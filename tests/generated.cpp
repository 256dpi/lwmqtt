#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "L\255\GS\208o\194\236\140\156\225\135\244\SO\154#", _pubPktID = 6184, _pubBody =
// "_\160\218auw5\192\154w\154\194:T\135\200\157", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x3c, 0x24, 0x0,  0xf,  0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c,
                   0xe1, 0x87, 0xf4, 0xe,  0x9a, 0x23, 0x18, 0x28, 0x5f, 0xa0, 0xda, 0x61, 0x75,
                   0x77, 0x35, 0xc0, 0x9a, 0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  uint8_t topic_bytes[] = {0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c, 0xe1, 0x87, 0xf4, 0xe, 0x9a, 0x23};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5f, 0xa0, 0xda, 0x61, 0x75, 0x77, 0x35, 0xc0, 0x9a,
                         0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6184, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "L\255\GS\208o\194\236\140\156\225\135\244\SO\154#", _pubPktID = 6184, _pubBody =
// "_\160\218auw5\192\154w\154\194:T\135\200\157", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x3c, 0x24, 0x0,  0xf,  0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c,
                   0xe1, 0x87, 0xf4, 0xe,  0x9a, 0x23, 0x18, 0x28, 0x5f, 0xa0, 0xda, 0x61, 0x75,
                   0x77, 0x35, 0xc0, 0x9a, 0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c, 0xe1, 0x87, 0xf4, 0xe, 0x9a, 0x23};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5f, 0xa0, 0xda, 0x61, 0x75, 0x77, 0x35, 0xc0, 0x9a,
                              0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6184);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\198\DC1L:\231)\185\220\223D\v\EOT\217<", _pubPktID = 6873, _pubBody = "\ESC\"[|\180", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x35, 0x17, 0x0, 0xe,  0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf,
                   0x44, 0xb,  0x4, 0xd9, 0x3c, 0x1a, 0xd9, 0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  uint8_t topic_bytes[] = {0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf, 0x44, 0xb, 0x4, 0xd9, 0x3c};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 6873, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\198\DC1L:\231)\185\220\223D\v\EOT\217<", _pubPktID = 6873, _pubBody = "\ESC\"[|\180", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x35, 0x17, 0x0, 0xe,  0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf,
                   0x44, 0xb,  0x4, 0xd9, 0x3c, 0x1a, 0xd9, 0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf, 0x44, 0xb, 0x4, 0xd9, 0x3c};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 6873);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "^W\131\160\253B\156\130SrVB\238=\158m_\253\242\178N", _pubPktID = 12282, _pubBody =
// "\169\159cc\RSh\239_U\ETB\NAK\223f", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x3a, 0x26, 0x0,  0x15, 0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72,
                   0x56, 0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e, 0x2f, 0xfa, 0xa9,
                   0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  uint8_t topic_bytes[] = {0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72, 0x56,
                           0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa9, 0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 12282, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "^W\131\160\253B\156\130SrVB\238=\158m_\253\242\178N", _pubPktID = 12282, _pubBody =
// "\169\159cc\RSh\239_U\ETB\NAK\223f", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x3a, 0x26, 0x0,  0x15, 0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72,
                   0x56, 0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e, 0x2f, 0xfa, 0xa9,
                   0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72, 0x56,
                               0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa9, 0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 12282);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\223~\247S\221_\137\253\202\t\SO<\197\171X=\DC1'\196\ACK", _pubPktID = 7369, _pubBody =
// "\218\SI\242\t\138\r\SO\ESC[\224\207", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x34, 0x23, 0x0,  0x14, 0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca,
                   0x9,  0xe,  0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6,  0x1c, 0xc9,
                   0xda, 0xf,  0xf2, 0x9,  0x8a, 0xd,  0xe,  0x1b, 0x5b, 0xe0, 0xcf};
  uint8_t topic_bytes[] = {0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca, 0x9,
                           0xe,  0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xda, 0xf, 0xf2, 0x9, 0x8a, 0xd, 0xe, 0x1b, 0x5b, 0xe0, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7369, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\223~\247S\221_\137\253\202\t\SO<\197\171X=\DC1'\196\ACK", _pubPktID = 7369, _pubBody =
// "\218\SI\242\t\138\r\SO\ESC[\224\207", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x34, 0x23, 0x0,  0x14, 0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca,
                   0x9,  0xe,  0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6,  0x1c, 0xc9,
                   0xda, 0xf,  0xf2, 0x9,  0x8a, 0xd,  0xe,  0x1b, 0x5b, 0xe0, 0xcf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca, 0x9,
                               0xe,  0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xda, 0xf, 0xf2, 0x9, 0x8a, 0xd, 0xe, 0x1b, 0x5b, 0xe0, 0xcf};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7369);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\250\191\190jan\209", _pubPktID =
// 6761, _pubBody = "z-\195\235\243\220Q", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x3c, 0x12, 0x0,  0x7,  0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e,
                   0xd1, 0x1a, 0x69, 0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  uint8_t topic_bytes[] = {0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e, 0xd1};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6761, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\250\191\190jan\209", _pubPktID =
// 6761, _pubBody = "z-\195\235\243\220Q", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x3c, 0x12, 0x0,  0x7,  0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e,
                   0xd1, 0x1a, 0x69, 0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e, 0xd1};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6761);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\229Y\156\186GOd\EOT\247\ETB\224\251-\228h{^Q!\246\b\DEL\225\NUL{/Q ", _pubPktID = 0, _pubBody = "<@\201Iv",
// _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x39, 0x23, 0x0,  0x1c, 0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4, 0xf7,
                   0x17, 0xe0, 0xfb, 0x2d, 0xe4, 0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8, 0x7f,
                   0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20, 0x3c, 0x40, 0xc9, 0x49, 0x76};
  uint8_t topic_bytes[] = {0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4,  0xf7, 0x17, 0xe0, 0xfb, 0x2d, 0xe4,
                           0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8,  0x7f, 0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3c, 0x40, 0xc9, 0x49, 0x76};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\229Y\156\186GOd\EOT\247\ETB\224\251-\228h{^Q!\246\b\DEL\225\NUL{/Q ", _pubPktID = 0, _pubBody = "<@\201Iv",
// _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x39, 0x23, 0x0,  0x1c, 0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4, 0xf7,
                   0x17, 0xe0, 0xfb, 0x2d, 0xe4, 0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8, 0x7f,
                   0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20, 0x3c, 0x40, 0xc9, 0x49, 0x76};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4,  0xf7, 0x17, 0xe0, 0xfb, 0x2d, 0xe4,
                               0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8,  0x7f, 0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3c, 0x40, 0xc9, 0x49, 0x76};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242\EM\182T\137\181\\_\NUL\137\135\&0\211", _pubPktID = 31937, _pubBody =
// "\242\196\240\145t\150mj\CANV\251\200\142o\192\150G", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x35, 0x22, 0x0,  0xd,  0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f,
                   0x0,  0x89, 0x87, 0x30, 0xd3, 0x7c, 0xc1, 0xf2, 0xc4, 0xf0, 0x91, 0x74,
                   0x96, 0x6d, 0x6a, 0x18, 0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  uint8_t topic_bytes[] = {0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f, 0x0, 0x89, 0x87, 0x30, 0xd3};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf2, 0xc4, 0xf0, 0x91, 0x74, 0x96, 0x6d, 0x6a, 0x18,
                         0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 31937, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242\EM\182T\137\181\\_\NUL\137\135\&0\211", _pubPktID = 31937, _pubBody =
// "\242\196\240\145t\150mj\CANV\251\200\142o\192\150G", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x35, 0x22, 0x0,  0xd,  0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f,
                   0x0,  0x89, 0x87, 0x30, 0xd3, 0x7c, 0xc1, 0xf2, 0xc4, 0xf0, 0x91, 0x74,
                   0x96, 0x6d, 0x6a, 0x18, 0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f, 0x0, 0x89, 0x87, 0x30, 0xd3};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf2, 0xc4, 0xf0, 0x91, 0x74, 0x96, 0x6d, 0x6a, 0x18,
                              0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 31937);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "q", _pubPktID = 31364, _pubBody =
// "J\NAK\203\196\226\"\223\GS\200a", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x33, 0xf, 0x0, 0x1, 0x71, 0x7a, 0x84, 0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  uint8_t topic_bytes[] = {0x71};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 31364, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "q", _pubPktID = 31364, _pubBody =
// "J\NAK\203\196\226\"\223\GS\200a", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x33, 0xf, 0x0, 0x1, 0x71, 0x7a, 0x84, 0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x71};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 31364);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\144\171\130\USB\155\212\163\136\212\154", _pubPktID = 8173, _pubBody =
// "\142\178\132u\236\130\153F\CANno\142\151\241\209\208\162\246\156\249\199", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x33, 0x24, 0x0,  0xb,  0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88,
                   0xd4, 0x9a, 0x1f, 0xed, 0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18,
                   0x6e, 0x6f, 0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  uint8_t topic_bytes[] = {0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88, 0xd4, 0x9a};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18, 0x6e, 0x6f,
                         0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 8173, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\144\171\130\USB\155\212\163\136\212\154", _pubPktID = 8173, _pubBody =
// "\142\178\132u\236\130\153F\CANno\142\151\241\209\208\162\246\156\249\199", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x33, 0x24, 0x0,  0xb,  0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88,
                   0xd4, 0x9a, 0x1f, 0xed, 0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18,
                   0x6e, 0x6f, 0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88, 0xd4, 0x9a};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18, 0x6e, 0x6f,
                              0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8173);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "@\179\160", _pubPktID = 5779,
// _pubBody = "+>\SI\ESC\130^\213\173\147\167D\FS\254\153\218c\237\133\220\156Zk\211\207", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x34, 0x1f, 0x0,  0x3,  0x40, 0xb3, 0xa0, 0x16, 0x93, 0x2b, 0x3e, 0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad,
                   0x93, 0xa7, 0x44, 0x1c, 0xfe, 0x99, 0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  uint8_t topic_bytes[] = {0x40, 0xb3, 0xa0};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2b, 0x3e, 0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad, 0x93, 0xa7, 0x44, 0x1c,
                         0xfe, 0x99, 0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 5779, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "@\179\160", _pubPktID = 5779,
// _pubBody = "+>\SI\ESC\130^\213\173\147\167D\FS\254\153\218c\237\133\220\156Zk\211\207", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x34, 0x1f, 0x0,  0x3,  0x40, 0xb3, 0xa0, 0x16, 0x93, 0x2b, 0x3e, 0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad,
                   0x93, 0xa7, 0x44, 0x1c, 0xfe, 0x99, 0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x40, 0xb3, 0xa0};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x3e, 0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad, 0x93, 0xa7, 0x44, 0x1c,
                              0xfe, 0x99, 0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5779);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "P\177\NAK.\190\171\224\139\&2\248]=\179n\DC4k\146\152\175\210\205`3|\135\&8i\209", _pubPktID = 19270, _pubBody =
// "\134\ENQKL\159E.\211+^\240\187\146\NAK7dRg\129.m\133\DLE\152C\ESCJ\160\203", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x32, 0x3d, 0x0,  0x1c, 0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d,
                   0xb3, 0x6e, 0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1,
                   0x4b, 0x46, 0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15,
                   0x37, 0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  uint8_t topic_bytes[] = {0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d, 0xb3, 0x6e,
                           0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15, 0x37,
                         0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 19270, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "P\177\NAK.\190\171\224\139\&2\248]=\179n\DC4k\146\152\175\210\205`3|\135\&8i\209", _pubPktID = 19270, _pubBody =
// "\134\ENQKL\159E.\211+^\240\187\146\NAK7dRg\129.m\133\DLE\152C\ESCJ\160\203", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x32, 0x3d, 0x0,  0x1c, 0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d,
                   0xb3, 0x6e, 0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1,
                   0x4b, 0x46, 0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15,
                   0x37, 0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d, 0xb3, 0x6e,
                               0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15, 0x37,
                              0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 19270);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DLE", _pubPktID = 0, _pubBody =
// "\DC4s\199\ACKg\249\133\ENQ\157\223\145\&2NM^T\137xH3\226=j,\r\239U\ACK\153\210", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x39, 0x21, 0x0,  0x1,  0x10, 0x14, 0x73, 0xc7, 0x6,  0x67, 0xf9, 0x85,
                   0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e, 0x54, 0x89, 0x78, 0x48,
                   0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  uint8_t topic_bytes[] = {0x10};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x14, 0x73, 0xc7, 0x6,  0x67, 0xf9, 0x85, 0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e,
                         0x54, 0x89, 0x78, 0x48, 0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DLE", _pubPktID = 0, _pubBody =
// "\DC4s\199\ACKg\249\133\ENQ\157\223\145\&2NM^T\137xH3\226=j,\r\239U\ACK\153\210", _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x39, 0x21, 0x0,  0x1,  0x10, 0x14, 0x73, 0xc7, 0x6,  0x67, 0xf9, 0x85,
                   0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e, 0x54, 0x89, 0x78, 0x48,
                   0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x10};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x14, 0x73, 0xc7, 0x6,  0x67, 0xf9, 0x85, 0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e,
                              0x54, 0x89, 0x78, 0x48, 0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\171b\DC1\233\"[\161x\tR2\b\143\ap\176)0\156/\230\155\ETBx\154h*|", _pubPktID = 3357, _pubBody = "\139", _pubProps =
// []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x3c, 0x21, 0x0,  0x1c, 0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78,
                   0x9,  0x52, 0x32, 0x8,  0x8f, 0x7,  0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f,
                   0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a, 0x7c, 0xd,  0x1d, 0x8b};
  uint8_t topic_bytes[] = {0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78, 0x9,  0x52, 0x32, 0x8,  0x8f, 0x7,
                           0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f, 0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a, 0x7c};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 3357, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\171b\DC1\233\"[\161x\tR2\b\143\ap\176)0\156/\230\155\ETBx\154h*|", _pubPktID = 3357, _pubBody = "\139", _pubProps =
// []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x3c, 0x21, 0x0,  0x1c, 0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78,
                   0x9,  0x52, 0x32, 0x8,  0x8f, 0x7,  0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f,
                   0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a, 0x7c, 0xd,  0x1d, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78, 0x9,  0x52, 0x32, 0x8,  0x8f, 0x7,
                               0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f, 0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a, 0x7c};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8b};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3357);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\243\197\208\135\165\n\174^Z4\184\231\152+\166\ETX\175`\187\229\171:\143\196\rO\140G", _pubPktID = 31669, _pubBody =
// "\165yk,.\240\234\134]\245eA\SI\171\146\201\234a.\165", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x34, 0x34, 0x0,  0x1c, 0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34,
                   0xb8, 0xe7, 0x98, 0x2b, 0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4,
                   0xd,  0x4f, 0x8c, 0x47, 0x7b, 0xb5, 0xa5, 0x79, 0x6b, 0x2c, 0x2e, 0xf0, 0xea, 0x86,
                   0x5d, 0xf5, 0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  uint8_t topic_bytes[] = {0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34, 0xb8, 0xe7, 0x98, 0x2b,
                           0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4, 0xd,  0x4f, 0x8c, 0x47};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0x79, 0x6b, 0x2c, 0x2e, 0xf0, 0xea, 0x86, 0x5d, 0xf5,
                         0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 31669, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\243\197\208\135\165\n\174^Z4\184\231\152+\166\ETX\175`\187\229\171:\143\196\rO\140G", _pubPktID = 31669, _pubBody =
// "\165yk,.\240\234\134]\245eA\SI\171\146\201\234a.\165", _pubProps = []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x34, 0x34, 0x0,  0x1c, 0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34,
                   0xb8, 0xe7, 0x98, 0x2b, 0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4,
                   0xd,  0x4f, 0x8c, 0x47, 0x7b, 0xb5, 0xa5, 0x79, 0x6b, 0x2c, 0x2e, 0xf0, 0xea, 0x86,
                   0x5d, 0xf5, 0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34, 0xb8, 0xe7, 0x98, 0x2b,
                               0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4, 0xd,  0x4f, 0x8c, 0x47};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa5, 0x79, 0x6b, 0x2c, 0x2e, 0xf0, 0xea, 0x86, 0x5d, 0xf5,
                              0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31669);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\v\172h\241z\159Z'\153h\STXiS.\STX&a\166|\147~\ETBbP\194\242$`q", _pubPktID = 29118, _pubBody =
// "\155\GS\134h\241\DC2\174", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x33, 0x28, 0x0,  0x1d, 0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68,
                   0x2,  0x69, 0x53, 0x2e, 0x2,  0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50,
                   0xc2, 0xf2, 0x24, 0x60, 0x71, 0x71, 0xbe, 0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  uint8_t topic_bytes[] = {0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68, 0x2,  0x69, 0x53, 0x2e, 0x2,
                           0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50, 0xc2, 0xf2, 0x24, 0x60, 0x71};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29118, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\v\172h\241z\159Z'\153h\STXiS.\STX&a\166|\147~\ETBbP\194\242$`q", _pubPktID = 29118, _pubBody =
// "\155\GS\134h\241\DC2\174", _pubProps = []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x33, 0x28, 0x0,  0x1d, 0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68,
                   0x2,  0x69, 0x53, 0x2e, 0x2,  0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50,
                   0xc2, 0xf2, 0x24, 0x60, 0x71, 0x71, 0xbe, 0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68, 0x2,  0x69, 0x53, 0x2e, 0x2,
                               0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50, 0xc2, 0xf2, 0x24, 0x60, 0x71};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29118);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "q+J\205\r\197\201+\DLE\216\DC4\207\206\SI\242\241\137\SUB\213\246\&1\NUL%\242b\204", _pubPktID = 0, _pubBody =
// "\137[\151L+\\\238\187\158\137/}8}\vL\159\208\134\DC4\192", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x39, 0x31, 0x0,  0x1a, 0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10,
                   0xd8, 0x14, 0xcf, 0xce, 0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,
                   0x25, 0xf2, 0x62, 0xcc, 0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb, 0x9e,
                   0x89, 0x2f, 0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  uint8_t topic_bytes[] = {0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10, 0xd8, 0x14, 0xcf, 0xce,
                           0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,  0x25, 0xf2, 0x62, 0xcc};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb, 0x9e, 0x89, 0x2f,
                         0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "q+J\205\r\197\201+\DLE\216\DC4\207\206\SI\242\241\137\SUB\213\246\&1\NUL%\242b\204", _pubPktID = 0, _pubBody =
// "\137[\151L+\\\238\187\158\137/}8}\vL\159\208\134\DC4\192", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x39, 0x31, 0x0,  0x1a, 0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10,
                   0xd8, 0x14, 0xcf, 0xce, 0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,
                   0x25, 0xf2, 0x62, 0xcc, 0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb, 0x9e,
                   0x89, 0x2f, 0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10, 0xd8, 0x14, 0xcf, 0xce,
                               0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,  0x25, 0xf2, 0x62, 0xcc};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb, 0x9e, 0x89, 0x2f,
                              0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "6", _pubPktID = 0, _pubBody = "b",
// _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x31, 0x4, 0x0, 0x1, 0x36, 0x62};
  uint8_t topic_bytes[] = {0x36};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x62};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "6", _pubPktID = 0, _pubBody = "b",
// _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x31, 0x4, 0x0, 0x1, 0x36, 0x62};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x36};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x62};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\150\184\EOT\177\237[w\205\DC4E\GS@",
// _pubPktID = 11334, _pubBody = "\247ax\ESCb", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x3b, 0x15, 0x0,  0xc,  0x96, 0xb8, 0x4,  0xb1, 0xed, 0x5b, 0x77, 0xcd,
                   0x14, 0x45, 0x1d, 0x40, 0x2c, 0x46, 0xf7, 0x61, 0x78, 0x1b, 0x62};
  uint8_t topic_bytes[] = {0x96, 0xb8, 0x4, 0xb1, 0xed, 0x5b, 0x77, 0xcd, 0x14, 0x45, 0x1d, 0x40};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf7, 0x61, 0x78, 0x1b, 0x62};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 11334, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\150\184\EOT\177\237[w\205\DC4E\GS@",
// _pubPktID = 11334, _pubBody = "\247ax\ESCb", _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x3b, 0x15, 0x0,  0xc,  0x96, 0xb8, 0x4,  0xb1, 0xed, 0x5b, 0x77, 0xcd,
                   0x14, 0x45, 0x1d, 0x40, 0x2c, 0x46, 0xf7, 0x61, 0x78, 0x1b, 0x62};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x96, 0xb8, 0x4, 0xb1, 0xed, 0x5b, 0x77, 0xcd, 0x14, 0x45, 0x1d, 0x40};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf7, 0x61, 0x78, 0x1b, 0x62};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 11334);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\tm5\139\DC1\DC18\255>\b\a\EM\145\213XbT\218|", _pubPktID = 0, _pubBody = "\DC4\GS+\EM\ESC\132B\172\232|\215",
// _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x31, 0x20, 0x0,  0x13, 0x9,  0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff,
                   0x3e, 0x8,  0x7,  0x19, 0x91, 0xd5, 0x58, 0x62, 0x54, 0xda, 0x7c, 0x14,
                   0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  uint8_t topic_bytes[] = {0x9, 0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff, 0x3e, 0x8,
                           0x7, 0x19, 0x91, 0xd5, 0x58, 0x62, 0x54, 0xda, 0x7c};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x14, 0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\tm5\139\DC1\DC18\255>\b\a\EM\145\213XbT\218|", _pubPktID = 0, _pubBody = "\DC4\GS+\EM\ESC\132B\172\232|\215",
// _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x31, 0x20, 0x0,  0x13, 0x9,  0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff,
                   0x3e, 0x8,  0x7,  0x19, 0x91, 0xd5, 0x58, 0x62, 0x54, 0xda, 0x7c, 0x14,
                   0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9, 0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff, 0x3e, 0x8,
                               0x7, 0x19, 0x91, 0xd5, 0x58, 0x62, 0x54, 0xda, 0x7c};
  lwmqtt_string_t exp_topic = {19, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x14, 0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 19);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\211Q\204\149\142\&8\217\174\213\221\133\214\221\166\207E\151\t\221y\192>\ETBqK[", _pubPktID = 0, _pubBody =
// "\189\221\169\130\f\211\DC1\DC2\252", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x30, 0x25, 0x0,  0x1a, 0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5,
                   0xdd, 0x85, 0xd6, 0xdd, 0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e,
                   0x17, 0x71, 0x4b, 0x5b, 0xbd, 0xdd, 0xa9, 0x82, 0xc,  0xd3, 0x11, 0x12, 0xfc};
  uint8_t topic_bytes[] = {0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5, 0xdd, 0x85, 0xd6, 0xdd,
                           0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e, 0x17, 0x71, 0x4b, 0x5b};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbd, 0xdd, 0xa9, 0x82, 0xc, 0xd3, 0x11, 0x12, 0xfc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\211Q\204\149\142\&8\217\174\213\221\133\214\221\166\207E\151\t\221y\192>\ETBqK[", _pubPktID = 0, _pubBody =
// "\189\221\169\130\f\211\DC1\DC2\252", _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x30, 0x25, 0x0,  0x1a, 0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5,
                   0xdd, 0x85, 0xd6, 0xdd, 0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e,
                   0x17, 0x71, 0x4b, 0x5b, 0xbd, 0xdd, 0xa9, 0x82, 0xc,  0xd3, 0x11, 0x12, 0xfc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5, 0xdd, 0x85, 0xd6, 0xdd,
                               0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e, 0x17, 0x71, 0x4b, 0x5b};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbd, 0xdd, 0xa9, 0x82, 0xc, 0xd3, 0x11, 0x12, 0xfc};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "p\211K\218>w\SOHst%h%\249P\an\SYNF\157q=]", _pubPktID = 0, _pubBody = "\135 \184\208\200\r\GSu\205<Z\162", _pubProps
// = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x38, 0x24, 0x0,  0x16, 0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74,
                   0x25, 0x68, 0x25, 0xf9, 0x50, 0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d,
                   0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd,  0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  uint8_t topic_bytes[] = {0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74, 0x25, 0x68,
                           0x25, 0xf9, 0x50, 0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd, 0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "p\211K\218>w\SOHst%h%\249P\an\SYNF\157q=]", _pubPktID = 0, _pubBody = "\135 \184\208\200\r\GSu\205<Z\162", _pubProps
// = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x38, 0x24, 0x0,  0x16, 0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74,
                   0x25, 0x68, 0x25, 0xf9, 0x50, 0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d,
                   0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd,  0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74, 0x25, 0x68,
                               0x25, 0xf9, 0x50, 0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd, 0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\249", _pubPktID = 7383, _pubBody =
// "\166\v\241D\ESCtx4\151\196\206=\239 r\RS\159\195\249NT_", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x32, 0x1b, 0x0,  0x1,  0xf9, 0x1c, 0xd7, 0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78, 0x34,
                   0x97, 0xc4, 0xce, 0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  uint8_t topic_bytes[] = {0xf9};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78, 0x34, 0x97, 0xc4, 0xce,
                         0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7383, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\249", _pubPktID = 7383, _pubBody =
// "\166\v\241D\ESCtx4\151\196\206=\239 r\RS\159\195\249NT_", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x32, 0x1b, 0x0,  0x1,  0xf9, 0x1c, 0xd7, 0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78, 0x34,
                   0x97, 0xc4, 0xce, 0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf9};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78, 0x34, 0x97, 0xc4, 0xce,
                              0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7383);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\156\249\196\168\224\205\FS\219\244\128\231\SYN\252\239j\NAK\164\171G]\133\229\147Q\199(\f\249y", _pubPktID = 11390,
// _pubBody = "s\226]\184\NUL\176A\242\&3\195\ETBC\RSN\254\t\t\\\203\255=\180B\201k\163", _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x3a, 0x3b, 0x0,  0x1d, 0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16,
                   0xfc, 0xef, 0x6a, 0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9,
                   0x79, 0x2c, 0x7e, 0x73, 0xe2, 0x5d, 0xb8, 0x0,  0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e,
                   0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9, 0x6b, 0xa3};
  uint8_t topic_bytes[] = {0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16, 0xfc, 0xef, 0x6a,
                           0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9, 0x79};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x73, 0xe2, 0x5d, 0xb8, 0x0,  0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e,
                         0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9, 0x6b, 0xa3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 11390, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\156\249\196\168\224\205\FS\219\244\128\231\SYN\252\239j\NAK\164\171G]\133\229\147Q\199(\f\249y", _pubPktID = 11390,
// _pubBody = "s\226]\184\NUL\176A\242\&3\195\ETBC\RSN\254\t\t\\\203\255=\180B\201k\163", _pubProps = []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x3a, 0x3b, 0x0,  0x1d, 0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16,
                   0xfc, 0xef, 0x6a, 0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9,
                   0x79, 0x2c, 0x7e, 0x73, 0xe2, 0x5d, 0xb8, 0x0,  0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e,
                   0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9, 0x6b, 0xa3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16, 0xfc, 0xef, 0x6a,
                               0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9, 0x79};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x73, 0xe2, 0x5d, 0xb8, 0x0,  0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e,
                              0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9, 0x6b, 0xa3};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11390);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\247\&51\173<\172\250\229U\SOH\214a\211n>\225\&2^", _pubPktID = 0, _pubBody =
// "\r\136\219Jg\197\169\234\190\251\255K\212\139c\186,\229", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x30, 0x26, 0x0,  0x12, 0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55, 0x1,
                   0xd6, 0x61, 0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e, 0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5,
                   0xa9, 0xea, 0xbe, 0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  uint8_t topic_bytes[] = {0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55,
                           0x1,  0xd6, 0x61, 0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5, 0xa9, 0xea, 0xbe,
                         0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\247\&51\173<\172\250\229U\SOH\214a\211n>\225\&2^", _pubPktID = 0, _pubBody =
// "\r\136\219Jg\197\169\234\190\251\255K\212\139c\186,\229", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x30, 0x26, 0x0,  0x12, 0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55, 0x1,
                   0xd6, 0x61, 0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e, 0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5,
                   0xa9, 0xea, 0xbe, 0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55,
                               0x1,  0xd6, 0x61, 0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5, 0xa9, 0xea, 0xbe,
                              0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\DC3
// \244\212\ETX\143\186\222G-\212", _pubPktID = 0, _pubBody = "cndv<\250\182\170?\140\SYN\204\158n'\161tLKL\DC4\131",
// _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x30, 0x23, 0x0,  0xb,  0x13, 0x20, 0xf4, 0xd4, 0x3,  0x8f, 0xba, 0xde, 0x47,
                   0x2d, 0xd4, 0x63, 0x6e, 0x64, 0x76, 0x3c, 0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16,
                   0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  uint8_t topic_bytes[] = {0x13, 0x20, 0xf4, 0xd4, 0x3, 0x8f, 0xba, 0xde, 0x47, 0x2d, 0xd4};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x63, 0x6e, 0x64, 0x76, 0x3c, 0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16,
                         0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\DC3
// \244\212\ETX\143\186\222G-\212", _pubPktID = 0, _pubBody = "cndv<\250\182\170?\140\SYN\204\158n'\161tLKL\DC4\131",
// _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x30, 0x23, 0x0,  0xb,  0x13, 0x20, 0xf4, 0xd4, 0x3,  0x8f, 0xba, 0xde, 0x47,
                   0x2d, 0xd4, 0x63, 0x6e, 0x64, 0x76, 0x3c, 0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16,
                   0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x13, 0x20, 0xf4, 0xd4, 0x3, 0x8f, 0xba, 0xde, 0x47, 0x2d, 0xd4};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x63, 0x6e, 0x64, 0x76, 0x3c, 0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16,
                              0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "o#L\177\210\EOT\140\230w\252ir\220-\217\230\154\182\a0(\169\225\232uo", _pubPktID = 0, _pubBody =
// "2\137\n\NUL\201\149\252e\191]\CAN#`\250", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x31, 0x2a, 0x0,  0x1a, 0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4,  0x8c, 0xe6, 0x77, 0xfc, 0x69,
                   0x72, 0xdc, 0x2d, 0xd9, 0xe6, 0x9a, 0xb6, 0x7,  0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f,
                   0x32, 0x89, 0xa,  0x0,  0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  uint8_t topic_bytes[] = {0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4, 0x8c, 0xe6, 0x77, 0xfc, 0x69, 0x72, 0xdc,
                           0x2d, 0xd9, 0xe6, 0x9a, 0xb6, 0x7, 0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x32, 0x89, 0xa, 0x0, 0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "o#L\177\210\EOT\140\230w\252ir\220-\217\230\154\182\a0(\169\225\232uo", _pubPktID = 0, _pubBody =
// "2\137\n\NUL\201\149\252e\191]\CAN#`\250", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x31, 0x2a, 0x0,  0x1a, 0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4,  0x8c, 0xe6, 0x77, 0xfc, 0x69,
                   0x72, 0xdc, 0x2d, 0xd9, 0xe6, 0x9a, 0xb6, 0x7,  0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f,
                   0x32, 0x89, 0xa,  0x0,  0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4, 0x8c, 0xe6, 0x77, 0xfc, 0x69, 0x72, 0xdc,
                               0x2d, 0xd9, 0xe6, 0x9a, 0xb6, 0x7, 0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x32, 0x89, 0xa, 0x0, 0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "O\216\186", _pubPktID = 31863,
// _pubBody = "\206\US\183\184\207\198X\216\SOn\202 \214", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x3d, 0x14, 0x0,  0x3,  0x4f, 0xd8, 0xba, 0x7c, 0x77, 0xce, 0x1f,
                   0xb7, 0xb8, 0xcf, 0xc6, 0x58, 0xd8, 0xe,  0x6e, 0xca, 0x20, 0xd6};
  uint8_t topic_bytes[] = {0x4f, 0xd8, 0xba};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xce, 0x1f, 0xb7, 0xb8, 0xcf, 0xc6, 0x58, 0xd8, 0xe, 0x6e, 0xca, 0x20, 0xd6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 31863, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "O\216\186", _pubPktID = 31863,
// _pubBody = "\206\US\183\184\207\198X\216\SOn\202 \214", _pubProps = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x3d, 0x14, 0x0,  0x3,  0x4f, 0xd8, 0xba, 0x7c, 0x77, 0xce, 0x1f,
                   0xb7, 0xb8, 0xcf, 0xc6, 0x58, 0xd8, 0xe,  0x6e, 0xca, 0x20, 0xd6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x4f, 0xd8, 0xba};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xce, 0x1f, 0xb7, 0xb8, 0xcf, 0xc6, 0x58, 0xd8, 0xe, 0x6e, 0xca, 0x20, 0xd6};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 31863);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "r8*
// \EM\150\251uUH\DEL\151\232\SOH\RS\240\192\167=\255\246\193\250*<", _pubPktID = 26145, _pubBody =
// "\165\DC2\SOH6&\169\226\233\172\134`\205\149\221__", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x32, 0x2d, 0x0,  0x19, 0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97,
                   0xe8, 0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c, 0x66, 0x21, 0xa5,
                   0x12, 0x1,  0x36, 0x26, 0xa9, 0xe2, 0xe9, 0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  uint8_t topic_bytes[] = {0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97, 0xe8,
                           0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0x12, 0x1, 0x36, 0x26, 0xa9, 0xe2, 0xe9, 0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 26145, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "r8*
// \EM\150\251uUH\DEL\151\232\SOH\RS\240\192\167=\255\246\193\250*<", _pubPktID = 26145, _pubBody =
// "\165\DC2\SOH6&\169\226\233\172\134`\205\149\221__", _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x32, 0x2d, 0x0,  0x19, 0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97,
                   0xe8, 0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c, 0x66, 0x21, 0xa5,
                   0x12, 0x1,  0x36, 0x26, 0xa9, 0xe2, 0xe9, 0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97, 0xe8,
                               0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa5, 0x12, 0x1,  0x36, 0x26, 0xa9, 0xe2, 0xe9,
                              0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 26145);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 7976, _pubBody =
// "\ENQP\a\164\163\166{\250{", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x3b, 0xd, 0x0, 0x0, 0x1f, 0x28, 0x5, 0x50, 0x7, 0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5, 0x50, 0x7, 0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 7976, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 7976, _pubBody =
// "\ENQP\a\164\163\166{\250{", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x3b, 0xd, 0x0, 0x0, 0x1f, 0x28, 0x5, 0x50, 0x7, 0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5, 0x50, 0x7, 0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 7976);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\197\a\164\SUB\DC1\195\RS`\FS\155?\206\154I\134\181\139\252Vc\161i`\DC3\245", _pubPktID = 3213, _pubBody =
// "\249a\NAK\209f+\v\251'\141\199\&6\195s\160^:v\251\&5\174\FS\240\191k\205\"\201\222=", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x35, 0x3b, 0x0,  0x19, 0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce,
                   0x9a, 0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5, 0xc,  0x8d, 0xf9,
                   0x61, 0x15, 0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0, 0x5e, 0x3a,
                   0x76, 0xfb, 0x35, 0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  uint8_t topic_bytes[] = {0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce, 0x9a,
                           0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf9, 0x61, 0x15, 0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0,
                         0x5e, 0x3a, 0x76, 0xfb, 0x35, 0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 3213, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\197\a\164\SUB\DC1\195\RS`\FS\155?\206\154I\134\181\139\252Vc\161i`\DC3\245", _pubPktID = 3213, _pubBody =
// "\249a\NAK\209f+\v\251'\141\199\&6\195s\160^:v\251\&5\174\FS\240\191k\205\"\201\222=", _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x35, 0x3b, 0x0,  0x19, 0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce,
                   0x9a, 0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5, 0xc,  0x8d, 0xf9,
                   0x61, 0x15, 0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0, 0x5e, 0x3a,
                   0x76, 0xfb, 0x35, 0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce, 0x9a,
                               0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf9, 0x61, 0x15, 0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0,
                              0x5e, 0x3a, 0x76, 0xfb, 0x35, 0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 3213);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "L\255\GS\208o\194\236\140\156\225\135\244\SO\154#", _pubPktID = 6184, _pubBody =
// "_\160\218auw5\192\154w\154\194:T\135\200\157", _pubProps = [PropTopicAliasMaximum
// 15521,PropRequestResponseInformation 202,PropServerReference "",PropServerKeepAlive 27747,PropUserProperty
// "1\250^n\DELx\208e/~\246we" "8,\249\179r\DC2",PropSubscriptionIdentifierAvailable 146,PropSharedSubscriptionAvailable
// 249,PropRetainAvailable 178,PropCorrelationData "\ENQ\231",PropServerReference "F",PropWildcardSubscriptionAvailable
// 173,PropMaximumPacketSize 23566,PropSubscriptionIdentifier 22,PropSubscriptionIdentifierAvailable 53,PropTopicAlias
// 15812,PropServerKeepAlive 31656,PropContentType
// "_\240\vO\162;\136g\247\135\144ae\182;\154\237X\DELCf2\EOT*\171h",PropReasonString
// "\146\r]\239\153\&5r`1#\251",PropResponseTopic
// "G\164\230\178G\CAN\234\254p\DEL\156\250KR\r\219x@\247t\164\141\&9",PropAuthenticationData
// "B]0.\181\174\177\221T\128`D\210\253@\137[\DC2\174\160\245\227\170u\SI{^\241",PropWillDelayInterval
// 30420,PropAuthenticationData "\NUL\245\ETX\229[\STX\140\179V\227\226\220t\DC20\164R",PropReceiveMaximum
// 12547,PropTopicAlias 18835,PropMaximumQoS 44,PropMaximumPacketSize 5027,PropSharedSubscriptionAvailable
// 105,PropTopicAlias 9204,PropServerKeepAlive 4590,PropRequestProblemInformation 67]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x3c, 0xfd, 0x1,  0x0,  0xf,  0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c, 0xe1, 0x87, 0xf4, 0xe,  0x9a,
      0x23, 0x18, 0x28, 0xd7, 0x1,  0x22, 0x3c, 0xa1, 0x19, 0xca, 0x1c, 0x0,  0x0,  0x13, 0x6c, 0x63, 0x26, 0x0,  0xd,
      0x31, 0xfa, 0x5e, 0x6e, 0x7f, 0x78, 0xd0, 0x65, 0x2f, 0x7e, 0xf6, 0x77, 0x65, 0x0,  0x6,  0x38, 0x2c, 0xf9, 0xb3,
      0x72, 0x12, 0x29, 0x92, 0x2a, 0xf9, 0x25, 0xb2, 0x9,  0x0,  0x2,  0x5,  0xe7, 0x1c, 0x0,  0x1,  0x46, 0x28, 0xad,
      0x27, 0x0,  0x0,  0x5c, 0xe,  0xb,  0x16, 0x29, 0x35, 0x23, 0x3d, 0xc4, 0x13, 0x7b, 0xa8, 0x3,  0x0,  0x1a, 0x5f,
      0xf0, 0xb,  0x4f, 0xa2, 0x3b, 0x88, 0x67, 0xf7, 0x87, 0x90, 0x61, 0x65, 0xb6, 0x3b, 0x9a, 0xed, 0x58, 0x7f, 0x43,
      0x66, 0x32, 0x4,  0x2a, 0xab, 0x68, 0x1f, 0x0,  0xb,  0x92, 0xd,  0x5d, 0xef, 0x99, 0x35, 0x72, 0x60, 0x31, 0x23,
      0xfb, 0x8,  0x0,  0x17, 0x47, 0xa4, 0xe6, 0xb2, 0x47, 0x18, 0xea, 0xfe, 0x70, 0x7f, 0x9c, 0xfa, 0x4b, 0x52, 0xd,
      0xdb, 0x78, 0x40, 0xf7, 0x74, 0xa4, 0x8d, 0x39, 0x16, 0x0,  0x1c, 0x42, 0x5d, 0x30, 0x2e, 0xb5, 0xae, 0xb1, 0xdd,
      0x54, 0x80, 0x60, 0x44, 0xd2, 0xfd, 0x40, 0x89, 0x5b, 0x12, 0xae, 0xa0, 0xf5, 0xe3, 0xaa, 0x75, 0xf,  0x7b, 0x5e,
      0xf1, 0x18, 0x0,  0x0,  0x76, 0xd4, 0x16, 0x0,  0x11, 0x0,  0xf5, 0x3,  0xe5, 0x5b, 0x2,  0x8c, 0xb3, 0x56, 0xe3,
      0xe2, 0xdc, 0x74, 0x12, 0x30, 0xa4, 0x52, 0x21, 0x31, 0x3,  0x23, 0x49, 0x93, 0x24, 0x2c, 0x27, 0x0,  0x0,  0x13,
      0xa3, 0x2a, 0x69, 0x23, 0x23, 0xf4, 0x13, 0x11, 0xee, 0x17, 0x43, 0x5f, 0xa0, 0xda, 0x61, 0x75, 0x77, 0x35, 0xc0,
      0x9a, 0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  uint8_t topic_bytes[] = {0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c, 0xe1, 0x87, 0xf4, 0xe, 0x9a, 0x23};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x5f, 0xa0, 0xda, 0x61, 0x75, 0x77, 0x35, 0xc0, 0x9a,
                         0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops2[] = {0x38, 0x2c, 0xf9, 0xb3, 0x72, 0x12};
  uint8_t bytesprops1[] = {0x31, 0xfa, 0x5e, 0x6e, 0x7f, 0x78, 0xd0, 0x65, 0x2f, 0x7e, 0xf6, 0x77, 0x65};
  uint8_t bytesprops3[] = {0x5, 0xe7};
  uint8_t bytesprops4[] = {0x46};
  uint8_t bytesprops5[] = {0x5f, 0xf0, 0xb,  0x4f, 0xa2, 0x3b, 0x88, 0x67, 0xf7, 0x87, 0x90, 0x61, 0x65,
                           0xb6, 0x3b, 0x9a, 0xed, 0x58, 0x7f, 0x43, 0x66, 0x32, 0x4,  0x2a, 0xab, 0x68};
  uint8_t bytesprops6[] = {0x92, 0xd, 0x5d, 0xef, 0x99, 0x35, 0x72, 0x60, 0x31, 0x23, 0xfb};
  uint8_t bytesprops7[] = {0x47, 0xa4, 0xe6, 0xb2, 0x47, 0x18, 0xea, 0xfe, 0x70, 0x7f, 0x9c, 0xfa,
                           0x4b, 0x52, 0xd,  0xdb, 0x78, 0x40, 0xf7, 0x74, 0xa4, 0x8d, 0x39};
  uint8_t bytesprops8[] = {0x42, 0x5d, 0x30, 0x2e, 0xb5, 0xae, 0xb1, 0xdd, 0x54, 0x80, 0x60, 0x44, 0xd2, 0xfd,
                           0x40, 0x89, 0x5b, 0x12, 0xae, 0xa0, 0xf5, 0xe3, 0xaa, 0x75, 0xf,  0x7b, 0x5e, 0xf1};
  uint8_t bytesprops9[] = {0x0,  0xf5, 0x3,  0xe5, 0x5b, 0x2,  0x8c, 0xb3, 0x56,
                           0xe3, 0xe2, 0xdc, 0x74, 0x12, 0x30, 0xa4, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15521}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27747}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops1}, .v = {6, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23566}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15812}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31656}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30420}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12547}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18835}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5027}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9204}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4590}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 67}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6184, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "L\255\GS\208o\194\236\140\156\225\135\244\SO\154#", _pubPktID = 6184, _pubBody =
// "_\160\218auw5\192\154w\154\194:T\135\200\157", _pubProps = [PropTopicAliasMaximum
// 15521,PropRequestResponseInformation 202,PropServerReference "",PropServerKeepAlive 27747,PropUserProperty
// "1\250^n\DELx\208e/~\246we" "8,\249\179r\DC2",PropSubscriptionIdentifierAvailable 146,PropSharedSubscriptionAvailable
// 249,PropRetainAvailable 178,PropCorrelationData "\ENQ\231",PropServerReference "F",PropWildcardSubscriptionAvailable
// 173,PropMaximumPacketSize 23566,PropSubscriptionIdentifier 22,PropSubscriptionIdentifierAvailable 53,PropTopicAlias
// 15812,PropServerKeepAlive 31656,PropContentType
// "_\240\vO\162;\136g\247\135\144ae\182;\154\237X\DELCf2\EOT*\171h",PropReasonString
// "\146\r]\239\153\&5r`1#\251",PropResponseTopic
// "G\164\230\178G\CAN\234\254p\DEL\156\250KR\r\219x@\247t\164\141\&9",PropAuthenticationData
// "B]0.\181\174\177\221T\128`D\210\253@\137[\DC2\174\160\245\227\170u\SI{^\241",PropWillDelayInterval
// 30420,PropAuthenticationData "\NUL\245\ETX\229[\STX\140\179V\227\226\220t\DC20\164R",PropReceiveMaximum
// 12547,PropTopicAlias 18835,PropMaximumQoS 44,PropMaximumPacketSize 5027,PropSharedSubscriptionAvailable
// 105,PropTopicAlias 9204,PropServerKeepAlive 4590,PropRequestProblemInformation 67]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {
      0x3c, 0xfd, 0x1,  0x0,  0xf,  0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c, 0xe1, 0x87, 0xf4, 0xe,  0x9a,
      0x23, 0x18, 0x28, 0xd7, 0x1,  0x22, 0x3c, 0xa1, 0x19, 0xca, 0x1c, 0x0,  0x0,  0x13, 0x6c, 0x63, 0x26, 0x0,  0xd,
      0x31, 0xfa, 0x5e, 0x6e, 0x7f, 0x78, 0xd0, 0x65, 0x2f, 0x7e, 0xf6, 0x77, 0x65, 0x0,  0x6,  0x38, 0x2c, 0xf9, 0xb3,
      0x72, 0x12, 0x29, 0x92, 0x2a, 0xf9, 0x25, 0xb2, 0x9,  0x0,  0x2,  0x5,  0xe7, 0x1c, 0x0,  0x1,  0x46, 0x28, 0xad,
      0x27, 0x0,  0x0,  0x5c, 0xe,  0xb,  0x16, 0x29, 0x35, 0x23, 0x3d, 0xc4, 0x13, 0x7b, 0xa8, 0x3,  0x0,  0x1a, 0x5f,
      0xf0, 0xb,  0x4f, 0xa2, 0x3b, 0x88, 0x67, 0xf7, 0x87, 0x90, 0x61, 0x65, 0xb6, 0x3b, 0x9a, 0xed, 0x58, 0x7f, 0x43,
      0x66, 0x32, 0x4,  0x2a, 0xab, 0x68, 0x1f, 0x0,  0xb,  0x92, 0xd,  0x5d, 0xef, 0x99, 0x35, 0x72, 0x60, 0x31, 0x23,
      0xfb, 0x8,  0x0,  0x17, 0x47, 0xa4, 0xe6, 0xb2, 0x47, 0x18, 0xea, 0xfe, 0x70, 0x7f, 0x9c, 0xfa, 0x4b, 0x52, 0xd,
      0xdb, 0x78, 0x40, 0xf7, 0x74, 0xa4, 0x8d, 0x39, 0x16, 0x0,  0x1c, 0x42, 0x5d, 0x30, 0x2e, 0xb5, 0xae, 0xb1, 0xdd,
      0x54, 0x80, 0x60, 0x44, 0xd2, 0xfd, 0x40, 0x89, 0x5b, 0x12, 0xae, 0xa0, 0xf5, 0xe3, 0xaa, 0x75, 0xf,  0x7b, 0x5e,
      0xf1, 0x18, 0x0,  0x0,  0x76, 0xd4, 0x16, 0x0,  0x11, 0x0,  0xf5, 0x3,  0xe5, 0x5b, 0x2,  0x8c, 0xb3, 0x56, 0xe3,
      0xe2, 0xdc, 0x74, 0x12, 0x30, 0xa4, 0x52, 0x21, 0x31, 0x3,  0x23, 0x49, 0x93, 0x24, 0x2c, 0x27, 0x0,  0x0,  0x13,
      0xa3, 0x2a, 0x69, 0x23, 0x23, 0xf4, 0x13, 0x11, 0xee, 0x17, 0x43, 0x5f, 0xa0, 0xda, 0x61, 0x75, 0x77, 0x35, 0xc0,
      0x9a, 0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x4c, 0xff, 0x1d, 0xd0, 0x6f, 0xc2, 0xec, 0x8c, 0x9c, 0xe1, 0x87, 0xf4, 0xe, 0x9a, 0x23};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5f, 0xa0, 0xda, 0x61, 0x75, 0x77, 0x35, 0xc0, 0x9a,
                              0x77, 0x9a, 0xc2, 0x3a, 0x54, 0x87, 0xc8, 0x9d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6184);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\198\DC1L:\231)\185\220\223D\v\EOT\217<", _pubPktID = 6873, _pubBody = "\ESC\"[|\180", _pubProps =
// [PropSubscriptionIdentifier 26,PropSubscriptionIdentifier 20,PropSubscriptionIdentifierAvailable
// 97,PropSessionExpiryInterval 1270,PropMaximumQoS 17,PropTopicAliasMaximum 10662,PropServerReference
// "1\200T%r\131\SOHr\212\191\242\CAN\247#\238v\nH\DC4\201Z\164\245\223\FS]",PropWillDelayInterval 643,PropMaximumQoS
// 77,PropPayloadFormatIndicator 204,PropAuthenticationData "\191
// \136a\144\SUB\218\233\142\192\141\188\130\200\&2\140\234\168.\182\244`\169",PropRequestResponseInformation
// 99,PropRequestProblemInformation 98,PropSessionExpiryInterval 4736,PropSessionExpiryInterval 22872,PropResponseTopic
// "\143(Q\146\&7\171ew}S^\134\238QZ\DC3E \182\230'\234`",PropAuthenticationData
// "\207\179g\145M\145\246\226Ij\173\US\145\ETX\155\251\132^E\219\179\185\SO\136",PropServerReference
// "\250|\135#h",PropRetainAvailable 1,PropServerReference
// "1\GS\178\129~-{+\US\SUBBe\DEL\SI\174q\210\241Zq\201_mb\129@\210E\208",PropSubscriptionIdentifier
// 14,PropMessageExpiryInterval 1239]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x35, 0xdd, 0x1,  0x0,  0xe,  0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf, 0x44, 0xb,  0x4,  0xd9, 0x3c,
      0x1a, 0xd9, 0xc4, 0x1,  0xb,  0x1a, 0xb,  0x14, 0x29, 0x61, 0x11, 0x0,  0x0,  0x4,  0xf6, 0x24, 0x11, 0x22, 0x29,
      0xa6, 0x1c, 0x0,  0x1a, 0x31, 0xc8, 0x54, 0x25, 0x72, 0x83, 0x1,  0x72, 0xd4, 0xbf, 0xf2, 0x18, 0xf7, 0x23, 0xee,
      0x76, 0xa,  0x48, 0x14, 0xc9, 0x5a, 0xa4, 0xf5, 0xdf, 0x1c, 0x5d, 0x18, 0x0,  0x0,  0x2,  0x83, 0x24, 0x4d, 0x1,
      0xcc, 0x16, 0x0,  0x17, 0xbf, 0x20, 0x88, 0x61, 0x90, 0x1a, 0xda, 0xe9, 0x8e, 0xc0, 0x8d, 0xbc, 0x82, 0xc8, 0x32,
      0x8c, 0xea, 0xa8, 0x2e, 0xb6, 0xf4, 0x60, 0xa9, 0x19, 0x63, 0x17, 0x62, 0x11, 0x0,  0x0,  0x12, 0x80, 0x11, 0x0,
      0x0,  0x59, 0x58, 0x8,  0x0,  0x17, 0x8f, 0x28, 0x51, 0x92, 0x37, 0xab, 0x65, 0x77, 0x7d, 0x53, 0x5e, 0x86, 0xee,
      0x51, 0x5a, 0x13, 0x45, 0x20, 0xb6, 0xe6, 0x27, 0xea, 0x60, 0x16, 0x0,  0x18, 0xcf, 0xb3, 0x67, 0x91, 0x4d, 0x91,
      0xf6, 0xe2, 0x49, 0x6a, 0xad, 0x1f, 0x91, 0x3,  0x9b, 0xfb, 0x84, 0x5e, 0x45, 0xdb, 0xb3, 0xb9, 0xe,  0x88, 0x1c,
      0x0,  0x5,  0xfa, 0x7c, 0x87, 0x23, 0x68, 0x25, 0x1,  0x1c, 0x0,  0x1d, 0x31, 0x1d, 0xb2, 0x81, 0x7e, 0x2d, 0x7b,
      0x2b, 0x1f, 0x1a, 0x42, 0x65, 0x7f, 0xf,  0xae, 0x71, 0xd2, 0xf1, 0x5a, 0x71, 0xc9, 0x5f, 0x6d, 0x62, 0x81, 0x40,
      0xd2, 0x45, 0xd0, 0xb,  0xe,  0x2,  0x0,  0x0,  0x4,  0xd7, 0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  uint8_t topic_bytes[] = {0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf, 0x44, 0xb, 0x4, 0xd9, 0x3c};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0x31, 0xc8, 0x54, 0x25, 0x72, 0x83, 0x1,  0x72, 0xd4, 0xbf, 0xf2, 0x18, 0xf7,
                           0x23, 0xee, 0x76, 0xa,  0x48, 0x14, 0xc9, 0x5a, 0xa4, 0xf5, 0xdf, 0x1c, 0x5d};
  uint8_t bytesprops1[] = {0xbf, 0x20, 0x88, 0x61, 0x90, 0x1a, 0xda, 0xe9, 0x8e, 0xc0, 0x8d, 0xbc,
                           0x82, 0xc8, 0x32, 0x8c, 0xea, 0xa8, 0x2e, 0xb6, 0xf4, 0x60, 0xa9};
  uint8_t bytesprops2[] = {0x8f, 0x28, 0x51, 0x92, 0x37, 0xab, 0x65, 0x77, 0x7d, 0x53, 0x5e, 0x86,
                           0xee, 0x51, 0x5a, 0x13, 0x45, 0x20, 0xb6, 0xe6, 0x27, 0xea, 0x60};
  uint8_t bytesprops3[] = {0xcf, 0xb3, 0x67, 0x91, 0x4d, 0x91, 0xf6, 0xe2, 0x49, 0x6a, 0xad, 0x1f,
                           0x91, 0x3,  0x9b, 0xfb, 0x84, 0x5e, 0x45, 0xdb, 0xb3, 0xb9, 0xe,  0x88};
  uint8_t bytesprops4[] = {0xfa, 0x7c, 0x87, 0x23, 0x68};
  uint8_t bytesprops5[] = {0x31, 0x1d, 0xb2, 0x81, 0x7e, 0x2d, 0x7b, 0x2b, 0x1f, 0x1a, 0x42, 0x65, 0x7f, 0xf, 0xae,
                           0x71, 0xd2, 0xf1, 0x5a, 0x71, 0xc9, 0x5f, 0x6d, 0x62, 0x81, 0x40, 0xd2, 0x45, 0xd0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1270}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10662}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 643}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4736}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22872}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1239}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 6873, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\198\DC1L:\231)\185\220\223D\v\EOT\217<", _pubPktID = 6873, _pubBody = "\ESC\"[|\180", _pubProps =
// [PropSubscriptionIdentifier 26,PropSubscriptionIdentifier 20,PropSubscriptionIdentifierAvailable
// 97,PropSessionExpiryInterval 1270,PropMaximumQoS 17,PropTopicAliasMaximum 10662,PropServerReference
// "1\200T%r\131\SOHr\212\191\242\CAN\247#\238v\nH\DC4\201Z\164\245\223\FS]",PropWillDelayInterval 643,PropMaximumQoS
// 77,PropPayloadFormatIndicator 204,PropAuthenticationData "\191
// \136a\144\SUB\218\233\142\192\141\188\130\200\&2\140\234\168.\182\244`\169",PropRequestResponseInformation
// 99,PropRequestProblemInformation 98,PropSessionExpiryInterval 4736,PropSessionExpiryInterval 22872,PropResponseTopic
// "\143(Q\146\&7\171ew}S^\134\238QZ\DC3E \182\230'\234`",PropAuthenticationData
// "\207\179g\145M\145\246\226Ij\173\US\145\ETX\155\251\132^E\219\179\185\SO\136",PropServerReference
// "\250|\135#h",PropRetainAvailable 1,PropServerReference
// "1\GS\178\129~-{+\US\SUBBe\DEL\SI\174q\210\241Zq\201_mb\129@\210E\208",PropSubscriptionIdentifier
// 14,PropMessageExpiryInterval 1239]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {
      0x35, 0xdd, 0x1,  0x0,  0xe,  0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf, 0x44, 0xb,  0x4,  0xd9, 0x3c,
      0x1a, 0xd9, 0xc4, 0x1,  0xb,  0x1a, 0xb,  0x14, 0x29, 0x61, 0x11, 0x0,  0x0,  0x4,  0xf6, 0x24, 0x11, 0x22, 0x29,
      0xa6, 0x1c, 0x0,  0x1a, 0x31, 0xc8, 0x54, 0x25, 0x72, 0x83, 0x1,  0x72, 0xd4, 0xbf, 0xf2, 0x18, 0xf7, 0x23, 0xee,
      0x76, 0xa,  0x48, 0x14, 0xc9, 0x5a, 0xa4, 0xf5, 0xdf, 0x1c, 0x5d, 0x18, 0x0,  0x0,  0x2,  0x83, 0x24, 0x4d, 0x1,
      0xcc, 0x16, 0x0,  0x17, 0xbf, 0x20, 0x88, 0x61, 0x90, 0x1a, 0xda, 0xe9, 0x8e, 0xc0, 0x8d, 0xbc, 0x82, 0xc8, 0x32,
      0x8c, 0xea, 0xa8, 0x2e, 0xb6, 0xf4, 0x60, 0xa9, 0x19, 0x63, 0x17, 0x62, 0x11, 0x0,  0x0,  0x12, 0x80, 0x11, 0x0,
      0x0,  0x59, 0x58, 0x8,  0x0,  0x17, 0x8f, 0x28, 0x51, 0x92, 0x37, 0xab, 0x65, 0x77, 0x7d, 0x53, 0x5e, 0x86, 0xee,
      0x51, 0x5a, 0x13, 0x45, 0x20, 0xb6, 0xe6, 0x27, 0xea, 0x60, 0x16, 0x0,  0x18, 0xcf, 0xb3, 0x67, 0x91, 0x4d, 0x91,
      0xf6, 0xe2, 0x49, 0x6a, 0xad, 0x1f, 0x91, 0x3,  0x9b, 0xfb, 0x84, 0x5e, 0x45, 0xdb, 0xb3, 0xb9, 0xe,  0x88, 0x1c,
      0x0,  0x5,  0xfa, 0x7c, 0x87, 0x23, 0x68, 0x25, 0x1,  0x1c, 0x0,  0x1d, 0x31, 0x1d, 0xb2, 0x81, 0x7e, 0x2d, 0x7b,
      0x2b, 0x1f, 0x1a, 0x42, 0x65, 0x7f, 0xf,  0xae, 0x71, 0xd2, 0xf1, 0x5a, 0x71, 0xc9, 0x5f, 0x6d, 0x62, 0x81, 0x40,
      0xd2, 0x45, 0xd0, 0xb,  0xe,  0x2,  0x0,  0x0,  0x4,  0xd7, 0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc6, 0x11, 0x4c, 0x3a, 0xe7, 0x29, 0xb9, 0xdc, 0xdf, 0x44, 0xb, 0x4, 0xd9, 0x3c};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1b, 0x22, 0x5b, 0x7c, 0xb4};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 6873);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "^W\131\160\253B\156\130SrVB\238=\158m_\253\242\178N", _pubPktID = 12282, _pubBody =
// "\169\159cc\RSh\239_U\ETB\NAK\223f", _pubProps = [PropMessageExpiryInterval 2866,PropServerReference
// "\216\SOH\NAKu\157\159\n\164\172",PropRequestProblemInformation 154]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x3a, 0x3a, 0x0,  0x15, 0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72, 0x56,
                   0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e, 0x2f, 0xfa, 0x13, 0x2,  0x0,
                   0x0,  0xb,  0x32, 0x1c, 0x0,  0x9,  0xd8, 0x1,  0x15, 0x75, 0x9d, 0x9f, 0xa,  0xa4, 0xac,
                   0x17, 0x9a, 0xa9, 0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  uint8_t topic_bytes[] = {0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72, 0x56,
                           0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa9, 0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0xd8, 0x1, 0x15, 0x75, 0x9d, 0x9f, 0xa, 0xa4, 0xac};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2866}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 154}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 12282, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "^W\131\160\253B\156\130SrVB\238=\158m_\253\242\178N", _pubPktID = 12282, _pubBody =
// "\169\159cc\RSh\239_U\ETB\NAK\223f", _pubProps = [PropMessageExpiryInterval 2866,PropServerReference
// "\216\SOH\NAKu\157\159\n\164\172",PropRequestProblemInformation 154]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x3a, 0x3a, 0x0,  0x15, 0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72, 0x56,
                   0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e, 0x2f, 0xfa, 0x13, 0x2,  0x0,
                   0x0,  0xb,  0x32, 0x1c, 0x0,  0x9,  0xd8, 0x1,  0x15, 0x75, 0x9d, 0x9f, 0xa,  0xa4, 0xac,
                   0x17, 0x9a, 0xa9, 0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5e, 0x57, 0x83, 0xa0, 0xfd, 0x42, 0x9c, 0x82, 0x53, 0x72, 0x56,
                               0x42, 0xee, 0x3d, 0x9e, 0x6d, 0x5f, 0xfd, 0xf2, 0xb2, 0x4e};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa9, 0x9f, 0x63, 0x63, 0x1e, 0x68, 0xef, 0x5f, 0x55, 0x17, 0x15, 0xdf, 0x66};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 12282);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\223~\247S\221_\137\253\202\t\SO<\197\171X=\DC1'\196\ACK", _pubPktID = 7369, _pubBody =
// "\218\SI\242\t\138\r\SO\ESC[\224\207", _pubProps = [PropMaximumPacketSize 12936,PropServerKeepAlive
// 29399,PropRetainAvailable 124,PropTopicAliasMaximum 20663,PropReasonString
// "\189\DC2u}o&\218G\239\DC4\202;\143\b",PropCorrelationData
// "\129=\183\174f\210\184\204h\195\223\\\138\141",PropMessageExpiryInterval 17593,PropMaximumPacketSize
// 27303,PropServerReference "d\146\185<\255\151\&8\ETB\"\163[\176|\214g/w\210N\250s",PropRequestResponseInformation
// 140,PropResponseTopic "\172\144\DC2\140\130\\\EM\rj\243\135\&6",PropRequestResponseInformation 24,PropReceiveMaximum
// 24602,PropRetainAvailable 197,PropWillDelayInterval 7751,PropRequestProblemInformation
// 36,PropRequestResponseInformation 76,PropSubscriptionIdentifier 7,PropRequestResponseInformation 2]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x34, 0x9a, 0x1,  0x0,  0x14, 0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca, 0x9,  0xe,
                   0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6,  0x1c, 0xc9, 0x76, 0x27, 0x0,  0x0,  0x32,
                   0x88, 0x13, 0x72, 0xd7, 0x25, 0x7c, 0x22, 0x50, 0xb7, 0x1f, 0x0,  0xe,  0xbd, 0x12, 0x75, 0x7d,
                   0x6f, 0x26, 0xda, 0x47, 0xef, 0x14, 0xca, 0x3b, 0x8f, 0x8,  0x9,  0x0,  0xe,  0x81, 0x3d, 0xb7,
                   0xae, 0x66, 0xd2, 0xb8, 0xcc, 0x68, 0xc3, 0xdf, 0x5c, 0x8a, 0x8d, 0x2,  0x0,  0x0,  0x44, 0xb9,
                   0x27, 0x0,  0x0,  0x6a, 0xa7, 0x1c, 0x0,  0x15, 0x64, 0x92, 0xb9, 0x3c, 0xff, 0x97, 0x38, 0x17,
                   0x22, 0xa3, 0x5b, 0xb0, 0x7c, 0xd6, 0x67, 0x2f, 0x77, 0xd2, 0x4e, 0xfa, 0x73, 0x19, 0x8c, 0x8,
                   0x0,  0xc,  0xac, 0x90, 0x12, 0x8c, 0x82, 0x5c, 0x19, 0xd,  0x6a, 0xf3, 0x87, 0x36, 0x19, 0x18,
                   0x21, 0x60, 0x1a, 0x25, 0xc5, 0x18, 0x0,  0x0,  0x1e, 0x47, 0x17, 0x24, 0x19, 0x4c, 0xb,  0x7,
                   0x19, 0x2,  0xda, 0xf,  0xf2, 0x9,  0x8a, 0xd,  0xe,  0x1b, 0x5b, 0xe0, 0xcf};
  uint8_t topic_bytes[] = {0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca, 0x9,
                           0xe,  0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xda, 0xf, 0xf2, 0x9, 0x8a, 0xd, 0xe, 0x1b, 0x5b, 0xe0, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0xbd, 0x12, 0x75, 0x7d, 0x6f, 0x26, 0xda, 0x47, 0xef, 0x14, 0xca, 0x3b, 0x8f, 0x8};
  uint8_t bytesprops1[] = {0x81, 0x3d, 0xb7, 0xae, 0x66, 0xd2, 0xb8, 0xcc, 0x68, 0xc3, 0xdf, 0x5c, 0x8a, 0x8d};
  uint8_t bytesprops2[] = {0x64, 0x92, 0xb9, 0x3c, 0xff, 0x97, 0x38, 0x17, 0x22, 0xa3, 0x5b,
                           0xb0, 0x7c, 0xd6, 0x67, 0x2f, 0x77, 0xd2, 0x4e, 0xfa, 0x73};
  uint8_t bytesprops3[] = {0xac, 0x90, 0x12, 0x8c, 0x82, 0x5c, 0x19, 0xd, 0x6a, 0xf3, 0x87, 0x36};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12936}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29399}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20663}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17593}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27303}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24602}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7751}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 2}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7369, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\223~\247S\221_\137\253\202\t\SO<\197\171X=\DC1'\196\ACK", _pubPktID = 7369, _pubBody =
// "\218\SI\242\t\138\r\SO\ESC[\224\207", _pubProps = [PropMaximumPacketSize 12936,PropServerKeepAlive
// 29399,PropRetainAvailable 124,PropTopicAliasMaximum 20663,PropReasonString
// "\189\DC2u}o&\218G\239\DC4\202;\143\b",PropCorrelationData
// "\129=\183\174f\210\184\204h\195\223\\\138\141",PropMessageExpiryInterval 17593,PropMaximumPacketSize
// 27303,PropServerReference "d\146\185<\255\151\&8\ETB\"\163[\176|\214g/w\210N\250s",PropRequestResponseInformation
// 140,PropResponseTopic "\172\144\DC2\140\130\\\EM\rj\243\135\&6",PropRequestResponseInformation 24,PropReceiveMaximum
// 24602,PropRetainAvailable 197,PropWillDelayInterval 7751,PropRequestProblemInformation
// 36,PropRequestResponseInformation 76,PropSubscriptionIdentifier 7,PropRequestResponseInformation 2]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x34, 0x9a, 0x1,  0x0,  0x14, 0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca, 0x9,  0xe,
                   0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6,  0x1c, 0xc9, 0x76, 0x27, 0x0,  0x0,  0x32,
                   0x88, 0x13, 0x72, 0xd7, 0x25, 0x7c, 0x22, 0x50, 0xb7, 0x1f, 0x0,  0xe,  0xbd, 0x12, 0x75, 0x7d,
                   0x6f, 0x26, 0xda, 0x47, 0xef, 0x14, 0xca, 0x3b, 0x8f, 0x8,  0x9,  0x0,  0xe,  0x81, 0x3d, 0xb7,
                   0xae, 0x66, 0xd2, 0xb8, 0xcc, 0x68, 0xc3, 0xdf, 0x5c, 0x8a, 0x8d, 0x2,  0x0,  0x0,  0x44, 0xb9,
                   0x27, 0x0,  0x0,  0x6a, 0xa7, 0x1c, 0x0,  0x15, 0x64, 0x92, 0xb9, 0x3c, 0xff, 0x97, 0x38, 0x17,
                   0x22, 0xa3, 0x5b, 0xb0, 0x7c, 0xd6, 0x67, 0x2f, 0x77, 0xd2, 0x4e, 0xfa, 0x73, 0x19, 0x8c, 0x8,
                   0x0,  0xc,  0xac, 0x90, 0x12, 0x8c, 0x82, 0x5c, 0x19, 0xd,  0x6a, 0xf3, 0x87, 0x36, 0x19, 0x18,
                   0x21, 0x60, 0x1a, 0x25, 0xc5, 0x18, 0x0,  0x0,  0x1e, 0x47, 0x17, 0x24, 0x19, 0x4c, 0xb,  0x7,
                   0x19, 0x2,  0xda, 0xf,  0xf2, 0x9,  0x8a, 0xd,  0xe,  0x1b, 0x5b, 0xe0, 0xcf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xdf, 0x7e, 0xf7, 0x53, 0xdd, 0x5f, 0x89, 0xfd, 0xca, 0x9,
                               0xe,  0x3c, 0xc5, 0xab, 0x58, 0x3d, 0x11, 0x27, 0xc4, 0x6};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xda, 0xf, 0xf2, 0x9, 0x8a, 0xd, 0xe, 0x1b, 0x5b, 0xe0, 0xcf};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7369);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\250\191\190jan\209", _pubPktID =
// 6761, _pubBody = "z-\195\235\243\220Q", _pubProps = [PropMaximumQoS 51,PropWildcardSubscriptionAvailable
// 241,PropWillDelayInterval 30710,PropAuthenticationData "m\144\196p",PropRetainAvailable 66,PropMaximumPacketSize
// 28886,PropWillDelayInterval 10121,PropSharedSubscriptionAvailable 136]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x3c, 0x31, 0x0,  0x7,  0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e, 0xd1, 0x1a, 0x69,
                   0x1e, 0x24, 0x33, 0x28, 0xf1, 0x18, 0x0,  0x0,  0x77, 0xf6, 0x16, 0x0,  0x4,
                   0x6d, 0x90, 0xc4, 0x70, 0x25, 0x42, 0x27, 0x0,  0x0,  0x70, 0xd6, 0x18, 0x0,
                   0x0,  0x27, 0x89, 0x2a, 0x88, 0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  uint8_t topic_bytes[] = {0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e, 0xd1};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0x6d, 0x90, 0xc4, 0x70};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30710}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28886}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10121}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 136}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6761, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\250\191\190jan\209", _pubPktID =
// 6761, _pubBody = "z-\195\235\243\220Q", _pubProps = [PropMaximumQoS 51,PropWildcardSubscriptionAvailable
// 241,PropWillDelayInterval 30710,PropAuthenticationData "m\144\196p",PropRetainAvailable 66,PropMaximumPacketSize
// 28886,PropWillDelayInterval 10121,PropSharedSubscriptionAvailable 136]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x3c, 0x31, 0x0,  0x7,  0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e, 0xd1, 0x1a, 0x69,
                   0x1e, 0x24, 0x33, 0x28, 0xf1, 0x18, 0x0,  0x0,  0x77, 0xf6, 0x16, 0x0,  0x4,
                   0x6d, 0x90, 0xc4, 0x70, 0x25, 0x42, 0x27, 0x0,  0x0,  0x70, 0xd6, 0x18, 0x0,
                   0x0,  0x27, 0x89, 0x2a, 0x88, 0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfa, 0xbf, 0xbe, 0x6a, 0x61, 0x6e, 0xd1};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7a, 0x2d, 0xc3, 0xeb, 0xf3, 0xdc, 0x51};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6761);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\229Y\156\186GOd\EOT\247\ETB\224\251-\228h{^Q!\246\b\DEL\225\NUL{/Q ", _pubPktID = 0, _pubBody = "<@\201Iv",
// _pubProps = [PropWildcardSubscriptionAvailable 30,PropRequestProblemInformation 173,PropSharedSubscriptionAvailable
// 114,PropRequestProblemInformation 48,PropSharedSubscriptionAvailable 63,PropWildcardSubscriptionAvailable
// 80,PropAssignedClientIdentifier "j",PropReceiveMaximum 7010,PropTopicAliasMaximum 29063,PropResponseInformation
// "\150\206\240\187U\152#\224]2=,\t\189\138\205\255\254`\175{}",PropServerKeepAlive 31184,PropReasonString
// "\ETXA",PropRequestProblemInformation 225,PropRetainAvailable 107,PropResponseTopic
// "\153\228\225A$\189h\217",PropAuthenticationMethod ";\180\240#\146Z \140_\212$\176\156Nt|
// \r",PropAuthenticationMethod "\175V\149+\250\164\254\205\181\234v`\233\247j\161\146\174"]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x39, 0x94, 0x1,  0x0,  0x1c, 0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4,  0xf7, 0x17, 0xe0, 0xfb,
                   0x2d, 0xe4, 0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8,  0x7f, 0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20, 0x70,
                   0x28, 0x1e, 0x17, 0xad, 0x2a, 0x72, 0x17, 0x30, 0x2a, 0x3f, 0x28, 0x50, 0x12, 0x0,  0x1,  0x6a, 0x21,
                   0x1b, 0x62, 0x22, 0x71, 0x87, 0x1a, 0x0,  0x16, 0x96, 0xce, 0xf0, 0xbb, 0x55, 0x98, 0x23, 0xe0, 0x5d,
                   0x32, 0x3d, 0x2c, 0x9,  0xbd, 0x8a, 0xcd, 0xff, 0xfe, 0x60, 0xaf, 0x7b, 0x7d, 0x13, 0x79, 0xd0, 0x1f,
                   0x0,  0x2,  0x3,  0x41, 0x17, 0xe1, 0x25, 0x6b, 0x8,  0x0,  0x8,  0x99, 0xe4, 0xe1, 0x41, 0x24, 0xbd,
                   0x68, 0xd9, 0x15, 0x0,  0x12, 0x3b, 0xb4, 0xf0, 0x23, 0x92, 0x5a, 0x20, 0x8c, 0x5f, 0xd4, 0x24, 0xb0,
                   0x9c, 0x4e, 0x74, 0x7c, 0x20, 0xd,  0x15, 0x0,  0x12, 0xaf, 0x56, 0x95, 0x2b, 0xfa, 0xa4, 0xfe, 0xcd,
                   0xb5, 0xea, 0x76, 0x60, 0xe9, 0xf7, 0x6a, 0xa1, 0x92, 0xae, 0x3c, 0x40, 0xc9, 0x49, 0x76};
  uint8_t topic_bytes[] = {0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4,  0xf7, 0x17, 0xe0, 0xfb, 0x2d, 0xe4,
                           0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8,  0x7f, 0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3c, 0x40, 0xc9, 0x49, 0x76};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0x6a};
  uint8_t bytesprops1[] = {0x96, 0xce, 0xf0, 0xbb, 0x55, 0x98, 0x23, 0xe0, 0x5d, 0x32, 0x3d,
                           0x2c, 0x9,  0xbd, 0x8a, 0xcd, 0xff, 0xfe, 0x60, 0xaf, 0x7b, 0x7d};
  uint8_t bytesprops2[] = {0x3, 0x41};
  uint8_t bytesprops3[] = {0x99, 0xe4, 0xe1, 0x41, 0x24, 0xbd, 0x68, 0xd9};
  uint8_t bytesprops4[] = {0x3b, 0xb4, 0xf0, 0x23, 0x92, 0x5a, 0x20, 0x8c, 0x5f,
                           0xd4, 0x24, 0xb0, 0x9c, 0x4e, 0x74, 0x7c, 0x20, 0xd};
  uint8_t bytesprops5[] = {0xaf, 0x56, 0x95, 0x2b, 0xfa, 0xa4, 0xfe, 0xcd, 0xb5,
                           0xea, 0x76, 0x60, 0xe9, 0xf7, 0x6a, 0xa1, 0x92, 0xae};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7010}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29063}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31184}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\229Y\156\186GOd\EOT\247\ETB\224\251-\228h{^Q!\246\b\DEL\225\NUL{/Q ", _pubPktID = 0, _pubBody = "<@\201Iv",
// _pubProps = [PropWildcardSubscriptionAvailable 30,PropRequestProblemInformation 173,PropSharedSubscriptionAvailable
// 114,PropRequestProblemInformation 48,PropSharedSubscriptionAvailable 63,PropWildcardSubscriptionAvailable
// 80,PropAssignedClientIdentifier "j",PropReceiveMaximum 7010,PropTopicAliasMaximum 29063,PropResponseInformation
// "\150\206\240\187U\152#\224]2=,\t\189\138\205\255\254`\175{}",PropServerKeepAlive 31184,PropReasonString
// "\ETXA",PropRequestProblemInformation 225,PropRetainAvailable 107,PropResponseTopic
// "\153\228\225A$\189h\217",PropAuthenticationMethod ";\180\240#\146Z \140_\212$\176\156Nt|
// \r",PropAuthenticationMethod "\175V\149+\250\164\254\205\181\234v`\233\247j\161\146\174"]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x39, 0x94, 0x1,  0x0,  0x1c, 0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4,  0xf7, 0x17, 0xe0, 0xfb,
                   0x2d, 0xe4, 0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8,  0x7f, 0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20, 0x70,
                   0x28, 0x1e, 0x17, 0xad, 0x2a, 0x72, 0x17, 0x30, 0x2a, 0x3f, 0x28, 0x50, 0x12, 0x0,  0x1,  0x6a, 0x21,
                   0x1b, 0x62, 0x22, 0x71, 0x87, 0x1a, 0x0,  0x16, 0x96, 0xce, 0xf0, 0xbb, 0x55, 0x98, 0x23, 0xe0, 0x5d,
                   0x32, 0x3d, 0x2c, 0x9,  0xbd, 0x8a, 0xcd, 0xff, 0xfe, 0x60, 0xaf, 0x7b, 0x7d, 0x13, 0x79, 0xd0, 0x1f,
                   0x0,  0x2,  0x3,  0x41, 0x17, 0xe1, 0x25, 0x6b, 0x8,  0x0,  0x8,  0x99, 0xe4, 0xe1, 0x41, 0x24, 0xbd,
                   0x68, 0xd9, 0x15, 0x0,  0x12, 0x3b, 0xb4, 0xf0, 0x23, 0x92, 0x5a, 0x20, 0x8c, 0x5f, 0xd4, 0x24, 0xb0,
                   0x9c, 0x4e, 0x74, 0x7c, 0x20, 0xd,  0x15, 0x0,  0x12, 0xaf, 0x56, 0x95, 0x2b, 0xfa, 0xa4, 0xfe, 0xcd,
                   0xb5, 0xea, 0x76, 0x60, 0xe9, 0xf7, 0x6a, 0xa1, 0x92, 0xae, 0x3c, 0x40, 0xc9, 0x49, 0x76};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe5, 0x59, 0x9c, 0xba, 0x47, 0x4f, 0x64, 0x4,  0xf7, 0x17, 0xe0, 0xfb, 0x2d, 0xe4,
                               0x68, 0x7b, 0x5e, 0x51, 0x21, 0xf6, 0x8,  0x7f, 0xe1, 0x0,  0x7b, 0x2f, 0x51, 0x20};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3c, 0x40, 0xc9, 0x49, 0x76};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242\EM\182T\137\181\\_\NUL\137\135\&0\211", _pubPktID = 31937, _pubBody =
// "\242\196\240\145t\150mj\CANV\251\200\142o\192\150G", _pubProps = [PropRetainAvailable 122,PropSubscriptionIdentifier
// 19,PropReasonString
// "\140l=\142\212\166k\196\222\153\204\166\224!-\SOt\135\152\221\fy\192k!\FS\221\f",PropSharedSubscriptionAvailable
// 194,PropSessionExpiryInterval 2254,PropResponseInformation "\222\199\193\131a@\249",PropWillDelayInterval
// 14313,PropSessionExpiryInterval 29233,PropResponseInformation "\184\154\187\142\"?\231\147",PropResponseInformation
// "\"\US\156\n^\143\tH\US\133\160$g\171\241\173\FS",PropRequestResponseInformation 58,PropResponseInformation
// "Rdn\237\230",PropMessageExpiryInterval 25080,PropReceiveMaximum 25894,PropServerKeepAlive 22192,PropServerReference
// "\166",PropAssignedClientIdentifier
// "\164\233=z\206\223\177<\187\250A\226z.\158;:\ENQ\177J\206\t\v\249\181U\221\240\135"]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x35, 0xba, 0x1,  0x0,  0xd,  0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f, 0x0,  0x89, 0x87, 0x30, 0xd3, 0x7c,
      0xc1, 0x96, 0x1,  0x25, 0x7a, 0xb,  0x13, 0x1f, 0x0,  0x1c, 0x8c, 0x6c, 0x3d, 0x8e, 0xd4, 0xa6, 0x6b, 0xc4, 0xde,
      0x99, 0xcc, 0xa6, 0xe0, 0x21, 0x2d, 0xe,  0x74, 0x87, 0x98, 0xdd, 0xc,  0x79, 0xc0, 0x6b, 0x21, 0x1c, 0xdd, 0xc,
      0x2a, 0xc2, 0x11, 0x0,  0x0,  0x8,  0xce, 0x1a, 0x0,  0x7,  0xde, 0xc7, 0xc1, 0x83, 0x61, 0x40, 0xf9, 0x18, 0x0,
      0x0,  0x37, 0xe9, 0x11, 0x0,  0x0,  0x72, 0x31, 0x1a, 0x0,  0x8,  0xb8, 0x9a, 0xbb, 0x8e, 0x22, 0x3f, 0xe7, 0x93,
      0x1a, 0x0,  0x11, 0x22, 0x1f, 0x9c, 0xa,  0x5e, 0x8f, 0x9,  0x48, 0x1f, 0x85, 0xa0, 0x24, 0x67, 0xab, 0xf1, 0xad,
      0x1c, 0x19, 0x3a, 0x1a, 0x0,  0x5,  0x52, 0x64, 0x6e, 0xed, 0xe6, 0x2,  0x0,  0x0,  0x61, 0xf8, 0x21, 0x65, 0x26,
      0x13, 0x56, 0xb0, 0x1c, 0x0,  0x1,  0xa6, 0x12, 0x0,  0x1d, 0xa4, 0xe9, 0x3d, 0x7a, 0xce, 0xdf, 0xb1, 0x3c, 0xbb,
      0xfa, 0x41, 0xe2, 0x7a, 0x2e, 0x9e, 0x3b, 0x3a, 0x5,  0xb1, 0x4a, 0xce, 0x9,  0xb,  0xf9, 0xb5, 0x55, 0xdd, 0xf0,
      0x87, 0xf2, 0xc4, 0xf0, 0x91, 0x74, 0x96, 0x6d, 0x6a, 0x18, 0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  uint8_t topic_bytes[] = {0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f, 0x0, 0x89, 0x87, 0x30, 0xd3};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf2, 0xc4, 0xf0, 0x91, 0x74, 0x96, 0x6d, 0x6a, 0x18,
                         0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0x8c, 0x6c, 0x3d, 0x8e, 0xd4, 0xa6, 0x6b, 0xc4, 0xde, 0x99, 0xcc, 0xa6, 0xe0, 0x21,
                           0x2d, 0xe,  0x74, 0x87, 0x98, 0xdd, 0xc,  0x79, 0xc0, 0x6b, 0x21, 0x1c, 0xdd, 0xc};
  uint8_t bytesprops1[] = {0xde, 0xc7, 0xc1, 0x83, 0x61, 0x40, 0xf9};
  uint8_t bytesprops2[] = {0xb8, 0x9a, 0xbb, 0x8e, 0x22, 0x3f, 0xe7, 0x93};
  uint8_t bytesprops3[] = {0x22, 0x1f, 0x9c, 0xa,  0x5e, 0x8f, 0x9,  0x48, 0x1f,
                           0x85, 0xa0, 0x24, 0x67, 0xab, 0xf1, 0xad, 0x1c};
  uint8_t bytesprops4[] = {0x52, 0x64, 0x6e, 0xed, 0xe6};
  uint8_t bytesprops5[] = {0xa6};
  uint8_t bytesprops6[] = {0xa4, 0xe9, 0x3d, 0x7a, 0xce, 0xdf, 0xb1, 0x3c, 0xbb, 0xfa, 0x41, 0xe2, 0x7a, 0x2e, 0x9e,
                           0x3b, 0x3a, 0x5,  0xb1, 0x4a, 0xce, 0x9,  0xb,  0xf9, 0xb5, 0x55, 0xdd, 0xf0, 0x87};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2254}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14313}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29233}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25080}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25894}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22192}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 31937, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\242\EM\182T\137\181\\_\NUL\137\135\&0\211", _pubPktID = 31937, _pubBody =
// "\242\196\240\145t\150mj\CANV\251\200\142o\192\150G", _pubProps = [PropRetainAvailable 122,PropSubscriptionIdentifier
// 19,PropReasonString
// "\140l=\142\212\166k\196\222\153\204\166\224!-\SOt\135\152\221\fy\192k!\FS\221\f",PropSharedSubscriptionAvailable
// 194,PropSessionExpiryInterval 2254,PropResponseInformation "\222\199\193\131a@\249",PropWillDelayInterval
// 14313,PropSessionExpiryInterval 29233,PropResponseInformation "\184\154\187\142\"?\231\147",PropResponseInformation
// "\"\US\156\n^\143\tH\US\133\160$g\171\241\173\FS",PropRequestResponseInformation 58,PropResponseInformation
// "Rdn\237\230",PropMessageExpiryInterval 25080,PropReceiveMaximum 25894,PropServerKeepAlive 22192,PropServerReference
// "\166",PropAssignedClientIdentifier
// "\164\233=z\206\223\177<\187\250A\226z.\158;:\ENQ\177J\206\t\v\249\181U\221\240\135"]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {
      0x35, 0xba, 0x1,  0x0,  0xd,  0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f, 0x0,  0x89, 0x87, 0x30, 0xd3, 0x7c,
      0xc1, 0x96, 0x1,  0x25, 0x7a, 0xb,  0x13, 0x1f, 0x0,  0x1c, 0x8c, 0x6c, 0x3d, 0x8e, 0xd4, 0xa6, 0x6b, 0xc4, 0xde,
      0x99, 0xcc, 0xa6, 0xe0, 0x21, 0x2d, 0xe,  0x74, 0x87, 0x98, 0xdd, 0xc,  0x79, 0xc0, 0x6b, 0x21, 0x1c, 0xdd, 0xc,
      0x2a, 0xc2, 0x11, 0x0,  0x0,  0x8,  0xce, 0x1a, 0x0,  0x7,  0xde, 0xc7, 0xc1, 0x83, 0x61, 0x40, 0xf9, 0x18, 0x0,
      0x0,  0x37, 0xe9, 0x11, 0x0,  0x0,  0x72, 0x31, 0x1a, 0x0,  0x8,  0xb8, 0x9a, 0xbb, 0x8e, 0x22, 0x3f, 0xe7, 0x93,
      0x1a, 0x0,  0x11, 0x22, 0x1f, 0x9c, 0xa,  0x5e, 0x8f, 0x9,  0x48, 0x1f, 0x85, 0xa0, 0x24, 0x67, 0xab, 0xf1, 0xad,
      0x1c, 0x19, 0x3a, 0x1a, 0x0,  0x5,  0x52, 0x64, 0x6e, 0xed, 0xe6, 0x2,  0x0,  0x0,  0x61, 0xf8, 0x21, 0x65, 0x26,
      0x13, 0x56, 0xb0, 0x1c, 0x0,  0x1,  0xa6, 0x12, 0x0,  0x1d, 0xa4, 0xe9, 0x3d, 0x7a, 0xce, 0xdf, 0xb1, 0x3c, 0xbb,
      0xfa, 0x41, 0xe2, 0x7a, 0x2e, 0x9e, 0x3b, 0x3a, 0x5,  0xb1, 0x4a, 0xce, 0x9,  0xb,  0xf9, 0xb5, 0x55, 0xdd, 0xf0,
      0x87, 0xf2, 0xc4, 0xf0, 0x91, 0x74, 0x96, 0x6d, 0x6a, 0x18, 0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf2, 0x19, 0xb6, 0x54, 0x89, 0xb5, 0x5c, 0x5f, 0x0, 0x89, 0x87, 0x30, 0xd3};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf2, 0xc4, 0xf0, 0x91, 0x74, 0x96, 0x6d, 0x6a, 0x18,
                              0x56, 0xfb, 0xc8, 0x8e, 0x6f, 0xc0, 0x96, 0x47};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 31937);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "q", _pubPktID = 31364, _pubBody =
// "J\NAK\203\196\226\"\223\GS\200a", _pubProps = [PropResponseTopic
// "s\189\254=\155q+\137\192=\248J\fp\152\162<",PropTopicAliasMaximum 24003,PropServerKeepAlive
// 19136,PropAssignedClientIdentifier "v\160!%L>\161\232\190&]U\199'&Z\224z\249",PropResponseTopic
// "\229\161+\255\128u?\DC1",PropAuthenticationMethod
// "\ACK2\135\209F\135\136\253x\RS\141\227\165",PropSubscriptionIdentifier 9,PropAuthenticationData
// "i\EM\192\253\161f;MIF\130B\159\160\212\183Y\192\237}\136\224",PropReasonString
// "~O\167\ESC\194\253\147K\217\193\222\219",PropAuthenticationMethod "",PropAuthenticationMethod
// "\225\164\b\DLE\SI\246\ETBE\187\220\&7kW\NAKC\206\205\239\227\&9\147\173uTz\139\176",PropServerKeepAlive
// 10976,PropReasonString "\160",PropCorrelationData "L\251\158X\237\135\138\ETB\SYN\208",PropMessageExpiryInterval
// 13532,PropSubscriptionIdentifier 18,PropMaximumQoS 0,PropServerKeepAlive 1892,PropContentType
// "r",PropSubscriptionIdentifierAvailable 72,PropSharedSubscriptionAvailable 67,PropReceiveMaximum
// 5584,PropRequestResponseInformation 193,PropUserProperty
// "0o\232\US\216\196(\156w\234\"\SIz\217\137\135\vw\232\178\160y\144\224\f\NUL7\224"
// "#\DC2'\206[\156\194\217\172\194\b{0\146",PropWildcardSubscriptionAvailable 155,PropRequestProblemInformation
// 110,PropAuthenticationMethod "*\195\218\FS4L\130^!\230:\227RH\US\150\241\175\198\245\134",PropMessageExpiryInterval
// 11523]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x33, 0xa4, 0x2,  0x0,  0x1,  0x71, 0x7a, 0x84, 0x93, 0x2,  0x8,  0x0,  0x11, 0x73, 0xbd, 0xfe, 0x3d, 0x9b, 0x71,
      0x2b, 0x89, 0xc0, 0x3d, 0xf8, 0x4a, 0xc,  0x70, 0x98, 0xa2, 0x3c, 0x22, 0x5d, 0xc3, 0x13, 0x4a, 0xc0, 0x12, 0x0,
      0x13, 0x76, 0xa0, 0x21, 0x25, 0x4c, 0x3e, 0xa1, 0xe8, 0xbe, 0x26, 0x5d, 0x55, 0xc7, 0x27, 0x26, 0x5a, 0xe0, 0x7a,
      0xf9, 0x8,  0x0,  0x8,  0xe5, 0xa1, 0x2b, 0xff, 0x80, 0x75, 0x3f, 0x11, 0x15, 0x0,  0xd,  0x6,  0x32, 0x87, 0xd1,
      0x46, 0x87, 0x88, 0xfd, 0x78, 0x1e, 0x8d, 0xe3, 0xa5, 0xb,  0x9,  0x16, 0x0,  0x16, 0x69, 0x19, 0xc0, 0xfd, 0xa1,
      0x66, 0x3b, 0x4d, 0x49, 0x46, 0x82, 0x42, 0x9f, 0xa0, 0xd4, 0xb7, 0x59, 0xc0, 0xed, 0x7d, 0x88, 0xe0, 0x1f, 0x0,
      0xc,  0x7e, 0x4f, 0xa7, 0x1b, 0xc2, 0xfd, 0x93, 0x4b, 0xd9, 0xc1, 0xde, 0xdb, 0x15, 0x0,  0x0,  0x15, 0x0,  0x1b,
      0xe1, 0xa4, 0x8,  0x10, 0xf,  0xf6, 0x17, 0x45, 0xbb, 0xdc, 0x37, 0x6b, 0x57, 0x15, 0x43, 0xce, 0xcd, 0xef, 0xe3,
      0x39, 0x93, 0xad, 0x75, 0x54, 0x7a, 0x8b, 0xb0, 0x13, 0x2a, 0xe0, 0x1f, 0x0,  0x1,  0xa0, 0x9,  0x0,  0xa,  0x4c,
      0xfb, 0x9e, 0x58, 0xed, 0x87, 0x8a, 0x17, 0x16, 0xd0, 0x2,  0x0,  0x0,  0x34, 0xdc, 0xb,  0x12, 0x24, 0x0,  0x13,
      0x7,  0x64, 0x3,  0x0,  0x1,  0x72, 0x29, 0x48, 0x2a, 0x43, 0x21, 0x15, 0xd0, 0x19, 0xc1, 0x26, 0x0,  0x1c, 0x30,
      0x6f, 0xe8, 0x1f, 0xd8, 0xc4, 0x28, 0x9c, 0x77, 0xea, 0x22, 0xf,  0x7a, 0xd9, 0x89, 0x87, 0xb,  0x77, 0xe8, 0xb2,
      0xa0, 0x79, 0x90, 0xe0, 0xc,  0x0,  0x37, 0xe0, 0x0,  0xe,  0x23, 0x12, 0x27, 0xce, 0x5b, 0x9c, 0xc2, 0xd9, 0xac,
      0xc2, 0x8,  0x7b, 0x30, 0x92, 0x28, 0x9b, 0x17, 0x6e, 0x15, 0x0,  0x15, 0x2a, 0xc3, 0xda, 0x1c, 0x34, 0x4c, 0x82,
      0x5e, 0x21, 0xe6, 0x3a, 0xe3, 0x52, 0x48, 0x1f, 0x96, 0xf1, 0xaf, 0xc6, 0xf5, 0x86, 0x2,  0x0,  0x0,  0x2d, 0x3,
      0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  uint8_t topic_bytes[] = {0x71};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x73, 0xbd, 0xfe, 0x3d, 0x9b, 0x71, 0x2b, 0x89, 0xc0,
                           0x3d, 0xf8, 0x4a, 0xc,  0x70, 0x98, 0xa2, 0x3c};
  uint8_t bytesprops1[] = {0x76, 0xa0, 0x21, 0x25, 0x4c, 0x3e, 0xa1, 0xe8, 0xbe, 0x26,
                           0x5d, 0x55, 0xc7, 0x27, 0x26, 0x5a, 0xe0, 0x7a, 0xf9};
  uint8_t bytesprops2[] = {0xe5, 0xa1, 0x2b, 0xff, 0x80, 0x75, 0x3f, 0x11};
  uint8_t bytesprops3[] = {0x6, 0x32, 0x87, 0xd1, 0x46, 0x87, 0x88, 0xfd, 0x78, 0x1e, 0x8d, 0xe3, 0xa5};
  uint8_t bytesprops4[] = {0x69, 0x19, 0xc0, 0xfd, 0xa1, 0x66, 0x3b, 0x4d, 0x49, 0x46, 0x82,
                           0x42, 0x9f, 0xa0, 0xd4, 0xb7, 0x59, 0xc0, 0xed, 0x7d, 0x88, 0xe0};
  uint8_t bytesprops5[] = {0x7e, 0x4f, 0xa7, 0x1b, 0xc2, 0xfd, 0x93, 0x4b, 0xd9, 0xc1, 0xde, 0xdb};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0xe1, 0xa4, 0x8,  0x10, 0xf,  0xf6, 0x17, 0x45, 0xbb, 0xdc, 0x37, 0x6b, 0x57, 0x15,
                           0x43, 0xce, 0xcd, 0xef, 0xe3, 0x39, 0x93, 0xad, 0x75, 0x54, 0x7a, 0x8b, 0xb0};
  uint8_t bytesprops8[] = {0xa0};
  uint8_t bytesprops9[] = {0x4c, 0xfb, 0x9e, 0x58, 0xed, 0x87, 0x8a, 0x17, 0x16, 0xd0};
  uint8_t bytesprops10[] = {0x72};
  uint8_t bytesprops12[] = {0x23, 0x12, 0x27, 0xce, 0x5b, 0x9c, 0xc2, 0xd9, 0xac, 0xc2, 0x8, 0x7b, 0x30, 0x92};
  uint8_t bytesprops11[] = {0x30, 0x6f, 0xe8, 0x1f, 0xd8, 0xc4, 0x28, 0x9c, 0x77, 0xea, 0x22, 0xf, 0x7a, 0xd9,
                            0x89, 0x87, 0xb,  0x77, 0xe8, 0xb2, 0xa0, 0x79, 0x90, 0xe0, 0xc,  0x0, 0x37, 0xe0};
  uint8_t bytesprops13[] = {0x2a, 0xc3, 0xda, 0x1c, 0x34, 0x4c, 0x82, 0x5e, 0x21, 0xe6, 0x3a,
                            0xe3, 0x52, 0x48, 0x1f, 0x96, 0xf1, 0xaf, 0xc6, 0xf5, 0x86};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24003}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19136}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10976}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13532}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1892}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5584}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {28, (char*)&bytesprops11}, .v = {14, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11523}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 31364, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "q", _pubPktID = 31364, _pubBody =
// "J\NAK\203\196\226\"\223\GS\200a", _pubProps = [PropResponseTopic
// "s\189\254=\155q+\137\192=\248J\fp\152\162<",PropTopicAliasMaximum 24003,PropServerKeepAlive
// 19136,PropAssignedClientIdentifier "v\160!%L>\161\232\190&]U\199'&Z\224z\249",PropResponseTopic
// "\229\161+\255\128u?\DC1",PropAuthenticationMethod
// "\ACK2\135\209F\135\136\253x\RS\141\227\165",PropSubscriptionIdentifier 9,PropAuthenticationData
// "i\EM\192\253\161f;MIF\130B\159\160\212\183Y\192\237}\136\224",PropReasonString
// "~O\167\ESC\194\253\147K\217\193\222\219",PropAuthenticationMethod "",PropAuthenticationMethod
// "\225\164\b\DLE\SI\246\ETBE\187\220\&7kW\NAKC\206\205\239\227\&9\147\173uTz\139\176",PropServerKeepAlive
// 10976,PropReasonString "\160",PropCorrelationData "L\251\158X\237\135\138\ETB\SYN\208",PropMessageExpiryInterval
// 13532,PropSubscriptionIdentifier 18,PropMaximumQoS 0,PropServerKeepAlive 1892,PropContentType
// "r",PropSubscriptionIdentifierAvailable 72,PropSharedSubscriptionAvailable 67,PropReceiveMaximum
// 5584,PropRequestResponseInformation 193,PropUserProperty
// "0o\232\US\216\196(\156w\234\"\SIz\217\137\135\vw\232\178\160y\144\224\f\NUL7\224"
// "#\DC2'\206[\156\194\217\172\194\b{0\146",PropWildcardSubscriptionAvailable 155,PropRequestProblemInformation
// 110,PropAuthenticationMethod "*\195\218\FS4L\130^!\230:\227RH\US\150\241\175\198\245\134",PropMessageExpiryInterval
// 11523]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {
      0x33, 0xa4, 0x2,  0x0,  0x1,  0x71, 0x7a, 0x84, 0x93, 0x2,  0x8,  0x0,  0x11, 0x73, 0xbd, 0xfe, 0x3d, 0x9b, 0x71,
      0x2b, 0x89, 0xc0, 0x3d, 0xf8, 0x4a, 0xc,  0x70, 0x98, 0xa2, 0x3c, 0x22, 0x5d, 0xc3, 0x13, 0x4a, 0xc0, 0x12, 0x0,
      0x13, 0x76, 0xa0, 0x21, 0x25, 0x4c, 0x3e, 0xa1, 0xe8, 0xbe, 0x26, 0x5d, 0x55, 0xc7, 0x27, 0x26, 0x5a, 0xe0, 0x7a,
      0xf9, 0x8,  0x0,  0x8,  0xe5, 0xa1, 0x2b, 0xff, 0x80, 0x75, 0x3f, 0x11, 0x15, 0x0,  0xd,  0x6,  0x32, 0x87, 0xd1,
      0x46, 0x87, 0x88, 0xfd, 0x78, 0x1e, 0x8d, 0xe3, 0xa5, 0xb,  0x9,  0x16, 0x0,  0x16, 0x69, 0x19, 0xc0, 0xfd, 0xa1,
      0x66, 0x3b, 0x4d, 0x49, 0x46, 0x82, 0x42, 0x9f, 0xa0, 0xd4, 0xb7, 0x59, 0xc0, 0xed, 0x7d, 0x88, 0xe0, 0x1f, 0x0,
      0xc,  0x7e, 0x4f, 0xa7, 0x1b, 0xc2, 0xfd, 0x93, 0x4b, 0xd9, 0xc1, 0xde, 0xdb, 0x15, 0x0,  0x0,  0x15, 0x0,  0x1b,
      0xe1, 0xa4, 0x8,  0x10, 0xf,  0xf6, 0x17, 0x45, 0xbb, 0xdc, 0x37, 0x6b, 0x57, 0x15, 0x43, 0xce, 0xcd, 0xef, 0xe3,
      0x39, 0x93, 0xad, 0x75, 0x54, 0x7a, 0x8b, 0xb0, 0x13, 0x2a, 0xe0, 0x1f, 0x0,  0x1,  0xa0, 0x9,  0x0,  0xa,  0x4c,
      0xfb, 0x9e, 0x58, 0xed, 0x87, 0x8a, 0x17, 0x16, 0xd0, 0x2,  0x0,  0x0,  0x34, 0xdc, 0xb,  0x12, 0x24, 0x0,  0x13,
      0x7,  0x64, 0x3,  0x0,  0x1,  0x72, 0x29, 0x48, 0x2a, 0x43, 0x21, 0x15, 0xd0, 0x19, 0xc1, 0x26, 0x0,  0x1c, 0x30,
      0x6f, 0xe8, 0x1f, 0xd8, 0xc4, 0x28, 0x9c, 0x77, 0xea, 0x22, 0xf,  0x7a, 0xd9, 0x89, 0x87, 0xb,  0x77, 0xe8, 0xb2,
      0xa0, 0x79, 0x90, 0xe0, 0xc,  0x0,  0x37, 0xe0, 0x0,  0xe,  0x23, 0x12, 0x27, 0xce, 0x5b, 0x9c, 0xc2, 0xd9, 0xac,
      0xc2, 0x8,  0x7b, 0x30, 0x92, 0x28, 0x9b, 0x17, 0x6e, 0x15, 0x0,  0x15, 0x2a, 0xc3, 0xda, 0x1c, 0x34, 0x4c, 0x82,
      0x5e, 0x21, 0xe6, 0x3a, 0xe3, 0x52, 0x48, 0x1f, 0x96, 0xf1, 0xaf, 0xc6, 0xf5, 0x86, 0x2,  0x0,  0x0,  0x2d, 0x3,
      0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x71};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4a, 0x15, 0xcb, 0xc4, 0xe2, 0x22, 0xdf, 0x1d, 0xc8, 0x61};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 31364);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\144\171\130\USB\155\212\163\136\212\154", _pubPktID = 8173, _pubBody =
// "\142\178\132u\236\130\153F\CANno\142\151\241\209\208\162\246\156\249\199", _pubProps =
// [PropRequestResponseInformation 100,PropAssignedClientIdentifier
// "u\235\b'?\200\200\222\209\170\244\a\163",PropAuthenticationMethod
// "\130\170\149\228\NAK\DC3(\236\185\239\206\199Ie\136X",PropPayloadFormatIndicator 109,PropReceiveMaximum
// 17095,PropContentType "\132X\255\250z3T;\180\219\144,gS\137BB\144\DC3w\170\248\173a\245\211\246",PropCorrelationData
// "\RSN\167\184\187bki4\152\197F=H\168"]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x33, 0x7f, 0x0,  0xb,  0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88, 0xd4, 0x9a, 0x1f, 0xed,
                   0x5a, 0x19, 0x64, 0x12, 0x0,  0xd,  0x75, 0xeb, 0x8,  0x27, 0x3f, 0xc8, 0xc8, 0xde, 0xd1, 0xaa, 0xf4,
                   0x7,  0xa3, 0x15, 0x0,  0x10, 0x82, 0xaa, 0x95, 0xe4, 0x15, 0x13, 0x28, 0xec, 0xb9, 0xef, 0xce, 0xc7,
                   0x49, 0x65, 0x88, 0x58, 0x1,  0x6d, 0x21, 0x42, 0xc7, 0x3,  0x0,  0x1b, 0x84, 0x58, 0xff, 0xfa, 0x7a,
                   0x33, 0x54, 0x3b, 0xb4, 0xdb, 0x90, 0x2c, 0x67, 0x53, 0x89, 0x42, 0x42, 0x90, 0x13, 0x77, 0xaa, 0xf8,
                   0xad, 0x61, 0xf5, 0xd3, 0xf6, 0x9,  0x0,  0xf,  0x1e, 0x4e, 0xa7, 0xb8, 0xbb, 0x62, 0x6b, 0x69, 0x34,
                   0x98, 0xc5, 0x46, 0x3d, 0x48, 0xa8, 0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18, 0x6e, 0x6f,
                   0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  uint8_t topic_bytes[] = {0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88, 0xd4, 0x9a};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18, 0x6e, 0x6f,
                         0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0x75, 0xeb, 0x8, 0x27, 0x3f, 0xc8, 0xc8, 0xde, 0xd1, 0xaa, 0xf4, 0x7, 0xa3};
  uint8_t bytesprops1[] = {0x82, 0xaa, 0x95, 0xe4, 0x15, 0x13, 0x28, 0xec,
                           0xb9, 0xef, 0xce, 0xc7, 0x49, 0x65, 0x88, 0x58};
  uint8_t bytesprops2[] = {0x84, 0x58, 0xff, 0xfa, 0x7a, 0x33, 0x54, 0x3b, 0xb4, 0xdb, 0x90, 0x2c, 0x67, 0x53,
                           0x89, 0x42, 0x42, 0x90, 0x13, 0x77, 0xaa, 0xf8, 0xad, 0x61, 0xf5, 0xd3, 0xf6};
  uint8_t bytesprops3[] = {0x1e, 0x4e, 0xa7, 0xb8, 0xbb, 0x62, 0x6b, 0x69, 0x34, 0x98, 0xc5, 0x46, 0x3d, 0x48, 0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17095}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 8173, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\144\171\130\USB\155\212\163\136\212\154", _pubPktID = 8173, _pubBody =
// "\142\178\132u\236\130\153F\CANno\142\151\241\209\208\162\246\156\249\199", _pubProps =
// [PropRequestResponseInformation 100,PropAssignedClientIdentifier
// "u\235\b'?\200\200\222\209\170\244\a\163",PropAuthenticationMethod
// "\130\170\149\228\NAK\DC3(\236\185\239\206\199Ie\136X",PropPayloadFormatIndicator 109,PropReceiveMaximum
// 17095,PropContentType "\132X\255\250z3T;\180\219\144,gS\137BB\144\DC3w\170\248\173a\245\211\246",PropCorrelationData
// "\RSN\167\184\187bki4\152\197F=H\168"]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x33, 0x7f, 0x0,  0xb,  0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88, 0xd4, 0x9a, 0x1f, 0xed,
                   0x5a, 0x19, 0x64, 0x12, 0x0,  0xd,  0x75, 0xeb, 0x8,  0x27, 0x3f, 0xc8, 0xc8, 0xde, 0xd1, 0xaa, 0xf4,
                   0x7,  0xa3, 0x15, 0x0,  0x10, 0x82, 0xaa, 0x95, 0xe4, 0x15, 0x13, 0x28, 0xec, 0xb9, 0xef, 0xce, 0xc7,
                   0x49, 0x65, 0x88, 0x58, 0x1,  0x6d, 0x21, 0x42, 0xc7, 0x3,  0x0,  0x1b, 0x84, 0x58, 0xff, 0xfa, 0x7a,
                   0x33, 0x54, 0x3b, 0xb4, 0xdb, 0x90, 0x2c, 0x67, 0x53, 0x89, 0x42, 0x42, 0x90, 0x13, 0x77, 0xaa, 0xf8,
                   0xad, 0x61, 0xf5, 0xd3, 0xf6, 0x9,  0x0,  0xf,  0x1e, 0x4e, 0xa7, 0xb8, 0xbb, 0x62, 0x6b, 0x69, 0x34,
                   0x98, 0xc5, 0x46, 0x3d, 0x48, 0xa8, 0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18, 0x6e, 0x6f,
                   0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x90, 0xab, 0x82, 0x1f, 0x42, 0x9b, 0xd4, 0xa3, 0x88, 0xd4, 0x9a};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8e, 0xb2, 0x84, 0x75, 0xec, 0x82, 0x99, 0x46, 0x18, 0x6e, 0x6f,
                              0x8e, 0x97, 0xf1, 0xd1, 0xd0, 0xa2, 0xf6, 0x9c, 0xf9, 0xc7};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8173);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "@\179\160", _pubPktID = 5779,
// _pubBody = "+>\SI\ESC\130^\213\173\147\167D\FS\254\153\218c\237\133\220\156Zk\211\207", _pubProps = []}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x34, 0x20, 0x0,  0x3,  0x40, 0xb3, 0xa0, 0x16, 0x93, 0x0,  0x2b, 0x3e,
                   0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad, 0x93, 0xa7, 0x44, 0x1c, 0xfe, 0x99,
                   0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  uint8_t topic_bytes[] = {0x40, 0xb3, 0xa0};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2b, 0x3e, 0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad, 0x93, 0xa7, 0x44, 0x1c,
                         0xfe, 0x99, 0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 5779, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "@\179\160", _pubPktID = 5779,
// _pubBody = "+>\SI\ESC\130^\213\173\147\167D\FS\254\153\218c\237\133\220\156Zk\211\207", _pubProps = []}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x34, 0x20, 0x0,  0x3,  0x40, 0xb3, 0xa0, 0x16, 0x93, 0x0,  0x2b, 0x3e,
                   0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad, 0x93, 0xa7, 0x44, 0x1c, 0xfe, 0x99,
                   0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x40, 0xb3, 0xa0};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2b, 0x3e, 0xf,  0x1b, 0x82, 0x5e, 0xd5, 0xad, 0x93, 0xa7, 0x44, 0x1c,
                              0xfe, 0x99, 0xda, 0x63, 0xed, 0x85, 0xdc, 0x9c, 0x5a, 0x6b, 0xd3, 0xcf};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5779);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "P\177\NAK.\190\171\224\139\&2\248]=\179n\DC4k\146\152\175\210\205`3|\135\&8i\209", _pubPktID = 19270, _pubBody =
// "\134\ENQKL\159E.\211+^\240\187\146\NAK7dRg\129.m\133\DLE\152C\ESCJ\160\203", _pubProps = [PropAuthenticationData
// "\249\128\218!m\186\b\174\&6\228q\130iQ\252O2\t\134\f\159\211n\150K\164\213\196?\149",PropResponseInformation
// "\244\162%",PropAuthenticationData "\156\195]t",PropContentType
// "7o\211\198\220\230\ETB",PropSubscriptionIdentifierAvailable 49,PropContentType
// "\161\192\204\175\207\205\182\229\236.\247C\EMZf/\223\243\205",PropWillDelayInterval 20097]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x32, 0x93, 0x1,  0x0,  0x1c, 0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d,
                   0xb3, 0x6e, 0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1, 0x4b,
                   0x46, 0x55, 0x16, 0x0,  0x1e, 0xf9, 0x80, 0xda, 0x21, 0x6d, 0xba, 0x8,  0xae, 0x36, 0xe4, 0x71, 0x82,
                   0x69, 0x51, 0xfc, 0x4f, 0x32, 0x9,  0x86, 0xc,  0x9f, 0xd3, 0x6e, 0x96, 0x4b, 0xa4, 0xd5, 0xc4, 0x3f,
                   0x95, 0x1a, 0x0,  0x3,  0xf4, 0xa2, 0x25, 0x16, 0x0,  0x4,  0x9c, 0xc3, 0x5d, 0x74, 0x3,  0x0,  0x7,
                   0x37, 0x6f, 0xd3, 0xc6, 0xdc, 0xe6, 0x17, 0x29, 0x31, 0x3,  0x0,  0x13, 0xa1, 0xc0, 0xcc, 0xaf, 0xcf,
                   0xcd, 0xb6, 0xe5, 0xec, 0x2e, 0xf7, 0x43, 0x19, 0x5a, 0x66, 0x2f, 0xdf, 0xf3, 0xcd, 0x18, 0x0,  0x0,
                   0x4e, 0x81, 0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15, 0x37,
                   0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  uint8_t topic_bytes[] = {0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d, 0xb3, 0x6e,
                           0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15, 0x37,
                         0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0xf9, 0x80, 0xda, 0x21, 0x6d, 0xba, 0x8,  0xae, 0x36, 0xe4, 0x71, 0x82, 0x69, 0x51, 0xfc,
                           0x4f, 0x32, 0x9,  0x86, 0xc,  0x9f, 0xd3, 0x6e, 0x96, 0x4b, 0xa4, 0xd5, 0xc4, 0x3f, 0x95};
  uint8_t bytesprops1[] = {0xf4, 0xa2, 0x25};
  uint8_t bytesprops2[] = {0x9c, 0xc3, 0x5d, 0x74};
  uint8_t bytesprops3[] = {0x37, 0x6f, 0xd3, 0xc6, 0xdc, 0xe6, 0x17};
  uint8_t bytesprops4[] = {0xa1, 0xc0, 0xcc, 0xaf, 0xcf, 0xcd, 0xb6, 0xe5, 0xec, 0x2e,
                           0xf7, 0x43, 0x19, 0x5a, 0x66, 0x2f, 0xdf, 0xf3, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20097}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 19270, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "P\177\NAK.\190\171\224\139\&2\248]=\179n\DC4k\146\152\175\210\205`3|\135\&8i\209", _pubPktID = 19270, _pubBody =
// "\134\ENQKL\159E.\211+^\240\187\146\NAK7dRg\129.m\133\DLE\152C\ESCJ\160\203", _pubProps = [PropAuthenticationData
// "\249\128\218!m\186\b\174\&6\228q\130iQ\252O2\t\134\f\159\211n\150K\164\213\196?\149",PropResponseInformation
// "\244\162%",PropAuthenticationData "\156\195]t",PropContentType
// "7o\211\198\220\230\ETB",PropSubscriptionIdentifierAvailable 49,PropContentType
// "\161\192\204\175\207\205\182\229\236.\247C\EMZf/\223\243\205",PropWillDelayInterval 20097]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {0x32, 0x93, 0x1,  0x0,  0x1c, 0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d,
                   0xb3, 0x6e, 0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1, 0x4b,
                   0x46, 0x55, 0x16, 0x0,  0x1e, 0xf9, 0x80, 0xda, 0x21, 0x6d, 0xba, 0x8,  0xae, 0x36, 0xe4, 0x71, 0x82,
                   0x69, 0x51, 0xfc, 0x4f, 0x32, 0x9,  0x86, 0xc,  0x9f, 0xd3, 0x6e, 0x96, 0x4b, 0xa4, 0xd5, 0xc4, 0x3f,
                   0x95, 0x1a, 0x0,  0x3,  0xf4, 0xa2, 0x25, 0x16, 0x0,  0x4,  0x9c, 0xc3, 0x5d, 0x74, 0x3,  0x0,  0x7,
                   0x37, 0x6f, 0xd3, 0xc6, 0xdc, 0xe6, 0x17, 0x29, 0x31, 0x3,  0x0,  0x13, 0xa1, 0xc0, 0xcc, 0xaf, 0xcf,
                   0xcd, 0xb6, 0xe5, 0xec, 0x2e, 0xf7, 0x43, 0x19, 0x5a, 0x66, 0x2f, 0xdf, 0xf3, 0xcd, 0x18, 0x0,  0x0,
                   0x4e, 0x81, 0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15, 0x37,
                   0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x50, 0xb1, 0x15, 0x2e, 0xbe, 0xab, 0xe0, 0x8b, 0x32, 0xf8, 0x5d, 0x3d, 0xb3, 0x6e,
                               0x14, 0x6b, 0x92, 0x98, 0xaf, 0xd2, 0xcd, 0x60, 0x33, 0x7c, 0x87, 0x38, 0x69, 0xd1};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x86, 0x5,  0x4b, 0x4c, 0x9f, 0x45, 0x2e, 0xd3, 0x2b, 0x5e, 0xf0, 0xbb, 0x92, 0x15, 0x37,
                              0x64, 0x52, 0x67, 0x81, 0x2e, 0x6d, 0x85, 0x10, 0x98, 0x43, 0x1b, 0x4a, 0xa0, 0xcb};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 19270);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DLE", _pubPktID = 0, _pubBody =
// "\DC4s\199\ACKg\249\133\ENQ\157\223\145\&2NM^T\137xH3\226=j,\r\239U\ACK\153\210", _pubProps = [PropWillDelayInterval
// 13975,PropAuthenticationMethod "\178y~\133\229\US\134f",PropSubscriptionIdentifier 24,PropPayloadFormatIndicator
// 112,PropAuthenticationData "\226\221\243\164*\209\&1_F\NAKcK\194",PropServerReference
// "\RSW\194s\202\203\172/\207R",PropServerReference "\248\244\133\DC4",PropTopicAlias 12118,PropAuthenticationData
// "\181\221\RS{\134\247\SUB\195\SO",PropServerReference
// "\225\232\152\176yO\DEL{\233x\170^\b\193g\ETXd\v\\\252wc\175\149eU\a\DC4",PropResponseTopic
// "Z\FSr\DC3\220{\RS\206V\168\197\&0\210\203\ENQ\160\&5\176W\213\&64\vu",PropCorrelationData "Jh"]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {0x39, 0xa9, 0x1,  0x0,  0x1,  0x10, 0x86, 0x1,  0x18, 0x0,  0x0,  0x36, 0x97, 0x15, 0x0,  0x8,
                   0xb2, 0x79, 0x7e, 0x85, 0xe5, 0x1f, 0x86, 0x66, 0xb,  0x18, 0x1,  0x70, 0x16, 0x0,  0xd,  0xe2,
                   0xdd, 0xf3, 0xa4, 0x2a, 0xd1, 0x31, 0x5f, 0x46, 0x15, 0x63, 0x4b, 0xc2, 0x1c, 0x0,  0xa,  0x1e,
                   0x57, 0xc2, 0x73, 0xca, 0xcb, 0xac, 0x2f, 0xcf, 0x52, 0x1c, 0x0,  0x4,  0xf8, 0xf4, 0x85, 0x14,
                   0x23, 0x2f, 0x56, 0x16, 0x0,  0x9,  0xb5, 0xdd, 0x1e, 0x7b, 0x86, 0xf7, 0x1a, 0xc3, 0xe,  0x1c,
                   0x0,  0x1c, 0xe1, 0xe8, 0x98, 0xb0, 0x79, 0x4f, 0x7f, 0x7b, 0xe9, 0x78, 0xaa, 0x5e, 0x8,  0xc1,
                   0x67, 0x3,  0x64, 0xb,  0x5c, 0xfc, 0x77, 0x63, 0xaf, 0x95, 0x65, 0x55, 0x7,  0x14, 0x8,  0x0,
                   0x18, 0x5a, 0x1c, 0x72, 0x13, 0xdc, 0x7b, 0x1e, 0xce, 0x56, 0xa8, 0xc5, 0x30, 0xd2, 0xcb, 0x5,
                   0xa0, 0x35, 0xb0, 0x57, 0xd5, 0x36, 0x34, 0xb,  0x75, 0x9,  0x0,  0x2,  0x4a, 0x68, 0x14, 0x73,
                   0xc7, 0x6,  0x67, 0xf9, 0x85, 0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e, 0x54, 0x89, 0x78,
                   0x48, 0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  uint8_t topic_bytes[] = {0x10};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x14, 0x73, 0xc7, 0x6,  0x67, 0xf9, 0x85, 0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e,
                         0x54, 0x89, 0x78, 0x48, 0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xb2, 0x79, 0x7e, 0x85, 0xe5, 0x1f, 0x86, 0x66};
  uint8_t bytesprops1[] = {0xe2, 0xdd, 0xf3, 0xa4, 0x2a, 0xd1, 0x31, 0x5f, 0x46, 0x15, 0x63, 0x4b, 0xc2};
  uint8_t bytesprops2[] = {0x1e, 0x57, 0xc2, 0x73, 0xca, 0xcb, 0xac, 0x2f, 0xcf, 0x52};
  uint8_t bytesprops3[] = {0xf8, 0xf4, 0x85, 0x14};
  uint8_t bytesprops4[] = {0xb5, 0xdd, 0x1e, 0x7b, 0x86, 0xf7, 0x1a, 0xc3, 0xe};
  uint8_t bytesprops5[] = {0xe1, 0xe8, 0x98, 0xb0, 0x79, 0x4f, 0x7f, 0x7b, 0xe9, 0x78, 0xaa, 0x5e, 0x8, 0xc1,
                           0x67, 0x3,  0x64, 0xb,  0x5c, 0xfc, 0x77, 0x63, 0xaf, 0x95, 0x65, 0x55, 0x7, 0x14};
  uint8_t bytesprops6[] = {0x5a, 0x1c, 0x72, 0x13, 0xdc, 0x7b, 0x1e, 0xce, 0x56, 0xa8, 0xc5, 0x30,
                           0xd2, 0xcb, 0x5,  0xa0, 0x35, 0xb0, 0x57, 0xd5, 0x36, 0x34, 0xb,  0x75};
  uint8_t bytesprops7[] = {0x4a, 0x68};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13975}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12118}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DLE", _pubPktID = 0, _pubBody =
// "\DC4s\199\ACKg\249\133\ENQ\157\223\145\&2NM^T\137xH3\226=j,\r\239U\ACK\153\210", _pubProps = [PropWillDelayInterval
// 13975,PropAuthenticationMethod "\178y~\133\229\US\134f",PropSubscriptionIdentifier 24,PropPayloadFormatIndicator
// 112,PropAuthenticationData "\226\221\243\164*\209\&1_F\NAKcK\194",PropServerReference
// "\RSW\194s\202\203\172/\207R",PropServerReference "\248\244\133\DC4",PropTopicAlias 12118,PropAuthenticationData
// "\181\221\RS{\134\247\SUB\195\SO",PropServerReference
// "\225\232\152\176yO\DEL{\233x\170^\b\193g\ETXd\v\\\252wc\175\149eU\a\DC4",PropResponseTopic
// "Z\FSr\DC3\220{\RS\206V\168\197\&0\210\203\ENQ\160\&5\176W\213\&64\vu",PropCorrelationData "Jh"]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {0x39, 0xa9, 0x1,  0x0,  0x1,  0x10, 0x86, 0x1,  0x18, 0x0,  0x0,  0x36, 0x97, 0x15, 0x0,  0x8,
                   0xb2, 0x79, 0x7e, 0x85, 0xe5, 0x1f, 0x86, 0x66, 0xb,  0x18, 0x1,  0x70, 0x16, 0x0,  0xd,  0xe2,
                   0xdd, 0xf3, 0xa4, 0x2a, 0xd1, 0x31, 0x5f, 0x46, 0x15, 0x63, 0x4b, 0xc2, 0x1c, 0x0,  0xa,  0x1e,
                   0x57, 0xc2, 0x73, 0xca, 0xcb, 0xac, 0x2f, 0xcf, 0x52, 0x1c, 0x0,  0x4,  0xf8, 0xf4, 0x85, 0x14,
                   0x23, 0x2f, 0x56, 0x16, 0x0,  0x9,  0xb5, 0xdd, 0x1e, 0x7b, 0x86, 0xf7, 0x1a, 0xc3, 0xe,  0x1c,
                   0x0,  0x1c, 0xe1, 0xe8, 0x98, 0xb0, 0x79, 0x4f, 0x7f, 0x7b, 0xe9, 0x78, 0xaa, 0x5e, 0x8,  0xc1,
                   0x67, 0x3,  0x64, 0xb,  0x5c, 0xfc, 0x77, 0x63, 0xaf, 0x95, 0x65, 0x55, 0x7,  0x14, 0x8,  0x0,
                   0x18, 0x5a, 0x1c, 0x72, 0x13, 0xdc, 0x7b, 0x1e, 0xce, 0x56, 0xa8, 0xc5, 0x30, 0xd2, 0xcb, 0x5,
                   0xa0, 0x35, 0xb0, 0x57, 0xd5, 0x36, 0x34, 0xb,  0x75, 0x9,  0x0,  0x2,  0x4a, 0x68, 0x14, 0x73,
                   0xc7, 0x6,  0x67, 0xf9, 0x85, 0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e, 0x54, 0x89, 0x78,
                   0x48, 0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x10};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x14, 0x73, 0xc7, 0x6,  0x67, 0xf9, 0x85, 0x5,  0x9d, 0xdf, 0x91, 0x32, 0x4e, 0x4d, 0x5e,
                              0x54, 0x89, 0x78, 0x48, 0x33, 0xe2, 0x3d, 0x6a, 0x2c, 0xd,  0xef, 0x55, 0x6,  0x99, 0xd2};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\171b\DC1\233\"[\161x\tR2\b\143\ap\176)0\156/\230\155\ETBx\154h*|", _pubPktID = 3357, _pubBody = "\139", _pubProps =
// [PropTopicAlias 26188,PropRetainAvailable 55,PropReasonString
// "w\181\DC2\242\168\ACK\248@\224\ACK\SOH\135",PropMaximumPacketSize 1661,PropWillDelayInterval
// 877,PropRequestResponseInformation 164,PropWillDelayInterval 28432,PropSessionExpiryInterval
// 27592,PropMessageExpiryInterval 19299,PropTopicAliasMaximum 32078,PropAuthenticationMethod "\154
// 0o}R\229`h\198\&0\STX0D\221\218\242\&3e\162\164\225\248\183\SIZ\209\251\226\251",PropMessageExpiryInterval
// 7477,PropSubscriptionIdentifier 1,PropReasonString
// "YS\ETB\STX\157\204_\155\&2\244\201\"\143X\142&\241\US\131\&0\ETB\177",PropTopicAlias 10274]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {0x3c, 0x98, 0x1,  0x0,  0x1c, 0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78, 0x9,  0x52, 0x32,
                   0x8,  0x8f, 0x7,  0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f, 0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a,
                   0x7c, 0xd,  0x1d, 0x76, 0x23, 0x66, 0x4c, 0x25, 0x37, 0x1f, 0x0,  0xc,  0x77, 0xb5, 0x12, 0xf2,
                   0xa8, 0x6,  0xf8, 0x40, 0xe0, 0x6,  0x1,  0x87, 0x27, 0x0,  0x0,  0x6,  0x7d, 0x18, 0x0,  0x0,
                   0x3,  0x6d, 0x19, 0xa4, 0x18, 0x0,  0x0,  0x6f, 0x10, 0x11, 0x0,  0x0,  0x6b, 0xc8, 0x2,  0x0,
                   0x0,  0x4b, 0x63, 0x22, 0x7d, 0x4e, 0x15, 0x0,  0x1e, 0x9a, 0x20, 0x30, 0x6f, 0x7d, 0x52, 0xe5,
                   0x60, 0x68, 0xc6, 0x30, 0x2,  0x30, 0x44, 0xdd, 0xda, 0xf2, 0x33, 0x65, 0xa2, 0xa4, 0xe1, 0xf8,
                   0xb7, 0xf,  0x5a, 0xd1, 0xfb, 0xe2, 0xfb, 0x2,  0x0,  0x0,  0x1d, 0x35, 0xb,  0x1,  0x1f, 0x0,
                   0x16, 0x59, 0x53, 0x17, 0x2,  0x9d, 0xcc, 0x5f, 0x9b, 0x32, 0xf4, 0xc9, 0x22, 0x8f, 0x58, 0x8e,
                   0x26, 0xf1, 0x1f, 0x83, 0x30, 0x17, 0xb1, 0x23, 0x28, 0x22, 0x8b};
  uint8_t topic_bytes[] = {0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78, 0x9,  0x52, 0x32, 0x8,  0x8f, 0x7,
                           0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f, 0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a, 0x7c};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x77, 0xb5, 0x12, 0xf2, 0xa8, 0x6, 0xf8, 0x40, 0xe0, 0x6, 0x1, 0x87};
  uint8_t bytesprops1[] = {0x9a, 0x20, 0x30, 0x6f, 0x7d, 0x52, 0xe5, 0x60, 0x68, 0xc6, 0x30, 0x2,  0x30, 0x44, 0xdd,
                           0xda, 0xf2, 0x33, 0x65, 0xa2, 0xa4, 0xe1, 0xf8, 0xb7, 0xf,  0x5a, 0xd1, 0xfb, 0xe2, 0xfb};
  uint8_t bytesprops2[] = {0x59, 0x53, 0x17, 0x2,  0x9d, 0xcc, 0x5f, 0x9b, 0x32, 0xf4, 0xc9,
                           0x22, 0x8f, 0x58, 0x8e, 0x26, 0xf1, 0x1f, 0x83, 0x30, 0x17, 0xb1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26188}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1661}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 877}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28432}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27592}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19299}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32078}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7477}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 1}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10274}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 3357, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\171b\DC1\233\"[\161x\tR2\b\143\ap\176)0\156/\230\155\ETBx\154h*|", _pubPktID = 3357, _pubBody = "\139", _pubProps =
// [PropTopicAlias 26188,PropRetainAvailable 55,PropReasonString
// "w\181\DC2\242\168\ACK\248@\224\ACK\SOH\135",PropMaximumPacketSize 1661,PropWillDelayInterval
// 877,PropRequestResponseInformation 164,PropWillDelayInterval 28432,PropSessionExpiryInterval
// 27592,PropMessageExpiryInterval 19299,PropTopicAliasMaximum 32078,PropAuthenticationMethod "\154
// 0o}R\229`h\198\&0\STX0D\221\218\242\&3e\162\164\225\248\183\SIZ\209\251\226\251",PropMessageExpiryInterval
// 7477,PropSubscriptionIdentifier 1,PropReasonString
// "YS\ETB\STX\157\204_\155\&2\244\201\"\143X\142&\241\US\131\&0\ETB\177",PropTopicAlias 10274]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {0x3c, 0x98, 0x1,  0x0,  0x1c, 0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78, 0x9,  0x52, 0x32,
                   0x8,  0x8f, 0x7,  0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f, 0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a,
                   0x7c, 0xd,  0x1d, 0x76, 0x23, 0x66, 0x4c, 0x25, 0x37, 0x1f, 0x0,  0xc,  0x77, 0xb5, 0x12, 0xf2,
                   0xa8, 0x6,  0xf8, 0x40, 0xe0, 0x6,  0x1,  0x87, 0x27, 0x0,  0x0,  0x6,  0x7d, 0x18, 0x0,  0x0,
                   0x3,  0x6d, 0x19, 0xa4, 0x18, 0x0,  0x0,  0x6f, 0x10, 0x11, 0x0,  0x0,  0x6b, 0xc8, 0x2,  0x0,
                   0x0,  0x4b, 0x63, 0x22, 0x7d, 0x4e, 0x15, 0x0,  0x1e, 0x9a, 0x20, 0x30, 0x6f, 0x7d, 0x52, 0xe5,
                   0x60, 0x68, 0xc6, 0x30, 0x2,  0x30, 0x44, 0xdd, 0xda, 0xf2, 0x33, 0x65, 0xa2, 0xa4, 0xe1, 0xf8,
                   0xb7, 0xf,  0x5a, 0xd1, 0xfb, 0xe2, 0xfb, 0x2,  0x0,  0x0,  0x1d, 0x35, 0xb,  0x1,  0x1f, 0x0,
                   0x16, 0x59, 0x53, 0x17, 0x2,  0x9d, 0xcc, 0x5f, 0x9b, 0x32, 0xf4, 0xc9, 0x22, 0x8f, 0x58, 0x8e,
                   0x26, 0xf1, 0x1f, 0x83, 0x30, 0x17, 0xb1, 0x23, 0x28, 0x22, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xab, 0x62, 0x11, 0xe9, 0x22, 0x5b, 0xa1, 0x78, 0x9,  0x52, 0x32, 0x8,  0x8f, 0x7,
                               0x70, 0xb0, 0x29, 0x30, 0x9c, 0x2f, 0xe6, 0x9b, 0x17, 0x78, 0x9a, 0x68, 0x2a, 0x7c};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8b};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3357);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\243\197\208\135\165\n\174^Z4\184\231\152+\166\ETX\175`\187\229\171:\143\196\rO\140G", _pubPktID = 31669, _pubBody =
// "\165yk,.\240\234\134]\245eA\SI\171\146\201\234a.\165", _pubProps = [PropCorrelationData "w2\170x\169\&4\199\\"]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {0x34, 0x40, 0x0,  0x1c, 0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34, 0xb8, 0xe7, 0x98,
                   0x2b, 0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4, 0xd,  0x4f, 0x8c, 0x47, 0x7b, 0xb5,
                   0xb,  0x9,  0x0,  0x8,  0x77, 0x32, 0xaa, 0x78, 0xa9, 0x34, 0xc7, 0x5c, 0xa5, 0x79, 0x6b, 0x2c, 0x2e,
                   0xf0, 0xea, 0x86, 0x5d, 0xf5, 0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  uint8_t topic_bytes[] = {0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34, 0xb8, 0xe7, 0x98, 0x2b,
                           0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4, 0xd,  0x4f, 0x8c, 0x47};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0x79, 0x6b, 0x2c, 0x2e, 0xf0, 0xea, 0x86, 0x5d, 0xf5,
                         0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0x77, 0x32, 0xaa, 0x78, 0xa9, 0x34, 0xc7, 0x5c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 31669, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\243\197\208\135\165\n\174^Z4\184\231\152+\166\ETX\175`\187\229\171:\143\196\rO\140G", _pubPktID = 31669, _pubBody =
// "\165yk,.\240\234\134]\245eA\SI\171\146\201\234a.\165", _pubProps = [PropCorrelationData "w2\170x\169\&4\199\\"]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {0x34, 0x40, 0x0,  0x1c, 0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34, 0xb8, 0xe7, 0x98,
                   0x2b, 0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4, 0xd,  0x4f, 0x8c, 0x47, 0x7b, 0xb5,
                   0xb,  0x9,  0x0,  0x8,  0x77, 0x32, 0xaa, 0x78, 0xa9, 0x34, 0xc7, 0x5c, 0xa5, 0x79, 0x6b, 0x2c, 0x2e,
                   0xf0, 0xea, 0x86, 0x5d, 0xf5, 0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf3, 0xc5, 0xd0, 0x87, 0xa5, 0xa,  0xae, 0x5e, 0x5a, 0x34, 0xb8, 0xe7, 0x98, 0x2b,
                               0xa6, 0x3,  0xaf, 0x60, 0xbb, 0xe5, 0xab, 0x3a, 0x8f, 0xc4, 0xd,  0x4f, 0x8c, 0x47};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa5, 0x79, 0x6b, 0x2c, 0x2e, 0xf0, 0xea, 0x86, 0x5d, 0xf5,
                              0x65, 0x41, 0xf,  0xab, 0x92, 0xc9, 0xea, 0x61, 0x2e, 0xa5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31669);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\v\172h\241z\159Z'\153h\STXiS.\STX&a\166|\147~\ETBbP\194\242$`q", _pubPktID = 29118, _pubBody =
// "\155\GS\134h\241\DC2\174", _pubProps = [PropRequestProblemInformation 58,PropSubscriptionIdentifierAvailable
// 41,PropSubscriptionIdentifier 30,PropMessageExpiryInterval 13507,PropPayloadFormatIndicator
// 213,PropWildcardSubscriptionAvailable 147,PropSubscriptionIdentifierAvailable 57,PropReceiveMaximum
// 3682,PropServerReference "5C\CAN$\STXi\214\131o\r\205\&8X\143",PropWildcardSubscriptionAvailable
// 131,PropRequestResponseInformation 174,PropWildcardSubscriptionAvailable 121,PropSharedSubscriptionAvailable
// 106,PropMaximumPacketSize 6087,PropMessageExpiryInterval 1138,PropMaximumQoS 166,PropResponseTopic
// "e:\SYN\202\158\161\132\161\SOH\139\ETBr\ACK\ESC7\160+\183}\221#\201",PropRequestResponseInformation
// 40,PropAuthenticationData "\203\213\NUL#\207\DC4?5Y\249n\"\174\140\150\216\"3sz",PropWildcardSubscriptionAvailable
// 42,PropSubscriptionIdentifier 19,PropMaximumPacketSize 27196,PropCorrelationData "\b\223\191e\227"]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {0x33, 0xa5, 0x1,  0x0,  0x1d, 0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68, 0x2,  0x69,
                   0x53, 0x2e, 0x2,  0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50, 0xc2, 0xf2, 0x24, 0x60, 0x71,
                   0x71, 0xbe, 0x7c, 0x17, 0x3a, 0x29, 0x29, 0xb,  0x1e, 0x2,  0x0,  0x0,  0x34, 0xc3, 0x1,  0xd5, 0x28,
                   0x93, 0x29, 0x39, 0x21, 0xe,  0x62, 0x1c, 0x0,  0xe,  0x35, 0x43, 0x18, 0x24, 0x2,  0x69, 0xd6, 0x83,
                   0x6f, 0xd,  0xcd, 0x38, 0x58, 0x8f, 0x28, 0x83, 0x19, 0xae, 0x28, 0x79, 0x2a, 0x6a, 0x27, 0x0,  0x0,
                   0x17, 0xc7, 0x2,  0x0,  0x0,  0x4,  0x72, 0x24, 0xa6, 0x8,  0x0,  0x16, 0x65, 0x3a, 0x16, 0xca, 0x9e,
                   0xa1, 0x84, 0xa1, 0x1,  0x8b, 0x17, 0x72, 0x6,  0x1b, 0x37, 0xa0, 0x2b, 0xb7, 0x7d, 0xdd, 0x23, 0xc9,
                   0x19, 0x28, 0x16, 0x0,  0x14, 0xcb, 0xd5, 0x0,  0x23, 0xcf, 0x14, 0x3f, 0x35, 0x59, 0xf9, 0x6e, 0x22,
                   0xae, 0x8c, 0x96, 0xd8, 0x22, 0x33, 0x73, 0x7a, 0x28, 0x2a, 0xb,  0x13, 0x27, 0x0,  0x0,  0x6a, 0x3c,
                   0x9,  0x0,  0x5,  0x8,  0xdf, 0xbf, 0x65, 0xe3, 0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  uint8_t topic_bytes[] = {0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68, 0x2,  0x69, 0x53, 0x2e, 0x2,
                           0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50, 0xc2, 0xf2, 0x24, 0x60, 0x71};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0x35, 0x43, 0x18, 0x24, 0x2, 0x69, 0xd6, 0x83, 0x6f, 0xd, 0xcd, 0x38, 0x58, 0x8f};
  uint8_t bytesprops1[] = {0x65, 0x3a, 0x16, 0xca, 0x9e, 0xa1, 0x84, 0xa1, 0x1,  0x8b, 0x17,
                           0x72, 0x6,  0x1b, 0x37, 0xa0, 0x2b, 0xb7, 0x7d, 0xdd, 0x23, 0xc9};
  uint8_t bytesprops2[] = {0xcb, 0xd5, 0x0,  0x23, 0xcf, 0x14, 0x3f, 0x35, 0x59, 0xf9,
                           0x6e, 0x22, 0xae, 0x8c, 0x96, 0xd8, 0x22, 0x33, 0x73, 0x7a};
  uint8_t bytesprops3[] = {0x8, 0xdf, 0xbf, 0x65, 0xe3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13507}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3682}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6087}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1138}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27196}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29118, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\v\172h\241z\159Z'\153h\STXiS.\STX&a\166|\147~\ETBbP\194\242$`q", _pubPktID = 29118, _pubBody =
// "\155\GS\134h\241\DC2\174", _pubProps = [PropRequestProblemInformation 58,PropSubscriptionIdentifierAvailable
// 41,PropSubscriptionIdentifier 30,PropMessageExpiryInterval 13507,PropPayloadFormatIndicator
// 213,PropWildcardSubscriptionAvailable 147,PropSubscriptionIdentifierAvailable 57,PropReceiveMaximum
// 3682,PropServerReference "5C\CAN$\STXi\214\131o\r\205\&8X\143",PropWildcardSubscriptionAvailable
// 131,PropRequestResponseInformation 174,PropWildcardSubscriptionAvailable 121,PropSharedSubscriptionAvailable
// 106,PropMaximumPacketSize 6087,PropMessageExpiryInterval 1138,PropMaximumQoS 166,PropResponseTopic
// "e:\SYN\202\158\161\132\161\SOH\139\ETBr\ACK\ESC7\160+\183}\221#\201",PropRequestResponseInformation
// 40,PropAuthenticationData "\203\213\NUL#\207\DC4?5Y\249n\"\174\140\150\216\"3sz",PropWildcardSubscriptionAvailable
// 42,PropSubscriptionIdentifier 19,PropMaximumPacketSize 27196,PropCorrelationData "\b\223\191e\227"]}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {0x33, 0xa5, 0x1,  0x0,  0x1d, 0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68, 0x2,  0x69,
                   0x53, 0x2e, 0x2,  0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50, 0xc2, 0xf2, 0x24, 0x60, 0x71,
                   0x71, 0xbe, 0x7c, 0x17, 0x3a, 0x29, 0x29, 0xb,  0x1e, 0x2,  0x0,  0x0,  0x34, 0xc3, 0x1,  0xd5, 0x28,
                   0x93, 0x29, 0x39, 0x21, 0xe,  0x62, 0x1c, 0x0,  0xe,  0x35, 0x43, 0x18, 0x24, 0x2,  0x69, 0xd6, 0x83,
                   0x6f, 0xd,  0xcd, 0x38, 0x58, 0x8f, 0x28, 0x83, 0x19, 0xae, 0x28, 0x79, 0x2a, 0x6a, 0x27, 0x0,  0x0,
                   0x17, 0xc7, 0x2,  0x0,  0x0,  0x4,  0x72, 0x24, 0xa6, 0x8,  0x0,  0x16, 0x65, 0x3a, 0x16, 0xca, 0x9e,
                   0xa1, 0x84, 0xa1, 0x1,  0x8b, 0x17, 0x72, 0x6,  0x1b, 0x37, 0xa0, 0x2b, 0xb7, 0x7d, 0xdd, 0x23, 0xc9,
                   0x19, 0x28, 0x16, 0x0,  0x14, 0xcb, 0xd5, 0x0,  0x23, 0xcf, 0x14, 0x3f, 0x35, 0x59, 0xf9, 0x6e, 0x22,
                   0xae, 0x8c, 0x96, 0xd8, 0x22, 0x33, 0x73, 0x7a, 0x28, 0x2a, 0xb,  0x13, 0x27, 0x0,  0x0,  0x6a, 0x3c,
                   0x9,  0x0,  0x5,  0x8,  0xdf, 0xbf, 0x65, 0xe3, 0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb,  0xac, 0x68, 0xf1, 0x7a, 0x9f, 0x5a, 0x27, 0x99, 0x68, 0x2,  0x69, 0x53, 0x2e, 0x2,
                               0x26, 0x61, 0xa6, 0x7c, 0x93, 0x7e, 0x17, 0x62, 0x50, 0xc2, 0xf2, 0x24, 0x60, 0x71};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x1d, 0x86, 0x68, 0xf1, 0x12, 0xae};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29118);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "q+J\205\r\197\201+\DLE\216\DC4\207\206\SI\242\241\137\SUB\213\246\&1\NUL%\242b\204", _pubPktID = 0, _pubBody =
// "\137[\151L+\\\238\187\158\137/}8}\vL\159\208\134\DC4\192", _pubProps = []}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x39, 0x32, 0x0,  0x1a, 0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10,
                   0xd8, 0x14, 0xcf, 0xce, 0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,
                   0x25, 0xf2, 0x62, 0xcc, 0x0,  0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb,
                   0x9e, 0x89, 0x2f, 0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  uint8_t topic_bytes[] = {0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10, 0xd8, 0x14, 0xcf, 0xce,
                           0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,  0x25, 0xf2, 0x62, 0xcc};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb, 0x9e, 0x89, 0x2f,
                         0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "q+J\205\r\197\201+\DLE\216\DC4\207\206\SI\242\241\137\SUB\213\246\&1\NUL%\242b\204", _pubPktID = 0, _pubBody =
// "\137[\151L+\\\238\187\158\137/}8}\vL\159\208\134\DC4\192", _pubProps = []}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x39, 0x32, 0x0,  0x1a, 0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10,
                   0xd8, 0x14, 0xcf, 0xce, 0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,
                   0x25, 0xf2, 0x62, 0xcc, 0x0,  0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb,
                   0x9e, 0x89, 0x2f, 0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x71, 0x2b, 0x4a, 0xcd, 0xd,  0xc5, 0xc9, 0x2b, 0x10, 0xd8, 0x14, 0xcf, 0xce,
                               0xf,  0xf2, 0xf1, 0x89, 0x1a, 0xd5, 0xf6, 0x31, 0x0,  0x25, 0xf2, 0x62, 0xcc};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x89, 0x5b, 0x97, 0x4c, 0x2b, 0x5c, 0xee, 0xbb, 0x9e, 0x89, 0x2f,
                              0x7d, 0x38, 0x7d, 0xb,  0x4c, 0x9f, 0xd0, 0x86, 0x14, 0xc0};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "6", _pubPktID = 0, _pubBody = "b",
// _pubProps = [PropResponseTopic "l\135\EM",PropSessionExpiryInterval 27254,PropSubscriptionIdentifierAvailable
// 134,PropMaximumPacketSize 4947,PropRequestResponseInformation 129,PropServerReference
// "\152$\STX\215\220\243\246\202@\129_V%\158\176",PropServerReference "\246bNa\175@;\160\187\144o\232
// ",PropServerReference "\246} \172\ETB?\252U\254\a\237Q\226WE\173\162b\163\217\246",PropMaximumPacketSize
// 23596,PropReasonString "]\CAN!\SUB\191~\131}S\202$f\141\155\&0~\189\ENQ^\228\203\206",PropContentType
// "@/\238{\253\142\158t\206&\143\160\&2\225\244\162x\195\r\235\DELx",PropReceiveMaximum 15263,PropCorrelationData
// "\241\234\181\&8\220^\161\239SU",PropAuthenticationData
// "\212\211G%\134\NUL&\185\242\159+\139J\177\177",PropResponseTopic
// "\230\238s\143\164\133-\212\SOV++\249\138",PropServerReference
// "PV\128\209\&0$\172M\231l\153\129\199\184\&84\244\152F\170C\225\179\208\b\137",PropMessageExpiryInterval
// 26834,PropServerKeepAlive 26744,PropRequestResponseInformation 214,PropTopicAlias 21354,PropServerReference
// "\164\244\229\233\151\187k}v\237",PropRetainAvailable 118,PropAuthenticationMethod
// "IX\131\171r\178\196u",PropTopicAliasMaximum 8893,PropCorrelationData "`\146\151\209}\EOT\177\230\236S"]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x31, 0x92, 0x2,  0x0,  0x1,  0x36, 0x8c, 0x2,  0x8,  0x0,  0x3,  0x6c, 0x87, 0x19, 0x11, 0x0,  0x0,  0x6a, 0x76,
      0x29, 0x86, 0x27, 0x0,  0x0,  0x13, 0x53, 0x19, 0x81, 0x1c, 0x0,  0xf,  0x98, 0x24, 0x2,  0xd7, 0xdc, 0xf3, 0xf6,
      0xca, 0x40, 0x81, 0x5f, 0x56, 0x25, 0x9e, 0xb0, 0x1c, 0x0,  0xd,  0xf6, 0x62, 0x4e, 0x61, 0xaf, 0x40, 0x3b, 0xa0,
      0xbb, 0x90, 0x6f, 0xe8, 0x20, 0x1c, 0x0,  0x15, 0xf6, 0x7d, 0x20, 0xac, 0x17, 0x3f, 0xfc, 0x55, 0xfe, 0x7,  0xed,
      0x51, 0xe2, 0x57, 0x45, 0xad, 0xa2, 0x62, 0xa3, 0xd9, 0xf6, 0x27, 0x0,  0x0,  0x5c, 0x2c, 0x1f, 0x0,  0x16, 0x5d,
      0x18, 0x21, 0x1a, 0xbf, 0x7e, 0x83, 0x7d, 0x53, 0xca, 0x24, 0x66, 0x8d, 0x9b, 0x30, 0x7e, 0xbd, 0x5,  0x5e, 0xe4,
      0xcb, 0xce, 0x3,  0x0,  0x16, 0x40, 0x2f, 0xee, 0x7b, 0xfd, 0x8e, 0x9e, 0x74, 0xce, 0x26, 0x8f, 0xa0, 0x32, 0xe1,
      0xf4, 0xa2, 0x78, 0xc3, 0xd,  0xeb, 0x7f, 0x78, 0x21, 0x3b, 0x9f, 0x9,  0x0,  0xa,  0xf1, 0xea, 0xb5, 0x38, 0xdc,
      0x5e, 0xa1, 0xef, 0x53, 0x55, 0x16, 0x0,  0xf,  0xd4, 0xd3, 0x47, 0x25, 0x86, 0x0,  0x26, 0xb9, 0xf2, 0x9f, 0x2b,
      0x8b, 0x4a, 0xb1, 0xb1, 0x8,  0x0,  0xe,  0xe6, 0xee, 0x73, 0x8f, 0xa4, 0x85, 0x2d, 0xd4, 0xe,  0x56, 0x2b, 0x2b,
      0xf9, 0x8a, 0x1c, 0x0,  0x1a, 0x50, 0x56, 0x80, 0xd1, 0x30, 0x24, 0xac, 0x4d, 0xe7, 0x6c, 0x99, 0x81, 0xc7, 0xb8,
      0x38, 0x34, 0xf4, 0x98, 0x46, 0xaa, 0x43, 0xe1, 0xb3, 0xd0, 0x8,  0x89, 0x2,  0x0,  0x0,  0x68, 0xd2, 0x13, 0x68,
      0x78, 0x19, 0xd6, 0x23, 0x53, 0x6a, 0x1c, 0x0,  0xa,  0xa4, 0xf4, 0xe5, 0xe9, 0x97, 0xbb, 0x6b, 0x7d, 0x76, 0xed,
      0x25, 0x76, 0x15, 0x0,  0x8,  0x49, 0x58, 0x83, 0xab, 0x72, 0xb2, 0xc4, 0x75, 0x22, 0x22, 0xbd, 0x9,  0x0,  0xa,
      0x60, 0x92, 0x97, 0xd1, 0x7d, 0x4,  0xb1, 0xe6, 0xec, 0x53, 0x62};
  uint8_t topic_bytes[] = {0x36};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x62};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x6c, 0x87, 0x19};
  uint8_t bytesprops1[] = {0x98, 0x24, 0x2, 0xd7, 0xdc, 0xf3, 0xf6, 0xca, 0x40, 0x81, 0x5f, 0x56, 0x25, 0x9e, 0xb0};
  uint8_t bytesprops2[] = {0xf6, 0x62, 0x4e, 0x61, 0xaf, 0x40, 0x3b, 0xa0, 0xbb, 0x90, 0x6f, 0xe8, 0x20};
  uint8_t bytesprops3[] = {0xf6, 0x7d, 0x20, 0xac, 0x17, 0x3f, 0xfc, 0x55, 0xfe, 0x7, 0xed,
                           0x51, 0xe2, 0x57, 0x45, 0xad, 0xa2, 0x62, 0xa3, 0xd9, 0xf6};
  uint8_t bytesprops4[] = {0x5d, 0x18, 0x21, 0x1a, 0xbf, 0x7e, 0x83, 0x7d, 0x53, 0xca, 0x24,
                           0x66, 0x8d, 0x9b, 0x30, 0x7e, 0xbd, 0x5,  0x5e, 0xe4, 0xcb, 0xce};
  uint8_t bytesprops5[] = {0x40, 0x2f, 0xee, 0x7b, 0xfd, 0x8e, 0x9e, 0x74, 0xce, 0x26, 0x8f,
                           0xa0, 0x32, 0xe1, 0xf4, 0xa2, 0x78, 0xc3, 0xd,  0xeb, 0x7f, 0x78};
  uint8_t bytesprops6[] = {0xf1, 0xea, 0xb5, 0x38, 0xdc, 0x5e, 0xa1, 0xef, 0x53, 0x55};
  uint8_t bytesprops7[] = {0xd4, 0xd3, 0x47, 0x25, 0x86, 0x0, 0x26, 0xb9, 0xf2, 0x9f, 0x2b, 0x8b, 0x4a, 0xb1, 0xb1};
  uint8_t bytesprops8[] = {0xe6, 0xee, 0x73, 0x8f, 0xa4, 0x85, 0x2d, 0xd4, 0xe, 0x56, 0x2b, 0x2b, 0xf9, 0x8a};
  uint8_t bytesprops9[] = {0x50, 0x56, 0x80, 0xd1, 0x30, 0x24, 0xac, 0x4d, 0xe7, 0x6c, 0x99, 0x81, 0xc7,
                           0xb8, 0x38, 0x34, 0xf4, 0x98, 0x46, 0xaa, 0x43, 0xe1, 0xb3, 0xd0, 0x8,  0x89};
  uint8_t bytesprops10[] = {0xa4, 0xf4, 0xe5, 0xe9, 0x97, 0xbb, 0x6b, 0x7d, 0x76, 0xed};
  uint8_t bytesprops11[] = {0x49, 0x58, 0x83, 0xab, 0x72, 0xb2, 0xc4, 0x75};
  uint8_t bytesprops12[] = {0x60, 0x92, 0x97, 0xd1, 0x7d, 0x4, 0xb1, 0xe6, 0xec, 0x53};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27254}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4947}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23596}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15263}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26834}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26744}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21354}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8893}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops12}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "6", _pubPktID = 0, _pubBody = "b",
// _pubProps = [PropResponseTopic "l\135\EM",PropSessionExpiryInterval 27254,PropSubscriptionIdentifierAvailable
// 134,PropMaximumPacketSize 4947,PropRequestResponseInformation 129,PropServerReference
// "\152$\STX\215\220\243\246\202@\129_V%\158\176",PropServerReference "\246bNa\175@;\160\187\144o\232
// ",PropServerReference "\246} \172\ETB?\252U\254\a\237Q\226WE\173\162b\163\217\246",PropMaximumPacketSize
// 23596,PropReasonString "]\CAN!\SUB\191~\131}S\202$f\141\155\&0~\189\ENQ^\228\203\206",PropContentType
// "@/\238{\253\142\158t\206&\143\160\&2\225\244\162x\195\r\235\DELx",PropReceiveMaximum 15263,PropCorrelationData
// "\241\234\181\&8\220^\161\239SU",PropAuthenticationData
// "\212\211G%\134\NUL&\185\242\159+\139J\177\177",PropResponseTopic
// "\230\238s\143\164\133-\212\SOV++\249\138",PropServerReference
// "PV\128\209\&0$\172M\231l\153\129\199\184\&84\244\152F\170C\225\179\208\b\137",PropMessageExpiryInterval
// 26834,PropServerKeepAlive 26744,PropRequestResponseInformation 214,PropTopicAlias 21354,PropServerReference
// "\164\244\229\233\151\187k}v\237",PropRetainAvailable 118,PropAuthenticationMethod
// "IX\131\171r\178\196u",PropTopicAliasMaximum 8893,PropCorrelationData "`\146\151\209}\EOT\177\230\236S"]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {
      0x31, 0x92, 0x2,  0x0,  0x1,  0x36, 0x8c, 0x2,  0x8,  0x0,  0x3,  0x6c, 0x87, 0x19, 0x11, 0x0,  0x0,  0x6a, 0x76,
      0x29, 0x86, 0x27, 0x0,  0x0,  0x13, 0x53, 0x19, 0x81, 0x1c, 0x0,  0xf,  0x98, 0x24, 0x2,  0xd7, 0xdc, 0xf3, 0xf6,
      0xca, 0x40, 0x81, 0x5f, 0x56, 0x25, 0x9e, 0xb0, 0x1c, 0x0,  0xd,  0xf6, 0x62, 0x4e, 0x61, 0xaf, 0x40, 0x3b, 0xa0,
      0xbb, 0x90, 0x6f, 0xe8, 0x20, 0x1c, 0x0,  0x15, 0xf6, 0x7d, 0x20, 0xac, 0x17, 0x3f, 0xfc, 0x55, 0xfe, 0x7,  0xed,
      0x51, 0xe2, 0x57, 0x45, 0xad, 0xa2, 0x62, 0xa3, 0xd9, 0xf6, 0x27, 0x0,  0x0,  0x5c, 0x2c, 0x1f, 0x0,  0x16, 0x5d,
      0x18, 0x21, 0x1a, 0xbf, 0x7e, 0x83, 0x7d, 0x53, 0xca, 0x24, 0x66, 0x8d, 0x9b, 0x30, 0x7e, 0xbd, 0x5,  0x5e, 0xe4,
      0xcb, 0xce, 0x3,  0x0,  0x16, 0x40, 0x2f, 0xee, 0x7b, 0xfd, 0x8e, 0x9e, 0x74, 0xce, 0x26, 0x8f, 0xa0, 0x32, 0xe1,
      0xf4, 0xa2, 0x78, 0xc3, 0xd,  0xeb, 0x7f, 0x78, 0x21, 0x3b, 0x9f, 0x9,  0x0,  0xa,  0xf1, 0xea, 0xb5, 0x38, 0xdc,
      0x5e, 0xa1, 0xef, 0x53, 0x55, 0x16, 0x0,  0xf,  0xd4, 0xd3, 0x47, 0x25, 0x86, 0x0,  0x26, 0xb9, 0xf2, 0x9f, 0x2b,
      0x8b, 0x4a, 0xb1, 0xb1, 0x8,  0x0,  0xe,  0xe6, 0xee, 0x73, 0x8f, 0xa4, 0x85, 0x2d, 0xd4, 0xe,  0x56, 0x2b, 0x2b,
      0xf9, 0x8a, 0x1c, 0x0,  0x1a, 0x50, 0x56, 0x80, 0xd1, 0x30, 0x24, 0xac, 0x4d, 0xe7, 0x6c, 0x99, 0x81, 0xc7, 0xb8,
      0x38, 0x34, 0xf4, 0x98, 0x46, 0xaa, 0x43, 0xe1, 0xb3, 0xd0, 0x8,  0x89, 0x2,  0x0,  0x0,  0x68, 0xd2, 0x13, 0x68,
      0x78, 0x19, 0xd6, 0x23, 0x53, 0x6a, 0x1c, 0x0,  0xa,  0xa4, 0xf4, 0xe5, 0xe9, 0x97, 0xbb, 0x6b, 0x7d, 0x76, 0xed,
      0x25, 0x76, 0x15, 0x0,  0x8,  0x49, 0x58, 0x83, 0xab, 0x72, 0xb2, 0xc4, 0x75, 0x22, 0x22, 0xbd, 0x9,  0x0,  0xa,
      0x60, 0x92, 0x97, 0xd1, 0x7d, 0x4,  0xb1, 0xe6, 0xec, 0x53, 0x62};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x36};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x62};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\150\184\EOT\177\237[w\205\DC4E\GS@",
// _pubPktID = 11334, _pubBody = "\247ax\ESCb", _pubProps = []}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x3b, 0x16, 0x0,  0xc,  0x96, 0xb8, 0x4, 0xb1, 0xed, 0x5b, 0x77, 0xcd,
                   0x14, 0x45, 0x1d, 0x40, 0x2c, 0x46, 0x0, 0xf7, 0x61, 0x78, 0x1b, 0x62};
  uint8_t topic_bytes[] = {0x96, 0xb8, 0x4, 0xb1, 0xed, 0x5b, 0x77, 0xcd, 0x14, 0x45, 0x1d, 0x40};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf7, 0x61, 0x78, 0x1b, 0x62};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 11334, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\150\184\EOT\177\237[w\205\DC4E\GS@",
// _pubPktID = 11334, _pubBody = "\247ax\ESCb", _pubProps = []}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x3b, 0x16, 0x0,  0xc,  0x96, 0xb8, 0x4, 0xb1, 0xed, 0x5b, 0x77, 0xcd,
                   0x14, 0x45, 0x1d, 0x40, 0x2c, 0x46, 0x0, 0xf7, 0x61, 0x78, 0x1b, 0x62};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x96, 0xb8, 0x4, 0xb1, 0xed, 0x5b, 0x77, 0xcd, 0x14, 0x45, 0x1d, 0x40};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf7, 0x61, 0x78, 0x1b, 0x62};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 11334);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\tm5\139\DC1\DC18\255>\b\a\EM\145\213XbT\218|", _pubPktID = 0, _pubBody = "\DC4\GS+\EM\ESC\132B\172\232|\215",
// _pubProps = [PropTopicAliasMaximum 14496,PropServerReference
// "\176\251s\234\234\&2\201O&\DLE",PropSharedSubscriptionAvailable 24,PropUserProperty
// "\249Z\DC3\EOT\145\166\&4\182U\162t}\DC2\139\128]1\211@L\DC22&M\157\&7"
// "\254\223\&7\220BMq\175Un",PropMaximumPacketSize 6785,PropServerKeepAlive 10085,PropPayloadFormatIndicator
// 74,PropAuthenticationData "\213\150\137\148W\231\160",PropTopicAliasMaximum 7081,PropContentType
// "\155A\166\188\NAK,\180\206\154\226j\f!\160",PropWillDelayInterval 17165,PropMaximumPacketSize
// 15345,PropAuthenticationData
// "\206@\151\167<u\153\SUB\214A\130<\252\227\&6\151{\177\142\SUB\163\f\DC2",PropContentType
// "QQS\154\178\247\174cO\201\245+\199y\163DX\210a{\243",PropMaximumQoS 89,PropAuthenticationMethod "Ha
// \210\FS\159\164_]\n\235fB\v#kb\132\212\ENQ\199\&5",PropMessageExpiryInterval 14214]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x31, 0xe1, 0x1,  0x0,  0x13, 0x9,  0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff, 0x3e, 0x8,  0x7,  0x19, 0x91, 0xd5,
      0x58, 0x62, 0x54, 0xda, 0x7c, 0xbf, 0x1,  0x22, 0x38, 0xa0, 0x1c, 0x0,  0xa,  0xb0, 0xfb, 0x73, 0xea, 0xea, 0x32,
      0xc9, 0x4f, 0x26, 0x10, 0x2a, 0x18, 0x26, 0x0,  0x1a, 0xf9, 0x5a, 0x13, 0x4,  0x91, 0xa6, 0x34, 0xb6, 0x55, 0xa2,
      0x74, 0x7d, 0x12, 0x8b, 0x80, 0x5d, 0x31, 0xd3, 0x40, 0x4c, 0x12, 0x32, 0x26, 0x4d, 0x9d, 0x37, 0x0,  0xa,  0xfe,
      0xdf, 0x37, 0xdc, 0x42, 0x4d, 0x71, 0xaf, 0x55, 0x6e, 0x27, 0x0,  0x0,  0x1a, 0x81, 0x13, 0x27, 0x65, 0x1,  0x4a,
      0x16, 0x0,  0x7,  0xd5, 0x96, 0x89, 0x94, 0x57, 0xe7, 0xa0, 0x22, 0x1b, 0xa9, 0x3,  0x0,  0xe,  0x9b, 0x41, 0xa6,
      0xbc, 0x15, 0x2c, 0xb4, 0xce, 0x9a, 0xe2, 0x6a, 0xc,  0x21, 0xa0, 0x18, 0x0,  0x0,  0x43, 0xd,  0x27, 0x0,  0x0,
      0x3b, 0xf1, 0x16, 0x0,  0x17, 0xce, 0x40, 0x97, 0xa7, 0x3c, 0x75, 0x99, 0x1a, 0xd6, 0x41, 0x82, 0x3c, 0xfc, 0xe3,
      0x36, 0x97, 0x7b, 0xb1, 0x8e, 0x1a, 0xa3, 0xc,  0x12, 0x3,  0x0,  0x15, 0x51, 0x51, 0x53, 0x9a, 0xb2, 0xf7, 0xae,
      0x63, 0x4f, 0xc9, 0xf5, 0x2b, 0xc7, 0x79, 0xa3, 0x44, 0x58, 0xd2, 0x61, 0x7b, 0xf3, 0x24, 0x59, 0x15, 0x0,  0x16,
      0x48, 0x61, 0x20, 0xd2, 0x1c, 0x9f, 0xa4, 0x5f, 0x5d, 0xa,  0xeb, 0x66, 0x42, 0xb,  0x23, 0x6b, 0x62, 0x84, 0xd4,
      0x5,  0xc7, 0x35, 0x2,  0x0,  0x0,  0x37, 0x86, 0x14, 0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  uint8_t topic_bytes[] = {0x9, 0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff, 0x3e, 0x8,
                           0x7, 0x19, 0x91, 0xd5, 0x58, 0x62, 0x54, 0xda, 0x7c};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x14, 0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0xb0, 0xfb, 0x73, 0xea, 0xea, 0x32, 0xc9, 0x4f, 0x26, 0x10};
  uint8_t bytesprops2[] = {0xfe, 0xdf, 0x37, 0xdc, 0x42, 0x4d, 0x71, 0xaf, 0x55, 0x6e};
  uint8_t bytesprops1[] = {0xf9, 0x5a, 0x13, 0x4,  0x91, 0xa6, 0x34, 0xb6, 0x55, 0xa2, 0x74, 0x7d, 0x12,
                           0x8b, 0x80, 0x5d, 0x31, 0xd3, 0x40, 0x4c, 0x12, 0x32, 0x26, 0x4d, 0x9d, 0x37};
  uint8_t bytesprops3[] = {0xd5, 0x96, 0x89, 0x94, 0x57, 0xe7, 0xa0};
  uint8_t bytesprops4[] = {0x9b, 0x41, 0xa6, 0xbc, 0x15, 0x2c, 0xb4, 0xce, 0x9a, 0xe2, 0x6a, 0xc, 0x21, 0xa0};
  uint8_t bytesprops5[] = {0xce, 0x40, 0x97, 0xa7, 0x3c, 0x75, 0x99, 0x1a, 0xd6, 0x41, 0x82, 0x3c,
                           0xfc, 0xe3, 0x36, 0x97, 0x7b, 0xb1, 0x8e, 0x1a, 0xa3, 0xc,  0x12};
  uint8_t bytesprops6[] = {0x51, 0x51, 0x53, 0x9a, 0xb2, 0xf7, 0xae, 0x63, 0x4f, 0xc9, 0xf5,
                           0x2b, 0xc7, 0x79, 0xa3, 0x44, 0x58, 0xd2, 0x61, 0x7b, 0xf3};
  uint8_t bytesprops7[] = {0x48, 0x61, 0x20, 0xd2, 0x1c, 0x9f, 0xa4, 0x5f, 0x5d, 0xa,  0xeb,
                           0x66, 0x42, 0xb,  0x23, 0x6b, 0x62, 0x84, 0xd4, 0x5,  0xc7, 0x35};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14496}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops1}, .v = {10, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6785}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10085}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7081}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17165}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15345}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14214}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\tm5\139\DC1\DC18\255>\b\a\EM\145\213XbT\218|", _pubPktID = 0, _pubBody = "\DC4\GS+\EM\ESC\132B\172\232|\215",
// _pubProps = [PropTopicAliasMaximum 14496,PropServerReference
// "\176\251s\234\234\&2\201O&\DLE",PropSharedSubscriptionAvailable 24,PropUserProperty
// "\249Z\DC3\EOT\145\166\&4\182U\162t}\DC2\139\128]1\211@L\DC22&M\157\&7"
// "\254\223\&7\220BMq\175Un",PropMaximumPacketSize 6785,PropServerKeepAlive 10085,PropPayloadFormatIndicator
// 74,PropAuthenticationData "\213\150\137\148W\231\160",PropTopicAliasMaximum 7081,PropContentType
// "\155A\166\188\NAK,\180\206\154\226j\f!\160",PropWillDelayInterval 17165,PropMaximumPacketSize
// 15345,PropAuthenticationData
// "\206@\151\167<u\153\SUB\214A\130<\252\227\&6\151{\177\142\SUB\163\f\DC2",PropContentType
// "QQS\154\178\247\174cO\201\245+\199y\163DX\210a{\243",PropMaximumQoS 89,PropAuthenticationMethod "Ha
// \210\FS\159\164_]\n\235fB\v#kb\132\212\ENQ\199\&5",PropMessageExpiryInterval 14214]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {
      0x31, 0xe1, 0x1,  0x0,  0x13, 0x9,  0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff, 0x3e, 0x8,  0x7,  0x19, 0x91, 0xd5,
      0x58, 0x62, 0x54, 0xda, 0x7c, 0xbf, 0x1,  0x22, 0x38, 0xa0, 0x1c, 0x0,  0xa,  0xb0, 0xfb, 0x73, 0xea, 0xea, 0x32,
      0xc9, 0x4f, 0x26, 0x10, 0x2a, 0x18, 0x26, 0x0,  0x1a, 0xf9, 0x5a, 0x13, 0x4,  0x91, 0xa6, 0x34, 0xb6, 0x55, 0xa2,
      0x74, 0x7d, 0x12, 0x8b, 0x80, 0x5d, 0x31, 0xd3, 0x40, 0x4c, 0x12, 0x32, 0x26, 0x4d, 0x9d, 0x37, 0x0,  0xa,  0xfe,
      0xdf, 0x37, 0xdc, 0x42, 0x4d, 0x71, 0xaf, 0x55, 0x6e, 0x27, 0x0,  0x0,  0x1a, 0x81, 0x13, 0x27, 0x65, 0x1,  0x4a,
      0x16, 0x0,  0x7,  0xd5, 0x96, 0x89, 0x94, 0x57, 0xe7, 0xa0, 0x22, 0x1b, 0xa9, 0x3,  0x0,  0xe,  0x9b, 0x41, 0xa6,
      0xbc, 0x15, 0x2c, 0xb4, 0xce, 0x9a, 0xe2, 0x6a, 0xc,  0x21, 0xa0, 0x18, 0x0,  0x0,  0x43, 0xd,  0x27, 0x0,  0x0,
      0x3b, 0xf1, 0x16, 0x0,  0x17, 0xce, 0x40, 0x97, 0xa7, 0x3c, 0x75, 0x99, 0x1a, 0xd6, 0x41, 0x82, 0x3c, 0xfc, 0xe3,
      0x36, 0x97, 0x7b, 0xb1, 0x8e, 0x1a, 0xa3, 0xc,  0x12, 0x3,  0x0,  0x15, 0x51, 0x51, 0x53, 0x9a, 0xb2, 0xf7, 0xae,
      0x63, 0x4f, 0xc9, 0xf5, 0x2b, 0xc7, 0x79, 0xa3, 0x44, 0x58, 0xd2, 0x61, 0x7b, 0xf3, 0x24, 0x59, 0x15, 0x0,  0x16,
      0x48, 0x61, 0x20, 0xd2, 0x1c, 0x9f, 0xa4, 0x5f, 0x5d, 0xa,  0xeb, 0x66, 0x42, 0xb,  0x23, 0x6b, 0x62, 0x84, 0xd4,
      0x5,  0xc7, 0x35, 0x2,  0x0,  0x0,  0x37, 0x86, 0x14, 0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9, 0x6d, 0x35, 0x8b, 0x11, 0x11, 0x38, 0xff, 0x3e, 0x8,
                               0x7, 0x19, 0x91, 0xd5, 0x58, 0x62, 0x54, 0xda, 0x7c};
  lwmqtt_string_t exp_topic = {19, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x14, 0x1d, 0x2b, 0x19, 0x1b, 0x84, 0x42, 0xac, 0xe8, 0x7c, 0xd7};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 19);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\211Q\204\149\142\&8\217\174\213\221\133\214\221\166\207E\151\t\221y\192>\ETBqK[", _pubPktID = 0, _pubBody =
// "\189\221\169\130\f\211\DC1\DC2\252", _pubProps = [PropWildcardSubscriptionAvailable 130,PropRetainAvailable
// 210,PropPayloadFormatIndicator 124,PropReasonString "\SIO\248m?>tR\149\216l\CANUVY\236",PropMessageExpiryInterval
// 13933,PropRequestResponseInformation 138,PropSharedSubscriptionAvailable 224,PropWildcardSubscriptionAvailable 148]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {0x30, 0x4a, 0x0,  0x1a, 0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5, 0xdd, 0x85, 0xd6,
                   0xdd, 0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e, 0x17, 0x71, 0x4b, 0x5b, 0x24, 0x28,
                   0x82, 0x25, 0xd2, 0x1,  0x7c, 0x1f, 0x0,  0x10, 0xf,  0x4f, 0xf8, 0x6d, 0x3f, 0x3e, 0x74, 0x52,
                   0x95, 0xd8, 0x6c, 0x18, 0x55, 0x56, 0x59, 0xec, 0x2,  0x0,  0x0,  0x36, 0x6d, 0x19, 0x8a, 0x2a,
                   0xe0, 0x28, 0x94, 0xbd, 0xdd, 0xa9, 0x82, 0xc,  0xd3, 0x11, 0x12, 0xfc};
  uint8_t topic_bytes[] = {0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5, 0xdd, 0x85, 0xd6, 0xdd,
                           0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e, 0x17, 0x71, 0x4b, 0x5b};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbd, 0xdd, 0xa9, 0x82, 0xc, 0xd3, 0x11, 0x12, 0xfc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0xf,  0x4f, 0xf8, 0x6d, 0x3f, 0x3e, 0x74, 0x52,
                           0x95, 0xd8, 0x6c, 0x18, 0x55, 0x56, 0x59, 0xec};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13933}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 148}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\211Q\204\149\142\&8\217\174\213\221\133\214\221\166\207E\151\t\221y\192>\ETBqK[", _pubPktID = 0, _pubBody =
// "\189\221\169\130\f\211\DC1\DC2\252", _pubProps = [PropWildcardSubscriptionAvailable 130,PropRetainAvailable
// 210,PropPayloadFormatIndicator 124,PropReasonString "\SIO\248m?>tR\149\216l\CANUVY\236",PropMessageExpiryInterval
// 13933,PropRequestResponseInformation 138,PropSharedSubscriptionAvailable 224,PropWildcardSubscriptionAvailable 148]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {0x30, 0x4a, 0x0,  0x1a, 0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5, 0xdd, 0x85, 0xd6,
                   0xdd, 0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e, 0x17, 0x71, 0x4b, 0x5b, 0x24, 0x28,
                   0x82, 0x25, 0xd2, 0x1,  0x7c, 0x1f, 0x0,  0x10, 0xf,  0x4f, 0xf8, 0x6d, 0x3f, 0x3e, 0x74, 0x52,
                   0x95, 0xd8, 0x6c, 0x18, 0x55, 0x56, 0x59, 0xec, 0x2,  0x0,  0x0,  0x36, 0x6d, 0x19, 0x8a, 0x2a,
                   0xe0, 0x28, 0x94, 0xbd, 0xdd, 0xa9, 0x82, 0xc,  0xd3, 0x11, 0x12, 0xfc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd3, 0x51, 0xcc, 0x95, 0x8e, 0x38, 0xd9, 0xae, 0xd5, 0xdd, 0x85, 0xd6, 0xdd,
                               0xa6, 0xcf, 0x45, 0x97, 0x9,  0xdd, 0x79, 0xc0, 0x3e, 0x17, 0x71, 0x4b, 0x5b};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbd, 0xdd, 0xa9, 0x82, 0xc, 0xd3, 0x11, 0x12, 0xfc};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "p\211K\218>w\SOHst%h%\249P\an\SYNF\157q=]", _pubPktID = 0, _pubBody = "\135 \184\208\200\r\GSu\205<Z\162", _pubProps
// = [PropWildcardSubscriptionAvailable 132,PropAssignedClientIdentifier "|mP5K})",PropTopicAlias
// 5697,PropWillDelayInterval 21344,PropTopicAliasMaximum 19736,PropReasonString
// "\158\238\205\204#\255\ETB\198\140\&9Y\201\201-$\235\168\178n\155\SO@\152\200\189\228a\232\246\231",PropRequestProblemInformation
// 157,PropCorrelationData ":\128\243V\179\178\FS\134\180b(\237\241",PropMessageExpiryInterval
// 6729,PropSubscriptionIdentifierAvailable 92,PropReasonString
// "\234\130]\247s\142`\132\r\ETX@\183_\145\140\170\234\176m/\211\215\175\255\&6\ACKw\204M",PropRetainAvailable
// 8,PropAssignedClientIdentifier "\207",PropCorrelationData
// "B\250+w\DC4Q\NAK\225o\182\200\195e\142\153\147\223\\L%\226OB\133"]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x38, 0xb8, 0x1,  0x0,  0x16, 0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74, 0x25, 0x68, 0x25, 0xf9, 0x50,
      0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d, 0x92, 0x1,  0x28, 0x84, 0x12, 0x0,  0x7,  0x7c, 0x6d, 0x50, 0x35,
      0x4b, 0x7d, 0x29, 0x23, 0x16, 0x41, 0x18, 0x0,  0x0,  0x53, 0x60, 0x22, 0x4d, 0x18, 0x1f, 0x0,  0x1e, 0x9e, 0xee,
      0xcd, 0xcc, 0x23, 0xff, 0x17, 0xc6, 0x8c, 0x39, 0x59, 0xc9, 0xc9, 0x2d, 0x24, 0xeb, 0xa8, 0xb2, 0x6e, 0x9b, 0xe,
      0x40, 0x98, 0xc8, 0xbd, 0xe4, 0x61, 0xe8, 0xf6, 0xe7, 0x17, 0x9d, 0x9,  0x0,  0xd,  0x3a, 0x80, 0xf3, 0x56, 0xb3,
      0xb2, 0x1c, 0x86, 0xb4, 0x62, 0x28, 0xed, 0xf1, 0x2,  0x0,  0x0,  0x1a, 0x49, 0x29, 0x5c, 0x1f, 0x0,  0x1d, 0xea,
      0x82, 0x5d, 0xf7, 0x73, 0x8e, 0x60, 0x84, 0xd,  0x3,  0x40, 0xb7, 0x5f, 0x91, 0x8c, 0xaa, 0xea, 0xb0, 0x6d, 0x2f,
      0xd3, 0xd7, 0xaf, 0xff, 0x36, 0x6,  0x77, 0xcc, 0x4d, 0x25, 0x8,  0x12, 0x0,  0x1,  0xcf, 0x9,  0x0,  0x18, 0x42,
      0xfa, 0x2b, 0x77, 0x14, 0x51, 0x15, 0xe1, 0x6f, 0xb6, 0xc8, 0xc3, 0x65, 0x8e, 0x99, 0x93, 0xdf, 0x5c, 0x4c, 0x25,
      0xe2, 0x4f, 0x42, 0x85, 0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd,  0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  uint8_t topic_bytes[] = {0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74, 0x25, 0x68,
                           0x25, 0xf9, 0x50, 0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd, 0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x7c, 0x6d, 0x50, 0x35, 0x4b, 0x7d, 0x29};
  uint8_t bytesprops1[] = {0x9e, 0xee, 0xcd, 0xcc, 0x23, 0xff, 0x17, 0xc6, 0x8c, 0x39, 0x59, 0xc9, 0xc9, 0x2d, 0x24,
                           0xeb, 0xa8, 0xb2, 0x6e, 0x9b, 0xe,  0x40, 0x98, 0xc8, 0xbd, 0xe4, 0x61, 0xe8, 0xf6, 0xe7};
  uint8_t bytesprops2[] = {0x3a, 0x80, 0xf3, 0x56, 0xb3, 0xb2, 0x1c, 0x86, 0xb4, 0x62, 0x28, 0xed, 0xf1};
  uint8_t bytesprops3[] = {0xea, 0x82, 0x5d, 0xf7, 0x73, 0x8e, 0x60, 0x84, 0xd,  0x3,  0x40, 0xb7, 0x5f, 0x91, 0x8c,
                           0xaa, 0xea, 0xb0, 0x6d, 0x2f, 0xd3, 0xd7, 0xaf, 0xff, 0x36, 0x6,  0x77, 0xcc, 0x4d};
  uint8_t bytesprops4[] = {0xcf};
  uint8_t bytesprops5[] = {0x42, 0xfa, 0x2b, 0x77, 0x14, 0x51, 0x15, 0xe1, 0x6f, 0xb6, 0xc8, 0xc3,
                           0x65, 0x8e, 0x99, 0x93, 0xdf, 0x5c, 0x4c, 0x25, 0xe2, 0x4f, 0x42, 0x85};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5697}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21344}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19736}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6729}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "p\211K\218>w\SOHst%h%\249P\an\SYNF\157q=]", _pubPktID = 0, _pubBody = "\135 \184\208\200\r\GSu\205<Z\162", _pubProps
// = [PropWildcardSubscriptionAvailable 132,PropAssignedClientIdentifier "|mP5K})",PropTopicAlias
// 5697,PropWillDelayInterval 21344,PropTopicAliasMaximum 19736,PropReasonString
// "\158\238\205\204#\255\ETB\198\140\&9Y\201\201-$\235\168\178n\155\SO@\152\200\189\228a\232\246\231",PropRequestProblemInformation
// 157,PropCorrelationData ":\128\243V\179\178\FS\134\180b(\237\241",PropMessageExpiryInterval
// 6729,PropSubscriptionIdentifierAvailable 92,PropReasonString
// "\234\130]\247s\142`\132\r\ETX@\183_\145\140\170\234\176m/\211\215\175\255\&6\ACKw\204M",PropRetainAvailable
// 8,PropAssignedClientIdentifier "\207",PropCorrelationData
// "B\250+w\DC4Q\NAK\225o\182\200\195e\142\153\147\223\\L%\226OB\133"]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {
      0x38, 0xb8, 0x1,  0x0,  0x16, 0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74, 0x25, 0x68, 0x25, 0xf9, 0x50,
      0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d, 0x92, 0x1,  0x28, 0x84, 0x12, 0x0,  0x7,  0x7c, 0x6d, 0x50, 0x35,
      0x4b, 0x7d, 0x29, 0x23, 0x16, 0x41, 0x18, 0x0,  0x0,  0x53, 0x60, 0x22, 0x4d, 0x18, 0x1f, 0x0,  0x1e, 0x9e, 0xee,
      0xcd, 0xcc, 0x23, 0xff, 0x17, 0xc6, 0x8c, 0x39, 0x59, 0xc9, 0xc9, 0x2d, 0x24, 0xeb, 0xa8, 0xb2, 0x6e, 0x9b, 0xe,
      0x40, 0x98, 0xc8, 0xbd, 0xe4, 0x61, 0xe8, 0xf6, 0xe7, 0x17, 0x9d, 0x9,  0x0,  0xd,  0x3a, 0x80, 0xf3, 0x56, 0xb3,
      0xb2, 0x1c, 0x86, 0xb4, 0x62, 0x28, 0xed, 0xf1, 0x2,  0x0,  0x0,  0x1a, 0x49, 0x29, 0x5c, 0x1f, 0x0,  0x1d, 0xea,
      0x82, 0x5d, 0xf7, 0x73, 0x8e, 0x60, 0x84, 0xd,  0x3,  0x40, 0xb7, 0x5f, 0x91, 0x8c, 0xaa, 0xea, 0xb0, 0x6d, 0x2f,
      0xd3, 0xd7, 0xaf, 0xff, 0x36, 0x6,  0x77, 0xcc, 0x4d, 0x25, 0x8,  0x12, 0x0,  0x1,  0xcf, 0x9,  0x0,  0x18, 0x42,
      0xfa, 0x2b, 0x77, 0x14, 0x51, 0x15, 0xe1, 0x6f, 0xb6, 0xc8, 0xc3, 0x65, 0x8e, 0x99, 0x93, 0xdf, 0x5c, 0x4c, 0x25,
      0xe2, 0x4f, 0x42, 0x85, 0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd,  0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x70, 0xd3, 0x4b, 0xda, 0x3e, 0x77, 0x1,  0x73, 0x74, 0x25, 0x68,
                               0x25, 0xf9, 0x50, 0x7,  0x6e, 0x16, 0x46, 0x9d, 0x71, 0x3d, 0x5d};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x87, 0x20, 0xb8, 0xd0, 0xc8, 0xd, 0x1d, 0x75, 0xcd, 0x3c, 0x5a, 0xa2};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\249", _pubPktID = 7383, _pubBody =
// "\166\v\241D\ESCtx4\151\196\206=\239 r\RS\159\195\249NT_", _pubProps = [PropPayloadFormatIndicator
// 118,PropWillDelayInterval 17649,PropServerKeepAlive 8042,PropSessionExpiryInterval 18970]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {0x32, 0x2b, 0x0,  0x1,  0xf9, 0x1c, 0xd7, 0xf,  0x1,  0x76, 0x18, 0x0,  0x0,  0x44, 0xf1,
                   0x13, 0x1f, 0x6a, 0x11, 0x0,  0x0,  0x4a, 0x1a, 0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78,
                   0x34, 0x97, 0xc4, 0xce, 0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  uint8_t topic_bytes[] = {0xf9};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78, 0x34, 0x97, 0xc4, 0xce,
                         0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17649}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8042}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18970}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7383, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\249", _pubPktID = 7383, _pubBody =
// "\166\v\241D\ESCtx4\151\196\206=\239 r\RS\159\195\249NT_", _pubProps = [PropPayloadFormatIndicator
// 118,PropWillDelayInterval 17649,PropServerKeepAlive 8042,PropSessionExpiryInterval 18970]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {0x32, 0x2b, 0x0,  0x1,  0xf9, 0x1c, 0xd7, 0xf,  0x1,  0x76, 0x18, 0x0,  0x0,  0x44, 0xf1,
                   0x13, 0x1f, 0x6a, 0x11, 0x0,  0x0,  0x4a, 0x1a, 0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78,
                   0x34, 0x97, 0xc4, 0xce, 0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf9};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa6, 0xb,  0xf1, 0x44, 0x1b, 0x74, 0x78, 0x34, 0x97, 0xc4, 0xce,
                              0x3d, 0xef, 0x20, 0x72, 0x1e, 0x9f, 0xc3, 0xf9, 0x4e, 0x54, 0x5f};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7383);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\156\249\196\168\224\205\FS\219\244\128\231\SYN\252\239j\NAK\164\171G]\133\229\147Q\199(\f\249y", _pubPktID = 11390,
// _pubBody = "s\226]\184\NUL\176A\242\&3\195\ETBC\RSN\254\t\t\\\203\255=\180B\201k\163", _pubProps = [PropResponseTopic
// "\FS,J\229`\170\204\255\133\133G\208(]+j\132\230x\244\CAN\148\143\227\151H",PropMessageExpiryInterval
// 23325,PropUserProperty "\224\150\SUB\154\&6d:y\142\239\232\RS_\181CY\184\150\254\242\226\a\"\132\159#\158Fk"
// "\ESC\180|3&\134",PropAuthenticationMethod "\230\198",PropAuthenticationData
// "\255\246\195f\b,.\176\150\222",PropResponseTopic "\182\CANu\SOH\SO\151\224@N
// \200\220\199\168S\NAKD\NAK'\DC3\fA\243\135\195\147^",PropRetainAvailable 157,PropServerReference
// "V?\225\174\237\154y9\175\195oX\212d\182\214\157\vb\239\157-p\US\155>\ACK\242",PropRequestResponseInformation
// 114,PropSubscriptionIdentifier 23,PropAssignedClientIdentifier
// "\221\200\143\NUL\229\132\232H`2O\213\DC1\SOHL\142\bz\241\138\167A",PropTopicAliasMaximum 14201,PropServerReference
// "c\146\NAK\140cS\135G\172?j\144\244\232\141g\239F\DC4\ETB#\255\r\207\&7\129N\183\143",PropAuthenticationMethod
// "R\141\240\142\180Ky",PropMaximumPacketSize 27523,PropSessionExpiryInterval 9563,PropAssignedClientIdentifier
// "V\229\STX\153\n\153\DC2\204=\DC4\147B\b\153\169\175\191CW"]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x3a, 0xc2, 0x2,  0x0,  0x1d, 0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16, 0xfc, 0xef,
      0x6a, 0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9, 0x79, 0x2c, 0x7e, 0x85, 0x2,
      0x8,  0x0,  0x1a, 0x1c, 0x2c, 0x4a, 0xe5, 0x60, 0xaa, 0xcc, 0xff, 0x85, 0x85, 0x47, 0xd0, 0x28, 0x5d, 0x2b, 0x6a,
      0x84, 0xe6, 0x78, 0xf4, 0x18, 0x94, 0x8f, 0xe3, 0x97, 0x48, 0x2,  0x0,  0x0,  0x5b, 0x1d, 0x26, 0x0,  0x1d, 0xe0,
      0x96, 0x1a, 0x9a, 0x36, 0x64, 0x3a, 0x79, 0x8e, 0xef, 0xe8, 0x1e, 0x5f, 0xb5, 0x43, 0x59, 0xb8, 0x96, 0xfe, 0xf2,
      0xe2, 0x7,  0x22, 0x84, 0x9f, 0x23, 0x9e, 0x46, 0x6b, 0x0,  0x6,  0x1b, 0xb4, 0x7c, 0x33, 0x26, 0x86, 0x15, 0x0,
      0x2,  0xe6, 0xc6, 0x16, 0x0,  0xa,  0xff, 0xf6, 0xc3, 0x66, 0x8,  0x2c, 0x2e, 0xb0, 0x96, 0xde, 0x8,  0x0,  0x1b,
      0xb6, 0x18, 0x75, 0x1,  0xe,  0x97, 0xe0, 0x40, 0x4e, 0x20, 0xc8, 0xdc, 0xc7, 0xa8, 0x53, 0x15, 0x44, 0x15, 0x27,
      0x13, 0xc,  0x41, 0xf3, 0x87, 0xc3, 0x93, 0x5e, 0x25, 0x9d, 0x1c, 0x0,  0x1c, 0x56, 0x3f, 0xe1, 0xae, 0xed, 0x9a,
      0x79, 0x39, 0xaf, 0xc3, 0x6f, 0x58, 0xd4, 0x64, 0xb6, 0xd6, 0x9d, 0xb,  0x62, 0xef, 0x9d, 0x2d, 0x70, 0x1f, 0x9b,
      0x3e, 0x6,  0xf2, 0x19, 0x72, 0xb,  0x17, 0x12, 0x0,  0x16, 0xdd, 0xc8, 0x8f, 0x0,  0xe5, 0x84, 0xe8, 0x48, 0x60,
      0x32, 0x4f, 0xd5, 0x11, 0x1,  0x4c, 0x8e, 0x8,  0x7a, 0xf1, 0x8a, 0xa7, 0x41, 0x22, 0x37, 0x79, 0x1c, 0x0,  0x1d,
      0x63, 0x92, 0x15, 0x8c, 0x63, 0x53, 0x87, 0x47, 0xac, 0x3f, 0x6a, 0x90, 0xf4, 0xe8, 0x8d, 0x67, 0xef, 0x46, 0x14,
      0x17, 0x23, 0xff, 0xd,  0xcf, 0x37, 0x81, 0x4e, 0xb7, 0x8f, 0x15, 0x0,  0x7,  0x52, 0x8d, 0xf0, 0x8e, 0xb4, 0x4b,
      0x79, 0x27, 0x0,  0x0,  0x6b, 0x83, 0x11, 0x0,  0x0,  0x25, 0x5b, 0x12, 0x0,  0x13, 0x56, 0xe5, 0x2,  0x99, 0xa,
      0x99, 0x12, 0xcc, 0x3d, 0x14, 0x93, 0x42, 0x8,  0x99, 0xa9, 0xaf, 0xbf, 0x43, 0x57, 0x73, 0xe2, 0x5d, 0xb8, 0x0,
      0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e, 0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9,
      0x6b, 0xa3};
  uint8_t topic_bytes[] = {0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16, 0xfc, 0xef, 0x6a,
                           0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9, 0x79};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x73, 0xe2, 0x5d, 0xb8, 0x0,  0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e,
                         0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9, 0x6b, 0xa3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0x1c, 0x2c, 0x4a, 0xe5, 0x60, 0xaa, 0xcc, 0xff, 0x85, 0x85, 0x47, 0xd0, 0x28,
                           0x5d, 0x2b, 0x6a, 0x84, 0xe6, 0x78, 0xf4, 0x18, 0x94, 0x8f, 0xe3, 0x97, 0x48};
  uint8_t bytesprops2[] = {0x1b, 0xb4, 0x7c, 0x33, 0x26, 0x86};
  uint8_t bytesprops1[] = {0xe0, 0x96, 0x1a, 0x9a, 0x36, 0x64, 0x3a, 0x79, 0x8e, 0xef, 0xe8, 0x1e, 0x5f, 0xb5, 0x43,
                           0x59, 0xb8, 0x96, 0xfe, 0xf2, 0xe2, 0x7,  0x22, 0x84, 0x9f, 0x23, 0x9e, 0x46, 0x6b};
  uint8_t bytesprops3[] = {0xe6, 0xc6};
  uint8_t bytesprops4[] = {0xff, 0xf6, 0xc3, 0x66, 0x8, 0x2c, 0x2e, 0xb0, 0x96, 0xde};
  uint8_t bytesprops5[] = {0xb6, 0x18, 0x75, 0x1,  0xe,  0x97, 0xe0, 0x40, 0x4e, 0x20, 0xc8, 0xdc, 0xc7, 0xa8,
                           0x53, 0x15, 0x44, 0x15, 0x27, 0x13, 0xc,  0x41, 0xf3, 0x87, 0xc3, 0x93, 0x5e};
  uint8_t bytesprops6[] = {0x56, 0x3f, 0xe1, 0xae, 0xed, 0x9a, 0x79, 0x39, 0xaf, 0xc3, 0x6f, 0x58, 0xd4, 0x64,
                           0xb6, 0xd6, 0x9d, 0xb,  0x62, 0xef, 0x9d, 0x2d, 0x70, 0x1f, 0x9b, 0x3e, 0x6,  0xf2};
  uint8_t bytesprops7[] = {0xdd, 0xc8, 0x8f, 0x0,  0xe5, 0x84, 0xe8, 0x48, 0x60, 0x32, 0x4f,
                           0xd5, 0x11, 0x1,  0x4c, 0x8e, 0x8,  0x7a, 0xf1, 0x8a, 0xa7, 0x41};
  uint8_t bytesprops8[] = {0x63, 0x92, 0x15, 0x8c, 0x63, 0x53, 0x87, 0x47, 0xac, 0x3f, 0x6a, 0x90, 0xf4, 0xe8, 0x8d,
                           0x67, 0xef, 0x46, 0x14, 0x17, 0x23, 0xff, 0xd,  0xcf, 0x37, 0x81, 0x4e, 0xb7, 0x8f};
  uint8_t bytesprops9[] = {0x52, 0x8d, 0xf0, 0x8e, 0xb4, 0x4b, 0x79};
  uint8_t bytesprops10[] = {0x56, 0xe5, 0x2, 0x99, 0xa,  0x99, 0x12, 0xcc, 0x3d, 0x14,
                            0x93, 0x42, 0x8, 0x99, 0xa9, 0xaf, 0xbf, 0x43, 0x57};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23325}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {6, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14201}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27523}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9563}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 11390, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\156\249\196\168\224\205\FS\219\244\128\231\SYN\252\239j\NAK\164\171G]\133\229\147Q\199(\f\249y", _pubPktID = 11390,
// _pubBody = "s\226]\184\NUL\176A\242\&3\195\ETBC\RSN\254\t\t\\\203\255=\180B\201k\163", _pubProps = [PropResponseTopic
// "\FS,J\229`\170\204\255\133\133G\208(]+j\132\230x\244\CAN\148\143\227\151H",PropMessageExpiryInterval
// 23325,PropUserProperty "\224\150\SUB\154\&6d:y\142\239\232\RS_\181CY\184\150\254\242\226\a\"\132\159#\158Fk"
// "\ESC\180|3&\134",PropAuthenticationMethod "\230\198",PropAuthenticationData
// "\255\246\195f\b,.\176\150\222",PropResponseTopic "\182\CANu\SOH\SO\151\224@N
// \200\220\199\168S\NAKD\NAK'\DC3\fA\243\135\195\147^",PropRetainAvailable 157,PropServerReference
// "V?\225\174\237\154y9\175\195oX\212d\182\214\157\vb\239\157-p\US\155>\ACK\242",PropRequestResponseInformation
// 114,PropSubscriptionIdentifier 23,PropAssignedClientIdentifier
// "\221\200\143\NUL\229\132\232H`2O\213\DC1\SOHL\142\bz\241\138\167A",PropTopicAliasMaximum 14201,PropServerReference
// "c\146\NAK\140cS\135G\172?j\144\244\232\141g\239F\DC4\ETB#\255\r\207\&7\129N\183\143",PropAuthenticationMethod
// "R\141\240\142\180Ky",PropMaximumPacketSize 27523,PropSessionExpiryInterval 9563,PropAssignedClientIdentifier
// "V\229\STX\153\n\153\DC2\204=\DC4\147B\b\153\169\175\191CW"]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {
      0x3a, 0xc2, 0x2,  0x0,  0x1d, 0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16, 0xfc, 0xef,
      0x6a, 0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9, 0x79, 0x2c, 0x7e, 0x85, 0x2,
      0x8,  0x0,  0x1a, 0x1c, 0x2c, 0x4a, 0xe5, 0x60, 0xaa, 0xcc, 0xff, 0x85, 0x85, 0x47, 0xd0, 0x28, 0x5d, 0x2b, 0x6a,
      0x84, 0xe6, 0x78, 0xf4, 0x18, 0x94, 0x8f, 0xe3, 0x97, 0x48, 0x2,  0x0,  0x0,  0x5b, 0x1d, 0x26, 0x0,  0x1d, 0xe0,
      0x96, 0x1a, 0x9a, 0x36, 0x64, 0x3a, 0x79, 0x8e, 0xef, 0xe8, 0x1e, 0x5f, 0xb5, 0x43, 0x59, 0xb8, 0x96, 0xfe, 0xf2,
      0xe2, 0x7,  0x22, 0x84, 0x9f, 0x23, 0x9e, 0x46, 0x6b, 0x0,  0x6,  0x1b, 0xb4, 0x7c, 0x33, 0x26, 0x86, 0x15, 0x0,
      0x2,  0xe6, 0xc6, 0x16, 0x0,  0xa,  0xff, 0xf6, 0xc3, 0x66, 0x8,  0x2c, 0x2e, 0xb0, 0x96, 0xde, 0x8,  0x0,  0x1b,
      0xb6, 0x18, 0x75, 0x1,  0xe,  0x97, 0xe0, 0x40, 0x4e, 0x20, 0xc8, 0xdc, 0xc7, 0xa8, 0x53, 0x15, 0x44, 0x15, 0x27,
      0x13, 0xc,  0x41, 0xf3, 0x87, 0xc3, 0x93, 0x5e, 0x25, 0x9d, 0x1c, 0x0,  0x1c, 0x56, 0x3f, 0xe1, 0xae, 0xed, 0x9a,
      0x79, 0x39, 0xaf, 0xc3, 0x6f, 0x58, 0xd4, 0x64, 0xb6, 0xd6, 0x9d, 0xb,  0x62, 0xef, 0x9d, 0x2d, 0x70, 0x1f, 0x9b,
      0x3e, 0x6,  0xf2, 0x19, 0x72, 0xb,  0x17, 0x12, 0x0,  0x16, 0xdd, 0xc8, 0x8f, 0x0,  0xe5, 0x84, 0xe8, 0x48, 0x60,
      0x32, 0x4f, 0xd5, 0x11, 0x1,  0x4c, 0x8e, 0x8,  0x7a, 0xf1, 0x8a, 0xa7, 0x41, 0x22, 0x37, 0x79, 0x1c, 0x0,  0x1d,
      0x63, 0x92, 0x15, 0x8c, 0x63, 0x53, 0x87, 0x47, 0xac, 0x3f, 0x6a, 0x90, 0xf4, 0xe8, 0x8d, 0x67, 0xef, 0x46, 0x14,
      0x17, 0x23, 0xff, 0xd,  0xcf, 0x37, 0x81, 0x4e, 0xb7, 0x8f, 0x15, 0x0,  0x7,  0x52, 0x8d, 0xf0, 0x8e, 0xb4, 0x4b,
      0x79, 0x27, 0x0,  0x0,  0x6b, 0x83, 0x11, 0x0,  0x0,  0x25, 0x5b, 0x12, 0x0,  0x13, 0x56, 0xe5, 0x2,  0x99, 0xa,
      0x99, 0x12, 0xcc, 0x3d, 0x14, 0x93, 0x42, 0x8,  0x99, 0xa9, 0xaf, 0xbf, 0x43, 0x57, 0x73, 0xe2, 0x5d, 0xb8, 0x0,
      0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e, 0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9,
      0x6b, 0xa3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0xf9, 0xc4, 0xa8, 0xe0, 0xcd, 0x1c, 0xdb, 0xf4, 0x80, 0xe7, 0x16, 0xfc, 0xef, 0x6a,
                               0x15, 0xa4, 0xab, 0x47, 0x5d, 0x85, 0xe5, 0x93, 0x51, 0xc7, 0x28, 0xc,  0xf9, 0x79};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x73, 0xe2, 0x5d, 0xb8, 0x0,  0xb0, 0x41, 0xf2, 0x33, 0xc3, 0x17, 0x43, 0x1e,
                              0x4e, 0xfe, 0x9,  0x9,  0x5c, 0xcb, 0xff, 0x3d, 0xb4, 0x42, 0xc9, 0x6b, 0xa3};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11390);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\247\&51\173<\172\250\229U\SOH\214a\211n>\225\&2^", _pubPktID = 0, _pubBody =
// "\r\136\219Jg\197\169\234\190\251\255K\212\139c\186,\229", _pubProps = [PropAuthenticationMethod
// "\160\209\234jK\216\216:)\166\146\205\&8\249\CAN\191E\188\ESC",PropWillDelayInterval 18526,PropMaximumQoS
// 140,PropAssignedClientIdentifier "\GSd\199\233",PropServerReference
// "\249\DC2e^I\139\STX\232\195\NUL\ACK\233Z\214\206\STX\180\191&\t\DC1\249\154\158\\\NUL\EM",PropWillDelayInterval
// 6427,PropServerReference "b\SI_\254",PropRequestProblemInformation 249]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x30, 0x77, 0x0,  0x12, 0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55, 0x1,  0xd6, 0x61,
                   0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e, 0x50, 0x15, 0x0,  0x13, 0xa0, 0xd1, 0xea, 0x6a, 0x4b, 0xd8,
                   0xd8, 0x3a, 0x29, 0xa6, 0x92, 0xcd, 0x38, 0xf9, 0x18, 0xbf, 0x45, 0xbc, 0x1b, 0x18, 0x0,  0x0,
                   0x48, 0x5e, 0x24, 0x8c, 0x12, 0x0,  0x4,  0x1d, 0x64, 0xc7, 0xe9, 0x1c, 0x0,  0x1b, 0xf9, 0x12,
                   0x65, 0x5e, 0x49, 0x8b, 0x2,  0xe8, 0xc3, 0x0,  0x6,  0xe9, 0x5a, 0xd6, 0xce, 0x2,  0xb4, 0xbf,
                   0x26, 0x9,  0x11, 0xf9, 0x9a, 0x9e, 0x5c, 0x0,  0x19, 0x18, 0x0,  0x0,  0x19, 0x1b, 0x1c, 0x0,
                   0x4,  0x62, 0xf,  0x5f, 0xfe, 0x17, 0xf9, 0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5, 0xa9, 0xea, 0xbe,
                   0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  uint8_t topic_bytes[] = {0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55,
                           0x1,  0xd6, 0x61, 0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5, 0xa9, 0xea, 0xbe,
                         0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0xa0, 0xd1, 0xea, 0x6a, 0x4b, 0xd8, 0xd8, 0x3a, 0x29, 0xa6,
                           0x92, 0xcd, 0x38, 0xf9, 0x18, 0xbf, 0x45, 0xbc, 0x1b};
  uint8_t bytesprops1[] = {0x1d, 0x64, 0xc7, 0xe9};
  uint8_t bytesprops2[] = {0xf9, 0x12, 0x65, 0x5e, 0x49, 0x8b, 0x2,  0xe8, 0xc3, 0x0,  0x6,  0xe9, 0x5a, 0xd6,
                           0xce, 0x2,  0xb4, 0xbf, 0x26, 0x9,  0x11, 0xf9, 0x9a, 0x9e, 0x5c, 0x0,  0x19};
  uint8_t bytesprops3[] = {0x62, 0xf, 0x5f, 0xfe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18526}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6427}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 249}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\247\&51\173<\172\250\229U\SOH\214a\211n>\225\&2^", _pubPktID = 0, _pubBody =
// "\r\136\219Jg\197\169\234\190\251\255K\212\139c\186,\229", _pubProps = [PropAuthenticationMethod
// "\160\209\234jK\216\216:)\166\146\205\&8\249\CAN\191E\188\ESC",PropWillDelayInterval 18526,PropMaximumQoS
// 140,PropAssignedClientIdentifier "\GSd\199\233",PropServerReference
// "\249\DC2e^I\139\STX\232\195\NUL\ACK\233Z\214\206\STX\180\191&\t\DC1\249\154\158\\\NUL\EM",PropWillDelayInterval
// 6427,PropServerReference "b\SI_\254",PropRequestProblemInformation 249]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {0x30, 0x77, 0x0,  0x12, 0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55, 0x1,  0xd6, 0x61,
                   0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e, 0x50, 0x15, 0x0,  0x13, 0xa0, 0xd1, 0xea, 0x6a, 0x4b, 0xd8,
                   0xd8, 0x3a, 0x29, 0xa6, 0x92, 0xcd, 0x38, 0xf9, 0x18, 0xbf, 0x45, 0xbc, 0x1b, 0x18, 0x0,  0x0,
                   0x48, 0x5e, 0x24, 0x8c, 0x12, 0x0,  0x4,  0x1d, 0x64, 0xc7, 0xe9, 0x1c, 0x0,  0x1b, 0xf9, 0x12,
                   0x65, 0x5e, 0x49, 0x8b, 0x2,  0xe8, 0xc3, 0x0,  0x6,  0xe9, 0x5a, 0xd6, 0xce, 0x2,  0xb4, 0xbf,
                   0x26, 0x9,  0x11, 0xf9, 0x9a, 0x9e, 0x5c, 0x0,  0x19, 0x18, 0x0,  0x0,  0x19, 0x1b, 0x1c, 0x0,
                   0x4,  0x62, 0xf,  0x5f, 0xfe, 0x17, 0xf9, 0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5, 0xa9, 0xea, 0xbe,
                   0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf7, 0x35, 0x31, 0xad, 0x3c, 0xac, 0xfa, 0xe5, 0x55,
                               0x1,  0xd6, 0x61, 0xd3, 0x6e, 0x3e, 0xe1, 0x32, 0x5e};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd,  0x88, 0xdb, 0x4a, 0x67, 0xc5, 0xa9, 0xea, 0xbe,
                              0xfb, 0xff, 0x4b, 0xd4, 0x8b, 0x63, 0xba, 0x2c, 0xe5};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\DC3
// \244\212\ETX\143\186\222G-\212", _pubPktID = 0, _pubBody = "cndv<\250\182\170?\140\SYN\204\158n'\161tLKL\DC4\131",
// _pubProps = [PropPayloadFormatIndicator 90,PropMessageExpiryInterval 11159,PropSessionExpiryInterval
// 2113,PropAuthenticationMethod "\128\249OaH;\232",PropTopicAliasMaximum 15946,PropAuthenticationData
// "\168\187\142\SO\157\223\&5\t\242g\246\141\t\FS\237\217\EM\DLE\203L\134\175\189<(#\DC2",PropMessageExpiryInterval
// 27559,PropWildcardSubscriptionAvailable 13,PropSubscriptionIdentifierAvailable 37,PropResponseTopic
// "\147\215\NAK\\\NUL\181\ETBQ\254\200\135\US\250\229\EOTI\149<G\236h4\217\\\t\223;\237\226",PropAssignedClientIdentifier
// "\b\215\206\206",PropReceiveMaximum 26589,PropSubscriptionIdentifier 15,PropServerKeepAlive
// 4355,PropWillDelayInterval 12530,PropAuthenticationData "\146\SOH\SI\151\231\186\135",PropServerReference
// "\ESC$-\145\253\217\CAN\234\225\r\t\SOHI\244$5\243",PropServerReference
// "c\212\241\168x<\207\203\148\195-\129\230\200\GS\215|_j\223X\242__&",PropRequestProblemInformation
// 120,PropCorrelationData "\v+",PropMessageExpiryInterval 18239]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x30, 0xdf, 0x1,  0x0,  0xb,  0x13, 0x20, 0xf4, 0xd4, 0x3,  0x8f, 0xba, 0xde, 0x47, 0x2d, 0xd4, 0xba, 0x1,  0x1,
      0x5a, 0x2,  0x0,  0x0,  0x2b, 0x97, 0x11, 0x0,  0x0,  0x8,  0x41, 0x15, 0x0,  0x7,  0x80, 0xf9, 0x4f, 0x61, 0x48,
      0x3b, 0xe8, 0x22, 0x3e, 0x4a, 0x16, 0x0,  0x1b, 0xa8, 0xbb, 0x8e, 0xe,  0x9d, 0xdf, 0x35, 0x9,  0xf2, 0x67, 0xf6,
      0x8d, 0x9,  0x1c, 0xed, 0xd9, 0x19, 0x10, 0xcb, 0x4c, 0x86, 0xaf, 0xbd, 0x3c, 0x28, 0x23, 0x12, 0x2,  0x0,  0x0,
      0x6b, 0xa7, 0x28, 0xd,  0x29, 0x25, 0x8,  0x0,  0x1d, 0x93, 0xd7, 0x15, 0x5c, 0x0,  0xb5, 0x17, 0x51, 0xfe, 0xc8,
      0x87, 0x1f, 0xfa, 0xe5, 0x4,  0x49, 0x95, 0x3c, 0x47, 0xec, 0x68, 0x34, 0xd9, 0x5c, 0x9,  0xdf, 0x3b, 0xed, 0xe2,
      0x12, 0x0,  0x4,  0x8,  0xd7, 0xce, 0xce, 0x21, 0x67, 0xdd, 0xb,  0xf,  0x13, 0x11, 0x3,  0x18, 0x0,  0x0,  0x30,
      0xf2, 0x16, 0x0,  0x7,  0x92, 0x1,  0xf,  0x97, 0xe7, 0xba, 0x87, 0x1c, 0x0,  0x11, 0x1b, 0x24, 0x2d, 0x91, 0xfd,
      0xd9, 0x18, 0xea, 0xe1, 0xd,  0x9,  0x1,  0x49, 0xf4, 0x24, 0x35, 0xf3, 0x1c, 0x0,  0x19, 0x63, 0xd4, 0xf1, 0xa8,
      0x78, 0x3c, 0xcf, 0xcb, 0x94, 0xc3, 0x2d, 0x81, 0xe6, 0xc8, 0x1d, 0xd7, 0x7c, 0x5f, 0x6a, 0xdf, 0x58, 0xf2, 0x5f,
      0x5f, 0x26, 0x17, 0x78, 0x9,  0x0,  0x2,  0xb,  0x2b, 0x2,  0x0,  0x0,  0x47, 0x3f, 0x63, 0x6e, 0x64, 0x76, 0x3c,
      0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16, 0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  uint8_t topic_bytes[] = {0x13, 0x20, 0xf4, 0xd4, 0x3, 0x8f, 0xba, 0xde, 0x47, 0x2d, 0xd4};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x63, 0x6e, 0x64, 0x76, 0x3c, 0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16,
                         0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0x80, 0xf9, 0x4f, 0x61, 0x48, 0x3b, 0xe8};
  uint8_t bytesprops1[] = {0xa8, 0xbb, 0x8e, 0xe,  0x9d, 0xdf, 0x35, 0x9,  0xf2, 0x67, 0xf6, 0x8d, 0x9, 0x1c,
                           0xed, 0xd9, 0x19, 0x10, 0xcb, 0x4c, 0x86, 0xaf, 0xbd, 0x3c, 0x28, 0x23, 0x12};
  uint8_t bytesprops2[] = {0x93, 0xd7, 0x15, 0x5c, 0x0,  0xb5, 0x17, 0x51, 0xfe, 0xc8, 0x87, 0x1f, 0xfa, 0xe5, 0x4,
                           0x49, 0x95, 0x3c, 0x47, 0xec, 0x68, 0x34, 0xd9, 0x5c, 0x9,  0xdf, 0x3b, 0xed, 0xe2};
  uint8_t bytesprops3[] = {0x8, 0xd7, 0xce, 0xce};
  uint8_t bytesprops4[] = {0x92, 0x1, 0xf, 0x97, 0xe7, 0xba, 0x87};
  uint8_t bytesprops5[] = {0x1b, 0x24, 0x2d, 0x91, 0xfd, 0xd9, 0x18, 0xea, 0xe1,
                           0xd,  0x9,  0x1,  0x49, 0xf4, 0x24, 0x35, 0xf3};
  uint8_t bytesprops6[] = {0x63, 0xd4, 0xf1, 0xa8, 0x78, 0x3c, 0xcf, 0xcb, 0x94, 0xc3, 0x2d, 0x81, 0xe6,
                           0xc8, 0x1d, 0xd7, 0x7c, 0x5f, 0x6a, 0xdf, 0x58, 0xf2, 0x5f, 0x5f, 0x26};
  uint8_t bytesprops7[] = {0xb, 0x2b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11159}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2113}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15946}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27559}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26589}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4355}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12530}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18239}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\DC3
// \244\212\ETX\143\186\222G-\212", _pubPktID = 0, _pubBody = "cndv<\250\182\170?\140\SYN\204\158n'\161tLKL\DC4\131",
// _pubProps = [PropPayloadFormatIndicator 90,PropMessageExpiryInterval 11159,PropSessionExpiryInterval
// 2113,PropAuthenticationMethod "\128\249OaH;\232",PropTopicAliasMaximum 15946,PropAuthenticationData
// "\168\187\142\SO\157\223\&5\t\242g\246\141\t\FS\237\217\EM\DLE\203L\134\175\189<(#\DC2",PropMessageExpiryInterval
// 27559,PropWildcardSubscriptionAvailable 13,PropSubscriptionIdentifierAvailable 37,PropResponseTopic
// "\147\215\NAK\\\NUL\181\ETBQ\254\200\135\US\250\229\EOTI\149<G\236h4\217\\\t\223;\237\226",PropAssignedClientIdentifier
// "\b\215\206\206",PropReceiveMaximum 26589,PropSubscriptionIdentifier 15,PropServerKeepAlive
// 4355,PropWillDelayInterval 12530,PropAuthenticationData "\146\SOH\SI\151\231\186\135",PropServerReference
// "\ESC$-\145\253\217\CAN\234\225\r\t\SOHI\244$5\243",PropServerReference
// "c\212\241\168x<\207\203\148\195-\129\230\200\GS\215|_j\223X\242__&",PropRequestProblemInformation
// 120,PropCorrelationData "\v+",PropMessageExpiryInterval 18239]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {
      0x30, 0xdf, 0x1,  0x0,  0xb,  0x13, 0x20, 0xf4, 0xd4, 0x3,  0x8f, 0xba, 0xde, 0x47, 0x2d, 0xd4, 0xba, 0x1,  0x1,
      0x5a, 0x2,  0x0,  0x0,  0x2b, 0x97, 0x11, 0x0,  0x0,  0x8,  0x41, 0x15, 0x0,  0x7,  0x80, 0xf9, 0x4f, 0x61, 0x48,
      0x3b, 0xe8, 0x22, 0x3e, 0x4a, 0x16, 0x0,  0x1b, 0xa8, 0xbb, 0x8e, 0xe,  0x9d, 0xdf, 0x35, 0x9,  0xf2, 0x67, 0xf6,
      0x8d, 0x9,  0x1c, 0xed, 0xd9, 0x19, 0x10, 0xcb, 0x4c, 0x86, 0xaf, 0xbd, 0x3c, 0x28, 0x23, 0x12, 0x2,  0x0,  0x0,
      0x6b, 0xa7, 0x28, 0xd,  0x29, 0x25, 0x8,  0x0,  0x1d, 0x93, 0xd7, 0x15, 0x5c, 0x0,  0xb5, 0x17, 0x51, 0xfe, 0xc8,
      0x87, 0x1f, 0xfa, 0xe5, 0x4,  0x49, 0x95, 0x3c, 0x47, 0xec, 0x68, 0x34, 0xd9, 0x5c, 0x9,  0xdf, 0x3b, 0xed, 0xe2,
      0x12, 0x0,  0x4,  0x8,  0xd7, 0xce, 0xce, 0x21, 0x67, 0xdd, 0xb,  0xf,  0x13, 0x11, 0x3,  0x18, 0x0,  0x0,  0x30,
      0xf2, 0x16, 0x0,  0x7,  0x92, 0x1,  0xf,  0x97, 0xe7, 0xba, 0x87, 0x1c, 0x0,  0x11, 0x1b, 0x24, 0x2d, 0x91, 0xfd,
      0xd9, 0x18, 0xea, 0xe1, 0xd,  0x9,  0x1,  0x49, 0xf4, 0x24, 0x35, 0xf3, 0x1c, 0x0,  0x19, 0x63, 0xd4, 0xf1, 0xa8,
      0x78, 0x3c, 0xcf, 0xcb, 0x94, 0xc3, 0x2d, 0x81, 0xe6, 0xc8, 0x1d, 0xd7, 0x7c, 0x5f, 0x6a, 0xdf, 0x58, 0xf2, 0x5f,
      0x5f, 0x26, 0x17, 0x78, 0x9,  0x0,  0x2,  0xb,  0x2b, 0x2,  0x0,  0x0,  0x47, 0x3f, 0x63, 0x6e, 0x64, 0x76, 0x3c,
      0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16, 0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x13, 0x20, 0xf4, 0xd4, 0x3, 0x8f, 0xba, 0xde, 0x47, 0x2d, 0xd4};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x63, 0x6e, 0x64, 0x76, 0x3c, 0xfa, 0xb6, 0xaa, 0x3f, 0x8c, 0x16,
                              0xcc, 0x9e, 0x6e, 0x27, 0xa1, 0x74, 0x4c, 0x4b, 0x4c, 0x14, 0x83};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "o#L\177\210\EOT\140\230w\252ir\220-\217\230\154\182\a0(\169\225\232uo", _pubPktID = 0, _pubBody =
// "2\137\n\NUL\201\149\252e\191]\CAN#`\250", _pubProps = [PropSubscriptionIdentifierAvailable
// 236,PropAssignedClientIdentifier "\152\SOHt\252\165",PropTopicAliasMaximum 13490,PropWillDelayInterval
// 22209,PropPayloadFormatIndicator 60,PropTopicAlias 16841,PropRetainAvailable 107,PropResponseTopic
// "ah\ETB\139iQ\b\n\164\233Q\132g\GSU\160\212\b\191K\211\157\200\165",PropMessageExpiryInterval
// 1549,PropAuthenticationMethod "\229\224\206\vA\237\182\FS![1=U\218,V>\ETX\210p3",PropSharedSubscriptionAvailable
// 99,PropAuthenticationData "o\213\198\161'A?P\ENQ'\144\235qY\144\192\210\156\214\200*M",PropRetainAvailable
// 220,PropServerKeepAlive 26426,PropAuthenticationData
// "\212O\226\198\214\236\150D_\DC2\135",PropRequestProblemInformation 170,PropTopicAliasMaximum
// 10106,PropResponseInformation
// "\ESCu\152M\180V\202\DLE\220&`\244\RS\234\&5X\137\237\DC1\230\210\208u\RS\180\ETB",PropContentType
// "",PropAuthenticationData
// "R\178\230b\169\192\188\232\161\168\230K\SOMj>|s@b\140\243\197\246\t\156\b^",PropSubscriptionIdentifier
// 12,PropSessionExpiryInterval 28419,PropSharedSubscriptionAvailable 28,PropMaximumPacketSize 19043,PropServerKeepAlive
// 19008,PropRetainAvailable 208,PropUserProperty "\195\DEL\252}\STX.\234\130\189\255:)\SO\136x\143\133\129"
// "\159\161:z\170\255\DC3\230\249\ETBZ\204}\178T\190\222\198\DEL\181\150\245\253\f\255#\218\t*M"]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x31, 0xb7, 0x2,  0x0,  0x1a, 0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4,  0x8c, 0xe6, 0x77, 0xfc, 0x69, 0x72, 0xdc, 0x2d,
      0xd9, 0xe6, 0x9a, 0xb6, 0x7,  0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f, 0x8b, 0x2,  0x29, 0xec, 0x12, 0x0,  0x5,
      0x98, 0x1,  0x74, 0xfc, 0xa5, 0x22, 0x34, 0xb2, 0x18, 0x0,  0x0,  0x56, 0xc1, 0x1,  0x3c, 0x23, 0x41, 0xc9, 0x25,
      0x6b, 0x8,  0x0,  0x18, 0x61, 0x68, 0x17, 0x8b, 0x69, 0x51, 0x8,  0xa,  0xa4, 0xe9, 0x51, 0x84, 0x67, 0x1d, 0x55,
      0xa0, 0xd4, 0x8,  0xbf, 0x4b, 0xd3, 0x9d, 0xc8, 0xa5, 0x2,  0x0,  0x0,  0x6,  0xd,  0x15, 0x0,  0x15, 0xe5, 0xe0,
      0xce, 0xb,  0x41, 0xed, 0xb6, 0x1c, 0x21, 0x5b, 0x31, 0x3d, 0x55, 0xda, 0x2c, 0x56, 0x3e, 0x3,  0xd2, 0x70, 0x33,
      0x2a, 0x63, 0x16, 0x0,  0x16, 0x6f, 0xd5, 0xc6, 0xa1, 0x27, 0x41, 0x3f, 0x50, 0x5,  0x27, 0x90, 0xeb, 0x71, 0x59,
      0x90, 0xc0, 0xd2, 0x9c, 0xd6, 0xc8, 0x2a, 0x4d, 0x25, 0xdc, 0x13, 0x67, 0x3a, 0x16, 0x0,  0xb,  0xd4, 0x4f, 0xe2,
      0xc6, 0xd6, 0xec, 0x96, 0x44, 0x5f, 0x12, 0x87, 0x17, 0xaa, 0x22, 0x27, 0x7a, 0x1a, 0x0,  0x1a, 0x1b, 0x75, 0x98,
      0x4d, 0xb4, 0x56, 0xca, 0x10, 0xdc, 0x26, 0x60, 0xf4, 0x1e, 0xea, 0x35, 0x58, 0x89, 0xed, 0x11, 0xe6, 0xd2, 0xd0,
      0x75, 0x1e, 0xb4, 0x17, 0x3,  0x0,  0x0,  0x16, 0x0,  0x1c, 0x52, 0xb2, 0xe6, 0x62, 0xa9, 0xc0, 0xbc, 0xe8, 0xa1,
      0xa8, 0xe6, 0x4b, 0xe,  0x4d, 0x6a, 0x3e, 0x7c, 0x73, 0x40, 0x62, 0x8c, 0xf3, 0xc5, 0xf6, 0x9,  0x9c, 0x8,  0x5e,
      0xb,  0xc,  0x11, 0x0,  0x0,  0x6f, 0x3,  0x2a, 0x1c, 0x27, 0x0,  0x0,  0x4a, 0x63, 0x13, 0x4a, 0x40, 0x25, 0xd0,
      0x26, 0x0,  0x12, 0xc3, 0x7f, 0xfc, 0x7d, 0x2,  0x2e, 0xea, 0x82, 0xbd, 0xff, 0x3a, 0x29, 0xe,  0x88, 0x78, 0x8f,
      0x85, 0x81, 0x0,  0x1e, 0x9f, 0xa1, 0x3a, 0x7a, 0xaa, 0xff, 0x13, 0xe6, 0xf9, 0x17, 0x5a, 0xcc, 0x7d, 0xb2, 0x54,
      0xbe, 0xde, 0xc6, 0x7f, 0xb5, 0x96, 0xf5, 0xfd, 0xc,  0xff, 0x23, 0xda, 0x9,  0x2a, 0x4d, 0x32, 0x89, 0xa,  0x0,
      0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  uint8_t topic_bytes[] = {0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4, 0x8c, 0xe6, 0x77, 0xfc, 0x69, 0x72, 0xdc,
                           0x2d, 0xd9, 0xe6, 0x9a, 0xb6, 0x7, 0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x32, 0x89, 0xa, 0x0, 0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0x98, 0x1, 0x74, 0xfc, 0xa5};
  uint8_t bytesprops1[] = {0x61, 0x68, 0x17, 0x8b, 0x69, 0x51, 0x8,  0xa,  0xa4, 0xe9, 0x51, 0x84,
                           0x67, 0x1d, 0x55, 0xa0, 0xd4, 0x8,  0xbf, 0x4b, 0xd3, 0x9d, 0xc8, 0xa5};
  uint8_t bytesprops2[] = {0xe5, 0xe0, 0xce, 0xb,  0x41, 0xed, 0xb6, 0x1c, 0x21, 0x5b, 0x31,
                           0x3d, 0x55, 0xda, 0x2c, 0x56, 0x3e, 0x3,  0xd2, 0x70, 0x33};
  uint8_t bytesprops3[] = {0x6f, 0xd5, 0xc6, 0xa1, 0x27, 0x41, 0x3f, 0x50, 0x5,  0x27, 0x90,
                           0xeb, 0x71, 0x59, 0x90, 0xc0, 0xd2, 0x9c, 0xd6, 0xc8, 0x2a, 0x4d};
  uint8_t bytesprops4[] = {0xd4, 0x4f, 0xe2, 0xc6, 0xd6, 0xec, 0x96, 0x44, 0x5f, 0x12, 0x87};
  uint8_t bytesprops5[] = {0x1b, 0x75, 0x98, 0x4d, 0xb4, 0x56, 0xca, 0x10, 0xdc, 0x26, 0x60, 0xf4, 0x1e,
                           0xea, 0x35, 0x58, 0x89, 0xed, 0x11, 0xe6, 0xd2, 0xd0, 0x75, 0x1e, 0xb4, 0x17};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0x52, 0xb2, 0xe6, 0x62, 0xa9, 0xc0, 0xbc, 0xe8, 0xa1, 0xa8, 0xe6, 0x4b, 0xe, 0x4d,
                           0x6a, 0x3e, 0x7c, 0x73, 0x40, 0x62, 0x8c, 0xf3, 0xc5, 0xf6, 0x9,  0x9c, 0x8, 0x5e};
  uint8_t bytesprops9[] = {0x9f, 0xa1, 0x3a, 0x7a, 0xaa, 0xff, 0x13, 0xe6, 0xf9, 0x17, 0x5a, 0xcc, 0x7d, 0xb2, 0x54,
                           0xbe, 0xde, 0xc6, 0x7f, 0xb5, 0x96, 0xf5, 0xfd, 0xc,  0xff, 0x23, 0xda, 0x9,  0x2a, 0x4d};
  uint8_t bytesprops8[] = {0xc3, 0x7f, 0xfc, 0x7d, 0x2,  0x2e, 0xea, 0x82, 0xbd,
                           0xff, 0x3a, 0x29, 0xe,  0x88, 0x78, 0x8f, 0x85, 0x81};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13490}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22209}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16841}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1549}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26426}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10106}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28419}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19043}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19008}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops8}, .v = {30, (char*)&bytesprops9}}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "o#L\177\210\EOT\140\230w\252ir\220-\217\230\154\182\a0(\169\225\232uo", _pubPktID = 0, _pubBody =
// "2\137\n\NUL\201\149\252e\191]\CAN#`\250", _pubProps = [PropSubscriptionIdentifierAvailable
// 236,PropAssignedClientIdentifier "\152\SOHt\252\165",PropTopicAliasMaximum 13490,PropWillDelayInterval
// 22209,PropPayloadFormatIndicator 60,PropTopicAlias 16841,PropRetainAvailable 107,PropResponseTopic
// "ah\ETB\139iQ\b\n\164\233Q\132g\GSU\160\212\b\191K\211\157\200\165",PropMessageExpiryInterval
// 1549,PropAuthenticationMethod "\229\224\206\vA\237\182\FS![1=U\218,V>\ETX\210p3",PropSharedSubscriptionAvailable
// 99,PropAuthenticationData "o\213\198\161'A?P\ENQ'\144\235qY\144\192\210\156\214\200*M",PropRetainAvailable
// 220,PropServerKeepAlive 26426,PropAuthenticationData
// "\212O\226\198\214\236\150D_\DC2\135",PropRequestProblemInformation 170,PropTopicAliasMaximum
// 10106,PropResponseInformation
// "\ESCu\152M\180V\202\DLE\220&`\244\RS\234\&5X\137\237\DC1\230\210\208u\RS\180\ETB",PropContentType
// "",PropAuthenticationData
// "R\178\230b\169\192\188\232\161\168\230K\SOMj>|s@b\140\243\197\246\t\156\b^",PropSubscriptionIdentifier
// 12,PropSessionExpiryInterval 28419,PropSharedSubscriptionAvailable 28,PropMaximumPacketSize 19043,PropServerKeepAlive
// 19008,PropRetainAvailable 208,PropUserProperty "\195\DEL\252}\STX.\234\130\189\255:)\SO\136x\143\133\129"
// "\159\161:z\170\255\DC3\230\249\ETBZ\204}\178T\190\222\198\DEL\181\150\245\253\f\255#\218\t*M"]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {
      0x31, 0xb7, 0x2,  0x0,  0x1a, 0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4,  0x8c, 0xe6, 0x77, 0xfc, 0x69, 0x72, 0xdc, 0x2d,
      0xd9, 0xe6, 0x9a, 0xb6, 0x7,  0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f, 0x8b, 0x2,  0x29, 0xec, 0x12, 0x0,  0x5,
      0x98, 0x1,  0x74, 0xfc, 0xa5, 0x22, 0x34, 0xb2, 0x18, 0x0,  0x0,  0x56, 0xc1, 0x1,  0x3c, 0x23, 0x41, 0xc9, 0x25,
      0x6b, 0x8,  0x0,  0x18, 0x61, 0x68, 0x17, 0x8b, 0x69, 0x51, 0x8,  0xa,  0xa4, 0xe9, 0x51, 0x84, 0x67, 0x1d, 0x55,
      0xa0, 0xd4, 0x8,  0xbf, 0x4b, 0xd3, 0x9d, 0xc8, 0xa5, 0x2,  0x0,  0x0,  0x6,  0xd,  0x15, 0x0,  0x15, 0xe5, 0xe0,
      0xce, 0xb,  0x41, 0xed, 0xb6, 0x1c, 0x21, 0x5b, 0x31, 0x3d, 0x55, 0xda, 0x2c, 0x56, 0x3e, 0x3,  0xd2, 0x70, 0x33,
      0x2a, 0x63, 0x16, 0x0,  0x16, 0x6f, 0xd5, 0xc6, 0xa1, 0x27, 0x41, 0x3f, 0x50, 0x5,  0x27, 0x90, 0xeb, 0x71, 0x59,
      0x90, 0xc0, 0xd2, 0x9c, 0xd6, 0xc8, 0x2a, 0x4d, 0x25, 0xdc, 0x13, 0x67, 0x3a, 0x16, 0x0,  0xb,  0xd4, 0x4f, 0xe2,
      0xc6, 0xd6, 0xec, 0x96, 0x44, 0x5f, 0x12, 0x87, 0x17, 0xaa, 0x22, 0x27, 0x7a, 0x1a, 0x0,  0x1a, 0x1b, 0x75, 0x98,
      0x4d, 0xb4, 0x56, 0xca, 0x10, 0xdc, 0x26, 0x60, 0xf4, 0x1e, 0xea, 0x35, 0x58, 0x89, 0xed, 0x11, 0xe6, 0xd2, 0xd0,
      0x75, 0x1e, 0xb4, 0x17, 0x3,  0x0,  0x0,  0x16, 0x0,  0x1c, 0x52, 0xb2, 0xe6, 0x62, 0xa9, 0xc0, 0xbc, 0xe8, 0xa1,
      0xa8, 0xe6, 0x4b, 0xe,  0x4d, 0x6a, 0x3e, 0x7c, 0x73, 0x40, 0x62, 0x8c, 0xf3, 0xc5, 0xf6, 0x9,  0x9c, 0x8,  0x5e,
      0xb,  0xc,  0x11, 0x0,  0x0,  0x6f, 0x3,  0x2a, 0x1c, 0x27, 0x0,  0x0,  0x4a, 0x63, 0x13, 0x4a, 0x40, 0x25, 0xd0,
      0x26, 0x0,  0x12, 0xc3, 0x7f, 0xfc, 0x7d, 0x2,  0x2e, 0xea, 0x82, 0xbd, 0xff, 0x3a, 0x29, 0xe,  0x88, 0x78, 0x8f,
      0x85, 0x81, 0x0,  0x1e, 0x9f, 0xa1, 0x3a, 0x7a, 0xaa, 0xff, 0x13, 0xe6, 0xf9, 0x17, 0x5a, 0xcc, 0x7d, 0xb2, 0x54,
      0xbe, 0xde, 0xc6, 0x7f, 0xb5, 0x96, 0xf5, 0xfd, 0xc,  0xff, 0x23, 0xda, 0x9,  0x2a, 0x4d, 0x32, 0x89, 0xa,  0x0,
      0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6f, 0x23, 0x4c, 0xb1, 0xd2, 0x4, 0x8c, 0xe6, 0x77, 0xfc, 0x69, 0x72, 0xdc,
                               0x2d, 0xd9, 0xe6, 0x9a, 0xb6, 0x7, 0x30, 0x28, 0xa9, 0xe1, 0xe8, 0x75, 0x6f};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x32, 0x89, 0xa, 0x0, 0xc9, 0x95, 0xfc, 0x65, 0xbf, 0x5d, 0x18, 0x23, 0x60, 0xfa};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "O\216\186", _pubPktID = 31863,
// _pubBody = "\206\US\183\184\207\198X\216\SOn\202 \214", _pubProps = [PropServerKeepAlive
// 3457,PropAssignedClientIdentifier "y",PropCorrelationData "\RS\202\193",PropMaximumQoS 253,PropUserProperty
// "n\150\v\139\139\166K\163lr$-#\CANEK\243(;\253" "\164N\244\218LO#\214\vfMF\176\136\FS\138",PropPayloadFormatIndicator
// 113,PropMessageExpiryInterval 28096,PropServerReference
// "d\172q\231\174\232v\SYN\ACK\213\189,=\132\DC2\144\235z\t%\DEL\227\230\147\&9\198;",PropWildcardSubscriptionAvailable
// 100,PropRequestProblemInformation 159,PropTopicAlias 29659,PropResponseTopic "\ENQt\165[",PropReceiveMaximum
// 23882,PropWildcardSubscriptionAvailable 19]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {0x3d, 0x85, 0x1,  0x0,  0x3,  0x4f, 0xd8, 0xba, 0x7c, 0x77, 0x70, 0x13, 0xd,  0x81, 0x12, 0x0,
                   0x1,  0x79, 0x9,  0x0,  0x3,  0x1e, 0xca, 0xc1, 0x24, 0xfd, 0x26, 0x0,  0x14, 0x6e, 0x96, 0xb,
                   0x8b, 0x8b, 0xa6, 0x4b, 0xa3, 0x6c, 0x72, 0x24, 0x2d, 0x23, 0x18, 0x45, 0x4b, 0xf3, 0x28, 0x3b,
                   0xfd, 0x0,  0x10, 0xa4, 0x4e, 0xf4, 0xda, 0x4c, 0x4f, 0x23, 0xd6, 0xb,  0x66, 0x4d, 0x46, 0xb0,
                   0x88, 0x1c, 0x8a, 0x1,  0x71, 0x2,  0x0,  0x0,  0x6d, 0xc0, 0x1c, 0x0,  0x1b, 0x64, 0xac, 0x71,
                   0xe7, 0xae, 0xe8, 0x76, 0x16, 0x6,  0xd5, 0xbd, 0x2c, 0x3d, 0x84, 0x12, 0x90, 0xeb, 0x7a, 0x9,
                   0x25, 0x7f, 0xe3, 0xe6, 0x93, 0x39, 0xc6, 0x3b, 0x28, 0x64, 0x17, 0x9f, 0x23, 0x73, 0xdb, 0x8,
                   0x0,  0x4,  0x5,  0x74, 0xa5, 0x5b, 0x21, 0x5d, 0x4a, 0x28, 0x13, 0xce, 0x1f, 0xb7, 0xb8, 0xcf,
                   0xc6, 0x58, 0xd8, 0xe,  0x6e, 0xca, 0x20, 0xd6};
  uint8_t topic_bytes[] = {0x4f, 0xd8, 0xba};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xce, 0x1f, 0xb7, 0xb8, 0xcf, 0xc6, 0x58, 0xd8, 0xe, 0x6e, 0xca, 0x20, 0xd6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0x79};
  uint8_t bytesprops1[] = {0x1e, 0xca, 0xc1};
  uint8_t bytesprops3[] = {0xa4, 0x4e, 0xf4, 0xda, 0x4c, 0x4f, 0x23, 0xd6,
                           0xb,  0x66, 0x4d, 0x46, 0xb0, 0x88, 0x1c, 0x8a};
  uint8_t bytesprops2[] = {0x6e, 0x96, 0xb,  0x8b, 0x8b, 0xa6, 0x4b, 0xa3, 0x6c, 0x72,
                           0x24, 0x2d, 0x23, 0x18, 0x45, 0x4b, 0xf3, 0x28, 0x3b, 0xfd};
  uint8_t bytesprops4[] = {0x64, 0xac, 0x71, 0xe7, 0xae, 0xe8, 0x76, 0x16, 0x6,  0xd5, 0xbd, 0x2c, 0x3d, 0x84,
                           0x12, 0x90, 0xeb, 0x7a, 0x9,  0x25, 0x7f, 0xe3, 0xe6, 0x93, 0x39, 0xc6, 0x3b};
  uint8_t bytesprops5[] = {0x5, 0x74, 0xa5, 0x5b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3457}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops2}, .v = {16, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28096}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29659}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23882}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 19}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 31863, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "O\216\186", _pubPktID = 31863,
// _pubBody = "\206\US\183\184\207\198X\216\SOn\202 \214", _pubProps = [PropServerKeepAlive
// 3457,PropAssignedClientIdentifier "y",PropCorrelationData "\RS\202\193",PropMaximumQoS 253,PropUserProperty
// "n\150\v\139\139\166K\163lr$-#\CANEK\243(;\253" "\164N\244\218LO#\214\vfMF\176\136\FS\138",PropPayloadFormatIndicator
// 113,PropMessageExpiryInterval 28096,PropServerReference
// "d\172q\231\174\232v\SYN\ACK\213\189,=\132\DC2\144\235z\t%\DEL\227\230\147\&9\198;",PropWildcardSubscriptionAvailable
// 100,PropRequestProblemInformation 159,PropTopicAlias 29659,PropResponseTopic "\ENQt\165[",PropReceiveMaximum
// 23882,PropWildcardSubscriptionAvailable 19]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {0x3d, 0x85, 0x1,  0x0,  0x3,  0x4f, 0xd8, 0xba, 0x7c, 0x77, 0x70, 0x13, 0xd,  0x81, 0x12, 0x0,
                   0x1,  0x79, 0x9,  0x0,  0x3,  0x1e, 0xca, 0xc1, 0x24, 0xfd, 0x26, 0x0,  0x14, 0x6e, 0x96, 0xb,
                   0x8b, 0x8b, 0xa6, 0x4b, 0xa3, 0x6c, 0x72, 0x24, 0x2d, 0x23, 0x18, 0x45, 0x4b, 0xf3, 0x28, 0x3b,
                   0xfd, 0x0,  0x10, 0xa4, 0x4e, 0xf4, 0xda, 0x4c, 0x4f, 0x23, 0xd6, 0xb,  0x66, 0x4d, 0x46, 0xb0,
                   0x88, 0x1c, 0x8a, 0x1,  0x71, 0x2,  0x0,  0x0,  0x6d, 0xc0, 0x1c, 0x0,  0x1b, 0x64, 0xac, 0x71,
                   0xe7, 0xae, 0xe8, 0x76, 0x16, 0x6,  0xd5, 0xbd, 0x2c, 0x3d, 0x84, 0x12, 0x90, 0xeb, 0x7a, 0x9,
                   0x25, 0x7f, 0xe3, 0xe6, 0x93, 0x39, 0xc6, 0x3b, 0x28, 0x64, 0x17, 0x9f, 0x23, 0x73, 0xdb, 0x8,
                   0x0,  0x4,  0x5,  0x74, 0xa5, 0x5b, 0x21, 0x5d, 0x4a, 0x28, 0x13, 0xce, 0x1f, 0xb7, 0xb8, 0xcf,
                   0xc6, 0x58, 0xd8, 0xe,  0x6e, 0xca, 0x20, 0xd6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x4f, 0xd8, 0xba};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xce, 0x1f, 0xb7, 0xb8, 0xcf, 0xc6, 0x58, 0xd8, 0xe, 0x6e, 0xca, 0x20, 0xd6};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 31863);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "r8*
// \EM\150\251uUH\DEL\151\232\SOH\RS\240\192\167=\255\246\193\250*<", _pubPktID = 26145, _pubBody =
// "\165\DC2\SOH6&\169\226\233\172\134`\205\149\221__", _pubProps = [PropRequestProblemInformation 48,PropReceiveMaximum
// 6809,PropMessageExpiryInterval 14400,PropUserProperty "\212\RSv!\211"
// "\156h\\\138^\159\139P\172\217\153\"\130|\137}\SOH\249\187\141\215\172",PropMessageExpiryInterval
// 29289,PropAuthenticationData
// "\DC4\DEL\172\&5\147\250\NUL\154M\t\146@\234\176\244\226q\218i\252\147\170NpB\213\248\134w!",PropSessionExpiryInterval
// 14509,PropReceiveMaximum 27484,PropContentType
// "H\228\SYN\255;x\209\150\154\165\179!\200\159O)E\189\128*\132\SI\154\235\ENQ{\180\154h",PropSubscriptionIdentifierAvailable
// 195,PropTopicAliasMaximum 24651,PropContentType
// "\140\196p2\EM\213p\178\139`o&\139\215CP\210\198\170\227A\221\195\205",PropWillDelayInterval
// 31842,PropServerKeepAlive 227,PropRequestResponseInformation 96,PropSubscriptionIdentifierAvailable
// 234,PropTopicAlias 30778,PropSubscriptionIdentifierAvailable 201,PropRequestResponseInformation
// 153,PropSubscriptionIdentifier 8,PropWildcardSubscriptionAvailable 6,PropMessageExpiryInterval 27590]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {0x32, 0xe3, 0x1,  0x0,  0x19, 0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97,
                   0xe8, 0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c, 0x66, 0x21, 0xb4, 0x1,
                   0x17, 0x30, 0x21, 0x1a, 0x99, 0x2,  0x0,  0x0,  0x38, 0x40, 0x26, 0x0,  0x5,  0xd4, 0x1e, 0x76, 0x21,
                   0xd3, 0x0,  0x16, 0x9c, 0x68, 0x5c, 0x8a, 0x5e, 0x9f, 0x8b, 0x50, 0xac, 0xd9, 0x99, 0x22, 0x82, 0x7c,
                   0x89, 0x7d, 0x1,  0xf9, 0xbb, 0x8d, 0xd7, 0xac, 0x2,  0x0,  0x0,  0x72, 0x69, 0x16, 0x0,  0x1e, 0x14,
                   0x7f, 0xac, 0x35, 0x93, 0xfa, 0x0,  0x9a, 0x4d, 0x9,  0x92, 0x40, 0xea, 0xb0, 0xf4, 0xe2, 0x71, 0xda,
                   0x69, 0xfc, 0x93, 0xaa, 0x4e, 0x70, 0x42, 0xd5, 0xf8, 0x86, 0x77, 0x21, 0x11, 0x0,  0x0,  0x38, 0xad,
                   0x21, 0x6b, 0x5c, 0x3,  0x0,  0x1d, 0x48, 0xe4, 0x16, 0xff, 0x3b, 0x78, 0xd1, 0x96, 0x9a, 0xa5, 0xb3,
                   0x21, 0xc8, 0x9f, 0x4f, 0x29, 0x45, 0xbd, 0x80, 0x2a, 0x84, 0xf,  0x9a, 0xeb, 0x5,  0x7b, 0xb4, 0x9a,
                   0x68, 0x29, 0xc3, 0x22, 0x60, 0x4b, 0x3,  0x0,  0x18, 0x8c, 0xc4, 0x70, 0x32, 0x19, 0xd5, 0x70, 0xb2,
                   0x8b, 0x60, 0x6f, 0x26, 0x8b, 0xd7, 0x43, 0x50, 0xd2, 0xc6, 0xaa, 0xe3, 0x41, 0xdd, 0xc3, 0xcd, 0x18,
                   0x0,  0x0,  0x7c, 0x62, 0x13, 0x0,  0xe3, 0x19, 0x60, 0x29, 0xea, 0x23, 0x78, 0x3a, 0x29, 0xc9, 0x19,
                   0x99, 0xb,  0x8,  0x28, 0x6,  0x2,  0x0,  0x0,  0x6b, 0xc6, 0xa5, 0x12, 0x1,  0x36, 0x26, 0xa9, 0xe2,
                   0xe9, 0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  uint8_t topic_bytes[] = {0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97, 0xe8,
                           0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa5, 0x12, 0x1, 0x36, 0x26, 0xa9, 0xe2, 0xe9, 0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops1[] = {0x9c, 0x68, 0x5c, 0x8a, 0x5e, 0x9f, 0x8b, 0x50, 0xac, 0xd9, 0x99,
                           0x22, 0x82, 0x7c, 0x89, 0x7d, 0x1,  0xf9, 0xbb, 0x8d, 0xd7, 0xac};
  uint8_t bytesprops0[] = {0xd4, 0x1e, 0x76, 0x21, 0xd3};
  uint8_t bytesprops2[] = {0x14, 0x7f, 0xac, 0x35, 0x93, 0xfa, 0x0,  0x9a, 0x4d, 0x9,  0x92, 0x40, 0xea, 0xb0, 0xf4,
                           0xe2, 0x71, 0xda, 0x69, 0xfc, 0x93, 0xaa, 0x4e, 0x70, 0x42, 0xd5, 0xf8, 0x86, 0x77, 0x21};
  uint8_t bytesprops3[] = {0x48, 0xe4, 0x16, 0xff, 0x3b, 0x78, 0xd1, 0x96, 0x9a, 0xa5, 0xb3, 0x21, 0xc8, 0x9f, 0x4f,
                           0x29, 0x45, 0xbd, 0x80, 0x2a, 0x84, 0xf,  0x9a, 0xeb, 0x5,  0x7b, 0xb4, 0x9a, 0x68};
  uint8_t bytesprops4[] = {0x8c, 0xc4, 0x70, 0x32, 0x19, 0xd5, 0x70, 0xb2, 0x8b, 0x60, 0x6f, 0x26,
                           0x8b, 0xd7, 0x43, 0x50, 0xd2, 0xc6, 0xaa, 0xe3, 0x41, 0xdd, 0xc3, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6809}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14400}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops0}, .v = {22, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29289}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14509}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27484}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24651}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31842}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 227}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30778}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27590}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 26145, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "r8*
// \EM\150\251uUH\DEL\151\232\SOH\RS\240\192\167=\255\246\193\250*<", _pubPktID = 26145, _pubBody =
// "\165\DC2\SOH6&\169\226\233\172\134`\205\149\221__", _pubProps = [PropRequestProblemInformation 48,PropReceiveMaximum
// 6809,PropMessageExpiryInterval 14400,PropUserProperty "\212\RSv!\211"
// "\156h\\\138^\159\139P\172\217\153\"\130|\137}\SOH\249\187\141\215\172",PropMessageExpiryInterval
// 29289,PropAuthenticationData
// "\DC4\DEL\172\&5\147\250\NUL\154M\t\146@\234\176\244\226q\218i\252\147\170NpB\213\248\134w!",PropSessionExpiryInterval
// 14509,PropReceiveMaximum 27484,PropContentType
// "H\228\SYN\255;x\209\150\154\165\179!\200\159O)E\189\128*\132\SI\154\235\ENQ{\180\154h",PropSubscriptionIdentifierAvailable
// 195,PropTopicAliasMaximum 24651,PropContentType
// "\140\196p2\EM\213p\178\139`o&\139\215CP\210\198\170\227A\221\195\205",PropWillDelayInterval
// 31842,PropServerKeepAlive 227,PropRequestResponseInformation 96,PropSubscriptionIdentifierAvailable
// 234,PropTopicAlias 30778,PropSubscriptionIdentifierAvailable 201,PropRequestResponseInformation
// 153,PropSubscriptionIdentifier 8,PropWildcardSubscriptionAvailable 6,PropMessageExpiryInterval 27590]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {0x32, 0xe3, 0x1,  0x0,  0x19, 0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97,
                   0xe8, 0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c, 0x66, 0x21, 0xb4, 0x1,
                   0x17, 0x30, 0x21, 0x1a, 0x99, 0x2,  0x0,  0x0,  0x38, 0x40, 0x26, 0x0,  0x5,  0xd4, 0x1e, 0x76, 0x21,
                   0xd3, 0x0,  0x16, 0x9c, 0x68, 0x5c, 0x8a, 0x5e, 0x9f, 0x8b, 0x50, 0xac, 0xd9, 0x99, 0x22, 0x82, 0x7c,
                   0x89, 0x7d, 0x1,  0xf9, 0xbb, 0x8d, 0xd7, 0xac, 0x2,  0x0,  0x0,  0x72, 0x69, 0x16, 0x0,  0x1e, 0x14,
                   0x7f, 0xac, 0x35, 0x93, 0xfa, 0x0,  0x9a, 0x4d, 0x9,  0x92, 0x40, 0xea, 0xb0, 0xf4, 0xe2, 0x71, 0xda,
                   0x69, 0xfc, 0x93, 0xaa, 0x4e, 0x70, 0x42, 0xd5, 0xf8, 0x86, 0x77, 0x21, 0x11, 0x0,  0x0,  0x38, 0xad,
                   0x21, 0x6b, 0x5c, 0x3,  0x0,  0x1d, 0x48, 0xe4, 0x16, 0xff, 0x3b, 0x78, 0xd1, 0x96, 0x9a, 0xa5, 0xb3,
                   0x21, 0xc8, 0x9f, 0x4f, 0x29, 0x45, 0xbd, 0x80, 0x2a, 0x84, 0xf,  0x9a, 0xeb, 0x5,  0x7b, 0xb4, 0x9a,
                   0x68, 0x29, 0xc3, 0x22, 0x60, 0x4b, 0x3,  0x0,  0x18, 0x8c, 0xc4, 0x70, 0x32, 0x19, 0xd5, 0x70, 0xb2,
                   0x8b, 0x60, 0x6f, 0x26, 0x8b, 0xd7, 0x43, 0x50, 0xd2, 0xc6, 0xaa, 0xe3, 0x41, 0xdd, 0xc3, 0xcd, 0x18,
                   0x0,  0x0,  0x7c, 0x62, 0x13, 0x0,  0xe3, 0x19, 0x60, 0x29, 0xea, 0x23, 0x78, 0x3a, 0x29, 0xc9, 0x19,
                   0x99, 0xb,  0x8,  0x28, 0x6,  0x2,  0x0,  0x0,  0x6b, 0xc6, 0xa5, 0x12, 0x1,  0x36, 0x26, 0xa9, 0xe2,
                   0xe9, 0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x72, 0x38, 0x2a, 0x20, 0x19, 0x96, 0xfb, 0x75, 0x55, 0x48, 0x7f, 0x97, 0xe8,
                               0x1,  0x1e, 0xf0, 0xc0, 0xa7, 0x3d, 0xff, 0xf6, 0xc1, 0xfa, 0x2a, 0x3c};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa5, 0x12, 0x1,  0x36, 0x26, 0xa9, 0xe2, 0xe9,
                              0xac, 0x86, 0x60, 0xcd, 0x95, 0xdd, 0x5f, 0x5f};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 26145);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 7976, _pubBody =
// "\ENQP\a\164\163\166{\250{", _pubProps = [PropWillDelayInterval 3340,PropSubscriptionIdentifierAvailable
// 115,PropAuthenticationMethod "0\192j1e\ACK",PropReasonString "\r\173"]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {0x3b, 0x23, 0x0, 0x0,  0x1f, 0x28, 0x15, 0x18, 0x0,  0x0,  0xd,  0xc, 0x29,
                   0x73, 0x15, 0x0, 0x6,  0x30, 0xc0, 0x6a, 0x31, 0x65, 0x6,  0x1f, 0x0, 0x2,
                   0xd,  0xad, 0x5, 0x50, 0x7,  0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5, 0x50, 0x7, 0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0x30, 0xc0, 0x6a, 0x31, 0x65, 0x6};
  uint8_t bytesprops1[] = {0xd, 0xad};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3340}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 7976, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 7976, _pubBody =
// "\ENQP\a\164\163\166{\250{", _pubProps = [PropWillDelayInterval 3340,PropSubscriptionIdentifierAvailable
// 115,PropAuthenticationMethod "0\192j1e\ACK",PropReasonString "\r\173"]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {0x3b, 0x23, 0x0, 0x0,  0x1f, 0x28, 0x15, 0x18, 0x0,  0x0,  0xd,  0xc, 0x29,
                   0x73, 0x15, 0x0, 0x6,  0x30, 0xc0, 0x6a, 0x31, 0x65, 0x6,  0x1f, 0x0, 0x2,
                   0xd,  0xad, 0x5, 0x50, 0x7,  0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5, 0x50, 0x7, 0xa4, 0xa3, 0xa6, 0x7b, 0xfa, 0x7b};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 7976);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\197\a\164\SUB\DC1\195\RS`\FS\155?\206\154I\134\181\139\252Vc\161i`\DC3\245", _pubPktID = 3213, _pubBody =
// "\249a\NAK\209f+\v\251'\141\199\&6\195s\160^:v\251\&5\174\FS\240\191k\205\"\201\222=", _pubProps = [PropResponseTopic
// "\227\163\184+",PropAssignedClientIdentifier "\231\&6\243\150\NAK\194\191\142e",PropPayloadFormatIndicator
// 184,PropRequestProblemInformation 163,PropResponseInformation
// "\213^\232,F\184\\p\DC3L?\221\DC1\DC1\153#\DC3UYf\242\192\234\142LV",PropMaximumQoS 81,PropCorrelationData
// "\131\229\227oU\136O\"zQ\191\211$\214\&79",PropAuthenticationData "\213\215\v\179~l\190c
// \165wh.\181\208u\128\133\t\243\161\232\SOHB"]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x35, 0xa0, 0x1,  0x0,  0x19, 0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce,
                   0x9a, 0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5, 0xc,  0x8d, 0x64, 0x8,
                   0x0,  0x4,  0xe3, 0xa3, 0xb8, 0x2b, 0x12, 0x0,  0x9,  0xe7, 0x36, 0xf3, 0x96, 0x15, 0xc2, 0xbf, 0x8e,
                   0x65, 0x1,  0xb8, 0x17, 0xa3, 0x1a, 0x0,  0x1a, 0xd5, 0x5e, 0xe8, 0x2c, 0x46, 0xb8, 0x5c, 0x70, 0x13,
                   0x4c, 0x3f, 0xdd, 0x11, 0x11, 0x99, 0x23, 0x13, 0x55, 0x59, 0x66, 0xf2, 0xc0, 0xea, 0x8e, 0x4c, 0x56,
                   0x24, 0x51, 0x9,  0x0,  0x10, 0x83, 0xe5, 0xe3, 0x6f, 0x55, 0x88, 0x4f, 0x22, 0x7a, 0x51, 0xbf, 0xd3,
                   0x24, 0xd6, 0x37, 0x39, 0x16, 0x0,  0x18, 0xd5, 0xd7, 0xb,  0xb3, 0x7e, 0x6c, 0xbe, 0x63, 0x20, 0xa5,
                   0x77, 0x68, 0x2e, 0xb5, 0xd0, 0x75, 0x80, 0x85, 0x9,  0xf3, 0xa1, 0xe8, 0x1,  0x42, 0xf9, 0x61, 0x15,
                   0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0, 0x5e, 0x3a, 0x76, 0xfb, 0x35,
                   0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  uint8_t topic_bytes[] = {0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce, 0x9a,
                           0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf9, 0x61, 0x15, 0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0,
                         0x5e, 0x3a, 0x76, 0xfb, 0x35, 0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xe3, 0xa3, 0xb8, 0x2b};
  uint8_t bytesprops1[] = {0xe7, 0x36, 0xf3, 0x96, 0x15, 0xc2, 0xbf, 0x8e, 0x65};
  uint8_t bytesprops2[] = {0xd5, 0x5e, 0xe8, 0x2c, 0x46, 0xb8, 0x5c, 0x70, 0x13, 0x4c, 0x3f, 0xdd, 0x11,
                           0x11, 0x99, 0x23, 0x13, 0x55, 0x59, 0x66, 0xf2, 0xc0, 0xea, 0x8e, 0x4c, 0x56};
  uint8_t bytesprops3[] = {0x83, 0xe5, 0xe3, 0x6f, 0x55, 0x88, 0x4f, 0x22,
                           0x7a, 0x51, 0xbf, 0xd3, 0x24, 0xd6, 0x37, 0x39};
  uint8_t bytesprops4[] = {0xd5, 0xd7, 0xb,  0xb3, 0x7e, 0x6c, 0xbe, 0x63, 0x20, 0xa5, 0x77, 0x68,
                           0x2e, 0xb5, 0xd0, 0x75, 0x80, 0x85, 0x9,  0xf3, 0xa1, 0xe8, 0x1,  0x42};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 3213, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\197\a\164\SUB\DC1\195\RS`\FS\155?\206\154I\134\181\139\252Vc\161i`\DC3\245", _pubPktID = 3213, _pubBody =
// "\249a\NAK\209f+\v\251'\141\199\&6\195s\160^:v\251\&5\174\FS\240\191k\205\"\201\222=", _pubProps = [PropResponseTopic
// "\227\163\184+",PropAssignedClientIdentifier "\231\&6\243\150\NAK\194\191\142e",PropPayloadFormatIndicator
// 184,PropRequestProblemInformation 163,PropResponseInformation
// "\213^\232,F\184\\p\DC3L?\221\DC1\DC1\153#\DC3UYf\242\192\234\142LV",PropMaximumQoS 81,PropCorrelationData
// "\131\229\227oU\136O\"zQ\191\211$\214\&79",PropAuthenticationData "\213\215\v\179~l\190c
// \165wh.\181\208u\128\133\t\243\161\232\SOHB"]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x35, 0xa0, 0x1,  0x0,  0x19, 0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce,
                   0x9a, 0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5, 0xc,  0x8d, 0x64, 0x8,
                   0x0,  0x4,  0xe3, 0xa3, 0xb8, 0x2b, 0x12, 0x0,  0x9,  0xe7, 0x36, 0xf3, 0x96, 0x15, 0xc2, 0xbf, 0x8e,
                   0x65, 0x1,  0xb8, 0x17, 0xa3, 0x1a, 0x0,  0x1a, 0xd5, 0x5e, 0xe8, 0x2c, 0x46, 0xb8, 0x5c, 0x70, 0x13,
                   0x4c, 0x3f, 0xdd, 0x11, 0x11, 0x99, 0x23, 0x13, 0x55, 0x59, 0x66, 0xf2, 0xc0, 0xea, 0x8e, 0x4c, 0x56,
                   0x24, 0x51, 0x9,  0x0,  0x10, 0x83, 0xe5, 0xe3, 0x6f, 0x55, 0x88, 0x4f, 0x22, 0x7a, 0x51, 0xbf, 0xd3,
                   0x24, 0xd6, 0x37, 0x39, 0x16, 0x0,  0x18, 0xd5, 0xd7, 0xb,  0xb3, 0x7e, 0x6c, 0xbe, 0x63, 0x20, 0xa5,
                   0x77, 0x68, 0x2e, 0xb5, 0xd0, 0x75, 0x80, 0x85, 0x9,  0xf3, 0xa1, 0xe8, 0x1,  0x42, 0xf9, 0x61, 0x15,
                   0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0, 0x5e, 0x3a, 0x76, 0xfb, 0x35,
                   0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc5, 0x7,  0xa4, 0x1a, 0x11, 0xc3, 0x1e, 0x60, 0x1c, 0x9b, 0x3f, 0xce, 0x9a,
                               0x49, 0x86, 0xb5, 0x8b, 0xfc, 0x56, 0x63, 0xa1, 0x69, 0x60, 0x13, 0xf5};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf9, 0x61, 0x15, 0xd1, 0x66, 0x2b, 0xb,  0xfb, 0x27, 0x8d, 0xc7, 0x36, 0xc3, 0x73, 0xa0,
                              0x5e, 0x3a, 0x76, 0xfb, 0x35, 0xae, 0x1c, 0xf0, 0xbf, 0x6b, 0xcd, 0x22, 0xc9, 0xde, 0x3d};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 3213);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Just "\160\151\149a\211\ACK*?\149\202\211vrIu\153\DC2\173\173!\ACK", _password = Just
// "\212\133\STX\STX\240\131p", _lastWill = Nothing, _cleanSession = False, _keepAlive = 1099, _connID =
// "1\a\221\162V\235\244\238\188\&2v1%G\151H4@{\224\180\180\184\194\165\&2\138\141\204", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x4,  0x4b, 0x0,  0x1d, 0x31,
                   0x7,  0xdd, 0xa2, 0x56, 0xeb, 0xf4, 0xee, 0xbc, 0x32, 0x76, 0x31, 0x25, 0x47, 0x97, 0x48,
                   0x34, 0x40, 0x7b, 0xe0, 0xb4, 0xb4, 0xb8, 0xc2, 0xa5, 0x32, 0x8a, 0x8d, 0xcc, 0x0,  0x15,
                   0xa0, 0x97, 0x95, 0x61, 0xd3, 0x6,  0x2a, 0x3f, 0x95, 0xca, 0xd3, 0x76, 0x72, 0x49, 0x75,
                   0x99, 0x12, 0xad, 0xad, 0x21, 0x6,  0x0,  0x7,  0xd4, 0x85, 0x2,  0x2,  0xf0, 0x83, 0x70};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1099;
  uint8_t client_id_bytes[] = {0x31, 0x7,  0xdd, 0xa2, 0x56, 0xeb, 0xf4, 0xee, 0xbc, 0x32, 0x76, 0x31, 0x25, 0x47, 0x97,
                               0x48, 0x34, 0x40, 0x7b, 0xe0, 0xb4, 0xb4, 0xb8, 0xc2, 0xa5, 0x32, 0x8a, 0x8d, 0xcc};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa0, 0x97, 0x95, 0x61, 0xd3, 0x6,  0x2a, 0x3f, 0x95, 0xca, 0xd3,
                              0x76, 0x72, 0x49, 0x75, 0x99, 0x12, 0xad, 0xad, 0x21, 0x6};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd4, 0x85, 0x2, 0x2, 0xf0, 0x83, 0x70};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\245\FSg\131", _password = Just "\SO\141\210", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "\152\255\131ME_\ENQ\227\fVV\141\172", _willMsg =
// "\152\v\143\189\254\149a\FS7i\f_\220\240\209\232", _willProps = []}), _cleanSession = True, _keepAlive = 4861,
// _connID = "=\b:\142\144", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x3d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x12, 0xfd, 0x0,  0x5,  0x3d, 0x8,
                   0x3a, 0x8e, 0x90, 0x0,  0xd,  0x98, 0xff, 0x83, 0x4d, 0x45, 0x5f, 0x5,  0xe3, 0xc,  0x56, 0x56,
                   0x8d, 0xac, 0x0,  0x10, 0x98, 0xb,  0x8f, 0xbd, 0xfe, 0x95, 0x61, 0x1c, 0x37, 0x69, 0xc,  0x5f,
                   0xdc, 0xf0, 0xd1, 0xe8, 0x0,  0x4,  0xf5, 0x1c, 0x67, 0x83, 0x0,  0x3,  0xe,  0x8d, 0xd2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x98, 0xff, 0x83, 0x4d, 0x45, 0x5f, 0x5, 0xe3, 0xc, 0x56, 0x56, 0x8d, 0xac};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x98, 0xb,  0x8f, 0xbd, 0xfe, 0x95, 0x61, 0x1c,
                                  0x37, 0x69, 0xc,  0x5f, 0xdc, 0xf0, 0xd1, 0xe8};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4861;
  uint8_t client_id_bytes[] = {0x3d, 0x8, 0x3a, 0x8e, 0x90};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf5, 0x1c, 0x67, 0x83};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe, 0x8d, 0xd2};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\190~\232\224\v\218x\135\ESC\193\243\132\192\&1\150\134+\245\EOT9\235j\175",
// _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive = 11488, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x25, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x80, 0x2c, 0xe0, 0x0,
                   0x0,  0x0,  0x17, 0xbe, 0x7e, 0xe8, 0xe0, 0xb,  0xda, 0x78, 0x87, 0x1b, 0xc1,
                   0xf3, 0x84, 0xc0, 0x31, 0x96, 0x86, 0x2b, 0xf5, 0x4,  0x39, 0xeb, 0x6a, 0xaf};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11488;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbe, 0x7e, 0xe8, 0xe0, 0xb,  0xda, 0x78, 0x87, 0x1b, 0xc1, 0xf3, 0x84,
                              0xc0, 0x31, 0x96, 0x86, 0x2b, 0xf5, 0x4,  0x39, 0xeb, 0x6a, 0xaf};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "_\DLE\201\254`\162\246\240I", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "\248J", _willMsg =
// "\RSG\205\252\RSP\173\SO\195\CAN\209PX\DC1c:\218\166G\158\ACK", _willProps = []}), _cleanSession = True, _keepAlive =
// 31889, _connID = "I.j%\170?\194\183h\143.\150\255", _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x3f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xae, 0x7c, 0x91, 0x0,  0xd,  0x49, 0x2e, 0x6a,
                   0x25, 0xaa, 0x3f, 0xc2, 0xb7, 0x68, 0x8f, 0x2e, 0x96, 0xff, 0x0,  0x2,  0xf8, 0x4a, 0x0,  0x15, 0x1e,
                   0x47, 0xcd, 0xfc, 0x1e, 0x50, 0xad, 0xe,  0xc3, 0x18, 0xd1, 0x50, 0x58, 0x11, 0x63, 0x3a, 0xda, 0xa6,
                   0x47, 0x9e, 0x6,  0x0,  0x9,  0x5f, 0x10, 0xc9, 0xfe, 0x60, 0xa2, 0xf6, 0xf0, 0x49};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf8, 0x4a};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1e, 0x47, 0xcd, 0xfc, 0x1e, 0x50, 0xad, 0xe,  0xc3, 0x18, 0xd1,
                                  0x50, 0x58, 0x11, 0x63, 0x3a, 0xda, 0xa6, 0x47, 0x9e, 0x6};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31889;
  uint8_t client_id_bytes[] = {0x49, 0x2e, 0x6a, 0x25, 0xaa, 0x3f, 0xc2, 0xb7, 0x68, 0x8f, 0x2e, 0x96, 0xff};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5f, 0x10, 0xc9, 0xfe, 0x60, 0xa2, 0xf6, 0xf0, 0x49};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "T\207\211", _willMsg = "\bM\f\154\142\&6\191\r\DC3\RS\222", _willProps = []}), _cleanSession =
// False, _keepAlive = 12566, _connID = "\137\175)\181\207\247\&7@\223\162\&1\146;\226\v8", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x2e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x24, 0x31, 0x16, 0x0, 0x10, 0x89, 0xaf,
                   0x29, 0xb5, 0xcf, 0xf7, 0x37, 0x40, 0xdf, 0xa2, 0x31, 0x92, 0x3b, 0xe2, 0xb, 0x38, 0x0,  0x3,
                   0x54, 0xcf, 0xd3, 0x0,  0xb,  0x8,  0x4d, 0xc,  0x9a, 0x8e, 0x36, 0xbf, 0xd, 0x13, 0x1e, 0xde};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x54, 0xcf, 0xd3};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8, 0x4d, 0xc, 0x9a, 0x8e, 0x36, 0xbf, 0xd, 0x13, 0x1e, 0xde};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12566;
  uint8_t client_id_bytes[] = {0x89, 0xaf, 0x29, 0xb5, 0xcf, 0xf7, 0x37, 0x40,
                               0xdf, 0xa2, 0x31, 0x92, 0x3b, 0xe2, 0xb,  0x38};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\174g-~\US\254\174\RS5\r\148\251\190\141\147ed,\178\FS\148'\DELb\174\216", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\SI%\202\210^\187\&7\227\165\SI\236\b\199,\159\238\169", _willMsg =
// "\167\235\ACK\211F\n\211\\@!Wh\n", _willProps = []}), _cleanSession = True, _keepAlive = 4901, _connID = "bDc",
// _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x31, 0x0, 0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x13, 0x25, 0x0,  0x3,  0x62, 0x44, 0x63,
                   0x0,  0x11, 0xf, 0x25, 0xca, 0xd2, 0x5e, 0xbb, 0x37, 0xe3, 0xa5, 0xf,  0xec, 0x8,  0xc7, 0x2c, 0x9f,
                   0xee, 0xa9, 0x0, 0xd,  0xa7, 0xeb, 0x6,  0xd3, 0x46, 0xa,  0xd3, 0x5c, 0x40, 0x21, 0x57, 0x68, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf, 0x25, 0xca, 0xd2, 0x5e, 0xbb, 0x37, 0xe3, 0xa5,
                                0xf, 0xec, 0x8,  0xc7, 0x2c, 0x9f, 0xee, 0xa9};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa7, 0xeb, 0x6, 0xd3, 0x46, 0xa, 0xd3, 0x5c, 0x40, 0x21, 0x57, 0x68, 0xa};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4901;
  uint8_t client_id_bytes[] = {0x62, 0x44, 0x63};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xae, 0x67, 0x2d, 0x7e, 0x1f, 0xfe, 0xae, 0x1e, 0x35, 0xd,  0x94, 0xfb, 0xbe,
                              0x8d, 0x93, 0x65, 0x64, 0x2c, 0xb2, 0x1c, 0x94, 0x27, 0x7f, 0x62, 0xae, 0xd8};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "c_\DC1\222(\232\&7", _willMsg =
// "\213z\217-\215\&3\195\ETB\188G\198\140\251+\139\183\183\222\232\204M\187\145\252\EOT\n\192\129", _willProps = []}),
// _cleanSession = True, _keepAlive = 7652, _connID = "m\186 \189\208z", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x39, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x1d, 0xe4, 0x0,  0x6,  0x6d,
                   0xba, 0x20, 0xbd, 0xd0, 0x7a, 0x0,  0x7,  0x63, 0x5f, 0x11, 0xde, 0x28, 0xe8, 0x37, 0x0,
                   0x1c, 0xd5, 0x7a, 0xd9, 0x2d, 0xd7, 0x33, 0xc3, 0x17, 0xbc, 0x47, 0xc6, 0x8c, 0xfb, 0x2b,
                   0x8b, 0xb7, 0xb7, 0xde, 0xe8, 0xcc, 0x4d, 0xbb, 0x91, 0xfc, 0x4,  0xa,  0xc0, 0x81};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x63, 0x5f, 0x11, 0xde, 0x28, 0xe8, 0x37};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd5, 0x7a, 0xd9, 0x2d, 0xd7, 0x33, 0xc3, 0x17, 0xbc, 0x47, 0xc6, 0x8c, 0xfb, 0x2b,
                                  0x8b, 0xb7, 0xb7, 0xde, 0xe8, 0xcc, 0x4d, 0xbb, 0x91, 0xfc, 0x4,  0xa,  0xc0, 0x81};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7652;
  uint8_t client_id_bytes[] = {0x6d, 0xba, 0x20, 0xbd, 0xd0, 0x7a};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS2, _willTopic = "\167\186,\225\231\n\229RS\158n\EOT\157pX\SI\134\254\187\&5\178[\235\215\141", _willMsg = "\183~",
// _willProps = []}), _cleanSession = True, _keepAlive = 4897, _connID = "\215ES)\213\"\RS\149\165\167\252\216_\166",
// _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x39, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x13, 0x21, 0x0,  0xe,  0xd7,
                   0x45, 0x53, 0x29, 0xd5, 0x22, 0x1e, 0x95, 0xa5, 0xa7, 0xfc, 0xd8, 0x5f, 0xa6, 0x0,  0x19,
                   0xa7, 0xba, 0x2c, 0xe1, 0xe7, 0xa,  0xe5, 0x52, 0x53, 0x9e, 0x6e, 0x4,  0x9d, 0x70, 0x58,
                   0xf,  0x86, 0xfe, 0xbb, 0x35, 0xb2, 0x5b, 0xeb, 0xd7, 0x8d, 0x0,  0x2,  0xb7, 0x7e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa7, 0xba, 0x2c, 0xe1, 0xe7, 0xa,  0xe5, 0x52, 0x53, 0x9e, 0x6e, 0x4, 0x9d,
                                0x70, 0x58, 0xf,  0x86, 0xfe, 0xbb, 0x35, 0xb2, 0x5b, 0xeb, 0xd7, 0x8d};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb7, 0x7e};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4897;
  uint8_t client_id_bytes[] = {0xd7, 0x45, 0x53, 0x29, 0xd5, 0x22, 0x1e, 0x95, 0xa5, 0xa7, 0xfc, 0xd8, 0x5f, 0xa6};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\179\171\192\219e27\202\244Y\238\&9\151", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\221\239\USQ\"", _willMsg = "", _willProps = []}),
// _cleanSession = False, _keepAlive = 28246, _connID =
// "6S\138\205\221\220lm\242_x6\230\192\DC4\219\134u\DC40\191tP^\212\247", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x2f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x14, 0x6e, 0x56, 0x0,  0x1a, 0x36, 0x53, 0x8a,
                   0xcd, 0xdd, 0xdc, 0x6c, 0x6d, 0xf2, 0x5f, 0x78, 0x36, 0xe6, 0xc0, 0x14, 0xdb, 0x86, 0x75, 0x14, 0x30,
                   0xbf, 0x74, 0x50, 0x5e, 0xd4, 0xf7, 0x0,  0x5,  0xdd, 0xef, 0x1f, 0x51, 0x22, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdd, 0xef, 0x1f, 0x51, 0x22};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28246;
  uint8_t client_id_bytes[] = {0x36, 0x53, 0x8a, 0xcd, 0xdd, 0xdc, 0x6c, 0x6d, 0xf2, 0x5f, 0x78, 0x36, 0xe6,
                               0xc0, 0x14, 0xdb, 0x86, 0x75, 0x14, 0x30, 0xbf, 0x74, 0x50, 0x5e, 0xd4, 0xf7};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb3, 0xab, 0xc0, 0xdb, 0x65, 0x32, 0x37, 0xca, 0xf4, 0x59, 0xee, 0x39, 0x97};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "a\240\130l{", _password = Just
// "\139\168iv\184\216p\167\249\142\150\188G^'\235a\GS", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic =
// "\DC4\144\178\229\CAN\160\DC2\233\SI\160\DC1G\219\173\175\r\161\&3\250\246\200\250\r\199J\154\165\195\221\237",
// _willMsg = " \207(\FS?\175Cq\NUL\154(\203(\186\197\156`\189O\255\195\169\153\RS\226\b`h", _willProps = []}),
// _cleanSession = True, _keepAlive = 13826, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x65, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x36, 0x2,  0x0,  0x0,  0x0,
                   0x1e, 0x14, 0x90, 0xb2, 0xe5, 0x18, 0xa0, 0x12, 0xe9, 0xf,  0xa0, 0x11, 0x47, 0xdb, 0xad,
                   0xaf, 0xd,  0xa1, 0x33, 0xfa, 0xf6, 0xc8, 0xfa, 0xd,  0xc7, 0x4a, 0x9a, 0xa5, 0xc3, 0xdd,
                   0xed, 0x0,  0x1c, 0x20, 0xcf, 0x28, 0x1c, 0x3f, 0xaf, 0x43, 0x71, 0x0,  0x9a, 0x28, 0xcb,
                   0x28, 0xba, 0xc5, 0x9c, 0x60, 0xbd, 0x4f, 0xff, 0xc3, 0xa9, 0x99, 0x1e, 0xe2, 0x8,  0x60,
                   0x68, 0x0,  0x5,  0x61, 0xf0, 0x82, 0x6c, 0x7b, 0x0,  0x12, 0x8b, 0xa8, 0x69, 0x76, 0xb8,
                   0xd8, 0x70, 0xa7, 0xf9, 0x8e, 0x96, 0xbc, 0x47, 0x5e, 0x27, 0xeb, 0x61, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x14, 0x90, 0xb2, 0xe5, 0x18, 0xa0, 0x12, 0xe9, 0xf,  0xa0,
                                0x11, 0x47, 0xdb, 0xad, 0xaf, 0xd,  0xa1, 0x33, 0xfa, 0xf6,
                                0xc8, 0xfa, 0xd,  0xc7, 0x4a, 0x9a, 0xa5, 0xc3, 0xdd, 0xed};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x20, 0xcf, 0x28, 0x1c, 0x3f, 0xaf, 0x43, 0x71, 0x0,  0x9a, 0x28, 0xcb, 0x28, 0xba,
                                  0xc5, 0x9c, 0x60, 0xbd, 0x4f, 0xff, 0xc3, 0xa9, 0x99, 0x1e, 0xe2, 0x8,  0x60, 0x68};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13826;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x61, 0xf0, 0x82, 0x6c, 0x7b};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x8b, 0xa8, 0x69, 0x76, 0xb8, 0xd8, 0x70, 0xa7, 0xf9,
                              0x8e, 0x96, 0xbc, 0x47, 0x5e, 0x27, 0xeb, 0x61, 0x1d};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\212\GS\145\247\v\161", _password = Just "{!\212\236\201\231Q", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "", _willMsg =
// "]9\230\162rqS\215\197\SI\129\173\160\"j\ACK\181\v\226\253X\189\&4\146\169\138%\143$", _willProps = []}),
// _cleanSession = True, _keepAlive = 10261, _connID = "\137\n\r\250!\209\SO\245\&0\146@>\253V:\197D", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x4f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x28, 0x15, 0x0,  0x11, 0x89, 0xa,  0xd,
                   0xfa, 0x21, 0xd1, 0xe,  0xf5, 0x30, 0x92, 0x40, 0x3e, 0xfd, 0x56, 0x3a, 0xc5, 0x44, 0x0,  0x0,  0x0,
                   0x1d, 0x5d, 0x39, 0xe6, 0xa2, 0x72, 0x71, 0x53, 0xd7, 0xc5, 0xf,  0x81, 0xad, 0xa0, 0x22, 0x6a, 0x6,
                   0xb5, 0xb,  0xe2, 0xfd, 0x58, 0xbd, 0x34, 0x92, 0xa9, 0x8a, 0x25, 0x8f, 0x24, 0x0,  0x6,  0xd4, 0x1d,
                   0x91, 0xf7, 0xb,  0xa1, 0x0,  0x7,  0x7b, 0x21, 0xd4, 0xec, 0xc9, 0xe7, 0x51};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5d, 0x39, 0xe6, 0xa2, 0x72, 0x71, 0x53, 0xd7, 0xc5, 0xf,
                                  0x81, 0xad, 0xa0, 0x22, 0x6a, 0x6,  0xb5, 0xb,  0xe2, 0xfd,
                                  0x58, 0xbd, 0x34, 0x92, 0xa9, 0x8a, 0x25, 0x8f, 0x24};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10261;
  uint8_t client_id_bytes[] = {0x89, 0xa,  0xd,  0xfa, 0x21, 0xd1, 0xe,  0xf5, 0x30,
                               0x92, 0x40, 0x3e, 0xfd, 0x56, 0x3a, 0xc5, 0x44};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd4, 0x1d, 0x91, 0xf7, 0xb, 0xa1};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x7b, 0x21, 0xd4, 0xec, 0xc9, 0xe7, 0x51};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\221\242}\231\174B\GS\239\159Y\168\135+?h\249\&9`9<\191\211!\157\134\174",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\181\SUB\128:,a\250\247V)\184\235rKQORD!\154\244M\a", _willMsg =
// "\160\135:w_\160cdu\218\207\198\170\214\131\252w*0\v\204\191\186\ACK\224v", _willProps = []}), _cleanSession = False,
// _keepAlive = 27848, _connID = "|c\",E\248\&4\129\STX\254\128^\SYNv\175", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x6c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xac, 0x6c, 0xc8, 0x0,  0xf,  0x7c, 0x63,
                   0x22, 0x2c, 0x45, 0xf8, 0x34, 0x81, 0x2,  0xfe, 0x80, 0x5e, 0x16, 0x76, 0xaf, 0x0,  0x17, 0xb5,
                   0x1a, 0x80, 0x3a, 0x2c, 0x61, 0xfa, 0xf7, 0x56, 0x29, 0xb8, 0xeb, 0x72, 0x4b, 0x51, 0x4f, 0x52,
                   0x44, 0x21, 0x9a, 0xf4, 0x4d, 0x7,  0x0,  0x1a, 0xa0, 0x87, 0x3a, 0x77, 0x5f, 0xa0, 0x63, 0x64,
                   0x75, 0xda, 0xcf, 0xc6, 0xaa, 0xd6, 0x83, 0xfc, 0x77, 0x2a, 0x30, 0xb,  0xcc, 0xbf, 0xba, 0x6,
                   0xe0, 0x76, 0x0,  0x1a, 0xdd, 0xf2, 0x7d, 0xe7, 0xae, 0x42, 0x1d, 0xef, 0x9f, 0x59, 0xa8, 0x87,
                   0x2b, 0x3f, 0x68, 0xf9, 0x39, 0x60, 0x39, 0x3c, 0xbf, 0xd3, 0x21, 0x9d, 0x86, 0xae};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb5, 0x1a, 0x80, 0x3a, 0x2c, 0x61, 0xfa, 0xf7, 0x56, 0x29, 0xb8, 0xeb,
                                0x72, 0x4b, 0x51, 0x4f, 0x52, 0x44, 0x21, 0x9a, 0xf4, 0x4d, 0x7};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa0, 0x87, 0x3a, 0x77, 0x5f, 0xa0, 0x63, 0x64, 0x75, 0xda, 0xcf, 0xc6, 0xaa,
                                  0xd6, 0x83, 0xfc, 0x77, 0x2a, 0x30, 0xb,  0xcc, 0xbf, 0xba, 0x6,  0xe0, 0x76};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27848;
  uint8_t client_id_bytes[] = {0x7c, 0x63, 0x22, 0x2c, 0x45, 0xf8, 0x34, 0x81, 0x2, 0xfe, 0x80, 0x5e, 0x16, 0x76, 0xaf};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xdd, 0xf2, 0x7d, 0xe7, 0xae, 0x42, 0x1d, 0xef, 0x9f, 0x59, 0xa8, 0x87, 0x2b,
                              0x3f, 0x68, 0xf9, 0x39, 0x60, 0x39, 0x3c, 0xbf, 0xd3, 0x21, 0x9d, 0x86, 0xae};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\235w\132m]\248$4\232\&0\249V\214\DEL\182\170\EOT\DLE\DC1\212X\147-\207\&0",
// _password = Just "B\245\236\128\196\"\v\166[\CAN\160u\146&\ENQ*\DC1tN?h", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\141", _willMsg = "\251\154\202\252\&51i(\SOK", _willProps = []}),
// _cleanSession = True, _keepAlive = 7077, _connID = "\166\&2\183R\234\EM*\227 \nz\SYN\ENQ", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x1b, 0xa5, 0x0,  0xd,  0xa6, 0x32,
                   0xb7, 0x52, 0xea, 0x19, 0x2a, 0xe3, 0x20, 0xa,  0x7a, 0x16, 0x5,  0x0,  0x1,  0x8d, 0x0,  0xa,
                   0xfb, 0x9a, 0xca, 0xfc, 0x35, 0x31, 0x69, 0x28, 0xe,  0x4b, 0x0,  0x19, 0xeb, 0x77, 0x84, 0x6d,
                   0x5d, 0xf8, 0x24, 0x34, 0xe8, 0x30, 0xf9, 0x56, 0xd6, 0x7f, 0xb6, 0xaa, 0x4,  0x10, 0x11, 0xd4,
                   0x58, 0x93, 0x2d, 0xcf, 0x30, 0x0,  0x15, 0x42, 0xf5, 0xec, 0x80, 0xc4, 0x22, 0xb,  0xa6, 0x5b,
                   0x18, 0xa0, 0x75, 0x92, 0x26, 0x5,  0x2a, 0x11, 0x74, 0x4e, 0x3f, 0x68};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8d};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb, 0x9a, 0xca, 0xfc, 0x35, 0x31, 0x69, 0x28, 0xe, 0x4b};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7077;
  uint8_t client_id_bytes[] = {0xa6, 0x32, 0xb7, 0x52, 0xea, 0x19, 0x2a, 0xe3, 0x20, 0xa, 0x7a, 0x16, 0x5};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xeb, 0x77, 0x84, 0x6d, 0x5d, 0xf8, 0x24, 0x34, 0xe8, 0x30, 0xf9, 0x56, 0xd6,
                              0x7f, 0xb6, 0xaa, 0x4,  0x10, 0x11, 0xd4, 0x58, 0x93, 0x2d, 0xcf, 0x30};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x42, 0xf5, 0xec, 0x80, 0xc4, 0x22, 0xb,  0xa6, 0x5b, 0x18, 0xa0,
                              0x75, 0x92, 0x26, 0x5,  0x2a, 0x11, 0x74, 0x4e, 0x3f, 0x68};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just " \173\&3f\DC4", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\SUB\224\241\aY%\155\222\143G\155T\163lx\218+", _willMsg =
// "m\130Tq\186R\196\157\v\245\FS\140\202\ETB\143\v\188\159\199\242\237\249A\DEL", _willProps = []}), _cleanSession =
// True, _keepAlive = 16885, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8e, 0x41, 0xf5, 0x0,  0x0,  0x0,  0x11, 0x1a,
                   0xe0, 0xf1, 0x7,  0x59, 0x25, 0x9b, 0xde, 0x8f, 0x47, 0x9b, 0x54, 0xa3, 0x6c, 0x78, 0xda, 0x2b, 0x0,
                   0x18, 0x6d, 0x82, 0x54, 0x71, 0xba, 0x52, 0xc4, 0x9d, 0xb,  0xf5, 0x1c, 0x8c, 0xca, 0x17, 0x8f, 0xb,
                   0xbc, 0x9f, 0xc7, 0xf2, 0xed, 0xf9, 0x41, 0x7f, 0x0,  0x5,  0x20, 0xad, 0x33, 0x66, 0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1a, 0xe0, 0xf1, 0x7,  0x59, 0x25, 0x9b, 0xde, 0x8f,
                                0x47, 0x9b, 0x54, 0xa3, 0x6c, 0x78, 0xda, 0x2b};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6d, 0x82, 0x54, 0x71, 0xba, 0x52, 0xc4, 0x9d, 0xb,  0xf5, 0x1c, 0x8c,
                                  0xca, 0x17, 0x8f, 0xb,  0xbc, 0x9f, 0xc7, 0xf2, 0xed, 0xf9, 0x41, 0x7f};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16885;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x20, 0xad, 0x33, 0x66, 0x14};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\162\146\138\141K)\DEL\142\&8zW\163\DC2M#\138\ENQ\NUL\134\235\203", _password =
// Just "\133\n\206/_y\134\132\146/\225s 4O\210\144\130\GS\148b", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "\251\220\159\161T\129^\175\210\212\RS0Yh\NAK\141{5\207lv\193\253\209", _willMsg =
// "\202{q\255\165\RS", _willProps = []}), _cleanSession = False, _keepAlive = 28167, _connID =
// "v\243\203T}\236\142\226\SI\204\157\191\223\138y\DC4\252\163\134", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x6f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x6e, 0x7,  0x0,  0x13, 0x76, 0xf3, 0xcb,
                   0x54, 0x7d, 0xec, 0x8e, 0xe2, 0xf,  0xcc, 0x9d, 0xbf, 0xdf, 0x8a, 0x79, 0x14, 0xfc, 0xa3, 0x86, 0x0,
                   0x18, 0xfb, 0xdc, 0x9f, 0xa1, 0x54, 0x81, 0x5e, 0xaf, 0xd2, 0xd4, 0x1e, 0x30, 0x59, 0x68, 0x15, 0x8d,
                   0x7b, 0x35, 0xcf, 0x6c, 0x76, 0xc1, 0xfd, 0xd1, 0x0,  0x6,  0xca, 0x7b, 0x71, 0xff, 0xa5, 0x1e, 0x0,
                   0x15, 0xa2, 0x92, 0x8a, 0x8d, 0x4b, 0x29, 0x7f, 0x8e, 0x38, 0x7a, 0x57, 0xa3, 0x12, 0x4d, 0x23, 0x8a,
                   0x5,  0x0,  0x86, 0xeb, 0xcb, 0x0,  0x15, 0x85, 0xa,  0xce, 0x2f, 0x5f, 0x79, 0x86, 0x84, 0x92, 0x2f,
                   0xe1, 0x73, 0x20, 0x34, 0x4f, 0xd2, 0x90, 0x82, 0x1d, 0x94, 0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfb, 0xdc, 0x9f, 0xa1, 0x54, 0x81, 0x5e, 0xaf, 0xd2, 0xd4, 0x1e, 0x30,
                                0x59, 0x68, 0x15, 0x8d, 0x7b, 0x35, 0xcf, 0x6c, 0x76, 0xc1, 0xfd, 0xd1};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xca, 0x7b, 0x71, 0xff, 0xa5, 0x1e};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28167;
  uint8_t client_id_bytes[] = {0x76, 0xf3, 0xcb, 0x54, 0x7d, 0xec, 0x8e, 0xe2, 0xf, 0xcc,
                               0x9d, 0xbf, 0xdf, 0x8a, 0x79, 0x14, 0xfc, 0xa3, 0x86};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa2, 0x92, 0x8a, 0x8d, 0x4b, 0x29, 0x7f, 0x8e, 0x38, 0x7a, 0x57,
                              0xa3, 0x12, 0x4d, 0x23, 0x8a, 0x5,  0x0,  0x86, 0xeb, 0xcb};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x85, 0xa,  0xce, 0x2f, 0x5f, 0x79, 0x86, 0x84, 0x92, 0x2f, 0xe1,
                              0x73, 0x20, 0x34, 0x4f, 0xd2, 0x90, 0x82, 0x1d, 0x94, 0x62};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Ub", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS2, _willTopic = "\EM\162\218\226Q\179}\211\ETB\242\188\157(\150\&7-", _willMsg = "\146#K\CAN-7w\161\228\157",
// _willProps = []}), _cleanSession = False, _keepAlive = 618, _connID = "\193\150\ENQ", _properties = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x31, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb4, 0x2,  0x6a, 0x0,
                   0x3,  0xc1, 0x96, 0x5,  0x0,  0x10, 0x19, 0xa2, 0xda, 0xe2, 0x51, 0xb3, 0x7d,
                   0xd3, 0x17, 0xf2, 0xbc, 0x9d, 0x28, 0x96, 0x37, 0x2d, 0x0,  0xa,  0x92, 0x23,
                   0x4b, 0x18, 0x2d, 0x37, 0x77, 0xa1, 0xe4, 0x9d, 0x0,  0x2,  0x55, 0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x19, 0xa2, 0xda, 0xe2, 0x51, 0xb3, 0x7d, 0xd3,
                                0x17, 0xf2, 0xbc, 0x9d, 0x28, 0x96, 0x37, 0x2d};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x92, 0x23, 0x4b, 0x18, 0x2d, 0x37, 0x77, 0xa1, 0xe4, 0x9d};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 618;
  uint8_t client_id_bytes[] = {0xc1, 0x96, 0x5};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x55, 0x62};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\212\178\194\175\",\DC4\189\220\226\206U\131Q\182\202p\244\242D;\212\175m*\194WT\207", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\DC24\133\225%k\SOHa\149\232\DC3}q\224", _willMsg = "\226\225\232\214\198L7\156\&6H\247\231\176X'm", _willProps =
// []}), _cleanSession = True, _keepAlive = 5852, _connID = "|\199", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x4f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xae, 0x16, 0xdc, 0x0,  0x2,  0x7c, 0xc7, 0x0,
                   0xe,  0x12, 0x34, 0x85, 0xe1, 0x25, 0x6b, 0x1,  0x61, 0x95, 0xe8, 0x13, 0x7d, 0x71, 0xe0, 0x0,  0x10,
                   0xe2, 0xe1, 0xe8, 0xd6, 0xc6, 0x4c, 0x37, 0x9c, 0x36, 0x48, 0xf7, 0xe7, 0xb0, 0x58, 0x27, 0x6d, 0x0,
                   0x1d, 0xd4, 0xb2, 0xc2, 0xaf, 0x22, 0x2c, 0x14, 0xbd, 0xdc, 0xe2, 0xce, 0x55, 0x83, 0x51, 0xb6, 0xca,
                   0x70, 0xf4, 0xf2, 0x44, 0x3b, 0xd4, 0xaf, 0x6d, 0x2a, 0xc2, 0x57, 0x54, 0xcf};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x12, 0x34, 0x85, 0xe1, 0x25, 0x6b, 0x1, 0x61, 0x95, 0xe8, 0x13, 0x7d, 0x71, 0xe0};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe2, 0xe1, 0xe8, 0xd6, 0xc6, 0x4c, 0x37, 0x9c,
                                  0x36, 0x48, 0xf7, 0xe7, 0xb0, 0x58, 0x27, 0x6d};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5852;
  uint8_t client_id_bytes[] = {0x7c, 0xc7};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd4, 0xb2, 0xc2, 0xaf, 0x22, 0x2c, 0x14, 0xbd, 0xdc, 0xe2, 0xce, 0x55, 0x83, 0x51, 0xb6,
                              0xca, 0x70, 0xf4, 0xf2, 0x44, 0x3b, 0xd4, 0xaf, 0x6d, 0x2a, 0xc2, 0x57, 0x54, 0xcf};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "2\DC1\197\140\172\STX\245\224", _password = Just
// "C\232\160\f\216\162\204\154\165\248\249\194\&5g\172\177\236\DC2\EOT\245\214\156", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic =
// "$\RSC_\156\STX\165$\246x_\195(]^\f\a%\232O\vf\"\180\174\135\223!8`", _willMsg =
// "\190'c\128\&6\169\239\f\a\GS\246\152}\153\215\ACK\SOH9\248\193A\224\237\179", _willProps = []}), _cleanSession =
// True, _keepAlive = 12387, _connID = "\ETX\SYN\DC2\a\ETB\224\158xuW\n\236S\134\138\198\CAN\SI\bp", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x7c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x30, 0x63, 0x0,  0x14, 0x3,  0x16,
                   0x12, 0x7,  0x17, 0xe0, 0x9e, 0x78, 0x75, 0x57, 0xa,  0xec, 0x53, 0x86, 0x8a, 0xc6, 0x18, 0xf,
                   0x8,  0x70, 0x0,  0x1e, 0x24, 0x1e, 0x43, 0x5f, 0x9c, 0x2,  0xa5, 0x24, 0xf6, 0x78, 0x5f, 0xc3,
                   0x28, 0x5d, 0x5e, 0xc,  0x7,  0x25, 0xe8, 0x4f, 0xb,  0x66, 0x22, 0xb4, 0xae, 0x87, 0xdf, 0x21,
                   0x38, 0x60, 0x0,  0x18, 0xbe, 0x27, 0x63, 0x80, 0x36, 0xa9, 0xef, 0xc,  0x7,  0x1d, 0xf6, 0x98,
                   0x7d, 0x99, 0xd7, 0x6,  0x1,  0x39, 0xf8, 0xc1, 0x41, 0xe0, 0xed, 0xb3, 0x0,  0x8,  0x32, 0x11,
                   0xc5, 0x8c, 0xac, 0x2,  0xf5, 0xe0, 0x0,  0x16, 0x43, 0xe8, 0xa0, 0xc,  0xd8, 0xa2, 0xcc, 0x9a,
                   0xa5, 0xf8, 0xf9, 0xc2, 0x35, 0x67, 0xac, 0xb1, 0xec, 0x12, 0x4,  0xf5, 0xd6, 0x9c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x24, 0x1e, 0x43, 0x5f, 0x9c, 0x2,  0xa5, 0x24, 0xf6, 0x78,
                                0x5f, 0xc3, 0x28, 0x5d, 0x5e, 0xc,  0x7,  0x25, 0xe8, 0x4f,
                                0xb,  0x66, 0x22, 0xb4, 0xae, 0x87, 0xdf, 0x21, 0x38, 0x60};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbe, 0x27, 0x63, 0x80, 0x36, 0xa9, 0xef, 0xc,  0x7,  0x1d, 0xf6, 0x98,
                                  0x7d, 0x99, 0xd7, 0x6,  0x1,  0x39, 0xf8, 0xc1, 0x41, 0xe0, 0xed, 0xb3};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12387;
  uint8_t client_id_bytes[] = {0x3, 0x16, 0x12, 0x7,  0x17, 0xe0, 0x9e, 0x78, 0x75, 0x57,
                               0xa, 0xec, 0x53, 0x86, 0x8a, 0xc6, 0x18, 0xf,  0x8,  0x70};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x32, 0x11, 0xc5, 0x8c, 0xac, 0x2, 0xf5, 0xe0};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x43, 0xe8, 0xa0, 0xc,  0xd8, 0xa2, 0xcc, 0x9a, 0xa5, 0xf8, 0xf9,
                              0xc2, 0x35, 0x67, 0xac, 0xb1, 0xec, 0x12, 0x4,  0xf5, 0xd6, 0x9c};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "m\224J\233E\DC3\ETB\NUL`\145\194\ETXi", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 8004, _connID = "\152\175\205\ESC\239\142|}6k\238\178", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x18, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2,  0x1f, 0x44, 0x0,
                   0xc,  0x98, 0xaf, 0xcd, 0x1b, 0xef, 0x8e, 0x7c, 0x7d, 0x36, 0x6b, 0xee, 0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8004;
  uint8_t client_id_bytes[] = {0x98, 0xaf, 0xcd, 0x1b, 0xef, 0x8e, 0x7c, 0x7d, 0x36, 0x6b, 0xee, 0xb2};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x6d, 0xe0, 0x4a, 0xe9, 0x45, 0x13, 0x17, 0x0, 0x60, 0x91, 0xc2, 0x3, 0x69};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\238", _password = Just "\224\167\178Vb~\222\DLE\192\146\197\133L", _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\STX", _willMsg =
// "6D\137\167,4\131\&6\166\145\201\149|\221\&2i\192", _willProps = []}), _cleanSession = False, _keepAlive = 19508,
// _connID = "|\238>", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x37, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x4c, 0x34, 0x0,  0x3,  0x7c,
                   0xee, 0x3e, 0x0,  0x1,  0x2,  0x0,  0x11, 0x36, 0x44, 0x89, 0xa7, 0x2c, 0x34, 0x83, 0x36,
                   0xa6, 0x91, 0xc9, 0x95, 0x7c, 0xdd, 0x32, 0x69, 0xc0, 0x0,  0x1,  0xee, 0x0,  0xd,  0xe0,
                   0xa7, 0xb2, 0x56, 0x62, 0x7e, 0xde, 0x10, 0xc0, 0x92, 0xc5, 0x85, 0x4c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x36, 0x44, 0x89, 0xa7, 0x2c, 0x34, 0x83, 0x36, 0xa6,
                                  0x91, 0xc9, 0x95, 0x7c, 0xdd, 0x32, 0x69, 0xc0};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19508;
  uint8_t client_id_bytes[] = {0x7c, 0xee, 0x3e};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xee};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xa7, 0xb2, 0x56, 0x62, 0x7e, 0xde, 0x10, 0xc0, 0x92, 0xc5, 0x85, 0x4c};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "e\178\176 \SO\167T!\SOH\NAK;b\193\247\SUB\136\189\199\232", _willMsg =
// "\221}\161\196zS\178P*\152}\254\220\196\216\136\161\220\"\NAK", _willProps = []}), _cleanSession = True, _keepAlive =
// 9446, _connID = "\146\132J\ENQ\144\192\ty\167>\184:C\152\133o\\1C\128\253\189]VH\210", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x51, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x6,  0x24, 0xe6, 0x0,  0x1a, 0x92, 0x84, 0x4a,
                   0x5,  0x90, 0xc0, 0x9,  0x79, 0xa7, 0x3e, 0xb8, 0x3a, 0x43, 0x98, 0x85, 0x6f, 0x5c, 0x31, 0x43, 0x80,
                   0xfd, 0xbd, 0x5d, 0x56, 0x48, 0xd2, 0x0,  0x13, 0x65, 0xb2, 0xb0, 0x20, 0xe,  0xa7, 0x54, 0x21, 0x1,
                   0x15, 0x3b, 0x62, 0xc1, 0xf7, 0x1a, 0x88, 0xbd, 0xc7, 0xe8, 0x0,  0x14, 0xdd, 0x7d, 0xa1, 0xc4, 0x7a,
                   0x53, 0xb2, 0x50, 0x2a, 0x98, 0x7d, 0xfe, 0xdc, 0xc4, 0xd8, 0x88, 0xa1, 0xdc, 0x22, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x65, 0xb2, 0xb0, 0x20, 0xe,  0xa7, 0x54, 0x21, 0x1, 0x15,
                                0x3b, 0x62, 0xc1, 0xf7, 0x1a, 0x88, 0xbd, 0xc7, 0xe8};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdd, 0x7d, 0xa1, 0xc4, 0x7a, 0x53, 0xb2, 0x50, 0x2a, 0x98,
                                  0x7d, 0xfe, 0xdc, 0xc4, 0xd8, 0x88, 0xa1, 0xdc, 0x22, 0x15};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 9446;
  uint8_t client_id_bytes[] = {0x92, 0x84, 0x4a, 0x5,  0x90, 0xc0, 0x9,  0x79, 0xa7, 0x3e, 0xb8, 0x3a, 0x43,
                               0x98, 0x85, 0x6f, 0x5c, 0x31, 0x43, 0x80, 0xfd, 0xbd, 0x5d, 0x56, 0x48, 0xd2};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "0\219\168\207u\209FQb\194\255\SYN:\216` ", _password = Just
// "\224\206\238\173\&1\157LS\135\STX\RSL\213\178A\184\&6\185\133\180r1\191O\169\153m\246O", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "\210\254({", _willMsg = "Z\128\204\SOH\NUL\v%", _willProps =
// []}), _cleanSession = False, _keepAlive = 10802, _connID = "\229U\154\147\141\141XPP\181I\226\208\SYN", _properties =
// []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x2a, 0x32, 0x0,  0xe,  0xe5, 0x55,
                   0x9a, 0x93, 0x8d, 0x8d, 0x58, 0x50, 0x50, 0xb5, 0x49, 0xe2, 0xd0, 0x16, 0x0,  0x4,  0xd2, 0xfe,
                   0x28, 0x7b, 0x0,  0x7,  0x5a, 0x80, 0xcc, 0x1,  0x0,  0xb,  0x25, 0x0,  0x10, 0x30, 0xdb, 0xa8,
                   0xcf, 0x75, 0xd1, 0x46, 0x51, 0x62, 0xc2, 0xff, 0x16, 0x3a, 0xd8, 0x60, 0x20, 0x0,  0x1d, 0xe0,
                   0xce, 0xee, 0xad, 0x31, 0x9d, 0x4c, 0x53, 0x87, 0x2,  0x1e, 0x4c, 0xd5, 0xb2, 0x41, 0xb8, 0x36,
                   0xb9, 0x85, 0xb4, 0x72, 0x31, 0xbf, 0x4f, 0xa9, 0x99, 0x6d, 0xf6, 0x4f};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd2, 0xfe, 0x28, 0x7b};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5a, 0x80, 0xcc, 0x1, 0x0, 0xb, 0x25};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10802;
  uint8_t client_id_bytes[] = {0xe5, 0x55, 0x9a, 0x93, 0x8d, 0x8d, 0x58, 0x50, 0x50, 0xb5, 0x49, 0xe2, 0xd0, 0x16};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x30, 0xdb, 0xa8, 0xcf, 0x75, 0xd1, 0x46, 0x51,
                              0x62, 0xc2, 0xff, 0x16, 0x3a, 0xd8, 0x60, 0x20};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xce, 0xee, 0xad, 0x31, 0x9d, 0x4c, 0x53, 0x87, 0x2,  0x1e, 0x4c, 0xd5, 0xb2, 0x41,
                              0xb8, 0x36, 0xb9, 0x85, 0xb4, 0x72, 0x31, 0xbf, 0x4f, 0xa9, 0x99, 0x6d, 0xf6, 0x4f};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\159V\EOT\ENQR\a\169J\EOT", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\SI\SO", _willMsg = "\SUB{\SO\EM\190", _willProps = []}),
// _cleanSession = True, _keepAlive = 3695, _connID = "V\159\161\231\237\200\154\134\206X\143", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x22, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0xe,  0x6f,
                   0x0,  0xb,  0x56, 0x9f, 0xa1, 0xe7, 0xed, 0xc8, 0x9a, 0x86, 0xce, 0x58,
                   0x8f, 0x0,  0x2,  0xf,  0xe,  0x0,  0x5,  0x1a, 0x7b, 0xe,  0x19, 0xbe};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf, 0xe};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1a, 0x7b, 0xe, 0x19, 0xbe};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3695;
  uint8_t client_id_bytes[] = {0x56, 0x9f, 0xa1, 0xe7, 0xed, 0xc8, 0x9a, 0x86, 0xce, 0x58, 0x8f};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9f, 0x56, 0x4, 0x5, 0x52, 0x7, 0xa9, 0x4a, 0x4};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\US\184\177\250\165\178m\202\177\229\250+d\229", _password = Just "4#", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\DLE\157\231\207\176$D\205\246cj\139\212\151\237\181\225\198\182>C\FS", _willMsg =
// "\242\166\\\SYN\191\r\DC2d8\129\239\138\135\230\214]\CAN#K\206\USb%R\215\254\242\255\GS\139", _willProps = []}),
// _cleanSession = True, _keepAlive = 21935, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x58, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x55, 0xaf, 0x0,  0x0,  0x0,
                   0x16, 0x10, 0x9d, 0xe7, 0xcf, 0xb0, 0x24, 0x44, 0xcd, 0xf6, 0x63, 0x6a, 0x8b, 0xd4, 0x97,
                   0xed, 0xb5, 0xe1, 0xc6, 0xb6, 0x3e, 0x43, 0x1c, 0x0,  0x1e, 0xf2, 0xa6, 0x5c, 0x16, 0xbf,
                   0xd,  0x12, 0x64, 0x38, 0x81, 0xef, 0x8a, 0x87, 0xe6, 0xd6, 0x5d, 0x18, 0x23, 0x4b, 0xce,
                   0x1f, 0x62, 0x25, 0x52, 0xd7, 0xfe, 0xf2, 0xff, 0x1d, 0x8b, 0x0,  0xe,  0x1f, 0xb8, 0xb1,
                   0xfa, 0xa5, 0xb2, 0x6d, 0xca, 0xb1, 0xe5, 0xfa, 0x2b, 0x64, 0xe5, 0x0,  0x2,  0x34, 0x23};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x10, 0x9d, 0xe7, 0xcf, 0xb0, 0x24, 0x44, 0xcd, 0xf6, 0x63, 0x6a,
                                0x8b, 0xd4, 0x97, 0xed, 0xb5, 0xe1, 0xc6, 0xb6, 0x3e, 0x43, 0x1c};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf2, 0xa6, 0x5c, 0x16, 0xbf, 0xd,  0x12, 0x64, 0x38, 0x81,
                                  0xef, 0x8a, 0x87, 0xe6, 0xd6, 0x5d, 0x18, 0x23, 0x4b, 0xce,
                                  0x1f, 0x62, 0x25, 0x52, 0xd7, 0xfe, 0xf2, 0xff, 0x1d, 0x8b};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 21935;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1f, 0xb8, 0xb1, 0xfa, 0xa5, 0xb2, 0x6d, 0xca, 0xb1, 0xe5, 0xfa, 0x2b, 0x64, 0xe5};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x34, 0x23};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\223\FS\149\212{Q\139+/s\191U\174l\n\173", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "AbQ~\153\211\195\255aR\240\202u\223", _willMsg =
// "\254\139\131\221\&7y\167\ETX\187I\188O~e\199", _willProps = []}), _cleanSession = False, _keepAlive = 5033, _connID
// = "\168\223\181\140\b\149\&4\184\157\178\201.\ETX\169Tm\178;\228b\\\246\DLE", _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x44, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc,  0x13, 0xa9, 0x0,  0x17,
                   0xa8, 0xdf, 0xb5, 0x8c, 0x8,  0x95, 0x34, 0xb8, 0x9d, 0xb2, 0xc9, 0x2e, 0x3,  0xa9,
                   0x54, 0x6d, 0xb2, 0x3b, 0xe4, 0x62, 0x5c, 0xf6, 0x10, 0x0,  0xe,  0x41, 0x62, 0x51,
                   0x7e, 0x99, 0xd3, 0xc3, 0xff, 0x61, 0x52, 0xf0, 0xca, 0x75, 0xdf, 0x0,  0xf,  0xfe,
                   0x8b, 0x83, 0xdd, 0x37, 0x79, 0xa7, 0x3,  0xbb, 0x49, 0xbc, 0x4f, 0x7e, 0x65, 0xc7};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x41, 0x62, 0x51, 0x7e, 0x99, 0xd3, 0xc3, 0xff, 0x61, 0x52, 0xf0, 0xca, 0x75, 0xdf};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfe, 0x8b, 0x83, 0xdd, 0x37, 0x79, 0xa7, 0x3,
                                  0xbb, 0x49, 0xbc, 0x4f, 0x7e, 0x65, 0xc7};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 5033;
  uint8_t client_id_bytes[] = {0xa8, 0xdf, 0xb5, 0x8c, 0x8,  0x95, 0x34, 0xb8, 0x9d, 0xb2, 0xc9, 0x2e,
                               0x3,  0xa9, 0x54, 0x6d, 0xb2, 0x3b, 0xe4, 0x62, 0x5c, 0xf6, 0x10};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xdf, 0x1c, 0x95, 0xd4, 0x7b, 0x51, 0x8b, 0x2b,
                              0x2f, 0x73, 0xbf, 0x55, 0xae, 0x6c, 0xa,  0xad};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Q\ESC&\174\247\148\240\DEL]\244\244\245", _password = Just "*\202 ;\132", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\130\&6pS\DC2\ACK(Y\152Y\FS\150\ETBy\207\136\204", _willMsg =
// "\164w\254._0\196?\182\141eY\201\165\141n\163\251|\199\160", _willProps = []}), _cleanSession = False, _keepAlive =
// 6835, _connID = "=7\240F\243\217", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x51, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x1a, 0xb3, 0x0,  0x6,  0x3d, 0x37, 0xf0,
                   0x46, 0xf3, 0xd9, 0x0,  0x11, 0x82, 0x36, 0x70, 0x53, 0x12, 0x6,  0x28, 0x59, 0x98, 0x59, 0x1c, 0x96,
                   0x17, 0x79, 0xcf, 0x88, 0xcc, 0x0,  0x15, 0xa4, 0x77, 0xfe, 0x2e, 0x5f, 0x30, 0xc4, 0x3f, 0xb6, 0x8d,
                   0x65, 0x59, 0xc9, 0xa5, 0x8d, 0x6e, 0xa3, 0xfb, 0x7c, 0xc7, 0xa0, 0x0,  0xc,  0x51, 0x1b, 0x26, 0xae,
                   0xf7, 0x94, 0xf0, 0x7f, 0x5d, 0xf4, 0xf4, 0xf5, 0x0,  0x5,  0x2a, 0xca, 0x20, 0x3b, 0x84};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x82, 0x36, 0x70, 0x53, 0x12, 0x6,  0x28, 0x59, 0x98,
                                0x59, 0x1c, 0x96, 0x17, 0x79, 0xcf, 0x88, 0xcc};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0x77, 0xfe, 0x2e, 0x5f, 0x30, 0xc4, 0x3f, 0xb6, 0x8d, 0x65,
                                  0x59, 0xc9, 0xa5, 0x8d, 0x6e, 0xa3, 0xfb, 0x7c, 0xc7, 0xa0};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6835;
  uint8_t client_id_bytes[] = {0x3d, 0x37, 0xf0, 0x46, 0xf3, 0xd9};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x51, 0x1b, 0x26, 0xae, 0xf7, 0x94, 0xf0, 0x7f, 0x5d, 0xf4, 0xf4, 0xf5};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2a, 0xca, 0x20, 0x3b, 0x84};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ">\GSG\161K\206,\183\NAKu{\239\227y\214\238\251\157?\147!,XQ\180\vF\251P", _password
// = Just "\f\192\209\&7\135\205f\134\181\170)xCW.\190E", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\236\202:\200\SO\EMYd\145y6:\171-\DC4 \194", _willMsg =
// "\241\156\177\145\136\DC3h\r\128\187P\182\239\173#\153y0o'\158G\149", _willProps = []}), _cleanSession = True,
// _keepAlive = 12883, _connID = "\191\194\&3\136\GS\t\240", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x71, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x32, 0x53, 0x0,  0x7,  0xbf, 0xc2, 0x33,
                   0x88, 0x1d, 0x9,  0xf0, 0x0,  0x11, 0xec, 0xca, 0x3a, 0xc8, 0xe,  0x19, 0x59, 0x64, 0x91, 0x79, 0x36,
                   0x3a, 0xab, 0x2d, 0x14, 0x20, 0xc2, 0x0,  0x17, 0xf1, 0x9c, 0xb1, 0x91, 0x88, 0x13, 0x68, 0xd,  0x80,
                   0xbb, 0x50, 0xb6, 0xef, 0xad, 0x23, 0x99, 0x79, 0x30, 0x6f, 0x27, 0x9e, 0x47, 0x95, 0x0,  0x1d, 0x3e,
                   0x1d, 0x47, 0xa1, 0x4b, 0xce, 0x2c, 0xb7, 0x15, 0x75, 0x7b, 0xef, 0xe3, 0x79, 0xd6, 0xee, 0xfb, 0x9d,
                   0x3f, 0x93, 0x21, 0x2c, 0x58, 0x51, 0xb4, 0xb,  0x46, 0xfb, 0x50, 0x0,  0x11, 0xc,  0xc0, 0xd1, 0x37,
                   0x87, 0xcd, 0x66, 0x86, 0xb5, 0xaa, 0x29, 0x78, 0x43, 0x57, 0x2e, 0xbe, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xec, 0xca, 0x3a, 0xc8, 0xe,  0x19, 0x59, 0x64, 0x91,
                                0x79, 0x36, 0x3a, 0xab, 0x2d, 0x14, 0x20, 0xc2};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf1, 0x9c, 0xb1, 0x91, 0x88, 0x13, 0x68, 0xd,  0x80, 0xbb, 0x50, 0xb6,
                                  0xef, 0xad, 0x23, 0x99, 0x79, 0x30, 0x6f, 0x27, 0x9e, 0x47, 0x95};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12883;
  uint8_t client_id_bytes[] = {0xbf, 0xc2, 0x33, 0x88, 0x1d, 0x9, 0xf0};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3e, 0x1d, 0x47, 0xa1, 0x4b, 0xce, 0x2c, 0xb7, 0x15, 0x75, 0x7b, 0xef, 0xe3, 0x79, 0xd6,
                              0xee, 0xfb, 0x9d, 0x3f, 0x93, 0x21, 0x2c, 0x58, 0x51, 0xb4, 0xb,  0x46, 0xfb, 0x50};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc,  0xc0, 0xd1, 0x37, 0x87, 0xcd, 0x66, 0x86, 0xb5,
                              0xaa, 0x29, 0x78, 0x43, 0x57, 0x2e, 0xbe, 0x45};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\148o\200m\186<\174\187@H*\199\199k\241N\207z\181$\235z\253j\134{", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "", _willMsg =
// "U\STX\188\199\130;", _willProps = []}), _cleanSession = True, _keepAlive = 3904, _connID =
// "\197#\190r4\236\133\t\SIY\198\226\213\244\145", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8e, 0xf,  0x40, 0x0,  0xf,  0xc5, 0x23, 0xbe,
                   0x72, 0x34, 0xec, 0x85, 0x9,  0xf,  0x59, 0xc6, 0xe2, 0xd5, 0xf4, 0x91, 0x0,  0x0,  0x0,  0x6,  0x55,
                   0x2,  0xbc, 0xc7, 0x82, 0x3b, 0x0,  0x1a, 0x94, 0x6f, 0xc8, 0x6d, 0xba, 0x3c, 0xae, 0xbb, 0x40, 0x48,
                   0x2a, 0xc7, 0xc7, 0x6b, 0xf1, 0x4e, 0xcf, 0x7a, 0xb5, 0x24, 0xeb, 0x7a, 0xfd, 0x6a, 0x86, 0x7b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x55, 0x2, 0xbc, 0xc7, 0x82, 0x3b};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3904;
  uint8_t client_id_bytes[] = {0xc5, 0x23, 0xbe, 0x72, 0x34, 0xec, 0x85, 0x9, 0xf, 0x59, 0xc6, 0xe2, 0xd5, 0xf4, 0x91};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x94, 0x6f, 0xc8, 0x6d, 0xba, 0x3c, 0xae, 0xbb, 0x40, 0x48, 0x2a, 0xc7, 0xc7,
                              0x6b, 0xf1, 0x4e, 0xcf, 0x7a, 0xb5, 0x24, 0xeb, 0x7a, 0xfd, 0x6a, 0x86, 0x7b};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\166@\DEL\142", _willMsg = "\DC3x\226\245Jp\148\STX%\DC1\141\240\169\253\ETXfd\193t^", _willProps
// = []}), _cleanSession = True, _keepAlive = 24545, _connID = "\183#J\202\157\184-\233Zr\211\247l\185=\182\150\193",
// _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x5f, 0xe1, 0x0,  0x12, 0xb7,
                   0x23, 0x4a, 0xca, 0x9d, 0xb8, 0x2d, 0xe9, 0x5a, 0x72, 0xd3, 0xf7, 0x6c, 0xb9, 0x3d, 0xb6,
                   0x96, 0xc1, 0x0,  0x4,  0xa6, 0x40, 0x7f, 0x8e, 0x0,  0x14, 0x13, 0x78, 0xe2, 0xf5, 0x4a,
                   0x70, 0x94, 0x2,  0x25, 0x11, 0x8d, 0xf0, 0xa9, 0xfd, 0x3,  0x66, 0x64, 0xc1, 0x74, 0x5e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa6, 0x40, 0x7f, 0x8e};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x13, 0x78, 0xe2, 0xf5, 0x4a, 0x70, 0x94, 0x2,  0x25, 0x11,
                                  0x8d, 0xf0, 0xa9, 0xfd, 0x3,  0x66, 0x64, 0xc1, 0x74, 0x5e};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24545;
  uint8_t client_id_bytes[] = {0xb7, 0x23, 0x4a, 0xca, 0x9d, 0xb8, 0x2d, 0xe9, 0x5a,
                               0x72, 0xd3, 0xf7, 0x6c, 0xb9, 0x3d, 0xb6, 0x96, 0xc1};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\\\143\216", _password = Just "\151\&6\134W]\238P\207\167\&0Z", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "9", _willMsg =
// "]v\243\130\NULm\134'\201\ESCs\176\166\a;\239\EM", _willProps = []}), _cleanSession = True, _keepAlive = 17718,
// _connID = "\225qY\140\214\227+/\167\SI7\177", _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x45, 0x36, 0x0,  0xc,  0xe1, 0x71, 0x59,
                   0x8c, 0xd6, 0xe3, 0x2b, 0x2f, 0xa7, 0xf,  0x37, 0xb1, 0x0,  0x1,  0x39, 0x0,  0x11, 0x5d, 0x76, 0xf3,
                   0x82, 0x0,  0x6d, 0x86, 0x27, 0xc9, 0x1b, 0x73, 0xb0, 0xa6, 0x7,  0x3b, 0xef, 0x19, 0x0,  0x3,  0x5c,
                   0x8f, 0xd8, 0x0,  0xb,  0x97, 0x36, 0x86, 0x57, 0x5d, 0xee, 0x50, 0xcf, 0xa7, 0x30, 0x5a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x39};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5d, 0x76, 0xf3, 0x82, 0x0, 0x6d, 0x86, 0x27, 0xc9,
                                  0x1b, 0x73, 0xb0, 0xa6, 0x7, 0x3b, 0xef, 0x19};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17718;
  uint8_t client_id_bytes[] = {0xe1, 0x71, 0x59, 0x8c, 0xd6, 0xe3, 0x2b, 0x2f, 0xa7, 0xf, 0x37, 0xb1};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5c, 0x8f, 0xd8};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x97, 0x36, 0x86, 0x57, 0x5d, 0xee, 0x50, 0xcf, 0xa7, 0x30, 0x5a};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\160\151\149a\211\ACK*?\149\202\211vrIu\153\DC2\173\173!\ACK", _password = Just
// "\212\133\STX\STX\240\131p", _lastWill = Nothing, _cleanSession = False, _keepAlive = 1099, _connID =
// "1\a\221\162V\235\244\238\188\&2v1%G\151H4@{\224\180\180\184\194\165\&2\138\141\204", _properties =
// [PropTopicAliasMaximum 31313,PropCorrelationData
// "\EM\156`\194\144Q\221Y\128T\245\213e\134x\b\178\&6\139\210O\142\150\175\244:K\DLE\130",PropResponseTopic
// "\139\&65\223zD[\226\128\144#\142\&5/\237\&0]h\231\145\228\212\253\248p\222k",PropWillDelayInterval
// 16733,PropMessageExpiryInterval 18158,PropSessionExpiryInterval 27136,PropTopicAliasMaximum
// 4386,PropAssignedClientIdentifier
// "VC\234\151/a\191E\ETB\203On\215\244's]\STXPT\204\171\205\ESC/l6\"w!",PropRetainAvailable 236,PropServerReference
// "v\221\208?g\141\SO\&H\174\215\209<j\r",PropContentType "spIE\CAN\225\237\FS\ETBW\156O4",PropPayloadFormatIndicator
// 39,PropRetainAvailable 30,PropServerReference
// "\FS\SOH\203\183\STX\vN\201\&2m\199\217M+YX\166\203N2$\223",PropServerKeepAlive 7963,PropResponseInformation
// ",l\193\ESCG\227\t\176+W\ENQ\143V\RS",PropContentType "c\SI\151\157\191\214Q3\184",PropServerReference
// "\171\&4A\153\SOH\211M\"\184\183\f\185\228Q \n\240\\\235\164\SI\252\ACK\198",PropCorrelationData
// "7\255\130\206\SOH%\184",PropServerKeepAlive 17056,PropReasonString
// "g\NUL\197\188\ETB\134\134\180a\197yIgX\197Y'",PropMessageExpiryInterval 16788]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x10, 0xe0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x4,  0x4b, 0x95, 0x2,  0x22, 0x7a, 0x51, 0x9,
      0x0,  0x1d, 0x19, 0x9c, 0x60, 0xc2, 0x90, 0x51, 0xdd, 0x59, 0x80, 0x54, 0xf5, 0xd5, 0x65, 0x86, 0x78, 0x8,  0xb2,
      0x36, 0x8b, 0xd2, 0x4f, 0x8e, 0x96, 0xaf, 0xf4, 0x3a, 0x4b, 0x10, 0x82, 0x8,  0x0,  0x1b, 0x8b, 0x36, 0x35, 0xdf,
      0x7a, 0x44, 0x5b, 0xe2, 0x80, 0x90, 0x23, 0x8e, 0x35, 0x2f, 0xed, 0x30, 0x5d, 0x68, 0xe7, 0x91, 0xe4, 0xd4, 0xfd,
      0xf8, 0x70, 0xde, 0x6b, 0x18, 0x0,  0x0,  0x41, 0x5d, 0x2,  0x0,  0x0,  0x46, 0xee, 0x11, 0x0,  0x0,  0x6a, 0x0,
      0x22, 0x11, 0x22, 0x12, 0x0,  0x1e, 0x56, 0x43, 0xea, 0x97, 0x2f, 0x61, 0xbf, 0x45, 0x17, 0xcb, 0x4f, 0x6e, 0xd7,
      0xf4, 0x27, 0x73, 0x5d, 0x2,  0x50, 0x54, 0xcc, 0xab, 0xcd, 0x1b, 0x2f, 0x6c, 0x36, 0x22, 0x77, 0x21, 0x25, 0xec,
      0x1c, 0x0,  0xe,  0x76, 0xdd, 0xd0, 0x3f, 0x67, 0x8d, 0xe,  0x48, 0xae, 0xd7, 0xd1, 0x3c, 0x6a, 0xd,  0x3,  0x0,
      0xd,  0x73, 0x70, 0x49, 0x45, 0x18, 0xe1, 0xed, 0x1c, 0x17, 0x57, 0x9c, 0x4f, 0x34, 0x1,  0x27, 0x25, 0x1e, 0x1c,
      0x0,  0x16, 0x1c, 0x1,  0xcb, 0xb7, 0x2,  0xb,  0x4e, 0xc9, 0x32, 0x6d, 0xc7, 0xd9, 0x4d, 0x2b, 0x59, 0x58, 0xa6,
      0xcb, 0x4e, 0x32, 0x24, 0xdf, 0x13, 0x1f, 0x1b, 0x1a, 0x0,  0xe,  0x2c, 0x6c, 0xc1, 0x1b, 0x47, 0xe3, 0x9,  0xb0,
      0x2b, 0x57, 0x5,  0x8f, 0x56, 0x1e, 0x3,  0x0,  0x9,  0x63, 0xf,  0x97, 0x9d, 0xbf, 0xd6, 0x51, 0x33, 0xb8, 0x1c,
      0x0,  0x18, 0xab, 0x34, 0x41, 0x99, 0x1,  0xd3, 0x4d, 0x22, 0xb8, 0xb7, 0xc,  0xb9, 0xe4, 0x51, 0x20, 0xa,  0xf0,
      0x5c, 0xeb, 0xa4, 0xf,  0xfc, 0x6,  0xc6, 0x9,  0x0,  0x7,  0x37, 0xff, 0x82, 0xce, 0x1,  0x25, 0xb8, 0x13, 0x42,
      0xa0, 0x1f, 0x0,  0x11, 0x67, 0x0,  0xc5, 0xbc, 0x17, 0x86, 0x86, 0xb4, 0x61, 0xc5, 0x79, 0x49, 0x67, 0x58, 0xc5,
      0x59, 0x27, 0x2,  0x0,  0x0,  0x41, 0x94, 0x0,  0x1d, 0x31, 0x7,  0xdd, 0xa2, 0x56, 0xeb, 0xf4, 0xee, 0xbc, 0x32,
      0x76, 0x31, 0x25, 0x47, 0x97, 0x48, 0x34, 0x40, 0x7b, 0xe0, 0xb4, 0xb4, 0xb8, 0xc2, 0xa5, 0x32, 0x8a, 0x8d, 0xcc,
      0x0,  0x15, 0xa0, 0x97, 0x95, 0x61, 0xd3, 0x6,  0x2a, 0x3f, 0x95, 0xca, 0xd3, 0x76, 0x72, 0x49, 0x75, 0x99, 0x12,
      0xad, 0xad, 0x21, 0x6,  0x0,  0x7,  0xd4, 0x85, 0x2,  0x2,  0xf0, 0x83, 0x70};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x19, 0x9c, 0x60, 0xc2, 0x90, 0x51, 0xdd, 0x59, 0x80, 0x54, 0xf5, 0xd5, 0x65, 0x86, 0x78,
                           0x8,  0xb2, 0x36, 0x8b, 0xd2, 0x4f, 0x8e, 0x96, 0xaf, 0xf4, 0x3a, 0x4b, 0x10, 0x82};
  uint8_t bytesprops1[] = {0x8b, 0x36, 0x35, 0xdf, 0x7a, 0x44, 0x5b, 0xe2, 0x80, 0x90, 0x23, 0x8e, 0x35, 0x2f,
                           0xed, 0x30, 0x5d, 0x68, 0xe7, 0x91, 0xe4, 0xd4, 0xfd, 0xf8, 0x70, 0xde, 0x6b};
  uint8_t bytesprops2[] = {0x56, 0x43, 0xea, 0x97, 0x2f, 0x61, 0xbf, 0x45, 0x17, 0xcb, 0x4f, 0x6e, 0xd7, 0xf4, 0x27,
                           0x73, 0x5d, 0x2,  0x50, 0x54, 0xcc, 0xab, 0xcd, 0x1b, 0x2f, 0x6c, 0x36, 0x22, 0x77, 0x21};
  uint8_t bytesprops3[] = {0x76, 0xdd, 0xd0, 0x3f, 0x67, 0x8d, 0xe, 0x48, 0xae, 0xd7, 0xd1, 0x3c, 0x6a, 0xd};
  uint8_t bytesprops4[] = {0x73, 0x70, 0x49, 0x45, 0x18, 0xe1, 0xed, 0x1c, 0x17, 0x57, 0x9c, 0x4f, 0x34};
  uint8_t bytesprops5[] = {0x1c, 0x1,  0xcb, 0xb7, 0x2,  0xb,  0x4e, 0xc9, 0x32, 0x6d, 0xc7,
                           0xd9, 0x4d, 0x2b, 0x59, 0x58, 0xa6, 0xcb, 0x4e, 0x32, 0x24, 0xdf};
  uint8_t bytesprops6[] = {0x2c, 0x6c, 0xc1, 0x1b, 0x47, 0xe3, 0x9, 0xb0, 0x2b, 0x57, 0x5, 0x8f, 0x56, 0x1e};
  uint8_t bytesprops7[] = {0x63, 0xf, 0x97, 0x9d, 0xbf, 0xd6, 0x51, 0x33, 0xb8};
  uint8_t bytesprops8[] = {0xab, 0x34, 0x41, 0x99, 0x1,  0xd3, 0x4d, 0x22, 0xb8, 0xb7, 0xc, 0xb9,
                           0xe4, 0x51, 0x20, 0xa,  0xf0, 0x5c, 0xeb, 0xa4, 0xf,  0xfc, 0x6, 0xc6};
  uint8_t bytesprops9[] = {0x37, 0xff, 0x82, 0xce, 0x1, 0x25, 0xb8};
  uint8_t bytesprops10[] = {0x67, 0x0,  0xc5, 0xbc, 0x17, 0x86, 0x86, 0xb4, 0x61,
                            0xc5, 0x79, 0x49, 0x67, 0x58, 0xc5, 0x59, 0x27};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31313}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16733}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18158}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27136}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4386}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7963}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17056}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16788}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1099;
  uint8_t client_id_bytes[] = {0x31, 0x7,  0xdd, 0xa2, 0x56, 0xeb, 0xf4, 0xee, 0xbc, 0x32, 0x76, 0x31, 0x25, 0x47, 0x97,
                               0x48, 0x34, 0x40, 0x7b, 0xe0, 0xb4, 0xb4, 0xb8, 0xc2, 0xa5, 0x32, 0x8a, 0x8d, 0xcc};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa0, 0x97, 0x95, 0x61, 0xd3, 0x6,  0x2a, 0x3f, 0x95, 0xca, 0xd3,
                              0x76, 0x72, 0x49, 0x75, 0x99, 0x12, 0xad, 0xad, 0x21, 0x6};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd4, 0x85, 0x2, 0x2, 0xf0, 0x83, 0x70};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\245\FSg\131", _password = Just "\SO\141\210", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "\152\255\131ME_\ENQ\227\fVV\141\172", _willMsg =
// "\152\v\143\189\254\149a\FS7i\f_\220\240\209\232", _willProps = [PropTopicAlias 11626,PropMessageExpiryInterval
// 920,PropRetainAvailable 101,PropReceiveMaximum 25442,PropReceiveMaximum 28647,PropReceiveMaximum
// 4995,PropCorrelationData "9\214\188g\235\151#\SOH\254\140/\134@\203",PropServerReference
// "Os\152\233\190\EOT\230/|f\179\219\206\225r\164\196\237D8\185\135,\US\SIu",PropRequestProblemInformation
// 223,PropReceiveMaximum 2060,PropRequestProblemInformation 235,PropMaximumPacketSize 24384,PropSubscriptionIdentifier
// 18,PropServerReference "\150\218w\205\136\136SRq\SI\160a\253\ETB\242\151\SYN\ACK;:)q\174\220",PropResponseTopic
// "r\135\221\128(\174\f\223\NAK\153 \247\168\244R\130t\232\162-\144\189",PropContentType
// "\160\246\188P/(j+(",PropSubscriptionIdentifierAvailable 69,PropAssignedClientIdentifier
// "\212\212\148t\237yC)\\x\DEL\231*a@\154\217>\n",PropSubscriptionIdentifierAvailable 144,PropMaximumPacketSize
// 25477,PropWillDelayInterval 18212,PropContentType "lo\137\203\SO\DC2\143hj\SYNVTE\243\197P",PropAuthenticationMethod
// "",PropResponseTopic "$\220+\241\ACK\255\154\161\\[\196C\230@\183\151\DC1\218\&8",PropMessageExpiryInterval
// 22702,PropCorrelationData "",PropMaximumPacketSize 15828,PropReasonString "\129\177\229",PropResponseInformation
// "\213\128\226\159X>\243\ETX\135}\133\&58\220x\213y\252\v(C=C\205\157\205",PropWillDelayInterval 26379]}),
// _cleanSession = True, _keepAlive = 4861, _connID = "=\b:\142\144", _properties = [PropUserProperty
// "\159\246\235\237\139\128\212\129\\\220\222\223\196\232\172\r)\132\&2"
// "c\CAN\ESC'\DC2\DEL/N\204W-\182\226\228\189k\CAN\241'B\186/\ETX\133\"\193J\137N",PropWildcardSubscriptionAvailable
// 95,PropRetainAvailable 190,PropSubscriptionIdentifierAvailable 194,PropCorrelationData
// "0\ETXL\136\181",PropWildcardSubscriptionAvailable 128,PropRetainAvailable 219,PropUserProperty "s"
// "\139|\244\136\ETB\253\223\191\EOT\DC2I\225G\218\218\190nE\217DR",PropSharedSubscriptionAvailable
// 220,PropRetainAvailable 8,PropRequestProblemInformation 64,PropMessageExpiryInterval 6339,PropMaximumQoS
// 142,PropRequestResponseInformation 171,PropTopicAliasMaximum 27261,PropRequestProblemInformation
// 243,PropReceiveMaximum 26619,PropAuthenticationData "j.\254",PropResponseTopic
// "\189\181JM'!\255\213;d\175\182G~j",PropRetainAvailable 249,PropWillDelayInterval 4276,PropSessionExpiryInterval
// 15218,PropSessionExpiryInterval 26486,PropMessageExpiryInterval 22520,PropSubscriptionIdentifier
// 13,PropResponseInformation "N\b\236\146\171\225\169\acTL{\245/\129[q",PropMaximumQoS 191]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0x94, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x12, 0xfd, 0xbf, 0x1,  0x26, 0x0,  0x13, 0x9f,
      0xf6, 0xeb, 0xed, 0x8b, 0x80, 0xd4, 0x81, 0x5c, 0xdc, 0xde, 0xdf, 0xc4, 0xe8, 0xac, 0xd,  0x29, 0x84, 0x32, 0x0,
      0x1d, 0x63, 0x18, 0x1b, 0x27, 0x12, 0x7f, 0x2f, 0x4e, 0xcc, 0x57, 0x2d, 0xb6, 0xe2, 0xe4, 0xbd, 0x6b, 0x18, 0xf1,
      0x27, 0x42, 0xba, 0x2f, 0x3,  0x85, 0x22, 0xc1, 0x4a, 0x89, 0x4e, 0x28, 0x5f, 0x25, 0xbe, 0x29, 0xc2, 0x9,  0x0,
      0x5,  0x30, 0x3,  0x4c, 0x88, 0xb5, 0x28, 0x80, 0x25, 0xdb, 0x26, 0x0,  0x1,  0x73, 0x0,  0x15, 0x8b, 0x7c, 0xf4,
      0x88, 0x17, 0xfd, 0xdf, 0xbf, 0x4,  0x12, 0x49, 0xe1, 0x47, 0xda, 0xda, 0xbe, 0x6e, 0x45, 0xd9, 0x44, 0x52, 0x2a,
      0xdc, 0x25, 0x8,  0x17, 0x40, 0x2,  0x0,  0x0,  0x18, 0xc3, 0x24, 0x8e, 0x19, 0xab, 0x22, 0x6a, 0x7d, 0x17, 0xf3,
      0x21, 0x67, 0xfb, 0x16, 0x0,  0x3,  0x6a, 0x2e, 0xfe, 0x8,  0x0,  0xf,  0xbd, 0xb5, 0x4a, 0x4d, 0x27, 0x21, 0xff,
      0xd5, 0x3b, 0x64, 0xaf, 0xb6, 0x47, 0x7e, 0x6a, 0x25, 0xf9, 0x18, 0x0,  0x0,  0x10, 0xb4, 0x11, 0x0,  0x0,  0x3b,
      0x72, 0x11, 0x0,  0x0,  0x67, 0x76, 0x2,  0x0,  0x0,  0x57, 0xf8, 0xb,  0xd,  0x1a, 0x0,  0x11, 0x4e, 0x8,  0xec,
      0x92, 0xab, 0xe1, 0xa9, 0x7,  0x63, 0x54, 0x4c, 0x7b, 0xf5, 0x2f, 0x81, 0x5b, 0x71, 0x24, 0xbf, 0x0,  0x5,  0x3d,
      0x8,  0x3a, 0x8e, 0x90, 0x94, 0x2,  0x23, 0x2d, 0x6a, 0x2,  0x0,  0x0,  0x3,  0x98, 0x25, 0x65, 0x21, 0x63, 0x62,
      0x21, 0x6f, 0xe7, 0x21, 0x13, 0x83, 0x9,  0x0,  0xe,  0x39, 0xd6, 0xbc, 0x67, 0xeb, 0x97, 0x23, 0x1,  0xfe, 0x8c,
      0x2f, 0x86, 0x40, 0xcb, 0x1c, 0x0,  0x1a, 0x4f, 0x73, 0x98, 0xe9, 0xbe, 0x4,  0xe6, 0x2f, 0x7c, 0x66, 0xb3, 0xdb,
      0xce, 0xe1, 0x72, 0xa4, 0xc4, 0xed, 0x44, 0x38, 0xb9, 0x87, 0x2c, 0x1f, 0xf,  0x75, 0x17, 0xdf, 0x21, 0x8,  0xc,
      0x17, 0xeb, 0x27, 0x0,  0x0,  0x5f, 0x40, 0xb,  0x12, 0x1c, 0x0,  0x18, 0x96, 0xda, 0x77, 0xcd, 0x88, 0x88, 0x53,
      0x52, 0x71, 0xf,  0xa0, 0x61, 0xfd, 0x17, 0xf2, 0x97, 0x16, 0x6,  0x3b, 0x3a, 0x29, 0x71, 0xae, 0xdc, 0x8,  0x0,
      0x16, 0x72, 0x87, 0xdd, 0x80, 0x28, 0xae, 0xc,  0xdf, 0x15, 0x99, 0x20, 0xf7, 0xa8, 0xf4, 0x52, 0x82, 0x74, 0xe8,
      0xa2, 0x2d, 0x90, 0xbd, 0x3,  0x0,  0x9,  0xa0, 0xf6, 0xbc, 0x50, 0x2f, 0x28, 0x6a, 0x2b, 0x28, 0x29, 0x45, 0x12,
      0x0,  0x13, 0xd4, 0xd4, 0x94, 0x74, 0xed, 0x79, 0x43, 0x29, 0x5c, 0x78, 0x7f, 0xe7, 0x2a, 0x61, 0x40, 0x9a, 0xd9,
      0x3e, 0xa,  0x29, 0x90, 0x27, 0x0,  0x0,  0x63, 0x85, 0x18, 0x0,  0x0,  0x47, 0x24, 0x3,  0x0,  0x10, 0x6c, 0x6f,
      0x89, 0xcb, 0xe,  0x12, 0x8f, 0x68, 0x6a, 0x16, 0x56, 0x54, 0x45, 0xf3, 0xc5, 0x50, 0x15, 0x0,  0x0,  0x8,  0x0,
      0x13, 0x24, 0xdc, 0x2b, 0xf1, 0x6,  0xff, 0x9a, 0xa1, 0x5c, 0x5b, 0xc4, 0x43, 0xe6, 0x40, 0xb7, 0x97, 0x11, 0xda,
      0x38, 0x2,  0x0,  0x0,  0x58, 0xae, 0x9,  0x0,  0x0,  0x27, 0x0,  0x0,  0x3d, 0xd4, 0x1f, 0x0,  0x3,  0x81, 0xb1,
      0xe5, 0x1a, 0x0,  0x1a, 0xd5, 0x80, 0xe2, 0x9f, 0x58, 0x3e, 0xf3, 0x3,  0x87, 0x7d, 0x85, 0x35, 0x38, 0xdc, 0x78,
      0xd5, 0x79, 0xfc, 0xb,  0x28, 0x43, 0x3d, 0x43, 0xcd, 0x9d, 0xcd, 0x18, 0x0,  0x0,  0x67, 0xb,  0x0,  0xd,  0x98,
      0xff, 0x83, 0x4d, 0x45, 0x5f, 0x5,  0xe3, 0xc,  0x56, 0x56, 0x8d, 0xac, 0x0,  0x10, 0x98, 0xb,  0x8f, 0xbd, 0xfe,
      0x95, 0x61, 0x1c, 0x37, 0x69, 0xc,  0x5f, 0xdc, 0xf0, 0xd1, 0xe8, 0x0,  0x4,  0xf5, 0x1c, 0x67, 0x83, 0x0,  0x3,
      0xe,  0x8d, 0xd2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x63, 0x18, 0x1b, 0x27, 0x12, 0x7f, 0x2f, 0x4e, 0xcc, 0x57, 0x2d, 0xb6, 0xe2, 0xe4, 0xbd,
                           0x6b, 0x18, 0xf1, 0x27, 0x42, 0xba, 0x2f, 0x3,  0x85, 0x22, 0xc1, 0x4a, 0x89, 0x4e};
  uint8_t bytesprops0[] = {0x9f, 0xf6, 0xeb, 0xed, 0x8b, 0x80, 0xd4, 0x81, 0x5c, 0xdc,
                           0xde, 0xdf, 0xc4, 0xe8, 0xac, 0xd,  0x29, 0x84, 0x32};
  uint8_t bytesprops2[] = {0x30, 0x3, 0x4c, 0x88, 0xb5};
  uint8_t bytesprops4[] = {0x8b, 0x7c, 0xf4, 0x88, 0x17, 0xfd, 0xdf, 0xbf, 0x4,  0x12, 0x49,
                           0xe1, 0x47, 0xda, 0xda, 0xbe, 0x6e, 0x45, 0xd9, 0x44, 0x52};
  uint8_t bytesprops3[] = {0x73};
  uint8_t bytesprops5[] = {0x6a, 0x2e, 0xfe};
  uint8_t bytesprops6[] = {0xbd, 0xb5, 0x4a, 0x4d, 0x27, 0x21, 0xff, 0xd5, 0x3b, 0x64, 0xaf, 0xb6, 0x47, 0x7e, 0x6a};
  uint8_t bytesprops7[] = {0x4e, 0x8,  0xec, 0x92, 0xab, 0xe1, 0xa9, 0x7, 0x63,
                           0x54, 0x4c, 0x7b, 0xf5, 0x2f, 0x81, 0x5b, 0x71};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops0}, .v = {29, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops3}, .v = {21, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6339}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27261}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26619}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4276}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15218}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26486}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22520}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 191}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x39, 0xd6, 0xbc, 0x67, 0xeb, 0x97, 0x23, 0x1, 0xfe, 0x8c, 0x2f, 0x86, 0x40, 0xcb};
  uint8_t byteswillprops1[] = {0x4f, 0x73, 0x98, 0xe9, 0xbe, 0x4,  0xe6, 0x2f, 0x7c, 0x66, 0xb3, 0xdb, 0xce,
                               0xe1, 0x72, 0xa4, 0xc4, 0xed, 0x44, 0x38, 0xb9, 0x87, 0x2c, 0x1f, 0xf,  0x75};
  uint8_t byteswillprops2[] = {0x96, 0xda, 0x77, 0xcd, 0x88, 0x88, 0x53, 0x52, 0x71, 0xf,  0xa0, 0x61,
                               0xfd, 0x17, 0xf2, 0x97, 0x16, 0x6,  0x3b, 0x3a, 0x29, 0x71, 0xae, 0xdc};
  uint8_t byteswillprops3[] = {0x72, 0x87, 0xdd, 0x80, 0x28, 0xae, 0xc,  0xdf, 0x15, 0x99, 0x20,
                               0xf7, 0xa8, 0xf4, 0x52, 0x82, 0x74, 0xe8, 0xa2, 0x2d, 0x90, 0xbd};
  uint8_t byteswillprops4[] = {0xa0, 0xf6, 0xbc, 0x50, 0x2f, 0x28, 0x6a, 0x2b, 0x28};
  uint8_t byteswillprops5[] = {0xd4, 0xd4, 0x94, 0x74, 0xed, 0x79, 0x43, 0x29, 0x5c, 0x78,
                               0x7f, 0xe7, 0x2a, 0x61, 0x40, 0x9a, 0xd9, 0x3e, 0xa};
  uint8_t byteswillprops6[] = {0x6c, 0x6f, 0x89, 0xcb, 0xe,  0x12, 0x8f, 0x68,
                               0x6a, 0x16, 0x56, 0x54, 0x45, 0xf3, 0xc5, 0x50};
  uint8_t byteswillprops7[] = {0};
  uint8_t byteswillprops8[] = {0x24, 0xdc, 0x2b, 0xf1, 0x6,  0xff, 0x9a, 0xa1, 0x5c, 0x5b,
                               0xc4, 0x43, 0xe6, 0x40, 0xb7, 0x97, 0x11, 0xda, 0x38};
  uint8_t byteswillprops9[] = {0};
  uint8_t byteswillprops10[] = {0x81, 0xb1, 0xe5};
  uint8_t byteswillprops11[] = {0xd5, 0x80, 0xe2, 0x9f, 0x58, 0x3e, 0xf3, 0x3,  0x87, 0x7d, 0x85, 0x35, 0x38,
                                0xdc, 0x78, 0xd5, 0x79, 0xfc, 0xb,  0x28, 0x43, 0x3d, 0x43, 0xcd, 0x9d, 0xcd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11626}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 920}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25442}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28647}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4995}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2060}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24384}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25477}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18212}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22702}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15828}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26379}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x98, 0xff, 0x83, 0x4d, 0x45, 0x5f, 0x5, 0xe3, 0xc, 0x56, 0x56, 0x8d, 0xac};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x98, 0xb,  0x8f, 0xbd, 0xfe, 0x95, 0x61, 0x1c,
                                  0x37, 0x69, 0xc,  0x5f, 0xdc, 0xf0, 0xd1, 0xe8};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4861;
  uint8_t client_id_bytes[] = {0x3d, 0x8, 0x3a, 0x8e, 0x90};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf5, 0x1c, 0x67, 0x83};
  lwmqtt_string_t username = {4, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe, 0x8d, 0xd2};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\190~\232\224\v\218x\135\ESC\193\243\132\192\&1\150\134+\245\EOT9\235j\175",
// _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive = 11488, _connID = "", _properties =
// [PropMaximumQoS 223,PropWildcardSubscriptionAvailable 149,PropAuthenticationData
// "-_/y\147\ENQa\135\188\238\227\231M\225F\161\STX",PropResponseTopic "",PropSharedSubscriptionAvailable
// 166,PropReasonString "\136-W\248Fp\FS\128P\"",PropMaximumPacketSize 25315,PropRetainAvailable
// 63,PropMaximumPacketSize 6919,PropMaximumQoS 71,PropReasonString
// "\137\233\ENQ\ETB\207#\ETB\133s\205\209\247\ENQ\135\166u\232\252",PropRequestProblemInformation
// 115,PropServerReference "\219\229\161t|\255&\195!\" \169\248\&0\157\242j\233\228A\195",PropContentType
// "",PropWillDelayInterval 7778,PropRequestProblemInformation 53,PropAuthenticationData
// "\DLE\152\177\194\aV1\129\129\209c\241\249\201\CANb\162*k\194\246.\193q\190\213\145",PropResponseTopic
// "\178\216\236\130\131\234\173\165\&3\222\STX|C\237\197\191}\193\166z\227\160\186\205\176\219\tPW\NAK",PropAuthenticationMethod
// "\202j\240\220\140\STX\182\SI\DC3\SI\200\147\NUL\SYN\fp\n\132)\188\CANp\163\&1\US",PropCorrelationData
// "n;\254\190E\166\160A",PropSubscriptionIdentifier 15,PropSharedSubscriptionAvailable 228,PropPayloadFormatIndicator
// 39,PropServerKeepAlive 29814]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0x87, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x2c, 0xe0, 0xe0, 0x1,  0x24, 0xdf, 0x28, 0x95,
      0x16, 0x0,  0x11, 0x2d, 0x5f, 0x2f, 0x79, 0x93, 0x5,  0x61, 0x87, 0xbc, 0xee, 0xe3, 0xe7, 0x4d, 0xe1, 0x46, 0xa1,
      0x2,  0x8,  0x0,  0x0,  0x2a, 0xa6, 0x1f, 0x0,  0xa,  0x88, 0x2d, 0x57, 0xf8, 0x46, 0x70, 0x1c, 0x80, 0x50, 0x22,
      0x27, 0x0,  0x0,  0x62, 0xe3, 0x25, 0x3f, 0x27, 0x0,  0x0,  0x1b, 0x7,  0x24, 0x47, 0x1f, 0x0,  0x12, 0x89, 0xe9,
      0x5,  0x17, 0xcf, 0x23, 0x17, 0x85, 0x73, 0xcd, 0xd1, 0xf7, 0x5,  0x87, 0xa6, 0x75, 0xe8, 0xfc, 0x17, 0x73, 0x1c,
      0x0,  0x15, 0xdb, 0xe5, 0xa1, 0x74, 0x7c, 0xff, 0x26, 0xc3, 0x21, 0x22, 0x20, 0xa9, 0xf8, 0x30, 0x9d, 0xf2, 0x6a,
      0xe9, 0xe4, 0x41, 0xc3, 0x3,  0x0,  0x0,  0x18, 0x0,  0x0,  0x1e, 0x62, 0x17, 0x35, 0x16, 0x0,  0x1b, 0x10, 0x98,
      0xb1, 0xc2, 0x7,  0x56, 0x31, 0x81, 0x81, 0xd1, 0x63, 0xf1, 0xf9, 0xc9, 0x18, 0x62, 0xa2, 0x2a, 0x6b, 0xc2, 0xf6,
      0x2e, 0xc1, 0x71, 0xbe, 0xd5, 0x91, 0x8,  0x0,  0x1e, 0xb2, 0xd8, 0xec, 0x82, 0x83, 0xea, 0xad, 0xa5, 0x33, 0xde,
      0x2,  0x7c, 0x43, 0xed, 0xc5, 0xbf, 0x7d, 0xc1, 0xa6, 0x7a, 0xe3, 0xa0, 0xba, 0xcd, 0xb0, 0xdb, 0x9,  0x50, 0x57,
      0x15, 0x15, 0x0,  0x19, 0xca, 0x6a, 0xf0, 0xdc, 0x8c, 0x2,  0xb6, 0xf,  0x13, 0xf,  0xc8, 0x93, 0x0,  0x16, 0xc,
      0x70, 0xa,  0x84, 0x29, 0xbc, 0x18, 0x70, 0xa3, 0x31, 0x1f, 0x9,  0x0,  0x8,  0x6e, 0x3b, 0xfe, 0xbe, 0x45, 0xa6,
      0xa0, 0x41, 0xb,  0xf,  0x2a, 0xe4, 0x1,  0x27, 0x13, 0x74, 0x76, 0x0,  0x0,  0x0,  0x17, 0xbe, 0x7e, 0xe8, 0xe0,
      0xb,  0xda, 0x78, 0x87, 0x1b, 0xc1, 0xf3, 0x84, 0xc0, 0x31, 0x96, 0x86, 0x2b, 0xf5, 0x4,  0x39, 0xeb, 0x6a, 0xaf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2d, 0x5f, 0x2f, 0x79, 0x93, 0x5,  0x61, 0x87, 0xbc,
                           0xee, 0xe3, 0xe7, 0x4d, 0xe1, 0x46, 0xa1, 0x2};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x88, 0x2d, 0x57, 0xf8, 0x46, 0x70, 0x1c, 0x80, 0x50, 0x22};
  uint8_t bytesprops3[] = {0x89, 0xe9, 0x5,  0x17, 0xcf, 0x23, 0x17, 0x85, 0x73,
                           0xcd, 0xd1, 0xf7, 0x5,  0x87, 0xa6, 0x75, 0xe8, 0xfc};
  uint8_t bytesprops4[] = {0xdb, 0xe5, 0xa1, 0x74, 0x7c, 0xff, 0x26, 0xc3, 0x21, 0x22, 0x20,
                           0xa9, 0xf8, 0x30, 0x9d, 0xf2, 0x6a, 0xe9, 0xe4, 0x41, 0xc3};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x10, 0x98, 0xb1, 0xc2, 0x7,  0x56, 0x31, 0x81, 0x81, 0xd1, 0x63, 0xf1, 0xf9, 0xc9,
                           0x18, 0x62, 0xa2, 0x2a, 0x6b, 0xc2, 0xf6, 0x2e, 0xc1, 0x71, 0xbe, 0xd5, 0x91};
  uint8_t bytesprops7[] = {0xb2, 0xd8, 0xec, 0x82, 0x83, 0xea, 0xad, 0xa5, 0x33, 0xde, 0x2,  0x7c, 0x43, 0xed, 0xc5,
                           0xbf, 0x7d, 0xc1, 0xa6, 0x7a, 0xe3, 0xa0, 0xba, 0xcd, 0xb0, 0xdb, 0x9,  0x50, 0x57, 0x15};
  uint8_t bytesprops8[] = {0xca, 0x6a, 0xf0, 0xdc, 0x8c, 0x2,  0xb6, 0xf,  0x13, 0xf,  0xc8, 0x93, 0x0,
                           0x16, 0xc,  0x70, 0xa,  0x84, 0x29, 0xbc, 0x18, 0x70, 0xa3, 0x31, 0x1f};
  uint8_t bytesprops9[] = {0x6e, 0x3b, 0xfe, 0xbe, 0x45, 0xa6, 0xa0, 0x41};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25315}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6919}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7778}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29814}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11488;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbe, 0x7e, 0xe8, 0xe0, 0xb,  0xda, 0x78, 0x87, 0x1b, 0xc1, 0xf3, 0x84,
                              0xc0, 0x31, 0x96, 0x86, 0x2b, 0xf5, 0x4,  0x39, 0xeb, 0x6a, 0xaf};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "_\DLE\201\254`\162\246\240I", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "\248J", _willMsg =
// "\RSG\205\252\RSP\173\SO\195\CAN\209PX\DC1c:\218\166G\158\ACK", _willProps = [PropReceiveMaximum
// 2303,PropRetainAvailable 55,PropMessageExpiryInterval 30752,PropRetainAvailable 95,PropResponseTopic
// "\vKr\227\129\189d",PropContentType "#\SOz\SOH\223\DC2;\ESC;\NULc8\199",PropSharedSubscriptionAvailable
// 83,PropWillDelayInterval 19746]}), _cleanSession = True, _keepAlive = 31889, _connID =
// "I.j%\170?\194\183h\143.\150\255", _properties = [PropAssignedClientIdentifier
// "\234P\ETB(T\179\STX\247\STXs\207SoA\133(=\STXG\191\201{\ENQ\225\DC2",PropAssignedClientIdentifier
// "\141^o",PropPayloadFormatIndicator 172,PropWillDelayInterval 32628,PropServerReference
// "\135V\185W\131B^\149\189\&8\216\232K\244",PropUserProperty "q2F\169"
// "\191Vo,\205a\218\174\USbTj\162G\243\177_>1\158$\232",PropMaximumQoS 203,PropTopicAliasMaximum
// 6794,PropAuthenticationMethod
// "\225)Q$>\220E\215\169\243$r\247{\241\&6<p\"\232ZI\231\EOT\216\240\151",PropRequestResponseInformation
// 237,PropAuthenticationData "Y\191e\222?",PropTopicAliasMaximum 27816,PropMaximumQoS 114,PropWillDelayInterval
// 6594,PropSessionExpiryInterval 8264,PropWillDelayInterval 29718,PropAssignedClientIdentifier
// "\US\"\205\224\138DB\253c\221\136tI\181\193\209\229\153k\129\SOH\163&{\140R",PropTopicAlias
// 9968,PropPayloadFormatIndicator 51,PropMaximumQoS 34,PropSubscriptionIdentifier 29,PropTopicAlias
// 10251,PropAuthenticationMethod "\253\193G\ACK",PropWillDelayInterval 31783,PropMaximumQoS 121]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xc0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xae, 0x7c, 0x91, 0xd1, 0x1,  0x12, 0x0,  0x19, 0xea,
      0x50, 0x17, 0x28, 0x54, 0xb3, 0x2,  0xf7, 0x2,  0x73, 0xcf, 0x53, 0x6f, 0x41, 0x85, 0x28, 0x3d, 0x2,  0x47, 0xbf,
      0xc9, 0x7b, 0x5,  0xe1, 0x12, 0x12, 0x0,  0x3,  0x8d, 0x5e, 0x6f, 0x1,  0xac, 0x18, 0x0,  0x0,  0x7f, 0x74, 0x1c,
      0x0,  0xe,  0x87, 0x56, 0xb9, 0x57, 0x83, 0x42, 0x5e, 0x95, 0xbd, 0x38, 0xd8, 0xe8, 0x4b, 0xf4, 0x26, 0x0,  0x4,
      0x71, 0x32, 0x46, 0xa9, 0x0,  0x16, 0xbf, 0x56, 0x6f, 0x2c, 0xcd, 0x61, 0xda, 0xae, 0x1f, 0x62, 0x54, 0x6a, 0xa2,
      0x47, 0xf3, 0xb1, 0x5f, 0x3e, 0x31, 0x9e, 0x24, 0xe8, 0x24, 0xcb, 0x22, 0x1a, 0x8a, 0x15, 0x0,  0x1b, 0xe1, 0x29,
      0x51, 0x24, 0x3e, 0xdc, 0x45, 0xd7, 0xa9, 0xf3, 0x24, 0x72, 0xf7, 0x7b, 0xf1, 0x36, 0x3c, 0x70, 0x22, 0xe8, 0x5a,
      0x49, 0xe7, 0x4,  0xd8, 0xf0, 0x97, 0x19, 0xed, 0x16, 0x0,  0x5,  0x59, 0xbf, 0x65, 0xde, 0x3f, 0x22, 0x6c, 0xa8,
      0x24, 0x72, 0x18, 0x0,  0x0,  0x19, 0xc2, 0x11, 0x0,  0x0,  0x20, 0x48, 0x18, 0x0,  0x0,  0x74, 0x16, 0x12, 0x0,
      0x1a, 0x1f, 0x22, 0xcd, 0xe0, 0x8a, 0x44, 0x42, 0xfd, 0x63, 0xdd, 0x88, 0x74, 0x49, 0xb5, 0xc1, 0xd1, 0xe5, 0x99,
      0x6b, 0x81, 0x1,  0xa3, 0x26, 0x7b, 0x8c, 0x52, 0x23, 0x26, 0xf0, 0x1,  0x33, 0x24, 0x22, 0xb,  0x1d, 0x23, 0x28,
      0xb,  0x15, 0x0,  0x4,  0xfd, 0xc1, 0x47, 0x6,  0x18, 0x0,  0x0,  0x7c, 0x27, 0x24, 0x79, 0x0,  0xd,  0x49, 0x2e,
      0x6a, 0x25, 0xaa, 0x3f, 0xc2, 0xb7, 0x68, 0x8f, 0x2e, 0x96, 0xff, 0x2d, 0x21, 0x8,  0xff, 0x25, 0x37, 0x2,  0x0,
      0x0,  0x78, 0x20, 0x25, 0x5f, 0x8,  0x0,  0x7,  0xb,  0x4b, 0x72, 0xe3, 0x81, 0xbd, 0x64, 0x3,  0x0,  0xd,  0x23,
      0xe,  0x7a, 0x1,  0xdf, 0x12, 0x3b, 0x1b, 0x3b, 0x0,  0x63, 0x38, 0xc7, 0x2a, 0x53, 0x18, 0x0,  0x0,  0x4d, 0x22,
      0x0,  0x2,  0xf8, 0x4a, 0x0,  0x15, 0x1e, 0x47, 0xcd, 0xfc, 0x1e, 0x50, 0xad, 0xe,  0xc3, 0x18, 0xd1, 0x50, 0x58,
      0x11, 0x63, 0x3a, 0xda, 0xa6, 0x47, 0x9e, 0x6,  0x0,  0x9,  0x5f, 0x10, 0xc9, 0xfe, 0x60, 0xa2, 0xf6, 0xf0, 0x49};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xea, 0x50, 0x17, 0x28, 0x54, 0xb3, 0x2,  0xf7, 0x2,  0x73, 0xcf, 0x53, 0x6f,
                           0x41, 0x85, 0x28, 0x3d, 0x2,  0x47, 0xbf, 0xc9, 0x7b, 0x5,  0xe1, 0x12};
  uint8_t bytesprops1[] = {0x8d, 0x5e, 0x6f};
  uint8_t bytesprops2[] = {0x87, 0x56, 0xb9, 0x57, 0x83, 0x42, 0x5e, 0x95, 0xbd, 0x38, 0xd8, 0xe8, 0x4b, 0xf4};
  uint8_t bytesprops4[] = {0xbf, 0x56, 0x6f, 0x2c, 0xcd, 0x61, 0xda, 0xae, 0x1f, 0x62, 0x54,
                           0x6a, 0xa2, 0x47, 0xf3, 0xb1, 0x5f, 0x3e, 0x31, 0x9e, 0x24, 0xe8};
  uint8_t bytesprops3[] = {0x71, 0x32, 0x46, 0xa9};
  uint8_t bytesprops5[] = {0xe1, 0x29, 0x51, 0x24, 0x3e, 0xdc, 0x45, 0xd7, 0xa9, 0xf3, 0x24, 0x72, 0xf7, 0x7b,
                           0xf1, 0x36, 0x3c, 0x70, 0x22, 0xe8, 0x5a, 0x49, 0xe7, 0x4,  0xd8, 0xf0, 0x97};
  uint8_t bytesprops6[] = {0x59, 0xbf, 0x65, 0xde, 0x3f};
  uint8_t bytesprops7[] = {0x1f, 0x22, 0xcd, 0xe0, 0x8a, 0x44, 0x42, 0xfd, 0x63, 0xdd, 0x88, 0x74, 0x49,
                           0xb5, 0xc1, 0xd1, 0xe5, 0x99, 0x6b, 0x81, 0x1,  0xa3, 0x26, 0x7b, 0x8c, 0x52};
  uint8_t bytesprops8[] = {0xfd, 0xc1, 0x47, 0x6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32628}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops3}, .v = {22, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6794}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27816}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6594}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8264}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29718}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9968}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10251}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31783}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 121}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb, 0x4b, 0x72, 0xe3, 0x81, 0xbd, 0x64};
  uint8_t byteswillprops1[] = {0x23, 0xe, 0x7a, 0x1, 0xdf, 0x12, 0x3b, 0x1b, 0x3b, 0x0, 0x63, 0x38, 0xc7};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2303}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30752}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19746}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf8, 0x4a};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1e, 0x47, 0xcd, 0xfc, 0x1e, 0x50, 0xad, 0xe,  0xc3, 0x18, 0xd1,
                                  0x50, 0x58, 0x11, 0x63, 0x3a, 0xda, 0xa6, 0x47, 0x9e, 0x6};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31889;
  uint8_t client_id_bytes[] = {0x49, 0x2e, 0x6a, 0x25, 0xaa, 0x3f, 0xc2, 0xb7, 0x68, 0x8f, 0x2e, 0x96, 0xff};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5f, 0x10, 0xc9, 0xfe, 0x60, 0xa2, 0xf6, 0xf0, 0x49};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "T\207\211", _willMsg = "\bM\f\154\142\&6\191\r\DC3\RS\222", _willProps = [PropWillDelayInterval
// 15539,PropRetainAvailable 239,PropMaximumPacketSize 23772]}), _cleanSession = False, _keepAlive = 12566, _connID =
// "\137\175)\181\207\247\&7@\223\162\&1\146;\226\v8", _properties = [PropSubscriptionIdentifier 4,PropResponseTopic
// "\244\146\224",PropServerKeepAlive 16880,PropServerReference
// "^O\135\169\216\134\128\194z\GS}J\147\156\ESC\149\241r\211x\221\143\157",PropRequestProblemInformation
// 247,PropPayloadFormatIndicator 31]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x65, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x24, 0x31, 0x16, 0x29, 0xb,  0x4,
                   0x8,  0x0,  0x3,  0xf4, 0x92, 0xe0, 0x13, 0x41, 0xf0, 0x1c, 0x0,  0x17, 0x5e, 0x4f, 0x87,
                   0xa9, 0xd8, 0x86, 0x80, 0xc2, 0x7a, 0x1d, 0x7d, 0x4a, 0x93, 0x9c, 0x1b, 0x95, 0xf1, 0x72,
                   0xd3, 0x78, 0xdd, 0x8f, 0x9d, 0x17, 0xf7, 0x1,  0x1f, 0x0,  0x10, 0x89, 0xaf, 0x29, 0xb5,
                   0xcf, 0xf7, 0x37, 0x40, 0xdf, 0xa2, 0x31, 0x92, 0x3b, 0xe2, 0xb,  0x38, 0xc,  0x18, 0x0,
                   0x0,  0x3c, 0xb3, 0x25, 0xef, 0x27, 0x0,  0x0,  0x5c, 0xdc, 0x0,  0x3,  0x54, 0xcf, 0xd3,
                   0x0,  0xb,  0x8,  0x4d, 0xc,  0x9a, 0x8e, 0x36, 0xbf, 0xd,  0x13, 0x1e, 0xde};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf4, 0x92, 0xe0};
  uint8_t bytesprops1[] = {0x5e, 0x4f, 0x87, 0xa9, 0xd8, 0x86, 0x80, 0xc2, 0x7a, 0x1d, 0x7d, 0x4a,
                           0x93, 0x9c, 0x1b, 0x95, 0xf1, 0x72, 0xd3, 0x78, 0xdd, 0x8f, 0x9d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16880}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 31}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15539}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23772}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x54, 0xcf, 0xd3};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8, 0x4d, 0xc, 0x9a, 0x8e, 0x36, 0xbf, 0xd, 0x13, 0x1e, 0xde};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12566;
  uint8_t client_id_bytes[] = {0x89, 0xaf, 0x29, 0xb5, 0xcf, 0xf7, 0x37, 0x40,
                               0xdf, 0xa2, 0x31, 0x92, 0x3b, 0xe2, 0xb,  0x38};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\174g-~\US\254\174\RS5\r\148\251\190\141\147ed,\178\FS\148'\DELb\174\216", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\SI%\202\210^\187\&7\227\165\SI\236\b\199,\159\238\169", _willMsg =
// "\167\235\ACK\211F\n\211\\@!Wh\n", _willProps = [PropMaximumPacketSize 31865,PropWillDelayInterval
// 5958,PropRequestResponseInformation 226,PropTopicAliasMaximum 20550,PropServerReference
// "\251\243\149\253{\186\171\197\172\164\193\GS\210GA1",PropAssignedClientIdentifier
// "\187\r\205\fTG\138\218\133\DLE\128\244\ETX\198\192\212\224\&8'\212\131\162\238uY\128Ur\222",PropRequestProblemInformation
// 93,PropRequestProblemInformation 71,PropServerKeepAlive 1297,PropContentType
// "\211q\DEL\249u",PropWildcardSubscriptionAvailable 19,PropReasonString
// "K\231\207\&1u\206Lr\143u\177\240\DC4\187c\ACK\168'\234\226\205`m\128\194\192,V",PropMessageExpiryInterval
// 4777,PropUserProperty "\160\152\tN\DC2h0\252\173\SOHX/\RS\GS.\216\184\DC1#s" "\246\183h\156",PropTopicAlias
// 1527,PropTopicAliasMaximum 10288,PropMaximumQoS 218,PropSharedSubscriptionAvailable 223,PropCorrelationData
// "\139\SI\142\182F\208\229\156\214",PropReceiveMaximum 11822,PropTopicAliasMaximum 18800,PropReceiveMaximum
// 25564,PropSubscriptionIdentifierAvailable 144,PropMaximumQoS 54,PropCorrelationData
// "m\239O\DC4",PropWildcardSubscriptionAvailable 255,PropTopicAliasMaximum 1795,PropSubscriptionIdentifierAvailable
// 216,PropWillDelayInterval 10052,PropSubscriptionIdentifierAvailable 47]}), _cleanSession = True, _keepAlive = 4901,
// _connID = "bDc", _properties = [PropServerKeepAlive 6085,PropMaximumQoS 244,PropPayloadFormatIndicator
// 209,PropWillDelayInterval 32239,PropMaximumQoS 201,PropSubscriptionIdentifier 15,PropSessionExpiryInterval
// 26513,PropWildcardSubscriptionAvailable 151,PropSharedSubscriptionAvailable 224,PropTopicAliasMaximum
// 27052,PropTopicAlias 13374,PropAuthenticationData "\177\182x*\204\EOT\213\180\ESC\207",PropServerKeepAlive
// 14469,PropRequestResponseInformation 157,PropAuthenticationMethod "\139L",PropWillDelayInterval
// 15730,PropCorrelationData "\143|q\214\&0\146\214Q\EMz\v2\255\GS\222.\FSFSUc\DC2x\136\148u",PropSessionExpiryInterval
// 20899,PropServerReference "X\216\153I\242j",PropSessionExpiryInterval 3724,PropTopicAliasMaximum
// 4163,PropTopicAliasMaximum 13157,PropServerReference "\255\142\198\NUL\245t\ty\246\234\aF\187\209"]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0x9f, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4e, 0x13, 0x25, 0x82, 0x1,  0x13, 0x17, 0xc5, 0x24,
      0xf4, 0x1,  0xd1, 0x18, 0x0,  0x0,  0x7d, 0xef, 0x24, 0xc9, 0xb,  0xf,  0x11, 0x0,  0x0,  0x67, 0x91, 0x28, 0x97,
      0x2a, 0xe0, 0x22, 0x69, 0xac, 0x23, 0x34, 0x3e, 0x16, 0x0,  0xa,  0xb1, 0xb6, 0x78, 0x2a, 0xcc, 0x4,  0xd5, 0xb4,
      0x1b, 0xcf, 0x13, 0x38, 0x85, 0x19, 0x9d, 0x15, 0x0,  0x2,  0x8b, 0x4c, 0x18, 0x0,  0x0,  0x3d, 0x72, 0x9,  0x0,
      0x1a, 0x8f, 0x7c, 0x71, 0xd6, 0x30, 0x92, 0xd6, 0x51, 0x19, 0x7a, 0xb,  0x32, 0xff, 0x1d, 0xde, 0x2e, 0x1c, 0x46,
      0x53, 0x55, 0x63, 0x12, 0x78, 0x88, 0x94, 0x75, 0x11, 0x0,  0x0,  0x51, 0xa3, 0x1c, 0x0,  0x6,  0x58, 0xd8, 0x99,
      0x49, 0xf2, 0x6a, 0x11, 0x0,  0x0,  0xe,  0x8c, 0x22, 0x10, 0x43, 0x22, 0x33, 0x65, 0x1c, 0x0,  0xe,  0xff, 0x8e,
      0xc6, 0x0,  0xf5, 0x74, 0x9,  0x79, 0xf6, 0xea, 0x7,  0x46, 0xbb, 0xd1, 0x0,  0x3,  0x62, 0x44, 0x63, 0xcc, 0x1,
      0x27, 0x0,  0x0,  0x7c, 0x79, 0x18, 0x0,  0x0,  0x17, 0x46, 0x19, 0xe2, 0x22, 0x50, 0x46, 0x1c, 0x0,  0x10, 0xfb,
      0xf3, 0x95, 0xfd, 0x7b, 0xba, 0xab, 0xc5, 0xac, 0xa4, 0xc1, 0x1d, 0xd2, 0x47, 0x41, 0x31, 0x12, 0x0,  0x1d, 0xbb,
      0xd,  0xcd, 0xc,  0x54, 0x47, 0x8a, 0xda, 0x85, 0x10, 0x80, 0xf4, 0x3,  0xc6, 0xc0, 0xd4, 0xe0, 0x38, 0x27, 0xd4,
      0x83, 0xa2, 0xee, 0x75, 0x59, 0x80, 0x55, 0x72, 0xde, 0x17, 0x5d, 0x17, 0x47, 0x13, 0x5,  0x11, 0x3,  0x0,  0x5,
      0xd3, 0x71, 0x7f, 0xf9, 0x75, 0x28, 0x13, 0x1f, 0x0,  0x1c, 0x4b, 0xe7, 0xcf, 0x31, 0x75, 0xce, 0x4c, 0x72, 0x8f,
      0x75, 0xb1, 0xf0, 0x14, 0xbb, 0x63, 0x6,  0xa8, 0x27, 0xea, 0xe2, 0xcd, 0x60, 0x6d, 0x80, 0xc2, 0xc0, 0x2c, 0x56,
      0x2,  0x0,  0x0,  0x12, 0xa9, 0x26, 0x0,  0x14, 0xa0, 0x98, 0x9,  0x4e, 0x12, 0x68, 0x30, 0xfc, 0xad, 0x1,  0x58,
      0x2f, 0x1e, 0x1d, 0x2e, 0xd8, 0xb8, 0x11, 0x23, 0x73, 0x0,  0x4,  0xf6, 0xb7, 0x68, 0x9c, 0x23, 0x5,  0xf7, 0x22,
      0x28, 0x30, 0x24, 0xda, 0x2a, 0xdf, 0x9,  0x0,  0x9,  0x8b, 0xf,  0x8e, 0xb6, 0x46, 0xd0, 0xe5, 0x9c, 0xd6, 0x21,
      0x2e, 0x2e, 0x22, 0x49, 0x70, 0x21, 0x63, 0xdc, 0x29, 0x90, 0x24, 0x36, 0x9,  0x0,  0x4,  0x6d, 0xef, 0x4f, 0x14,
      0x28, 0xff, 0x22, 0x7,  0x3,  0x29, 0xd8, 0x18, 0x0,  0x0,  0x27, 0x44, 0x29, 0x2f, 0x0,  0x11, 0xf,  0x25, 0xca,
      0xd2, 0x5e, 0xbb, 0x37, 0xe3, 0xa5, 0xf,  0xec, 0x8,  0xc7, 0x2c, 0x9f, 0xee, 0xa9, 0x0,  0xd,  0xa7, 0xeb, 0x6,
      0xd3, 0x46, 0xa,  0xd3, 0x5c, 0x40, 0x21, 0x57, 0x68, 0xa,  0x0,  0x1a, 0xae, 0x67, 0x2d, 0x7e, 0x1f, 0xfe, 0xae,
      0x1e, 0x35, 0xd,  0x94, 0xfb, 0xbe, 0x8d, 0x93, 0x65, 0x64, 0x2c, 0xb2, 0x1c, 0x94, 0x27, 0x7f, 0x62, 0xae, 0xd8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb1, 0xb6, 0x78, 0x2a, 0xcc, 0x4, 0xd5, 0xb4, 0x1b, 0xcf};
  uint8_t bytesprops1[] = {0x8b, 0x4c};
  uint8_t bytesprops2[] = {0x8f, 0x7c, 0x71, 0xd6, 0x30, 0x92, 0xd6, 0x51, 0x19, 0x7a, 0xb,  0x32, 0xff,
                           0x1d, 0xde, 0x2e, 0x1c, 0x46, 0x53, 0x55, 0x63, 0x12, 0x78, 0x88, 0x94, 0x75};
  uint8_t bytesprops3[] = {0x58, 0xd8, 0x99, 0x49, 0xf2, 0x6a};
  uint8_t bytesprops4[] = {0xff, 0x8e, 0xc6, 0x0, 0xf5, 0x74, 0x9, 0x79, 0xf6, 0xea, 0x7, 0x46, 0xbb, 0xd1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6085}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32239}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26513}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27052}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13374}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14469}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15730}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20899}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3724}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4163}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13157}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xfb, 0xf3, 0x95, 0xfd, 0x7b, 0xba, 0xab, 0xc5,
                               0xac, 0xa4, 0xc1, 0x1d, 0xd2, 0x47, 0x41, 0x31};
  uint8_t byteswillprops1[] = {0xbb, 0xd,  0xcd, 0xc,  0x54, 0x47, 0x8a, 0xda, 0x85, 0x10, 0x80, 0xf4, 0x3,  0xc6, 0xc0,
                               0xd4, 0xe0, 0x38, 0x27, 0xd4, 0x83, 0xa2, 0xee, 0x75, 0x59, 0x80, 0x55, 0x72, 0xde};
  uint8_t byteswillprops2[] = {0xd3, 0x71, 0x7f, 0xf9, 0x75};
  uint8_t byteswillprops3[] = {0x4b, 0xe7, 0xcf, 0x31, 0x75, 0xce, 0x4c, 0x72, 0x8f, 0x75, 0xb1, 0xf0, 0x14, 0xbb,
                               0x63, 0x6,  0xa8, 0x27, 0xea, 0xe2, 0xcd, 0x60, 0x6d, 0x80, 0xc2, 0xc0, 0x2c, 0x56};
  uint8_t byteswillprops5[] = {0xf6, 0xb7, 0x68, 0x9c};
  uint8_t byteswillprops4[] = {0xa0, 0x98, 0x9,  0x4e, 0x12, 0x68, 0x30, 0xfc, 0xad, 0x1,
                               0x58, 0x2f, 0x1e, 0x1d, 0x2e, 0xd8, 0xb8, 0x11, 0x23, 0x73};
  uint8_t byteswillprops6[] = {0x8b, 0xf, 0x8e, 0xb6, 0x46, 0xd0, 0xe5, 0x9c, 0xd6};
  uint8_t byteswillprops7[] = {0x6d, 0xef, 0x4f, 0x14};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31865}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5958}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20550}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1297}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4777}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {20, (char*)&byteswillprops4}, .v = {4, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1527}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10288}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11822}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18800}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25564}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1795}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10052}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 47}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf, 0x25, 0xca, 0xd2, 0x5e, 0xbb, 0x37, 0xe3, 0xa5,
                                0xf, 0xec, 0x8,  0xc7, 0x2c, 0x9f, 0xee, 0xa9};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa7, 0xeb, 0x6, 0xd3, 0x46, 0xa, 0xd3, 0x5c, 0x40, 0x21, 0x57, 0x68, 0xa};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4901;
  uint8_t client_id_bytes[] = {0x62, 0x44, 0x63};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xae, 0x67, 0x2d, 0x7e, 0x1f, 0xfe, 0xae, 0x1e, 0x35, 0xd,  0x94, 0xfb, 0xbe,
                              0x8d, 0x93, 0x65, 0x64, 0x2c, 0xb2, 0x1c, 0x94, 0x27, 0x7f, 0x62, 0xae, 0xd8};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "c_\DC1\222(\232\&7", _willMsg =
// "\213z\217-\215\&3\195\ETB\188G\198\140\251+\139\183\183\222\232\204M\187\145\252\EOT\n\192\129", _willProps =
// [PropResponseInformation "u",PropAuthenticationData
// "\NAK9\201\234S\189\240C\251\ETB\182\187\t\187\144]\"|\139",PropRequestProblemInformation 231,PropMaximumPacketSize
// 25564,PropReceiveMaximum 26307,PropSessionExpiryInterval 3535,PropSubscriptionIdentifierAvailable 156,PropContentType
// "1\235\244~\199I\"\180\SYN\ACK\176\153P\148\255c\237\161[\USL\191\a\f&\232\137\151>)",PropAuthenticationMethod
// "Z#\f",PropSubscriptionIdentifier 5,PropSubscriptionIdentifier 19,PropServerReference
// "\212b4\143\148\223\232\250\163\228\138.\135\237`\195\SO&\130\RS\168\CAN\149\a\150\226\221\247?",PropSubscriptionIdentifier
// 7,PropContentType "\186\190?\ETXv;Q\GS\179\141\215\t2\179\233",PropReasonString
// "B/\ESC\165\176\135\235\200=\ETX\225<\150\224\149\197\200\NAK-I\214P\144\161\fJ/",PropAuthenticationData
// "\229\180M\232i\215~\143\DC3",PropReceiveMaximum 3850,PropMaximumPacketSize 19044,PropSubscriptionIdentifierAvailable
// 27,PropWillDelayInterval 8865,PropResponseTopic "u\"\DC3\246
// \187\191\176`\146\GS\247\NAKQ~E\152i\196",PropRequestProblemInformation 35,PropMaximumQoS
// 212,PropRequestResponseInformation 160,PropResponseInformation
// "\237\190\209K-\180\155\253\153s\210\235p\221S\153\206\142\165%\DC28?",PropSubscriptionIdentifier 18]}),
// _cleanSession = True, _keepAlive = 7652, _connID = "m\186 \189\208z", _properties = [PropTopicAliasMaximum
// 7752,PropWildcardSubscriptionAvailable 167,PropSubscriptionIdentifier 19,PropUserProperty "\153\230"
// "\145m5q\238U\ETB\136*",PropSessionExpiryInterval 19199,PropServerKeepAlive 11861,PropSubscriptionIdentifierAvailable
// 196,PropMaximumPacketSize 19471,PropTopicAlias 18512,PropContentType
// "-oGT\128\163\EOTR\171\195\143\248\153.",PropReceiveMaximum 12290,PropReceiveMaximum 23080,PropMessageExpiryInterval
// 8200,PropUserProperty "\198\b^\159\210i_*\238\241\tFl\224\239RJ+\167\CAN\232u\185\DC4\183\249"
// "\140k\231\194\181\213^o \211\\\244\214\145\130\174\190\158=\255\143 \146\195n\151\145\202",PropServerReference
// "t\a\166xR$\213W\142\241\RS\203",PropRequestResponseInformation 132,PropRequestResponseInformation
// 227,PropSubscriptionIdentifierAvailable 22,PropResponseInformation "\US\160\170\180",PropPayloadFormatIndicator
// 131,PropRetainAvailable 204,PropResponseInformation "\214\DLE\218\190fG"]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0xe1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0x1d, 0xe4, 0xa9, 0x1,  0x22, 0x1e, 0x48, 0x28,
      0xa7, 0xb,  0x13, 0x26, 0x0,  0x2,  0x99, 0xe6, 0x0,  0x9,  0x91, 0x6d, 0x35, 0x71, 0xee, 0x55, 0x17, 0x88, 0x2a,
      0x11, 0x0,  0x0,  0x4a, 0xff, 0x13, 0x2e, 0x55, 0x29, 0xc4, 0x27, 0x0,  0x0,  0x4c, 0xf,  0x23, 0x48, 0x50, 0x3,
      0x0,  0xe,  0x2d, 0x6f, 0x47, 0x54, 0x80, 0xa3, 0x4,  0x52, 0xab, 0xc3, 0x8f, 0xf8, 0x99, 0x2e, 0x21, 0x30, 0x2,
      0x21, 0x5a, 0x28, 0x2,  0x0,  0x0,  0x20, 0x8,  0x26, 0x0,  0x1a, 0xc6, 0x8,  0x5e, 0x9f, 0xd2, 0x69, 0x5f, 0x2a,
      0xee, 0xf1, 0x9,  0x46, 0x6c, 0xe0, 0xef, 0x52, 0x4a, 0x2b, 0xa7, 0x18, 0xe8, 0x75, 0xb9, 0x14, 0xb7, 0xf9, 0x0,
      0x1c, 0x8c, 0x6b, 0xe7, 0xc2, 0xb5, 0xd5, 0x5e, 0x6f, 0x20, 0xd3, 0x5c, 0xf4, 0xd6, 0x91, 0x82, 0xae, 0xbe, 0x9e,
      0x3d, 0xff, 0x8f, 0x20, 0x92, 0xc3, 0x6e, 0x97, 0x91, 0xca, 0x1c, 0x0,  0xc,  0x74, 0x7,  0xa6, 0x78, 0x52, 0x24,
      0xd5, 0x57, 0x8e, 0xf1, 0x1e, 0xcb, 0x19, 0x84, 0x19, 0xe3, 0x29, 0x16, 0x1a, 0x0,  0x4,  0x1f, 0xa0, 0xaa, 0xb4,
      0x1,  0x83, 0x25, 0xcc, 0x1a, 0x0,  0x6,  0xd6, 0x10, 0xda, 0xbe, 0x66, 0x47, 0x0,  0x6,  0x6d, 0xba, 0x20, 0xbd,
      0xd0, 0x7a, 0xfb, 0x1,  0x1a, 0x0,  0x1,  0x75, 0x16, 0x0,  0x13, 0x15, 0x39, 0xc9, 0xea, 0x53, 0xbd, 0xf0, 0x43,
      0xfb, 0x17, 0xb6, 0xbb, 0x9,  0xbb, 0x90, 0x5d, 0x22, 0x7c, 0x8b, 0x17, 0xe7, 0x27, 0x0,  0x0,  0x63, 0xdc, 0x21,
      0x66, 0xc3, 0x11, 0x0,  0x0,  0xd,  0xcf, 0x29, 0x9c, 0x3,  0x0,  0x1e, 0x31, 0xeb, 0xf4, 0x7e, 0xc7, 0x49, 0x22,
      0xb4, 0x16, 0x6,  0xb0, 0x99, 0x50, 0x94, 0xff, 0x63, 0xed, 0xa1, 0x5b, 0x1f, 0x4c, 0xbf, 0x7,  0xc,  0x26, 0xe8,
      0x89, 0x97, 0x3e, 0x29, 0x15, 0x0,  0x3,  0x5a, 0x23, 0xc,  0xb,  0x5,  0xb,  0x13, 0x1c, 0x0,  0x1d, 0xd4, 0x62,
      0x34, 0x8f, 0x94, 0xdf, 0xe8, 0xfa, 0xa3, 0xe4, 0x8a, 0x2e, 0x87, 0xed, 0x60, 0xc3, 0xe,  0x26, 0x82, 0x1e, 0xa8,
      0x18, 0x95, 0x7,  0x96, 0xe2, 0xdd, 0xf7, 0x3f, 0xb,  0x7,  0x3,  0x0,  0xf,  0xba, 0xbe, 0x3f, 0x3,  0x76, 0x3b,
      0x51, 0x1d, 0xb3, 0x8d, 0xd7, 0x9,  0x32, 0xb3, 0xe9, 0x1f, 0x0,  0x1b, 0x42, 0x2f, 0x1b, 0xa5, 0xb0, 0x87, 0xeb,
      0xc8, 0x3d, 0x3,  0xe1, 0x3c, 0x96, 0xe0, 0x95, 0xc5, 0xc8, 0x15, 0x2d, 0x49, 0xd6, 0x50, 0x90, 0xa1, 0xc,  0x4a,
      0x2f, 0x16, 0x0,  0x9,  0xe5, 0xb4, 0x4d, 0xe8, 0x69, 0xd7, 0x7e, 0x8f, 0x13, 0x21, 0xf,  0xa,  0x27, 0x0,  0x0,
      0x4a, 0x64, 0x29, 0x1b, 0x18, 0x0,  0x0,  0x22, 0xa1, 0x8,  0x0,  0x13, 0x75, 0x22, 0x13, 0xf6, 0x20, 0xbb, 0xbf,
      0xb0, 0x60, 0x92, 0x1d, 0xf7, 0x15, 0x51, 0x7e, 0x45, 0x98, 0x69, 0xc4, 0x17, 0x23, 0x24, 0xd4, 0x19, 0xa0, 0x1a,
      0x0,  0x17, 0xed, 0xbe, 0xd1, 0x4b, 0x2d, 0xb4, 0x9b, 0xfd, 0x99, 0x73, 0xd2, 0xeb, 0x70, 0xdd, 0x53, 0x99, 0xce,
      0x8e, 0xa5, 0x25, 0x12, 0x38, 0x3f, 0xb,  0x12, 0x0,  0x7,  0x63, 0x5f, 0x11, 0xde, 0x28, 0xe8, 0x37, 0x0,  0x1c,
      0xd5, 0x7a, 0xd9, 0x2d, 0xd7, 0x33, 0xc3, 0x17, 0xbc, 0x47, 0xc6, 0x8c, 0xfb, 0x2b, 0x8b, 0xb7, 0xb7, 0xde, 0xe8,
      0xcc, 0x4d, 0xbb, 0x91, 0xfc, 0x4,  0xa,  0xc0, 0x81};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x91, 0x6d, 0x35, 0x71, 0xee, 0x55, 0x17, 0x88, 0x2a};
  uint8_t bytesprops0[] = {0x99, 0xe6};
  uint8_t bytesprops2[] = {0x2d, 0x6f, 0x47, 0x54, 0x80, 0xa3, 0x4, 0x52, 0xab, 0xc3, 0x8f, 0xf8, 0x99, 0x2e};
  uint8_t bytesprops4[] = {0x8c, 0x6b, 0xe7, 0xc2, 0xb5, 0xd5, 0x5e, 0x6f, 0x20, 0xd3, 0x5c, 0xf4, 0xd6, 0x91,
                           0x82, 0xae, 0xbe, 0x9e, 0x3d, 0xff, 0x8f, 0x20, 0x92, 0xc3, 0x6e, 0x97, 0x91, 0xca};
  uint8_t bytesprops3[] = {0xc6, 0x8,  0x5e, 0x9f, 0xd2, 0x69, 0x5f, 0x2a, 0xee, 0xf1, 0x9,  0x46, 0x6c,
                           0xe0, 0xef, 0x52, 0x4a, 0x2b, 0xa7, 0x18, 0xe8, 0x75, 0xb9, 0x14, 0xb7, 0xf9};
  uint8_t bytesprops5[] = {0x74, 0x7, 0xa6, 0x78, 0x52, 0x24, 0xd5, 0x57, 0x8e, 0xf1, 0x1e, 0xcb};
  uint8_t bytesprops6[] = {0x1f, 0xa0, 0xaa, 0xb4};
  uint8_t bytesprops7[] = {0xd6, 0x10, 0xda, 0xbe, 0x66, 0x47};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7752}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops0}, .v = {9, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19199}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11861}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19471}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18512}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12290}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23080}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8200}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops3}, .v = {28, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x75};
  uint8_t byteswillprops1[] = {0x15, 0x39, 0xc9, 0xea, 0x53, 0xbd, 0xf0, 0x43, 0xfb, 0x17,
                               0xb6, 0xbb, 0x9,  0xbb, 0x90, 0x5d, 0x22, 0x7c, 0x8b};
  uint8_t byteswillprops2[] = {0x31, 0xeb, 0xf4, 0x7e, 0xc7, 0x49, 0x22, 0xb4, 0x16, 0x6,
                               0xb0, 0x99, 0x50, 0x94, 0xff, 0x63, 0xed, 0xa1, 0x5b, 0x1f,
                               0x4c, 0xbf, 0x7,  0xc,  0x26, 0xe8, 0x89, 0x97, 0x3e, 0x29};
  uint8_t byteswillprops3[] = {0x5a, 0x23, 0xc};
  uint8_t byteswillprops4[] = {0xd4, 0x62, 0x34, 0x8f, 0x94, 0xdf, 0xe8, 0xfa, 0xa3, 0xe4, 0x8a, 0x2e, 0x87, 0xed, 0x60,
                               0xc3, 0xe,  0x26, 0x82, 0x1e, 0xa8, 0x18, 0x95, 0x7,  0x96, 0xe2, 0xdd, 0xf7, 0x3f};
  uint8_t byteswillprops5[] = {0xba, 0xbe, 0x3f, 0x3, 0x76, 0x3b, 0x51, 0x1d, 0xb3, 0x8d, 0xd7, 0x9, 0x32, 0xb3, 0xe9};
  uint8_t byteswillprops6[] = {0x42, 0x2f, 0x1b, 0xa5, 0xb0, 0x87, 0xeb, 0xc8, 0x3d, 0x3,  0xe1, 0x3c, 0x96, 0xe0,
                               0x95, 0xc5, 0xc8, 0x15, 0x2d, 0x49, 0xd6, 0x50, 0x90, 0xa1, 0xc,  0x4a, 0x2f};
  uint8_t byteswillprops7[] = {0xe5, 0xb4, 0x4d, 0xe8, 0x69, 0xd7, 0x7e, 0x8f, 0x13};
  uint8_t byteswillprops8[] = {0x75, 0x22, 0x13, 0xf6, 0x20, 0xbb, 0xbf, 0xb0, 0x60, 0x92,
                               0x1d, 0xf7, 0x15, 0x51, 0x7e, 0x45, 0x98, 0x69, 0xc4};
  uint8_t byteswillprops9[] = {0xed, 0xbe, 0xd1, 0x4b, 0x2d, 0xb4, 0x9b, 0xfd, 0x99, 0x73, 0xd2, 0xeb,
                               0x70, 0xdd, 0x53, 0x99, 0xce, 0x8e, 0xa5, 0x25, 0x12, 0x38, 0x3f};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25564}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26307}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3535}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3850}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19044}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8865}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x63, 0x5f, 0x11, 0xde, 0x28, 0xe8, 0x37};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd5, 0x7a, 0xd9, 0x2d, 0xd7, 0x33, 0xc3, 0x17, 0xbc, 0x47, 0xc6, 0x8c, 0xfb, 0x2b,
                                  0x8b, 0xb7, 0xb7, 0xde, 0xe8, 0xcc, 0x4d, 0xbb, 0x91, 0xfc, 0x4,  0xa,  0xc0, 0x81};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7652;
  uint8_t client_id_bytes[] = {0x6d, 0xba, 0x20, 0xbd, 0xd0, 0x7a};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS2, _willTopic = "\167\186,\225\231\n\229RS\158n\EOT\157pX\SI\134\254\187\&5\178[\235\215\141", _willMsg = "\183~",
// _willProps = [PropReasonString "\131\239}\233\220"]}), _cleanSession = True, _keepAlive = 4897, _connID =
// "\215ES)\213\"\RS\149\165\167\252\216_\166", _properties = [PropAssignedClientIdentifier
// "\128\128D\184\170\196U\255\162\EOT8}6\229b\DLE\170n\214\186\201"]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x5b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x36, 0x13, 0x21, 0x18, 0x12, 0x0,  0x15,
                   0x80, 0x80, 0x44, 0xb8, 0xaa, 0xc4, 0x55, 0xff, 0xa2, 0x4,  0x38, 0x7d, 0x36, 0xe5, 0x62, 0x10,
                   0xaa, 0x6e, 0xd6, 0xba, 0xc9, 0x0,  0xe,  0xd7, 0x45, 0x53, 0x29, 0xd5, 0x22, 0x1e, 0x95, 0xa5,
                   0xa7, 0xfc, 0xd8, 0x5f, 0xa6, 0x8,  0x1f, 0x0,  0x5,  0x83, 0xef, 0x7d, 0xe9, 0xdc, 0x0,  0x19,
                   0xa7, 0xba, 0x2c, 0xe1, 0xe7, 0xa,  0xe5, 0x52, 0x53, 0x9e, 0x6e, 0x4,  0x9d, 0x70, 0x58, 0xf,
                   0x86, 0xfe, 0xbb, 0x35, 0xb2, 0x5b, 0xeb, 0xd7, 0x8d, 0x0,  0x2,  0xb7, 0x7e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x80, 0x80, 0x44, 0xb8, 0xaa, 0xc4, 0x55, 0xff, 0xa2, 0x4, 0x38,
                           0x7d, 0x36, 0xe5, 0x62, 0x10, 0xaa, 0x6e, 0xd6, 0xba, 0xc9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x83, 0xef, 0x7d, 0xe9, 0xdc};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa7, 0xba, 0x2c, 0xe1, 0xe7, 0xa,  0xe5, 0x52, 0x53, 0x9e, 0x6e, 0x4, 0x9d,
                                0x70, 0x58, 0xf,  0x86, 0xfe, 0xbb, 0x35, 0xb2, 0x5b, 0xeb, 0xd7, 0x8d};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb7, 0x7e};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 4897;
  uint8_t client_id_bytes[] = {0xd7, 0x45, 0x53, 0x29, 0xd5, 0x22, 0x1e, 0x95, 0xa5, 0xa7, 0xfc, 0xd8, 0x5f, 0xa6};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\179\171\192\219e27\202\244Y\238\&9\151", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\221\239\USQ\"", _willMsg = "", _willProps =
// [PropResponseInformation "",PropMessageExpiryInterval 22718,PropMessageExpiryInterval 30489,PropServerReference
// "\SOH9\SI\231n\192\&0\131\174(K\137G\157..\".)\r\200",PropAuthenticationData
// "\SI\153\128\245\140\187\fq\157\195\155\ETX",PropContentType
// "\232\163\189\148d\GS\190\DC2\223\245\164\a\153",PropSubscriptionIdentifier 26,PropWildcardSubscriptionAvailable
// 103,PropAssignedClientIdentifier "\161v\133c",PropWildcardSubscriptionAvailable 179,PropTopicAlias
// 28960,PropSessionExpiryInterval 4948,PropReasonString
// "(\ETX\234\205Th\243\249\210\244\148\&2\DC3\204^\236S\222\245\EM2W",PropReasonString
// "\EMO\240\STX;\DC2\n\214\158!\216\156d\236G\226",PropMaximumQoS 112,PropMaximumQoS 191,PropRetainAvailable
// 33,PropUserProperty "\SO}\GSW\RS,\137t\152\DC2\249wQ"
// "\148\209\242\207\218\&2\128?\DLEa\184\191\141L\225.\183f\155U\DC4\135(",PropMessageExpiryInterval
// 31362,PropWillDelayInterval 19268,PropResponseInformation
// "\179\230\206\&9\227n#!\178@\v\200oj\192\155LU\170\141\161c\202<u\130\245"]}), _cleanSession = False, _keepAlive =
// 28246, _connID = "6S\138\205\221\220lm\242_x6\230\192\DC4\219\134u\DC40\191tP^\212\247", _properties =
// [PropResponseInformation "i\160",PropResponseTopic
// "Y\254\195j\243\162*\240\141\229@\168\210\189\191y\160\228\170\221\213",PropSessionExpiryInterval
// 2781,PropAuthenticationData "\SI^~
// \249\133\237c\197\223\135\170\182\197zs\142BW\203B\244\131\140\EOT\222mG",PropSharedSubscriptionAvailable
// 69,PropReasonString "\b\nS\144\t\147\162y\245{\135S",PropRetainAvailable 218,PropMessageExpiryInterval
// 3826,PropTopicAliasMaximum 20888,PropAuthenticationMethod
// "\203\220\197\NAKFw\204a\146\FS\158I:",PropSessionExpiryInterval 24341,PropUserProperty "\162J\247\&40p\175"
// "q\161US\SIxW\221\163\152-hw\148",PropServerReference "\169\139g\174|\144^#\213\242P>k",PropMaximumQoS 128]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xbb, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x54, 0x6e, 0x56, 0x9d, 0x1,  0x1a, 0x0,  0x2,  0x69,
      0xa0, 0x8,  0x0,  0x15, 0x59, 0xfe, 0xc3, 0x6a, 0xf3, 0xa2, 0x2a, 0xf0, 0x8d, 0xe5, 0x40, 0xa8, 0xd2, 0xbd, 0xbf,
      0x79, 0xa0, 0xe4, 0xaa, 0xdd, 0xd5, 0x11, 0x0,  0x0,  0xa,  0xdd, 0x16, 0x0,  0x1c, 0xf,  0x5e, 0x7e, 0x20, 0xf9,
      0x85, 0xed, 0x63, 0xc5, 0xdf, 0x87, 0xaa, 0xb6, 0xc5, 0x7a, 0x73, 0x8e, 0x42, 0x57, 0xcb, 0x42, 0xf4, 0x83, 0x8c,
      0x4,  0xde, 0x6d, 0x47, 0x2a, 0x45, 0x1f, 0x0,  0xc,  0x8,  0xa,  0x53, 0x90, 0x9,  0x93, 0xa2, 0x79, 0xf5, 0x7b,
      0x87, 0x53, 0x25, 0xda, 0x2,  0x0,  0x0,  0xe,  0xf2, 0x22, 0x51, 0x98, 0x15, 0x0,  0xd,  0xcb, 0xdc, 0xc5, 0x15,
      0x46, 0x77, 0xcc, 0x61, 0x92, 0x1c, 0x9e, 0x49, 0x3a, 0x11, 0x0,  0x0,  0x5f, 0x15, 0x26, 0x0,  0x7,  0xa2, 0x4a,
      0xf7, 0x34, 0x30, 0x70, 0xaf, 0x0,  0xe,  0x71, 0xa1, 0x55, 0x53, 0xf,  0x78, 0x57, 0xdd, 0xa3, 0x98, 0x2d, 0x68,
      0x77, 0x94, 0x1c, 0x0,  0xd,  0xa9, 0x8b, 0x67, 0xae, 0x7c, 0x90, 0x5e, 0x23, 0xd5, 0xf2, 0x50, 0x3e, 0x6b, 0x24,
      0x80, 0x0,  0x1a, 0x36, 0x53, 0x8a, 0xcd, 0xdd, 0xdc, 0x6c, 0x6d, 0xf2, 0x5f, 0x78, 0x36, 0xe6, 0xc0, 0x14, 0xdb,
      0x86, 0x75, 0x14, 0x30, 0xbf, 0x74, 0x50, 0x5e, 0xd4, 0xf7, 0xdc, 0x1,  0x1a, 0x0,  0x0,  0x2,  0x0,  0x0,  0x58,
      0xbe, 0x2,  0x0,  0x0,  0x77, 0x19, 0x1c, 0x0,  0x15, 0x1,  0x39, 0xf,  0xe7, 0x6e, 0xc0, 0x30, 0x83, 0xae, 0x28,
      0x4b, 0x89, 0x47, 0x9d, 0x2e, 0x2e, 0x22, 0x2e, 0x29, 0xd,  0xc8, 0x16, 0x0,  0xc,  0xf,  0x99, 0x80, 0xf5, 0x8c,
      0xbb, 0xc,  0x71, 0x9d, 0xc3, 0x9b, 0x3,  0x3,  0x0,  0xd,  0xe8, 0xa3, 0xbd, 0x94, 0x64, 0x1d, 0xbe, 0x12, 0xdf,
      0xf5, 0xa4, 0x7,  0x99, 0xb,  0x1a, 0x28, 0x67, 0x12, 0x0,  0x4,  0xa1, 0x76, 0x85, 0x63, 0x28, 0xb3, 0x23, 0x71,
      0x20, 0x11, 0x0,  0x0,  0x13, 0x54, 0x1f, 0x0,  0x16, 0x28, 0x3,  0xea, 0xcd, 0x54, 0x68, 0xf3, 0xf9, 0xd2, 0xf4,
      0x94, 0x32, 0x13, 0xcc, 0x5e, 0xec, 0x53, 0xde, 0xf5, 0x19, 0x32, 0x57, 0x1f, 0x0,  0x10, 0x19, 0x4f, 0xf0, 0x2,
      0x3b, 0x12, 0xa,  0xd6, 0x9e, 0x21, 0xd8, 0x9c, 0x64, 0xec, 0x47, 0xe2, 0x24, 0x70, 0x24, 0xbf, 0x25, 0x21, 0x26,
      0x0,  0xd,  0xe,  0x7d, 0x1d, 0x57, 0x1e, 0x2c, 0x89, 0x74, 0x98, 0x12, 0xf9, 0x77, 0x51, 0x0,  0x17, 0x94, 0xd1,
      0xf2, 0xcf, 0xda, 0x32, 0x80, 0x3f, 0x10, 0x61, 0xb8, 0xbf, 0x8d, 0x4c, 0xe1, 0x2e, 0xb7, 0x66, 0x9b, 0x55, 0x14,
      0x87, 0x28, 0x2,  0x0,  0x0,  0x7a, 0x82, 0x18, 0x0,  0x0,  0x4b, 0x44, 0x1a, 0x0,  0x1b, 0xb3, 0xe6, 0xce, 0x39,
      0xe3, 0x6e, 0x23, 0x21, 0xb2, 0x40, 0xb,  0xc8, 0x6f, 0x6a, 0xc0, 0x9b, 0x4c, 0x55, 0xaa, 0x8d, 0xa1, 0x63, 0xca,
      0x3c, 0x75, 0x82, 0xf5, 0x0,  0x5,  0xdd, 0xef, 0x1f, 0x51, 0x22, 0x0,  0x0,  0x0,  0xd,  0xb3, 0xab, 0xc0, 0xdb,
      0x65, 0x32, 0x37, 0xca, 0xf4, 0x59, 0xee, 0x39, 0x97};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x69, 0xa0};
  uint8_t bytesprops1[] = {0x59, 0xfe, 0xc3, 0x6a, 0xf3, 0xa2, 0x2a, 0xf0, 0x8d, 0xe5, 0x40,
                           0xa8, 0xd2, 0xbd, 0xbf, 0x79, 0xa0, 0xe4, 0xaa, 0xdd, 0xd5};
  uint8_t bytesprops2[] = {0xf,  0x5e, 0x7e, 0x20, 0xf9, 0x85, 0xed, 0x63, 0xc5, 0xdf, 0x87, 0xaa, 0xb6, 0xc5,
                           0x7a, 0x73, 0x8e, 0x42, 0x57, 0xcb, 0x42, 0xf4, 0x83, 0x8c, 0x4,  0xde, 0x6d, 0x47};
  uint8_t bytesprops3[] = {0x8, 0xa, 0x53, 0x90, 0x9, 0x93, 0xa2, 0x79, 0xf5, 0x7b, 0x87, 0x53};
  uint8_t bytesprops4[] = {0xcb, 0xdc, 0xc5, 0x15, 0x46, 0x77, 0xcc, 0x61, 0x92, 0x1c, 0x9e, 0x49, 0x3a};
  uint8_t bytesprops6[] = {0x71, 0xa1, 0x55, 0x53, 0xf, 0x78, 0x57, 0xdd, 0xa3, 0x98, 0x2d, 0x68, 0x77, 0x94};
  uint8_t bytesprops5[] = {0xa2, 0x4a, 0xf7, 0x34, 0x30, 0x70, 0xaf};
  uint8_t bytesprops7[] = {0xa9, 0x8b, 0x67, 0xae, 0x7c, 0x90, 0x5e, 0x23, 0xd5, 0xf2, 0x50, 0x3e, 0x6b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2781}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3826}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20888}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24341}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops5}, .v = {14, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 128}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops1[] = {0x1,  0x39, 0xf,  0xe7, 0x6e, 0xc0, 0x30, 0x83, 0xae, 0x28, 0x4b,
                               0x89, 0x47, 0x9d, 0x2e, 0x2e, 0x22, 0x2e, 0x29, 0xd,  0xc8};
  uint8_t byteswillprops2[] = {0xf, 0x99, 0x80, 0xf5, 0x8c, 0xbb, 0xc, 0x71, 0x9d, 0xc3, 0x9b, 0x3};
  uint8_t byteswillprops3[] = {0xe8, 0xa3, 0xbd, 0x94, 0x64, 0x1d, 0xbe, 0x12, 0xdf, 0xf5, 0xa4, 0x7, 0x99};
  uint8_t byteswillprops4[] = {0xa1, 0x76, 0x85, 0x63};
  uint8_t byteswillprops5[] = {0x28, 0x3,  0xea, 0xcd, 0x54, 0x68, 0xf3, 0xf9, 0xd2, 0xf4, 0x94,
                               0x32, 0x13, 0xcc, 0x5e, 0xec, 0x53, 0xde, 0xf5, 0x19, 0x32, 0x57};
  uint8_t byteswillprops6[] = {0x19, 0x4f, 0xf0, 0x2,  0x3b, 0x12, 0xa,  0xd6,
                               0x9e, 0x21, 0xd8, 0x9c, 0x64, 0xec, 0x47, 0xe2};
  uint8_t byteswillprops8[] = {0x94, 0xd1, 0xf2, 0xcf, 0xda, 0x32, 0x80, 0x3f, 0x10, 0x61, 0xb8, 0xbf,
                               0x8d, 0x4c, 0xe1, 0x2e, 0xb7, 0x66, 0x9b, 0x55, 0x14, 0x87, 0x28};
  uint8_t byteswillprops7[] = {0xe, 0x7d, 0x1d, 0x57, 0x1e, 0x2c, 0x89, 0x74, 0x98, 0x12, 0xf9, 0x77, 0x51};
  uint8_t byteswillprops9[] = {0xb3, 0xe6, 0xce, 0x39, 0xe3, 0x6e, 0x23, 0x21, 0xb2, 0x40, 0xb,  0xc8, 0x6f, 0x6a,
                               0xc0, 0x9b, 0x4c, 0x55, 0xaa, 0x8d, 0xa1, 0x63, 0xca, 0x3c, 0x75, 0x82, 0xf5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22718}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30489}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28960}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4948}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops7}, .v = {23, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31362}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19268}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&byteswillprops9}}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdd, 0xef, 0x1f, 0x51, 0x22};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28246;
  uint8_t client_id_bytes[] = {0x36, 0x53, 0x8a, 0xcd, 0xdd, 0xdc, 0x6c, 0x6d, 0xf2, 0x5f, 0x78, 0x36, 0xe6,
                               0xc0, 0x14, 0xdb, 0x86, 0x75, 0x14, 0x30, 0xbf, 0x74, 0x50, 0x5e, 0xd4, 0xf7};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb3, 0xab, 0xc0, 0xdb, 0x65, 0x32, 0x37, 0xca, 0xf4, 0x59, 0xee, 0x39, 0x97};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "a\240\130l{", _password = Just
// "\139\168iv\184\216p\167\249\142\150\188G^'\235a\GS", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic =
// "\DC4\144\178\229\CAN\160\DC2\233\SI\160\DC1G\219\173\175\r\161\&3\250\246\200\250\r\199J\154\165\195\221\237",
// _willMsg = " \207(\FS?\175Cq\NUL\154(\203(\186\197\156`\189O\255\195\169\153\RS\226\b`h", _willProps =
// [PropCorrelationData
// "\236\178\197~\STX\NULy\189\224\b*\v\238\151\152\203\DC4H~\189\189J\168\202\234\223\132\168",PropReceiveMaximum
// 30115,PropTopicAlias 12374,PropResponseTopic "o\232",PropWillDelayInterval 27982,PropServerKeepAlive
// 23541,PropRetainAvailable 187,PropMessageExpiryInterval 22446,PropServerReference
// "\177\183\219\223\162E\151EIW\226/\154\128s)\187\242"]}), _cleanSession = True, _keepAlive = 13826, _connID = "",
// _properties = [PropRequestResponseInformation 160,PropMaximumPacketSize 26751,PropAuthenticationMethod
// "Z\t",PropPayloadFormatIndicator 71,PropContentType "\RSC\154\FS;\DC2",PropRequestResponseInformation
// 197,PropRequestProblemInformation 183,PropSubscriptionIdentifierAvailable 243,PropMessageExpiryInterval
// 18872,PropRetainAvailable 244,PropMaximumPacketSize 13684,PropCorrelationData
// "\204\STX\236q,\211'\138P\161S\136+\163\SI\240x\DC2\131\129\210",PropResponseTopic
// "$\142\152\245\&6\ENQ\163\238\179\"O\162\215*\251\177\&3\ACK\231\149",PropRequestProblemInformation
// 163,PropWillDelayInterval 24681,PropSessionExpiryInterval 31574,PropReasonString
// "\ETB\216*p\rd\248*dIe\154(\166\194\222\205\206\222\215",PropContentType
// ",#\227\179\151+{",PropSharedSubscriptionAvailable 219,PropAuthenticationMethod
// "\139N\EM\180\186x\145\131`l2h)\201\155\152\177\144\FSC\223\238\154\237\&6dRu4\170",PropUserProperty
// "\237_\195\211\163\204P2f\162\DLE\177<j!\DC3\224"
// "\155Pa)\161\228:\154T\186\&3\139\187\189O\137<A#",PropAuthenticationData
// "\155:/\163\172\DC1\CAN1<\162s-By}\224u\212\222ct\247<\153C\166\222\&9\183",PropRequestProblemInformation
// 46,PropResponseTopic ")*b\191\133",PropSubscriptionIdentifier 18,PropMessageExpiryInterval 32631,PropMaximumQoS
// 145,PropRequestResponseInformation 132,PropRetainAvailable 137,PropSessionExpiryInterval 5351]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xc3, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x36, 0x2,  0x8d, 0x2,  0x19, 0xa0, 0x27, 0x0,
      0x0,  0x68, 0x7f, 0x15, 0x0,  0x2,  0x5a, 0x9,  0x1,  0x47, 0x3,  0x0,  0x6,  0x1e, 0x43, 0x9a, 0x1c, 0x3b, 0x12,
      0x19, 0xc5, 0x17, 0xb7, 0x29, 0xf3, 0x2,  0x0,  0x0,  0x49, 0xb8, 0x25, 0xf4, 0x27, 0x0,  0x0,  0x35, 0x74, 0x9,
      0x0,  0x15, 0xcc, 0x2,  0xec, 0x71, 0x2c, 0xd3, 0x27, 0x8a, 0x50, 0xa1, 0x53, 0x88, 0x2b, 0xa3, 0xf,  0xf0, 0x78,
      0x12, 0x83, 0x81, 0xd2, 0x8,  0x0,  0x14, 0x24, 0x8e, 0x98, 0xf5, 0x36, 0x5,  0xa3, 0xee, 0xb3, 0x22, 0x4f, 0xa2,
      0xd7, 0x2a, 0xfb, 0xb1, 0x33, 0x6,  0xe7, 0x95, 0x17, 0xa3, 0x18, 0x0,  0x0,  0x60, 0x69, 0x11, 0x0,  0x0,  0x7b,
      0x56, 0x1f, 0x0,  0x14, 0x17, 0xd8, 0x2a, 0x70, 0xd,  0x64, 0xf8, 0x2a, 0x64, 0x49, 0x65, 0x9a, 0x28, 0xa6, 0xc2,
      0xde, 0xcd, 0xce, 0xde, 0xd7, 0x3,  0x0,  0x7,  0x2c, 0x23, 0xe3, 0xb3, 0x97, 0x2b, 0x7b, 0x2a, 0xdb, 0x15, 0x0,
      0x1e, 0x8b, 0x4e, 0x19, 0xb4, 0xba, 0x78, 0x91, 0x83, 0x60, 0x6c, 0x32, 0x68, 0x29, 0xc9, 0x9b, 0x98, 0xb1, 0x90,
      0x1c, 0x43, 0xdf, 0xee, 0x9a, 0xed, 0x36, 0x64, 0x52, 0x75, 0x34, 0xaa, 0x26, 0x0,  0x11, 0xed, 0x5f, 0xc3, 0xd3,
      0xa3, 0xcc, 0x50, 0x32, 0x66, 0xa2, 0x10, 0xb1, 0x3c, 0x6a, 0x21, 0x13, 0xe0, 0x0,  0x13, 0x9b, 0x50, 0x61, 0x29,
      0xa1, 0xe4, 0x3a, 0x9a, 0x54, 0xba, 0x33, 0x8b, 0xbb, 0xbd, 0x4f, 0x89, 0x3c, 0x41, 0x23, 0x16, 0x0,  0x1d, 0x9b,
      0x3a, 0x2f, 0xa3, 0xac, 0x11, 0x18, 0x31, 0x3c, 0xa2, 0x73, 0x2d, 0x42, 0x79, 0x7d, 0xe0, 0x75, 0xd4, 0xde, 0x63,
      0x74, 0xf7, 0x3c, 0x99, 0x43, 0xa6, 0xde, 0x39, 0xb7, 0x17, 0x2e, 0x8,  0x0,  0x5,  0x29, 0x2a, 0x62, 0xbf, 0x85,
      0xb,  0x12, 0x2,  0x0,  0x0,  0x7f, 0x77, 0x24, 0x91, 0x19, 0x84, 0x25, 0x89, 0x11, 0x0,  0x0,  0x14, 0xe7, 0x0,
      0x0,  0x4e, 0x9,  0x0,  0x1c, 0xec, 0xb2, 0xc5, 0x7e, 0x2,  0x0,  0x79, 0xbd, 0xe0, 0x8,  0x2a, 0xb,  0xee, 0x97,
      0x98, 0xcb, 0x14, 0x48, 0x7e, 0xbd, 0xbd, 0x4a, 0xa8, 0xca, 0xea, 0xdf, 0x84, 0xa8, 0x21, 0x75, 0xa3, 0x23, 0x30,
      0x56, 0x8,  0x0,  0x2,  0x6f, 0xe8, 0x18, 0x0,  0x0,  0x6d, 0x4e, 0x13, 0x5b, 0xf5, 0x25, 0xbb, 0x2,  0x0,  0x0,
      0x57, 0xae, 0x1c, 0x0,  0x12, 0xb1, 0xb7, 0xdb, 0xdf, 0xa2, 0x45, 0x97, 0x45, 0x49, 0x57, 0xe2, 0x2f, 0x9a, 0x80,
      0x73, 0x29, 0xbb, 0xf2, 0x0,  0x1e, 0x14, 0x90, 0xb2, 0xe5, 0x18, 0xa0, 0x12, 0xe9, 0xf,  0xa0, 0x11, 0x47, 0xdb,
      0xad, 0xaf, 0xd,  0xa1, 0x33, 0xfa, 0xf6, 0xc8, 0xfa, 0xd,  0xc7, 0x4a, 0x9a, 0xa5, 0xc3, 0xdd, 0xed, 0x0,  0x1c,
      0x20, 0xcf, 0x28, 0x1c, 0x3f, 0xaf, 0x43, 0x71, 0x0,  0x9a, 0x28, 0xcb, 0x28, 0xba, 0xc5, 0x9c, 0x60, 0xbd, 0x4f,
      0xff, 0xc3, 0xa9, 0x99, 0x1e, 0xe2, 0x8,  0x60, 0x68, 0x0,  0x5,  0x61, 0xf0, 0x82, 0x6c, 0x7b, 0x0,  0x12, 0x8b,
      0xa8, 0x69, 0x76, 0xb8, 0xd8, 0x70, 0xa7, 0xf9, 0x8e, 0x96, 0xbc, 0x47, 0x5e, 0x27, 0xeb, 0x61, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5a, 0x9};
  uint8_t bytesprops1[] = {0x1e, 0x43, 0x9a, 0x1c, 0x3b, 0x12};
  uint8_t bytesprops2[] = {0xcc, 0x2,  0xec, 0x71, 0x2c, 0xd3, 0x27, 0x8a, 0x50, 0xa1, 0x53,
                           0x88, 0x2b, 0xa3, 0xf,  0xf0, 0x78, 0x12, 0x83, 0x81, 0xd2};
  uint8_t bytesprops3[] = {0x24, 0x8e, 0x98, 0xf5, 0x36, 0x5,  0xa3, 0xee, 0xb3, 0x22,
                           0x4f, 0xa2, 0xd7, 0x2a, 0xfb, 0xb1, 0x33, 0x6,  0xe7, 0x95};
  uint8_t bytesprops4[] = {0x17, 0xd8, 0x2a, 0x70, 0xd,  0x64, 0xf8, 0x2a, 0x64, 0x49,
                           0x65, 0x9a, 0x28, 0xa6, 0xc2, 0xde, 0xcd, 0xce, 0xde, 0xd7};
  uint8_t bytesprops5[] = {0x2c, 0x23, 0xe3, 0xb3, 0x97, 0x2b, 0x7b};
  uint8_t bytesprops6[] = {0x8b, 0x4e, 0x19, 0xb4, 0xba, 0x78, 0x91, 0x83, 0x60, 0x6c, 0x32, 0x68, 0x29, 0xc9, 0x9b,
                           0x98, 0xb1, 0x90, 0x1c, 0x43, 0xdf, 0xee, 0x9a, 0xed, 0x36, 0x64, 0x52, 0x75, 0x34, 0xaa};
  uint8_t bytesprops8[] = {0x9b, 0x50, 0x61, 0x29, 0xa1, 0xe4, 0x3a, 0x9a, 0x54, 0xba,
                           0x33, 0x8b, 0xbb, 0xbd, 0x4f, 0x89, 0x3c, 0x41, 0x23};
  uint8_t bytesprops7[] = {0xed, 0x5f, 0xc3, 0xd3, 0xa3, 0xcc, 0x50, 0x32, 0x66,
                           0xa2, 0x10, 0xb1, 0x3c, 0x6a, 0x21, 0x13, 0xe0};
  uint8_t bytesprops9[] = {0x9b, 0x3a, 0x2f, 0xa3, 0xac, 0x11, 0x18, 0x31, 0x3c, 0xa2, 0x73, 0x2d, 0x42, 0x79, 0x7d,
                           0xe0, 0x75, 0xd4, 0xde, 0x63, 0x74, 0xf7, 0x3c, 0x99, 0x43, 0xa6, 0xde, 0x39, 0xb7};
  uint8_t bytesprops10[] = {0x29, 0x2a, 0x62, 0xbf, 0x85};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26751}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18872}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13684}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24681}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31574}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops7}, .v = {19, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32631}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5351}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xec, 0xb2, 0xc5, 0x7e, 0x2,  0x0,  0x79, 0xbd, 0xe0, 0x8,  0x2a, 0xb,  0xee, 0x97,
                               0x98, 0xcb, 0x14, 0x48, 0x7e, 0xbd, 0xbd, 0x4a, 0xa8, 0xca, 0xea, 0xdf, 0x84, 0xa8};
  uint8_t byteswillprops1[] = {0x6f, 0xe8};
  uint8_t byteswillprops2[] = {0xb1, 0xb7, 0xdb, 0xdf, 0xa2, 0x45, 0x97, 0x45, 0x49,
                               0x57, 0xe2, 0x2f, 0x9a, 0x80, 0x73, 0x29, 0xbb, 0xf2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30115}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12374}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27982}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23541}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22446}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&byteswillprops2}}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x14, 0x90, 0xb2, 0xe5, 0x18, 0xa0, 0x12, 0xe9, 0xf,  0xa0,
                                0x11, 0x47, 0xdb, 0xad, 0xaf, 0xd,  0xa1, 0x33, 0xfa, 0xf6,
                                0xc8, 0xfa, 0xd,  0xc7, 0x4a, 0x9a, 0xa5, 0xc3, 0xdd, 0xed};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x20, 0xcf, 0x28, 0x1c, 0x3f, 0xaf, 0x43, 0x71, 0x0,  0x9a, 0x28, 0xcb, 0x28, 0xba,
                                  0xc5, 0x9c, 0x60, 0xbd, 0x4f, 0xff, 0xc3, 0xa9, 0x99, 0x1e, 0xe2, 0x8,  0x60, 0x68};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13826;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x61, 0xf0, 0x82, 0x6c, 0x7b};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x8b, 0xa8, 0x69, 0x76, 0xb8, 0xd8, 0x70, 0xa7, 0xf9,
                              0x8e, 0x96, 0xbc, 0x47, 0x5e, 0x27, 0xeb, 0x61, 0x1d};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\212\GS\145\247\v\161", _password = Just "{!\212\236\201\231Q", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "", _willMsg =
// "]9\230\162rqS\215\197\SI\129\173\160\"j\ACK\181\v\226\253X\189\&4\146\169\138%\143$", _willProps = [PropContentType
// "\246",PropRetainAvailable 147,PropMessageExpiryInterval 21241,PropSubscriptionIdentifierAvailable
// 172,PropAuthenticationMethod "",PropWillDelayInterval 25801,PropMessageExpiryInterval 9579,PropCorrelationData
// "<\172\236\180\184\246\190mk\ETX\SO\211\&1g",PropMessageExpiryInterval 5348,PropResponseInformation
// "\187\181\163\219\231\189\210\138\190fa\236\185J;lJ\224\239~\149\145\EM\145y",PropServerReference
// "i\ACK\197\210\247\&1Yu\176\DEL\SOU\231G\243\157\SI\182\177",PropMaximumQoS 194,PropRetainAvailable
// 193,PropRequestResponseInformation 206,PropAuthenticationData
// "\178M]]\219\169P\194\184U.\195\165%\134\SYNrm\150\202",PropCorrelationData
// "\249HK\RSL42\STXS\219:\164\SUB\234\221\161\200\251^ih\251\173D\197'\215I\172",PropMessageExpiryInterval
// 26894,PropSubscriptionIdentifierAvailable 234,PropTopicAliasMaximum 21437,PropSubscriptionIdentifierAvailable
// 68,PropAuthenticationMethod "\197\164M",PropReceiveMaximum 2333,PropServerReference
// "\202\US\FS\236@\SI\230\&6\US,\US!\222\&4\139\246\t\186\DLE\178\132\190\251",PropContentType "\202K0\209(p\211*"]}),
// _cleanSession = True, _keepAlive = 10261, _connID = "\137\n\r\250!\209\SO\245\&0\146@>\253V:\197D", _properties =
// [PropRequestResponseInformation 60,PropUserProperty "1\242\143\175.\149\t\146\&7\210\162??\SOH\130\vF"
// "e\167\181\238lP!\175/+\252\247\180N\210]\197\230&\SI",PropSubscriptionIdentifierAvailable
// 227,PropSubscriptionIdentifier 0,PropTopicAliasMaximum 10293,PropWildcardSubscriptionAvailable
// 250,PropCorrelationData "@.i\223G\187",PropRequestProblemInformation 143,PropRequestResponseInformation
// 241,PropTopicAliasMaximum 18222,PropTopicAlias 9204,PropMessageExpiryInterval 28916,PropSharedSubscriptionAvailable
// 149,PropServerKeepAlive 21186,PropUserProperty "\138\fS\245\169\f \DC4\146\191\226\133\SYN \220"
// "\175\f\155n\SOH\190\SOB\239\156K\203\128\131%",PropMessageExpiryInterval 13949,PropServerKeepAlive
// 27732,PropMaximumPacketSize 8468,PropMessageExpiryInterval 2102,PropResponseInformation
// "\EOT\ENQR\DC3ZYh\174\173-\217\188\DC19\216\151sc\NAK\254\251",PropUserProperty
// "_\167\ACK\199\146\STX\235\209\136\DC4\191\190\202 \SO\CAN\157\240\228\228TY\209+\189\175" "X\200\247FN\SI\DC3\141
// \222_x"]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0xf6, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x28, 0x15, 0xca, 0x1,  0x19, 0x3c, 0x26, 0x0,
      0x11, 0x31, 0xf2, 0x8f, 0xaf, 0x2e, 0x95, 0x9,  0x92, 0x37, 0xd2, 0xa2, 0x3f, 0x3f, 0x1,  0x82, 0xb,  0x46, 0x0,
      0x14, 0x65, 0xa7, 0xb5, 0xee, 0x6c, 0x50, 0x21, 0xaf, 0x2f, 0x2b, 0xfc, 0xf7, 0xb4, 0x4e, 0xd2, 0x5d, 0xc5, 0xe6,
      0x26, 0xf,  0x29, 0xe3, 0xb,  0x0,  0x22, 0x28, 0x35, 0x28, 0xfa, 0x9,  0x0,  0x6,  0x40, 0x2e, 0x69, 0xdf, 0x47,
      0xbb, 0x17, 0x8f, 0x19, 0xf1, 0x22, 0x47, 0x2e, 0x23, 0x23, 0xf4, 0x2,  0x0,  0x0,  0x70, 0xf4, 0x2a, 0x95, 0x13,
      0x52, 0xc2, 0x26, 0x0,  0xf,  0x8a, 0xc,  0x53, 0xf5, 0xa9, 0xc,  0x20, 0x14, 0x92, 0xbf, 0xe2, 0x85, 0x16, 0x20,
      0xdc, 0x0,  0xf,  0xaf, 0xc,  0x9b, 0x6e, 0x1,  0xbe, 0xe,  0x42, 0xef, 0x9c, 0x4b, 0xcb, 0x80, 0x83, 0x25, 0x2,
      0x0,  0x0,  0x36, 0x7d, 0x13, 0x6c, 0x54, 0x27, 0x0,  0x0,  0x21, 0x14, 0x2,  0x0,  0x0,  0x8,  0x36, 0x1a, 0x0,
      0x15, 0x4,  0x5,  0x52, 0x13, 0x5a, 0x59, 0x68, 0xae, 0xad, 0x2d, 0xd9, 0xbc, 0x11, 0x39, 0xd8, 0x97, 0x73, 0x63,
      0x15, 0xfe, 0xfb, 0x26, 0x0,  0x1a, 0x5f, 0xa7, 0x6,  0xc7, 0x92, 0x2,  0xeb, 0xd1, 0x88, 0x14, 0xbf, 0xbe, 0xca,
      0x20, 0xe,  0x18, 0x9d, 0xf0, 0xe4, 0xe4, 0x54, 0x59, 0xd1, 0x2b, 0xbd, 0xaf, 0x0,  0xc,  0x58, 0xc8, 0xf7, 0x46,
      0x4e, 0xf,  0x13, 0x8d, 0x20, 0xde, 0x5f, 0x78, 0x0,  0x11, 0x89, 0xa,  0xd,  0xfa, 0x21, 0xd1, 0xe,  0xf5, 0x30,
      0x92, 0x40, 0x3e, 0xfd, 0x56, 0x3a, 0xc5, 0x44, 0xd9, 0x1,  0x3,  0x0,  0x1,  0xf6, 0x25, 0x93, 0x2,  0x0,  0x0,
      0x52, 0xf9, 0x29, 0xac, 0x15, 0x0,  0x0,  0x18, 0x0,  0x0,  0x64, 0xc9, 0x2,  0x0,  0x0,  0x25, 0x6b, 0x9,  0x0,
      0xe,  0x3c, 0xac, 0xec, 0xb4, 0xb8, 0xf6, 0xbe, 0x6d, 0x6b, 0x3,  0xe,  0xd3, 0x31, 0x67, 0x2,  0x0,  0x0,  0x14,
      0xe4, 0x1a, 0x0,  0x19, 0xbb, 0xb5, 0xa3, 0xdb, 0xe7, 0xbd, 0xd2, 0x8a, 0xbe, 0x66, 0x61, 0xec, 0xb9, 0x4a, 0x3b,
      0x6c, 0x4a, 0xe0, 0xef, 0x7e, 0x95, 0x91, 0x19, 0x91, 0x79, 0x1c, 0x0,  0x13, 0x69, 0x6,  0xc5, 0xd2, 0xf7, 0x31,
      0x59, 0x75, 0xb0, 0x7f, 0xe,  0x55, 0xe7, 0x47, 0xf3, 0x9d, 0xf,  0xb6, 0xb1, 0x24, 0xc2, 0x25, 0xc1, 0x19, 0xce,
      0x16, 0x0,  0x14, 0xb2, 0x4d, 0x5d, 0x5d, 0xdb, 0xa9, 0x50, 0xc2, 0xb8, 0x55, 0x2e, 0xc3, 0xa5, 0x25, 0x86, 0x16,
      0x72, 0x6d, 0x96, 0xca, 0x9,  0x0,  0x1d, 0xf9, 0x48, 0x4b, 0x1e, 0x4c, 0x34, 0x32, 0x2,  0x53, 0xdb, 0x3a, 0xa4,
      0x1a, 0xea, 0xdd, 0xa1, 0xc8, 0xfb, 0x5e, 0x69, 0x68, 0xfb, 0xad, 0x44, 0xc5, 0x27, 0xd7, 0x49, 0xac, 0x2,  0x0,
      0x0,  0x69, 0xe,  0x29, 0xea, 0x22, 0x53, 0xbd, 0x29, 0x44, 0x15, 0x0,  0x3,  0xc5, 0xa4, 0x4d, 0x21, 0x9,  0x1d,
      0x1c, 0x0,  0x17, 0xca, 0x1f, 0x1c, 0xec, 0x40, 0xf,  0xe6, 0x36, 0x1f, 0x2c, 0x1f, 0x21, 0xde, 0x34, 0x8b, 0xf6,
      0x9,  0xba, 0x10, 0xb2, 0x84, 0xbe, 0xfb, 0x3,  0x0,  0x8,  0xca, 0x4b, 0x30, 0xd1, 0x28, 0x70, 0xd3, 0x2a, 0x0,
      0x0,  0x0,  0x1d, 0x5d, 0x39, 0xe6, 0xa2, 0x72, 0x71, 0x53, 0xd7, 0xc5, 0xf,  0x81, 0xad, 0xa0, 0x22, 0x6a, 0x6,
      0xb5, 0xb,  0xe2, 0xfd, 0x58, 0xbd, 0x34, 0x92, 0xa9, 0x8a, 0x25, 0x8f, 0x24, 0x0,  0x6,  0xd4, 0x1d, 0x91, 0xf7,
      0xb,  0xa1, 0x0,  0x7,  0x7b, 0x21, 0xd4, 0xec, 0xc9, 0xe7, 0x51};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x65, 0xa7, 0xb5, 0xee, 0x6c, 0x50, 0x21, 0xaf, 0x2f, 0x2b,
                           0xfc, 0xf7, 0xb4, 0x4e, 0xd2, 0x5d, 0xc5, 0xe6, 0x26, 0xf};
  uint8_t bytesprops0[] = {0x31, 0xf2, 0x8f, 0xaf, 0x2e, 0x95, 0x9, 0x92, 0x37,
                           0xd2, 0xa2, 0x3f, 0x3f, 0x1,  0x82, 0xb, 0x46};
  uint8_t bytesprops2[] = {0x40, 0x2e, 0x69, 0xdf, 0x47, 0xbb};
  uint8_t bytesprops4[] = {0xaf, 0xc, 0x9b, 0x6e, 0x1, 0xbe, 0xe, 0x42, 0xef, 0x9c, 0x4b, 0xcb, 0x80, 0x83, 0x25};
  uint8_t bytesprops3[] = {0x8a, 0xc, 0x53, 0xf5, 0xa9, 0xc, 0x20, 0x14, 0x92, 0xbf, 0xe2, 0x85, 0x16, 0x20, 0xdc};
  uint8_t bytesprops5[] = {0x4,  0x5,  0x52, 0x13, 0x5a, 0x59, 0x68, 0xae, 0xad, 0x2d, 0xd9,
                           0xbc, 0x11, 0x39, 0xd8, 0x97, 0x73, 0x63, 0x15, 0xfe, 0xfb};
  uint8_t bytesprops7[] = {0x58, 0xc8, 0xf7, 0x46, 0x4e, 0xf, 0x13, 0x8d, 0x20, 0xde, 0x5f, 0x78};
  uint8_t bytesprops6[] = {0x5f, 0xa7, 0x6,  0xc7, 0x92, 0x2,  0xeb, 0xd1, 0x88, 0x14, 0xbf, 0xbe, 0xca,
                           0x20, 0xe,  0x18, 0x9d, 0xf0, 0xe4, 0xe4, 0x54, 0x59, 0xd1, 0x2b, 0xbd, 0xaf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10293}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18222}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9204}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28916}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21186}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops3}, .v = {15, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13949}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27732}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8468}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2102}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops6}, .v = {12, (char*)&bytesprops7}}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf6};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops2[] = {0x3c, 0xac, 0xec, 0xb4, 0xb8, 0xf6, 0xbe, 0x6d, 0x6b, 0x3, 0xe, 0xd3, 0x31, 0x67};
  uint8_t byteswillprops3[] = {0xbb, 0xb5, 0xa3, 0xdb, 0xe7, 0xbd, 0xd2, 0x8a, 0xbe, 0x66, 0x61, 0xec, 0xb9,
                               0x4a, 0x3b, 0x6c, 0x4a, 0xe0, 0xef, 0x7e, 0x95, 0x91, 0x19, 0x91, 0x79};
  uint8_t byteswillprops4[] = {0x69, 0x6,  0xc5, 0xd2, 0xf7, 0x31, 0x59, 0x75, 0xb0, 0x7f,
                               0xe,  0x55, 0xe7, 0x47, 0xf3, 0x9d, 0xf,  0xb6, 0xb1};
  uint8_t byteswillprops5[] = {0xb2, 0x4d, 0x5d, 0x5d, 0xdb, 0xa9, 0x50, 0xc2, 0xb8, 0x55,
                               0x2e, 0xc3, 0xa5, 0x25, 0x86, 0x16, 0x72, 0x6d, 0x96, 0xca};
  uint8_t byteswillprops6[] = {0xf9, 0x48, 0x4b, 0x1e, 0x4c, 0x34, 0x32, 0x2,  0x53, 0xdb, 0x3a, 0xa4, 0x1a, 0xea, 0xdd,
                               0xa1, 0xc8, 0xfb, 0x5e, 0x69, 0x68, 0xfb, 0xad, 0x44, 0xc5, 0x27, 0xd7, 0x49, 0xac};
  uint8_t byteswillprops7[] = {0xc5, 0xa4, 0x4d};
  uint8_t byteswillprops8[] = {0xca, 0x1f, 0x1c, 0xec, 0x40, 0xf,  0xe6, 0x36, 0x1f, 0x2c, 0x1f, 0x21,
                               0xde, 0x34, 0x8b, 0xf6, 0x9,  0xba, 0x10, 0xb2, 0x84, 0xbe, 0xfb};
  uint8_t byteswillprops9[] = {0xca, 0x4b, 0x30, 0xd1, 0x28, 0x70, 0xd3, 0x2a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21241}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25801}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9579}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5348}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26894}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21437}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2333}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&byteswillprops9}}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5d, 0x39, 0xe6, 0xa2, 0x72, 0x71, 0x53, 0xd7, 0xc5, 0xf,
                                  0x81, 0xad, 0xa0, 0x22, 0x6a, 0x6,  0xb5, 0xb,  0xe2, 0xfd,
                                  0x58, 0xbd, 0x34, 0x92, 0xa9, 0x8a, 0x25, 0x8f, 0x24};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10261;
  uint8_t client_id_bytes[] = {0x89, 0xa,  0xd,  0xfa, 0x21, 0xd1, 0xe,  0xf5, 0x30,
                               0x92, 0x40, 0x3e, 0xfd, 0x56, 0x3a, 0xc5, 0x44};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd4, 0x1d, 0x91, 0xf7, 0xb, 0xa1};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x7b, 0x21, 0xd4, 0xec, 0xc9, 0xe7, 0x51};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\221\242}\231\174B\GS\239\159Y\168\135+?h\249\&9`9<\191\211!\157\134\174",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\181\SUB\128:,a\250\247V)\184\235rKQORD!\154\244M\a", _willMsg =
// "\160\135:w_\160cdu\218\207\198\170\214\131\252w*0\v\204\191\186\ACK\224v", _willProps = []}), _cleanSession = False,
// _keepAlive = 27848, _connID = "|c\",E\248\&4\129\STX\254\128^\SYNv\175", _properties = [PropMessageExpiryInterval
// 29973,PropSharedSubscriptionAvailable 47,PropMaximumQoS 82,PropPayloadFormatIndicator
// 15,PropSubscriptionIdentifierAvailable 104,PropSessionExpiryInterval 12791,PropSharedSubscriptionAvailable
// 26,PropPayloadFormatIndicator 53,PropSessionExpiryInterval 22192,PropReasonString
// "1\158\140,\135\&4\193&\197\167\159\187w\231S\223\162\191\212\\\DC4,",PropMessageExpiryInterval
// 20556,PropSubscriptionIdentifierAvailable 202,PropCorrelationData
// "\195\145\135\211L\206\254\138k\229G",PropMessageExpiryInterval 6156,PropPayloadFormatIndicator 137]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0xbe, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xac, 0x6c, 0xc8, 0x50, 0x2,  0x0,  0x0,
                   0x75, 0x15, 0x2a, 0x2f, 0x24, 0x52, 0x1,  0xf,  0x29, 0x68, 0x11, 0x0,  0x0,  0x31, 0xf7, 0x2a, 0x1a,
                   0x1,  0x35, 0x11, 0x0,  0x0,  0x56, 0xb0, 0x1f, 0x0,  0x16, 0x31, 0x9e, 0x8c, 0x2c, 0x87, 0x34, 0xc1,
                   0x26, 0xc5, 0xa7, 0x9f, 0xbb, 0x77, 0xe7, 0x53, 0xdf, 0xa2, 0xbf, 0xd4, 0x5c, 0x14, 0x2c, 0x2,  0x0,
                   0x0,  0x50, 0x4c, 0x29, 0xca, 0x9,  0x0,  0xb,  0xc3, 0x91, 0x87, 0xd3, 0x4c, 0xce, 0xfe, 0x8a, 0x6b,
                   0xe5, 0x47, 0x2,  0x0,  0x0,  0x18, 0xc,  0x1,  0x89, 0x0,  0xf,  0x7c, 0x63, 0x22, 0x2c, 0x45, 0xf8,
                   0x34, 0x81, 0x2,  0xfe, 0x80, 0x5e, 0x16, 0x76, 0xaf, 0x0,  0x0,  0x17, 0xb5, 0x1a, 0x80, 0x3a, 0x2c,
                   0x61, 0xfa, 0xf7, 0x56, 0x29, 0xb8, 0xeb, 0x72, 0x4b, 0x51, 0x4f, 0x52, 0x44, 0x21, 0x9a, 0xf4, 0x4d,
                   0x7,  0x0,  0x1a, 0xa0, 0x87, 0x3a, 0x77, 0x5f, 0xa0, 0x63, 0x64, 0x75, 0xda, 0xcf, 0xc6, 0xaa, 0xd6,
                   0x83, 0xfc, 0x77, 0x2a, 0x30, 0xb,  0xcc, 0xbf, 0xba, 0x6,  0xe0, 0x76, 0x0,  0x1a, 0xdd, 0xf2, 0x7d,
                   0xe7, 0xae, 0x42, 0x1d, 0xef, 0x9f, 0x59, 0xa8, 0x87, 0x2b, 0x3f, 0x68, 0xf9, 0x39, 0x60, 0x39, 0x3c,
                   0xbf, 0xd3, 0x21, 0x9d, 0x86, 0xae};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x31, 0x9e, 0x8c, 0x2c, 0x87, 0x34, 0xc1, 0x26, 0xc5, 0xa7, 0x9f,
                           0xbb, 0x77, 0xe7, 0x53, 0xdf, 0xa2, 0xbf, 0xd4, 0x5c, 0x14, 0x2c};
  uint8_t bytesprops1[] = {0xc3, 0x91, 0x87, 0xd3, 0x4c, 0xce, 0xfe, 0x8a, 0x6b, 0xe5, 0x47};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29973}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12791}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22192}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20556}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6156}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 137}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb5, 0x1a, 0x80, 0x3a, 0x2c, 0x61, 0xfa, 0xf7, 0x56, 0x29, 0xb8, 0xeb,
                                0x72, 0x4b, 0x51, 0x4f, 0x52, 0x44, 0x21, 0x9a, 0xf4, 0x4d, 0x7};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa0, 0x87, 0x3a, 0x77, 0x5f, 0xa0, 0x63, 0x64, 0x75, 0xda, 0xcf, 0xc6, 0xaa,
                                  0xd6, 0x83, 0xfc, 0x77, 0x2a, 0x30, 0xb,  0xcc, 0xbf, 0xba, 0x6,  0xe0, 0x76};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27848;
  uint8_t client_id_bytes[] = {0x7c, 0x63, 0x22, 0x2c, 0x45, 0xf8, 0x34, 0x81, 0x2, 0xfe, 0x80, 0x5e, 0x16, 0x76, 0xaf};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xdd, 0xf2, 0x7d, 0xe7, 0xae, 0x42, 0x1d, 0xef, 0x9f, 0x59, 0xa8, 0x87, 0x2b,
                              0x3f, 0x68, 0xf9, 0x39, 0x60, 0x39, 0x3c, 0xbf, 0xd3, 0x21, 0x9d, 0x86, 0xae};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\235w\132m]\248$4\232\&0\249V\214\DEL\182\170\EOT\DLE\DC1\212X\147-\207\&0",
// _password = Just "B\245\236\128\196\"\v\166[\CAN\160u\146&\ENQ*\DC1tN?h", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\141", _willMsg = "\251\154\202\252\&51i(\SOK", _willProps =
// [PropRequestProblemInformation 222,PropTopicAliasMaximum 13107,PropWillDelayInterval
// 12452,PropAssignedClientIdentifier
// "\240\166\247\223|#\193\193\178\193a\138\183\228|\162=\128",PropMessageExpiryInterval
// 30328,PropSharedSubscriptionAvailable 13,PropReceiveMaximum 21462,PropRequestResponseInformation
// 218,PropResponseTopic "\244\242>a\DC2\US\n\131`\196\203a\214\169\DC2\164k",PropAssignedClientIdentifier
// "\241?\174A\148\194\220\207\b\232o'\191f\196g\202&\241\181]\NUL8\139X\180\229\167\&6\212",PropSubscriptionIdentifier
// 0]}), _cleanSession = True, _keepAlive = 7077, _connID = "\166\&2\183R\234\EM*\227 \nz\SYN\ENQ", _properties =
// [PropSubscriptionIdentifierAvailable 184,PropSessionExpiryInterval 30559,PropSubscriptionIdentifier
// 25,PropUserProperty "\v\DC3T\175R\161\245\244" "",PropMessageExpiryInterval 9738,PropPayloadFormatIndicator
// 210,PropSharedSubscriptionAvailable 42,PropSharedSubscriptionAvailable 253,PropTopicAlias 4943,PropResponseTopic
// "gY\132",PropTopicAlias 8971,PropAuthenticationMethod
// "\161a\230q\SYN\ACK\204\168P\EOT\165\USz\203\228\227\240\DC3\141n\211Vu{\243\201,\NULE\161",PropTopicAlias
// 11926,PropAssignedClientIdentifier "\NAK\223",PropAuthenticationMethod
// "\158\171\141\228\145\225(\133d\194\&9\186\209\ENQ",PropSharedSubscriptionAvailable 39,PropMaximumQoS
// 223,PropUserProperty "\227\178\161\167\232\149\174>\STX\233\SO\156\ACKD\190&Iq\168\191"
// "\160\151\239|Fq\216\129\&8\250N\130T\152\167\ETB\246\b\178\130\RS[W\132",PropMaximumPacketSize
// 12119,PropMessageExpiryInterval 11980,PropReasonString
// "\187\156\155\226\ENQ(ym\234\DLE1i\234\SO\171c\207p",PropTopicAlias 15565,PropSessionExpiryInterval
// 19627,PropSubscriptionIdentifierAvailable 9,PropMaximumPacketSize 1238]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x10, 0x89, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x1b, 0xa5, 0xca, 0x1,  0x29, 0xb8, 0x11, 0x0,
      0x0,  0x77, 0x5f, 0xb,  0x19, 0x26, 0x0,  0x8,  0xb,  0x13, 0x54, 0xaf, 0x52, 0xa1, 0xf5, 0xf4, 0x0,  0x0,  0x2,
      0x0,  0x0,  0x26, 0xa,  0x1,  0xd2, 0x2a, 0x2a, 0x2a, 0xfd, 0x23, 0x13, 0x4f, 0x8,  0x0,  0x3,  0x67, 0x59, 0x84,
      0x23, 0x23, 0xb,  0x15, 0x0,  0x1e, 0xa1, 0x61, 0xe6, 0x71, 0x16, 0x6,  0xcc, 0xa8, 0x50, 0x4,  0xa5, 0x1f, 0x7a,
      0xcb, 0xe4, 0xe3, 0xf0, 0x13, 0x8d, 0x6e, 0xd3, 0x56, 0x75, 0x7b, 0xf3, 0xc9, 0x2c, 0x0,  0x45, 0xa1, 0x23, 0x2e,
      0x96, 0x12, 0x0,  0x2,  0x15, 0xdf, 0x15, 0x0,  0xe,  0x9e, 0xab, 0x8d, 0xe4, 0x91, 0xe1, 0x28, 0x85, 0x64, 0xc2,
      0x39, 0xba, 0xd1, 0x5,  0x2a, 0x27, 0x24, 0xdf, 0x26, 0x0,  0x14, 0xe3, 0xb2, 0xa1, 0xa7, 0xe8, 0x95, 0xae, 0x3e,
      0x2,  0xe9, 0xe,  0x9c, 0x6,  0x44, 0xbe, 0x26, 0x49, 0x71, 0xa8, 0xbf, 0x0,  0x18, 0xa0, 0x97, 0xef, 0x7c, 0x46,
      0x71, 0xd8, 0x81, 0x38, 0xfa, 0x4e, 0x82, 0x54, 0x98, 0xa7, 0x17, 0xf6, 0x8,  0xb2, 0x82, 0x1e, 0x5b, 0x57, 0x84,
      0x27, 0x0,  0x0,  0x2f, 0x57, 0x2,  0x0,  0x0,  0x2e, 0xcc, 0x1f, 0x0,  0x12, 0xbb, 0x9c, 0x9b, 0xe2, 0x5,  0x28,
      0x79, 0x6d, 0xea, 0x10, 0x31, 0x69, 0xea, 0xe,  0xab, 0x63, 0xcf, 0x70, 0x23, 0x3c, 0xcd, 0x11, 0x0,  0x0,  0x4c,
      0xab, 0x29, 0x9,  0x27, 0x0,  0x0,  0x4,  0xd6, 0x0,  0xd,  0xa6, 0x32, 0xb7, 0x52, 0xea, 0x19, 0x2a, 0xe3, 0x20,
      0xa,  0x7a, 0x16, 0x5,  0x62, 0x17, 0xde, 0x22, 0x33, 0x33, 0x18, 0x0,  0x0,  0x30, 0xa4, 0x12, 0x0,  0x12, 0xf0,
      0xa6, 0xf7, 0xdf, 0x7c, 0x23, 0xc1, 0xc1, 0xb2, 0xc1, 0x61, 0x8a, 0xb7, 0xe4, 0x7c, 0xa2, 0x3d, 0x80, 0x2,  0x0,
      0x0,  0x76, 0x78, 0x2a, 0xd,  0x21, 0x53, 0xd6, 0x19, 0xda, 0x8,  0x0,  0x11, 0xf4, 0xf2, 0x3e, 0x61, 0x12, 0x1f,
      0xa,  0x83, 0x60, 0xc4, 0xcb, 0x61, 0xd6, 0xa9, 0x12, 0xa4, 0x6b, 0x12, 0x0,  0x1e, 0xf1, 0x3f, 0xae, 0x41, 0x94,
      0xc2, 0xdc, 0xcf, 0x8,  0xe8, 0x6f, 0x27, 0xbf, 0x66, 0xc4, 0x67, 0xca, 0x26, 0xf1, 0xb5, 0x5d, 0x0,  0x38, 0x8b,
      0x58, 0xb4, 0xe5, 0xa7, 0x36, 0xd4, 0xb,  0x0,  0x0,  0x1,  0x8d, 0x0,  0xa,  0xfb, 0x9a, 0xca, 0xfc, 0x35, 0x31,
      0x69, 0x28, 0xe,  0x4b, 0x0,  0x19, 0xeb, 0x77, 0x84, 0x6d, 0x5d, 0xf8, 0x24, 0x34, 0xe8, 0x30, 0xf9, 0x56, 0xd6,
      0x7f, 0xb6, 0xaa, 0x4,  0x10, 0x11, 0xd4, 0x58, 0x93, 0x2d, 0xcf, 0x30, 0x0,  0x15, 0x42, 0xf5, 0xec, 0x80, 0xc4,
      0x22, 0xb,  0xa6, 0x5b, 0x18, 0xa0, 0x75, 0x92, 0x26, 0x5,  0x2a, 0x11, 0x74, 0x4e, 0x3f, 0x68};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops0[] = {0xb, 0x13, 0x54, 0xaf, 0x52, 0xa1, 0xf5, 0xf4};
  uint8_t bytesprops2[] = {0x67, 0x59, 0x84};
  uint8_t bytesprops3[] = {0xa1, 0x61, 0xe6, 0x71, 0x16, 0x6,  0xcc, 0xa8, 0x50, 0x4,  0xa5, 0x1f, 0x7a, 0xcb, 0xe4,
                           0xe3, 0xf0, 0x13, 0x8d, 0x6e, 0xd3, 0x56, 0x75, 0x7b, 0xf3, 0xc9, 0x2c, 0x0,  0x45, 0xa1};
  uint8_t bytesprops4[] = {0x15, 0xdf};
  uint8_t bytesprops5[] = {0x9e, 0xab, 0x8d, 0xe4, 0x91, 0xe1, 0x28, 0x85, 0x64, 0xc2, 0x39, 0xba, 0xd1, 0x5};
  uint8_t bytesprops7[] = {0xa0, 0x97, 0xef, 0x7c, 0x46, 0x71, 0xd8, 0x81, 0x38, 0xfa, 0x4e, 0x82,
                           0x54, 0x98, 0xa7, 0x17, 0xf6, 0x8,  0xb2, 0x82, 0x1e, 0x5b, 0x57, 0x84};
  uint8_t bytesprops6[] = {0xe3, 0xb2, 0xa1, 0xa7, 0xe8, 0x95, 0xae, 0x3e, 0x2,  0xe9,
                           0xe,  0x9c, 0x6,  0x44, 0xbe, 0x26, 0x49, 0x71, 0xa8, 0xbf};
  uint8_t bytesprops8[] = {0xbb, 0x9c, 0x9b, 0xe2, 0x5, 0x28, 0x79, 0x6d, 0xea,
                           0x10, 0x31, 0x69, 0xea, 0xe, 0xab, 0x63, 0xcf, 0x70};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30559}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 25}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {0, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9738}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4943}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8971}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11926}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops6}, .v = {24, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12119}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11980}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15565}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19627}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1238}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf0, 0xa6, 0xf7, 0xdf, 0x7c, 0x23, 0xc1, 0xc1, 0xb2,
                               0xc1, 0x61, 0x8a, 0xb7, 0xe4, 0x7c, 0xa2, 0x3d, 0x80};
  uint8_t byteswillprops1[] = {0xf4, 0xf2, 0x3e, 0x61, 0x12, 0x1f, 0xa,  0x83, 0x60,
                               0xc4, 0xcb, 0x61, 0xd6, 0xa9, 0x12, 0xa4, 0x6b};
  uint8_t byteswillprops2[] = {0xf1, 0x3f, 0xae, 0x41, 0x94, 0xc2, 0xdc, 0xcf, 0x8,  0xe8,
                               0x6f, 0x27, 0xbf, 0x66, 0xc4, 0x67, 0xca, 0x26, 0xf1, 0xb5,
                               0x5d, 0x0,  0x38, 0x8b, 0x58, 0xb4, 0xe5, 0xa7, 0x36, 0xd4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13107}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12452}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30328}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21462}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
  };

  lwmqtt_properties_t willprops = {11, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8d};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb, 0x9a, 0xca, 0xfc, 0x35, 0x31, 0x69, 0x28, 0xe, 0x4b};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7077;
  uint8_t client_id_bytes[] = {0xa6, 0x32, 0xb7, 0x52, 0xea, 0x19, 0x2a, 0xe3, 0x20, 0xa, 0x7a, 0x16, 0x5};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xeb, 0x77, 0x84, 0x6d, 0x5d, 0xf8, 0x24, 0x34, 0xe8, 0x30, 0xf9, 0x56, 0xd6,
                              0x7f, 0xb6, 0xaa, 0x4,  0x10, 0x11, 0xd4, 0x58, 0x93, 0x2d, 0xcf, 0x30};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x42, 0xf5, 0xec, 0x80, 0xc4, 0x22, 0xb,  0xa6, 0x5b, 0x18, 0xa0,
                              0x75, 0x92, 0x26, 0x5,  0x2a, 0x11, 0x74, 0x4e, 0x3f, 0x68};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just " \173\&3f\DC4", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "\SUB\224\241\aY%\155\222\143G\155T\163lx\218+", _willMsg =
// "m\130Tq\186R\196\157\v\245\FS\140\202\ETB\143\v\188\159\199\242\237\249A\DEL", _willProps = [PropTopicAlias
// 12587,PropTopicAlias 20812,PropRequestProblemInformation 63,PropServerKeepAlive 6655,PropTopicAliasMaximum
// 24552,PropContentType "\229\251\&4R\180\208\DC4/\147\141\196\EOT\211\149",PropMaximumQoS 199,PropCorrelationData
// "\252\240\SYN\147\221\204V\169\&2j\SOY\156\EOT\140\248\211|u\b\ACK\231\&6\223a\227"]}), _cleanSession = True,
// _keepAlive = 16885, _connID = "", _properties = [PropServerReference "\SOHRM\GS\154",PropResponseTopic
// ":g6\165\129\139|h\f2\210}\n2*M\186\142\149\157\129e\161\164M\157\199j:",PropPayloadFormatIndicator
// 74,PropMessageExpiryInterval 7166,PropSharedSubscriptionAvailable 99,PropReasonString
// "Fw3ry\206`s\DC4%I\ETB\226W\137\176\217k\130-\237\"*D\134\232\207\176W",PropServerKeepAlive 31247,PropUserProperty
// "\199P\237\222`\FS\153\STX\213m\217\254\156\218\ESC\ENQ0" "\173i\138\vj\231\246\199`"]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0xf3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8e, 0x41, 0xf5, 0x73, 0x1c, 0x0,  0x5,  0x1,  0x52,
      0x4d, 0x1d, 0x9a, 0x8,  0x0,  0x1d, 0x3a, 0x67, 0x36, 0xa5, 0x81, 0x8b, 0x7c, 0x68, 0xc,  0x32, 0xd2, 0x7d, 0xa,
      0x32, 0x2a, 0x4d, 0xba, 0x8e, 0x95, 0x9d, 0x81, 0x65, 0xa1, 0xa4, 0x4d, 0x9d, 0xc7, 0x6a, 0x3a, 0x1,  0x4a, 0x2,
      0x0,  0x0,  0x1b, 0xfe, 0x2a, 0x63, 0x1f, 0x0,  0x1d, 0x46, 0x77, 0x33, 0x72, 0x79, 0xce, 0x60, 0x73, 0x14, 0x25,
      0x49, 0x17, 0xe2, 0x57, 0x89, 0xb0, 0xd9, 0x6b, 0x82, 0x2d, 0xed, 0x22, 0x2a, 0x44, 0x86, 0xe8, 0xcf, 0xb0, 0x57,
      0x13, 0x7a, 0xf,  0x26, 0x0,  0x11, 0xc7, 0x50, 0xed, 0xde, 0x60, 0x1c, 0x99, 0x2,  0xd5, 0x6d, 0xd9, 0xfe, 0x9c,
      0xda, 0x1b, 0x5,  0x30, 0x0,  0x9,  0xad, 0x69, 0x8a, 0xb,  0x6a, 0xe7, 0xf6, 0xc7, 0x60, 0x0,  0x0,  0x3e, 0x23,
      0x31, 0x2b, 0x23, 0x51, 0x4c, 0x17, 0x3f, 0x13, 0x19, 0xff, 0x22, 0x5f, 0xe8, 0x3,  0x0,  0xe,  0xe5, 0xfb, 0x34,
      0x52, 0xb4, 0xd0, 0x14, 0x2f, 0x93, 0x8d, 0xc4, 0x4,  0xd3, 0x95, 0x24, 0xc7, 0x9,  0x0,  0x1a, 0xfc, 0xf0, 0x16,
      0x93, 0xdd, 0xcc, 0x56, 0xa9, 0x32, 0x6a, 0xe,  0x59, 0x9c, 0x4,  0x8c, 0xf8, 0xd3, 0x7c, 0x75, 0x8,  0x6,  0xe7,
      0x36, 0xdf, 0x61, 0xe3, 0x0,  0x11, 0x1a, 0xe0, 0xf1, 0x7,  0x59, 0x25, 0x9b, 0xde, 0x8f, 0x47, 0x9b, 0x54, 0xa3,
      0x6c, 0x78, 0xda, 0x2b, 0x0,  0x18, 0x6d, 0x82, 0x54, 0x71, 0xba, 0x52, 0xc4, 0x9d, 0xb,  0xf5, 0x1c, 0x8c, 0xca,
      0x17, 0x8f, 0xb,  0xbc, 0x9f, 0xc7, 0xf2, 0xed, 0xf9, 0x41, 0x7f, 0x0,  0x5,  0x20, 0xad, 0x33, 0x66, 0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1, 0x52, 0x4d, 0x1d, 0x9a};
  uint8_t bytesprops1[] = {0x3a, 0x67, 0x36, 0xa5, 0x81, 0x8b, 0x7c, 0x68, 0xc,  0x32, 0xd2, 0x7d, 0xa,  0x32, 0x2a,
                           0x4d, 0xba, 0x8e, 0x95, 0x9d, 0x81, 0x65, 0xa1, 0xa4, 0x4d, 0x9d, 0xc7, 0x6a, 0x3a};
  uint8_t bytesprops2[] = {0x46, 0x77, 0x33, 0x72, 0x79, 0xce, 0x60, 0x73, 0x14, 0x25, 0x49, 0x17, 0xe2, 0x57, 0x89,
                           0xb0, 0xd9, 0x6b, 0x82, 0x2d, 0xed, 0x22, 0x2a, 0x44, 0x86, 0xe8, 0xcf, 0xb0, 0x57};
  uint8_t bytesprops4[] = {0xad, 0x69, 0x8a, 0xb, 0x6a, 0xe7, 0xf6, 0xc7, 0x60};
  uint8_t bytesprops3[] = {0xc7, 0x50, 0xed, 0xde, 0x60, 0x1c, 0x99, 0x2, 0xd5,
                           0x6d, 0xd9, 0xfe, 0x9c, 0xda, 0x1b, 0x5,  0x30};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7166}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31247}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops3}, .v = {9, (char*)&bytesprops4}}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xe5, 0xfb, 0x34, 0x52, 0xb4, 0xd0, 0x14, 0x2f, 0x93, 0x8d, 0xc4, 0x4, 0xd3, 0x95};
  uint8_t byteswillprops1[] = {0xfc, 0xf0, 0x16, 0x93, 0xdd, 0xcc, 0x56, 0xa9, 0x32, 0x6a, 0xe,  0x59, 0x9c,
                               0x4,  0x8c, 0xf8, 0xd3, 0x7c, 0x75, 0x8,  0x6,  0xe7, 0x36, 0xdf, 0x61, 0xe3};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12587}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20812}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6655}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24552}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&byteswillprops1}}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1a, 0xe0, 0xf1, 0x7,  0x59, 0x25, 0x9b, 0xde, 0x8f,
                                0x47, 0x9b, 0x54, 0xa3, 0x6c, 0x78, 0xda, 0x2b};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6d, 0x82, 0x54, 0x71, 0xba, 0x52, 0xc4, 0x9d, 0xb,  0xf5, 0x1c, 0x8c,
                                  0xca, 0x17, 0x8f, 0xb,  0xbc, 0x9f, 0xc7, 0xf2, 0xed, 0xf9, 0x41, 0x7f};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16885;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x20, 0xad, 0x33, 0x66, 0x14};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\162\146\138\141K)\DEL\142\&8zW\163\DC2M#\138\ENQ\NUL\134\235\203", _password =
// Just "\133\n\206/_y\134\132\146/\225s 4O\210\144\130\GS\148b", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "\251\220\159\161T\129^\175\210\212\RS0Yh\NAK\141{5\207lv\193\253\209", _willMsg =
// "\202{q\255\165\RS", _willProps = [PropReasonString "\168\154\234\&83o\192\NAK\202",PropRequestProblemInformation
// 231,PropRetainAvailable 97,PropUserProperty "q\142\NUL,\255\238\211\245\224\DC4\DC2\235\RS\145"
// ">\US\141r\136\162\CAN\254\209\139\160\178\162n\220RI",PropContentType "\142\247DZ^\180e]\n",PropContentType
// "5(NH>\143x",PropTopicAlias 27268,PropReasonString
// "'\227w\244\183\240\230\146+\SI\186C_C\172y$",PropRequestProblemInformation 87,PropWillDelayInterval
// 31902,PropRequestResponseInformation 176,PropMessageExpiryInterval 30405,PropUserProperty
// "\SI\204Vp}Z\199]\ETX\160\179u\247~y\194" "6bN\162\245\&3%\158\243\214\vo\239\151",PropCorrelationData
// "\204\&9\DC2\US\170=<X|Z\164",PropMaximumPacketSize 3339,PropMessageExpiryInterval 29385,PropSubscriptionIdentifier
// 27,PropMessageExpiryInterval 699,PropSharedSubscriptionAvailable 38,PropReceiveMaximum 17173,PropUserProperty
// "\237\239\145\\\250k\217<\ACK\207\186ax" "\161\181F8D%\167T-.r\150\186",PropSharedSubscriptionAvailable
// 25,PropTopicAlias 19083,PropAuthenticationMethod
// "\187}\236&\176\&4X.\SYN\218\ETB!\154\238\227\216\133\184\f\164\SOH\235\ENQ\152\ENQ\160\185\181>\209"]}),
// _cleanSession = False, _keepAlive = 28167, _connID =
// "v\243\203T}\236\142\226\SI\204\157\191\223\138y\DC4\252\163\134", _properties = [PropResponseTopic
// "/3\SOHI\158%/\137v\174\&1\233Qf\168Mm*\189~\ETX\150\232A\244\129",PropSubscriptionIdentifier 24,PropServerReference
// ".-8Qz\239le",PropTopicAliasMaximum 3736,PropWillDelayInterval 24917,PropMessageExpiryInterval
// 20599,PropAuthenticationMethod "\144b\171\CAN\130\235R\162",PropMaximumQoS 223,PropWillDelayInterval
// 24968,PropCorrelationData "\199\GS\128N\212\&6}U\131(\200",PropResponseInformation
// "\192\231e\176Q5P\183\175>\183I\NAK`\253\235\132\168\148\238\ESCy2\SI\140\241\161\EOT",PropResponseTopic
// "\159\238F\145\170>\183_\142\t\184\&4OB\185\190:\175\f\175'\RS\"/\158\155}==\191",PropContentType
// "\243\234(\159\206\202\222\143#\192\ACKj\217\b\t\175`\"\139\r8\198b\SUBZ`\172/\GS2",PropResponseTopic
// "O\250w\212w+\ENQ\NUL\194'\148\177\136",PropSubscriptionIdentifierAvailable 242,PropRequestProblemInformation
// 255,PropWildcardSubscriptionAvailable 72,PropTopicAlias 11275]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x10, 0xbf, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x6e, 0x7,  0xd1, 0x1,  0x8,  0x0,  0x1a, 0x2f,
      0x33, 0x1,  0x49, 0x9e, 0x25, 0x2f, 0x89, 0x76, 0xae, 0x31, 0xe9, 0x51, 0x66, 0xa8, 0x4d, 0x6d, 0x2a, 0xbd, 0x7e,
      0x3,  0x96, 0xe8, 0x41, 0xf4, 0x81, 0xb,  0x18, 0x1c, 0x0,  0x8,  0x2e, 0x2d, 0x38, 0x51, 0x7a, 0xef, 0x6c, 0x65,
      0x22, 0xe,  0x98, 0x18, 0x0,  0x0,  0x61, 0x55, 0x2,  0x0,  0x0,  0x50, 0x77, 0x15, 0x0,  0x8,  0x90, 0x62, 0xab,
      0x18, 0x82, 0xeb, 0x52, 0xa2, 0x24, 0xdf, 0x18, 0x0,  0x0,  0x61, 0x88, 0x9,  0x0,  0xb,  0xc7, 0x1d, 0x80, 0x4e,
      0xd4, 0x36, 0x7d, 0x55, 0x83, 0x28, 0xc8, 0x1a, 0x0,  0x1c, 0xc0, 0xe7, 0x65, 0xb0, 0x51, 0x35, 0x50, 0xb7, 0xaf,
      0x3e, 0xb7, 0x49, 0x15, 0x60, 0xfd, 0xeb, 0x84, 0xa8, 0x94, 0xee, 0x1b, 0x79, 0x32, 0xf,  0x8c, 0xf1, 0xa1, 0x4,
      0x8,  0x0,  0x1e, 0x9f, 0xee, 0x46, 0x91, 0xaa, 0x3e, 0xb7, 0x5f, 0x8e, 0x9,  0xb8, 0x34, 0x4f, 0x42, 0xb9, 0xbe,
      0x3a, 0xaf, 0xc,  0xaf, 0x27, 0x1e, 0x22, 0x2f, 0x9e, 0x9b, 0x7d, 0x3d, 0x3d, 0xbf, 0x3,  0x0,  0x1e, 0xf3, 0xea,
      0x28, 0x9f, 0xce, 0xca, 0xde, 0x8f, 0x23, 0xc0, 0x6,  0x6a, 0xd9, 0x8,  0x9,  0xaf, 0x60, 0x22, 0x8b, 0xd,  0x38,
      0xc6, 0x62, 0x1a, 0x5a, 0x60, 0xac, 0x2f, 0x1d, 0x32, 0x8,  0x0,  0xd,  0x4f, 0xfa, 0x77, 0xd4, 0x77, 0x2b, 0x5,
      0x0,  0xc2, 0x27, 0x94, 0xb1, 0x88, 0x29, 0xf2, 0x17, 0xff, 0x28, 0x48, 0x23, 0x2c, 0xb,  0x0,  0x13, 0x76, 0xf3,
      0xcb, 0x54, 0x7d, 0xec, 0x8e, 0xe2, 0xf,  0xcc, 0x9d, 0xbf, 0xdf, 0x8a, 0x79, 0x14, 0xfc, 0xa3, 0x86, 0xfb, 0x1,
      0x1f, 0x0,  0x9,  0xa8, 0x9a, 0xea, 0x38, 0x33, 0x6f, 0xc0, 0x15, 0xca, 0x17, 0xe7, 0x25, 0x61, 0x26, 0x0,  0xe,
      0x71, 0x8e, 0x0,  0x2c, 0xff, 0xee, 0xd3, 0xf5, 0xe0, 0x14, 0x12, 0xeb, 0x1e, 0x91, 0x0,  0x11, 0x3e, 0x1f, 0x8d,
      0x72, 0x88, 0xa2, 0x18, 0xfe, 0xd1, 0x8b, 0xa0, 0xb2, 0xa2, 0x6e, 0xdc, 0x52, 0x49, 0x3,  0x0,  0x9,  0x8e, 0xf7,
      0x44, 0x5a, 0x5e, 0xb4, 0x65, 0x5d, 0xa,  0x3,  0x0,  0x7,  0x35, 0x28, 0x4e, 0x48, 0x3e, 0x8f, 0x78, 0x23, 0x6a,
      0x84, 0x1f, 0x0,  0x11, 0x27, 0xe3, 0x77, 0xf4, 0xb7, 0xf0, 0xe6, 0x92, 0x2b, 0xf,  0xba, 0x43, 0x5f, 0x43, 0xac,
      0x79, 0x24, 0x17, 0x57, 0x18, 0x0,  0x0,  0x7c, 0x9e, 0x19, 0xb0, 0x2,  0x0,  0x0,  0x76, 0xc5, 0x26, 0x0,  0x10,
      0xf,  0xcc, 0x56, 0x70, 0x7d, 0x5a, 0xc7, 0x5d, 0x3,  0xa0, 0xb3, 0x75, 0xf7, 0x7e, 0x79, 0xc2, 0x0,  0xe,  0x36,
      0x62, 0x4e, 0xa2, 0xf5, 0x33, 0x25, 0x9e, 0xf3, 0xd6, 0xb,  0x6f, 0xef, 0x97, 0x9,  0x0,  0xb,  0xcc, 0x39, 0x12,
      0x1f, 0xaa, 0x3d, 0x3c, 0x58, 0x7c, 0x5a, 0xa4, 0x27, 0x0,  0x0,  0xd,  0xb,  0x2,  0x0,  0x0,  0x72, 0xc9, 0xb,
      0x1b, 0x2,  0x0,  0x0,  0x2,  0xbb, 0x2a, 0x26, 0x21, 0x43, 0x15, 0x26, 0x0,  0xd,  0xed, 0xef, 0x91, 0x5c, 0xfa,
      0x6b, 0xd9, 0x3c, 0x6,  0xcf, 0xba, 0x61, 0x78, 0x0,  0xd,  0xa1, 0xb5, 0x46, 0x38, 0x44, 0x25, 0xa7, 0x54, 0x2d,
      0x2e, 0x72, 0x96, 0xba, 0x2a, 0x19, 0x23, 0x4a, 0x8b, 0x15, 0x0,  0x1e, 0xbb, 0x7d, 0xec, 0x26, 0xb0, 0x34, 0x58,
      0x2e, 0x16, 0xda, 0x17, 0x21, 0x9a, 0xee, 0xe3, 0xd8, 0x85, 0xb8, 0xc,  0xa4, 0x1,  0xeb, 0x5,  0x98, 0x5,  0xa0,
      0xb9, 0xb5, 0x3e, 0xd1, 0x0,  0x18, 0xfb, 0xdc, 0x9f, 0xa1, 0x54, 0x81, 0x5e, 0xaf, 0xd2, 0xd4, 0x1e, 0x30, 0x59,
      0x68, 0x15, 0x8d, 0x7b, 0x35, 0xcf, 0x6c, 0x76, 0xc1, 0xfd, 0xd1, 0x0,  0x6,  0xca, 0x7b, 0x71, 0xff, 0xa5, 0x1e,
      0x0,  0x15, 0xa2, 0x92, 0x8a, 0x8d, 0x4b, 0x29, 0x7f, 0x8e, 0x38, 0x7a, 0x57, 0xa3, 0x12, 0x4d, 0x23, 0x8a, 0x5,
      0x0,  0x86, 0xeb, 0xcb, 0x0,  0x15, 0x85, 0xa,  0xce, 0x2f, 0x5f, 0x79, 0x86, 0x84, 0x92, 0x2f, 0xe1, 0x73, 0x20,
      0x34, 0x4f, 0xd2, 0x90, 0x82, 0x1d, 0x94, 0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2f, 0x33, 0x1,  0x49, 0x9e, 0x25, 0x2f, 0x89, 0x76, 0xae, 0x31, 0xe9, 0x51,
                           0x66, 0xa8, 0x4d, 0x6d, 0x2a, 0xbd, 0x7e, 0x3,  0x96, 0xe8, 0x41, 0xf4, 0x81};
  uint8_t bytesprops1[] = {0x2e, 0x2d, 0x38, 0x51, 0x7a, 0xef, 0x6c, 0x65};
  uint8_t bytesprops2[] = {0x90, 0x62, 0xab, 0x18, 0x82, 0xeb, 0x52, 0xa2};
  uint8_t bytesprops3[] = {0xc7, 0x1d, 0x80, 0x4e, 0xd4, 0x36, 0x7d, 0x55, 0x83, 0x28, 0xc8};
  uint8_t bytesprops4[] = {0xc0, 0xe7, 0x65, 0xb0, 0x51, 0x35, 0x50, 0xb7, 0xaf, 0x3e, 0xb7, 0x49, 0x15, 0x60,
                           0xfd, 0xeb, 0x84, 0xa8, 0x94, 0xee, 0x1b, 0x79, 0x32, 0xf,  0x8c, 0xf1, 0xa1, 0x4};
  uint8_t bytesprops5[] = {0x9f, 0xee, 0x46, 0x91, 0xaa, 0x3e, 0xb7, 0x5f, 0x8e, 0x9,  0xb8, 0x34, 0x4f, 0x42, 0xb9,
                           0xbe, 0x3a, 0xaf, 0xc,  0xaf, 0x27, 0x1e, 0x22, 0x2f, 0x9e, 0x9b, 0x7d, 0x3d, 0x3d, 0xbf};
  uint8_t bytesprops6[] = {0xf3, 0xea, 0x28, 0x9f, 0xce, 0xca, 0xde, 0x8f, 0x23, 0xc0, 0x6,  0x6a, 0xd9, 0x8,  0x9,
                           0xaf, 0x60, 0x22, 0x8b, 0xd,  0x38, 0xc6, 0x62, 0x1a, 0x5a, 0x60, 0xac, 0x2f, 0x1d, 0x32};
  uint8_t bytesprops7[] = {0x4f, 0xfa, 0x77, 0xd4, 0x77, 0x2b, 0x5, 0x0, 0xc2, 0x27, 0x94, 0xb1, 0x88};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3736}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24917}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20599}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24968}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11275}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa8, 0x9a, 0xea, 0x38, 0x33, 0x6f, 0xc0, 0x15, 0xca};
  uint8_t byteswillprops2[] = {0x3e, 0x1f, 0x8d, 0x72, 0x88, 0xa2, 0x18, 0xfe, 0xd1,
                               0x8b, 0xa0, 0xb2, 0xa2, 0x6e, 0xdc, 0x52, 0x49};
  uint8_t byteswillprops1[] = {0x71, 0x8e, 0x0, 0x2c, 0xff, 0xee, 0xd3, 0xf5, 0xe0, 0x14, 0x12, 0xeb, 0x1e, 0x91};
  uint8_t byteswillprops3[] = {0x8e, 0xf7, 0x44, 0x5a, 0x5e, 0xb4, 0x65, 0x5d, 0xa};
  uint8_t byteswillprops4[] = {0x35, 0x28, 0x4e, 0x48, 0x3e, 0x8f, 0x78};
  uint8_t byteswillprops5[] = {0x27, 0xe3, 0x77, 0xf4, 0xb7, 0xf0, 0xe6, 0x92, 0x2b,
                               0xf,  0xba, 0x43, 0x5f, 0x43, 0xac, 0x79, 0x24};
  uint8_t byteswillprops7[] = {0x36, 0x62, 0x4e, 0xa2, 0xf5, 0x33, 0x25, 0x9e, 0xf3, 0xd6, 0xb, 0x6f, 0xef, 0x97};
  uint8_t byteswillprops6[] = {0xf, 0xcc, 0x56, 0x70, 0x7d, 0x5a, 0xc7, 0x5d,
                               0x3, 0xa0, 0xb3, 0x75, 0xf7, 0x7e, 0x79, 0xc2};
  uint8_t byteswillprops8[] = {0xcc, 0x39, 0x12, 0x1f, 0xaa, 0x3d, 0x3c, 0x58, 0x7c, 0x5a, 0xa4};
  uint8_t byteswillprops10[] = {0xa1, 0xb5, 0x46, 0x38, 0x44, 0x25, 0xa7, 0x54, 0x2d, 0x2e, 0x72, 0x96, 0xba};
  uint8_t byteswillprops9[] = {0xed, 0xef, 0x91, 0x5c, 0xfa, 0x6b, 0xd9, 0x3c, 0x6, 0xcf, 0xba, 0x61, 0x78};
  uint8_t byteswillprops11[] = {0xbb, 0x7d, 0xec, 0x26, 0xb0, 0x34, 0x58, 0x2e, 0x16, 0xda,
                                0x17, 0x21, 0x9a, 0xee, 0xe3, 0xd8, 0x85, 0xb8, 0xc,  0xa4,
                                0x1,  0xeb, 0x5,  0x98, 0x5,  0xa0, 0xb9, 0xb5, 0x3e, 0xd1};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {14, (char*)&byteswillprops1}, .v = {17, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27268}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31902}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30405}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {16, (char*)&byteswillprops6}, .v = {14, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3339}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29385}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 699}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17173}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops9}, .v = {13, (char*)&byteswillprops10}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19083}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops11}}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfb, 0xdc, 0x9f, 0xa1, 0x54, 0x81, 0x5e, 0xaf, 0xd2, 0xd4, 0x1e, 0x30,
                                0x59, 0x68, 0x15, 0x8d, 0x7b, 0x35, 0xcf, 0x6c, 0x76, 0xc1, 0xfd, 0xd1};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xca, 0x7b, 0x71, 0xff, 0xa5, 0x1e};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28167;
  uint8_t client_id_bytes[] = {0x76, 0xf3, 0xcb, 0x54, 0x7d, 0xec, 0x8e, 0xe2, 0xf, 0xcc,
                               0x9d, 0xbf, 0xdf, 0x8a, 0x79, 0x14, 0xfc, 0xa3, 0x86};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa2, 0x92, 0x8a, 0x8d, 0x4b, 0x29, 0x7f, 0x8e, 0x38, 0x7a, 0x57,
                              0xa3, 0x12, 0x4d, 0x23, 0x8a, 0x5,  0x0,  0x86, 0xeb, 0xcb};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x85, 0xa,  0xce, 0x2f, 0x5f, 0x79, 0x86, 0x84, 0x92, 0x2f, 0xe1,
                              0x73, 0x20, 0x34, 0x4f, 0xd2, 0x90, 0x82, 0x1d, 0x94, 0x62};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Ub", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS2, _willTopic = "\EM\162\218\226Q\179}\211\ETB\242\188\157(\150\&7-", _willMsg = "\146#K\CAN-7w\161\228\157",
// _willProps = [PropContentType "'\193\181\DC3zy\170p\GS\r\191\129\&7\"\141\162\128-\249i\138
// KIN\222\198J",PropWildcardSubscriptionAvailable 118,PropMaximumQoS 163,PropTopicAlias 27085,PropMessageExpiryInterval
// 28560,PropTopicAliasMaximum 5360,PropSubscriptionIdentifierAvailable 70,PropTopicAlias 7674,PropServerKeepAlive
// 24177,PropMessageExpiryInterval 7765,PropWillDelayInterval 31134,PropServerKeepAlive 25331,PropServerKeepAlive
// 13361]}), _cleanSession = False, _keepAlive = 618, _connID = "\193\150\ENQ", _properties = [PropContentType
// "\RS\163\209\\Kg\ESC\139%\192",PropContentType "\172_\167\130\t\159\152\a",PropMessageExpiryInterval
// 29459,PropPayloadFormatIndicator 84,PropTopicAlias 10884,PropServerReference
// "\245{\232\189\&0PI\DC3\160\254\NUL\235*\230\157\182x\146",PropReasonString
// "&b\EOTAb\217\ax\bD\vz\222\234x\196\212\&5fEI\thW\241",PropTopicAliasMaximum 6153,PropResponseTopic
// "e-l.d\\d\184\ETB\ENQ\197\179\143\245\186\EMD!",PropServerKeepAlive 25494,PropMaximumPacketSize
// 12721,PropReceiveMaximum 3532,PropSubscriptionIdentifier 23,PropAssignedClientIdentifier
// "#\237\144\214\228NA\185p\166\DC3E\ETB",PropWillDelayInterval 19226,PropTopicAliasMaximum 16287,PropWillDelayInterval
// 26966,PropReceiveMaximum 22426,PropRetainAvailable 175,PropPayloadFormatIndicator 116,PropSubscriptionIdentifier
// 4,PropCorrelationData "i\252\ETX\226",PropSubscriptionIdentifierAvailable 152,PropSubscriptionIdentifierAvailable
// 66,PropMessageExpiryInterval 8075,PropContentType
// "\SYN\250\NAK\GS\154N\EMC3P\DC3\DC1d%\SO\177\140\239@\182\171\142\"\146\190ub\SO\DC2\135",PropMessageExpiryInterval
// 29700]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x10, 0xce, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb4, 0x2,  0x6a, 0xd4, 0x1,  0x3,  0x0,  0xa,  0x1e,
      0xa3, 0xd1, 0x5c, 0x4b, 0x67, 0x1b, 0x8b, 0x25, 0xc0, 0x3,  0x0,  0x8,  0xac, 0x5f, 0xa7, 0x82, 0x9,  0x9f, 0x98,
      0x7,  0x2,  0x0,  0x0,  0x73, 0x13, 0x1,  0x54, 0x23, 0x2a, 0x84, 0x1c, 0x0,  0x12, 0xf5, 0x7b, 0xe8, 0xbd, 0x30,
      0x50, 0x49, 0x13, 0xa0, 0xfe, 0x0,  0xeb, 0x2a, 0xe6, 0x9d, 0xb6, 0x78, 0x92, 0x1f, 0x0,  0x19, 0x26, 0x62, 0x4,
      0x41, 0x62, 0xd9, 0x7,  0x78, 0x8,  0x44, 0xb,  0x7a, 0xde, 0xea, 0x78, 0xc4, 0xd4, 0x35, 0x66, 0x45, 0x49, 0x9,
      0x68, 0x57, 0xf1, 0x22, 0x18, 0x9,  0x8,  0x0,  0x12, 0x65, 0x2d, 0x6c, 0x2e, 0x64, 0x5c, 0x64, 0xb8, 0x17, 0x5,
      0xc5, 0xb3, 0x8f, 0xf5, 0xba, 0x19, 0x44, 0x21, 0x13, 0x63, 0x96, 0x27, 0x0,  0x0,  0x31, 0xb1, 0x21, 0xd,  0xcc,
      0xb,  0x17, 0x12, 0x0,  0xd,  0x23, 0xed, 0x90, 0xd6, 0xe4, 0x4e, 0x41, 0xb9, 0x70, 0xa6, 0x13, 0x45, 0x17, 0x18,
      0x0,  0x0,  0x4b, 0x1a, 0x22, 0x3f, 0x9f, 0x18, 0x0,  0x0,  0x69, 0x56, 0x21, 0x57, 0x9a, 0x25, 0xaf, 0x1,  0x74,
      0xb,  0x4,  0x9,  0x0,  0x4,  0x69, 0xfc, 0x3,  0xe2, 0x29, 0x98, 0x29, 0x42, 0x2,  0x0,  0x0,  0x1f, 0x8b, 0x3,
      0x0,  0x1e, 0x16, 0xfa, 0x15, 0x1d, 0x9a, 0x4e, 0x19, 0x43, 0x33, 0x50, 0x13, 0x11, 0x64, 0x25, 0xe,  0xb1, 0x8c,
      0xef, 0x40, 0xb6, 0xab, 0x8e, 0x22, 0x92, 0xbe, 0x75, 0x62, 0xe,  0x12, 0x87, 0x2,  0x0,  0x0,  0x74, 0x4,  0x0,
      0x3,  0xc1, 0x96, 0x5,  0x46, 0x3,  0x0,  0x1c, 0x27, 0xc1, 0xb5, 0x13, 0x7a, 0x79, 0xaa, 0x70, 0x1d, 0xd,  0xbf,
      0x81, 0x37, 0x22, 0x8d, 0xa2, 0x80, 0x2d, 0xf9, 0x69, 0x8a, 0x20, 0x4b, 0x49, 0x4e, 0xde, 0xc6, 0x4a, 0x28, 0x76,
      0x24, 0xa3, 0x23, 0x69, 0xcd, 0x2,  0x0,  0x0,  0x6f, 0x90, 0x22, 0x14, 0xf0, 0x29, 0x46, 0x23, 0x1d, 0xfa, 0x13,
      0x5e, 0x71, 0x2,  0x0,  0x0,  0x1e, 0x55, 0x18, 0x0,  0x0,  0x79, 0x9e, 0x13, 0x62, 0xf3, 0x13, 0x34, 0x31, 0x0,
      0x10, 0x19, 0xa2, 0xda, 0xe2, 0x51, 0xb3, 0x7d, 0xd3, 0x17, 0xf2, 0xbc, 0x9d, 0x28, 0x96, 0x37, 0x2d, 0x0,  0xa,
      0x92, 0x23, 0x4b, 0x18, 0x2d, 0x37, 0x77, 0xa1, 0xe4, 0x9d, 0x0,  0x2,  0x55, 0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1e, 0xa3, 0xd1, 0x5c, 0x4b, 0x67, 0x1b, 0x8b, 0x25, 0xc0};
  uint8_t bytesprops1[] = {0xac, 0x5f, 0xa7, 0x82, 0x9, 0x9f, 0x98, 0x7};
  uint8_t bytesprops2[] = {0xf5, 0x7b, 0xe8, 0xbd, 0x30, 0x50, 0x49, 0x13, 0xa0,
                           0xfe, 0x0,  0xeb, 0x2a, 0xe6, 0x9d, 0xb6, 0x78, 0x92};
  uint8_t bytesprops3[] = {0x26, 0x62, 0x4,  0x41, 0x62, 0xd9, 0x7,  0x78, 0x8, 0x44, 0xb,  0x7a, 0xde,
                           0xea, 0x78, 0xc4, 0xd4, 0x35, 0x66, 0x45, 0x49, 0x9, 0x68, 0x57, 0xf1};
  uint8_t bytesprops4[] = {0x65, 0x2d, 0x6c, 0x2e, 0x64, 0x5c, 0x64, 0xb8, 0x17,
                           0x5,  0xc5, 0xb3, 0x8f, 0xf5, 0xba, 0x19, 0x44, 0x21};
  uint8_t bytesprops5[] = {0x23, 0xed, 0x90, 0xd6, 0xe4, 0x4e, 0x41, 0xb9, 0x70, 0xa6, 0x13, 0x45, 0x17};
  uint8_t bytesprops6[] = {0x69, 0xfc, 0x3, 0xe2};
  uint8_t bytesprops7[] = {0x16, 0xfa, 0x15, 0x1d, 0x9a, 0x4e, 0x19, 0x43, 0x33, 0x50, 0x13, 0x11, 0x64, 0x25, 0xe,
                           0xb1, 0x8c, 0xef, 0x40, 0xb6, 0xab, 0x8e, 0x22, 0x92, 0xbe, 0x75, 0x62, 0xe,  0x12, 0x87};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29459}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10884}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6153}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25494}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12721}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3532}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19226}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16287}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26966}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22426}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8075}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29700}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x27, 0xc1, 0xb5, 0x13, 0x7a, 0x79, 0xaa, 0x70, 0x1d, 0xd,  0xbf, 0x81, 0x37, 0x22,
                               0x8d, 0xa2, 0x80, 0x2d, 0xf9, 0x69, 0x8a, 0x20, 0x4b, 0x49, 0x4e, 0xde, 0xc6, 0x4a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27085}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28560}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5360}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7674}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24177}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7765}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31134}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25331}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13361}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x19, 0xa2, 0xda, 0xe2, 0x51, 0xb3, 0x7d, 0xd3,
                                0x17, 0xf2, 0xbc, 0x9d, 0x28, 0x96, 0x37, 0x2d};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x92, 0x23, 0x4b, 0x18, 0x2d, 0x37, 0x77, 0xa1, 0xe4, 0x9d};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 618;
  uint8_t client_id_bytes[] = {0xc1, 0x96, 0x5};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x55, 0x62};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\212\178\194\175\",\DC4\189\220\226\206U\131Q\182\202p\244\242D;\212\175m*\194WT\207", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\DC24\133\225%k\SOHa\149\232\DC3}q\224", _willMsg = "\226\225\232\214\198L7\156\&6H\247\231\176X'm", _willProps =
// [PropRequestResponseInformation 60,PropMaximumQoS 151,PropServerReference "\175K\156",PropResponseTopic
// "P3\246S\222\&3\172\246\179\&4\DC3\r\220\&0\147\200|\204\174I\GS\203 \216\199d$",PropResponseInformation
// "\220\196\163\176\SYNy6\"\154\214\244\160\233\&9u\163\251\185",PropReasonString
// "6\214\n\182\231\180\&3x\176g\142r?F\218\&4&P T\214\188\238\141\171\229,\160",PropRetainAvailable
// 170,PropUserProperty "p\231\183\DC2\181\143\217\224\158\159snl\204\SO\151"
// "\219\148\139l\211x\221\143\240\187",PropWildcardSubscriptionAvailable 5]}), _cleanSession = True, _keepAlive = 5852,
// _connID = "|\199", _properties = [PropMaximumQoS 226,PropContentType "
// ,\ETB\189c\a^\181\200{\NUL\163\DLE\NAK\215g\"6\156'\169\215h\199\249\179\210\130+\144",PropServerReference
// "K\183T\166\151L\234\143\193\234C:\134\GS\220\138\206\179",PropSharedSubscriptionAvailable 218,PropMaximumQoS
// 115,PropContentType "MkR\DLEx\252\148j\174C\187\182\220\161\250",PropTopicAliasMaximum 18250,PropRetainAvailable
// 97,PropMessageExpiryInterval 18382,PropMaximumQoS 171,PropSubscriptionIdentifierAvailable
// 58,PropRequestResponseInformation 98,PropAssignedClientIdentifier
// "\168}\160\147\NAK\128V\DC1\214\177\v<\DC44\218\179",PropReasonString
// "\STX2\227.PW\187\161z\148\170\217\174\\\227<|\204\&4\204N\245\SI&z\173v=\233"]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x10, 0xe2, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xae, 0x16, 0xdc, 0x91, 0x1,  0x24, 0xe2, 0x3,  0x0,
      0x1e, 0x20, 0x2c, 0x17, 0xbd, 0x63, 0x7,  0x5e, 0xb5, 0xc8, 0x7b, 0x0,  0xa3, 0x10, 0x15, 0xd7, 0x67, 0x22, 0x36,
      0x9c, 0x27, 0xa9, 0xd7, 0x68, 0xc7, 0xf9, 0xb3, 0xd2, 0x82, 0x2b, 0x90, 0x1c, 0x0,  0x12, 0x4b, 0xb7, 0x54, 0xa6,
      0x97, 0x4c, 0xea, 0x8f, 0xc1, 0xea, 0x43, 0x3a, 0x86, 0x1d, 0xdc, 0x8a, 0xce, 0xb3, 0x2a, 0xda, 0x24, 0x73, 0x3,
      0x0,  0xf,  0x4d, 0x6b, 0x52, 0x10, 0x78, 0xfc, 0x94, 0x6a, 0xae, 0x43, 0xbb, 0xb6, 0xdc, 0xa1, 0xfa, 0x22, 0x47,
      0x4a, 0x25, 0x61, 0x2,  0x0,  0x0,  0x47, 0xce, 0x24, 0xab, 0x29, 0x3a, 0x19, 0x62, 0x12, 0x0,  0x10, 0xa8, 0x7d,
      0xa0, 0x93, 0x15, 0x80, 0x56, 0x11, 0xd6, 0xb1, 0xb,  0x3c, 0x14, 0x34, 0xda, 0xb3, 0x1f, 0x0,  0x1d, 0x2,  0x32,
      0xe3, 0x2e, 0x50, 0x57, 0xbb, 0xa1, 0x7a, 0x94, 0xaa, 0xd9, 0xae, 0x5c, 0xe3, 0x3c, 0x7c, 0xcc, 0x34, 0xcc, 0x4e,
      0xf5, 0xf,  0x26, 0x7a, 0xad, 0x76, 0x3d, 0xe9, 0x0,  0x2,  0x7c, 0xc7, 0x7f, 0x19, 0x3c, 0x24, 0x97, 0x1c, 0x0,
      0x3,  0xaf, 0x4b, 0x9c, 0x8,  0x0,  0x1b, 0x50, 0x33, 0xf6, 0x53, 0xde, 0x33, 0xac, 0xf6, 0xb3, 0x34, 0x13, 0xd,
      0xdc, 0x30, 0x93, 0xc8, 0x7c, 0xcc, 0xae, 0x49, 0x1d, 0xcb, 0x20, 0xd8, 0xc7, 0x64, 0x24, 0x1a, 0x0,  0x12, 0xdc,
      0xc4, 0xa3, 0xb0, 0x16, 0x79, 0x36, 0x22, 0x9a, 0xd6, 0xf4, 0xa0, 0xe9, 0x39, 0x75, 0xa3, 0xfb, 0xb9, 0x1f, 0x0,
      0x1c, 0x36, 0xd6, 0xa,  0xb6, 0xe7, 0xb4, 0x33, 0x78, 0xb0, 0x67, 0x8e, 0x72, 0x3f, 0x46, 0xda, 0x34, 0x26, 0x50,
      0x20, 0x54, 0xd6, 0xbc, 0xee, 0x8d, 0xab, 0xe5, 0x2c, 0xa0, 0x25, 0xaa, 0x26, 0x0,  0x10, 0x70, 0xe7, 0xb7, 0x12,
      0xb5, 0x8f, 0xd9, 0xe0, 0x9e, 0x9f, 0x73, 0x6e, 0x6c, 0xcc, 0xe,  0x97, 0x0,  0xa,  0xdb, 0x94, 0x8b, 0x6c, 0xd3,
      0x78, 0xdd, 0x8f, 0xf0, 0xbb, 0x28, 0x5,  0x0,  0xe,  0x12, 0x34, 0x85, 0xe1, 0x25, 0x6b, 0x1,  0x61, 0x95, 0xe8,
      0x13, 0x7d, 0x71, 0xe0, 0x0,  0x10, 0xe2, 0xe1, 0xe8, 0xd6, 0xc6, 0x4c, 0x37, 0x9c, 0x36, 0x48, 0xf7, 0xe7, 0xb0,
      0x58, 0x27, 0x6d, 0x0,  0x1d, 0xd4, 0xb2, 0xc2, 0xaf, 0x22, 0x2c, 0x14, 0xbd, 0xdc, 0xe2, 0xce, 0x55, 0x83, 0x51,
      0xb6, 0xca, 0x70, 0xf4, 0xf2, 0x44, 0x3b, 0xd4, 0xaf, 0x6d, 0x2a, 0xc2, 0x57, 0x54, 0xcf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x20, 0x2c, 0x17, 0xbd, 0x63, 0x7,  0x5e, 0xb5, 0xc8, 0x7b, 0x0,  0xa3, 0x10, 0x15, 0xd7,
                           0x67, 0x22, 0x36, 0x9c, 0x27, 0xa9, 0xd7, 0x68, 0xc7, 0xf9, 0xb3, 0xd2, 0x82, 0x2b, 0x90};
  uint8_t bytesprops1[] = {0x4b, 0xb7, 0x54, 0xa6, 0x97, 0x4c, 0xea, 0x8f, 0xc1,
                           0xea, 0x43, 0x3a, 0x86, 0x1d, 0xdc, 0x8a, 0xce, 0xb3};
  uint8_t bytesprops2[] = {0x4d, 0x6b, 0x52, 0x10, 0x78, 0xfc, 0x94, 0x6a, 0xae, 0x43, 0xbb, 0xb6, 0xdc, 0xa1, 0xfa};
  uint8_t bytesprops3[] = {0xa8, 0x7d, 0xa0, 0x93, 0x15, 0x80, 0x56, 0x11,
                           0xd6, 0xb1, 0xb,  0x3c, 0x14, 0x34, 0xda, 0xb3};
  uint8_t bytesprops4[] = {0x2,  0x32, 0xe3, 0x2e, 0x50, 0x57, 0xbb, 0xa1, 0x7a, 0x94, 0xaa, 0xd9, 0xae, 0x5c, 0xe3,
                           0x3c, 0x7c, 0xcc, 0x34, 0xcc, 0x4e, 0xf5, 0xf,  0x26, 0x7a, 0xad, 0x76, 0x3d, 0xe9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18250}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18382}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xaf, 0x4b, 0x9c};
  uint8_t byteswillprops1[] = {0x50, 0x33, 0xf6, 0x53, 0xde, 0x33, 0xac, 0xf6, 0xb3, 0x34, 0x13, 0xd,  0xdc, 0x30,
                               0x93, 0xc8, 0x7c, 0xcc, 0xae, 0x49, 0x1d, 0xcb, 0x20, 0xd8, 0xc7, 0x64, 0x24};
  uint8_t byteswillprops2[] = {0xdc, 0xc4, 0xa3, 0xb0, 0x16, 0x79, 0x36, 0x22, 0x9a,
                               0xd6, 0xf4, 0xa0, 0xe9, 0x39, 0x75, 0xa3, 0xfb, 0xb9};
  uint8_t byteswillprops3[] = {0x36, 0xd6, 0xa,  0xb6, 0xe7, 0xb4, 0x33, 0x78, 0xb0, 0x67, 0x8e, 0x72, 0x3f, 0x46,
                               0xda, 0x34, 0x26, 0x50, 0x20, 0x54, 0xd6, 0xbc, 0xee, 0x8d, 0xab, 0xe5, 0x2c, 0xa0};
  uint8_t byteswillprops5[] = {0xdb, 0x94, 0x8b, 0x6c, 0xd3, 0x78, 0xdd, 0x8f, 0xf0, 0xbb};
  uint8_t byteswillprops4[] = {0x70, 0xe7, 0xb7, 0x12, 0xb5, 0x8f, 0xd9, 0xe0,
                               0x9e, 0x9f, 0x73, 0x6e, 0x6c, 0xcc, 0xe,  0x97};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {16, (char*)&byteswillprops4}, .v = {10, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 5}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x12, 0x34, 0x85, 0xe1, 0x25, 0x6b, 0x1, 0x61, 0x95, 0xe8, 0x13, 0x7d, 0x71, 0xe0};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe2, 0xe1, 0xe8, 0xd6, 0xc6, 0x4c, 0x37, 0x9c,
                                  0x36, 0x48, 0xf7, 0xe7, 0xb0, 0x58, 0x27, 0x6d};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5852;
  uint8_t client_id_bytes[] = {0x7c, 0xc7};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd4, 0xb2, 0xc2, 0xaf, 0x22, 0x2c, 0x14, 0xbd, 0xdc, 0xe2, 0xce, 0x55, 0x83, 0x51, 0xb6,
                              0xca, 0x70, 0xf4, 0xf2, 0x44, 0x3b, 0xd4, 0xaf, 0x6d, 0x2a, 0xc2, 0x57, 0x54, 0xcf};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "2\DC1\197\140\172\STX\245\224", _password = Just
// "C\232\160\f\216\162\204\154\165\248\249\194\&5g\172\177\236\DC2\EOT\245\214\156", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic =
// "$\RSC_\156\STX\165$\246x_\195(]^\f\a%\232O\vf\"\180\174\135\223!8`", _willMsg =
// "\190'c\128\&6\169\239\f\a\GS\246\152}\153\215\ACK\SOH9\248\193A\224\237\179", _willProps =
// [PropSessionExpiryInterval 28866,PropMessageExpiryInterval 5544,PropAuthenticationData
// "\170\250\133s\NAK\140\167\t\209",PropTopicAliasMaximum 28843,PropMessageExpiryInterval
// 11044,PropAssignedClientIdentifier "\180T8\237}\182\204\RSr",PropAuthenticationMethod "\138\179
// ?",PropSessionExpiryInterval 27762,PropMaximumPacketSize 16384,PropResponseTopic
// "W\235\149U",PropMessageExpiryInterval 14766,PropWillDelayInterval 26866,PropWillDelayInterval
// 8680,PropMaximumPacketSize 16961,PropMessageExpiryInterval 6312,PropMaximumPacketSize 28045,PropRetainAvailable
// 220,PropSessionExpiryInterval 31091,PropSharedSubscriptionAvailable 27,PropWildcardSubscriptionAvailable
// 139,PropReceiveMaximum 19162,PropAuthenticationMethod
// "\188\170\148Z\CAN\211L\SUB\175\158#\192\236B\193V\162",PropWildcardSubscriptionAvailable
// 142,PropSharedSubscriptionAvailable 27]}), _cleanSession = True, _keepAlive = 12387, _connID =
// "\ETX\SYN\DC2\a\ETB\224\158xuW\n\236S\134\138\198\CAN\SI\bp", _properties = [PropContentType
// "\194\251\188\239\FS\176\180!\193\141\210 \251%e\203!\254\182k\SI",PropWildcardSubscriptionAvailable
// 207,PropMaximumPacketSize 3626,PropWillDelayInterval 12740,PropAuthenticationMethod
// "\DC4\STXj\145\185k\160\SYN\181\SUBlW\171\142\207j\177\v\192",PropMessageExpiryInterval 13928,PropServerKeepAlive
// 13861]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x10, 0xc7, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x30, 0x63, 0x42, 0x3,  0x0,  0x15, 0xc2, 0xfb,
      0xbc, 0xef, 0x1c, 0xb0, 0xb4, 0x21, 0xc1, 0x8d, 0xd2, 0x20, 0xfb, 0x25, 0x65, 0xcb, 0x21, 0xfe, 0xb6, 0x6b, 0xf,
      0x28, 0xcf, 0x27, 0x0,  0x0,  0xe,  0x2a, 0x18, 0x0,  0x0,  0x31, 0xc4, 0x15, 0x0,  0x13, 0x14, 0x2,  0x6a, 0x91,
      0xb9, 0x6b, 0xa0, 0x16, 0xb5, 0x1a, 0x6c, 0x57, 0xab, 0x8e, 0xcf, 0x6a, 0xb1, 0xb,  0xc0, 0x2,  0x0,  0x0,  0x36,
      0x68, 0x13, 0x36, 0x25, 0x0,  0x14, 0x3,  0x16, 0x12, 0x7,  0x17, 0xe0, 0x9e, 0x78, 0x75, 0x57, 0xa,  0xec, 0x53,
      0x86, 0x8a, 0xc6, 0x18, 0xf,  0x8,  0x70, 0x86, 0x1,  0x11, 0x0,  0x0,  0x70, 0xc2, 0x2,  0x0,  0x0,  0x15, 0xa8,
      0x16, 0x0,  0x9,  0xaa, 0xfa, 0x85, 0x73, 0x15, 0x8c, 0xa7, 0x9,  0xd1, 0x22, 0x70, 0xab, 0x2,  0x0,  0x0,  0x2b,
      0x24, 0x12, 0x0,  0x9,  0xb4, 0x54, 0x38, 0xed, 0x7d, 0xb6, 0xcc, 0x1e, 0x72, 0x15, 0x0,  0x4,  0x8a, 0xb3, 0x20,
      0x3f, 0x11, 0x0,  0x0,  0x6c, 0x72, 0x27, 0x0,  0x0,  0x40, 0x0,  0x8,  0x0,  0x4,  0x57, 0xeb, 0x95, 0x55, 0x2,
      0x0,  0x0,  0x39, 0xae, 0x18, 0x0,  0x0,  0x68, 0xf2, 0x18, 0x0,  0x0,  0x21, 0xe8, 0x27, 0x0,  0x0,  0x42, 0x41,
      0x2,  0x0,  0x0,  0x18, 0xa8, 0x27, 0x0,  0x0,  0x6d, 0x8d, 0x25, 0xdc, 0x11, 0x0,  0x0,  0x79, 0x73, 0x2a, 0x1b,
      0x28, 0x8b, 0x21, 0x4a, 0xda, 0x15, 0x0,  0x11, 0xbc, 0xaa, 0x94, 0x5a, 0x18, 0xd3, 0x4c, 0x1a, 0xaf, 0x9e, 0x23,
      0xc0, 0xec, 0x42, 0xc1, 0x56, 0xa2, 0x28, 0x8e, 0x2a, 0x1b, 0x0,  0x1e, 0x24, 0x1e, 0x43, 0x5f, 0x9c, 0x2,  0xa5,
      0x24, 0xf6, 0x78, 0x5f, 0xc3, 0x28, 0x5d, 0x5e, 0xc,  0x7,  0x25, 0xe8, 0x4f, 0xb,  0x66, 0x22, 0xb4, 0xae, 0x87,
      0xdf, 0x21, 0x38, 0x60, 0x0,  0x18, 0xbe, 0x27, 0x63, 0x80, 0x36, 0xa9, 0xef, 0xc,  0x7,  0x1d, 0xf6, 0x98, 0x7d,
      0x99, 0xd7, 0x6,  0x1,  0x39, 0xf8, 0xc1, 0x41, 0xe0, 0xed, 0xb3, 0x0,  0x8,  0x32, 0x11, 0xc5, 0x8c, 0xac, 0x2,
      0xf5, 0xe0, 0x0,  0x16, 0x43, 0xe8, 0xa0, 0xc,  0xd8, 0xa2, 0xcc, 0x9a, 0xa5, 0xf8, 0xf9, 0xc2, 0x35, 0x67, 0xac,
      0xb1, 0xec, 0x12, 0x4,  0xf5, 0xd6, 0x9c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc2, 0xfb, 0xbc, 0xef, 0x1c, 0xb0, 0xb4, 0x21, 0xc1, 0x8d, 0xd2,
                           0x20, 0xfb, 0x25, 0x65, 0xcb, 0x21, 0xfe, 0xb6, 0x6b, 0xf};
  uint8_t bytesprops1[] = {0x14, 0x2,  0x6a, 0x91, 0xb9, 0x6b, 0xa0, 0x16, 0xb5, 0x1a,
                           0x6c, 0x57, 0xab, 0x8e, 0xcf, 0x6a, 0xb1, 0xb,  0xc0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3626}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12740}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13928}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13861}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xaa, 0xfa, 0x85, 0x73, 0x15, 0x8c, 0xa7, 0x9, 0xd1};
  uint8_t byteswillprops1[] = {0xb4, 0x54, 0x38, 0xed, 0x7d, 0xb6, 0xcc, 0x1e, 0x72};
  uint8_t byteswillprops2[] = {0x8a, 0xb3, 0x20, 0x3f};
  uint8_t byteswillprops3[] = {0x57, 0xeb, 0x95, 0x55};
  uint8_t byteswillprops4[] = {0xbc, 0xaa, 0x94, 0x5a, 0x18, 0xd3, 0x4c, 0x1a, 0xaf,
                               0x9e, 0x23, 0xc0, 0xec, 0x42, 0xc1, 0x56, 0xa2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28866}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5544}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28843}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11044}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27762}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16384}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14766}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26866}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8680}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16961}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6312}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28045}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31091}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19162}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 27}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x24, 0x1e, 0x43, 0x5f, 0x9c, 0x2,  0xa5, 0x24, 0xf6, 0x78,
                                0x5f, 0xc3, 0x28, 0x5d, 0x5e, 0xc,  0x7,  0x25, 0xe8, 0x4f,
                                0xb,  0x66, 0x22, 0xb4, 0xae, 0x87, 0xdf, 0x21, 0x38, 0x60};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbe, 0x27, 0x63, 0x80, 0x36, 0xa9, 0xef, 0xc,  0x7,  0x1d, 0xf6, 0x98,
                                  0x7d, 0x99, 0xd7, 0x6,  0x1,  0x39, 0xf8, 0xc1, 0x41, 0xe0, 0xed, 0xb3};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12387;
  uint8_t client_id_bytes[] = {0x3, 0x16, 0x12, 0x7,  0x17, 0xe0, 0x9e, 0x78, 0x75, 0x57,
                               0xa, 0xec, 0x53, 0x86, 0x8a, 0xc6, 0x18, 0xf,  0x8,  0x70};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x32, 0x11, 0xc5, 0x8c, 0xac, 0x2, 0xf5, 0xe0};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x43, 0xe8, 0xa0, 0xc,  0xd8, 0xa2, 0xcc, 0x9a, 0xa5, 0xf8, 0xf9,
                              0xc2, 0x35, 0x67, 0xac, 0xb1, 0xec, 0x12, 0x4,  0xf5, 0xd6, 0x9c};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "m\224J\233E\DC3\ETB\NUL`\145\194\ETXi", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 8004, _connID = "\152\175\205\ESC\239\142|}6k\238\178", _properties =
// [PropWildcardSubscriptionAvailable 80,PropRetainAvailable 187,PropReceiveMaximum 22643,PropResponseInformation
// "\187\173\&8\139\232!=",PropTopicAliasMaximum 32061,PropSharedSubscriptionAvailable 144,PropMessageExpiryInterval
// 21234,PropServerKeepAlive 17963,PropPayloadFormatIndicator 196,PropServerReference
// "\196\&4dF+]\206jD]\217\206\168^\138\248U\253\141\SOH\STX\222\186\184",PropMessageExpiryInterval
// 7126,PropWildcardSubscriptionAvailable 228,PropPayloadFormatIndicator 253,PropSessionExpiryInterval
// 14518,PropResponseInformation
// "\219\249\154\SYN/\139\177\142v\188\153\189\148\216XtX\139\237c\219B",PropRetainAvailable
// 4,PropRequestResponseInformation 105,PropSubscriptionIdentifierAvailable 243,PropMessageExpiryInterval
// 15556,PropTopicAliasMaximum 20230,PropServerReference
// "G\225\nh\248\NUL%\254\193S\131\227,b\137l\ACK\DC2.\STX0\222l\143\142\228\128\135",PropReceiveMaximum
// 20167,PropMessageExpiryInterval 26552,PropTopicAliasMaximum 18024]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0xc3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x42, 0x1f, 0x44, 0x9a, 0x1,  0x28, 0x50,
                   0x25, 0xbb, 0x21, 0x58, 0x73, 0x1a, 0x0,  0x7,  0xbb, 0xad, 0x38, 0x8b, 0xe8, 0x21, 0x3d, 0x22, 0x7d,
                   0x3d, 0x2a, 0x90, 0x2,  0x0,  0x0,  0x52, 0xf2, 0x13, 0x46, 0x2b, 0x1,  0xc4, 0x1c, 0x0,  0x18, 0xc4,
                   0x34, 0x64, 0x46, 0x2b, 0x5d, 0xce, 0x6a, 0x44, 0x5d, 0xd9, 0xce, 0xa8, 0x5e, 0x8a, 0xf8, 0x55, 0xfd,
                   0x8d, 0x1,  0x2,  0xde, 0xba, 0xb8, 0x2,  0x0,  0x0,  0x1b, 0xd6, 0x28, 0xe4, 0x1,  0xfd, 0x11, 0x0,
                   0x0,  0x38, 0xb6, 0x1a, 0x0,  0x16, 0xdb, 0xf9, 0x9a, 0x16, 0x2f, 0x8b, 0xb1, 0x8e, 0x76, 0xbc, 0x99,
                   0xbd, 0x94, 0xd8, 0x58, 0x74, 0x58, 0x8b, 0xed, 0x63, 0xdb, 0x42, 0x25, 0x4,  0x19, 0x69, 0x29, 0xf3,
                   0x2,  0x0,  0x0,  0x3c, 0xc4, 0x22, 0x4f, 0x6,  0x1c, 0x0,  0x1c, 0x47, 0xe1, 0xa,  0x68, 0xf8, 0x0,
                   0x25, 0xfe, 0xc1, 0x53, 0x83, 0xe3, 0x2c, 0x62, 0x89, 0x6c, 0x6,  0x12, 0x2e, 0x2,  0x30, 0xde, 0x6c,
                   0x8f, 0x8e, 0xe4, 0x80, 0x87, 0x21, 0x4e, 0xc7, 0x2,  0x0,  0x0,  0x67, 0xb8, 0x22, 0x46, 0x68, 0x0,
                   0xc,  0x98, 0xaf, 0xcd, 0x1b, 0xef, 0x8e, 0x7c, 0x7d, 0x36, 0x6b, 0xee, 0xb2, 0x0,  0xd,  0x6d, 0xe0,
                   0x4a, 0xe9, 0x45, 0x13, 0x17, 0x0,  0x60, 0x91, 0xc2, 0x3,  0x69};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbb, 0xad, 0x38, 0x8b, 0xe8, 0x21, 0x3d};
  uint8_t bytesprops1[] = {0xc4, 0x34, 0x64, 0x46, 0x2b, 0x5d, 0xce, 0x6a, 0x44, 0x5d, 0xd9, 0xce,
                           0xa8, 0x5e, 0x8a, 0xf8, 0x55, 0xfd, 0x8d, 0x1,  0x2,  0xde, 0xba, 0xb8};
  uint8_t bytesprops2[] = {0xdb, 0xf9, 0x9a, 0x16, 0x2f, 0x8b, 0xb1, 0x8e, 0x76, 0xbc, 0x99,
                           0xbd, 0x94, 0xd8, 0x58, 0x74, 0x58, 0x8b, 0xed, 0x63, 0xdb, 0x42};
  uint8_t bytesprops3[] = {0x47, 0xe1, 0xa, 0x68, 0xf8, 0x0, 0x25, 0xfe, 0xc1, 0x53, 0x83, 0xe3, 0x2c, 0x62,
                           0x89, 0x6c, 0x6, 0x12, 0x2e, 0x2, 0x30, 0xde, 0x6c, 0x8f, 0x8e, 0xe4, 0x80, 0x87};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22643}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32061}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21234}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17963}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7126}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14518}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15556}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20230}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20167}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26552}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18024}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8004;
  uint8_t client_id_bytes[] = {0x98, 0xaf, 0xcd, 0x1b, 0xef, 0x8e, 0x7c, 0x7d, 0x36, 0x6b, 0xee, 0xb2};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x6d, 0xe0, 0x4a, 0xe9, 0x45, 0x13, 0x17, 0x0, 0x60, 0x91, 0xc2, 0x3, 0x69};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\238", _password = Just "\224\167\178Vb~\222\DLE\192\146\197\133L", _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\STX", _willMsg =
// "6D\137\167,4\131\&6\166\145\201\149|\221\&2i\192", _willProps = [PropResponseInformation
// "\DC1\210\228c-H\171\231\183MU\SYN\236*\248",PropUserProperty
// "\195\a\251E=/\214g\222\249\221\174\229$wSn\217\STX\229f\147\229lr"
// "\ETXL\202*l\201?p\247\250\173\210\161#\"R\STX\210",PropSubscriptionIdentifierAvailable 96,PropServerKeepAlive
// 3571,PropAssignedClientIdentifier "+)\152\164\177\&9v\245\NAK\153",PropRequestResponseInformation
// 45,PropMessageExpiryInterval 10940,PropMaximumPacketSize 12523]}), _cleanSession = False, _keepAlive = 19508, _connID
// = "|\238>", _properties = [PropReceiveMaximum 6419,PropUserProperty "\STX\194\196\164\209@\152\NUL\248\149a\ENQL"
// "}\167h6tf0h!\200L\STX\SIv\190\183\165\225\DC3\217\237$\173\&4\tK\FS\149\221\GS",PropAuthenticationData
// "\182",PropRequestProblemInformation 122,PropAssignedClientIdentifier "",PropMessageExpiryInterval
// 23247,PropRequestProblemInformation 18,PropMaximumPacketSize 25523,PropWildcardSubscriptionAvailable
// 88,PropMaximumPacketSize 27103,PropSubscriptionIdentifier 30,PropSubscriptionIdentifierAvailable
// 145,PropTopicAliasMaximum 11597,PropResponseTopic
// "\178M\160PH\183\241\149\DLE\144\150y\233\ENQ\253\233\148\SO\DC4\212\222\b\246\182\DC4\vG",PropServerReference
// "L\224",PropMessageExpiryInterval 31337,PropResponseTopic
// "\ACK\130S\DC3\159>\232\132\&3\175\184\149\191\255x\SOH\NAK",PropMaximumQoS 247]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0xae, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x4c, 0x34, 0x94, 0x1,  0x21, 0x19,
                   0x13, 0x26, 0x0,  0xd,  0x2,  0xc2, 0xc4, 0xa4, 0xd1, 0x40, 0x98, 0x0,  0xf8, 0x95, 0x61, 0x5,  0x4c,
                   0x0,  0x1e, 0x7d, 0xa7, 0x68, 0x36, 0x74, 0x66, 0x30, 0x68, 0x21, 0xc8, 0x4c, 0x2,  0xf,  0x76, 0xbe,
                   0xb7, 0xa5, 0xe1, 0x13, 0xd9, 0xed, 0x24, 0xad, 0x34, 0x9,  0x4b, 0x1c, 0x95, 0xdd, 0x1d, 0x16, 0x0,
                   0x1,  0xb6, 0x17, 0x7a, 0x12, 0x0,  0x0,  0x2,  0x0,  0x0,  0x5a, 0xcf, 0x17, 0x12, 0x27, 0x0,  0x0,
                   0x63, 0xb3, 0x28, 0x58, 0x27, 0x0,  0x0,  0x69, 0xdf, 0xb,  0x1e, 0x29, 0x91, 0x22, 0x2d, 0x4d, 0x8,
                   0x0,  0x1b, 0xb2, 0x4d, 0xa0, 0x50, 0x48, 0xb7, 0xf1, 0x95, 0x10, 0x90, 0x96, 0x79, 0xe9, 0x5,  0xfd,
                   0xe9, 0x94, 0xe,  0x14, 0xd4, 0xde, 0x8,  0xf6, 0xb6, 0x14, 0xb,  0x47, 0x1c, 0x0,  0x2,  0x4c, 0xe0,
                   0x2,  0x0,  0x0,  0x7a, 0x69, 0x8,  0x0,  0x11, 0x6,  0x82, 0x53, 0x13, 0x9f, 0x3e, 0xe8, 0x84, 0x33,
                   0xaf, 0xb8, 0x95, 0xbf, 0xff, 0x78, 0x1,  0x15, 0x24, 0xf7, 0x0,  0x3,  0x7c, 0xee, 0x3e, 0x60, 0x1a,
                   0x0,  0xf,  0x11, 0xd2, 0xe4, 0x63, 0x2d, 0x48, 0xab, 0xe7, 0xb7, 0x4d, 0x55, 0x16, 0xec, 0x2a, 0xf8,
                   0x26, 0x0,  0x19, 0xc3, 0x7,  0xfb, 0x45, 0x3d, 0x2f, 0xd6, 0x67, 0xde, 0xf9, 0xdd, 0xae, 0xe5, 0x24,
                   0x77, 0x53, 0x6e, 0xd9, 0x2,  0xe5, 0x66, 0x93, 0xe5, 0x6c, 0x72, 0x0,  0x12, 0x3,  0x4c, 0xca, 0x2a,
                   0x6c, 0xc9, 0x3f, 0x70, 0xf7, 0xfa, 0xad, 0xd2, 0xa1, 0x23, 0x22, 0x52, 0x2,  0xd2, 0x29, 0x60, 0x13,
                   0xd,  0xf3, 0x12, 0x0,  0xa,  0x2b, 0x29, 0x98, 0xa4, 0xb1, 0x39, 0x76, 0xf5, 0x15, 0x99, 0x19, 0x2d,
                   0x2,  0x0,  0x0,  0x2a, 0xbc, 0x27, 0x0,  0x0,  0x30, 0xeb, 0x0,  0x1,  0x2,  0x0,  0x11, 0x36, 0x44,
                   0x89, 0xa7, 0x2c, 0x34, 0x83, 0x36, 0xa6, 0x91, 0xc9, 0x95, 0x7c, 0xdd, 0x32, 0x69, 0xc0, 0x0,  0x1,
                   0xee, 0x0,  0xd,  0xe0, 0xa7, 0xb2, 0x56, 0x62, 0x7e, 0xde, 0x10, 0xc0, 0x92, 0xc5, 0x85, 0x4c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x7d, 0xa7, 0x68, 0x36, 0x74, 0x66, 0x30, 0x68, 0x21, 0xc8, 0x4c, 0x2,  0xf,  0x76, 0xbe,
                           0xb7, 0xa5, 0xe1, 0x13, 0xd9, 0xed, 0x24, 0xad, 0x34, 0x9,  0x4b, 0x1c, 0x95, 0xdd, 0x1d};
  uint8_t bytesprops0[] = {0x2, 0xc2, 0xc4, 0xa4, 0xd1, 0x40, 0x98, 0x0, 0xf8, 0x95, 0x61, 0x5, 0x4c};
  uint8_t bytesprops2[] = {0xb6};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xb2, 0x4d, 0xa0, 0x50, 0x48, 0xb7, 0xf1, 0x95, 0x10, 0x90, 0x96, 0x79, 0xe9, 0x5,
                           0xfd, 0xe9, 0x94, 0xe,  0x14, 0xd4, 0xde, 0x8,  0xf6, 0xb6, 0x14, 0xb,  0x47};
  uint8_t bytesprops5[] = {0x4c, 0xe0};
  uint8_t bytesprops6[] = {0x6,  0x82, 0x53, 0x13, 0x9f, 0x3e, 0xe8, 0x84, 0x33,
                           0xaf, 0xb8, 0x95, 0xbf, 0xff, 0x78, 0x1,  0x15};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6419}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops0}, .v = {30, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23247}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25523}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27103}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11597}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31337}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 247}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x11, 0xd2, 0xe4, 0x63, 0x2d, 0x48, 0xab, 0xe7,
                               0xb7, 0x4d, 0x55, 0x16, 0xec, 0x2a, 0xf8};
  uint8_t byteswillprops2[] = {0x3,  0x4c, 0xca, 0x2a, 0x6c, 0xc9, 0x3f, 0x70, 0xf7,
                               0xfa, 0xad, 0xd2, 0xa1, 0x23, 0x22, 0x52, 0x2,  0xd2};
  uint8_t byteswillprops1[] = {0xc3, 0x7,  0xfb, 0x45, 0x3d, 0x2f, 0xd6, 0x67, 0xde, 0xf9, 0xdd, 0xae, 0xe5,
                               0x24, 0x77, 0x53, 0x6e, 0xd9, 0x2,  0xe5, 0x66, 0x93, 0xe5, 0x6c, 0x72};
  uint8_t byteswillprops3[] = {0x2b, 0x29, 0x98, 0xa4, 0xb1, 0x39, 0x76, 0xf5, 0x15, 0x99};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {25, (char*)&byteswillprops1}, .v = {18, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3571}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10940}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12523}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x36, 0x44, 0x89, 0xa7, 0x2c, 0x34, 0x83, 0x36, 0xa6,
                                  0x91, 0xc9, 0x95, 0x7c, 0xdd, 0x32, 0x69, 0xc0};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19508;
  uint8_t client_id_bytes[] = {0x7c, 0xee, 0x3e};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xee};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xa7, 0xb2, 0x56, 0x62, 0x7e, 0xde, 0x10, 0xc0, 0x92, 0xc5, 0x85, 0x4c};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "e\178\176 \SO\167T!\SOH\NAK;b\193\247\SUB\136\189\199\232", _willMsg =
// "\221}\161\196zS\178P*\152}\254\220\196\216\136\161\220\"\NAK", _willProps = [PropTopicAlias
// 16380,PropServerKeepAlive 6209,PropTopicAliasMaximum 29194,PropMessageExpiryInterval
// 2368,PropSharedSubscriptionAvailable 195,PropUserProperty "kQPG\NUL\228\229\249\156W\217\246\204;d\163\\"
// "n\DLE\225\169\DELI\STX>\SUB\211\248M\169l/p\172m\"",PropSubscriptionIdentifier 4,PropServerReference
// "\NULV\211\225\152A%",PropSubscriptionIdentifier 18,PropMessageExpiryInterval 14776,PropAssignedClientIdentifier
// "\NUL\255\152\137\144\229\186}{\213\173\227\152\131\249\219%!>\DC3\234kn",PropReceiveMaximum
// 26829,PropResponseInformation
// "H\"\255\170l\158\193\141\\\199\168n\STXg\252\197q\133\174W\203ov\131\174k\192\196\GS\167",PropResponseTopic
// "lEe\202\150\130%\146xf\212\255\f\233\&5U@\178\208\212\149\ACK\145@\202_b\241\ACK",PropSubscriptionIdentifier
// 22,PropSessionExpiryInterval 20393,PropAuthenticationMethod
// "\\\242k\155\215\150b\233Q+\217\196\165\166\138\ETX$\248",PropReasonString "nr~\SO\v\242*\199\193 \180"]}),
// _cleanSession = True, _keepAlive = 9446, _connID =
// "\146\132J\ENQ\144\192\ty\167>\184:C\152\133o\\1C\128\253\189]VH\210", _properties = [PropServerKeepAlive
// 15281,PropMessageExpiryInterval 321,PropAuthenticationData
// "\190!H7\224\152\SYNg4\164d2\208\255gR\134",PropRetainAvailable 111,PropServerKeepAlive
// 26493,PropRequestResponseInformation 29,PropAuthenticationMethod
// "\147\NUL>\US\145\&3\139\&8tE\CANV\232F\158\209\149\181\191\130\185\255\196c",PropMaximumQoS
// 44,PropSubscriptionIdentifier 11,PropContentType
// "P\EM\232\185\128:Rju\139a+\171\249hU\221W\DEL&[\178\164\238Cw\ETBn\157_",PropWildcardSubscriptionAvailable
// 71,PropWildcardSubscriptionAvailable 2,PropWillDelayInterval 5770,PropMaximumPacketSize 12405,PropAuthenticationData
// "\183\EOT\SO_\249\f\SO\148\\C\ACK\158\148\251\US\203\171Bu",PropAuthenticationData
// "$hlnO\140Pg\219k\FSPX,\234\DC3\128\166\253h\225\197\SUB\"\243\239\NUL\160",PropRetainAvailable
// 195,PropSessionExpiryInterval 28432,PropAuthenticationData
// "\ENQn\243\212\SOH>k!\151t\212\189\175\165\SYNV\233\ENQ\250\ETB\201\247\&3",PropMaximumQoS
// 223,PropSessionExpiryInterval 1570,PropTopicAliasMaximum 17694,PropSubscriptionIdentifierAvailable
// 230,PropWillDelayInterval 3740,PropSubscriptionIdentifierAvailable 101,PropServerReference
// "3\157\"Cg\215\196r",PropPayloadFormatIndicator 21,PropSubscriptionIdentifier 30,PropAuthenticationData
// "1\196D",PropMaximumPacketSize 9841]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x10, 0x9d, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6,  0x24, 0xe6, 0xf4, 0x1,  0x13, 0x3b, 0xb1, 0x2,
      0x0,  0x0,  0x1,  0x41, 0x16, 0x0,  0x11, 0xbe, 0x21, 0x48, 0x37, 0xe0, 0x98, 0x16, 0x67, 0x34, 0xa4, 0x64, 0x32,
      0xd0, 0xff, 0x67, 0x52, 0x86, 0x25, 0x6f, 0x13, 0x67, 0x7d, 0x19, 0x1d, 0x15, 0x0,  0x18, 0x93, 0x0,  0x3e, 0x1f,
      0x91, 0x33, 0x8b, 0x38, 0x74, 0x45, 0x18, 0x56, 0xe8, 0x46, 0x9e, 0xd1, 0x95, 0xb5, 0xbf, 0x82, 0xb9, 0xff, 0xc4,
      0x63, 0x24, 0x2c, 0xb,  0xb,  0x3,  0x0,  0x1e, 0x50, 0x19, 0xe8, 0xb9, 0x80, 0x3a, 0x52, 0x6a, 0x75, 0x8b, 0x61,
      0x2b, 0xab, 0xf9, 0x68, 0x55, 0xdd, 0x57, 0x7f, 0x26, 0x5b, 0xb2, 0xa4, 0xee, 0x43, 0x77, 0x17, 0x6e, 0x9d, 0x5f,
      0x28, 0x47, 0x28, 0x2,  0x18, 0x0,  0x0,  0x16, 0x8a, 0x27, 0x0,  0x0,  0x30, 0x75, 0x16, 0x0,  0x13, 0xb7, 0x4,
      0xe,  0x5f, 0xf9, 0xc,  0xe,  0x94, 0x5c, 0x43, 0x6,  0x9e, 0x94, 0xfb, 0x1f, 0xcb, 0xab, 0x42, 0x75, 0x16, 0x0,
      0x1c, 0x24, 0x68, 0x6c, 0x6e, 0x4f, 0x8c, 0x50, 0x67, 0xdb, 0x6b, 0x1c, 0x50, 0x58, 0x2c, 0xea, 0x13, 0x80, 0xa6,
      0xfd, 0x68, 0xe1, 0xc5, 0x1a, 0x22, 0xf3, 0xef, 0x0,  0xa0, 0x25, 0xc3, 0x11, 0x0,  0x0,  0x6f, 0x10, 0x16, 0x0,
      0x17, 0x5,  0x6e, 0xf3, 0xd4, 0x1,  0x3e, 0x6b, 0x21, 0x97, 0x74, 0xd4, 0xbd, 0xaf, 0xa5, 0x16, 0x56, 0xe9, 0x5,
      0xfa, 0x17, 0xc9, 0xf7, 0x33, 0x24, 0xdf, 0x11, 0x0,  0x0,  0x6,  0x22, 0x22, 0x45, 0x1e, 0x29, 0xe6, 0x18, 0x0,
      0x0,  0xe,  0x9c, 0x29, 0x65, 0x1c, 0x0,  0x8,  0x33, 0x9d, 0x22, 0x43, 0x67, 0xd7, 0xc4, 0x72, 0x1,  0x15, 0xb,
      0x1e, 0x16, 0x0,  0x3,  0x31, 0xc4, 0x44, 0x27, 0x0,  0x0,  0x26, 0x71, 0x0,  0x1a, 0x92, 0x84, 0x4a, 0x5,  0x90,
      0xc0, 0x9,  0x79, 0xa7, 0x3e, 0xb8, 0x3a, 0x43, 0x98, 0x85, 0x6f, 0x5c, 0x31, 0x43, 0x80, 0xfd, 0xbd, 0x5d, 0x56,
      0x48, 0xd2, 0xd4, 0x1,  0x23, 0x3f, 0xfc, 0x13, 0x18, 0x41, 0x22, 0x72, 0xa,  0x2,  0x0,  0x0,  0x9,  0x40, 0x2a,
      0xc3, 0x26, 0x0,  0x11, 0x6b, 0x51, 0x50, 0x47, 0x0,  0xe4, 0xe5, 0xf9, 0x9c, 0x57, 0xd9, 0xf6, 0xcc, 0x3b, 0x64,
      0xa3, 0x5c, 0x0,  0x13, 0x6e, 0x10, 0xe1, 0xa9, 0x7f, 0x49, 0x2,  0x3e, 0x1a, 0xd3, 0xf8, 0x4d, 0xa9, 0x6c, 0x2f,
      0x70, 0xac, 0x6d, 0x22, 0xb,  0x4,  0x1c, 0x0,  0x7,  0x0,  0x56, 0xd3, 0xe1, 0x98, 0x41, 0x25, 0xb,  0x12, 0x2,
      0x0,  0x0,  0x39, 0xb8, 0x12, 0x0,  0x17, 0x0,  0xff, 0x98, 0x89, 0x90, 0xe5, 0xba, 0x7d, 0x7b, 0xd5, 0xad, 0xe3,
      0x98, 0x83, 0xf9, 0xdb, 0x25, 0x21, 0x3e, 0x13, 0xea, 0x6b, 0x6e, 0x21, 0x68, 0xcd, 0x1a, 0x0,  0x1e, 0x48, 0x22,
      0xff, 0xaa, 0x6c, 0x9e, 0xc1, 0x8d, 0x5c, 0xc7, 0xa8, 0x6e, 0x2,  0x67, 0xfc, 0xc5, 0x71, 0x85, 0xae, 0x57, 0xcb,
      0x6f, 0x76, 0x83, 0xae, 0x6b, 0xc0, 0xc4, 0x1d, 0xa7, 0x8,  0x0,  0x1d, 0x6c, 0x45, 0x65, 0xca, 0x96, 0x82, 0x25,
      0x92, 0x78, 0x66, 0xd4, 0xff, 0xc,  0xe9, 0x35, 0x55, 0x40, 0xb2, 0xd0, 0xd4, 0x95, 0x6,  0x91, 0x40, 0xca, 0x5f,
      0x62, 0xf1, 0x6,  0xb,  0x16, 0x11, 0x0,  0x0,  0x4f, 0xa9, 0x15, 0x0,  0x12, 0x5c, 0xf2, 0x6b, 0x9b, 0xd7, 0x96,
      0x62, 0xe9, 0x51, 0x2b, 0xd9, 0xc4, 0xa5, 0xa6, 0x8a, 0x3,  0x24, 0xf8, 0x1f, 0x0,  0xb,  0x6e, 0x72, 0x7e, 0xe,
      0xb,  0xf2, 0x2a, 0xc7, 0xc1, 0x20, 0xb4, 0x0,  0x13, 0x65, 0xb2, 0xb0, 0x20, 0xe,  0xa7, 0x54, 0x21, 0x1,  0x15,
      0x3b, 0x62, 0xc1, 0xf7, 0x1a, 0x88, 0xbd, 0xc7, 0xe8, 0x0,  0x14, 0xdd, 0x7d, 0xa1, 0xc4, 0x7a, 0x53, 0xb2, 0x50,
      0x2a, 0x98, 0x7d, 0xfe, 0xdc, 0xc4, 0xd8, 0x88, 0xa1, 0xdc, 0x22, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbe, 0x21, 0x48, 0x37, 0xe0, 0x98, 0x16, 0x67, 0x34,
                           0xa4, 0x64, 0x32, 0xd0, 0xff, 0x67, 0x52, 0x86};
  uint8_t bytesprops1[] = {0x93, 0x0,  0x3e, 0x1f, 0x91, 0x33, 0x8b, 0x38, 0x74, 0x45, 0x18, 0x56,
                           0xe8, 0x46, 0x9e, 0xd1, 0x95, 0xb5, 0xbf, 0x82, 0xb9, 0xff, 0xc4, 0x63};
  uint8_t bytesprops2[] = {0x50, 0x19, 0xe8, 0xb9, 0x80, 0x3a, 0x52, 0x6a, 0x75, 0x8b, 0x61, 0x2b, 0xab, 0xf9, 0x68,
                           0x55, 0xdd, 0x57, 0x7f, 0x26, 0x5b, 0xb2, 0xa4, 0xee, 0x43, 0x77, 0x17, 0x6e, 0x9d, 0x5f};
  uint8_t bytesprops3[] = {0xb7, 0x4,  0xe,  0x5f, 0xf9, 0xc,  0xe,  0x94, 0x5c, 0x43,
                           0x6,  0x9e, 0x94, 0xfb, 0x1f, 0xcb, 0xab, 0x42, 0x75};
  uint8_t bytesprops4[] = {0x24, 0x68, 0x6c, 0x6e, 0x4f, 0x8c, 0x50, 0x67, 0xdb, 0x6b, 0x1c, 0x50, 0x58, 0x2c,
                           0xea, 0x13, 0x80, 0xa6, 0xfd, 0x68, 0xe1, 0xc5, 0x1a, 0x22, 0xf3, 0xef, 0x0,  0xa0};
  uint8_t bytesprops5[] = {0x5,  0x6e, 0xf3, 0xd4, 0x1,  0x3e, 0x6b, 0x21, 0x97, 0x74, 0xd4, 0xbd,
                           0xaf, 0xa5, 0x16, 0x56, 0xe9, 0x5,  0xfa, 0x17, 0xc9, 0xf7, 0x33};
  uint8_t bytesprops6[] = {0x33, 0x9d, 0x22, 0x43, 0x67, 0xd7, 0xc4, 0x72};
  uint8_t bytesprops7[] = {0x31, 0xc4, 0x44};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15281}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 321}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26493}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5770}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12405}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28432}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1570}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17694}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3740}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9841}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x6e, 0x10, 0xe1, 0xa9, 0x7f, 0x49, 0x2,  0x3e, 0x1a, 0xd3,
                               0xf8, 0x4d, 0xa9, 0x6c, 0x2f, 0x70, 0xac, 0x6d, 0x22};
  uint8_t byteswillprops0[] = {0x6b, 0x51, 0x50, 0x47, 0x0,  0xe4, 0xe5, 0xf9, 0x9c,
                               0x57, 0xd9, 0xf6, 0xcc, 0x3b, 0x64, 0xa3, 0x5c};
  uint8_t byteswillprops2[] = {0x0, 0x56, 0xd3, 0xe1, 0x98, 0x41, 0x25};
  uint8_t byteswillprops3[] = {0x0,  0xff, 0x98, 0x89, 0x90, 0xe5, 0xba, 0x7d, 0x7b, 0xd5, 0xad, 0xe3,
                               0x98, 0x83, 0xf9, 0xdb, 0x25, 0x21, 0x3e, 0x13, 0xea, 0x6b, 0x6e};
  uint8_t byteswillprops4[] = {0x48, 0x22, 0xff, 0xaa, 0x6c, 0x9e, 0xc1, 0x8d, 0x5c, 0xc7,
                               0xa8, 0x6e, 0x2,  0x67, 0xfc, 0xc5, 0x71, 0x85, 0xae, 0x57,
                               0xcb, 0x6f, 0x76, 0x83, 0xae, 0x6b, 0xc0, 0xc4, 0x1d, 0xa7};
  uint8_t byteswillprops5[] = {0x6c, 0x45, 0x65, 0xca, 0x96, 0x82, 0x25, 0x92, 0x78, 0x66, 0xd4, 0xff, 0xc,  0xe9, 0x35,
                               0x55, 0x40, 0xb2, 0xd0, 0xd4, 0x95, 0x6,  0x91, 0x40, 0xca, 0x5f, 0x62, 0xf1, 0x6};
  uint8_t byteswillprops6[] = {0x5c, 0xf2, 0x6b, 0x9b, 0xd7, 0x96, 0x62, 0xe9, 0x51,
                               0x2b, 0xd9, 0xc4, 0xa5, 0xa6, 0x8a, 0x3,  0x24, 0xf8};
  uint8_t byteswillprops7[] = {0x6e, 0x72, 0x7e, 0xe, 0xb, 0xf2, 0x2a, 0xc7, 0xc1, 0x20, 0xb4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16380}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6209}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29194}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2368}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {17, (char*)&byteswillprops0}, .v = {19, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14776}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26829}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20393}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x65, 0xb2, 0xb0, 0x20, 0xe,  0xa7, 0x54, 0x21, 0x1, 0x15,
                                0x3b, 0x62, 0xc1, 0xf7, 0x1a, 0x88, 0xbd, 0xc7, 0xe8};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdd, 0x7d, 0xa1, 0xc4, 0x7a, 0x53, 0xb2, 0x50, 0x2a, 0x98,
                                  0x7d, 0xfe, 0xdc, 0xc4, 0xd8, 0x88, 0xa1, 0xdc, 0x22, 0x15};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 9446;
  uint8_t client_id_bytes[] = {0x92, 0x84, 0x4a, 0x5,  0x90, 0xc0, 0x9,  0x79, 0xa7, 0x3e, 0xb8, 0x3a, 0x43,
                               0x98, 0x85, 0x6f, 0x5c, 0x31, 0x43, 0x80, 0xfd, 0xbd, 0x5d, 0x56, 0x48, 0xd2};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "0\219\168\207u\209FQb\194\255\SYN:\216` ", _password = Just
// "\224\206\238\173\&1\157LS\135\STX\RSL\213\178A\184\&6\185\133\180r1\191O\169\153m\246O", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "\210\254({", _willMsg = "Z\128\204\SOH\NUL\v%", _willProps =
// [PropResponseInformation "\152\&8\173\FSM*G\129w\204\184\247\224\STX\CANn\168\STX\173\227/u",PropReasonString
// "\233\146Y\178,\161\&2\ETB\179\220\200\243\162\SI[",PropTopicAliasMaximum 2888,PropTopicAliasMaximum
// 31004,PropSessionExpiryInterval 32704,PropReasonString "
// \250\210\140\217\149>\216\255\232\209I\171\180\US\239",PropMessageExpiryInterval 2234]}), _cleanSession = False,
// _keepAlive = 10802, _connID = "\229U\154\147\141\141XPP\181I\226\208\SYN", _properties =
// [PropRequestProblemInformation 180,PropAuthenticationData "w\144",PropRetainAvailable
// 254,PropSubscriptionIdentifierAvailable 147,PropAuthenticationData "\214\130\181",PropWildcardSubscriptionAvailable
// 225]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0xbd, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x2a, 0x32, 0x13, 0x17, 0xb4,
                   0x16, 0x0,  0x2,  0x77, 0x90, 0x25, 0xfe, 0x29, 0x93, 0x16, 0x0,  0x3,  0xd6, 0x82, 0xb5, 0x28,
                   0xe1, 0x0,  0xe,  0xe5, 0x55, 0x9a, 0x93, 0x8d, 0x8d, 0x58, 0x50, 0x50, 0xb5, 0x49, 0xe2, 0xd0,
                   0x16, 0x4e, 0x1a, 0x0,  0x16, 0x98, 0x38, 0xad, 0x1c, 0x4d, 0x2a, 0x47, 0x81, 0x77, 0xcc, 0xb8,
                   0xf7, 0xe0, 0x2,  0x18, 0x6e, 0xa8, 0x2,  0xad, 0xe3, 0x2f, 0x75, 0x1f, 0x0,  0xf,  0xe9, 0x92,
                   0x59, 0xb2, 0x2c, 0xa1, 0x32, 0x17, 0xb3, 0xdc, 0xc8, 0xf3, 0xa2, 0xf,  0x5b, 0x22, 0xb,  0x48,
                   0x22, 0x79, 0x1c, 0x11, 0x0,  0x0,  0x7f, 0xc0, 0x1f, 0x0,  0x10, 0x20, 0xfa, 0xd2, 0x8c, 0xd9,
                   0x95, 0x3e, 0xd8, 0xff, 0xe8, 0xd1, 0x49, 0xab, 0xb4, 0x1f, 0xef, 0x2,  0x0,  0x0,  0x8,  0xba,
                   0x0,  0x4,  0xd2, 0xfe, 0x28, 0x7b, 0x0,  0x7,  0x5a, 0x80, 0xcc, 0x1,  0x0,  0xb,  0x25, 0x0,
                   0x10, 0x30, 0xdb, 0xa8, 0xcf, 0x75, 0xd1, 0x46, 0x51, 0x62, 0xc2, 0xff, 0x16, 0x3a, 0xd8, 0x60,
                   0x20, 0x0,  0x1d, 0xe0, 0xce, 0xee, 0xad, 0x31, 0x9d, 0x4c, 0x53, 0x87, 0x2,  0x1e, 0x4c, 0xd5,
                   0xb2, 0x41, 0xb8, 0x36, 0xb9, 0x85, 0xb4, 0x72, 0x31, 0xbf, 0x4f, 0xa9, 0x99, 0x6d, 0xf6, 0x4f};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x77, 0x90};
  uint8_t bytesprops1[] = {0xd6, 0x82, 0xb5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 225}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x98, 0x38, 0xad, 0x1c, 0x4d, 0x2a, 0x47, 0x81, 0x77, 0xcc, 0xb8,
                               0xf7, 0xe0, 0x2,  0x18, 0x6e, 0xa8, 0x2,  0xad, 0xe3, 0x2f, 0x75};
  uint8_t byteswillprops1[] = {0xe9, 0x92, 0x59, 0xb2, 0x2c, 0xa1, 0x32, 0x17, 0xb3, 0xdc, 0xc8, 0xf3, 0xa2, 0xf, 0x5b};
  uint8_t byteswillprops2[] = {0x20, 0xfa, 0xd2, 0x8c, 0xd9, 0x95, 0x3e, 0xd8,
                               0xff, 0xe8, 0xd1, 0x49, 0xab, 0xb4, 0x1f, 0xef};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2888}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31004}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32704}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2234}},
  };

  lwmqtt_properties_t willprops = {7, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd2, 0xfe, 0x28, 0x7b};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5a, 0x80, 0xcc, 0x1, 0x0, 0xb, 0x25};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10802;
  uint8_t client_id_bytes[] = {0xe5, 0x55, 0x9a, 0x93, 0x8d, 0x8d, 0x58, 0x50, 0x50, 0xb5, 0x49, 0xe2, 0xd0, 0x16};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x30, 0xdb, 0xa8, 0xcf, 0x75, 0xd1, 0x46, 0x51,
                              0x62, 0xc2, 0xff, 0x16, 0x3a, 0xd8, 0x60, 0x20};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe0, 0xce, 0xee, 0xad, 0x31, 0x9d, 0x4c, 0x53, 0x87, 0x2,  0x1e, 0x4c, 0xd5, 0xb2, 0x41,
                              0xb8, 0x36, 0xb9, 0x85, 0xb4, 0x72, 0x31, 0xbf, 0x4f, 0xa9, 0x99, 0x6d, 0xf6, 0x4f};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\159V\EOT\ENQR\a\169J\EOT", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\SI\SO", _willMsg = "\SUB{\SO\EM\190", _willProps =
// [PropWillDelayInterval 5775,PropResponseTopic
// "\140\225i)\252N\183\&5\199\SOH\140\234\131\v;\SOH?\DEL\174k\252Ec\US&\EOT|y\178\r",PropTopicAlias
// 30510,PropReceiveMaximum 21817,PropAuthenticationMethod
// "\203\131\189\214\DC37\DEL\212cm,\254\173\168\RS\185",PropRequestResponseInformation 44,PropServerReference
// "\200\225-\175\171\&7\v\ENQ\226\209\&5\195CL:\163)g\ENQ\181\135\CANqM",PropTopicAlias 24660,PropAuthenticationData
// "rR\237\185\200\186\207\EOT\166f\184\193d\v\GS\\\US#;\238N\172\142\175\198\240",PropMessageExpiryInterval
// 20356,PropSubscriptionIdentifier 18,PropSessionExpiryInterval 11181,PropReceiveMaximum
// 3137,PropRequestResponseInformation 79,PropSessionExpiryInterval 6595,PropAuthenticationData
// ")n\183vS\DC2m\248\ACK`]\251J2\180\175\132,X",PropWildcardSubscriptionAvailable 98,PropWillDelayInterval
// 5996,PropMaximumQoS 190,PropRetainAvailable 40,PropAuthenticationData "",PropAuthenticationData
// "\ESC\STX{\vt\142u\254\161\141Cii\t\217\171`\212\&0\230G",PropSubscriptionIdentifier 4,PropMessageExpiryInterval
// 23967,PropPayloadFormatIndicator 96,PropSubscriptionIdentifier 26,PropServerReference
// "Q$Z\ACK\179\240\155\200\192\204\246x\140\139\ESC",PropRetainAvailable 57,PropMaximumPacketSize 32201]}),
// _cleanSession = True, _keepAlive = 3695, _connID = "V\159\161\231\237\200\154\134\206X\143", _properties =
// [PropAuthenticationMethod "c\143pZf\163]\251gI9S5-O\128l]\v}\249\174o",PropServerKeepAlive
// 9332,PropSubscriptionIdentifier 11,PropMessageExpiryInterval 1769,PropRequestResponseInformation 244,PropUserProperty
// "`\183z(\192\160\144Y=>w8{\136,\183\248\181,\233\247w\252+\ESC\250\203\t\139"
// "\138\218\139z\246@\n\161\244\SOHJ\232\235\DC1\220xX\\?\213\166\DLE\140r\150p",PropResponseInformation
// "\220\147tPcV\NAK\212\f\158\157s\156(\128",PropSessionExpiryInterval 28700,PropSubscriptionIdentifier
// 17,PropCorrelationData "\SICy",PropResponseInformation
// "\NUL\230\136@\146\247\150P*\172\153/\254\174\STX\191",PropReasonString
// "2\163\DC3\220Q\217\133Kg&\163\DC4\254\155;?;\168M[\b-\237z.\FS\249\DC3\202\SI",PropRequestProblemInformation
// 181,PropServerKeepAlive 3262,PropAuthenticationData "$\b\235\EM",PropCorrelationData
// "\184\131\245e\n:\DC3\238",PropTopicAlias 25579,PropUserProperty "\ETX\EOT\167\US\248\139\fB\173"
// "\183\186\&1l\FS\195;\167",PropAssignedClientIdentifier
// "\DC48#GK=,\"\234\253\128\205\177\222\255\195e\173",PropCorrelationData
// "G\173\255m\161\184\247\171T\"a\132",PropTopicAlias 31936,PropUserProperty
// "|\211\196|\176\192\&2\247\156!!L\RS\250\SO" "",PropMessageExpiryInterval 12658,PropRetainAvailable
// 205,PropPayloadFormatIndicator 53]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x10, 0xcc, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4e, 0xe,  0x6f, 0xa9, 0x2,  0x15, 0x0,  0x17, 0x63,
      0x8f, 0x70, 0x5a, 0x66, 0xa3, 0x5d, 0xfb, 0x67, 0x49, 0x39, 0x53, 0x35, 0x2d, 0x4f, 0x80, 0x6c, 0x5d, 0xb,  0x7d,
      0xf9, 0xae, 0x6f, 0x13, 0x24, 0x74, 0xb,  0xb,  0x2,  0x0,  0x0,  0x6,  0xe9, 0x19, 0xf4, 0x26, 0x0,  0x1d, 0x60,
      0xb7, 0x7a, 0x28, 0xc0, 0xa0, 0x90, 0x59, 0x3d, 0x3e, 0x77, 0x38, 0x7b, 0x88, 0x2c, 0xb7, 0xf8, 0xb5, 0x2c, 0xe9,
      0xf7, 0x77, 0xfc, 0x2b, 0x1b, 0xfa, 0xcb, 0x9,  0x8b, 0x0,  0x1a, 0x8a, 0xda, 0x8b, 0x7a, 0xf6, 0x40, 0xa,  0xa1,
      0xf4, 0x1,  0x4a, 0xe8, 0xeb, 0x11, 0xdc, 0x78, 0x58, 0x5c, 0x3f, 0xd5, 0xa6, 0x10, 0x8c, 0x72, 0x96, 0x70, 0x1a,
      0x0,  0xf,  0xdc, 0x93, 0x74, 0x50, 0x63, 0x56, 0x15, 0xd4, 0xc,  0x9e, 0x9d, 0x73, 0x9c, 0x28, 0x80, 0x11, 0x0,
      0x0,  0x70, 0x1c, 0xb,  0x11, 0x9,  0x0,  0x3,  0xf,  0x43, 0x79, 0x1a, 0x0,  0x10, 0x0,  0xe6, 0x88, 0x40, 0x92,
      0xf7, 0x96, 0x50, 0x2a, 0xac, 0x99, 0x2f, 0xfe, 0xae, 0x2,  0xbf, 0x1f, 0x0,  0x1e, 0x32, 0xa3, 0x13, 0xdc, 0x51,
      0xd9, 0x85, 0x4b, 0x67, 0x26, 0xa3, 0x14, 0xfe, 0x9b, 0x3b, 0x3f, 0x3b, 0xa8, 0x4d, 0x5b, 0x8,  0x2d, 0xed, 0x7a,
      0x2e, 0x1c, 0xf9, 0x13, 0xca, 0xf,  0x17, 0xb5, 0x13, 0xc,  0xbe, 0x16, 0x0,  0x4,  0x24, 0x8,  0xeb, 0x19, 0x9,
      0x0,  0x8,  0xb8, 0x83, 0xf5, 0x65, 0xa,  0x3a, 0x13, 0xee, 0x23, 0x63, 0xeb, 0x26, 0x0,  0x9,  0x3,  0x4,  0xa7,
      0x1f, 0xf8, 0x8b, 0xc,  0x42, 0xad, 0x0,  0x8,  0xb7, 0xba, 0x31, 0x6c, 0x1c, 0xc3, 0x3b, 0xa7, 0x12, 0x0,  0x12,
      0x14, 0x38, 0x23, 0x47, 0x4b, 0x3d, 0x2c, 0x22, 0xea, 0xfd, 0x80, 0xcd, 0xb1, 0xde, 0xff, 0xc3, 0x65, 0xad, 0x9,
      0x0,  0xc,  0x47, 0xad, 0xff, 0x6d, 0xa1, 0xb8, 0xf7, 0xab, 0x54, 0x22, 0x61, 0x84, 0x23, 0x7c, 0xc0, 0x26, 0x0,
      0xf,  0x7c, 0xd3, 0xc4, 0x7c, 0xb0, 0xc0, 0x32, 0xf7, 0x9c, 0x21, 0x21, 0x4c, 0x1e, 0xfa, 0xe,  0x0,  0x0,  0x2,
      0x0,  0x0,  0x31, 0x72, 0x25, 0xcd, 0x1,  0x35, 0x0,  0xb,  0x56, 0x9f, 0xa1, 0xe7, 0xed, 0xc8, 0x9a, 0x86, 0xce,
      0x58, 0x8f, 0xf2, 0x1,  0x18, 0x0,  0x0,  0x16, 0x8f, 0x8,  0x0,  0x1e, 0x8c, 0xe1, 0x69, 0x29, 0xfc, 0x4e, 0xb7,
      0x35, 0xc7, 0x1,  0x8c, 0xea, 0x83, 0xb,  0x3b, 0x1,  0x3f, 0x7f, 0xae, 0x6b, 0xfc, 0x45, 0x63, 0x1f, 0x26, 0x4,
      0x7c, 0x79, 0xb2, 0xd,  0x23, 0x77, 0x2e, 0x21, 0x55, 0x39, 0x15, 0x0,  0x10, 0xcb, 0x83, 0xbd, 0xd6, 0x13, 0x37,
      0x7f, 0xd4, 0x63, 0x6d, 0x2c, 0xfe, 0xad, 0xa8, 0x1e, 0xb9, 0x19, 0x2c, 0x1c, 0x0,  0x18, 0xc8, 0xe1, 0x2d, 0xaf,
      0xab, 0x37, 0xb,  0x5,  0xe2, 0xd1, 0x35, 0xc3, 0x43, 0x4c, 0x3a, 0xa3, 0x29, 0x67, 0x5,  0xb5, 0x87, 0x18, 0x71,
      0x4d, 0x23, 0x60, 0x54, 0x16, 0x0,  0x1a, 0x72, 0x52, 0xed, 0xb9, 0xc8, 0xba, 0xcf, 0x4,  0xa6, 0x66, 0xb8, 0xc1,
      0x64, 0xb,  0x1d, 0x5c, 0x1f, 0x23, 0x3b, 0xee, 0x4e, 0xac, 0x8e, 0xaf, 0xc6, 0xf0, 0x2,  0x0,  0x0,  0x4f, 0x84,
      0xb,  0x12, 0x11, 0x0,  0x0,  0x2b, 0xad, 0x21, 0xc,  0x41, 0x19, 0x4f, 0x11, 0x0,  0x0,  0x19, 0xc3, 0x16, 0x0,
      0x13, 0x29, 0x6e, 0xb7, 0x76, 0x53, 0x12, 0x6d, 0xf8, 0x6,  0x60, 0x5d, 0xfb, 0x4a, 0x32, 0xb4, 0xaf, 0x84, 0x2c,
      0x58, 0x28, 0x62, 0x18, 0x0,  0x0,  0x17, 0x6c, 0x24, 0xbe, 0x25, 0x28, 0x16, 0x0,  0x0,  0x16, 0x0,  0x15, 0x1b,
      0x2,  0x7b, 0xb,  0x74, 0x8e, 0x75, 0xfe, 0xa1, 0x8d, 0x43, 0x69, 0x69, 0x9,  0xd9, 0xab, 0x60, 0xd4, 0x30, 0xe6,
      0x47, 0xb,  0x4,  0x2,  0x0,  0x0,  0x5d, 0x9f, 0x1,  0x60, 0xb,  0x1a, 0x1c, 0x0,  0xf,  0x51, 0x24, 0x5a, 0x6,
      0xb3, 0xf0, 0x9b, 0xc8, 0xc0, 0xcc, 0xf6, 0x78, 0x8c, 0x8b, 0x1b, 0x25, 0x39, 0x27, 0x0,  0x0,  0x7d, 0xc9, 0x0,
      0x2,  0xf,  0xe,  0x0,  0x5,  0x1a, 0x7b, 0xe,  0x19, 0xbe, 0x0,  0x9,  0x9f, 0x56, 0x4,  0x5,  0x52, 0x7,  0xa9,
      0x4a, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x63, 0x8f, 0x70, 0x5a, 0x66, 0xa3, 0x5d, 0xfb, 0x67, 0x49, 0x39, 0x53,
                           0x35, 0x2d, 0x4f, 0x80, 0x6c, 0x5d, 0xb,  0x7d, 0xf9, 0xae, 0x6f};
  uint8_t bytesprops2[] = {0x8a, 0xda, 0x8b, 0x7a, 0xf6, 0x40, 0xa,  0xa1, 0xf4, 0x1,  0x4a, 0xe8, 0xeb,
                           0x11, 0xdc, 0x78, 0x58, 0x5c, 0x3f, 0xd5, 0xa6, 0x10, 0x8c, 0x72, 0x96, 0x70};
  uint8_t bytesprops1[] = {0x60, 0xb7, 0x7a, 0x28, 0xc0, 0xa0, 0x90, 0x59, 0x3d, 0x3e, 0x77, 0x38, 0x7b, 0x88, 0x2c,
                           0xb7, 0xf8, 0xb5, 0x2c, 0xe9, 0xf7, 0x77, 0xfc, 0x2b, 0x1b, 0xfa, 0xcb, 0x9,  0x8b};
  uint8_t bytesprops3[] = {0xdc, 0x93, 0x74, 0x50, 0x63, 0x56, 0x15, 0xd4, 0xc, 0x9e, 0x9d, 0x73, 0x9c, 0x28, 0x80};
  uint8_t bytesprops4[] = {0xf, 0x43, 0x79};
  uint8_t bytesprops5[] = {0x0,  0xe6, 0x88, 0x40, 0x92, 0xf7, 0x96, 0x50,
                           0x2a, 0xac, 0x99, 0x2f, 0xfe, 0xae, 0x2,  0xbf};
  uint8_t bytesprops6[] = {0x32, 0xa3, 0x13, 0xdc, 0x51, 0xd9, 0x85, 0x4b, 0x67, 0x26, 0xa3, 0x14, 0xfe, 0x9b, 0x3b,
                           0x3f, 0x3b, 0xa8, 0x4d, 0x5b, 0x8,  0x2d, 0xed, 0x7a, 0x2e, 0x1c, 0xf9, 0x13, 0xca, 0xf};
  uint8_t bytesprops7[] = {0x24, 0x8, 0xeb, 0x19};
  uint8_t bytesprops8[] = {0xb8, 0x83, 0xf5, 0x65, 0xa, 0x3a, 0x13, 0xee};
  uint8_t bytesprops10[] = {0xb7, 0xba, 0x31, 0x6c, 0x1c, 0xc3, 0x3b, 0xa7};
  uint8_t bytesprops9[] = {0x3, 0x4, 0xa7, 0x1f, 0xf8, 0x8b, 0xc, 0x42, 0xad};
  uint8_t bytesprops11[] = {0x14, 0x38, 0x23, 0x47, 0x4b, 0x3d, 0x2c, 0x22, 0xea,
                            0xfd, 0x80, 0xcd, 0xb1, 0xde, 0xff, 0xc3, 0x65, 0xad};
  uint8_t bytesprops12[] = {0x47, 0xad, 0xff, 0x6d, 0xa1, 0xb8, 0xf7, 0xab, 0x54, 0x22, 0x61, 0x84};
  uint8_t bytesprops14[] = {0};
  uint8_t bytesprops13[] = {0x7c, 0xd3, 0xc4, 0x7c, 0xb0, 0xc0, 0x32, 0xf7, 0x9c, 0x21, 0x21, 0x4c, 0x1e, 0xfa, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9332}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1769}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {26, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28700}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3262}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25579}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops9}, .v = {8, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31936}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops13}, .v = {0, (char*)&bytesprops14}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12658}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 53}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x8c, 0xe1, 0x69, 0x29, 0xfc, 0x4e, 0xb7, 0x35, 0xc7, 0x1,  0x8c, 0xea, 0x83, 0xb,  0x3b,
                               0x1,  0x3f, 0x7f, 0xae, 0x6b, 0xfc, 0x45, 0x63, 0x1f, 0x26, 0x4,  0x7c, 0x79, 0xb2, 0xd};
  uint8_t byteswillprops1[] = {0xcb, 0x83, 0xbd, 0xd6, 0x13, 0x37, 0x7f, 0xd4,
                               0x63, 0x6d, 0x2c, 0xfe, 0xad, 0xa8, 0x1e, 0xb9};
  uint8_t byteswillprops2[] = {0xc8, 0xe1, 0x2d, 0xaf, 0xab, 0x37, 0xb, 0x5,  0xe2, 0xd1, 0x35, 0xc3,
                               0x43, 0x4c, 0x3a, 0xa3, 0x29, 0x67, 0x5, 0xb5, 0x87, 0x18, 0x71, 0x4d};
  uint8_t byteswillprops3[] = {0x72, 0x52, 0xed, 0xb9, 0xc8, 0xba, 0xcf, 0x4,  0xa6, 0x66, 0xb8, 0xc1, 0x64,
                               0xb,  0x1d, 0x5c, 0x1f, 0x23, 0x3b, 0xee, 0x4e, 0xac, 0x8e, 0xaf, 0xc6, 0xf0};
  uint8_t byteswillprops4[] = {0x29, 0x6e, 0xb7, 0x76, 0x53, 0x12, 0x6d, 0xf8, 0x6, 0x60,
                               0x5d, 0xfb, 0x4a, 0x32, 0xb4, 0xaf, 0x84, 0x2c, 0x58};
  uint8_t byteswillprops5[] = {0};
  uint8_t byteswillprops6[] = {0x1b, 0x2,  0x7b, 0xb,  0x74, 0x8e, 0x75, 0xfe, 0xa1, 0x8d, 0x43,
                               0x69, 0x69, 0x9,  0xd9, 0xab, 0x60, 0xd4, 0x30, 0xe6, 0x47};
  uint8_t byteswillprops7[] = {0x51, 0x24, 0x5a, 0x6, 0xb3, 0xf0, 0x9b, 0xc8, 0xc0, 0xcc, 0xf6, 0x78, 0x8c, 0x8b, 0x1b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5775}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30510}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21817}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24660}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20356}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11181}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3137}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6595}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5996}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23967}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32201}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf, 0xe};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1a, 0x7b, 0xe, 0x19, 0xbe};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3695;
  uint8_t client_id_bytes[] = {0x56, 0x9f, 0xa1, 0xe7, 0xed, 0xc8, 0x9a, 0x86, 0xce, 0x58, 0x8f};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9f, 0x56, 0x4, 0x5, 0x52, 0x7, 0xa9, 0x4a, 0x4};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\US\184\177\250\165\178m\202\177\229\250+d\229", _password = Just "4#", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\DLE\157\231\207\176$D\205\246cj\139\212\151\237\181\225\198\182>C\FS", _willMsg =
// "\242\166\\\SYN\191\r\DC2d8\129\239\138\135\230\214]\CAN#K\206\USb%R\215\254\242\255\GS\139", _willProps =
// [PropMessageExpiryInterval 10172,PropServerKeepAlive 6438,PropWildcardSubscriptionAvailable 190,PropResponseTopic
// "",PropMessageExpiryInterval 30408,PropMessageExpiryInterval 16984,PropRetainAvailable
// 240,PropSubscriptionIdentifierAvailable 176,PropAssignedClientIdentifier "[\228\138d\USq\v\FS\172",PropReceiveMaximum
// 14049,PropMaximumQoS 252,PropContentType "\252",PropServerKeepAlive 31013]}), _cleanSession = True, _keepAlive =
// 21935, _connID = "", _properties = [PropUserProperty "\169\176\198\202\133\GS\188\USq\SYN\194\135\249\187J"
// "\211\224S;\229\176ID\210\168\US\185Mo\241\137\144\153\143\203\250\ETXW\251",PropTopicAliasMaximum
// 23665,PropServerReference "\SUB\DC1\253\168\&7\NAK'&\186\137\215\158O\229b9",PropSessionExpiryInterval 15033]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0xd4, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x55, 0xaf, 0x47, 0x26, 0x0,  0xf,
                   0xa9, 0xb0, 0xc6, 0xca, 0x85, 0x1d, 0xbc, 0x1f, 0x71, 0x16, 0xc2, 0x87, 0xf9, 0xbb, 0x4a, 0x0,  0x18,
                   0xd3, 0xe0, 0x53, 0x3b, 0xe5, 0xb0, 0x49, 0x44, 0xd2, 0xa8, 0x1f, 0xb9, 0x4d, 0x6f, 0xf1, 0x89, 0x90,
                   0x99, 0x8f, 0xcb, 0xfa, 0x3,  0x57, 0xfb, 0x22, 0x5c, 0x71, 0x1c, 0x0,  0x10, 0x1a, 0x11, 0xfd, 0xa8,
                   0x37, 0x15, 0x27, 0x26, 0xba, 0x89, 0xd7, 0x9e, 0x4f, 0xe5, 0x62, 0x39, 0x11, 0x0,  0x0,  0x3a, 0xb9,
                   0x0,  0x0,  0x33, 0x2,  0x0,  0x0,  0x27, 0xbc, 0x13, 0x19, 0x26, 0x28, 0xbe, 0x8,  0x0,  0x0,  0x2,
                   0x0,  0x0,  0x76, 0xc8, 0x2,  0x0,  0x0,  0x42, 0x58, 0x25, 0xf0, 0x29, 0xb0, 0x12, 0x0,  0x9,  0x5b,
                   0xe4, 0x8a, 0x64, 0x1f, 0x71, 0xb,  0x1c, 0xac, 0x21, 0x36, 0xe1, 0x24, 0xfc, 0x3,  0x0,  0x1,  0xfc,
                   0x13, 0x79, 0x25, 0x0,  0x16, 0x10, 0x9d, 0xe7, 0xcf, 0xb0, 0x24, 0x44, 0xcd, 0xf6, 0x63, 0x6a, 0x8b,
                   0xd4, 0x97, 0xed, 0xb5, 0xe1, 0xc6, 0xb6, 0x3e, 0x43, 0x1c, 0x0,  0x1e, 0xf2, 0xa6, 0x5c, 0x16, 0xbf,
                   0xd,  0x12, 0x64, 0x38, 0x81, 0xef, 0x8a, 0x87, 0xe6, 0xd6, 0x5d, 0x18, 0x23, 0x4b, 0xce, 0x1f, 0x62,
                   0x25, 0x52, 0xd7, 0xfe, 0xf2, 0xff, 0x1d, 0x8b, 0x0,  0xe,  0x1f, 0xb8, 0xb1, 0xfa, 0xa5, 0xb2, 0x6d,
                   0xca, 0xb1, 0xe5, 0xfa, 0x2b, 0x64, 0xe5, 0x0,  0x2,  0x34, 0x23};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0xd3, 0xe0, 0x53, 0x3b, 0xe5, 0xb0, 0x49, 0x44, 0xd2, 0xa8, 0x1f, 0xb9,
                           0x4d, 0x6f, 0xf1, 0x89, 0x90, 0x99, 0x8f, 0xcb, 0xfa, 0x3,  0x57, 0xfb};
  uint8_t bytesprops0[] = {0xa9, 0xb0, 0xc6, 0xca, 0x85, 0x1d, 0xbc, 0x1f, 0x71, 0x16, 0xc2, 0x87, 0xf9, 0xbb, 0x4a};
  uint8_t bytesprops2[] = {0x1a, 0x11, 0xfd, 0xa8, 0x37, 0x15, 0x27, 0x26,
                           0xba, 0x89, 0xd7, 0x9e, 0x4f, 0xe5, 0x62, 0x39};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops0}, .v = {24, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23665}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15033}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops1[] = {0x5b, 0xe4, 0x8a, 0x64, 0x1f, 0x71, 0xb, 0x1c, 0xac};
  uint8_t byteswillprops2[] = {0xfc};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10172}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6438}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30408}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16984}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14049}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31013}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x10, 0x9d, 0xe7, 0xcf, 0xb0, 0x24, 0x44, 0xcd, 0xf6, 0x63, 0x6a,
                                0x8b, 0xd4, 0x97, 0xed, 0xb5, 0xe1, 0xc6, 0xb6, 0x3e, 0x43, 0x1c};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf2, 0xa6, 0x5c, 0x16, 0xbf, 0xd,  0x12, 0x64, 0x38, 0x81,
                                  0xef, 0x8a, 0x87, 0xe6, 0xd6, 0x5d, 0x18, 0x23, 0x4b, 0xce,
                                  0x1f, 0x62, 0x25, 0x52, 0xd7, 0xfe, 0xf2, 0xff, 0x1d, 0x8b};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 21935;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1f, 0xb8, 0xb1, 0xfa, 0xa5, 0xb2, 0x6d, 0xca, 0xb1, 0xe5, 0xfa, 0x2b, 0x64, 0xe5};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x34, 0x23};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\223\FS\149\212{Q\139+/s\191U\174l\n\173", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "AbQ~\153\211\195\255aR\240\202u\223", _willMsg =
// "\254\139\131\221\&7y\167\ETX\187I\188O~e\199", _willProps = [PropContentType
// "'\161^\GS\NAK*\DC4\158A\141\229\135",PropResponseTopic "\222\229\&7\167\192\177",PropReasonString
// "jJL\n7\250\173\NULx\ENQ\245",PropContentType
// "\SOH\253\f&\217\230\253,\164\246\162\227ms,\172\161\218\b\168\178w3",PropMessageExpiryInterval 15070]}),
// _cleanSession = False, _keepAlive = 5033, _connID =
// "\168\223\181\140\b\149\&4\184\157\178\201.\ETX\169Tm\178;\228b\\\246\DLE", _properties = [PropResponseInformation
// "\212\SYN\137\165Fi\152\ETB%\128\216\254\142C\150:\r\254\203S\RS\229\149\188&yS\137\239\GS",PropWildcardSubscriptionAvailable
// 197,PropWildcardSubscriptionAvailable 24,PropServerKeepAlive 21035,PropMessageExpiryInterval 969,PropRetainAvailable
// 9,PropServerReference
// "\147\ETX\233\SI^\128\n\152VB\254\142\252\174\252\160K\219\229\254n\234\&3\SYNbK\186",PropMaximumQoS
// 116,PropMaximumPacketSize 7900,PropReasonString "&\248\165w\200\ENQ\223\213J",PropMaximumQoS
// 31,PropSharedSubscriptionAvailable 112]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x10, 0x81, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4c, 0x13, 0xa9, 0x64, 0x1a, 0x0,  0x1e, 0xd4, 0x16,
      0x89, 0xa5, 0x46, 0x69, 0x98, 0x17, 0x25, 0x80, 0xd8, 0xfe, 0x8e, 0x43, 0x96, 0x3a, 0xd,  0xfe, 0xcb, 0x53, 0x1e,
      0xe5, 0x95, 0xbc, 0x26, 0x79, 0x53, 0x89, 0xef, 0x1d, 0x28, 0xc5, 0x28, 0x18, 0x13, 0x52, 0x2b, 0x2,  0x0,  0x0,
      0x3,  0xc9, 0x25, 0x9,  0x1c, 0x0,  0x1b, 0x93, 0x3,  0xe9, 0xf,  0x5e, 0x80, 0xa,  0x98, 0x56, 0x42, 0xfe, 0x8e,
      0xfc, 0xae, 0xfc, 0xa0, 0x4b, 0xdb, 0xe5, 0xfe, 0x6e, 0xea, 0x33, 0x16, 0x62, 0x4b, 0xba, 0x24, 0x74, 0x27, 0x0,
      0x0,  0x1e, 0xdc, 0x1f, 0x0,  0x9,  0x26, 0xf8, 0xa5, 0x77, 0xc8, 0x5,  0xdf, 0xd5, 0x4a, 0x24, 0x1f, 0x2a, 0x70,
      0x0,  0x17, 0xa8, 0xdf, 0xb5, 0x8c, 0x8,  0x95, 0x34, 0xb8, 0x9d, 0xb2, 0xc9, 0x2e, 0x3,  0xa9, 0x54, 0x6d, 0xb2,
      0x3b, 0xe4, 0x62, 0x5c, 0xf6, 0x10, 0x45, 0x3,  0x0,  0xc,  0x27, 0xa1, 0x5e, 0x1d, 0x15, 0x2a, 0x14, 0x9e, 0x41,
      0x8d, 0xe5, 0x87, 0x8,  0x0,  0x6,  0xde, 0xe5, 0x37, 0xa7, 0xc0, 0xb1, 0x1f, 0x0,  0xb,  0x6a, 0x4a, 0x4c, 0xa,
      0x37, 0xfa, 0xad, 0x0,  0x78, 0x5,  0xf5, 0x3,  0x0,  0x17, 0x1,  0xfd, 0xc,  0x26, 0xd9, 0xe6, 0xfd, 0x2c, 0xa4,
      0xf6, 0xa2, 0xe3, 0x6d, 0x73, 0x2c, 0xac, 0xa1, 0xda, 0x8,  0xa8, 0xb2, 0x77, 0x33, 0x2,  0x0,  0x0,  0x3a, 0xde,
      0x0,  0xe,  0x41, 0x62, 0x51, 0x7e, 0x99, 0xd3, 0xc3, 0xff, 0x61, 0x52, 0xf0, 0xca, 0x75, 0xdf, 0x0,  0xf,  0xfe,
      0x8b, 0x83, 0xdd, 0x37, 0x79, 0xa7, 0x3,  0xbb, 0x49, 0xbc, 0x4f, 0x7e, 0x65, 0xc7, 0x0,  0x10, 0xdf, 0x1c, 0x95,
      0xd4, 0x7b, 0x51, 0x8b, 0x2b, 0x2f, 0x73, 0xbf, 0x55, 0xae, 0x6c, 0xa,  0xad};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd4, 0x16, 0x89, 0xa5, 0x46, 0x69, 0x98, 0x17, 0x25, 0x80, 0xd8, 0xfe, 0x8e, 0x43, 0x96,
                           0x3a, 0xd,  0xfe, 0xcb, 0x53, 0x1e, 0xe5, 0x95, 0xbc, 0x26, 0x79, 0x53, 0x89, 0xef, 0x1d};
  uint8_t bytesprops1[] = {0x93, 0x3,  0xe9, 0xf,  0x5e, 0x80, 0xa,  0x98, 0x56, 0x42, 0xfe, 0x8e, 0xfc, 0xae,
                           0xfc, 0xa0, 0x4b, 0xdb, 0xe5, 0xfe, 0x6e, 0xea, 0x33, 0x16, 0x62, 0x4b, 0xba};
  uint8_t bytesprops2[] = {0x26, 0xf8, 0xa5, 0x77, 0xc8, 0x5, 0xdf, 0xd5, 0x4a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21035}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 969}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7900}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 112}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x27, 0xa1, 0x5e, 0x1d, 0x15, 0x2a, 0x14, 0x9e, 0x41, 0x8d, 0xe5, 0x87};
  uint8_t byteswillprops1[] = {0xde, 0xe5, 0x37, 0xa7, 0xc0, 0xb1};
  uint8_t byteswillprops2[] = {0x6a, 0x4a, 0x4c, 0xa, 0x37, 0xfa, 0xad, 0x0, 0x78, 0x5, 0xf5};
  uint8_t byteswillprops3[] = {0x1,  0xfd, 0xc,  0x26, 0xd9, 0xe6, 0xfd, 0x2c, 0xa4, 0xf6, 0xa2, 0xe3,
                               0x6d, 0x73, 0x2c, 0xac, 0xa1, 0xda, 0x8,  0xa8, 0xb2, 0x77, 0x33};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15070}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x41, 0x62, 0x51, 0x7e, 0x99, 0xd3, 0xc3, 0xff, 0x61, 0x52, 0xf0, 0xca, 0x75, 0xdf};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfe, 0x8b, 0x83, 0xdd, 0x37, 0x79, 0xa7, 0x3,
                                  0xbb, 0x49, 0xbc, 0x4f, 0x7e, 0x65, 0xc7};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 5033;
  uint8_t client_id_bytes[] = {0xa8, 0xdf, 0xb5, 0x8c, 0x8,  0x95, 0x34, 0xb8, 0x9d, 0xb2, 0xc9, 0x2e,
                               0x3,  0xa9, 0x54, 0x6d, 0xb2, 0x3b, 0xe4, 0x62, 0x5c, 0xf6, 0x10};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xdf, 0x1c, 0x95, 0xd4, 0x7b, 0x51, 0x8b, 0x2b,
                              0x2f, 0x73, 0xbf, 0x55, 0xae, 0x6c, 0xa,  0xad};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Q\ESC&\174\247\148\240\DEL]\244\244\245", _password = Just "*\202 ;\132", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\130\&6pS\DC2\ACK(Y\152Y\FS\150\ETBy\207\136\204", _willMsg =
// "\164w\254._0\196?\182\141eY\201\165\141n\163\251|\199\160", _willProps = [PropContentType
// "\154\206-*'Q(\236D@xx\151\148\167T\239xC\195+\142\v\186SA\174\138\166s",PropResponseTopic
// "A\191\DC2E$(\239%vB^\212\181\152?7\150\164f\DEL\220Zp\158\SYNvF\226\151",PropPayloadFormatIndicator
// 101,PropCorrelationData ",2\176$",PropServerKeepAlive 11601,PropMaximumQoS 120,PropServerReference
// "s\230h.\SUB5p9\178\248\227\DC3\n\STXf*\ACKN\242+\225",PropReceiveMaximum 10666,PropMessageExpiryInterval
// 5491,PropRequestProblemInformation 111,PropRequestResponseInformation 47,PropCorrelationData
// "T\200\254\157[x\210\185\228+\186\190P\155*[z\r\188",PropTopicAlias 26651,PropAssignedClientIdentifier
// "",PropSubscriptionIdentifierAvailable 199,PropSessionExpiryInterval 12887,PropContentType
// "J\199fS-_\250\180\160\129K\171\151\155y\220-1"]}), _cleanSession = False, _keepAlive = 6835, _connID =
// "=7\240F\243\217", _properties = [PropSharedSubscriptionAvailable 204,PropResponseInformation
// "e",PropSharedSubscriptionAvailable 192,PropRequestProblemInformation 201,PropSessionExpiryInterval
// 19992,PropAssignedClientIdentifier "\186\&2\ETB\169\190\129o\ETXN\160I",PropUserProperty
// "a?\166r\172\240\159\250\128\187" "kX{\140\215\235/\248\SO\152L\239\229\175~O\199",PropUserProperty "\131\173"
// "\189c\135\&4\t\DEL\130[\176\171\241O\192\189q\149\&3\255\&0\ETBq",PropServerKeepAlive 15269,PropResponseInformation
// "\214\161\150\SOH\136\247cV\158\&2</\134<\187\135\139B\203\ENQ\ETB\"",PropRequestResponseInformation
// 113,PropAuthenticationMethod "\246ar\207\224\148\249\NAK\EOTx\DC1D\183\251\&6\144\202",PropAuthenticationData
// "W\234N\245\SO\USc\150r\\\DC4",PropAuthenticationData
// "N\NUL\239\145Qi\208\222\162W_O\156\DC20\157\130\143\148g(\238\181\163\161k\246\233\153",PropAssignedClientIdentifier
// "Z\182\139\194\146\by[m\EOT\253\186\EM\241b\233t\158\173^\137t",PropRetainAvailable 86,PropReceiveMaximum
// 28984,PropServerReference "\228U\EOT\143\&9\199ss\174\243^_7\213\EOT\156]M$",PropRetainAvailable
// 135,PropAuthenticationData
// "\188\139]\215\&4\194\171\EOT;x\201M\252\138\RS\138\DC3\199\236\144U\128",PropServerReference
// "-\192\\\STX\GS\ENQ\ACK\150o>\ENQ\154\249\DC2!\141p:-C%\250q1",PropAssignedClientIdentifier
// "\211<5\229Y$",PropRequestProblemInformation 252,PropServerReference
// "\SOoo\f\156\CAN\157\249S\170\218o\SYN\153\142\207\236\133\176XN6\219iZ",PropTopicAlias
// 27820,PropSubscriptionIdentifierAvailable 228,PropSubscriptionIdentifier 3,PropServerKeepAlive 30256,PropMaximumQoS
// 231]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x10, 0xd6, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x1a, 0xb3, 0xd6, 0x2,  0x2a, 0xcc, 0x1a, 0x0,
      0x1,  0x65, 0x2a, 0xc0, 0x17, 0xc9, 0x11, 0x0,  0x0,  0x4e, 0x18, 0x12, 0x0,  0xb,  0xba, 0x32, 0x17, 0xa9, 0xbe,
      0x81, 0x6f, 0x3,  0x4e, 0xa0, 0x49, 0x26, 0x0,  0xa,  0x61, 0x3f, 0xa6, 0x72, 0xac, 0xf0, 0x9f, 0xfa, 0x80, 0xbb,
      0x0,  0x11, 0x6b, 0x58, 0x7b, 0x8c, 0xd7, 0xeb, 0x2f, 0xf8, 0xe,  0x98, 0x4c, 0xef, 0xe5, 0xaf, 0x7e, 0x4f, 0xc7,
      0x26, 0x0,  0x2,  0x83, 0xad, 0x0,  0x15, 0xbd, 0x63, 0x87, 0x34, 0x9,  0x7f, 0x82, 0x5b, 0xb0, 0xab, 0xf1, 0x4f,
      0xc0, 0xbd, 0x71, 0x95, 0x33, 0xff, 0x30, 0x17, 0x71, 0x13, 0x3b, 0xa5, 0x1a, 0x0,  0x16, 0xd6, 0xa1, 0x96, 0x1,
      0x88, 0xf7, 0x63, 0x56, 0x9e, 0x32, 0x3c, 0x2f, 0x86, 0x3c, 0xbb, 0x87, 0x8b, 0x42, 0xcb, 0x5,  0x17, 0x22, 0x19,
      0x71, 0x15, 0x0,  0x11, 0xf6, 0x61, 0x72, 0xcf, 0xe0, 0x94, 0xf9, 0x15, 0x4,  0x78, 0x11, 0x44, 0xb7, 0xfb, 0x36,
      0x90, 0xca, 0x16, 0x0,  0xb,  0x57, 0xea, 0x4e, 0xf5, 0xe,  0x1f, 0x63, 0x96, 0x72, 0x5c, 0x14, 0x16, 0x0,  0x1d,
      0x4e, 0x0,  0xef, 0x91, 0x51, 0x69, 0xd0, 0xde, 0xa2, 0x57, 0x5f, 0x4f, 0x9c, 0x12, 0x30, 0x9d, 0x82, 0x8f, 0x94,
      0x67, 0x28, 0xee, 0xb5, 0xa3, 0xa1, 0x6b, 0xf6, 0xe9, 0x99, 0x12, 0x0,  0x16, 0x5a, 0xb6, 0x8b, 0xc2, 0x92, 0x8,
      0x79, 0x5b, 0x6d, 0x4,  0xfd, 0xba, 0x19, 0xf1, 0x62, 0xe9, 0x74, 0x9e, 0xad, 0x5e, 0x89, 0x74, 0x25, 0x56, 0x21,
      0x71, 0x38, 0x1c, 0x0,  0x13, 0xe4, 0x55, 0x4,  0x8f, 0x39, 0xc7, 0x73, 0x73, 0xae, 0xf3, 0x5e, 0x5f, 0x37, 0xd5,
      0x4,  0x9c, 0x5d, 0x4d, 0x24, 0x25, 0x87, 0x16, 0x0,  0x16, 0xbc, 0x8b, 0x5d, 0xd7, 0x34, 0xc2, 0xab, 0x4,  0x3b,
      0x78, 0xc9, 0x4d, 0xfc, 0x8a, 0x1e, 0x8a, 0x13, 0xc7, 0xec, 0x90, 0x55, 0x80, 0x1c, 0x0,  0x18, 0x2d, 0xc0, 0x5c,
      0x2,  0x1d, 0x5,  0x6,  0x96, 0x6f, 0x3e, 0x5,  0x9a, 0xf9, 0x12, 0x21, 0x8d, 0x70, 0x3a, 0x2d, 0x43, 0x25, 0xfa,
      0x71, 0x31, 0x12, 0x0,  0x6,  0xd3, 0x3c, 0x35, 0xe5, 0x59, 0x24, 0x17, 0xfc, 0x1c, 0x0,  0x19, 0xe,  0x6f, 0x6f,
      0xc,  0x9c, 0x18, 0x9d, 0xf9, 0x53, 0xaa, 0xda, 0x6f, 0x16, 0x99, 0x8e, 0xcf, 0xec, 0x85, 0xb0, 0x58, 0x4e, 0x36,
      0xdb, 0x69, 0x5a, 0x23, 0x6c, 0xac, 0x29, 0xe4, 0xb,  0x3,  0x13, 0x76, 0x30, 0x24, 0xe7, 0x0,  0x6,  0x3d, 0x37,
      0xf0, 0x46, 0xf3, 0xd9, 0xab, 0x1,  0x3,  0x0,  0x1e, 0x9a, 0xce, 0x2d, 0x2a, 0x27, 0x51, 0x28, 0xec, 0x44, 0x40,
      0x78, 0x78, 0x97, 0x94, 0xa7, 0x54, 0xef, 0x78, 0x43, 0xc3, 0x2b, 0x8e, 0xb,  0xba, 0x53, 0x41, 0xae, 0x8a, 0xa6,
      0x73, 0x8,  0x0,  0x1d, 0x41, 0xbf, 0x12, 0x45, 0x24, 0x28, 0xef, 0x25, 0x76, 0x42, 0x5e, 0xd4, 0xb5, 0x98, 0x3f,
      0x37, 0x96, 0xa4, 0x66, 0x7f, 0xdc, 0x5a, 0x70, 0x9e, 0x16, 0x76, 0x46, 0xe2, 0x97, 0x1,  0x65, 0x9,  0x0,  0x4,
      0x2c, 0x32, 0xb0, 0x24, 0x13, 0x2d, 0x51, 0x24, 0x78, 0x1c, 0x0,  0x15, 0x73, 0xe6, 0x68, 0x2e, 0x1a, 0x35, 0x70,
      0x39, 0xb2, 0xf8, 0xe3, 0x13, 0xa,  0x2,  0x66, 0x2a, 0x6,  0x4e, 0xf2, 0x2b, 0xe1, 0x21, 0x29, 0xaa, 0x2,  0x0,
      0x0,  0x15, 0x73, 0x17, 0x6f, 0x19, 0x2f, 0x9,  0x0,  0x13, 0x54, 0xc8, 0xfe, 0x9d, 0x5b, 0x78, 0xd2, 0xb9, 0xe4,
      0x2b, 0xba, 0xbe, 0x50, 0x9b, 0x2a, 0x5b, 0x7a, 0xd,  0xbc, 0x23, 0x68, 0x1b, 0x12, 0x0,  0x0,  0x29, 0xc7, 0x11,
      0x0,  0x0,  0x32, 0x57, 0x3,  0x0,  0x12, 0x4a, 0xc7, 0x66, 0x53, 0x2d, 0x5f, 0xfa, 0xb4, 0xa0, 0x81, 0x4b, 0xab,
      0x97, 0x9b, 0x79, 0xdc, 0x2d, 0x31, 0x0,  0x11, 0x82, 0x36, 0x70, 0x53, 0x12, 0x6,  0x28, 0x59, 0x98, 0x59, 0x1c,
      0x96, 0x17, 0x79, 0xcf, 0x88, 0xcc, 0x0,  0x15, 0xa4, 0x77, 0xfe, 0x2e, 0x5f, 0x30, 0xc4, 0x3f, 0xb6, 0x8d, 0x65,
      0x59, 0xc9, 0xa5, 0x8d, 0x6e, 0xa3, 0xfb, 0x7c, 0xc7, 0xa0, 0x0,  0xc,  0x51, 0x1b, 0x26, 0xae, 0xf7, 0x94, 0xf0,
      0x7f, 0x5d, 0xf4, 0xf4, 0xf5, 0x0,  0x5,  0x2a, 0xca, 0x20, 0x3b, 0x84};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x65};
  uint8_t bytesprops1[] = {0xba, 0x32, 0x17, 0xa9, 0xbe, 0x81, 0x6f, 0x3, 0x4e, 0xa0, 0x49};
  uint8_t bytesprops3[] = {0x6b, 0x58, 0x7b, 0x8c, 0xd7, 0xeb, 0x2f, 0xf8, 0xe,
                           0x98, 0x4c, 0xef, 0xe5, 0xaf, 0x7e, 0x4f, 0xc7};
  uint8_t bytesprops2[] = {0x61, 0x3f, 0xa6, 0x72, 0xac, 0xf0, 0x9f, 0xfa, 0x80, 0xbb};
  uint8_t bytesprops5[] = {0xbd, 0x63, 0x87, 0x34, 0x9,  0x7f, 0x82, 0x5b, 0xb0, 0xab, 0xf1,
                           0x4f, 0xc0, 0xbd, 0x71, 0x95, 0x33, 0xff, 0x30, 0x17, 0x71};
  uint8_t bytesprops4[] = {0x83, 0xad};
  uint8_t bytesprops6[] = {0xd6, 0xa1, 0x96, 0x1,  0x88, 0xf7, 0x63, 0x56, 0x9e, 0x32, 0x3c,
                           0x2f, 0x86, 0x3c, 0xbb, 0x87, 0x8b, 0x42, 0xcb, 0x5,  0x17, 0x22};
  uint8_t bytesprops7[] = {0xf6, 0x61, 0x72, 0xcf, 0xe0, 0x94, 0xf9, 0x15, 0x4,
                           0x78, 0x11, 0x44, 0xb7, 0xfb, 0x36, 0x90, 0xca};
  uint8_t bytesprops8[] = {0x57, 0xea, 0x4e, 0xf5, 0xe, 0x1f, 0x63, 0x96, 0x72, 0x5c, 0x14};
  uint8_t bytesprops9[] = {0x4e, 0x0,  0xef, 0x91, 0x51, 0x69, 0xd0, 0xde, 0xa2, 0x57, 0x5f, 0x4f, 0x9c, 0x12, 0x30,
                           0x9d, 0x82, 0x8f, 0x94, 0x67, 0x28, 0xee, 0xb5, 0xa3, 0xa1, 0x6b, 0xf6, 0xe9, 0x99};
  uint8_t bytesprops10[] = {0x5a, 0xb6, 0x8b, 0xc2, 0x92, 0x8,  0x79, 0x5b, 0x6d, 0x4,  0xfd,
                            0xba, 0x19, 0xf1, 0x62, 0xe9, 0x74, 0x9e, 0xad, 0x5e, 0x89, 0x74};
  uint8_t bytesprops11[] = {0xe4, 0x55, 0x4,  0x8f, 0x39, 0xc7, 0x73, 0x73, 0xae, 0xf3,
                            0x5e, 0x5f, 0x37, 0xd5, 0x4,  0x9c, 0x5d, 0x4d, 0x24};
  uint8_t bytesprops12[] = {0xbc, 0x8b, 0x5d, 0xd7, 0x34, 0xc2, 0xab, 0x4,  0x3b, 0x78, 0xc9,
                            0x4d, 0xfc, 0x8a, 0x1e, 0x8a, 0x13, 0xc7, 0xec, 0x90, 0x55, 0x80};
  uint8_t bytesprops13[] = {0x2d, 0xc0, 0x5c, 0x2,  0x1d, 0x5,  0x6,  0x96, 0x6f, 0x3e, 0x5,  0x9a,
                            0xf9, 0x12, 0x21, 0x8d, 0x70, 0x3a, 0x2d, 0x43, 0x25, 0xfa, 0x71, 0x31};
  uint8_t bytesprops14[] = {0xd3, 0x3c, 0x35, 0xe5, 0x59, 0x24};
  uint8_t bytesprops15[] = {0xe,  0x6f, 0x6f, 0xc,  0x9c, 0x18, 0x9d, 0xf9, 0x53, 0xaa, 0xda, 0x6f, 0x16,
                            0x99, 0x8e, 0xcf, 0xec, 0x85, 0xb0, 0x58, 0x4e, 0x36, 0xdb, 0x69, 0x5a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19992}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops2}, .v = {17, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops4}, .v = {21, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15269}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28984}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27820}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30256}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9a, 0xce, 0x2d, 0x2a, 0x27, 0x51, 0x28, 0xec, 0x44, 0x40,
                               0x78, 0x78, 0x97, 0x94, 0xa7, 0x54, 0xef, 0x78, 0x43, 0xc3,
                               0x2b, 0x8e, 0xb,  0xba, 0x53, 0x41, 0xae, 0x8a, 0xa6, 0x73};
  uint8_t byteswillprops1[] = {0x41, 0xbf, 0x12, 0x45, 0x24, 0x28, 0xef, 0x25, 0x76, 0x42, 0x5e, 0xd4, 0xb5, 0x98, 0x3f,
                               0x37, 0x96, 0xa4, 0x66, 0x7f, 0xdc, 0x5a, 0x70, 0x9e, 0x16, 0x76, 0x46, 0xe2, 0x97};
  uint8_t byteswillprops2[] = {0x2c, 0x32, 0xb0, 0x24};
  uint8_t byteswillprops3[] = {0x73, 0xe6, 0x68, 0x2e, 0x1a, 0x35, 0x70, 0x39, 0xb2, 0xf8, 0xe3,
                               0x13, 0xa,  0x2,  0x66, 0x2a, 0x6,  0x4e, 0xf2, 0x2b, 0xe1};
  uint8_t byteswillprops4[] = {0x54, 0xc8, 0xfe, 0x9d, 0x5b, 0x78, 0xd2, 0xb9, 0xe4, 0x2b,
                               0xba, 0xbe, 0x50, 0x9b, 0x2a, 0x5b, 0x7a, 0xd,  0xbc};
  uint8_t byteswillprops5[] = {0};
  uint8_t byteswillprops6[] = {0x4a, 0xc7, 0x66, 0x53, 0x2d, 0x5f, 0xfa, 0xb4, 0xa0,
                               0x81, 0x4b, 0xab, 0x97, 0x9b, 0x79, 0xdc, 0x2d, 0x31};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11601}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10666}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5491}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26651}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12887}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&byteswillprops6}}},
  };

  lwmqtt_properties_t willprops = {17, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x82, 0x36, 0x70, 0x53, 0x12, 0x6,  0x28, 0x59, 0x98,
                                0x59, 0x1c, 0x96, 0x17, 0x79, 0xcf, 0x88, 0xcc};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0x77, 0xfe, 0x2e, 0x5f, 0x30, 0xc4, 0x3f, 0xb6, 0x8d, 0x65,
                                  0x59, 0xc9, 0xa5, 0x8d, 0x6e, 0xa3, 0xfb, 0x7c, 0xc7, 0xa0};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6835;
  uint8_t client_id_bytes[] = {0x3d, 0x37, 0xf0, 0x46, 0xf3, 0xd9};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x51, 0x1b, 0x26, 0xae, 0xf7, 0x94, 0xf0, 0x7f, 0x5d, 0xf4, 0xf4, 0xf5};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2a, 0xca, 0x20, 0x3b, 0x84};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ">\GSG\161K\206,\183\NAKu{\239\227y\214\238\251\157?\147!,XQ\180\vF\251P", _password
// = Just "\f\192\209\&7\135\205f\134\181\170)xCW.\190E", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\236\202:\200\SO\EMYd\145y6:\171-\DC4 \194", _willMsg =
// "\241\156\177\145\136\DC3h\r\128\187P\182\239\173#\153y0o'\158G\149", _willProps = [PropTopicAlias
// 21,PropWildcardSubscriptionAvailable 157,PropRetainAvailable 182,PropAuthenticationData
// "\194\245\254~wi#\142\214\131\248O\248\196\175Mck3",PropServerKeepAlive 22229,PropAuthenticationData
// "\236\171D\173C]U\192",PropWildcardSubscriptionAvailable 147,PropContentType
// "\220\246\153\DLE\162&\216K\232xv\174;\254\165\135\190\EOT\180J\134~O\195mm\SI\197\b\EM",PropRetainAvailable
// 220,PropUserProperty "\167\194\244p\245=\238\DC1\201" "\238D#5S\160B\242",PropWillDelayInterval
// 10510,PropRequestProblemInformation 144,PropServerReference "e\221\133\147A\NAK\v\139\\\157\131t\208C_I\239\FS
// \232\168]\183Q",PropUserProperty "\216\t\198\192"
// "\136\143\229\225U\194lb%\141\200\&1R`\254\225\192\136;z`\216CgR",PropCorrelationData
// "\180\207\178x\STX\142",PropAuthenticationData
// "\240\DC1\254\162\155\&0\180\243s\195\223\STX\179\168\149F\174\150v\NAK\188\136\DC3\213\226(\137R",PropServerKeepAlive
// 11277,PropWildcardSubscriptionAvailable 162,PropSharedSubscriptionAvailable 16,PropMessageExpiryInterval
// 30939,PropAuthenticationMethod ".\203\&4\150\r\ETB\214\146\&4\225\253\133\215\223",PropTopicAlias
// 4379,PropWillDelayInterval 22271,PropSubscriptionIdentifierAvailable 53,PropAuthenticationData
// "\236;\228$\176\133yZg\ETX\DC1\188\230=\255jI'S\197",PropRequestProblemInformation 132,PropReceiveMaximum 16913]}),
// _cleanSession = True, _keepAlive = 12883, _connID = "\191\194\&3\136\GS\t\240", _properties =
// [PropSubscriptionIdentifier 22,PropUserProperty "\RSP\240{\242\140\r" "e",PropWildcardSubscriptionAvailable
// 74,PropSubscriptionIdentifierAvailable 79,PropMessageExpiryInterval 5364,PropServerReference
// "\222\145\154\252\ESC\163\147\152\203",PropMessageExpiryInterval 22212,PropReasonString
// "\168",PropPayloadFormatIndicator 212,PropRetainAvailable 246,PropUserProperty
// "\237\&4\146}\DC3\252G=^,\SIuu\132\196\143\233\240\SYN"
// ":\198\183\192\218al[\DELNr\206\245\152\236\196\198l\151\SUB\195\188_",PropSharedSubscriptionAvailable
// 192,PropServerKeepAlive 9518,PropCorrelationData "\156>\SO?\216^g\197\146",PropAuthenticationData
// "|>\136\187\214w2",PropMessageExpiryInterval 5171,PropWillDelayInterval 30792,PropAssignedClientIdentifier
// "",PropMaximumQoS 160,PropSharedSubscriptionAvailable 59,PropContentType
// "\238U\161av\178!p\175\197Zz<\ACKC\162\208\177\US\RS\ETBqg1",PropMessageExpiryInterval 2410,PropServerKeepAlive
// 21813,PropRequestProblemInformation 2,PropContentType "\EM\DC1\v\ACK\DC1\177\185\f+",PropMessageExpiryInterval
// 30176,PropUserProperty "a\180U" "\163\156\183\NAK\195\193\a]/|\253\171\US\190[ 4\227\195\214\ETX",PropUserProperty
// "\240\151\205\238\\H" "@\194\234\209`\132\NUL\144T"]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0xfd, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x32, 0x53, 0xf3, 0x1,  0xb,  0x16, 0x26, 0x0,
      0x7,  0x1e, 0x50, 0xf0, 0x7b, 0xf2, 0x8c, 0xd,  0x0,  0x1,  0x65, 0x28, 0x4a, 0x29, 0x4f, 0x2,  0x0,  0x0,  0x14,
      0xf4, 0x1c, 0x0,  0x9,  0xde, 0x91, 0x9a, 0xfc, 0x1b, 0xa3, 0x93, 0x98, 0xcb, 0x2,  0x0,  0x0,  0x56, 0xc4, 0x1f,
      0x0,  0x1,  0xa8, 0x1,  0xd4, 0x25, 0xf6, 0x26, 0x0,  0x13, 0xed, 0x34, 0x92, 0x7d, 0x13, 0xfc, 0x47, 0x3d, 0x5e,
      0x2c, 0xf,  0x75, 0x75, 0x84, 0xc4, 0x8f, 0xe9, 0xf0, 0x16, 0x0,  0x17, 0x3a, 0xc6, 0xb7, 0xc0, 0xda, 0x61, 0x6c,
      0x5b, 0x7f, 0x4e, 0x72, 0xce, 0xf5, 0x98, 0xec, 0xc4, 0xc6, 0x6c, 0x97, 0x1a, 0xc3, 0xbc, 0x5f, 0x2a, 0xc0, 0x13,
      0x25, 0x2e, 0x9,  0x0,  0x9,  0x9c, 0x3e, 0xe,  0x3f, 0xd8, 0x5e, 0x67, 0xc5, 0x92, 0x16, 0x0,  0x7,  0x7c, 0x3e,
      0x88, 0xbb, 0xd6, 0x77, 0x32, 0x2,  0x0,  0x0,  0x14, 0x33, 0x18, 0x0,  0x0,  0x78, 0x48, 0x12, 0x0,  0x0,  0x24,
      0xa0, 0x2a, 0x3b, 0x3,  0x0,  0x18, 0xee, 0x55, 0xa1, 0x61, 0x76, 0xb2, 0x21, 0x70, 0xaf, 0xc5, 0x5a, 0x7a, 0x3c,
      0x6,  0x43, 0xa2, 0xd0, 0xb1, 0x1f, 0x1e, 0x17, 0x71, 0x67, 0x31, 0x2,  0x0,  0x0,  0x9,  0x6a, 0x13, 0x55, 0x35,
      0x17, 0x2,  0x3,  0x0,  0x9,  0x19, 0x11, 0xb,  0x6,  0x11, 0xb1, 0xb9, 0xc,  0x2b, 0x2,  0x0,  0x0,  0x75, 0xe0,
      0x26, 0x0,  0x3,  0x61, 0xb4, 0x55, 0x0,  0x15, 0xa3, 0x9c, 0xb7, 0x15, 0xc3, 0xc1, 0x7,  0x5d, 0x2f, 0x7c, 0xfd,
      0xab, 0x1f, 0xbe, 0x5b, 0x20, 0x34, 0xe3, 0xc3, 0xd6, 0x3,  0x26, 0x0,  0x6,  0xf0, 0x97, 0xcd, 0xee, 0x5c, 0x48,
      0x0,  0x9,  0x40, 0xc2, 0xea, 0xd1, 0x60, 0x84, 0x0,  0x90, 0x54, 0x0,  0x7,  0xbf, 0xc2, 0x33, 0x88, 0x1d, 0x9,
      0xf0, 0x95, 0x2,  0x23, 0x0,  0x15, 0x28, 0x9d, 0x25, 0xb6, 0x16, 0x0,  0x13, 0xc2, 0xf5, 0xfe, 0x7e, 0x77, 0x69,
      0x23, 0x8e, 0xd6, 0x83, 0xf8, 0x4f, 0xf8, 0xc4, 0xaf, 0x4d, 0x63, 0x6b, 0x33, 0x13, 0x56, 0xd5, 0x16, 0x0,  0x8,
      0xec, 0xab, 0x44, 0xad, 0x43, 0x5d, 0x55, 0xc0, 0x28, 0x93, 0x3,  0x0,  0x1e, 0xdc, 0xf6, 0x99, 0x10, 0xa2, 0x26,
      0xd8, 0x4b, 0xe8, 0x78, 0x76, 0xae, 0x3b, 0xfe, 0xa5, 0x87, 0xbe, 0x4,  0xb4, 0x4a, 0x86, 0x7e, 0x4f, 0xc3, 0x6d,
      0x6d, 0xf,  0xc5, 0x8,  0x19, 0x25, 0xdc, 0x26, 0x0,  0x9,  0xa7, 0xc2, 0xf4, 0x70, 0xf5, 0x3d, 0xee, 0x11, 0xc9,
      0x0,  0x8,  0xee, 0x44, 0x23, 0x35, 0x53, 0xa0, 0x42, 0xf2, 0x18, 0x0,  0x0,  0x29, 0xe,  0x17, 0x90, 0x1c, 0x0,
      0x18, 0x65, 0xdd, 0x85, 0x93, 0x41, 0x15, 0xb,  0x8b, 0x5c, 0x9d, 0x83, 0x74, 0xd0, 0x43, 0x5f, 0x49, 0xef, 0x1c,
      0x20, 0xe8, 0xa8, 0x5d, 0xb7, 0x51, 0x26, 0x0,  0x4,  0xd8, 0x9,  0xc6, 0xc0, 0x0,  0x19, 0x88, 0x8f, 0xe5, 0xe1,
      0x55, 0xc2, 0x6c, 0x62, 0x25, 0x8d, 0xc8, 0x31, 0x52, 0x60, 0xfe, 0xe1, 0xc0, 0x88, 0x3b, 0x7a, 0x60, 0xd8, 0x43,
      0x67, 0x52, 0x9,  0x0,  0x6,  0xb4, 0xcf, 0xb2, 0x78, 0x2,  0x8e, 0x16, 0x0,  0x1c, 0xf0, 0x11, 0xfe, 0xa2, 0x9b,
      0x30, 0xb4, 0xf3, 0x73, 0xc3, 0xdf, 0x2,  0xb3, 0xa8, 0x95, 0x46, 0xae, 0x96, 0x76, 0x15, 0xbc, 0x88, 0x13, 0xd5,
      0xe2, 0x28, 0x89, 0x52, 0x13, 0x2c, 0xd,  0x28, 0xa2, 0x2a, 0x10, 0x2,  0x0,  0x0,  0x78, 0xdb, 0x15, 0x0,  0xe,
      0x2e, 0xcb, 0x34, 0x96, 0xd,  0x17, 0xd6, 0x92, 0x34, 0xe1, 0xfd, 0x85, 0xd7, 0xdf, 0x23, 0x11, 0x1b, 0x18, 0x0,
      0x0,  0x56, 0xff, 0x29, 0x35, 0x16, 0x0,  0x14, 0xec, 0x3b, 0xe4, 0x24, 0xb0, 0x85, 0x79, 0x5a, 0x67, 0x3,  0x11,
      0xbc, 0xe6, 0x3d, 0xff, 0x6a, 0x49, 0x27, 0x53, 0xc5, 0x17, 0x84, 0x21, 0x42, 0x11, 0x0,  0x11, 0xec, 0xca, 0x3a,
      0xc8, 0xe,  0x19, 0x59, 0x64, 0x91, 0x79, 0x36, 0x3a, 0xab, 0x2d, 0x14, 0x20, 0xc2, 0x0,  0x17, 0xf1, 0x9c, 0xb1,
      0x91, 0x88, 0x13, 0x68, 0xd,  0x80, 0xbb, 0x50, 0xb6, 0xef, 0xad, 0x23, 0x99, 0x79, 0x30, 0x6f, 0x27, 0x9e, 0x47,
      0x95, 0x0,  0x1d, 0x3e, 0x1d, 0x47, 0xa1, 0x4b, 0xce, 0x2c, 0xb7, 0x15, 0x75, 0x7b, 0xef, 0xe3, 0x79, 0xd6, 0xee,
      0xfb, 0x9d, 0x3f, 0x93, 0x21, 0x2c, 0x58, 0x51, 0xb4, 0xb,  0x46, 0xfb, 0x50, 0x0,  0x11, 0xc,  0xc0, 0xd1, 0x37,
      0x87, 0xcd, 0x66, 0x86, 0xb5, 0xaa, 0x29, 0x78, 0x43, 0x57, 0x2e, 0xbe, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x65};
  uint8_t bytesprops0[] = {0x1e, 0x50, 0xf0, 0x7b, 0xf2, 0x8c, 0xd};
  uint8_t bytesprops2[] = {0xde, 0x91, 0x9a, 0xfc, 0x1b, 0xa3, 0x93, 0x98, 0xcb};
  uint8_t bytesprops3[] = {0xa8};
  uint8_t bytesprops5[] = {0x3a, 0xc6, 0xb7, 0xc0, 0xda, 0x61, 0x6c, 0x5b, 0x7f, 0x4e, 0x72, 0xce,
                           0xf5, 0x98, 0xec, 0xc4, 0xc6, 0x6c, 0x97, 0x1a, 0xc3, 0xbc, 0x5f};
  uint8_t bytesprops4[] = {0xed, 0x34, 0x92, 0x7d, 0x13, 0xfc, 0x47, 0x3d, 0x5e, 0x2c,
                           0xf,  0x75, 0x75, 0x84, 0xc4, 0x8f, 0xe9, 0xf0, 0x16};
  uint8_t bytesprops6[] = {0x9c, 0x3e, 0xe, 0x3f, 0xd8, 0x5e, 0x67, 0xc5, 0x92};
  uint8_t bytesprops7[] = {0x7c, 0x3e, 0x88, 0xbb, 0xd6, 0x77, 0x32};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0xee, 0x55, 0xa1, 0x61, 0x76, 0xb2, 0x21, 0x70, 0xaf, 0xc5, 0x5a, 0x7a,
                           0x3c, 0x6,  0x43, 0xa2, 0xd0, 0xb1, 0x1f, 0x1e, 0x17, 0x71, 0x67, 0x31};
  uint8_t bytesprops10[] = {0x19, 0x11, 0xb, 0x6, 0x11, 0xb1, 0xb9, 0xc, 0x2b};
  uint8_t bytesprops12[] = {0xa3, 0x9c, 0xb7, 0x15, 0xc3, 0xc1, 0x7,  0x5d, 0x2f, 0x7c, 0xfd,
                            0xab, 0x1f, 0xbe, 0x5b, 0x20, 0x34, 0xe3, 0xc3, 0xd6, 0x3};
  uint8_t bytesprops11[] = {0x61, 0xb4, 0x55};
  uint8_t bytesprops14[] = {0x40, 0xc2, 0xea, 0xd1, 0x60, 0x84, 0x0, 0x90, 0x54};
  uint8_t bytesprops13[] = {0xf0, 0x97, 0xcd, 0xee, 0x5c, 0x48};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops0}, .v = {1, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5364}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22212}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops4}, .v = {23, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9518}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5171}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30792}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2410}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21813}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30176}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops11}, .v = {21, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops13}, .v = {9, (char*)&bytesprops14}}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc2, 0xf5, 0xfe, 0x7e, 0x77, 0x69, 0x23, 0x8e, 0xd6, 0x83,
                               0xf8, 0x4f, 0xf8, 0xc4, 0xaf, 0x4d, 0x63, 0x6b, 0x33};
  uint8_t byteswillprops1[] = {0xec, 0xab, 0x44, 0xad, 0x43, 0x5d, 0x55, 0xc0};
  uint8_t byteswillprops2[] = {0xdc, 0xf6, 0x99, 0x10, 0xa2, 0x26, 0xd8, 0x4b, 0xe8, 0x78,
                               0x76, 0xae, 0x3b, 0xfe, 0xa5, 0x87, 0xbe, 0x4,  0xb4, 0x4a,
                               0x86, 0x7e, 0x4f, 0xc3, 0x6d, 0x6d, 0xf,  0xc5, 0x8,  0x19};
  uint8_t byteswillprops4[] = {0xee, 0x44, 0x23, 0x35, 0x53, 0xa0, 0x42, 0xf2};
  uint8_t byteswillprops3[] = {0xa7, 0xc2, 0xf4, 0x70, 0xf5, 0x3d, 0xee, 0x11, 0xc9};
  uint8_t byteswillprops5[] = {0x65, 0xdd, 0x85, 0x93, 0x41, 0x15, 0xb,  0x8b, 0x5c, 0x9d, 0x83, 0x74,
                               0xd0, 0x43, 0x5f, 0x49, 0xef, 0x1c, 0x20, 0xe8, 0xa8, 0x5d, 0xb7, 0x51};
  uint8_t byteswillprops7[] = {0x88, 0x8f, 0xe5, 0xe1, 0x55, 0xc2, 0x6c, 0x62, 0x25, 0x8d, 0xc8, 0x31, 0x52,
                               0x60, 0xfe, 0xe1, 0xc0, 0x88, 0x3b, 0x7a, 0x60, 0xd8, 0x43, 0x67, 0x52};
  uint8_t byteswillprops6[] = {0xd8, 0x9, 0xc6, 0xc0};
  uint8_t byteswillprops8[] = {0xb4, 0xcf, 0xb2, 0x78, 0x2, 0x8e};
  uint8_t byteswillprops9[] = {0xf0, 0x11, 0xfe, 0xa2, 0x9b, 0x30, 0xb4, 0xf3, 0x73, 0xc3, 0xdf, 0x2,  0xb3, 0xa8,
                               0x95, 0x46, 0xae, 0x96, 0x76, 0x15, 0xbc, 0x88, 0x13, 0xd5, 0xe2, 0x28, 0x89, 0x52};
  uint8_t byteswillprops10[] = {0x2e, 0xcb, 0x34, 0x96, 0xd, 0x17, 0xd6, 0x92, 0x34, 0xe1, 0xfd, 0x85, 0xd7, 0xdf};
  uint8_t byteswillprops11[] = {0xec, 0x3b, 0xe4, 0x24, 0xb0, 0x85, 0x79, 0x5a, 0x67, 0x3,
                                0x11, 0xbc, 0xe6, 0x3d, 0xff, 0x6a, 0x49, 0x27, 0x53, 0xc5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22229}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops3}, .v = {8, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10510}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops6}, .v = {25, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11277}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30939}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4379}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22271}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16913}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xec, 0xca, 0x3a, 0xc8, 0xe,  0x19, 0x59, 0x64, 0x91,
                                0x79, 0x36, 0x3a, 0xab, 0x2d, 0x14, 0x20, 0xc2};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf1, 0x9c, 0xb1, 0x91, 0x88, 0x13, 0x68, 0xd,  0x80, 0xbb, 0x50, 0xb6,
                                  0xef, 0xad, 0x23, 0x99, 0x79, 0x30, 0x6f, 0x27, 0x9e, 0x47, 0x95};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12883;
  uint8_t client_id_bytes[] = {0xbf, 0xc2, 0x33, 0x88, 0x1d, 0x9, 0xf0};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3e, 0x1d, 0x47, 0xa1, 0x4b, 0xce, 0x2c, 0xb7, 0x15, 0x75, 0x7b, 0xef, 0xe3, 0x79, 0xd6,
                              0xee, 0xfb, 0x9d, 0x3f, 0x93, 0x21, 0x2c, 0x58, 0x51, 0xb4, 0xb,  0x46, 0xfb, 0x50};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc,  0xc0, 0xd1, 0x37, 0x87, 0xcd, 0x66, 0x86, 0xb5,
                              0xaa, 0x29, 0x78, 0x43, 0x57, 0x2e, 0xbe, 0x45};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\148o\200m\186<\174\187@H*\199\199k\241N\207z\181$\235z\253j\134{", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "", _willMsg =
// "U\STX\188\199\130;", _willProps = [PropPayloadFormatIndicator 132,PropServerReference
// "\170\132t\195V",PropPayloadFormatIndicator 178,PropRequestResponseInformation 96,PropServerKeepAlive
// 9172,PropAssignedClientIdentifier "i\192",PropRequestResponseInformation 37,PropMessageExpiryInterval
// 19524,PropSharedSubscriptionAvailable 118,PropWillDelayInterval 17746,PropSubscriptionIdentifierAvailable
// 127,PropSessionExpiryInterval 472,PropResponseInformation
// "\141\250qW\223\253\SUB\252\&4D\170\137\DC3n\b\183\208=\153\236\159\201\159",PropSharedSubscriptionAvailable
// 150,PropWildcardSubscriptionAvailable 221,PropSubscriptionIdentifierAvailable 233,PropResponseTopic
// "",PropSubscriptionIdentifier 13,PropAssignedClientIdentifier
// "FI\195a\235\207\ETBV\146e\ESC\140\DLE\203G\248\175\219\226\&3\238\245\183\249\169\145\DC3",PropRetainAvailable
// 121,PropServerReference "<\174D\171p#\215\&0\252{Hz\218\f5f\185\189\SOH\246?",PropMessageExpiryInterval
// 15394,PropServerKeepAlive 17437,PropAssignedClientIdentifier "q\129\t\232g\vx\DC3\247V2,\240",PropAuthenticationData
// "[\215\255\168\194\203\r\DC39T\145e\207\223\n\154\152",PropContentType
// "7>\218\155\&7\EOT\194?4\219\&9\147^[\208\SI\DC2\ETB\128\a",PropAuthenticationData "\232\244r\172\150\172\202\r"]}),
// _cleanSession = True, _keepAlive = 3904, _connID = "\197#\190r4\236\133\t\SIY\198\226\213\244\145", _properties =
// [PropAssignedClientIdentifier
// "\232\255\&0\209\230;\163\SOH\DC1W\195\245\151\152.k4\199\184\160\SOHK5\253\bs\227\243",PropRetainAvailable
// 233,PropTopicAliasMaximum 12059,PropServerKeepAlive 30416,PropServerReference
// "\STX\233(\186\n\178\236",PropWildcardSubscriptionAvailable 183,PropWillDelayInterval
// 3122,PropRequestProblemInformation 134,PropResponseInformation "\210\191B\190\229\138\&0",PropContentType
// "F|\179y\166H\200>!\175\227\154\151\139\206Z\151\179S\EM\251",PropRequestProblemInformation
// 132,PropResponseInformation "L_\172\207_lX\164\STX4J\236\211!\245\STX[\128\&23\163] ",PropUserProperty "\168"
// "\183T\242\131\181\r\229\191\200\212\252\154\175\\Q\167\\\182\232T\188\n\EOT\130"]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x10, 0xb1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8e, 0xf,  0x40, 0x96, 0x1,  0x12, 0x0,  0x1c, 0xe8,
      0xff, 0x30, 0xd1, 0xe6, 0x3b, 0xa3, 0x1,  0x11, 0x57, 0xc3, 0xf5, 0x97, 0x98, 0x2e, 0x6b, 0x34, 0xc7, 0xb8, 0xa0,
      0x1,  0x4b, 0x35, 0xfd, 0x8,  0x73, 0xe3, 0xf3, 0x25, 0xe9, 0x22, 0x2f, 0x1b, 0x13, 0x76, 0xd0, 0x1c, 0x0,  0x7,
      0x2,  0xe9, 0x28, 0xba, 0xa,  0xb2, 0xec, 0x28, 0xb7, 0x18, 0x0,  0x0,  0xc,  0x32, 0x17, 0x86, 0x1a, 0x0,  0x7,
      0xd2, 0xbf, 0x42, 0xbe, 0xe5, 0x8a, 0x30, 0x3,  0x0,  0x15, 0x46, 0x7c, 0xb3, 0x79, 0xa6, 0x48, 0xc8, 0x3e, 0x21,
      0xaf, 0xe3, 0x9a, 0x97, 0x8b, 0xce, 0x5a, 0x97, 0xb3, 0x53, 0x19, 0xfb, 0x17, 0x84, 0x1a, 0x0,  0x17, 0x4c, 0x5f,
      0xac, 0xcf, 0x5f, 0x6c, 0x58, 0xa4, 0x2,  0x34, 0x4a, 0xec, 0xd3, 0x21, 0xf5, 0x2,  0x5b, 0x80, 0x32, 0x33, 0xa3,
      0x5d, 0x20, 0x26, 0x0,  0x1,  0xa8, 0x0,  0x18, 0xb7, 0x54, 0xf2, 0x83, 0xb5, 0xd,  0xe5, 0xbf, 0xc8, 0xd4, 0xfc,
      0x9a, 0xaf, 0x5c, 0x51, 0xa7, 0x5c, 0xb6, 0xe8, 0x54, 0xbc, 0xa,  0x4,  0x82, 0x0,  0xf,  0xc5, 0x23, 0xbe, 0x72,
      0x34, 0xec, 0x85, 0x9,  0xf,  0x59, 0xc6, 0xe2, 0xd5, 0xf4, 0x91, 0xd6, 0x1,  0x1,  0x84, 0x1c, 0x0,  0x5,  0xaa,
      0x84, 0x74, 0xc3, 0x56, 0x1,  0xb2, 0x19, 0x60, 0x13, 0x23, 0xd4, 0x12, 0x0,  0x2,  0x69, 0xc0, 0x19, 0x25, 0x2,
      0x0,  0x0,  0x4c, 0x44, 0x2a, 0x76, 0x18, 0x0,  0x0,  0x45, 0x52, 0x29, 0x7f, 0x11, 0x0,  0x0,  0x1,  0xd8, 0x1a,
      0x0,  0x17, 0x8d, 0xfa, 0x71, 0x57, 0xdf, 0xfd, 0x1a, 0xfc, 0x34, 0x44, 0xaa, 0x89, 0x13, 0x6e, 0x8,  0xb7, 0xd0,
      0x3d, 0x99, 0xec, 0x9f, 0xc9, 0x9f, 0x2a, 0x96, 0x28, 0xdd, 0x29, 0xe9, 0x8,  0x0,  0x0,  0xb,  0xd,  0x12, 0x0,
      0x1b, 0x46, 0x49, 0xc3, 0x61, 0xeb, 0xcf, 0x17, 0x56, 0x92, 0x65, 0x1b, 0x8c, 0x10, 0xcb, 0x47, 0xf8, 0xaf, 0xdb,
      0xe2, 0x33, 0xee, 0xf5, 0xb7, 0xf9, 0xa9, 0x91, 0x13, 0x25, 0x79, 0x1c, 0x0,  0x15, 0x3c, 0xae, 0x44, 0xab, 0x70,
      0x23, 0xd7, 0x30, 0xfc, 0x7b, 0x48, 0x7a, 0xda, 0xc,  0x35, 0x66, 0xb9, 0xbd, 0x1,  0xf6, 0x3f, 0x2,  0x0,  0x0,
      0x3c, 0x22, 0x13, 0x44, 0x1d, 0x12, 0x0,  0xd,  0x71, 0x81, 0x9,  0xe8, 0x67, 0xb,  0x78, 0x13, 0xf7, 0x56, 0x32,
      0x2c, 0xf0, 0x16, 0x0,  0x11, 0x5b, 0xd7, 0xff, 0xa8, 0xc2, 0xcb, 0xd,  0x13, 0x39, 0x54, 0x91, 0x65, 0xcf, 0xdf,
      0xa,  0x9a, 0x98, 0x3,  0x0,  0x14, 0x37, 0x3e, 0xda, 0x9b, 0x37, 0x4,  0xc2, 0x3f, 0x34, 0xdb, 0x39, 0x93, 0x5e,
      0x5b, 0xd0, 0xf,  0x12, 0x17, 0x80, 0x7,  0x16, 0x0,  0x8,  0xe8, 0xf4, 0x72, 0xac, 0x96, 0xac, 0xca, 0xd,  0x0,
      0x0,  0x0,  0x6,  0x55, 0x2,  0xbc, 0xc7, 0x82, 0x3b, 0x0,  0x1a, 0x94, 0x6f, 0xc8, 0x6d, 0xba, 0x3c, 0xae, 0xbb,
      0x40, 0x48, 0x2a, 0xc7, 0xc7, 0x6b, 0xf1, 0x4e, 0xcf, 0x7a, 0xb5, 0x24, 0xeb, 0x7a, 0xfd, 0x6a, 0x86, 0x7b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe8, 0xff, 0x30, 0xd1, 0xe6, 0x3b, 0xa3, 0x1,  0x11, 0x57, 0xc3, 0xf5, 0x97, 0x98,
                           0x2e, 0x6b, 0x34, 0xc7, 0xb8, 0xa0, 0x1,  0x4b, 0x35, 0xfd, 0x8,  0x73, 0xe3, 0xf3};
  uint8_t bytesprops1[] = {0x2, 0xe9, 0x28, 0xba, 0xa, 0xb2, 0xec};
  uint8_t bytesprops2[] = {0xd2, 0xbf, 0x42, 0xbe, 0xe5, 0x8a, 0x30};
  uint8_t bytesprops3[] = {0x46, 0x7c, 0xb3, 0x79, 0xa6, 0x48, 0xc8, 0x3e, 0x21, 0xaf, 0xe3,
                           0x9a, 0x97, 0x8b, 0xce, 0x5a, 0x97, 0xb3, 0x53, 0x19, 0xfb};
  uint8_t bytesprops4[] = {0x4c, 0x5f, 0xac, 0xcf, 0x5f, 0x6c, 0x58, 0xa4, 0x2,  0x34, 0x4a, 0xec,
                           0xd3, 0x21, 0xf5, 0x2,  0x5b, 0x80, 0x32, 0x33, 0xa3, 0x5d, 0x20};
  uint8_t bytesprops6[] = {0xb7, 0x54, 0xf2, 0x83, 0xb5, 0xd,  0xe5, 0xbf, 0xc8, 0xd4, 0xfc, 0x9a,
                           0xaf, 0x5c, 0x51, 0xa7, 0x5c, 0xb6, 0xe8, 0x54, 0xbc, 0xa,  0x4,  0x82};
  uint8_t bytesprops5[] = {0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12059}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30416}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3122}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops5}, .v = {24, (char*)&bytesprops6}}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xaa, 0x84, 0x74, 0xc3, 0x56};
  uint8_t byteswillprops1[] = {0x69, 0xc0};
  uint8_t byteswillprops2[] = {0x8d, 0xfa, 0x71, 0x57, 0xdf, 0xfd, 0x1a, 0xfc, 0x34, 0x44, 0xaa, 0x89,
                               0x13, 0x6e, 0x8,  0xb7, 0xd0, 0x3d, 0x99, 0xec, 0x9f, 0xc9, 0x9f};
  uint8_t byteswillprops3[] = {0};
  uint8_t byteswillprops4[] = {0x46, 0x49, 0xc3, 0x61, 0xeb, 0xcf, 0x17, 0x56, 0x92, 0x65, 0x1b, 0x8c, 0x10, 0xcb,
                               0x47, 0xf8, 0xaf, 0xdb, 0xe2, 0x33, 0xee, 0xf5, 0xb7, 0xf9, 0xa9, 0x91, 0x13};
  uint8_t byteswillprops5[] = {0x3c, 0xae, 0x44, 0xab, 0x70, 0x23, 0xd7, 0x30, 0xfc, 0x7b, 0x48,
                               0x7a, 0xda, 0xc,  0x35, 0x66, 0xb9, 0xbd, 0x1,  0xf6, 0x3f};
  uint8_t byteswillprops6[] = {0x71, 0x81, 0x9, 0xe8, 0x67, 0xb, 0x78, 0x13, 0xf7, 0x56, 0x32, 0x2c, 0xf0};
  uint8_t byteswillprops7[] = {0x5b, 0xd7, 0xff, 0xa8, 0xc2, 0xcb, 0xd,  0x13, 0x39,
                               0x54, 0x91, 0x65, 0xcf, 0xdf, 0xa,  0x9a, 0x98};
  uint8_t byteswillprops8[] = {0x37, 0x3e, 0xda, 0x9b, 0x37, 0x4, 0xc2, 0x3f, 0x34, 0xdb,
                               0x39, 0x93, 0x5e, 0x5b, 0xd0, 0xf, 0x12, 0x17, 0x80, 0x7};
  uint8_t byteswillprops9[] = {0xe8, 0xf4, 0x72, 0xac, 0x96, 0xac, 0xca, 0xd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9172}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19524}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17746}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 472}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15394}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17437}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&byteswillprops9}}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x55, 0x2, 0xbc, 0xc7, 0x82, 0x3b};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3904;
  uint8_t client_id_bytes[] = {0xc5, 0x23, 0xbe, 0x72, 0x34, 0xec, 0x85, 0x9, 0xf, 0x59, 0xc6, 0xe2, 0xd5, 0xf4, 0x91};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x94, 0x6f, 0xc8, 0x6d, 0xba, 0x3c, 0xae, 0xbb, 0x40, 0x48, 0x2a, 0xc7, 0xc7,
                              0x6b, 0xf1, 0x4e, 0xcf, 0x7a, 0xb5, 0x24, 0xeb, 0x7a, 0xfd, 0x6a, 0x86, 0x7b};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\166@\DEL\142", _willMsg = "\DC3x\226\245Jp\148\STX%\DC1\141\240\169\253\ETXfd\193t^", _willProps
// = [PropSessionExpiryInterval 7530,PropReceiveMaximum 31785,PropMaximumQoS 65,PropRetainAvailable 194,PropTopicAlias
// 21418,PropUserProperty "\224d\226;k\168\171\DC1"
// "i\240\218\201\&0z\254\253\SOHJ\242\163y\179&\vU\153Y\STX&\154\162p\197)b\190\172\164",PropUserProperty
// "6\238\176~7q\238\246\244" "",PropRequestResponseInformation 178,PropTopicAlias
// 12178,PropSubscriptionIdentifierAvailable 60,PropServerKeepAlive 3346,PropRequestProblemInformation
// 21,PropRequestResponseInformation 121,PropReceiveMaximum 12214,PropContentType "P\CAN;\v\185\238I"]}), _cleanSession
// = True, _keepAlive = 24545, _connID = "\183#J\202\157\184-\233Zr\211\247l\185=\182\150\193", _properties =
// [PropMessageExpiryInterval 31631,PropAssignedClientIdentifier
// "\249\225\a\NAK\SI\208\131\134\214\160\183\245\239*'\211eW\230\&2f\196",PropMaximumQoS
// 18,PropAssignedClientIdentifier
// "\252C\255\232\155\"\206\242\174\250\194i\184\184\142-$.",PropSubscriptionIdentifierAvailable
// 222,PropAuthenticationData "n.\154/\a\222m}\161\165\ESC\183[\154\193",PropResponseInformation
// "\199$\GS\CAN\ENQ)J\173\175\&0\vx'\154",PropResponseInformation
// "\184\228G\241\161\230\r+\CAN\132\156",PropRetainAvailable 229,PropWillDelayInterval 21182,PropUserProperty
// "\190\242\161M\185\225\143-\232" "Qdd\252\245\141\203",PropSessionExpiryInterval 9172,PropPayloadFormatIndicator
// 8,PropAuthenticationMethod "(C\164\132S\160AU3\208>p\179\208\SYN,\216M\235\161\DEL",PropSubscriptionIdentifier
// 17,PropReasonString
// "\ETB\179\226_(\215m\183\134\210\160\214\245)n\194j]I\205T\170o&h\192\157,",PropSubscriptionIdentifierAvailable
// 205,PropServerKeepAlive 439,PropResponseTopic
// "\155\204\228y\SUB\224\f\200(\165\189\241\\b9\141\205\239'\ETBV\SUB\DC1\229-\EOT'",PropTopicAlias
// 6588,PropServerKeepAlive 28469,PropReasonString "\220\131\238\SOHh\247\186\184\192%n\ACK",PropWillDelayInterval
// 6420,PropResponseTopic ";",PropReasonString
// "\213]\DC1\215\239B\DC3\139\161\NAK\147\135\ETX\DELL\148\&6#?\144\225\145j\231",PropAuthenticationData
// "I\v\fz$\216\249@\204 -\231\EM",PropMessageExpiryInterval 30414,PropSubscriptionIdentifierAvailable
// 228,PropSharedSubscriptionAvailable 117,PropPayloadFormatIndicator 40]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x10, 0xdb, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x26, 0x5f, 0xe1, 0xbb, 0x2,  0x2,  0x0,  0x0,  0x7b,
      0x8f, 0x12, 0x0,  0x16, 0xf9, 0xe1, 0x7,  0x15, 0xf,  0xd0, 0x83, 0x86, 0xd6, 0xa0, 0xb7, 0xf5, 0xef, 0x2a, 0x27,
      0xd3, 0x65, 0x57, 0xe6, 0x32, 0x66, 0xc4, 0x24, 0x12, 0x12, 0x0,  0x12, 0xfc, 0x43, 0xff, 0xe8, 0x9b, 0x22, 0xce,
      0xf2, 0xae, 0xfa, 0xc2, 0x69, 0xb8, 0xb8, 0x8e, 0x2d, 0x24, 0x2e, 0x29, 0xde, 0x16, 0x0,  0xf,  0x6e, 0x2e, 0x9a,
      0x2f, 0x7,  0xde, 0x6d, 0x7d, 0xa1, 0xa5, 0x1b, 0xb7, 0x5b, 0x9a, 0xc1, 0x1a, 0x0,  0xe,  0xc7, 0x24, 0x1d, 0x18,
      0x5,  0x29, 0x4a, 0xad, 0xaf, 0x30, 0xb,  0x78, 0x27, 0x9a, 0x1a, 0x0,  0xb,  0xb8, 0xe4, 0x47, 0xf1, 0xa1, 0xe6,
      0xd,  0x2b, 0x18, 0x84, 0x9c, 0x25, 0xe5, 0x18, 0x0,  0x0,  0x52, 0xbe, 0x26, 0x0,  0x9,  0xbe, 0xf2, 0xa1, 0x4d,
      0xb9, 0xe1, 0x8f, 0x2d, 0xe8, 0x0,  0x7,  0x51, 0x64, 0x64, 0xfc, 0xf5, 0x8d, 0xcb, 0x11, 0x0,  0x0,  0x23, 0xd4,
      0x1,  0x8,  0x15, 0x0,  0x15, 0x28, 0x43, 0xa4, 0x84, 0x53, 0xa0, 0x41, 0x55, 0x33, 0xd0, 0x3e, 0x70, 0xb3, 0xd0,
      0x16, 0x2c, 0xd8, 0x4d, 0xeb, 0xa1, 0x7f, 0xb,  0x11, 0x1f, 0x0,  0x1c, 0x17, 0xb3, 0xe2, 0x5f, 0x28, 0xd7, 0x6d,
      0xb7, 0x86, 0xd2, 0xa0, 0xd6, 0xf5, 0x29, 0x6e, 0xc2, 0x6a, 0x5d, 0x49, 0xcd, 0x54, 0xaa, 0x6f, 0x26, 0x68, 0xc0,
      0x9d, 0x2c, 0x29, 0xcd, 0x13, 0x1,  0xb7, 0x8,  0x0,  0x1b, 0x9b, 0xcc, 0xe4, 0x79, 0x1a, 0xe0, 0xc,  0xc8, 0x28,
      0xa5, 0xbd, 0xf1, 0x5c, 0x62, 0x39, 0x8d, 0xcd, 0xef, 0x27, 0x17, 0x56, 0x1a, 0x11, 0xe5, 0x2d, 0x4,  0x27, 0x23,
      0x19, 0xbc, 0x13, 0x6f, 0x35, 0x1f, 0x0,  0xc,  0xdc, 0x83, 0xee, 0x1,  0x68, 0xf7, 0xba, 0xb8, 0xc0, 0x25, 0x6e,
      0x6,  0x18, 0x0,  0x0,  0x19, 0x14, 0x8,  0x0,  0x1,  0x3b, 0x1f, 0x0,  0x18, 0xd5, 0x5d, 0x11, 0xd7, 0xef, 0x42,
      0x13, 0x8b, 0xa1, 0x15, 0x93, 0x87, 0x3,  0x7f, 0x4c, 0x94, 0x36, 0x23, 0x3f, 0x90, 0xe1, 0x91, 0x6a, 0xe7, 0x16,
      0x0,  0xd,  0x49, 0xb,  0xc,  0x7a, 0x24, 0xd8, 0xf9, 0x40, 0xcc, 0x20, 0x2d, 0xe7, 0x19, 0x2,  0x0,  0x0,  0x76,
      0xce, 0x29, 0xe4, 0x2a, 0x75, 0x1,  0x28, 0x0,  0x12, 0xb7, 0x23, 0x4a, 0xca, 0x9d, 0xb8, 0x2d, 0xe9, 0x5a, 0x72,
      0xd3, 0xf7, 0x6c, 0xb9, 0x3d, 0xb6, 0x96, 0xc1, 0x63, 0x11, 0x0,  0x0,  0x1d, 0x6a, 0x21, 0x7c, 0x29, 0x24, 0x41,
      0x25, 0xc2, 0x23, 0x53, 0xaa, 0x26, 0x0,  0x8,  0xe0, 0x64, 0xe2, 0x3b, 0x6b, 0xa8, 0xab, 0x11, 0x0,  0x1e, 0x69,
      0xf0, 0xda, 0xc9, 0x30, 0x7a, 0xfe, 0xfd, 0x1,  0x4a, 0xf2, 0xa3, 0x79, 0xb3, 0x26, 0xb,  0x55, 0x99, 0x59, 0x2,
      0x26, 0x9a, 0xa2, 0x70, 0xc5, 0x29, 0x62, 0xbe, 0xac, 0xa4, 0x26, 0x0,  0x9,  0x36, 0xee, 0xb0, 0x7e, 0x37, 0x71,
      0xee, 0xf6, 0xf4, 0x0,  0x0,  0x19, 0xb2, 0x23, 0x2f, 0x92, 0x29, 0x3c, 0x13, 0xd,  0x12, 0x17, 0x15, 0x19, 0x79,
      0x21, 0x2f, 0xb6, 0x3,  0x0,  0x7,  0x50, 0x18, 0x3b, 0xb,  0xb9, 0xee, 0x49, 0x0,  0x4,  0xa6, 0x40, 0x7f, 0x8e,
      0x0,  0x14, 0x13, 0x78, 0xe2, 0xf5, 0x4a, 0x70, 0x94, 0x2,  0x25, 0x11, 0x8d, 0xf0, 0xa9, 0xfd, 0x3,  0x66, 0x64,
      0xc1, 0x74, 0x5e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf9, 0xe1, 0x7,  0x15, 0xf,  0xd0, 0x83, 0x86, 0xd6, 0xa0, 0xb7,
                           0xf5, 0xef, 0x2a, 0x27, 0xd3, 0x65, 0x57, 0xe6, 0x32, 0x66, 0xc4};
  uint8_t bytesprops1[] = {0xfc, 0x43, 0xff, 0xe8, 0x9b, 0x22, 0xce, 0xf2, 0xae,
                           0xfa, 0xc2, 0x69, 0xb8, 0xb8, 0x8e, 0x2d, 0x24, 0x2e};
  uint8_t bytesprops2[] = {0x6e, 0x2e, 0x9a, 0x2f, 0x7, 0xde, 0x6d, 0x7d, 0xa1, 0xa5, 0x1b, 0xb7, 0x5b, 0x9a, 0xc1};
  uint8_t bytesprops3[] = {0xc7, 0x24, 0x1d, 0x18, 0x5, 0x29, 0x4a, 0xad, 0xaf, 0x30, 0xb, 0x78, 0x27, 0x9a};
  uint8_t bytesprops4[] = {0xb8, 0xe4, 0x47, 0xf1, 0xa1, 0xe6, 0xd, 0x2b, 0x18, 0x84, 0x9c};
  uint8_t bytesprops6[] = {0x51, 0x64, 0x64, 0xfc, 0xf5, 0x8d, 0xcb};
  uint8_t bytesprops5[] = {0xbe, 0xf2, 0xa1, 0x4d, 0xb9, 0xe1, 0x8f, 0x2d, 0xe8};
  uint8_t bytesprops7[] = {0x28, 0x43, 0xa4, 0x84, 0x53, 0xa0, 0x41, 0x55, 0x33, 0xd0, 0x3e,
                           0x70, 0xb3, 0xd0, 0x16, 0x2c, 0xd8, 0x4d, 0xeb, 0xa1, 0x7f};
  uint8_t bytesprops8[] = {0x17, 0xb3, 0xe2, 0x5f, 0x28, 0xd7, 0x6d, 0xb7, 0x86, 0xd2, 0xa0, 0xd6, 0xf5, 0x29,
                           0x6e, 0xc2, 0x6a, 0x5d, 0x49, 0xcd, 0x54, 0xaa, 0x6f, 0x26, 0x68, 0xc0, 0x9d, 0x2c};
  uint8_t bytesprops9[] = {0x9b, 0xcc, 0xe4, 0x79, 0x1a, 0xe0, 0xc,  0xc8, 0x28, 0xa5, 0xbd, 0xf1, 0x5c, 0x62,
                           0x39, 0x8d, 0xcd, 0xef, 0x27, 0x17, 0x56, 0x1a, 0x11, 0xe5, 0x2d, 0x4,  0x27};
  uint8_t bytesprops10[] = {0xdc, 0x83, 0xee, 0x1, 0x68, 0xf7, 0xba, 0xb8, 0xc0, 0x25, 0x6e, 0x6};
  uint8_t bytesprops11[] = {0x3b};
  uint8_t bytesprops12[] = {0xd5, 0x5d, 0x11, 0xd7, 0xef, 0x42, 0x13, 0x8b, 0xa1, 0x15, 0x93, 0x87,
                            0x3,  0x7f, 0x4c, 0x94, 0x36, 0x23, 0x3f, 0x90, 0xe1, 0x91, 0x6a, 0xe7};
  uint8_t bytesprops13[] = {0x49, 0xb, 0xc, 0x7a, 0x24, 0xd8, 0xf9, 0x40, 0xcc, 0x20, 0x2d, 0xe7, 0x19};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31631}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21182}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops5}, .v = {7, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9172}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 439}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6588}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28469}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6420}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30414}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 40}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x69, 0xf0, 0xda, 0xc9, 0x30, 0x7a, 0xfe, 0xfd, 0x1,  0x4a,
                               0xf2, 0xa3, 0x79, 0xb3, 0x26, 0xb,  0x55, 0x99, 0x59, 0x2,
                               0x26, 0x9a, 0xa2, 0x70, 0xc5, 0x29, 0x62, 0xbe, 0xac, 0xa4};
  uint8_t byteswillprops0[] = {0xe0, 0x64, 0xe2, 0x3b, 0x6b, 0xa8, 0xab, 0x11};
  uint8_t byteswillprops3[] = {0};
  uint8_t byteswillprops2[] = {0x36, 0xee, 0xb0, 0x7e, 0x37, 0x71, 0xee, 0xf6, 0xf4};
  uint8_t byteswillprops4[] = {0x50, 0x18, 0x3b, 0xb, 0xb9, 0xee, 0x49};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7530}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31785}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21418}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops0}, .v = {30, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops2}, .v = {0, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12178}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3346}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12214}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa6, 0x40, 0x7f, 0x8e};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x13, 0x78, 0xe2, 0xf5, 0x4a, 0x70, 0x94, 0x2,  0x25, 0x11,
                                  0x8d, 0xf0, 0xa9, 0xfd, 0x3,  0x66, 0x64, 0xc1, 0x74, 0x5e};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24545;
  uint8_t client_id_bytes[] = {0xb7, 0x23, 0x4a, 0xca, 0x9d, 0xb8, 0x2d, 0xe9, 0x5a,
                               0x72, 0xd3, 0xf7, 0x6c, 0xb9, 0x3d, 0xb6, 0x96, 0xc1};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\\\143\216", _password = Just "\151\&6\134W]\238P\207\167\&0Z", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "9", _willMsg =
// "]v\243\130\NULm\134'\201\ESCs\176\166\a;\239\EM", _willProps = [PropSharedSubscriptionAvailable 43,PropMaximumQoS
// 74,PropMessageExpiryInterval 14419,PropAssignedClientIdentifier
// "\134\183\136\208\159\DC1M\141\142\DC3\FS\237\155$",PropRetainAvailable 128,PropResponseTopic
// "\206\129\SIY>CI\193\192n\236\&4\226\185#\168@u\CAN\ETB\212\212\225\251\207",PropSessionExpiryInterval
// 24313,PropMaximumQoS 77,PropAssignedClientIdentifier "\206\237\&9\246\213\tt\GS\186H\198k\ETB[",PropMaximumQoS
// 145,PropMessageExpiryInterval 9405,PropSubscriptionIdentifierAvailable 222,PropMaximumPacketSize 705,PropTopicAlias
// 16865]}), _cleanSession = True, _keepAlive = 17718, _connID = "\225qY\140\214\227+/\167\SI7\177", _properties =
// [PropContentType "\229\150\211\156\128\237\250J=\219\181",PropSessionExpiryInterval 21507,PropCorrelationData
// "\215\234ZT\219\251a\DC2lHJ\250\133\243z\132\145T?%\241Y[",PropReceiveMaximum 25812,PropTopicAlias
// 9975,PropPayloadFormatIndicator 188]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0xd8, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x45, 0x36, 0x35, 0x3,  0x0,  0xb,
                   0xe5, 0x96, 0xd3, 0x9c, 0x80, 0xed, 0xfa, 0x4a, 0x3d, 0xdb, 0xb5, 0x11, 0x0,  0x0,  0x54, 0x3,  0x9,
                   0x0,  0x17, 0xd7, 0xea, 0x5a, 0x54, 0xdb, 0xfb, 0x61, 0x12, 0x6c, 0x48, 0x4a, 0xfa, 0x85, 0xf3, 0x7a,
                   0x84, 0x91, 0x54, 0x3f, 0x25, 0xf1, 0x59, 0x5b, 0x21, 0x64, 0xd4, 0x23, 0x26, 0xf7, 0x1,  0xbc, 0x0,
                   0xc,  0xe1, 0x71, 0x59, 0x8c, 0xd6, 0xe3, 0x2b, 0x2f, 0xa7, 0xf,  0x37, 0xb1, 0x61, 0x2a, 0x2b, 0x24,
                   0x4a, 0x2,  0x0,  0x0,  0x38, 0x53, 0x12, 0x0,  0xe,  0x86, 0xb7, 0x88, 0xd0, 0x9f, 0x11, 0x4d, 0x8d,
                   0x8e, 0x13, 0x1c, 0xed, 0x9b, 0x24, 0x25, 0x80, 0x8,  0x0,  0x19, 0xce, 0x81, 0xf,  0x59, 0x3e, 0x43,
                   0x49, 0xc1, 0xc0, 0x6e, 0xec, 0x34, 0xe2, 0xb9, 0x23, 0xa8, 0x40, 0x75, 0x18, 0x17, 0xd4, 0xd4, 0xe1,
                   0xfb, 0xcf, 0x11, 0x0,  0x0,  0x5e, 0xf9, 0x24, 0x4d, 0x12, 0x0,  0xe,  0xce, 0xed, 0x39, 0xf6, 0xd5,
                   0x9,  0x74, 0x1d, 0xba, 0x48, 0xc6, 0x6b, 0x17, 0x5b, 0x24, 0x91, 0x2,  0x0,  0x0,  0x24, 0xbd, 0x29,
                   0xde, 0x27, 0x0,  0x0,  0x2,  0xc1, 0x23, 0x41, 0xe1, 0x0,  0x1,  0x39, 0x0,  0x11, 0x5d, 0x76, 0xf3,
                   0x82, 0x0,  0x6d, 0x86, 0x27, 0xc9, 0x1b, 0x73, 0xb0, 0xa6, 0x7,  0x3b, 0xef, 0x19, 0x0,  0x3,  0x5c,
                   0x8f, 0xd8, 0x0,  0xb,  0x97, 0x36, 0x86, 0x57, 0x5d, 0xee, 0x50, 0xcf, 0xa7, 0x30, 0x5a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe5, 0x96, 0xd3, 0x9c, 0x80, 0xed, 0xfa, 0x4a, 0x3d, 0xdb, 0xb5};
  uint8_t bytesprops1[] = {0xd7, 0xea, 0x5a, 0x54, 0xdb, 0xfb, 0x61, 0x12, 0x6c, 0x48, 0x4a, 0xfa,
                           0x85, 0xf3, 0x7a, 0x84, 0x91, 0x54, 0x3f, 0x25, 0xf1, 0x59, 0x5b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21507}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25812}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9975}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 188}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x86, 0xb7, 0x88, 0xd0, 0x9f, 0x11, 0x4d, 0x8d, 0x8e, 0x13, 0x1c, 0xed, 0x9b, 0x24};
  uint8_t byteswillprops1[] = {0xce, 0x81, 0xf,  0x59, 0x3e, 0x43, 0x49, 0xc1, 0xc0, 0x6e, 0xec, 0x34, 0xe2,
                               0xb9, 0x23, 0xa8, 0x40, 0x75, 0x18, 0x17, 0xd4, 0xd4, 0xe1, 0xfb, 0xcf};
  uint8_t byteswillprops2[] = {0xce, 0xed, 0x39, 0xf6, 0xd5, 0x9, 0x74, 0x1d, 0xba, 0x48, 0xc6, 0x6b, 0x17, 0x5b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14419}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24313}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9405}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 705}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16865}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x39};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5d, 0x76, 0xf3, 0x82, 0x0, 0x6d, 0x86, 0x27, 0xc9,
                                  0x1b, 0x73, 0xb0, 0xa6, 0x7, 0x3b, 0xef, 0x19};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17718;
  uint8_t client_id_bytes[] = {0xe1, 0x71, 0x59, 0x8c, 0xd6, 0xe3, 0x2b, 0x2f, 0xa7, 0xf, 0x37, 0xb1};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5c, 0x8f, 0xd8};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x97, 0x36, 0x86, 0x57, 0x5d, 0xee, 0x50, 0xcf, 0xa7, 0x30, 0x5a};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18112 [("\217\163\ETBT\231\217",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\199}\169\229\237\168.,U\215W4W\211\197\172\&1&\235\203\213",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\225\200[H\253e\NUL\230l[hR\220\215\242\223\175\133\169\231}",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("X",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("D\ACK\181\185\&4\239\235M\227\131\252\255M\176\r\219\180\ETB\217\167\232\190\223\236",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("B)`\234\&1'\221\218\171\ETBd\196\&4\229\170Y\SYN\164y\164b\174E\240",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\165\213\SYN\240\249\ETX\f\225\171\188j\164(\170\190\189\248\223\202",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\182\208\135BB\223",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("7",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x9b, 0x1,  0x46, 0xc0, 0x0,  0x6,  0xd9, 0xa3, 0x17, 0x54, 0xe7, 0xd9, 0x0,  0x0,  0x15,
                   0xc7, 0x7d, 0xa9, 0xe5, 0xed, 0xa8, 0x2e, 0x2c, 0x55, 0xd7, 0x57, 0x34, 0x57, 0xd3, 0xc5, 0xac,
                   0x31, 0x26, 0xeb, 0xcb, 0xd5, 0x0,  0x0,  0x15, 0xe1, 0xc8, 0x5b, 0x48, 0xfd, 0x65, 0x0,  0xe6,
                   0x6c, 0x5b, 0x68, 0x52, 0xdc, 0xd7, 0xf2, 0xdf, 0xaf, 0x85, 0xa9, 0xe7, 0x7d, 0x0,  0x0,  0x1,
                   0x58, 0x1,  0x0,  0x18, 0x44, 0x6,  0xb5, 0xb9, 0x34, 0xef, 0xeb, 0x4d, 0xe3, 0x83, 0xfc, 0xff,
                   0x4d, 0xb0, 0xd,  0xdb, 0xb4, 0x17, 0xd9, 0xa7, 0xe8, 0xbe, 0xdf, 0xec, 0x1,  0x0,  0x18, 0x42,
                   0x29, 0x60, 0xea, 0x31, 0x27, 0xdd, 0xda, 0xab, 0x17, 0x64, 0xc4, 0x34, 0xe5, 0xaa, 0x59, 0x16,
                   0xa4, 0x79, 0xa4, 0x62, 0xae, 0x45, 0xf0, 0x1,  0x0,  0x0,  0x0,  0x0,  0x13, 0xa5, 0xd5, 0x16,
                   0xf0, 0xf9, 0x3,  0xc,  0xe1, 0xab, 0xbc, 0x6a, 0xa4, 0x28, 0xaa, 0xbe, 0xbd, 0xf8, 0xdf, 0xca,
                   0x0,  0x0,  0x6,  0xb6, 0xd0, 0x87, 0x42, 0x42, 0xdf, 0x2,  0x0,  0x1,  0x37, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd9, 0xa3, 0x17, 0x54, 0xe7, 0xd9};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc7, 0x7d, 0xa9, 0xe5, 0xed, 0xa8, 0x2e, 0x2c, 0x55, 0xd7, 0x57,
                                     0x34, 0x57, 0xd3, 0xc5, 0xac, 0x31, 0x26, 0xeb, 0xcb, 0xd5};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe1, 0xc8, 0x5b, 0x48, 0xfd, 0x65, 0x0,  0xe6, 0x6c, 0x5b, 0x68,
                                     0x52, 0xdc, 0xd7, 0xf2, 0xdf, 0xaf, 0x85, 0xa9, 0xe7, 0x7d};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x44, 0x6,  0xb5, 0xb9, 0x34, 0xef, 0xeb, 0x4d, 0xe3, 0x83, 0xfc, 0xff,
                                     0x4d, 0xb0, 0xd,  0xdb, 0xb4, 0x17, 0xd9, 0xa7, 0xe8, 0xbe, 0xdf, 0xec};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x42, 0x29, 0x60, 0xea, 0x31, 0x27, 0xdd, 0xda, 0xab, 0x17, 0x64, 0xc4,
                                     0x34, 0xe5, 0xaa, 0x59, 0x16, 0xa4, 0x79, 0xa4, 0x62, 0xae, 0x45, 0xf0};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa5, 0xd5, 0x16, 0xf0, 0xf9, 0x3,  0xc,  0xe1, 0xab, 0xbc,
                                     0x6a, 0xa4, 0x28, 0xaa, 0xbe, 0xbd, 0xf8, 0xdf, 0xca};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xb6, 0xd0, 0x87, 0x42, 0x42, 0xdf};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x37};
  lwmqtt_string_t topic_filter_s9 = {1, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18112, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8048 [("=\136\230h\216\226(\250c\195\226\174/9",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\216k\253Z\203\ETX\218\SYN&\169m",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x21, 0x1f, 0x70, 0x0,  0xe,  0x3d, 0x88, 0xe6, 0x68, 0xd8, 0xe2,
                   0x28, 0xfa, 0x63, 0xc3, 0xe2, 0xae, 0x2f, 0x39, 0x2,  0x0,  0xb,  0xd8,
                   0x6b, 0xfd, 0x5a, 0xcb, 0x3,  0xda, 0x16, 0x26, 0xa9, 0x6d, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x3d, 0x88, 0xe6, 0x68, 0xd8, 0xe2, 0x28,
                                     0xfa, 0x63, 0xc3, 0xe2, 0xae, 0x2f, 0x39};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd8, 0x6b, 0xfd, 0x5a, 0xcb, 0x3, 0xda, 0x16, 0x26, 0xa9, 0x6d};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8048, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21602 [("\218I\151?\251\157\177r\DC2$\167\179\239",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\DELM\163P3T\138\133=\251\243C\218\218\133`\166",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SYN\189'\252\223\241\r\ENQ?\146.\216n\235jI",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("K$\SYNda\EOT\253\217\190\241p\RS\f\191\f.\252\152\244\DEL\215\RSn\195\EOTyZ\150",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\167",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("c7\142\243",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\155\184\145gf\215\SYN|%",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x72, 0x54, 0x62, 0x0,  0xd,  0xda, 0x49, 0x97, 0x3f, 0xfb, 0x9d, 0xb1, 0x72, 0x12, 0x24, 0xa7,
                   0xb3, 0xef, 0x1,  0x0,  0x11, 0x7f, 0x4d, 0xa3, 0x50, 0x33, 0x54, 0x8a, 0x85, 0x3d, 0xfb, 0xf3, 0x43,
                   0xda, 0xda, 0x85, 0x60, 0xa6, 0x2,  0x0,  0x10, 0x16, 0xbd, 0x27, 0xfc, 0xdf, 0xf1, 0xd,  0x5,  0x3f,
                   0x92, 0x2e, 0xd8, 0x6e, 0xeb, 0x6a, 0x49, 0x0,  0x0,  0x1c, 0x4b, 0x24, 0x16, 0x64, 0x61, 0x4,  0xfd,
                   0xd9, 0xbe, 0xf1, 0x70, 0x1e, 0xc,  0xbf, 0xc,  0x2e, 0xfc, 0x98, 0xf4, 0x7f, 0xd7, 0x1e, 0x6e, 0xc3,
                   0x4,  0x79, 0x5a, 0x96, 0x0,  0x0,  0x1,  0xa7, 0x2,  0x0,  0x0,  0x0,  0x0,  0x4,  0x63, 0x37, 0x8e,
                   0xf3, 0x1,  0x0,  0x9,  0x9b, 0xb8, 0x91, 0x67, 0x66, 0xd7, 0x16, 0x7c, 0x25, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xda, 0x49, 0x97, 0x3f, 0xfb, 0x9d, 0xb1, 0x72, 0x12, 0x24, 0xa7, 0xb3, 0xef};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7f, 0x4d, 0xa3, 0x50, 0x33, 0x54, 0x8a, 0x85, 0x3d,
                                     0xfb, 0xf3, 0x43, 0xda, 0xda, 0x85, 0x60, 0xa6};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x16, 0xbd, 0x27, 0xfc, 0xdf, 0xf1, 0xd,  0x5,
                                     0x3f, 0x92, 0x2e, 0xd8, 0x6e, 0xeb, 0x6a, 0x49};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4b, 0x24, 0x16, 0x64, 0x61, 0x4,  0xfd, 0xd9, 0xbe, 0xf1,
                                     0x70, 0x1e, 0xc,  0xbf, 0xc,  0x2e, 0xfc, 0x98, 0xf4, 0x7f,
                                     0xd7, 0x1e, 0x6e, 0xc3, 0x4,  0x79, 0x5a, 0x96};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7};
  lwmqtt_string_t topic_filter_s4 = {1, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x63, 0x37, 0x8e, 0xf3};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x9b, 0xb8, 0x91, 0x67, 0x66, 0xd7, 0x16, 0x7c, 0x25};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21602, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20894 [("\237B-\128DW\251-\ENQ\236~\v\231",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\235\144\244p\b",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\162\EM\147\205\188{m\242\133S\193\173\220\173H\227m\DC3\251\217\SUB\DC4\184\DC4~\255\a",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\237M\170\&2IG\163",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("N\168\164\212\213\140\SO|b\223\242P\195\226\192\139\128\NUL\SYN8 C",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\ETB\a\246\155\191\141\202\183\152",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x6a, 0x51, 0x9e, 0x0,  0xd,  0xed, 0x42, 0x2d, 0x80, 0x44, 0x57, 0xfb, 0x2d, 0x5,  0xec,
                   0x7e, 0xb,  0xe7, 0x0,  0x0,  0x5,  0xeb, 0x90, 0xf4, 0x70, 0x8,  0x1,  0x0,  0x1b, 0xa2, 0x19,
                   0x93, 0xcd, 0xbc, 0x7b, 0x6d, 0xf2, 0x85, 0x53, 0xc1, 0xad, 0xdc, 0xad, 0x48, 0xe3, 0x6d, 0x13,
                   0xfb, 0xd9, 0x1a, 0x14, 0xb8, 0x14, 0x7e, 0xff, 0x7,  0x1,  0x0,  0x0,  0x2,  0x0,  0x7,  0xed,
                   0x4d, 0xaa, 0x32, 0x49, 0x47, 0xa3, 0x2,  0x0,  0x16, 0x4e, 0xa8, 0xa4, 0xd4, 0xd5, 0x8c, 0xe,
                   0x7c, 0x62, 0xdf, 0xf2, 0x50, 0xc3, 0xe2, 0xc0, 0x8b, 0x80, 0x0,  0x16, 0x38, 0x20, 0x43, 0x1,
                   0x0,  0x9,  0x17, 0x7,  0xf6, 0x9b, 0xbf, 0x8d, 0xca, 0xb7, 0x98, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x42, 0x2d, 0x80, 0x44, 0x57, 0xfb, 0x2d, 0x5, 0xec, 0x7e, 0xb, 0xe7};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xeb, 0x90, 0xf4, 0x70, 0x8};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa2, 0x19, 0x93, 0xcd, 0xbc, 0x7b, 0x6d, 0xf2, 0x85, 0x53, 0xc1, 0xad, 0xdc, 0xad,
                                     0x48, 0xe3, 0x6d, 0x13, 0xfb, 0xd9, 0x1a, 0x14, 0xb8, 0x14, 0x7e, 0xff, 0x7};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xed, 0x4d, 0xaa, 0x32, 0x49, 0x47, 0xa3};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4e, 0xa8, 0xa4, 0xd4, 0xd5, 0x8c, 0xe, 0x7c, 0x62, 0xdf, 0xf2,
                                     0x50, 0xc3, 0xe2, 0xc0, 0x8b, 0x80, 0x0, 0x16, 0x38, 0x20, 0x43};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x17, 0x7, 0xf6, 0x9b, 0xbf, 0x8d, 0xca, 0xb7, 0x98};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20894, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15574
// [("]\129\160\v\144]\DC3^\204\220\DEL\ETX2_\SI\"\197\208\215\196\b\176^\158\233\177\180\164\255",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x22, 0x3c, 0xd6, 0x0,  0x1d, 0x5d, 0x81, 0xa0, 0xb,  0x90, 0x5d,
                   0x13, 0x5e, 0xcc, 0xdc, 0x7f, 0x3,  0x32, 0x5f, 0xf,  0x22, 0xc5, 0xd0,
                   0xd7, 0xc4, 0x8,  0xb0, 0x5e, 0x9e, 0xe9, 0xb1, 0xb4, 0xa4, 0xff, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x5d, 0x81, 0xa0, 0xb,  0x90, 0x5d, 0x13, 0x5e, 0xcc, 0xdc,
                                     0x7f, 0x3,  0x32, 0x5f, 0xf,  0x22, 0xc5, 0xd0, 0xd7, 0xc4,
                                     0x8,  0xb0, 0x5e, 0x9e, 0xe9, 0xb1, 0xb4, 0xa4, 0xff};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15574, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17105 [("\251AO\229\203\204a\247\204\191\DC4\162\204\146JU\160\SUB\157\195",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\155\216\r\EOT\169\SO\224\155n\235\FS\nu\159\142g;\149\246\147E\179]b\231\&8\US/<\FS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("{,\159\154j\185o\n\143m\178\242\207>=R\NAK\247nHl\242\STX\213&oY",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x58, 0x42, 0xd1, 0x0,  0x14, 0xfb, 0x41, 0x4f, 0xe5, 0xcb, 0xcc, 0x61, 0xf7, 0xcc,
                   0xbf, 0x14, 0xa2, 0xcc, 0x92, 0x4a, 0x55, 0xa0, 0x1a, 0x9d, 0xc3, 0x1,  0x0,  0x1e, 0x9b,
                   0xd8, 0xd,  0x4,  0xa9, 0xe,  0xe0, 0x9b, 0x6e, 0xeb, 0x1c, 0xa,  0x75, 0x9f, 0x8e, 0x67,
                   0x3b, 0x95, 0xf6, 0x93, 0x45, 0xb3, 0x5d, 0x62, 0xe7, 0x38, 0x1f, 0x2f, 0x3c, 0x1c, 0x2,
                   0x0,  0x1b, 0x7b, 0x2c, 0x9f, 0x9a, 0x6a, 0xb9, 0x6f, 0xa,  0x8f, 0x6d, 0xb2, 0xf2, 0xcf,
                   0x3e, 0x3d, 0x52, 0x15, 0xf7, 0x6e, 0x48, 0x6c, 0xf2, 0x2,  0xd5, 0x26, 0x6f, 0x59, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xfb, 0x41, 0x4f, 0xe5, 0xcb, 0xcc, 0x61, 0xf7, 0xcc, 0xbf,
                                     0x14, 0xa2, 0xcc, 0x92, 0x4a, 0x55, 0xa0, 0x1a, 0x9d, 0xc3};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9b, 0xd8, 0xd,  0x4,  0xa9, 0xe,  0xe0, 0x9b, 0x6e, 0xeb,
                                     0x1c, 0xa,  0x75, 0x9f, 0x8e, 0x67, 0x3b, 0x95, 0xf6, 0x93,
                                     0x45, 0xb3, 0x5d, 0x62, 0xe7, 0x38, 0x1f, 0x2f, 0x3c, 0x1c};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7b, 0x2c, 0x9f, 0x9a, 0x6a, 0xb9, 0x6f, 0xa,  0x8f, 0x6d, 0xb2, 0xf2, 0xcf, 0x3e,
                                     0x3d, 0x52, 0x15, 0xf7, 0x6e, 0x48, 0x6c, 0xf2, 0x2,  0xd5, 0x26, 0x6f, 0x59};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17105, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26860 [("\\\141\254\CAN\217\DC4\240\244\DELx;\238\SO\168\&6A\223v\163\128",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("t\181>5/\245\f\155\161\184\211",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\STX=\b\150d\219\200\177\178\226D\153\252A\229",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\245\138\fl\228\159\224Bny",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\194t\244\206\158\155>\128\183y\199\173\195\199~F\150;\142\178d",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0x5e, 0x68, 0xec, 0x0,  0x14, 0x5c, 0x8d, 0xfe, 0x18, 0xd9, 0x14, 0xf0, 0xf4, 0x7f, 0x78,
                   0x3b, 0xee, 0xe,  0xa8, 0x36, 0x41, 0xdf, 0x76, 0xa3, 0x80, 0x1,  0x0,  0xb,  0x74, 0xb5, 0x3e,
                   0x35, 0x2f, 0xf5, 0xc,  0x9b, 0xa1, 0xb8, 0xd3, 0x0,  0x0,  0xf,  0x2,  0x3d, 0x8,  0x96, 0x64,
                   0xdb, 0xc8, 0xb1, 0xb2, 0xe2, 0x44, 0x99, 0xfc, 0x41, 0xe5, 0x1,  0x0,  0xa,  0xf5, 0x8a, 0xc,
                   0x6c, 0xe4, 0x9f, 0xe0, 0x42, 0x6e, 0x79, 0x0,  0x0,  0x15, 0xc2, 0x74, 0xf4, 0xce, 0x9e, 0x9b,
                   0x3e, 0x80, 0xb7, 0x79, 0xc7, 0xad, 0xc3, 0xc7, 0x7e, 0x46, 0x96, 0x3b, 0x8e, 0xb2, 0x64, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x5c, 0x8d, 0xfe, 0x18, 0xd9, 0x14, 0xf0, 0xf4, 0x7f, 0x78,
                                     0x3b, 0xee, 0xe,  0xa8, 0x36, 0x41, 0xdf, 0x76, 0xa3, 0x80};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x74, 0xb5, 0x3e, 0x35, 0x2f, 0xf5, 0xc, 0x9b, 0xa1, 0xb8, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2,  0x3d, 0x8,  0x96, 0x64, 0xdb, 0xc8, 0xb1,
                                     0xb2, 0xe2, 0x44, 0x99, 0xfc, 0x41, 0xe5};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf5, 0x8a, 0xc, 0x6c, 0xe4, 0x9f, 0xe0, 0x42, 0x6e, 0x79};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc2, 0x74, 0xf4, 0xce, 0x9e, 0x9b, 0x3e, 0x80, 0xb7, 0x79, 0xc7,
                                     0xad, 0xc3, 0xc7, 0x7e, 0x46, 0x96, 0x3b, 0x8e, 0xb2, 0x64};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26860, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11675 [("n\192\248\255\205<\240\238\SO!\140\179\201",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("o",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\232\ETXX\162\232\228\251b8Y\146c\244\143\247\RS\135",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x2a, 0x2d, 0x9b, 0x0,  0xd,  0x6e, 0xc0, 0xf8, 0xff, 0xcd, 0x3c, 0xf0, 0xee, 0xe,
                   0x21, 0x8c, 0xb3, 0xc9, 0x1,  0x0,  0x1,  0x6f, 0x0,  0x0,  0x11, 0xe8, 0x3,  0x58, 0xa2,
                   0xe8, 0xe4, 0xfb, 0x62, 0x38, 0x59, 0x92, 0x63, 0xf4, 0x8f, 0xf7, 0x1e, 0x87, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x6e, 0xc0, 0xf8, 0xff, 0xcd, 0x3c, 0xf0, 0xee, 0xe, 0x21, 0x8c, 0xb3, 0xc9};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6f};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe8, 0x3,  0x58, 0xa2, 0xe8, 0xe4, 0xfb, 0x62, 0x38,
                                     0x59, 0x92, 0x63, 0xf4, 0x8f, 0xf7, 0x1e, 0x87};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11675, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3007 [("<\ESCJ\DC2V\230\n\158\168\250G%\212R\210V\227\229\134j\165\&3)\146\165\&95",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("_\234\180~!\246(\231}4\200\221\168\191\149\197$0\202\223\&0\150\vE\169\217\189",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS\195\202\227\242t}K9k\EMD\149|\186\ESC~tO\216\200\234",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Nz\DC2\155\&2\182\ETB>)\DC2&?\246\193i`\151\NAK_\US4\DC1\252\234\DC2Z\NUL\a\153",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("@\194TRT
// \178\157\251\225q\SO\181(\194\220\217p",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\206\DLE\241X5E\154\204\CAN\229~hlj{`f1\155y\181\DEL\217;",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\201{}\179\NAK",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("f\t\SYN\165=\225\132\NUL\207\161F\250\237\SOH\195\142\"\148",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\186\ETX[",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\234\250\254\182(\DEL\154mqQ\135K\160MA\174\234\211\145}\187\DC2hn/_",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0xea, 0x1,  0xb,  0xbf, 0x0,  0x1b, 0x3c, 0x1b, 0x4a, 0x12, 0x56, 0xe6, 0xa,  0x9e, 0xa8, 0xfa,
                   0x47, 0x25, 0xd4, 0x52, 0xd2, 0x56, 0xe3, 0xe5, 0x86, 0x6a, 0xa5, 0x33, 0x29, 0x92, 0xa5, 0x39, 0x35,
                   0x0,  0x0,  0x1b, 0x5f, 0xea, 0xb4, 0x7e, 0x21, 0xf6, 0x28, 0xe7, 0x7d, 0x34, 0xc8, 0xdd, 0xa8, 0xbf,
                   0x95, 0xc5, 0x24, 0x30, 0xca, 0xdf, 0x30, 0x96, 0xb,  0x45, 0xa9, 0xd9, 0xbd, 0x0,  0x0,  0x16, 0x1d,
                   0xc3, 0xca, 0xe3, 0xf2, 0x74, 0x7d, 0x4b, 0x39, 0x6b, 0x19, 0x44, 0x95, 0x7c, 0xba, 0x1b, 0x7e, 0x74,
                   0x4f, 0xd8, 0xc8, 0xea, 0x0,  0x0,  0x0,  0x2,  0x0,  0x1d, 0x4e, 0x7a, 0x12, 0x9b, 0x32, 0xb6, 0x17,
                   0x3e, 0x29, 0x12, 0x26, 0x3f, 0xf6, 0xc1, 0x69, 0x60, 0x97, 0x15, 0x5f, 0x1f, 0x34, 0x11, 0xfc, 0xea,
                   0x12, 0x5a, 0x0,  0x7,  0x99, 0x1,  0x0,  0x12, 0x40, 0xc2, 0x54, 0x52, 0x54, 0x20, 0xb2, 0x9d, 0xfb,
                   0xe1, 0x71, 0xe,  0xb5, 0x28, 0xc2, 0xdc, 0xd9, 0x70, 0x1,  0x0,  0x18, 0xce, 0x10, 0xf1, 0x58, 0x35,
                   0x45, 0x9a, 0xcc, 0x18, 0xe5, 0x7e, 0x68, 0x6c, 0x6a, 0x7b, 0x60, 0x66, 0x31, 0x9b, 0x79, 0xb5, 0x7f,
                   0xd9, 0x3b, 0x0,  0x0,  0x5,  0xc9, 0x7b, 0x7d, 0xb3, 0x15, 0x0,  0x0,  0x12, 0x66, 0x9,  0x16, 0xa5,
                   0x3d, 0xe1, 0x84, 0x0,  0xcf, 0xa1, 0x46, 0xfa, 0xed, 0x1,  0xc3, 0x8e, 0x22, 0x94, 0x0,  0x0,  0x3,
                   0xba, 0x3,  0x5b, 0x1,  0x0,  0x1a, 0xea, 0xfa, 0xfe, 0xb6, 0x28, 0x7f, 0x9a, 0x6d, 0x71, 0x51, 0x87,
                   0x4b, 0xa0, 0x4d, 0x41, 0xae, 0xea, 0xd3, 0x91, 0x7d, 0xbb, 0x12, 0x68, 0x6e, 0x2f, 0x5f, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x3c, 0x1b, 0x4a, 0x12, 0x56, 0xe6, 0xa,  0x9e, 0xa8, 0xfa, 0x47, 0x25, 0xd4, 0x52,
                                     0xd2, 0x56, 0xe3, 0xe5, 0x86, 0x6a, 0xa5, 0x33, 0x29, 0x92, 0xa5, 0x39, 0x35};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0xea, 0xb4, 0x7e, 0x21, 0xf6, 0x28, 0xe7, 0x7d, 0x34, 0xc8, 0xdd, 0xa8, 0xbf,
                                     0x95, 0xc5, 0x24, 0x30, 0xca, 0xdf, 0x30, 0x96, 0xb,  0x45, 0xa9, 0xd9, 0xbd};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1d, 0xc3, 0xca, 0xe3, 0xf2, 0x74, 0x7d, 0x4b, 0x39, 0x6b, 0x19,
                                     0x44, 0x95, 0x7c, 0xba, 0x1b, 0x7e, 0x74, 0x4f, 0xd8, 0xc8, 0xea};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4e, 0x7a, 0x12, 0x9b, 0x32, 0xb6, 0x17, 0x3e, 0x29, 0x12,
                                     0x26, 0x3f, 0xf6, 0xc1, 0x69, 0x60, 0x97, 0x15, 0x5f, 0x1f,
                                     0x34, 0x11, 0xfc, 0xea, 0x12, 0x5a, 0x0,  0x7,  0x99};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x40, 0xc2, 0x54, 0x52, 0x54, 0x20, 0xb2, 0x9d, 0xfb,
                                     0xe1, 0x71, 0xe,  0xb5, 0x28, 0xc2, 0xdc, 0xd9, 0x70};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xce, 0x10, 0xf1, 0x58, 0x35, 0x45, 0x9a, 0xcc, 0x18, 0xe5, 0x7e, 0x68,
                                     0x6c, 0x6a, 0x7b, 0x60, 0x66, 0x31, 0x9b, 0x79, 0xb5, 0x7f, 0xd9, 0x3b};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc9, 0x7b, 0x7d, 0xb3, 0x15};
  lwmqtt_string_t topic_filter_s7 = {5, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x66, 0x9,  0x16, 0xa5, 0x3d, 0xe1, 0x84, 0x0,  0xcf,
                                     0xa1, 0x46, 0xfa, 0xed, 0x1,  0xc3, 0x8e, 0x22, 0x94};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xba, 0x3, 0x5b};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xea, 0xfa, 0xfe, 0xb6, 0x28, 0x7f, 0x9a, 0x6d, 0x71, 0x51, 0x87, 0x4b, 0xa0,
                                      0x4d, 0x41, 0xae, 0xea, 0xd3, 0x91, 0x7d, 0xbb, 0x12, 0x68, 0x6e, 0x2f, 0x5f};
  lwmqtt_string_t topic_filter_s10 = {26, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3007, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30616 [("b\GS\215\182QH\USjKr\230\129\142?Q\129UE\243\147n\229\160)\137",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\164\EMyC\254\225\STX33_\EOTAsM\"\DEL\236\&3jy",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("}\159dgE^\200\218v",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\DC2\249\217\184\DEL\147\151g\128\169}\221\168\236~l",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\227\172\EM\147eL\199B
// \USLxP\210\a4as\191\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x6b, 0x77, 0x98, 0x0,  0x19, 0x62, 0x1d, 0xd7, 0xb6, 0x51, 0x48, 0x1f, 0x6a, 0x4b, 0x72,
                   0xe6, 0x81, 0x8e, 0x3f, 0x51, 0x81, 0x55, 0x45, 0xf3, 0x93, 0x6e, 0xe5, 0xa0, 0x29, 0x89, 0x2,
                   0x0,  0x14, 0xa4, 0x19, 0x79, 0x43, 0xfe, 0xe1, 0x2,  0x33, 0x33, 0x5f, 0x4,  0x41, 0x73, 0x4d,
                   0x22, 0x7f, 0xec, 0x33, 0x6a, 0x79, 0x2,  0x0,  0x9,  0x7d, 0x9f, 0x64, 0x67, 0x45, 0x5e, 0xc8,
                   0xda, 0x76, 0x2,  0x0,  0x10, 0x12, 0xf9, 0xd9, 0xb8, 0x7f, 0x93, 0x97, 0x67, 0x80, 0xa9, 0x7d,
                   0xdd, 0xa8, 0xec, 0x7e, 0x6c, 0x1,  0x0,  0x14, 0xe3, 0xac, 0x19, 0x93, 0x65, 0x4c, 0xc7, 0x42,
                   0x20, 0x1f, 0x4c, 0x78, 0x50, 0xd2, 0x7,  0x34, 0x61, 0x73, 0xbf, 0xe8, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x62, 0x1d, 0xd7, 0xb6, 0x51, 0x48, 0x1f, 0x6a, 0x4b, 0x72, 0xe6, 0x81, 0x8e,
                                     0x3f, 0x51, 0x81, 0x55, 0x45, 0xf3, 0x93, 0x6e, 0xe5, 0xa0, 0x29, 0x89};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa4, 0x19, 0x79, 0x43, 0xfe, 0xe1, 0x2,  0x33, 0x33, 0x5f,
                                     0x4,  0x41, 0x73, 0x4d, 0x22, 0x7f, 0xec, 0x33, 0x6a, 0x79};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7d, 0x9f, 0x64, 0x67, 0x45, 0x5e, 0xc8, 0xda, 0x76};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x12, 0xf9, 0xd9, 0xb8, 0x7f, 0x93, 0x97, 0x67,
                                     0x80, 0xa9, 0x7d, 0xdd, 0xa8, 0xec, 0x7e, 0x6c};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe3, 0xac, 0x19, 0x93, 0x65, 0x4c, 0xc7, 0x42, 0x20, 0x1f,
                                     0x4c, 0x78, 0x50, 0xd2, 0x7,  0x34, 0x61, 0x73, 0xbf, 0xe8};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30616, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27910 [("\146\183",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\190\186\217w\248\160\225))",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\178\157\206\191\161S\255!{\198\145\131E2\133W2",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\181\210p\180\241\184\&6\233r\192\145\128\159Q1\210\199",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\DLE5#\237\150\213-\170\158\FS\165\166\EOTJ\249\144T\SOH\158`N\200\168B\EM",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0x57, 0x6d, 0x6,  0x0,  0x2,  0x92, 0xb7, 0x2,  0x0,  0x9,  0xbe, 0xba, 0xd9, 0x77,
                   0xf8, 0xa0, 0xe1, 0x29, 0x29, 0x2,  0x0,  0x11, 0xb2, 0x9d, 0xce, 0xbf, 0xa1, 0x53, 0xff,
                   0x21, 0x7b, 0xc6, 0x91, 0x83, 0x45, 0x32, 0x85, 0x57, 0x32, 0x2,  0x0,  0x11, 0xb5, 0xd2,
                   0x70, 0xb4, 0xf1, 0xb8, 0x36, 0xe9, 0x72, 0xc0, 0x91, 0x80, 0x9f, 0x51, 0x31, 0xd2, 0xc7,
                   0x2,  0x0,  0x19, 0x10, 0x35, 0x23, 0xed, 0x96, 0xd5, 0x2d, 0xaa, 0x9e, 0x1c, 0xa5, 0xa6,
                   0x4,  0x4a, 0xf9, 0x90, 0x54, 0x1,  0x9e, 0x60, 0x4e, 0xc8, 0xa8, 0x42, 0x19, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x92, 0xb7};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbe, 0xba, 0xd9, 0x77, 0xf8, 0xa0, 0xe1, 0x29, 0x29};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb2, 0x9d, 0xce, 0xbf, 0xa1, 0x53, 0xff, 0x21, 0x7b,
                                     0xc6, 0x91, 0x83, 0x45, 0x32, 0x85, 0x57, 0x32};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb5, 0xd2, 0x70, 0xb4, 0xf1, 0xb8, 0x36, 0xe9, 0x72,
                                     0xc0, 0x91, 0x80, 0x9f, 0x51, 0x31, 0xd2, 0xc7};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x10, 0x35, 0x23, 0xed, 0x96, 0xd5, 0x2d, 0xaa, 0x9e, 0x1c, 0xa5, 0xa6, 0x4,
                                     0x4a, 0xf9, 0x90, 0x54, 0x1,  0x9e, 0x60, 0x4e, 0xc8, 0xa8, 0x42, 0x19};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27910, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31365 [("\241\182\221\CAN\nn8\n\144\151\&9\198\NUL<>\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),(".6V",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("N\199\249\DC2\184\STX\149\167\166je\254\207\152\130\210\151\ETB\144\RS\162\130\128\207I\DLE~\162\244<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\162\199}\255V\131",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\215\SOM\234!\158\&7\167\225\183\250\173",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("&\v\205\128\233\230\187\129\181\128S\NUL\222\253\185$*\180i\183",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\135z\215D\NAK\225\197",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("v\236\188\199\GS\206N.\208J\187\188q~\n\173.\199\154\SIQ\215\&7",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("d\128\&5B\227\&7\DC3\221\200",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0x9b, 0x1,  0x7a, 0x85, 0x0,  0x10, 0xf1, 0xb6, 0xdd, 0x18, 0xa,  0x6e, 0x38, 0xa,  0x90,
                   0x97, 0x39, 0xc6, 0x0,  0x3c, 0x3e, 0xd4, 0x0,  0x0,  0x3,  0x2e, 0x36, 0x56, 0x2,  0x0,  0x1e,
                   0x4e, 0xc7, 0xf9, 0x12, 0xb8, 0x2,  0x95, 0xa7, 0xa6, 0x6a, 0x65, 0xfe, 0xcf, 0x98, 0x82, 0xd2,
                   0x97, 0x17, 0x90, 0x1e, 0xa2, 0x82, 0x80, 0xcf, 0x49, 0x10, 0x7e, 0xa2, 0xf4, 0x3c, 0x0,  0x0,
                   0x6,  0xa2, 0xc7, 0x7d, 0xff, 0x56, 0x83, 0x1,  0x0,  0xc,  0xd7, 0xe,  0x4d, 0xea, 0x21, 0x9e,
                   0x37, 0xa7, 0xe1, 0xb7, 0xfa, 0xad, 0x2,  0x0,  0x14, 0x26, 0xb,  0xcd, 0x80, 0xe9, 0xe6, 0xbb,
                   0x81, 0xb5, 0x80, 0x53, 0x0,  0xde, 0xfd, 0xb9, 0x24, 0x2a, 0xb4, 0x69, 0xb7, 0x0,  0x0,  0x7,
                   0x87, 0x7a, 0xd7, 0x44, 0x15, 0xe1, 0xc5, 0x0,  0x0,  0x17, 0x76, 0xec, 0xbc, 0xc7, 0x1d, 0xce,
                   0x4e, 0x2e, 0xd0, 0x4a, 0xbb, 0xbc, 0x71, 0x7e, 0xa,  0xad, 0x2e, 0xc7, 0x9a, 0xf,  0x51, 0xd7,
                   0x37, 0x2,  0x0,  0x9,  0x64, 0x80, 0x35, 0x42, 0xe3, 0x37, 0x13, 0xdd, 0xc8, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xf1, 0xb6, 0xdd, 0x18, 0xa, 0x6e, 0x38, 0xa,
                                     0x90, 0x97, 0x39, 0xc6, 0x0, 0x3c, 0x3e, 0xd4};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2e, 0x36, 0x56};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4e, 0xc7, 0xf9, 0x12, 0xb8, 0x2,  0x95, 0xa7, 0xa6, 0x6a,
                                     0x65, 0xfe, 0xcf, 0x98, 0x82, 0xd2, 0x97, 0x17, 0x90, 0x1e,
                                     0xa2, 0x82, 0x80, 0xcf, 0x49, 0x10, 0x7e, 0xa2, 0xf4, 0x3c};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa2, 0xc7, 0x7d, 0xff, 0x56, 0x83};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd7, 0xe, 0x4d, 0xea, 0x21, 0x9e, 0x37, 0xa7, 0xe1, 0xb7, 0xfa, 0xad};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x26, 0xb, 0xcd, 0x80, 0xe9, 0xe6, 0xbb, 0x81, 0xb5, 0x80,
                                     0x53, 0x0, 0xde, 0xfd, 0xb9, 0x24, 0x2a, 0xb4, 0x69, 0xb7};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x87, 0x7a, 0xd7, 0x44, 0x15, 0xe1, 0xc5};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x76, 0xec, 0xbc, 0xc7, 0x1d, 0xce, 0x4e, 0x2e, 0xd0, 0x4a, 0xbb, 0xbc,
                                     0x71, 0x7e, 0xa,  0xad, 0x2e, 0xc7, 0x9a, 0xf,  0x51, 0xd7, 0x37};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x64, 0x80, 0x35, 0x42, 0xe3, 0x37, 0x13, 0xdd, 0xc8};
  lwmqtt_string_t topic_filter_s8 = {9, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 31365, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3963 [("&\249+\165\255",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0xa, 0xf, 0x7b, 0x0, 0x5, 0x26, 0xf9, 0x2b, 0xa5, 0xff, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x26, 0xf9, 0x2b, 0xa5, 0xff};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3963, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27481 [("\173\187\212\&85\132\164-<\f",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("j\187\191\158GB4
// \150\146\235\244\140\&1\188\t\220\225\SI+O\165\163\DLE'\SI\226\221\181\254",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\210\&5",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("a\169{+\204\189x\GS{`\\\195",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("Q\\\225<Tp\204<>\194\n\180\179d|\208<\202R,\183\137\RSh",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("^\135\131R\219\\\129W@5`^\130\225?\243\200\157",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("Z\177\195\252s\ESCh\253 \b\f6\DC4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\166\138\DC3\154:7\189]-\201p\160\223*R,\224",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("6\EM\165\136\194\149\NULb\236I\138\FS\207\&5qi\206\228\169i\r\252\132R\237",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0xb4, 0x1,  0x6b, 0x59, 0x0,  0xa,  0xad, 0xbb, 0xd4, 0x38, 0x35, 0x84, 0xa4, 0x2d, 0x3c, 0xc,
                   0x1,  0x0,  0x1e, 0x6a, 0xbb, 0xbf, 0x9e, 0x47, 0x42, 0x34, 0x20, 0x96, 0x92, 0xeb, 0xf4, 0x8c, 0x31,
                   0xbc, 0x9,  0xdc, 0xe1, 0xf,  0x2b, 0x4f, 0xa5, 0xa3, 0x10, 0x27, 0xf,  0xe2, 0xdd, 0xb5, 0xfe, 0x2,
                   0x0,  0x2,  0xd2, 0x35, 0x2,  0x0,  0xc,  0x61, 0xa9, 0x7b, 0x2b, 0xcc, 0xbd, 0x78, 0x1d, 0x7b, 0x60,
                   0x5c, 0xc3, 0x0,  0x0,  0x18, 0x51, 0x5c, 0xe1, 0x3c, 0x54, 0x70, 0xcc, 0x3c, 0x3e, 0xc2, 0xa,  0xb4,
                   0xb3, 0x64, 0x7c, 0xd0, 0x3c, 0xca, 0x52, 0x2c, 0xb7, 0x89, 0x1e, 0x68, 0x2,  0x0,  0x12, 0x5e, 0x87,
                   0x83, 0x52, 0xdb, 0x5c, 0x81, 0x57, 0x40, 0x35, 0x60, 0x5e, 0x82, 0xe1, 0x3f, 0xf3, 0xc8, 0x9d, 0x2,
                   0x0,  0xd,  0x5a, 0xb1, 0xc3, 0xfc, 0x73, 0x1b, 0x68, 0xfd, 0x20, 0x8,  0xc,  0x36, 0x14, 0x2,  0x0,
                   0x11, 0xa6, 0x8a, 0x13, 0x9a, 0x3a, 0x37, 0xbd, 0x5d, 0x2d, 0xc9, 0x70, 0xa0, 0xdf, 0x2a, 0x52, 0x2c,
                   0xe0, 0x2,  0x0,  0x19, 0x36, 0x19, 0xa5, 0x88, 0xc2, 0x95, 0x0,  0x62, 0xec, 0x49, 0x8a, 0x1c, 0xcf,
                   0x35, 0x71, 0x69, 0xce, 0xe4, 0xa9, 0x69, 0xd,  0xfc, 0x84, 0x52, 0xed, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xad, 0xbb, 0xd4, 0x38, 0x35, 0x84, 0xa4, 0x2d, 0x3c, 0xc};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0xbb, 0xbf, 0x9e, 0x47, 0x42, 0x34, 0x20, 0x96, 0x92,
                                     0xeb, 0xf4, 0x8c, 0x31, 0xbc, 0x9,  0xdc, 0xe1, 0xf,  0x2b,
                                     0x4f, 0xa5, 0xa3, 0x10, 0x27, 0xf,  0xe2, 0xdd, 0xb5, 0xfe};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd2, 0x35};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x61, 0xa9, 0x7b, 0x2b, 0xcc, 0xbd, 0x78, 0x1d, 0x7b, 0x60, 0x5c, 0xc3};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x51, 0x5c, 0xe1, 0x3c, 0x54, 0x70, 0xcc, 0x3c, 0x3e, 0xc2, 0xa,  0xb4,
                                     0xb3, 0x64, 0x7c, 0xd0, 0x3c, 0xca, 0x52, 0x2c, 0xb7, 0x89, 0x1e, 0x68};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5e, 0x87, 0x83, 0x52, 0xdb, 0x5c, 0x81, 0x57, 0x40,
                                     0x35, 0x60, 0x5e, 0x82, 0xe1, 0x3f, 0xf3, 0xc8, 0x9d};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5a, 0xb1, 0xc3, 0xfc, 0x73, 0x1b, 0x68, 0xfd, 0x20, 0x8, 0xc, 0x36, 0x14};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa6, 0x8a, 0x13, 0x9a, 0x3a, 0x37, 0xbd, 0x5d, 0x2d,
                                     0xc9, 0x70, 0xa0, 0xdf, 0x2a, 0x52, 0x2c, 0xe0};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x36, 0x19, 0xa5, 0x88, 0xc2, 0x95, 0x0,  0x62, 0xec, 0x49, 0x8a, 0x1c, 0xcf,
                                     0x35, 0x71, 0x69, 0xce, 0xe4, 0xa9, 0x69, 0xd,  0xfc, 0x84, 0x52, 0xed};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27481, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32387
// [("\205Yv\244\133\240o\244\240\227\&6\170r\201\GS\177\160\165\236\219\187K\FS\205\151\152",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\164\170z",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0x25, 0x7e, 0x83, 0x0,  0x1a, 0xcd, 0x59, 0x76, 0xf4, 0x85, 0xf0, 0x6f,
                   0xf4, 0xf0, 0xe3, 0x36, 0xaa, 0x72, 0xc9, 0x1d, 0xb1, 0xa0, 0xa5, 0xec, 0xdb,
                   0xbb, 0x4b, 0x1c, 0xcd, 0x97, 0x98, 0x0,  0x0,  0x3,  0xa4, 0xaa, 0x7a, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xcd, 0x59, 0x76, 0xf4, 0x85, 0xf0, 0x6f, 0xf4, 0xf0, 0xe3, 0x36, 0xaa, 0x72,
                                     0xc9, 0x1d, 0xb1, 0xa0, 0xa5, 0xec, 0xdb, 0xbb, 0x4b, 0x1c, 0xcd, 0x97, 0x98};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa4, 0xaa, 0x7a};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32387, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27695 [("\244savN\237\&9\ETB\SUB\239C\CAN\184a\157b\NUL\151u\142\230\r",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("D\153\DC2\SOH",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\SYN\139\192\ETB\205fr\136\n\229V\162C\DC3\130\ENQ\DC1\228\179\196C\192\RS\DEL",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\149\140\bL\128\SI\252T",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS =
// QoS0}),("\164\138\235VW\242\242\a\134\243\168\215tQK\DLE\179\202\207\250A\EM\226\174]\a",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("!W\178\139't\202\166K\r\223\151",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\180\239\139\STX\NULd",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\133\235X3\227\134\248\236\248\231",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\170\153\226",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0x90, 0x1,  0x6c, 0x2f, 0x0,  0x16, 0xf4, 0x73, 0x61, 0x76, 0x4e, 0xed, 0x39, 0x17, 0x1a, 0xef,
                   0x43, 0x18, 0xb8, 0x61, 0x9d, 0x62, 0x0,  0x97, 0x75, 0x8e, 0xe6, 0xd,  0x1,  0x0,  0x4,  0x44, 0x99,
                   0x12, 0x1,  0x0,  0x0,  0x18, 0x16, 0x8b, 0xc0, 0x17, 0xcd, 0x66, 0x72, 0x88, 0xa,  0xe5, 0x56, 0xa2,
                   0x43, 0x13, 0x82, 0x5,  0x11, 0xe4, 0xb3, 0xc4, 0x43, 0xc0, 0x1e, 0x7f, 0x1,  0x0,  0x8,  0x95, 0x8c,
                   0x8,  0x4c, 0x80, 0xf,  0xfc, 0x54, 0x0,  0x0,  0x1a, 0xa4, 0x8a, 0xeb, 0x56, 0x57, 0xf2, 0xf2, 0x7,
                   0x86, 0xf3, 0xa8, 0xd7, 0x74, 0x51, 0x4b, 0x10, 0xb3, 0xca, 0xcf, 0xfa, 0x41, 0x19, 0xe2, 0xae, 0x5d,
                   0x7,  0x2,  0x0,  0xc,  0x21, 0x57, 0xb2, 0x8b, 0x27, 0x74, 0xca, 0xa6, 0x4b, 0xd,  0xdf, 0x97, 0x2,
                   0x0,  0x6,  0xb4, 0xef, 0x8b, 0x2,  0x0,  0x64, 0x1,  0x0,  0xa,  0x85, 0xeb, 0x58, 0x33, 0xe3, 0x86,
                   0xf8, 0xec, 0xf8, 0xe7, 0x0,  0x0,  0x3,  0xaa, 0x99, 0xe2, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0x73, 0x61, 0x76, 0x4e, 0xed, 0x39, 0x17, 0x1a, 0xef, 0x43,
                                     0x18, 0xb8, 0x61, 0x9d, 0x62, 0x0,  0x97, 0x75, 0x8e, 0xe6, 0xd};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x44, 0x99, 0x12, 0x1};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x16, 0x8b, 0xc0, 0x17, 0xcd, 0x66, 0x72, 0x88, 0xa,  0xe5, 0x56, 0xa2,
                                     0x43, 0x13, 0x82, 0x5,  0x11, 0xe4, 0xb3, 0xc4, 0x43, 0xc0, 0x1e, 0x7f};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x95, 0x8c, 0x8, 0x4c, 0x80, 0xf, 0xfc, 0x54};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa4, 0x8a, 0xeb, 0x56, 0x57, 0xf2, 0xf2, 0x7,  0x86, 0xf3, 0xa8, 0xd7, 0x74,
                                     0x51, 0x4b, 0x10, 0xb3, 0xca, 0xcf, 0xfa, 0x41, 0x19, 0xe2, 0xae, 0x5d, 0x7};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x21, 0x57, 0xb2, 0x8b, 0x27, 0x74, 0xca, 0xa6, 0x4b, 0xd, 0xdf, 0x97};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb4, 0xef, 0x8b, 0x2, 0x0, 0x64};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x85, 0xeb, 0x58, 0x33, 0xe3, 0x86, 0xf8, 0xec, 0xf8, 0xe7};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xaa, 0x99, 0xe2};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27695, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29411 [(")\137\189d\189&\250#\214n1\GS\218A\245\158\136\t;\247\175:A\180\233",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\209\DLEs\183`\203\204*\136K\202\223k",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\214?\172zE\154=\DLE\186u!\132\140a\183\249\&3\189\186)\139\SUB",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x47, 0x72, 0xe3, 0x0,  0x19, 0x29, 0x89, 0xbd, 0x64, 0xbd, 0x26, 0xfa, 0x23, 0xd6,
                   0x6e, 0x31, 0x1d, 0xda, 0x41, 0xf5, 0x9e, 0x88, 0x9,  0x3b, 0xf7, 0xaf, 0x3a, 0x41, 0xb4,
                   0xe9, 0x2,  0x0,  0xd,  0xd1, 0x10, 0x73, 0xb7, 0x60, 0xcb, 0xcc, 0x2a, 0x88, 0x4b, 0xca,
                   0xdf, 0x6b, 0x2,  0x0,  0x16, 0xd6, 0x3f, 0xac, 0x7a, 0x45, 0x9a, 0x3d, 0x10, 0xba, 0x75,
                   0x21, 0x84, 0x8c, 0x61, 0xb7, 0xf9, 0x33, 0xbd, 0xba, 0x29, 0x8b, 0x1a, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x29, 0x89, 0xbd, 0x64, 0xbd, 0x26, 0xfa, 0x23, 0xd6, 0x6e, 0x31, 0x1d, 0xda,
                                     0x41, 0xf5, 0x9e, 0x88, 0x9,  0x3b, 0xf7, 0xaf, 0x3a, 0x41, 0xb4, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd1, 0x10, 0x73, 0xb7, 0x60, 0xcb, 0xcc, 0x2a, 0x88, 0x4b, 0xca, 0xdf, 0x6b};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd6, 0x3f, 0xac, 0x7a, 0x45, 0x9a, 0x3d, 0x10, 0xba, 0x75, 0x21,
                                     0x84, 0x8c, 0x61, 0xb7, 0xf9, 0x33, 0xbd, 0xba, 0x29, 0x8b, 0x1a};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29411, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22557 [("#\164A\r\139\STX;\197\SIwh\SYN\201\230\252\196\208K",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\137\185l\EOT\205\r\219\t.\239j\181j,*k\255\SO}L",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("d\196T\247\DC4\198\165\SUB1\a\181\255",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ACK\155R\SYN\217\207\&3\145V\215ws\192\177\184S",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("#\161\214\195\f@H\130\av\155\169\241\157\251\196\231\233\135V\142",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("/\172\STX\DC2\"`\224+\179{\129\239\180\165\221\248\189\133",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\169\228LZ\199^-&\NAKA\f\129\251\EOT]\FS\185h\190Zn6\252\DLE\187\153\170d\148",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\251\166\176\214=\STX\232\&4\248\r\254\\\184(\142\213\SO\140L\217\DC4\221y\202\169\138\206\145\182\192",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\170*\229'\207\130\193\237\139\159>\223\200\200\153\SOH\132\208\190\DC2\153\190\213O\190\DLE.\\y",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0xde, 0x1,  0x58, 0x1d, 0x0,  0x12, 0x23, 0xa4, 0x41, 0xd,  0x8b, 0x2,  0x3b, 0xc5, 0xf,  0x77, 0x68, 0x16,
      0xc9, 0xe6, 0xfc, 0xc4, 0xd0, 0x4b, 0x0,  0x0,  0x14, 0x89, 0xb9, 0x6c, 0x4,  0xcd, 0xd,  0xdb, 0x9,  0x2e, 0xef,
      0x6a, 0xb5, 0x6a, 0x2c, 0x2a, 0x6b, 0xff, 0xe,  0x7d, 0x4c, 0x1,  0x0,  0xc,  0x64, 0xc4, 0x54, 0xf7, 0x14, 0xc6,
      0xa5, 0x1a, 0x31, 0x7,  0xb5, 0xff, 0x2,  0x0,  0x10, 0x6,  0x9b, 0x52, 0x16, 0xd9, 0xcf, 0x33, 0x91, 0x56, 0xd7,
      0x77, 0x73, 0xc0, 0xb1, 0xb8, 0x53, 0x0,  0x0,  0x15, 0x23, 0xa1, 0xd6, 0xc3, 0xc,  0x40, 0x48, 0x82, 0x7,  0x76,
      0x9b, 0xa9, 0xf1, 0x9d, 0xfb, 0xc4, 0xe7, 0xe9, 0x87, 0x56, 0x8e, 0x1,  0x0,  0x12, 0x2f, 0xac, 0x2,  0x12, 0x22,
      0x60, 0xe0, 0x2b, 0xb3, 0x7b, 0x81, 0xef, 0xb4, 0xa5, 0xdd, 0xf8, 0xbd, 0x85, 0x0,  0x0,  0x1d, 0xa9, 0xe4, 0x4c,
      0x5a, 0xc7, 0x5e, 0x2d, 0x26, 0x15, 0x41, 0xc,  0x81, 0xfb, 0x4,  0x5d, 0x1c, 0xb9, 0x68, 0xbe, 0x5a, 0x6e, 0x36,
      0xfc, 0x10, 0xbb, 0x99, 0xaa, 0x64, 0x94, 0x2,  0x0,  0x1e, 0xfb, 0xa6, 0xb0, 0xd6, 0x3d, 0x2,  0xe8, 0x34, 0xf8,
      0xd,  0xfe, 0x5c, 0xb8, 0x28, 0x8e, 0xd5, 0xe,  0x8c, 0x4c, 0xd9, 0x14, 0xdd, 0x79, 0xca, 0xa9, 0x8a, 0xce, 0x91,
      0xb6, 0xc0, 0x2,  0x0,  0x1d, 0xaa, 0x2a, 0xe5, 0x27, 0xcf, 0x82, 0xc1, 0xed, 0x8b, 0x9f, 0x3e, 0xdf, 0xc8, 0xc8,
      0x99, 0x1,  0x84, 0xd0, 0xbe, 0x12, 0x99, 0xbe, 0xd5, 0x4f, 0xbe, 0x10, 0x2e, 0x5c, 0x79, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x23, 0xa4, 0x41, 0xd,  0x8b, 0x2,  0x3b, 0xc5, 0xf,
                                     0x77, 0x68, 0x16, 0xc9, 0xe6, 0xfc, 0xc4, 0xd0, 0x4b};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x89, 0xb9, 0x6c, 0x4,  0xcd, 0xd,  0xdb, 0x9, 0x2e, 0xef,
                                     0x6a, 0xb5, 0x6a, 0x2c, 0x2a, 0x6b, 0xff, 0xe, 0x7d, 0x4c};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x64, 0xc4, 0x54, 0xf7, 0x14, 0xc6, 0xa5, 0x1a, 0x31, 0x7, 0xb5, 0xff};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6,  0x9b, 0x52, 0x16, 0xd9, 0xcf, 0x33, 0x91,
                                     0x56, 0xd7, 0x77, 0x73, 0xc0, 0xb1, 0xb8, 0x53};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x23, 0xa1, 0xd6, 0xc3, 0xc,  0x40, 0x48, 0x82, 0x7,  0x76, 0x9b,
                                     0xa9, 0xf1, 0x9d, 0xfb, 0xc4, 0xe7, 0xe9, 0x87, 0x56, 0x8e};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2f, 0xac, 0x2,  0x12, 0x22, 0x60, 0xe0, 0x2b, 0xb3,
                                     0x7b, 0x81, 0xef, 0xb4, 0xa5, 0xdd, 0xf8, 0xbd, 0x85};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa9, 0xe4, 0x4c, 0x5a, 0xc7, 0x5e, 0x2d, 0x26, 0x15, 0x41,
                                     0xc,  0x81, 0xfb, 0x4,  0x5d, 0x1c, 0xb9, 0x68, 0xbe, 0x5a,
                                     0x6e, 0x36, 0xfc, 0x10, 0xbb, 0x99, 0xaa, 0x64, 0x94};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfb, 0xa6, 0xb0, 0xd6, 0x3d, 0x2,  0xe8, 0x34, 0xf8, 0xd,
                                     0xfe, 0x5c, 0xb8, 0x28, 0x8e, 0xd5, 0xe,  0x8c, 0x4c, 0xd9,
                                     0x14, 0xdd, 0x79, 0xca, 0xa9, 0x8a, 0xce, 0x91, 0xb6, 0xc0};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xaa, 0x2a, 0xe5, 0x27, 0xcf, 0x82, 0xc1, 0xed, 0x8b, 0x9f,
                                     0x3e, 0xdf, 0xc8, 0xc8, 0x99, 0x1,  0x84, 0xd0, 0xbe, 0x12,
                                     0x99, 0xbe, 0xd5, 0x4f, 0xbe, 0x10, 0x2e, 0x5c, 0x79};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22557, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10879 [("k\CAN\STX\230?\231\199\145\130\DLE\182\233W\233\&5F\250\153Hoip\242W\164",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\t\253\178\254a\b\217\143\162\FS\221\238PG\177\229\208*\DEL$k\160O\DLEs`\132\DC2\NAKV",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\216/\149I\232hE\247*RW\244\251\134\204",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\FS9Yu\225\234\246\SOHB>\199#\188\"i\162<\168\185?\219`\237\163\NUL%",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\201\177D\132y\246}ad\135\228\US<H2]V\255\158e\223\255\250",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("=\205o\NAK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\131\207\&6W\195
// gL\178\218\130\152u\209>\t",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\132lyi].N\135g\164se\160\235!n\158\239MqZ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0xba, 0x1,  0x2a, 0x7f, 0x0,  0x19, 0x6b, 0x18, 0x2,  0xe6, 0x3f, 0xe7, 0xc7, 0x91, 0x82, 0x10, 0xb6, 0xe9,
      0x57, 0xe9, 0x35, 0x46, 0xfa, 0x99, 0x48, 0x6f, 0x69, 0x70, 0xf2, 0x57, 0xa4, 0x1,  0x0,  0x1e, 0x9,  0xfd, 0xb2,
      0xfe, 0x61, 0x8,  0xd9, 0x8f, 0xa2, 0x1c, 0xdd, 0xee, 0x50, 0x47, 0xb1, 0xe5, 0xd0, 0x2a, 0x7f, 0x24, 0x6b, 0xa0,
      0x4f, 0x10, 0x73, 0x60, 0x84, 0x12, 0x15, 0x56, 0x0,  0x0,  0xf,  0xd8, 0x2f, 0x95, 0x49, 0xe8, 0x68, 0x45, 0xf7,
      0x2a, 0x52, 0x57, 0xf4, 0xfb, 0x86, 0xcc, 0x0,  0x0,  0x1a, 0x1c, 0x39, 0x59, 0x75, 0xe1, 0xea, 0xf6, 0x1,  0x42,
      0x3e, 0xc7, 0x23, 0xbc, 0x22, 0x69, 0xa2, 0x3c, 0xa8, 0xb9, 0x3f, 0xdb, 0x60, 0xed, 0xa3, 0x0,  0x25, 0x2,  0x0,
      0x17, 0xc9, 0xb1, 0x44, 0x84, 0x79, 0xf6, 0x7d, 0x61, 0x64, 0x87, 0xe4, 0x1f, 0x3c, 0x48, 0x32, 0x5d, 0x56, 0xff,
      0x9e, 0x65, 0xdf, 0xff, 0xfa, 0x1,  0x0,  0x4,  0x3d, 0xcd, 0x6f, 0x15, 0x2,  0x0,  0x10, 0x83, 0xcf, 0x36, 0x57,
      0xc3, 0x20, 0x67, 0x4c, 0xb2, 0xda, 0x82, 0x98, 0x75, 0xd1, 0x3e, 0x9,  0x0,  0x0,  0x15, 0x84, 0x6c, 0x79, 0x69,
      0x5d, 0x2e, 0x4e, 0x87, 0x67, 0xa4, 0x73, 0x65, 0xa0, 0xeb, 0x21, 0x6e, 0x9e, 0xef, 0x4d, 0x71, 0x5a, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0x18, 0x2,  0xe6, 0x3f, 0xe7, 0xc7, 0x91, 0x82, 0x10, 0xb6, 0xe9, 0x57,
                                     0xe9, 0x35, 0x46, 0xfa, 0x99, 0x48, 0x6f, 0x69, 0x70, 0xf2, 0x57, 0xa4};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9,  0xfd, 0xb2, 0xfe, 0x61, 0x8,  0xd9, 0x8f, 0xa2, 0x1c,
                                     0xdd, 0xee, 0x50, 0x47, 0xb1, 0xe5, 0xd0, 0x2a, 0x7f, 0x24,
                                     0x6b, 0xa0, 0x4f, 0x10, 0x73, 0x60, 0x84, 0x12, 0x15, 0x56};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd8, 0x2f, 0x95, 0x49, 0xe8, 0x68, 0x45, 0xf7,
                                     0x2a, 0x52, 0x57, 0xf4, 0xfb, 0x86, 0xcc};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1c, 0x39, 0x59, 0x75, 0xe1, 0xea, 0xf6, 0x1,  0x42, 0x3e, 0xc7, 0x23, 0xbc,
                                     0x22, 0x69, 0xa2, 0x3c, 0xa8, 0xb9, 0x3f, 0xdb, 0x60, 0xed, 0xa3, 0x0,  0x25};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc9, 0xb1, 0x44, 0x84, 0x79, 0xf6, 0x7d, 0x61, 0x64, 0x87, 0xe4, 0x1f,
                                     0x3c, 0x48, 0x32, 0x5d, 0x56, 0xff, 0x9e, 0x65, 0xdf, 0xff, 0xfa};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3d, 0xcd, 0x6f, 0x15};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x83, 0xcf, 0x36, 0x57, 0xc3, 0x20, 0x67, 0x4c,
                                     0xb2, 0xda, 0x82, 0x98, 0x75, 0xd1, 0x3e, 0x9};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x84, 0x6c, 0x79, 0x69, 0x5d, 0x2e, 0x4e, 0x87, 0x67, 0xa4, 0x73,
                                     0x65, 0xa0, 0xeb, 0x21, 0x6e, 0x9e, 0xef, 0x4d, 0x71, 0x5a};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10879, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26713 [("i",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("0\150\163\DC3)S\193\165K\135\211\DC43\159\\/\250+\200MF\149sGs{t\158",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\180+?\143\187\GS",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("s\t\186\187\183\237\241gr\201",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\SYN\179\228\226\252EZ\t\240$\ENQ\239JJq",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("D",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0x51, 0x68, 0x59, 0x0,  0x1,  0x69, 0x2,  0x0,  0x1c, 0x30, 0x96, 0xa3, 0x13, 0x29, 0x53, 0xc1,
                   0xa5, 0x4b, 0x87, 0xd3, 0x14, 0x33, 0x9f, 0x5c, 0x2f, 0xfa, 0x2b, 0xc8, 0x4d, 0x46, 0x95, 0x73, 0x47,
                   0x73, 0x7b, 0x74, 0x9e, 0x1,  0x0,  0x6,  0xb4, 0x2b, 0x3f, 0x8f, 0xbb, 0x1d, 0x0,  0x0,  0xa,  0x73,
                   0x9,  0xba, 0xbb, 0xb7, 0xed, 0xf1, 0x67, 0x72, 0xc9, 0x0,  0x0,  0xf,  0x16, 0xb3, 0xe4, 0xe2, 0xfc,
                   0x45, 0x5a, 0x9,  0xf0, 0x24, 0x5,  0xef, 0x4a, 0x4a, 0x71, 0x1,  0x0,  0x1,  0x44, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x69};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x30, 0x96, 0xa3, 0x13, 0x29, 0x53, 0xc1, 0xa5, 0x4b, 0x87,
                                     0xd3, 0x14, 0x33, 0x9f, 0x5c, 0x2f, 0xfa, 0x2b, 0xc8, 0x4d,
                                     0x46, 0x95, 0x73, 0x47, 0x73, 0x7b, 0x74, 0x9e};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb4, 0x2b, 0x3f, 0x8f, 0xbb, 0x1d};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x73, 0x9, 0xba, 0xbb, 0xb7, 0xed, 0xf1, 0x67, 0x72, 0xc9};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x16, 0xb3, 0xe4, 0xe2, 0xfc, 0x45, 0x5a, 0x9,
                                     0xf0, 0x24, 0x5,  0xef, 0x4a, 0x4a, 0x71};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x44};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26713, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25908 [("\158\154$vc\165\145gf\234i\231\148\155\181",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\RS\209\233$}",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x1c, 0x65, 0x34, 0x0,  0xf,  0x9e, 0x9a, 0x24, 0x76, 0x63, 0xa5, 0x91, 0x67, 0x66,
                   0xea, 0x69, 0xe7, 0x94, 0x9b, 0xb5, 0x2,  0x0,  0x5,  0x1e, 0xd1, 0xe9, 0x24, 0x7d, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x9e, 0x9a, 0x24, 0x76, 0x63, 0xa5, 0x91, 0x67,
                                     0x66, 0xea, 0x69, 0xe7, 0x94, 0x9b, 0xb5};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0xd1, 0xe9, 0x24, 0x7d};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25908, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20578 [("\224\194C\240\225\DC1\DEL\202~\187o\222v\157/\164<\CAN\230;\141",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("m\173}5\SUB\254\SI\157\231",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\r$\DLE9\US*E\226",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x31, 0x50, 0x62, 0x0,  0x15, 0xe0, 0xc2, 0x43, 0xf0, 0xe1, 0x11, 0x7f, 0xca, 0x7e, 0xbb, 0x6f,
                   0xde, 0x76, 0x9d, 0x2f, 0xa4, 0x3c, 0x18, 0xe6, 0x3b, 0x8d, 0x1,  0x0,  0x9,  0x6d, 0xad, 0x7d, 0x35,
                   0x1a, 0xfe, 0xf,  0x9d, 0xe7, 0x2,  0x0,  0x8,  0xd,  0x24, 0x10, 0x39, 0x1f, 0x2a, 0x45, 0xe2, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xe0, 0xc2, 0x43, 0xf0, 0xe1, 0x11, 0x7f, 0xca, 0x7e, 0xbb, 0x6f,
                                     0xde, 0x76, 0x9d, 0x2f, 0xa4, 0x3c, 0x18, 0xe6, 0x3b, 0x8d};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6d, 0xad, 0x7d, 0x35, 0x1a, 0xfe, 0xf, 0x9d, 0xe7};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd, 0x24, 0x10, 0x39, 0x1f, 0x2a, 0x45, 0xe2};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20578, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13418 [("\EM\171z\153z\136\168{\150\208\134\ENQ\134\225\231\CAN}",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0x16, 0x34, 0x6a, 0x0,  0x11, 0x19, 0xab, 0x7a, 0x99, 0x7a, 0x88,
                   0xa8, 0x7b, 0x96, 0xd0, 0x86, 0x5,  0x86, 0xe1, 0xe7, 0x18, 0x7d, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x19, 0xab, 0x7a, 0x99, 0x7a, 0x88, 0xa8, 0x7b, 0x96,
                                     0xd0, 0x86, 0x5,  0x86, 0xe1, 0xe7, 0x18, 0x7d};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13418, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22728 [("\166f3\207\139\210\163\t\187Z#\n\170",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\172\151\200\161\130zE\214\&3\212\199\SIg\129^\tMy",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("G\151j0\232B\192\231\172\a\206\224T\237",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x38, 0x58, 0xc8, 0x0,  0xd,  0xa6, 0x66, 0x33, 0xcf, 0x8b, 0xd2, 0xa3, 0x9,  0xbb,
                   0x5a, 0x23, 0xa,  0xaa, 0x2,  0x0,  0x12, 0xac, 0x97, 0xc8, 0xa1, 0x82, 0x7a, 0x45, 0xd6,
                   0x33, 0xd4, 0xc7, 0xf,  0x67, 0x81, 0x5e, 0x9,  0x4d, 0x79, 0x0,  0x0,  0xe,  0x47, 0x97,
                   0x6a, 0x30, 0xe8, 0x42, 0xc0, 0xe7, 0xac, 0x7,  0xce, 0xe0, 0x54, 0xed, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xa6, 0x66, 0x33, 0xcf, 0x8b, 0xd2, 0xa3, 0x9, 0xbb, 0x5a, 0x23, 0xa, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xac, 0x97, 0xc8, 0xa1, 0x82, 0x7a, 0x45, 0xd6, 0x33,
                                     0xd4, 0xc7, 0xf,  0x67, 0x81, 0x5e, 0x9,  0x4d, 0x79};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x47, 0x97, 0x6a, 0x30, 0xe8, 0x42, 0xc0, 0xe7, 0xac, 0x7, 0xce, 0xe0, 0x54, 0xed};
  lwmqtt_string_t topic_filter_s2 = {14, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22728, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17738 [("\217\130'@BS\183\201\137\SOH\DC4\225o",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x12, 0x45, 0x4a, 0x0,  0xd, 0xd9, 0x82, 0x27, 0x40,
                   0x42, 0x53, 0xb7, 0xc9, 0x89, 0x1, 0x14, 0xe1, 0x6f, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xd9, 0x82, 0x27, 0x40, 0x42, 0x53, 0xb7, 0xc9, 0x89, 0x1, 0x14, 0xe1, 0x6f};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17738, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21727 [("\220\186\EOT'\230\ACK\148x\215=1\233\144*\214{t\159\208X\ENQ\n*n\NAK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("O\nf",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x24, 0x54, 0xdf, 0x0,  0x19, 0xdc, 0xba, 0x4,  0x27, 0xe6, 0x6,  0x94,
                   0x78, 0xd7, 0x3d, 0x31, 0xe9, 0x90, 0x2a, 0xd6, 0x7b, 0x74, 0x9f, 0xd0, 0x58,
                   0x5,  0xa,  0x2a, 0x6e, 0x15, 0x1,  0x0,  0x3,  0x4f, 0xa,  0x66, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xdc, 0xba, 0x4,  0x27, 0xe6, 0x6,  0x94, 0x78, 0xd7, 0x3d, 0x31, 0xe9, 0x90,
                                     0x2a, 0xd6, 0x7b, 0x74, 0x9f, 0xd0, 0x58, 0x5,  0xa,  0x2a, 0x6e, 0x15};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4f, 0xa, 0x66};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21727, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19375 [("\225\165Uj\\\240\190*Vv\135:f)\169i/up&",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\203N\154\STXXt\245\221\238\134 ?=",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SUB\205",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0x2e, 0x4b, 0xaf, 0x0,  0x14, 0xe1, 0xa5, 0x55, 0x6a, 0x5c, 0xf0, 0xbe, 0x2a, 0x56, 0x76,
                   0x87, 0x3a, 0x66, 0x29, 0xa9, 0x69, 0x2f, 0x75, 0x70, 0x26, 0x0,  0x0,  0xd,  0xcb, 0x4e, 0x9a,
                   0x2,  0x58, 0x74, 0xf5, 0xdd, 0xee, 0x86, 0x20, 0x3f, 0x3d, 0x2,  0x0,  0x2,  0x1a, 0xcd, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xe1, 0xa5, 0x55, 0x6a, 0x5c, 0xf0, 0xbe, 0x2a, 0x56, 0x76,
                                     0x87, 0x3a, 0x66, 0x29, 0xa9, 0x69, 0x2f, 0x75, 0x70, 0x26};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcb, 0x4e, 0x9a, 0x2, 0x58, 0x74, 0xf5, 0xdd, 0xee, 0x86, 0x20, 0x3f, 0x3d};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0xcd};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19375, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28027 [("\"g&\184\164\188M\DC4'tW=\211iw\223\142\177\135\221\193\212\ETX\235",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Ef\203H",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("\174\&6\157\194{p\223\202\255Fi\201O\EM}\223\234$\EOTq\SYN\201\182\219\164:\136|x",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("m\t\200\200|++\177\DLE\DC4,\198\195:SP44\161-",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("cW\193\160\232\166\&8@\244
// \"\SI\171\&5Ky\215;\131\US\243c\144\128\214\138",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\174\&7\208h4ML@\STX\167Mp\vQ\232\148\r\254\b\189\132\219}\235\155\131\\,\255",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\219\233",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\139\228'\CAN\224\233y\170z\235\168\b'\237\"\171\177",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0xb1, 0x1,  0x6d, 0x7b, 0x0,  0x18, 0x22, 0x67, 0x26, 0xb8, 0xa4, 0xbc, 0x4d, 0x14, 0x27, 0x74,
                   0x57, 0x3d, 0xd3, 0x69, 0x77, 0xdf, 0x8e, 0xb1, 0x87, 0xdd, 0xc1, 0xd4, 0x3,  0xeb, 0x2,  0x0,  0x4,
                   0x45, 0x66, 0xcb, 0x48, 0x2,  0x0,  0x1d, 0xae, 0x36, 0x9d, 0xc2, 0x7b, 0x70, 0xdf, 0xca, 0xff, 0x46,
                   0x69, 0xc9, 0x4f, 0x19, 0x7d, 0xdf, 0xea, 0x24, 0x4,  0x71, 0x16, 0xc9, 0xb6, 0xdb, 0xa4, 0x3a, 0x88,
                   0x7c, 0x78, 0x2,  0x0,  0x14, 0x6d, 0x9,  0xc8, 0xc8, 0x7c, 0x2b, 0x2b, 0xb1, 0x10, 0x14, 0x2c, 0xc6,
                   0xc3, 0x3a, 0x53, 0x50, 0x34, 0x34, 0xa1, 0x2d, 0x1,  0x0,  0x1a, 0x63, 0x57, 0xc1, 0xa0, 0xe8, 0xa6,
                   0x38, 0x40, 0xf4, 0x20, 0x22, 0xf,  0xab, 0x35, 0x4b, 0x79, 0xd7, 0x3b, 0x83, 0x1f, 0xf3, 0x63, 0x90,
                   0x80, 0xd6, 0x8a, 0x0,  0x0,  0x1d, 0xae, 0x37, 0xd0, 0x68, 0x34, 0x4d, 0x4c, 0x40, 0x2,  0xa7, 0x4d,
                   0x70, 0xb,  0x51, 0xe8, 0x94, 0xd,  0xfe, 0x8,  0xbd, 0x84, 0xdb, 0x7d, 0xeb, 0x9b, 0x83, 0x5c, 0x2c,
                   0xff, 0x0,  0x0,  0x2,  0xdb, 0xe9, 0x1,  0x0,  0x11, 0x8b, 0xe4, 0x27, 0x18, 0xe0, 0xe9, 0x79, 0xaa,
                   0x7a, 0xeb, 0xa8, 0x8,  0x27, 0xed, 0x22, 0xab, 0xb1, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x22, 0x67, 0x26, 0xb8, 0xa4, 0xbc, 0x4d, 0x14, 0x27, 0x74, 0x57, 0x3d,
                                     0xd3, 0x69, 0x77, 0xdf, 0x8e, 0xb1, 0x87, 0xdd, 0xc1, 0xd4, 0x3,  0xeb};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x45, 0x66, 0xcb, 0x48};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xae, 0x36, 0x9d, 0xc2, 0x7b, 0x70, 0xdf, 0xca, 0xff, 0x46,
                                     0x69, 0xc9, 0x4f, 0x19, 0x7d, 0xdf, 0xea, 0x24, 0x4,  0x71,
                                     0x16, 0xc9, 0xb6, 0xdb, 0xa4, 0x3a, 0x88, 0x7c, 0x78};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6d, 0x9,  0xc8, 0xc8, 0x7c, 0x2b, 0x2b, 0xb1, 0x10, 0x14,
                                     0x2c, 0xc6, 0xc3, 0x3a, 0x53, 0x50, 0x34, 0x34, 0xa1, 0x2d};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x63, 0x57, 0xc1, 0xa0, 0xe8, 0xa6, 0x38, 0x40, 0xf4, 0x20, 0x22, 0xf,  0xab,
                                     0x35, 0x4b, 0x79, 0xd7, 0x3b, 0x83, 0x1f, 0xf3, 0x63, 0x90, 0x80, 0xd6, 0x8a};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xae, 0x37, 0xd0, 0x68, 0x34, 0x4d, 0x4c, 0x40, 0x2, 0xa7,
                                     0x4d, 0x70, 0xb,  0x51, 0xe8, 0x94, 0xd,  0xfe, 0x8, 0xbd,
                                     0x84, 0xdb, 0x7d, 0xeb, 0x9b, 0x83, 0x5c, 0x2c, 0xff};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xdb, 0xe9};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x8b, 0xe4, 0x27, 0x18, 0xe0, 0xe9, 0x79, 0xaa, 0x7a,
                                     0xeb, 0xa8, 0x8,  0x27, 0xed, 0x22, 0xab, 0xb1};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28027, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16403 [("36\t\GS\147",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\219(\232\129\147/\NAKI\148\189\191\241l\207\134M;
// \146\255\164\SI\129\251\252g\253\DLE=",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("\178]k\204\209\202\239\157m\227\SI\182M\tft\NUL?\184]}\128\149%\202\234",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(",\249N\129\196\212+ft,\180\v\166\t\164j\DEL\ETB\SYNC\244GIO\203\176\180|\148",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x67, 0x40, 0x13, 0x0,  0x5,  0x33, 0x36, 0x9,  0x1d, 0x93, 0x1,  0x0,  0x1d, 0xdb,
                   0x28, 0xe8, 0x81, 0x93, 0x2f, 0x15, 0x49, 0x94, 0xbd, 0xbf, 0xf1, 0x6c, 0xcf, 0x86, 0x4d,
                   0x3b, 0x20, 0x92, 0xff, 0xa4, 0xf,  0x81, 0xfb, 0xfc, 0x67, 0xfd, 0x10, 0x3d, 0x2,  0x0,
                   0x1a, 0xb2, 0x5d, 0x6b, 0xcc, 0xd1, 0xca, 0xef, 0x9d, 0x6d, 0xe3, 0xf,  0xb6, 0x4d, 0x9,
                   0x66, 0x74, 0x0,  0x3f, 0xb8, 0x5d, 0x7d, 0x80, 0x95, 0x25, 0xca, 0xea, 0x2,  0x0,  0x1d,
                   0x2c, 0xf9, 0x4e, 0x81, 0xc4, 0xd4, 0x2b, 0x66, 0x74, 0x2c, 0xb4, 0xb,  0xa6, 0x9,  0xa4,
                   0x6a, 0x7f, 0x17, 0x16, 0x43, 0xf4, 0x47, 0x49, 0x4f, 0xcb, 0xb0, 0xb4, 0x7c, 0x94, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x33, 0x36, 0x9, 0x1d, 0x93};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdb, 0x28, 0xe8, 0x81, 0x93, 0x2f, 0x15, 0x49, 0x94, 0xbd,
                                     0xbf, 0xf1, 0x6c, 0xcf, 0x86, 0x4d, 0x3b, 0x20, 0x92, 0xff,
                                     0xa4, 0xf,  0x81, 0xfb, 0xfc, 0x67, 0xfd, 0x10, 0x3d};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb2, 0x5d, 0x6b, 0xcc, 0xd1, 0xca, 0xef, 0x9d, 0x6d, 0xe3, 0xf,  0xb6, 0x4d,
                                     0x9,  0x66, 0x74, 0x0,  0x3f, 0xb8, 0x5d, 0x7d, 0x80, 0x95, 0x25, 0xca, 0xea};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2c, 0xf9, 0x4e, 0x81, 0xc4, 0xd4, 0x2b, 0x66, 0x74, 0x2c,
                                     0xb4, 0xb,  0xa6, 0x9,  0xa4, 0x6a, 0x7f, 0x17, 0x16, 0x43,
                                     0xf4, 0x47, 0x49, 0x4f, 0xcb, 0xb0, 0xb4, 0x7c, 0x94};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 16403, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25747 [(":\163i\190\141\188d\208\&4\STX\b\EMn\ETB.y\192\230kO\177\204'\156\206",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\184\200\144sIg\248\r\181<\187\NUL\207\160Y\137I\224\151]U'g[\v\ACKr",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\136\159\161\ETB\151\211$\128E",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("v\ay\rA\210\DC2\243",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("e\174q\139U\145\139
// \140\238i\152?\244\239\ACKBN\248\218\188\238\DELu\EOT\ENQ/",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",\196\144\&6$\US\DC3\212\195n\RS\149\140\204}\235\149\DC2\234\254\f",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("[\241\133m#\240#\175",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x97, 0x1,  0x64, 0x93, 0x0,  0x19, 0x3a, 0xa3, 0x69, 0xbe, 0x8d, 0xbc, 0x64, 0xd0, 0x34,
                   0x2,  0x8,  0x19, 0x6e, 0x17, 0x2e, 0x79, 0xc0, 0xe6, 0x6b, 0x4f, 0xb1, 0xcc, 0x27, 0x9c, 0xce,
                   0x1,  0x0,  0x1b, 0xb8, 0xc8, 0x90, 0x73, 0x49, 0x67, 0xf8, 0xd,  0xb5, 0x3c, 0xbb, 0x0,  0xcf,
                   0xa0, 0x59, 0x89, 0x49, 0xe0, 0x97, 0x5d, 0x55, 0x27, 0x67, 0x5b, 0xb,  0x6,  0x72, 0x0,  0x0,
                   0x0,  0x0,  0x0,  0x9,  0x88, 0x9f, 0xa1, 0x17, 0x97, 0xd3, 0x24, 0x80, 0x45, 0x0,  0x0,  0x8,
                   0x76, 0x7,  0x79, 0xd,  0x41, 0xd2, 0x12, 0xf3, 0x1,  0x0,  0x1b, 0x65, 0xae, 0x71, 0x8b, 0x55,
                   0x91, 0x8b, 0x20, 0x8c, 0xee, 0x69, 0x98, 0x3f, 0xf4, 0xef, 0x6,  0x42, 0x4e, 0xf8, 0xda, 0xbc,
                   0xee, 0x7f, 0x75, 0x4,  0x5,  0x2f, 0x0,  0x0,  0x15, 0x2c, 0xc4, 0x90, 0x36, 0x24, 0x1f, 0x13,
                   0xd4, 0xc3, 0x6e, 0x1e, 0x95, 0x8c, 0xcc, 0x7d, 0xeb, 0x95, 0x12, 0xea, 0xfe, 0xc,  0x0,  0x0,
                   0x8,  0x5b, 0xf1, 0x85, 0x6d, 0x23, 0xf0, 0x23, 0xaf, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x3a, 0xa3, 0x69, 0xbe, 0x8d, 0xbc, 0x64, 0xd0, 0x34, 0x2,  0x8,  0x19, 0x6e,
                                     0x17, 0x2e, 0x79, 0xc0, 0xe6, 0x6b, 0x4f, 0xb1, 0xcc, 0x27, 0x9c, 0xce};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb8, 0xc8, 0x90, 0x73, 0x49, 0x67, 0xf8, 0xd,  0xb5, 0x3c, 0xbb, 0x0, 0xcf, 0xa0,
                                     0x59, 0x89, 0x49, 0xe0, 0x97, 0x5d, 0x55, 0x27, 0x67, 0x5b, 0xb,  0x6, 0x72};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x9f, 0xa1, 0x17, 0x97, 0xd3, 0x24, 0x80, 0x45};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x76, 0x7, 0x79, 0xd, 0x41, 0xd2, 0x12, 0xf3};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x65, 0xae, 0x71, 0x8b, 0x55, 0x91, 0x8b, 0x20, 0x8c, 0xee, 0x69, 0x98, 0x3f, 0xf4,
                                     0xef, 0x6,  0x42, 0x4e, 0xf8, 0xda, 0xbc, 0xee, 0x7f, 0x75, 0x4,  0x5,  0x2f};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2c, 0xc4, 0x90, 0x36, 0x24, 0x1f, 0x13, 0xd4, 0xc3, 0x6e, 0x1e,
                                     0x95, 0x8c, 0xcc, 0x7d, 0xeb, 0x95, 0x12, 0xea, 0xfe, 0xc};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x5b, 0xf1, 0x85, 0x6d, 0x23, 0xf0, 0x23, 0xaf};
  lwmqtt_string_t topic_filter_s7 = {8, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25747, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18112 [("\217\163\ETBT\231\217",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = True, _noLocal = False, _subQoS = QoS0}),("\199}\169\229\237\168.,U\215W4W\211\197\172\&1&\235\203\213",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\225\200[H\253e\NUL\230l[hR\220\215\242\223\175\133\169\231}",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("X",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("D\ACK\181\185\&4\239\235M\227\131\252\255M\176\r\219\180\ETB\217\167\232\190\223\236",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("B)`\234\&1'\221\218\171\ETBd\196\&4\229\170Y\SYN\164y\164b\174E\240",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\165\213\SYN\240\249\ETX\f\225\171\188j\164(\170\190\189\248\223\202",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\182\208\135BB\223",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("7",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0})] [PropResponseTopic "\185\135'\a\a7w\240)%\STX\159&m\206\&0\166\244\143l\211\NAK.&H",PropContentType
// "%J\151\213\176\av\128\232\176\217\185\193\172\144\128\243\SI\241(FXa\187\232\155{",PropAuthenticationData
// "o\RS\157\ENQ7\219M>\246W\239\223&\183|yIe\202\130",PropAuthenticationMethod "\RS0[",PropMessageExpiryInterval
// 28857,PropMaximumQoS 254,PropWildcardSubscriptionAvailable 30,PropRetainAvailable 142,PropResponseInformation
// "`\229\&7\140\135\136\158\155\167",PropTopicAliasMaximum 26525,PropWildcardSubscriptionAvailable
// 230,PropRetainAvailable 219,PropResponseInformation "\162\SOH\231\175#k\213x\144\r",PropTopicAlias
// 21056,PropWillDelayInterval 27038,PropSessionExpiryInterval 11270,PropSharedSubscriptionAvailable
// 235,PropMessageExpiryInterval 22008,PropResponseInformation "3\193\168\DLE\137\220\135",PropRequestProblemInformation
// 36,PropResponseTopic "\158$\182g5\191\210\129^u\139\168\240KN\194n\NUL?]_\SUBQE\189p\240%\218",PropMaximumQoS
// 194,PropMaximumPacketSize 20583,PropSessionExpiryInterval 24442,PropWillDelayInterval
// 23910,PropWildcardSubscriptionAvailable 159,PropServerReference
// "\211\189#27\227\ETB4-,0\153$\190\200\216\ETX\173q\ETB\203v=",PropSharedSubscriptionAvailable
// 104,PropMaximumPacketSize 10426,PropReasonString
// "=\172N\203;\246v\211\130Y\182\162d\228\254\&5\b\216\133\179\153\223"]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x82, 0xac, 0x3,  0x46, 0xc0, 0x8f, 0x2,  0x8,  0x0,  0x19, 0xb9, 0x87, 0x27, 0x7,  0x7,  0x37, 0x77, 0xf0, 0x29,
      0x25, 0x2,  0x9f, 0x26, 0x6d, 0xce, 0x30, 0xa6, 0xf4, 0x8f, 0x6c, 0xd3, 0x15, 0x2e, 0x26, 0x48, 0x3,  0x0,  0x1b,
      0x25, 0x4a, 0x97, 0xd5, 0xb0, 0x7,  0x76, 0x80, 0xe8, 0xb0, 0xd9, 0xb9, 0xc1, 0xac, 0x90, 0x80, 0xf3, 0xf,  0xf1,
      0x28, 0x46, 0x58, 0x61, 0xbb, 0xe8, 0x9b, 0x7b, 0x16, 0x0,  0x14, 0x6f, 0x1e, 0x9d, 0x5,  0x37, 0xdb, 0x4d, 0x3e,
      0xf6, 0x57, 0xef, 0xdf, 0x26, 0xb7, 0x7c, 0x79, 0x49, 0x65, 0xca, 0x82, 0x15, 0x0,  0x3,  0x1e, 0x30, 0x5b, 0x2,
      0x0,  0x0,  0x70, 0xb9, 0x24, 0xfe, 0x28, 0x1e, 0x25, 0x8e, 0x1a, 0x0,  0x9,  0x60, 0xe5, 0x37, 0x8c, 0x87, 0x88,
      0x9e, 0x9b, 0xa7, 0x22, 0x67, 0x9d, 0x28, 0xe6, 0x25, 0xdb, 0x1a, 0x0,  0xa,  0xa2, 0x1,  0xe7, 0xaf, 0x23, 0x6b,
      0xd5, 0x78, 0x90, 0xd,  0x23, 0x52, 0x40, 0x18, 0x0,  0x0,  0x69, 0x9e, 0x11, 0x0,  0x0,  0x2c, 0x6,  0x2a, 0xeb,
      0x2,  0x0,  0x0,  0x55, 0xf8, 0x1a, 0x0,  0x7,  0x33, 0xc1, 0xa8, 0x10, 0x89, 0xdc, 0x87, 0x17, 0x24, 0x8,  0x0,
      0x1d, 0x9e, 0x24, 0xb6, 0x67, 0x35, 0xbf, 0xd2, 0x81, 0x5e, 0x75, 0x8b, 0xa8, 0xf0, 0x4b, 0x4e, 0xc2, 0x6e, 0x0,
      0x3f, 0x5d, 0x5f, 0x1a, 0x51, 0x45, 0xbd, 0x70, 0xf0, 0x25, 0xda, 0x24, 0xc2, 0x27, 0x0,  0x0,  0x50, 0x67, 0x11,
      0x0,  0x0,  0x5f, 0x7a, 0x18, 0x0,  0x0,  0x5d, 0x66, 0x28, 0x9f, 0x1c, 0x0,  0x17, 0xd3, 0xbd, 0x23, 0x32, 0x37,
      0xe3, 0x17, 0x34, 0x2d, 0x2c, 0x30, 0x99, 0x24, 0xbe, 0xc8, 0xd8, 0x3,  0xad, 0x71, 0x17, 0xcb, 0x76, 0x3d, 0x2a,
      0x68, 0x27, 0x0,  0x0,  0x28, 0xba, 0x1f, 0x0,  0x16, 0x3d, 0xac, 0x4e, 0xcb, 0x3b, 0xf6, 0x76, 0xd3, 0x82, 0x59,
      0xb6, 0xa2, 0x64, 0xe4, 0xfe, 0x35, 0x8,  0xd8, 0x85, 0xb3, 0x99, 0xdf, 0x0,  0x6,  0xd9, 0xa3, 0x17, 0x54, 0xe7,
      0xd9, 0x18, 0x0,  0x15, 0xc7, 0x7d, 0xa9, 0xe5, 0xed, 0xa8, 0x2e, 0x2c, 0x55, 0xd7, 0x57, 0x34, 0x57, 0xd3, 0xc5,
      0xac, 0x31, 0x26, 0xeb, 0xcb, 0xd5, 0x2c, 0x0,  0x15, 0xe1, 0xc8, 0x5b, 0x48, 0xfd, 0x65, 0x0,  0xe6, 0x6c, 0x5b,
      0x68, 0x52, 0xdc, 0xd7, 0xf2, 0xdf, 0xaf, 0x85, 0xa9, 0xe7, 0x7d, 0xc,  0x0,  0x1,  0x58, 0x9,  0x0,  0x18, 0x44,
      0x6,  0xb5, 0xb9, 0x34, 0xef, 0xeb, 0x4d, 0xe3, 0x83, 0xfc, 0xff, 0x4d, 0xb0, 0xd,  0xdb, 0xb4, 0x17, 0xd9, 0xa7,
      0xe8, 0xbe, 0xdf, 0xec, 0x5,  0x0,  0x18, 0x42, 0x29, 0x60, 0xea, 0x31, 0x27, 0xdd, 0xda, 0xab, 0x17, 0x64, 0xc4,
      0x34, 0xe5, 0xaa, 0x59, 0x16, 0xa4, 0x79, 0xa4, 0x62, 0xae, 0x45, 0xf0, 0x2d, 0x0,  0x0,  0x10, 0x0,  0x13, 0xa5,
      0xd5, 0x16, 0xf0, 0xf9, 0x3,  0xc,  0xe1, 0xab, 0xbc, 0x6a, 0xa4, 0x28, 0xaa, 0xbe, 0xbd, 0xf8, 0xdf, 0xca, 0x4,
      0x0,  0x6,  0xb6, 0xd0, 0x87, 0x42, 0x42, 0xdf, 0x26, 0x0,  0x1,  0x37, 0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd9, 0xa3, 0x17, 0x54, 0xe7, 0xd9};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc7, 0x7d, 0xa9, 0xe5, 0xed, 0xa8, 0x2e, 0x2c, 0x55, 0xd7, 0x57,
                                     0x34, 0x57, 0xd3, 0xc5, 0xac, 0x31, 0x26, 0xeb, 0xcb, 0xd5};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe1, 0xc8, 0x5b, 0x48, 0xfd, 0x65, 0x0,  0xe6, 0x6c, 0x5b, 0x68,
                                     0x52, 0xdc, 0xd7, 0xf2, 0xdf, 0xaf, 0x85, 0xa9, 0xe7, 0x7d};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x44, 0x6,  0xb5, 0xb9, 0x34, 0xef, 0xeb, 0x4d, 0xe3, 0x83, 0xfc, 0xff,
                                     0x4d, 0xb0, 0xd,  0xdb, 0xb4, 0x17, 0xd9, 0xa7, 0xe8, 0xbe, 0xdf, 0xec};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x42, 0x29, 0x60, 0xea, 0x31, 0x27, 0xdd, 0xda, 0xab, 0x17, 0x64, 0xc4,
                                     0x34, 0xe5, 0xaa, 0x59, 0x16, 0xa4, 0x79, 0xa4, 0x62, 0xae, 0x45, 0xf0};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa5, 0xd5, 0x16, 0xf0, 0xf9, 0x3,  0xc,  0xe1, 0xab, 0xbc,
                                     0x6a, 0xa4, 0x28, 0xaa, 0xbe, 0xbd, 0xf8, 0xdf, 0xca};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xb6, 0xd0, 0x87, 0x42, 0x42, 0xdf};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x37};
  lwmqtt_string_t topic_filter_s9 = {1, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = true;
  uint8_t bytesprops0[] = {0xb9, 0x87, 0x27, 0x7,  0x7,  0x37, 0x77, 0xf0, 0x29, 0x25, 0x2,  0x9f, 0x26,
                           0x6d, 0xce, 0x30, 0xa6, 0xf4, 0x8f, 0x6c, 0xd3, 0x15, 0x2e, 0x26, 0x48};
  uint8_t bytesprops1[] = {0x25, 0x4a, 0x97, 0xd5, 0xb0, 0x7,  0x76, 0x80, 0xe8, 0xb0, 0xd9, 0xb9, 0xc1, 0xac,
                           0x90, 0x80, 0xf3, 0xf,  0xf1, 0x28, 0x46, 0x58, 0x61, 0xbb, 0xe8, 0x9b, 0x7b};
  uint8_t bytesprops2[] = {0x6f, 0x1e, 0x9d, 0x5,  0x37, 0xdb, 0x4d, 0x3e, 0xf6, 0x57,
                           0xef, 0xdf, 0x26, 0xb7, 0x7c, 0x79, 0x49, 0x65, 0xca, 0x82};
  uint8_t bytesprops3[] = {0x1e, 0x30, 0x5b};
  uint8_t bytesprops4[] = {0x60, 0xe5, 0x37, 0x8c, 0x87, 0x88, 0x9e, 0x9b, 0xa7};
  uint8_t bytesprops5[] = {0xa2, 0x1, 0xe7, 0xaf, 0x23, 0x6b, 0xd5, 0x78, 0x90, 0xd};
  uint8_t bytesprops6[] = {0x33, 0xc1, 0xa8, 0x10, 0x89, 0xdc, 0x87};
  uint8_t bytesprops7[] = {0x9e, 0x24, 0xb6, 0x67, 0x35, 0xbf, 0xd2, 0x81, 0x5e, 0x75, 0x8b, 0xa8, 0xf0, 0x4b, 0x4e,
                           0xc2, 0x6e, 0x0,  0x3f, 0x5d, 0x5f, 0x1a, 0x51, 0x45, 0xbd, 0x70, 0xf0, 0x25, 0xda};
  uint8_t bytesprops8[] = {0xd3, 0xbd, 0x23, 0x32, 0x37, 0xe3, 0x17, 0x34, 0x2d, 0x2c, 0x30, 0x99,
                           0x24, 0xbe, 0xc8, 0xd8, 0x3,  0xad, 0x71, 0x17, 0xcb, 0x76, 0x3d};
  uint8_t bytesprops9[] = {0x3d, 0xac, 0x4e, 0xcb, 0x3b, 0xf6, 0x76, 0xd3, 0x82, 0x59, 0xb6,
                           0xa2, 0x64, 0xe4, 0xfe, 0x35, 0x8,  0xd8, 0x85, 0xb3, 0x99, 0xdf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28857}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26525}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21056}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27038}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11270}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22008}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20583}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24442}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23910}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10426}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18112, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8048 [("=\136\230h\216\226(\250c\195\226\174/9",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\216k\253Z\203\ETX\218\SYN&\169m",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})]
// [PropSharedSubscriptionAvailable 45,PropMaximumPacketSize 3495,PropRetainAvailable 129,PropTopicAliasMaximum
// 16323,PropSubscriptionIdentifierAvailable 118,PropContentType "\EMr\219\211\237\200A\140oe",PropTopicAlias 12732]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x40, 0x1f, 0x70, 0x1e, 0x2a, 0x2d, 0x27, 0x0,  0x0,  0xd,  0xa7, 0x25, 0x81, 0x22, 0x3f, 0xc3,
                   0x29, 0x76, 0x3,  0x0,  0xa,  0x19, 0x72, 0xdb, 0xd3, 0xed, 0xc8, 0x41, 0x8c, 0x6f, 0x65, 0x23, 0x31,
                   0xbc, 0x0,  0xe,  0x3d, 0x88, 0xe6, 0x68, 0xd8, 0xe2, 0x28, 0xfa, 0x63, 0xc3, 0xe2, 0xae, 0x2f, 0x39,
                   0x22, 0x0,  0xb,  0xd8, 0x6b, 0xfd, 0x5a, 0xcb, 0x3,  0xda, 0x16, 0x26, 0xa9, 0x6d, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x3d, 0x88, 0xe6, 0x68, 0xd8, 0xe2, 0x28,
                                     0xfa, 0x63, 0xc3, 0xe2, 0xae, 0x2f, 0x39};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd8, 0x6b, 0xfd, 0x5a, 0xcb, 0x3, 0xda, 0x16, 0x26, 0xa9, 0x6d};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0x19, 0x72, 0xdb, 0xd3, 0xed, 0xc8, 0x41, 0x8c, 0x6f, 0x65};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3495}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16323}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12732}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8048, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21602 [("\218I\151?\251\157\177r\DC2$\167\179\239",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\DELM\163P3T\138\133=\251\243C\218\218\133`\166",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SYN\189'\252\223\241\r\ENQ?\146.\216n\235jI",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("K$\SYNda\EOT\253\217\190\241p\RS\f\191\f.\252\152\244\DEL\215\RSn\195\EOTyZ\150",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\167",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("c7\142\243",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS1}),("\155\184\145gf\215\SYN|%",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x73, 0x54, 0x62, 0x0,  0x0,  0xd,  0xda, 0x49, 0x97, 0x3f, 0xfb, 0x9d, 0xb1, 0x72, 0x12, 0x24,
                   0xa7, 0xb3, 0xef, 0x25, 0x0,  0x11, 0x7f, 0x4d, 0xa3, 0x50, 0x33, 0x54, 0x8a, 0x85, 0x3d, 0xfb, 0xf3,
                   0x43, 0xda, 0xda, 0x85, 0x60, 0xa6, 0x22, 0x0,  0x10, 0x16, 0xbd, 0x27, 0xfc, 0xdf, 0xf1, 0xd,  0x5,
                   0x3f, 0x92, 0x2e, 0xd8, 0x6e, 0xeb, 0x6a, 0x49, 0x18, 0x0,  0x1c, 0x4b, 0x24, 0x16, 0x64, 0x61, 0x4,
                   0xfd, 0xd9, 0xbe, 0xf1, 0x70, 0x1e, 0xc,  0xbf, 0xc,  0x2e, 0xfc, 0x98, 0xf4, 0x7f, 0xd7, 0x1e, 0x6e,
                   0xc3, 0x4,  0x79, 0x5a, 0x96, 0x1c, 0x0,  0x1,  0xa7, 0x16, 0x0,  0x0,  0x8,  0x0,  0x4,  0x63, 0x37,
                   0x8e, 0xf3, 0xd,  0x0,  0x9,  0x9b, 0xb8, 0x91, 0x67, 0x66, 0xd7, 0x16, 0x7c, 0x25, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xda, 0x49, 0x97, 0x3f, 0xfb, 0x9d, 0xb1, 0x72, 0x12, 0x24, 0xa7, 0xb3, 0xef};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7f, 0x4d, 0xa3, 0x50, 0x33, 0x54, 0x8a, 0x85, 0x3d,
                                     0xfb, 0xf3, 0x43, 0xda, 0xda, 0x85, 0x60, 0xa6};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x16, 0xbd, 0x27, 0xfc, 0xdf, 0xf1, 0xd,  0x5,
                                     0x3f, 0x92, 0x2e, 0xd8, 0x6e, 0xeb, 0x6a, 0x49};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4b, 0x24, 0x16, 0x64, 0x61, 0x4,  0xfd, 0xd9, 0xbe, 0xf1,
                                     0x70, 0x1e, 0xc,  0xbf, 0xc,  0x2e, 0xfc, 0x98, 0xf4, 0x7f,
                                     0xd7, 0x1e, 0x6e, 0xc3, 0x4,  0x79, 0x5a, 0x96};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7};
  lwmqtt_string_t topic_filter_s4 = {1, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x63, 0x37, 0x8e, 0xf3};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x9b, 0xb8, 0x91, 0x67, 0x66, 0xd7, 0x16, 0x7c, 0x25};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21602, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20894 [("\237B-\128DW\251-\ENQ\236~\v\231",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\235\144\244p\b",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\162\EM\147\205\188{m\242\133S\193\173\220\173H\227m\DC3\251\217\SUB\DC4\184\DC4~\255\a",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\237M\170\&2IG\163",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// True, _subQoS = QoS2}),("N\168\164\212\213\140\SO|b\223\242P\195\226\192\139\128\NUL\SYN8 C",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\ETB\a\246\155\191\141\202\183\152",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS2})] [PropSubscriptionIdentifier 6,PropResponseInformation
// "\178\168^^\182\241\241\131\ENQ_a\201\211\216\rN\173",PropReasonString
// "\STX\169\229\229\133\129\243\183\235\131\229\t\149anD\136\&3\DC4.N\DC4\130\237N\222l",PropServerReference
// "\EM\140b\EOTZzsq",PropContentType "",PropResponseInformation
// ";\246\&2\EM`B\215\214\185\DEL`\NUL\171\138\226\145\221\148\234\134\199]S{,\200",PropMaximumPacketSize
// 3807,PropMaximumQoS 104,PropMaximumPacketSize 17251,PropTopicAliasMaximum 6956,PropWildcardSubscriptionAvailable
// 2,PropMessageExpiryInterval 16191,PropAuthenticationMethod "",PropReceiveMaximum 21313,PropMessageExpiryInterval
// 30861,PropMessageExpiryInterval 17656,PropServerReference "",PropContentType
// "oi6\DC3\186\190\147\231\221u",PropMaximumPacketSize 25970,PropReceiveMaximum 27606,PropMaximumQoS
// 107,PropAssignedClientIdentifier
// "\134\201i/*\DLEBEC\162Y{\144\&5Vz\224\170\255\186=\195\208h",PropSubscriptionIdentifierAvailable
// 104,PropAuthenticationMethod "\148\FS",PropRetainAvailable 189,PropSharedSubscriptionAvailable 253]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xb1, 0x2,  0x51, 0x9e, 0xc5, 0x1,  0xb,  0x6,  0x1a, 0x0,  0x11, 0xb2, 0xa8, 0x5e, 0x5e, 0xb6, 0xf1, 0xf1,
      0x83, 0x5,  0x5f, 0x61, 0xc9, 0xd3, 0xd8, 0xd,  0x4e, 0xad, 0x1f, 0x0,  0x1b, 0x2,  0xa9, 0xe5, 0xe5, 0x85, 0x81,
      0xf3, 0xb7, 0xeb, 0x83, 0xe5, 0x9,  0x95, 0x61, 0x6e, 0x44, 0x88, 0x33, 0x14, 0x2e, 0x4e, 0x14, 0x82, 0xed, 0x4e,
      0xde, 0x6c, 0x1c, 0x0,  0x8,  0x19, 0x8c, 0x62, 0x4,  0x5a, 0x7a, 0x73, 0x71, 0x3,  0x0,  0x0,  0x1a, 0x0,  0x1a,
      0x3b, 0xf6, 0x32, 0x19, 0x60, 0x42, 0xd7, 0xd6, 0xb9, 0x7f, 0x60, 0x0,  0xab, 0x8a, 0xe2, 0x91, 0xdd, 0x94, 0xea,
      0x86, 0xc7, 0x5d, 0x53, 0x7b, 0x2c, 0xc8, 0x27, 0x0,  0x0,  0xe,  0xdf, 0x24, 0x68, 0x27, 0x0,  0x0,  0x43, 0x63,
      0x22, 0x1b, 0x2c, 0x28, 0x2,  0x2,  0x0,  0x0,  0x3f, 0x3f, 0x15, 0x0,  0x0,  0x21, 0x53, 0x41, 0x2,  0x0,  0x0,
      0x78, 0x8d, 0x2,  0x0,  0x0,  0x44, 0xf8, 0x1c, 0x0,  0x0,  0x3,  0x0,  0xa,  0x6f, 0x69, 0x36, 0x13, 0xba, 0xbe,
      0x93, 0xe7, 0xdd, 0x75, 0x27, 0x0,  0x0,  0x65, 0x72, 0x21, 0x6b, 0xd6, 0x24, 0x6b, 0x12, 0x0,  0x18, 0x86, 0xc9,
      0x69, 0x2f, 0x2a, 0x10, 0x42, 0x45, 0x43, 0xa2, 0x59, 0x7b, 0x90, 0x35, 0x56, 0x7a, 0xe0, 0xaa, 0xff, 0xba, 0x3d,
      0xc3, 0xd0, 0x68, 0x29, 0x68, 0x15, 0x0,  0x2,  0x94, 0x1c, 0x25, 0xbd, 0x2a, 0xfd, 0x0,  0xd,  0xed, 0x42, 0x2d,
      0x80, 0x44, 0x57, 0xfb, 0x2d, 0x5,  0xec, 0x7e, 0xb,  0xe7, 0x0,  0x0,  0x5,  0xeb, 0x90, 0xf4, 0x70, 0x8,  0x9,
      0x0,  0x1b, 0xa2, 0x19, 0x93, 0xcd, 0xbc, 0x7b, 0x6d, 0xf2, 0x85, 0x53, 0xc1, 0xad, 0xdc, 0xad, 0x48, 0xe3, 0x6d,
      0x13, 0xfb, 0xd9, 0x1a, 0x14, 0xb8, 0x14, 0x7e, 0xff, 0x7,  0x29, 0x0,  0x0,  0x12, 0x0,  0x7,  0xed, 0x4d, 0xaa,
      0x32, 0x49, 0x47, 0xa3, 0xe,  0x0,  0x16, 0x4e, 0xa8, 0xa4, 0xd4, 0xd5, 0x8c, 0xe,  0x7c, 0x62, 0xdf, 0xf2, 0x50,
      0xc3, 0xe2, 0xc0, 0x8b, 0x80, 0x0,  0x16, 0x38, 0x20, 0x43, 0x5,  0x0,  0x9,  0x17, 0x7,  0xf6, 0x9b, 0xbf, 0x8d,
      0xca, 0xb7, 0x98, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x42, 0x2d, 0x80, 0x44, 0x57, 0xfb, 0x2d, 0x5, 0xec, 0x7e, 0xb, 0xe7};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xeb, 0x90, 0xf4, 0x70, 0x8};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa2, 0x19, 0x93, 0xcd, 0xbc, 0x7b, 0x6d, 0xf2, 0x85, 0x53, 0xc1, 0xad, 0xdc, 0xad,
                                     0x48, 0xe3, 0x6d, 0x13, 0xfb, 0xd9, 0x1a, 0x14, 0xb8, 0x14, 0x7e, 0xff, 0x7};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xed, 0x4d, 0xaa, 0x32, 0x49, 0x47, 0xa3};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4e, 0xa8, 0xa4, 0xd4, 0xd5, 0x8c, 0xe, 0x7c, 0x62, 0xdf, 0xf2,
                                     0x50, 0xc3, 0xe2, 0xc0, 0x8b, 0x80, 0x0, 0x16, 0x38, 0x20, 0x43};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x17, 0x7, 0xf6, 0x9b, 0xbf, 0x8d, 0xca, 0xb7, 0x98};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  uint8_t bytesprops0[] = {0xb2, 0xa8, 0x5e, 0x5e, 0xb6, 0xf1, 0xf1, 0x83, 0x5,
                           0x5f, 0x61, 0xc9, 0xd3, 0xd8, 0xd,  0x4e, 0xad};
  uint8_t bytesprops1[] = {0x2,  0xa9, 0xe5, 0xe5, 0x85, 0x81, 0xf3, 0xb7, 0xeb, 0x83, 0xe5, 0x9,  0x95, 0x61,
                           0x6e, 0x44, 0x88, 0x33, 0x14, 0x2e, 0x4e, 0x14, 0x82, 0xed, 0x4e, 0xde, 0x6c};
  uint8_t bytesprops2[] = {0x19, 0x8c, 0x62, 0x4, 0x5a, 0x7a, 0x73, 0x71};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x3b, 0xf6, 0x32, 0x19, 0x60, 0x42, 0xd7, 0xd6, 0xb9, 0x7f, 0x60, 0x0,  0xab,
                           0x8a, 0xe2, 0x91, 0xdd, 0x94, 0xea, 0x86, 0xc7, 0x5d, 0x53, 0x7b, 0x2c, 0xc8};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0x6f, 0x69, 0x36, 0x13, 0xba, 0xbe, 0x93, 0xe7, 0xdd, 0x75};
  uint8_t bytesprops8[] = {0x86, 0xc9, 0x69, 0x2f, 0x2a, 0x10, 0x42, 0x45, 0x43, 0xa2, 0x59, 0x7b,
                           0x90, 0x35, 0x56, 0x7a, 0xe0, 0xaa, 0xff, 0xba, 0x3d, 0xc3, 0xd0, 0x68};
  uint8_t bytesprops9[] = {0x94, 0x1c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3807}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17251}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6956}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16191}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21313}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30861}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17656}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25970}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27606}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 253}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20894, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15574
// [("]\129\160\v\144]\DC3^\204\220\DEL\ETX2_\SI\"\197\208\215\196\b\176^\158\233\177\180\164\255",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})]
// [PropSharedSubscriptionAvailable 88,PropServerKeepAlive 7219,PropWildcardSubscriptionAvailable
// 143,PropPayloadFormatIndicator 61,PropMaximumPacketSize 20794,PropSubscriptionIdentifier 5,PropMessageExpiryInterval
// 31212,PropResponseInformation
// "\DC22\181\175>\228\190i\148\139{\SI\DC3R\ACK\198\170K\SUB\185\189\164\129\190",PropReasonString
// "\192\145SO\207*\186\227\223",PropSubscriptionIdentifierAvailable 133,PropPayloadFormatIndicator
// 58,PropMessageExpiryInterval 5405,PropServerReference "\150\140\151\180\226Xe\b",PropTopicAliasMaximum
// 27080,PropResponseInformation
// "\184\254\&9Tn#Q\192\SYN\244\193\240/\180\DLE~\206\FS*\207\187\152\"\DC2",PropUserProperty
// "\252\&4<n{z\204\152\&8F_\233E\242!\168\DC1\NUL\134\SOH=\151{\139"
// "Z\SI\152\241\239G\EOT\244\198*\f\198",PropAssignedClientIdentifier "\147\174\148\197\n",PropContentType
// "\211\153}\187fb\160-\166\176m$\227D\233\RSU\140:\146",PropContentType "!\DC4W\229K",PropServerKeepAlive
// 1359,PropContentType
// "\244c\240?\214\233\202\&0\230\v\247\180\132\232A\136=\147\198\174\&7\189\149\223\STXL\137\ACK",PropAuthenticationData
// "\141\133\185\202%m\191M\222\201\165cQZ\225\156s\211\168\SUB_\189\210\&3\251",PropReasonString
// "I\179de\202\ACK\n\229G\DELc3\DC3?\r%\186h\NAK\220\252\237/\209\177\158\SI\161",PropReasonString
// "\188O\218\153\233\f@\166VP\NAK\RS\SI\n\239\206\131",PropTopicAliasMaximum 28168,PropMaximumQoS
// 154,PropServerKeepAlive 25953,PropContentType
// "Y\167*\149\174\159:\r\174\213M\176\148+\189\r\ETXa[",PropMessageExpiryInterval 14517,PropMessageExpiryInterval 9459]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x82, 0xfb, 0x2,  0x3c, 0xd6, 0xd7, 0x2,  0x2a, 0x58, 0x13, 0x1c, 0x33, 0x28, 0x8f, 0x1,  0x3d, 0x27, 0x0,  0x0,
      0x51, 0x3a, 0xb,  0x5,  0x2,  0x0,  0x0,  0x79, 0xec, 0x1a, 0x0,  0x18, 0x12, 0x32, 0xb5, 0xaf, 0x3e, 0xe4, 0xbe,
      0x69, 0x94, 0x8b, 0x7b, 0xf,  0x13, 0x52, 0x6,  0xc6, 0xaa, 0x4b, 0x1a, 0xb9, 0xbd, 0xa4, 0x81, 0xbe, 0x1f, 0x0,
      0x9,  0xc0, 0x91, 0x53, 0x4f, 0xcf, 0x2a, 0xba, 0xe3, 0xdf, 0x29, 0x85, 0x1,  0x3a, 0x2,  0x0,  0x0,  0x15, 0x1d,
      0x1c, 0x0,  0x8,  0x96, 0x8c, 0x97, 0xb4, 0xe2, 0x58, 0x65, 0x8,  0x22, 0x69, 0xc8, 0x1a, 0x0,  0x18, 0xb8, 0xfe,
      0x39, 0x54, 0x6e, 0x23, 0x51, 0xc0, 0x16, 0xf4, 0xc1, 0xf0, 0x2f, 0xb4, 0x10, 0x7e, 0xce, 0x1c, 0x2a, 0xcf, 0xbb,
      0x98, 0x22, 0x12, 0x26, 0x0,  0x18, 0xfc, 0x34, 0x3c, 0x6e, 0x7b, 0x7a, 0xcc, 0x98, 0x38, 0x46, 0x5f, 0xe9, 0x45,
      0xf2, 0x21, 0xa8, 0x11, 0x0,  0x86, 0x1,  0x3d, 0x97, 0x7b, 0x8b, 0x0,  0xc,  0x5a, 0xf,  0x98, 0xf1, 0xef, 0x47,
      0x4,  0xf4, 0xc6, 0x2a, 0xc,  0xc6, 0x12, 0x0,  0x5,  0x93, 0xae, 0x94, 0xc5, 0xa,  0x3,  0x0,  0x14, 0xd3, 0x99,
      0x7d, 0xbb, 0x66, 0x62, 0xa0, 0x2d, 0xa6, 0xb0, 0x6d, 0x24, 0xe3, 0x44, 0xe9, 0x1e, 0x55, 0x8c, 0x3a, 0x92, 0x3,
      0x0,  0x5,  0x21, 0x14, 0x57, 0xe5, 0x4b, 0x13, 0x5,  0x4f, 0x3,  0x0,  0x1c, 0xf4, 0x63, 0xf0, 0x3f, 0xd6, 0xe9,
      0xca, 0x30, 0xe6, 0xb,  0xf7, 0xb4, 0x84, 0xe8, 0x41, 0x88, 0x3d, 0x93, 0xc6, 0xae, 0x37, 0xbd, 0x95, 0xdf, 0x2,
      0x4c, 0x89, 0x6,  0x16, 0x0,  0x19, 0x8d, 0x85, 0xb9, 0xca, 0x25, 0x6d, 0xbf, 0x4d, 0xde, 0xc9, 0xa5, 0x63, 0x51,
      0x5a, 0xe1, 0x9c, 0x73, 0xd3, 0xa8, 0x1a, 0x5f, 0xbd, 0xd2, 0x33, 0xfb, 0x1f, 0x0,  0x1c, 0x49, 0xb3, 0x64, 0x65,
      0xca, 0x6,  0xa,  0xe5, 0x47, 0x7f, 0x63, 0x33, 0x13, 0x3f, 0xd,  0x25, 0xba, 0x68, 0x15, 0xdc, 0xfc, 0xed, 0x2f,
      0xd1, 0xb1, 0x9e, 0xf,  0xa1, 0x1f, 0x0,  0x11, 0xbc, 0x4f, 0xda, 0x99, 0xe9, 0xc,  0x40, 0xa6, 0x56, 0x50, 0x15,
      0x1e, 0xf,  0xa,  0xef, 0xce, 0x83, 0x22, 0x6e, 0x8,  0x24, 0x9a, 0x13, 0x65, 0x61, 0x3,  0x0,  0x13, 0x59, 0xa7,
      0x2a, 0x95, 0xae, 0x9f, 0x3a, 0xd,  0xae, 0xd5, 0x4d, 0xb0, 0x94, 0x2b, 0xbd, 0xd,  0x3,  0x61, 0x5b, 0x2,  0x0,
      0x0,  0x38, 0xb5, 0x2,  0x0,  0x0,  0x24, 0xf3, 0x0,  0x1d, 0x5d, 0x81, 0xa0, 0xb,  0x90, 0x5d, 0x13, 0x5e, 0xcc,
      0xdc, 0x7f, 0x3,  0x32, 0x5f, 0xf,  0x22, 0xc5, 0xd0, 0xd7, 0xc4, 0x8,  0xb0, 0x5e, 0x9e, 0xe9, 0xb1, 0xb4, 0xa4,
      0xff, 0x21};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x5d, 0x81, 0xa0, 0xb,  0x90, 0x5d, 0x13, 0x5e, 0xcc, 0xdc,
                                     0x7f, 0x3,  0x32, 0x5f, 0xf,  0x22, 0xc5, 0xd0, 0xd7, 0xc4,
                                     0x8,  0xb0, 0x5e, 0x9e, 0xe9, 0xb1, 0xb4, 0xa4, 0xff};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0x12, 0x32, 0xb5, 0xaf, 0x3e, 0xe4, 0xbe, 0x69, 0x94, 0x8b, 0x7b, 0xf,
                           0x13, 0x52, 0x6,  0xc6, 0xaa, 0x4b, 0x1a, 0xb9, 0xbd, 0xa4, 0x81, 0xbe};
  uint8_t bytesprops1[] = {0xc0, 0x91, 0x53, 0x4f, 0xcf, 0x2a, 0xba, 0xe3, 0xdf};
  uint8_t bytesprops2[] = {0x96, 0x8c, 0x97, 0xb4, 0xe2, 0x58, 0x65, 0x8};
  uint8_t bytesprops3[] = {0xb8, 0xfe, 0x39, 0x54, 0x6e, 0x23, 0x51, 0xc0, 0x16, 0xf4, 0xc1, 0xf0,
                           0x2f, 0xb4, 0x10, 0x7e, 0xce, 0x1c, 0x2a, 0xcf, 0xbb, 0x98, 0x22, 0x12};
  uint8_t bytesprops5[] = {0x5a, 0xf, 0x98, 0xf1, 0xef, 0x47, 0x4, 0xf4, 0xc6, 0x2a, 0xc, 0xc6};
  uint8_t bytesprops4[] = {0xfc, 0x34, 0x3c, 0x6e, 0x7b, 0x7a, 0xcc, 0x98, 0x38, 0x46, 0x5f, 0xe9,
                           0x45, 0xf2, 0x21, 0xa8, 0x11, 0x0,  0x86, 0x1,  0x3d, 0x97, 0x7b, 0x8b};
  uint8_t bytesprops6[] = {0x93, 0xae, 0x94, 0xc5, 0xa};
  uint8_t bytesprops7[] = {0xd3, 0x99, 0x7d, 0xbb, 0x66, 0x62, 0xa0, 0x2d, 0xa6, 0xb0,
                           0x6d, 0x24, 0xe3, 0x44, 0xe9, 0x1e, 0x55, 0x8c, 0x3a, 0x92};
  uint8_t bytesprops8[] = {0x21, 0x14, 0x57, 0xe5, 0x4b};
  uint8_t bytesprops9[] = {0xf4, 0x63, 0xf0, 0x3f, 0xd6, 0xe9, 0xca, 0x30, 0xe6, 0xb,  0xf7, 0xb4, 0x84, 0xe8,
                           0x41, 0x88, 0x3d, 0x93, 0xc6, 0xae, 0x37, 0xbd, 0x95, 0xdf, 0x2,  0x4c, 0x89, 0x6};
  uint8_t bytesprops10[] = {0x8d, 0x85, 0xb9, 0xca, 0x25, 0x6d, 0xbf, 0x4d, 0xde, 0xc9, 0xa5, 0x63, 0x51,
                            0x5a, 0xe1, 0x9c, 0x73, 0xd3, 0xa8, 0x1a, 0x5f, 0xbd, 0xd2, 0x33, 0xfb};
  uint8_t bytesprops11[] = {0x49, 0xb3, 0x64, 0x65, 0xca, 0x6,  0xa,  0xe5, 0x47, 0x7f, 0x63, 0x33, 0x13, 0x3f,
                            0xd,  0x25, 0xba, 0x68, 0x15, 0xdc, 0xfc, 0xed, 0x2f, 0xd1, 0xb1, 0x9e, 0xf,  0xa1};
  uint8_t bytesprops12[] = {0xbc, 0x4f, 0xda, 0x99, 0xe9, 0xc,  0x40, 0xa6, 0x56,
                            0x50, 0x15, 0x1e, 0xf,  0xa,  0xef, 0xce, 0x83};
  uint8_t bytesprops13[] = {0x59, 0xa7, 0x2a, 0x95, 0xae, 0x9f, 0x3a, 0xd,  0xae, 0xd5,
                            0x4d, 0xb0, 0x94, 0x2b, 0xbd, 0xd,  0x3,  0x61, 0x5b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7219}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20794}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31212}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5405}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27080}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops4}, .v = {12, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1359}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28168}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25953}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14517}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9459}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15574, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17105 [("\251AO\229\203\204a\247\204\191\DC4\162\204\146JU\160\SUB\157\195",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\155\216\r\EOT\169\SO\224\155n\235\FS\nu\159\142g;\149\246\147E\179]b\231\&8\US/<\FS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("{,\159\154j\185o\n\143m\178\242\207>=R\NAK\247nHl\242\STX\213&oY",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropReasonString "\223b
// @\167?\143\&7L\163\146\216\197;\DC2\213\228\234\208",PropMessageExpiryInterval 31326,PropTopicAlias
// 16320,PropReceiveMaximum 6351,PropWildcardSubscriptionAvailable 31,PropMessageExpiryInterval
// 8699,PropMaximumPacketSize 25430,PropPayloadFormatIndicator 87,PropReasonString
// "az\138\221\181\197\191\NAK{=\137)\243\181\184\209W4\231\253\229\153\163\170\156",PropSubscriptionIdentifier
// 9,PropMessageExpiryInterval 26330,PropTopicAlias 22270,PropMessageExpiryInterval 27322,PropCorrelationData
// "\131\145H\141\152\159\218H\153*\192\&7\186\154\231",PropMaximumQoS 32,PropMaximumQoS 233,PropWillDelayInterval
// 24371,PropRequestResponseInformation 149,PropSharedSubscriptionAvailable 31,PropSharedSubscriptionAvailable
// 199,PropRetainAvailable 125]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0xd6, 0x1,  0x42, 0xd1, 0x7d, 0x1f, 0x0,  0x13, 0xdf, 0x62, 0x20, 0x40, 0xa7, 0x3f, 0x8f, 0x37,
                   0x4c, 0xa3, 0x92, 0xd8, 0xc5, 0x3b, 0x12, 0xd5, 0xe4, 0xea, 0xd0, 0x2,  0x0,  0x0,  0x7a, 0x5e, 0x23,
                   0x3f, 0xc0, 0x21, 0x18, 0xcf, 0x28, 0x1f, 0x2,  0x0,  0x0,  0x21, 0xfb, 0x27, 0x0,  0x0,  0x63, 0x56,
                   0x1,  0x57, 0x1f, 0x0,  0x19, 0x61, 0x7a, 0x8a, 0xdd, 0xb5, 0xc5, 0xbf, 0x15, 0x7b, 0x3d, 0x89, 0x29,
                   0xf3, 0xb5, 0xb8, 0xd1, 0x57, 0x34, 0xe7, 0xfd, 0xe5, 0x99, 0xa3, 0xaa, 0x9c, 0xb,  0x9,  0x2,  0x0,
                   0x0,  0x66, 0xda, 0x23, 0x56, 0xfe, 0x2,  0x0,  0x0,  0x6a, 0xba, 0x9,  0x0,  0xf,  0x83, 0x91, 0x48,
                   0x8d, 0x98, 0x9f, 0xda, 0x48, 0x99, 0x2a, 0xc0, 0x37, 0xba, 0x9a, 0xe7, 0x24, 0x20, 0x24, 0xe9, 0x18,
                   0x0,  0x0,  0x5f, 0x33, 0x19, 0x95, 0x2a, 0x1f, 0x2a, 0xc7, 0x25, 0x7d, 0x0,  0x14, 0xfb, 0x41, 0x4f,
                   0xe5, 0xcb, 0xcc, 0x61, 0xf7, 0xcc, 0xbf, 0x14, 0xa2, 0xcc, 0x92, 0x4a, 0x55, 0xa0, 0x1a, 0x9d, 0xc3,
                   0x19, 0x0,  0x1e, 0x9b, 0xd8, 0xd,  0x4,  0xa9, 0xe,  0xe0, 0x9b, 0x6e, 0xeb, 0x1c, 0xa,  0x75, 0x9f,
                   0x8e, 0x67, 0x3b, 0x95, 0xf6, 0x93, 0x45, 0xb3, 0x5d, 0x62, 0xe7, 0x38, 0x1f, 0x2f, 0x3c, 0x1c, 0x6,
                   0x0,  0x1b, 0x7b, 0x2c, 0x9f, 0x9a, 0x6a, 0xb9, 0x6f, 0xa,  0x8f, 0x6d, 0xb2, 0xf2, 0xcf, 0x3e, 0x3d,
                   0x52, 0x15, 0xf7, 0x6e, 0x48, 0x6c, 0xf2, 0x2,  0xd5, 0x26, 0x6f, 0x59, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xfb, 0x41, 0x4f, 0xe5, 0xcb, 0xcc, 0x61, 0xf7, 0xcc, 0xbf,
                                     0x14, 0xa2, 0xcc, 0x92, 0x4a, 0x55, 0xa0, 0x1a, 0x9d, 0xc3};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9b, 0xd8, 0xd,  0x4,  0xa9, 0xe,  0xe0, 0x9b, 0x6e, 0xeb,
                                     0x1c, 0xa,  0x75, 0x9f, 0x8e, 0x67, 0x3b, 0x95, 0xf6, 0x93,
                                     0x45, 0xb3, 0x5d, 0x62, 0xe7, 0x38, 0x1f, 0x2f, 0x3c, 0x1c};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7b, 0x2c, 0x9f, 0x9a, 0x6a, 0xb9, 0x6f, 0xa,  0x8f, 0x6d, 0xb2, 0xf2, 0xcf, 0x3e,
                                     0x3d, 0x52, 0x15, 0xf7, 0x6e, 0x48, 0x6c, 0xf2, 0x2,  0xd5, 0x26, 0x6f, 0x59};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0xdf, 0x62, 0x20, 0x40, 0xa7, 0x3f, 0x8f, 0x37, 0x4c, 0xa3,
                           0x92, 0xd8, 0xc5, 0x3b, 0x12, 0xd5, 0xe4, 0xea, 0xd0};
  uint8_t bytesprops1[] = {0x61, 0x7a, 0x8a, 0xdd, 0xb5, 0xc5, 0xbf, 0x15, 0x7b, 0x3d, 0x89, 0x29, 0xf3,
                           0xb5, 0xb8, 0xd1, 0x57, 0x34, 0xe7, 0xfd, 0xe5, 0x99, 0xa3, 0xaa, 0x9c};
  uint8_t bytesprops2[] = {0x83, 0x91, 0x48, 0x8d, 0x98, 0x9f, 0xda, 0x48, 0x99, 0x2a, 0xc0, 0x37, 0xba, 0x9a, 0xe7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31326}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16320}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6351}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8699}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25430}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26330}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22270}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27322}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24371}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 125}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17105, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26860 [("\\\141\254\CAN\217\DC4\240\244\DELx;\238\SO\168\&6A\223v\163\128",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("t\181>5/\245\f\155\161\184\211",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS0}),("\STX=\b\150d\219\200\177\178\226D\153\252A\229",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\245\138\fl\228\159\224Bny",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS0}),("\194t\244\206\158\155>\128\183y\199\173\195\199~F\150;\142\178d",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropRetainAvailable 154,PropSubscriptionIdentifierAvailable 188,PropMaximumPacketSize
// 17727,PropRequestResponseInformation 216,PropResponseTopic "Y\168\178\200/\208",PropReceiveMaximum
// 30281,PropTopicAliasMaximum 7251,PropSessionExpiryInterval 20135,PropSessionExpiryInterval 569,PropTopicAliasMaximum
// 7009,PropTopicAlias 16877,PropCorrelationData "\154\229V\235\EOT\190b\152",PropReceiveMaximum 12069,PropMaximumQoS
// 161,PropMessageExpiryInterval 426,PropSubscriptionIdentifierAvailable 154]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x68, 0xec, 0x41, 0x25, 0x9a, 0x29, 0xbc, 0x27, 0x0,  0x0,  0x45, 0x3f, 0x19, 0xd8,
                   0x8,  0x0,  0x6,  0x59, 0xa8, 0xb2, 0xc8, 0x2f, 0xd0, 0x21, 0x76, 0x49, 0x22, 0x1c, 0x53, 0x11, 0x0,
                   0x0,  0x4e, 0xa7, 0x11, 0x0,  0x0,  0x2,  0x39, 0x22, 0x1b, 0x61, 0x23, 0x41, 0xed, 0x9,  0x0,  0x8,
                   0x9a, 0xe5, 0x56, 0xeb, 0x4,  0xbe, 0x62, 0x98, 0x21, 0x2f, 0x25, 0x24, 0xa1, 0x2,  0x0,  0x0,  0x1,
                   0xaa, 0x29, 0x9a, 0x0,  0x14, 0x5c, 0x8d, 0xfe, 0x18, 0xd9, 0x14, 0xf0, 0xf4, 0x7f, 0x78, 0x3b, 0xee,
                   0xe,  0xa8, 0x36, 0x41, 0xdf, 0x76, 0xa3, 0x80, 0x1d, 0x0,  0xb,  0x74, 0xb5, 0x3e, 0x35, 0x2f, 0xf5,
                   0xc,  0x9b, 0xa1, 0xb8, 0xd3, 0x28, 0x0,  0xf,  0x2,  0x3d, 0x8,  0x96, 0x64, 0xdb, 0xc8, 0xb1, 0xb2,
                   0xe2, 0x44, 0x99, 0xfc, 0x41, 0xe5, 0x11, 0x0,  0xa,  0xf5, 0x8a, 0xc,  0x6c, 0xe4, 0x9f, 0xe0, 0x42,
                   0x6e, 0x79, 0x8,  0x0,  0x15, 0xc2, 0x74, 0xf4, 0xce, 0x9e, 0x9b, 0x3e, 0x80, 0xb7, 0x79, 0xc7, 0xad,
                   0xc3, 0xc7, 0x7e, 0x46, 0x96, 0x3b, 0x8e, 0xb2, 0x64, 0x1c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x5c, 0x8d, 0xfe, 0x18, 0xd9, 0x14, 0xf0, 0xf4, 0x7f, 0x78,
                                     0x3b, 0xee, 0xe,  0xa8, 0x36, 0x41, 0xdf, 0x76, 0xa3, 0x80};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x74, 0xb5, 0x3e, 0x35, 0x2f, 0xf5, 0xc, 0x9b, 0xa1, 0xb8, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2,  0x3d, 0x8,  0x96, 0x64, 0xdb, 0xc8, 0xb1,
                                     0xb2, 0xe2, 0x44, 0x99, 0xfc, 0x41, 0xe5};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf5, 0x8a, 0xc, 0x6c, 0xe4, 0x9f, 0xe0, 0x42, 0x6e, 0x79};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc2, 0x74, 0xf4, 0xce, 0x9e, 0x9b, 0x3e, 0x80, 0xb7, 0x79, 0xc7,
                                     0xad, 0xc3, 0xc7, 0x7e, 0x46, 0x96, 0x3b, 0x8e, 0xb2, 0x64};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0x59, 0xa8, 0xb2, 0xc8, 0x2f, 0xd0};
  uint8_t bytesprops1[] = {0x9a, 0xe5, 0x56, 0xeb, 0x4, 0xbe, 0x62, 0x98};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17727}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30281}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7251}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20135}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 569}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7009}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16877}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12069}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 426}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 154}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26860, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11675 [("n\192\248\255\205<\240\238\SO!\140\179\201",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("o",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\232\ETXX\162\232\228\251b8Y\146c\244\143\247\RS\135",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] [PropTopicAlias 32522,PropTopicAliasMaximum
// 473,PropRequestResponseInformation 137,PropTopicAliasMaximum 6865,PropMaximumPacketSize
// 20987,PropAuthenticationMethod "\227\&2\SI/bp6",PropSessionExpiryInterval 15350,PropWildcardSubscriptionAvailable
// 52,PropServerReference "\225\214\182\253A\198\159V\185D\226h\135D*Q\187\242/\247\FS0\223K",PropCorrelationData
// "\181\137t5",PropWildcardSubscriptionAvailable 22,PropReceiveMaximum 31071,PropWildcardSubscriptionAvailable
// 134,PropMessageExpiryInterval 1718,PropUserProperty "\223\NAK\191"
// "\129\DEL\SI\239\241^\224\147\&5\"5\210-\153@H.!ES\148\183",PropSubscriptionIdentifierAvailable
// 101,PropRequestProblemInformation 134]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x9c, 0x1,  0x2d, 0x9b, 0x71, 0x23, 0x7f, 0xa,  0x22, 0x1,  0xd9, 0x19, 0x89, 0x22, 0x1a,
                   0xd1, 0x27, 0x0,  0x0,  0x51, 0xfb, 0x15, 0x0,  0x7,  0xe3, 0x32, 0xf,  0x2f, 0x62, 0x70, 0x36,
                   0x11, 0x0,  0x0,  0x3b, 0xf6, 0x28, 0x34, 0x1c, 0x0,  0x18, 0xe1, 0xd6, 0xb6, 0xfd, 0x41, 0xc6,
                   0x9f, 0x56, 0xb9, 0x44, 0xe2, 0x68, 0x87, 0x44, 0x2a, 0x51, 0xbb, 0xf2, 0x2f, 0xf7, 0x1c, 0x30,
                   0xdf, 0x4b, 0x9,  0x0,  0x4,  0xb5, 0x89, 0x74, 0x35, 0x28, 0x16, 0x21, 0x79, 0x5f, 0x28, 0x86,
                   0x2,  0x0,  0x0,  0x6,  0xb6, 0x26, 0x0,  0x3,  0xdf, 0x15, 0xbf, 0x0,  0x16, 0x81, 0x7f, 0xf,
                   0xef, 0xf1, 0x5e, 0xe0, 0x93, 0x35, 0x22, 0x35, 0xd2, 0x2d, 0x99, 0x40, 0x48, 0x2e, 0x21, 0x45,
                   0x53, 0x94, 0xb7, 0x29, 0x65, 0x17, 0x86, 0x0,  0xd,  0x6e, 0xc0, 0xf8, 0xff, 0xcd, 0x3c, 0xf0,
                   0xee, 0xe,  0x21, 0x8c, 0xb3, 0xc9, 0xd,  0x0,  0x1,  0x6f, 0x4,  0x0,  0x11, 0xe8, 0x3,  0x58,
                   0xa2, 0xe8, 0xe4, 0xfb, 0x62, 0x38, 0x59, 0x92, 0x63, 0xf4, 0x8f, 0xf7, 0x1e, 0x87, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x6e, 0xc0, 0xf8, 0xff, 0xcd, 0x3c, 0xf0, 0xee, 0xe, 0x21, 0x8c, 0xb3, 0xc9};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6f};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe8, 0x3,  0x58, 0xa2, 0xe8, 0xe4, 0xfb, 0x62, 0x38,
                                     0x59, 0x92, 0x63, 0xf4, 0x8f, 0xf7, 0x1e, 0x87};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  uint8_t bytesprops0[] = {0xe3, 0x32, 0xf, 0x2f, 0x62, 0x70, 0x36};
  uint8_t bytesprops1[] = {0xe1, 0xd6, 0xb6, 0xfd, 0x41, 0xc6, 0x9f, 0x56, 0xb9, 0x44, 0xe2, 0x68,
                           0x87, 0x44, 0x2a, 0x51, 0xbb, 0xf2, 0x2f, 0xf7, 0x1c, 0x30, 0xdf, 0x4b};
  uint8_t bytesprops2[] = {0xb5, 0x89, 0x74, 0x35};
  uint8_t bytesprops4[] = {0x81, 0x7f, 0xf,  0xef, 0xf1, 0x5e, 0xe0, 0x93, 0x35, 0x22, 0x35,
                           0xd2, 0x2d, 0x99, 0x40, 0x48, 0x2e, 0x21, 0x45, 0x53, 0x94, 0xb7};
  uint8_t bytesprops3[] = {0xdf, 0x15, 0xbf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32522}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 473}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6865}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20987}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15350}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31071}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1718}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops3}, .v = {22, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 134}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11675, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3007 [("<\ESCJ\DC2V\230\n\158\168\250G%\212R\210V\227\229\134j\165\&3)\146\165\&95",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("_\234\180~!\246(\231}4\200\221\168\191\149\197$0\202\223\&0\150\vE\169\217\189",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS\195\202\227\242t}K9k\EMD\149|\186\ESC~tO\216\200\234",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("Nz\DC2\155\&2\182\ETB>)\DC2&?\246\193i`\151\NAK_\US4\DC1\252\234\DC2Z\NUL\a\153",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("@\194TRT
// \178\157\251\225q\SO\181(\194\220\217p",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\206\DLE\241X5E\154\204\CAN\229~hlj{`f1\155y\181\DEL\217;",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\201{}\179\NAK",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS0}),("f\t\SYN\165=\225\132\NUL\207\161F\250\237\SOH\195\142\"\148",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("\186\ETX[",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\234\250\254\182(\DEL\154mqQ\135K\160MA\174\234\211\145}\187\DC2hn/_",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropReasonString
// "",PropServerKeepAlive 8062]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x82, 0xf1, 0x1,  0xb,  0xbf, 0x6,  0x1f, 0x0,  0x0,  0x13, 0x1f, 0x7e, 0x0,  0x1b, 0x3c, 0x1b, 0x4a, 0x12, 0x56,
      0xe6, 0xa,  0x9e, 0xa8, 0xfa, 0x47, 0x25, 0xd4, 0x52, 0xd2, 0x56, 0xe3, 0xe5, 0x86, 0x6a, 0xa5, 0x33, 0x29, 0x92,
      0xa5, 0x39, 0x35, 0x10, 0x0,  0x1b, 0x5f, 0xea, 0xb4, 0x7e, 0x21, 0xf6, 0x28, 0xe7, 0x7d, 0x34, 0xc8, 0xdd, 0xa8,
      0xbf, 0x95, 0xc5, 0x24, 0x30, 0xca, 0xdf, 0x30, 0x96, 0xb,  0x45, 0xa9, 0xd9, 0xbd, 0x20, 0x0,  0x16, 0x1d, 0xc3,
      0xca, 0xe3, 0xf2, 0x74, 0x7d, 0x4b, 0x39, 0x6b, 0x19, 0x44, 0x95, 0x7c, 0xba, 0x1b, 0x7e, 0x74, 0x4f, 0xd8, 0xc8,
      0xea, 0x4,  0x0,  0x0,  0x2a, 0x0,  0x1d, 0x4e, 0x7a, 0x12, 0x9b, 0x32, 0xb6, 0x17, 0x3e, 0x29, 0x12, 0x26, 0x3f,
      0xf6, 0xc1, 0x69, 0x60, 0x97, 0x15, 0x5f, 0x1f, 0x34, 0x11, 0xfc, 0xea, 0x12, 0x5a, 0x0,  0x7,  0x99, 0xd,  0x0,
      0x12, 0x40, 0xc2, 0x54, 0x52, 0x54, 0x20, 0xb2, 0x9d, 0xfb, 0xe1, 0x71, 0xe,  0xb5, 0x28, 0xc2, 0xdc, 0xd9, 0x70,
      0x11, 0x0,  0x18, 0xce, 0x10, 0xf1, 0x58, 0x35, 0x45, 0x9a, 0xcc, 0x18, 0xe5, 0x7e, 0x68, 0x6c, 0x6a, 0x7b, 0x60,
      0x66, 0x31, 0x9b, 0x79, 0xb5, 0x7f, 0xd9, 0x3b, 0x14, 0x0,  0x5,  0xc9, 0x7b, 0x7d, 0xb3, 0x15, 0x14, 0x0,  0x12,
      0x66, 0x9,  0x16, 0xa5, 0x3d, 0xe1, 0x84, 0x0,  0xcf, 0xa1, 0x46, 0xfa, 0xed, 0x1,  0xc3, 0x8e, 0x22, 0x94, 0x8,
      0x0,  0x3,  0xba, 0x3,  0x5b, 0x5,  0x0,  0x1a, 0xea, 0xfa, 0xfe, 0xb6, 0x28, 0x7f, 0x9a, 0x6d, 0x71, 0x51, 0x87,
      0x4b, 0xa0, 0x4d, 0x41, 0xae, 0xea, 0xd3, 0x91, 0x7d, 0xbb, 0x12, 0x68, 0x6e, 0x2f, 0x5f, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x3c, 0x1b, 0x4a, 0x12, 0x56, 0xe6, 0xa,  0x9e, 0xa8, 0xfa, 0x47, 0x25, 0xd4, 0x52,
                                     0xd2, 0x56, 0xe3, 0xe5, 0x86, 0x6a, 0xa5, 0x33, 0x29, 0x92, 0xa5, 0x39, 0x35};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0xea, 0xb4, 0x7e, 0x21, 0xf6, 0x28, 0xe7, 0x7d, 0x34, 0xc8, 0xdd, 0xa8, 0xbf,
                                     0x95, 0xc5, 0x24, 0x30, 0xca, 0xdf, 0x30, 0x96, 0xb,  0x45, 0xa9, 0xd9, 0xbd};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1d, 0xc3, 0xca, 0xe3, 0xf2, 0x74, 0x7d, 0x4b, 0x39, 0x6b, 0x19,
                                     0x44, 0x95, 0x7c, 0xba, 0x1b, 0x7e, 0x74, 0x4f, 0xd8, 0xc8, 0xea};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4e, 0x7a, 0x12, 0x9b, 0x32, 0xb6, 0x17, 0x3e, 0x29, 0x12,
                                     0x26, 0x3f, 0xf6, 0xc1, 0x69, 0x60, 0x97, 0x15, 0x5f, 0x1f,
                                     0x34, 0x11, 0xfc, 0xea, 0x12, 0x5a, 0x0,  0x7,  0x99};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x40, 0xc2, 0x54, 0x52, 0x54, 0x20, 0xb2, 0x9d, 0xfb,
                                     0xe1, 0x71, 0xe,  0xb5, 0x28, 0xc2, 0xdc, 0xd9, 0x70};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xce, 0x10, 0xf1, 0x58, 0x35, 0x45, 0x9a, 0xcc, 0x18, 0xe5, 0x7e, 0x68,
                                     0x6c, 0x6a, 0x7b, 0x60, 0x66, 0x31, 0x9b, 0x79, 0xb5, 0x7f, 0xd9, 0x3b};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc9, 0x7b, 0x7d, 0xb3, 0x15};
  lwmqtt_string_t topic_filter_s7 = {5, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x66, 0x9,  0x16, 0xa5, 0x3d, 0xe1, 0x84, 0x0,  0xcf,
                                     0xa1, 0x46, 0xfa, 0xed, 0x1,  0xc3, 0x8e, 0x22, 0x94};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xba, 0x3, 0x5b};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xea, 0xfa, 0xfe, 0xb6, 0x28, 0x7f, 0x9a, 0x6d, 0x71, 0x51, 0x87, 0x4b, 0xa0,
                                      0x4d, 0x41, 0xae, 0xea, 0xd3, 0x91, 0x7d, 0xbb, 0x12, 0x68, 0x6e, 0x2f, 0x5f};
  lwmqtt_string_t topic_filter_s10 = {26, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8062}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3007, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30616 [("b\GS\215\182QH\USjKr\230\129\142?Q\129UE\243\147n\229\160)\137",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\164\EMyC\254\225\STX33_\EOTAsM\"\DEL\236\&3jy",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("}\159dgE^\200\218v",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\DC2\249\217\184\DEL\147\151g\128\169}\221\168\236~l",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\227\172\EM\147eL\199B
// \USLxP\210\a4as\191\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS1})] [PropRequestResponseInformation 255,PropAssignedClientIdentifier
// "\190\DLE\FS\134c\141\255\181\"\248z\206N\t@\160{\200]\SYN\140\f\198\232\176>\252\243\t\203",PropReceiveMaximum
// 29184,PropTopicAliasMaximum 29191,PropRetainAvailable 168,PropServerKeepAlive 31897,PropServerKeepAlive
// 26301,PropUserProperty "\230I\187\DC3X\225\190\156\156E\249\132\DC2\244\&3v\158\144\182F"
// "\131\238\138\225\SI\204r\200#\SYN?\234&\ESCg4\176\213\&3\227;\146\228\209k\246",PropAuthenticationData
// "\254\172\138\226\"bfv\179\220\166",PropAuthenticationMethod
// "TlTU\SUBqZU\187\b\156\160\&8\224\244\252\CAN\190\152",PropResponseInformation
// "\246\164\160zZ",PropWildcardSubscriptionAvailable 0,PropContentType "",PropReceiveMaximum 29467,PropUserProperty
// "\253\RSI\129\158\223IT\156\186\DC2~\161\161\194/\130\179\168\213VX\247QY" "d5",PropUserProperty
// "q\207\173\188\221\183\194\223\155\181\193/c\247a"
// "\236d\219pJ%\DC3gf1\189\196\166\227\224\NAKx\243$\ETB\194\163\147",PropMessageExpiryInterval 9079,PropMaximumQoS
// 74,PropRequestProblemInformation 57]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0xd9, 0x2,  0x77, 0x98, 0xec, 0x1,  0x19, 0xff, 0x12, 0x0,  0x1e, 0xbe, 0x10, 0x1c, 0x86, 0x63, 0x8d, 0xff,
      0xb5, 0x22, 0xf8, 0x7a, 0xce, 0x4e, 0x9,  0x40, 0xa0, 0x7b, 0xc8, 0x5d, 0x16, 0x8c, 0xc,  0xc6, 0xe8, 0xb0, 0x3e,
      0xfc, 0xf3, 0x9,  0xcb, 0x21, 0x72, 0x0,  0x22, 0x72, 0x7,  0x25, 0xa8, 0x13, 0x7c, 0x99, 0x13, 0x66, 0xbd, 0x26,
      0x0,  0x14, 0xe6, 0x49, 0xbb, 0x13, 0x58, 0xe1, 0xbe, 0x9c, 0x9c, 0x45, 0xf9, 0x84, 0x12, 0xf4, 0x33, 0x76, 0x9e,
      0x90, 0xb6, 0x46, 0x0,  0x1a, 0x83, 0xee, 0x8a, 0xe1, 0xf,  0xcc, 0x72, 0xc8, 0x23, 0x16, 0x3f, 0xea, 0x26, 0x1b,
      0x67, 0x34, 0xb0, 0xd5, 0x33, 0xe3, 0x3b, 0x92, 0xe4, 0xd1, 0x6b, 0xf6, 0x16, 0x0,  0xb,  0xfe, 0xac, 0x8a, 0xe2,
      0x22, 0x62, 0x66, 0x76, 0xb3, 0xdc, 0xa6, 0x15, 0x0,  0x13, 0x54, 0x6c, 0x54, 0x55, 0x1a, 0x71, 0x5a, 0x55, 0xbb,
      0x8,  0x9c, 0xa0, 0x38, 0xe0, 0xf4, 0xfc, 0x18, 0xbe, 0x98, 0x1a, 0x0,  0x5,  0xf6, 0xa4, 0xa0, 0x7a, 0x5a, 0x28,
      0x0,  0x3,  0x0,  0x0,  0x21, 0x73, 0x1b, 0x26, 0x0,  0x19, 0xfd, 0x1e, 0x49, 0x81, 0x9e, 0xdf, 0x49, 0x54, 0x9c,
      0xba, 0x12, 0x7e, 0xa1, 0xa1, 0xc2, 0x2f, 0x82, 0xb3, 0xa8, 0xd5, 0x56, 0x58, 0xf7, 0x51, 0x59, 0x0,  0x2,  0x64,
      0x35, 0x26, 0x0,  0xf,  0x71, 0xcf, 0xad, 0xbc, 0xdd, 0xb7, 0xc2, 0xdf, 0x9b, 0xb5, 0xc1, 0x2f, 0x63, 0xf7, 0x61,
      0x0,  0x17, 0xec, 0x64, 0xdb, 0x70, 0x4a, 0x25, 0x13, 0x67, 0x66, 0x31, 0xbd, 0xc4, 0xa6, 0xe3, 0xe0, 0x15, 0x78,
      0xf3, 0x24, 0x17, 0xc2, 0xa3, 0x93, 0x2,  0x0,  0x0,  0x23, 0x77, 0x24, 0x4a, 0x17, 0x39, 0x0,  0x19, 0x62, 0x1d,
      0xd7, 0xb6, 0x51, 0x48, 0x1f, 0x6a, 0x4b, 0x72, 0xe6, 0x81, 0x8e, 0x3f, 0x51, 0x81, 0x55, 0x45, 0xf3, 0x93, 0x6e,
      0xe5, 0xa0, 0x29, 0x89, 0x2e, 0x0,  0x14, 0xa4, 0x19, 0x79, 0x43, 0xfe, 0xe1, 0x2,  0x33, 0x33, 0x5f, 0x4,  0x41,
      0x73, 0x4d, 0x22, 0x7f, 0xec, 0x33, 0x6a, 0x79, 0x22, 0x0,  0x9,  0x7d, 0x9f, 0x64, 0x67, 0x45, 0x5e, 0xc8, 0xda,
      0x76, 0x16, 0x0,  0x10, 0x12, 0xf9, 0xd9, 0xb8, 0x7f, 0x93, 0x97, 0x67, 0x80, 0xa9, 0x7d, 0xdd, 0xa8, 0xec, 0x7e,
      0x6c, 0x15, 0x0,  0x14, 0xe3, 0xac, 0x19, 0x93, 0x65, 0x4c, 0xc7, 0x42, 0x20, 0x1f, 0x4c, 0x78, 0x50, 0xd2, 0x7,
      0x34, 0x61, 0x73, 0xbf, 0xe8, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x62, 0x1d, 0xd7, 0xb6, 0x51, 0x48, 0x1f, 0x6a, 0x4b, 0x72, 0xe6, 0x81, 0x8e,
                                     0x3f, 0x51, 0x81, 0x55, 0x45, 0xf3, 0x93, 0x6e, 0xe5, 0xa0, 0x29, 0x89};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa4, 0x19, 0x79, 0x43, 0xfe, 0xe1, 0x2,  0x33, 0x33, 0x5f,
                                     0x4,  0x41, 0x73, 0x4d, 0x22, 0x7f, 0xec, 0x33, 0x6a, 0x79};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7d, 0x9f, 0x64, 0x67, 0x45, 0x5e, 0xc8, 0xda, 0x76};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x12, 0xf9, 0xd9, 0xb8, 0x7f, 0x93, 0x97, 0x67,
                                     0x80, 0xa9, 0x7d, 0xdd, 0xa8, 0xec, 0x7e, 0x6c};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe3, 0xac, 0x19, 0x93, 0x65, 0x4c, 0xc7, 0x42, 0x20, 0x1f,
                                     0x4c, 0x78, 0x50, 0xd2, 0x7,  0x34, 0x61, 0x73, 0xbf, 0xe8};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0xbe, 0x10, 0x1c, 0x86, 0x63, 0x8d, 0xff, 0xb5, 0x22, 0xf8, 0x7a, 0xce, 0x4e, 0x9, 0x40,
                           0xa0, 0x7b, 0xc8, 0x5d, 0x16, 0x8c, 0xc,  0xc6, 0xe8, 0xb0, 0x3e, 0xfc, 0xf3, 0x9, 0xcb};
  uint8_t bytesprops2[] = {0x83, 0xee, 0x8a, 0xe1, 0xf,  0xcc, 0x72, 0xc8, 0x23, 0x16, 0x3f, 0xea, 0x26,
                           0x1b, 0x67, 0x34, 0xb0, 0xd5, 0x33, 0xe3, 0x3b, 0x92, 0xe4, 0xd1, 0x6b, 0xf6};
  uint8_t bytesprops1[] = {0xe6, 0x49, 0xbb, 0x13, 0x58, 0xe1, 0xbe, 0x9c, 0x9c, 0x45,
                           0xf9, 0x84, 0x12, 0xf4, 0x33, 0x76, 0x9e, 0x90, 0xb6, 0x46};
  uint8_t bytesprops3[] = {0xfe, 0xac, 0x8a, 0xe2, 0x22, 0x62, 0x66, 0x76, 0xb3, 0xdc, 0xa6};
  uint8_t bytesprops4[] = {0x54, 0x6c, 0x54, 0x55, 0x1a, 0x71, 0x5a, 0x55, 0xbb, 0x8,
                           0x9c, 0xa0, 0x38, 0xe0, 0xf4, 0xfc, 0x18, 0xbe, 0x98};
  uint8_t bytesprops5[] = {0xf6, 0xa4, 0xa0, 0x7a, 0x5a};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops8[] = {0x64, 0x35};
  uint8_t bytesprops7[] = {0xfd, 0x1e, 0x49, 0x81, 0x9e, 0xdf, 0x49, 0x54, 0x9c, 0xba, 0x12, 0x7e, 0xa1,
                           0xa1, 0xc2, 0x2f, 0x82, 0xb3, 0xa8, 0xd5, 0x56, 0x58, 0xf7, 0x51, 0x59};
  uint8_t bytesprops10[] = {0xec, 0x64, 0xdb, 0x70, 0x4a, 0x25, 0x13, 0x67, 0x66, 0x31, 0xbd, 0xc4,
                            0xa6, 0xe3, 0xe0, 0x15, 0x78, 0xf3, 0x24, 0x17, 0xc2, 0xa3, 0x93};
  uint8_t bytesprops9[] = {0x71, 0xcf, 0xad, 0xbc, 0xdd, 0xb7, 0xc2, 0xdf, 0x9b, 0xb5, 0xc1, 0x2f, 0x63, 0xf7, 0x61};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29184}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29191}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31897}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26301}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {26, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29467}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops7}, .v = {2, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops9}, .v = {23, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9079}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 57}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30616, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27910 [("\146\183",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("\190\186\217w\248\160\225))",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\178\157\206\191\161S\255!{\198\145\131E2\133W2",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\181\210p\180\241\184\&6\233r\192\145\128\159Q1\210\199",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\DLE5#\237\150\213-\170\158\FS\165\166\EOTJ\249\144T\SOH\158`N\200\168B\EM",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropTopicAlias
// 16384,PropRequestResponseInformation 139,PropTopicAliasMaximum 1928,PropTopicAlias 30103,PropMaximumPacketSize
// 20035,PropAssignedClientIdentifier "l\ETB!k",PropReasonString "",PropSubscriptionIdentifierAvailable
// 81,PropSubscriptionIdentifier 19,PropMessageExpiryInterval 6072,PropSubscriptionIdentifierAvailable
// 15,PropAuthenticationMethod
// "\205\240\131\NAK@\225a\134\146\191\128\DC4\165\228\161'\157\130C\USb\NAKl\174\US",PropAssignedClientIdentifier
// "*O9\212p$\STX\219\129!^\130\168\173\136",PropContentType "1\186\178
// &\163s\188^K\173\184\229\174\184K\172\US\246+2\192\151\133R\210\182\DC1",PropReasonString
// "\145E[\218\131\&3",PropResponseInformation
// "#2\198b\246Q\149x\178\149\US\216~\178\147\193\168\150n+\a\137\234",PropRetainAvailable 219]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x82, 0xf0, 0x1,  0x6d, 0x6,  0x97, 0x1,  0x23, 0x40, 0x0,  0x19, 0x8b, 0x22, 0x7,  0x88, 0x23, 0x75, 0x97, 0x27,
      0x0,  0x0,  0x4e, 0x43, 0x12, 0x0,  0x4,  0x6c, 0x17, 0x21, 0x6b, 0x1f, 0x0,  0x0,  0x29, 0x51, 0xb,  0x13, 0x2,
      0x0,  0x0,  0x17, 0xb8, 0x29, 0xf,  0x15, 0x0,  0x19, 0xcd, 0xf0, 0x83, 0x15, 0x40, 0xe1, 0x61, 0x86, 0x92, 0xbf,
      0x80, 0x14, 0xa5, 0xe4, 0xa1, 0x27, 0x9d, 0x82, 0x43, 0x1f, 0x62, 0x15, 0x6c, 0xae, 0x1f, 0x12, 0x0,  0xf,  0x2a,
      0x4f, 0x39, 0xd4, 0x70, 0x24, 0x2,  0xdb, 0x81, 0x21, 0x5e, 0x82, 0xa8, 0xad, 0x88, 0x3,  0x0,  0x1c, 0x31, 0xba,
      0xb2, 0x20, 0x26, 0xa3, 0x73, 0xbc, 0x5e, 0x4b, 0xad, 0xb8, 0xe5, 0xae, 0xb8, 0x4b, 0xac, 0x1f, 0xf6, 0x2b, 0x32,
      0xc0, 0x97, 0x85, 0x52, 0xd2, 0xb6, 0x11, 0x1f, 0x0,  0x6,  0x91, 0x45, 0x5b, 0xda, 0x83, 0x33, 0x1a, 0x0,  0x17,
      0x23, 0x32, 0xc6, 0x62, 0xf6, 0x51, 0x95, 0x78, 0xb2, 0x95, 0x1f, 0xd8, 0x7e, 0xb2, 0x93, 0xc1, 0xa8, 0x96, 0x6e,
      0x2b, 0x7,  0x89, 0xea, 0x25, 0xdb, 0x0,  0x2,  0x92, 0xb7, 0x2a, 0x0,  0x9,  0xbe, 0xba, 0xd9, 0x77, 0xf8, 0xa0,
      0xe1, 0x29, 0x29, 0x16, 0x0,  0x11, 0xb2, 0x9d, 0xce, 0xbf, 0xa1, 0x53, 0xff, 0x21, 0x7b, 0xc6, 0x91, 0x83, 0x45,
      0x32, 0x85, 0x57, 0x32, 0x6,  0x0,  0x11, 0xb5, 0xd2, 0x70, 0xb4, 0xf1, 0xb8, 0x36, 0xe9, 0x72, 0xc0, 0x91, 0x80,
      0x9f, 0x51, 0x31, 0xd2, 0xc7, 0xe,  0x0,  0x19, 0x10, 0x35, 0x23, 0xed, 0x96, 0xd5, 0x2d, 0xaa, 0x9e, 0x1c, 0xa5,
      0xa6, 0x4,  0x4a, 0xf9, 0x90, 0x54, 0x1,  0x9e, 0x60, 0x4e, 0xc8, 0xa8, 0x42, 0x19, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x92, 0xb7};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbe, 0xba, 0xd9, 0x77, 0xf8, 0xa0, 0xe1, 0x29, 0x29};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb2, 0x9d, 0xce, 0xbf, 0xa1, 0x53, 0xff, 0x21, 0x7b,
                                     0xc6, 0x91, 0x83, 0x45, 0x32, 0x85, 0x57, 0x32};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb5, 0xd2, 0x70, 0xb4, 0xf1, 0xb8, 0x36, 0xe9, 0x72,
                                     0xc0, 0x91, 0x80, 0x9f, 0x51, 0x31, 0xd2, 0xc7};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x10, 0x35, 0x23, 0xed, 0x96, 0xd5, 0x2d, 0xaa, 0x9e, 0x1c, 0xa5, 0xa6, 0x4,
                                     0x4a, 0xf9, 0x90, 0x54, 0x1,  0x9e, 0x60, 0x4e, 0xc8, 0xa8, 0x42, 0x19};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0x6c, 0x17, 0x21, 0x6b};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0xcd, 0xf0, 0x83, 0x15, 0x40, 0xe1, 0x61, 0x86, 0x92, 0xbf, 0x80, 0x14, 0xa5,
                           0xe4, 0xa1, 0x27, 0x9d, 0x82, 0x43, 0x1f, 0x62, 0x15, 0x6c, 0xae, 0x1f};
  uint8_t bytesprops3[] = {0x2a, 0x4f, 0x39, 0xd4, 0x70, 0x24, 0x2, 0xdb, 0x81, 0x21, 0x5e, 0x82, 0xa8, 0xad, 0x88};
  uint8_t bytesprops4[] = {0x31, 0xba, 0xb2, 0x20, 0x26, 0xa3, 0x73, 0xbc, 0x5e, 0x4b, 0xad, 0xb8, 0xe5, 0xae,
                           0xb8, 0x4b, 0xac, 0x1f, 0xf6, 0x2b, 0x32, 0xc0, 0x97, 0x85, 0x52, 0xd2, 0xb6, 0x11};
  uint8_t bytesprops5[] = {0x91, 0x45, 0x5b, 0xda, 0x83, 0x33};
  uint8_t bytesprops6[] = {0x23, 0x32, 0xc6, 0x62, 0xf6, 0x51, 0x95, 0x78, 0xb2, 0x95, 0x1f, 0xd8,
                           0x7e, 0xb2, 0x93, 0xc1, 0xa8, 0x96, 0x6e, 0x2b, 0x7,  0x89, 0xea};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16384}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1928}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30103}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20035}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6072}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27910, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31365 [("\241\182\221\CAN\nn8\n\144\151\&9\198\NUL<>\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),(".6V",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("N\199\249\DC2\184\STX\149\167\166je\254\207\152\130\210\151\ETB\144\RS\162\130\128\207I\DLE~\162\244<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\162\199}\255V\131",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS1}),("\215\SOM\234!\158\&7\167\225\183\250\173",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("&\v\205\128\233\230\187\129\181\128S\NUL\222\253\185$*\180i\183",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\135z\215D\NAK\225\197",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("v\236\188\199\GS\206N.\208J\187\188q~\n\173.\199\154\SIQ\215\&7",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("d\128\&5B\227\&7\DC3\221\200",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0})] [PropResponseInformation "\150\142\";\245\DC4",PropAuthenticationMethod
// "\142\197%iY\t\156\255V\203\167\DLEA\SYN5\159Rb.`L|\SO%\GS\157=\SYN",PropReasonString
// "}\253\139\EM\150\229\RS",PropResponseTopic "=`\216\230\156\148\240\148\223\188bA\161z\144\196\143",PropResponseTopic
// "5\229\214\SOt\234)\r\129\181\200\r\229\209\DLE\213\238\146\ETX\177\131",PropCorrelationData "",PropTopicAliasMaximum
// 20281,PropAuthenticationMethod "\203\204k\"\168\132M\194\133\157\b@\155\&9"]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x82, 0x91, 0x2,  0x7a, 0x85, 0x75, 0x1a, 0x0,  0x6,  0x96, 0x8e, 0x22, 0x3b, 0xf5, 0x14, 0x15, 0x0,  0x1c, 0x8e,
      0xc5, 0x25, 0x69, 0x59, 0x9,  0x9c, 0xff, 0x56, 0xcb, 0xa7, 0x10, 0x41, 0x16, 0x35, 0x9f, 0x52, 0x62, 0x2e, 0x60,
      0x4c, 0x7c, 0xe,  0x25, 0x1d, 0x9d, 0x3d, 0x16, 0x1f, 0x0,  0x7,  0x7d, 0xfd, 0x8b, 0x19, 0x96, 0xe5, 0x1e, 0x8,
      0x0,  0x11, 0x3d, 0x60, 0xd8, 0xe6, 0x9c, 0x94, 0xf0, 0x94, 0xdf, 0xbc, 0x62, 0x41, 0xa1, 0x7a, 0x90, 0xc4, 0x8f,
      0x8,  0x0,  0x15, 0x35, 0xe5, 0xd6, 0xe,  0x74, 0xea, 0x29, 0xd,  0x81, 0xb5, 0xc8, 0xd,  0xe5, 0xd1, 0x10, 0xd5,
      0xee, 0x92, 0x3,  0xb1, 0x83, 0x9,  0x0,  0x0,  0x22, 0x4f, 0x39, 0x15, 0x0,  0xe,  0xcb, 0xcc, 0x6b, 0x22, 0xa8,
      0x84, 0x4d, 0xc2, 0x85, 0x9d, 0x8,  0x40, 0x9b, 0x39, 0x0,  0x10, 0xf1, 0xb6, 0xdd, 0x18, 0xa,  0x6e, 0x38, 0xa,
      0x90, 0x97, 0x39, 0xc6, 0x0,  0x3c, 0x3e, 0xd4, 0xc,  0x0,  0x3,  0x2e, 0x36, 0x56, 0x22, 0x0,  0x1e, 0x4e, 0xc7,
      0xf9, 0x12, 0xb8, 0x2,  0x95, 0xa7, 0xa6, 0x6a, 0x65, 0xfe, 0xcf, 0x98, 0x82, 0xd2, 0x97, 0x17, 0x90, 0x1e, 0xa2,
      0x82, 0x80, 0xcf, 0x49, 0x10, 0x7e, 0xa2, 0xf4, 0x3c, 0x8,  0x0,  0x6,  0xa2, 0xc7, 0x7d, 0xff, 0x56, 0x83, 0x15,
      0x0,  0xc,  0xd7, 0xe,  0x4d, 0xea, 0x21, 0x9e, 0x37, 0xa7, 0xe1, 0xb7, 0xfa, 0xad, 0x2a, 0x0,  0x14, 0x26, 0xb,
      0xcd, 0x80, 0xe9, 0xe6, 0xbb, 0x81, 0xb5, 0x80, 0x53, 0x0,  0xde, 0xfd, 0xb9, 0x24, 0x2a, 0xb4, 0x69, 0xb7, 0x18,
      0x0,  0x7,  0x87, 0x7a, 0xd7, 0x44, 0x15, 0xe1, 0xc5, 0x10, 0x0,  0x17, 0x76, 0xec, 0xbc, 0xc7, 0x1d, 0xce, 0x4e,
      0x2e, 0xd0, 0x4a, 0xbb, 0xbc, 0x71, 0x7e, 0xa,  0xad, 0x2e, 0xc7, 0x9a, 0xf,  0x51, 0xd7, 0x37, 0x6,  0x0,  0x9,
      0x64, 0x80, 0x35, 0x42, 0xe3, 0x37, 0x13, 0xdd, 0xc8, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xf1, 0xb6, 0xdd, 0x18, 0xa, 0x6e, 0x38, 0xa,
                                     0x90, 0x97, 0x39, 0xc6, 0x0, 0x3c, 0x3e, 0xd4};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2e, 0x36, 0x56};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4e, 0xc7, 0xf9, 0x12, 0xb8, 0x2,  0x95, 0xa7, 0xa6, 0x6a,
                                     0x65, 0xfe, 0xcf, 0x98, 0x82, 0xd2, 0x97, 0x17, 0x90, 0x1e,
                                     0xa2, 0x82, 0x80, 0xcf, 0x49, 0x10, 0x7e, 0xa2, 0xf4, 0x3c};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa2, 0xc7, 0x7d, 0xff, 0x56, 0x83};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd7, 0xe, 0x4d, 0xea, 0x21, 0x9e, 0x37, 0xa7, 0xe1, 0xb7, 0xfa, 0xad};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x26, 0xb, 0xcd, 0x80, 0xe9, 0xe6, 0xbb, 0x81, 0xb5, 0x80,
                                     0x53, 0x0, 0xde, 0xfd, 0xb9, 0x24, 0x2a, 0xb4, 0x69, 0xb7};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x87, 0x7a, 0xd7, 0x44, 0x15, 0xe1, 0xc5};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x76, 0xec, 0xbc, 0xc7, 0x1d, 0xce, 0x4e, 0x2e, 0xd0, 0x4a, 0xbb, 0xbc,
                                     0x71, 0x7e, 0xa,  0xad, 0x2e, 0xc7, 0x9a, 0xf,  0x51, 0xd7, 0x37};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x64, 0x80, 0x35, 0x42, 0xe3, 0x37, 0x13, 0xdd, 0xc8};
  lwmqtt_string_t topic_filter_s8 = {9, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0x96, 0x8e, 0x22, 0x3b, 0xf5, 0x14};
  uint8_t bytesprops1[] = {0x8e, 0xc5, 0x25, 0x69, 0x59, 0x9,  0x9c, 0xff, 0x56, 0xcb, 0xa7, 0x10, 0x41, 0x16,
                           0x35, 0x9f, 0x52, 0x62, 0x2e, 0x60, 0x4c, 0x7c, 0xe,  0x25, 0x1d, 0x9d, 0x3d, 0x16};
  uint8_t bytesprops2[] = {0x7d, 0xfd, 0x8b, 0x19, 0x96, 0xe5, 0x1e};
  uint8_t bytesprops3[] = {0x3d, 0x60, 0xd8, 0xe6, 0x9c, 0x94, 0xf0, 0x94, 0xdf,
                           0xbc, 0x62, 0x41, 0xa1, 0x7a, 0x90, 0xc4, 0x8f};
  uint8_t bytesprops4[] = {0x35, 0xe5, 0xd6, 0xe,  0x74, 0xea, 0x29, 0xd, 0x81, 0xb5, 0xc8,
                           0xd,  0xe5, 0xd1, 0x10, 0xd5, 0xee, 0x92, 0x3, 0xb1, 0x83};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0xcb, 0xcc, 0x6b, 0x22, 0xa8, 0x84, 0x4d, 0xc2, 0x85, 0x9d, 0x8, 0x40, 0x9b, 0x39};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20281}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 31365, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3963 [("&\249+\165\255",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2})] [PropTopicAliasMaximum 15126,PropMessageExpiryInterval 4277,PropTopicAlias
// 4146,PropRequestProblemInformation 97,PropMaximumPacketSize 4331,PropSharedSubscriptionAvailable
// 226,PropRetainAvailable 242,PropWillDelayInterval 30502,PropServerReference "\132\189p\225q\153rV\203\130%"]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0x34, 0xf,  0x7b, 0x29, 0x22, 0x3b, 0x16, 0x2,  0x0,  0x0,  0x10, 0xb5, 0x23,
                   0x10, 0x32, 0x17, 0x61, 0x27, 0x0,  0x0,  0x10, 0xeb, 0x2a, 0xe2, 0x25, 0xf2, 0x18,
                   0x0,  0x0,  0x77, 0x26, 0x1c, 0x0,  0xb,  0x84, 0xbd, 0x70, 0xe1, 0x71, 0x99, 0x72,
                   0x56, 0xcb, 0x82, 0x25, 0x0,  0x5,  0x26, 0xf9, 0x2b, 0xa5, 0xff, 0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x26, 0xf9, 0x2b, 0xa5, 0xff};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0x84, 0xbd, 0x70, 0xe1, 0x71, 0x99, 0x72, 0x56, 0xcb, 0x82, 0x25};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15126}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4277}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4146}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4331}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30502}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3963, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27481 [("\173\187\212\&85\132\164-<\f",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("j\187\191\158GB4
// \150\146\235\244\140\&1\188\t\220\225\SI+O\165\163\DLE'\SI\226\221\181\254",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\210\&5",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("a\169{+\204\189x\GS{`\\\195",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("Q\\\225<Tp\204<>\194\n\180\179d|\208<\202R,\183\137\RSh",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("^\135\131R\219\\\129W@5`^\130\225?\243\200\157",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("Z\177\195\252s\ESCh\253 \b\f6\DC4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\166\138\DC3\154:7\189]-\201p\160\223*R,\224",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("6\EM\165\136\194\149\NULb\236I\138\FS\207\&5qi\206\228\169i\r\252\132R\237",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0xb5, 0x1,  0x6b, 0x59, 0x0,  0x0,  0xa,  0xad, 0xbb, 0xd4, 0x38, 0x35, 0x84, 0xa4, 0x2d, 0x3c,
                   0xc,  0x1d, 0x0,  0x1e, 0x6a, 0xbb, 0xbf, 0x9e, 0x47, 0x42, 0x34, 0x20, 0x96, 0x92, 0xeb, 0xf4, 0x8c,
                   0x31, 0xbc, 0x9,  0xdc, 0xe1, 0xf,  0x2b, 0x4f, 0xa5, 0xa3, 0x10, 0x27, 0xf,  0xe2, 0xdd, 0xb5, 0xfe,
                   0x12, 0x0,  0x2,  0xd2, 0x35, 0x16, 0x0,  0xc,  0x61, 0xa9, 0x7b, 0x2b, 0xcc, 0xbd, 0x78, 0x1d, 0x7b,
                   0x60, 0x5c, 0xc3, 0x20, 0x0,  0x18, 0x51, 0x5c, 0xe1, 0x3c, 0x54, 0x70, 0xcc, 0x3c, 0x3e, 0xc2, 0xa,
                   0xb4, 0xb3, 0x64, 0x7c, 0xd0, 0x3c, 0xca, 0x52, 0x2c, 0xb7, 0x89, 0x1e, 0x68, 0x2a, 0x0,  0x12, 0x5e,
                   0x87, 0x83, 0x52, 0xdb, 0x5c, 0x81, 0x57, 0x40, 0x35, 0x60, 0x5e, 0x82, 0xe1, 0x3f, 0xf3, 0xc8, 0x9d,
                   0x6,  0x0,  0xd,  0x5a, 0xb1, 0xc3, 0xfc, 0x73, 0x1b, 0x68, 0xfd, 0x20, 0x8,  0xc,  0x36, 0x14, 0x6,
                   0x0,  0x11, 0xa6, 0x8a, 0x13, 0x9a, 0x3a, 0x37, 0xbd, 0x5d, 0x2d, 0xc9, 0x70, 0xa0, 0xdf, 0x2a, 0x52,
                   0x2c, 0xe0, 0xa,  0x0,  0x19, 0x36, 0x19, 0xa5, 0x88, 0xc2, 0x95, 0x0,  0x62, 0xec, 0x49, 0x8a, 0x1c,
                   0xcf, 0x35, 0x71, 0x69, 0xce, 0xe4, 0xa9, 0x69, 0xd,  0xfc, 0x84, 0x52, 0xed, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xad, 0xbb, 0xd4, 0x38, 0x35, 0x84, 0xa4, 0x2d, 0x3c, 0xc};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0xbb, 0xbf, 0x9e, 0x47, 0x42, 0x34, 0x20, 0x96, 0x92,
                                     0xeb, 0xf4, 0x8c, 0x31, 0xbc, 0x9,  0xdc, 0xe1, 0xf,  0x2b,
                                     0x4f, 0xa5, 0xa3, 0x10, 0x27, 0xf,  0xe2, 0xdd, 0xb5, 0xfe};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd2, 0x35};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x61, 0xa9, 0x7b, 0x2b, 0xcc, 0xbd, 0x78, 0x1d, 0x7b, 0x60, 0x5c, 0xc3};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x51, 0x5c, 0xe1, 0x3c, 0x54, 0x70, 0xcc, 0x3c, 0x3e, 0xc2, 0xa,  0xb4,
                                     0xb3, 0x64, 0x7c, 0xd0, 0x3c, 0xca, 0x52, 0x2c, 0xb7, 0x89, 0x1e, 0x68};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5e, 0x87, 0x83, 0x52, 0xdb, 0x5c, 0x81, 0x57, 0x40,
                                     0x35, 0x60, 0x5e, 0x82, 0xe1, 0x3f, 0xf3, 0xc8, 0x9d};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5a, 0xb1, 0xc3, 0xfc, 0x73, 0x1b, 0x68, 0xfd, 0x20, 0x8, 0xc, 0x36, 0x14};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa6, 0x8a, 0x13, 0x9a, 0x3a, 0x37, 0xbd, 0x5d, 0x2d,
                                     0xc9, 0x70, 0xa0, 0xdf, 0x2a, 0x52, 0x2c, 0xe0};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x36, 0x19, 0xa5, 0x88, 0xc2, 0x95, 0x0,  0x62, 0xec, 0x49, 0x8a, 0x1c, 0xcf,
                                     0x35, 0x71, 0x69, 0xce, 0xe4, 0xa9, 0x69, 0xd,  0xfc, 0x84, 0x52, 0xed};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27481, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32387
// [("\205Yv\244\133\240o\244\240\227\&6\170r\201\GS\177\160\165\236\219\187K\FS\205\151\152",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\164\170z",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False,
// _subQoS = QoS1})] [PropContentType
// "\180\152w\228\156\212\184=\145}\222\233e\NAK\147\246\178;\EOT\v>ADt\176\130\244\151g\166",PropRequestResponseInformation
// 80,PropSharedSubscriptionAvailable 77,PropMessageExpiryInterval 13371,PropTopicAliasMaximum
// 31269,PropResponseInformation "\\\248\"\136|\205\SOH\199\t\EM,\f\130\150\145\NUL\209\197[Or",PropServerKeepAlive
// 27813,PropMessageExpiryInterval 4055,PropResponseInformation "\206\154\235\a",PropMaximumPacketSize
// 22528,PropAuthenticationData "\249\178\159\175\&8W\220ZP\135\135\145\ESC\154\180qm\215",PropRequestProblemInformation
// 145,PropAuthenticationData "",PropWildcardSubscriptionAvailable 69,PropSubscriptionIdentifier
// 16,PropResponseInformation "\187\139\137",PropContentType "\DEL\240\137",PropAssignedClientIdentifier
// "\246;O\145\161\200\SOY6\186\246\155\v\US0\229Z&\131\202\220\175v\142\132c\ESC\220\167&",PropSessionExpiryInterval
// 27386,PropWildcardSubscriptionAvailable 84,PropReceiveMaximum 20115,PropMaximumPacketSize
// 27201,PropWildcardSubscriptionAvailable 252,PropSessionExpiryInterval 21491,PropRetainAvailable
// 238,PropMessageExpiryInterval 11536,PropWildcardSubscriptionAvailable 92,PropRequestResponseInformation
// 103,PropAuthenticationData
// "\198\183\ACKLl\180H\200\194\209\200)\252\149!\195\199\156\226\191x\218{\250\SOH\235\254\226\158"]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0x8c, 0x2,  0x7e, 0x83, 0xe5, 0x1,  0x3,  0x0,  0x1e, 0xb4, 0x98, 0x77, 0xe4, 0x9c, 0xd4, 0xb8,
                   0x3d, 0x91, 0x7d, 0xde, 0xe9, 0x65, 0x15, 0x93, 0xf6, 0xb2, 0x3b, 0x4,  0xb,  0x3e, 0x41, 0x44, 0x74,
                   0xb0, 0x82, 0xf4, 0x97, 0x67, 0xa6, 0x19, 0x50, 0x2a, 0x4d, 0x2,  0x0,  0x0,  0x34, 0x3b, 0x22, 0x7a,
                   0x25, 0x1a, 0x0,  0x15, 0x5c, 0xf8, 0x22, 0x88, 0x7c, 0xcd, 0x1,  0xc7, 0x9,  0x19, 0x2c, 0xc,  0x82,
                   0x96, 0x91, 0x0,  0xd1, 0xc5, 0x5b, 0x4f, 0x72, 0x13, 0x6c, 0xa5, 0x2,  0x0,  0x0,  0xf,  0xd7, 0x1a,
                   0x0,  0x4,  0xce, 0x9a, 0xeb, 0x7,  0x27, 0x0,  0x0,  0x58, 0x0,  0x16, 0x0,  0x12, 0xf9, 0xb2, 0x9f,
                   0xaf, 0x38, 0x57, 0xdc, 0x5a, 0x50, 0x87, 0x87, 0x91, 0x1b, 0x9a, 0xb4, 0x71, 0x6d, 0xd7, 0x17, 0x91,
                   0x16, 0x0,  0x0,  0x28, 0x45, 0xb,  0x10, 0x1a, 0x0,  0x3,  0xbb, 0x8b, 0x89, 0x3,  0x0,  0x3,  0x7f,
                   0xf0, 0x89, 0x12, 0x0,  0x1e, 0xf6, 0x3b, 0x4f, 0x91, 0xa1, 0xc8, 0xe,  0x59, 0x36, 0xba, 0xf6, 0x9b,
                   0xb,  0x1f, 0x30, 0xe5, 0x5a, 0x26, 0x83, 0xca, 0xdc, 0xaf, 0x76, 0x8e, 0x84, 0x63, 0x1b, 0xdc, 0xa7,
                   0x26, 0x11, 0x0,  0x0,  0x6a, 0xfa, 0x28, 0x54, 0x21, 0x4e, 0x93, 0x27, 0x0,  0x0,  0x6a, 0x41, 0x28,
                   0xfc, 0x11, 0x0,  0x0,  0x53, 0xf3, 0x25, 0xee, 0x2,  0x0,  0x0,  0x2d, 0x10, 0x28, 0x5c, 0x19, 0x67,
                   0x16, 0x0,  0x1d, 0xc6, 0xb7, 0x6,  0x4c, 0x6c, 0xb4, 0x48, 0xc8, 0xc2, 0xd1, 0xc8, 0x29, 0xfc, 0x95,
                   0x21, 0xc3, 0xc7, 0x9c, 0xe2, 0xbf, 0x78, 0xda, 0x7b, 0xfa, 0x1,  0xeb, 0xfe, 0xe2, 0x9e, 0x0,  0x1a,
                   0xcd, 0x59, 0x76, 0xf4, 0x85, 0xf0, 0x6f, 0xf4, 0xf0, 0xe3, 0x36, 0xaa, 0x72, 0xc9, 0x1d, 0xb1, 0xa0,
                   0xa5, 0xec, 0xdb, 0xbb, 0x4b, 0x1c, 0xcd, 0x97, 0x98, 0x14, 0x0,  0x3,  0xa4, 0xaa, 0x7a, 0x19};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xcd, 0x59, 0x76, 0xf4, 0x85, 0xf0, 0x6f, 0xf4, 0xf0, 0xe3, 0x36, 0xaa, 0x72,
                                     0xc9, 0x1d, 0xb1, 0xa0, 0xa5, 0xec, 0xdb, 0xbb, 0x4b, 0x1c, 0xcd, 0x97, 0x98};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa4, 0xaa, 0x7a};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0xb4, 0x98, 0x77, 0xe4, 0x9c, 0xd4, 0xb8, 0x3d, 0x91, 0x7d, 0xde, 0xe9, 0x65, 0x15, 0x93,
                           0xf6, 0xb2, 0x3b, 0x4,  0xb,  0x3e, 0x41, 0x44, 0x74, 0xb0, 0x82, 0xf4, 0x97, 0x67, 0xa6};
  uint8_t bytesprops1[] = {0x5c, 0xf8, 0x22, 0x88, 0x7c, 0xcd, 0x1,  0xc7, 0x9,  0x19, 0x2c,
                           0xc,  0x82, 0x96, 0x91, 0x0,  0xd1, 0xc5, 0x5b, 0x4f, 0x72};
  uint8_t bytesprops2[] = {0xce, 0x9a, 0xeb, 0x7};
  uint8_t bytesprops3[] = {0xf9, 0xb2, 0x9f, 0xaf, 0x38, 0x57, 0xdc, 0x5a, 0x50,
                           0x87, 0x87, 0x91, 0x1b, 0x9a, 0xb4, 0x71, 0x6d, 0xd7};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0xbb, 0x8b, 0x89};
  uint8_t bytesprops6[] = {0x7f, 0xf0, 0x89};
  uint8_t bytesprops7[] = {0xf6, 0x3b, 0x4f, 0x91, 0xa1, 0xc8, 0xe,  0x59, 0x36, 0xba, 0xf6, 0x9b, 0xb,  0x1f, 0x30,
                           0xe5, 0x5a, 0x26, 0x83, 0xca, 0xdc, 0xaf, 0x76, 0x8e, 0x84, 0x63, 0x1b, 0xdc, 0xa7, 0x26};
  uint8_t bytesprops8[] = {0xc6, 0xb7, 0x6,  0x4c, 0x6c, 0xb4, 0x48, 0xc8, 0xc2, 0xd1, 0xc8, 0x29, 0xfc, 0x95, 0x21,
                           0xc3, 0xc7, 0x9c, 0xe2, 0xbf, 0x78, 0xda, 0x7b, 0xfa, 0x1,  0xeb, 0xfe, 0xe2, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13371}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31269}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27813}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4055}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22528}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27386}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20115}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27201}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21491}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11536}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32387, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27695 [("\244savN\237\&9\ETB\SUB\239C\CAN\184a\157b\NUL\151u\142\230\r",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("D\153\DC2\SOH",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\SYN\139\192\ETB\205fr\136\n\229V\162C\DC3\130\ENQ\DC1\228\179\196C\192\RS\DEL",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\149\140\bL\128\SI\252T",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\164\138\235VW\242\242\a\134\243\168\215tQK\DLE\179\202\207\250A\EM\226\174]\a",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("!W\178\139't\202\166K\r\223\151",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS2}),("\180\239\139\STX\NULd",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\133\235X3\227\134\248\236\248\231",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\170\153\226",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS1})] [PropWildcardSubscriptionAvailable 234,PropReceiveMaximum 14285,PropResponseTopic
// "\172\210\DC2V\192\181\r\246 \134\220\223\158g\ESC\253[\177A\159;",PropAuthenticationMethod
// "I\179\204z]\EMI\129}T<\198",PropCorrelationData
// "\227\228\229\232\195\192)\252o;\166u\160\155\GS\199*\184Z\ENQ\151x",PropReceiveMaximum
// 19610,PropMessageExpiryInterval 13043,PropServerKeepAlive 8811,PropReasonString
// "\184\203\209\211\252\175\\\198\165\234\b\131\NAK)\208z2\214M]\132",PropAssignedClientIdentifier
// "o\244$c\DLET\ENQ\190\188n\232\222\DC4\181\189y\211\208 \211\163\130\193\212V\178\139s",PropUserProperty
// "\128\156T\160\146\244;\154\a~\135\201K\128\253\169{e\175\ACK" "o8\153\tujsS#\162~",PropUserProperty
// "y\188\150\225\160Q\214\228\189,C" "\170\215`\226\186\ENQ\156\"z\190O%\182\&7{9z\218>"]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x82, 0xe0, 0x2,  0x6c, 0x2f, 0xce, 0x1,  0x28, 0xea, 0x21, 0x37, 0xcd, 0x8,  0x0,  0x15, 0xac, 0xd2, 0x12, 0x56,
      0xc0, 0xb5, 0xd,  0xf6, 0x20, 0x86, 0xdc, 0xdf, 0x9e, 0x67, 0x1b, 0xfd, 0x5b, 0xb1, 0x41, 0x9f, 0x3b, 0x15, 0x0,
      0xc,  0x49, 0xb3, 0xcc, 0x7a, 0x5d, 0x19, 0x49, 0x81, 0x7d, 0x54, 0x3c, 0xc6, 0x9,  0x0,  0x16, 0xe3, 0xe4, 0xe5,
      0xe8, 0xc3, 0xc0, 0x29, 0xfc, 0x6f, 0x3b, 0xa6, 0x75, 0xa0, 0x9b, 0x1d, 0xc7, 0x2a, 0xb8, 0x5a, 0x5,  0x97, 0x78,
      0x21, 0x4c, 0x9a, 0x2,  0x0,  0x0,  0x32, 0xf3, 0x13, 0x22, 0x6b, 0x1f, 0x0,  0x15, 0xb8, 0xcb, 0xd1, 0xd3, 0xfc,
      0xaf, 0x5c, 0xc6, 0xa5, 0xea, 0x8,  0x83, 0x15, 0x29, 0xd0, 0x7a, 0x32, 0xd6, 0x4d, 0x5d, 0x84, 0x12, 0x0,  0x1c,
      0x6f, 0xf4, 0x24, 0x63, 0x10, 0x54, 0x5,  0xbe, 0xbc, 0x6e, 0xe8, 0xde, 0x14, 0xb5, 0xbd, 0x79, 0xd3, 0xd0, 0x20,
      0xd3, 0xa3, 0x82, 0xc1, 0xd4, 0x56, 0xb2, 0x8b, 0x73, 0x26, 0x0,  0x14, 0x80, 0x9c, 0x54, 0xa0, 0x92, 0xf4, 0x3b,
      0x9a, 0x7,  0x7e, 0x87, 0xc9, 0x4b, 0x80, 0xfd, 0xa9, 0x7b, 0x65, 0xaf, 0x6,  0x0,  0xb,  0x6f, 0x38, 0x99, 0x9,
      0x75, 0x6a, 0x73, 0x53, 0x23, 0xa2, 0x7e, 0x26, 0x0,  0xb,  0x79, 0xbc, 0x96, 0xe1, 0xa0, 0x51, 0xd6, 0xe4, 0xbd,
      0x2c, 0x43, 0x0,  0x13, 0xaa, 0xd7, 0x60, 0xe2, 0xba, 0x5,  0x9c, 0x22, 0x7a, 0xbe, 0x4f, 0x25, 0xb6, 0x37, 0x7b,
      0x39, 0x7a, 0xda, 0x3e, 0x0,  0x16, 0xf4, 0x73, 0x61, 0x76, 0x4e, 0xed, 0x39, 0x17, 0x1a, 0xef, 0x43, 0x18, 0xb8,
      0x61, 0x9d, 0x62, 0x0,  0x97, 0x75, 0x8e, 0xe6, 0xd,  0x9,  0x0,  0x4,  0x44, 0x99, 0x12, 0x1,  0x18, 0x0,  0x18,
      0x16, 0x8b, 0xc0, 0x17, 0xcd, 0x66, 0x72, 0x88, 0xa,  0xe5, 0x56, 0xa2, 0x43, 0x13, 0x82, 0x5,  0x11, 0xe4, 0xb3,
      0xc4, 0x43, 0xc0, 0x1e, 0x7f, 0xd,  0x0,  0x8,  0x95, 0x8c, 0x8,  0x4c, 0x80, 0xf,  0xfc, 0x54, 0x18, 0x0,  0x1a,
      0xa4, 0x8a, 0xeb, 0x56, 0x57, 0xf2, 0xf2, 0x7,  0x86, 0xf3, 0xa8, 0xd7, 0x74, 0x51, 0x4b, 0x10, 0xb3, 0xca, 0xcf,
      0xfa, 0x41, 0x19, 0xe2, 0xae, 0x5d, 0x7,  0x12, 0x0,  0xc,  0x21, 0x57, 0xb2, 0x8b, 0x27, 0x74, 0xca, 0xa6, 0x4b,
      0xd,  0xdf, 0x97, 0x2a, 0x0,  0x6,  0xb4, 0xef, 0x8b, 0x2,  0x0,  0x64, 0x29, 0x0,  0xa,  0x85, 0xeb, 0x58, 0x33,
      0xe3, 0x86, 0xf8, 0xec, 0xf8, 0xe7, 0xc,  0x0,  0x3,  0xaa, 0x99, 0xe2, 0x25};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0x73, 0x61, 0x76, 0x4e, 0xed, 0x39, 0x17, 0x1a, 0xef, 0x43,
                                     0x18, 0xb8, 0x61, 0x9d, 0x62, 0x0,  0x97, 0x75, 0x8e, 0xe6, 0xd};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x44, 0x99, 0x12, 0x1};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x16, 0x8b, 0xc0, 0x17, 0xcd, 0x66, 0x72, 0x88, 0xa,  0xe5, 0x56, 0xa2,
                                     0x43, 0x13, 0x82, 0x5,  0x11, 0xe4, 0xb3, 0xc4, 0x43, 0xc0, 0x1e, 0x7f};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x95, 0x8c, 0x8, 0x4c, 0x80, 0xf, 0xfc, 0x54};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa4, 0x8a, 0xeb, 0x56, 0x57, 0xf2, 0xf2, 0x7,  0x86, 0xf3, 0xa8, 0xd7, 0x74,
                                     0x51, 0x4b, 0x10, 0xb3, 0xca, 0xcf, 0xfa, 0x41, 0x19, 0xe2, 0xae, 0x5d, 0x7};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x21, 0x57, 0xb2, 0x8b, 0x27, 0x74, 0xca, 0xa6, 0x4b, 0xd, 0xdf, 0x97};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb4, 0xef, 0x8b, 0x2, 0x0, 0x64};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x85, 0xeb, 0x58, 0x33, 0xe3, 0x86, 0xf8, 0xec, 0xf8, 0xe7};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xaa, 0x99, 0xe2};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0xac, 0xd2, 0x12, 0x56, 0xc0, 0xb5, 0xd,  0xf6, 0x20, 0x86, 0xdc,
                           0xdf, 0x9e, 0x67, 0x1b, 0xfd, 0x5b, 0xb1, 0x41, 0x9f, 0x3b};
  uint8_t bytesprops1[] = {0x49, 0xb3, 0xcc, 0x7a, 0x5d, 0x19, 0x49, 0x81, 0x7d, 0x54, 0x3c, 0xc6};
  uint8_t bytesprops2[] = {0xe3, 0xe4, 0xe5, 0xe8, 0xc3, 0xc0, 0x29, 0xfc, 0x6f, 0x3b, 0xa6,
                           0x75, 0xa0, 0x9b, 0x1d, 0xc7, 0x2a, 0xb8, 0x5a, 0x5,  0x97, 0x78};
  uint8_t bytesprops3[] = {0xb8, 0xcb, 0xd1, 0xd3, 0xfc, 0xaf, 0x5c, 0xc6, 0xa5, 0xea, 0x8,
                           0x83, 0x15, 0x29, 0xd0, 0x7a, 0x32, 0xd6, 0x4d, 0x5d, 0x84};
  uint8_t bytesprops4[] = {0x6f, 0xf4, 0x24, 0x63, 0x10, 0x54, 0x5,  0xbe, 0xbc, 0x6e, 0xe8, 0xde, 0x14, 0xb5,
                           0xbd, 0x79, 0xd3, 0xd0, 0x20, 0xd3, 0xa3, 0x82, 0xc1, 0xd4, 0x56, 0xb2, 0x8b, 0x73};
  uint8_t bytesprops6[] = {0x6f, 0x38, 0x99, 0x9, 0x75, 0x6a, 0x73, 0x53, 0x23, 0xa2, 0x7e};
  uint8_t bytesprops5[] = {0x80, 0x9c, 0x54, 0xa0, 0x92, 0xf4, 0x3b, 0x9a, 0x7,  0x7e,
                           0x87, 0xc9, 0x4b, 0x80, 0xfd, 0xa9, 0x7b, 0x65, 0xaf, 0x6};
  uint8_t bytesprops8[] = {0xaa, 0xd7, 0x60, 0xe2, 0xba, 0x5,  0x9c, 0x22, 0x7a, 0xbe,
                           0x4f, 0x25, 0xb6, 0x37, 0x7b, 0x39, 0x7a, 0xda, 0x3e};
  uint8_t bytesprops7[] = {0x79, 0xbc, 0x96, 0xe1, 0xa0, 0x51, 0xd6, 0xe4, 0xbd, 0x2c, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14285}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19610}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13043}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8811}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops5}, .v = {11, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops7}, .v = {19, (char*)&bytesprops8}}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27695, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29411 [(")\137\189d\189&\250#\214n1\GS\218A\245\158\136\t;\247\175:A\180\233",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\209\DLEs\183`\203\204*\136K\202\223k",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = True, _noLocal = True, _subQoS =
// QoS2}),("\214?\172zE\154=\DLE\186u!\132\140a\183\249\&3\189\186)\139\SUB",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropSharedSubscriptionAvailable
// 165,PropRequestResponseInformation 235,PropAuthenticationMethod
// "\DC2\t\188\157&$\245\GSX\196zgV\211\138q\208\196>\DLE\232\198f\166\224\223",PropAssignedClientIdentifier
// "EH",PropRetainAvailable 186,PropMessageExpiryInterval 4196,PropMessageExpiryInterval
// 5834,PropRequestResponseInformation 226,PropRequestProblemInformation 73,PropContentType "<",PropRetainAvailable
// 62,PropCorrelationData "2\ESC\245\&0",PropWildcardSubscriptionAvailable 39,PropRetainAvailable
// 243,PropCorrelationData ":\150\175\195\204\EOT\133\245\202\NUL\160\240_\NUL\219\251<\228",PropAuthenticationData
// "\245\EM\159B\215\228\255\166@4B?*'|G\143"]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x82, 0xb8, 0x1,  0x72, 0xe3, 0x70, 0x2a, 0xa5, 0x19, 0xeb, 0x15, 0x0,  0x1a, 0x12, 0x9,  0xbc, 0x9d, 0x26, 0x24,
      0xf5, 0x1d, 0x58, 0xc4, 0x7a, 0x67, 0x56, 0xd3, 0x8a, 0x71, 0xd0, 0xc4, 0x3e, 0x10, 0xe8, 0xc6, 0x66, 0xa6, 0xe0,
      0xdf, 0x12, 0x0,  0x2,  0x45, 0x48, 0x25, 0xba, 0x2,  0x0,  0x0,  0x10, 0x64, 0x2,  0x0,  0x0,  0x16, 0xca, 0x19,
      0xe2, 0x17, 0x49, 0x3,  0x0,  0x1,  0x3c, 0x25, 0x3e, 0x9,  0x0,  0x4,  0x32, 0x1b, 0xf5, 0x30, 0x28, 0x27, 0x25,
      0xf3, 0x9,  0x0,  0x12, 0x3a, 0x96, 0xaf, 0xc3, 0xcc, 0x4,  0x85, 0xf5, 0xca, 0x0,  0xa0, 0xf0, 0x5f, 0x0,  0xdb,
      0xfb, 0x3c, 0xe4, 0x16, 0x0,  0x11, 0xf5, 0x19, 0x9f, 0x42, 0xd7, 0xe4, 0xff, 0xa6, 0x40, 0x34, 0x42, 0x3f, 0x2a,
      0x27, 0x7c, 0x47, 0x8f, 0x0,  0x19, 0x29, 0x89, 0xbd, 0x64, 0xbd, 0x26, 0xfa, 0x23, 0xd6, 0x6e, 0x31, 0x1d, 0xda,
      0x41, 0xf5, 0x9e, 0x88, 0x9,  0x3b, 0xf7, 0xaf, 0x3a, 0x41, 0xb4, 0xe9, 0x16, 0x0,  0xd,  0xd1, 0x10, 0x73, 0xb7,
      0x60, 0xcb, 0xcc, 0x2a, 0x88, 0x4b, 0xca, 0xdf, 0x6b, 0x1e, 0x0,  0x16, 0xd6, 0x3f, 0xac, 0x7a, 0x45, 0x9a, 0x3d,
      0x10, 0xba, 0x75, 0x21, 0x84, 0x8c, 0x61, 0xb7, 0xf9, 0x33, 0xbd, 0xba, 0x29, 0x8b, 0x1a, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x29, 0x89, 0xbd, 0x64, 0xbd, 0x26, 0xfa, 0x23, 0xd6, 0x6e, 0x31, 0x1d, 0xda,
                                     0x41, 0xf5, 0x9e, 0x88, 0x9,  0x3b, 0xf7, 0xaf, 0x3a, 0x41, 0xb4, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd1, 0x10, 0x73, 0xb7, 0x60, 0xcb, 0xcc, 0x2a, 0x88, 0x4b, 0xca, 0xdf, 0x6b};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd6, 0x3f, 0xac, 0x7a, 0x45, 0x9a, 0x3d, 0x10, 0xba, 0x75, 0x21,
                                     0x84, 0x8c, 0x61, 0xb7, 0xf9, 0x33, 0xbd, 0xba, 0x29, 0x8b, 0x1a};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0x12, 0x9,  0xbc, 0x9d, 0x26, 0x24, 0xf5, 0x1d, 0x58, 0xc4, 0x7a, 0x67, 0x56,
                           0xd3, 0x8a, 0x71, 0xd0, 0xc4, 0x3e, 0x10, 0xe8, 0xc6, 0x66, 0xa6, 0xe0, 0xdf};
  uint8_t bytesprops1[] = {0x45, 0x48};
  uint8_t bytesprops2[] = {0x3c};
  uint8_t bytesprops3[] = {0x32, 0x1b, 0xf5, 0x30};
  uint8_t bytesprops4[] = {0x3a, 0x96, 0xaf, 0xc3, 0xcc, 0x4,  0x85, 0xf5, 0xca,
                           0x0,  0xa0, 0xf0, 0x5f, 0x0,  0xdb, 0xfb, 0x3c, 0xe4};
  uint8_t bytesprops5[] = {0xf5, 0x19, 0x9f, 0x42, 0xd7, 0xe4, 0xff, 0xa6, 0x40,
                           0x34, 0x42, 0x3f, 0x2a, 0x27, 0x7c, 0x47, 0x8f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4196}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5834}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29411, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22557 [("#\164A\r\139\STX;\197\SIwh\SYN\201\230\252\196\208K",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\137\185l\EOT\205\r\219\t.\239j\181j,*k\255\SO}L",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("d\196T\247\DC4\198\165\SUB1\a\181\255",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\ACK\155R\SYN\217\207\&3\145V\215ws\192\177\184S",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("#\161\214\195\f@H\130\av\155\169\241\157\251\196\231\233\135V\142",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("/\172\STX\DC2\"`\224+\179{\129\239\180\165\221\248\189\133",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\169\228LZ\199^-&\NAKA\f\129\251\EOT]\FS\185h\190Zn6\252\DLE\187\153\170d\148",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\251\166\176\214=\STX\232\&4\248\r\254\\\184(\142\213\SO\140L\217\DC4\221y\202\169\138\206\145\182\192",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\170*\229'\207\130\193\237\139\159>\223\200\200\153\SOH\132\208\190\DC2\153\190\213O\190\DLE.\\y",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropCorrelationData "\219\232\\\149f\b\DLE\248\250\168O\137Z\145\179\NULo\131\221",PropMaximumQoS
// 52,PropReasonString "n\SUB\132\189\253\138\247t",PropTopicAlias 31150,PropServerReference
// "\149w\214w\141\f\DC3\216\f\163\133\198^g\164\255\207\r\188a\201",PropReceiveMaximum 12814,PropServerReference
// ")\241C38s\146\152\ESCu\195\201\FS",PropAssignedClientIdentifier "\225",PropReceiveMaximum 26923,PropServerKeepAlive
// 21509,PropAuthenticationData
// "\\\228>xr[\227\207\154\DC3z\ETX\SYN\FSnw\163\195\139\240+&\168k\180\128",PropSharedSubscriptionAvailable
// 181,PropSharedSubscriptionAvailable 46,PropAssignedClientIdentifier
// "\DC3\218\251\245a\157\158\192\250\193?/\143\183P\180\189\ACK\146\250_",PropAuthenticationData
// "\172-jq\222\188^4\250\241\161\EM\133\189\245\142\228\148\216\238Q\179\SO\134&6?\ETB]\244",PropRetainAvailable
// 16,PropSharedSubscriptionAvailable 13,PropReceiveMaximum 25304,PropMessageExpiryInterval 30495,PropServerReference
// "yH\210U\184\&6\GS\a\131\148\&1",PropReceiveMaximum 2552,PropSessionExpiryInterval 29036,PropSessionExpiryInterval
// 17544,PropSubscriptionIdentifier 28,PropAuthenticationMethod
// "?\187\128M\206f\225\177G\175AJ0\156\185\219h\219\231\&5\138on\248\157"]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0xda, 0x3,  0x58, 0x1d, 0xfa, 0x1,  0x9,  0x0,  0x13, 0xdb, 0xe8, 0x5c, 0x95, 0x66, 0x8,  0x10, 0xf8, 0xfa,
      0xa8, 0x4f, 0x89, 0x5a, 0x91, 0xb3, 0x0,  0x6f, 0x83, 0xdd, 0x24, 0x34, 0x1f, 0x0,  0x8,  0x6e, 0x1a, 0x84, 0xbd,
      0xfd, 0x8a, 0xf7, 0x74, 0x23, 0x79, 0xae, 0x1c, 0x0,  0x15, 0x95, 0x77, 0xd6, 0x77, 0x8d, 0xc,  0x13, 0xd8, 0xc,
      0xa3, 0x85, 0xc6, 0x5e, 0x67, 0xa4, 0xff, 0xcf, 0xd,  0xbc, 0x61, 0xc9, 0x21, 0x32, 0xe,  0x1c, 0x0,  0xd,  0x29,
      0xf1, 0x43, 0x33, 0x38, 0x73, 0x92, 0x98, 0x1b, 0x75, 0xc3, 0xc9, 0x1c, 0x12, 0x0,  0x1,  0xe1, 0x21, 0x69, 0x2b,
      0x13, 0x54, 0x5,  0x16, 0x0,  0x1a, 0x5c, 0xe4, 0x3e, 0x78, 0x72, 0x5b, 0xe3, 0xcf, 0x9a, 0x13, 0x7a, 0x3,  0x16,
      0x1c, 0x6e, 0x77, 0xa3, 0xc3, 0x8b, 0xf0, 0x2b, 0x26, 0xa8, 0x6b, 0xb4, 0x80, 0x2a, 0xb5, 0x2a, 0x2e, 0x12, 0x0,
      0x15, 0x13, 0xda, 0xfb, 0xf5, 0x61, 0x9d, 0x9e, 0xc0, 0xfa, 0xc1, 0x3f, 0x2f, 0x8f, 0xb7, 0x50, 0xb4, 0xbd, 0x6,
      0x92, 0xfa, 0x5f, 0x16, 0x0,  0x1e, 0xac, 0x2d, 0x6a, 0x71, 0xde, 0xbc, 0x5e, 0x34, 0xfa, 0xf1, 0xa1, 0x19, 0x85,
      0xbd, 0xf5, 0x8e, 0xe4, 0x94, 0xd8, 0xee, 0x51, 0xb3, 0xe,  0x86, 0x26, 0x36, 0x3f, 0x17, 0x5d, 0xf4, 0x25, 0x10,
      0x2a, 0xd,  0x21, 0x62, 0xd8, 0x2,  0x0,  0x0,  0x77, 0x1f, 0x1c, 0x0,  0xb,  0x79, 0x48, 0xd2, 0x55, 0xb8, 0x36,
      0x1d, 0x7,  0x83, 0x94, 0x31, 0x21, 0x9,  0xf8, 0x11, 0x0,  0x0,  0x71, 0x6c, 0x11, 0x0,  0x0,  0x44, 0x88, 0xb,
      0x1c, 0x15, 0x0,  0x19, 0x3f, 0xbb, 0x80, 0x4d, 0xce, 0x66, 0xe1, 0xb1, 0x47, 0xaf, 0x41, 0x4a, 0x30, 0x9c, 0xb9,
      0xdb, 0x68, 0xdb, 0xe7, 0x35, 0x8a, 0x6f, 0x6e, 0xf8, 0x9d, 0x0,  0x12, 0x23, 0xa4, 0x41, 0xd,  0x8b, 0x2,  0x3b,
      0xc5, 0xf,  0x77, 0x68, 0x16, 0xc9, 0xe6, 0xfc, 0xc4, 0xd0, 0x4b, 0x10, 0x0,  0x14, 0x89, 0xb9, 0x6c, 0x4,  0xcd,
      0xd,  0xdb, 0x9,  0x2e, 0xef, 0x6a, 0xb5, 0x6a, 0x2c, 0x2a, 0x6b, 0xff, 0xe,  0x7d, 0x4c, 0x25, 0x0,  0xc,  0x64,
      0xc4, 0x54, 0xf7, 0x14, 0xc6, 0xa5, 0x1a, 0x31, 0x7,  0xb5, 0xff, 0x1a, 0x0,  0x10, 0x6,  0x9b, 0x52, 0x16, 0xd9,
      0xcf, 0x33, 0x91, 0x56, 0xd7, 0x77, 0x73, 0xc0, 0xb1, 0xb8, 0x53, 0x14, 0x0,  0x15, 0x23, 0xa1, 0xd6, 0xc3, 0xc,
      0x40, 0x48, 0x82, 0x7,  0x76, 0x9b, 0xa9, 0xf1, 0x9d, 0xfb, 0xc4, 0xe7, 0xe9, 0x87, 0x56, 0x8e, 0x1,  0x0,  0x12,
      0x2f, 0xac, 0x2,  0x12, 0x22, 0x60, 0xe0, 0x2b, 0xb3, 0x7b, 0x81, 0xef, 0xb4, 0xa5, 0xdd, 0xf8, 0xbd, 0x85, 0xc,
      0x0,  0x1d, 0xa9, 0xe4, 0x4c, 0x5a, 0xc7, 0x5e, 0x2d, 0x26, 0x15, 0x41, 0xc,  0x81, 0xfb, 0x4,  0x5d, 0x1c, 0xb9,
      0x68, 0xbe, 0x5a, 0x6e, 0x36, 0xfc, 0x10, 0xbb, 0x99, 0xaa, 0x64, 0x94, 0x16, 0x0,  0x1e, 0xfb, 0xa6, 0xb0, 0xd6,
      0x3d, 0x2,  0xe8, 0x34, 0xf8, 0xd,  0xfe, 0x5c, 0xb8, 0x28, 0x8e, 0xd5, 0xe,  0x8c, 0x4c, 0xd9, 0x14, 0xdd, 0x79,
      0xca, 0xa9, 0x8a, 0xce, 0x91, 0xb6, 0xc0, 0xa,  0x0,  0x1d, 0xaa, 0x2a, 0xe5, 0x27, 0xcf, 0x82, 0xc1, 0xed, 0x8b,
      0x9f, 0x3e, 0xdf, 0xc8, 0xc8, 0x99, 0x1,  0x84, 0xd0, 0xbe, 0x12, 0x99, 0xbe, 0xd5, 0x4f, 0xbe, 0x10, 0x2e, 0x5c,
      0x79, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x23, 0xa4, 0x41, 0xd,  0x8b, 0x2,  0x3b, 0xc5, 0xf,
                                     0x77, 0x68, 0x16, 0xc9, 0xe6, 0xfc, 0xc4, 0xd0, 0x4b};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x89, 0xb9, 0x6c, 0x4,  0xcd, 0xd,  0xdb, 0x9, 0x2e, 0xef,
                                     0x6a, 0xb5, 0x6a, 0x2c, 0x2a, 0x6b, 0xff, 0xe, 0x7d, 0x4c};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x64, 0xc4, 0x54, 0xf7, 0x14, 0xc6, 0xa5, 0x1a, 0x31, 0x7, 0xb5, 0xff};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6,  0x9b, 0x52, 0x16, 0xd9, 0xcf, 0x33, 0x91,
                                     0x56, 0xd7, 0x77, 0x73, 0xc0, 0xb1, 0xb8, 0x53};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x23, 0xa1, 0xd6, 0xc3, 0xc,  0x40, 0x48, 0x82, 0x7,  0x76, 0x9b,
                                     0xa9, 0xf1, 0x9d, 0xfb, 0xc4, 0xe7, 0xe9, 0x87, 0x56, 0x8e};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2f, 0xac, 0x2,  0x12, 0x22, 0x60, 0xe0, 0x2b, 0xb3,
                                     0x7b, 0x81, 0xef, 0xb4, 0xa5, 0xdd, 0xf8, 0xbd, 0x85};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa9, 0xe4, 0x4c, 0x5a, 0xc7, 0x5e, 0x2d, 0x26, 0x15, 0x41,
                                     0xc,  0x81, 0xfb, 0x4,  0x5d, 0x1c, 0xb9, 0x68, 0xbe, 0x5a,
                                     0x6e, 0x36, 0xfc, 0x10, 0xbb, 0x99, 0xaa, 0x64, 0x94};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfb, 0xa6, 0xb0, 0xd6, 0x3d, 0x2,  0xe8, 0x34, 0xf8, 0xd,
                                     0xfe, 0x5c, 0xb8, 0x28, 0x8e, 0xd5, 0xe,  0x8c, 0x4c, 0xd9,
                                     0x14, 0xdd, 0x79, 0xca, 0xa9, 0x8a, 0xce, 0x91, 0xb6, 0xc0};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xaa, 0x2a, 0xe5, 0x27, 0xcf, 0x82, 0xc1, 0xed, 0x8b, 0x9f,
                                     0x3e, 0xdf, 0xc8, 0xc8, 0x99, 0x1,  0x84, 0xd0, 0xbe, 0x12,
                                     0x99, 0xbe, 0xd5, 0x4f, 0xbe, 0x10, 0x2e, 0x5c, 0x79};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0xdb, 0xe8, 0x5c, 0x95, 0x66, 0x8, 0x10, 0xf8, 0xfa, 0xa8,
                           0x4f, 0x89, 0x5a, 0x91, 0xb3, 0x0, 0x6f, 0x83, 0xdd};
  uint8_t bytesprops1[] = {0x6e, 0x1a, 0x84, 0xbd, 0xfd, 0x8a, 0xf7, 0x74};
  uint8_t bytesprops2[] = {0x95, 0x77, 0xd6, 0x77, 0x8d, 0xc,  0x13, 0xd8, 0xc,  0xa3, 0x85,
                           0xc6, 0x5e, 0x67, 0xa4, 0xff, 0xcf, 0xd,  0xbc, 0x61, 0xc9};
  uint8_t bytesprops3[] = {0x29, 0xf1, 0x43, 0x33, 0x38, 0x73, 0x92, 0x98, 0x1b, 0x75, 0xc3, 0xc9, 0x1c};
  uint8_t bytesprops4[] = {0xe1};
  uint8_t bytesprops5[] = {0x5c, 0xe4, 0x3e, 0x78, 0x72, 0x5b, 0xe3, 0xcf, 0x9a, 0x13, 0x7a, 0x3,  0x16,
                           0x1c, 0x6e, 0x77, 0xa3, 0xc3, 0x8b, 0xf0, 0x2b, 0x26, 0xa8, 0x6b, 0xb4, 0x80};
  uint8_t bytesprops6[] = {0x13, 0xda, 0xfb, 0xf5, 0x61, 0x9d, 0x9e, 0xc0, 0xfa, 0xc1, 0x3f,
                           0x2f, 0x8f, 0xb7, 0x50, 0xb4, 0xbd, 0x6,  0x92, 0xfa, 0x5f};
  uint8_t bytesprops7[] = {0xac, 0x2d, 0x6a, 0x71, 0xde, 0xbc, 0x5e, 0x34, 0xfa, 0xf1, 0xa1, 0x19, 0x85, 0xbd, 0xf5,
                           0x8e, 0xe4, 0x94, 0xd8, 0xee, 0x51, 0xb3, 0xe,  0x86, 0x26, 0x36, 0x3f, 0x17, 0x5d, 0xf4};
  uint8_t bytesprops8[] = {0x79, 0x48, 0xd2, 0x55, 0xb8, 0x36, 0x1d, 0x7, 0x83, 0x94, 0x31};
  uint8_t bytesprops9[] = {0x3f, 0xbb, 0x80, 0x4d, 0xce, 0x66, 0xe1, 0xb1, 0x47, 0xaf, 0x41, 0x4a, 0x30,
                           0x9c, 0xb9, 0xdb, 0x68, 0xdb, 0xe7, 0x35, 0x8a, 0x6f, 0x6e, 0xf8, 0x9d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31150}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12814}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26923}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21509}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25304}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30495}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2552}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29036}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17544}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22557, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10879 [("k\CAN\STX\230?\231\199\145\130\DLE\182\233W\233\&5F\250\153Hoip\242W\164",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\t\253\178\254a\b\217\143\162\FS\221\238PG\177\229\208*\DEL$k\160O\DLEs`\132\DC2\NAKV",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\216/\149I\232hE\247*RW\244\251\134\204",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\FS9Yu\225\234\246\SOHB>\199#\188\"i\162<\168\185?\219`\237\163\NUL%",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\201\177D\132y\246}ad\135\228\US<H2]V\255\158e\223\255\250",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("=\205o\NAK",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\131\207\&6W\195
// gL\178\218\130\152u\209>\t",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("\132lyi].N\135g\164se\160\235!n\158\239MqZ",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] [PropMaximumPacketSize
// 5146,PropSessionExpiryInterval 25344,PropSubscriptionIdentifier 9,PropMessageExpiryInterval
// 11213,PropWillDelayInterval 9631,PropRequestResponseInformation 142,PropResponseTopic
// "\170\224\174/\170\135\131\ENQ\235\194\247h",PropUserProperty ";T\ETX]^\235;F|\153Z\157/h\242'c|\147\178M!"
// "7\238KB\173\223%4\178a\RS\US\174~\157k\145\158\141\EM\184\242_\221<\170\&9\214",PropRetainAvailable
// 235,PropWillDelayInterval 23966,PropMessageExpiryInterval 27117,PropContentType "W\166",PropMessageExpiryInterval
// 2184,PropAssignedClientIdentifier "\181\&1\145;\250\248p1\144\145z\DC1\236",PropContentType
// "\238\168G\197\219\136\142i\243\&8I\220eyc\163\254e\f\193\f)SB\205\246\188B",PropWildcardSubscriptionAvailable
// 5,PropMessageExpiryInterval 2521,PropMaximumQoS 243,PropSubscriptionIdentifier 8,PropRequestResponseInformation
// 226,PropSharedSubscriptionAvailable 105,PropPayloadFormatIndicator 50,PropWildcardSubscriptionAvailable
// 13,PropAssignedClientIdentifier "0wW[P\155;\165A",PropMessageExpiryInterval 8553,PropTopicAliasMaximum
// 21395,PropSubscriptionIdentifier 18,PropMaximumQoS 178,PropContentType
// "\r`\209\159\254\ACK\148\236\161+\185\&6%\201~\198MC",PropReasonString "\170\215y\147\243U\216\222UI"]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0xac, 0x3,  0x2a, 0x7f, 0xf0, 0x1,  0x27, 0x0,  0x0,  0x14, 0x1a, 0x11, 0x0,  0x0,  0x63, 0x0,  0xb,  0x9,
      0x2,  0x0,  0x0,  0x2b, 0xcd, 0x18, 0x0,  0x0,  0x25, 0x9f, 0x19, 0x8e, 0x8,  0x0,  0xc,  0xaa, 0xe0, 0xae, 0x2f,
      0xaa, 0x87, 0x83, 0x5,  0xeb, 0xc2, 0xf7, 0x68, 0x26, 0x0,  0x16, 0x3b, 0x54, 0x3,  0x5d, 0x5e, 0xeb, 0x3b, 0x46,
      0x7c, 0x99, 0x5a, 0x9d, 0x2f, 0x68, 0xf2, 0x27, 0x63, 0x7c, 0x93, 0xb2, 0x4d, 0x21, 0x0,  0x1c, 0x37, 0xee, 0x4b,
      0x42, 0xad, 0xdf, 0x25, 0x34, 0xb2, 0x61, 0x1e, 0x1f, 0xae, 0x7e, 0x9d, 0x6b, 0x91, 0x9e, 0x8d, 0x19, 0xb8, 0xf2,
      0x5f, 0xdd, 0x3c, 0xaa, 0x39, 0xd6, 0x25, 0xeb, 0x18, 0x0,  0x0,  0x5d, 0x9e, 0x2,  0x0,  0x0,  0x69, 0xed, 0x3,
      0x0,  0x2,  0x57, 0xa6, 0x2,  0x0,  0x0,  0x8,  0x88, 0x12, 0x0,  0xd,  0xb5, 0x31, 0x91, 0x3b, 0xfa, 0xf8, 0x70,
      0x31, 0x90, 0x91, 0x7a, 0x11, 0xec, 0x3,  0x0,  0x1c, 0xee, 0xa8, 0x47, 0xc5, 0xdb, 0x88, 0x8e, 0x69, 0xf3, 0x38,
      0x49, 0xdc, 0x65, 0x79, 0x63, 0xa3, 0xfe, 0x65, 0xc,  0xc1, 0xc,  0x29, 0x53, 0x42, 0xcd, 0xf6, 0xbc, 0x42, 0x28,
      0x5,  0x2,  0x0,  0x0,  0x9,  0xd9, 0x24, 0xf3, 0xb,  0x8,  0x19, 0xe2, 0x2a, 0x69, 0x1,  0x32, 0x28, 0xd,  0x12,
      0x0,  0x9,  0x30, 0x77, 0x57, 0x5b, 0x50, 0x9b, 0x3b, 0xa5, 0x41, 0x2,  0x0,  0x0,  0x21, 0x69, 0x22, 0x53, 0x93,
      0xb,  0x12, 0x24, 0xb2, 0x3,  0x0,  0x12, 0xd,  0x60, 0xd1, 0x9f, 0xfe, 0x6,  0x94, 0xec, 0xa1, 0x2b, 0xb9, 0x36,
      0x25, 0xc9, 0x7e, 0xc6, 0x4d, 0x43, 0x1f, 0x0,  0xa,  0xaa, 0xd7, 0x79, 0x93, 0xf3, 0x55, 0xd8, 0xde, 0x55, 0x49,
      0x0,  0x19, 0x6b, 0x18, 0x2,  0xe6, 0x3f, 0xe7, 0xc7, 0x91, 0x82, 0x10, 0xb6, 0xe9, 0x57, 0xe9, 0x35, 0x46, 0xfa,
      0x99, 0x48, 0x6f, 0x69, 0x70, 0xf2, 0x57, 0xa4, 0x2d, 0x0,  0x1e, 0x9,  0xfd, 0xb2, 0xfe, 0x61, 0x8,  0xd9, 0x8f,
      0xa2, 0x1c, 0xdd, 0xee, 0x50, 0x47, 0xb1, 0xe5, 0xd0, 0x2a, 0x7f, 0x24, 0x6b, 0xa0, 0x4f, 0x10, 0x73, 0x60, 0x84,
      0x12, 0x15, 0x56, 0x8,  0x0,  0xf,  0xd8, 0x2f, 0x95, 0x49, 0xe8, 0x68, 0x45, 0xf7, 0x2a, 0x52, 0x57, 0xf4, 0xfb,
      0x86, 0xcc, 0x20, 0x0,  0x1a, 0x1c, 0x39, 0x59, 0x75, 0xe1, 0xea, 0xf6, 0x1,  0x42, 0x3e, 0xc7, 0x23, 0xbc, 0x22,
      0x69, 0xa2, 0x3c, 0xa8, 0xb9, 0x3f, 0xdb, 0x60, 0xed, 0xa3, 0x0,  0x25, 0x2e, 0x0,  0x17, 0xc9, 0xb1, 0x44, 0x84,
      0x79, 0xf6, 0x7d, 0x61, 0x64, 0x87, 0xe4, 0x1f, 0x3c, 0x48, 0x32, 0x5d, 0x56, 0xff, 0x9e, 0x65, 0xdf, 0xff, 0xfa,
      0x5,  0x0,  0x4,  0x3d, 0xcd, 0x6f, 0x15, 0x2a, 0x0,  0x10, 0x83, 0xcf, 0x36, 0x57, 0xc3, 0x20, 0x67, 0x4c, 0xb2,
      0xda, 0x82, 0x98, 0x75, 0xd1, 0x3e, 0x9,  0x20, 0x0,  0x15, 0x84, 0x6c, 0x79, 0x69, 0x5d, 0x2e, 0x4e, 0x87, 0x67,
      0xa4, 0x73, 0x65, 0xa0, 0xeb, 0x21, 0x6e, 0x9e, 0xef, 0x4d, 0x71, 0x5a, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0x18, 0x2,  0xe6, 0x3f, 0xe7, 0xc7, 0x91, 0x82, 0x10, 0xb6, 0xe9, 0x57,
                                     0xe9, 0x35, 0x46, 0xfa, 0x99, 0x48, 0x6f, 0x69, 0x70, 0xf2, 0x57, 0xa4};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9,  0xfd, 0xb2, 0xfe, 0x61, 0x8,  0xd9, 0x8f, 0xa2, 0x1c,
                                     0xdd, 0xee, 0x50, 0x47, 0xb1, 0xe5, 0xd0, 0x2a, 0x7f, 0x24,
                                     0x6b, 0xa0, 0x4f, 0x10, 0x73, 0x60, 0x84, 0x12, 0x15, 0x56};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd8, 0x2f, 0x95, 0x49, 0xe8, 0x68, 0x45, 0xf7,
                                     0x2a, 0x52, 0x57, 0xf4, 0xfb, 0x86, 0xcc};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1c, 0x39, 0x59, 0x75, 0xe1, 0xea, 0xf6, 0x1,  0x42, 0x3e, 0xc7, 0x23, 0xbc,
                                     0x22, 0x69, 0xa2, 0x3c, 0xa8, 0xb9, 0x3f, 0xdb, 0x60, 0xed, 0xa3, 0x0,  0x25};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc9, 0xb1, 0x44, 0x84, 0x79, 0xf6, 0x7d, 0x61, 0x64, 0x87, 0xe4, 0x1f,
                                     0x3c, 0x48, 0x32, 0x5d, 0x56, 0xff, 0x9e, 0x65, 0xdf, 0xff, 0xfa};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3d, 0xcd, 0x6f, 0x15};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x83, 0xcf, 0x36, 0x57, 0xc3, 0x20, 0x67, 0x4c,
                                     0xb2, 0xda, 0x82, 0x98, 0x75, 0xd1, 0x3e, 0x9};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x84, 0x6c, 0x79, 0x69, 0x5d, 0x2e, 0x4e, 0x87, 0x67, 0xa4, 0x73,
                                     0x65, 0xa0, 0xeb, 0x21, 0x6e, 0x9e, 0xef, 0x4d, 0x71, 0x5a};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0xaa, 0xe0, 0xae, 0x2f, 0xaa, 0x87, 0x83, 0x5, 0xeb, 0xc2, 0xf7, 0x68};
  uint8_t bytesprops2[] = {0x37, 0xee, 0x4b, 0x42, 0xad, 0xdf, 0x25, 0x34, 0xb2, 0x61, 0x1e, 0x1f, 0xae, 0x7e,
                           0x9d, 0x6b, 0x91, 0x9e, 0x8d, 0x19, 0xb8, 0xf2, 0x5f, 0xdd, 0x3c, 0xaa, 0x39, 0xd6};
  uint8_t bytesprops1[] = {0x3b, 0x54, 0x3,  0x5d, 0x5e, 0xeb, 0x3b, 0x46, 0x7c, 0x99, 0x5a,
                           0x9d, 0x2f, 0x68, 0xf2, 0x27, 0x63, 0x7c, 0x93, 0xb2, 0x4d, 0x21};
  uint8_t bytesprops3[] = {0x57, 0xa6};
  uint8_t bytesprops4[] = {0xb5, 0x31, 0x91, 0x3b, 0xfa, 0xf8, 0x70, 0x31, 0x90, 0x91, 0x7a, 0x11, 0xec};
  uint8_t bytesprops5[] = {0xee, 0xa8, 0x47, 0xc5, 0xdb, 0x88, 0x8e, 0x69, 0xf3, 0x38, 0x49, 0xdc, 0x65, 0x79,
                           0x63, 0xa3, 0xfe, 0x65, 0xc,  0xc1, 0xc,  0x29, 0x53, 0x42, 0xcd, 0xf6, 0xbc, 0x42};
  uint8_t bytesprops6[] = {0x30, 0x77, 0x57, 0x5b, 0x50, 0x9b, 0x3b, 0xa5, 0x41};
  uint8_t bytesprops7[] = {0xd,  0x60, 0xd1, 0x9f, 0xfe, 0x6,  0x94, 0xec, 0xa1,
                           0x2b, 0xb9, 0x36, 0x25, 0xc9, 0x7e, 0xc6, 0x4d, 0x43};
  uint8_t bytesprops8[] = {0xaa, 0xd7, 0x79, 0x93, 0xf3, 0x55, 0xd8, 0xde, 0x55, 0x49};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5146}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25344}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11213}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9631}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops1}, .v = {28, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23966}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27117}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2184}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2521}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8553}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21395}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10879, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26713 [("i",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// True, _subQoS = QoS2}),("0\150\163\DC3)S\193\165K\135\211\DC43\159\\/\250+\200MF\149sGs{t\158",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\180+?\143\187\GS",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS0}),("s\t\186\187\183\237\241gr\201",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\SYN\179\228\226\252EZ\t\240$\ENQ\239JJq",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("D",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropResponseTopic
// "\223\150\233R;\FS\196o:\236\230\&7U\196\135\157\241\193",PropResponseInformation
// "\136\SUB\197qd\255\131\226\DC1\\J\\\206\172\197\NAK\253\189^",PropSessionExpiryInterval 19197,PropContentType
// "p",PropMessageExpiryInterval 25930,PropServerKeepAlive 24518,PropCorrelationData
// "\ENQ:e\DC2\145\ESC\195q\191\143\t\132\bX\154\SYN\210\230\196_`\"\201G",PropSharedSubscriptionAvailable
// 124,PropRequestResponseInformation 109,PropWildcardSubscriptionAvailable 99,PropMessageExpiryInterval
// 3866,PropReasonString "\162\132`\154\166\235\173\155G\215\236T\202!$z\ENQL"]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0xc9, 0x1,  0x68, 0x59, 0x77, 0x8,  0x0,  0x12, 0xdf, 0x96, 0xe9, 0x52, 0x3b, 0x1c, 0xc4, 0x6f,
                   0x3a, 0xec, 0xe6, 0x37, 0x55, 0xc4, 0x87, 0x9d, 0xf1, 0xc1, 0x1a, 0x0,  0x13, 0x88, 0x1a, 0xc5, 0x71,
                   0x64, 0xff, 0x83, 0xe2, 0x11, 0x5c, 0x4a, 0x5c, 0xce, 0xac, 0xc5, 0x15, 0xfd, 0xbd, 0x5e, 0x11, 0x0,
                   0x0,  0x4a, 0xfd, 0x3,  0x0,  0x1,  0x70, 0x2,  0x0,  0x0,  0x65, 0x4a, 0x13, 0x5f, 0xc6, 0x9,  0x0,
                   0x18, 0x5,  0x3a, 0x65, 0x12, 0x91, 0x1b, 0xc3, 0x71, 0xbf, 0x8f, 0x9,  0x84, 0x8,  0x58, 0x9a, 0x16,
                   0xd2, 0xe6, 0xc4, 0x5f, 0x60, 0x22, 0xc9, 0x47, 0x2a, 0x7c, 0x19, 0x6d, 0x28, 0x63, 0x2,  0x0,  0x0,
                   0xf,  0x1a, 0x1f, 0x0,  0x12, 0xa2, 0x84, 0x60, 0x9a, 0xa6, 0xeb, 0xad, 0x9b, 0x47, 0xd7, 0xec, 0x54,
                   0xca, 0x21, 0x24, 0x7a, 0x5,  0x4c, 0x0,  0x1,  0x69, 0xe,  0x0,  0x1c, 0x30, 0x96, 0xa3, 0x13, 0x29,
                   0x53, 0xc1, 0xa5, 0x4b, 0x87, 0xd3, 0x14, 0x33, 0x9f, 0x5c, 0x2f, 0xfa, 0x2b, 0xc8, 0x4d, 0x46, 0x95,
                   0x73, 0x47, 0x73, 0x7b, 0x74, 0x9e, 0xd,  0x0,  0x6,  0xb4, 0x2b, 0x3f, 0x8f, 0xbb, 0x1d, 0x18, 0x0,
                   0xa,  0x73, 0x9,  0xba, 0xbb, 0xb7, 0xed, 0xf1, 0x67, 0x72, 0xc9, 0x14, 0x0,  0xf,  0x16, 0xb3, 0xe4,
                   0xe2, 0xfc, 0x45, 0x5a, 0x9,  0xf0, 0x24, 0x5,  0xef, 0x4a, 0x4a, 0x71, 0x11, 0x0,  0x1,  0x44, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x69};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x30, 0x96, 0xa3, 0x13, 0x29, 0x53, 0xc1, 0xa5, 0x4b, 0x87,
                                     0xd3, 0x14, 0x33, 0x9f, 0x5c, 0x2f, 0xfa, 0x2b, 0xc8, 0x4d,
                                     0x46, 0x95, 0x73, 0x47, 0x73, 0x7b, 0x74, 0x9e};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb4, 0x2b, 0x3f, 0x8f, 0xbb, 0x1d};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x73, 0x9, 0xba, 0xbb, 0xb7, 0xed, 0xf1, 0x67, 0x72, 0xc9};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x16, 0xb3, 0xe4, 0xe2, 0xfc, 0x45, 0x5a, 0x9,
                                     0xf0, 0x24, 0x5,  0xef, 0x4a, 0x4a, 0x71};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x44};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0xdf, 0x96, 0xe9, 0x52, 0x3b, 0x1c, 0xc4, 0x6f, 0x3a,
                           0xec, 0xe6, 0x37, 0x55, 0xc4, 0x87, 0x9d, 0xf1, 0xc1};
  uint8_t bytesprops1[] = {0x88, 0x1a, 0xc5, 0x71, 0x64, 0xff, 0x83, 0xe2, 0x11, 0x5c,
                           0x4a, 0x5c, 0xce, 0xac, 0xc5, 0x15, 0xfd, 0xbd, 0x5e};
  uint8_t bytesprops2[] = {0x70};
  uint8_t bytesprops3[] = {0x5, 0x3a, 0x65, 0x12, 0x91, 0x1b, 0xc3, 0x71, 0xbf, 0x8f, 0x9,  0x84,
                           0x8, 0x58, 0x9a, 0x16, 0xd2, 0xe6, 0xc4, 0x5f, 0x60, 0x22, 0xc9, 0x47};
  uint8_t bytesprops4[] = {0xa2, 0x84, 0x60, 0x9a, 0xa6, 0xeb, 0xad, 0x9b, 0x47,
                           0xd7, 0xec, 0x54, 0xca, 0x21, 0x24, 0x7a, 0x5,  0x4c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19197}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25930}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24518}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3866}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26713, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25908 [("\158\154$vc\165\145gf\234i\231\148\155\181",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\RS\209\233$}",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})]
// [PropMaximumPacketSize 30821,PropAuthenticationData
// "*\169G\209g~n26\184@\177\173{e\US\178L\188\167\165\130l",PropTopicAliasMaximum 29506,PropSessionExpiryInterval
// 19470,PropReasonString "o\EOT\159\170J5\136M\STX\189\189",PropSharedSubscriptionAvailable 133,PropResponseTopic
// "\218\SUB%\182\174\&2\178Sv\151\SYN@\155B\193B(#\161~\135",PropServerReference
// "\145H\203T%\196\244\219,\209K\246q0\171\167\EMxG\b\206\189\241\197\149X",PropServerReference
// ")\237+\191\222?\136\139\177#\166",PropSessionExpiryInterval 19900,PropServerReference
// ")\189v3\142G",PropSessionExpiryInterval 9354,PropPayloadFormatIndicator 193,PropMessageExpiryInterval
// 24898,PropWildcardSubscriptionAvailable 103,PropRequestResponseInformation 94,PropMessageExpiryInterval
// 3135,PropResponseInformation "\208S",PropReceiveMaximum 3314,PropSubscriptionIdentifierAvailable 172]
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0xc5, 0x1,  0x65, 0x34, 0xa7, 0x1,  0x27, 0x0,  0x0,  0x78, 0x65, 0x16, 0x0,  0x17, 0x2a, 0xa9,
                   0x47, 0xd1, 0x67, 0x7e, 0x6e, 0x32, 0x36, 0xb8, 0x40, 0xb1, 0xad, 0x7b, 0x65, 0x1f, 0xb2, 0x4c, 0xbc,
                   0xa7, 0xa5, 0x82, 0x6c, 0x22, 0x73, 0x42, 0x11, 0x0,  0x0,  0x4c, 0xe,  0x1f, 0x0,  0xb,  0x6f, 0x4,
                   0x9f, 0xaa, 0x4a, 0x35, 0x88, 0x4d, 0x2,  0xbd, 0xbd, 0x2a, 0x85, 0x8,  0x0,  0x15, 0xda, 0x1a, 0x25,
                   0xb6, 0xae, 0x32, 0xb2, 0x53, 0x76, 0x97, 0x16, 0x40, 0x9b, 0x42, 0xc1, 0x42, 0x28, 0x23, 0xa1, 0x7e,
                   0x87, 0x1c, 0x0,  0x1a, 0x91, 0x48, 0xcb, 0x54, 0x25, 0xc4, 0xf4, 0xdb, 0x2c, 0xd1, 0x4b, 0xf6, 0x71,
                   0x30, 0xab, 0xa7, 0x19, 0x78, 0x47, 0x8,  0xce, 0xbd, 0xf1, 0xc5, 0x95, 0x58, 0x1c, 0x0,  0xb,  0x29,
                   0xed, 0x2b, 0xbf, 0xde, 0x3f, 0x88, 0x8b, 0xb1, 0x23, 0xa6, 0x11, 0x0,  0x0,  0x4d, 0xbc, 0x1c, 0x0,
                   0x6,  0x29, 0xbd, 0x76, 0x33, 0x8e, 0x47, 0x11, 0x0,  0x0,  0x24, 0x8a, 0x1,  0xc1, 0x2,  0x0,  0x0,
                   0x61, 0x42, 0x28, 0x67, 0x19, 0x5e, 0x2,  0x0,  0x0,  0xc,  0x3f, 0x1a, 0x0,  0x2,  0xd0, 0x53, 0x21,
                   0xc,  0xf2, 0x29, 0xac, 0x0,  0xf,  0x9e, 0x9a, 0x24, 0x76, 0x63, 0xa5, 0x91, 0x67, 0x66, 0xea, 0x69,
                   0xe7, 0x94, 0x9b, 0xb5, 0x1a, 0x0,  0x5,  0x1e, 0xd1, 0xe9, 0x24, 0x7d, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x9e, 0x9a, 0x24, 0x76, 0x63, 0xa5, 0x91, 0x67,
                                     0x66, 0xea, 0x69, 0xe7, 0x94, 0x9b, 0xb5};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0xd1, 0xe9, 0x24, 0x7d};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0x2a, 0xa9, 0x47, 0xd1, 0x67, 0x7e, 0x6e, 0x32, 0x36, 0xb8, 0x40, 0xb1,
                           0xad, 0x7b, 0x65, 0x1f, 0xb2, 0x4c, 0xbc, 0xa7, 0xa5, 0x82, 0x6c};
  uint8_t bytesprops1[] = {0x6f, 0x4, 0x9f, 0xaa, 0x4a, 0x35, 0x88, 0x4d, 0x2, 0xbd, 0xbd};
  uint8_t bytesprops2[] = {0xda, 0x1a, 0x25, 0xb6, 0xae, 0x32, 0xb2, 0x53, 0x76, 0x97, 0x16,
                           0x40, 0x9b, 0x42, 0xc1, 0x42, 0x28, 0x23, 0xa1, 0x7e, 0x87};
  uint8_t bytesprops3[] = {0x91, 0x48, 0xcb, 0x54, 0x25, 0xc4, 0xf4, 0xdb, 0x2c, 0xd1, 0x4b, 0xf6, 0x71,
                           0x30, 0xab, 0xa7, 0x19, 0x78, 0x47, 0x8,  0xce, 0xbd, 0xf1, 0xc5, 0x95, 0x58};
  uint8_t bytesprops4[] = {0x29, 0xed, 0x2b, 0xbf, 0xde, 0x3f, 0x88, 0x8b, 0xb1, 0x23, 0xa6};
  uint8_t bytesprops5[] = {0x29, 0xbd, 0x76, 0x33, 0x8e, 0x47};
  uint8_t bytesprops6[] = {0xd0, 0x53};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30821}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29506}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19470}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19900}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9354}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24898}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3135}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3314}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 172}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25908, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20578 [("\224\194C\240\225\DC1\DEL\202~\187o\222v\157/\164<\CAN\230;\141",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("m\173}5\SUB\254\SI\157\231",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\r$\DLE9\US*E\226",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropAuthenticationData
// "\240\203\GS\191\198\140g\225~d\237\136\231oHF\167o\SI_\129\207\DEL\131\239\243C\173R",PropSharedSubscriptionAvailable
// 31,PropRetainAvailable 143,PropUserProperty "\254\199.t\235\132\145\197\fY^\250\255\185\187\211"
// "i\129\190\202\142\134\177%\237\180K\142\n\DC4/\236\188\169\160\135K",PropWildcardSubscriptionAvailable
// 165,PropSubscriptionIdentifier 0,PropWillDelayInterval 11724,PropTopicAliasMaximum 2174,PropResponseInformation
// "z\156\158\150Q\177U\168",PropCorrelationData
// "\202\184\170/\229\145\&7\"\255:]\237\215\DC3\228\158/N\DC4_\233b~\196\250iy\162\202",PropRequestResponseInformation
// 248,PropWildcardSubscriptionAvailable 99,PropReceiveMaximum 29354,PropContentType "\166",PropRetainAvailable
// 99,PropSubscriptionIdentifierAvailable 214,PropMaximumPacketSize 12704,PropServerReference
// "k\184{\254\DC2u\DC4,\213\DC1\ESC@\201\227\225=\141\ESC\US\149"]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0xe3, 0x1,  0x50, 0x62, 0xb0, 0x1,  0x16, 0x0,  0x1d, 0xf0, 0xcb, 0x1d, 0xbf, 0xc6, 0x8c, 0x67,
                   0xe1, 0x7e, 0x64, 0xed, 0x88, 0xe7, 0x6f, 0x48, 0x46, 0xa7, 0x6f, 0xf,  0x5f, 0x81, 0xcf, 0x7f, 0x83,
                   0xef, 0xf3, 0x43, 0xad, 0x52, 0x2a, 0x1f, 0x25, 0x8f, 0x26, 0x0,  0x10, 0xfe, 0xc7, 0x2e, 0x74, 0xeb,
                   0x84, 0x91, 0xc5, 0xc,  0x59, 0x5e, 0xfa, 0xff, 0xb9, 0xbb, 0xd3, 0x0,  0x15, 0x69, 0x81, 0xbe, 0xca,
                   0x8e, 0x86, 0xb1, 0x25, 0xed, 0xb4, 0x4b, 0x8e, 0xa,  0x14, 0x2f, 0xec, 0xbc, 0xa9, 0xa0, 0x87, 0x4b,
                   0x28, 0xa5, 0xb,  0x0,  0x18, 0x0,  0x0,  0x2d, 0xcc, 0x22, 0x8,  0x7e, 0x1a, 0x0,  0x8,  0x7a, 0x9c,
                   0x9e, 0x96, 0x51, 0xb1, 0x55, 0xa8, 0x9,  0x0,  0x1d, 0xca, 0xb8, 0xaa, 0x2f, 0xe5, 0x91, 0x37, 0x22,
                   0xff, 0x3a, 0x5d, 0xed, 0xd7, 0x13, 0xe4, 0x9e, 0x2f, 0x4e, 0x14, 0x5f, 0xe9, 0x62, 0x7e, 0xc4, 0xfa,
                   0x69, 0x79, 0xa2, 0xca, 0x19, 0xf8, 0x28, 0x63, 0x21, 0x72, 0xaa, 0x3,  0x0,  0x1,  0xa6, 0x25, 0x63,
                   0x29, 0xd6, 0x27, 0x0,  0x0,  0x31, 0xa0, 0x1c, 0x0,  0x14, 0x6b, 0xb8, 0x7b, 0xfe, 0x12, 0x75, 0x14,
                   0x2c, 0xd5, 0x11, 0x1b, 0x40, 0xc9, 0xe3, 0xe1, 0x3d, 0x8d, 0x1b, 0x1f, 0x95, 0x0,  0x15, 0xe0, 0xc2,
                   0x43, 0xf0, 0xe1, 0x11, 0x7f, 0xca, 0x7e, 0xbb, 0x6f, 0xde, 0x76, 0x9d, 0x2f, 0xa4, 0x3c, 0x18, 0xe6,
                   0x3b, 0x8d, 0xd,  0x0,  0x9,  0x6d, 0xad, 0x7d, 0x35, 0x1a, 0xfe, 0xf,  0x9d, 0xe7, 0x2,  0x0,  0x8,
                   0xd,  0x24, 0x10, 0x39, 0x1f, 0x2a, 0x45, 0xe2, 0x11};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xe0, 0xc2, 0x43, 0xf0, 0xe1, 0x11, 0x7f, 0xca, 0x7e, 0xbb, 0x6f,
                                     0xde, 0x76, 0x9d, 0x2f, 0xa4, 0x3c, 0x18, 0xe6, 0x3b, 0x8d};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6d, 0xad, 0x7d, 0x35, 0x1a, 0xfe, 0xf, 0x9d, 0xe7};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd, 0x24, 0x10, 0x39, 0x1f, 0x2a, 0x45, 0xe2};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  uint8_t bytesprops0[] = {0xf0, 0xcb, 0x1d, 0xbf, 0xc6, 0x8c, 0x67, 0xe1, 0x7e, 0x64, 0xed, 0x88, 0xe7, 0x6f, 0x48,
                           0x46, 0xa7, 0x6f, 0xf,  0x5f, 0x81, 0xcf, 0x7f, 0x83, 0xef, 0xf3, 0x43, 0xad, 0x52};
  uint8_t bytesprops2[] = {0x69, 0x81, 0xbe, 0xca, 0x8e, 0x86, 0xb1, 0x25, 0xed, 0xb4, 0x4b,
                           0x8e, 0xa,  0x14, 0x2f, 0xec, 0xbc, 0xa9, 0xa0, 0x87, 0x4b};
  uint8_t bytesprops1[] = {0xfe, 0xc7, 0x2e, 0x74, 0xeb, 0x84, 0x91, 0xc5,
                           0xc,  0x59, 0x5e, 0xfa, 0xff, 0xb9, 0xbb, 0xd3};
  uint8_t bytesprops3[] = {0x7a, 0x9c, 0x9e, 0x96, 0x51, 0xb1, 0x55, 0xa8};
  uint8_t bytesprops4[] = {0xca, 0xb8, 0xaa, 0x2f, 0xe5, 0x91, 0x37, 0x22, 0xff, 0x3a, 0x5d, 0xed, 0xd7, 0x13, 0xe4,
                           0x9e, 0x2f, 0x4e, 0x14, 0x5f, 0xe9, 0x62, 0x7e, 0xc4, 0xfa, 0x69, 0x79, 0xa2, 0xca};
  uint8_t bytesprops5[] = {0xa6};
  uint8_t bytesprops6[] = {0x6b, 0xb8, 0x7b, 0xfe, 0x12, 0x75, 0x14, 0x2c, 0xd5, 0x11,
                           0x1b, 0x40, 0xc9, 0xe3, 0xe1, 0x3d, 0x8d, 0x1b, 0x1f, 0x95};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops1}, .v = {21, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11724}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2174}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29354}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12704}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20578, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13418 [("\EM\171z\153z\136\168{\150\208\134\ENQ\134\225\231\CAN}",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropResponseInformation
// "B\187\220L\DLE",PropAuthenticationMethod "\130\196\&9~\195\ACK\152\&1\170\nI",PropSubscriptionIdentifierAvailable
// 123,PropMaximumQoS 103,PropSharedSubscriptionAvailable 60,PropTopicAlias 26601,PropTopicAlias
// 29510,PropReceiveMaximum 8856,PropSubscriptionIdentifierAvailable 204,PropUserProperty
// "\149y\130\172\239\250\154X>P\193\175u\132\221\236\228 }\192\FS\166on\"4\DC2\146" "e",PropSessionExpiryInterval
// 5464,PropWillDelayInterval 6090,PropReasonString "\249\188\SO\197\&7",PropAuthenticationMethod
// "_4;\253\209\216f\167\&5;\235\177\201\EOT\255\226\192\174\FSC5\SUB\230\ETX",PropSessionExpiryInterval
// 7464,PropServerReference "\245\169\255T\239\199jO\214\238\147\175\246N\a\181+\DC3",PropResponseTopic
// "\190\DLE\239",PropMaximumQoS 137,PropReceiveMaximum 27863,PropSharedSubscriptionAvailable 120,PropReceiveMaximum
// 3606,PropServerKeepAlive 27761,PropReasonString
// "\184\203\DC2\252[)\133\220-\US$\178V'\146\EOT\149\DC1\161\160d\142*\229\224",PropAuthenticationData
// "`^\v\ACK\206\225\130_\199w0 \rU"]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0xe8, 0x1,  0x34, 0x6a, 0xd0, 0x1,  0x1a, 0x0,  0x5,  0x42, 0xbb, 0xdc, 0x4c, 0x10, 0x15, 0x0,
                   0xb,  0x82, 0xc4, 0x39, 0x7e, 0xc3, 0x6,  0x98, 0x31, 0xaa, 0xa,  0x49, 0x29, 0x7b, 0x24, 0x67, 0x2a,
                   0x3c, 0x23, 0x67, 0xe9, 0x23, 0x73, 0x46, 0x21, 0x22, 0x98, 0x29, 0xcc, 0x26, 0x0,  0x1c, 0x95, 0x79,
                   0x82, 0xac, 0xef, 0xfa, 0x9a, 0x58, 0x3e, 0x50, 0xc1, 0xaf, 0x75, 0x84, 0xdd, 0xec, 0xe4, 0x20, 0x7d,
                   0xc0, 0x1c, 0xa6, 0x6f, 0x6e, 0x22, 0x34, 0x12, 0x92, 0x0,  0x1,  0x65, 0x11, 0x0,  0x0,  0x15, 0x58,
                   0x18, 0x0,  0x0,  0x17, 0xca, 0x1f, 0x0,  0x5,  0xf9, 0xbc, 0xe,  0xc5, 0x37, 0x15, 0x0,  0x18, 0x5f,
                   0x34, 0x3b, 0xfd, 0xd1, 0xd8, 0x66, 0xa7, 0x35, 0x3b, 0xeb, 0xb1, 0xc9, 0x4,  0xff, 0xe2, 0xc0, 0xae,
                   0x1c, 0x43, 0x35, 0x1a, 0xe6, 0x3,  0x11, 0x0,  0x0,  0x1d, 0x28, 0x1c, 0x0,  0x12, 0xf5, 0xa9, 0xff,
                   0x54, 0xef, 0xc7, 0x6a, 0x4f, 0xd6, 0xee, 0x93, 0xaf, 0xf6, 0x4e, 0x7,  0xb5, 0x2b, 0x13, 0x8,  0x0,
                   0x3,  0xbe, 0x10, 0xef, 0x24, 0x89, 0x21, 0x6c, 0xd7, 0x2a, 0x78, 0x21, 0xe,  0x16, 0x13, 0x6c, 0x71,
                   0x1f, 0x0,  0x19, 0xb8, 0xcb, 0x12, 0xfc, 0x5b, 0x29, 0x85, 0xdc, 0x2d, 0x1f, 0x24, 0xb2, 0x56, 0x27,
                   0x92, 0x4,  0x95, 0x11, 0xa1, 0xa0, 0x64, 0x8e, 0x2a, 0xe5, 0xe0, 0x16, 0x0,  0xe,  0x60, 0x5e, 0xb,
                   0x6,  0xce, 0xe1, 0x82, 0x5f, 0xc7, 0x77, 0x30, 0x20, 0xd,  0x55, 0x0,  0x11, 0x19, 0xab, 0x7a, 0x99,
                   0x7a, 0x88, 0xa8, 0x7b, 0x96, 0xd0, 0x86, 0x5,  0x86, 0xe1, 0xe7, 0x18, 0x7d, 0x10};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x19, 0xab, 0x7a, 0x99, 0x7a, 0x88, 0xa8, 0x7b, 0x96,
                                     0xd0, 0x86, 0x5,  0x86, 0xe1, 0xe7, 0x18, 0x7d};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0x42, 0xbb, 0xdc, 0x4c, 0x10};
  uint8_t bytesprops1[] = {0x82, 0xc4, 0x39, 0x7e, 0xc3, 0x6, 0x98, 0x31, 0xaa, 0xa, 0x49};
  uint8_t bytesprops3[] = {0x65};
  uint8_t bytesprops2[] = {0x95, 0x79, 0x82, 0xac, 0xef, 0xfa, 0x9a, 0x58, 0x3e, 0x50, 0xc1, 0xaf, 0x75, 0x84,
                           0xdd, 0xec, 0xe4, 0x20, 0x7d, 0xc0, 0x1c, 0xa6, 0x6f, 0x6e, 0x22, 0x34, 0x12, 0x92};
  uint8_t bytesprops4[] = {0xf9, 0xbc, 0xe, 0xc5, 0x37};
  uint8_t bytesprops5[] = {0x5f, 0x34, 0x3b, 0xfd, 0xd1, 0xd8, 0x66, 0xa7, 0x35, 0x3b, 0xeb, 0xb1,
                           0xc9, 0x4,  0xff, 0xe2, 0xc0, 0xae, 0x1c, 0x43, 0x35, 0x1a, 0xe6, 0x3};
  uint8_t bytesprops6[] = {0xf5, 0xa9, 0xff, 0x54, 0xef, 0xc7, 0x6a, 0x4f, 0xd6,
                           0xee, 0x93, 0xaf, 0xf6, 0x4e, 0x7,  0xb5, 0x2b, 0x13};
  uint8_t bytesprops7[] = {0xbe, 0x10, 0xef};
  uint8_t bytesprops8[] = {0xb8, 0xcb, 0x12, 0xfc, 0x5b, 0x29, 0x85, 0xdc, 0x2d, 0x1f, 0x24, 0xb2, 0x56,
                           0x27, 0x92, 0x4,  0x95, 0x11, 0xa1, 0xa0, 0x64, 0x8e, 0x2a, 0xe5, 0xe0};
  uint8_t bytesprops9[] = {0x60, 0x5e, 0xb, 0x6, 0xce, 0xe1, 0x82, 0x5f, 0xc7, 0x77, 0x30, 0x20, 0xd, 0x55};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26601}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29510}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8856}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops2}, .v = {1, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5464}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6090}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7464}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27863}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3606}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27761}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13418, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22728 [("\166f3\207\139\210\163\t\187Z#\n\170",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\172\151\200\161\130zE\214\&3\212\199\SIg\129^\tMy",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("G\151j0\232B\192\231\172\a\206\224T\237",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})]
// [PropWildcardSubscriptionAvailable 87,PropSessionExpiryInterval 6532,PropSubscriptionIdentifierAvailable
// 27,PropMaximumPacketSize 9588,PropRequestResponseInformation 134,PropUserProperty "~\226d\201\239"
// "V\237\135\&1\182AS\215A\132\160u}\145\232\214\128\131f\219\194\ACK\128\246\159",PropAssignedClientIdentifier
// "i\203\148\DC1\199I\216$\DC2#y\172\128\DLEqc\213\145",PropSessionExpiryInterval 24693,PropUserProperty
// "\FSlt\205\208k" "\GS\184V\202\186v\192\220aOaY\ESC",PropTopicAlias 2280,PropContentType
// "\174-;\203",PropWillDelayInterval 22596]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0xad, 0x1,  0x58, 0xc8, 0x74, 0x28, 0x57, 0x11, 0x0,  0x0,  0x19, 0x84, 0x29, 0x1b, 0x27,
                   0x0,  0x0,  0x25, 0x74, 0x19, 0x86, 0x26, 0x0,  0x5,  0x7e, 0xe2, 0x64, 0xc9, 0xef, 0x0,  0x19,
                   0x56, 0xed, 0x87, 0x31, 0xb6, 0x41, 0x53, 0xd7, 0x41, 0x84, 0xa0, 0x75, 0x7d, 0x91, 0xe8, 0xd6,
                   0x80, 0x83, 0x66, 0xdb, 0xc2, 0x6,  0x80, 0xf6, 0x9f, 0x12, 0x0,  0x12, 0x69, 0xcb, 0x94, 0x11,
                   0xc7, 0x49, 0xd8, 0x24, 0x12, 0x23, 0x79, 0xac, 0x80, 0x10, 0x71, 0x63, 0xd5, 0x91, 0x11, 0x0,
                   0x0,  0x60, 0x75, 0x26, 0x0,  0x6,  0x1c, 0x6c, 0x74, 0xcd, 0xd0, 0x6b, 0x0,  0xd,  0x1d, 0xb8,
                   0x56, 0xca, 0xba, 0x76, 0xc0, 0xdc, 0x61, 0x4f, 0x61, 0x59, 0x1b, 0x23, 0x8,  0xe8, 0x3,  0x0,
                   0x4,  0xae, 0x2d, 0x3b, 0xcb, 0x18, 0x0,  0x0,  0x58, 0x44, 0x0,  0xd,  0xa6, 0x66, 0x33, 0xcf,
                   0x8b, 0xd2, 0xa3, 0x9,  0xbb, 0x5a, 0x23, 0xa,  0xaa, 0x16, 0x0,  0x12, 0xac, 0x97, 0xc8, 0xa1,
                   0x82, 0x7a, 0x45, 0xd6, 0x33, 0xd4, 0xc7, 0xf,  0x67, 0x81, 0x5e, 0x9,  0x4d, 0x79, 0x18, 0x0,
                   0xe,  0x47, 0x97, 0x6a, 0x30, 0xe8, 0x42, 0xc0, 0xe7, 0xac, 0x7,  0xce, 0xe0, 0x54, 0xed, 0x5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xa6, 0x66, 0x33, 0xcf, 0x8b, 0xd2, 0xa3, 0x9, 0xbb, 0x5a, 0x23, 0xa, 0xaa};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xac, 0x97, 0xc8, 0xa1, 0x82, 0x7a, 0x45, 0xd6, 0x33,
                                     0xd4, 0xc7, 0xf,  0x67, 0x81, 0x5e, 0x9,  0x4d, 0x79};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x47, 0x97, 0x6a, 0x30, 0xe8, 0x42, 0xc0, 0xe7, 0xac, 0x7, 0xce, 0xe0, 0x54, 0xed};
  lwmqtt_string_t topic_filter_s2 = {14, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  uint8_t bytesprops1[] = {0x56, 0xed, 0x87, 0x31, 0xb6, 0x41, 0x53, 0xd7, 0x41, 0x84, 0xa0, 0x75, 0x7d,
                           0x91, 0xe8, 0xd6, 0x80, 0x83, 0x66, 0xdb, 0xc2, 0x6,  0x80, 0xf6, 0x9f};
  uint8_t bytesprops0[] = {0x7e, 0xe2, 0x64, 0xc9, 0xef};
  uint8_t bytesprops2[] = {0x69, 0xcb, 0x94, 0x11, 0xc7, 0x49, 0xd8, 0x24, 0x12,
                           0x23, 0x79, 0xac, 0x80, 0x10, 0x71, 0x63, 0xd5, 0x91};
  uint8_t bytesprops4[] = {0x1d, 0xb8, 0x56, 0xca, 0xba, 0x76, 0xc0, 0xdc, 0x61, 0x4f, 0x61, 0x59, 0x1b};
  uint8_t bytesprops3[] = {0x1c, 0x6c, 0x74, 0xcd, 0xd0, 0x6b};
  uint8_t bytesprops5[] = {0xae, 0x2d, 0x3b, 0xcb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6532}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9588}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops0}, .v = {25, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24693}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops3}, .v = {13, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2280}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22596}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22728, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17738 [("\217\130'@BS\183\201\137\SOH\DC4\225o",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropAuthenticationData "",PropMaximumPacketSize
// 13226,PropTopicAlias 25122,PropPayloadFormatIndicator 92,PropAuthenticationData
// "\214\133\STX\246\DC1",PropTopicAliasMaximum 28878,PropTopicAlias 25882,PropRequestResponseInformation
// 230,PropUserProperty "\187\SUB_8\FS\170G\173i" "\178\148\207",PropMessageExpiryInterval 17596,PropTopicAlias
// 24979,PropSessionExpiryInterval 25290,PropPayloadFormatIndicator 23,PropServerKeepAlive
// 29088,PropAssignedClientIdentifier "\240\139A\a",PropSubscriptionIdentifierAvailable 237]
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x5c, 0x45, 0x4a, 0x49, 0x16, 0x0,  0x0,  0x27, 0x0,  0x0,  0x33, 0xaa, 0x23, 0x62, 0x22,
                   0x1,  0x5c, 0x16, 0x0,  0x5,  0xd6, 0x85, 0x2,  0xf6, 0x11, 0x22, 0x70, 0xce, 0x23, 0x65, 0x1a,
                   0x19, 0xe6, 0x26, 0x0,  0x9,  0xbb, 0x1a, 0x5f, 0x38, 0x1c, 0xaa, 0x47, 0xad, 0x69, 0x0,  0x3,
                   0xb2, 0x94, 0xcf, 0x2,  0x0,  0x0,  0x44, 0xbc, 0x23, 0x61, 0x93, 0x11, 0x0,  0x0,  0x62, 0xca,
                   0x1,  0x17, 0x13, 0x71, 0xa0, 0x12, 0x0,  0x4,  0xf0, 0x8b, 0x41, 0x7,  0x29, 0xed, 0x0,  0xd,
                   0xd9, 0x82, 0x27, 0x40, 0x42, 0x53, 0xb7, 0xc9, 0x89, 0x1,  0x14, 0xe1, 0x6f, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xd9, 0x82, 0x27, 0x40, 0x42, 0x53, 0xb7, 0xc9, 0x89, 0x1, 0x14, 0xe1, 0x6f};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xd6, 0x85, 0x2, 0xf6, 0x11};
  uint8_t bytesprops3[] = {0xb2, 0x94, 0xcf};
  uint8_t bytesprops2[] = {0xbb, 0x1a, 0x5f, 0x38, 0x1c, 0xaa, 0x47, 0xad, 0x69};
  uint8_t bytesprops4[] = {0xf0, 0x8b, 0x41, 0x7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13226}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25122}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28878}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25882}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops2}, .v = {3, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17596}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24979}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25290}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29088}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 237}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17738, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21727 [("\220\186\EOT'\230\ACK\148x\215=1\233\144*\214{t\159\208X\ENQ\n*n\NAK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("O\nf",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})]
// [PropRequestProblemInformation 67,PropCorrelationData "",PropWillDelayInterval 13240,PropPayloadFormatIndicator
// 111,PropResponseTopic "\245\152\DC3\133",PropTopicAliasMaximum 30298,PropServerReference
// "\150P\SYN\NUL\157\ETX\207\161\141/\182\&7\n\218G4\186",PropSubscriptionIdentifier
// 11,PropSubscriptionIdentifierAvailable 122,PropTopicAliasMaximum 29334,PropReceiveMaximum
// 29243,PropWildcardSubscriptionAvailable 210,PropWildcardSubscriptionAvailable 145,PropSubscriptionIdentifierAvailable
// 70,PropWildcardSubscriptionAvailable 17]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x61, 0x54, 0xdf, 0x3c, 0x17, 0x43, 0x9,  0x0,  0x0,  0x18, 0x0,  0x0,  0x33, 0xb8, 0x1,  0x6f,
                   0x8,  0x0,  0x4,  0xf5, 0x98, 0x13, 0x85, 0x22, 0x76, 0x5a, 0x1c, 0x0,  0x11, 0x96, 0x50, 0x16, 0x0,
                   0x9d, 0x3,  0xcf, 0xa1, 0x8d, 0x2f, 0xb6, 0x37, 0xa,  0xda, 0x47, 0x34, 0xba, 0xb,  0xb,  0x29, 0x7a,
                   0x22, 0x72, 0x96, 0x21, 0x72, 0x3b, 0x28, 0xd2, 0x28, 0x91, 0x29, 0x46, 0x28, 0x11, 0x0,  0x19, 0xdc,
                   0xba, 0x4,  0x27, 0xe6, 0x6,  0x94, 0x78, 0xd7, 0x3d, 0x31, 0xe9, 0x90, 0x2a, 0xd6, 0x7b, 0x74, 0x9f,
                   0xd0, 0x58, 0x5,  0xa,  0x2a, 0x6e, 0x15, 0x1,  0x0,  0x3,  0x4f, 0xa,  0x66, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xdc, 0xba, 0x4,  0x27, 0xe6, 0x6,  0x94, 0x78, 0xd7, 0x3d, 0x31, 0xe9, 0x90,
                                     0x2a, 0xd6, 0x7b, 0x74, 0x9f, 0xd0, 0x58, 0x5,  0xa,  0x2a, 0x6e, 0x15};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4f, 0xa, 0x66};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xf5, 0x98, 0x13, 0x85};
  uint8_t bytesprops2[] = {0x96, 0x50, 0x16, 0x0, 0x9d, 0x3,  0xcf, 0xa1, 0x8d,
                           0x2f, 0xb6, 0x37, 0xa, 0xda, 0x47, 0x34, 0xba};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13240}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30298}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29334}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29243}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21727, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19375 [("\225\165Uj\\\240\190*Vv\135:f)\169i/up&",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\203N\154\STXXt\245\221\238\134 ?=",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\SUB\205",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False,
// _subQoS = QoS0})] [PropAuthenticationData "\179\140vn5\142'\154\215l\129\171I\175\188\CANs\172/",PropMaximumQoS
// 49,PropMaximumPacketSize 29237,PropTopicAliasMaximum 8231,PropRequestResponseInformation 182,PropMaximumPacketSize
// 18717,PropResponseInformation "\178\129\246W",PropServerReference "*IE\245\240\167<\DC2
// \247-\STX\241\218\184n\225yl\145\179\161\190\145",PropResponseInformation
// "\165|\136\145Z\150\245F\USI\STX\154\232\224\158\168\SUB_\169\DC3\204\169v",PropServerReference
// "\NAK\143$\235",PropWildcardSubscriptionAvailable 222,PropTopicAliasMaximum 1110,PropSubscriptionIdentifierAvailable
// 115,PropMessageExpiryInterval 23125,PropContentType "m\SUB",PropSubscriptionIdentifier 12,PropMaximumPacketSize
// 8589,PropRetainAvailable 108,PropRetainAvailable 35,PropTopicAlias 7606,PropSessionExpiryInterval 28011]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0xbe, 0x1,  0x4b, 0xaf, 0x8e, 0x1,  0x16, 0x0,  0x13, 0xb3, 0x8c, 0x76, 0x6e, 0x35, 0x8e, 0x27,
                   0x9a, 0xd7, 0x6c, 0x81, 0xab, 0x49, 0xaf, 0xbc, 0x18, 0x73, 0xac, 0x2f, 0x24, 0x31, 0x27, 0x0,  0x0,
                   0x72, 0x35, 0x22, 0x20, 0x27, 0x19, 0xb6, 0x27, 0x0,  0x0,  0x49, 0x1d, 0x1a, 0x0,  0x4,  0xb2, 0x81,
                   0xf6, 0x57, 0x1c, 0x0,  0x18, 0x2a, 0x49, 0x45, 0xf5, 0xf0, 0xa7, 0x3c, 0x12, 0x20, 0xf7, 0x2d, 0x2,
                   0xf1, 0xda, 0xb8, 0x6e, 0xe1, 0x79, 0x6c, 0x91, 0xb3, 0xa1, 0xbe, 0x91, 0x1a, 0x0,  0x17, 0xa5, 0x7c,
                   0x88, 0x91, 0x5a, 0x96, 0xf5, 0x46, 0x1f, 0x49, 0x2,  0x9a, 0xe8, 0xe0, 0x9e, 0xa8, 0x1a, 0x5f, 0xa9,
                   0x13, 0xcc, 0xa9, 0x76, 0x1c, 0x0,  0x4,  0x15, 0x8f, 0x24, 0xeb, 0x28, 0xde, 0x22, 0x4,  0x56, 0x29,
                   0x73, 0x2,  0x0,  0x0,  0x5a, 0x55, 0x3,  0x0,  0x2,  0x6d, 0x1a, 0xb,  0xc,  0x27, 0x0,  0x0,  0x21,
                   0x8d, 0x25, 0x6c, 0x25, 0x23, 0x23, 0x1d, 0xb6, 0x11, 0x0,  0x0,  0x6d, 0x6b, 0x0,  0x14, 0xe1, 0xa5,
                   0x55, 0x6a, 0x5c, 0xf0, 0xbe, 0x2a, 0x56, 0x76, 0x87, 0x3a, 0x66, 0x29, 0xa9, 0x69, 0x2f, 0x75, 0x70,
                   0x26, 0x0,  0x0,  0xd,  0xcb, 0x4e, 0x9a, 0x2,  0x58, 0x74, 0xf5, 0xdd, 0xee, 0x86, 0x20, 0x3f, 0x3d,
                   0x2e, 0x0,  0x2,  0x1a, 0xcd, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xe1, 0xa5, 0x55, 0x6a, 0x5c, 0xf0, 0xbe, 0x2a, 0x56, 0x76,
                                     0x87, 0x3a, 0x66, 0x29, 0xa9, 0x69, 0x2f, 0x75, 0x70, 0x26};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcb, 0x4e, 0x9a, 0x2, 0x58, 0x74, 0xf5, 0xdd, 0xee, 0x86, 0x20, 0x3f, 0x3d};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0xcd};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  uint8_t bytesprops0[] = {0xb3, 0x8c, 0x76, 0x6e, 0x35, 0x8e, 0x27, 0x9a, 0xd7, 0x6c,
                           0x81, 0xab, 0x49, 0xaf, 0xbc, 0x18, 0x73, 0xac, 0x2f};
  uint8_t bytesprops1[] = {0xb2, 0x81, 0xf6, 0x57};
  uint8_t bytesprops2[] = {0x2a, 0x49, 0x45, 0xf5, 0xf0, 0xa7, 0x3c, 0x12, 0x20, 0xf7, 0x2d, 0x2,
                           0xf1, 0xda, 0xb8, 0x6e, 0xe1, 0x79, 0x6c, 0x91, 0xb3, 0xa1, 0xbe, 0x91};
  uint8_t bytesprops3[] = {0xa5, 0x7c, 0x88, 0x91, 0x5a, 0x96, 0xf5, 0x46, 0x1f, 0x49, 0x2, 0x9a,
                           0xe8, 0xe0, 0x9e, 0xa8, 0x1a, 0x5f, 0xa9, 0x13, 0xcc, 0xa9, 0x76};
  uint8_t bytesprops4[] = {0x15, 0x8f, 0x24, 0xeb};
  uint8_t bytesprops5[] = {0x6d, 0x1a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29237}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8231}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18717}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1110}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23125}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8589}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7606}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28011}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19375, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28027 [("\"g&\184\164\188M\DC4'tW=\211iw\223\142\177\135\221\193\212\ETX\235",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Ef\203H",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS2}),("\174\&6\157\194{p\223\202\255Fi\201O\EM}\223\234$\EOTq\SYN\201\182\219\164:\136|x",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("m\t\200\200|++\177\DLE\DC4,\198\195:SP44\161-",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("cW\193\160\232\166\&8@\244
// \"\SI\171\&5Ky\215;\131\US\243c\144\128\214\138",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\174\&7\208h4ML@\STX\167Mp\vQ\232\148\r\254\b\189\132\219}\235\155\131\\,\255",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\219\233",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\139\228'\CAN\224\233y\170z\235\168\b'\237\"\171\177",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1})] [PropTopicAlias 17001,PropResponseInformation
// "\128\244\176\190\199\NAK-\183\186\184\225r\242\202c\237\DC2\251\233>f\220\DC2\146H\160\233\166q",PropRequestResponseInformation
// 123,PropAuthenticationMethod "\143\252\247S\189\RSE\165\190B\173Ab^\r \217\170\DLE\214\142]@V\165\&9\185L"]
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0xf6, 0x1,  0x6d, 0x7b, 0x44, 0x23, 0x42, 0x69, 0x1a, 0x0,  0x1d, 0x80, 0xf4, 0xb0, 0xbe, 0xc7,
                   0x15, 0x2d, 0xb7, 0xba, 0xb8, 0xe1, 0x72, 0xf2, 0xca, 0x63, 0xed, 0x12, 0xfb, 0xe9, 0x3e, 0x66, 0xdc,
                   0x12, 0x92, 0x48, 0xa0, 0xe9, 0xa6, 0x71, 0x19, 0x7b, 0x15, 0x0,  0x1c, 0x8f, 0xfc, 0xf7, 0x53, 0xbd,
                   0x1e, 0x45, 0xa5, 0xbe, 0x42, 0xad, 0x41, 0x62, 0x5e, 0xd,  0x20, 0xd9, 0xaa, 0x10, 0xd6, 0x8e, 0x5d,
                   0x40, 0x56, 0xa5, 0x39, 0xb9, 0x4c, 0x0,  0x18, 0x22, 0x67, 0x26, 0xb8, 0xa4, 0xbc, 0x4d, 0x14, 0x27,
                   0x74, 0x57, 0x3d, 0xd3, 0x69, 0x77, 0xdf, 0x8e, 0xb1, 0x87, 0xdd, 0xc1, 0xd4, 0x3,  0xeb, 0x22, 0x0,
                   0x4,  0x45, 0x66, 0xcb, 0x48, 0x2e, 0x0,  0x1d, 0xae, 0x36, 0x9d, 0xc2, 0x7b, 0x70, 0xdf, 0xca, 0xff,
                   0x46, 0x69, 0xc9, 0x4f, 0x19, 0x7d, 0xdf, 0xea, 0x24, 0x4,  0x71, 0x16, 0xc9, 0xb6, 0xdb, 0xa4, 0x3a,
                   0x88, 0x7c, 0x78, 0x12, 0x0,  0x14, 0x6d, 0x9,  0xc8, 0xc8, 0x7c, 0x2b, 0x2b, 0xb1, 0x10, 0x14, 0x2c,
                   0xc6, 0xc3, 0x3a, 0x53, 0x50, 0x34, 0x34, 0xa1, 0x2d, 0x9,  0x0,  0x1a, 0x63, 0x57, 0xc1, 0xa0, 0xe8,
                   0xa6, 0x38, 0x40, 0xf4, 0x20, 0x22, 0xf,  0xab, 0x35, 0x4b, 0x79, 0xd7, 0x3b, 0x83, 0x1f, 0xf3, 0x63,
                   0x90, 0x80, 0xd6, 0x8a, 0x28, 0x0,  0x1d, 0xae, 0x37, 0xd0, 0x68, 0x34, 0x4d, 0x4c, 0x40, 0x2,  0xa7,
                   0x4d, 0x70, 0xb,  0x51, 0xe8, 0x94, 0xd,  0xfe, 0x8,  0xbd, 0x84, 0xdb, 0x7d, 0xeb, 0x9b, 0x83, 0x5c,
                   0x2c, 0xff, 0x1c, 0x0,  0x2,  0xdb, 0xe9, 0x9,  0x0,  0x11, 0x8b, 0xe4, 0x27, 0x18, 0xe0, 0xe9, 0x79,
                   0xaa, 0x7a, 0xeb, 0xa8, 0x8,  0x27, 0xed, 0x22, 0xab, 0xb1, 0x19};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x22, 0x67, 0x26, 0xb8, 0xa4, 0xbc, 0x4d, 0x14, 0x27, 0x74, 0x57, 0x3d,
                                     0xd3, 0x69, 0x77, 0xdf, 0x8e, 0xb1, 0x87, 0xdd, 0xc1, 0xd4, 0x3,  0xeb};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x45, 0x66, 0xcb, 0x48};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xae, 0x36, 0x9d, 0xc2, 0x7b, 0x70, 0xdf, 0xca, 0xff, 0x46,
                                     0x69, 0xc9, 0x4f, 0x19, 0x7d, 0xdf, 0xea, 0x24, 0x4,  0x71,
                                     0x16, 0xc9, 0xb6, 0xdb, 0xa4, 0x3a, 0x88, 0x7c, 0x78};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6d, 0x9,  0xc8, 0xc8, 0x7c, 0x2b, 0x2b, 0xb1, 0x10, 0x14,
                                     0x2c, 0xc6, 0xc3, 0x3a, 0x53, 0x50, 0x34, 0x34, 0xa1, 0x2d};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x63, 0x57, 0xc1, 0xa0, 0xe8, 0xa6, 0x38, 0x40, 0xf4, 0x20, 0x22, 0xf,  0xab,
                                     0x35, 0x4b, 0x79, 0xd7, 0x3b, 0x83, 0x1f, 0xf3, 0x63, 0x90, 0x80, 0xd6, 0x8a};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xae, 0x37, 0xd0, 0x68, 0x34, 0x4d, 0x4c, 0x40, 0x2, 0xa7,
                                     0x4d, 0x70, 0xb,  0x51, 0xe8, 0x94, 0xd,  0xfe, 0x8, 0xbd,
                                     0x84, 0xdb, 0x7d, 0xeb, 0x9b, 0x83, 0x5c, 0x2c, 0xff};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xdb, 0xe9};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x8b, 0xe4, 0x27, 0x18, 0xe0, 0xe9, 0x79, 0xaa, 0x7a,
                                     0xeb, 0xa8, 0x8,  0x27, 0xed, 0x22, 0xab, 0xb1};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0x80, 0xf4, 0xb0, 0xbe, 0xc7, 0x15, 0x2d, 0xb7, 0xba, 0xb8, 0xe1, 0x72, 0xf2, 0xca, 0x63,
                           0xed, 0x12, 0xfb, 0xe9, 0x3e, 0x66, 0xdc, 0x12, 0x92, 0x48, 0xa0, 0xe9, 0xa6, 0x71};
  uint8_t bytesprops1[] = {0x8f, 0xfc, 0xf7, 0x53, 0xbd, 0x1e, 0x45, 0xa5, 0xbe, 0x42, 0xad, 0x41, 0x62, 0x5e,
                           0xd,  0x20, 0xd9, 0xaa, 0x10, 0xd6, 0x8e, 0x5d, 0x40, 0x56, 0xa5, 0x39, 0xb9, 0x4c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17001}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28027, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16403 [("36\t\GS\147",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS1}),("\219(\232\129\147/\NAKI\148\189\191\241l\207\134M;
// \146\255\164\SI\129\251\252g\253\DLE=",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\178]k\204\209\202\239\157m\227\SI\182M\tft\NUL?\184]}\128\149%\202\234",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(",\249N\129\196\212+ft,\180\v\166\t\164j\DEL\ETB\SYNC\244GIO\203\176\180|\148",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropRequestProblemInformation
// 104,PropMessageExpiryInterval 8176,PropServerReference
// "$;3O@\155\252;\218*\227\DC2\171A\142~\169\&4\154i\ETX\FS\134\216\215\200\FS.",PropTopicAlias 3118,PropMaximumQoS
// 36,PropAuthenticationData "\146\t",PropResponseTopic
// "\153\138\ETBB\224C\196\174\224\ESC\EOT\249\vHT\163/\208e\192\215\&1\238\213\179O\224",PropTopicAlias
// 3095,PropReasonString
// "\212U\142\147\208\216\242\NAK\212\160\153\198\149\205\216\n\154\171\SUB\146\135:`:\186\SO\178B\GS\192",PropSharedSubscriptionAvailable
// 17,PropSubscriptionIdentifier 16,PropMessageExpiryInterval 4489,PropReceiveMaximum 32086,PropTopicAliasMaximum
// 29734,PropWillDelayInterval 24777,PropMaximumQoS 102,PropServerReference
// "\189\DLE\136lf\172\162ON",PropSubscriptionIdentifierAvailable 80,PropRequestProblemInformation
// 86,PropRetainAvailable 104,PropSharedSubscriptionAvailable 21,PropMaximumQoS 169,PropServerReference
// "\ETX9\150\170\210\235",PropAuthenticationData
// "\165`\DC1\240\DEL\STX\FS\EMH\CAN\179\197\147\249\215\209.\223\DC1\t\162o\164",PropRetainAvailable
// 155,PropUserProperty "\\\194\166?\"\207\143&hS\150\&2\193\180\162W\v"
// "\167\144AL,\160\184\231\185\231\ESC\209\&3\132\208\STXO\DLE\158b",PropSubscriptionIdentifier
// 28,PropMessageExpiryInterval 25290,PropServerReference "\159\235\tf
// ~\148\239\212\243e4iyG\177\198,\177o\218\228fb\182y\141\205P",PropAssignedClientIdentifier
// "\189\ESC!O\GS\248\FS\224^X\ETB}\142\DC4\DC1|T\243\226\218\145d\232\191\153[\129\253\ACK\ETX"]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x82, 0x9e, 0x3,  0x40, 0x13, 0xb5, 0x2,  0x17, 0x68, 0x2,  0x0,  0x0,  0x1f, 0xf0, 0x1c, 0x0,  0x1c, 0x24, 0x3b,
      0x33, 0x4f, 0x40, 0x9b, 0xfc, 0x3b, 0xda, 0x2a, 0xe3, 0x12, 0xab, 0x41, 0x8e, 0x7e, 0xa9, 0x34, 0x9a, 0x69, 0x3,
      0x1c, 0x86, 0xd8, 0xd7, 0xc8, 0x1c, 0x2e, 0x23, 0xc,  0x2e, 0x24, 0x24, 0x16, 0x0,  0x2,  0x92, 0x9,  0x8,  0x0,
      0x1b, 0x99, 0x8a, 0x17, 0x42, 0xe0, 0x43, 0xc4, 0xae, 0xe0, 0x1b, 0x4,  0xf9, 0xb,  0x48, 0x54, 0xa3, 0x2f, 0xd0,
      0x65, 0xc0, 0xd7, 0x31, 0xee, 0xd5, 0xb3, 0x4f, 0xe0, 0x23, 0xc,  0x17, 0x1f, 0x0,  0x1e, 0xd4, 0x55, 0x8e, 0x93,
      0xd0, 0xd8, 0xf2, 0x15, 0xd4, 0xa0, 0x99, 0xc6, 0x95, 0xcd, 0xd8, 0xa,  0x9a, 0xab, 0x1a, 0x92, 0x87, 0x3a, 0x60,
      0x3a, 0xba, 0xe,  0xb2, 0x42, 0x1d, 0xc0, 0x2a, 0x11, 0xb,  0x10, 0x2,  0x0,  0x0,  0x11, 0x89, 0x21, 0x7d, 0x56,
      0x22, 0x74, 0x26, 0x18, 0x0,  0x0,  0x60, 0xc9, 0x24, 0x66, 0x1c, 0x0,  0x9,  0xbd, 0x10, 0x88, 0x6c, 0x66, 0xac,
      0xa2, 0x4f, 0x4e, 0x29, 0x50, 0x17, 0x56, 0x25, 0x68, 0x2a, 0x15, 0x24, 0xa9, 0x1c, 0x0,  0x6,  0x3,  0x39, 0x96,
      0xaa, 0xd2, 0xeb, 0x16, 0x0,  0x17, 0xa5, 0x60, 0x11, 0xf0, 0x7f, 0x2,  0x1c, 0x19, 0x48, 0x18, 0xb3, 0xc5, 0x93,
      0xf9, 0xd7, 0xd1, 0x2e, 0xdf, 0x11, 0x9,  0xa2, 0x6f, 0xa4, 0x25, 0x9b, 0x26, 0x0,  0x11, 0x5c, 0xc2, 0xa6, 0x3f,
      0x22, 0xcf, 0x8f, 0x26, 0x68, 0x53, 0x96, 0x32, 0xc1, 0xb4, 0xa2, 0x57, 0xb,  0x0,  0x14, 0xa7, 0x90, 0x41, 0x4c,
      0x2c, 0xa0, 0xb8, 0xe7, 0xb9, 0xe7, 0x1b, 0xd1, 0x33, 0x84, 0xd0, 0x2,  0x4f, 0x10, 0x9e, 0x62, 0xb,  0x1c, 0x2,
      0x0,  0x0,  0x62, 0xca, 0x1c, 0x0,  0x1d, 0x9f, 0xeb, 0x9,  0x66, 0x20, 0x7e, 0x94, 0xef, 0xd4, 0xf3, 0x65, 0x34,
      0x69, 0x79, 0x47, 0xb1, 0xc6, 0x2c, 0xb1, 0x6f, 0xda, 0xe4, 0x66, 0x62, 0xb6, 0x79, 0x8d, 0xcd, 0x50, 0x12, 0x0,
      0x1e, 0xbd, 0x1b, 0x21, 0x4f, 0x1d, 0xf8, 0x1c, 0xe0, 0x5e, 0x58, 0x17, 0x7d, 0x8e, 0x14, 0x11, 0x7c, 0x54, 0xf3,
      0xe2, 0xda, 0x91, 0x64, 0xe8, 0xbf, 0x99, 0x5b, 0x81, 0xfd, 0x6,  0x3,  0x0,  0x5,  0x33, 0x36, 0x9,  0x1d, 0x93,
      0x19, 0x0,  0x1d, 0xdb, 0x28, 0xe8, 0x81, 0x93, 0x2f, 0x15, 0x49, 0x94, 0xbd, 0xbf, 0xf1, 0x6c, 0xcf, 0x86, 0x4d,
      0x3b, 0x20, 0x92, 0xff, 0xa4, 0xf,  0x81, 0xfb, 0xfc, 0x67, 0xfd, 0x10, 0x3d, 0x22, 0x0,  0x1a, 0xb2, 0x5d, 0x6b,
      0xcc, 0xd1, 0xca, 0xef, 0x9d, 0x6d, 0xe3, 0xf,  0xb6, 0x4d, 0x9,  0x66, 0x74, 0x0,  0x3f, 0xb8, 0x5d, 0x7d, 0x80,
      0x95, 0x25, 0xca, 0xea, 0x2,  0x0,  0x1d, 0x2c, 0xf9, 0x4e, 0x81, 0xc4, 0xd4, 0x2b, 0x66, 0x74, 0x2c, 0xb4, 0xb,
      0xa6, 0x9,  0xa4, 0x6a, 0x7f, 0x17, 0x16, 0x43, 0xf4, 0x47, 0x49, 0x4f, 0xcb, 0xb0, 0xb4, 0x7c, 0x94, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x33, 0x36, 0x9, 0x1d, 0x93};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdb, 0x28, 0xe8, 0x81, 0x93, 0x2f, 0x15, 0x49, 0x94, 0xbd,
                                     0xbf, 0xf1, 0x6c, 0xcf, 0x86, 0x4d, 0x3b, 0x20, 0x92, 0xff,
                                     0xa4, 0xf,  0x81, 0xfb, 0xfc, 0x67, 0xfd, 0x10, 0x3d};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb2, 0x5d, 0x6b, 0xcc, 0xd1, 0xca, 0xef, 0x9d, 0x6d, 0xe3, 0xf,  0xb6, 0x4d,
                                     0x9,  0x66, 0x74, 0x0,  0x3f, 0xb8, 0x5d, 0x7d, 0x80, 0x95, 0x25, 0xca, 0xea};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2c, 0xf9, 0x4e, 0x81, 0xc4, 0xd4, 0x2b, 0x66, 0x74, 0x2c,
                                     0xb4, 0xb,  0xa6, 0x9,  0xa4, 0x6a, 0x7f, 0x17, 0x16, 0x43,
                                     0xf4, 0x47, 0x49, 0x4f, 0xcb, 0xb0, 0xb4, 0x7c, 0x94};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  uint8_t bytesprops0[] = {0x24, 0x3b, 0x33, 0x4f, 0x40, 0x9b, 0xfc, 0x3b, 0xda, 0x2a, 0xe3, 0x12, 0xab, 0x41,
                           0x8e, 0x7e, 0xa9, 0x34, 0x9a, 0x69, 0x3,  0x1c, 0x86, 0xd8, 0xd7, 0xc8, 0x1c, 0x2e};
  uint8_t bytesprops1[] = {0x92, 0x9};
  uint8_t bytesprops2[] = {0x99, 0x8a, 0x17, 0x42, 0xe0, 0x43, 0xc4, 0xae, 0xe0, 0x1b, 0x4,  0xf9, 0xb, 0x48,
                           0x54, 0xa3, 0x2f, 0xd0, 0x65, 0xc0, 0xd7, 0x31, 0xee, 0xd5, 0xb3, 0x4f, 0xe0};
  uint8_t bytesprops3[] = {0xd4, 0x55, 0x8e, 0x93, 0xd0, 0xd8, 0xf2, 0x15, 0xd4, 0xa0, 0x99, 0xc6, 0x95, 0xcd, 0xd8,
                           0xa,  0x9a, 0xab, 0x1a, 0x92, 0x87, 0x3a, 0x60, 0x3a, 0xba, 0xe,  0xb2, 0x42, 0x1d, 0xc0};
  uint8_t bytesprops4[] = {0xbd, 0x10, 0x88, 0x6c, 0x66, 0xac, 0xa2, 0x4f, 0x4e};
  uint8_t bytesprops5[] = {0x3, 0x39, 0x96, 0xaa, 0xd2, 0xeb};
  uint8_t bytesprops6[] = {0xa5, 0x60, 0x11, 0xf0, 0x7f, 0x2,  0x1c, 0x19, 0x48, 0x18, 0xb3, 0xc5,
                           0x93, 0xf9, 0xd7, 0xd1, 0x2e, 0xdf, 0x11, 0x9,  0xa2, 0x6f, 0xa4};
  uint8_t bytesprops8[] = {0xa7, 0x90, 0x41, 0x4c, 0x2c, 0xa0, 0xb8, 0xe7, 0xb9, 0xe7,
                           0x1b, 0xd1, 0x33, 0x84, 0xd0, 0x2,  0x4f, 0x10, 0x9e, 0x62};
  uint8_t bytesprops7[] = {0x5c, 0xc2, 0xa6, 0x3f, 0x22, 0xcf, 0x8f, 0x26, 0x68,
                           0x53, 0x96, 0x32, 0xc1, 0xb4, 0xa2, 0x57, 0xb};
  uint8_t bytesprops9[] = {0x9f, 0xeb, 0x9,  0x66, 0x20, 0x7e, 0x94, 0xef, 0xd4, 0xf3, 0x65, 0x34, 0x69, 0x79, 0x47,
                           0xb1, 0xc6, 0x2c, 0xb1, 0x6f, 0xda, 0xe4, 0x66, 0x62, 0xb6, 0x79, 0x8d, 0xcd, 0x50};
  uint8_t bytesprops10[] = {0xbd, 0x1b, 0x21, 0x4f, 0x1d, 0xf8, 0x1c, 0xe0, 0x5e, 0x58, 0x17, 0x7d, 0x8e, 0x14, 0x11,
                            0x7c, 0x54, 0xf3, 0xe2, 0xda, 0x91, 0x64, 0xe8, 0xbf, 0x99, 0x5b, 0x81, 0xfd, 0x6,  0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8176}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3118}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3095}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4489}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32086}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29734}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24777}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops7}, .v = {20, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25290}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 16403, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25747 [(":\163i\190\141\188d\208\&4\STX\b\EMn\ETB.y\192\230kO\177\204'\156\206",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\184\200\144sIg\248\r\181<\187\NUL\207\160Y\137I\224\151]U'g[\v\ACKr",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\136\159\161\ETB\151\211$\128E",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("v\ay\rA\210\DC2\243",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("e\174q\139U\145\139
// \140\238i\152?\244\239\ACKBN\248\218\188\238\DELu\EOT\ENQ/",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),(",\196\144\&6$\US\DC3\212\195n\RS\149\140\204}\235\149\DC2\234\254\f",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("[\241\133m#\240#\175",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropTopicAlias
// 9871,PropWildcardSubscriptionAvailable 245,PropSubscriptionIdentifierAvailable 153,PropReasonString
// "\189\225K\201\t>\DC3{\215\199\185K\EOTM\172Q\128\150\208[\128\164\149",PropUserProperty ",bEZ\239\ESC\SOH\148_\ETXo"
// "A:I\242\215o\237\194\183\224\133",PropUserProperty "\129\183 \220\212\DC4']\180\247\ACK"
// "\140W\224.P\SYNpR\a\236$~\254\137\204\150",PropReceiveMaximum 32665,PropServerKeepAlive 9559,PropRetainAvailable
// 138]
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0xfc, 0x1,  0x64, 0x93, 0x64, 0x23, 0x26, 0x8f, 0x28, 0xf5, 0x29, 0x99, 0x1f, 0x0,  0x17, 0xbd,
                   0xe1, 0x4b, 0xc9, 0x9,  0x3e, 0x13, 0x7b, 0xd7, 0xc7, 0xb9, 0x4b, 0x4,  0x4d, 0xac, 0x51, 0x80, 0x96,
                   0xd0, 0x5b, 0x80, 0xa4, 0x95, 0x26, 0x0,  0xb,  0x2c, 0x62, 0x45, 0x5a, 0xef, 0x1b, 0x1,  0x94, 0x5f,
                   0x3,  0x6f, 0x0,  0xb,  0x41, 0x3a, 0x49, 0xf2, 0xd7, 0x6f, 0xed, 0xc2, 0xb7, 0xe0, 0x85, 0x26, 0x0,
                   0xb,  0x81, 0xb7, 0x20, 0xdc, 0xd4, 0x14, 0x27, 0x5d, 0xb4, 0xf7, 0x6,  0x0,  0x10, 0x8c, 0x57, 0xe0,
                   0x2e, 0x50, 0x16, 0x70, 0x52, 0x7,  0xec, 0x24, 0x7e, 0xfe, 0x89, 0xcc, 0x96, 0x21, 0x7f, 0x99, 0x13,
                   0x25, 0x57, 0x25, 0x8a, 0x0,  0x19, 0x3a, 0xa3, 0x69, 0xbe, 0x8d, 0xbc, 0x64, 0xd0, 0x34, 0x2,  0x8,
                   0x19, 0x6e, 0x17, 0x2e, 0x79, 0xc0, 0xe6, 0x6b, 0x4f, 0xb1, 0xcc, 0x27, 0x9c, 0xce, 0x1,  0x0,  0x1b,
                   0xb8, 0xc8, 0x90, 0x73, 0x49, 0x67, 0xf8, 0xd,  0xb5, 0x3c, 0xbb, 0x0,  0xcf, 0xa0, 0x59, 0x89, 0x49,
                   0xe0, 0x97, 0x5d, 0x55, 0x27, 0x67, 0x5b, 0xb,  0x6,  0x72, 0x10, 0x0,  0x0,  0x18, 0x0,  0x9,  0x88,
                   0x9f, 0xa1, 0x17, 0x97, 0xd3, 0x24, 0x80, 0x45, 0x0,  0x0,  0x8,  0x76, 0x7,  0x79, 0xd,  0x41, 0xd2,
                   0x12, 0xf3, 0x15, 0x0,  0x1b, 0x65, 0xae, 0x71, 0x8b, 0x55, 0x91, 0x8b, 0x20, 0x8c, 0xee, 0x69, 0x98,
                   0x3f, 0xf4, 0xef, 0x6,  0x42, 0x4e, 0xf8, 0xda, 0xbc, 0xee, 0x7f, 0x75, 0x4,  0x5,  0x2f, 0x2c, 0x0,
                   0x15, 0x2c, 0xc4, 0x90, 0x36, 0x24, 0x1f, 0x13, 0xd4, 0xc3, 0x6e, 0x1e, 0x95, 0x8c, 0xcc, 0x7d, 0xeb,
                   0x95, 0x12, 0xea, 0xfe, 0xc,  0x1c, 0x0,  0x8,  0x5b, 0xf1, 0x85, 0x6d, 0x23, 0xf0, 0x23, 0xaf, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x3a, 0xa3, 0x69, 0xbe, 0x8d, 0xbc, 0x64, 0xd0, 0x34, 0x2,  0x8,  0x19, 0x6e,
                                     0x17, 0x2e, 0x79, 0xc0, 0xe6, 0x6b, 0x4f, 0xb1, 0xcc, 0x27, 0x9c, 0xce};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb8, 0xc8, 0x90, 0x73, 0x49, 0x67, 0xf8, 0xd,  0xb5, 0x3c, 0xbb, 0x0, 0xcf, 0xa0,
                                     0x59, 0x89, 0x49, 0xe0, 0x97, 0x5d, 0x55, 0x27, 0x67, 0x5b, 0xb,  0x6, 0x72};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x9f, 0xa1, 0x17, 0x97, 0xd3, 0x24, 0x80, 0x45};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x76, 0x7, 0x79, 0xd, 0x41, 0xd2, 0x12, 0xf3};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x65, 0xae, 0x71, 0x8b, 0x55, 0x91, 0x8b, 0x20, 0x8c, 0xee, 0x69, 0x98, 0x3f, 0xf4,
                                     0xef, 0x6,  0x42, 0x4e, 0xf8, 0xda, 0xbc, 0xee, 0x7f, 0x75, 0x4,  0x5,  0x2f};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2c, 0xc4, 0x90, 0x36, 0x24, 0x1f, 0x13, 0xd4, 0xc3, 0x6e, 0x1e,
                                     0x95, 0x8c, 0xcc, 0x7d, 0xeb, 0x95, 0x12, 0xea, 0xfe, 0xc};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x5b, 0xf1, 0x85, 0x6d, 0x23, 0xf0, 0x23, 0xaf};
  lwmqtt_string_t topic_filter_s7 = {8, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0xbd, 0xe1, 0x4b, 0xc9, 0x9,  0x3e, 0x13, 0x7b, 0xd7, 0xc7, 0xb9, 0x4b,
                           0x4,  0x4d, 0xac, 0x51, 0x80, 0x96, 0xd0, 0x5b, 0x80, 0xa4, 0x95};
  uint8_t bytesprops2[] = {0x41, 0x3a, 0x49, 0xf2, 0xd7, 0x6f, 0xed, 0xc2, 0xb7, 0xe0, 0x85};
  uint8_t bytesprops1[] = {0x2c, 0x62, 0x45, 0x5a, 0xef, 0x1b, 0x1, 0x94, 0x5f, 0x3, 0x6f};
  uint8_t bytesprops4[] = {0x8c, 0x57, 0xe0, 0x2e, 0x50, 0x16, 0x70, 0x52,
                           0x7,  0xec, 0x24, 0x7e, 0xfe, 0x89, 0xcc, 0x96};
  uint8_t bytesprops3[] = {0x81, 0xb7, 0x20, 0xdc, 0xd4, 0x14, 0x27, 0x5d, 0xb4, 0xf7, 0x6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9871}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops3}, .v = {16, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32665}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9559}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 138}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25747, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeResponse 8450 [Right QoS0] []
TEST(SubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0x3, 0x21, 0x2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8450);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
}

// SubscribeResponse 20275 [Right QoS2,Right QoS0,Left SubErrQuotaExceeded,Right QoS0,Right QoS2,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError,Right QoS2] []
TEST(SubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0xb, 0x4f, 0x33, 0x2, 0x0, 0x97, 0x0, 0x2, 0x9e, 0x97, 0x80, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20275);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 3848 [Right QoS0,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError,Right QoS2,Left
// SubErrPacketIdentifierInUse,Left SubErrNotAuthorized,Left SubErrImplementationSpecificError,Right QoS1,Right QoS0] []
TEST(SubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0xb, 0xf, 0x8, 0x0, 0x97, 0x80, 0x2, 0x91, 0x87, 0x83, 0x1, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3848);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
}

// SubscribeResponse 21048 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrUnspecifiedError,Right QoS1,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0x8, 0x52, 0x38, 0xa2, 0x2, 0xa1, 0x80, 0x1, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21048);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
}

// SubscribeResponse 24181 [Right QoS0,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Right QoS0] []
TEST(SubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x6, 0x5e, 0x75, 0x0, 0x80, 0x87, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24181);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
}

// SubscribeResponse 29704 [Right QoS2,Right QoS1,Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Right QoS0,Right
// QoS1] []
TEST(SubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0x8, 0x74, 0x8, 0x2, 0x1, 0x9e, 0x0, 0x0, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29704);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 8 [Right QoS2] []
TEST(SubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x3, 0x0, 0x8, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
}

// SubscribeResponse 24329 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS0,Right QoS2,Right QoS0,Right QoS0,Right
// QoS1,Right QoS2] []
TEST(SubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0xc, 0x5f, 0x9, 0x2, 0x9e, 0xa2, 0x80, 0x0, 0x2, 0x0, 0x0, 0x1, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24329);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 10189 [Left SubErrImplementationSpecificError,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS2,Left SubErrUnspecifiedError,Right QoS1,Left
// SubErrImplementationSpecificError,Right QoS2,Left SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Left
// SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0xd, 0x27, 0xcd, 0x83, 0x0, 0x9e, 0x2, 0x80, 0x1, 0x83, 0x2, 0x83, 0x97, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10189);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 11213 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Right QoS0,Right
// QoS0,Right QoS0,Right QoS2,Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0x9, 0x2b, 0xcd, 0x9e, 0x97, 0x0, 0x0, 0x0, 0x2, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11213);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 16288 [Right QoS0,Right QoS1,Left SubErrUnspecifiedError,Left SubErrUnspecifiedError,Left
// SubErrNotAuthorized,Right QoS1,Right QoS1,Right QoS2,Left SubErrNotAuthorized] []
TEST(SubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0xb, 0x3f, 0xa0, 0x0, 0x1, 0x80, 0x80, 0x87, 0x1, 0x1, 0x2, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16288);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 12823 [Left SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x6, 0x32, 0x17, 0x8f, 0xa1, 0x0, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12823);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 27996 [Left SubErrSharedSubscriptionsNotSupported,Right QoS2,Right QoS2,Left
// SubErrImplementationSpecificError,Right QoS1,Right QoS2,Left SubErrUnspecifiedError,Left
// SubErrTopicFilterInvalid,Left SubErrPacketIdentifierInUse,Left SubErrSharedSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0xc, 0x6d, 0x5c, 0x9e, 0x2, 0x2, 0x83, 0x1, 0x2, 0x80, 0x8f, 0x91, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27996);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
}

// SubscribeResponse 30878 [Left SubErrUnspecifiedError,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrUnspecifiedError,Left
// SubErrTopicFilterInvalid,Right QoS0] []
TEST(SubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0xa, 0x78, 0x9e, 0x80, 0x1, 0xa2, 0x80, 0xa2, 0x80, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30878);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
}

// SubscribeResponse 7754 [Right QoS0,Right QoS2,Right QoS1,Right QoS1,Right QoS1,Right QoS2,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS0,Right QoS1,Left
// SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0xd, 0x1e, 0x4a, 0x0, 0x2, 0x1, 0x1, 0x1, 0x2, 0x9e, 0x1, 0x0, 0x1, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7754);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 29991 [Left SubErrPacketIdentifierInUse,Right QoS1,Right QoS0,Left
// SubErrPacketIdentifierInUse,Right QoS1,Right QoS1,Left SubErrImplementationSpecificError,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS0] []
TEST(SubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0xb, 0x75, 0x27, 0x91, 0x1, 0x0, 0x91, 0x1, 0x1, 0x83, 0xa1, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29991);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
}

// SubscribeResponse 6273 [Right QoS1,Right QoS0] []
TEST(SubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x4, 0x18, 0x81, 0x1, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6273);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
}

// SubscribeResponse 10407 [Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0x3, 0x28, 0xa7, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10407);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
}

// SubscribeResponse 13436 [Left SubErrPacketIdentifierInUse,Left SubErrImplementationSpecificError,Left
// SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Left SubErrNotAuthorized,Right QoS0,Right QoS1,Left
// SubErrQuotaExceeded,Right QoS0,Right QoS0] []
TEST(SubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0xc, 0x34, 0x7c, 0x91, 0x83, 0x83, 0x97, 0x87, 0x0, 0x1, 0x97, 0x0, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13436);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 634 [Right QoS2,Left SubErrPacketIdentifierInUse,Right QoS1,Left
// SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Right QoS0,Left SubErrWildcardSubscriptionsNotSupported]
// []
TEST(SubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0x9, 0x2, 0x7a, 0x2, 0x91, 0x1, 0x83, 0x97, 0x0, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 634);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 742 [Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Right QoS1,Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0xb, 0x2, 0xe6, 0x0, 0xa1, 0x91, 0x2, 0x9e, 0x83, 0x97, 0x1, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 742);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 14677 [Left SubErrTopicFilterInvalid,Right QoS0,Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0x5, 0x39, 0x55, 0x8f, 0x0, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14677);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 22954 [Right QoS1,Left SubErrTopicFilterInvalid,Left SubErrQuotaExceeded,Right QoS0,Left
// SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x7, 0x59, 0xaa, 0x1, 0x8f, 0x97, 0x0, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22954);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 18733 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS2,Right QoS1,Right QoS1] []
TEST(SubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x8, 0x49, 0x2d, 0x2, 0xa2, 0x91, 0x2, 0x1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18733);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 22455 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Left
// SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrQuotaExceeded,Right QoS0,Left
// SubErrTopicFilterInvalid,Right QoS1,Right QoS1] []
TEST(SubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0xb, 0x57, 0xb7, 0x9e, 0x97, 0x8f, 0xa1, 0x97, 0x0, 0x8f, 0x1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22455);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 556 [Right QoS1,Left SubErrImplementationSpecificError,Right QoS1] []
TEST(SubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0x5, 0x2, 0x2c, 0x1, 0x83, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 556);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
}

// SubscribeResponse 15417 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left SubErrNotAuthorized]
// []
TEST(SubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x6, 0x3c, 0x39, 0x2, 0xa2, 0x0, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15417);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 26950 [Left SubErrImplementationSpecificError,Right QoS2,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS1] []
TEST(SubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x7, 0x69, 0x46, 0x83, 0x2, 0x2, 0xa1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26950);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
}

// SubscribeResponse 24196 [Left SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError,Right QoS0,Right QoS0,Left SubErrTopicFilterInvalid,Left
// SubErrPacketIdentifierInUse,Right QoS2] []
TEST(SubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0xb, 0x5e, 0x84, 0x9e, 0x1, 0x8f, 0x83, 0x0, 0x0, 0x8f, 0x91, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24196);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 19551 [Left SubErrPacketIdentifierInUse,Right QoS2,Left SubErrUnspecifiedError,Right QoS1,Right
// QoS2,Left SubErrPacketIdentifierInUse,Right QoS1,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrQuotaExceeded,Right QoS0] []
TEST(SubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0xc, 0x4c, 0x5f, 0x91, 0x2, 0x80, 0x1, 0x2, 0x91, 0x1, 0x9e, 0x97, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19551);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 8450 [Right QoS0] [PropResponseInformation "\253u\180K`\159\150\fE\153}H",PropReceiveMaximum
// 24891,PropMaximumPacketSize 28088]
TEST(SubACK5QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0x1b, 0x21, 0x2,  0x17, 0x1a, 0x0,  0xc,  0xfd, 0x75, 0xb4, 0x4b, 0x60, 0x9f, 0x96,
                   0xc,  0x45, 0x99, 0x7d, 0x48, 0x21, 0x61, 0x3b, 0x27, 0x0,  0x0,  0x6d, 0xb8, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8450);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
}

// SubscribeResponse 20275 [Right QoS2,Right QoS0,Left SubErrQuotaExceeded,Right QoS0,Right QoS2,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError,Right QoS2]
// [PropAuthenticationData "\143\227\202\173[{\229$\148j<\161\220\DLE\204\194B",PropReasonString
// "rQ\202\231\161\&9\180\219\188\237\213U\157\233jKkC=\194\159\184T\187%\248\DC3j\156",PropSubscriptionIdentifierAvailable
// 97,PropWillDelayInterval 25789,PropTopicAliasMaximum 20234,PropServerKeepAlive 26883,PropPayloadFormatIndicator
// 65,PropWillDelayInterval 21939,PropServerReference
// "-\ETB\173\v\224\231Q\NAKr\b\196\158a\238\EM\185\244\&8h\152\UShJ\146",PropMaximumPacketSize
// 10688,PropWildcardSubscriptionAvailable 25,PropResponseInformation
// "\216\152\200\230\208o\208\DLE",PropAssignedClientIdentifier "\n",PropSessionExpiryInterval 20612,PropCorrelationData
// "\188{\132\187\247\ACK"]
TEST(SubACK5QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x94, 0x1,  0x4f, 0x33, 0x87, 0x1,  0x16, 0x0,  0x11, 0x8f, 0xe3, 0xca, 0xad, 0x5b, 0x7b, 0xe5,
                   0x24, 0x94, 0x6a, 0x3c, 0xa1, 0xdc, 0x10, 0xcc, 0xc2, 0x42, 0x1f, 0x0,  0x1d, 0x72, 0x51, 0xca, 0xe7,
                   0xa1, 0x39, 0xb4, 0xdb, 0xbc, 0xed, 0xd5, 0x55, 0x9d, 0xe9, 0x6a, 0x4b, 0x6b, 0x43, 0x3d, 0xc2, 0x9f,
                   0xb8, 0x54, 0xbb, 0x25, 0xf8, 0x13, 0x6a, 0x9c, 0x29, 0x61, 0x18, 0x0,  0x0,  0x64, 0xbd, 0x22, 0x4f,
                   0xa,  0x13, 0x69, 0x3,  0x1,  0x41, 0x18, 0x0,  0x0,  0x55, 0xb3, 0x1c, 0x0,  0x18, 0x2d, 0x17, 0xad,
                   0xb,  0xe0, 0xe7, 0x51, 0x15, 0x72, 0x8,  0xc4, 0x9e, 0x61, 0xee, 0x19, 0xb9, 0xf4, 0x38, 0x68, 0x98,
                   0x1f, 0x68, 0x4a, 0x92, 0x27, 0x0,  0x0,  0x29, 0xc0, 0x28, 0x19, 0x1a, 0x0,  0x8,  0xd8, 0x98, 0xc8,
                   0xe6, 0xd0, 0x6f, 0xd0, 0x10, 0x12, 0x0,  0x1,  0xa,  0x11, 0x0,  0x0,  0x50, 0x84, 0x9,  0x0,  0x6,
                   0xbc, 0x7b, 0x84, 0xbb, 0xf7, 0x6,  0x2,  0x0,  0x97, 0x0,  0x2,  0x9e, 0x97, 0x80, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20275);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x9E);
  EXPECT_EQ(granted_qos_levels[6], 0x97);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 3848 [Right QoS0,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError,Right QoS2,Left
// SubErrPacketIdentifierInUse,Left SubErrNotAuthorized,Left SubErrImplementationSpecificError,Right QoS1,Right QoS0]
// [PropTopicAliasMaximum 10554,PropSubscriptionIdentifierAvailable 81,PropTopicAlias 14436,PropReceiveMaximum
// 20441,PropCorrelationData "\148\162\129Gq\a\SYN\CAN\194\&4",PropResponseInformation
// "\231\CAN\128\ETXI\154\GS\249Jp\a.",PropSubscriptionIdentifierAvailable 23,PropContentType
// "\172\162&\f\194\135\128\154\DC32\179\222\&1\252\a\ACK\SIs!\DC4\185\131n;*",PropRetainAvailable
// 236,PropWillDelayInterval 13881,PropAuthenticationMethod
// "\228\216\192\DC3{W\USs\205\148F\192\&6a\204\152\242\&4\237?\169\174\216;\211\204\223\f",PropCorrelationData
// "\FS\SYN9\208\&2\146y\254\144\202g\234\161%\GSS\EOT0\226\162\SOH\137U",PropServerKeepAlive 25204]
TEST(SubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x95, 0x1,  0xf,  0x8,  0x88, 0x1,  0x22, 0x29, 0x3a, 0x29, 0x51, 0x23, 0x38, 0x64, 0x21, 0x4f,
                   0xd9, 0x9,  0x0,  0xa,  0x94, 0xa2, 0x81, 0x47, 0x71, 0x7,  0x16, 0x18, 0xc2, 0x34, 0x1a, 0x0,  0xc,
                   0xe7, 0x18, 0x80, 0x3,  0x49, 0x9a, 0x1d, 0xf9, 0x4a, 0x70, 0x7,  0x2e, 0x29, 0x17, 0x3,  0x0,  0x19,
                   0xac, 0xa2, 0x26, 0xc,  0xc2, 0x87, 0x80, 0x9a, 0x13, 0x32, 0xb3, 0xde, 0x31, 0xfc, 0x7,  0x6,  0xf,
                   0x73, 0x21, 0x14, 0xb9, 0x83, 0x6e, 0x3b, 0x2a, 0x25, 0xec, 0x18, 0x0,  0x0,  0x36, 0x39, 0x15, 0x0,
                   0x1c, 0xe4, 0xd8, 0xc0, 0x13, 0x7b, 0x57, 0x1f, 0x73, 0xcd, 0x94, 0x46, 0xc0, 0x36, 0x61, 0xcc, 0x98,
                   0xf2, 0x34, 0xed, 0x3f, 0xa9, 0xae, 0xd8, 0x3b, 0xd3, 0xcc, 0xdf, 0xc,  0x9,  0x0,  0x17, 0x1c, 0x16,
                   0x39, 0xd0, 0x32, 0x92, 0x79, 0xfe, 0x90, 0xca, 0x67, 0xea, 0xa1, 0x25, 0x1d, 0x53, 0x4,  0x30, 0xe2,
                   0xa2, 0x1,  0x89, 0x55, 0x13, 0x62, 0x74, 0x0,  0x97, 0x80, 0x2,  0x91, 0x87, 0x83, 0x1,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3848);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x97);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x91);
  EXPECT_EQ(granted_qos_levels[5], 0x87);
  EXPECT_EQ(granted_qos_levels[6], 0x83);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
}

// SubscribeResponse 21048 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrUnspecifiedError,Right QoS1,Left SubErrUnspecifiedError]
// [PropReasonString "o\143\223\139\170\249\182\142\220\FS\DC4\214\173\NUL\234+p\177Zd\247\&1*V\140",PropContentType
// "\RS*\SUB\ESC\NAK\nB\224\173\214\212\163z/\225",PropRetainAvailable 255,PropResponseTopic
// "\191\STX\221\172j\247\210\208",PropPayloadFormatIndicator 92,PropPayloadFormatIndicator 61,PropWillDelayInterval
// 3196,PropMaximumQoS 45,PropSessionExpiryInterval 11712,PropSessionExpiryInterval 21681,PropSessionExpiryInterval
// 10572,PropWildcardSubscriptionAvailable 93,PropAuthenticationData "\196\236\231",PropMessageExpiryInterval
// 11997,PropReasonString "v\RS(+hC\194B",PropSubscriptionIdentifierAvailable 77,PropTopicAlias
// 14811,PropRetainAvailable 155,PropResponseTopic "\217\178q\229|\154[1\a\CAN\138 \166",PropReceiveMaximum
// 86,PropReceiveMaximum 17084,PropWildcardSubscriptionAvailable 136,PropReceiveMaximum 8446,PropContentType
// "\193\168\176\&6X\185\203\232\SOH\219\194\176\f;J\191\155\237\"\206\n\225\DC1",PropMessageExpiryInterval 7662]
TEST(SubACK5QCTest, Decode4) {
  uint8_t pkt[] = {
      0x90, 0xb8, 0x1,  0x52, 0x38, 0xae, 0x1,  0x1f, 0x0,  0x19, 0x6f, 0x8f, 0xdf, 0x8b, 0xaa, 0xf9, 0xb6, 0x8e, 0xdc,
      0x1c, 0x14, 0xd6, 0xad, 0x0,  0xea, 0x2b, 0x70, 0xb1, 0x5a, 0x64, 0xf7, 0x31, 0x2a, 0x56, 0x8c, 0x3,  0x0,  0xf,
      0x1e, 0x2a, 0x1a, 0x1b, 0x15, 0xa,  0x42, 0xe0, 0xad, 0xd6, 0xd4, 0xa3, 0x7a, 0x2f, 0xe1, 0x25, 0xff, 0x8,  0x0,
      0x8,  0xbf, 0x2,  0xdd, 0xac, 0x6a, 0xf7, 0xd2, 0xd0, 0x1,  0x5c, 0x1,  0x3d, 0x18, 0x0,  0x0,  0xc,  0x7c, 0x24,
      0x2d, 0x11, 0x0,  0x0,  0x2d, 0xc0, 0x11, 0x0,  0x0,  0x54, 0xb1, 0x11, 0x0,  0x0,  0x29, 0x4c, 0x28, 0x5d, 0x16,
      0x0,  0x3,  0xc4, 0xec, 0xe7, 0x2,  0x0,  0x0,  0x2e, 0xdd, 0x1f, 0x0,  0x8,  0x76, 0x1e, 0x28, 0x2b, 0x68, 0x43,
      0xc2, 0x42, 0x29, 0x4d, 0x23, 0x39, 0xdb, 0x25, 0x9b, 0x8,  0x0,  0xd,  0xd9, 0xb2, 0x71, 0xe5, 0x7c, 0x9a, 0x5b,
      0x31, 0x7,  0x18, 0x8a, 0x20, 0xa6, 0x21, 0x0,  0x56, 0x21, 0x42, 0xbc, 0x28, 0x88, 0x21, 0x20, 0xfe, 0x3,  0x0,
      0x17, 0xc1, 0xa8, 0xb0, 0x36, 0x58, 0xb9, 0xcb, 0xe8, 0x1,  0xdb, 0xc2, 0xb0, 0xc,  0x3b, 0x4a, 0xbf, 0x9b, 0xed,
      0x22, 0xce, 0xa,  0xe1, 0x11, 0x2,  0x0,  0x0,  0x1d, 0xee, 0xa2, 0x2,  0xa1, 0x80, 0x1,  0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21048);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
}

// SubscribeResponse 24181 [Right QoS0,Left SubErrUnspecifiedError,Left SubErrNotAuthorized,Right QoS0] [PropTopicAlias
// 30523,PropPayloadFormatIndicator 73,PropPayloadFormatIndicator 92,PropAuthenticationMethod
// "4\173\163\200\211\178\&3",PropMaximumPacketSize 30847,PropMaximumPacketSize 4545,PropRetainAvailable
// 244,PropSessionExpiryInterval 28627,PropAuthenticationData
// "\a1\238\201\DC4L?\207NRyxAd\165\179b\143",PropResponseTopic
// "\198i\220\134\GS\253\157\176\140\a\169\218\172\204",PropMaximumQoS 172,PropReceiveMaximum
// 24080,PropWillDelayInterval 10878]
TEST(SubACK5QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x59, 0x5e, 0x75, 0x52, 0x23, 0x77, 0x3b, 0x1,  0x49, 0x1,  0x5c, 0x15, 0x0,  0x7,  0x34,
                   0xad, 0xa3, 0xc8, 0xd3, 0xb2, 0x33, 0x27, 0x0,  0x0,  0x78, 0x7f, 0x27, 0x0,  0x0,  0x11, 0xc1,
                   0x25, 0xf4, 0x11, 0x0,  0x0,  0x6f, 0xd3, 0x16, 0x0,  0x12, 0x7,  0x31, 0xee, 0xc9, 0x14, 0x4c,
                   0x3f, 0xcf, 0x4e, 0x52, 0x79, 0x78, 0x41, 0x64, 0xa5, 0xb3, 0x62, 0x8f, 0x8,  0x0,  0xe,  0xc6,
                   0x69, 0xdc, 0x86, 0x1d, 0xfd, 0x9d, 0xb0, 0x8c, 0x7,  0xa9, 0xda, 0xac, 0xcc, 0x24, 0xac, 0x21,
                   0x5e, 0x10, 0x18, 0x0,  0x0,  0x2a, 0x7e, 0x0,  0x80, 0x87, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24181);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
}

// SubscribeResponse 29704 [Right QoS2,Right QoS1,Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Right QoS0,Right
// QoS1] [PropSessionExpiryInterval 29415,PropSessionExpiryInterval 7070,PropReceiveMaximum 22071,PropResponseTopic
// "\226A\227\210\173\250\186\190\198\149p5\218\233k\154\153\135\161",PropMaximumPacketSize 29817,PropServerKeepAlive
// 22934,PropAssignedClientIdentifier "q\217\FS+u\251j\DEL\ACK\ETXc\146\233\190W#\168;\DC1\as
// \146\186",PropAssignedClientIdentifier
// "\168\197/\142\SUB)\DEL\192\164X\229\180\238\221{6\251k#\251\177?p\ESC-\230\229",PropServerReference
// "x\201\219#\195b`\144/Vs\128t\198\211\&7\160\CAN\190\DEL\EM>\151",PropCorrelationData
// "o\133c\153\191\&4\215%",PropTopicAlias 26118,PropSharedSubscriptionAvailable 115,PropCorrelationData
// "0{\216v\211ti\200\&3\"\177\173\143\210A\183\202\&3\145\176L\129\USJl\253",PropSessionExpiryInterval
// 18085,PropSharedSubscriptionAvailable 204,PropRequestResponseInformation 162,PropSubscriptionIdentifier
// 18,PropTopicAlias 29222,PropReceiveMaximum 26778,PropSessionExpiryInterval 21467,PropMessageExpiryInterval
// 25987,PropMaximumQoS 167,PropContentType
// "\252\143\173\221\235\141\145\138\NUL\254\NAK\175\201\234\193\255\218\150\182"]
TEST(SubACK5QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0xe8, 0x1,  0x74, 0x8,  0xde, 0x1,  0x11, 0x0,  0x0,  0x72, 0xe7, 0x11, 0x0,  0x0,  0x1b, 0x9e,
                   0x21, 0x56, 0x37, 0x8,  0x0,  0x13, 0xe2, 0x41, 0xe3, 0xd2, 0xad, 0xfa, 0xba, 0xbe, 0xc6, 0x95, 0x70,
                   0x35, 0xda, 0xe9, 0x6b, 0x9a, 0x99, 0x87, 0xa1, 0x27, 0x0,  0x0,  0x74, 0x79, 0x13, 0x59, 0x96, 0x12,
                   0x0,  0x18, 0x71, 0xd9, 0x1c, 0x2b, 0x75, 0xfb, 0x6a, 0x7f, 0x6,  0x3,  0x63, 0x92, 0xe9, 0xbe, 0x57,
                   0x23, 0xa8, 0x3b, 0x11, 0x7,  0x73, 0x20, 0x92, 0xba, 0x12, 0x0,  0x1b, 0xa8, 0xc5, 0x2f, 0x8e, 0x1a,
                   0x29, 0x7f, 0xc0, 0xa4, 0x58, 0xe5, 0xb4, 0xee, 0xdd, 0x7b, 0x36, 0xfb, 0x6b, 0x23, 0xfb, 0xb1, 0x3f,
                   0x70, 0x1b, 0x2d, 0xe6, 0xe5, 0x1c, 0x0,  0x17, 0x78, 0xc9, 0xdb, 0x23, 0xc3, 0x62, 0x60, 0x90, 0x2f,
                   0x56, 0x73, 0x80, 0x74, 0xc6, 0xd3, 0x37, 0xa0, 0x18, 0xbe, 0x7f, 0x19, 0x3e, 0x97, 0x9,  0x0,  0x8,
                   0x6f, 0x85, 0x63, 0x99, 0xbf, 0x34, 0xd7, 0x25, 0x23, 0x66, 0x6,  0x2a, 0x73, 0x9,  0x0,  0x1a, 0x30,
                   0x7b, 0xd8, 0x76, 0xd3, 0x74, 0x69, 0xc8, 0x33, 0x22, 0xb1, 0xad, 0x8f, 0xd2, 0x41, 0xb7, 0xca, 0x33,
                   0x91, 0xb0, 0x4c, 0x81, 0x1f, 0x4a, 0x6c, 0xfd, 0x11, 0x0,  0x0,  0x46, 0xa5, 0x2a, 0xcc, 0x19, 0xa2,
                   0xb,  0x12, 0x23, 0x72, 0x26, 0x21, 0x68, 0x9a, 0x11, 0x0,  0x0,  0x53, 0xdb, 0x2,  0x0,  0x0,  0x65,
                   0x83, 0x24, 0xa7, 0x3,  0x0,  0x13, 0xfc, 0x8f, 0xad, 0xdd, 0xeb, 0x8d, 0x91, 0x8a, 0x0,  0xfe, 0x15,
                   0xaf, 0xc9, 0xea, 0xc1, 0xff, 0xda, 0x96, 0xb6, 0x2,  0x1,  0x9e, 0x0,  0x0,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29704);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x9E);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 8 [Right QoS2] [PropAuthenticationMethod
// "\219\DC3\203\236\192<\167-\168*Q\133\138\ETX",PropSubscriptionIdentifierAvailable 27,PropAuthenticationData
// "\ESC\245r\158!\172\\u\184\USu\253f\164",PropSubscriptionIdentifier 30,PropMessageExpiryInterval
// 18702,PropPayloadFormatIndicator 181,PropReceiveMaximum 15038,PropWildcardSubscriptionAvailable
// 106,PropReceiveMaximum 24360,PropServerReference
// ">\133%\129\139\179\174\207\189\141l\ENQ\180\149\SYN'p\178\229\174\202",PropAuthenticationData
// "{\200\n\210\234]\233\130\204w \239\151:\228\&4\132+\234rY\176\SYN\249\&7\145\NAK\nd",PropResponseInformation
// "\215\251\159\227\154\130\234$\226\ACK\174\f\224#N\EM\254\205\151\141\192]s"]
TEST(SubACK5QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x8c, 0x1,  0x0,  0x8,  0x87, 0x1,  0x15, 0x0,  0xe,  0xdb, 0x13, 0xcb, 0xec, 0xc0, 0x3c,
                   0xa7, 0x2d, 0xa8, 0x2a, 0x51, 0x85, 0x8a, 0x3,  0x29, 0x1b, 0x16, 0x0,  0xe,  0x1b, 0xf5, 0x72,
                   0x9e, 0x21, 0xac, 0x5c, 0x75, 0xb8, 0x1f, 0x75, 0xfd, 0x66, 0xa4, 0xb,  0x1e, 0x2,  0x0,  0x0,
                   0x49, 0xe,  0x1,  0xb5, 0x21, 0x3a, 0xbe, 0x28, 0x6a, 0x21, 0x5f, 0x28, 0x1c, 0x0,  0x15, 0x3e,
                   0x85, 0x25, 0x81, 0x8b, 0xb3, 0xae, 0xcf, 0xbd, 0x8d, 0x6c, 0x5,  0xb4, 0x95, 0x16, 0x27, 0x70,
                   0xb2, 0xe5, 0xae, 0xca, 0x16, 0x0,  0x1d, 0x7b, 0xc8, 0xa,  0xd2, 0xea, 0x5d, 0xe9, 0x82, 0xcc,
                   0x77, 0x20, 0xef, 0x97, 0x3a, 0xe4, 0x34, 0x84, 0x2b, 0xea, 0x72, 0x59, 0xb0, 0x16, 0xf9, 0x37,
                   0x91, 0x15, 0xa,  0x64, 0x1a, 0x0,  0x17, 0xd7, 0xfb, 0x9f, 0xe3, 0x9a, 0x82, 0xea, 0x24, 0xe2,
                   0x6,  0xae, 0xc,  0xe0, 0x23, 0x4e, 0x19, 0xfe, 0xcd, 0x97, 0x8d, 0xc0, 0x5d, 0x73, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
}

// SubscribeResponse 24329 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS0,Right QoS2,Right QoS0,Right QoS0,Right
// QoS1,Right QoS2] [PropSessionExpiryInterval 3602,PropResponseTopic
// "/5x\ETBj\ACK0\DC3q\176\252\191\150\234\214\236\193\249\167\&5\225\&2\215\195i\132",PropCorrelationData
// "\198ww\135\192\229\234",PropReceiveMaximum 21158,PropResponseTopic
// "\255\a\ACKU\RSN\NAK5=\185,j\162",PropUserProperty "p1\CAN\188\144\DC4\146\207Q"
// "\NUL+\214\149G\195xo\177>\ACK\SYN\167\&2\220 \183\156\247\142#\196\STX\ETX{N0\220\230\243",PropTopicAlias
// 32590,PropRetainAvailable 229,PropServerKeepAlive 13344,PropSharedSubscriptionAvailable 121,PropUserProperty
// "@2K?\\\231\252\221\212S.\190\140\227\189\FSL\185\137\179\&7!\132\130\SUB\t\163\149\211"
// "\132#{\178\\\172\250\219\US\STX\ETB",PropSessionExpiryInterval 16041,PropReasonString
// "\249\165\157\CANk!\166\237\DC1\228\228O\187\STX\SYNT\170e\ETB>\167\151m\200\253r1r\GS\SOH",PropRequestProblemInformation
// 224,PropReasonString "B\244\133n{\179\DC1\129yE",PropResponseTopic
// "\177\171\SOm\243\192\vy=\182\133",PropReceiveMaximum 10480,PropAuthenticationData
// "\DC4q\131\160\239\241}^e\192m\252\187D\169\azt\239\DC1\EOT\RS",PropTopicAliasMaximum 11512,PropMessageExpiryInterval
// 6187,PropSubscriptionIdentifierAvailable 243,PropServerReference "\\\227\180",PropMessageExpiryInterval
// 6636,PropUserProperty "\241\243\139\207Fh\EM\GSo:\ESC" "\173\229{>\233\247-\SOHp",PropServerReference
// "",PropSubscriptionIdentifier 23]
TEST(SubACK5QCTest, Decode8) {
  uint8_t pkt[] = {
      0x90, 0xc2, 0x2,  0x5f, 0x9,  0xb4, 0x2,  0x11, 0x0,  0x0,  0xe,  0x12, 0x8,  0x0,  0x1a, 0x2f, 0x35, 0x78, 0x17,
      0x6a, 0x6,  0x30, 0x13, 0x71, 0xb0, 0xfc, 0xbf, 0x96, 0xea, 0xd6, 0xec, 0xc1, 0xf9, 0xa7, 0x35, 0xe1, 0x32, 0xd7,
      0xc3, 0x69, 0x84, 0x9,  0x0,  0x7,  0xc6, 0x77, 0x77, 0x87, 0xc0, 0xe5, 0xea, 0x21, 0x52, 0xa6, 0x8,  0x0,  0xd,
      0xff, 0x7,  0x6,  0x55, 0x1e, 0x4e, 0x15, 0x35, 0x3d, 0xb9, 0x2c, 0x6a, 0xa2, 0x26, 0x0,  0x9,  0x70, 0x31, 0x18,
      0xbc, 0x90, 0x14, 0x92, 0xcf, 0x51, 0x0,  0x1e, 0x0,  0x2b, 0xd6, 0x95, 0x47, 0xc3, 0x78, 0x6f, 0xb1, 0x3e, 0x6,
      0x16, 0xa7, 0x32, 0xdc, 0x20, 0xb7, 0x9c, 0xf7, 0x8e, 0x23, 0xc4, 0x2,  0x3,  0x7b, 0x4e, 0x30, 0xdc, 0xe6, 0xf3,
      0x23, 0x7f, 0x4e, 0x25, 0xe5, 0x13, 0x34, 0x20, 0x2a, 0x79, 0x26, 0x0,  0x1d, 0x40, 0x32, 0x4b, 0x3f, 0x5c, 0xe7,
      0xfc, 0xdd, 0xd4, 0x53, 0x2e, 0xbe, 0x8c, 0xe3, 0xbd, 0x1c, 0x4c, 0xb9, 0x89, 0xb3, 0x37, 0x21, 0x84, 0x82, 0x1a,
      0x9,  0xa3, 0x95, 0xd3, 0x0,  0xb,  0x84, 0x23, 0x7b, 0xb2, 0x5c, 0xac, 0xfa, 0xdb, 0x1f, 0x2,  0x17, 0x11, 0x0,
      0x0,  0x3e, 0xa9, 0x1f, 0x0,  0x1e, 0xf9, 0xa5, 0x9d, 0x18, 0x6b, 0x21, 0xa6, 0xed, 0x11, 0xe4, 0xe4, 0x4f, 0xbb,
      0x2,  0x16, 0x54, 0xaa, 0x65, 0x17, 0x3e, 0xa7, 0x97, 0x6d, 0xc8, 0xfd, 0x72, 0x31, 0x72, 0x1d, 0x1,  0x17, 0xe0,
      0x1f, 0x0,  0xa,  0x42, 0xf4, 0x85, 0x6e, 0x7b, 0xb3, 0x11, 0x81, 0x79, 0x45, 0x8,  0x0,  0xb,  0xb1, 0xab, 0xe,
      0x6d, 0xf3, 0xc0, 0xb,  0x79, 0x3d, 0xb6, 0x85, 0x21, 0x28, 0xf0, 0x16, 0x0,  0x16, 0x14, 0x71, 0x83, 0xa0, 0xef,
      0xf1, 0x7d, 0x5e, 0x65, 0xc0, 0x6d, 0xfc, 0xbb, 0x44, 0xa9, 0x7,  0x7a, 0x74, 0xef, 0x11, 0x4,  0x1e, 0x22, 0x2c,
      0xf8, 0x2,  0x0,  0x0,  0x18, 0x2b, 0x29, 0xf3, 0x1c, 0x0,  0x3,  0x5c, 0xe3, 0xb4, 0x2,  0x0,  0x0,  0x19, 0xec,
      0x26, 0x0,  0xb,  0xf1, 0xf3, 0x8b, 0xcf, 0x46, 0x68, 0x19, 0x1d, 0x6f, 0x3a, 0x1b, 0x0,  0x9,  0xad, 0xe5, 0x7b,
      0x3e, 0xe9, 0xf7, 0x2d, 0x1,  0x70, 0x1c, 0x0,  0x0,  0xb,  0x17, 0x2,  0x9e, 0xa2, 0x80, 0x0,  0x2,  0x0,  0x0,
      0x1,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24329);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 10189 [Left SubErrImplementationSpecificError,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS2,Left SubErrUnspecifiedError,Right QoS1,Left
// SubErrImplementationSpecificError,Right QoS2,Left SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Left
// SubErrWildcardSubscriptionsNotSupported] [PropAssignedClientIdentifier
// "\ETX\142\176\SI\135\229\156\165\&6TU\141\EOTR\196\ETBn&I~qx\220\SOD\ETB\183",PropSessionExpiryInterval
// 23384,PropUserProperty "\229\&7_'\206\145\128_\222C\153" ")*",PropAuthenticationData "=",PropPayloadFormatIndicator
// 144,PropMessageExpiryInterval 32480,PropCorrelationData
// "\SI\162JG\DC1\244\150\234\151\&2r\207\133\158\a\199&I\225\139\246E\v",PropMaximumQoS
// 76,PropSharedSubscriptionAvailable 193,PropReasonString "\177",PropRequestProblemInformation
// 85,PropAssignedClientIdentifier "T\179\"",PropAssignedClientIdentifier
// "AC}\ETX@\152H\238\150\154\185\ESC",PropResponseInformation "tM\128\192\157\173A",PropRetainAvailable
// 52,PropUserProperty "Z\153\222\f\RS\128t` 4\177\150\&5n\DC1\CANZx\207\DLE\\\GS\250\DC13\194\v"
// "_\245\182K\158",PropWillDelayInterval 30645,PropWildcardSubscriptionAvailable 207]
TEST(SubACK5QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0xc0, 0x1,  0x27, 0xcd, 0xb1, 0x1,  0x12, 0x0,  0x1b, 0x3,  0x8e, 0xb0, 0xf,  0x87, 0xe5, 0x9c,
                   0xa5, 0x36, 0x54, 0x55, 0x8d, 0x4,  0x52, 0xc4, 0x17, 0x6e, 0x26, 0x49, 0x7e, 0x71, 0x78, 0xdc, 0xe,
                   0x44, 0x17, 0xb7, 0x11, 0x0,  0x0,  0x5b, 0x58, 0x26, 0x0,  0xb,  0xe5, 0x37, 0x5f, 0x27, 0xce, 0x91,
                   0x80, 0x5f, 0xde, 0x43, 0x99, 0x0,  0x2,  0x29, 0x2a, 0x16, 0x0,  0x1,  0x3d, 0x1,  0x90, 0x2,  0x0,
                   0x0,  0x7e, 0xe0, 0x9,  0x0,  0x17, 0xf,  0xa2, 0x4a, 0x47, 0x11, 0xf4, 0x96, 0xea, 0x97, 0x32, 0x72,
                   0xcf, 0x85, 0x9e, 0x7,  0xc7, 0x26, 0x49, 0xe1, 0x8b, 0xf6, 0x45, 0xb,  0x24, 0x4c, 0x2a, 0xc1, 0x1f,
                   0x0,  0x1,  0xb1, 0x17, 0x55, 0x12, 0x0,  0x3,  0x54, 0xb3, 0x22, 0x12, 0x0,  0xc,  0x41, 0x43, 0x7d,
                   0x3,  0x40, 0x98, 0x48, 0xee, 0x96, 0x9a, 0xb9, 0x1b, 0x1a, 0x0,  0x7,  0x74, 0x4d, 0x80, 0xc0, 0x9d,
                   0xad, 0x41, 0x25, 0x34, 0x26, 0x0,  0x1b, 0x5a, 0x99, 0xde, 0xc,  0x1e, 0x80, 0x74, 0x60, 0x20, 0x34,
                   0xb1, 0x96, 0x35, 0x6e, 0x11, 0x18, 0x5a, 0x78, 0xcf, 0x10, 0x5c, 0x1d, 0xfa, 0x11, 0x33, 0xc2, 0xb,
                   0x0,  0x5,  0x5f, 0xf5, 0xb6, 0x4b, 0x9e, 0x18, 0x0,  0x0,  0x77, 0xb5, 0x28, 0xcf, 0x83, 0x0,  0x9e,
                   0x2,  0x80, 0x1,  0x83, 0x2,  0x83, 0x97, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10189);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x9E);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x83);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0x83);
  EXPECT_EQ(granted_qos_levels[9], 0x97);
  EXPECT_EQ(granted_qos_levels[10], 0xA2);
}

// SubscribeResponse 11213 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Right QoS0,Right
// QoS0,Right QoS0,Right QoS2,Left SubErrTopicFilterInvalid] []
TEST(SubACK5QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0xa, 0x2b, 0xcd, 0x0, 0x9e, 0x97, 0x0, 0x0, 0x0, 0x2, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11213);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], 0x97);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x8F);
}

// SubscribeResponse 16288 [Right QoS0,Right QoS1,Left SubErrUnspecifiedError,Left SubErrUnspecifiedError,Left
// SubErrNotAuthorized,Right QoS1,Right QoS1,Right QoS2,Left SubErrNotAuthorized] [PropTopicAliasMaximum
// 30519,PropAssignedClientIdentifier "\233\239U\129J\243",PropMessageExpiryInterval 32558,PropUserProperty
// "\140\191\189\162\129\153\128\203\DLEp\205" "\172\213\&7\228\140\170",PropSharedSubscriptionAvailable
// 227,PropCorrelationData
// "\159\199\&7X\\\t\169\209V\180C\206\158\198x,c\n|X\GS\214\165?%\128\199\131\131",PropSharedSubscriptionAvailable
// 133,PropRequestResponseInformation 128,PropServerReference "\230\155\144#\146\251\DELPI",PropSessionExpiryInterval
// 4721,PropContentType "\177d\239L\196",PropServerKeepAlive 26462,PropResponseTopic
// "\223\197\139",PropRequestProblemInformation 137,PropWillDelayInterval 16506,PropMessageExpiryInterval
// 3229,PropMaximumPacketSize 30608,PropServerKeepAlive 5792,PropSessionExpiryInterval 5438,PropServerReference "\201"]
TEST(SubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0x99, 0x1,  0x3f, 0xa0, 0x8c, 0x1,  0x22, 0x77, 0x37, 0x12, 0x0,  0x6,  0xe9, 0xef, 0x55,
                   0x81, 0x4a, 0xf3, 0x2,  0x0,  0x0,  0x7f, 0x2e, 0x26, 0x0,  0xb,  0x8c, 0xbf, 0xbd, 0xa2, 0x81,
                   0x99, 0x80, 0xcb, 0x10, 0x70, 0xcd, 0x0,  0x6,  0xac, 0xd5, 0x37, 0xe4, 0x8c, 0xaa, 0x2a, 0xe3,
                   0x9,  0x0,  0x1d, 0x9f, 0xc7, 0x37, 0x58, 0x5c, 0x9,  0xa9, 0xd1, 0x56, 0xb4, 0x43, 0xce, 0x9e,
                   0xc6, 0x78, 0x2c, 0x63, 0xa,  0x7c, 0x58, 0x1d, 0xd6, 0xa5, 0x3f, 0x25, 0x80, 0xc7, 0x83, 0x83,
                   0x2a, 0x85, 0x19, 0x80, 0x1c, 0x0,  0x9,  0xe6, 0x9b, 0x90, 0x23, 0x92, 0xfb, 0x7f, 0x50, 0x49,
                   0x11, 0x0,  0x0,  0x12, 0x71, 0x3,  0x0,  0x5,  0xb1, 0x64, 0xef, 0x4c, 0xc4, 0x13, 0x67, 0x5e,
                   0x8,  0x0,  0x3,  0xdf, 0xc5, 0x8b, 0x17, 0x89, 0x18, 0x0,  0x0,  0x40, 0x7a, 0x2,  0x0,  0x0,
                   0xc,  0x9d, 0x27, 0x0,  0x0,  0x77, 0x90, 0x13, 0x16, 0xa0, 0x11, 0x0,  0x0,  0x15, 0x3e, 0x1c,
                   0x0,  0x1,  0xc9, 0x0,  0x1,  0x80, 0x80, 0x87, 0x1,  0x1,  0x2,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16288);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x87);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
}

// SubscribeResponse 12823 [Left SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported] [PropCorrelationData "\181\216w _\250\170I\a",PropUserProperty
// "\174\196\238\142\&6N\212\r+\GS\b\231\192IT\198l\129\217c\163nq\185" "p\154\162\140`",PropPayloadFormatIndicator
// 64,PropMessageExpiryInterval 2937,PropMaximumQoS 140,PropContentType "\FS\227!",PropContentType
// "/~*\155\194\159]\161Z\192\184\238\SOH\244\131\188\188e\198]\165\244\130",PropRequestProblemInformation
// 85,PropRequestProblemInformation 65,PropSubscriptionIdentifier 18,PropTopicAlias 24580,PropReceiveMaximum
// 215,PropSharedSubscriptionAvailable 136,PropRetainAvailable 236,PropSessionExpiryInterval 15801,PropTopicAliasMaximum
// 8932,PropPayloadFormatIndicator 162,PropReceiveMaximum 27309,PropWillDelayInterval
// 22879,PropRequestProblemInformation 244,PropUserProperty "\186r"
// "B\242|$\ENQd\137\247B\200\&0\252\153\DC1\189\251\EOT)X",PropResponseTopic
// "\196\133\188\245\r\183",PropAuthenticationData
// "u@\182\ETX\192{\196\STX\175\135\196LR\166\209\&7E)N\138\159\204B\204\SUB",PropContentType
// "$\v\152'L\184\242",PropServerReference "\178 \186\207\147>\158u\NAKh\215\EOT\ACK\191\181",PropWillDelayInterval
// 5469,PropMessageExpiryInterval 27203]
TEST(SubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0xe8, 0x1,  0x32, 0x17, 0xe0, 0x1,  0x9,  0x0,  0x9,  0xb5, 0xd8, 0x77, 0x20, 0x5f, 0xfa, 0xaa,
                   0x49, 0x7,  0x26, 0x0,  0x18, 0xae, 0xc4, 0xee, 0x8e, 0x36, 0x4e, 0xd4, 0xd,  0x2b, 0x1d, 0x8,  0xe7,
                   0xc0, 0x49, 0x54, 0xc6, 0x6c, 0x81, 0xd9, 0x63, 0xa3, 0x6e, 0x71, 0xb9, 0x0,  0x5,  0x70, 0x9a, 0xa2,
                   0x8c, 0x60, 0x1,  0x40, 0x2,  0x0,  0x0,  0xb,  0x79, 0x24, 0x8c, 0x3,  0x0,  0x3,  0x1c, 0xe3, 0x21,
                   0x3,  0x0,  0x17, 0x2f, 0x7e, 0x2a, 0x9b, 0xc2, 0x9f, 0x5d, 0xa1, 0x5a, 0xc0, 0xb8, 0xee, 0x1,  0xf4,
                   0x83, 0xbc, 0xbc, 0x65, 0xc6, 0x5d, 0xa5, 0xf4, 0x82, 0x17, 0x55, 0x17, 0x41, 0xb,  0x12, 0x23, 0x60,
                   0x4,  0x21, 0x0,  0xd7, 0x2a, 0x88, 0x25, 0xec, 0x11, 0x0,  0x0,  0x3d, 0xb9, 0x22, 0x22, 0xe4, 0x1,
                   0xa2, 0x21, 0x6a, 0xad, 0x18, 0x0,  0x0,  0x59, 0x5f, 0x17, 0xf4, 0x26, 0x0,  0x2,  0xba, 0x72, 0x0,
                   0x13, 0x42, 0xf2, 0x7c, 0x24, 0x5,  0x64, 0x89, 0xf7, 0x42, 0xc8, 0x30, 0xfc, 0x99, 0x11, 0xbd, 0xfb,
                   0x4,  0x29, 0x58, 0x8,  0x0,  0x6,  0xc4, 0x85, 0xbc, 0xf5, 0xd,  0xb7, 0x16, 0x0,  0x19, 0x75, 0x40,
                   0xb6, 0x3,  0xc0, 0x7b, 0xc4, 0x2,  0xaf, 0x87, 0xc4, 0x4c, 0x52, 0xa6, 0xd1, 0x37, 0x45, 0x29, 0x4e,
                   0x8a, 0x9f, 0xcc, 0x42, 0xcc, 0x1a, 0x3,  0x0,  0x7,  0x24, 0xb,  0x98, 0x27, 0x4c, 0xb8, 0xf2, 0x1c,
                   0x0,  0xf,  0xb2, 0x20, 0xba, 0xcf, 0x93, 0x3e, 0x9e, 0x75, 0x15, 0x68, 0xd7, 0x4,  0x6,  0xbf, 0xb5,
                   0x18, 0x0,  0x0,  0x15, 0x5d, 0x2,  0x0,  0x0,  0x6a, 0x43, 0x8f, 0xa1, 0x0,  0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12823);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x9E);
}

// SubscribeResponse 27996 [Left SubErrSharedSubscriptionsNotSupported,Right QoS2,Right QoS2,Left
// SubErrImplementationSpecificError,Right QoS1,Right QoS2,Left SubErrUnspecifiedError,Left
// SubErrTopicFilterInvalid,Left SubErrPacketIdentifierInUse,Left SubErrSharedSubscriptionsNotSupported]
// [PropRequestProblemInformation 225,PropReceiveMaximum 12966,PropMaximumPacketSize 9315,PropSubscriptionIdentifier
// 22,PropContentType "\242\143",PropReasonString "y",PropContentType "\221\186\187\DLE!\219F",PropTopicAlias
// 31775,PropSharedSubscriptionAvailable 225,PropPayloadFormatIndicator 94,PropRequestResponseInformation 212]
TEST(SubACK5QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0x35, 0x6d, 0x5c, 0x28, 0x17, 0xe1, 0x21, 0x32, 0xa6, 0x27, 0x0,  0x0,  0x24,
                   0x63, 0xb,  0x16, 0x3,  0x0,  0x2,  0xf2, 0x8f, 0x1f, 0x0,  0x1,  0x79, 0x3,  0x0,
                   0x7,  0xdd, 0xba, 0xbb, 0x10, 0x21, 0xdb, 0x46, 0x23, 0x7c, 0x1f, 0x2a, 0xe1, 0x1,
                   0x5e, 0x19, 0xd4, 0x9e, 0x2,  0x2,  0x83, 0x1,  0x2,  0x80, 0x8f, 0x91, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27996);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x8F);
  EXPECT_EQ(granted_qos_levels[8], 0x91);
  EXPECT_EQ(granted_qos_levels[9], 0x9E);
}

// SubscribeResponse 30878 [Left SubErrUnspecifiedError,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrUnspecifiedError,Left
// SubErrTopicFilterInvalid,Right QoS0] [PropWildcardSubscriptionAvailable 185]
TEST(SubACK5QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0xd, 0x78, 0x9e, 0x2, 0x28, 0xb9, 0x80, 0x1, 0xa2, 0x80, 0xa2, 0x80, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30878);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x8F);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
}

// SubscribeResponse 7754 [Right QoS0,Right QoS2,Right QoS1,Right QoS1,Right QoS1,Right QoS2,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS0,Right QoS1,Left
// SubErrSubscriptionIdentifiersNotSupported] [PropAuthenticationMethod
// "\139\254\DC4\195\152n\197k\139\CAN\241/",PropSubscriptionIdentifier 10,PropReasonString
// "p\148(\243\SO\251\216$5\205\163\DEL\148\245\f",PropResponseInformation
// "\165\n\DC4\SYN\178\185\135\214\SO\150`\218!\t-\159\fv\248\STX,\193\159 Y"]
TEST(SubACK5QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0x4d, 0x1e, 0x4a, 0x3f, 0x15, 0x0,  0xc,  0x8b, 0xfe, 0x14, 0xc3, 0x98, 0x6e, 0xc5, 0x6b,
                   0x8b, 0x18, 0xf1, 0x2f, 0xb,  0xa,  0x1f, 0x0,  0xf,  0x70, 0x94, 0x28, 0xf3, 0xe,  0xfb, 0xd8,
                   0x24, 0x35, 0xcd, 0xa3, 0x7f, 0x94, 0xf5, 0xc,  0x1a, 0x0,  0x19, 0xa5, 0xa,  0x14, 0x16, 0xb2,
                   0xb9, 0x87, 0xd6, 0xe,  0x96, 0x60, 0xda, 0x21, 0x9,  0x2d, 0x9f, 0xc,  0x76, 0xf8, 0x2,  0x2c,
                   0xc1, 0x9f, 0x20, 0x59, 0x0,  0x2,  0x1,  0x1,  0x1,  0x2,  0x9e, 0x1,  0x0,  0x1,  0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7754);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x9E);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], 0xA1);
}

// SubscribeResponse 29991 [Left SubErrPacketIdentifierInUse,Right QoS1,Right QoS0,Left
// SubErrPacketIdentifierInUse,Right QoS1,Right QoS1,Left SubErrImplementationSpecificError,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS0] [PropTopicAliasMaximum 3368,PropWildcardSubscriptionAvailable
// 46,PropServerReference "wF\202\DEL\134\171H\239\153J\ETX\DLE\DLE/H\190un",PropReasonString
// "$\130\250\&1~1\173\158_\196\130\241\&2\141)\138h\EOT-Z\n",PropPayloadFormatIndicator 204,PropTopicAlias
// 21439,PropAssignedClientIdentifier "\227\STX\228>K\187",PropRequestProblemInformation 245,PropPayloadFormatIndicator
// 235,PropSubscriptionIdentifier 13,PropServerReference "\237\249\f\243\191\254\129\ACK\226%\232",PropTopicAliasMaximum
// 15309,PropReceiveMaximum 23314]
TEST(SubACK5QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0x66, 0x75, 0x27, 0x5a, 0x22, 0xd,  0x28, 0x28, 0x2e, 0x1c, 0x0,  0x12, 0x77, 0x46,
                   0xca, 0x7f, 0x86, 0xab, 0x48, 0xef, 0x99, 0x4a, 0x3,  0x10, 0x10, 0x2f, 0x48, 0xbe, 0x75,
                   0x6e, 0x1f, 0x0,  0x15, 0x24, 0x82, 0xfa, 0x31, 0x7e, 0x31, 0xad, 0x9e, 0x5f, 0xc4, 0x82,
                   0xf1, 0x32, 0x8d, 0x29, 0x8a, 0x68, 0x4,  0x2d, 0x5a, 0xa,  0x1,  0xcc, 0x23, 0x53, 0xbf,
                   0x12, 0x0,  0x6,  0xe3, 0x2,  0xe4, 0x3e, 0x4b, 0xbb, 0x17, 0xf5, 0x1,  0xeb, 0xb,  0xd,
                   0x1c, 0x0,  0xb,  0xed, 0xf9, 0xc,  0xf3, 0xbf, 0xfe, 0x81, 0x6,  0xe2, 0x25, 0xe8, 0x22,
                   0x3b, 0xcd, 0x21, 0x5b, 0x12, 0x91, 0x1,  0x0,  0x91, 0x1,  0x1,  0x83, 0xa1, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29991);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x91);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x83);
  EXPECT_EQ(granted_qos_levels[7], 0xA1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
}

// SubscribeResponse 6273 [Right QoS1,Right QoS0] [PropWildcardSubscriptionAvailable 63,PropAssignedClientIdentifier
// "*\165!\210&D\246\SO\ENQ\162{\ACKv\DELm\SUB\142"]
TEST(SubACK5QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x1b, 0x18, 0x81, 0x16, 0x28, 0x3f, 0x12, 0x0,  0x11, 0x2a, 0xa5, 0x21, 0xd2, 0x26,
                   0x44, 0xf6, 0xe,  0x5,  0xa2, 0x7b, 0x6,  0x76, 0x7f, 0x6d, 0x1a, 0x8e, 0x1,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6273);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
}

// SubscribeResponse 10407 [Left SubErrUnspecifiedError] [PropRequestProblemInformation
// 215,PropWildcardSubscriptionAvailable 161,PropRetainAvailable 44,PropMaximumQoS 1,PropMessageExpiryInterval
// 21069,PropAuthenticationData "~\EOTwE'\249\129\197\212\195\201\167&\208\240",PropMaximumQoS
// 34,PropSubscriptionIdentifier 17,PropAssignedClientIdentifier "\154\193\171B\f\171G",PropAuthenticationData
// "",PropResponseTopic
// "C\DC2\141\138W\234\235\136\177h\226\255\134\137b\148'ig\SOHZc]X\244\199\176+",PropWillDelayInterval
// 26669,PropReceiveMaximum 7925,PropAssignedClientIdentifier
// "0\147\&6\EM\231p\235\254Rk+\131\141",PropMaximumPacketSize 3698,PropAssignedClientIdentifier
// "\ACKJ\SOH\254Mb\131\138\192B\140\156\191\239\217\245;7\139\&1/u\215\139\&1\222\186\183",PropResponseInformation
// "\250e\DC1E\212\204?7y\236n0C\r",PropMaximumPacketSize 6648,PropReceiveMaximum
// 24409,PropSubscriptionIdentifierAvailable 230,PropWillDelayInterval 7378,PropServerKeepAlive
// 31324,PropSubscriptionIdentifier 6,PropSharedSubscriptionAvailable 10,PropAuthenticationData
// "\167\179MJ\ETX\174\185\166;\175\157nX\146",PropMessageExpiryInterval 8462,PropCorrelationData
// "\198f%h\140\253\213g#\163\251X\DC4\194\&4N\247\129\168\148\143\248Xc\138\215",PropUserProperty
// "\140\194m$C\226\235\183Gt\176\210\135\169H\133\144\213\156Z" "\176p9\ETB2y\251o<\145%\173\ENQ\244AX\r\204\167\238"]
TEST(SubACK5QCTest, Decode18) {
  uint8_t pkt[] = {
      0x90, 0x97, 0x2,  0x28, 0xa7, 0x92, 0x2,  0x17, 0xd7, 0x28, 0xa1, 0x25, 0x2c, 0x24, 0x1,  0x2,  0x0,  0x0,  0x52,
      0x4d, 0x16, 0x0,  0xf,  0x7e, 0x4,  0x77, 0x45, 0x27, 0xf9, 0x81, 0xc5, 0xd4, 0xc3, 0xc9, 0xa7, 0x26, 0xd0, 0xf0,
      0x24, 0x22, 0xb,  0x11, 0x12, 0x0,  0x7,  0x9a, 0xc1, 0xab, 0x42, 0xc,  0xab, 0x47, 0x16, 0x0,  0x0,  0x8,  0x0,
      0x1c, 0x43, 0x12, 0x8d, 0x8a, 0x57, 0xea, 0xeb, 0x88, 0xb1, 0x68, 0xe2, 0xff, 0x86, 0x89, 0x62, 0x94, 0x27, 0x69,
      0x67, 0x1,  0x5a, 0x63, 0x5d, 0x58, 0xf4, 0xc7, 0xb0, 0x2b, 0x18, 0x0,  0x0,  0x68, 0x2d, 0x21, 0x1e, 0xf5, 0x12,
      0x0,  0xd,  0x30, 0x93, 0x36, 0x19, 0xe7, 0x70, 0xeb, 0xfe, 0x52, 0x6b, 0x2b, 0x83, 0x8d, 0x27, 0x0,  0x0,  0xe,
      0x72, 0x12, 0x0,  0x1c, 0x6,  0x4a, 0x1,  0xfe, 0x4d, 0x62, 0x83, 0x8a, 0xc0, 0x42, 0x8c, 0x9c, 0xbf, 0xef, 0xd9,
      0xf5, 0x3b, 0x37, 0x8b, 0x31, 0x2f, 0x75, 0xd7, 0x8b, 0x31, 0xde, 0xba, 0xb7, 0x1a, 0x0,  0xe,  0xfa, 0x65, 0x11,
      0x45, 0xd4, 0xcc, 0x3f, 0x37, 0x79, 0xec, 0x6e, 0x30, 0x43, 0xd,  0x27, 0x0,  0x0,  0x19, 0xf8, 0x21, 0x5f, 0x59,
      0x29, 0xe6, 0x18, 0x0,  0x0,  0x1c, 0xd2, 0x13, 0x7a, 0x5c, 0xb,  0x6,  0x2a, 0xa,  0x16, 0x0,  0xe,  0xa7, 0xb3,
      0x4d, 0x4a, 0x3,  0xae, 0xb9, 0xa6, 0x3b, 0xaf, 0x9d, 0x6e, 0x58, 0x92, 0x2,  0x0,  0x0,  0x21, 0xe,  0x9,  0x0,
      0x1a, 0xc6, 0x66, 0x25, 0x68, 0x8c, 0xfd, 0xd5, 0x67, 0x23, 0xa3, 0xfb, 0x58, 0x14, 0xc2, 0x34, 0x4e, 0xf7, 0x81,
      0xa8, 0x94, 0x8f, 0xf8, 0x58, 0x63, 0x8a, 0xd7, 0x26, 0x0,  0x14, 0x8c, 0xc2, 0x6d, 0x24, 0x43, 0xe2, 0xeb, 0xb7,
      0x47, 0x74, 0xb0, 0xd2, 0x87, 0xa9, 0x48, 0x85, 0x90, 0xd5, 0x9c, 0x5a, 0x0,  0x14, 0xb0, 0x70, 0x39, 0x17, 0x32,
      0x79, 0xfb, 0x6f, 0x3c, 0x91, 0x25, 0xad, 0x5,  0xf4, 0x41, 0x58, 0xd,  0xcc, 0xa7, 0xee, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10407);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
}

// SubscribeResponse 13436 [Left SubErrPacketIdentifierInUse,Left SubErrImplementationSpecificError,Left
// SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Left SubErrNotAuthorized,Right QoS0,Right QoS1,Left
// SubErrQuotaExceeded,Right QoS0,Right QoS0] [PropServerKeepAlive 21556,PropReceiveMaximum 13390,PropUserProperty
// "P\129" "\198\207\160",PropTopicAliasMaximum 22735,PropTopicAliasMaximum 13713,PropCorrelationData
// "\219\137\CAN\153\223\\\198\164\161\190,\255e\253\219\211",PropSessionExpiryInterval 27448,PropMaximumPacketSize
// 13892,PropReasonString "\149\204[\147\151\198\145\131\EM~\250\&3\174\161\136\254\148n",PropReceiveMaximum
// 27195,PropTopicAlias 857,PropAuthenticationMethod
// "\ESC\233\211\237\133\246\177\198\212\136\213\160\154\143\202\143z\ETB\ESCW",PropSubscriptionIdentifier
// 20,PropSubscriptionIdentifierAvailable 95]
TEST(SubACK5QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0x76, 0x34, 0x7c, 0x69, 0x13, 0x54, 0x34, 0x21, 0x34, 0x4e, 0x26, 0x0,  0x2,  0x50,
                   0x81, 0x0,  0x3,  0xc6, 0xcf, 0xa0, 0x22, 0x58, 0xcf, 0x22, 0x35, 0x91, 0x9,  0x0,  0x10,
                   0xdb, 0x89, 0x18, 0x99, 0xdf, 0x5c, 0xc6, 0xa4, 0xa1, 0xbe, 0x2c, 0xff, 0x65, 0xfd, 0xdb,
                   0xd3, 0x11, 0x0,  0x0,  0x6b, 0x38, 0x27, 0x0,  0x0,  0x36, 0x44, 0x1f, 0x0,  0x12, 0x95,
                   0xcc, 0x5b, 0x93, 0x97, 0xc6, 0x91, 0x83, 0x19, 0x7e, 0xfa, 0x33, 0xae, 0xa1, 0x88, 0xfe,
                   0x94, 0x6e, 0x21, 0x6a, 0x3b, 0x23, 0x3,  0x59, 0x15, 0x0,  0x14, 0x1b, 0xe9, 0xd3, 0xed,
                   0x85, 0xf6, 0xb1, 0xc6, 0xd4, 0x88, 0xd5, 0xa0, 0x9a, 0x8f, 0xca, 0x8f, 0x7a, 0x17, 0x1b,
                   0x57, 0xb,  0x14, 0x29, 0x5f, 0x91, 0x83, 0x83, 0x97, 0x87, 0x0,  0x1,  0x97, 0x0,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13436);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], 0x97);
  EXPECT_EQ(granted_qos_levels[4], 0x87);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], 0x97);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 634 [Right QoS2,Left SubErrPacketIdentifierInUse,Right QoS1,Left
// SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Right QoS0,Left SubErrWildcardSubscriptionsNotSupported]
// [PropUserProperty "\239\&6\vvf\231\184Wm!\159" "\138\241\203Z\171*\189~\151^\tw&@",PropRetainAvailable
// 131,PropSubscriptionIdentifierAvailable 177,PropReceiveMaximum 32035,PropContentType
// "\185\176z#\225\150h6\171\145^",PropMaximumPacketSize 18026,PropPayloadFormatIndicator 233,PropAuthenticationData
// "\ETB\243\GS\DC3",PropServerReference
// "\161\183\130\246\207,\129\254\244\242\141Lr\161\DC1\192\&2",PropTopicAliasMaximum 23013,PropMaximumPacketSize
// 10661,PropServerKeepAlive 13847,PropSharedSubscriptionAvailable 98,PropWillDelayInterval 31057]
TEST(SubACK5QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0x71, 0x2,  0x7a, 0x67, 0x26, 0x0,  0xb,  0xef, 0x36, 0xb,  0x76, 0x66, 0xe7, 0xb8, 0x57, 0x6d,
                   0x21, 0x9f, 0x0,  0xe,  0x8a, 0xf1, 0xcb, 0x5a, 0xab, 0x2a, 0xbd, 0x7e, 0x97, 0x5e, 0x9,  0x77, 0x26,
                   0x40, 0x25, 0x83, 0x29, 0xb1, 0x21, 0x7d, 0x23, 0x3,  0x0,  0xb,  0xb9, 0xb0, 0x7a, 0x23, 0xe1, 0x96,
                   0x68, 0x36, 0xab, 0x91, 0x5e, 0x27, 0x0,  0x0,  0x46, 0x6a, 0x1,  0xe9, 0x16, 0x0,  0x4,  0x17, 0xf3,
                   0x1d, 0x13, 0x1c, 0x0,  0x11, 0xa1, 0xb7, 0x82, 0xf6, 0xcf, 0x2c, 0x81, 0xfe, 0xf4, 0xf2, 0x8d, 0x4c,
                   0x72, 0xa1, 0x11, 0xc0, 0x32, 0x22, 0x59, 0xe5, 0x27, 0x0,  0x0,  0x29, 0xa5, 0x13, 0x36, 0x17, 0x2a,
                   0x62, 0x18, 0x0,  0x0,  0x79, 0x51, 0x2,  0x91, 0x1,  0x83, 0x97, 0x0,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 634);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
}

// SubscribeResponse 742 [Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrImplementationSpecificError,Left SubErrQuotaExceeded,Right QoS1,Left SubErrTopicFilterInvalid]
// [PropReceiveMaximum 9630,PropMessageExpiryInterval 1477,PropAuthenticationMethod
// "\SYNe\DC2\234\203\229\STX\ENQ\240\167\NAK\146\130*\ESC$\SYN\236\148\195\137\179\183|\182\173\134",PropContentType
// "\242\253",PropMessageExpiryInterval 13288,PropWillDelayInterval 13555,PropReasonString
// "\213E\175+TG\142$t\EOT:aO\SO\228Iq\180\221\200'Z\244q]f",PropSubscriptionIdentifier 21,PropSessionExpiryInterval
// 2187,PropReasonString "\CAN-\219\198\DC4\128L=zQ\242\244",PropCorrelationData
// "\SO|\250M\EM\DC3\207e\213;\153\202",PropSubscriptionIdentifierAvailable 108]
TEST(SubACK5QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x85, 0x1,  0x2,  0xe6, 0x79, 0x21, 0x25, 0x9e, 0x2,  0x0,  0x0,  0x5,  0xc5, 0x15, 0x0,
                   0x1b, 0x16, 0x65, 0x12, 0xea, 0xcb, 0xe5, 0x2,  0x5,  0xf0, 0xa7, 0x15, 0x92, 0x82, 0x2a, 0x1b,
                   0x24, 0x16, 0xec, 0x94, 0xc3, 0x89, 0xb3, 0xb7, 0x7c, 0xb6, 0xad, 0x86, 0x3,  0x0,  0x2,  0xf2,
                   0xfd, 0x2,  0x0,  0x0,  0x33, 0xe8, 0x18, 0x0,  0x0,  0x34, 0xf3, 0x1f, 0x0,  0x1a, 0xd5, 0x45,
                   0xaf, 0x2b, 0x54, 0x47, 0x8e, 0x24, 0x74, 0x4,  0x3a, 0x61, 0x4f, 0xe,  0xe4, 0x49, 0x71, 0xb4,
                   0xdd, 0xc8, 0x27, 0x5a, 0xf4, 0x71, 0x5d, 0x66, 0xb,  0x15, 0x11, 0x0,  0x0,  0x8,  0x8b, 0x1f,
                   0x0,  0xc,  0x18, 0x2d, 0xdb, 0xc6, 0x14, 0x80, 0x4c, 0x3d, 0x7a, 0x51, 0xf2, 0xf4, 0x9,  0x0,
                   0xc,  0xe,  0x7c, 0xfa, 0x4d, 0x19, 0x13, 0xcf, 0x65, 0xd5, 0x3b, 0x99, 0xca, 0x29, 0x6c, 0x0,
                   0xa1, 0x91, 0x2,  0x9e, 0x83, 0x97, 0x1,  0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 742);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
  EXPECT_EQ(granted_qos_levels[2], 0x91);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x9E);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], 0x97);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x8F);
}

// SubscribeResponse 14677 [Left SubErrTopicFilterInvalid,Right QoS0,Left SubErrTopicFilterInvalid]
// [PropAuthenticationData "",PropMaximumQoS 183,PropWildcardSubscriptionAvailable 152,PropTopicAlias
// 10631,PropRequestResponseInformation 108,PropServerKeepAlive 7360,PropMessageExpiryInterval
// 29434,PropSubscriptionIdentifierAvailable 168,PropMaximumPacketSize 23853,PropMaximumQoS 108,PropReceiveMaximum
// 11783]
TEST(SubACK5QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0x26, 0x39, 0x55, 0x20, 0x16, 0x0,  0x0,  0x24, 0xb7, 0x28, 0x98, 0x23, 0x29,
                   0x87, 0x19, 0x6c, 0x13, 0x1c, 0xc0, 0x2,  0x0,  0x0,  0x72, 0xfa, 0x29, 0xa8, 0x27,
                   0x0,  0x0,  0x5d, 0x2d, 0x24, 0x6c, 0x21, 0x2e, 0x7,  0x8f, 0x0,  0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14677);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
}

// SubscribeResponse 22954 [Right QoS1,Left SubErrTopicFilterInvalid,Left SubErrQuotaExceeded,Right QoS0,Left
// SubErrUnspecifiedError] [PropRequestProblemInformation 173,PropContentType
// "\NAK\139j\215\189\191\162Iq\237\240q}\143\176\131\232\228\176#",PropTopicAliasMaximum
// 15589,PropSubscriptionIdentifierAvailable 54,PropServerKeepAlive 18613,PropSessionExpiryInterval
// 19845,PropSessionExpiryInterval 20838,PropReasonString
// "\168\164\252\190\143\164\141\198\NUL\176\138\235\CAN\187K\193*\US\147\SUB\254+\202y\150}\212{",PropContentType
// "",PropPayloadFormatIndicator 225,PropMaximumPacketSize 12913,PropTopicAliasMaximum 20068,PropCorrelationData
// "@\181I0\140\182\FS"]
TEST(SubACK5QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x69, 0x59, 0xaa, 0x61, 0x17, 0xad, 0x3,  0x0,  0x14, 0x15, 0x8b, 0x6a, 0xd7, 0xbd, 0xbf,
                   0xa2, 0x49, 0x71, 0xed, 0xf0, 0x71, 0x7d, 0x8f, 0xb0, 0x83, 0xe8, 0xe4, 0xb0, 0x23, 0x22, 0x3c,
                   0xe5, 0x29, 0x36, 0x13, 0x48, 0xb5, 0x11, 0x0,  0x0,  0x4d, 0x85, 0x11, 0x0,  0x0,  0x51, 0x66,
                   0x1f, 0x0,  0x1c, 0xa8, 0xa4, 0xfc, 0xbe, 0x8f, 0xa4, 0x8d, 0xc6, 0x0,  0xb0, 0x8a, 0xeb, 0x18,
                   0xbb, 0x4b, 0xc1, 0x2a, 0x1f, 0x93, 0x1a, 0xfe, 0x2b, 0xca, 0x79, 0x96, 0x7d, 0xd4, 0x7b, 0x3,
                   0x0,  0x0,  0x1,  0xe1, 0x27, 0x0,  0x0,  0x32, 0x71, 0x22, 0x4e, 0x64, 0x9,  0x0,  0x7,  0x40,
                   0xb5, 0x49, 0x30, 0x8c, 0xb6, 0x1c, 0x1,  0x8f, 0x97, 0x0,  0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22954);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x8F);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 18733 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS2,Right QoS1,Right QoS1] [PropPayloadFormatIndicator
// 98,PropSharedSubscriptionAvailable 87,PropRequestResponseInformation 52,PropCorrelationData
// "\134>?J\255\142\&8PT\238<\NUL\198.\165\206\229\a\216\211\239-X\218jL\249"]
TEST(SubACK5QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x2d, 0x49, 0x2d, 0x24, 0x1,  0x62, 0x2a, 0x57, 0x19, 0x34, 0x9,  0x0,  0x1b, 0x86, 0x3e,
                   0x3f, 0x4a, 0xff, 0x8e, 0x38, 0x50, 0x54, 0xee, 0x3c, 0x0,  0xc6, 0x2e, 0xa5, 0xce, 0xe5, 0x7,
                   0xd8, 0xd3, 0xef, 0x2d, 0x58, 0xda, 0x6a, 0x4c, 0xf9, 0x2,  0xa2, 0x91, 0x2,  0x1,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18733);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], 0x91);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 22455 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Left
// SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrQuotaExceeded,Right QoS0,Left
// SubErrTopicFilterInvalid,Right QoS1,Right QoS1] [PropMaximumQoS 125,PropCorrelationData
// "\US\144ST\228\202\ETX\225\EOT\163-\199\201 \191\180\235sf\n\186\158",PropReasonString
// "\NUL\FS\235\&6k\143v\171\SO\166\189\190x\254\162\243\182\255\157\222*d\219\178\187D",PropUserProperty
// "\231\144\n,\152\201\147\232\FSX\141B\158WY\182\166\242\244\ACK\230\165\233<)\165"
// "h\r9f\203\&8\202\146\DC4x\SI0\188\176\168\157\FSGj\157{FV\239\182Y",PropAuthenticationMethod
// "\231\&7\204\DELr\210\NUL\t7\162\245\&6H\136q\190\201\139v",PropTopicAliasMaximum
// 24385,PropSubscriptionIdentifierAvailable 37,PropAssignedClientIdentifier
// "q\149\212\165\220\240\146\&4b\167\164\244\180\165\254\191l\183\199@R",PropMessageExpiryInterval
// 23,PropSessionExpiryInterval 16436,PropAuthenticationMethod "",PropReceiveMaximum 8596,PropSessionExpiryInterval
// 14740,PropCorrelationData "\196A\NUL5\213\197J<@\180\STX\134W",PropAuthenticationData
// "\EOT\217`\180x\206\206!\187\204\172\236\&2B\189\235\167jap\161\196\&3wxl\131",PropPayloadFormatIndicator
// 140,PropContentType "\144\224\155\219\&5C\178\EM>\ESC./I\GS\242yx}\146\227=v\250DM\157",PropRequestProblemInformation
// 132,PropResponseTopic "b\RS\208r(#\a'\EOT\CAN\236h\187\213\tc\189`\243p\184q_\157\&4",PropReceiveMaximum
// 27370,PropMaximumPacketSize 23288,PropSubscriptionIdentifier 29,PropReasonString
// "[\169\145/\185f$\ESC\222\179'\226\134\ACK\129\218=A\DLE",PropServerReference
// "\187\US\179]\140\&4f\238",PropResponseInformation "\213\ENQ
// N\ACK\198v\STX6\231-\161\&0\132v\128\249",PropTopicAliasMaximum 27985,PropSharedSubscriptionAvailable
// 107,PropSubscriptionIdentifierAvailable 62]
TEST(SubACK5QCTest, Decode25) {
  uint8_t pkt[] = {
      0x90, 0xf7, 0x2,  0x57, 0xb7, 0xea, 0x2,  0x24, 0x7d, 0x9,  0x0,  0x16, 0x1f, 0x90, 0x53, 0x54, 0xe4, 0xca, 0x3,
      0xe1, 0x4,  0xa3, 0x2d, 0xc7, 0xc9, 0x20, 0xbf, 0xb4, 0xeb, 0x73, 0x66, 0xa,  0xba, 0x9e, 0x1f, 0x0,  0x1a, 0x0,
      0x1c, 0xeb, 0x36, 0x6b, 0x8f, 0x76, 0xab, 0xe,  0xa6, 0xbd, 0xbe, 0x78, 0xfe, 0xa2, 0xf3, 0xb6, 0xff, 0x9d, 0xde,
      0x2a, 0x64, 0xdb, 0xb2, 0xbb, 0x44, 0x26, 0x0,  0x1a, 0xe7, 0x90, 0xa,  0x2c, 0x98, 0xc9, 0x93, 0xe8, 0x1c, 0x58,
      0x8d, 0x42, 0x9e, 0x57, 0x59, 0xb6, 0xa6, 0xf2, 0xf4, 0x6,  0xe6, 0xa5, 0xe9, 0x3c, 0x29, 0xa5, 0x0,  0x1a, 0x68,
      0xd,  0x39, 0x66, 0xcb, 0x38, 0xca, 0x92, 0x14, 0x78, 0xf,  0x30, 0xbc, 0xb0, 0xa8, 0x9d, 0x1c, 0x47, 0x6a, 0x9d,
      0x7b, 0x46, 0x56, 0xef, 0xb6, 0x59, 0x15, 0x0,  0x13, 0xe7, 0x37, 0xcc, 0x7f, 0x72, 0xd2, 0x0,  0x9,  0x37, 0xa2,
      0xf5, 0x36, 0x48, 0x88, 0x71, 0xbe, 0xc9, 0x8b, 0x76, 0x22, 0x5f, 0x41, 0x29, 0x25, 0x12, 0x0,  0x15, 0x71, 0x95,
      0xd4, 0xa5, 0xdc, 0xf0, 0x92, 0x34, 0x62, 0xa7, 0xa4, 0xf4, 0xb4, 0xa5, 0xfe, 0xbf, 0x6c, 0xb7, 0xc7, 0x40, 0x52,
      0x2,  0x0,  0x0,  0x0,  0x17, 0x11, 0x0,  0x0,  0x40, 0x34, 0x15, 0x0,  0x0,  0x21, 0x21, 0x94, 0x11, 0x0,  0x0,
      0x39, 0x94, 0x9,  0x0,  0xd,  0xc4, 0x41, 0x0,  0x35, 0xd5, 0xc5, 0x4a, 0x3c, 0x40, 0xb4, 0x2,  0x86, 0x57, 0x16,
      0x0,  0x1b, 0x4,  0xd9, 0x60, 0xb4, 0x78, 0xce, 0xce, 0x21, 0xbb, 0xcc, 0xac, 0xec, 0x32, 0x42, 0xbd, 0xeb, 0xa7,
      0x6a, 0x61, 0x70, 0xa1, 0xc4, 0x33, 0x77, 0x78, 0x6c, 0x83, 0x1,  0x8c, 0x3,  0x0,  0x1a, 0x90, 0xe0, 0x9b, 0xdb,
      0x35, 0x43, 0xb2, 0x19, 0x3e, 0x1b, 0x2e, 0x2f, 0x49, 0x1d, 0xf2, 0x79, 0x78, 0x7d, 0x92, 0xe3, 0x3d, 0x76, 0xfa,
      0x44, 0x4d, 0x9d, 0x17, 0x84, 0x8,  0x0,  0x19, 0x62, 0x1e, 0xd0, 0x72, 0x28, 0x23, 0x7,  0x27, 0x4,  0x18, 0xec,
      0x68, 0xbb, 0xd5, 0x9,  0x63, 0xbd, 0x60, 0xf3, 0x70, 0xb8, 0x71, 0x5f, 0x9d, 0x34, 0x21, 0x6a, 0xea, 0x27, 0x0,
      0x0,  0x5a, 0xf8, 0xb,  0x1d, 0x1f, 0x0,  0x13, 0x5b, 0xa9, 0x91, 0x2f, 0xb9, 0x66, 0x24, 0x1b, 0xde, 0xb3, 0x27,
      0xe2, 0x86, 0x6,  0x81, 0xda, 0x3d, 0x41, 0x10, 0x1c, 0x0,  0x8,  0xbb, 0x1f, 0xb3, 0x5d, 0x8c, 0x34, 0x66, 0xee,
      0x1a, 0x0,  0x11, 0xd5, 0x5,  0x20, 0x4e, 0x6,  0xc6, 0x76, 0x2,  0x36, 0xe7, 0x2d, 0xa1, 0x30, 0x84, 0x76, 0x80,
      0xf9, 0x22, 0x6d, 0x51, 0x2a, 0x6b, 0x29, 0x3e, 0x9e, 0x97, 0x8f, 0xa1, 0x97, 0x0,  0x8f, 0x1,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22455);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], 0x97);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
  EXPECT_EQ(granted_qos_levels[3], 0xA1);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x8F);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 556 [Right QoS1,Left SubErrImplementationSpecificError,Right QoS1] [PropCorrelationData
// "\r\176\163\148\188\204\158}\243\207\214Z\b\a\208\157",PropRequestProblemInformation
// 75,PropSubscriptionIdentifierAvailable 129,PropAssignedClientIdentifier
// "\EOTx=`\208\142\153\149\224\224\161)@\166\SYN\EOT\224\162*\129*.;~\254\&1\193\252p8",PropMaximumQoS
// 38,PropAuthenticationMethod "Hb)\a{V[\252j\206^\222\&3\221V\192G\255o",PropRequestProblemInformation
// 31,PropWillDelayInterval 5553,PropMessageExpiryInterval 2889,PropWillDelayInterval 21169,PropAssignedClientIdentifier
// "\176m\159`Q\ETBF\196\DC4+\vv",PropResponseInformation
// "Tp7\179\236\EM\179kwZ\212g\143$\128\208\150*(\208q\255*\236\128\EM;",PropReasonString
// "\135\189\172\247\130\153\174\240\246\207\161,\201",PropMaximumQoS 212,PropRequestResponseInformation
// 227,PropCorrelationData "^\\k#\DC3\159\240\ENQ\208{\167[ml\253\173\b\163\134\157\185",PropWillDelayInterval
// 20829,PropServerKeepAlive 21836,PropReceiveMaximum 9146,PropWillDelayInterval 6516,PropResponseInformation
// "\227\203\253\152\aj"]
TEST(SubACK5QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0xda, 0x1,  0x2,  0x2c, 0xd3, 0x1,  0x9,  0x0,  0x10, 0xd,  0xb0, 0xa3, 0x94, 0xbc, 0xcc, 0x9e,
                   0x7d, 0xf3, 0xcf, 0xd6, 0x5a, 0x8,  0x7,  0xd0, 0x9d, 0x17, 0x4b, 0x29, 0x81, 0x12, 0x0,  0x1e, 0x4,
                   0x78, 0x3d, 0x60, 0xd0, 0x8e, 0x99, 0x95, 0xe0, 0xe0, 0xa1, 0x29, 0x40, 0xa6, 0x16, 0x4,  0xe0, 0xa2,
                   0x2a, 0x81, 0x2a, 0x2e, 0x3b, 0x7e, 0xfe, 0x31, 0xc1, 0xfc, 0x70, 0x38, 0x24, 0x26, 0x15, 0x0,  0x13,
                   0x48, 0x62, 0x29, 0x7,  0x7b, 0x56, 0x5b, 0xfc, 0x6a, 0xce, 0x5e, 0xde, 0x33, 0xdd, 0x56, 0xc0, 0x47,
                   0xff, 0x6f, 0x17, 0x1f, 0x18, 0x0,  0x0,  0x15, 0xb1, 0x2,  0x0,  0x0,  0xb,  0x49, 0x18, 0x0,  0x0,
                   0x52, 0xb1, 0x12, 0x0,  0xc,  0xb0, 0x6d, 0x9f, 0x60, 0x51, 0x17, 0x46, 0xc4, 0x14, 0x2b, 0xb,  0x76,
                   0x1a, 0x0,  0x1b, 0x54, 0x70, 0x37, 0xb3, 0xec, 0x19, 0xb3, 0x6b, 0x77, 0x5a, 0xd4, 0x67, 0x8f, 0x24,
                   0x80, 0xd0, 0x96, 0x2a, 0x28, 0xd0, 0x71, 0xff, 0x2a, 0xec, 0x80, 0x19, 0x3b, 0x1f, 0x0,  0xd,  0x87,
                   0xbd, 0xac, 0xf7, 0x82, 0x99, 0xae, 0xf0, 0xf6, 0xcf, 0xa1, 0x2c, 0xc9, 0x24, 0xd4, 0x19, 0xe3, 0x9,
                   0x0,  0x15, 0x5e, 0x5c, 0x6b, 0x23, 0x13, 0x9f, 0xf0, 0x5,  0xd0, 0x7b, 0xa7, 0x5b, 0x6d, 0x6c, 0xfd,
                   0xad, 0x8,  0xa3, 0x86, 0x9d, 0xb9, 0x18, 0x0,  0x0,  0x51, 0x5d, 0x13, 0x55, 0x4c, 0x21, 0x23, 0xba,
                   0x18, 0x0,  0x0,  0x19, 0x74, 0x1a, 0x0,  0x6,  0xe3, 0xcb, 0xfd, 0x98, 0x7,  0x6a, 0x1,  0x83, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 556);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
}

// SubscribeResponse 15417 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Left SubErrNotAuthorized]
// [PropMessageExpiryInterval 3342,PropAuthenticationMethod
// "\197\130\195\190\223w\173\235\225\ESC\GS\DC4\210\137m\159\ETBo\250",PropAuthenticationData
// "\179\131\211\146n]\SO\rus3\229\v'\158T\134\128\254\186\&1\DELe\217*\171\156-D",PropPayloadFormatIndicator
// 54,PropReasonString
// "\f\141\249u|R\191`S\153\251\&6+C\160\DC1\240>\241'\238\236\f\EM,\237",PropRequestProblemInformation
// 62,PropSharedSubscriptionAvailable 29,PropWildcardSubscriptionAvailable 131,PropRequestResponseInformation
// 224,PropTopicAlias 32256,PropRequestProblemInformation 194,PropSharedSubscriptionAvailable 79,PropRetainAvailable
// 34,PropRetainAvailable 19,PropSharedSubscriptionAvailable 92,PropContentType
// "\150\160\236\SYNp}\f",PropSubscriptionIdentifierAvailable 213,PropServerKeepAlive 8068]
TEST(SubACK5QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x85, 0x1,  0x3c, 0x39, 0x7e, 0x2,  0x0,  0x0,  0xd,  0xe,  0x15, 0x0,  0x13, 0xc5, 0x82,
                   0xc3, 0xbe, 0xdf, 0x77, 0xad, 0xeb, 0xe1, 0x1b, 0x1d, 0x14, 0xd2, 0x89, 0x6d, 0x9f, 0x17, 0x6f,
                   0xfa, 0x16, 0x0,  0x1d, 0xb3, 0x83, 0xd3, 0x92, 0x6e, 0x5d, 0xe,  0xd,  0x75, 0x73, 0x33, 0xe5,
                   0xb,  0x27, 0x9e, 0x54, 0x86, 0x80, 0xfe, 0xba, 0x31, 0x7f, 0x65, 0xd9, 0x2a, 0xab, 0x9c, 0x2d,
                   0x44, 0x1,  0x36, 0x1f, 0x0,  0x1a, 0xc,  0x8d, 0xf9, 0x75, 0x7c, 0x52, 0xbf, 0x60, 0x53, 0x99,
                   0xfb, 0x36, 0x2b, 0x43, 0xa0, 0x11, 0xf0, 0x3e, 0xf1, 0x27, 0xee, 0xec, 0xc,  0x19, 0x2c, 0xed,
                   0x17, 0x3e, 0x2a, 0x1d, 0x28, 0x83, 0x19, 0xe0, 0x23, 0x7e, 0x0,  0x17, 0xc2, 0x2a, 0x4f, 0x25,
                   0x22, 0x25, 0x13, 0x2a, 0x5c, 0x3,  0x0,  0x7,  0x96, 0xa0, 0xec, 0x16, 0x70, 0x7d, 0xc,  0x29,
                   0xd5, 0x13, 0x1f, 0x84, 0x2,  0xa2, 0x0,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15417);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
}

// SubscribeResponse 26950 [Left SubErrImplementationSpecificError,Right QoS2,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS1] [PropSubscriptionIdentifierAvailable
// 90,PropAssignedClientIdentifier "\245\DC3x\171w\SOx\129\DC3\a\249\239\252\188Y<\149>",PropReasonString
// "\194\253\ENQE\169\153\t8A?1S\200\249",PropServerReference "\211'\b\129:\147a\191",PropAuthenticationData
// "\162",PropMaximumPacketSize 9056,PropSubscriptionIdentifierAvailable 35,PropSessionExpiryInterval
// 8594,PropAuthenticationMethod "\238\150\215\189\233\132\SO\192\167^\SYN",PropCorrelationData "\155Si;8'7
// nh\232\209+Q6\FS",PropSharedSubscriptionAvailable 107,PropSessionExpiryInterval 16867,PropResponseInformation
// "\185\ESCf"]
TEST(SubACK5QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x79, 0x69, 0x46, 0x71, 0x29, 0x5a, 0x12, 0x0,  0x12, 0xf5, 0x13, 0x78, 0xab, 0x77, 0xe,
                   0x78, 0x81, 0x13, 0x7,  0xf9, 0xef, 0xfc, 0xbc, 0x59, 0x3c, 0x95, 0x3e, 0x1f, 0x0,  0xe,  0xc2,
                   0xfd, 0x5,  0x45, 0xa9, 0x99, 0x9,  0x38, 0x41, 0x3f, 0x31, 0x53, 0xc8, 0xf9, 0x1c, 0x0,  0x8,
                   0xd3, 0x27, 0x8,  0x81, 0x3a, 0x93, 0x61, 0xbf, 0x16, 0x0,  0x1,  0xa2, 0x27, 0x0,  0x0,  0x23,
                   0x60, 0x29, 0x23, 0x11, 0x0,  0x0,  0x21, 0x92, 0x15, 0x0,  0xb,  0xee, 0x96, 0xd7, 0xbd, 0xe9,
                   0x84, 0xe,  0xc0, 0xa7, 0x5e, 0x16, 0x9,  0x0,  0x10, 0x9b, 0x53, 0x69, 0x3b, 0x38, 0x27, 0x37,
                   0x20, 0x6e, 0x68, 0xe8, 0xd1, 0x2b, 0x51, 0x36, 0x1c, 0x2a, 0x6b, 0x11, 0x0,  0x0,  0x41, 0xe3,
                   0x1a, 0x0,  0x3,  0xb9, 0x1b, 0x66, 0x83, 0x2,  0x2,  0xa1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26950);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0xA1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
}

// SubscribeResponse 24196 [Left SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError,Right QoS0,Right QoS0,Left SubErrTopicFilterInvalid,Left
// SubErrPacketIdentifierInUse,Right QoS2] [PropSessionExpiryInterval 3870,PropSubscriptionIdentifierAvailable
// 240,PropAuthenticationMethod
// "\177\&3\SOH\212\US\176\160\237z\230\255\173\236[}u\135\240\137\187\159\140\191]",PropSubscriptionIdentifier
// 29,PropMaximumQoS 47,PropReasonString "\233*\a\152l~OR\188\184o\139",PropServerKeepAlive 12968,PropTopicAliasMaximum
// 5292,PropResponseInformation "1A\219XL\n\212\n\220\137\213",PropResponseTopic
// "\DC3\164q\212X\ACK\201D\164\128\&9\182\&8D6&",PropMaximumPacketSize 2747]
TEST(SubACK5QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0x6d, 0x5e, 0x84, 0x61, 0x11, 0x0,  0x0,  0xf,  0x1e, 0x29, 0xf0, 0x15, 0x0,  0x18, 0xb1,
                   0x33, 0x1,  0xd4, 0x1f, 0xb0, 0xa0, 0xed, 0x7a, 0xe6, 0xff, 0xad, 0xec, 0x5b, 0x7d, 0x75, 0x87,
                   0xf0, 0x89, 0xbb, 0x9f, 0x8c, 0xbf, 0x5d, 0xb,  0x1d, 0x24, 0x2f, 0x1f, 0x0,  0xc,  0xe9, 0x2a,
                   0x7,  0x98, 0x6c, 0x7e, 0x4f, 0x52, 0xbc, 0xb8, 0x6f, 0x8b, 0x13, 0x32, 0xa8, 0x22, 0x14, 0xac,
                   0x1a, 0x0,  0xb,  0x31, 0x41, 0xdb, 0x58, 0x4c, 0xa,  0xd4, 0xa,  0xdc, 0x89, 0xd5, 0x8,  0x0,
                   0x10, 0x13, 0xa4, 0x71, 0xd4, 0x58, 0x6,  0xc9, 0x44, 0xa4, 0x80, 0x39, 0xb6, 0x38, 0x44, 0x36,
                   0x26, 0x27, 0x0,  0x0,  0xa,  0xbb, 0x9e, 0x1,  0x8f, 0x83, 0x0,  0x0,  0x8f, 0x91, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24196);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x8F);
  EXPECT_EQ(granted_qos_levels[7], 0x91);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 19551 [Left SubErrPacketIdentifierInUse,Right QoS2,Left SubErrUnspecifiedError,Right QoS1,Right
// QoS2,Left SubErrPacketIdentifierInUse,Right QoS1,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrQuotaExceeded,Right QoS0] [PropResponseTopic "\251!<v\GS{\132\247@\179\133TJ\138",PropServerKeepAlive
// 23451,PropPayloadFormatIndicator 40,PropMessageExpiryInterval 28419,PropRetainAvailable
// 210,PropRequestProblemInformation 81,PropReasonString
// "\SYN:\ETX\221\217z~l\129\167b\155\t{\188\137?Ii",PropSharedSubscriptionAvailable 193,PropUserProperty
// "\241\132\231\SOHVd\151\171gW\156\163\150u5t\168\204I\237\169\174\&0\152\251\b\150qg"
// "@\167\158\159\&7\128\252\b\172",PropRetainAvailable 68,PropServerKeepAlive 14859,PropMessageExpiryInterval
// 1609,PropServerReference "\231\239",PropReasonString ".\240\205",PropMessageExpiryInterval 10469,PropResponseTopic
// "\178\131\244\&4\238\134\211/\168"]
TEST(SubACK5QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0x96, 0x1,  0x4c, 0x5f, 0x88, 0x1,  0x8,  0x0,  0xe,  0xfb, 0x21, 0x3c, 0x76, 0x1d, 0x7b, 0x84,
                   0xf7, 0x40, 0xb3, 0x85, 0x54, 0x4a, 0x8a, 0x13, 0x5b, 0x9b, 0x1,  0x28, 0x2,  0x0,  0x0,  0x6f, 0x3,
                   0x25, 0xd2, 0x17, 0x51, 0x1f, 0x0,  0x13, 0x16, 0x3a, 0x3,  0xdd, 0xd9, 0x7a, 0x7e, 0x6c, 0x81, 0xa7,
                   0x62, 0x9b, 0x9,  0x7b, 0xbc, 0x89, 0x3f, 0x49, 0x69, 0x2a, 0xc1, 0x26, 0x0,  0x1d, 0xf1, 0x84, 0xe7,
                   0x1,  0x56, 0x64, 0x97, 0xab, 0x67, 0x57, 0x9c, 0xa3, 0x96, 0x75, 0x35, 0x74, 0xa8, 0xcc, 0x49, 0xed,
                   0xa9, 0xae, 0x30, 0x98, 0xfb, 0x8,  0x96, 0x71, 0x67, 0x0,  0x9,  0x40, 0xa7, 0x9e, 0x9f, 0x37, 0x80,
                   0xfc, 0x8,  0xac, 0x25, 0x44, 0x13, 0x3a, 0xb,  0x2,  0x0,  0x0,  0x6,  0x49, 0x1c, 0x0,  0x2,  0xe7,
                   0xef, 0x1f, 0x0,  0x3,  0x2e, 0xf0, 0xcd, 0x2,  0x0,  0x0,  0x28, 0xe5, 0x8,  0x0,  0x9,  0xb2, 0x83,
                   0xf4, 0x34, 0xee, 0x86, 0xd3, 0x2f, 0xa8, 0x91, 0x2,  0x80, 0x1,  0x2,  0x91, 0x1,  0x9e, 0x97, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19551);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x91);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
  EXPECT_EQ(granted_qos_levels[8], 0x97);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// UnsubscribeRequest 21005
// ["\162U\229Q\203:\151\212\213\175Q\163\a\240\194\211\147\&1\196\251\US\142\159>\129\227\142\140","\191\&2\206V\211\208jL\223\162M\237i\241\128\DC1R\160UJ\195\175\194R\213","\213?\174\187\RS\DEL\245
// \199\246\204","6\147z\129\248e\186\239\143\190\200\231\233\244\170(\225[\f\254\202\159-VJ\255Pp!","H\191\171\135\157){d~\181\190","\FSe\146\150\222","\DLE\228\196{\157hG\135~RV^\EOT5","\243\212\198\a\157\193\174\231\196\129N\182\137\243w"]
// []
TEST(Unsubscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0xa2, 0x9c, 0x1,  0x52, 0xd,  0x0,  0x1c, 0xa2, 0x55, 0xe5, 0x51, 0xcb, 0x3a, 0x97, 0xd4, 0xd5,
                   0xaf, 0x51, 0xa3, 0x7,  0xf0, 0xc2, 0xd3, 0x93, 0x31, 0xc4, 0xfb, 0x1f, 0x8e, 0x9f, 0x3e, 0x81,
                   0xe3, 0x8e, 0x8c, 0x0,  0x19, 0xbf, 0x32, 0xce, 0x56, 0xd3, 0xd0, 0x6a, 0x4c, 0xdf, 0xa2, 0x4d,
                   0xed, 0x69, 0xf1, 0x80, 0x11, 0x52, 0xa0, 0x55, 0x4a, 0xc3, 0xaf, 0xc2, 0x52, 0xd5, 0x0,  0xb,
                   0xd5, 0x3f, 0xae, 0xbb, 0x1e, 0x7f, 0xf5, 0x20, 0xc7, 0xf6, 0xcc, 0x0,  0x1d, 0x36, 0x93, 0x7a,
                   0x81, 0xf8, 0x65, 0xba, 0xef, 0x8f, 0xbe, 0xc8, 0xe7, 0xe9, 0xf4, 0xaa, 0x28, 0xe1, 0x5b, 0xc,
                   0xfe, 0xca, 0x9f, 0x2d, 0x56, 0x4a, 0xff, 0x50, 0x70, 0x21, 0x0,  0xb,  0x48, 0xbf, 0xab, 0x87,
                   0x9d, 0x29, 0x7b, 0x64, 0x7e, 0xb5, 0xbe, 0x0,  0x5,  0x1c, 0x65, 0x92, 0x96, 0xde, 0x0,  0xe,
                   0x10, 0xe4, 0xc4, 0x7b, 0x9d, 0x68, 0x47, 0x87, 0x7e, 0x52, 0x56, 0x5e, 0x4,  0x35, 0x0,  0xf,
                   0xf3, 0xd4, 0xc6, 0x7,  0x9d, 0xc1, 0xae, 0xe7, 0xc4, 0x81, 0x4e, 0xb6, 0x89, 0xf3, 0x77};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xa2, 0x55, 0xe5, 0x51, 0xcb, 0x3a, 0x97, 0xd4, 0xd5, 0xaf,
                                     0x51, 0xa3, 0x7,  0xf0, 0xc2, 0xd3, 0x93, 0x31, 0xc4, 0xfb,
                                     0x1f, 0x8e, 0x9f, 0x3e, 0x81, 0xe3, 0x8e, 0x8c};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbf, 0x32, 0xce, 0x56, 0xd3, 0xd0, 0x6a, 0x4c, 0xdf, 0xa2, 0x4d, 0xed, 0x69,
                                     0xf1, 0x80, 0x11, 0x52, 0xa0, 0x55, 0x4a, 0xc3, 0xaf, 0xc2, 0x52, 0xd5};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd5, 0x3f, 0xae, 0xbb, 0x1e, 0x7f, 0xf5, 0x20, 0xc7, 0xf6, 0xcc};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x36, 0x93, 0x7a, 0x81, 0xf8, 0x65, 0xba, 0xef, 0x8f, 0xbe,
                                     0xc8, 0xe7, 0xe9, 0xf4, 0xaa, 0x28, 0xe1, 0x5b, 0xc,  0xfe,
                                     0xca, 0x9f, 0x2d, 0x56, 0x4a, 0xff, 0x50, 0x70, 0x21};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x48, 0xbf, 0xab, 0x87, 0x9d, 0x29, 0x7b, 0x64, 0x7e, 0xb5, 0xbe};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1c, 0x65, 0x92, 0x96, 0xde};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x10, 0xe4, 0xc4, 0x7b, 0x9d, 0x68, 0x47, 0x87, 0x7e, 0x52, 0x56, 0x5e, 0x4, 0x35};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf3, 0xd4, 0xc6, 0x7,  0x9d, 0xc1, 0xae, 0xe7,
                                     0xc4, 0x81, 0x4e, 0xb6, 0x89, 0xf3, 0x77};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21005, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17284
// ["\219\&6\208\245\251\252\ESC\222\a\175]6\SUB\EM\187\163\135\251R\141\188\250_~#\250\154\253'6","\209\"I\SOW",":/\181!v\193\177A\DC4\ACK\181\218\218*\183\248\233","^}\ETB\204n1\129\156\159\193Y\160\v","\222}^v\153\247\244\185\129\n\220Cy\SUB\ETX","\247\184r"]
// []
TEST(Unsubscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0xa2, 0x61, 0x43, 0x84, 0x0,  0x1e, 0xdb, 0x36, 0xd0, 0xf5, 0xfb, 0xfc, 0x1b, 0xde, 0x7,  0xaf, 0x5d,
                   0x36, 0x1a, 0x19, 0xbb, 0xa3, 0x87, 0xfb, 0x52, 0x8d, 0xbc, 0xfa, 0x5f, 0x7e, 0x23, 0xfa, 0x9a, 0xfd,
                   0x27, 0x36, 0x0,  0x5,  0xd1, 0x22, 0x49, 0xe,  0x57, 0x0,  0x11, 0x3a, 0x2f, 0xb5, 0x21, 0x76, 0xc1,
                   0xb1, 0x41, 0x14, 0x6,  0xb5, 0xda, 0xda, 0x2a, 0xb7, 0xf8, 0xe9, 0x0,  0xd,  0x5e, 0x7d, 0x17, 0xcc,
                   0x6e, 0x31, 0x81, 0x9c, 0x9f, 0xc1, 0x59, 0xa0, 0xb,  0x0,  0xf,  0xde, 0x7d, 0x5e, 0x76, 0x99, 0xf7,
                   0xf4, 0xb9, 0x81, 0xa,  0xdc, 0x43, 0x79, 0x1a, 0x3,  0x0,  0x3,  0xf7, 0xb8, 0x72};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xdb, 0x36, 0xd0, 0xf5, 0xfb, 0xfc, 0x1b, 0xde, 0x7,  0xaf,
                                     0x5d, 0x36, 0x1a, 0x19, 0xbb, 0xa3, 0x87, 0xfb, 0x52, 0x8d,
                                     0xbc, 0xfa, 0x5f, 0x7e, 0x23, 0xfa, 0x9a, 0xfd, 0x27, 0x36};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd1, 0x22, 0x49, 0xe, 0x57};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x3a, 0x2f, 0xb5, 0x21, 0x76, 0xc1, 0xb1, 0x41, 0x14,
                                     0x6,  0xb5, 0xda, 0xda, 0x2a, 0xb7, 0xf8, 0xe9};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5e, 0x7d, 0x17, 0xcc, 0x6e, 0x31, 0x81, 0x9c, 0x9f, 0xc1, 0x59, 0xa0, 0xb};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xde, 0x7d, 0x5e, 0x76, 0x99, 0xf7, 0xf4, 0xb9,
                                     0x81, 0xa,  0xdc, 0x43, 0x79, 0x1a, 0x3};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf7, 0xb8, 0x72};
  lwmqtt_string_t topic_filter_s5 = {3, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17284, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26289
// ["\140B\199\151L3\231\157\171K\204\197\224\217\DC2\144l\223\SYNH\185kEa\195","\170\250s\163&\SUB\DC3?I\176","*\244","\169\175\132P&\bp\128\&0B\ETB*\162u\148\&3p\fE\STX\ENQ\NAK)M{\199","\212j\250\SYN\247\NUL\139#9\128\SYN\141\DC1\198\182\221\128\146\130\239`3\STX\r","\179sq\146\SI\SYN\SUB\229\SUBT\SIeFJd\172\am\222\178|\234T\138\137\144"]
// []
TEST(Unsubscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0xa2, 0x7f, 0x66, 0xb1, 0x0,  0x19, 0x8c, 0x42, 0xc7, 0x97, 0x4c, 0x33, 0xe7, 0x9d, 0xab, 0x4b, 0xcc,
                   0xc5, 0xe0, 0xd9, 0x12, 0x90, 0x6c, 0xdf, 0x16, 0x48, 0xb9, 0x6b, 0x45, 0x61, 0xc3, 0x0,  0xa,  0xaa,
                   0xfa, 0x73, 0xa3, 0x26, 0x1a, 0x13, 0x3f, 0x49, 0xb0, 0x0,  0x2,  0x2a, 0xf4, 0x0,  0x1a, 0xa9, 0xaf,
                   0x84, 0x50, 0x26, 0x8,  0x70, 0x80, 0x30, 0x42, 0x17, 0x2a, 0xa2, 0x75, 0x94, 0x33, 0x70, 0xc,  0x45,
                   0x2,  0x5,  0x15, 0x29, 0x4d, 0x7b, 0xc7, 0x0,  0x18, 0xd4, 0x6a, 0xfa, 0x16, 0xf7, 0x0,  0x8b, 0x23,
                   0x39, 0x80, 0x16, 0x8d, 0x11, 0xc6, 0xb6, 0xdd, 0x80, 0x92, 0x82, 0xef, 0x60, 0x33, 0x2,  0xd,  0x0,
                   0x1a, 0xb3, 0x73, 0x71, 0x92, 0xf,  0x16, 0x1a, 0xe5, 0x1a, 0x54, 0xf,  0x65, 0x46, 0x4a, 0x64, 0xac,
                   0x7,  0x6d, 0xde, 0xb2, 0x7c, 0xea, 0x54, 0x8a, 0x89, 0x90};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x8c, 0x42, 0xc7, 0x97, 0x4c, 0x33, 0xe7, 0x9d, 0xab, 0x4b, 0xcc, 0xc5, 0xe0,
                                     0xd9, 0x12, 0x90, 0x6c, 0xdf, 0x16, 0x48, 0xb9, 0x6b, 0x45, 0x61, 0xc3};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaa, 0xfa, 0x73, 0xa3, 0x26, 0x1a, 0x13, 0x3f, 0x49, 0xb0};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2a, 0xf4};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa9, 0xaf, 0x84, 0x50, 0x26, 0x8,  0x70, 0x80, 0x30, 0x42, 0x17, 0x2a, 0xa2,
                                     0x75, 0x94, 0x33, 0x70, 0xc,  0x45, 0x2,  0x5,  0x15, 0x29, 0x4d, 0x7b, 0xc7};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd4, 0x6a, 0xfa, 0x16, 0xf7, 0x0,  0x8b, 0x23, 0x39, 0x80, 0x16, 0x8d,
                                     0x11, 0xc6, 0xb6, 0xdd, 0x80, 0x92, 0x82, 0xef, 0x60, 0x33, 0x2,  0xd};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb3, 0x73, 0x71, 0x92, 0xf,  0x16, 0x1a, 0xe5, 0x1a, 0x54, 0xf,  0x65, 0x46,
                                     0x4a, 0x64, 0xac, 0x7,  0x6d, 0xde, 0xb2, 0x7c, 0xea, 0x54, 0x8a, 0x89, 0x90};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26289, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 9896 ["\tB\174\175\ETB\143
// \v","\ENQm\"j\248","WK\250\223\NULU\203\244\200\172*\132","\RS\242\186\199b\226\200OR\vY\184#n\183\221\242\148bb\SUB\180"]
// []
TEST(Unsubscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0xa2, 0x39, 0x26, 0xa8, 0x0,  0x8,  0x9,  0x42, 0xae, 0xaf, 0x17, 0x8f, 0x20, 0xb,  0x0,
                   0x5,  0x5,  0x6d, 0x22, 0x6a, 0xf8, 0x0,  0xc,  0x57, 0x4b, 0xfa, 0xdf, 0x0,  0x55, 0xcb,
                   0xf4, 0xc8, 0xac, 0x2a, 0x84, 0x0,  0x16, 0x1e, 0xf2, 0xba, 0xc7, 0x62, 0xe2, 0xc8, 0x4f,
                   0x52, 0xb,  0x59, 0xb8, 0x23, 0x6e, 0xb7, 0xdd, 0xf2, 0x94, 0x62, 0x62, 0x1a, 0xb4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x9, 0x42, 0xae, 0xaf, 0x17, 0x8f, 0x20, 0xb};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5, 0x6d, 0x22, 0x6a, 0xf8};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x57, 0x4b, 0xfa, 0xdf, 0x0, 0x55, 0xcb, 0xf4, 0xc8, 0xac, 0x2a, 0x84};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1e, 0xf2, 0xba, 0xc7, 0x62, 0xe2, 0xc8, 0x4f, 0x52, 0xb,  0x59,
                                     0xb8, 0x23, 0x6e, 0xb7, 0xdd, 0xf2, 0x94, 0x62, 0x62, 0x1a, 0xb4};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9896, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 9659
// ["\253","\160\188","\246\207o\213\149\183l\132M\244\133\167\244B[\202","\DC4\197.\n\245\152<\170X\185\RS?8\177\237\152\ENQ\173\173\191\249\&8x\ESC\215\145\250","\158F\EOT.\ESC\EMp\SUB\218\&9P\172LJ\198"]
// []
TEST(Unsubscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0xa2, 0x49, 0x25, 0xbb, 0x0,  0x1,  0xfd, 0x0,  0x2,  0xa0, 0xbc, 0x0,  0x10, 0xf6, 0xcf,
                   0x6f, 0xd5, 0x95, 0xb7, 0x6c, 0x84, 0x4d, 0xf4, 0x85, 0xa7, 0xf4, 0x42, 0x5b, 0xca, 0x0,
                   0x1b, 0x14, 0xc5, 0x2e, 0xa,  0xf5, 0x98, 0x3c, 0xaa, 0x58, 0xb9, 0x1e, 0x3f, 0x38, 0xb1,
                   0xed, 0x98, 0x5,  0xad, 0xad, 0xbf, 0xf9, 0x38, 0x78, 0x1b, 0xd7, 0x91, 0xfa, 0x0,  0xf,
                   0x9e, 0x46, 0x4,  0x2e, 0x1b, 0x19, 0x70, 0x1a, 0xda, 0x39, 0x50, 0xac, 0x4c, 0x4a, 0xc6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xfd};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa0, 0xbc};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf6, 0xcf, 0x6f, 0xd5, 0x95, 0xb7, 0x6c, 0x84,
                                     0x4d, 0xf4, 0x85, 0xa7, 0xf4, 0x42, 0x5b, 0xca};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x14, 0xc5, 0x2e, 0xa,  0xf5, 0x98, 0x3c, 0xaa, 0x58, 0xb9, 0x1e, 0x3f, 0x38, 0xb1,
                                     0xed, 0x98, 0x5,  0xad, 0xad, 0xbf, 0xf9, 0x38, 0x78, 0x1b, 0xd7, 0x91, 0xfa};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9e, 0x46, 0x4,  0x2e, 0x1b, 0x19, 0x70, 0x1a,
                                     0xda, 0x39, 0x50, 0xac, 0x4c, 0x4a, 0xc6};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9659, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5752
// ["\a\tr\STXO4\140\DC2\166\&9\DC2\n\233","G\196\155\t.\170\213Y\229_\218\226k\NAKIi\229\145\SI\234","M!\NUL\223\224\185\128\215\200\186\241f\221vD\173\tW\162\EOT\200\&4!\n\160","Wu\227\181\230\224\215}\250\227\167\RS\140QIPk\192\135\b\STX\180\186\147\135U\174\155"]
// []
TEST(Unsubscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0xa2, 0x60, 0x16, 0x78, 0x0,  0xd,  0x7,  0x9,  0x72, 0x2,  0x4f, 0x34, 0x8c, 0x12, 0xa6, 0x39, 0x12,
                   0xa,  0xe9, 0x0,  0x14, 0x47, 0xc4, 0x9b, 0x9,  0x2e, 0xaa, 0xd5, 0x59, 0xe5, 0x5f, 0xda, 0xe2, 0x6b,
                   0x15, 0x49, 0x69, 0xe5, 0x91, 0xf,  0xea, 0x0,  0x19, 0x4d, 0x21, 0x0,  0xdf, 0xe0, 0xb9, 0x80, 0xd7,
                   0xc8, 0xba, 0xf1, 0x66, 0xdd, 0x76, 0x44, 0xad, 0x9,  0x57, 0xa2, 0x4,  0xc8, 0x34, 0x21, 0xa,  0xa0,
                   0x0,  0x1c, 0x57, 0x75, 0xe3, 0xb5, 0xe6, 0xe0, 0xd7, 0x7d, 0xfa, 0xe3, 0xa7, 0x1e, 0x8c, 0x51, 0x49,
                   0x50, 0x6b, 0xc0, 0x87, 0x8,  0x2,  0xb4, 0xba, 0x93, 0x87, 0x55, 0xae, 0x9b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x7, 0x9, 0x72, 0x2, 0x4f, 0x34, 0x8c, 0x12, 0xa6, 0x39, 0x12, 0xa, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x47, 0xc4, 0x9b, 0x9,  0x2e, 0xaa, 0xd5, 0x59, 0xe5, 0x5f,
                                     0xda, 0xe2, 0x6b, 0x15, 0x49, 0x69, 0xe5, 0x91, 0xf,  0xea};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4d, 0x21, 0x0,  0xdf, 0xe0, 0xb9, 0x80, 0xd7, 0xc8, 0xba, 0xf1, 0x66, 0xdd,
                                     0x76, 0x44, 0xad, 0x9,  0x57, 0xa2, 0x4,  0xc8, 0x34, 0x21, 0xa,  0xa0};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x57, 0x75, 0xe3, 0xb5, 0xe6, 0xe0, 0xd7, 0x7d, 0xfa, 0xe3,
                                     0xa7, 0x1e, 0x8c, 0x51, 0x49, 0x50, 0x6b, 0xc0, 0x87, 0x8,
                                     0x2,  0xb4, 0xba, 0x93, 0x87, 0x55, 0xae, 0x9b};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5752, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26590
// ["\"\128\&3`Z\154EIF","\191\216\128<6\157\128\f\207\159&h\207O\235|\169g\r\DC4\137\DC3\175\176\&3\201EN\NAK","\130{\210H\187
// \219q\251wl\247&\nJ$\185\DLE\158\179","\167\NUL\ETX\172\207gd3\251C\170\SIM\239\157O\233\224-\251e-\224\148\188","\184\NAK\198\&2\137\SI:\164\DC3\SYN(#\174\242\179\138<\206\157\US","\222\SO=\194\210\132u\185\192\r5\181","O\231\246\135\209\137","B>\250\193\SOL\212\170\245\168)\237\134\187\204\232*+\218\EM7\r\142\EOTb\221\152l\148"]
// []
TEST(Unsubscribe311QCTest, Encode7) {
  uint8_t pkt[] = {
      0xa2, 0xa8, 0x1,  0x67, 0xde, 0x0,  0x9,  0x22, 0x80, 0x33, 0x60, 0x5a, 0x9a, 0x45, 0x49, 0x46, 0x0,  0x1d, 0xbf,
      0xd8, 0x80, 0x3c, 0x36, 0x9d, 0x80, 0xc,  0xcf, 0x9f, 0x26, 0x68, 0xcf, 0x4f, 0xeb, 0x7c, 0xa9, 0x67, 0xd,  0x14,
      0x89, 0x13, 0xaf, 0xb0, 0x33, 0xc9, 0x45, 0x4e, 0x15, 0x0,  0x14, 0x82, 0x7b, 0xd2, 0x48, 0xbb, 0x20, 0xdb, 0x71,
      0xfb, 0x77, 0x6c, 0xf7, 0x26, 0xa,  0x4a, 0x24, 0xb9, 0x10, 0x9e, 0xb3, 0x0,  0x19, 0xa7, 0x0,  0x3,  0xac, 0xcf,
      0x67, 0x64, 0x33, 0xfb, 0x43, 0xaa, 0xf,  0x4d, 0xef, 0x9d, 0x4f, 0xe9, 0xe0, 0x2d, 0xfb, 0x65, 0x2d, 0xe0, 0x94,
      0xbc, 0x0,  0x14, 0xb8, 0x15, 0xc6, 0x32, 0x89, 0xf,  0x3a, 0xa4, 0x13, 0x16, 0x28, 0x23, 0xae, 0xf2, 0xb3, 0x8a,
      0x3c, 0xce, 0x9d, 0x1f, 0x0,  0xc,  0xde, 0xe,  0x3d, 0xc2, 0xd2, 0x84, 0x75, 0xb9, 0xc0, 0xd,  0x35, 0xb5, 0x0,
      0x6,  0x4f, 0xe7, 0xf6, 0x87, 0xd1, 0x89, 0x0,  0x1d, 0x42, 0x3e, 0xfa, 0xc1, 0xe,  0x4c, 0xd4, 0xaa, 0xf5, 0xa8,
      0x29, 0xed, 0x86, 0xbb, 0xcc, 0xe8, 0x2a, 0x2b, 0xda, 0x19, 0x37, 0xd,  0x8e, 0x4,  0x62, 0xdd, 0x98, 0x6c, 0x94};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x22, 0x80, 0x33, 0x60, 0x5a, 0x9a, 0x45, 0x49, 0x46};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbf, 0xd8, 0x80, 0x3c, 0x36, 0x9d, 0x80, 0xc,  0xcf, 0x9f,
                                     0x26, 0x68, 0xcf, 0x4f, 0xeb, 0x7c, 0xa9, 0x67, 0xd,  0x14,
                                     0x89, 0x13, 0xaf, 0xb0, 0x33, 0xc9, 0x45, 0x4e, 0x15};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x82, 0x7b, 0xd2, 0x48, 0xbb, 0x20, 0xdb, 0x71, 0xfb, 0x77,
                                     0x6c, 0xf7, 0x26, 0xa,  0x4a, 0x24, 0xb9, 0x10, 0x9e, 0xb3};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa7, 0x0,  0x3,  0xac, 0xcf, 0x67, 0x64, 0x33, 0xfb, 0x43, 0xaa, 0xf, 0x4d,
                                     0xef, 0x9d, 0x4f, 0xe9, 0xe0, 0x2d, 0xfb, 0x65, 0x2d, 0xe0, 0x94, 0xbc};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb8, 0x15, 0xc6, 0x32, 0x89, 0xf,  0x3a, 0xa4, 0x13, 0x16,
                                     0x28, 0x23, 0xae, 0xf2, 0xb3, 0x8a, 0x3c, 0xce, 0x9d, 0x1f};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xde, 0xe, 0x3d, 0xc2, 0xd2, 0x84, 0x75, 0xb9, 0xc0, 0xd, 0x35, 0xb5};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4f, 0xe7, 0xf6, 0x87, 0xd1, 0x89};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x42, 0x3e, 0xfa, 0xc1, 0xe,  0x4c, 0xd4, 0xaa, 0xf5, 0xa8,
                                     0x29, 0xed, 0x86, 0xbb, 0xcc, 0xe8, 0x2a, 0x2b, 0xda, 0x19,
                                     0x37, 0xd,  0x8e, 0x4,  0x62, 0xdd, 0x98, 0x6c, 0x94};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26590, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28467 ["\188j71/\157\SUBlO\ESC","N\195\136\SUB[L\203?\219","\USk\146!\197w\FSR\152\254\&3\216
// \DEL\184\"\147\247\GS\137\168","\147\161\247W\NAKc\172\214*\254 17\201\164\177)\167e\233\179\198\197Wf\a\153x"] []
TEST(Unsubscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0xa2, 0x4e, 0x6f, 0x33, 0x0,  0xa,  0xbc, 0x6a, 0x37, 0x31, 0x2f, 0x9d, 0x1a, 0x6c, 0x4f, 0x1b,
                   0x0,  0x9,  0x4e, 0xc3, 0x88, 0x1a, 0x5b, 0x4c, 0xcb, 0x3f, 0xdb, 0x0,  0x15, 0x1f, 0x6b, 0x92,
                   0x21, 0xc5, 0x77, 0x1c, 0x52, 0x98, 0xfe, 0x33, 0xd8, 0x20, 0x7f, 0xb8, 0x22, 0x93, 0xf7, 0x1d,
                   0x89, 0xa8, 0x0,  0x1c, 0x93, 0xa1, 0xf7, 0x57, 0x15, 0x63, 0xac, 0xd6, 0x2a, 0xfe, 0x20, 0x31,
                   0x37, 0xc9, 0xa4, 0xb1, 0x29, 0xa7, 0x65, 0xe9, 0xb3, 0xc6, 0xc5, 0x57, 0x66, 0x7,  0x99, 0x78};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xbc, 0x6a, 0x37, 0x31, 0x2f, 0x9d, 0x1a, 0x6c, 0x4f, 0x1b};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4e, 0xc3, 0x88, 0x1a, 0x5b, 0x4c, 0xcb, 0x3f, 0xdb};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1f, 0x6b, 0x92, 0x21, 0xc5, 0x77, 0x1c, 0x52, 0x98, 0xfe, 0x33,
                                     0xd8, 0x20, 0x7f, 0xb8, 0x22, 0x93, 0xf7, 0x1d, 0x89, 0xa8};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x93, 0xa1, 0xf7, 0x57, 0x15, 0x63, 0xac, 0xd6, 0x2a, 0xfe,
                                     0x20, 0x31, 0x37, 0xc9, 0xa4, 0xb1, 0x29, 0xa7, 0x65, 0xe9,
                                     0xb3, 0xc6, 0xc5, 0x57, 0x66, 0x7,  0x99, 0x78};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28467, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 8404 ["\198\198Y,9\140\US\ETB\133\SI\228\DC4\186\&9\252\131\242
// \160\ACK\250\190\133H\184","h|\216nA\142%q@$\216\a\145\EOTE{\207\164V16\251]\131\&8u\235\184Ez","\132T\176\161h\202^\226p\136\166%\163^5\146\232\ESC\STXi\ENQ(\228\223#\SOH\204","M","\172\206\130\186\208S\DC1\255\166\196a","\144}i\254(@\229\171\199YW\ESC:\DC2\SUBs\165k\t\164\175,PR\SYN\194\DEL","0pM\253Q\142\194\174\194\194G9c\235T\GS\235\199\205\220\170\a\vF"]
// []
TEST(Unsubscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0xa2, 0xa1, 0x1,  0x20, 0xd4, 0x0,  0x19, 0xc6, 0xc6, 0x59, 0x2c, 0x39, 0x8c, 0x1f, 0x17, 0x85, 0xf,
                   0xe4, 0x14, 0xba, 0x39, 0xfc, 0x83, 0xf2, 0x20, 0xa0, 0x6,  0xfa, 0xbe, 0x85, 0x48, 0xb8, 0x0,  0x1e,
                   0x68, 0x7c, 0xd8, 0x6e, 0x41, 0x8e, 0x25, 0x71, 0x40, 0x24, 0xd8, 0x7,  0x91, 0x4,  0x45, 0x7b, 0xcf,
                   0xa4, 0x56, 0x31, 0x36, 0xfb, 0x5d, 0x83, 0x38, 0x75, 0xeb, 0xb8, 0x45, 0x7a, 0x0,  0x1b, 0x84, 0x54,
                   0xb0, 0xa1, 0x68, 0xca, 0x5e, 0xe2, 0x70, 0x88, 0xa6, 0x25, 0xa3, 0x5e, 0x35, 0x92, 0xe8, 0x1b, 0x2,
                   0x69, 0x5,  0x28, 0xe4, 0xdf, 0x23, 0x1,  0xcc, 0x0,  0x1,  0x4d, 0x0,  0xb,  0xac, 0xce, 0x82, 0xba,
                   0xd0, 0x53, 0x11, 0xff, 0xa6, 0xc4, 0x61, 0x0,  0x1b, 0x90, 0x7d, 0x69, 0xfe, 0x28, 0x40, 0xe5, 0xab,
                   0xc7, 0x59, 0x57, 0x1b, 0x3a, 0x12, 0x1a, 0x73, 0xa5, 0x6b, 0x9,  0xa4, 0xaf, 0x2c, 0x50, 0x52, 0x16,
                   0xc2, 0x7f, 0x0,  0x18, 0x30, 0x70, 0x4d, 0xfd, 0x51, 0x8e, 0xc2, 0xae, 0xc2, 0xc2, 0x47, 0x39, 0x63,
                   0xeb, 0x54, 0x1d, 0xeb, 0xc7, 0xcd, 0xdc, 0xaa, 0x7,  0xb,  0x46};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xc6, 0xc6, 0x59, 0x2c, 0x39, 0x8c, 0x1f, 0x17, 0x85, 0xf,  0xe4, 0x14, 0xba,
                                     0x39, 0xfc, 0x83, 0xf2, 0x20, 0xa0, 0x6,  0xfa, 0xbe, 0x85, 0x48, 0xb8};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x68, 0x7c, 0xd8, 0x6e, 0x41, 0x8e, 0x25, 0x71, 0x40, 0x24,
                                     0xd8, 0x7,  0x91, 0x4,  0x45, 0x7b, 0xcf, 0xa4, 0x56, 0x31,
                                     0x36, 0xfb, 0x5d, 0x83, 0x38, 0x75, 0xeb, 0xb8, 0x45, 0x7a};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0x54, 0xb0, 0xa1, 0x68, 0xca, 0x5e, 0xe2, 0x70, 0x88, 0xa6, 0x25, 0xa3, 0x5e,
                                     0x35, 0x92, 0xe8, 0x1b, 0x2,  0x69, 0x5,  0x28, 0xe4, 0xdf, 0x23, 0x1,  0xcc};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4d};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xac, 0xce, 0x82, 0xba, 0xd0, 0x53, 0x11, 0xff, 0xa6, 0xc4, 0x61};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x90, 0x7d, 0x69, 0xfe, 0x28, 0x40, 0xe5, 0xab, 0xc7, 0x59, 0x57, 0x1b, 0x3a, 0x12,
                                     0x1a, 0x73, 0xa5, 0x6b, 0x9,  0xa4, 0xaf, 0x2c, 0x50, 0x52, 0x16, 0xc2, 0x7f};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x30, 0x70, 0x4d, 0xfd, 0x51, 0x8e, 0xc2, 0xae, 0xc2, 0xc2, 0x47, 0x39,
                                     0x63, 0xeb, 0x54, 0x1d, 0xeb, 0xc7, 0xcd, 0xdc, 0xaa, 0x7,  0xb,  0x46};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8404, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27989 ["q\223fV4\ETB\205\139(\ENQ`\204\145\206\221\207\248\245"] []
TEST(Unsubscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0xa2, 0x16, 0x6d, 0x55, 0x0,  0x12, 0x71, 0xdf, 0x66, 0x56, 0x34, 0x17,
                   0xcd, 0x8b, 0x28, 0x5,  0x60, 0xcc, 0x91, 0xce, 0xdd, 0xcf, 0xf8, 0xf5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0xdf, 0x66, 0x56, 0x34, 0x17, 0xcd, 0x8b, 0x28,
                                     0x5,  0x60, 0xcc, 0x91, 0xce, 0xdd, 0xcf, 0xf8, 0xf5};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27989, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 32178
// ["k\238\167\&3}\189\230\213?\DC3gW\142\236\196\STX\221\176\151\150\233","\174\208{E\236","&\174#!)\239\207\EOT\192Rr\155\145","\239\248\168\STXO\\~\184\&3\RS'*l\DLE\246\168^\a\173\137\&2\139G\SYN\218\170\152ELh","\206N\152\&2x\DC1\205\128\249\189\CAN\200_\228\162\207\RS\149"]
// []
TEST(Unsubscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0xa2, 0x63, 0x7d, 0xb2, 0x0,  0x15, 0x6b, 0xee, 0xa7, 0x33, 0x7d, 0xbd, 0xe6, 0xd5, 0x3f, 0x13, 0x67,
                   0x57, 0x8e, 0xec, 0xc4, 0x2,  0xdd, 0xb0, 0x97, 0x96, 0xe9, 0x0,  0x5,  0xae, 0xd0, 0x7b, 0x45, 0xec,
                   0x0,  0xd,  0x26, 0xae, 0x23, 0x21, 0x29, 0xef, 0xcf, 0x4,  0xc0, 0x52, 0x72, 0x9b, 0x91, 0x0,  0x1e,
                   0xef, 0xf8, 0xa8, 0x2,  0x4f, 0x5c, 0x7e, 0xb8, 0x33, 0x1e, 0x27, 0x2a, 0x6c, 0x10, 0xf6, 0xa8, 0x5e,
                   0x7,  0xad, 0x89, 0x32, 0x8b, 0x47, 0x16, 0xda, 0xaa, 0x98, 0x45, 0x4c, 0x68, 0x0,  0x12, 0xce, 0x4e,
                   0x98, 0x32, 0x78, 0x11, 0xcd, 0x80, 0xf9, 0xbd, 0x18, 0xc8, 0x5f, 0xe4, 0xa2, 0xcf, 0x1e, 0x95};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0xee, 0xa7, 0x33, 0x7d, 0xbd, 0xe6, 0xd5, 0x3f, 0x13, 0x67,
                                     0x57, 0x8e, 0xec, 0xc4, 0x2,  0xdd, 0xb0, 0x97, 0x96, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xae, 0xd0, 0x7b, 0x45, 0xec};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x26, 0xae, 0x23, 0x21, 0x29, 0xef, 0xcf, 0x4, 0xc0, 0x52, 0x72, 0x9b, 0x91};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xef, 0xf8, 0xa8, 0x2,  0x4f, 0x5c, 0x7e, 0xb8, 0x33, 0x1e,
                                     0x27, 0x2a, 0x6c, 0x10, 0xf6, 0xa8, 0x5e, 0x7,  0xad, 0x89,
                                     0x32, 0x8b, 0x47, 0x16, 0xda, 0xaa, 0x98, 0x45, 0x4c, 0x68};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xce, 0x4e, 0x98, 0x32, 0x78, 0x11, 0xcd, 0x80, 0xf9,
                                     0xbd, 0x18, 0xc8, 0x5f, 0xe4, 0xa2, 0xcf, 0x1e, 0x95};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32178, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17769 ["\192d\222\&2>\213\ESC_d\SUB\DC1N"] []
TEST(Unsubscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0xa2, 0x10, 0x45, 0x69, 0x0,  0xc,  0xc0, 0x64, 0xde,
                   0x32, 0x3e, 0xd5, 0x1b, 0x5f, 0x64, 0x1a, 0x11, 0x4e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xc0, 0x64, 0xde, 0x32, 0x3e, 0xd5, 0x1b, 0x5f, 0x64, 0x1a, 0x11, 0x4e};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17769, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 21908
// ["$","\GSI\141^\185\188\DC2|\159M\189\209\DC4\211\&1","L\t}\130~\220\&8\211\235","\210\USg\203\179@\DC2\174l\v\193\DC2)Q\233\STX#\177C\164\ENQ&@;=\238\138\217\158"]
// []
TEST(Unsubscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0xa2, 0x40, 0x55, 0x94, 0x0,  0x1,  0x24, 0x0,  0xf,  0x1d, 0x49, 0x8d, 0x5e, 0xb9, 0xbc, 0x12, 0x7c,
                   0x9f, 0x4d, 0xbd, 0xd1, 0x14, 0xd3, 0x31, 0x0,  0x9,  0x4c, 0x9,  0x7d, 0x82, 0x7e, 0xdc, 0x38, 0xd3,
                   0xeb, 0x0,  0x1d, 0xd2, 0x1f, 0x67, 0xcb, 0xb3, 0x40, 0x12, 0xae, 0x6c, 0xb,  0xc1, 0x12, 0x29, 0x51,
                   0xe9, 0x2,  0x23, 0xb1, 0x43, 0xa4, 0x5,  0x26, 0x40, 0x3b, 0x3d, 0xee, 0x8a, 0xd9, 0x9e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x24};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1d, 0x49, 0x8d, 0x5e, 0xb9, 0xbc, 0x12, 0x7c,
                                     0x9f, 0x4d, 0xbd, 0xd1, 0x14, 0xd3, 0x31};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4c, 0x9, 0x7d, 0x82, 0x7e, 0xdc, 0x38, 0xd3, 0xeb};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd2, 0x1f, 0x67, 0xcb, 0xb3, 0x40, 0x12, 0xae, 0x6c, 0xb,
                                     0xc1, 0x12, 0x29, 0x51, 0xe9, 0x2,  0x23, 0xb1, 0x43, 0xa4,
                                     0x5,  0x26, 0x40, 0x3b, 0x3d, 0xee, 0x8a, 0xd9, 0x9e};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21908, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 12542 ["j\251j\160\243\235
// \r\246R\192\234l\DC2.\153\144v\NAK\RSXz\DEL:","\DC4\SYN\240\227S!\ETX\ETBS\179\245t\185D+\225\&3n~\146z\194\143"] []
TEST(Unsubscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0xa2, 0x35, 0x30, 0xfe, 0x0,  0x18, 0x6a, 0xfb, 0x6a, 0xa0, 0xf3, 0xeb, 0x20, 0xd,
                   0xf6, 0x52, 0xc0, 0xea, 0x6c, 0x12, 0x2e, 0x99, 0x90, 0x76, 0x15, 0x1e, 0x58, 0x7a,
                   0x7f, 0x3a, 0x0,  0x17, 0x14, 0x16, 0xf0, 0xe3, 0x53, 0x21, 0x3,  0x17, 0x53, 0xb3,
                   0xf5, 0x74, 0xb9, 0x44, 0x2b, 0xe1, 0x33, 0x6e, 0x7e, 0x92, 0x7a, 0xc2, 0x8f};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x6a, 0xfb, 0x6a, 0xa0, 0xf3, 0xeb, 0x20, 0xd,  0xf6, 0x52, 0xc0, 0xea,
                                     0x6c, 0x12, 0x2e, 0x99, 0x90, 0x76, 0x15, 0x1e, 0x58, 0x7a, 0x7f, 0x3a};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x14, 0x16, 0xf0, 0xe3, 0x53, 0x21, 0x3,  0x17, 0x53, 0xb3, 0xf5, 0x74,
                                     0xb9, 0x44, 0x2b, 0xe1, 0x33, 0x6e, 0x7e, 0x92, 0x7a, 0xc2, 0x8f};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12542, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22335 ["\171r\247N1\218","4\149\209gL^\241\220\171\227{YRF8\184,\212\205\157"] []
TEST(Unsubscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0xa2, 0x20, 0x57, 0x3f, 0x0,  0x6,  0xab, 0x72, 0xf7, 0x4e, 0x31, 0xda,
                   0x0,  0x14, 0x34, 0x95, 0xd1, 0x67, 0x4c, 0x5e, 0xf1, 0xdc, 0xab, 0xe3,
                   0x7b, 0x59, 0x52, 0x46, 0x38, 0xb8, 0x2c, 0xd4, 0xcd, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x72, 0xf7, 0x4e, 0x31, 0xda};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x34, 0x95, 0xd1, 0x67, 0x4c, 0x5e, 0xf1, 0xdc, 0xab, 0xe3,
                                     0x7b, 0x59, 0x52, 0x46, 0x38, 0xb8, 0x2c, 0xd4, 0xcd, 0x9d};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22335, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 6771
// ["\135\US\219/\163+\FS-","\161\136\131Y\CAN\230t&\196\174\&4-\f\129\155\189N\211c\233\235q\138\227\250O\148\222\&3","JJ4\DEL\247{\189\166\DLE5\241-\195\141X\tN\138\248\171\247(\202Z\231\&6C\255","\182\r\144B[\233\NAK\194\179{\177\&6\206o\172h","","\163,+n\168M\SO\184\180","?\146X+Lw\191\EM\209\t\174\211\160s\192Fa\237\195\212\&1DY\131\163","z\255\213\SUBvQ\236M\152\208\149h","\137\237\131\198XD\SO^P\207\227\146\248\240\227}&\141\142v>\GS","\192\221\160N\167e\"R<\142",""]
// []
TEST(Unsubscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0xa2, 0xb7, 0x1,  0x1a, 0x73, 0x0,  0x8,  0x87, 0x1f, 0xdb, 0x2f, 0xa3, 0x2b, 0x1c, 0x2d, 0x0,  0x1d,
                   0xa1, 0x88, 0x83, 0x59, 0x18, 0xe6, 0x74, 0x26, 0xc4, 0xae, 0x34, 0x2d, 0xc,  0x81, 0x9b, 0xbd, 0x4e,
                   0xd3, 0x63, 0xe9, 0xeb, 0x71, 0x8a, 0xe3, 0xfa, 0x4f, 0x94, 0xde, 0x33, 0x0,  0x1c, 0x4a, 0x4a, 0x34,
                   0x7f, 0xf7, 0x7b, 0xbd, 0xa6, 0x10, 0x35, 0xf1, 0x2d, 0xc3, 0x8d, 0x58, 0x9,  0x4e, 0x8a, 0xf8, 0xab,
                   0xf7, 0x28, 0xca, 0x5a, 0xe7, 0x36, 0x43, 0xff, 0x0,  0x10, 0xb6, 0xd,  0x90, 0x42, 0x5b, 0xe9, 0x15,
                   0xc2, 0xb3, 0x7b, 0xb1, 0x36, 0xce, 0x6f, 0xac, 0x68, 0x0,  0x0,  0x0,  0x9,  0xa3, 0x2c, 0x2b, 0x6e,
                   0xa8, 0x4d, 0xe,  0xb8, 0xb4, 0x0,  0x19, 0x3f, 0x92, 0x58, 0x2b, 0x4c, 0x77, 0xbf, 0x19, 0xd1, 0x9,
                   0xae, 0xd3, 0xa0, 0x73, 0xc0, 0x46, 0x61, 0xed, 0xc3, 0xd4, 0x31, 0x44, 0x59, 0x83, 0xa3, 0x0,  0xc,
                   0x7a, 0xff, 0xd5, 0x1a, 0x76, 0x51, 0xec, 0x4d, 0x98, 0xd0, 0x95, 0x68, 0x0,  0x16, 0x89, 0xed, 0x83,
                   0xc6, 0x58, 0x44, 0xe,  0x5e, 0x50, 0xcf, 0xe3, 0x92, 0xf8, 0xf0, 0xe3, 0x7d, 0x26, 0x8d, 0x8e, 0x76,
                   0x3e, 0x1d, 0x0,  0xa,  0xc0, 0xdd, 0xa0, 0x4e, 0xa7, 0x65, 0x22, 0x52, 0x3c, 0x8e, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x87, 0x1f, 0xdb, 0x2f, 0xa3, 0x2b, 0x1c, 0x2d};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa1, 0x88, 0x83, 0x59, 0x18, 0xe6, 0x74, 0x26, 0xc4, 0xae,
                                     0x34, 0x2d, 0xc,  0x81, 0x9b, 0xbd, 0x4e, 0xd3, 0x63, 0xe9,
                                     0xeb, 0x71, 0x8a, 0xe3, 0xfa, 0x4f, 0x94, 0xde, 0x33};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4a, 0x4a, 0x34, 0x7f, 0xf7, 0x7b, 0xbd, 0xa6, 0x10, 0x35,
                                     0xf1, 0x2d, 0xc3, 0x8d, 0x58, 0x9,  0x4e, 0x8a, 0xf8, 0xab,
                                     0xf7, 0x28, 0xca, 0x5a, 0xe7, 0x36, 0x43, 0xff};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0xd,  0x90, 0x42, 0x5b, 0xe9, 0x15, 0xc2,
                                     0xb3, 0x7b, 0xb1, 0x36, 0xce, 0x6f, 0xac, 0x68};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa3, 0x2c, 0x2b, 0x6e, 0xa8, 0x4d, 0xe, 0xb8, 0xb4};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3f, 0x92, 0x58, 0x2b, 0x4c, 0x77, 0xbf, 0x19, 0xd1, 0x9,  0xae, 0xd3, 0xa0,
                                     0x73, 0xc0, 0x46, 0x61, 0xed, 0xc3, 0xd4, 0x31, 0x44, 0x59, 0x83, 0xa3};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7a, 0xff, 0xd5, 0x1a, 0x76, 0x51, 0xec, 0x4d, 0x98, 0xd0, 0x95, 0x68};
  lwmqtt_string_t topic_filter_s7 = {12, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x89, 0xed, 0x83, 0xc6, 0x58, 0x44, 0xe,  0x5e, 0x50, 0xcf, 0xe3,
                                     0x92, 0xf8, 0xf0, 0xe3, 0x7d, 0x26, 0x8d, 0x8e, 0x76, 0x3e, 0x1d};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xc0, 0xdd, 0xa0, 0x4e, 0xa7, 0x65, 0x22, 0x52, 0x3c, 0x8e};
  lwmqtt_string_t topic_filter_s9 = {10, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 6771, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 19984
// ["I|\192\176@\ETB\219a\254\217\n\238\172\EOT\202\143*?\ETB\130\172\174\CAN\DEL\177\163","~V\240~\192","b6\189\&0\244q","\143\166/\SO\r\r\240\212\181\136\172$\233\243\149\&70h_|\204\136
// \206\146\134\236\&6\179","\157\168\227\SOH\242\183\153\nO\235\DEL\aW\227\196\225\179\210s\174\FS\155(\t\137\158\229","\ESCl\130\ACK\135\&4,D\208\141\243s\n*F*","\170\194\223-H\208r]UF+\221\\.\187\225\135]x\218\140on\180\233","\194\f\246\&1n\154\DC1\195\170\161\232\152\185\222\ESC"]
// []
TEST(Unsubscribe311QCTest, Encode17) {
  uint8_t pkt[] = {
      0xa2, 0xa7, 0x1,  0x4e, 0x10, 0x0,  0x1a, 0x49, 0x7c, 0xc0, 0xb0, 0x40, 0x17, 0xdb, 0x61, 0xfe, 0xd9, 0xa,  0xee,
      0xac, 0x4,  0xca, 0x8f, 0x2a, 0x3f, 0x17, 0x82, 0xac, 0xae, 0x18, 0x7f, 0xb1, 0xa3, 0x0,  0x5,  0x7e, 0x56, 0xf0,
      0x7e, 0xc0, 0x0,  0x6,  0x62, 0x36, 0xbd, 0x30, 0xf4, 0x71, 0x0,  0x1d, 0x8f, 0xa6, 0x2f, 0xe,  0xd,  0xd,  0xf0,
      0xd4, 0xb5, 0x88, 0xac, 0x24, 0xe9, 0xf3, 0x95, 0x37, 0x30, 0x68, 0x5f, 0x7c, 0xcc, 0x88, 0x20, 0xce, 0x92, 0x86,
      0xec, 0x36, 0xb3, 0x0,  0x1b, 0x9d, 0xa8, 0xe3, 0x1,  0xf2, 0xb7, 0x99, 0xa,  0x4f, 0xeb, 0x7f, 0x7,  0x57, 0xe3,
      0xc4, 0xe1, 0xb3, 0xd2, 0x73, 0xae, 0x1c, 0x9b, 0x28, 0x9,  0x89, 0x9e, 0xe5, 0x0,  0x10, 0x1b, 0x6c, 0x82, 0x6,
      0x87, 0x34, 0x2c, 0x44, 0xd0, 0x8d, 0xf3, 0x73, 0xa,  0x2a, 0x46, 0x2a, 0x0,  0x19, 0xaa, 0xc2, 0xdf, 0x2d, 0x48,
      0xd0, 0x72, 0x5d, 0x55, 0x46, 0x2b, 0xdd, 0x5c, 0x2e, 0xbb, 0xe1, 0x87, 0x5d, 0x78, 0xda, 0x8c, 0x6f, 0x6e, 0xb4,
      0xe9, 0x0,  0xf,  0xc2, 0xc,  0xf6, 0x31, 0x6e, 0x9a, 0x11, 0xc3, 0xaa, 0xa1, 0xe8, 0x98, 0xb9, 0xde, 0x1b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x49, 0x7c, 0xc0, 0xb0, 0x40, 0x17, 0xdb, 0x61, 0xfe, 0xd9, 0xa,  0xee, 0xac,
                                     0x4,  0xca, 0x8f, 0x2a, 0x3f, 0x17, 0x82, 0xac, 0xae, 0x18, 0x7f, 0xb1, 0xa3};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7e, 0x56, 0xf0, 0x7e, 0xc0};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x62, 0x36, 0xbd, 0x30, 0xf4, 0x71};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8f, 0xa6, 0x2f, 0xe,  0xd,  0xd,  0xf0, 0xd4, 0xb5, 0x88,
                                     0xac, 0x24, 0xe9, 0xf3, 0x95, 0x37, 0x30, 0x68, 0x5f, 0x7c,
                                     0xcc, 0x88, 0x20, 0xce, 0x92, 0x86, 0xec, 0x36, 0xb3};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9d, 0xa8, 0xe3, 0x1,  0xf2, 0xb7, 0x99, 0xa,  0x4f, 0xeb, 0x7f, 0x7,  0x57, 0xe3,
                                     0xc4, 0xe1, 0xb3, 0xd2, 0x73, 0xae, 0x1c, 0x9b, 0x28, 0x9,  0x89, 0x9e, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1b, 0x6c, 0x82, 0x6,  0x87, 0x34, 0x2c, 0x44,
                                     0xd0, 0x8d, 0xf3, 0x73, 0xa,  0x2a, 0x46, 0x2a};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xaa, 0xc2, 0xdf, 0x2d, 0x48, 0xd0, 0x72, 0x5d, 0x55, 0x46, 0x2b, 0xdd, 0x5c,
                                     0x2e, 0xbb, 0xe1, 0x87, 0x5d, 0x78, 0xda, 0x8c, 0x6f, 0x6e, 0xb4, 0xe9};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc2, 0xc,  0xf6, 0x31, 0x6e, 0x9a, 0x11, 0xc3,
                                     0xaa, 0xa1, 0xe8, 0x98, 0xb9, 0xde, 0x1b};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19984, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 8587
// ["^\158\181\192J\FS\249","\248\243\ACK\NULSg}\128\177\154\&2\SUB-\242\GS\229\t\NAK\US\189m\225\230I\FS","\SUB\194\179C\203\152","\244#\152\175\194\153\231\239\ETBD\146Q\248g\246w\143K\194\245\181","\DC4\tIs\155jp\197\SYN'1,G(P\NAK$\163\144\146\159\USY\194M\151\157\255","\236\159","\228\132\130\254\213\173\&1\202\&0\136\135\231\157\167p\199}\139\ETX
// \191\189\168\245\227\DC2}","\233mc\155K\b!\RSu\SUB","t\178\DEL\DELy\240\224\228\141\238\EOT\EM\153;\190\234","\128xS\199\240\228\&0R\vR\180\&3\217\179\162H\189%\192\247\195e\179t\RS\"x\DC1my","\246\ESC\248\136\ETX>\225\204\ACK\136\170\"\v\232\253\219\199=\ACK"]
// []
TEST(Unsubscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0xa2, 0xd7, 0x1,  0x21, 0x8b, 0x0,  0x7,  0x5e, 0x9e, 0xb5, 0xc0, 0x4a, 0x1c, 0xf9, 0x0,  0x19, 0xf8,
                   0xf3, 0x6,  0x0,  0x53, 0x67, 0x7d, 0x80, 0xb1, 0x9a, 0x32, 0x1a, 0x2d, 0xf2, 0x1d, 0xe5, 0x9,  0x15,
                   0x1f, 0xbd, 0x6d, 0xe1, 0xe6, 0x49, 0x1c, 0x0,  0x6,  0x1a, 0xc2, 0xb3, 0x43, 0xcb, 0x98, 0x0,  0x15,
                   0xf4, 0x23, 0x98, 0xaf, 0xc2, 0x99, 0xe7, 0xef, 0x17, 0x44, 0x92, 0x51, 0xf8, 0x67, 0xf6, 0x77, 0x8f,
                   0x4b, 0xc2, 0xf5, 0xb5, 0x0,  0x1c, 0x14, 0x9,  0x49, 0x73, 0x9b, 0x6a, 0x70, 0xc5, 0x16, 0x27, 0x31,
                   0x2c, 0x47, 0x28, 0x50, 0x15, 0x24, 0xa3, 0x90, 0x92, 0x9f, 0x1f, 0x59, 0xc2, 0x4d, 0x97, 0x9d, 0xff,
                   0x0,  0x2,  0xec, 0x9f, 0x0,  0x1b, 0xe4, 0x84, 0x82, 0xfe, 0xd5, 0xad, 0x31, 0xca, 0x30, 0x88, 0x87,
                   0xe7, 0x9d, 0xa7, 0x70, 0xc7, 0x7d, 0x8b, 0x3,  0x20, 0xbf, 0xbd, 0xa8, 0xf5, 0xe3, 0x12, 0x7d, 0x0,
                   0xa,  0xe9, 0x6d, 0x63, 0x9b, 0x4b, 0x8,  0x21, 0x1e, 0x75, 0x1a, 0x0,  0x10, 0x74, 0xb2, 0x7f, 0x7f,
                   0x79, 0xf0, 0xe0, 0xe4, 0x8d, 0xee, 0x4,  0x19, 0x99, 0x3b, 0xbe, 0xea, 0x0,  0x1e, 0x80, 0x78, 0x53,
                   0xc7, 0xf0, 0xe4, 0x30, 0x52, 0xb,  0x52, 0xb4, 0x33, 0xd9, 0xb3, 0xa2, 0x48, 0xbd, 0x25, 0xc0, 0xf7,
                   0xc3, 0x65, 0xb3, 0x74, 0x1e, 0x22, 0x78, 0x11, 0x6d, 0x79, 0x0,  0x13, 0xf6, 0x1b, 0xf8, 0x88, 0x3,
                   0x3e, 0xe1, 0xcc, 0x6,  0x88, 0xaa, 0x22, 0xb,  0xe8, 0xfd, 0xdb, 0xc7, 0x3d, 0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x5e, 0x9e, 0xb5, 0xc0, 0x4a, 0x1c, 0xf9};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf8, 0xf3, 0x6,  0x0, 0x53, 0x67, 0x7d, 0x80, 0xb1, 0x9a, 0x32, 0x1a, 0x2d,
                                     0xf2, 0x1d, 0xe5, 0x9, 0x15, 0x1f, 0xbd, 0x6d, 0xe1, 0xe6, 0x49, 0x1c};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0xc2, 0xb3, 0x43, 0xcb, 0x98};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf4, 0x23, 0x98, 0xaf, 0xc2, 0x99, 0xe7, 0xef, 0x17, 0x44, 0x92,
                                     0x51, 0xf8, 0x67, 0xf6, 0x77, 0x8f, 0x4b, 0xc2, 0xf5, 0xb5};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x14, 0x9,  0x49, 0x73, 0x9b, 0x6a, 0x70, 0xc5, 0x16, 0x27,
                                     0x31, 0x2c, 0x47, 0x28, 0x50, 0x15, 0x24, 0xa3, 0x90, 0x92,
                                     0x9f, 0x1f, 0x59, 0xc2, 0x4d, 0x97, 0x9d, 0xff};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xec, 0x9f};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xe4, 0x84, 0x82, 0xfe, 0xd5, 0xad, 0x31, 0xca, 0x30, 0x88, 0x87, 0xe7, 0x9d, 0xa7,
                                     0x70, 0xc7, 0x7d, 0x8b, 0x3,  0x20, 0xbf, 0xbd, 0xa8, 0xf5, 0xe3, 0x12, 0x7d};
  lwmqtt_string_t topic_filter_s6 = {27, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe9, 0x6d, 0x63, 0x9b, 0x4b, 0x8, 0x21, 0x1e, 0x75, 0x1a};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x74, 0xb2, 0x7f, 0x7f, 0x79, 0xf0, 0xe0, 0xe4,
                                     0x8d, 0xee, 0x4,  0x19, 0x99, 0x3b, 0xbe, 0xea};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x80, 0x78, 0x53, 0xc7, 0xf0, 0xe4, 0x30, 0x52, 0xb,  0x52,
                                     0xb4, 0x33, 0xd9, 0xb3, 0xa2, 0x48, 0xbd, 0x25, 0xc0, 0xf7,
                                     0xc3, 0x65, 0xb3, 0x74, 0x1e, 0x22, 0x78, 0x11, 0x6d, 0x79};
  lwmqtt_string_t topic_filter_s9 = {30, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xf6, 0x1b, 0xf8, 0x88, 0x3,  0x3e, 0xe1, 0xcc, 0x6, 0x88,
                                      0xaa, 0x22, 0xb,  0xe8, 0xfd, 0xdb, 0xc7, 0x3d, 0x6};
  lwmqtt_string_t topic_filter_s10 = {19, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8587, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24034
// ["\156\234\208\197\181\158\172S\218","\132\v\NAK\170\230\US\216+\217\DEL\213\156F","MTu\239]\128\EOT\f\SYN_\203\250\250\148\128\\\SO\ETBuv\137\211w\174+\NULUh_\232","\134\175\155\DC1\190\137R%\247H\202\207","\135\ETX\221t\137\178A\194\131\189V\254\204\246\175\143x\NAK\162[\135*\235[\EOT","Sq\209\151pP","\185\181~\EM\159\160\137\183\ETXQ\129u\174'O\210\177\GSi\201\217","Ch\167\252[{V1Q\223D\152$70\147\DC1\158-t7\250\152+\244\255\RS^j","\134\&4\166Q\210\FS\194\136\206qe\DLE]CG\FSEj\169\156\NUL\213\185>H\ETX&\SI\140"]
// []
TEST(Unsubscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0xa2, 0xc2, 0x1,  0x5d, 0xe2, 0x0,  0x9,  0x9c, 0xea, 0xd0, 0xc5, 0xb5, 0x9e, 0xac, 0x53, 0xda, 0x0,
                   0xd,  0x84, 0xb,  0x15, 0xaa, 0xe6, 0x1f, 0xd8, 0x2b, 0xd9, 0x7f, 0xd5, 0x9c, 0x46, 0x0,  0x1e, 0x4d,
                   0x54, 0x75, 0xef, 0x5d, 0x80, 0x4,  0xc,  0x16, 0x5f, 0xcb, 0xfa, 0xfa, 0x94, 0x80, 0x5c, 0xe,  0x17,
                   0x75, 0x76, 0x89, 0xd3, 0x77, 0xae, 0x2b, 0x0,  0x55, 0x68, 0x5f, 0xe8, 0x0,  0xc,  0x86, 0xaf, 0x9b,
                   0x11, 0xbe, 0x89, 0x52, 0x25, 0xf7, 0x48, 0xca, 0xcf, 0x0,  0x19, 0x87, 0x3,  0xdd, 0x74, 0x89, 0xb2,
                   0x41, 0xc2, 0x83, 0xbd, 0x56, 0xfe, 0xcc, 0xf6, 0xaf, 0x8f, 0x78, 0x15, 0xa2, 0x5b, 0x87, 0x2a, 0xeb,
                   0x5b, 0x4,  0x0,  0x6,  0x53, 0x71, 0xd1, 0x97, 0x70, 0x50, 0x0,  0x15, 0xb9, 0xb5, 0x7e, 0x19, 0x9f,
                   0xa0, 0x89, 0xb7, 0x3,  0x51, 0x81, 0x75, 0xae, 0x27, 0x4f, 0xd2, 0xb1, 0x1d, 0x69, 0xc9, 0xd9, 0x0,
                   0x1d, 0x43, 0x68, 0xa7, 0xfc, 0x5b, 0x7b, 0x56, 0x31, 0x51, 0xdf, 0x44, 0x98, 0x24, 0x37, 0x30, 0x93,
                   0x11, 0x9e, 0x2d, 0x74, 0x37, 0xfa, 0x98, 0x2b, 0xf4, 0xff, 0x1e, 0x5e, 0x6a, 0x0,  0x1d, 0x86, 0x34,
                   0xa6, 0x51, 0xd2, 0x1c, 0xc2, 0x88, 0xce, 0x71, 0x65, 0x10, 0x5d, 0x43, 0x47, 0x1c, 0x45, 0x6a, 0xa9,
                   0x9c, 0x0,  0xd5, 0xb9, 0x3e, 0x48, 0x3,  0x26, 0xf,  0x8c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x9c, 0xea, 0xd0, 0xc5, 0xb5, 0x9e, 0xac, 0x53, 0xda};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x84, 0xb, 0x15, 0xaa, 0xe6, 0x1f, 0xd8, 0x2b, 0xd9, 0x7f, 0xd5, 0x9c, 0x46};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4d, 0x54, 0x75, 0xef, 0x5d, 0x80, 0x4,  0xc,  0x16, 0x5f,
                                     0xcb, 0xfa, 0xfa, 0x94, 0x80, 0x5c, 0xe,  0x17, 0x75, 0x76,
                                     0x89, 0xd3, 0x77, 0xae, 0x2b, 0x0,  0x55, 0x68, 0x5f, 0xe8};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x86, 0xaf, 0x9b, 0x11, 0xbe, 0x89, 0x52, 0x25, 0xf7, 0x48, 0xca, 0xcf};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x87, 0x3,  0xdd, 0x74, 0x89, 0xb2, 0x41, 0xc2, 0x83, 0xbd, 0x56, 0xfe, 0xcc,
                                     0xf6, 0xaf, 0x8f, 0x78, 0x15, 0xa2, 0x5b, 0x87, 0x2a, 0xeb, 0x5b, 0x4};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x53, 0x71, 0xd1, 0x97, 0x70, 0x50};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb9, 0xb5, 0x7e, 0x19, 0x9f, 0xa0, 0x89, 0xb7, 0x3,  0x51, 0x81,
                                     0x75, 0xae, 0x27, 0x4f, 0xd2, 0xb1, 0x1d, 0x69, 0xc9, 0xd9};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x43, 0x68, 0xa7, 0xfc, 0x5b, 0x7b, 0x56, 0x31, 0x51, 0xdf,
                                     0x44, 0x98, 0x24, 0x37, 0x30, 0x93, 0x11, 0x9e, 0x2d, 0x74,
                                     0x37, 0xfa, 0x98, 0x2b, 0xf4, 0xff, 0x1e, 0x5e, 0x6a};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x86, 0x34, 0xa6, 0x51, 0xd2, 0x1c, 0xc2, 0x88, 0xce, 0x71,
                                     0x65, 0x10, 0x5d, 0x43, 0x47, 0x1c, 0x45, 0x6a, 0xa9, 0x9c,
                                     0x0,  0xd5, 0xb9, 0x3e, 0x48, 0x3,  0x26, 0xf,  0x8c};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24034, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5686
// ["","\v}7\181\SI\131\156\ETX\158\RS<\237t\205^\236\158\139>","\179\158\242","","}>\\@\236\138X@Bu=P>J\STX\STXF&,?\129'\213\195\189","\\W=A\231m\181\237v\154\160","\254\234\210\&3`B\"/\175\253\131\244@\176]\211\159\163\160$\246"]
// []
TEST(Unsubscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0xa2, 0x5f, 0x16, 0x36, 0x0,  0x0,  0x0,  0x13, 0xb,  0x7d, 0x37, 0xb5, 0xf,  0x83, 0x9c, 0x3,  0x9e,
                   0x1e, 0x3c, 0xed, 0x74, 0xcd, 0x5e, 0xec, 0x9e, 0x8b, 0x3e, 0x0,  0x3,  0xb3, 0x9e, 0xf2, 0x0,  0x0,
                   0x0,  0x19, 0x7d, 0x3e, 0x5c, 0x40, 0xec, 0x8a, 0x58, 0x40, 0x42, 0x75, 0x3d, 0x50, 0x3e, 0x4a, 0x2,
                   0x2,  0x46, 0x26, 0x2c, 0x3f, 0x81, 0x27, 0xd5, 0xc3, 0xbd, 0x0,  0xb,  0x5c, 0x57, 0x3d, 0x41, 0xe7,
                   0x6d, 0xb5, 0xed, 0x76, 0x9a, 0xa0, 0x0,  0x15, 0xfe, 0xea, 0xd2, 0x33, 0x60, 0x42, 0x22, 0x2f, 0xaf,
                   0xfd, 0x83, 0xf4, 0x40, 0xb0, 0x5d, 0xd3, 0x9f, 0xa3, 0xa0, 0x24, 0xf6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb,  0x7d, 0x37, 0xb5, 0xf,  0x83, 0x9c, 0x3,  0x9e, 0x1e,
                                     0x3c, 0xed, 0x74, 0xcd, 0x5e, 0xec, 0x9e, 0x8b, 0x3e};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb3, 0x9e, 0xf2};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7d, 0x3e, 0x5c, 0x40, 0xec, 0x8a, 0x58, 0x40, 0x42, 0x75, 0x3d, 0x50, 0x3e,
                                     0x4a, 0x2,  0x2,  0x46, 0x26, 0x2c, 0x3f, 0x81, 0x27, 0xd5, 0xc3, 0xbd};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5c, 0x57, 0x3d, 0x41, 0xe7, 0x6d, 0xb5, 0xed, 0x76, 0x9a, 0xa0};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfe, 0xea, 0xd2, 0x33, 0x60, 0x42, 0x22, 0x2f, 0xaf, 0xfd, 0x83,
                                     0xf4, 0x40, 0xb0, 0x5d, 0xd3, 0x9f, 0xa3, 0xa0, 0x24, 0xf6};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5686, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24245
// ["\187-s\231\141\DELJq\246","\NAK]%\227\253\FST\142?\253C;\SOH\191\250\223T\RS\DC2\247B\191\193\222\196I\129","\196\132\&8J\197\&8\163\133\229"]
// []
TEST(Unsubscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0xa2, 0x35, 0x5e, 0xb5, 0x0,  0x9,  0xbb, 0x2d, 0x73, 0xe7, 0x8d, 0x7f, 0x4a, 0x71,
                   0xf6, 0x0,  0x1b, 0x15, 0x5d, 0x25, 0xe3, 0xfd, 0x1c, 0x54, 0x8e, 0x3f, 0xfd, 0x43,
                   0x3b, 0x1,  0xbf, 0xfa, 0xdf, 0x54, 0x1e, 0x12, 0xf7, 0x42, 0xbf, 0xc1, 0xde, 0xc4,
                   0x49, 0x81, 0x0,  0x9,  0xc4, 0x84, 0x38, 0x4a, 0xc5, 0x38, 0xa3, 0x85, 0xe5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xbb, 0x2d, 0x73, 0xe7, 0x8d, 0x7f, 0x4a, 0x71, 0xf6};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x15, 0x5d, 0x25, 0xe3, 0xfd, 0x1c, 0x54, 0x8e, 0x3f, 0xfd, 0x43, 0x3b, 0x1, 0xbf,
                                     0xfa, 0xdf, 0x54, 0x1e, 0x12, 0xf7, 0x42, 0xbf, 0xc1, 0xde, 0xc4, 0x49, 0x81};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc4, 0x84, 0x38, 0x4a, 0xc5, 0x38, 0xa3, 0x85, 0xe5};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24245, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 25032 ["\SYN;\174\NAK\140_\188\"[\SOH3z~7\194\136\&7\218\&2\SYN<\156w","V\219\229e\199
// ","W\238\187\GS\SUB\132\133w\251\149h\178\201\DC3\204\209\201\SYN","}=\204\166\208\175.\200\192\SYNb\177","!\174\SO\173\137~:\238\166u\EOT\165\184r4\185l\201\128\190\&0f\156","\149:.\217?\"ev=\v;\158\129d\244\ACKxH{\DC4\245","J"]
// []
TEST(Unsubscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0xa2, 0x78, 0x61, 0xc8, 0x0,  0x17, 0x16, 0x3b, 0xae, 0x15, 0x8c, 0x5f, 0xbc, 0x22, 0x5b, 0x1,
                   0x33, 0x7a, 0x7e, 0x37, 0xc2, 0x88, 0x37, 0xda, 0x32, 0x16, 0x3c, 0x9c, 0x77, 0x0,  0x6,  0x56,
                   0xdb, 0xe5, 0x65, 0xc7, 0x20, 0x0,  0x12, 0x57, 0xee, 0xbb, 0x1d, 0x1a, 0x84, 0x85, 0x77, 0xfb,
                   0x95, 0x68, 0xb2, 0xc9, 0x13, 0xcc, 0xd1, 0xc9, 0x16, 0x0,  0xc,  0x7d, 0x3d, 0xcc, 0xa6, 0xd0,
                   0xaf, 0x2e, 0xc8, 0xc0, 0x16, 0x62, 0xb1, 0x0,  0x17, 0x21, 0xae, 0xe,  0xad, 0x89, 0x7e, 0x3a,
                   0xee, 0xa6, 0x75, 0x4,  0xa5, 0xb8, 0x72, 0x34, 0xb9, 0x6c, 0xc9, 0x80, 0xbe, 0x30, 0x66, 0x9c,
                   0x0,  0x15, 0x95, 0x3a, 0x2e, 0xd9, 0x3f, 0x22, 0x65, 0x76, 0x3d, 0xb,  0x3b, 0x9e, 0x81, 0x64,
                   0xf4, 0x6,  0x78, 0x48, 0x7b, 0x14, 0xf5, 0x0,  0x1,  0x4a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x16, 0x3b, 0xae, 0x15, 0x8c, 0x5f, 0xbc, 0x22, 0x5b, 0x1,  0x33, 0x7a,
                                     0x7e, 0x37, 0xc2, 0x88, 0x37, 0xda, 0x32, 0x16, 0x3c, 0x9c, 0x77};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x56, 0xdb, 0xe5, 0x65, 0xc7, 0x20};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x57, 0xee, 0xbb, 0x1d, 0x1a, 0x84, 0x85, 0x77, 0xfb,
                                     0x95, 0x68, 0xb2, 0xc9, 0x13, 0xcc, 0xd1, 0xc9, 0x16};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x7d, 0x3d, 0xcc, 0xa6, 0xd0, 0xaf, 0x2e, 0xc8, 0xc0, 0x16, 0x62, 0xb1};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x21, 0xae, 0xe,  0xad, 0x89, 0x7e, 0x3a, 0xee, 0xa6, 0x75, 0x4, 0xa5,
                                     0xb8, 0x72, 0x34, 0xb9, 0x6c, 0xc9, 0x80, 0xbe, 0x30, 0x66, 0x9c};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x95, 0x3a, 0x2e, 0xd9, 0x3f, 0x22, 0x65, 0x76, 0x3d, 0xb, 0x3b,
                                     0x9e, 0x81, 0x64, 0xf4, 0x6,  0x78, 0x48, 0x7b, 0x14, 0xf5};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4a};
  lwmqtt_string_t topic_filter_s6 = {1, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25032, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 9981 ["\234","\236\168cp","~","\224\178\190\NAK\250][\147CG\225f\248\DC3\243\"\t\""] []
TEST(Unsubscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0xa2, 0x22, 0x26, 0xfd, 0x0,  0x1,  0xea, 0x0,  0x4,  0xec, 0xa8, 0x63,
                   0x70, 0x0,  0x1,  0x7e, 0x0,  0x12, 0xe0, 0xb2, 0xbe, 0x15, 0xfa, 0x5d,
                   0x5b, 0x93, 0x43, 0x47, 0xe1, 0x66, 0xf8, 0x13, 0xf3, 0x22, 0x9,  0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xea};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xec, 0xa8, 0x63, 0x70};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7e};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe0, 0xb2, 0xbe, 0x15, 0xfa, 0x5d, 0x5b, 0x93, 0x43,
                                     0x47, 0xe1, 0x66, 0xf8, 0x13, 0xf3, 0x22, 0x9,  0x22};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9981, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 12131 [";\204\192\156\203","\131\141H4\GSjh\223\t{hE[\134\CAN\142"] []
TEST(Unsubscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0xa2, 0x1b, 0x2f, 0x63, 0x0,  0x5,  0x3b, 0xcc, 0xc0, 0x9c, 0xcb, 0x0,  0x10, 0x83, 0x8d,
                   0x48, 0x34, 0x1d, 0x6a, 0x68, 0xdf, 0x9,  0x7b, 0x68, 0x45, 0x5b, 0x86, 0x18, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0xcc, 0xc0, 0x9c, 0xcb};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x83, 0x8d, 0x48, 0x34, 0x1d, 0x6a, 0x68, 0xdf,
                                     0x9,  0x7b, 0x68, 0x45, 0x5b, 0x86, 0x18, 0x8e};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12131, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 2785
// ["\208\203\198\224\198v\210\132\218\207\b","\DC4g\193CEY\226\133{\205;","\129E\167\RSx\161\SI\218\ENQ\196\149\136\243\170j\166\208\132m\DEL","lI\225V\SYN&\228E\191\236\171\EM\199eL\DLE-\191\155\223\&5\193\b","\154\ENQp\158
// dj\212\228\243\245\179\ESC\140\SI\ACK\193\215\a\FSR\DLE","\236\152b\183\203\239\189:A\241\200\CAN\207\221i","\198By$\ACK","\147\f\237\210\b\144w}\129d","\176\231\145U\138\241\252\185\178\238\136oQ\ENQ\187\168\228\197","*\210\FS\252"]
// []
TEST(Unsubscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0xa2, 0xa1, 0x1,  0xa,  0xe1, 0x0,  0xb,  0xd0, 0xcb, 0xc6, 0xe0, 0xc6, 0x76, 0xd2, 0x84, 0xda, 0xcf,
                   0x8,  0x0,  0xb,  0x14, 0x67, 0xc1, 0x43, 0x45, 0x59, 0xe2, 0x85, 0x7b, 0xcd, 0x3b, 0x0,  0x14, 0x81,
                   0x45, 0xa7, 0x1e, 0x78, 0xa1, 0xf,  0xda, 0x5,  0xc4, 0x95, 0x88, 0xf3, 0xaa, 0x6a, 0xa6, 0xd0, 0x84,
                   0x6d, 0x7f, 0x0,  0x17, 0x6c, 0x49, 0xe1, 0x56, 0x16, 0x26, 0xe4, 0x45, 0xbf, 0xec, 0xab, 0x19, 0xc7,
                   0x65, 0x4c, 0x10, 0x2d, 0xbf, 0x9b, 0xdf, 0x35, 0xc1, 0x8,  0x0,  0x16, 0x9a, 0x5,  0x70, 0x9e, 0x20,
                   0x64, 0x6a, 0xd4, 0xe4, 0xf3, 0xf5, 0xb3, 0x1b, 0x8c, 0xf,  0x6,  0xc1, 0xd7, 0x7,  0x1c, 0x52, 0x10,
                   0x0,  0xf,  0xec, 0x98, 0x62, 0xb7, 0xcb, 0xef, 0xbd, 0x3a, 0x41, 0xf1, 0xc8, 0x18, 0xcf, 0xdd, 0x69,
                   0x0,  0x5,  0xc6, 0x42, 0x79, 0x24, 0x6,  0x0,  0xa,  0x93, 0xc,  0xed, 0xd2, 0x8,  0x90, 0x77, 0x7d,
                   0x81, 0x64, 0x0,  0x12, 0xb0, 0xe7, 0x91, 0x55, 0x8a, 0xf1, 0xfc, 0xb9, 0xb2, 0xee, 0x88, 0x6f, 0x51,
                   0x5,  0xbb, 0xa8, 0xe4, 0xc5, 0x0,  0x4,  0x2a, 0xd2, 0x1c, 0xfc};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd0, 0xcb, 0xc6, 0xe0, 0xc6, 0x76, 0xd2, 0x84, 0xda, 0xcf, 0x8};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x14, 0x67, 0xc1, 0x43, 0x45, 0x59, 0xe2, 0x85, 0x7b, 0xcd, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x81, 0x45, 0xa7, 0x1e, 0x78, 0xa1, 0xf,  0xda, 0x5,  0xc4,
                                     0x95, 0x88, 0xf3, 0xaa, 0x6a, 0xa6, 0xd0, 0x84, 0x6d, 0x7f};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6c, 0x49, 0xe1, 0x56, 0x16, 0x26, 0xe4, 0x45, 0xbf, 0xec, 0xab, 0x19,
                                     0xc7, 0x65, 0x4c, 0x10, 0x2d, 0xbf, 0x9b, 0xdf, 0x35, 0xc1, 0x8};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9a, 0x5,  0x70, 0x9e, 0x20, 0x64, 0x6a, 0xd4, 0xe4, 0xf3, 0xf5,
                                     0xb3, 0x1b, 0x8c, 0xf,  0x6,  0xc1, 0xd7, 0x7,  0x1c, 0x52, 0x10};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xec, 0x98, 0x62, 0xb7, 0xcb, 0xef, 0xbd, 0x3a,
                                     0x41, 0xf1, 0xc8, 0x18, 0xcf, 0xdd, 0x69};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc6, 0x42, 0x79, 0x24, 0x6};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x93, 0xc, 0xed, 0xd2, 0x8, 0x90, 0x77, 0x7d, 0x81, 0x64};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xb0, 0xe7, 0x91, 0x55, 0x8a, 0xf1, 0xfc, 0xb9, 0xb2,
                                     0xee, 0x88, 0x6f, 0x51, 0x5,  0xbb, 0xa8, 0xe4, 0xc5};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2a, 0xd2, 0x1c, 0xfc};
  lwmqtt_string_t topic_filter_s9 = {4, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2785, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 3283
// ["\151","\140k\206\231T4\165\221\&7\206\161\&9\DC2z9\GS\146\232`AuR/&\215\192\226\253","\243?\170\SYNAk\239?W\173","\143l\157\212\165\140<-\"\250\185\166\SOHpBD\213\&5Y3\178\150\186\n\187\194%","\r\250\DLE<g\149\224\159\159\152\211i\135\163\142&\165\219\EM:\SI\DLE6[\187q!$","\ETXS\251\129\133,\183\186>'?\210\182\153\215\198\173\206k\201Vo\185\236\229\229","\176\171\220\205\STX>\227\CAN\239\167OEZ0s\170\DC2\165B\132r\134?\170L\216\246\162\"\136","\208^\167Dh\248\177\171~k\f\134U8
// \216\198\252\130\US\DEL*Mq)\186","\164[\150\159l\245a\169W]\ENQ=D\230\143\235\193\215\183:\217\244\EOT\236\CAN\221)\210","\191X\198\252\128?S\147\r>O\b\SUB\215L\222\239\201\157dEh\236\DC2\214'\186\243\\\161"]
// []
TEST(Unsubscribe311QCTest, Encode26) {
  uint8_t pkt[] = {
      0xa2, 0x80, 0x2,  0xc,  0xd3, 0x0,  0x1,  0x97, 0x0,  0x1c, 0x8c, 0x6b, 0xce, 0xe7, 0x54, 0x34, 0xa5, 0xdd, 0x37,
      0xce, 0xa1, 0x39, 0x12, 0x7a, 0x39, 0x1d, 0x92, 0xe8, 0x60, 0x41, 0x75, 0x52, 0x2f, 0x26, 0xd7, 0xc0, 0xe2, 0xfd,
      0x0,  0xa,  0xf3, 0x3f, 0xaa, 0x16, 0x41, 0x6b, 0xef, 0x3f, 0x57, 0xad, 0x0,  0x1b, 0x8f, 0x6c, 0x9d, 0xd4, 0xa5,
      0x8c, 0x3c, 0x2d, 0x22, 0xfa, 0xb9, 0xa6, 0x1,  0x70, 0x42, 0x44, 0xd5, 0x35, 0x59, 0x33, 0xb2, 0x96, 0xba, 0xa,
      0xbb, 0xc2, 0x25, 0x0,  0x1c, 0xd,  0xfa, 0x10, 0x3c, 0x67, 0x95, 0xe0, 0x9f, 0x9f, 0x98, 0xd3, 0x69, 0x87, 0xa3,
      0x8e, 0x26, 0xa5, 0xdb, 0x19, 0x3a, 0xf,  0x10, 0x36, 0x5b, 0xbb, 0x71, 0x21, 0x24, 0x0,  0x1a, 0x3,  0x53, 0xfb,
      0x81, 0x85, 0x2c, 0xb7, 0xba, 0x3e, 0x27, 0x3f, 0xd2, 0xb6, 0x99, 0xd7, 0xc6, 0xad, 0xce, 0x6b, 0xc9, 0x56, 0x6f,
      0xb9, 0xec, 0xe5, 0xe5, 0x0,  0x1e, 0xb0, 0xab, 0xdc, 0xcd, 0x2,  0x3e, 0xe3, 0x18, 0xef, 0xa7, 0x4f, 0x45, 0x5a,
      0x30, 0x73, 0xaa, 0x12, 0xa5, 0x42, 0x84, 0x72, 0x86, 0x3f, 0xaa, 0x4c, 0xd8, 0xf6, 0xa2, 0x22, 0x88, 0x0,  0x1a,
      0xd0, 0x5e, 0xa7, 0x44, 0x68, 0xf8, 0xb1, 0xab, 0x7e, 0x6b, 0xc,  0x86, 0x55, 0x38, 0x20, 0xd8, 0xc6, 0xfc, 0x82,
      0x1f, 0x7f, 0x2a, 0x4d, 0x71, 0x29, 0xba, 0x0,  0x1c, 0xa4, 0x5b, 0x96, 0x9f, 0x6c, 0xf5, 0x61, 0xa9, 0x57, 0x5d,
      0x5,  0x3d, 0x44, 0xe6, 0x8f, 0xeb, 0xc1, 0xd7, 0xb7, 0x3a, 0xd9, 0xf4, 0x4,  0xec, 0x18, 0xdd, 0x29, 0xd2, 0x0,
      0x1e, 0xbf, 0x58, 0xc6, 0xfc, 0x80, 0x3f, 0x53, 0x93, 0xd,  0x3e, 0x4f, 0x8,  0x1a, 0xd7, 0x4c, 0xde, 0xef, 0xc9,
      0x9d, 0x64, 0x45, 0x68, 0xec, 0x12, 0xd6, 0x27, 0xba, 0xf3, 0x5c, 0xa1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x97};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8c, 0x6b, 0xce, 0xe7, 0x54, 0x34, 0xa5, 0xdd, 0x37, 0xce,
                                     0xa1, 0x39, 0x12, 0x7a, 0x39, 0x1d, 0x92, 0xe8, 0x60, 0x41,
                                     0x75, 0x52, 0x2f, 0x26, 0xd7, 0xc0, 0xe2, 0xfd};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf3, 0x3f, 0xaa, 0x16, 0x41, 0x6b, 0xef, 0x3f, 0x57, 0xad};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8f, 0x6c, 0x9d, 0xd4, 0xa5, 0x8c, 0x3c, 0x2d, 0x22, 0xfa, 0xb9, 0xa6, 0x1, 0x70,
                                     0x42, 0x44, 0xd5, 0x35, 0x59, 0x33, 0xb2, 0x96, 0xba, 0xa,  0xbb, 0xc2, 0x25};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd,  0xfa, 0x10, 0x3c, 0x67, 0x95, 0xe0, 0x9f, 0x9f, 0x98,
                                     0xd3, 0x69, 0x87, 0xa3, 0x8e, 0x26, 0xa5, 0xdb, 0x19, 0x3a,
                                     0xf,  0x10, 0x36, 0x5b, 0xbb, 0x71, 0x21, 0x24};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3,  0x53, 0xfb, 0x81, 0x85, 0x2c, 0xb7, 0xba, 0x3e, 0x27, 0x3f, 0xd2, 0xb6,
                                     0x99, 0xd7, 0xc6, 0xad, 0xce, 0x6b, 0xc9, 0x56, 0x6f, 0xb9, 0xec, 0xe5, 0xe5};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb0, 0xab, 0xdc, 0xcd, 0x2,  0x3e, 0xe3, 0x18, 0xef, 0xa7,
                                     0x4f, 0x45, 0x5a, 0x30, 0x73, 0xaa, 0x12, 0xa5, 0x42, 0x84,
                                     0x72, 0x86, 0x3f, 0xaa, 0x4c, 0xd8, 0xf6, 0xa2, 0x22, 0x88};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd0, 0x5e, 0xa7, 0x44, 0x68, 0xf8, 0xb1, 0xab, 0x7e, 0x6b, 0xc,  0x86, 0x55,
                                     0x38, 0x20, 0xd8, 0xc6, 0xfc, 0x82, 0x1f, 0x7f, 0x2a, 0x4d, 0x71, 0x29, 0xba};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa4, 0x5b, 0x96, 0x9f, 0x6c, 0xf5, 0x61, 0xa9, 0x57, 0x5d,
                                     0x5,  0x3d, 0x44, 0xe6, 0x8f, 0xeb, 0xc1, 0xd7, 0xb7, 0x3a,
                                     0xd9, 0xf4, 0x4,  0xec, 0x18, 0xdd, 0x29, 0xd2};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xbf, 0x58, 0xc6, 0xfc, 0x80, 0x3f, 0x53, 0x93, 0xd,  0x3e,
                                     0x4f, 0x8,  0x1a, 0xd7, 0x4c, 0xde, 0xef, 0xc9, 0x9d, 0x64,
                                     0x45, 0x68, 0xec, 0x12, 0xd6, 0x27, 0xba, 0xf3, 0x5c, 0xa1};
  lwmqtt_string_t topic_filter_s9 = {30, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3283, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22892
// ["\235\157\254\138\f\159\160H\226\159\167\206[L\221\133p\185;","/\162\192\a\217\171[\233\178\227GTN~\SOHzIl\DC3G\195C(FH\241=He\251","n\212\225g\136\SYNK\222\238\207\137","","\ETB7!\RSO\252\EM4B\253\DEL\USs}\246e\192\201\135\DC1\174","\183~\216m","\174K\216\SUB\179
// \EMB\EMpq\EMl"] []
TEST(Unsubscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0xa2, 0x72, 0x59, 0x6c, 0x0,  0x13, 0xeb, 0x9d, 0xfe, 0x8a, 0xc,  0x9f, 0xa0, 0x48, 0xe2, 0x9f, 0xa7,
                   0xce, 0x5b, 0x4c, 0xdd, 0x85, 0x70, 0xb9, 0x3b, 0x0,  0x1e, 0x2f, 0xa2, 0xc0, 0x7,  0xd9, 0xab, 0x5b,
                   0xe9, 0xb2, 0xe3, 0x47, 0x54, 0x4e, 0x7e, 0x1,  0x7a, 0x49, 0x6c, 0x13, 0x47, 0xc3, 0x43, 0x28, 0x46,
                   0x48, 0xf1, 0x3d, 0x48, 0x65, 0xfb, 0x0,  0xb,  0x6e, 0xd4, 0xe1, 0x67, 0x88, 0x16, 0x4b, 0xde, 0xee,
                   0xcf, 0x89, 0x0,  0x0,  0x0,  0x15, 0x17, 0x37, 0x21, 0x1e, 0x4f, 0xfc, 0x19, 0x34, 0x42, 0xfd, 0x7f,
                   0x1f, 0x73, 0x7d, 0xf6, 0x65, 0xc0, 0xc9, 0x87, 0x11, 0xae, 0x0,  0x4,  0xb7, 0x7e, 0xd8, 0x6d, 0x0,
                   0xd,  0xae, 0x4b, 0xd8, 0x1a, 0xb3, 0x20, 0x19, 0x42, 0x19, 0x70, 0x71, 0x19, 0x6c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xeb, 0x9d, 0xfe, 0x8a, 0xc,  0x9f, 0xa0, 0x48, 0xe2, 0x9f,
                                     0xa7, 0xce, 0x5b, 0x4c, 0xdd, 0x85, 0x70, 0xb9, 0x3b};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2f, 0xa2, 0xc0, 0x7,  0xd9, 0xab, 0x5b, 0xe9, 0xb2, 0xe3,
                                     0x47, 0x54, 0x4e, 0x7e, 0x1,  0x7a, 0x49, 0x6c, 0x13, 0x47,
                                     0xc3, 0x43, 0x28, 0x46, 0x48, 0xf1, 0x3d, 0x48, 0x65, 0xfb};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6e, 0xd4, 0xe1, 0x67, 0x88, 0x16, 0x4b, 0xde, 0xee, 0xcf, 0x89};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x17, 0x37, 0x21, 0x1e, 0x4f, 0xfc, 0x19, 0x34, 0x42, 0xfd, 0x7f,
                                     0x1f, 0x73, 0x7d, 0xf6, 0x65, 0xc0, 0xc9, 0x87, 0x11, 0xae};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb7, 0x7e, 0xd8, 0x6d};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xae, 0x4b, 0xd8, 0x1a, 0xb3, 0x20, 0x19, 0x42, 0x19, 0x70, 0x71, 0x19, 0x6c};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22892, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 19885
// ["1PI\t\197=\237\156\210+\211\143\197F\237j\226K\DC1\ETB\231\195\ACK\162\148\247_\252\173","\t)\128a\GS\181\NUL\197\183{\205;m\230\199\US|l\166i\215'\180\129\184\186","\246D|d\241G\232+$\163\NAKm","\165","\r\189\ACK\138&\129\225V\220\215X\ESC\DLE<\192\150s\207","U\214xL\223\215.ob5\166\173wr\209\&1\167\&9\rJ\145\DC4\255","\DC3\215c\169\153\250\207@\186\242\r\"\183\129Q\RS\ETBbEj\160","L-\181*\192\&1}"]
// []
TEST(Unsubscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0xa2, 0x9b, 0x1,  0x4d, 0xad, 0x0,  0x1d, 0x31, 0x50, 0x49, 0x9,  0xc5, 0x3d, 0xed, 0x9c, 0xd2,
                   0x2b, 0xd3, 0x8f, 0xc5, 0x46, 0xed, 0x6a, 0xe2, 0x4b, 0x11, 0x17, 0xe7, 0xc3, 0x6,  0xa2, 0x94,
                   0xf7, 0x5f, 0xfc, 0xad, 0x0,  0x1a, 0x9,  0x29, 0x80, 0x61, 0x1d, 0xb5, 0x0,  0xc5, 0xb7, 0x7b,
                   0xcd, 0x3b, 0x6d, 0xe6, 0xc7, 0x1f, 0x7c, 0x6c, 0xa6, 0x69, 0xd7, 0x27, 0xb4, 0x81, 0xb8, 0xba,
                   0x0,  0xc,  0xf6, 0x44, 0x7c, 0x64, 0xf1, 0x47, 0xe8, 0x2b, 0x24, 0xa3, 0x15, 0x6d, 0x0,  0x1,
                   0xa5, 0x0,  0x12, 0xd,  0xbd, 0x6,  0x8a, 0x26, 0x81, 0xe1, 0x56, 0xdc, 0xd7, 0x58, 0x1b, 0x10,
                   0x3c, 0xc0, 0x96, 0x73, 0xcf, 0x0,  0x17, 0x55, 0xd6, 0x78, 0x4c, 0xdf, 0xd7, 0x2e, 0x6f, 0x62,
                   0x35, 0xa6, 0xad, 0x77, 0x72, 0xd1, 0x31, 0xa7, 0x39, 0xd,  0x4a, 0x91, 0x14, 0xff, 0x0,  0x15,
                   0x13, 0xd7, 0x63, 0xa9, 0x99, 0xfa, 0xcf, 0x40, 0xba, 0xf2, 0xd,  0x22, 0xb7, 0x81, 0x51, 0x1e,
                   0x17, 0x62, 0x45, 0x6a, 0xa0, 0x0,  0x7,  0x4c, 0x2d, 0xb5, 0x2a, 0xc0, 0x31, 0x7d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x31, 0x50, 0x49, 0x9,  0xc5, 0x3d, 0xed, 0x9c, 0xd2, 0x2b,
                                     0xd3, 0x8f, 0xc5, 0x46, 0xed, 0x6a, 0xe2, 0x4b, 0x11, 0x17,
                                     0xe7, 0xc3, 0x6,  0xa2, 0x94, 0xf7, 0x5f, 0xfc, 0xad};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9,  0x29, 0x80, 0x61, 0x1d, 0xb5, 0x0,  0xc5, 0xb7, 0x7b, 0xcd, 0x3b, 0x6d,
                                     0xe6, 0xc7, 0x1f, 0x7c, 0x6c, 0xa6, 0x69, 0xd7, 0x27, 0xb4, 0x81, 0xb8, 0xba};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf6, 0x44, 0x7c, 0x64, 0xf1, 0x47, 0xe8, 0x2b, 0x24, 0xa3, 0x15, 0x6d};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa5};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd,  0xbd, 0x6,  0x8a, 0x26, 0x81, 0xe1, 0x56, 0xdc,
                                     0xd7, 0x58, 0x1b, 0x10, 0x3c, 0xc0, 0x96, 0x73, 0xcf};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x55, 0xd6, 0x78, 0x4c, 0xdf, 0xd7, 0x2e, 0x6f, 0x62, 0x35, 0xa6, 0xad,
                                     0x77, 0x72, 0xd1, 0x31, 0xa7, 0x39, 0xd,  0x4a, 0x91, 0x14, 0xff};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x13, 0xd7, 0x63, 0xa9, 0x99, 0xfa, 0xcf, 0x40, 0xba, 0xf2, 0xd,
                                     0x22, 0xb7, 0x81, 0x51, 0x1e, 0x17, 0x62, 0x45, 0x6a, 0xa0};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x4c, 0x2d, 0xb5, 0x2a, 0xc0, 0x31, 0x7d};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19885, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27189
// ["\150\235'\154\141\134|\222\223]bA\223\139E\175+\178\158\176FT\218\DC4","\128\213\212b\169;\241\208\"!\167","\162\SO\SYN\164P(\US\SIR{\147\253k\235G\169;ZQ\NULH\DC3\DELP\SOH\222","F\229\157\217\ACK\155\rz\245\&8/\173G5\177\244S-8\150\198\194\&3\222)\209\STX","\191\143\241\237\222\157\191\187\142M}\207LC|\146","8\ENQ\229\241|Z^","*g\f\244dM\235\193*\177\&9\149\133\161","\168/\EOT\222\a^z\187\139\135","\167\206\130\&1\168\ETBH\200\241\221C\235\134Z9J\193\215v\237\131\197"]
// []
TEST(Unsubscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0xa2, 0xb1, 0x1,  0x6a, 0x35, 0x0,  0x18, 0x96, 0xeb, 0x27, 0x9a, 0x8d, 0x86, 0x7c, 0xde, 0xdf, 0x5d,
                   0x62, 0x41, 0xdf, 0x8b, 0x45, 0xaf, 0x2b, 0xb2, 0x9e, 0xb0, 0x46, 0x54, 0xda, 0x14, 0x0,  0xb,  0x80,
                   0xd5, 0xd4, 0x62, 0xa9, 0x3b, 0xf1, 0xd0, 0x22, 0x21, 0xa7, 0x0,  0x1a, 0xa2, 0xe,  0x16, 0xa4, 0x50,
                   0x28, 0x1f, 0xf,  0x52, 0x7b, 0x93, 0xfd, 0x6b, 0xeb, 0x47, 0xa9, 0x3b, 0x5a, 0x51, 0x0,  0x48, 0x13,
                   0x7f, 0x50, 0x1,  0xde, 0x0,  0x1b, 0x46, 0xe5, 0x9d, 0xd9, 0x6,  0x9b, 0xd,  0x7a, 0xf5, 0x38, 0x2f,
                   0xad, 0x47, 0x35, 0xb1, 0xf4, 0x53, 0x2d, 0x38, 0x96, 0xc6, 0xc2, 0x33, 0xde, 0x29, 0xd1, 0x2,  0x0,
                   0x10, 0xbf, 0x8f, 0xf1, 0xed, 0xde, 0x9d, 0xbf, 0xbb, 0x8e, 0x4d, 0x7d, 0xcf, 0x4c, 0x43, 0x7c, 0x92,
                   0x0,  0x7,  0x38, 0x5,  0xe5, 0xf1, 0x7c, 0x5a, 0x5e, 0x0,  0xe,  0x2a, 0x67, 0xc,  0xf4, 0x64, 0x4d,
                   0xeb, 0xc1, 0x2a, 0xb1, 0x39, 0x95, 0x85, 0xa1, 0x0,  0xa,  0xa8, 0x2f, 0x4,  0xde, 0x7,  0x5e, 0x7a,
                   0xbb, 0x8b, 0x87, 0x0,  0x16, 0xa7, 0xce, 0x82, 0x31, 0xa8, 0x17, 0x48, 0xc8, 0xf1, 0xdd, 0x43, 0xeb,
                   0x86, 0x5a, 0x39, 0x4a, 0xc1, 0xd7, 0x76, 0xed, 0x83, 0xc5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x96, 0xeb, 0x27, 0x9a, 0x8d, 0x86, 0x7c, 0xde, 0xdf, 0x5d, 0x62, 0x41,
                                     0xdf, 0x8b, 0x45, 0xaf, 0x2b, 0xb2, 0x9e, 0xb0, 0x46, 0x54, 0xda, 0x14};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x80, 0xd5, 0xd4, 0x62, 0xa9, 0x3b, 0xf1, 0xd0, 0x22, 0x21, 0xa7};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa2, 0xe,  0x16, 0xa4, 0x50, 0x28, 0x1f, 0xf,  0x52, 0x7b, 0x93, 0xfd, 0x6b,
                                     0xeb, 0x47, 0xa9, 0x3b, 0x5a, 0x51, 0x0,  0x48, 0x13, 0x7f, 0x50, 0x1,  0xde};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x46, 0xe5, 0x9d, 0xd9, 0x6,  0x9b, 0xd,  0x7a, 0xf5, 0x38, 0x2f, 0xad, 0x47, 0x35,
                                     0xb1, 0xf4, 0x53, 0x2d, 0x38, 0x96, 0xc6, 0xc2, 0x33, 0xde, 0x29, 0xd1, 0x2};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbf, 0x8f, 0xf1, 0xed, 0xde, 0x9d, 0xbf, 0xbb,
                                     0x8e, 0x4d, 0x7d, 0xcf, 0x4c, 0x43, 0x7c, 0x92};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x38, 0x5, 0xe5, 0xf1, 0x7c, 0x5a, 0x5e};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2a, 0x67, 0xc, 0xf4, 0x64, 0x4d, 0xeb, 0xc1, 0x2a, 0xb1, 0x39, 0x95, 0x85, 0xa1};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa8, 0x2f, 0x4, 0xde, 0x7, 0x5e, 0x7a, 0xbb, 0x8b, 0x87};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa7, 0xce, 0x82, 0x31, 0xa8, 0x17, 0x48, 0xc8, 0xf1, 0xdd, 0x43,
                                     0xeb, 0x86, 0x5a, 0x39, 0x4a, 0xc1, 0xd7, 0x76, 0xed, 0x83, 0xc5};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27189, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 10641
// ["\195Sa\217\ACK\194\232\166\EOT\a\175\198\164\196r\252M<T|\247|\225\ETBu,Y\DC4\182","\244u\140Q\229Ui\247[N\237kXd\172\182\252\136\216\203","-\232G\196\STX\177\161\185","\STX\171|5\142\131\236\&1\DC3\156,\197~2_Jn\187\240K\RS\179@\195\152\226\STX","\207\243\239\186\&7Fc\171\181CA\200\225\t\165\239\157","\179_\171\214\245\216\DC1\174\254,\172\SUB\DC2\173\172\SYN","S\142\SUBo6!\247\a\130Mt\223.'\139\219\228\232\211\214\208"]
// []
TEST(Unsubscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0xa2, 0x9a, 0x1,  0x29, 0x91, 0x0,  0x1d, 0xc3, 0x53, 0x61, 0xd9, 0x6,  0xc2, 0xe8, 0xa6, 0x4,
                   0x7,  0xaf, 0xc6, 0xa4, 0xc4, 0x72, 0xfc, 0x4d, 0x3c, 0x54, 0x7c, 0xf7, 0x7c, 0xe1, 0x17, 0x75,
                   0x2c, 0x59, 0x14, 0xb6, 0x0,  0x14, 0xf4, 0x75, 0x8c, 0x51, 0xe5, 0x55, 0x69, 0xf7, 0x5b, 0x4e,
                   0xed, 0x6b, 0x58, 0x64, 0xac, 0xb6, 0xfc, 0x88, 0xd8, 0xcb, 0x0,  0x8,  0x2d, 0xe8, 0x47, 0xc4,
                   0x2,  0xb1, 0xa1, 0xb9, 0x0,  0x1b, 0x2,  0xab, 0x7c, 0x35, 0x8e, 0x83, 0xec, 0x31, 0x13, 0x9c,
                   0x2c, 0xc5, 0x7e, 0x32, 0x5f, 0x4a, 0x6e, 0xbb, 0xf0, 0x4b, 0x1e, 0xb3, 0x40, 0xc3, 0x98, 0xe2,
                   0x2,  0x0,  0x11, 0xcf, 0xf3, 0xef, 0xba, 0x37, 0x46, 0x63, 0xab, 0xb5, 0x43, 0x41, 0xc8, 0xe1,
                   0x9,  0xa5, 0xef, 0x9d, 0x0,  0x10, 0xb3, 0x5f, 0xab, 0xd6, 0xf5, 0xd8, 0x11, 0xae, 0xfe, 0x2c,
                   0xac, 0x1a, 0x12, 0xad, 0xac, 0x16, 0x0,  0x15, 0x53, 0x8e, 0x1a, 0x6f, 0x36, 0x21, 0xf7, 0x7,
                   0x82, 0x4d, 0x74, 0xdf, 0x2e, 0x27, 0x8b, 0xdb, 0xe4, 0xe8, 0xd3, 0xd6, 0xd0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xc3, 0x53, 0x61, 0xd9, 0x6,  0xc2, 0xe8, 0xa6, 0x4,  0x7,
                                     0xaf, 0xc6, 0xa4, 0xc4, 0x72, 0xfc, 0x4d, 0x3c, 0x54, 0x7c,
                                     0xf7, 0x7c, 0xe1, 0x17, 0x75, 0x2c, 0x59, 0x14, 0xb6};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf4, 0x75, 0x8c, 0x51, 0xe5, 0x55, 0x69, 0xf7, 0x5b, 0x4e,
                                     0xed, 0x6b, 0x58, 0x64, 0xac, 0xb6, 0xfc, 0x88, 0xd8, 0xcb};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2d, 0xe8, 0x47, 0xc4, 0x2, 0xb1, 0xa1, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2,  0xab, 0x7c, 0x35, 0x8e, 0x83, 0xec, 0x31, 0x13, 0x9c, 0x2c, 0xc5, 0x7e, 0x32,
                                     0x5f, 0x4a, 0x6e, 0xbb, 0xf0, 0x4b, 0x1e, 0xb3, 0x40, 0xc3, 0x98, 0xe2, 0x2};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xcf, 0xf3, 0xef, 0xba, 0x37, 0x46, 0x63, 0xab, 0xb5,
                                     0x43, 0x41, 0xc8, 0xe1, 0x9,  0xa5, 0xef, 0x9d};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb3, 0x5f, 0xab, 0xd6, 0xf5, 0xd8, 0x11, 0xae,
                                     0xfe, 0x2c, 0xac, 0x1a, 0x12, 0xad, 0xac, 0x16};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x53, 0x8e, 0x1a, 0x6f, 0x36, 0x21, 0xf7, 0x7,  0x82, 0x4d, 0x74,
                                     0xdf, 0x2e, 0x27, 0x8b, 0xdb, 0xe4, 0xe8, 0xd3, 0xd6, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10641, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 21005
// ["\162U\229Q\203:\151\212\213\175Q\163\a\240\194\211\147\&1\196\251\US\142\159>\129\227\142\140","\191\&2\206V\211\208jL\223\162M\237i\241\128\DC1R\160UJ\195\175\194R\213","\213?\174\187\RS\DEL\245
// \199\246\204","6\147z\129\248e\186\239\143\190\200\231\233\244\170(\225[\f\254\202\159-VJ\255Pp!","H\191\171\135\157){d~\181\190","\FSe\146\150\222","\DLE\228\196{\157hG\135~RV^\EOT5","\243\212\198\a\157\193\174\231\196\129N\182\137\243w"]
// [PropServerKeepAlive 13535,PropAuthenticationData "<\192\"U\244<+b\244a\231\234\231\130\\",PropContentType
// "\r\DC1\r=\224\191z/\185\144\133mB\208SC\CAN\196\r",PropSessionExpiryInterval 4234,PropSubscriptionIdentifier
// 31,PropServerKeepAlive 3176,PropMaximumQoS 31,PropResponseTopic
// "\249\GSFA\DLE\173)O\176\129\250\FS\152\196\230oF\227\224\143\164\150",PropTopicAliasMaximum
// 28456,PropResponseInformation
// "<\CAN\176\225\190\209\226\247!\254\218\EM\aVxr\139K\239b\191\147>\198\242",PropAuthenticationData
// "_I*\240\161\192\b\200\216by\191!\133z\222\DC3",PropAssignedClientIdentifier
// "\242\230\SO\142\DEL75(:x0}A\182",PropContentType "[\as$\141\171\166\204\162\176",PropCorrelationData
// "\EOTZ\EOT\151I",PropServerReference "1\EM\248",PropMessageExpiryInterval 32586,PropAuthenticationData
// "xN)\150$\231\157\177R1\171\184\138\216\223\212\134v\251\132",PropMessageExpiryInterval 1627,PropMaximumPacketSize
// 17000,PropAuthenticationMethod "j\199\131\140\249\228\198u\tG)\NUL\187i\176\172^\160\157\185\STX\STX\183\205\155"]
TEST(Unsubscribe5QCTest, Encode1) {
  uint8_t pkt[] = {
      0xa2, 0x8f, 0x3,  0x52, 0xd,  0xf1, 0x1,  0x13, 0x34, 0xdf, 0x16, 0x0,  0xf,  0x3c, 0xc0, 0x22, 0x55, 0xf4, 0x3c,
      0x2b, 0x62, 0xf4, 0x61, 0xe7, 0xea, 0xe7, 0x82, 0x5c, 0x3,  0x0,  0x13, 0xd,  0x11, 0xd,  0x3d, 0xe0, 0xbf, 0x7a,
      0x2f, 0xb9, 0x90, 0x85, 0x6d, 0x42, 0xd0, 0x53, 0x43, 0x18, 0xc4, 0xd,  0x11, 0x0,  0x0,  0x10, 0x8a, 0xb,  0x1f,
      0x13, 0xc,  0x68, 0x24, 0x1f, 0x8,  0x0,  0x16, 0xf9, 0x1d, 0x46, 0x41, 0x10, 0xad, 0x29, 0x4f, 0xb0, 0x81, 0xfa,
      0x1c, 0x98, 0xc4, 0xe6, 0x6f, 0x46, 0xe3, 0xe0, 0x8f, 0xa4, 0x96, 0x22, 0x6f, 0x28, 0x1a, 0x0,  0x19, 0x3c, 0x18,
      0xb0, 0xe1, 0xbe, 0xd1, 0xe2, 0xf7, 0x21, 0xfe, 0xda, 0x19, 0x7,  0x56, 0x78, 0x72, 0x8b, 0x4b, 0xef, 0x62, 0xbf,
      0x93, 0x3e, 0xc6, 0xf2, 0x16, 0x0,  0x11, 0x5f, 0x49, 0x2a, 0xf0, 0xa1, 0xc0, 0x8,  0xc8, 0xd8, 0x62, 0x79, 0xbf,
      0x21, 0x85, 0x7a, 0xde, 0x13, 0x12, 0x0,  0xe,  0xf2, 0xe6, 0xe,  0x8e, 0x7f, 0x37, 0x35, 0x28, 0x3a, 0x78, 0x30,
      0x7d, 0x41, 0xb6, 0x3,  0x0,  0xa,  0x5b, 0x7,  0x73, 0x24, 0x8d, 0xab, 0xa6, 0xcc, 0xa2, 0xb0, 0x9,  0x0,  0x5,
      0x4,  0x5a, 0x4,  0x97, 0x49, 0x1c, 0x0,  0x3,  0x31, 0x19, 0xf8, 0x2,  0x0,  0x0,  0x7f, 0x4a, 0x16, 0x0,  0x14,
      0x78, 0x4e, 0x29, 0x96, 0x24, 0xe7, 0x9d, 0xb1, 0x52, 0x31, 0xab, 0xb8, 0x8a, 0xd8, 0xdf, 0xd4, 0x86, 0x76, 0xfb,
      0x84, 0x2,  0x0,  0x0,  0x6,  0x5b, 0x27, 0x0,  0x0,  0x42, 0x68, 0x15, 0x0,  0x19, 0x6a, 0xc7, 0x83, 0x8c, 0xf9,
      0xe4, 0xc6, 0x75, 0x9,  0x47, 0x29, 0x0,  0xbb, 0x69, 0xb0, 0xac, 0x5e, 0xa0, 0x9d, 0xb9, 0x2,  0x2,  0xb7, 0xcd,
      0x9b, 0x0,  0x1c, 0xa2, 0x55, 0xe5, 0x51, 0xcb, 0x3a, 0x97, 0xd4, 0xd5, 0xaf, 0x51, 0xa3, 0x7,  0xf0, 0xc2, 0xd3,
      0x93, 0x31, 0xc4, 0xfb, 0x1f, 0x8e, 0x9f, 0x3e, 0x81, 0xe3, 0x8e, 0x8c, 0x0,  0x19, 0xbf, 0x32, 0xce, 0x56, 0xd3,
      0xd0, 0x6a, 0x4c, 0xdf, 0xa2, 0x4d, 0xed, 0x69, 0xf1, 0x80, 0x11, 0x52, 0xa0, 0x55, 0x4a, 0xc3, 0xaf, 0xc2, 0x52,
      0xd5, 0x0,  0xb,  0xd5, 0x3f, 0xae, 0xbb, 0x1e, 0x7f, 0xf5, 0x20, 0xc7, 0xf6, 0xcc, 0x0,  0x1d, 0x36, 0x93, 0x7a,
      0x81, 0xf8, 0x65, 0xba, 0xef, 0x8f, 0xbe, 0xc8, 0xe7, 0xe9, 0xf4, 0xaa, 0x28, 0xe1, 0x5b, 0xc,  0xfe, 0xca, 0x9f,
      0x2d, 0x56, 0x4a, 0xff, 0x50, 0x70, 0x21, 0x0,  0xb,  0x48, 0xbf, 0xab, 0x87, 0x9d, 0x29, 0x7b, 0x64, 0x7e, 0xb5,
      0xbe, 0x0,  0x5,  0x1c, 0x65, 0x92, 0x96, 0xde, 0x0,  0xe,  0x10, 0xe4, 0xc4, 0x7b, 0x9d, 0x68, 0x47, 0x87, 0x7e,
      0x52, 0x56, 0x5e, 0x4,  0x35, 0x0,  0xf,  0xf3, 0xd4, 0xc6, 0x7,  0x9d, 0xc1, 0xae, 0xe7, 0xc4, 0x81, 0x4e, 0xb6,
      0x89, 0xf3, 0x77};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3c, 0xc0, 0x22, 0x55, 0xf4, 0x3c, 0x2b, 0x62, 0xf4, 0x61, 0xe7, 0xea, 0xe7, 0x82, 0x5c};
  uint8_t bytesprops1[] = {0xd,  0x11, 0xd,  0x3d, 0xe0, 0xbf, 0x7a, 0x2f, 0xb9, 0x90,
                           0x85, 0x6d, 0x42, 0xd0, 0x53, 0x43, 0x18, 0xc4, 0xd};
  uint8_t bytesprops2[] = {0xf9, 0x1d, 0x46, 0x41, 0x10, 0xad, 0x29, 0x4f, 0xb0, 0x81, 0xfa,
                           0x1c, 0x98, 0xc4, 0xe6, 0x6f, 0x46, 0xe3, 0xe0, 0x8f, 0xa4, 0x96};
  uint8_t bytesprops3[] = {0x3c, 0x18, 0xb0, 0xe1, 0xbe, 0xd1, 0xe2, 0xf7, 0x21, 0xfe, 0xda, 0x19, 0x7,
                           0x56, 0x78, 0x72, 0x8b, 0x4b, 0xef, 0x62, 0xbf, 0x93, 0x3e, 0xc6, 0xf2};
  uint8_t bytesprops4[] = {0x5f, 0x49, 0x2a, 0xf0, 0xa1, 0xc0, 0x8,  0xc8, 0xd8,
                           0x62, 0x79, 0xbf, 0x21, 0x85, 0x7a, 0xde, 0x13};
  uint8_t bytesprops5[] = {0xf2, 0xe6, 0xe, 0x8e, 0x7f, 0x37, 0x35, 0x28, 0x3a, 0x78, 0x30, 0x7d, 0x41, 0xb6};
  uint8_t bytesprops6[] = {0x5b, 0x7, 0x73, 0x24, 0x8d, 0xab, 0xa6, 0xcc, 0xa2, 0xb0};
  uint8_t bytesprops7[] = {0x4, 0x5a, 0x4, 0x97, 0x49};
  uint8_t bytesprops8[] = {0x31, 0x19, 0xf8};
  uint8_t bytesprops9[] = {0x78, 0x4e, 0x29, 0x96, 0x24, 0xe7, 0x9d, 0xb1, 0x52, 0x31,
                           0xab, 0xb8, 0x8a, 0xd8, 0xdf, 0xd4, 0x86, 0x76, 0xfb, 0x84};
  uint8_t bytesprops10[] = {0x6a, 0xc7, 0x83, 0x8c, 0xf9, 0xe4, 0xc6, 0x75, 0x9, 0x47, 0x29, 0x0, 0xbb,
                            0x69, 0xb0, 0xac, 0x5e, 0xa0, 0x9d, 0xb9, 0x2,  0x2, 0xb7, 0xcd, 0x9b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13535}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4234}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 31}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3176}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28456}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32586}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1627}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17000}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xa2, 0x55, 0xe5, 0x51, 0xcb, 0x3a, 0x97, 0xd4, 0xd5, 0xaf,
                                     0x51, 0xa3, 0x7,  0xf0, 0xc2, 0xd3, 0x93, 0x31, 0xc4, 0xfb,
                                     0x1f, 0x8e, 0x9f, 0x3e, 0x81, 0xe3, 0x8e, 0x8c};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbf, 0x32, 0xce, 0x56, 0xd3, 0xd0, 0x6a, 0x4c, 0xdf, 0xa2, 0x4d, 0xed, 0x69,
                                     0xf1, 0x80, 0x11, 0x52, 0xa0, 0x55, 0x4a, 0xc3, 0xaf, 0xc2, 0x52, 0xd5};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd5, 0x3f, 0xae, 0xbb, 0x1e, 0x7f, 0xf5, 0x20, 0xc7, 0xf6, 0xcc};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x36, 0x93, 0x7a, 0x81, 0xf8, 0x65, 0xba, 0xef, 0x8f, 0xbe,
                                     0xc8, 0xe7, 0xe9, 0xf4, 0xaa, 0x28, 0xe1, 0x5b, 0xc,  0xfe,
                                     0xca, 0x9f, 0x2d, 0x56, 0x4a, 0xff, 0x50, 0x70, 0x21};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x48, 0xbf, 0xab, 0x87, 0x9d, 0x29, 0x7b, 0x64, 0x7e, 0xb5, 0xbe};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1c, 0x65, 0x92, 0x96, 0xde};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x10, 0xe4, 0xc4, 0x7b, 0x9d, 0x68, 0x47, 0x87, 0x7e, 0x52, 0x56, 0x5e, 0x4, 0x35};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf3, 0xd4, 0xc6, 0x7,  0x9d, 0xc1, 0xae, 0xe7,
                                     0xc4, 0x81, 0x4e, 0xb6, 0x89, 0xf3, 0x77};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21005, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17284
// ["\219\&6\208\245\251\252\ESC\222\a\175]6\SUB\EM\187\163\135\251R\141\188\250_~#\250\154\253'6","\209\"I\SOW",":/\181!v\193\177A\DC4\ACK\181\218\218*\183\248\233","^}\ETB\204n1\129\156\159\193Y\160\v","\222}^v\153\247\244\185\129\n\220Cy\SUB\ETX","\247\184r"]
// [PropTopicAliasMaximum 19254,PropSubscriptionIdentifierAvailable 208,PropSubscriptionIdentifierAvailable 223]
TEST(Unsubscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0xa2, 0x69, 0x43, 0x84, 0x7,  0x22, 0x4b, 0x36, 0x29, 0xd0, 0x29, 0xdf, 0x0,  0x1e, 0xdb, 0x36,
                   0xd0, 0xf5, 0xfb, 0xfc, 0x1b, 0xde, 0x7,  0xaf, 0x5d, 0x36, 0x1a, 0x19, 0xbb, 0xa3, 0x87, 0xfb,
                   0x52, 0x8d, 0xbc, 0xfa, 0x5f, 0x7e, 0x23, 0xfa, 0x9a, 0xfd, 0x27, 0x36, 0x0,  0x5,  0xd1, 0x22,
                   0x49, 0xe,  0x57, 0x0,  0x11, 0x3a, 0x2f, 0xb5, 0x21, 0x76, 0xc1, 0xb1, 0x41, 0x14, 0x6,  0xb5,
                   0xda, 0xda, 0x2a, 0xb7, 0xf8, 0xe9, 0x0,  0xd,  0x5e, 0x7d, 0x17, 0xcc, 0x6e, 0x31, 0x81, 0x9c,
                   0x9f, 0xc1, 0x59, 0xa0, 0xb,  0x0,  0xf,  0xde, 0x7d, 0x5e, 0x76, 0x99, 0xf7, 0xf4, 0xb9, 0x81,
                   0xa,  0xdc, 0x43, 0x79, 0x1a, 0x3,  0x0,  0x3,  0xf7, 0xb8, 0x72};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19254}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 223}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xdb, 0x36, 0xd0, 0xf5, 0xfb, 0xfc, 0x1b, 0xde, 0x7,  0xaf,
                                     0x5d, 0x36, 0x1a, 0x19, 0xbb, 0xa3, 0x87, 0xfb, 0x52, 0x8d,
                                     0xbc, 0xfa, 0x5f, 0x7e, 0x23, 0xfa, 0x9a, 0xfd, 0x27, 0x36};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd1, 0x22, 0x49, 0xe, 0x57};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x3a, 0x2f, 0xb5, 0x21, 0x76, 0xc1, 0xb1, 0x41, 0x14,
                                     0x6,  0xb5, 0xda, 0xda, 0x2a, 0xb7, 0xf8, 0xe9};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5e, 0x7d, 0x17, 0xcc, 0x6e, 0x31, 0x81, 0x9c, 0x9f, 0xc1, 0x59, 0xa0, 0xb};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xde, 0x7d, 0x5e, 0x76, 0x99, 0xf7, 0xf4, 0xb9,
                                     0x81, 0xa,  0xdc, 0x43, 0x79, 0x1a, 0x3};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf7, 0xb8, 0x72};
  lwmqtt_string_t topic_filter_s5 = {3, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17284, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26289
// ["\140B\199\151L3\231\157\171K\204\197\224\217\DC2\144l\223\SYNH\185kEa\195","\170\250s\163&\SUB\DC3?I\176","*\244","\169\175\132P&\bp\128\&0B\ETB*\162u\148\&3p\fE\STX\ENQ\NAK)M{\199","\212j\250\SYN\247\NUL\139#9\128\SYN\141\DC1\198\182\221\128\146\130\239`3\STX\r","\179sq\146\SI\SYN\SUB\229\SUBT\SIeFJd\172\am\222\178|\234T\138\137\144"]
// [PropCorrelationData "\DEL\183",PropSubscriptionIdentifierAvailable 5,PropCorrelationData
// "\DC1\162\188MG\SYNI\246L<i%\237j\187g\179\247\169\215\221\229Y\GS",PropTopicAlias 15504,PropTopicAliasMaximum
// 28770,PropSharedSubscriptionAvailable 74,PropTopicAliasMaximum 27219,PropTopicAliasMaximum
// 30507,PropRequestResponseInformation 75,PropWildcardSubscriptionAvailable 216,PropReceiveMaximum
// 17068,PropSharedSubscriptionAvailable 239]
TEST(Unsubscribe5QCTest, Encode3) {
  uint8_t pkt[] = {
      0xa2, 0xb9, 0x1,  0x66, 0xb1, 0x39, 0x9,  0x0,  0x2,  0x7f, 0xb7, 0x29, 0x5,  0x9,  0x0,  0x18, 0x11, 0xa2, 0xbc,
      0x4d, 0x47, 0x16, 0x49, 0xf6, 0x4c, 0x3c, 0x69, 0x25, 0xed, 0x6a, 0xbb, 0x67, 0xb3, 0xf7, 0xa9, 0xd7, 0xdd, 0xe5,
      0x59, 0x1d, 0x23, 0x3c, 0x90, 0x22, 0x70, 0x62, 0x2a, 0x4a, 0x22, 0x6a, 0x53, 0x22, 0x77, 0x2b, 0x19, 0x4b, 0x28,
      0xd8, 0x21, 0x42, 0xac, 0x2a, 0xef, 0x0,  0x19, 0x8c, 0x42, 0xc7, 0x97, 0x4c, 0x33, 0xe7, 0x9d, 0xab, 0x4b, 0xcc,
      0xc5, 0xe0, 0xd9, 0x12, 0x90, 0x6c, 0xdf, 0x16, 0x48, 0xb9, 0x6b, 0x45, 0x61, 0xc3, 0x0,  0xa,  0xaa, 0xfa, 0x73,
      0xa3, 0x26, 0x1a, 0x13, 0x3f, 0x49, 0xb0, 0x0,  0x2,  0x2a, 0xf4, 0x0,  0x1a, 0xa9, 0xaf, 0x84, 0x50, 0x26, 0x8,
      0x70, 0x80, 0x30, 0x42, 0x17, 0x2a, 0xa2, 0x75, 0x94, 0x33, 0x70, 0xc,  0x45, 0x2,  0x5,  0x15, 0x29, 0x4d, 0x7b,
      0xc7, 0x0,  0x18, 0xd4, 0x6a, 0xfa, 0x16, 0xf7, 0x0,  0x8b, 0x23, 0x39, 0x80, 0x16, 0x8d, 0x11, 0xc6, 0xb6, 0xdd,
      0x80, 0x92, 0x82, 0xef, 0x60, 0x33, 0x2,  0xd,  0x0,  0x1a, 0xb3, 0x73, 0x71, 0x92, 0xf,  0x16, 0x1a, 0xe5, 0x1a,
      0x54, 0xf,  0x65, 0x46, 0x4a, 0x64, 0xac, 0x7,  0x6d, 0xde, 0xb2, 0x7c, 0xea, 0x54, 0x8a, 0x89, 0x90};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7f, 0xb7};
  uint8_t bytesprops1[] = {0x11, 0xa2, 0xbc, 0x4d, 0x47, 0x16, 0x49, 0xf6, 0x4c, 0x3c, 0x69, 0x25,
                           0xed, 0x6a, 0xbb, 0x67, 0xb3, 0xf7, 0xa9, 0xd7, 0xdd, 0xe5, 0x59, 0x1d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15504}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28770}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27219}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30507}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17068}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 239}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x8c, 0x42, 0xc7, 0x97, 0x4c, 0x33, 0xe7, 0x9d, 0xab, 0x4b, 0xcc, 0xc5, 0xe0,
                                     0xd9, 0x12, 0x90, 0x6c, 0xdf, 0x16, 0x48, 0xb9, 0x6b, 0x45, 0x61, 0xc3};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaa, 0xfa, 0x73, 0xa3, 0x26, 0x1a, 0x13, 0x3f, 0x49, 0xb0};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2a, 0xf4};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa9, 0xaf, 0x84, 0x50, 0x26, 0x8,  0x70, 0x80, 0x30, 0x42, 0x17, 0x2a, 0xa2,
                                     0x75, 0x94, 0x33, 0x70, 0xc,  0x45, 0x2,  0x5,  0x15, 0x29, 0x4d, 0x7b, 0xc7};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd4, 0x6a, 0xfa, 0x16, 0xf7, 0x0,  0x8b, 0x23, 0x39, 0x80, 0x16, 0x8d,
                                     0x11, 0xc6, 0xb6, 0xdd, 0x80, 0x92, 0x82, 0xef, 0x60, 0x33, 0x2,  0xd};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb3, 0x73, 0x71, 0x92, 0xf,  0x16, 0x1a, 0xe5, 0x1a, 0x54, 0xf,  0x65, 0x46,
                                     0x4a, 0x64, 0xac, 0x7,  0x6d, 0xde, 0xb2, 0x7c, 0xea, 0x54, 0x8a, 0x89, 0x90};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26289, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 9896 ["\tB\174\175\ETB\143
// \v","\ENQm\"j\248","WK\250\223\NULU\203\244\200\172*\132","\RS\242\186\199b\226\200OR\vY\184#n\183\221\242\148bb\SUB\180"]
// [PropMessageExpiryInterval 12070,PropCorrelationData "\208",PropResponseInformation
// "Z\DC1&\192}\132\159i\147\203\220\202\228s\218eJ\r\158N\140\&5\255\206h\189\155s\225j",PropReasonString
// "x]Ey\213\&8\155\187h\187\135\244\157\161sL\242|\131zs#",PropRetainAvailable 189,PropUserProperty "t\"\129\a"
// "B0\189O\236!\246\DEL\154p\193#\194\225\143\251\144N\DC4zc\245)j",PropRequestResponseInformation 159,PropTopicAlias
// 29629,PropWildcardSubscriptionAvailable 200,PropMessageExpiryInterval 26366,PropAuthenticationData
// "\EOTP4Dw\\{\139\DC1\206\238\185",PropSubscriptionIdentifierAvailable 204,PropWildcardSubscriptionAvailable
// 232,PropServerReference "\237K\143\241/~i\247\197\139\188\174\232\151C\244\240\167\162\158",PropMessageExpiryInterval
// 28644,PropRequestResponseInformation 191,PropReceiveMaximum 2968,PropWildcardSubscriptionAvailable
// 7,PropPayloadFormatIndicator 110,PropAuthenticationData
// "\239\233\SYN!$3\\?RfX\136\144\130\186\&3\236",PropSubscriptionIdentifierAvailable
// 147,PropSharedSubscriptionAvailable 55,PropMessageExpiryInterval 10330,PropAuthenticationData
// "\145\210\242\200\130u>\230\227\141\240l\SO\NUL&\148\157",PropMessageExpiryInterval 1519,PropServerKeepAlive
// 15506,PropRetainAvailable 132,PropReasonString "m\DEL\171\RS"]
TEST(Unsubscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0xa2, 0xa7, 0x2,  0x26, 0xa8, 0xec, 0x1,  0x2,  0x0,  0x0,  0x2f, 0x26, 0x9,  0x0,  0x1,  0xd0, 0x1a, 0x0,  0x1e,
      0x5a, 0x11, 0x26, 0xc0, 0x7d, 0x84, 0x9f, 0x69, 0x93, 0xcb, 0xdc, 0xca, 0xe4, 0x73, 0xda, 0x65, 0x4a, 0xd,  0x9e,
      0x4e, 0x8c, 0x35, 0xff, 0xce, 0x68, 0xbd, 0x9b, 0x73, 0xe1, 0x6a, 0x1f, 0x0,  0x16, 0x78, 0x5d, 0x45, 0x79, 0xd5,
      0x38, 0x9b, 0xbb, 0x68, 0xbb, 0x87, 0xf4, 0x9d, 0xa1, 0x73, 0x4c, 0xf2, 0x7c, 0x83, 0x7a, 0x73, 0x23, 0x25, 0xbd,
      0x26, 0x0,  0x4,  0x74, 0x22, 0x81, 0x7,  0x0,  0x18, 0x42, 0x30, 0xbd, 0x4f, 0xec, 0x21, 0xf6, 0x7f, 0x9a, 0x70,
      0xc1, 0x23, 0xc2, 0xe1, 0x8f, 0xfb, 0x90, 0x4e, 0x14, 0x7a, 0x63, 0xf5, 0x29, 0x6a, 0x19, 0x9f, 0x23, 0x73, 0xbd,
      0x28, 0xc8, 0x2,  0x0,  0x0,  0x66, 0xfe, 0x16, 0x0,  0xc,  0x4,  0x50, 0x34, 0x44, 0x77, 0x5c, 0x7b, 0x8b, 0x11,
      0xce, 0xee, 0xb9, 0x29, 0xcc, 0x28, 0xe8, 0x1c, 0x0,  0x14, 0xed, 0x4b, 0x8f, 0xf1, 0x2f, 0x7e, 0x69, 0xf7, 0xc5,
      0x8b, 0xbc, 0xae, 0xe8, 0x97, 0x43, 0xf4, 0xf0, 0xa7, 0xa2, 0x9e, 0x2,  0x0,  0x0,  0x6f, 0xe4, 0x19, 0xbf, 0x21,
      0xb,  0x98, 0x28, 0x7,  0x1,  0x6e, 0x16, 0x0,  0x11, 0xef, 0xe9, 0x16, 0x21, 0x24, 0x33, 0x5c, 0x3f, 0x52, 0x66,
      0x58, 0x88, 0x90, 0x82, 0xba, 0x33, 0xec, 0x29, 0x93, 0x2a, 0x37, 0x2,  0x0,  0x0,  0x28, 0x5a, 0x16, 0x0,  0x11,
      0x91, 0xd2, 0xf2, 0xc8, 0x82, 0x75, 0x3e, 0xe6, 0xe3, 0x8d, 0xf0, 0x6c, 0xe,  0x0,  0x26, 0x94, 0x9d, 0x2,  0x0,
      0x0,  0x5,  0xef, 0x13, 0x3c, 0x92, 0x25, 0x84, 0x1f, 0x0,  0x4,  0x6d, 0x7f, 0xab, 0x1e, 0x0,  0x8,  0x9,  0x42,
      0xae, 0xaf, 0x17, 0x8f, 0x20, 0xb,  0x0,  0x5,  0x5,  0x6d, 0x22, 0x6a, 0xf8, 0x0,  0xc,  0x57, 0x4b, 0xfa, 0xdf,
      0x0,  0x55, 0xcb, 0xf4, 0xc8, 0xac, 0x2a, 0x84, 0x0,  0x16, 0x1e, 0xf2, 0xba, 0xc7, 0x62, 0xe2, 0xc8, 0x4f, 0x52,
      0xb,  0x59, 0xb8, 0x23, 0x6e, 0xb7, 0xdd, 0xf2, 0x94, 0x62, 0x62, 0x1a, 0xb4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd0};
  uint8_t bytesprops1[] = {0x5a, 0x11, 0x26, 0xc0, 0x7d, 0x84, 0x9f, 0x69, 0x93, 0xcb, 0xdc, 0xca, 0xe4, 0x73, 0xda,
                           0x65, 0x4a, 0xd,  0x9e, 0x4e, 0x8c, 0x35, 0xff, 0xce, 0x68, 0xbd, 0x9b, 0x73, 0xe1, 0x6a};
  uint8_t bytesprops2[] = {0x78, 0x5d, 0x45, 0x79, 0xd5, 0x38, 0x9b, 0xbb, 0x68, 0xbb, 0x87,
                           0xf4, 0x9d, 0xa1, 0x73, 0x4c, 0xf2, 0x7c, 0x83, 0x7a, 0x73, 0x23};
  uint8_t bytesprops4[] = {0x42, 0x30, 0xbd, 0x4f, 0xec, 0x21, 0xf6, 0x7f, 0x9a, 0x70, 0xc1, 0x23,
                           0xc2, 0xe1, 0x8f, 0xfb, 0x90, 0x4e, 0x14, 0x7a, 0x63, 0xf5, 0x29, 0x6a};
  uint8_t bytesprops3[] = {0x74, 0x22, 0x81, 0x7};
  uint8_t bytesprops5[] = {0x4, 0x50, 0x34, 0x44, 0x77, 0x5c, 0x7b, 0x8b, 0x11, 0xce, 0xee, 0xb9};
  uint8_t bytesprops6[] = {0xed, 0x4b, 0x8f, 0xf1, 0x2f, 0x7e, 0x69, 0xf7, 0xc5, 0x8b,
                           0xbc, 0xae, 0xe8, 0x97, 0x43, 0xf4, 0xf0, 0xa7, 0xa2, 0x9e};
  uint8_t bytesprops7[] = {0xef, 0xe9, 0x16, 0x21, 0x24, 0x33, 0x5c, 0x3f, 0x52,
                           0x66, 0x58, 0x88, 0x90, 0x82, 0xba, 0x33, 0xec};
  uint8_t bytesprops8[] = {0x91, 0xd2, 0xf2, 0xc8, 0x82, 0x75, 0x3e, 0xe6, 0xe3,
                           0x8d, 0xf0, 0x6c, 0xe,  0x0,  0x26, 0x94, 0x9d};
  uint8_t bytesprops9[] = {0x6d, 0x7f, 0xab, 0x1e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12070}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops3}, .v = {24, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29629}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26366}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28644}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2968}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10330}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1519}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15506}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x9, 0x42, 0xae, 0xaf, 0x17, 0x8f, 0x20, 0xb};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5, 0x6d, 0x22, 0x6a, 0xf8};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x57, 0x4b, 0xfa, 0xdf, 0x0, 0x55, 0xcb, 0xf4, 0xc8, 0xac, 0x2a, 0x84};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1e, 0xf2, 0xba, 0xc7, 0x62, 0xe2, 0xc8, 0x4f, 0x52, 0xb,  0x59,
                                     0xb8, 0x23, 0x6e, 0xb7, 0xdd, 0xf2, 0x94, 0x62, 0x62, 0x1a, 0xb4};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9896, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 9659
// ["\253","\160\188","\246\207o\213\149\183l\132M\244\133\167\244B[\202","\DC4\197.\n\245\152<\170X\185\RS?8\177\237\152\ENQ\173\173\191\249\&8x\ESC\215\145\250","\158F\EOT.\ESC\EMp\SUB\218\&9P\172LJ\198"]
// [PropServerReference
// "&\166Q\248\184\225\194\133\145\vz\181\US\211\230{\249J\SI\136\252\246+\214\239\176",PropRequestResponseInformation
// 195,PropContentType
// "~\219\209i\147\SYN^L(\214\165w\243\214G\207!\DLE\236\219D'\210\199\184\\",PropMessageExpiryInterval
// 19808,PropMessageExpiryInterval 24445,PropAuthenticationMethod "",PropTopicAliasMaximum 4660,PropTopicAliasMaximum
// 13231,PropRetainAvailable 25,PropReceiveMaximum 26084]
TEST(Unsubscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0xa2, 0x9e, 0x1,  0x25, 0xbb, 0x54, 0x1c, 0x0,  0x1a, 0x26, 0xa6, 0x51, 0xf8, 0xb8, 0xe1, 0xc2, 0x85,
                   0x91, 0xb,  0x7a, 0xb5, 0x1f, 0xd3, 0xe6, 0x7b, 0xf9, 0x4a, 0xf,  0x88, 0xfc, 0xf6, 0x2b, 0xd6, 0xef,
                   0xb0, 0x19, 0xc3, 0x3,  0x0,  0x1a, 0x7e, 0xdb, 0xd1, 0x69, 0x93, 0x16, 0x5e, 0x4c, 0x28, 0xd6, 0xa5,
                   0x77, 0xf3, 0xd6, 0x47, 0xcf, 0x21, 0x10, 0xec, 0xdb, 0x44, 0x27, 0xd2, 0xc7, 0xb8, 0x5c, 0x2,  0x0,
                   0x0,  0x4d, 0x60, 0x2,  0x0,  0x0,  0x5f, 0x7d, 0x15, 0x0,  0x0,  0x22, 0x12, 0x34, 0x22, 0x33, 0xaf,
                   0x25, 0x19, 0x21, 0x65, 0xe4, 0x0,  0x1,  0xfd, 0x0,  0x2,  0xa0, 0xbc, 0x0,  0x10, 0xf6, 0xcf, 0x6f,
                   0xd5, 0x95, 0xb7, 0x6c, 0x84, 0x4d, 0xf4, 0x85, 0xa7, 0xf4, 0x42, 0x5b, 0xca, 0x0,  0x1b, 0x14, 0xc5,
                   0x2e, 0xa,  0xf5, 0x98, 0x3c, 0xaa, 0x58, 0xb9, 0x1e, 0x3f, 0x38, 0xb1, 0xed, 0x98, 0x5,  0xad, 0xad,
                   0xbf, 0xf9, 0x38, 0x78, 0x1b, 0xd7, 0x91, 0xfa, 0x0,  0xf,  0x9e, 0x46, 0x4,  0x2e, 0x1b, 0x19, 0x70,
                   0x1a, 0xda, 0x39, 0x50, 0xac, 0x4c, 0x4a, 0xc6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x26, 0xa6, 0x51, 0xf8, 0xb8, 0xe1, 0xc2, 0x85, 0x91, 0xb,  0x7a, 0xb5, 0x1f,
                           0xd3, 0xe6, 0x7b, 0xf9, 0x4a, 0xf,  0x88, 0xfc, 0xf6, 0x2b, 0xd6, 0xef, 0xb0};
  uint8_t bytesprops1[] = {0x7e, 0xdb, 0xd1, 0x69, 0x93, 0x16, 0x5e, 0x4c, 0x28, 0xd6, 0xa5, 0x77, 0xf3,
                           0xd6, 0x47, 0xcf, 0x21, 0x10, 0xec, 0xdb, 0x44, 0x27, 0xd2, 0xc7, 0xb8, 0x5c};
  uint8_t bytesprops2[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19808}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24445}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4660}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13231}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26084}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xfd};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa0, 0xbc};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf6, 0xcf, 0x6f, 0xd5, 0x95, 0xb7, 0x6c, 0x84,
                                     0x4d, 0xf4, 0x85, 0xa7, 0xf4, 0x42, 0x5b, 0xca};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x14, 0xc5, 0x2e, 0xa,  0xf5, 0x98, 0x3c, 0xaa, 0x58, 0xb9, 0x1e, 0x3f, 0x38, 0xb1,
                                     0xed, 0x98, 0x5,  0xad, 0xad, 0xbf, 0xf9, 0x38, 0x78, 0x1b, 0xd7, 0x91, 0xfa};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9e, 0x46, 0x4,  0x2e, 0x1b, 0x19, 0x70, 0x1a,
                                     0xda, 0x39, 0x50, 0xac, 0x4c, 0x4a, 0xc6};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9659, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5752
// ["\a\tr\STXO4\140\DC2\166\&9\DC2\n\233","G\196\155\t.\170\213Y\229_\218\226k\NAKIi\229\145\SI\234","M!\NUL\223\224\185\128\215\200\186\241f\221vD\173\tW\162\EOT\200\&4!\n\160","Wu\227\181\230\224\215}\250\227\167\RS\140QIPk\192\135\b\STX\180\186\147\135U\174\155"]
// [PropMaximumPacketSize 16593,PropMaximumQoS 135,PropMaximumQoS 76,PropResponseInformation
// "\134G\164\193cR\ETB\EMM\133\183%p\171HS\141\206\&7\206\248",PropServerKeepAlive 21530,PropTopicAlias
// 19135,PropRequestProblemInformation 183,PropReasonString "\166\148",PropResponseInformation
// "\NAKB\DC4\180\138h\SYN\ETB\142\186t1",PropAuthenticationData
// "\164\227\163\137\155\163\163\251\SI\211\207jX\NULO\245\\\206B\239",PropSessionExpiryInterval
// 26346,PropMessageExpiryInterval 10899,PropServerKeepAlive 21711,PropResponseInformation
// "+\174|\191\229\228\222ayU\250\221\254\216\232\&6\243\155B\231\180\EM\DC3\255",PropAuthenticationData
// "\222\202\&8\239\206\ETXx^",PropRetainAvailable 213,PropRequestProblemInformation 196,PropResponseTopic
// "+G\226\177\&6\133;\128`\130\142\243\159\137DKr\181\148\132\198",PropWillDelayInterval
// 6318,PropRequestProblemInformation 19]
TEST(Unsubscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0xa2, 0x8c, 0x2,  0x16, 0x78, 0xaa, 0x1,  0x27, 0x0,  0x0,  0x40, 0xd1, 0x24, 0x87, 0x24, 0x4c, 0x1a,
                   0x0,  0x15, 0x86, 0x47, 0xa4, 0xc1, 0x63, 0x52, 0x17, 0x19, 0x4d, 0x85, 0xb7, 0x25, 0x70, 0xab, 0x48,
                   0x53, 0x8d, 0xce, 0x37, 0xce, 0xf8, 0x13, 0x54, 0x1a, 0x23, 0x4a, 0xbf, 0x17, 0xb7, 0x1f, 0x0,  0x2,
                   0xa6, 0x94, 0x1a, 0x0,  0xc,  0x15, 0x42, 0x14, 0xb4, 0x8a, 0x68, 0x16, 0x17, 0x8e, 0xba, 0x74, 0x31,
                   0x16, 0x0,  0x14, 0xa4, 0xe3, 0xa3, 0x89, 0x9b, 0xa3, 0xa3, 0xfb, 0xf,  0xd3, 0xcf, 0x6a, 0x58, 0x0,
                   0x4f, 0xf5, 0x5c, 0xce, 0x42, 0xef, 0x11, 0x0,  0x0,  0x66, 0xea, 0x2,  0x0,  0x0,  0x2a, 0x93, 0x13,
                   0x54, 0xcf, 0x1a, 0x0,  0x18, 0x2b, 0xae, 0x7c, 0xbf, 0xe5, 0xe4, 0xde, 0x61, 0x79, 0x55, 0xfa, 0xdd,
                   0xfe, 0xd8, 0xe8, 0x36, 0xf3, 0x9b, 0x42, 0xe7, 0xb4, 0x19, 0x13, 0xff, 0x16, 0x0,  0x8,  0xde, 0xca,
                   0x38, 0xef, 0xce, 0x3,  0x78, 0x5e, 0x25, 0xd5, 0x17, 0xc4, 0x8,  0x0,  0x15, 0x2b, 0x47, 0xe2, 0xb1,
                   0x36, 0x85, 0x3b, 0x80, 0x60, 0x82, 0x8e, 0xf3, 0x9f, 0x89, 0x44, 0x4b, 0x72, 0xb5, 0x94, 0x84, 0xc6,
                   0x18, 0x0,  0x0,  0x18, 0xae, 0x17, 0x13, 0x0,  0xd,  0x7,  0x9,  0x72, 0x2,  0x4f, 0x34, 0x8c, 0x12,
                   0xa6, 0x39, 0x12, 0xa,  0xe9, 0x0,  0x14, 0x47, 0xc4, 0x9b, 0x9,  0x2e, 0xaa, 0xd5, 0x59, 0xe5, 0x5f,
                   0xda, 0xe2, 0x6b, 0x15, 0x49, 0x69, 0xe5, 0x91, 0xf,  0xea, 0x0,  0x19, 0x4d, 0x21, 0x0,  0xdf, 0xe0,
                   0xb9, 0x80, 0xd7, 0xc8, 0xba, 0xf1, 0x66, 0xdd, 0x76, 0x44, 0xad, 0x9,  0x57, 0xa2, 0x4,  0xc8, 0x34,
                   0x21, 0xa,  0xa0, 0x0,  0x1c, 0x57, 0x75, 0xe3, 0xb5, 0xe6, 0xe0, 0xd7, 0x7d, 0xfa, 0xe3, 0xa7, 0x1e,
                   0x8c, 0x51, 0x49, 0x50, 0x6b, 0xc0, 0x87, 0x8,  0x2,  0xb4, 0xba, 0x93, 0x87, 0x55, 0xae, 0x9b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x86, 0x47, 0xa4, 0xc1, 0x63, 0x52, 0x17, 0x19, 0x4d, 0x85, 0xb7,
                           0x25, 0x70, 0xab, 0x48, 0x53, 0x8d, 0xce, 0x37, 0xce, 0xf8};
  uint8_t bytesprops1[] = {0xa6, 0x94};
  uint8_t bytesprops2[] = {0x15, 0x42, 0x14, 0xb4, 0x8a, 0x68, 0x16, 0x17, 0x8e, 0xba, 0x74, 0x31};
  uint8_t bytesprops3[] = {0xa4, 0xe3, 0xa3, 0x89, 0x9b, 0xa3, 0xa3, 0xfb, 0xf,  0xd3,
                           0xcf, 0x6a, 0x58, 0x0,  0x4f, 0xf5, 0x5c, 0xce, 0x42, 0xef};
  uint8_t bytesprops4[] = {0x2b, 0xae, 0x7c, 0xbf, 0xe5, 0xe4, 0xde, 0x61, 0x79, 0x55, 0xfa, 0xdd,
                           0xfe, 0xd8, 0xe8, 0x36, 0xf3, 0x9b, 0x42, 0xe7, 0xb4, 0x19, 0x13, 0xff};
  uint8_t bytesprops5[] = {0xde, 0xca, 0x38, 0xef, 0xce, 0x3, 0x78, 0x5e};
  uint8_t bytesprops6[] = {0x2b, 0x47, 0xe2, 0xb1, 0x36, 0x85, 0x3b, 0x80, 0x60, 0x82, 0x8e,
                           0xf3, 0x9f, 0x89, 0x44, 0x4b, 0x72, 0xb5, 0x94, 0x84, 0xc6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16593}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21530}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19135}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26346}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10899}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21711}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6318}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 19}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x7, 0x9, 0x72, 0x2, 0x4f, 0x34, 0x8c, 0x12, 0xa6, 0x39, 0x12, 0xa, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x47, 0xc4, 0x9b, 0x9,  0x2e, 0xaa, 0xd5, 0x59, 0xe5, 0x5f,
                                     0xda, 0xe2, 0x6b, 0x15, 0x49, 0x69, 0xe5, 0x91, 0xf,  0xea};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4d, 0x21, 0x0,  0xdf, 0xe0, 0xb9, 0x80, 0xd7, 0xc8, 0xba, 0xf1, 0x66, 0xdd,
                                     0x76, 0x44, 0xad, 0x9,  0x57, 0xa2, 0x4,  0xc8, 0x34, 0x21, 0xa,  0xa0};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x57, 0x75, 0xe3, 0xb5, 0xe6, 0xe0, 0xd7, 0x7d, 0xfa, 0xe3,
                                     0xa7, 0x1e, 0x8c, 0x51, 0x49, 0x50, 0x6b, 0xc0, 0x87, 0x8,
                                     0x2,  0xb4, 0xba, 0x93, 0x87, 0x55, 0xae, 0x9b};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5752, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26590
// ["\"\128\&3`Z\154EIF","\191\216\128<6\157\128\f\207\159&h\207O\235|\169g\r\DC4\137\DC3\175\176\&3\201EN\NAK","\130{\210H\187
// \219q\251wl\247&\nJ$\185\DLE\158\179","\167\NUL\ETX\172\207gd3\251C\170\SIM\239\157O\233\224-\251e-\224\148\188","\184\NAK\198\&2\137\SI:\164\DC3\SYN(#\174\242\179\138<\206\157\US","\222\SO=\194\210\132u\185\192\r5\181","O\231\246\135\209\137","B>\250\193\SOL\212\170\245\168)\237\134\187\204\232*+\218\EM7\r\142\EOTb\221\152l\148"]
// [PropAuthenticationMethod "\146\176\246\146F&~y",PropReceiveMaximum 11903,PropServerKeepAlive
// 30316,PropTopicAliasMaximum 20575,PropSharedSubscriptionAvailable 19,PropSubscriptionIdentifierAvailable
// 238,PropResponseTopic
// "\185X\250\vG>,\222YWiQ5\207\238\DC4\t\223\181~d\143G\233ZP\213\DC3\234",PropAssignedClientIdentifier
// "@f:\SUB6\186\ETX*f\231}\133\150\b\DC1\171\136\204\255\197\ENQFE\f\179<\ESC\250",PropSharedSubscriptionAvailable
// 42,PropRequestResponseInformation 231,PropPayloadFormatIndicator 28,PropAuthenticationMethod
// "\202e\133\&0\206\235W\195\132\250]\238",PropRequestProblemInformation 213,PropReceiveMaximum 11947]
TEST(Unsubscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0xa2, 0x9a, 0x2,  0x67, 0xde, 0x71, 0x15, 0x0,  0x8,  0x92, 0xb0, 0xf6, 0x92, 0x46, 0x26, 0x7e, 0x79, 0x21, 0x2e,
      0x7f, 0x13, 0x76, 0x6c, 0x22, 0x50, 0x5f, 0x2a, 0x13, 0x29, 0xee, 0x8,  0x0,  0x1d, 0xb9, 0x58, 0xfa, 0xb,  0x47,
      0x3e, 0x2c, 0xde, 0x59, 0x57, 0x69, 0x51, 0x35, 0xcf, 0xee, 0x14, 0x9,  0xdf, 0xb5, 0x7e, 0x64, 0x8f, 0x47, 0xe9,
      0x5a, 0x50, 0xd5, 0x13, 0xea, 0x12, 0x0,  0x1c, 0x40, 0x66, 0x3a, 0x1a, 0x36, 0xba, 0x3,  0x2a, 0x66, 0xe7, 0x7d,
      0x85, 0x96, 0x8,  0x11, 0xab, 0x88, 0xcc, 0xff, 0xc5, 0x5,  0x46, 0x45, 0xc,  0xb3, 0x3c, 0x1b, 0xfa, 0x2a, 0x2a,
      0x19, 0xe7, 0x1,  0x1c, 0x15, 0x0,  0xc,  0xca, 0x65, 0x85, 0x30, 0xce, 0xeb, 0x57, 0xc3, 0x84, 0xfa, 0x5d, 0xee,
      0x17, 0xd5, 0x21, 0x2e, 0xab, 0x0,  0x9,  0x22, 0x80, 0x33, 0x60, 0x5a, 0x9a, 0x45, 0x49, 0x46, 0x0,  0x1d, 0xbf,
      0xd8, 0x80, 0x3c, 0x36, 0x9d, 0x80, 0xc,  0xcf, 0x9f, 0x26, 0x68, 0xcf, 0x4f, 0xeb, 0x7c, 0xa9, 0x67, 0xd,  0x14,
      0x89, 0x13, 0xaf, 0xb0, 0x33, 0xc9, 0x45, 0x4e, 0x15, 0x0,  0x14, 0x82, 0x7b, 0xd2, 0x48, 0xbb, 0x20, 0xdb, 0x71,
      0xfb, 0x77, 0x6c, 0xf7, 0x26, 0xa,  0x4a, 0x24, 0xb9, 0x10, 0x9e, 0xb3, 0x0,  0x19, 0xa7, 0x0,  0x3,  0xac, 0xcf,
      0x67, 0x64, 0x33, 0xfb, 0x43, 0xaa, 0xf,  0x4d, 0xef, 0x9d, 0x4f, 0xe9, 0xe0, 0x2d, 0xfb, 0x65, 0x2d, 0xe0, 0x94,
      0xbc, 0x0,  0x14, 0xb8, 0x15, 0xc6, 0x32, 0x89, 0xf,  0x3a, 0xa4, 0x13, 0x16, 0x28, 0x23, 0xae, 0xf2, 0xb3, 0x8a,
      0x3c, 0xce, 0x9d, 0x1f, 0x0,  0xc,  0xde, 0xe,  0x3d, 0xc2, 0xd2, 0x84, 0x75, 0xb9, 0xc0, 0xd,  0x35, 0xb5, 0x0,
      0x6,  0x4f, 0xe7, 0xf6, 0x87, 0xd1, 0x89, 0x0,  0x1d, 0x42, 0x3e, 0xfa, 0xc1, 0xe,  0x4c, 0xd4, 0xaa, 0xf5, 0xa8,
      0x29, 0xed, 0x86, 0xbb, 0xcc, 0xe8, 0x2a, 0x2b, 0xda, 0x19, 0x37, 0xd,  0x8e, 0x4,  0x62, 0xdd, 0x98, 0x6c, 0x94};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x92, 0xb0, 0xf6, 0x92, 0x46, 0x26, 0x7e, 0x79};
  uint8_t bytesprops1[] = {0xb9, 0x58, 0xfa, 0xb,  0x47, 0x3e, 0x2c, 0xde, 0x59, 0x57, 0x69, 0x51, 0x35, 0xcf, 0xee,
                           0x14, 0x9,  0xdf, 0xb5, 0x7e, 0x64, 0x8f, 0x47, 0xe9, 0x5a, 0x50, 0xd5, 0x13, 0xea};
  uint8_t bytesprops2[] = {0x40, 0x66, 0x3a, 0x1a, 0x36, 0xba, 0x3, 0x2a, 0x66, 0xe7, 0x7d, 0x85, 0x96, 0x8,
                           0x11, 0xab, 0x88, 0xcc, 0xff, 0xc5, 0x5, 0x46, 0x45, 0xc,  0xb3, 0x3c, 0x1b, 0xfa};
  uint8_t bytesprops3[] = {0xca, 0x65, 0x85, 0x30, 0xce, 0xeb, 0x57, 0xc3, 0x84, 0xfa, 0x5d, 0xee};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11903}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30316}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20575}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11947}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x22, 0x80, 0x33, 0x60, 0x5a, 0x9a, 0x45, 0x49, 0x46};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbf, 0xd8, 0x80, 0x3c, 0x36, 0x9d, 0x80, 0xc,  0xcf, 0x9f,
                                     0x26, 0x68, 0xcf, 0x4f, 0xeb, 0x7c, 0xa9, 0x67, 0xd,  0x14,
                                     0x89, 0x13, 0xaf, 0xb0, 0x33, 0xc9, 0x45, 0x4e, 0x15};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x82, 0x7b, 0xd2, 0x48, 0xbb, 0x20, 0xdb, 0x71, 0xfb, 0x77,
                                     0x6c, 0xf7, 0x26, 0xa,  0x4a, 0x24, 0xb9, 0x10, 0x9e, 0xb3};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa7, 0x0,  0x3,  0xac, 0xcf, 0x67, 0x64, 0x33, 0xfb, 0x43, 0xaa, 0xf, 0x4d,
                                     0xef, 0x9d, 0x4f, 0xe9, 0xe0, 0x2d, 0xfb, 0x65, 0x2d, 0xe0, 0x94, 0xbc};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb8, 0x15, 0xc6, 0x32, 0x89, 0xf,  0x3a, 0xa4, 0x13, 0x16,
                                     0x28, 0x23, 0xae, 0xf2, 0xb3, 0x8a, 0x3c, 0xce, 0x9d, 0x1f};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xde, 0xe, 0x3d, 0xc2, 0xd2, 0x84, 0x75, 0xb9, 0xc0, 0xd, 0x35, 0xb5};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4f, 0xe7, 0xf6, 0x87, 0xd1, 0x89};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x42, 0x3e, 0xfa, 0xc1, 0xe,  0x4c, 0xd4, 0xaa, 0xf5, 0xa8,
                                     0x29, 0xed, 0x86, 0xbb, 0xcc, 0xe8, 0x2a, 0x2b, 0xda, 0x19,
                                     0x37, 0xd,  0x8e, 0x4,  0x62, 0xdd, 0x98, 0x6c, 0x94};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26590, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28467 ["\188j71/\157\SUBlO\ESC","N\195\136\SUB[L\203?\219","\USk\146!\197w\FSR\152\254\&3\216
// \DEL\184\"\147\247\GS\137\168","\147\161\247W\NAKc\172\214*\254 17\201\164\177)\167e\233\179\198\197Wf\a\153x"] []
TEST(Unsubscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0xa2, 0x4f, 0x6f, 0x33, 0x0,  0x0,  0xa,  0xbc, 0x6a, 0x37, 0x31, 0x2f, 0x9d, 0x1a, 0x6c, 0x4f, 0x1b,
                   0x0,  0x9,  0x4e, 0xc3, 0x88, 0x1a, 0x5b, 0x4c, 0xcb, 0x3f, 0xdb, 0x0,  0x15, 0x1f, 0x6b, 0x92, 0x21,
                   0xc5, 0x77, 0x1c, 0x52, 0x98, 0xfe, 0x33, 0xd8, 0x20, 0x7f, 0xb8, 0x22, 0x93, 0xf7, 0x1d, 0x89, 0xa8,
                   0x0,  0x1c, 0x93, 0xa1, 0xf7, 0x57, 0x15, 0x63, 0xac, 0xd6, 0x2a, 0xfe, 0x20, 0x31, 0x37, 0xc9, 0xa4,
                   0xb1, 0x29, 0xa7, 0x65, 0xe9, 0xb3, 0xc6, 0xc5, 0x57, 0x66, 0x7,  0x99, 0x78};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xbc, 0x6a, 0x37, 0x31, 0x2f, 0x9d, 0x1a, 0x6c, 0x4f, 0x1b};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4e, 0xc3, 0x88, 0x1a, 0x5b, 0x4c, 0xcb, 0x3f, 0xdb};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1f, 0x6b, 0x92, 0x21, 0xc5, 0x77, 0x1c, 0x52, 0x98, 0xfe, 0x33,
                                     0xd8, 0x20, 0x7f, 0xb8, 0x22, 0x93, 0xf7, 0x1d, 0x89, 0xa8};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x93, 0xa1, 0xf7, 0x57, 0x15, 0x63, 0xac, 0xd6, 0x2a, 0xfe,
                                     0x20, 0x31, 0x37, 0xc9, 0xa4, 0xb1, 0x29, 0xa7, 0x65, 0xe9,
                                     0xb3, 0xc6, 0xc5, 0x57, 0x66, 0x7,  0x99, 0x78};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28467, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 8404 ["\198\198Y,9\140\US\ETB\133\SI\228\DC4\186\&9\252\131\242
// \160\ACK\250\190\133H\184","h|\216nA\142%q@$\216\a\145\EOTE{\207\164V16\251]\131\&8u\235\184Ez","\132T\176\161h\202^\226p\136\166%\163^5\146\232\ESC\STXi\ENQ(\228\223#\SOH\204","M","\172\206\130\186\208S\DC1\255\166\196a","\144}i\254(@\229\171\199YW\ESC:\DC2\SUBs\165k\t\164\175,PR\SYN\194\DEL","0pM\253Q\142\194\174\194\194G9c\235T\GS\235\199\205\220\170\a\vF"]
// [PropReceiveMaximum 26464,PropContentType "1\202V\139\a\219\200\200\128\239\194\147[\173",PropServerKeepAlive
// 22501,PropContentType "\206\191\191\SO\136\230*\158\219\228\142]3",PropSubscriptionIdentifier
// 26,PropWillDelayInterval 16408,PropMessageExpiryInterval 24346,PropResponseTopic
// "\239\&6\CAN\192\aq\EM\227\&5\SOH\244>\ESC\212{\CAN\213\213D\CAN\147WB",PropReasonString
// "\149\198\141\a\196\RS`\141\177\SYN\216\137\\(\133\209aN\178A\EM\200.(\204N\153\210xb",PropReasonString
// "",PropSubscriptionIdentifier 19,PropTopicAlias 25210,PropWillDelayInterval 12790,PropSubscriptionIdentifierAvailable
// 243,PropAuthenticationMethod "\243\220\NAK\199\145x\253&\188\223@ L\222>\ESC\192",PropAuthenticationData
// "\215=\139\184\ACKh\195\154\171",PropUserProperty "<F\SO\152/}\DC3" "",PropSharedSubscriptionAvailable
// 124,PropTopicAlias 22077,PropMaximumQoS 135,PropSessionExpiryInterval 30123,PropRequestProblemInformation
// 219,PropMessageExpiryInterval 28226,PropResponseInformation "R\207t\av\248",PropRequestProblemInformation
// 192,PropRetainAvailable 225,PropRetainAvailable 111,PropAuthenticationData "\f\216.\161*9\234\b\253\217\SYNQ
// ~s\189\160\220\243M\162\255\177\"ok+"]
TEST(Unsubscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0xa2, 0x8c, 0x3,  0x20, 0xd4, 0xe9, 0x1,  0x21, 0x67, 0x60, 0x3,  0x0,  0xe,  0x31, 0xca, 0x56, 0x8b, 0x7,  0xdb,
      0xc8, 0xc8, 0x80, 0xef, 0xc2, 0x93, 0x5b, 0xad, 0x13, 0x57, 0xe5, 0x3,  0x0,  0xd,  0xce, 0xbf, 0xbf, 0xe,  0x88,
      0xe6, 0x2a, 0x9e, 0xdb, 0xe4, 0x8e, 0x5d, 0x33, 0xb,  0x1a, 0x18, 0x0,  0x0,  0x40, 0x18, 0x2,  0x0,  0x0,  0x5f,
      0x1a, 0x8,  0x0,  0x17, 0xef, 0x36, 0x18, 0xc0, 0x7,  0x71, 0x19, 0xe3, 0x35, 0x1,  0xf4, 0x3e, 0x1b, 0xd4, 0x7b,
      0x18, 0xd5, 0xd5, 0x44, 0x18, 0x93, 0x57, 0x42, 0x1f, 0x0,  0x1e, 0x95, 0xc6, 0x8d, 0x7,  0xc4, 0x1e, 0x60, 0x8d,
      0xb1, 0x16, 0xd8, 0x89, 0x5c, 0x28, 0x85, 0xd1, 0x61, 0x4e, 0xb2, 0x41, 0x19, 0xc8, 0x2e, 0x28, 0xcc, 0x4e, 0x99,
      0xd2, 0x78, 0x62, 0x1f, 0x0,  0x0,  0xb,  0x13, 0x23, 0x62, 0x7a, 0x18, 0x0,  0x0,  0x31, 0xf6, 0x29, 0xf3, 0x15,
      0x0,  0x11, 0xf3, 0xdc, 0x15, 0xc7, 0x91, 0x78, 0xfd, 0x26, 0xbc, 0xdf, 0x40, 0x20, 0x4c, 0xde, 0x3e, 0x1b, 0xc0,
      0x16, 0x0,  0x9,  0xd7, 0x3d, 0x8b, 0xb8, 0x6,  0x68, 0xc3, 0x9a, 0xab, 0x26, 0x0,  0x7,  0x3c, 0x46, 0xe,  0x98,
      0x2f, 0x7d, 0x13, 0x0,  0x0,  0x2a, 0x7c, 0x23, 0x56, 0x3d, 0x24, 0x87, 0x11, 0x0,  0x0,  0x75, 0xab, 0x17, 0xdb,
      0x2,  0x0,  0x0,  0x6e, 0x42, 0x1a, 0x0,  0x6,  0x52, 0xcf, 0x74, 0x7,  0x76, 0xf8, 0x17, 0xc0, 0x25, 0xe1, 0x25,
      0x6f, 0x16, 0x0,  0x1b, 0xc,  0xd8, 0x2e, 0xa1, 0x2a, 0x39, 0xea, 0x8,  0xfd, 0xd9, 0x16, 0x51, 0x20, 0x7e, 0x73,
      0xbd, 0xa0, 0xdc, 0xf3, 0x4d, 0xa2, 0xff, 0xb1, 0x22, 0x6f, 0x6b, 0x2b, 0x0,  0x19, 0xc6, 0xc6, 0x59, 0x2c, 0x39,
      0x8c, 0x1f, 0x17, 0x85, 0xf,  0xe4, 0x14, 0xba, 0x39, 0xfc, 0x83, 0xf2, 0x20, 0xa0, 0x6,  0xfa, 0xbe, 0x85, 0x48,
      0xb8, 0x0,  0x1e, 0x68, 0x7c, 0xd8, 0x6e, 0x41, 0x8e, 0x25, 0x71, 0x40, 0x24, 0xd8, 0x7,  0x91, 0x4,  0x45, 0x7b,
      0xcf, 0xa4, 0x56, 0x31, 0x36, 0xfb, 0x5d, 0x83, 0x38, 0x75, 0xeb, 0xb8, 0x45, 0x7a, 0x0,  0x1b, 0x84, 0x54, 0xb0,
      0xa1, 0x68, 0xca, 0x5e, 0xe2, 0x70, 0x88, 0xa6, 0x25, 0xa3, 0x5e, 0x35, 0x92, 0xe8, 0x1b, 0x2,  0x69, 0x5,  0x28,
      0xe4, 0xdf, 0x23, 0x1,  0xcc, 0x0,  0x1,  0x4d, 0x0,  0xb,  0xac, 0xce, 0x82, 0xba, 0xd0, 0x53, 0x11, 0xff, 0xa6,
      0xc4, 0x61, 0x0,  0x1b, 0x90, 0x7d, 0x69, 0xfe, 0x28, 0x40, 0xe5, 0xab, 0xc7, 0x59, 0x57, 0x1b, 0x3a, 0x12, 0x1a,
      0x73, 0xa5, 0x6b, 0x9,  0xa4, 0xaf, 0x2c, 0x50, 0x52, 0x16, 0xc2, 0x7f, 0x0,  0x18, 0x30, 0x70, 0x4d, 0xfd, 0x51,
      0x8e, 0xc2, 0xae, 0xc2, 0xc2, 0x47, 0x39, 0x63, 0xeb, 0x54, 0x1d, 0xeb, 0xc7, 0xcd, 0xdc, 0xaa, 0x7,  0xb,  0x46};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x31, 0xca, 0x56, 0x8b, 0x7, 0xdb, 0xc8, 0xc8, 0x80, 0xef, 0xc2, 0x93, 0x5b, 0xad};
  uint8_t bytesprops1[] = {0xce, 0xbf, 0xbf, 0xe, 0x88, 0xe6, 0x2a, 0x9e, 0xdb, 0xe4, 0x8e, 0x5d, 0x33};
  uint8_t bytesprops2[] = {0xef, 0x36, 0x18, 0xc0, 0x7,  0x71, 0x19, 0xe3, 0x35, 0x1,  0xf4, 0x3e,
                           0x1b, 0xd4, 0x7b, 0x18, 0xd5, 0xd5, 0x44, 0x18, 0x93, 0x57, 0x42};
  uint8_t bytesprops3[] = {0x95, 0xc6, 0x8d, 0x7,  0xc4, 0x1e, 0x60, 0x8d, 0xb1, 0x16, 0xd8, 0x89, 0x5c, 0x28, 0x85,
                           0xd1, 0x61, 0x4e, 0xb2, 0x41, 0x19, 0xc8, 0x2e, 0x28, 0xcc, 0x4e, 0x99, 0xd2, 0x78, 0x62};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0xf3, 0xdc, 0x15, 0xc7, 0x91, 0x78, 0xfd, 0x26, 0xbc,
                           0xdf, 0x40, 0x20, 0x4c, 0xde, 0x3e, 0x1b, 0xc0};
  uint8_t bytesprops6[] = {0xd7, 0x3d, 0x8b, 0xb8, 0x6, 0x68, 0xc3, 0x9a, 0xab};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops7[] = {0x3c, 0x46, 0xe, 0x98, 0x2f, 0x7d, 0x13};
  uint8_t bytesprops9[] = {0x52, 0xcf, 0x74, 0x7, 0x76, 0xf8};
  uint8_t bytesprops10[] = {0xc,  0xd8, 0x2e, 0xa1, 0x2a, 0x39, 0xea, 0x8,  0xfd, 0xd9, 0x16, 0x51, 0x20, 0x7e,
                            0x73, 0xbd, 0xa0, 0xdc, 0xf3, 0x4d, 0xa2, 0xff, 0xb1, 0x22, 0x6f, 0x6b, 0x2b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26464}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22501}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16408}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24346}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25210}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12790}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops7}, .v = {0, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22077}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30123}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28226}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xc6, 0xc6, 0x59, 0x2c, 0x39, 0x8c, 0x1f, 0x17, 0x85, 0xf,  0xe4, 0x14, 0xba,
                                     0x39, 0xfc, 0x83, 0xf2, 0x20, 0xa0, 0x6,  0xfa, 0xbe, 0x85, 0x48, 0xb8};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x68, 0x7c, 0xd8, 0x6e, 0x41, 0x8e, 0x25, 0x71, 0x40, 0x24,
                                     0xd8, 0x7,  0x91, 0x4,  0x45, 0x7b, 0xcf, 0xa4, 0x56, 0x31,
                                     0x36, 0xfb, 0x5d, 0x83, 0x38, 0x75, 0xeb, 0xb8, 0x45, 0x7a};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0x54, 0xb0, 0xa1, 0x68, 0xca, 0x5e, 0xe2, 0x70, 0x88, 0xa6, 0x25, 0xa3, 0x5e,
                                     0x35, 0x92, 0xe8, 0x1b, 0x2,  0x69, 0x5,  0x28, 0xe4, 0xdf, 0x23, 0x1,  0xcc};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4d};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xac, 0xce, 0x82, 0xba, 0xd0, 0x53, 0x11, 0xff, 0xa6, 0xc4, 0x61};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x90, 0x7d, 0x69, 0xfe, 0x28, 0x40, 0xe5, 0xab, 0xc7, 0x59, 0x57, 0x1b, 0x3a, 0x12,
                                     0x1a, 0x73, 0xa5, 0x6b, 0x9,  0xa4, 0xaf, 0x2c, 0x50, 0x52, 0x16, 0xc2, 0x7f};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x30, 0x70, 0x4d, 0xfd, 0x51, 0x8e, 0xc2, 0xae, 0xc2, 0xc2, 0x47, 0x39,
                                     0x63, 0xeb, 0x54, 0x1d, 0xeb, 0xc7, 0xcd, 0xdc, 0xaa, 0x7,  0xb,  0x46};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8404, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27989 ["q\223fV4\ETB\205\139(\ENQ`\204\145\206\221\207\248\245"] [PropRetainAvailable
// 160,PropServerKeepAlive 11580,PropMessageExpiryInterval 22087,PropUserProperty "\169\242"
// "\152n!\224\136\241\rm\STX#\215m*\182\147$\ENQ>",PropRequestResponseInformation 125,PropRequestResponseInformation
// 90,PropMessageExpiryInterval 716,PropReceiveMaximum 10851,PropReceiveMaximum 23215,PropResponseTopic
// "FL}\163\244\228x\EOT\190\EM\152;9Fo(\DC3y\231\n\237\194\157p\145",PropResponseInformation
// "\129\b\STX\241C\NAK\189\169\CANI\163\240\162"]
TEST(Unsubscribe5QCTest, Encode10) {
  uint8_t pkt[] = {0xa2, 0x75, 0x6d, 0x55, 0x5e, 0x25, 0xa0, 0x13, 0x2d, 0x3c, 0x2,  0x0,  0x0,  0x56, 0x47,
                   0x26, 0x0,  0x2,  0xa9, 0xf2, 0x0,  0x12, 0x98, 0x6e, 0x21, 0xe0, 0x88, 0xf1, 0xd,  0x6d,
                   0x2,  0x23, 0xd7, 0x6d, 0x2a, 0xb6, 0x93, 0x24, 0x5,  0x3e, 0x19, 0x7d, 0x19, 0x5a, 0x2,
                   0x0,  0x0,  0x2,  0xcc, 0x21, 0x2a, 0x63, 0x21, 0x5a, 0xaf, 0x8,  0x0,  0x19, 0x46, 0x4c,
                   0x7d, 0xa3, 0xf4, 0xe4, 0x78, 0x4,  0xbe, 0x19, 0x98, 0x3b, 0x39, 0x46, 0x6f, 0x28, 0x13,
                   0x79, 0xe7, 0xa,  0xed, 0xc2, 0x9d, 0x70, 0x91, 0x1a, 0x0,  0xd,  0x81, 0x8,  0x2,  0xf1,
                   0x43, 0x15, 0xbd, 0xa9, 0x18, 0x49, 0xa3, 0xf0, 0xa2, 0x0,  0x12, 0x71, 0xdf, 0x66, 0x56,
                   0x34, 0x17, 0xcd, 0x8b, 0x28, 0x5,  0x60, 0xcc, 0x91, 0xce, 0xdd, 0xcf, 0xf8, 0xf5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x98, 0x6e, 0x21, 0xe0, 0x88, 0xf1, 0xd,  0x6d, 0x2,
                           0x23, 0xd7, 0x6d, 0x2a, 0xb6, 0x93, 0x24, 0x5,  0x3e};
  uint8_t bytesprops0[] = {0xa9, 0xf2};
  uint8_t bytesprops2[] = {0x46, 0x4c, 0x7d, 0xa3, 0xf4, 0xe4, 0x78, 0x4,  0xbe, 0x19, 0x98, 0x3b, 0x39,
                           0x46, 0x6f, 0x28, 0x13, 0x79, 0xe7, 0xa,  0xed, 0xc2, 0x9d, 0x70, 0x91};
  uint8_t bytesprops3[] = {0x81, 0x8, 0x2, 0xf1, 0x43, 0x15, 0xbd, 0xa9, 0x18, 0x49, 0xa3, 0xf0, 0xa2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11580}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22087}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops0}, .v = {18, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 716}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10851}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23215}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0xdf, 0x66, 0x56, 0x34, 0x17, 0xcd, 0x8b, 0x28,
                                     0x5,  0x60, 0xcc, 0x91, 0xce, 0xdd, 0xcf, 0xf8, 0xf5};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27989, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 32178
// ["k\238\167\&3}\189\230\213?\DC3gW\142\236\196\STX\221\176\151\150\233","\174\208{E\236","&\174#!)\239\207\EOT\192Rr\155\145","\239\248\168\STXO\\~\184\&3\RS'*l\DLE\246\168^\a\173\137\&2\139G\SYN\218\170\152ELh","\206N\152\&2x\DC1\205\128\249\189\CAN\200_\228\162\207\RS\149"]
// [PropContentType "_B\STX#\201\223V\215:7P\211q\STX\170t\SI\158",PropRequestProblemInformation
// 63,PropResponseInformation "\228\252\173",PropReceiveMaximum 22471,PropServerKeepAlive 3410,PropTopicAliasMaximum
// 16631,PropUserProperty "\160\238\190\135\&5A5\DC1\165\160*U\CANm\219\142N}\SYN\n\SO\CAN\142\212\129\153u\136\152\166"
// "Q\150\242\210\142X\RS\192\ETBg\EOT\166\134\248\&8Wu\255\ACK\254\169_",PropRetainAvailable 249,PropTopicAlias
// 2742,PropMessageExpiryInterval 1062,PropServerReference
// "\149:\172\&6\226\221\243pn\nP\222\241t{\192",PropSharedSubscriptionAvailable 98,PropWillDelayInterval 4817]
TEST(Unsubscribe5QCTest, Encode11) {
  uint8_t pkt[] = {0xa2, 0xe8, 0x1,  0x7d, 0xb2, 0x83, 0x1,  0x3,  0x0,  0x12, 0x5f, 0x42, 0x2,  0x23, 0xc9, 0xdf, 0x56,
                   0xd7, 0x3a, 0x37, 0x50, 0xd3, 0x71, 0x2,  0xaa, 0x74, 0xf,  0x9e, 0x17, 0x3f, 0x1a, 0x0,  0x3,  0xe4,
                   0xfc, 0xad, 0x21, 0x57, 0xc7, 0x13, 0xd,  0x52, 0x22, 0x40, 0xf7, 0x26, 0x0,  0x1e, 0xa0, 0xee, 0xbe,
                   0x87, 0x35, 0x41, 0x35, 0x11, 0xa5, 0xa0, 0x2a, 0x55, 0x18, 0x6d, 0xdb, 0x8e, 0x4e, 0x7d, 0x16, 0xa,
                   0xe,  0x18, 0x8e, 0xd4, 0x81, 0x99, 0x75, 0x88, 0x98, 0xa6, 0x0,  0x16, 0x51, 0x96, 0xf2, 0xd2, 0x8e,
                   0x58, 0x1e, 0xc0, 0x17, 0x67, 0x4,  0xa6, 0x86, 0xf8, 0x38, 0x57, 0x75, 0xff, 0x6,  0xfe, 0xa9, 0x5f,
                   0x25, 0xf9, 0x23, 0xa,  0xb6, 0x2,  0x0,  0x0,  0x4,  0x26, 0x1c, 0x0,  0x10, 0x95, 0x3a, 0xac, 0x36,
                   0xe2, 0xdd, 0xf3, 0x70, 0x6e, 0xa,  0x50, 0xde, 0xf1, 0x74, 0x7b, 0xc0, 0x2a, 0x62, 0x18, 0x0,  0x0,
                   0x12, 0xd1, 0x0,  0x15, 0x6b, 0xee, 0xa7, 0x33, 0x7d, 0xbd, 0xe6, 0xd5, 0x3f, 0x13, 0x67, 0x57, 0x8e,
                   0xec, 0xc4, 0x2,  0xdd, 0xb0, 0x97, 0x96, 0xe9, 0x0,  0x5,  0xae, 0xd0, 0x7b, 0x45, 0xec, 0x0,  0xd,
                   0x26, 0xae, 0x23, 0x21, 0x29, 0xef, 0xcf, 0x4,  0xc0, 0x52, 0x72, 0x9b, 0x91, 0x0,  0x1e, 0xef, 0xf8,
                   0xa8, 0x2,  0x4f, 0x5c, 0x7e, 0xb8, 0x33, 0x1e, 0x27, 0x2a, 0x6c, 0x10, 0xf6, 0xa8, 0x5e, 0x7,  0xad,
                   0x89, 0x32, 0x8b, 0x47, 0x16, 0xda, 0xaa, 0x98, 0x45, 0x4c, 0x68, 0x0,  0x12, 0xce, 0x4e, 0x98, 0x32,
                   0x78, 0x11, 0xcd, 0x80, 0xf9, 0xbd, 0x18, 0xc8, 0x5f, 0xe4, 0xa2, 0xcf, 0x1e, 0x95};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5f, 0x42, 0x2,  0x23, 0xc9, 0xdf, 0x56, 0xd7, 0x3a,
                           0x37, 0x50, 0xd3, 0x71, 0x2,  0xaa, 0x74, 0xf,  0x9e};
  uint8_t bytesprops1[] = {0xe4, 0xfc, 0xad};
  uint8_t bytesprops3[] = {0x51, 0x96, 0xf2, 0xd2, 0x8e, 0x58, 0x1e, 0xc0, 0x17, 0x67, 0x4,
                           0xa6, 0x86, 0xf8, 0x38, 0x57, 0x75, 0xff, 0x6,  0xfe, 0xa9, 0x5f};
  uint8_t bytesprops2[] = {0xa0, 0xee, 0xbe, 0x87, 0x35, 0x41, 0x35, 0x11, 0xa5, 0xa0, 0x2a, 0x55, 0x18, 0x6d, 0xdb,
                           0x8e, 0x4e, 0x7d, 0x16, 0xa,  0xe,  0x18, 0x8e, 0xd4, 0x81, 0x99, 0x75, 0x88, 0x98, 0xa6};
  uint8_t bytesprops4[] = {0x95, 0x3a, 0xac, 0x36, 0xe2, 0xdd, 0xf3, 0x70,
                           0x6e, 0xa,  0x50, 0xde, 0xf1, 0x74, 0x7b, 0xc0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22471}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3410}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16631}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops2}, .v = {22, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2742}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1062}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4817}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0xee, 0xa7, 0x33, 0x7d, 0xbd, 0xe6, 0xd5, 0x3f, 0x13, 0x67,
                                     0x57, 0x8e, 0xec, 0xc4, 0x2,  0xdd, 0xb0, 0x97, 0x96, 0xe9};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xae, 0xd0, 0x7b, 0x45, 0xec};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x26, 0xae, 0x23, 0x21, 0x29, 0xef, 0xcf, 0x4, 0xc0, 0x52, 0x72, 0x9b, 0x91};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xef, 0xf8, 0xa8, 0x2,  0x4f, 0x5c, 0x7e, 0xb8, 0x33, 0x1e,
                                     0x27, 0x2a, 0x6c, 0x10, 0xf6, 0xa8, 0x5e, 0x7,  0xad, 0x89,
                                     0x32, 0x8b, 0x47, 0x16, 0xda, 0xaa, 0x98, 0x45, 0x4c, 0x68};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xce, 0x4e, 0x98, 0x32, 0x78, 0x11, 0xcd, 0x80, 0xf9,
                                     0xbd, 0x18, 0xc8, 0x5f, 0xe4, 0xa2, 0xcf, 0x1e, 0x95};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32178, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17769 ["\192d\222\&2>\213\ESC_d\SUB\DC1N"] [PropMessageExpiryInterval 26793,PropMaximumPacketSize
// 6142,PropWillDelayInterval 30684,PropWillDelayInterval 12528,PropRequestProblemInformation
// 12,PropSharedSubscriptionAvailable 30,PropRequestResponseInformation 168,PropMessageExpiryInterval
// 9680,PropWillDelayInterval 2551,PropMaximumPacketSize 18149,PropServerReference
// "\139$\196\137",PropMessageExpiryInterval 27206,PropUserProperty "\NAKz\220\&5PE\229\206I\222\158,\195\230\t\t\210"
// "\DLEp\\\SOH\233r\"\n,\248:"]
TEST(Unsubscribe5QCTest, Encode12) {
  uint8_t pkt[] = {0xa2, 0x67, 0x45, 0x69, 0x56, 0x2,  0x0,  0x0,  0x68, 0xa9, 0x27, 0x0,  0x0,  0x17, 0xfe,
                   0x18, 0x0,  0x0,  0x77, 0xdc, 0x18, 0x0,  0x0,  0x30, 0xf0, 0x17, 0xc,  0x2a, 0x1e, 0x19,
                   0xa8, 0x2,  0x0,  0x0,  0x25, 0xd0, 0x18, 0x0,  0x0,  0x9,  0xf7, 0x27, 0x0,  0x0,  0x46,
                   0xe5, 0x1c, 0x0,  0x4,  0x8b, 0x24, 0xc4, 0x89, 0x2,  0x0,  0x0,  0x6a, 0x46, 0x26, 0x0,
                   0x11, 0x15, 0x7a, 0xdc, 0x35, 0x50, 0x45, 0xe5, 0xce, 0x49, 0xde, 0x9e, 0x2c, 0xc3, 0xe6,
                   0x9,  0x9,  0xd2, 0x0,  0xb,  0x10, 0x70, 0x5c, 0x1,  0xe9, 0x72, 0x22, 0xa,  0x2c, 0xf8,
                   0x3a, 0x0,  0xc,  0xc0, 0x64, 0xde, 0x32, 0x3e, 0xd5, 0x1b, 0x5f, 0x64, 0x1a, 0x11, 0x4e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8b, 0x24, 0xc4, 0x89};
  uint8_t bytesprops2[] = {0x10, 0x70, 0x5c, 0x1, 0xe9, 0x72, 0x22, 0xa, 0x2c, 0xf8, 0x3a};
  uint8_t bytesprops1[] = {0x15, 0x7a, 0xdc, 0x35, 0x50, 0x45, 0xe5, 0xce, 0x49,
                           0xde, 0x9e, 0x2c, 0xc3, 0xe6, 0x9,  0x9,  0xd2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26793}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6142}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30684}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12528}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9680}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2551}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18149}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27206}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xc0, 0x64, 0xde, 0x32, 0x3e, 0xd5, 0x1b, 0x5f, 0x64, 0x1a, 0x11, 0x4e};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17769, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 21908
// ["$","\GSI\141^\185\188\DC2|\159M\189\209\DC4\211\&1","L\t}\130~\220\&8\211\235","\210\USg\203\179@\DC2\174l\v\193\DC2)Q\233\STX#\177C\164\ENQ&@;=\238\138\217\158"]
// [PropRequestResponseInformation 28,PropResponseTopic
// "\172\213\248F\182$\184f\232\184\224\135\173\187",PropAssignedClientIdentifier
// "\200\DLE\205\216\204djT^\210/\170heT|l\251\SO\183f",PropWildcardSubscriptionAvailable 188,PropMessageExpiryInterval
// 9268,PropPayloadFormatIndicator 31,PropRequestResponseInformation 161,PropSharedSubscriptionAvailable
// 221,PropRequestResponseInformation 19,PropRequestResponseInformation 157,PropResponseInformation
// "\157\197\145\138\215\192\149\208",PropReceiveMaximum 11044,PropSubscriptionIdentifierAvailable 188,PropTopicAlias
// 21441,PropRequestResponseInformation 200,PropSubscriptionIdentifierAvailable 174,PropMessageExpiryInterval
// 16750,PropMaximumQoS 214,PropTopicAlias 14613,PropRetainAvailable 254,PropCorrelationData
// "\202\168j",PropUserProperty "'\171b\132\201Q\185\SYN"
// "\167\180\128\200\254\ETX\187R\231\199\175\182\250",PropRequestProblemInformation 61,PropAuthenticationData
// "JF\RS\149[\DEL\221\240",PropServerKeepAlive 25680,PropSessionExpiryInterval 24444]
TEST(Unsubscribe5QCTest, Encode13) {
  uint8_t pkt[] = {0xa2, 0xd6, 0x1,  0x55, 0x94, 0x94, 0x1,  0x19, 0x1c, 0x8,  0x0,  0xe,  0xac, 0xd5, 0xf8, 0x46, 0xb6,
                   0x24, 0xb8, 0x66, 0xe8, 0xb8, 0xe0, 0x87, 0xad, 0xbb, 0x12, 0x0,  0x15, 0xc8, 0x10, 0xcd, 0xd8, 0xcc,
                   0x64, 0x6a, 0x54, 0x5e, 0xd2, 0x2f, 0xaa, 0x68, 0x65, 0x54, 0x7c, 0x6c, 0xfb, 0xe,  0xb7, 0x66, 0x28,
                   0xbc, 0x2,  0x0,  0x0,  0x24, 0x34, 0x1,  0x1f, 0x19, 0xa1, 0x2a, 0xdd, 0x19, 0x13, 0x19, 0x9d, 0x1a,
                   0x0,  0x8,  0x9d, 0xc5, 0x91, 0x8a, 0xd7, 0xc0, 0x95, 0xd0, 0x21, 0x2b, 0x24, 0x29, 0xbc, 0x23, 0x53,
                   0xc1, 0x19, 0xc8, 0x29, 0xae, 0x2,  0x0,  0x0,  0x41, 0x6e, 0x24, 0xd6, 0x23, 0x39, 0x15, 0x25, 0xfe,
                   0x9,  0x0,  0x3,  0xca, 0xa8, 0x6a, 0x26, 0x0,  0x8,  0x27, 0xab, 0x62, 0x84, 0xc9, 0x51, 0xb9, 0x16,
                   0x0,  0xd,  0xa7, 0xb4, 0x80, 0xc8, 0xfe, 0x3,  0xbb, 0x52, 0xe7, 0xc7, 0xaf, 0xb6, 0xfa, 0x17, 0x3d,
                   0x16, 0x0,  0x8,  0x4a, 0x46, 0x1e, 0x95, 0x5b, 0x7f, 0xdd, 0xf0, 0x13, 0x64, 0x50, 0x11, 0x0,  0x0,
                   0x5f, 0x7c, 0x0,  0x1,  0x24, 0x0,  0xf,  0x1d, 0x49, 0x8d, 0x5e, 0xb9, 0xbc, 0x12, 0x7c, 0x9f, 0x4d,
                   0xbd, 0xd1, 0x14, 0xd3, 0x31, 0x0,  0x9,  0x4c, 0x9,  0x7d, 0x82, 0x7e, 0xdc, 0x38, 0xd3, 0xeb, 0x0,
                   0x1d, 0xd2, 0x1f, 0x67, 0xcb, 0xb3, 0x40, 0x12, 0xae, 0x6c, 0xb,  0xc1, 0x12, 0x29, 0x51, 0xe9, 0x2,
                   0x23, 0xb1, 0x43, 0xa4, 0x5,  0x26, 0x40, 0x3b, 0x3d, 0xee, 0x8a, 0xd9, 0x9e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xac, 0xd5, 0xf8, 0x46, 0xb6, 0x24, 0xb8, 0x66, 0xe8, 0xb8, 0xe0, 0x87, 0xad, 0xbb};
  uint8_t bytesprops1[] = {0xc8, 0x10, 0xcd, 0xd8, 0xcc, 0x64, 0x6a, 0x54, 0x5e, 0xd2, 0x2f,
                           0xaa, 0x68, 0x65, 0x54, 0x7c, 0x6c, 0xfb, 0xe,  0xb7, 0x66};
  uint8_t bytesprops2[] = {0x9d, 0xc5, 0x91, 0x8a, 0xd7, 0xc0, 0x95, 0xd0};
  uint8_t bytesprops3[] = {0xca, 0xa8, 0x6a};
  uint8_t bytesprops5[] = {0xa7, 0xb4, 0x80, 0xc8, 0xfe, 0x3, 0xbb, 0x52, 0xe7, 0xc7, 0xaf, 0xb6, 0xfa};
  uint8_t bytesprops4[] = {0x27, 0xab, 0x62, 0x84, 0xc9, 0x51, 0xb9, 0x16};
  uint8_t bytesprops6[] = {0x4a, 0x46, 0x1e, 0x95, 0x5b, 0x7f, 0xdd, 0xf0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9268}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11044}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21441}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16750}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14613}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops4}, .v = {13, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25680}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24444}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x24};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1d, 0x49, 0x8d, 0x5e, 0xb9, 0xbc, 0x12, 0x7c,
                                     0x9f, 0x4d, 0xbd, 0xd1, 0x14, 0xd3, 0x31};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4c, 0x9, 0x7d, 0x82, 0x7e, 0xdc, 0x38, 0xd3, 0xeb};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd2, 0x1f, 0x67, 0xcb, 0xb3, 0x40, 0x12, 0xae, 0x6c, 0xb,
                                     0xc1, 0x12, 0x29, 0x51, 0xe9, 0x2,  0x23, 0xb1, 0x43, 0xa4,
                                     0x5,  0x26, 0x40, 0x3b, 0x3d, 0xee, 0x8a, 0xd9, 0x9e};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21908, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 12542 ["j\251j\160\243\235
// \r\246R\192\234l\DC2.\153\144v\NAK\RSXz\DEL:","\DC4\SYN\240\227S!\ETX\ETBS\179\245t\185D+\225\&3n~\146z\194\143"]
// [PropSharedSubscriptionAvailable 1,PropTopicAlias 16745,PropAuthenticationMethod
// "\171\212\181\188\130\NUL\DC2\STXn\186\RS\141j\184a1\DC3 y1",PropWildcardSubscriptionAvailable
// 120,PropResponseInformation "\222\159\143",PropServerReference "\200K\SUB\175-2_x\136\&8
// \218O\211|\151\129z~`\252i\244\255\230",PropRequestProblemInformation 76,PropRequestProblemInformation
// 170,PropMessageExpiryInterval 14379,PropMessageExpiryInterval 11089,PropMaximumQoS 130,PropRequestResponseInformation
// 159,PropMaximumQoS 250,PropCorrelationData
// "\159\FSB\166\ETBt\182\131\213.~Y\230\178\180\214\SIC\175\136\DC2",PropSharedSubscriptionAvailable
// 185,PropTopicAliasMaximum 24719,PropWillDelayInterval 9537,PropRequestResponseInformation 18,PropContentType
// ":\140G\146\240;\134\RSn*\DC1\143d\177\225\153\SUBRo\178\&8\248|:\SI\145\129\180",PropRequestResponseInformation
// 228,PropReceiveMaximum 973]
TEST(Unsubscribe5QCTest, Encode14) {
  uint8_t pkt[] = {0xa2, 0xd3, 0x1,  0x30, 0xfe, 0x9c, 0x1,  0x2a, 0x1,  0x23, 0x41, 0x69, 0x15, 0x0,  0x14, 0xab, 0xd4,
                   0xb5, 0xbc, 0x82, 0x0,  0x12, 0x2,  0x6e, 0xba, 0x1e, 0x8d, 0x6a, 0xb8, 0x61, 0x31, 0x13, 0x20, 0x79,
                   0x31, 0x28, 0x78, 0x1a, 0x0,  0x3,  0xde, 0x9f, 0x8f, 0x1c, 0x0,  0x19, 0xc8, 0x4b, 0x1a, 0xaf, 0x2d,
                   0x32, 0x5f, 0x78, 0x88, 0x38, 0x20, 0xda, 0x4f, 0xd3, 0x7c, 0x97, 0x81, 0x7a, 0x7e, 0x60, 0xfc, 0x69,
                   0xf4, 0xff, 0xe6, 0x17, 0x4c, 0x17, 0xaa, 0x2,  0x0,  0x0,  0x38, 0x2b, 0x2,  0x0,  0x0,  0x2b, 0x51,
                   0x24, 0x82, 0x19, 0x9f, 0x24, 0xfa, 0x9,  0x0,  0x15, 0x9f, 0x1c, 0x42, 0xa6, 0x17, 0x74, 0xb6, 0x83,
                   0xd5, 0x2e, 0x7e, 0x59, 0xe6, 0xb2, 0xb4, 0xd6, 0xf,  0x43, 0xaf, 0x88, 0x12, 0x2a, 0xb9, 0x22, 0x60,
                   0x8f, 0x18, 0x0,  0x0,  0x25, 0x41, 0x19, 0x12, 0x3,  0x0,  0x1c, 0x3a, 0x8c, 0x47, 0x92, 0xf0, 0x3b,
                   0x86, 0x1e, 0x6e, 0x2a, 0x11, 0x8f, 0x64, 0xb1, 0xe1, 0x99, 0x1a, 0x52, 0x6f, 0xb2, 0x38, 0xf8, 0x7c,
                   0x3a, 0xf,  0x91, 0x81, 0xb4, 0x19, 0xe4, 0x21, 0x3,  0xcd, 0x0,  0x18, 0x6a, 0xfb, 0x6a, 0xa0, 0xf3,
                   0xeb, 0x20, 0xd,  0xf6, 0x52, 0xc0, 0xea, 0x6c, 0x12, 0x2e, 0x99, 0x90, 0x76, 0x15, 0x1e, 0x58, 0x7a,
                   0x7f, 0x3a, 0x0,  0x17, 0x14, 0x16, 0xf0, 0xe3, 0x53, 0x21, 0x3,  0x17, 0x53, 0xb3, 0xf5, 0x74, 0xb9,
                   0x44, 0x2b, 0xe1, 0x33, 0x6e, 0x7e, 0x92, 0x7a, 0xc2, 0x8f};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xab, 0xd4, 0xb5, 0xbc, 0x82, 0x0,  0x12, 0x2,  0x6e, 0xba,
                           0x1e, 0x8d, 0x6a, 0xb8, 0x61, 0x31, 0x13, 0x20, 0x79, 0x31};
  uint8_t bytesprops1[] = {0xde, 0x9f, 0x8f};
  uint8_t bytesprops2[] = {0xc8, 0x4b, 0x1a, 0xaf, 0x2d, 0x32, 0x5f, 0x78, 0x88, 0x38, 0x20, 0xda, 0x4f,
                           0xd3, 0x7c, 0x97, 0x81, 0x7a, 0x7e, 0x60, 0xfc, 0x69, 0xf4, 0xff, 0xe6};
  uint8_t bytesprops3[] = {0x9f, 0x1c, 0x42, 0xa6, 0x17, 0x74, 0xb6, 0x83, 0xd5, 0x2e, 0x7e,
                           0x59, 0xe6, 0xb2, 0xb4, 0xd6, 0xf,  0x43, 0xaf, 0x88, 0x12};
  uint8_t bytesprops4[] = {0x3a, 0x8c, 0x47, 0x92, 0xf0, 0x3b, 0x86, 0x1e, 0x6e, 0x2a, 0x11, 0x8f, 0x64, 0xb1,
                           0xe1, 0x99, 0x1a, 0x52, 0x6f, 0xb2, 0x38, 0xf8, 0x7c, 0x3a, 0xf,  0x91, 0x81, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16745}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14379}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11089}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24719}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9537}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 973}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x6a, 0xfb, 0x6a, 0xa0, 0xf3, 0xeb, 0x20, 0xd,  0xf6, 0x52, 0xc0, 0xea,
                                     0x6c, 0x12, 0x2e, 0x99, 0x90, 0x76, 0x15, 0x1e, 0x58, 0x7a, 0x7f, 0x3a};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x14, 0x16, 0xf0, 0xe3, 0x53, 0x21, 0x3,  0x17, 0x53, 0xb3, 0xf5, 0x74,
                                     0xb9, 0x44, 0x2b, 0xe1, 0x33, 0x6e, 0x7e, 0x92, 0x7a, 0xc2, 0x8f};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12542, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22335 ["\171r\247N1\218","4\149\209gL^\241\220\171\227{YRF8\184,\212\205\157"] [PropTopicAlias
// 10559,PropContentType "\211M\158\190",PropPayloadFormatIndicator 171,PropServerKeepAlive
// 3533,PropSubscriptionIdentifier 8,PropRequestResponseInformation 48,PropSubscriptionIdentifierAvailable
// 232,PropPayloadFormatIndicator 146,PropMessageExpiryInterval 26688,PropWillDelayInterval
// 11039,PropSubscriptionIdentifierAvailable 95,PropServerKeepAlive 27841,PropAuthenticationMethod
// "4c:\156-\214\161M\223\212\EOT\168\b",PropServerReference "\f\249\&0\EOT\154"]
TEST(Unsubscribe5QCTest, Encode15) {
  uint8_t pkt[] = {0xa2, 0x5f, 0x57, 0x3f, 0x3e, 0x23, 0x29, 0x3f, 0x3,  0x0,  0x4,  0xd3, 0x4d, 0x9e, 0xbe, 0x1,  0xab,
                   0x13, 0xd,  0xcd, 0xb,  0x8,  0x19, 0x30, 0x29, 0xe8, 0x1,  0x92, 0x2,  0x0,  0x0,  0x68, 0x40, 0x18,
                   0x0,  0x0,  0x2b, 0x1f, 0x29, 0x5f, 0x13, 0x6c, 0xc1, 0x15, 0x0,  0xd,  0x34, 0x63, 0x3a, 0x9c, 0x2d,
                   0xd6, 0xa1, 0x4d, 0xdf, 0xd4, 0x4,  0xa8, 0x8,  0x1c, 0x0,  0x5,  0xc,  0xf9, 0x30, 0x4,  0x9a, 0x0,
                   0x6,  0xab, 0x72, 0xf7, 0x4e, 0x31, 0xda, 0x0,  0x14, 0x34, 0x95, 0xd1, 0x67, 0x4c, 0x5e, 0xf1, 0xdc,
                   0xab, 0xe3, 0x7b, 0x59, 0x52, 0x46, 0x38, 0xb8, 0x2c, 0xd4, 0xcd, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd3, 0x4d, 0x9e, 0xbe};
  uint8_t bytesprops1[] = {0x34, 0x63, 0x3a, 0x9c, 0x2d, 0xd6, 0xa1, 0x4d, 0xdf, 0xd4, 0x4, 0xa8, 0x8};
  uint8_t bytesprops2[] = {0xc, 0xf9, 0x30, 0x4, 0x9a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10559}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3533}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26688}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11039}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27841}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x72, 0xf7, 0x4e, 0x31, 0xda};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x34, 0x95, 0xd1, 0x67, 0x4c, 0x5e, 0xf1, 0xdc, 0xab, 0xe3,
                                     0x7b, 0x59, 0x52, 0x46, 0x38, 0xb8, 0x2c, 0xd4, 0xcd, 0x9d};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22335, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 6771
// ["\135\US\219/\163+\FS-","\161\136\131Y\CAN\230t&\196\174\&4-\f\129\155\189N\211c\233\235q\138\227\250O\148\222\&3","JJ4\DEL\247{\189\166\DLE5\241-\195\141X\tN\138\248\171\247(\202Z\231\&6C\255","\182\r\144B[\233\NAK\194\179{\177\&6\206o\172h","","\163,+n\168M\SO\184\180","?\146X+Lw\191\EM\209\t\174\211\160s\192Fa\237\195\212\&1DY\131\163","z\255\213\SUBvQ\236M\152\208\149h","\137\237\131\198XD\SO^P\207\227\146\248\240\227}&\141\142v>\GS","\192\221\160N\167e\"R<\142",""]
// [PropRequestProblemInformation 48,PropSharedSubscriptionAvailable 181,PropRequestProblemInformation
// 98,PropMaximumPacketSize 23754,PropMaximumPacketSize 5686,PropTopicAlias 13579,PropRequestProblemInformation
// 156,PropMaximumPacketSize 28901,PropAssignedClientIdentifier "$m\243",PropServerKeepAlive 735,PropWillDelayInterval
// 24039,PropCorrelationData "d\190/\128%$\147\136\193U\141%\223\ENQ\218r\CAN",PropRetainAvailable 178,PropTopicAlias
// 30758,PropMessageExpiryInterval 10917,PropWildcardSubscriptionAvailable 54,PropContentType
// "\236\179^\ETB\151\159\FSd&I\139"]
TEST(Unsubscribe5QCTest, Encode16) {
  uint8_t pkt[] = {
      0xa2, 0x8e, 0x2,  0x1a, 0x73, 0x56, 0x17, 0x30, 0x2a, 0xb5, 0x17, 0x62, 0x27, 0x0,  0x0,  0x5c, 0xca, 0x27, 0x0,
      0x0,  0x16, 0x36, 0x23, 0x35, 0xb,  0x17, 0x9c, 0x27, 0x0,  0x0,  0x70, 0xe5, 0x12, 0x0,  0x3,  0x24, 0x6d, 0xf3,
      0x13, 0x2,  0xdf, 0x18, 0x0,  0x0,  0x5d, 0xe7, 0x9,  0x0,  0x11, 0x64, 0xbe, 0x2f, 0x80, 0x25, 0x24, 0x93, 0x88,
      0xc1, 0x55, 0x8d, 0x25, 0xdf, 0x5,  0xda, 0x72, 0x18, 0x25, 0xb2, 0x23, 0x78, 0x26, 0x2,  0x0,  0x0,  0x2a, 0xa5,
      0x28, 0x36, 0x3,  0x0,  0xb,  0xec, 0xb3, 0x5e, 0x17, 0x97, 0x9f, 0x1c, 0x64, 0x26, 0x49, 0x8b, 0x0,  0x8,  0x87,
      0x1f, 0xdb, 0x2f, 0xa3, 0x2b, 0x1c, 0x2d, 0x0,  0x1d, 0xa1, 0x88, 0x83, 0x59, 0x18, 0xe6, 0x74, 0x26, 0xc4, 0xae,
      0x34, 0x2d, 0xc,  0x81, 0x9b, 0xbd, 0x4e, 0xd3, 0x63, 0xe9, 0xeb, 0x71, 0x8a, 0xe3, 0xfa, 0x4f, 0x94, 0xde, 0x33,
      0x0,  0x1c, 0x4a, 0x4a, 0x34, 0x7f, 0xf7, 0x7b, 0xbd, 0xa6, 0x10, 0x35, 0xf1, 0x2d, 0xc3, 0x8d, 0x58, 0x9,  0x4e,
      0x8a, 0xf8, 0xab, 0xf7, 0x28, 0xca, 0x5a, 0xe7, 0x36, 0x43, 0xff, 0x0,  0x10, 0xb6, 0xd,  0x90, 0x42, 0x5b, 0xe9,
      0x15, 0xc2, 0xb3, 0x7b, 0xb1, 0x36, 0xce, 0x6f, 0xac, 0x68, 0x0,  0x0,  0x0,  0x9,  0xa3, 0x2c, 0x2b, 0x6e, 0xa8,
      0x4d, 0xe,  0xb8, 0xb4, 0x0,  0x19, 0x3f, 0x92, 0x58, 0x2b, 0x4c, 0x77, 0xbf, 0x19, 0xd1, 0x9,  0xae, 0xd3, 0xa0,
      0x73, 0xc0, 0x46, 0x61, 0xed, 0xc3, 0xd4, 0x31, 0x44, 0x59, 0x83, 0xa3, 0x0,  0xc,  0x7a, 0xff, 0xd5, 0x1a, 0x76,
      0x51, 0xec, 0x4d, 0x98, 0xd0, 0x95, 0x68, 0x0,  0x16, 0x89, 0xed, 0x83, 0xc6, 0x58, 0x44, 0xe,  0x5e, 0x50, 0xcf,
      0xe3, 0x92, 0xf8, 0xf0, 0xe3, 0x7d, 0x26, 0x8d, 0x8e, 0x76, 0x3e, 0x1d, 0x0,  0xa,  0xc0, 0xdd, 0xa0, 0x4e, 0xa7,
      0x65, 0x22, 0x52, 0x3c, 0x8e, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x24, 0x6d, 0xf3};
  uint8_t bytesprops1[] = {0x64, 0xbe, 0x2f, 0x80, 0x25, 0x24, 0x93, 0x88, 0xc1,
                           0x55, 0x8d, 0x25, 0xdf, 0x5,  0xda, 0x72, 0x18};
  uint8_t bytesprops2[] = {0xec, 0xb3, 0x5e, 0x17, 0x97, 0x9f, 0x1c, 0x64, 0x26, 0x49, 0x8b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23754}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5686}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13579}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28901}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 735}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24039}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30758}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10917}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x87, 0x1f, 0xdb, 0x2f, 0xa3, 0x2b, 0x1c, 0x2d};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa1, 0x88, 0x83, 0x59, 0x18, 0xe6, 0x74, 0x26, 0xc4, 0xae,
                                     0x34, 0x2d, 0xc,  0x81, 0x9b, 0xbd, 0x4e, 0xd3, 0x63, 0xe9,
                                     0xeb, 0x71, 0x8a, 0xe3, 0xfa, 0x4f, 0x94, 0xde, 0x33};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4a, 0x4a, 0x34, 0x7f, 0xf7, 0x7b, 0xbd, 0xa6, 0x10, 0x35,
                                     0xf1, 0x2d, 0xc3, 0x8d, 0x58, 0x9,  0x4e, 0x8a, 0xf8, 0xab,
                                     0xf7, 0x28, 0xca, 0x5a, 0xe7, 0x36, 0x43, 0xff};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0xd,  0x90, 0x42, 0x5b, 0xe9, 0x15, 0xc2,
                                     0xb3, 0x7b, 0xb1, 0x36, 0xce, 0x6f, 0xac, 0x68};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa3, 0x2c, 0x2b, 0x6e, 0xa8, 0x4d, 0xe, 0xb8, 0xb4};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3f, 0x92, 0x58, 0x2b, 0x4c, 0x77, 0xbf, 0x19, 0xd1, 0x9,  0xae, 0xd3, 0xa0,
                                     0x73, 0xc0, 0x46, 0x61, 0xed, 0xc3, 0xd4, 0x31, 0x44, 0x59, 0x83, 0xa3};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7a, 0xff, 0xd5, 0x1a, 0x76, 0x51, 0xec, 0x4d, 0x98, 0xd0, 0x95, 0x68};
  lwmqtt_string_t topic_filter_s7 = {12, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x89, 0xed, 0x83, 0xc6, 0x58, 0x44, 0xe,  0x5e, 0x50, 0xcf, 0xe3,
                                     0x92, 0xf8, 0xf0, 0xe3, 0x7d, 0x26, 0x8d, 0x8e, 0x76, 0x3e, 0x1d};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xc0, 0xdd, 0xa0, 0x4e, 0xa7, 0x65, 0x22, 0x52, 0x3c, 0x8e};
  lwmqtt_string_t topic_filter_s9 = {10, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 6771, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 19984
// ["I|\192\176@\ETB\219a\254\217\n\238\172\EOT\202\143*?\ETB\130\172\174\CAN\DEL\177\163","~V\240~\192","b6\189\&0\244q","\143\166/\SO\r\r\240\212\181\136\172$\233\243\149\&70h_|\204\136
// \206\146\134\236\&6\179","\157\168\227\SOH\242\183\153\nO\235\DEL\aW\227\196\225\179\210s\174\FS\155(\t\137\158\229","\ESCl\130\ACK\135\&4,D\208\141\243s\n*F*","\170\194\223-H\208r]UF+\221\\.\187\225\135]x\218\140on\180\233","\194\f\246\&1n\154\DC1\195\170\161\232\152\185\222\ESC"]
// [PropServerReference "K\143\138",PropMaximumQoS 8,PropServerKeepAlive 1748,PropAuthenticationData
// "\t\128XT\154gS\137\155\169*\161T\235U%\210\GS\245\242B\247\155\181\172\179do",PropServerReference
// "\181K\177\155",PropMaximumQoS 21,PropMessageExpiryInterval 5656,PropResponseInformation
// "\193\250Wq\170\178",PropSubscriptionIdentifierAvailable 224,PropWildcardSubscriptionAvailable
// 4,PropMaximumPacketSize 12873,PropWildcardSubscriptionAvailable 89,PropMessageExpiryInterval
// 15950,PropWillDelayInterval 2869,PropRetainAvailable 154,PropResponseTopic "\168\227\153",PropRetainAvailable
// 219,PropServerReference "=r\180gs\232#\253\249\138\192\STX\250",PropMessageExpiryInterval 32704,PropWillDelayInterval
// 25062,PropReceiveMaximum 20057,PropContentType "\146@\169D}\ENQ\DC2a",PropRequestProblemInformation
// 29,PropWillDelayInterval 22196,PropPayloadFormatIndicator 196,PropPayloadFormatIndicator 88]
TEST(Unsubscribe5QCTest, Encode17) {
  uint8_t pkt[] = {
      0xa2, 0xbc, 0x2,  0x4e, 0x10, 0x93, 0x1,  0x1c, 0x0,  0x3,  0x4b, 0x8f, 0x8a, 0x24, 0x8,  0x13, 0x6,  0xd4, 0x16,
      0x0,  0x1c, 0x9,  0x80, 0x58, 0x54, 0x9a, 0x67, 0x53, 0x89, 0x9b, 0xa9, 0x2a, 0xa1, 0x54, 0xeb, 0x55, 0x25, 0xd2,
      0x1d, 0xf5, 0xf2, 0x42, 0xf7, 0x9b, 0xb5, 0xac, 0xb3, 0x64, 0x6f, 0x1c, 0x0,  0x4,  0xb5, 0x4b, 0xb1, 0x9b, 0x24,
      0x15, 0x2,  0x0,  0x0,  0x16, 0x18, 0x1a, 0x0,  0x6,  0xc1, 0xfa, 0x57, 0x71, 0xaa, 0xb2, 0x29, 0xe0, 0x28, 0x4,
      0x27, 0x0,  0x0,  0x32, 0x49, 0x28, 0x59, 0x2,  0x0,  0x0,  0x3e, 0x4e, 0x18, 0x0,  0x0,  0xb,  0x35, 0x25, 0x9a,
      0x8,  0x0,  0x3,  0xa8, 0xe3, 0x99, 0x25, 0xdb, 0x1c, 0x0,  0xd,  0x3d, 0x72, 0xb4, 0x67, 0x73, 0xe8, 0x23, 0xfd,
      0xf9, 0x8a, 0xc0, 0x2,  0xfa, 0x2,  0x0,  0x0,  0x7f, 0xc0, 0x18, 0x0,  0x0,  0x61, 0xe6, 0x21, 0x4e, 0x59, 0x3,
      0x0,  0x8,  0x92, 0x40, 0xa9, 0x44, 0x7d, 0x5,  0x12, 0x61, 0x17, 0x1d, 0x18, 0x0,  0x0,  0x56, 0xb4, 0x1,  0xc4,
      0x1,  0x58, 0x0,  0x1a, 0x49, 0x7c, 0xc0, 0xb0, 0x40, 0x17, 0xdb, 0x61, 0xfe, 0xd9, 0xa,  0xee, 0xac, 0x4,  0xca,
      0x8f, 0x2a, 0x3f, 0x17, 0x82, 0xac, 0xae, 0x18, 0x7f, 0xb1, 0xa3, 0x0,  0x5,  0x7e, 0x56, 0xf0, 0x7e, 0xc0, 0x0,
      0x6,  0x62, 0x36, 0xbd, 0x30, 0xf4, 0x71, 0x0,  0x1d, 0x8f, 0xa6, 0x2f, 0xe,  0xd,  0xd,  0xf0, 0xd4, 0xb5, 0x88,
      0xac, 0x24, 0xe9, 0xf3, 0x95, 0x37, 0x30, 0x68, 0x5f, 0x7c, 0xcc, 0x88, 0x20, 0xce, 0x92, 0x86, 0xec, 0x36, 0xb3,
      0x0,  0x1b, 0x9d, 0xa8, 0xe3, 0x1,  0xf2, 0xb7, 0x99, 0xa,  0x4f, 0xeb, 0x7f, 0x7,  0x57, 0xe3, 0xc4, 0xe1, 0xb3,
      0xd2, 0x73, 0xae, 0x1c, 0x9b, 0x28, 0x9,  0x89, 0x9e, 0xe5, 0x0,  0x10, 0x1b, 0x6c, 0x82, 0x6,  0x87, 0x34, 0x2c,
      0x44, 0xd0, 0x8d, 0xf3, 0x73, 0xa,  0x2a, 0x46, 0x2a, 0x0,  0x19, 0xaa, 0xc2, 0xdf, 0x2d, 0x48, 0xd0, 0x72, 0x5d,
      0x55, 0x46, 0x2b, 0xdd, 0x5c, 0x2e, 0xbb, 0xe1, 0x87, 0x5d, 0x78, 0xda, 0x8c, 0x6f, 0x6e, 0xb4, 0xe9, 0x0,  0xf,
      0xc2, 0xc,  0xf6, 0x31, 0x6e, 0x9a, 0x11, 0xc3, 0xaa, 0xa1, 0xe8, 0x98, 0xb9, 0xde, 0x1b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4b, 0x8f, 0x8a};
  uint8_t bytesprops1[] = {0x9,  0x80, 0x58, 0x54, 0x9a, 0x67, 0x53, 0x89, 0x9b, 0xa9, 0x2a, 0xa1, 0x54, 0xeb,
                           0x55, 0x25, 0xd2, 0x1d, 0xf5, 0xf2, 0x42, 0xf7, 0x9b, 0xb5, 0xac, 0xb3, 0x64, 0x6f};
  uint8_t bytesprops2[] = {0xb5, 0x4b, 0xb1, 0x9b};
  uint8_t bytesprops3[] = {0xc1, 0xfa, 0x57, 0x71, 0xaa, 0xb2};
  uint8_t bytesprops4[] = {0xa8, 0xe3, 0x99};
  uint8_t bytesprops5[] = {0x3d, 0x72, 0xb4, 0x67, 0x73, 0xe8, 0x23, 0xfd, 0xf9, 0x8a, 0xc0, 0x2, 0xfa};
  uint8_t bytesprops6[] = {0x92, 0x40, 0xa9, 0x44, 0x7d, 0x5, 0x12, 0x61};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1748}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5656}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12873}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15950}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2869}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32704}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25062}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20057}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22196}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 88}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x49, 0x7c, 0xc0, 0xb0, 0x40, 0x17, 0xdb, 0x61, 0xfe, 0xd9, 0xa,  0xee, 0xac,
                                     0x4,  0xca, 0x8f, 0x2a, 0x3f, 0x17, 0x82, 0xac, 0xae, 0x18, 0x7f, 0xb1, 0xa3};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7e, 0x56, 0xf0, 0x7e, 0xc0};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x62, 0x36, 0xbd, 0x30, 0xf4, 0x71};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8f, 0xa6, 0x2f, 0xe,  0xd,  0xd,  0xf0, 0xd4, 0xb5, 0x88,
                                     0xac, 0x24, 0xe9, 0xf3, 0x95, 0x37, 0x30, 0x68, 0x5f, 0x7c,
                                     0xcc, 0x88, 0x20, 0xce, 0x92, 0x86, 0xec, 0x36, 0xb3};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9d, 0xa8, 0xe3, 0x1,  0xf2, 0xb7, 0x99, 0xa,  0x4f, 0xeb, 0x7f, 0x7,  0x57, 0xe3,
                                     0xc4, 0xe1, 0xb3, 0xd2, 0x73, 0xae, 0x1c, 0x9b, 0x28, 0x9,  0x89, 0x9e, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1b, 0x6c, 0x82, 0x6,  0x87, 0x34, 0x2c, 0x44,
                                     0xd0, 0x8d, 0xf3, 0x73, 0xa,  0x2a, 0x46, 0x2a};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xaa, 0xc2, 0xdf, 0x2d, 0x48, 0xd0, 0x72, 0x5d, 0x55, 0x46, 0x2b, 0xdd, 0x5c,
                                     0x2e, 0xbb, 0xe1, 0x87, 0x5d, 0x78, 0xda, 0x8c, 0x6f, 0x6e, 0xb4, 0xe9};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc2, 0xc,  0xf6, 0x31, 0x6e, 0x9a, 0x11, 0xc3,
                                     0xaa, 0xa1, 0xe8, 0x98, 0xb9, 0xde, 0x1b};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19984, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 8587
// ["^\158\181\192J\FS\249","\248\243\ACK\NULSg}\128\177\154\&2\SUB-\242\GS\229\t\NAK\US\189m\225\230I\FS","\SUB\194\179C\203\152","\244#\152\175\194\153\231\239\ETBD\146Q\248g\246w\143K\194\245\181","\DC4\tIs\155jp\197\SYN'1,G(P\NAK$\163\144\146\159\USY\194M\151\157\255","\236\159","\228\132\130\254\213\173\&1\202\&0\136\135\231\157\167p\199}\139\ETX
// \191\189\168\245\227\DC2}","\233mc\155K\b!\RSu\SUB","t\178\DEL\DELy\240\224\228\141\238\EOT\EM\153;\190\234","\128xS\199\240\228\&0R\vR\180\&3\217\179\162H\189%\192\247\195e\179t\RS\"x\DC1my","\246\ESC\248\136\ETX>\225\204\ACK\136\170\"\v\232\253\219\199=\ACK"]
// [PropMaximumQoS 241,PropServerKeepAlive 10894,PropResponseInformation "\FStN\244\173",PropContentType
// "`\183\173SH\237\225\251",PropResponseInformation "\227\226t\SYN\164\&6F \228\253\ENQ\177\SO\241\209/",PropTopicAlias
// 20782,PropSubscriptionIdentifierAvailable 123,PropWildcardSubscriptionAvailable 79,PropRetainAvailable
// 160,PropServerReference "\195\200\ETX\146\221/d\129h\135\SI+\241i",PropRequestProblemInformation
// 13,PropSessionExpiryInterval 10666,PropAuthenticationMethod
// "\250\"K\169\132\187\RS\252%\146\210\196\DC1Q\144\235\ESC\175\a\CAN=\155\170\157.",PropResponseTopic
// "\232d\215A",PropMaximumPacketSize 3468,PropReceiveMaximum 31173,PropContentType
// "\243\179\216\DC3\b\230",PropContentType "\197\223)\f",PropTopicAliasMaximum 15968,PropMessageExpiryInterval 26426]
TEST(Unsubscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0xa2, 0xe8, 0x2,  0x21, 0x8b, 0x8f, 0x1,  0x24, 0xf1, 0x13, 0x2a, 0x8e, 0x1a, 0x0,  0x5,  0x1c, 0x74, 0x4e, 0xf4,
      0xad, 0x3,  0x0,  0x8,  0x60, 0xb7, 0xad, 0x53, 0x48, 0xed, 0xe1, 0xfb, 0x1a, 0x0,  0x10, 0xe3, 0xe2, 0x74, 0x16,
      0xa4, 0x36, 0x46, 0x20, 0xe4, 0xfd, 0x5,  0xb1, 0xe,  0xf1, 0xd1, 0x2f, 0x23, 0x51, 0x2e, 0x29, 0x7b, 0x28, 0x4f,
      0x25, 0xa0, 0x1c, 0x0,  0xe,  0xc3, 0xc8, 0x3,  0x92, 0xdd, 0x2f, 0x64, 0x81, 0x68, 0x87, 0xf,  0x2b, 0xf1, 0x69,
      0x17, 0xd,  0x11, 0x0,  0x0,  0x29, 0xaa, 0x15, 0x0,  0x19, 0xfa, 0x22, 0x4b, 0xa9, 0x84, 0xbb, 0x1e, 0xfc, 0x25,
      0x92, 0xd2, 0xc4, 0x11, 0x51, 0x90, 0xeb, 0x1b, 0xaf, 0x7,  0x18, 0x3d, 0x9b, 0xaa, 0x9d, 0x2e, 0x8,  0x0,  0x4,
      0xe8, 0x64, 0xd7, 0x41, 0x27, 0x0,  0x0,  0xd,  0x8c, 0x21, 0x79, 0xc5, 0x3,  0x0,  0x6,  0xf3, 0xb3, 0xd8, 0x13,
      0x8,  0xe6, 0x3,  0x0,  0x4,  0xc5, 0xdf, 0x29, 0xc,  0x22, 0x3e, 0x60, 0x2,  0x0,  0x0,  0x67, 0x3a, 0x0,  0x7,
      0x5e, 0x9e, 0xb5, 0xc0, 0x4a, 0x1c, 0xf9, 0x0,  0x19, 0xf8, 0xf3, 0x6,  0x0,  0x53, 0x67, 0x7d, 0x80, 0xb1, 0x9a,
      0x32, 0x1a, 0x2d, 0xf2, 0x1d, 0xe5, 0x9,  0x15, 0x1f, 0xbd, 0x6d, 0xe1, 0xe6, 0x49, 0x1c, 0x0,  0x6,  0x1a, 0xc2,
      0xb3, 0x43, 0xcb, 0x98, 0x0,  0x15, 0xf4, 0x23, 0x98, 0xaf, 0xc2, 0x99, 0xe7, 0xef, 0x17, 0x44, 0x92, 0x51, 0xf8,
      0x67, 0xf6, 0x77, 0x8f, 0x4b, 0xc2, 0xf5, 0xb5, 0x0,  0x1c, 0x14, 0x9,  0x49, 0x73, 0x9b, 0x6a, 0x70, 0xc5, 0x16,
      0x27, 0x31, 0x2c, 0x47, 0x28, 0x50, 0x15, 0x24, 0xa3, 0x90, 0x92, 0x9f, 0x1f, 0x59, 0xc2, 0x4d, 0x97, 0x9d, 0xff,
      0x0,  0x2,  0xec, 0x9f, 0x0,  0x1b, 0xe4, 0x84, 0x82, 0xfe, 0xd5, 0xad, 0x31, 0xca, 0x30, 0x88, 0x87, 0xe7, 0x9d,
      0xa7, 0x70, 0xc7, 0x7d, 0x8b, 0x3,  0x20, 0xbf, 0xbd, 0xa8, 0xf5, 0xe3, 0x12, 0x7d, 0x0,  0xa,  0xe9, 0x6d, 0x63,
      0x9b, 0x4b, 0x8,  0x21, 0x1e, 0x75, 0x1a, 0x0,  0x10, 0x74, 0xb2, 0x7f, 0x7f, 0x79, 0xf0, 0xe0, 0xe4, 0x8d, 0xee,
      0x4,  0x19, 0x99, 0x3b, 0xbe, 0xea, 0x0,  0x1e, 0x80, 0x78, 0x53, 0xc7, 0xf0, 0xe4, 0x30, 0x52, 0xb,  0x52, 0xb4,
      0x33, 0xd9, 0xb3, 0xa2, 0x48, 0xbd, 0x25, 0xc0, 0xf7, 0xc3, 0x65, 0xb3, 0x74, 0x1e, 0x22, 0x78, 0x11, 0x6d, 0x79,
      0x0,  0x13, 0xf6, 0x1b, 0xf8, 0x88, 0x3,  0x3e, 0xe1, 0xcc, 0x6,  0x88, 0xaa, 0x22, 0xb,  0xe8, 0xfd, 0xdb, 0xc7,
      0x3d, 0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1c, 0x74, 0x4e, 0xf4, 0xad};
  uint8_t bytesprops1[] = {0x60, 0xb7, 0xad, 0x53, 0x48, 0xed, 0xe1, 0xfb};
  uint8_t bytesprops2[] = {0xe3, 0xe2, 0x74, 0x16, 0xa4, 0x36, 0x46, 0x20,
                           0xe4, 0xfd, 0x5,  0xb1, 0xe,  0xf1, 0xd1, 0x2f};
  uint8_t bytesprops3[] = {0xc3, 0xc8, 0x3, 0x92, 0xdd, 0x2f, 0x64, 0x81, 0x68, 0x87, 0xf, 0x2b, 0xf1, 0x69};
  uint8_t bytesprops4[] = {0xfa, 0x22, 0x4b, 0xa9, 0x84, 0xbb, 0x1e, 0xfc, 0x25, 0x92, 0xd2, 0xc4, 0x11,
                           0x51, 0x90, 0xeb, 0x1b, 0xaf, 0x7,  0x18, 0x3d, 0x9b, 0xaa, 0x9d, 0x2e};
  uint8_t bytesprops5[] = {0xe8, 0x64, 0xd7, 0x41};
  uint8_t bytesprops6[] = {0xf3, 0xb3, 0xd8, 0x13, 0x8, 0xe6};
  uint8_t bytesprops7[] = {0xc5, 0xdf, 0x29, 0xc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10894}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20782}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10666}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3468}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31173}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15968}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26426}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x5e, 0x9e, 0xb5, 0xc0, 0x4a, 0x1c, 0xf9};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf8, 0xf3, 0x6,  0x0, 0x53, 0x67, 0x7d, 0x80, 0xb1, 0x9a, 0x32, 0x1a, 0x2d,
                                     0xf2, 0x1d, 0xe5, 0x9, 0x15, 0x1f, 0xbd, 0x6d, 0xe1, 0xe6, 0x49, 0x1c};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0xc2, 0xb3, 0x43, 0xcb, 0x98};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf4, 0x23, 0x98, 0xaf, 0xc2, 0x99, 0xe7, 0xef, 0x17, 0x44, 0x92,
                                     0x51, 0xf8, 0x67, 0xf6, 0x77, 0x8f, 0x4b, 0xc2, 0xf5, 0xb5};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x14, 0x9,  0x49, 0x73, 0x9b, 0x6a, 0x70, 0xc5, 0x16, 0x27,
                                     0x31, 0x2c, 0x47, 0x28, 0x50, 0x15, 0x24, 0xa3, 0x90, 0x92,
                                     0x9f, 0x1f, 0x59, 0xc2, 0x4d, 0x97, 0x9d, 0xff};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xec, 0x9f};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xe4, 0x84, 0x82, 0xfe, 0xd5, 0xad, 0x31, 0xca, 0x30, 0x88, 0x87, 0xe7, 0x9d, 0xa7,
                                     0x70, 0xc7, 0x7d, 0x8b, 0x3,  0x20, 0xbf, 0xbd, 0xa8, 0xf5, 0xe3, 0x12, 0x7d};
  lwmqtt_string_t topic_filter_s6 = {27, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe9, 0x6d, 0x63, 0x9b, 0x4b, 0x8, 0x21, 0x1e, 0x75, 0x1a};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x74, 0xb2, 0x7f, 0x7f, 0x79, 0xf0, 0xe0, 0xe4,
                                     0x8d, 0xee, 0x4,  0x19, 0x99, 0x3b, 0xbe, 0xea};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x80, 0x78, 0x53, 0xc7, 0xf0, 0xe4, 0x30, 0x52, 0xb,  0x52,
                                     0xb4, 0x33, 0xd9, 0xb3, 0xa2, 0x48, 0xbd, 0x25, 0xc0, 0xf7,
                                     0xc3, 0x65, 0xb3, 0x74, 0x1e, 0x22, 0x78, 0x11, 0x6d, 0x79};
  lwmqtt_string_t topic_filter_s9 = {30, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xf6, 0x1b, 0xf8, 0x88, 0x3,  0x3e, 0xe1, 0xcc, 0x6, 0x88,
                                      0xaa, 0x22, 0xb,  0xe8, 0xfd, 0xdb, 0xc7, 0x3d, 0x6};
  lwmqtt_string_t topic_filter_s10 = {19, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8587, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24034
// ["\156\234\208\197\181\158\172S\218","\132\v\NAK\170\230\US\216+\217\DEL\213\156F","MTu\239]\128\EOT\f\SYN_\203\250\250\148\128\\\SO\ETBuv\137\211w\174+\NULUh_\232","\134\175\155\DC1\190\137R%\247H\202\207","\135\ETX\221t\137\178A\194\131\189V\254\204\246\175\143x\NAK\162[\135*\235[\EOT","Sq\209\151pP","\185\181~\EM\159\160\137\183\ETXQ\129u\174'O\210\177\GSi\201\217","Ch\167\252[{V1Q\223D\152$70\147\DC1\158-t7\250\152+\244\255\RS^j","\134\&4\166Q\210\FS\194\136\206qe\DLE]CG\FSEj\169\156\NUL\213\185>H\ETX&\SI\140"]
// [PropTopicAlias 5045,PropServerKeepAlive 13352,PropUserProperty "ap\248\162\242R\251" "\128"]
TEST(Unsubscribe5QCTest, Encode19) {
  uint8_t pkt[] = {0xa2, 0xd6, 0x1,  0x5d, 0xe2, 0x13, 0x23, 0x13, 0xb5, 0x13, 0x34, 0x28, 0x26, 0x0,  0x7,  0x61, 0x70,
                   0xf8, 0xa2, 0xf2, 0x52, 0xfb, 0x0,  0x1,  0x80, 0x0,  0x9,  0x9c, 0xea, 0xd0, 0xc5, 0xb5, 0x9e, 0xac,
                   0x53, 0xda, 0x0,  0xd,  0x84, 0xb,  0x15, 0xaa, 0xe6, 0x1f, 0xd8, 0x2b, 0xd9, 0x7f, 0xd5, 0x9c, 0x46,
                   0x0,  0x1e, 0x4d, 0x54, 0x75, 0xef, 0x5d, 0x80, 0x4,  0xc,  0x16, 0x5f, 0xcb, 0xfa, 0xfa, 0x94, 0x80,
                   0x5c, 0xe,  0x17, 0x75, 0x76, 0x89, 0xd3, 0x77, 0xae, 0x2b, 0x0,  0x55, 0x68, 0x5f, 0xe8, 0x0,  0xc,
                   0x86, 0xaf, 0x9b, 0x11, 0xbe, 0x89, 0x52, 0x25, 0xf7, 0x48, 0xca, 0xcf, 0x0,  0x19, 0x87, 0x3,  0xdd,
                   0x74, 0x89, 0xb2, 0x41, 0xc2, 0x83, 0xbd, 0x56, 0xfe, 0xcc, 0xf6, 0xaf, 0x8f, 0x78, 0x15, 0xa2, 0x5b,
                   0x87, 0x2a, 0xeb, 0x5b, 0x4,  0x0,  0x6,  0x53, 0x71, 0xd1, 0x97, 0x70, 0x50, 0x0,  0x15, 0xb9, 0xb5,
                   0x7e, 0x19, 0x9f, 0xa0, 0x89, 0xb7, 0x3,  0x51, 0x81, 0x75, 0xae, 0x27, 0x4f, 0xd2, 0xb1, 0x1d, 0x69,
                   0xc9, 0xd9, 0x0,  0x1d, 0x43, 0x68, 0xa7, 0xfc, 0x5b, 0x7b, 0x56, 0x31, 0x51, 0xdf, 0x44, 0x98, 0x24,
                   0x37, 0x30, 0x93, 0x11, 0x9e, 0x2d, 0x74, 0x37, 0xfa, 0x98, 0x2b, 0xf4, 0xff, 0x1e, 0x5e, 0x6a, 0x0,
                   0x1d, 0x86, 0x34, 0xa6, 0x51, 0xd2, 0x1c, 0xc2, 0x88, 0xce, 0x71, 0x65, 0x10, 0x5d, 0x43, 0x47, 0x1c,
                   0x45, 0x6a, 0xa9, 0x9c, 0x0,  0xd5, 0xb9, 0x3e, 0x48, 0x3,  0x26, 0xf,  0x8c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x80};
  uint8_t bytesprops0[] = {0x61, 0x70, 0xf8, 0xa2, 0xf2, 0x52, 0xfb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5045}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13352}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops0}, .v = {1, (char*)&bytesprops1}}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x9c, 0xea, 0xd0, 0xc5, 0xb5, 0x9e, 0xac, 0x53, 0xda};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x84, 0xb, 0x15, 0xaa, 0xe6, 0x1f, 0xd8, 0x2b, 0xd9, 0x7f, 0xd5, 0x9c, 0x46};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4d, 0x54, 0x75, 0xef, 0x5d, 0x80, 0x4,  0xc,  0x16, 0x5f,
                                     0xcb, 0xfa, 0xfa, 0x94, 0x80, 0x5c, 0xe,  0x17, 0x75, 0x76,
                                     0x89, 0xd3, 0x77, 0xae, 0x2b, 0x0,  0x55, 0x68, 0x5f, 0xe8};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x86, 0xaf, 0x9b, 0x11, 0xbe, 0x89, 0x52, 0x25, 0xf7, 0x48, 0xca, 0xcf};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x87, 0x3,  0xdd, 0x74, 0x89, 0xb2, 0x41, 0xc2, 0x83, 0xbd, 0x56, 0xfe, 0xcc,
                                     0xf6, 0xaf, 0x8f, 0x78, 0x15, 0xa2, 0x5b, 0x87, 0x2a, 0xeb, 0x5b, 0x4};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x53, 0x71, 0xd1, 0x97, 0x70, 0x50};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb9, 0xb5, 0x7e, 0x19, 0x9f, 0xa0, 0x89, 0xb7, 0x3,  0x51, 0x81,
                                     0x75, 0xae, 0x27, 0x4f, 0xd2, 0xb1, 0x1d, 0x69, 0xc9, 0xd9};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x43, 0x68, 0xa7, 0xfc, 0x5b, 0x7b, 0x56, 0x31, 0x51, 0xdf,
                                     0x44, 0x98, 0x24, 0x37, 0x30, 0x93, 0x11, 0x9e, 0x2d, 0x74,
                                     0x37, 0xfa, 0x98, 0x2b, 0xf4, 0xff, 0x1e, 0x5e, 0x6a};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x86, 0x34, 0xa6, 0x51, 0xd2, 0x1c, 0xc2, 0x88, 0xce, 0x71,
                                     0x65, 0x10, 0x5d, 0x43, 0x47, 0x1c, 0x45, 0x6a, 0xa9, 0x9c,
                                     0x0,  0xd5, 0xb9, 0x3e, 0x48, 0x3,  0x26, 0xf,  0x8c};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24034, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5686
// ["","\v}7\181\SI\131\156\ETX\158\RS<\237t\205^\236\158\139>","\179\158\242","","}>\\@\236\138X@Bu=P>J\STX\STXF&,?\129'\213\195\189","\\W=A\231m\181\237v\154\160","\254\234\210\&3`B\"/\175\253\131\244@\176]\211\159\163\160$\246"]
// [PropRequestProblemInformation 81,PropMessageExpiryInterval 13449,PropTopicAliasMaximum
// 21738,PropPayloadFormatIndicator 87,PropSessionExpiryInterval 22817,PropResponseTopic
// "\252\&9{_/\200\140\ETX",PropReceiveMaximum 16202,PropMessageExpiryInterval 32296,PropSubscriptionIdentifierAvailable
// 220,PropUserProperty "v\198\157\202a+\NUL2\222\a\DLEv\151"
// "\253\236fT\241\218YK\SOH\159#\156}\v\199\239)\249\144\ESC",PropRequestProblemInformation 191,PropReasonString
// "\EOT{I\FS{ep\216\139\201Ri\167\v#\165\&8B\a\145v^\131\200\201\153\177q\180\DC2",PropServerReference
// "G\171\191\199\&9",PropContentType
// "\STX\240\190\US\185Z\176\187+\144\209\&3\224\191Zm\STX\DC1%\DC1\142(\131\209^",PropReasonString
// "\US@\233w",PropSubscriptionIdentifierAvailable 252,PropServerKeepAlive 31044,PropReasonString
// "\176\153\SOH\183\DEL",PropServerKeepAlive 11070,PropRequestResponseInformation 182,PropResponseInformation
// "\232\157W\220\179<_",PropSubscriptionIdentifier 15,PropServerKeepAlive 3297,PropResponseTopic
// ".\ESC5\138E\147\194e\182",PropRetainAvailable 193]
TEST(Unsubscribe5QCTest, Encode20) {
  uint8_t pkt[] = {
      0xa2, 0xaa, 0x2,  0x16, 0x36, 0xc9, 0x1,  0x17, 0x51, 0x2,  0x0,  0x0,  0x34, 0x89, 0x22, 0x54, 0xea, 0x1,  0x57,
      0x11, 0x0,  0x0,  0x59, 0x21, 0x8,  0x0,  0x8,  0xfc, 0x39, 0x7b, 0x5f, 0x2f, 0xc8, 0x8c, 0x3,  0x21, 0x3f, 0x4a,
      0x2,  0x0,  0x0,  0x7e, 0x28, 0x29, 0xdc, 0x26, 0x0,  0xd,  0x76, 0xc6, 0x9d, 0xca, 0x61, 0x2b, 0x0,  0x32, 0xde,
      0x7,  0x10, 0x76, 0x97, 0x0,  0x14, 0xfd, 0xec, 0x66, 0x54, 0xf1, 0xda, 0x59, 0x4b, 0x1,  0x9f, 0x23, 0x9c, 0x7d,
      0xb,  0xc7, 0xef, 0x29, 0xf9, 0x90, 0x1b, 0x17, 0xbf, 0x1f, 0x0,  0x1e, 0x4,  0x7b, 0x49, 0x1c, 0x7b, 0x65, 0x70,
      0xd8, 0x8b, 0xc9, 0x52, 0x69, 0xa7, 0xb,  0x23, 0xa5, 0x38, 0x42, 0x7,  0x91, 0x76, 0x5e, 0x83, 0xc8, 0xc9, 0x99,
      0xb1, 0x71, 0xb4, 0x12, 0x1c, 0x0,  0x5,  0x47, 0xab, 0xbf, 0xc7, 0x39, 0x3,  0x0,  0x19, 0x2,  0xf0, 0xbe, 0x1f,
      0xb9, 0x5a, 0xb0, 0xbb, 0x2b, 0x90, 0xd1, 0x33, 0xe0, 0xbf, 0x5a, 0x6d, 0x2,  0x11, 0x25, 0x11, 0x8e, 0x28, 0x83,
      0xd1, 0x5e, 0x1f, 0x0,  0x4,  0x1f, 0x40, 0xe9, 0x77, 0x29, 0xfc, 0x13, 0x79, 0x44, 0x1f, 0x0,  0x5,  0xb0, 0x99,
      0x1,  0xb7, 0x7f, 0x13, 0x2b, 0x3e, 0x19, 0xb6, 0x1a, 0x0,  0x7,  0xe8, 0x9d, 0x57, 0xdc, 0xb3, 0x3c, 0x5f, 0xb,
      0xf,  0x13, 0xc,  0xe1, 0x8,  0x0,  0x9,  0x2e, 0x1b, 0x35, 0x8a, 0x45, 0x93, 0xc2, 0x65, 0xb6, 0x25, 0xc1, 0x0,
      0x0,  0x0,  0x13, 0xb,  0x7d, 0x37, 0xb5, 0xf,  0x83, 0x9c, 0x3,  0x9e, 0x1e, 0x3c, 0xed, 0x74, 0xcd, 0x5e, 0xec,
      0x9e, 0x8b, 0x3e, 0x0,  0x3,  0xb3, 0x9e, 0xf2, 0x0,  0x0,  0x0,  0x19, 0x7d, 0x3e, 0x5c, 0x40, 0xec, 0x8a, 0x58,
      0x40, 0x42, 0x75, 0x3d, 0x50, 0x3e, 0x4a, 0x2,  0x2,  0x46, 0x26, 0x2c, 0x3f, 0x81, 0x27, 0xd5, 0xc3, 0xbd, 0x0,
      0xb,  0x5c, 0x57, 0x3d, 0x41, 0xe7, 0x6d, 0xb5, 0xed, 0x76, 0x9a, 0xa0, 0x0,  0x15, 0xfe, 0xea, 0xd2, 0x33, 0x60,
      0x42, 0x22, 0x2f, 0xaf, 0xfd, 0x83, 0xf4, 0x40, 0xb0, 0x5d, 0xd3, 0x9f, 0xa3, 0xa0, 0x24, 0xf6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xfc, 0x39, 0x7b, 0x5f, 0x2f, 0xc8, 0x8c, 0x3};
  uint8_t bytesprops2[] = {0xfd, 0xec, 0x66, 0x54, 0xf1, 0xda, 0x59, 0x4b, 0x1,  0x9f,
                           0x23, 0x9c, 0x7d, 0xb,  0xc7, 0xef, 0x29, 0xf9, 0x90, 0x1b};
  uint8_t bytesprops1[] = {0x76, 0xc6, 0x9d, 0xca, 0x61, 0x2b, 0x0, 0x32, 0xde, 0x7, 0x10, 0x76, 0x97};
  uint8_t bytesprops3[] = {0x4,  0x7b, 0x49, 0x1c, 0x7b, 0x65, 0x70, 0xd8, 0x8b, 0xc9, 0x52, 0x69, 0xa7, 0xb,  0x23,
                           0xa5, 0x38, 0x42, 0x7,  0x91, 0x76, 0x5e, 0x83, 0xc8, 0xc9, 0x99, 0xb1, 0x71, 0xb4, 0x12};
  uint8_t bytesprops4[] = {0x47, 0xab, 0xbf, 0xc7, 0x39};
  uint8_t bytesprops5[] = {0x2,  0xf0, 0xbe, 0x1f, 0xb9, 0x5a, 0xb0, 0xbb, 0x2b, 0x90, 0xd1, 0x33, 0xe0,
                           0xbf, 0x5a, 0x6d, 0x2,  0x11, 0x25, 0x11, 0x8e, 0x28, 0x83, 0xd1, 0x5e};
  uint8_t bytesprops6[] = {0x1f, 0x40, 0xe9, 0x77};
  uint8_t bytesprops7[] = {0xb0, 0x99, 0x1, 0xb7, 0x7f};
  uint8_t bytesprops8[] = {0xe8, 0x9d, 0x57, 0xdc, 0xb3, 0x3c, 0x5f};
  uint8_t bytesprops9[] = {0x2e, 0x1b, 0x35, 0x8a, 0x45, 0x93, 0xc2, 0x65, 0xb6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13449}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21738}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22817}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16202}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32296}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops1}, .v = {20, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31044}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11070}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3297}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 193}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb,  0x7d, 0x37, 0xb5, 0xf,  0x83, 0x9c, 0x3,  0x9e, 0x1e,
                                     0x3c, 0xed, 0x74, 0xcd, 0x5e, 0xec, 0x9e, 0x8b, 0x3e};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb3, 0x9e, 0xf2};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7d, 0x3e, 0x5c, 0x40, 0xec, 0x8a, 0x58, 0x40, 0x42, 0x75, 0x3d, 0x50, 0x3e,
                                     0x4a, 0x2,  0x2,  0x46, 0x26, 0x2c, 0x3f, 0x81, 0x27, 0xd5, 0xc3, 0xbd};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5c, 0x57, 0x3d, 0x41, 0xe7, 0x6d, 0xb5, 0xed, 0x76, 0x9a, 0xa0};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfe, 0xea, 0xd2, 0x33, 0x60, 0x42, 0x22, 0x2f, 0xaf, 0xfd, 0x83,
                                     0xf4, 0x40, 0xb0, 0x5d, 0xd3, 0x9f, 0xa3, 0xa0, 0x24, 0xf6};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5686, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24245
// ["\187-s\231\141\DELJq\246","\NAK]%\227\253\FST\142?\253C;\SOH\191\250\223T\RS\DC2\247B\191\193\222\196I\129","\196\132\&8J\197\&8\163\133\229"]
// [PropAuthenticationMethod "\152\248\&1\250M\n\162\131\DLEs\230"]
TEST(Unsubscribe5QCTest, Encode21) {
  uint8_t pkt[] = {0xa2, 0x44, 0x5e, 0xb5, 0xe,  0x15, 0x0,  0xb,  0x98, 0xf8, 0x31, 0xfa, 0x4d, 0xa,
                   0xa2, 0x83, 0x10, 0x73, 0xe6, 0x0,  0x9,  0xbb, 0x2d, 0x73, 0xe7, 0x8d, 0x7f, 0x4a,
                   0x71, 0xf6, 0x0,  0x1b, 0x15, 0x5d, 0x25, 0xe3, 0xfd, 0x1c, 0x54, 0x8e, 0x3f, 0xfd,
                   0x43, 0x3b, 0x1,  0xbf, 0xfa, 0xdf, 0x54, 0x1e, 0x12, 0xf7, 0x42, 0xbf, 0xc1, 0xde,
                   0xc4, 0x49, 0x81, 0x0,  0x9,  0xc4, 0x84, 0x38, 0x4a, 0xc5, 0x38, 0xa3, 0x85, 0xe5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x98, 0xf8, 0x31, 0xfa, 0x4d, 0xa, 0xa2, 0x83, 0x10, 0x73, 0xe6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xbb, 0x2d, 0x73, 0xe7, 0x8d, 0x7f, 0x4a, 0x71, 0xf6};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x15, 0x5d, 0x25, 0xe3, 0xfd, 0x1c, 0x54, 0x8e, 0x3f, 0xfd, 0x43, 0x3b, 0x1, 0xbf,
                                     0xfa, 0xdf, 0x54, 0x1e, 0x12, 0xf7, 0x42, 0xbf, 0xc1, 0xde, 0xc4, 0x49, 0x81};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc4, 0x84, 0x38, 0x4a, 0xc5, 0x38, 0xa3, 0x85, 0xe5};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24245, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 25032 ["\SYN;\174\NAK\140_\188\"[\SOH3z~7\194\136\&7\218\&2\SYN<\156w","V\219\229e\199
// ","W\238\187\GS\SUB\132\133w\251\149h\178\201\DC3\204\209\201\SYN","}=\204\166\208\175.\200\192\SYNb\177","!\174\SO\173\137~:\238\166u\EOT\165\184r4\185l\201\128\190\&0f\156","\149:.\217?\"ev=\v;\158\129d\244\ACKxH{\DC4\245","J"]
// [PropAuthenticationData
// "\176\224\132\EOT\217\155yE\177\193\187\245\181\SOH\SUB@\232>\169\179\166\250\248o\139",PropTopicAlias
// 15556,PropMaximumPacketSize 12808,PropSessionExpiryInterval 32646,PropSubscriptionIdentifier
// 20,PropAssignedClientIdentifier
// "x\142b5_\202\ESC\180\209\&3\STX\252\156\226wp\237\242\240\129y\EOT\DEL\DC3\134\154\227",PropReceiveMaximum
// 26150,PropMessageExpiryInterval 32475,PropSharedSubscriptionAvailable 16,PropAssignedClientIdentifier
// "\ESC\158\248\b",PropMessageExpiryInterval 17120,PropWillDelayInterval 29419,PropMessageExpiryInterval
// 31352,PropServerReference
// "soB8\152\129\173\163\233\ESC\214/\195\254\213e\184\198\DC4\230\158l\229-\153\216I\191\SUB",PropMessageExpiryInterval
// 2639,PropMessageExpiryInterval 18192]
TEST(Unsubscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0xa2, 0x8d, 0x2,  0x61, 0xc8, 0x93, 0x1,  0x16, 0x0,  0x19, 0xb0, 0xe0, 0x84, 0x4,  0xd9, 0x9b, 0x79, 0x45, 0xb1,
      0xc1, 0xbb, 0xf5, 0xb5, 0x1,  0x1a, 0x40, 0xe8, 0x3e, 0xa9, 0xb3, 0xa6, 0xfa, 0xf8, 0x6f, 0x8b, 0x23, 0x3c, 0xc4,
      0x27, 0x0,  0x0,  0x32, 0x8,  0x11, 0x0,  0x0,  0x7f, 0x86, 0xb,  0x14, 0x12, 0x0,  0x1b, 0x78, 0x8e, 0x62, 0x35,
      0x5f, 0xca, 0x1b, 0xb4, 0xd1, 0x33, 0x2,  0xfc, 0x9c, 0xe2, 0x77, 0x70, 0xed, 0xf2, 0xf0, 0x81, 0x79, 0x4,  0x7f,
      0x13, 0x86, 0x9a, 0xe3, 0x21, 0x66, 0x26, 0x2,  0x0,  0x0,  0x7e, 0xdb, 0x2a, 0x10, 0x12, 0x0,  0x4,  0x1b, 0x9e,
      0xf8, 0x8,  0x2,  0x0,  0x0,  0x42, 0xe0, 0x18, 0x0,  0x0,  0x72, 0xeb, 0x2,  0x0,  0x0,  0x7a, 0x78, 0x1c, 0x0,
      0x1d, 0x73, 0x6f, 0x42, 0x38, 0x98, 0x81, 0xad, 0xa3, 0xe9, 0x1b, 0xd6, 0x2f, 0xc3, 0xfe, 0xd5, 0x65, 0xb8, 0xc6,
      0x14, 0xe6, 0x9e, 0x6c, 0xe5, 0x2d, 0x99, 0xd8, 0x49, 0xbf, 0x1a, 0x2,  0x0,  0x0,  0xa,  0x4f, 0x2,  0x0,  0x0,
      0x47, 0x10, 0x0,  0x17, 0x16, 0x3b, 0xae, 0x15, 0x8c, 0x5f, 0xbc, 0x22, 0x5b, 0x1,  0x33, 0x7a, 0x7e, 0x37, 0xc2,
      0x88, 0x37, 0xda, 0x32, 0x16, 0x3c, 0x9c, 0x77, 0x0,  0x6,  0x56, 0xdb, 0xe5, 0x65, 0xc7, 0x20, 0x0,  0x12, 0x57,
      0xee, 0xbb, 0x1d, 0x1a, 0x84, 0x85, 0x77, 0xfb, 0x95, 0x68, 0xb2, 0xc9, 0x13, 0xcc, 0xd1, 0xc9, 0x16, 0x0,  0xc,
      0x7d, 0x3d, 0xcc, 0xa6, 0xd0, 0xaf, 0x2e, 0xc8, 0xc0, 0x16, 0x62, 0xb1, 0x0,  0x17, 0x21, 0xae, 0xe,  0xad, 0x89,
      0x7e, 0x3a, 0xee, 0xa6, 0x75, 0x4,  0xa5, 0xb8, 0x72, 0x34, 0xb9, 0x6c, 0xc9, 0x80, 0xbe, 0x30, 0x66, 0x9c, 0x0,
      0x15, 0x95, 0x3a, 0x2e, 0xd9, 0x3f, 0x22, 0x65, 0x76, 0x3d, 0xb,  0x3b, 0x9e, 0x81, 0x64, 0xf4, 0x6,  0x78, 0x48,
      0x7b, 0x14, 0xf5, 0x0,  0x1,  0x4a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb0, 0xe0, 0x84, 0x4,  0xd9, 0x9b, 0x79, 0x45, 0xb1, 0xc1, 0xbb, 0xf5, 0xb5,
                           0x1,  0x1a, 0x40, 0xe8, 0x3e, 0xa9, 0xb3, 0xa6, 0xfa, 0xf8, 0x6f, 0x8b};
  uint8_t bytesprops1[] = {0x78, 0x8e, 0x62, 0x35, 0x5f, 0xca, 0x1b, 0xb4, 0xd1, 0x33, 0x2,  0xfc, 0x9c, 0xe2,
                           0x77, 0x70, 0xed, 0xf2, 0xf0, 0x81, 0x79, 0x4,  0x7f, 0x13, 0x86, 0x9a, 0xe3};
  uint8_t bytesprops2[] = {0x1b, 0x9e, 0xf8, 0x8};
  uint8_t bytesprops3[] = {0x73, 0x6f, 0x42, 0x38, 0x98, 0x81, 0xad, 0xa3, 0xe9, 0x1b, 0xd6, 0x2f, 0xc3, 0xfe, 0xd5,
                           0x65, 0xb8, 0xc6, 0x14, 0xe6, 0x9e, 0x6c, 0xe5, 0x2d, 0x99, 0xd8, 0x49, 0xbf, 0x1a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15556}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12808}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32646}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26150}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32475}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17120}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29419}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31352}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2639}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18192}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x16, 0x3b, 0xae, 0x15, 0x8c, 0x5f, 0xbc, 0x22, 0x5b, 0x1,  0x33, 0x7a,
                                     0x7e, 0x37, 0xc2, 0x88, 0x37, 0xda, 0x32, 0x16, 0x3c, 0x9c, 0x77};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x56, 0xdb, 0xe5, 0x65, 0xc7, 0x20};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x57, 0xee, 0xbb, 0x1d, 0x1a, 0x84, 0x85, 0x77, 0xfb,
                                     0x95, 0x68, 0xb2, 0xc9, 0x13, 0xcc, 0xd1, 0xc9, 0x16};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x7d, 0x3d, 0xcc, 0xa6, 0xd0, 0xaf, 0x2e, 0xc8, 0xc0, 0x16, 0x62, 0xb1};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x21, 0xae, 0xe,  0xad, 0x89, 0x7e, 0x3a, 0xee, 0xa6, 0x75, 0x4, 0xa5,
                                     0xb8, 0x72, 0x34, 0xb9, 0x6c, 0xc9, 0x80, 0xbe, 0x30, 0x66, 0x9c};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x95, 0x3a, 0x2e, 0xd9, 0x3f, 0x22, 0x65, 0x76, 0x3d, 0xb, 0x3b,
                                     0x9e, 0x81, 0x64, 0xf4, 0x6,  0x78, 0x48, 0x7b, 0x14, 0xf5};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4a};
  lwmqtt_string_t topic_filter_s6 = {1, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25032, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 9981 ["\234","\236\168cp","~","\224\178\190\NAK\250][\147CG\225f\248\DC3\243\"\t\""]
// [PropSharedSubscriptionAvailable 83,PropMaximumPacketSize 12284,PropReasonString
// "\165\EOT\EOT\182\212_\146\172\131\222\247\253)\178_\210\RSO\SI\208\237$8p\ESC\138d",PropResponseInformation
// "\202\ETBPO",PropRetainAvailable 25,PropPayloadFormatIndicator 168,PropServerReference
// "\DC2\129(\154\245k4\239\158de\253\160\170\182l\173j",PropServerReference
// "\244h\NAK\216\SOH\NAK\154\240l^\172\193\138Z=tv\129\195\168\178\154$\154\244\214\184\ESCO",PropUserProperty
// "\190\247\160\199\252\195Q" "]hb\CAN\139\158\206\249\ESCHD%\175\n",PropAssignedClientIdentifier
// "\156\168\233\179\255\&5\173\140U\187&oi",PropRetainAvailable 187,PropSharedSubscriptionAvailable
// 238,PropSubscriptionIdentifierAvailable 17,PropRequestProblemInformation 207,PropServerKeepAlive
// 1787,PropSubscriptionIdentifierAvailable 187,PropAssignedClientIdentifier "\221",PropSessionExpiryInterval
// 22065,PropSessionExpiryInterval 24448,PropAuthenticationData "\199m\248\213[\219\249\FS\252\234<,f
// \254\206Z\142\FS\184\139\177\220\140W\RS\219\166x\160",PropWillDelayInterval 10612,PropRequestProblemInformation
// 154,PropReceiveMaximum 3414]
TEST(Unsubscribe5QCTest, Encode23) {
  uint8_t pkt[] = {0xa2, 0xf9, 0x1,  0x26, 0xfd, 0xd5, 0x1,  0x2a, 0x53, 0x27, 0x0,  0x0,  0x2f, 0xfc, 0x1f, 0x0,  0x1b,
                   0xa5, 0x4,  0x4,  0xb6, 0xd4, 0x5f, 0x92, 0xac, 0x83, 0xde, 0xf7, 0xfd, 0x29, 0xb2, 0x5f, 0xd2, 0x1e,
                   0x4f, 0xf,  0xd0, 0xed, 0x24, 0x38, 0x70, 0x1b, 0x8a, 0x64, 0x1a, 0x0,  0x4,  0xca, 0x17, 0x50, 0x4f,
                   0x25, 0x19, 0x1,  0xa8, 0x1c, 0x0,  0x12, 0x12, 0x81, 0x28, 0x9a, 0xf5, 0x6b, 0x34, 0xef, 0x9e, 0x64,
                   0x65, 0xfd, 0xa0, 0xaa, 0xb6, 0x6c, 0xad, 0x6a, 0x1c, 0x0,  0x1d, 0xf4, 0x68, 0x15, 0xd8, 0x1,  0x15,
                   0x9a, 0xf0, 0x6c, 0x5e, 0xac, 0xc1, 0x8a, 0x5a, 0x3d, 0x74, 0x76, 0x81, 0xc3, 0xa8, 0xb2, 0x9a, 0x24,
                   0x9a, 0xf4, 0xd6, 0xb8, 0x1b, 0x4f, 0x26, 0x0,  0x7,  0xbe, 0xf7, 0xa0, 0xc7, 0xfc, 0xc3, 0x51, 0x0,
                   0xe,  0x5d, 0x68, 0x62, 0x18, 0x8b, 0x9e, 0xce, 0xf9, 0x1b, 0x48, 0x44, 0x25, 0xaf, 0xa,  0x12, 0x0,
                   0xd,  0x9c, 0xa8, 0xe9, 0xb3, 0xff, 0x35, 0xad, 0x8c, 0x55, 0xbb, 0x26, 0x6f, 0x69, 0x25, 0xbb, 0x2a,
                   0xee, 0x29, 0x11, 0x17, 0xcf, 0x13, 0x6,  0xfb, 0x29, 0xbb, 0x12, 0x0,  0x1,  0xdd, 0x11, 0x0,  0x0,
                   0x56, 0x31, 0x11, 0x0,  0x0,  0x5f, 0x80, 0x16, 0x0,  0x1e, 0xc7, 0x6d, 0xf8, 0xd5, 0x5b, 0xdb, 0xf9,
                   0x1c, 0xfc, 0xea, 0x3c, 0x2c, 0x66, 0x20, 0xfe, 0xce, 0x5a, 0x8e, 0x1c, 0xb8, 0x8b, 0xb1, 0xdc, 0x8c,
                   0x57, 0x1e, 0xdb, 0xa6, 0x78, 0xa0, 0x18, 0x0,  0x0,  0x29, 0x74, 0x17, 0x9a, 0x21, 0xd,  0x56, 0x0,
                   0x1,  0xea, 0x0,  0x4,  0xec, 0xa8, 0x63, 0x70, 0x0,  0x1,  0x7e, 0x0,  0x12, 0xe0, 0xb2, 0xbe, 0x15,
                   0xfa, 0x5d, 0x5b, 0x93, 0x43, 0x47, 0xe1, 0x66, 0xf8, 0x13, 0xf3, 0x22, 0x9,  0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa5, 0x4,  0x4,  0xb6, 0xd4, 0x5f, 0x92, 0xac, 0x83, 0xde, 0xf7, 0xfd, 0x29, 0xb2,
                           0x5f, 0xd2, 0x1e, 0x4f, 0xf,  0xd0, 0xed, 0x24, 0x38, 0x70, 0x1b, 0x8a, 0x64};
  uint8_t bytesprops1[] = {0xca, 0x17, 0x50, 0x4f};
  uint8_t bytesprops2[] = {0x12, 0x81, 0x28, 0x9a, 0xf5, 0x6b, 0x34, 0xef, 0x9e,
                           0x64, 0x65, 0xfd, 0xa0, 0xaa, 0xb6, 0x6c, 0xad, 0x6a};
  uint8_t bytesprops3[] = {0xf4, 0x68, 0x15, 0xd8, 0x1,  0x15, 0x9a, 0xf0, 0x6c, 0x5e, 0xac, 0xc1, 0x8a, 0x5a, 0x3d,
                           0x74, 0x76, 0x81, 0xc3, 0xa8, 0xb2, 0x9a, 0x24, 0x9a, 0xf4, 0xd6, 0xb8, 0x1b, 0x4f};
  uint8_t bytesprops5[] = {0x5d, 0x68, 0x62, 0x18, 0x8b, 0x9e, 0xce, 0xf9, 0x1b, 0x48, 0x44, 0x25, 0xaf, 0xa};
  uint8_t bytesprops4[] = {0xbe, 0xf7, 0xa0, 0xc7, 0xfc, 0xc3, 0x51};
  uint8_t bytesprops6[] = {0x9c, 0xa8, 0xe9, 0xb3, 0xff, 0x35, 0xad, 0x8c, 0x55, 0xbb, 0x26, 0x6f, 0x69};
  uint8_t bytesprops7[] = {0xdd};
  uint8_t bytesprops8[] = {0xc7, 0x6d, 0xf8, 0xd5, 0x5b, 0xdb, 0xf9, 0x1c, 0xfc, 0xea, 0x3c, 0x2c, 0x66, 0x20, 0xfe,
                           0xce, 0x5a, 0x8e, 0x1c, 0xb8, 0x8b, 0xb1, 0xdc, 0x8c, 0x57, 0x1e, 0xdb, 0xa6, 0x78, 0xa0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12284}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops4}, .v = {14, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1787}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22065}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24448}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10612}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3414}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xea};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xec, 0xa8, 0x63, 0x70};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7e};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe0, 0xb2, 0xbe, 0x15, 0xfa, 0x5d, 0x5b, 0x93, 0x43,
                                     0x47, 0xe1, 0x66, 0xf8, 0x13, 0xf3, 0x22, 0x9,  0x22};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9981, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 12131 [";\204\192\156\203","\131\141H4\GSjh\223\t{hE[\134\CAN\142"] [PropRetainAvailable
// 221,PropRequestProblemInformation 37,PropReceiveMaximum 2247,PropSharedSubscriptionAvailable 7,PropResponseTopic
// "\163\170\&0\238\148\by\229\227g\164\222&\153\137\238L\211\200\192\207\253n\243",PropMessageExpiryInterval
// 13609,PropSubscriptionIdentifier 4,PropResponseInformation
// "\208\ACK\139\252\DC1\ETB\SUB\SYN\154\222\228*\228\CAN\216\139\181",PropMaximumQoS 41,PropMaximumQoS
// 249,PropRequestResponseInformation 149,PropSubscriptionIdentifier 32,PropRequestResponseInformation
// 120,PropTopicAlias 26179,PropServerReference "\249",PropAuthenticationMethod
// "f\142k\131\137\241\&3%\EOT\133\148\168g\140\DC1Q\187\226\169>5\208",PropRetainAvailable 64,PropWillDelayInterval
// 28574,PropResponseTopic "\DLE\246\142\&5\157\168C\255pV\141\v\230\162\222h@ s",PropMessageExpiryInterval
// 32507,PropMaximumQoS 35,PropMaximumQoS 246,PropPayloadFormatIndicator 78,PropSessionExpiryInterval
// 24294,PropMaximumQoS 182,PropMaximumQoS 76,PropContentType "P\232\DC1\144\ETB.\162\147@",PropServerReference
// ".\202T\DLE\ENQy\248R\209\128",PropMessageExpiryInterval 4809]
TEST(Unsubscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0xa2, 0xd5, 0x1,  0x2f, 0x63, 0xb8, 0x1,  0x25, 0xdd, 0x17, 0x25, 0x21, 0x8,  0xc7, 0x2a, 0x7,  0x8,
                   0x0,  0x18, 0xa3, 0xaa, 0x30, 0xee, 0x94, 0x8,  0x79, 0xe5, 0xe3, 0x67, 0xa4, 0xde, 0x26, 0x99, 0x89,
                   0xee, 0x4c, 0xd3, 0xc8, 0xc0, 0xcf, 0xfd, 0x6e, 0xf3, 0x2,  0x0,  0x0,  0x35, 0x29, 0xb,  0x4,  0x1a,
                   0x0,  0x11, 0xd0, 0x6,  0x8b, 0xfc, 0x11, 0x17, 0x1a, 0x16, 0x9a, 0xde, 0xe4, 0x2a, 0xe4, 0x18, 0xd8,
                   0x8b, 0xb5, 0x24, 0x29, 0x24, 0xf9, 0x19, 0x95, 0xb,  0x20, 0x19, 0x78, 0x23, 0x66, 0x43, 0x1c, 0x0,
                   0x1,  0xf9, 0x15, 0x0,  0x16, 0x66, 0x8e, 0x6b, 0x83, 0x89, 0xf1, 0x33, 0x25, 0x4,  0x85, 0x94, 0xa8,
                   0x67, 0x8c, 0x11, 0x51, 0xbb, 0xe2, 0xa9, 0x3e, 0x35, 0xd0, 0x25, 0x40, 0x18, 0x0,  0x0,  0x6f, 0x9e,
                   0x8,  0x0,  0x13, 0x10, 0xf6, 0x8e, 0x35, 0x9d, 0xa8, 0x43, 0xff, 0x70, 0x56, 0x8d, 0xb,  0xe6, 0xa2,
                   0xde, 0x68, 0x40, 0x20, 0x73, 0x2,  0x0,  0x0,  0x7e, 0xfb, 0x24, 0x23, 0x24, 0xf6, 0x1,  0x4e, 0x11,
                   0x0,  0x0,  0x5e, 0xe6, 0x24, 0xb6, 0x24, 0x4c, 0x3,  0x0,  0x9,  0x50, 0xe8, 0x11, 0x90, 0x17, 0x2e,
                   0xa2, 0x93, 0x40, 0x1c, 0x0,  0xa,  0x2e, 0xca, 0x54, 0x10, 0x5,  0x79, 0xf8, 0x52, 0xd1, 0x80, 0x2,
                   0x0,  0x0,  0x12, 0xc9, 0x0,  0x5,  0x3b, 0xcc, 0xc0, 0x9c, 0xcb, 0x0,  0x10, 0x83, 0x8d, 0x48, 0x34,
                   0x1d, 0x6a, 0x68, 0xdf, 0x9,  0x7b, 0x68, 0x45, 0x5b, 0x86, 0x18, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa3, 0xaa, 0x30, 0xee, 0x94, 0x8,  0x79, 0xe5, 0xe3, 0x67, 0xa4, 0xde,
                           0x26, 0x99, 0x89, 0xee, 0x4c, 0xd3, 0xc8, 0xc0, 0xcf, 0xfd, 0x6e, 0xf3};
  uint8_t bytesprops1[] = {0xd0, 0x6,  0x8b, 0xfc, 0x11, 0x17, 0x1a, 0x16, 0x9a,
                           0xde, 0xe4, 0x2a, 0xe4, 0x18, 0xd8, 0x8b, 0xb5};
  uint8_t bytesprops2[] = {0xf9};
  uint8_t bytesprops3[] = {0x66, 0x8e, 0x6b, 0x83, 0x89, 0xf1, 0x33, 0x25, 0x4,  0x85, 0x94,
                           0xa8, 0x67, 0x8c, 0x11, 0x51, 0xbb, 0xe2, 0xa9, 0x3e, 0x35, 0xd0};
  uint8_t bytesprops4[] = {0x10, 0xf6, 0x8e, 0x35, 0x9d, 0xa8, 0x43, 0xff, 0x70, 0x56,
                           0x8d, 0xb,  0xe6, 0xa2, 0xde, 0x68, 0x40, 0x20, 0x73};
  uint8_t bytesprops5[] = {0x50, 0xe8, 0x11, 0x90, 0x17, 0x2e, 0xa2, 0x93, 0x40};
  uint8_t bytesprops6[] = {0x2e, 0xca, 0x54, 0x10, 0x5, 0x79, 0xf8, 0x52, 0xd1, 0x80};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2247}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13609}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 32}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26179}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28574}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32507}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24294}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4809}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0xcc, 0xc0, 0x9c, 0xcb};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x83, 0x8d, 0x48, 0x34, 0x1d, 0x6a, 0x68, 0xdf,
                                     0x9,  0x7b, 0x68, 0x45, 0x5b, 0x86, 0x18, 0x8e};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12131, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 2785
// ["\208\203\198\224\198v\210\132\218\207\b","\DC4g\193CEY\226\133{\205;","\129E\167\RSx\161\SI\218\ENQ\196\149\136\243\170j\166\208\132m\DEL","lI\225V\SYN&\228E\191\236\171\EM\199eL\DLE-\191\155\223\&5\193\b","\154\ENQp\158
// dj\212\228\243\245\179\ESC\140\SI\ACK\193\215\a\FSR\DLE","\236\152b\183\203\239\189:A\241\200\CAN\207\221i","\198By$\ACK","\147\f\237\210\b\144w}\129d","\176\231\145U\138\241\252\185\178\238\136oQ\ENQ\187\168\228\197","*\210\FS\252"]
// [PropRetainAvailable 81,PropWildcardSubscriptionAvailable 94,PropPayloadFormatIndicator
// 176,PropSharedSubscriptionAvailable 192,PropUserProperty "\189f\SUBc\254\SO"
// "!6\174\DC4\EOTm%\182\180Ok$rV*\225\\(\167\232\&9q",PropSessionExpiryInterval 29837,PropAssignedClientIdentifier
// ":\246.\GS\193r\DC4\224\186-\209\176\208u\211\&2\251\135\ACK\136\212\145\161\195Y",PropMaximumPacketSize
// 1899,PropSharedSubscriptionAvailable 191,PropReceiveMaximum 8879,PropPayloadFormatIndicator 19,PropResponseTopic
// "\246\128\218f\254\213\&4R\145\140\244\212\173\221;\ENQ\168\255\&6m\STXK\203f",PropAuthenticationMethod
// "o\202\DC4-\246{w\202\234f\179 "]
TEST(Unsubscribe5QCTest, Encode25) {
  uint8_t pkt[] = {
      0xa2, 0xa3, 0x2,  0xa,  0xe1, 0x80, 0x1,  0x25, 0x51, 0x28, 0x5e, 0x1,  0xb0, 0x2a, 0xc0, 0x26, 0x0,  0x6,  0xbd,
      0x66, 0x1a, 0x63, 0xfe, 0xe,  0x0,  0x16, 0x21, 0x36, 0xae, 0x14, 0x4,  0x6d, 0x25, 0xb6, 0xb4, 0x4f, 0x6b, 0x24,
      0x72, 0x56, 0x2a, 0xe1, 0x5c, 0x28, 0xa7, 0xe8, 0x39, 0x71, 0x11, 0x0,  0x0,  0x74, 0x8d, 0x12, 0x0,  0x19, 0x3a,
      0xf6, 0x2e, 0x1d, 0xc1, 0x72, 0x14, 0xe0, 0xba, 0x2d, 0xd1, 0xb0, 0xd0, 0x75, 0xd3, 0x32, 0xfb, 0x87, 0x6,  0x88,
      0xd4, 0x91, 0xa1, 0xc3, 0x59, 0x27, 0x0,  0x0,  0x7,  0x6b, 0x2a, 0xbf, 0x21, 0x22, 0xaf, 0x1,  0x13, 0x8,  0x0,
      0x18, 0xf6, 0x80, 0xda, 0x66, 0xfe, 0xd5, 0x34, 0x52, 0x91, 0x8c, 0xf4, 0xd4, 0xad, 0xdd, 0x3b, 0x5,  0xa8, 0xff,
      0x36, 0x6d, 0x2,  0x4b, 0xcb, 0x66, 0x15, 0x0,  0xc,  0x6f, 0xca, 0x14, 0x2d, 0xf6, 0x7b, 0x77, 0xca, 0xea, 0x66,
      0xb3, 0x20, 0x0,  0xb,  0xd0, 0xcb, 0xc6, 0xe0, 0xc6, 0x76, 0xd2, 0x84, 0xda, 0xcf, 0x8,  0x0,  0xb,  0x14, 0x67,
      0xc1, 0x43, 0x45, 0x59, 0xe2, 0x85, 0x7b, 0xcd, 0x3b, 0x0,  0x14, 0x81, 0x45, 0xa7, 0x1e, 0x78, 0xa1, 0xf,  0xda,
      0x5,  0xc4, 0x95, 0x88, 0xf3, 0xaa, 0x6a, 0xa6, 0xd0, 0x84, 0x6d, 0x7f, 0x0,  0x17, 0x6c, 0x49, 0xe1, 0x56, 0x16,
      0x26, 0xe4, 0x45, 0xbf, 0xec, 0xab, 0x19, 0xc7, 0x65, 0x4c, 0x10, 0x2d, 0xbf, 0x9b, 0xdf, 0x35, 0xc1, 0x8,  0x0,
      0x16, 0x9a, 0x5,  0x70, 0x9e, 0x20, 0x64, 0x6a, 0xd4, 0xe4, 0xf3, 0xf5, 0xb3, 0x1b, 0x8c, 0xf,  0x6,  0xc1, 0xd7,
      0x7,  0x1c, 0x52, 0x10, 0x0,  0xf,  0xec, 0x98, 0x62, 0xb7, 0xcb, 0xef, 0xbd, 0x3a, 0x41, 0xf1, 0xc8, 0x18, 0xcf,
      0xdd, 0x69, 0x0,  0x5,  0xc6, 0x42, 0x79, 0x24, 0x6,  0x0,  0xa,  0x93, 0xc,  0xed, 0xd2, 0x8,  0x90, 0x77, 0x7d,
      0x81, 0x64, 0x0,  0x12, 0xb0, 0xe7, 0x91, 0x55, 0x8a, 0xf1, 0xfc, 0xb9, 0xb2, 0xee, 0x88, 0x6f, 0x51, 0x5,  0xbb,
      0xa8, 0xe4, 0xc5, 0x0,  0x4,  0x2a, 0xd2, 0x1c, 0xfc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x21, 0x36, 0xae, 0x14, 0x4,  0x6d, 0x25, 0xb6, 0xb4, 0x4f, 0x6b,
                           0x24, 0x72, 0x56, 0x2a, 0xe1, 0x5c, 0x28, 0xa7, 0xe8, 0x39, 0x71};
  uint8_t bytesprops0[] = {0xbd, 0x66, 0x1a, 0x63, 0xfe, 0xe};
  uint8_t bytesprops2[] = {0x3a, 0xf6, 0x2e, 0x1d, 0xc1, 0x72, 0x14, 0xe0, 0xba, 0x2d, 0xd1, 0xb0, 0xd0,
                           0x75, 0xd3, 0x32, 0xfb, 0x87, 0x6,  0x88, 0xd4, 0x91, 0xa1, 0xc3, 0x59};
  uint8_t bytesprops3[] = {0xf6, 0x80, 0xda, 0x66, 0xfe, 0xd5, 0x34, 0x52, 0x91, 0x8c, 0xf4, 0xd4,
                           0xad, 0xdd, 0x3b, 0x5,  0xa8, 0xff, 0x36, 0x6d, 0x2,  0x4b, 0xcb, 0x66};
  uint8_t bytesprops4[] = {0x6f, 0xca, 0x14, 0x2d, 0xf6, 0x7b, 0x77, 0xca, 0xea, 0x66, 0xb3, 0x20};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops0}, .v = {22, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29837}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1899}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8879}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd0, 0xcb, 0xc6, 0xe0, 0xc6, 0x76, 0xd2, 0x84, 0xda, 0xcf, 0x8};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x14, 0x67, 0xc1, 0x43, 0x45, 0x59, 0xe2, 0x85, 0x7b, 0xcd, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x81, 0x45, 0xa7, 0x1e, 0x78, 0xa1, 0xf,  0xda, 0x5,  0xc4,
                                     0x95, 0x88, 0xf3, 0xaa, 0x6a, 0xa6, 0xd0, 0x84, 0x6d, 0x7f};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6c, 0x49, 0xe1, 0x56, 0x16, 0x26, 0xe4, 0x45, 0xbf, 0xec, 0xab, 0x19,
                                     0xc7, 0x65, 0x4c, 0x10, 0x2d, 0xbf, 0x9b, 0xdf, 0x35, 0xc1, 0x8};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9a, 0x5,  0x70, 0x9e, 0x20, 0x64, 0x6a, 0xd4, 0xe4, 0xf3, 0xf5,
                                     0xb3, 0x1b, 0x8c, 0xf,  0x6,  0xc1, 0xd7, 0x7,  0x1c, 0x52, 0x10};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xec, 0x98, 0x62, 0xb7, 0xcb, 0xef, 0xbd, 0x3a,
                                     0x41, 0xf1, 0xc8, 0x18, 0xcf, 0xdd, 0x69};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc6, 0x42, 0x79, 0x24, 0x6};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x93, 0xc, 0xed, 0xd2, 0x8, 0x90, 0x77, 0x7d, 0x81, 0x64};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xb0, 0xe7, 0x91, 0x55, 0x8a, 0xf1, 0xfc, 0xb9, 0xb2,
                                     0xee, 0x88, 0x6f, 0x51, 0x5,  0xbb, 0xa8, 0xe4, 0xc5};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2a, 0xd2, 0x1c, 0xfc};
  lwmqtt_string_t topic_filter_s9 = {4, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2785, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 3283
// ["\151","\140k\206\231T4\165\221\&7\206\161\&9\DC2z9\GS\146\232`AuR/&\215\192\226\253","\243?\170\SYNAk\239?W\173","\143l\157\212\165\140<-\"\250\185\166\SOHpBD\213\&5Y3\178\150\186\n\187\194%","\r\250\DLE<g\149\224\159\159\152\211i\135\163\142&\165\219\EM:\SI\DLE6[\187q!$","\ETXS\251\129\133,\183\186>'?\210\182\153\215\198\173\206k\201Vo\185\236\229\229","\176\171\220\205\STX>\227\CAN\239\167OEZ0s\170\DC2\165B\132r\134?\170L\216\246\162\"\136","\208^\167Dh\248\177\171~k\f\134U8
// \216\198\252\130\US\DEL*Mq)\186","\164[\150\159l\245a\169W]\ENQ=D\230\143\235\193\215\183:\217\244\EOT\236\CAN\221)\210","\191X\198\252\128?S\147\r>O\b\SUB\215L\222\239\201\157dEh\236\DC2\214'\186\243\\\161"]
// [PropRequestResponseInformation 161,PropRetainAvailable 224,PropMaximumQoS 111]
TEST(Unsubscribe5QCTest, Encode26) {
  uint8_t pkt[] = {
      0xa2, 0x87, 0x2,  0xc,  0xd3, 0x6,  0x19, 0xa1, 0x25, 0xe0, 0x24, 0x6f, 0x0,  0x1,  0x97, 0x0,  0x1c, 0x8c, 0x6b,
      0xce, 0xe7, 0x54, 0x34, 0xa5, 0xdd, 0x37, 0xce, 0xa1, 0x39, 0x12, 0x7a, 0x39, 0x1d, 0x92, 0xe8, 0x60, 0x41, 0x75,
      0x52, 0x2f, 0x26, 0xd7, 0xc0, 0xe2, 0xfd, 0x0,  0xa,  0xf3, 0x3f, 0xaa, 0x16, 0x41, 0x6b, 0xef, 0x3f, 0x57, 0xad,
      0x0,  0x1b, 0x8f, 0x6c, 0x9d, 0xd4, 0xa5, 0x8c, 0x3c, 0x2d, 0x22, 0xfa, 0xb9, 0xa6, 0x1,  0x70, 0x42, 0x44, 0xd5,
      0x35, 0x59, 0x33, 0xb2, 0x96, 0xba, 0xa,  0xbb, 0xc2, 0x25, 0x0,  0x1c, 0xd,  0xfa, 0x10, 0x3c, 0x67, 0x95, 0xe0,
      0x9f, 0x9f, 0x98, 0xd3, 0x69, 0x87, 0xa3, 0x8e, 0x26, 0xa5, 0xdb, 0x19, 0x3a, 0xf,  0x10, 0x36, 0x5b, 0xbb, 0x71,
      0x21, 0x24, 0x0,  0x1a, 0x3,  0x53, 0xfb, 0x81, 0x85, 0x2c, 0xb7, 0xba, 0x3e, 0x27, 0x3f, 0xd2, 0xb6, 0x99, 0xd7,
      0xc6, 0xad, 0xce, 0x6b, 0xc9, 0x56, 0x6f, 0xb9, 0xec, 0xe5, 0xe5, 0x0,  0x1e, 0xb0, 0xab, 0xdc, 0xcd, 0x2,  0x3e,
      0xe3, 0x18, 0xef, 0xa7, 0x4f, 0x45, 0x5a, 0x30, 0x73, 0xaa, 0x12, 0xa5, 0x42, 0x84, 0x72, 0x86, 0x3f, 0xaa, 0x4c,
      0xd8, 0xf6, 0xa2, 0x22, 0x88, 0x0,  0x1a, 0xd0, 0x5e, 0xa7, 0x44, 0x68, 0xf8, 0xb1, 0xab, 0x7e, 0x6b, 0xc,  0x86,
      0x55, 0x38, 0x20, 0xd8, 0xc6, 0xfc, 0x82, 0x1f, 0x7f, 0x2a, 0x4d, 0x71, 0x29, 0xba, 0x0,  0x1c, 0xa4, 0x5b, 0x96,
      0x9f, 0x6c, 0xf5, 0x61, 0xa9, 0x57, 0x5d, 0x5,  0x3d, 0x44, 0xe6, 0x8f, 0xeb, 0xc1, 0xd7, 0xb7, 0x3a, 0xd9, 0xf4,
      0x4,  0xec, 0x18, 0xdd, 0x29, 0xd2, 0x0,  0x1e, 0xbf, 0x58, 0xc6, 0xfc, 0x80, 0x3f, 0x53, 0x93, 0xd,  0x3e, 0x4f,
      0x8,  0x1a, 0xd7, 0x4c, 0xde, 0xef, 0xc9, 0x9d, 0x64, 0x45, 0x68, 0xec, 0x12, 0xd6, 0x27, 0xba, 0xf3, 0x5c, 0xa1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 111}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x97};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8c, 0x6b, 0xce, 0xe7, 0x54, 0x34, 0xa5, 0xdd, 0x37, 0xce,
                                     0xa1, 0x39, 0x12, 0x7a, 0x39, 0x1d, 0x92, 0xe8, 0x60, 0x41,
                                     0x75, 0x52, 0x2f, 0x26, 0xd7, 0xc0, 0xe2, 0xfd};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf3, 0x3f, 0xaa, 0x16, 0x41, 0x6b, 0xef, 0x3f, 0x57, 0xad};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8f, 0x6c, 0x9d, 0xd4, 0xa5, 0x8c, 0x3c, 0x2d, 0x22, 0xfa, 0xb9, 0xa6, 0x1, 0x70,
                                     0x42, 0x44, 0xd5, 0x35, 0x59, 0x33, 0xb2, 0x96, 0xba, 0xa,  0xbb, 0xc2, 0x25};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd,  0xfa, 0x10, 0x3c, 0x67, 0x95, 0xe0, 0x9f, 0x9f, 0x98,
                                     0xd3, 0x69, 0x87, 0xa3, 0x8e, 0x26, 0xa5, 0xdb, 0x19, 0x3a,
                                     0xf,  0x10, 0x36, 0x5b, 0xbb, 0x71, 0x21, 0x24};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3,  0x53, 0xfb, 0x81, 0x85, 0x2c, 0xb7, 0xba, 0x3e, 0x27, 0x3f, 0xd2, 0xb6,
                                     0x99, 0xd7, 0xc6, 0xad, 0xce, 0x6b, 0xc9, 0x56, 0x6f, 0xb9, 0xec, 0xe5, 0xe5};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb0, 0xab, 0xdc, 0xcd, 0x2,  0x3e, 0xe3, 0x18, 0xef, 0xa7,
                                     0x4f, 0x45, 0x5a, 0x30, 0x73, 0xaa, 0x12, 0xa5, 0x42, 0x84,
                                     0x72, 0x86, 0x3f, 0xaa, 0x4c, 0xd8, 0xf6, 0xa2, 0x22, 0x88};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd0, 0x5e, 0xa7, 0x44, 0x68, 0xf8, 0xb1, 0xab, 0x7e, 0x6b, 0xc,  0x86, 0x55,
                                     0x38, 0x20, 0xd8, 0xc6, 0xfc, 0x82, 0x1f, 0x7f, 0x2a, 0x4d, 0x71, 0x29, 0xba};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa4, 0x5b, 0x96, 0x9f, 0x6c, 0xf5, 0x61, 0xa9, 0x57, 0x5d,
                                     0x5,  0x3d, 0x44, 0xe6, 0x8f, 0xeb, 0xc1, 0xd7, 0xb7, 0x3a,
                                     0xd9, 0xf4, 0x4,  0xec, 0x18, 0xdd, 0x29, 0xd2};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xbf, 0x58, 0xc6, 0xfc, 0x80, 0x3f, 0x53, 0x93, 0xd,  0x3e,
                                     0x4f, 0x8,  0x1a, 0xd7, 0x4c, 0xde, 0xef, 0xc9, 0x9d, 0x64,
                                     0x45, 0x68, 0xec, 0x12, 0xd6, 0x27, 0xba, 0xf3, 0x5c, 0xa1};
  lwmqtt_string_t topic_filter_s9 = {30, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3283, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22892
// ["\235\157\254\138\f\159\160H\226\159\167\206[L\221\133p\185;","/\162\192\a\217\171[\233\178\227GTN~\SOHzIl\DC3G\195C(FH\241=He\251","n\212\225g\136\SYNK\222\238\207\137","","\ETB7!\RSO\252\EM4B\253\DEL\USs}\246e\192\201\135\DC1\174","\183~\216m","\174K\216\SUB\179
// \EMB\EMpq\EMl"] [PropMessageExpiryInterval 30491,PropMessageExpiryInterval 12126]
TEST(Unsubscribe5QCTest, Encode27) {
  uint8_t pkt[] = {0xa2, 0x7d, 0x59, 0x6c, 0xa,  0x2,  0x0,  0x0,  0x77, 0x1b, 0x2,  0x0,  0x0,  0x2f, 0x5e, 0x0,
                   0x13, 0xeb, 0x9d, 0xfe, 0x8a, 0xc,  0x9f, 0xa0, 0x48, 0xe2, 0x9f, 0xa7, 0xce, 0x5b, 0x4c, 0xdd,
                   0x85, 0x70, 0xb9, 0x3b, 0x0,  0x1e, 0x2f, 0xa2, 0xc0, 0x7,  0xd9, 0xab, 0x5b, 0xe9, 0xb2, 0xe3,
                   0x47, 0x54, 0x4e, 0x7e, 0x1,  0x7a, 0x49, 0x6c, 0x13, 0x47, 0xc3, 0x43, 0x28, 0x46, 0x48, 0xf1,
                   0x3d, 0x48, 0x65, 0xfb, 0x0,  0xb,  0x6e, 0xd4, 0xe1, 0x67, 0x88, 0x16, 0x4b, 0xde, 0xee, 0xcf,
                   0x89, 0x0,  0x0,  0x0,  0x15, 0x17, 0x37, 0x21, 0x1e, 0x4f, 0xfc, 0x19, 0x34, 0x42, 0xfd, 0x7f,
                   0x1f, 0x73, 0x7d, 0xf6, 0x65, 0xc0, 0xc9, 0x87, 0x11, 0xae, 0x0,  0x4,  0xb7, 0x7e, 0xd8, 0x6d,
                   0x0,  0xd,  0xae, 0x4b, 0xd8, 0x1a, 0xb3, 0x20, 0x19, 0x42, 0x19, 0x70, 0x71, 0x19, 0x6c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30491}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12126}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xeb, 0x9d, 0xfe, 0x8a, 0xc,  0x9f, 0xa0, 0x48, 0xe2, 0x9f,
                                     0xa7, 0xce, 0x5b, 0x4c, 0xdd, 0x85, 0x70, 0xb9, 0x3b};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2f, 0xa2, 0xc0, 0x7,  0xd9, 0xab, 0x5b, 0xe9, 0xb2, 0xe3,
                                     0x47, 0x54, 0x4e, 0x7e, 0x1,  0x7a, 0x49, 0x6c, 0x13, 0x47,
                                     0xc3, 0x43, 0x28, 0x46, 0x48, 0xf1, 0x3d, 0x48, 0x65, 0xfb};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6e, 0xd4, 0xe1, 0x67, 0x88, 0x16, 0x4b, 0xde, 0xee, 0xcf, 0x89};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x17, 0x37, 0x21, 0x1e, 0x4f, 0xfc, 0x19, 0x34, 0x42, 0xfd, 0x7f,
                                     0x1f, 0x73, 0x7d, 0xf6, 0x65, 0xc0, 0xc9, 0x87, 0x11, 0xae};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb7, 0x7e, 0xd8, 0x6d};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xae, 0x4b, 0xd8, 0x1a, 0xb3, 0x20, 0x19, 0x42, 0x19, 0x70, 0x71, 0x19, 0x6c};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22892, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 19885
// ["1PI\t\197=\237\156\210+\211\143\197F\237j\226K\DC1\ETB\231\195\ACK\162\148\247_\252\173","\t)\128a\GS\181\NUL\197\183{\205;m\230\199\US|l\166i\215'\180\129\184\186","\246D|d\241G\232+$\163\NAKm","\165","\r\189\ACK\138&\129\225V\220\215X\ESC\DLE<\192\150s\207","U\214xL\223\215.ob5\166\173wr\209\&1\167\&9\rJ\145\DC4\255","\DC3\215c\169\153\250\207@\186\242\r\"\183\129Q\RS\ETBbEj\160","L-\181*\192\&1}"]
// [PropReasonString "\159\193\135\239W\133\141\v\147\&9[<\156",PropContentType
// "\251n\183\239\139gc\DC2\"\GS0",PropSessionExpiryInterval 7449]
TEST(Unsubscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0xa2, 0xbf, 0x1,  0x4d, 0xad, 0x23, 0x1f, 0x0,  0xd,  0x9f, 0xc1, 0x87, 0xef, 0x57, 0x85, 0x8d, 0xb,
                   0x93, 0x39, 0x5b, 0x3c, 0x9c, 0x3,  0x0,  0xb,  0xfb, 0x6e, 0xb7, 0xef, 0x8b, 0x67, 0x63, 0x12, 0x22,
                   0x1d, 0x30, 0x11, 0x0,  0x0,  0x1d, 0x19, 0x0,  0x1d, 0x31, 0x50, 0x49, 0x9,  0xc5, 0x3d, 0xed, 0x9c,
                   0xd2, 0x2b, 0xd3, 0x8f, 0xc5, 0x46, 0xed, 0x6a, 0xe2, 0x4b, 0x11, 0x17, 0xe7, 0xc3, 0x6,  0xa2, 0x94,
                   0xf7, 0x5f, 0xfc, 0xad, 0x0,  0x1a, 0x9,  0x29, 0x80, 0x61, 0x1d, 0xb5, 0x0,  0xc5, 0xb7, 0x7b, 0xcd,
                   0x3b, 0x6d, 0xe6, 0xc7, 0x1f, 0x7c, 0x6c, 0xa6, 0x69, 0xd7, 0x27, 0xb4, 0x81, 0xb8, 0xba, 0x0,  0xc,
                   0xf6, 0x44, 0x7c, 0x64, 0xf1, 0x47, 0xe8, 0x2b, 0x24, 0xa3, 0x15, 0x6d, 0x0,  0x1,  0xa5, 0x0,  0x12,
                   0xd,  0xbd, 0x6,  0x8a, 0x26, 0x81, 0xe1, 0x56, 0xdc, 0xd7, 0x58, 0x1b, 0x10, 0x3c, 0xc0, 0x96, 0x73,
                   0xcf, 0x0,  0x17, 0x55, 0xd6, 0x78, 0x4c, 0xdf, 0xd7, 0x2e, 0x6f, 0x62, 0x35, 0xa6, 0xad, 0x77, 0x72,
                   0xd1, 0x31, 0xa7, 0x39, 0xd,  0x4a, 0x91, 0x14, 0xff, 0x0,  0x15, 0x13, 0xd7, 0x63, 0xa9, 0x99, 0xfa,
                   0xcf, 0x40, 0xba, 0xf2, 0xd,  0x22, 0xb7, 0x81, 0x51, 0x1e, 0x17, 0x62, 0x45, 0x6a, 0xa0, 0x0,  0x7,
                   0x4c, 0x2d, 0xb5, 0x2a, 0xc0, 0x31, 0x7d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9f, 0xc1, 0x87, 0xef, 0x57, 0x85, 0x8d, 0xb, 0x93, 0x39, 0x5b, 0x3c, 0x9c};
  uint8_t bytesprops1[] = {0xfb, 0x6e, 0xb7, 0xef, 0x8b, 0x67, 0x63, 0x12, 0x22, 0x1d, 0x30};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7449}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x31, 0x50, 0x49, 0x9,  0xc5, 0x3d, 0xed, 0x9c, 0xd2, 0x2b,
                                     0xd3, 0x8f, 0xc5, 0x46, 0xed, 0x6a, 0xe2, 0x4b, 0x11, 0x17,
                                     0xe7, 0xc3, 0x6,  0xa2, 0x94, 0xf7, 0x5f, 0xfc, 0xad};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9,  0x29, 0x80, 0x61, 0x1d, 0xb5, 0x0,  0xc5, 0xb7, 0x7b, 0xcd, 0x3b, 0x6d,
                                     0xe6, 0xc7, 0x1f, 0x7c, 0x6c, 0xa6, 0x69, 0xd7, 0x27, 0xb4, 0x81, 0xb8, 0xba};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf6, 0x44, 0x7c, 0x64, 0xf1, 0x47, 0xe8, 0x2b, 0x24, 0xa3, 0x15, 0x6d};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa5};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd,  0xbd, 0x6,  0x8a, 0x26, 0x81, 0xe1, 0x56, 0xdc,
                                     0xd7, 0x58, 0x1b, 0x10, 0x3c, 0xc0, 0x96, 0x73, 0xcf};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x55, 0xd6, 0x78, 0x4c, 0xdf, 0xd7, 0x2e, 0x6f, 0x62, 0x35, 0xa6, 0xad,
                                     0x77, 0x72, 0xd1, 0x31, 0xa7, 0x39, 0xd,  0x4a, 0x91, 0x14, 0xff};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x13, 0xd7, 0x63, 0xa9, 0x99, 0xfa, 0xcf, 0x40, 0xba, 0xf2, 0xd,
                                     0x22, 0xb7, 0x81, 0x51, 0x1e, 0x17, 0x62, 0x45, 0x6a, 0xa0};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x4c, 0x2d, 0xb5, 0x2a, 0xc0, 0x31, 0x7d};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19885, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27189
// ["\150\235'\154\141\134|\222\223]bA\223\139E\175+\178\158\176FT\218\DC4","\128\213\212b\169;\241\208\"!\167","\162\SO\SYN\164P(\US\SIR{\147\253k\235G\169;ZQ\NULH\DC3\DELP\SOH\222","F\229\157\217\ACK\155\rz\245\&8/\173G5\177\244S-8\150\198\194\&3\222)\209\STX","\191\143\241\237\222\157\191\187\142M}\207LC|\146","8\ENQ\229\241|Z^","*g\f\244dM\235\193*\177\&9\149\133\161","\168/\EOT\222\a^z\187\139\135","\167\206\130\&1\168\ETBH\200\241\221C\235\134Z9J\193\215v\237\131\197"]
// [PropRequestProblemInformation 244,PropSubscriptionIdentifierAvailable 57,PropMessageExpiryInterval
// 25256,PropRetainAvailable 180,PropCorrelationData "\214\166\DC1\175\199/`",PropResponseInformation
// "\244D{\US\150\SYNk=\184\140A\225|0\138"]
TEST(Unsubscribe5QCTest, Encode29) {
  uint8_t pkt[] = {0xa2, 0xd9, 0x1,  0x6a, 0x35, 0x27, 0x17, 0xf4, 0x29, 0x39, 0x2,  0x0,  0x0,  0x62, 0xa8, 0x25, 0xb4,
                   0x9,  0x0,  0x7,  0xd6, 0xa6, 0x11, 0xaf, 0xc7, 0x2f, 0x60, 0x1a, 0x0,  0xf,  0xf4, 0x44, 0x7b, 0x1f,
                   0x96, 0x16, 0x6b, 0x3d, 0xb8, 0x8c, 0x41, 0xe1, 0x7c, 0x30, 0x8a, 0x0,  0x18, 0x96, 0xeb, 0x27, 0x9a,
                   0x8d, 0x86, 0x7c, 0xde, 0xdf, 0x5d, 0x62, 0x41, 0xdf, 0x8b, 0x45, 0xaf, 0x2b, 0xb2, 0x9e, 0xb0, 0x46,
                   0x54, 0xda, 0x14, 0x0,  0xb,  0x80, 0xd5, 0xd4, 0x62, 0xa9, 0x3b, 0xf1, 0xd0, 0x22, 0x21, 0xa7, 0x0,
                   0x1a, 0xa2, 0xe,  0x16, 0xa4, 0x50, 0x28, 0x1f, 0xf,  0x52, 0x7b, 0x93, 0xfd, 0x6b, 0xeb, 0x47, 0xa9,
                   0x3b, 0x5a, 0x51, 0x0,  0x48, 0x13, 0x7f, 0x50, 0x1,  0xde, 0x0,  0x1b, 0x46, 0xe5, 0x9d, 0xd9, 0x6,
                   0x9b, 0xd,  0x7a, 0xf5, 0x38, 0x2f, 0xad, 0x47, 0x35, 0xb1, 0xf4, 0x53, 0x2d, 0x38, 0x96, 0xc6, 0xc2,
                   0x33, 0xde, 0x29, 0xd1, 0x2,  0x0,  0x10, 0xbf, 0x8f, 0xf1, 0xed, 0xde, 0x9d, 0xbf, 0xbb, 0x8e, 0x4d,
                   0x7d, 0xcf, 0x4c, 0x43, 0x7c, 0x92, 0x0,  0x7,  0x38, 0x5,  0xe5, 0xf1, 0x7c, 0x5a, 0x5e, 0x0,  0xe,
                   0x2a, 0x67, 0xc,  0xf4, 0x64, 0x4d, 0xeb, 0xc1, 0x2a, 0xb1, 0x39, 0x95, 0x85, 0xa1, 0x0,  0xa,  0xa8,
                   0x2f, 0x4,  0xde, 0x7,  0x5e, 0x7a, 0xbb, 0x8b, 0x87, 0x0,  0x16, 0xa7, 0xce, 0x82, 0x31, 0xa8, 0x17,
                   0x48, 0xc8, 0xf1, 0xdd, 0x43, 0xeb, 0x86, 0x5a, 0x39, 0x4a, 0xc1, 0xd7, 0x76, 0xed, 0x83, 0xc5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd6, 0xa6, 0x11, 0xaf, 0xc7, 0x2f, 0x60};
  uint8_t bytesprops1[] = {0xf4, 0x44, 0x7b, 0x1f, 0x96, 0x16, 0x6b, 0x3d, 0xb8, 0x8c, 0x41, 0xe1, 0x7c, 0x30, 0x8a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25256}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x96, 0xeb, 0x27, 0x9a, 0x8d, 0x86, 0x7c, 0xde, 0xdf, 0x5d, 0x62, 0x41,
                                     0xdf, 0x8b, 0x45, 0xaf, 0x2b, 0xb2, 0x9e, 0xb0, 0x46, 0x54, 0xda, 0x14};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x80, 0xd5, 0xd4, 0x62, 0xa9, 0x3b, 0xf1, 0xd0, 0x22, 0x21, 0xa7};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa2, 0xe,  0x16, 0xa4, 0x50, 0x28, 0x1f, 0xf,  0x52, 0x7b, 0x93, 0xfd, 0x6b,
                                     0xeb, 0x47, 0xa9, 0x3b, 0x5a, 0x51, 0x0,  0x48, 0x13, 0x7f, 0x50, 0x1,  0xde};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x46, 0xe5, 0x9d, 0xd9, 0x6,  0x9b, 0xd,  0x7a, 0xf5, 0x38, 0x2f, 0xad, 0x47, 0x35,
                                     0xb1, 0xf4, 0x53, 0x2d, 0x38, 0x96, 0xc6, 0xc2, 0x33, 0xde, 0x29, 0xd1, 0x2};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbf, 0x8f, 0xf1, 0xed, 0xde, 0x9d, 0xbf, 0xbb,
                                     0x8e, 0x4d, 0x7d, 0xcf, 0x4c, 0x43, 0x7c, 0x92};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x38, 0x5, 0xe5, 0xf1, 0x7c, 0x5a, 0x5e};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2a, 0x67, 0xc, 0xf4, 0x64, 0x4d, 0xeb, 0xc1, 0x2a, 0xb1, 0x39, 0x95, 0x85, 0xa1};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa8, 0x2f, 0x4, 0xde, 0x7, 0x5e, 0x7a, 0xbb, 0x8b, 0x87};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa7, 0xce, 0x82, 0x31, 0xa8, 0x17, 0x48, 0xc8, 0xf1, 0xdd, 0x43,
                                     0xeb, 0x86, 0x5a, 0x39, 0x4a, 0xc1, 0xd7, 0x76, 0xed, 0x83, 0xc5};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27189, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 10641
// ["\195Sa\217\ACK\194\232\166\EOT\a\175\198\164\196r\252M<T|\247|\225\ETBu,Y\DC4\182","\244u\140Q\229Ui\247[N\237kXd\172\182\252\136\216\203","-\232G\196\STX\177\161\185","\STX\171|5\142\131\236\&1\DC3\156,\197~2_Jn\187\240K\RS\179@\195\152\226\STX","\207\243\239\186\&7Fc\171\181CA\200\225\t\165\239\157","\179_\171\214\245\216\DC1\174\254,\172\SUB\DC2\173\172\SYN","S\142\SUBo6!\247\a\130Mt\223.'\139\219\228\232\211\214\208"]
// [PropMaximumQoS 183,PropMaximumQoS 96,PropWillDelayInterval 16303,PropRequestProblemInformation
// 193,PropMaximumPacketSize 19557,PropReceiveMaximum 32606,PropReceiveMaximum 14452,PropRequestResponseInformation
// 117,PropReasonString "\CAN\191\183\227\224",PropWildcardSubscriptionAvailable 96,PropReceiveMaximum
// 30811,PropRequestResponseInformation 132,PropWillDelayInterval 27024,PropWildcardSubscriptionAvailable 220]
TEST(Unsubscribe5QCTest, Encode30) {
  uint8_t pkt[] = {
      0xa2, 0xc9, 0x1,  0x29, 0x91, 0x2e, 0x24, 0xb7, 0x24, 0x60, 0x18, 0x0,  0x0,  0x3f, 0xaf, 0x17, 0xc1, 0x27, 0x0,
      0x0,  0x4c, 0x65, 0x21, 0x7f, 0x5e, 0x21, 0x38, 0x74, 0x19, 0x75, 0x1f, 0x0,  0x5,  0x18, 0xbf, 0xb7, 0xe3, 0xe0,
      0x28, 0x60, 0x21, 0x78, 0x5b, 0x19, 0x84, 0x18, 0x0,  0x0,  0x69, 0x90, 0x28, 0xdc, 0x0,  0x1d, 0xc3, 0x53, 0x61,
      0xd9, 0x6,  0xc2, 0xe8, 0xa6, 0x4,  0x7,  0xaf, 0xc6, 0xa4, 0xc4, 0x72, 0xfc, 0x4d, 0x3c, 0x54, 0x7c, 0xf7, 0x7c,
      0xe1, 0x17, 0x75, 0x2c, 0x59, 0x14, 0xb6, 0x0,  0x14, 0xf4, 0x75, 0x8c, 0x51, 0xe5, 0x55, 0x69, 0xf7, 0x5b, 0x4e,
      0xed, 0x6b, 0x58, 0x64, 0xac, 0xb6, 0xfc, 0x88, 0xd8, 0xcb, 0x0,  0x8,  0x2d, 0xe8, 0x47, 0xc4, 0x2,  0xb1, 0xa1,
      0xb9, 0x0,  0x1b, 0x2,  0xab, 0x7c, 0x35, 0x8e, 0x83, 0xec, 0x31, 0x13, 0x9c, 0x2c, 0xc5, 0x7e, 0x32, 0x5f, 0x4a,
      0x6e, 0xbb, 0xf0, 0x4b, 0x1e, 0xb3, 0x40, 0xc3, 0x98, 0xe2, 0x2,  0x0,  0x11, 0xcf, 0xf3, 0xef, 0xba, 0x37, 0x46,
      0x63, 0xab, 0xb5, 0x43, 0x41, 0xc8, 0xe1, 0x9,  0xa5, 0xef, 0x9d, 0x0,  0x10, 0xb3, 0x5f, 0xab, 0xd6, 0xf5, 0xd8,
      0x11, 0xae, 0xfe, 0x2c, 0xac, 0x1a, 0x12, 0xad, 0xac, 0x16, 0x0,  0x15, 0x53, 0x8e, 0x1a, 0x6f, 0x36, 0x21, 0xf7,
      0x7,  0x82, 0x4d, 0x74, 0xdf, 0x2e, 0x27, 0x8b, 0xdb, 0xe4, 0xe8, 0xd3, 0xd6, 0xd0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x18, 0xbf, 0xb7, 0xe3, 0xe0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16303}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19557}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32606}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14452}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30811}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27024}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 220}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xc3, 0x53, 0x61, 0xd9, 0x6,  0xc2, 0xe8, 0xa6, 0x4,  0x7,
                                     0xaf, 0xc6, 0xa4, 0xc4, 0x72, 0xfc, 0x4d, 0x3c, 0x54, 0x7c,
                                     0xf7, 0x7c, 0xe1, 0x17, 0x75, 0x2c, 0x59, 0x14, 0xb6};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf4, 0x75, 0x8c, 0x51, 0xe5, 0x55, 0x69, 0xf7, 0x5b, 0x4e,
                                     0xed, 0x6b, 0x58, 0x64, 0xac, 0xb6, 0xfc, 0x88, 0xd8, 0xcb};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2d, 0xe8, 0x47, 0xc4, 0x2, 0xb1, 0xa1, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2,  0xab, 0x7c, 0x35, 0x8e, 0x83, 0xec, 0x31, 0x13, 0x9c, 0x2c, 0xc5, 0x7e, 0x32,
                                     0x5f, 0x4a, 0x6e, 0xbb, 0xf0, 0x4b, 0x1e, 0xb3, 0x40, 0xc3, 0x98, 0xe2, 0x2};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xcf, 0xf3, 0xef, 0xba, 0x37, 0x46, 0x63, 0xab, 0xb5,
                                     0x43, 0x41, 0xc8, 0xe1, 0x9,  0xa5, 0xef, 0x9d};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb3, 0x5f, 0xab, 0xd6, 0xf5, 0xd8, 0x11, 0xae,
                                     0xfe, 0x2c, 0xac, 0x1a, 0x12, 0xad, 0xac, 0x16};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x53, 0x8e, 0x1a, 0x6f, 0x36, 0x21, 0xf7, 0x7,  0x82, 0x4d, 0x74,
                                     0xdf, 0x2e, 0x27, 0x8b, 0xdb, 0xe4, 0xe8, 0xd3, 0xd6, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10641, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeResponse 24860 [] []
TEST(UnsubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0xb0, 0x2, 0x61, 0x1c};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24860);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 3894 [] []
TEST(UnsubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0xb0, 0x2, 0xf, 0x36};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3894);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 2326 [] []
TEST(UnsubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0xb0, 0x2, 0x9, 0x16};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2326);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 10530 [] []
TEST(UnsubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0xb0, 0x2, 0x29, 0x22};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10530);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 29099 [] []
TEST(UnsubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0xb0, 0x2, 0x71, 0xab};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29099);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 3499 [] []
TEST(UnsubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0xb0, 0x2, 0xd, 0xab};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3499);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 25674 [] []
TEST(UnsubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0xb0, 0x2, 0x64, 0x4a};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25674);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 11351 [] []
TEST(UnsubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0xb0, 0x2, 0x2c, 0x57};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11351);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 11966 [] []
TEST(UnsubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0xb0, 0x2, 0x2e, 0xbe};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11966);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 28946 [] []
TEST(UnsubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0xb0, 0x2, 0x71, 0x12};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28946);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 29805 [] []
TEST(UnsubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0xb0, 0x2, 0x74, 0x6d};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29805);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 19841 [] []
TEST(UnsubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0xb0, 0x2, 0x4d, 0x81};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19841);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 20127 [] []
TEST(UnsubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0xb0, 0x2, 0x4e, 0x9f};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20127);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 6820 [] []
TEST(UnsubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0xb0, 0x2, 0x1a, 0xa4};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6820);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 20949 [] []
TEST(UnsubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0xb0, 0x2, 0x51, 0xd5};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20949);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 15084 [] []
TEST(UnsubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0xb0, 0x2, 0x3a, 0xec};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15084);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 3745 [] []
TEST(UnsubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0xb0, 0x2, 0xe, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3745);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 2642 [] []
TEST(UnsubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0xb0, 0x2, 0xa, 0x52};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2642);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 11641 [] []
TEST(UnsubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0xb0, 0x2, 0x2d, 0x79};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11641);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 5146 [] []
TEST(UnsubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0xb0, 0x2, 0x14, 0x1a};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5146);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 19495 [] []
TEST(UnsubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0xb0, 0x2, 0x4c, 0x27};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19495);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 2650 [] []
TEST(UnsubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0xb0, 0x2, 0xa, 0x5a};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2650);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 4720 [] []
TEST(UnsubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0xb0, 0x2, 0x12, 0x70};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4720);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 7392 [] []
TEST(UnsubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0xb0, 0x2, 0x1c, 0xe0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7392);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 18418 [] []
TEST(UnsubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0xb0, 0x2, 0x47, 0xf2};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18418);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 9706 [] []
TEST(UnsubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0xb0, 0x2, 0x25, 0xea};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9706);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 5357 [] []
TEST(UnsubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0xb0, 0x2, 0x14, 0xed};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5357);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 25609 [] []
TEST(UnsubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0xb0, 0x2, 0x64, 0x9};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25609);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 8043 [] []
TEST(UnsubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0xb0, 0x2, 0x1f, 0x6b};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8043);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 7204 [] []
TEST(UnsubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0xb0, 0x2, 0x1c, 0x24};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7204);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 24860 [PropMessageExpiryInterval 25678,PropServerReference
// "/\253#\195\214\135\207",PropPayloadFormatIndicator 165,PropReceiveMaximum 10195,PropServerReference
// "\175I",PropCorrelationData
// "\235%b\133\177\167{W,\162]<\133\&2T`1\170\va\SO\226NNw\243\133Vh\156",PropRequestResponseInformation
// 153,PropContentType "\ENQ\RS7\SYNc\161\v\NUL\169\248\150J\201\197=\ENQ\190",PropMessageExpiryInterval
// 11970,PropAuthenticationData "",PropServerKeepAlive 4559,PropSubscriptionIdentifier 4,PropServerReference
// "C\176\CAN4\216[\136\187\223\198\184\205\a\SUB",PropReasonString
// "g\206\&5\128\227(\134\161\171\t\131f",PropSharedSubscriptionAvailable 29,PropReceiveMaximum 16106,PropResponseTopic
// "\158\152\GS:\STX1S\RS\EOT",PropTopicAliasMaximum 24112,PropAuthenticationMethod "\ETX\EM\187-\178\228U"]
// [UnsubNotAuthorized,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode1) {
  uint8_t pkt[] = {0xb0, 0xb6, 0x1,  0x61, 0x1c, 0x9b, 0x1,  0x2,  0x0,  0x0,  0x64, 0x4e, 0x1c, 0x0,  0x7,  0x2f, 0xfd,
                   0x23, 0xc3, 0xd6, 0x87, 0xcf, 0x1,  0xa5, 0x21, 0x27, 0xd3, 0x1c, 0x0,  0x2,  0xaf, 0x49, 0x9,  0x0,
                   0x1e, 0xeb, 0x25, 0x62, 0x85, 0xb1, 0xa7, 0x7b, 0x57, 0x2c, 0xa2, 0x5d, 0x3c, 0x85, 0x32, 0x54, 0x60,
                   0x31, 0xaa, 0xb,  0x61, 0xe,  0xe2, 0x4e, 0x4e, 0x77, 0xf3, 0x85, 0x56, 0x68, 0x9c, 0x19, 0x99, 0x3,
                   0x0,  0x11, 0x5,  0x1e, 0x37, 0x16, 0x63, 0xa1, 0xb,  0x0,  0xa9, 0xf8, 0x96, 0x4a, 0xc9, 0xc5, 0x3d,
                   0x5,  0xbe, 0x2,  0x0,  0x0,  0x2e, 0xc2, 0x16, 0x0,  0x0,  0x13, 0x11, 0xcf, 0xb,  0x4,  0x1c, 0x0,
                   0xe,  0x43, 0xb0, 0x18, 0x34, 0xd8, 0x5b, 0x88, 0xbb, 0xdf, 0xc6, 0xb8, 0xcd, 0x7,  0x1a, 0x1f, 0x0,
                   0xc,  0x67, 0xce, 0x35, 0x80, 0xe3, 0x28, 0x86, 0xa1, 0xab, 0x9,  0x83, 0x66, 0x2a, 0x1d, 0x21, 0x3e,
                   0xea, 0x8,  0x0,  0x9,  0x9e, 0x98, 0x1d, 0x3a, 0x2,  0x31, 0x53, 0x1e, 0x4,  0x22, 0x5e, 0x30, 0x15,
                   0x0,  0x7,  0x3,  0x19, 0xbb, 0x2d, 0xb2, 0xe4, 0x55, 0x87, 0x0,  0x91, 0x11, 0x87, 0x83, 0x80, 0x8f,
                   0x11, 0x91, 0x83, 0x8f, 0x8f, 0x91, 0x80, 0x83, 0x80, 0x11, 0x91, 0x11, 0x91, 0x83, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[23];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 23, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24860);
  EXPECT_EQ(count, 23);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 3894 [PropReasonString
// "A\238\220^\134u\207\244\233]\158\b+B\208\154\218\&9\206\US\200\193",PropRetainAvailable 121]
// [UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode2) {
  uint8_t pkt[] = {0xb0, 0x21, 0xf,  0x36, 0x1b, 0x1f, 0x0,  0x16, 0x41, 0xee, 0xdc, 0x5e,
                   0x86, 0x75, 0xcf, 0xf4, 0xe9, 0x5d, 0x9e, 0x8,  0x2b, 0x42, 0xd0, 0x9a,
                   0xda, 0x39, 0xce, 0x1f, 0xc8, 0xc1, 0x25, 0x79, 0x87, 0x11, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[3];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3894);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 2326 [PropServerKeepAlive 24388,PropContentType
// "\152Q\214'{\169Cl\189_\164\USU\164(\202p\160\159\159\200d\NUL\DLEk\228\188",PropSubscriptionIdentifierAvailable
// 7,PropRequestProblemInformation 224,PropSubscriptionIdentifierAvailable 225,PropResponseInformation
// "@Y\255!\245\212G\157l|",PropReceiveMaximum 7833,PropPayloadFormatIndicator 27,PropResponseInformation
// "\200\ESC\GS\203xTA>hC\EOT\222\231\RSw\206L\183\217",PropSessionExpiryInterval 20207,PropMessageExpiryInterval
// 10350,PropRequestProblemInformation 187,PropSubscriptionIdentifier 12]
// [UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0xb0, 0x65, 0x9,  0x16, 0x5d, 0x13, 0x5f, 0x44, 0x3,  0x0,  0x1b, 0x98, 0x51, 0xd6, 0x27,
                   0x7b, 0xa9, 0x43, 0x6c, 0xbd, 0x5f, 0xa4, 0x1f, 0x55, 0xa4, 0x28, 0xca, 0x70, 0xa0, 0x9f,
                   0x9f, 0xc8, 0x64, 0x0,  0x10, 0x6b, 0xe4, 0xbc, 0x29, 0x7,  0x17, 0xe0, 0x29, 0xe1, 0x1a,
                   0x0,  0xa,  0x40, 0x59, 0xff, 0x21, 0xf5, 0xd4, 0x47, 0x9d, 0x6c, 0x7c, 0x21, 0x1e, 0x99,
                   0x1,  0x1b, 0x1a, 0x0,  0x13, 0xc8, 0x1b, 0x1d, 0xcb, 0x78, 0x54, 0x41, 0x3e, 0x68, 0x43,
                   0x4,  0xde, 0xe7, 0x1e, 0x77, 0xce, 0x4c, 0xb7, 0xd9, 0x11, 0x0,  0x0,  0x4e, 0xef, 0x2,
                   0x0,  0x0,  0x28, 0x6e, 0x17, 0xbb, 0xb,  0xc,  0x8f, 0x80, 0x91, 0x80, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[5];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2326);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 10530 [PropAuthenticationData
// "\209\210\SI\198\NUL]x~Jd\216l\174\DC2\160\168\199\145\n\SOHn\206\v",PropSubscriptionIdentifier
// 32,PropMessageExpiryInterval 17080,PropAuthenticationData "c\200",PropTopicAliasMaximum 14580,PropCorrelationData
// "\SYN\188\240\206\178>\241\"\CAN\EOT\230\185\238\199\191\&3\135\129\166\DC1\250\&6\246=\140:",PropServerReference
// "\149\179g\166\253X\EM\167\147\200\DC1\199\SUB}",PropReasonString
// "%\161(R\183&\SOH\220\135\&6N\SYN<r?\RS\219\SOH\253*!\209\231\SO\151\210\t\184\233",PropTopicAlias
// 6963,PropServerReference
// "{rY\205\&5h\195\158\191\191J\168\202\ETX>\DC4\149\132\247:B\SYN;\188\a",PropPayloadFormatIndicator
// 27,PropPayloadFormatIndicator 128,PropServerReference
// "\219\190\207\b\STXH\225}n\226\194`\172\&9\226\231Z\146\208\241!\DC2\240\164\ETBM \216",PropMaximumQoS
// 250,PropServerKeepAlive 27834,PropSessionExpiryInterval 18960,PropRetainAvailable 149,PropTopicAliasMaximum
// 25123,PropAuthenticationMethod
// "B\DC4\195\134\160\NAK\197\ETX\n\205\203\&8so\199\130\223=^h\234\139p4N",PropTopicAlias
// 24560,PropSubscriptionIdentifierAvailable 73,PropSharedSubscriptionAvailable 225]
// [UnsubSuccess,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode4) {
  uint8_t pkt[] = {
      0xb0, 0xfd, 0x1,  0x29, 0x22, 0xeb, 0x1,  0x16, 0x0,  0x17, 0xd1, 0xd2, 0xf,  0xc6, 0x0,  0x5d, 0x78, 0x7e, 0x4a,
      0x64, 0xd8, 0x6c, 0xae, 0x12, 0xa0, 0xa8, 0xc7, 0x91, 0xa,  0x1,  0x6e, 0xce, 0xb,  0xb,  0x20, 0x2,  0x0,  0x0,
      0x42, 0xb8, 0x16, 0x0,  0x2,  0x63, 0xc8, 0x22, 0x38, 0xf4, 0x9,  0x0,  0x1a, 0x16, 0xbc, 0xf0, 0xce, 0xb2, 0x3e,
      0xf1, 0x22, 0x18, 0x4,  0xe6, 0xb9, 0xee, 0xc7, 0xbf, 0x33, 0x87, 0x81, 0xa6, 0x11, 0xfa, 0x36, 0xf6, 0x3d, 0x8c,
      0x3a, 0x1c, 0x0,  0xe,  0x95, 0xb3, 0x67, 0xa6, 0xfd, 0x58, 0x19, 0xa7, 0x93, 0xc8, 0x11, 0xc7, 0x1a, 0x7d, 0x1f,
      0x0,  0x1d, 0x25, 0xa1, 0x28, 0x52, 0xb7, 0x26, 0x1,  0xdc, 0x87, 0x36, 0x4e, 0x16, 0x3c, 0x72, 0x3f, 0x1e, 0xdb,
      0x1,  0xfd, 0x2a, 0x21, 0xd1, 0xe7, 0xe,  0x97, 0xd2, 0x9,  0xb8, 0xe9, 0x23, 0x1b, 0x33, 0x1c, 0x0,  0x19, 0x7b,
      0x72, 0x59, 0xcd, 0x35, 0x68, 0xc3, 0x9e, 0xbf, 0xbf, 0x4a, 0xa8, 0xca, 0x3,  0x3e, 0x14, 0x95, 0x84, 0xf7, 0x3a,
      0x42, 0x16, 0x3b, 0xbc, 0x7,  0x1,  0x1b, 0x1,  0x80, 0x1c, 0x0,  0x1c, 0xdb, 0xbe, 0xcf, 0x8,  0x2,  0x48, 0xe1,
      0x7d, 0x6e, 0xe2, 0xc2, 0x60, 0xac, 0x39, 0xe2, 0xe7, 0x5a, 0x92, 0xd0, 0xf1, 0x21, 0x12, 0xf0, 0xa4, 0x17, 0x4d,
      0x20, 0xd8, 0x24, 0xfa, 0x13, 0x6c, 0xba, 0x11, 0x0,  0x0,  0x4a, 0x10, 0x25, 0x95, 0x22, 0x62, 0x23, 0x15, 0x0,
      0x19, 0x42, 0x14, 0xc3, 0x86, 0xa0, 0x15, 0xc5, 0x3,  0xa,  0xcd, 0xcb, 0x38, 0x73, 0x6f, 0xc7, 0x82, 0xdf, 0x3d,
      0x5e, 0x68, 0xea, 0x8b, 0x70, 0x34, 0x4e, 0x23, 0x5f, 0xf0, 0x29, 0x49, 0x2a, 0xe1, 0x0,  0x8f, 0x8f, 0x83, 0x11,
      0x80, 0x87, 0x83, 0x11, 0x8f, 0x0,  0x91, 0x83, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[14];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 14, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10530);
  EXPECT_EQ(count, 14);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 29099 [PropUserProperty
// "5\209\150\165M\250\224\199\213Ze\168\DC4\r\205\193P#\GS\232\179dd\228\187=!\245"
// "\192\240\203\188%\240\133\a\130=\FS2\SOH\248\ACK\152",PropServerReference
// "\177\NAK\163\EOT\134d7\204\192=\237A\232p\214\153\227g\211\176x%'",PropMaximumPacketSize
// 25124,PropAssignedClientIdentifier
// "\246\150\248\ETX\SUB\139\220\151\235\217\246\US\205\&3\219\241\238\DLE\151\EM\ETX\158D\197P\186\244",PropMessageExpiryInterval
// 6475,PropServerKeepAlive 7420,PropCorrelationData "+\255\134G\153{\217Sx\145\241\CAN&%",PropMessageExpiryInterval
// 10192,PropCorrelationData
// "\155\219\130gz\157\&1\181`[\138\156\191\220}\SO;i\139\150\157\153\&0D\SOH\ESC<\166",PropCorrelationData
// "\131\172\171\&7h\135\222\137\DC1IW",PropRequestProblemInformation 5,PropMessageExpiryInterval
// 14885,PropSharedSubscriptionAvailable 70,PropReasonString "\SI\136gr\141\GS\142",PropTopicAliasMaximum 2086]
// [UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode5) {
  uint8_t pkt[] = {
      0xb0, 0xde, 0x1,  0x71, 0xab, 0xcf, 0x1,  0x26, 0x0,  0x1c, 0x35, 0xd1, 0x96, 0xa5, 0x4d, 0xfa, 0xe0, 0xc7, 0xd5,
      0x5a, 0x65, 0xa8, 0x14, 0xd,  0xcd, 0xc1, 0x50, 0x23, 0x1d, 0xe8, 0xb3, 0x64, 0x64, 0xe4, 0xbb, 0x3d, 0x21, 0xf5,
      0x0,  0x10, 0xc0, 0xf0, 0xcb, 0xbc, 0x25, 0xf0, 0x85, 0x7,  0x82, 0x3d, 0x1c, 0x32, 0x1,  0xf8, 0x6,  0x98, 0x1c,
      0x0,  0x17, 0xb1, 0x15, 0xa3, 0x4,  0x86, 0x64, 0x37, 0xcc, 0xc0, 0x3d, 0xed, 0x41, 0xe8, 0x70, 0xd6, 0x99, 0xe3,
      0x67, 0xd3, 0xb0, 0x78, 0x25, 0x27, 0x27, 0x0,  0x0,  0x62, 0x24, 0x12, 0x0,  0x1b, 0xf6, 0x96, 0xf8, 0x3,  0x1a,
      0x8b, 0xdc, 0x97, 0xeb, 0xd9, 0xf6, 0x1f, 0xcd, 0x33, 0xdb, 0xf1, 0xee, 0x10, 0x97, 0x19, 0x3,  0x9e, 0x44, 0xc5,
      0x50, 0xba, 0xf4, 0x2,  0x0,  0x0,  0x19, 0x4b, 0x13, 0x1c, 0xfc, 0x9,  0x0,  0xe,  0x2b, 0xff, 0x86, 0x47, 0x99,
      0x7b, 0xd9, 0x53, 0x78, 0x91, 0xf1, 0x18, 0x26, 0x25, 0x2,  0x0,  0x0,  0x27, 0xd0, 0x9,  0x0,  0x1c, 0x9b, 0xdb,
      0x82, 0x67, 0x7a, 0x9d, 0x31, 0xb5, 0x60, 0x5b, 0x8a, 0x9c, 0xbf, 0xdc, 0x7d, 0xe,  0x3b, 0x69, 0x8b, 0x96, 0x9d,
      0x99, 0x30, 0x44, 0x1,  0x1b, 0x3c, 0xa6, 0x9,  0x0,  0xb,  0x83, 0xac, 0xab, 0x37, 0x68, 0x87, 0xde, 0x89, 0x11,
      0x49, 0x57, 0x17, 0x5,  0x2,  0x0,  0x0,  0x3a, 0x25, 0x2a, 0x46, 0x1f, 0x0,  0x7,  0xf,  0x88, 0x67, 0x72, 0x8d,
      0x1d, 0x8e, 0x22, 0x8,  0x26, 0x8f, 0x91, 0x8f, 0x0,  0x11, 0x80, 0x91, 0x80, 0x11, 0x83, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[11];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29099);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 3499 [PropMaximumQoS 97,PropSubscriptionIdentifier 14,PropSubscriptionIdentifier
// 13,PropSharedSubscriptionAvailable 56,PropSubscriptionIdentifier 27,PropRequestProblemInformation
// 242,PropMessageExpiryInterval 26017,PropSessionExpiryInterval 17048,PropRetainAvailable
// 187,PropAssignedClientIdentifier "85\244\182\246)W\189:\215\211\197\139:\141d<\233",PropSubscriptionIdentifier
// 11,PropResponseInformation ">'\175\SYNZ\151\&6\180\217\&3\162\227\191\245\&0",PropMessageExpiryInterval
// 6524,PropTopicAlias 20579,PropMessageExpiryInterval 2741,PropMaximumQoS 195,PropUserProperty
// "\ETXIeK\163\ESC\164\STX\DC1n14\224\201\139\224\&6H\172\165\241m\210}3H3\EM" "\212",PropUserProperty
// "\136\206\175\143K\DC4\ENQ\168" "\132\196|\230H=l\149\v\223.\a_u\136",PropAuthenticationMethod
// "\FS",PropServerKeepAlive 12431,PropMessageExpiryInterval 22466,PropSharedSubscriptionAvailable
// 133,PropMaximumPacketSize 31328,PropAuthenticationMethod
// "\201SD\203y\v4P\184\198\181\GSc>\129B",PropPayloadFormatIndicator 18,PropSharedSubscriptionAvailable
// 186,PropSessionExpiryInterval 1470,PropRequestResponseInformation 50,PropMaximumQoS 19,PropSubscriptionIdentifier 12]
// [UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode6) {
  uint8_t pkt[] = {0xb0, 0xd6, 0x1,  0xd,  0xab, 0xc3, 0x1,  0x24, 0x61, 0xb,  0xe,  0xb,  0xd,  0x2a, 0x38, 0xb,  0x1b,
                   0x17, 0xf2, 0x2,  0x0,  0x0,  0x65, 0xa1, 0x11, 0x0,  0x0,  0x42, 0x98, 0x25, 0xbb, 0x12, 0x0,  0x12,
                   0x38, 0x35, 0xf4, 0xb6, 0xf6, 0x29, 0x57, 0xbd, 0x3a, 0xd7, 0xd3, 0xc5, 0x8b, 0x3a, 0x8d, 0x64, 0x3c,
                   0xe9, 0xb,  0xb,  0x1a, 0x0,  0xf,  0x3e, 0x27, 0xaf, 0x16, 0x5a, 0x97, 0x36, 0xb4, 0xd9, 0x33, 0xa2,
                   0xe3, 0xbf, 0xf5, 0x30, 0x2,  0x0,  0x0,  0x19, 0x7c, 0x23, 0x50, 0x63, 0x2,  0x0,  0x0,  0xa,  0xb5,
                   0x24, 0xc3, 0x26, 0x0,  0x1c, 0x3,  0x49, 0x65, 0x4b, 0xa3, 0x1b, 0xa4, 0x2,  0x11, 0x6e, 0x31, 0x34,
                   0xe0, 0xc9, 0x8b, 0xe0, 0x36, 0x48, 0xac, 0xa5, 0xf1, 0x6d, 0xd2, 0x7d, 0x33, 0x48, 0x33, 0x19, 0x0,
                   0x1,  0xd4, 0x26, 0x0,  0x8,  0x88, 0xce, 0xaf, 0x8f, 0x4b, 0x14, 0x5,  0xa8, 0x0,  0xf,  0x84, 0xc4,
                   0x7c, 0xe6, 0x48, 0x3d, 0x6c, 0x95, 0xb,  0xdf, 0x2e, 0x7,  0x5f, 0x75, 0x88, 0x15, 0x0,  0x1,  0x1c,
                   0x13, 0x30, 0x8f, 0x2,  0x0,  0x0,  0x57, 0xc2, 0x2a, 0x85, 0x27, 0x0,  0x0,  0x7a, 0x60, 0x15, 0x0,
                   0x10, 0xc9, 0x53, 0x44, 0xcb, 0x79, 0xb,  0x34, 0x50, 0xb8, 0xc6, 0xb5, 0x1d, 0x63, 0x3e, 0x81, 0x42,
                   0x1,  0x12, 0x2a, 0xba, 0x11, 0x0,  0x0,  0x5,  0xbe, 0x19, 0x32, 0x24, 0x13, 0xb,  0xc,  0x91, 0x91,
                   0x83, 0x80, 0x91, 0x91, 0x91, 0x80, 0x91, 0x80, 0x87, 0x80, 0x87, 0x83, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[15];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 15, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3499);
  EXPECT_EQ(count, 15);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 25674 [PropResponseTopic "\251\172\163@\137*\EOT\243wZ\153\210\140\220\ETB\v5
// \174}\179L\STXx",PropCorrelationData
// "\170Gh3!.\146\EMfLE\190\ETX\250s\220\144\&1t\184{[t%Rg\DEL\231\132",PropMaximumPacketSize
// 1709,PropPayloadFormatIndicator 243,PropWildcardSubscriptionAvailable 187,PropRequestProblemInformation
// 182,PropTopicAliasMaximum 30360,PropMessageExpiryInterval 6490,PropAssignedClientIdentifier
// "T\175\b\244\228G\235\DC3@\EM\139\174\148\170\241\255\139",PropAssignedClientIdentifier
// "\144\177\176\&9\SYN\128\181%\155\171",PropMessageExpiryInterval 538,PropTopicAliasMaximum 10132]
// [UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubSuccess,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode7) {
  uint8_t pkt[] = {0xb0, 0x90, 0x1,  0x64, 0x4a, 0x77, 0x8,  0x0,  0x18, 0xfb, 0xac, 0xa3, 0x40, 0x89, 0x2a, 0x4,  0xf3,
                   0x77, 0x5a, 0x99, 0xd2, 0x8c, 0xdc, 0x17, 0xb,  0x35, 0x20, 0xae, 0x7d, 0xb3, 0x4c, 0x2,  0x78, 0x9,
                   0x0,  0x1d, 0xaa, 0x47, 0x68, 0x33, 0x21, 0x2e, 0x92, 0x19, 0x66, 0x4c, 0x45, 0xbe, 0x3,  0xfa, 0x73,
                   0xdc, 0x90, 0x31, 0x74, 0xb8, 0x7b, 0x5b, 0x74, 0x25, 0x52, 0x67, 0x7f, 0xe7, 0x84, 0x27, 0x0,  0x0,
                   0x6,  0xad, 0x1,  0xf3, 0x28, 0xbb, 0x17, 0xb6, 0x22, 0x76, 0x98, 0x2,  0x0,  0x0,  0x19, 0x5a, 0x12,
                   0x0,  0x11, 0x54, 0xaf, 0x8,  0xf4, 0xe4, 0x47, 0xeb, 0x13, 0x40, 0x19, 0x8b, 0xae, 0x94, 0xaa, 0xf1,
                   0xff, 0x8b, 0x12, 0x0,  0xa,  0x90, 0xb1, 0xb0, 0x39, 0x16, 0x80, 0xb5, 0x25, 0x9b, 0xab, 0x2,  0x0,
                   0x0,  0x2,  0x1a, 0x22, 0x27, 0x94, 0x83, 0x8f, 0x0,  0x11, 0x80, 0x80, 0x87, 0x83, 0x87, 0x11, 0x11,
                   0x87, 0x8f, 0x0,  0x83, 0x80, 0x8f, 0x0,  0x83, 0x83, 0x87, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[22];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 22, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25674);
  EXPECT_EQ(count, 22);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 11351 [PropSharedSubscriptionAvailable 5,PropAuthenticationMethod
// "\147L\NUL|8\218\130\203\a]M\252\142\DC1\130_#)\153F",PropMaximumPacketSize 19701,PropMaximumPacketSize
// 4611,PropAuthenticationMethod
// ">\200t{\194Y\163\&1wW\157\168\SI\ETX\141A\242t)\204O\195`!",PropAssignedClientIdentifier
// "\DLE\132i\162\130",PropServerReference
// "_\171\144\140\131\ESC\130\146\SI*\170\193U8\164A)\ENQ\238S9\DELuG",PropSharedSubscriptionAvailable 18,PropMaximumQoS
// 242,PropTopicAliasMaximum 11494,PropMaximumPacketSize 16918,PropTopicAlias 17194,PropRetainAvailable
// 72,PropContentType "0%\131\137\229\191\f\216ab",PropPayloadFormatIndicator 183,PropPayloadFormatIndicator
// 219,PropSubscriptionIdentifier 23,PropMessageExpiryInterval 5099,PropRetainAvailable 7,PropMaximumPacketSize
// 32687,PropReceiveMaximum 31244]
// [UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubImplementationSpecificError]
TEST(UnsubACK5QCTest, Decode8) {
  uint8_t pkt[] = {0xb0, 0xb5, 0x1,  0x2c, 0x57, 0x94, 0x1,  0x2a, 0x5,  0x15, 0x0,  0x14, 0x93, 0x4c, 0x0,  0x7c, 0x38,
                   0xda, 0x82, 0xcb, 0x7,  0x5d, 0x4d, 0xfc, 0x8e, 0x11, 0x82, 0x5f, 0x23, 0x29, 0x99, 0x46, 0x27, 0x0,
                   0x0,  0x4c, 0xf5, 0x27, 0x0,  0x0,  0x12, 0x3,  0x15, 0x0,  0x18, 0x3e, 0xc8, 0x74, 0x7b, 0xc2, 0x59,
                   0xa3, 0x31, 0x77, 0x57, 0x9d, 0xa8, 0xf,  0x3,  0x8d, 0x41, 0xf2, 0x74, 0x29, 0xcc, 0x4f, 0xc3, 0x60,
                   0x21, 0x12, 0x0,  0x5,  0x10, 0x84, 0x69, 0xa2, 0x82, 0x1c, 0x0,  0x18, 0x5f, 0xab, 0x90, 0x8c, 0x83,
                   0x1b, 0x82, 0x92, 0xf,  0x2a, 0xaa, 0xc1, 0x55, 0x38, 0xa4, 0x41, 0x29, 0x5,  0xee, 0x53, 0x39, 0x7f,
                   0x75, 0x47, 0x2a, 0x12, 0x24, 0xf2, 0x22, 0x2c, 0xe6, 0x27, 0x0,  0x0,  0x42, 0x16, 0x23, 0x43, 0x2a,
                   0x25, 0x48, 0x3,  0x0,  0xa,  0x30, 0x25, 0x83, 0x89, 0xe5, 0xbf, 0xc,  0xd8, 0x61, 0x62, 0x1,  0xb7,
                   0x1,  0xdb, 0xb,  0x17, 0x2,  0x0,  0x0,  0x13, 0xeb, 0x25, 0x7,  0x27, 0x0,  0x0,  0x7f, 0xaf, 0x21,
                   0x7a, 0xc,  0x11, 0x87, 0x8f, 0x8f, 0x8f, 0x87, 0x83, 0x83, 0x83, 0x11, 0x11, 0x87, 0x11, 0x80, 0x0,
                   0x11, 0x11, 0x8f, 0x87, 0x83, 0x11, 0x91, 0x83, 0x80, 0x8f, 0x11, 0x91, 0x83, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[29];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 29, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11351);
  EXPECT_EQ(count, 29);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[27], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[28], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
}

// UnsubscribeResponse 11966 [PropResponseInformation
// "\145\227\228&\228\DELM\RSc\140Vq\207\188\GS\229\174",PropAssignedClientIdentifier
// ",^\169\191\RSt\198\251\229iB\DC4\195\132G\202yI\223\171\SO\214\223u\143\150X",PropReasonString "-\203\&3\175
// @\212\223\133\n\155J\141u\253\188d\177\f",PropSessionExpiryInterval 29407,PropTopicAlias 32744,PropResponseTopic
// "\188",PropReceiveMaximum 14635,PropWildcardSubscriptionAvailable 47]
// [UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubSuccess,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubUnspecifiedError]
TEST(UnsubACK5QCTest, Decode9) {
  uint8_t pkt[] = {0xb0, 0x63, 0x2e, 0xbe, 0x59, 0x1a, 0x0,  0x11, 0x91, 0xe3, 0xe4, 0x26, 0xe4, 0x7f, 0x4d, 0x1e, 0x63,
                   0x8c, 0x56, 0x71, 0xcf, 0xbc, 0x1d, 0xe5, 0xae, 0x12, 0x0,  0x1b, 0x2c, 0x5e, 0xa9, 0xbf, 0x1e, 0x74,
                   0xc6, 0xfb, 0xe5, 0x69, 0x42, 0x14, 0xc3, 0x84, 0x47, 0xca, 0x79, 0x49, 0xdf, 0xab, 0xe,  0xd6, 0xdf,
                   0x75, 0x8f, 0x96, 0x58, 0x1f, 0x0,  0x13, 0x2d, 0xcb, 0x33, 0xaf, 0x20, 0x40, 0xd4, 0xdf, 0x85, 0xa,
                   0x9b, 0x4a, 0x8d, 0x75, 0xfd, 0xbc, 0x64, 0xb1, 0xc,  0x11, 0x0,  0x0,  0x72, 0xdf, 0x23, 0x7f, 0xe8,
                   0x8,  0x0,  0x1,  0xbc, 0x21, 0x39, 0x2b, 0x28, 0x2f, 0x87, 0x91, 0x80, 0x0,  0x87, 0x8f, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[7];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11966);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
}

// UnsubscribeResponse 28946 [PropAuthenticationMethod
// "7\240\150\195\&38\131m\233\159C\214\147>R\128\253|m\GS-\193\129",PropTopicAlias 5564,PropRequestProblemInformation
// 75,PropRequestProblemInformation 190,PropMessageExpiryInterval 834,PropRetainAvailable 33,PropResponseInformation
// "I\198",PropCorrelationData
// "\193\rCf+\STX\155\193\169\167\SOH)\137\145b\156h\ESC\219\154\225PE\DC2\239\ACK\244",PropResponseInformation
// "\133|o\247!\161\195m\165e1mJ\157e",PropReceiveMaximum 27827,PropServerKeepAlive 13713,PropReasonString
// ")\228I\174\175\245\179\225",PropRetainAvailable 106,PropSessionExpiryInterval 19620]
// [UnsubSuccess,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubSuccess,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode10) {
  uint8_t pkt[] = {0xb0, 0x93, 0x1,  0x71, 0x12, 0x75, 0x15, 0x0,  0x17, 0x37, 0xf0, 0x96, 0xc3, 0x33, 0x38, 0x83, 0x6d,
                   0xe9, 0x9f, 0x43, 0xd6, 0x93, 0x3e, 0x52, 0x80, 0xfd, 0x7c, 0x6d, 0x1d, 0x2d, 0xc1, 0x81, 0x23, 0x15,
                   0xbc, 0x17, 0x4b, 0x17, 0xbe, 0x2,  0x0,  0x0,  0x3,  0x42, 0x25, 0x21, 0x1a, 0x0,  0x2,  0x49, 0xc6,
                   0x9,  0x0,  0x1b, 0xc1, 0xd,  0x43, 0x66, 0x2b, 0x2,  0x9b, 0xc1, 0xa9, 0xa7, 0x1,  0x29, 0x89, 0x91,
                   0x62, 0x9c, 0x68, 0x1b, 0xdb, 0x9a, 0xe1, 0x50, 0x45, 0x12, 0xef, 0x6,  0xf4, 0x1a, 0x0,  0xf,  0x85,
                   0x7c, 0x6f, 0xf7, 0x21, 0xa1, 0xc3, 0x6d, 0xa5, 0x65, 0x31, 0x6d, 0x4a, 0x9d, 0x65, 0x21, 0x6c, 0xb3,
                   0x13, 0x35, 0x91, 0x1f, 0x0,  0x8,  0x29, 0xe4, 0x49, 0xae, 0xaf, 0xf5, 0xb3, 0xe1, 0x25, 0x6a, 0x11,
                   0x0,  0x0,  0x4c, 0xa4, 0x0,  0x0,  0x11, 0x8f, 0x80, 0x8f, 0x83, 0x11, 0x83, 0x80, 0x8f, 0x83, 0x80,
                   0x0,  0x83, 0x91, 0x87, 0x83, 0x87, 0x8f, 0x80, 0x0,  0x11, 0x87, 0x0,  0x11, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[27];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 27, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28946);
  EXPECT_EQ(count, 27);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 29805 [PropSharedSubscriptionAvailable 167,PropWildcardSubscriptionAvailable
// 36,PropRetainAvailable 125,PropReceiveMaximum 20880,PropServerKeepAlive 6088,PropTopicAliasMaximum
// 18031,PropTopicAliasMaximum 15408,PropSubscriptionIdentifierAvailable 7,PropRequestProblemInformation
// 160,PropSharedSubscriptionAvailable 138,PropWildcardSubscriptionAvailable 221,PropAuthenticationMethod
// "\150\233T\188",PropSharedSubscriptionAvailable 218,PropTopicAlias 11586]
// [UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0xb0, 0x2e, 0x74, 0x6d, 0x26, 0x2a, 0xa7, 0x28, 0x24, 0x25, 0x7d, 0x21, 0x51, 0x90, 0x13, 0x17,
                   0xc8, 0x22, 0x46, 0x6f, 0x22, 0x3c, 0x30, 0x29, 0x7,  0x17, 0xa0, 0x2a, 0x8a, 0x28, 0xdd, 0x15,
                   0x0,  0x4,  0x96, 0xe9, 0x54, 0xbc, 0x2a, 0xda, 0x23, 0x2d, 0x42, 0x83, 0x80, 0x83, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[5];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29805);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 19841 [PropRequestResponseInformation 195,PropSessionExpiryInterval 7099,PropCorrelationData
// "\253Q\149=\DC2\ESC \244\255\163G\186go\221\227M\SUB\224c\250\197a\SYN\167\151",PropServerReference
// "\160f\192\196\162",PropRequestProblemInformation 69,PropResponseInformation
// "\143\148\214\220\&6\248\182\150\135/\227\183\208#\244\&5\226\147\239\162+",PropSharedSubscriptionAvailable
// 5,PropTopicAlias 25859,PropAuthenticationMethod "\219*\147/^\ETB\RS-\219\ACK$6\\\185P%(",PropResponseInformation
// "\235g\205<\169\&98\245v\187\214\183\222\160\167\CAN\ETXkE\176 \137",PropSharedSubscriptionAvailable
// 1,PropMessageExpiryInterval 8462,PropAuthenticationMethod "\171",PropReceiveMaximum 23714,PropMessageExpiryInterval
// 31618,PropServerKeepAlive 15174,PropWillDelayInterval 30554,PropServerKeepAlive 28321,PropMaximumQoS
// 208,PropAuthenticationMethod "\251\188MB\GS\ESCW\186R\142A\tj\235@\166\"",PropMaximumPacketSize 26290,PropMaximumQoS
// 50,PropUserProperty "b\DC3\146\176(lv\171\154\&1\191\141\225\&5\145_O\245Y\192\EM\ESC"
// "\167\CAN|\150\ACK\214\214Q\ETX\152I\181I\a\164\155~\184\218\180Jq",PropSessionExpiryInterval 2734,PropContentType
// "m\176\&7\170\\"]
// [UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubSuccess,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubTopicFilterInvalid]
TEST(UnsubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0xb0, 0x88, 0x2,  0x4d, 0x81, 0xf1, 0x1,  0x19, 0xc3, 0x11, 0x0,  0x0,  0x1b, 0xbb, 0x9,  0x0,  0x1a,
                   0xfd, 0x51, 0x95, 0x3d, 0x12, 0x1b, 0x20, 0xf4, 0xff, 0xa3, 0x47, 0xba, 0x67, 0x6f, 0xdd, 0xe3, 0x4d,
                   0x1a, 0xe0, 0x63, 0xfa, 0xc5, 0x61, 0x16, 0xa7, 0x97, 0x1c, 0x0,  0x5,  0xa0, 0x66, 0xc0, 0xc4, 0xa2,
                   0x17, 0x45, 0x1a, 0x0,  0x15, 0x8f, 0x94, 0xd6, 0xdc, 0x36, 0xf8, 0xb6, 0x96, 0x87, 0x2f, 0xe3, 0xb7,
                   0xd0, 0x23, 0xf4, 0x35, 0xe2, 0x93, 0xef, 0xa2, 0x2b, 0x2a, 0x5,  0x23, 0x65, 0x3,  0x15, 0x0,  0x11,
                   0xdb, 0x2a, 0x93, 0x2f, 0x5e, 0x17, 0x1e, 0x2d, 0xdb, 0x6,  0x24, 0x36, 0x5c, 0xb9, 0x50, 0x25, 0x28,
                   0x1a, 0x0,  0x16, 0xeb, 0x67, 0xcd, 0x3c, 0xa9, 0x39, 0x38, 0xf5, 0x76, 0xbb, 0xd6, 0xb7, 0xde, 0xa0,
                   0xa7, 0x18, 0x3,  0x6b, 0x45, 0xb0, 0x20, 0x89, 0x2a, 0x1,  0x2,  0x0,  0x0,  0x21, 0xe,  0x15, 0x0,
                   0x1,  0xab, 0x21, 0x5c, 0xa2, 0x2,  0x0,  0x0,  0x7b, 0x82, 0x13, 0x3b, 0x46, 0x18, 0x0,  0x0,  0x77,
                   0x5a, 0x13, 0x6e, 0xa1, 0x24, 0xd0, 0x15, 0x0,  0x11, 0xfb, 0xbc, 0x4d, 0x42, 0x1d, 0x1b, 0x57, 0xba,
                   0x52, 0x8e, 0x41, 0x9,  0x6a, 0xeb, 0x40, 0xa6, 0x22, 0x27, 0x0,  0x0,  0x66, 0xb2, 0x24, 0x32, 0x26,
                   0x0,  0x16, 0x62, 0x13, 0x92, 0xb0, 0x28, 0x6c, 0x76, 0xab, 0x9a, 0x31, 0xbf, 0x8d, 0xe1, 0x35, 0x91,
                   0x5f, 0x4f, 0xf5, 0x59, 0xc0, 0x19, 0x1b, 0x0,  0x16, 0xa7, 0x18, 0x7c, 0x96, 0x6,  0xd6, 0xd6, 0x51,
                   0x3,  0x98, 0x49, 0xb5, 0x49, 0x7,  0xa4, 0x9b, 0x7e, 0xb8, 0xda, 0xb4, 0x4a, 0x71, 0x11, 0x0,  0x0,
                   0xa,  0xae, 0x3,  0x0,  0x5,  0x6d, 0xb0, 0x37, 0xaa, 0x5c, 0x11, 0x11, 0x91, 0x8f, 0x0,  0x83, 0x11,
                   0x80, 0x11, 0x8f, 0x80, 0x83, 0x11, 0x0,  0x8f, 0x0,  0x11, 0x80, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[19];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 19, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19841);
  EXPECT_EQ(count, 19);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
}

// UnsubscribeResponse 20127 [PropResponseInformation "\141",PropAuthenticationData
// "\SUB\224",PropAssignedClientIdentifier "\243",PropAuthenticationMethod "\145\DC2\201\DC4\250\153\"Xo0i\134D\215\223
// w5\214\138\213\164f~\\\150\175\171;",PropReasonString
// "$\223\232\147\131e\183\175U\200Dv\234S\129X\202",PropAuthenticationMethod
// "\US\162w\181I\">p$\n",PropSharedSubscriptionAvailable 226,PropReceiveMaximum
// 3366,PropSubscriptionIdentifierAvailable 14,PropWillDelayInterval 9401,PropReceiveMaximum 23667,PropUserProperty
// "\tu\153\250\252\DC1S" "\238\169\232\b\146\135",PropSharedSubscriptionAvailable 108]
// [UnsubPacketIdentifierInUse,UnsubSuccess,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubSuccess,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubSuccess,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubImplementationSpecificError,UnsubSuccess,UnsubImplementationSpecificError,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode13) {
  uint8_t pkt[] = {0xb0, 0x90, 0x1,  0x4e, 0x9f, 0x71, 0x1a, 0x0,  0x1,  0x8d, 0x16, 0x0,  0x2,  0x1a, 0xe0, 0x12, 0x0,
                   0x1,  0xf3, 0x15, 0x0,  0x1d, 0x91, 0x12, 0xc9, 0x14, 0xfa, 0x99, 0x22, 0x58, 0x6f, 0x30, 0x69, 0x86,
                   0x44, 0xd7, 0xdf, 0x20, 0x77, 0x35, 0xd6, 0x8a, 0xd5, 0xa4, 0x66, 0x7e, 0x5c, 0x96, 0xaf, 0xab, 0x3b,
                   0x1f, 0x0,  0x11, 0x24, 0xdf, 0xe8, 0x93, 0x83, 0x65, 0xb7, 0xaf, 0x55, 0xc8, 0x44, 0x76, 0xea, 0x53,
                   0x81, 0x58, 0xca, 0x15, 0x0,  0xa,  0x1f, 0xa2, 0x77, 0xb5, 0x49, 0x22, 0x3e, 0x70, 0x24, 0xa,  0x2a,
                   0xe2, 0x21, 0xd,  0x26, 0x29, 0xe,  0x18, 0x0,  0x0,  0x24, 0xb9, 0x21, 0x5c, 0x73, 0x26, 0x0,  0x7,
                   0x9,  0x75, 0x99, 0xfa, 0xfc, 0x11, 0x53, 0x0,  0x6,  0xee, 0xa9, 0xe8, 0x8,  0x92, 0x87, 0x2a, 0x6c,
                   0x91, 0x0,  0x83, 0x83, 0x0,  0x80, 0x11, 0x83, 0x91, 0x91, 0x0,  0x8f, 0x8f, 0x87, 0x11, 0x87, 0x80,
                   0x0,  0x80, 0x8f, 0x80, 0x0,  0x11, 0x0,  0x83, 0x0,  0x83, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[28];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 28, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20127);
  EXPECT_EQ(count, 28);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[27], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 6820 [PropAssignedClientIdentifier "&l\161Q\197\198\157\":\212o
// \179w\US~\197\144\244.\ETB\233\171",PropTopicAliasMaximum 7609,PropRequestProblemInformation 190,PropReasonString
// "[\209mi\197\160\NAK==\141\139\200 c\244",PropSubscriptionIdentifierAvailable 164]
// [UnsubNotAuthorized,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubSuccess,UnsubSuccess,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubSuccess,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubTopicFilterInvalid]
TEST(UnsubACK5QCTest, Decode14) {
  uint8_t pkt[] = {0xb0, 0x52, 0x1a, 0xa4, 0x33, 0x12, 0x0,  0x17, 0x26, 0x6c, 0xa1, 0x51, 0xc5, 0xc6, 0x9d, 0x22, 0x3a,
                   0xd4, 0x6f, 0x20, 0xb3, 0x77, 0x1f, 0x7e, 0xc5, 0x90, 0xf4, 0x2e, 0x17, 0xe9, 0xab, 0x22, 0x1d, 0xb9,
                   0x17, 0xbe, 0x1f, 0x0,  0xf,  0x5b, 0xd1, 0x6d, 0x69, 0xc5, 0xa0, 0x15, 0x3d, 0x3d, 0x8d, 0x8b, 0xc8,
                   0x20, 0x63, 0xf4, 0x29, 0xa4, 0x87, 0x80, 0x83, 0x91, 0x91, 0x83, 0x83, 0x87, 0x91, 0x91, 0x91, 0x8f,
                   0x0,  0x0,  0x87, 0x83, 0x87, 0x0,  0x87, 0x83, 0x80, 0x80, 0x8f, 0x83, 0x80, 0x83, 0x80, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[28];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 28, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6820);
  EXPECT_EQ(count, 28);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[27], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
}

// UnsubscribeResponse 20949 [PropCorrelationData
// "\222\218_AT\185\SI\247\STX\156\252\152\SOE\186",PropSessionExpiryInterval 10976,PropAuthenticationData
// "\131I\RS\EOT\213n\135\197\206\129&\209\&4\191)\f\221U\159gR^]\184\173\131\152*\235",PropRequestProblemInformation
// 254,PropTopicAliasMaximum 23485,PropResponseInformation "2Y\223\239\209L\140)\153\144)& \156\164p",PropReceiveMaximum
// 636,PropPayloadFormatIndicator 97,PropMaximumPacketSize 26198,PropContentType "0\220\&5",PropWillDelayInterval
// 14882,PropTopicAlias 20936,PropRequestProblemInformation 127,PropResponseTopic
// "C\214\182\176\151\189\234\237'%g6\235\214\239\&3\246#\155\213\142",PropResponseInformation
// "\224zEl-\188RO\219\140?s\231\GSR\234)\200\197\238",PropContentType "\244\bC\217\SYN\152\&9\SI#\241~\186\214}\198"]
// [UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubSuccess,UnsubUnspecifiedError,UnsubImplementationSpecificError]
TEST(UnsubACK5QCTest, Decode15) {
  uint8_t pkt[] = {0xb0, 0xb6, 0x1,  0x51, 0xd5, 0xaa, 0x1,  0x9,  0x0,  0xf,  0xde, 0xda, 0x5f, 0x41, 0x54, 0xb9, 0xf,
                   0xf7, 0x2,  0x9c, 0xfc, 0x98, 0xe,  0x45, 0xba, 0x11, 0x0,  0x0,  0x2a, 0xe0, 0x16, 0x0,  0x1d, 0x83,
                   0x49, 0x1e, 0x4,  0xd5, 0x6e, 0x87, 0xc5, 0xce, 0x81, 0x26, 0xd1, 0x34, 0xbf, 0x29, 0xc,  0xdd, 0x55,
                   0x9f, 0x67, 0x52, 0x5e, 0x5d, 0xb8, 0xad, 0x83, 0x98, 0x2a, 0xeb, 0x17, 0xfe, 0x22, 0x5b, 0xbd, 0x1a,
                   0x0,  0x10, 0x32, 0x59, 0xdf, 0xef, 0xd1, 0x4c, 0x8c, 0x29, 0x99, 0x90, 0x29, 0x26, 0x20, 0x9c, 0xa4,
                   0x70, 0x21, 0x2,  0x7c, 0x1,  0x61, 0x27, 0x0,  0x0,  0x66, 0x56, 0x3,  0x0,  0x3,  0x30, 0xdc, 0x35,
                   0x18, 0x0,  0x0,  0x3a, 0x22, 0x23, 0x51, 0xc8, 0x17, 0x7f, 0x8,  0x0,  0x15, 0x43, 0xd6, 0xb6, 0xb0,
                   0x97, 0xbd, 0xea, 0xed, 0x27, 0x25, 0x67, 0x36, 0xeb, 0xd6, 0xef, 0x33, 0xf6, 0x23, 0x9b, 0xd5, 0x8e,
                   0x1a, 0x0,  0x14, 0xe0, 0x7a, 0x45, 0x6c, 0x2d, 0xbc, 0x52, 0x4f, 0xdb, 0x8c, 0x3f, 0x73, 0xe7, 0x1d,
                   0x52, 0xea, 0x29, 0xc8, 0xc5, 0xee, 0x3,  0x0,  0xf,  0xf4, 0x8,  0x43, 0xd9, 0x16, 0x98, 0x39, 0xf,
                   0x23, 0xf1, 0x7e, 0xba, 0xd6, 0x7d, 0xc6, 0x83, 0x80, 0x83, 0x91, 0x83, 0x0,  0x80, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[8];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20949);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
}

// UnsubscribeResponse 15084 [PropTopicAliasMaximum 6984,PropUserProperty ",\189
// \197\190&S,t\241E\ESC\248\211\DC4\177\187\b\238\205w\159\183\USK\148"
// "-\229\131\222\RS\193\171\151c\STX\138\139\214`\144\165\239k\146",PropSessionExpiryInterval
// 2451,PropSessionExpiryInterval 9205,PropAuthenticationMethod
// "\161E:&\206\194Z1\183\139\v~\SOH\255\STXx\SO\SO\ETXz\224R\161\209",PropMaximumQoS 80,PropReceiveMaximum
// 30671,PropAuthenticationData "Ya\157\&1Y\f\"\255*\248\SI\bf\EOT<Tg?P",PropTopicAlias
// 29333,PropWildcardSubscriptionAvailable 40,PropRetainAvailable 225,PropServerKeepAlive
// 17144,PropSubscriptionIdentifier 10,PropWildcardSubscriptionAvailable 219,PropTopicAlias 23806,PropReceiveMaximum
// 18243,PropMessageExpiryInterval 7920,PropMaximumQoS 204,PropReasonString
// "s\RSZ\214\STX\160\241i\159",PropMaximumPacketSize 11169,PropMessageExpiryInterval
// 25352,PropWildcardSubscriptionAvailable 29,PropMessageExpiryInterval 19580,PropMessageExpiryInterval
// 18088,PropAuthenticationData "\212\217\207#\n9\211\240z
// :\186\145\198\130\157\200j\228\&8\191\SO\234)\211\170x\225\SOH\203",PropWildcardSubscriptionAvailable
// 200,PropCorrelationData
// "Q\FS\224\USv.\146U\248\204&O\224\ETXc\CAN\178\&3\220+z\176@\207\SUB@\231\237\DC4",PropMaximumPacketSize
// 14536,PropReasonString
// "\SOe\238\191\224\224:$\ACKh\192\246\145]h\NULd\EM\161\152\177{\216(\132\DC4\239(\NUL",PropResponseTopic
// "\223\234)\ETX\SYNM\157=)\rc\t\235\158\SOH\194"]
// [UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode16) {
  uint8_t pkt[] = {
      0xb0, 0xbe, 0x2,  0x3a, 0xec, 0xad, 0x2,  0x22, 0x1b, 0x48, 0x26, 0x0,  0x1a, 0x2c, 0xbd, 0x20, 0xc5, 0xbe, 0x26,
      0x53, 0x2c, 0x74, 0xf1, 0x45, 0x1b, 0xf8, 0xd3, 0x14, 0xb1, 0xbb, 0x8,  0xee, 0xcd, 0x77, 0x9f, 0xb7, 0x1f, 0x4b,
      0x94, 0x0,  0x13, 0x2d, 0xe5, 0x83, 0xde, 0x1e, 0xc1, 0xab, 0x97, 0x63, 0x2,  0x8a, 0x8b, 0xd6, 0x60, 0x90, 0xa5,
      0xef, 0x6b, 0x92, 0x11, 0x0,  0x0,  0x9,  0x93, 0x11, 0x0,  0x0,  0x23, 0xf5, 0x15, 0x0,  0x18, 0xa1, 0x45, 0x3a,
      0x26, 0xce, 0xc2, 0x5a, 0x31, 0xb7, 0x8b, 0xb,  0x7e, 0x1,  0xff, 0x2,  0x78, 0xe,  0xe,  0x3,  0x7a, 0xe0, 0x52,
      0xa1, 0xd1, 0x24, 0x50, 0x21, 0x77, 0xcf, 0x16, 0x0,  0x13, 0x59, 0x61, 0x9d, 0x31, 0x59, 0xc,  0x22, 0xff, 0x2a,
      0xf8, 0xf,  0x8,  0x66, 0x4,  0x3c, 0x54, 0x67, 0x3f, 0x50, 0x23, 0x72, 0x95, 0x28, 0x28, 0x25, 0xe1, 0x13, 0x42,
      0xf8, 0xb,  0xa,  0x28, 0xdb, 0x23, 0x5c, 0xfe, 0x21, 0x47, 0x43, 0x2,  0x0,  0x0,  0x1e, 0xf0, 0x24, 0xcc, 0x1f,
      0x0,  0x9,  0x73, 0x1e, 0x5a, 0xd6, 0x2,  0xa0, 0xf1, 0x69, 0x9f, 0x27, 0x0,  0x0,  0x2b, 0xa1, 0x2,  0x0,  0x0,
      0x63, 0x8,  0x28, 0x1d, 0x2,  0x0,  0x0,  0x4c, 0x7c, 0x2,  0x0,  0x0,  0x46, 0xa8, 0x16, 0x0,  0x1e, 0xd4, 0xd9,
      0xcf, 0x23, 0xa,  0x39, 0xd3, 0xf0, 0x7a, 0x20, 0x3a, 0xba, 0x91, 0xc6, 0x82, 0x9d, 0xc8, 0x6a, 0xe4, 0x38, 0xbf,
      0xe,  0xea, 0x29, 0xd3, 0xaa, 0x78, 0xe1, 0x1,  0xcb, 0x28, 0xc8, 0x9,  0x0,  0x1d, 0x51, 0x1c, 0xe0, 0x1f, 0x76,
      0x2e, 0x92, 0x55, 0xf8, 0xcc, 0x26, 0x4f, 0xe0, 0x3,  0x63, 0x18, 0xb2, 0x33, 0xdc, 0x2b, 0x7a, 0xb0, 0x40, 0xcf,
      0x1a, 0x40, 0xe7, 0xed, 0x14, 0x27, 0x0,  0x0,  0x38, 0xc8, 0x1f, 0x0,  0x1d, 0xe,  0x65, 0xee, 0xbf, 0xe0, 0xe0,
      0x3a, 0x24, 0x6,  0x68, 0xc0, 0xf6, 0x91, 0x5d, 0x68, 0x0,  0x64, 0x19, 0xa1, 0x98, 0xb1, 0x7b, 0xd8, 0x28, 0x84,
      0x14, 0xef, 0x28, 0x0,  0x8,  0x0,  0x10, 0xdf, 0xea, 0x29, 0x3,  0x16, 0x4d, 0x9d, 0x3d, 0x29, 0xd,  0x63, 0x9,
      0xeb, 0x9e, 0x1,  0xc2, 0x11, 0x8f, 0x80, 0x11, 0x80, 0x91, 0x80, 0x8f, 0x8f, 0x91, 0x11, 0x83, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[13];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 13, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15084);
  EXPECT_EQ(count, 13);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 3745 [PropCorrelationData "\194\ACK\SIc\GSjx\243\215s\150(",PropReceiveMaximum
// 24320,PropServerKeepAlive 17397,PropWildcardSubscriptionAvailable 157,PropMessageExpiryInterval
// 2700,PropServerReference
// "^\232\202-\198Y\189\138\167\&3\190\SI\140\STX!\SUB\STX\145\231\171\&0\160\241X\166\173",PropAssignedClientIdentifier
// "4\207\242\244L",PropPayloadFormatIndicator 219,PropRequestProblemInformation 17,PropMessageExpiryInterval
// 21299,PropResponseTopic "\176\176'\133\145\175x",PropCorrelationData
// "U\249X\210\STX\196\140X\232$3\137\DC2\NAK\218\FS\139\230\253\SI\233)6/+\228",PropSessionExpiryInterval
// 13662,PropServerKeepAlive 24528,PropSessionExpiryInterval 6125,PropSubscriptionIdentifier 24,PropRetainAvailable
// 252,PropWillDelayInterval 17895,PropResponseTopic
// "\245\144\173Ne\247\154GVf<\137\174\"\142\147im\212\RS+\179\SOu\144",PropCorrelationData
// "\231\222\206\172\CAN\180\&3DkVj\233\194u\166q\230P",PropResponseInformation
// "~\173\228\\\NUL\SO\255\"",PropSubscriptionIdentifier 0,PropSharedSubscriptionAvailable 137]
// [UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode17) {
  uint8_t pkt[] = {0xb0, 0xd9, 0x1,  0xe,  0xa1, 0xc7, 0x1,  0x9,  0x0,  0xc,  0xc2, 0x6,  0xf,  0x63, 0x1d, 0x6a, 0x78,
                   0xf3, 0xd7, 0x73, 0x96, 0x28, 0x21, 0x5f, 0x0,  0x13, 0x43, 0xf5, 0x28, 0x9d, 0x2,  0x0,  0x0,  0xa,
                   0x8c, 0x1c, 0x0,  0x1a, 0x5e, 0xe8, 0xca, 0x2d, 0xc6, 0x59, 0xbd, 0x8a, 0xa7, 0x33, 0xbe, 0xf,  0x8c,
                   0x2,  0x21, 0x1a, 0x2,  0x91, 0xe7, 0xab, 0x30, 0xa0, 0xf1, 0x58, 0xa6, 0xad, 0x12, 0x0,  0x5,  0x34,
                   0xcf, 0xf2, 0xf4, 0x4c, 0x1,  0xdb, 0x17, 0x11, 0x2,  0x0,  0x0,  0x53, 0x33, 0x8,  0x0,  0x7,  0xb0,
                   0xb0, 0x27, 0x85, 0x91, 0xaf, 0x78, 0x9,  0x0,  0x1a, 0x55, 0xf9, 0x58, 0xd2, 0x2,  0xc4, 0x8c, 0x58,
                   0xe8, 0x24, 0x33, 0x89, 0x12, 0x15, 0xda, 0x1c, 0x8b, 0xe6, 0xfd, 0xf,  0xe9, 0x29, 0x36, 0x2f, 0x2b,
                   0xe4, 0x11, 0x0,  0x0,  0x35, 0x5e, 0x13, 0x5f, 0xd0, 0x11, 0x0,  0x0,  0x17, 0xed, 0xb,  0x18, 0x25,
                   0xfc, 0x18, 0x0,  0x0,  0x45, 0xe7, 0x8,  0x0,  0x19, 0xf5, 0x90, 0xad, 0x4e, 0x65, 0xf7, 0x9a, 0x47,
                   0x56, 0x66, 0x3c, 0x89, 0xae, 0x22, 0x8e, 0x93, 0x69, 0x6d, 0xd4, 0x1e, 0x2b, 0xb3, 0xe,  0x75, 0x90,
                   0x9,  0x0,  0x12, 0xe7, 0xde, 0xce, 0xac, 0x18, 0xb4, 0x33, 0x44, 0x6b, 0x56, 0x6a, 0xe9, 0xc2, 0x75,
                   0xa6, 0x71, 0xe6, 0x50, 0x1a, 0x0,  0x8,  0x7e, 0xad, 0xe4, 0x5c, 0x0,  0xe,  0xff, 0x22, 0xb,  0x0,
                   0x2a, 0x89, 0x91, 0x91, 0x80, 0x80, 0x87, 0x91, 0x8f, 0x11, 0x80, 0x8f, 0x11, 0x11, 0x83, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[14];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 14, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3745);
  EXPECT_EQ(count, 14);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 2642 [PropTopicAliasMaximum 15489,PropResponseInformation
// "@\158?\133-\170RV\154,\NUL\154\194\227\&9f\RS\SOH{",PropAuthenticationData
// "\NULR\182\STXS\174\184Q",PropResponseInformation
// "\182\221\237\187\205F\\x1\197\239\217;\128y<\141\RS\SYN\187\169\193\149\208\244\205\201\236\&8\219",PropTopicAliasMaximum
// 32442,PropWillDelayInterval 23140,PropPayloadFormatIndicator 34,PropSubscriptionIdentifierAvailable
// 232,PropSubscriptionIdentifier 14,PropSubscriptionIdentifierAvailable 60,PropReceiveMaximum 5190,PropServerReference
// "\ETB\SO@\219\239\USWe\204",PropWillDelayInterval 27808,PropResponseTopic
// "\154\195\&64\220\241\184\199+\155bA\ETX\216\171\186\187\236\220O\ESC\175!\SO\202.,",PropUserProperty
// "4m\229w\185\137" "\CAN\129\SI\214\141Zf",PropRequestProblemInformation 108,PropPayloadFormatIndicator
// 60,PropTopicAlias 3976,PropAuthenticationData "\168\153\170g\DLE"]
// [UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode18) {
  uint8_t pkt[] = {0xb0, 0xb0, 0x1,  0xa,  0x52, 0xa8, 0x1,  0x22, 0x3c, 0x81, 0x1a, 0x0,  0x13, 0x40, 0x9e, 0x3f, 0x85,
                   0x2d, 0xaa, 0x52, 0x56, 0x9a, 0x2c, 0x0,  0x9a, 0xc2, 0xe3, 0x39, 0x66, 0x1e, 0x1,  0x7b, 0x16, 0x0,
                   0x8,  0x0,  0x52, 0xb6, 0x2,  0x53, 0xae, 0xb8, 0x51, 0x1a, 0x0,  0x1e, 0xb6, 0xdd, 0xed, 0xbb, 0xcd,
                   0x46, 0x5c, 0x78, 0x31, 0xc5, 0xef, 0xd9, 0x3b, 0x80, 0x79, 0x3c, 0x8d, 0x1e, 0x16, 0xbb, 0xa9, 0xc1,
                   0x95, 0xd0, 0xf4, 0xcd, 0xc9, 0xec, 0x38, 0xdb, 0x22, 0x7e, 0xba, 0x18, 0x0,  0x0,  0x5a, 0x64, 0x1,
                   0x22, 0x29, 0xe8, 0xb,  0xe,  0x29, 0x3c, 0x21, 0x14, 0x46, 0x1c, 0x0,  0x9,  0x17, 0xe,  0x40, 0xdb,
                   0xef, 0x1f, 0x57, 0x65, 0xcc, 0x18, 0x0,  0x0,  0x6c, 0xa0, 0x8,  0x0,  0x1b, 0x9a, 0xc3, 0x36, 0x34,
                   0xdc, 0xf1, 0xb8, 0xc7, 0x2b, 0x9b, 0x62, 0x41, 0x3,  0xd8, 0xab, 0xba, 0xbb, 0xec, 0xdc, 0x4f, 0x1b,
                   0xaf, 0x21, 0xe,  0xca, 0x2e, 0x2c, 0x26, 0x0,  0x6,  0x34, 0x6d, 0xe5, 0x77, 0xb9, 0x89, 0x0,  0x7,
                   0x18, 0x81, 0xf,  0xd6, 0x8d, 0x5a, 0x66, 0x17, 0x6c, 0x1,  0x3c, 0x23, 0xf,  0x88, 0x16, 0x0,  0x5,
                   0xa8, 0x99, 0xaa, 0x67, 0x10, 0x80, 0x80, 0x80, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[4];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2642);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 11641 [PropReasonString "",PropUserProperty "+\182\183\fKgh\ETX9\129\166\141"
// "\FS\167\197\194\DC1\208\244\"<\221>qd\168\USC'8\175\241!",PropResponseInformation
// "\138l\NAK",PropSubscriptionIdentifierAvailable 136,PropMaximumQoS 148,PropSubscriptionIdentifierAvailable
// 244,PropServerKeepAlive 25040,PropTopicAlias 1743,PropAuthenticationMethod
// "\216\201r\175]\219x@i5q\239e\238\160\218\DLE",PropUserProperty "0\164y\143N" "KD",PropReasonString
// "3C\210q\n\CAN{\131\237\224N\FS\170\183u|4R",PropServerKeepAlive 10794,PropMessageExpiryInterval
// 17780,PropSubscriptionIdentifierAvailable 204,PropSessionExpiryInterval 3287,PropRequestProblemInformation
// 246,PropSubscriptionIdentifier 19,PropSubscriptionIdentifier 10,PropContentType
// "\143?}\ESC\249}9\NUL\142\128\210r\SYNA\STX\176\250\132"]
// [UnsubNoSubscriptionExisted,UnsubSuccess,UnsubNotAuthorized,UnsubSuccess,UnsubNotAuthorized,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode19) {
  uint8_t pkt[] = {0xb0, 0xa4, 0x1,  0x2d, 0x79, 0x9a, 0x1,  0x1f, 0x0,  0x0,  0x26, 0x0,  0xc,  0x2b, 0xb6, 0xb7, 0xc,
                   0x4b, 0x67, 0x68, 0x3,  0x39, 0x81, 0xa6, 0x8d, 0x0,  0x15, 0x1c, 0xa7, 0xc5, 0xc2, 0x11, 0xd0, 0xf4,
                   0x22, 0x3c, 0xdd, 0x3e, 0x71, 0x64, 0xa8, 0x1f, 0x43, 0x27, 0x38, 0xaf, 0xf1, 0x21, 0x1a, 0x0,  0x3,
                   0x8a, 0x6c, 0x15, 0x29, 0x88, 0x24, 0x94, 0x29, 0xf4, 0x13, 0x61, 0xd0, 0x23, 0x6,  0xcf, 0x15, 0x0,
                   0x11, 0xd8, 0xc9, 0x72, 0xaf, 0x5d, 0xdb, 0x78, 0x40, 0x69, 0x35, 0x71, 0xef, 0x65, 0xee, 0xa0, 0xda,
                   0x10, 0x26, 0x0,  0x5,  0x30, 0xa4, 0x79, 0x8f, 0x4e, 0x0,  0x2,  0x4b, 0x44, 0x1f, 0x0,  0x12, 0x33,
                   0x43, 0xd2, 0x71, 0xa,  0x18, 0x7b, 0x83, 0xed, 0xe0, 0x4e, 0x1c, 0xaa, 0xb7, 0x75, 0x7c, 0x34, 0x52,
                   0x13, 0x2a, 0x2a, 0x2,  0x0,  0x0,  0x45, 0x74, 0x29, 0xcc, 0x11, 0x0,  0x0,  0xc,  0xd7, 0x17, 0xf6,
                   0xb,  0x13, 0xb,  0xa,  0x3,  0x0,  0x12, 0x8f, 0x3f, 0x7d, 0x1b, 0xf9, 0x7d, 0x39, 0x0,  0x8e, 0x80,
                   0xd2, 0x72, 0x16, 0x41, 0x2,  0xb0, 0xfa, 0x84, 0x11, 0x0,  0x87, 0x0,  0x87, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[6];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11641);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 5146 [PropReasonString
// "\214\192\142\182(b@\215w\222t\145\195\EM\141Er\161\US\255\136m\US\133'\219\164j ",PropCorrelationData
// "\200\USu_+<\195\139\163\156q\EOT\158\\\149\223\SYN\184\221\GS\f\202~\179A\187_"]
// [UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubSuccess,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubSuccess,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode20) {
  uint8_t pkt[] = {0xb0, 0x5a, 0x14, 0x1a, 0x3e, 0x1f, 0x0,  0x1d, 0xd6, 0xc0, 0x8e, 0xb6, 0x28, 0x62, 0x40, 0xd7,
                   0x77, 0xde, 0x74, 0x91, 0xc3, 0x19, 0x8d, 0x45, 0x72, 0xa1, 0x1f, 0xff, 0x88, 0x6d, 0x1f, 0x85,
                   0x27, 0xdb, 0xa4, 0x6a, 0x20, 0x9,  0x0,  0x1b, 0xc8, 0x1f, 0x75, 0x5f, 0x2b, 0x3c, 0xc3, 0x8b,
                   0xa3, 0x9c, 0x71, 0x4,  0x9e, 0x5c, 0x95, 0xdf, 0x16, 0xb8, 0xdd, 0x1d, 0xc,  0xca, 0x7e, 0xb3,
                   0x41, 0xbb, 0x5f, 0x83, 0x87, 0x87, 0x80, 0x87, 0x0,  0x87, 0x91, 0x11, 0x91, 0x87, 0x91, 0x11,
                   0x0,  0x0,  0x91, 0x0,  0x8f, 0x8f, 0x87, 0x0,  0x83, 0x83, 0x11, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[25];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 25, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5146);
  EXPECT_EQ(count, 25);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 19495 [PropReceiveMaximum 12701,PropAuthenticationData "\DC24\224\169"]
// [UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubSuccess,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubTopicFilterInvalid,UnsubSuccess,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubSuccess,UnsubUnspecifiedError,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode21) {
  uint8_t pkt[] = {0xb0, 0x28, 0x4c, 0x27, 0xa,  0x21, 0x31, 0x9d, 0x16, 0x0,  0x4, 0x12, 0x34, 0xe0,
                   0xa9, 0x91, 0x8f, 0x83, 0x0,  0x0,  0x11, 0x80, 0x8f, 0x91, 0x0, 0x8f, 0x0,  0x0,
                   0x11, 0x87, 0x11, 0x91, 0x91, 0x83, 0x80, 0x11, 0x11, 0x11, 0x0, 0x0,  0x80, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[27];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 27, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19495);
  EXPECT_EQ(count, 27);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 2650 [PropMaximumPacketSize 23567,PropReceiveMaximum 460,PropReceiveMaximum 9781,PropReasonString
// "\223\167\182\215\NUL\210\201\211\218\131",PropServerKeepAlive 9721]
// [UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode22) {
  uint8_t pkt[] = {0xb0, 0x2b, 0xa,  0x5a, 0x1b, 0x27, 0x0,  0x0,  0x5c, 0xf,  0x21, 0x1,  0xcc, 0x21, 0x26,
                   0x35, 0x1f, 0x0,  0xa,  0xdf, 0xa7, 0xb6, 0xd7, 0x0,  0xd2, 0xc9, 0xd3, 0xda, 0x83, 0x13,
                   0x25, 0xf9, 0x83, 0x80, 0x83, 0x8f, 0x80, 0x80, 0x0,  0x11, 0x8f, 0x87, 0x83, 0x11, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[13];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 13, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2650);
  EXPECT_EQ(count, 13);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 4720 [PropReasonString
// "\130\242\f\SYN\158?\183\229\174\203B\213\\\249\DC3I\134\138\252\129\SO\231\199.",PropReasonString
// "\187\196\213\ESC\128\213t\145OU/",PropServerReference "",PropReasonString
// "\DEL?z+\\\197\200\219\193\152!'\174\137",PropPayloadFormatIndicator 48,PropUserProperty "\202)+\188\172\192\223C"
// "\139\178H!\SUB\253\&8\190!\135]\CAN",PropSharedSubscriptionAvailable 34,PropMaximumPacketSize
// 14585,PropRequestProblemInformation 61,PropAssignedClientIdentifier
// "Xi\247yG\138_v\247-\181",PropRequestProblemInformation 16,PropMaximumPacketSize 13540,PropContentType
// "N\243W[\DEL\181\221H\240#\232",PropAuthenticationMethod
// "\209\131F\129\218\174\131O\220\166\253\238\b\164W(?\189\236\218\v\204M\215\NAKYXo",PropRetainAvailable
// 195,PropReceiveMaximum 20755,PropWildcardSubscriptionAvailable 251,PropUserProperty "\184\EM\148\DC4]\167"
// "",PropAuthenticationData "\175kB\217",PropSubscriptionIdentifierAvailable 154,PropWillDelayInterval
// 23743,PropMaximumQoS 106,PropSubscriptionIdentifier 25,PropSessionExpiryInterval 7290]
// [UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNotAuthorized,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode23) {
  uint8_t pkt[] = {
      0xb0, 0xdb, 0x1,  0x12, 0x70, 0xcc, 0x1,  0x1f, 0x0,  0x18, 0x82, 0xf2, 0xc,  0x16, 0x9e, 0x3f, 0xb7, 0xe5, 0xae,
      0xcb, 0x42, 0xd5, 0x5c, 0xf9, 0x13, 0x49, 0x86, 0x8a, 0xfc, 0x81, 0xe,  0xe7, 0xc7, 0x2e, 0x1f, 0x0,  0xb,  0xbb,
      0xc4, 0xd5, 0x1b, 0x80, 0xd5, 0x74, 0x91, 0x4f, 0x55, 0x2f, 0x1c, 0x0,  0x0,  0x1f, 0x0,  0xe,  0x7f, 0x3f, 0x7a,
      0x2b, 0x5c, 0xc5, 0xc8, 0xdb, 0xc1, 0x98, 0x21, 0x27, 0xae, 0x89, 0x1,  0x30, 0x26, 0x0,  0x8,  0xca, 0x29, 0x2b,
      0xbc, 0xac, 0xc0, 0xdf, 0x43, 0x0,  0xc,  0x8b, 0xb2, 0x48, 0x21, 0x1a, 0xfd, 0x38, 0xbe, 0x21, 0x87, 0x5d, 0x18,
      0x2a, 0x22, 0x27, 0x0,  0x0,  0x38, 0xf9, 0x17, 0x3d, 0x12, 0x0,  0xb,  0x58, 0x69, 0xf7, 0x79, 0x47, 0x8a, 0x5f,
      0x76, 0xf7, 0x2d, 0xb5, 0x17, 0x10, 0x27, 0x0,  0x0,  0x34, 0xe4, 0x3,  0x0,  0xb,  0x4e, 0xf3, 0x57, 0x5b, 0x7f,
      0xb5, 0xdd, 0x48, 0xf0, 0x23, 0xe8, 0x15, 0x0,  0x1c, 0xd1, 0x83, 0x46, 0x81, 0xda, 0xae, 0x83, 0x4f, 0xdc, 0xa6,
      0xfd, 0xee, 0x8,  0xa4, 0x57, 0x28, 0x3f, 0xbd, 0xec, 0xda, 0xb,  0xcc, 0x4d, 0xd7, 0x15, 0x59, 0x58, 0x6f, 0x25,
      0xc3, 0x21, 0x51, 0x13, 0x28, 0xfb, 0x26, 0x0,  0x6,  0xb8, 0x19, 0x94, 0x14, 0x5d, 0xa7, 0x0,  0x0,  0x16, 0x0,
      0x4,  0xaf, 0x6b, 0x42, 0xd9, 0x29, 0x9a, 0x18, 0x0,  0x0,  0x5c, 0xbf, 0x24, 0x6a, 0xb,  0x19, 0x11, 0x0,  0x0,
      0x1c, 0x7a, 0x8f, 0x11, 0x8f, 0x80, 0x8f, 0x0,  0x87, 0x87, 0x80, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[11];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4720);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 7392 [PropContentType
// "#\204w\172\159\245\142\174]\141\136\249\183-\SYNO\223\131\202",PropSubscriptionIdentifierAvailable
// 98,PropMessageExpiryInterval 23148,PropAssignedClientIdentifier
// "\252\168\233}\191\225\SI\199\td\207:\n\\\141\228p\b9\187\SUB\195\176\158\243\197l\202\ENQ\244",PropServerKeepAlive
// 18028,PropSubscriptionIdentifierAvailable 242,PropRequestResponseInformation 130]
// [UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubSuccess,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubSuccess,UnsubImplementationSpecificError]
TEST(UnsubACK5QCTest, Decode24) {
  uint8_t pkt[] = {0xb0, 0x63, 0x1c, 0xe0, 0x45, 0x3,  0x0,  0x13, 0x23, 0xcc, 0x77, 0xac, 0x9f, 0xf5, 0x8e, 0xae, 0x5d,
                   0x8d, 0x88, 0xf9, 0xb7, 0x2d, 0x16, 0x4f, 0xdf, 0x83, 0xca, 0x29, 0x62, 0x2,  0x0,  0x0,  0x5a, 0x6c,
                   0x12, 0x0,  0x1e, 0xfc, 0xa8, 0xe9, 0x7d, 0xbf, 0xe1, 0xf,  0xc7, 0x9,  0x64, 0xcf, 0x3a, 0xa,  0x5c,
                   0x8d, 0xe4, 0x70, 0x8,  0x39, 0xbb, 0x1a, 0xc3, 0xb0, 0x9e, 0xf3, 0xc5, 0x6c, 0xca, 0x5,  0xf4, 0x13,
                   0x46, 0x6c, 0x29, 0xf2, 0x19, 0x82, 0x80, 0x8f, 0x8f, 0x11, 0x87, 0x11, 0x11, 0x87, 0x87, 0x11, 0x80,
                   0x83, 0x80, 0x83, 0x8f, 0x0,  0x0,  0x87, 0x91, 0x0,  0x8f, 0x80, 0x83, 0x80, 0x83, 0x0,  0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[27];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 27, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7392);
  EXPECT_EQ(count, 27);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
}

// UnsubscribeResponse 18418 [PropPayloadFormatIndicator 73,PropSubscriptionIdentifier 27,PropMessageExpiryInterval
// 17696,PropPayloadFormatIndicator 158,PropRequestProblemInformation 251]
// [UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubSuccess,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode25) {
  uint8_t pkt[] = {0xb0, 0x23, 0x47, 0xf2, 0xd,  0x1,  0x49, 0xb,  0x1b, 0x2,  0x0,  0x0,  0x45,
                   0x20, 0x1,  0x9e, 0x17, 0xfb, 0x11, 0x87, 0x83, 0x91, 0x11, 0x8f, 0x80, 0x87,
                   0x8f, 0x8f, 0x87, 0x80, 0x83, 0x8f, 0x11, 0x80, 0x80, 0x0,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[19];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 19, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18418);
  EXPECT_EQ(count, 19);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 9706 [PropMaximumQoS 251,PropServerKeepAlive 26315,PropSharedSubscriptionAvailable
// 253,PropTopicAliasMaximum 9589,PropResponseInformation "*",PropUserProperty
// "\170\252A\186\171\246)\178\217\236\136\250x\153T\NAK\211W\CAN\214\ACK\208\132\164\&3\175."
// "6\192\t\182\242\160\FSJN",PropServerKeepAlive 1102,PropMaximumPacketSize 12716,PropWildcardSubscriptionAvailable
// 93,PropRequestResponseInformation 111,PropTopicAliasMaximum 7469,PropServerReference
// "}\189Q\204\235\166\&5",PropResponseTopic "\236\DC3\DLE\158Ri\185\176\NUL\136d\139`
// p\171\ENQ",PropSubscriptionIdentifierAvailable 133]
// [UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubSuccess,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubSuccess,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubSuccess,UnsubUnspecifiedError,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode26) {
  uint8_t pkt[] = {0xb0, 0x80, 0x1,  0x25, 0xea, 0x66, 0x24, 0xfb, 0x13, 0x66, 0xcb, 0x2a, 0xfd, 0x22, 0x25, 0x75, 0x1a,
                   0x0,  0x1,  0x2a, 0x26, 0x0,  0x1b, 0xaa, 0xfc, 0x41, 0xba, 0xab, 0xf6, 0x29, 0xb2, 0xd9, 0xec, 0x88,
                   0xfa, 0x78, 0x99, 0x54, 0x15, 0xd3, 0x57, 0x18, 0xd6, 0x6,  0xd0, 0x84, 0xa4, 0x33, 0xaf, 0x2e, 0x0,
                   0x9,  0x36, 0xc0, 0x9,  0xb6, 0xf2, 0xa0, 0x1c, 0x4a, 0x4e, 0x13, 0x4,  0x4e, 0x27, 0x0,  0x0,  0x31,
                   0xac, 0x28, 0x5d, 0x19, 0x6f, 0x22, 0x1d, 0x2d, 0x1c, 0x0,  0x7,  0x7d, 0xbd, 0x51, 0xcc, 0xeb, 0xa6,
                   0x35, 0x8,  0x0,  0x11, 0xec, 0x13, 0x10, 0x9e, 0x52, 0x69, 0xb9, 0xb0, 0x0,  0x88, 0x64, 0x8b, 0x60,
                   0x20, 0x70, 0xab, 0x5,  0x29, 0x85, 0x80, 0x8f, 0x83, 0x8f, 0x83, 0x0,  0x8f, 0x83, 0x91, 0x80, 0x83,
                   0x8f, 0x87, 0x0,  0x83, 0x87, 0x11, 0x80, 0x8f, 0x87, 0x0,  0x80, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[23];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 23, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9706);
  EXPECT_EQ(count, 23);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 5357 [PropServerReference "\206\234\191\NAK: X\146\171\"\144\186M\137\&4\177",PropServerReference
// "\169\149\216\&6\137\215a\221!\132\DC4\240\CAN\DC2\150\138\183\133\169\170\170\218\GS\n\RS\178t\165",PropResponseInformation
// "\220\\@\247\235\229\202\154q\165?",PropCorrelationData
// "5\255\155\163o\236\228\203\143\252\178\&9\129\DC2\172\&1",PropMaximumQoS 160,PropAssignedClientIdentifier
// ":'\n\158{\194\135",PropSubscriptionIdentifierAvailable 169,PropServerReference
// "j\148\240\DEL*\ACK\240\189\219]p<\STX\ETXk2-XJ\145\&1\245",PropCorrelationData
// "B\FS\249\247\176\STXS\250\155:%\DC2\\\t\252_\161",PropServerKeepAlive 9127]
// [UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubNotAuthorized,UnsubSuccess,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubTopicFilterInvalid]
TEST(UnsubACK5QCTest, Decode27) {
  uint8_t pkt[] = {0xb0, 0xb1, 0x1,  0x14, 0xed, 0x91, 0x1,  0x1c, 0x0,  0x10, 0xce, 0xea, 0xbf, 0x15, 0x3a, 0x20, 0x58,
                   0x92, 0xab, 0x22, 0x90, 0xba, 0x4d, 0x89, 0x34, 0xb1, 0x1c, 0x0,  0x1c, 0xa9, 0x95, 0xd8, 0x36, 0x89,
                   0xd7, 0x61, 0xdd, 0x21, 0x84, 0x14, 0xf0, 0x18, 0x12, 0x96, 0x8a, 0xb7, 0x85, 0xa9, 0xaa, 0xaa, 0xda,
                   0x1d, 0xa,  0x1e, 0xb2, 0x74, 0xa5, 0x1a, 0x0,  0xb,  0xdc, 0x5c, 0x40, 0xf7, 0xeb, 0xe5, 0xca, 0x9a,
                   0x71, 0xa5, 0x3f, 0x9,  0x0,  0x10, 0x35, 0xff, 0x9b, 0xa3, 0x6f, 0xec, 0xe4, 0xcb, 0x8f, 0xfc, 0xb2,
                   0x39, 0x81, 0x12, 0xac, 0x31, 0x24, 0xa0, 0x12, 0x0,  0x7,  0x3a, 0x27, 0xa,  0x9e, 0x7b, 0xc2, 0x87,
                   0x29, 0xa9, 0x1c, 0x0,  0x16, 0x6a, 0x94, 0xf0, 0x7f, 0x2a, 0x6,  0xf0, 0xbd, 0xdb, 0x5d, 0x70, 0x3c,
                   0x2,  0x3,  0x6b, 0x32, 0x2d, 0x58, 0x4a, 0x91, 0x31, 0xf5, 0x9,  0x0,  0x11, 0x42, 0x1c, 0xf9, 0xf7,
                   0xb0, 0x2,  0x53, 0xfa, 0x9b, 0x3a, 0x25, 0x12, 0x5c, 0x9,  0xfc, 0x5f, 0xa1, 0x13, 0x23, 0xa7, 0x80,
                   0x91, 0x83, 0x87, 0x91, 0x80, 0x91, 0x87, 0x0,  0x91, 0x11, 0x83, 0x11, 0x87, 0x83, 0x80, 0x91, 0x0,
                   0x87, 0x0,  0x0,  0x91, 0x91, 0x80, 0x80, 0x91, 0x87, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[28];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 28, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5357);
  EXPECT_EQ(count, 28);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[27], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
}

// UnsubscribeResponse 25609 [PropMessageExpiryInterval 9067,PropResponseTopic "{\128r\NAK\243",PropContentType
// "\188{7\DC1",PropSubscriptionIdentifierAvailable 61,PropTopicAlias 16945,PropSubscriptionIdentifierAvailable
// 187,PropSharedSubscriptionAvailable 206,PropCorrelationData
// "\233//V\237q\181\252\175\v\228\148T-\148,\177\195\198\129\214",PropAuthenticationMethod "\180n\210j",PropMaximumQoS
// 221,PropSubscriptionIdentifierAvailable 160,PropSubscriptionIdentifier 30,PropCorrelationData
// "m\231x\175M^\208\130\203\253\152\204\186\227\161\204\"\218Ybp9z",PropMessageExpiryInterval 1351,PropResponseTopic
// "L\158\139\DC4#J\165\136k\SUB\129\&7t\227o",PropMessageExpiryInterval 6136,PropReceiveMaximum
// 26201,PropServerReference "\252\176\201>2Q\184H\140\231L\b\163B\221",PropRequestProblemInformation 95,PropContentType
// "\254h\216\EM\140=.\213\168\DC3\245\232V\201'{",PropServerKeepAlive 21516,PropMaximumQoS 182,PropMaximumQoS
// 194,PropMessageExpiryInterval 26010,PropServerReference
// "\rI\194\189\CAN\161\170\&8\161;\189(\139K\216/",PropServerKeepAlive 30668,PropCorrelationData
// "l\246h\220\220\&4k\176\173=\SYN\227\193@a\196\207\ACK\ACK\245\226",PropResponseInformation
// "Z\225\245w",PropTopicAlias 5475]
// [UnsubSuccess,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubSuccess,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubNotAuthorized,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode28) {
  uint8_t pkt[] = {
      0xb0, 0x86, 0x2,  0x64, 0x9,  0xe6, 0x1,  0x2,  0x0,  0x0,  0x23, 0x6b, 0x8,  0x0,  0x5,  0x7b, 0x80, 0x72, 0x15,
      0xf3, 0x3,  0x0,  0x4,  0xbc, 0x7b, 0x37, 0x11, 0x29, 0x3d, 0x23, 0x42, 0x31, 0x29, 0xbb, 0x2a, 0xce, 0x9,  0x0,
      0x15, 0xe9, 0x2f, 0x2f, 0x56, 0xed, 0x71, 0xb5, 0xfc, 0xaf, 0xb,  0xe4, 0x94, 0x54, 0x2d, 0x94, 0x2c, 0xb1, 0xc3,
      0xc6, 0x81, 0xd6, 0x15, 0x0,  0x4,  0xb4, 0x6e, 0xd2, 0x6a, 0x24, 0xdd, 0x29, 0xa0, 0xb,  0x1e, 0x9,  0x0,  0x17,
      0x6d, 0xe7, 0x78, 0xaf, 0x4d, 0x5e, 0xd0, 0x82, 0xcb, 0xfd, 0x98, 0xcc, 0xba, 0xe3, 0xa1, 0xcc, 0x22, 0xda, 0x59,
      0x62, 0x70, 0x39, 0x7a, 0x2,  0x0,  0x0,  0x5,  0x47, 0x8,  0x0,  0xf,  0x4c, 0x9e, 0x8b, 0x14, 0x23, 0x4a, 0xa5,
      0x88, 0x6b, 0x1a, 0x81, 0x37, 0x74, 0xe3, 0x6f, 0x2,  0x0,  0x0,  0x17, 0xf8, 0x21, 0x66, 0x59, 0x1c, 0x0,  0xf,
      0xfc, 0xb0, 0xc9, 0x3e, 0x32, 0x51, 0xb8, 0x48, 0x8c, 0xe7, 0x4c, 0x8,  0xa3, 0x42, 0xdd, 0x17, 0x5f, 0x3,  0x0,
      0x10, 0xfe, 0x68, 0xd8, 0x19, 0x8c, 0x3d, 0x2e, 0xd5, 0xa8, 0x13, 0xf5, 0xe8, 0x56, 0xc9, 0x27, 0x7b, 0x13, 0x54,
      0xc,  0x24, 0xb6, 0x24, 0xc2, 0x2,  0x0,  0x0,  0x65, 0x9a, 0x1c, 0x0,  0x10, 0xd,  0x49, 0xc2, 0xbd, 0x18, 0xa1,
      0xaa, 0x38, 0xa1, 0x3b, 0xbd, 0x28, 0x8b, 0x4b, 0xd8, 0x2f, 0x13, 0x77, 0xcc, 0x9,  0x0,  0x15, 0x6c, 0xf6, 0x68,
      0xdc, 0xdc, 0x34, 0x6b, 0xb0, 0xad, 0x3d, 0x16, 0xe3, 0xc1, 0x40, 0x61, 0xc4, 0xcf, 0x6,  0x6,  0xf5, 0xe2, 0x1a,
      0x0,  0x4,  0x5a, 0xe1, 0xf5, 0x77, 0x23, 0x15, 0x63, 0x0,  0x83, 0x87, 0x83, 0x87, 0x83, 0x11, 0x83, 0x8f, 0x87,
      0x8f, 0x0,  0x8f, 0x91, 0x91, 0x80, 0x11, 0x87, 0x87, 0x0,  0x91, 0x83, 0x80, 0x83, 0x8f, 0x8f, 0x11, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[28];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 28, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25609);
  EXPECT_EQ(count, 28);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[27], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 8043 [PropSubscriptionIdentifier 25,PropContentType
// "\161\&9M\177\b\244KwX\199\205\251P\178\179\232\211\RS\168o1\DLE\ESCB(\\\225\184\146m",PropUserProperty
// "\b\DC4\f&\SYN\228N\DLE3\DLE\160z\DC2f\170\146v"
// "\SO\145\232\139v\159\204\232\154\180\&1}#\r\ENQ\209",PropPayloadFormatIndicator
// 28,PropSubscriptionIdentifierAvailable 64,PropAssignedClientIdentifier "\186\208\242Ce\210\207x\206"]
// [UnsubUnspecifiedError,UnsubSuccess,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubSuccess,UnsubUnspecifiedError]
TEST(UnsubACK5QCTest, Decode29) {
  uint8_t pkt[] = {0xb0, 0x6e, 0x1f, 0x6b, 0x59, 0xb,  0x19, 0x3,  0x0,  0x1e, 0xa1, 0x39, 0x4d, 0xb1, 0x8,  0xf4,
                   0x4b, 0x77, 0x58, 0xc7, 0xcd, 0xfb, 0x50, 0xb2, 0xb3, 0xe8, 0xd3, 0x1e, 0xa8, 0x6f, 0x31, 0x10,
                   0x1b, 0x42, 0x28, 0x5c, 0xe1, 0xb8, 0x92, 0x6d, 0x26, 0x0,  0x11, 0x8,  0x14, 0xc,  0x26, 0x16,
                   0xe4, 0x4e, 0x10, 0x33, 0x10, 0xa0, 0x7a, 0x12, 0x66, 0xaa, 0x92, 0x76, 0x0,  0x10, 0xe,  0x91,
                   0xe8, 0x8b, 0x76, 0x9f, 0xcc, 0xe8, 0x9a, 0xb4, 0x31, 0x7d, 0x23, 0xd,  0x5,  0xd1, 0x1,  0x1c,
                   0x29, 0x40, 0x12, 0x0,  0x9,  0xba, 0xd0, 0xf2, 0x43, 0x65, 0xd2, 0xcf, 0x78, 0xce, 0x80, 0x0,
                   0x87, 0x8f, 0x91, 0x87, 0x0,  0x11, 0x0,  0x80, 0x87, 0x87, 0x80, 0x8f, 0x8f, 0x83, 0x0,  0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[18];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 18, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8043);
  EXPECT_EQ(count, 18);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
}

// UnsubscribeResponse 7204 [PropMaximumPacketSize 20642]
// [UnsubSuccess,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode30) {
  uint8_t pkt[] = {0xb0, 0x1a, 0x1c, 0x24, 0x5,  0x27, 0x0,  0x0,  0x50, 0xa2, 0x0,  0x80, 0x11, 0x91,
                   0x8f, 0x11, 0x91, 0x80, 0x83, 0x87, 0x11, 0x91, 0x8f, 0x8f, 0x83, 0x8f, 0x0,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[18];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 18, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7204);
  EXPECT_EQ(count, 18);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// DisconnectRequest DiscoNormalDisconnection []
TEST(Disco311QCTest, Encode1) {
  uint8_t pkt[] = {0xe0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT311, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection []
TEST(Disco311QCTest, Encode2) {
  uint8_t pkt[] = {0xe0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT311, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMaximumConnectTime [PropReasonString "\191\242\214\230?\v",PropResponseInformation
// "\227]\205*mi\179\ENQ\196\227",PropMaximumPacketSize 18477,PropPayloadFormatIndicator 55,PropResponseInformation
// "\f\217\229)@Ys\156\135\174}\129!\243\129\ETB\219\172a|\168\v\143",PropAuthenticationMethod
// "\fd\152L0q\214OSP\224\DEL 7\227\182\219\186",PropResponseInformation "",PropMaximumPacketSize
// 13687,PropWildcardSubscriptionAvailable 118,PropPayloadFormatIndicator 51,PropReasonString "",PropCorrelationData
// "u(\184\161}\139\227E\ENQ\249\&8\183\139\240\181\206\223/\172h\128\&7\160\254\178\162\250\147\179\226",PropWildcardSubscriptionAvailable
// 108,PropMessageExpiryInterval 17592,PropRequestResponseInformation 153,PropSessionExpiryInterval
// 23985,PropTopicAliasMaximum 16607,PropSubscriptionIdentifierAvailable 88,PropSessionExpiryInterval
// 11289,PropAuthenticationMethod "\134#\163\160R2\132\&5\176\&4\250\129\192Z\225\143+",PropContentType
// "\200\224",PropAssignedClientIdentifier
// "\204\132\143\226|\135~\240\171T\188\241-P\147\219`\235\178\vi\225\142",PropMaximumPacketSize
// 25765,PropSubscriptionIdentifierAvailable 116,PropResponseInformation
// "\160\154\248\199,\190\ETXZ\SUB&SM\240(\220\244Q\129:\SUB",PropTopicAliasMaximum 588,PropMessageExpiryInterval
// 9192,PropReasonString "\189\183\178\156\DC4\DEL\196w\208\154c\231\a"]
TEST(Disco5QCTest, Encode1) {
  uint8_t pkt[] = {
      0xe0, 0x80, 0x2,  0xa0, 0xfd, 0x1,  0x1f, 0x0,  0x6,  0xbf, 0xf2, 0xd6, 0xe6, 0x3f, 0xb,  0x1a, 0x0,  0xa,  0xe3,
      0x5d, 0xcd, 0x2a, 0x6d, 0x69, 0xb3, 0x5,  0xc4, 0xe3, 0x27, 0x0,  0x0,  0x48, 0x2d, 0x1,  0x37, 0x1a, 0x0,  0x17,
      0xc,  0xd9, 0xe5, 0x29, 0x40, 0x59, 0x73, 0x9c, 0x87, 0xae, 0x7d, 0x81, 0x21, 0xf3, 0x81, 0x17, 0xdb, 0xac, 0x61,
      0x7c, 0xa8, 0xb,  0x8f, 0x15, 0x0,  0x12, 0xc,  0x64, 0x98, 0x4c, 0x30, 0x71, 0xd6, 0x4f, 0x53, 0x50, 0xe0, 0x7f,
      0x20, 0x37, 0xe3, 0xb6, 0xdb, 0xba, 0x1a, 0x0,  0x0,  0x27, 0x0,  0x0,  0x35, 0x77, 0x28, 0x76, 0x1,  0x33, 0x1f,
      0x0,  0x0,  0x9,  0x0,  0x1e, 0x75, 0x28, 0xb8, 0xa1, 0x7d, 0x8b, 0xe3, 0x45, 0x5,  0xf9, 0x38, 0xb7, 0x8b, 0xf0,
      0xb5, 0xce, 0xdf, 0x2f, 0xac, 0x68, 0x80, 0x37, 0xa0, 0xfe, 0xb2, 0xa2, 0xfa, 0x93, 0xb3, 0xe2, 0x28, 0x6c, 0x2,
      0x0,  0x0,  0x44, 0xb8, 0x19, 0x99, 0x11, 0x0,  0x0,  0x5d, 0xb1, 0x22, 0x40, 0xdf, 0x29, 0x58, 0x11, 0x0,  0x0,
      0x2c, 0x19, 0x15, 0x0,  0x11, 0x86, 0x23, 0xa3, 0xa0, 0x52, 0x32, 0x84, 0x35, 0xb0, 0x34, 0xfa, 0x81, 0xc0, 0x5a,
      0xe1, 0x8f, 0x2b, 0x3,  0x0,  0x2,  0xc8, 0xe0, 0x12, 0x0,  0x17, 0xcc, 0x84, 0x8f, 0xe2, 0x7c, 0x87, 0x7e, 0xf0,
      0xab, 0x54, 0xbc, 0xf1, 0x2d, 0x50, 0x93, 0xdb, 0x60, 0xeb, 0xb2, 0xb,  0x69, 0xe1, 0x8e, 0x27, 0x0,  0x0,  0x64,
      0xa5, 0x29, 0x74, 0x1a, 0x0,  0x14, 0xa0, 0x9a, 0xf8, 0xc7, 0x2c, 0xbe, 0x3,  0x5a, 0x1a, 0x26, 0x53, 0x4d, 0xf0,
      0x28, 0xdc, 0xf4, 0x51, 0x81, 0x3a, 0x1a, 0x22, 0x2,  0x4c, 0x2,  0x0,  0x0,  0x23, 0xe8, 0x1f, 0x0,  0xd,  0xbd,
      0xb7, 0xb2, 0x9c, 0x14, 0x7f, 0xc4, 0x77, 0xd0, 0x9a, 0x63, 0xe7, 0x7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbf, 0xf2, 0xd6, 0xe6, 0x3f, 0xb};
  uint8_t bytesprops1[] = {0xe3, 0x5d, 0xcd, 0x2a, 0x6d, 0x69, 0xb3, 0x5, 0xc4, 0xe3};
  uint8_t bytesprops2[] = {0xc,  0xd9, 0xe5, 0x29, 0x40, 0x59, 0x73, 0x9c, 0x87, 0xae, 0x7d, 0x81,
                           0x21, 0xf3, 0x81, 0x17, 0xdb, 0xac, 0x61, 0x7c, 0xa8, 0xb,  0x8f};
  uint8_t bytesprops3[] = {0xc,  0x64, 0x98, 0x4c, 0x30, 0x71, 0xd6, 0x4f, 0x53,
                           0x50, 0xe0, 0x7f, 0x20, 0x37, 0xe3, 0xb6, 0xdb, 0xba};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x75, 0x28, 0xb8, 0xa1, 0x7d, 0x8b, 0xe3, 0x45, 0x5,  0xf9, 0x38, 0xb7, 0x8b, 0xf0, 0xb5,
                           0xce, 0xdf, 0x2f, 0xac, 0x68, 0x80, 0x37, 0xa0, 0xfe, 0xb2, 0xa2, 0xfa, 0x93, 0xb3, 0xe2};
  uint8_t bytesprops7[] = {0x86, 0x23, 0xa3, 0xa0, 0x52, 0x32, 0x84, 0x35, 0xb0,
                           0x34, 0xfa, 0x81, 0xc0, 0x5a, 0xe1, 0x8f, 0x2b};
  uint8_t bytesprops8[] = {0xc8, 0xe0};
  uint8_t bytesprops9[] = {0xcc, 0x84, 0x8f, 0xe2, 0x7c, 0x87, 0x7e, 0xf0, 0xab, 0x54, 0xbc, 0xf1,
                           0x2d, 0x50, 0x93, 0xdb, 0x60, 0xeb, 0xb2, 0xb,  0x69, 0xe1, 0x8e};
  uint8_t bytesprops10[] = {0xa0, 0x9a, 0xf8, 0xc7, 0x2c, 0xbe, 0x3,  0x5a, 0x1a, 0x26,
                            0x53, 0x4d, 0xf0, 0x28, 0xdc, 0xf4, 0x51, 0x81, 0x3a, 0x1a};
  uint8_t bytesprops11[] = {0xbd, 0xb7, 0xb2, 0x9c, 0x14, 0x7f, 0xc4, 0x77, 0xd0, 0x9a, 0x63, 0xe7, 0x7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18477}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13687}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17592}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23985}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16607}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11289}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25765}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 588}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9192}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 160, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoImplementationSpecificError [PropSessionExpiryInterval 15056,PropSharedSubscriptionAvailable
// 72,PropResponseTopic "\129\DC3E",PropTopicAlias 16377,PropResponseInformation
// "\162\159C1O\159\168\197\NAK\157\179",PropSharedSubscriptionAvailable 106,PropMaximumQoS 44,PropTopicAlias
// 9466,PropRequestProblemInformation 78,PropRequestResponseInformation 138,PropSessionExpiryInterval
// 29538,PropRetainAvailable 222]
TEST(Disco5QCTest, Encode2) {
  uint8_t pkt[] = {0xe0, 0x32, 0x83, 0x30, 0x11, 0x0,  0x0,  0x3a, 0xd0, 0x2a, 0x48, 0x8,  0x0,
                   0x3,  0x81, 0x13, 0x45, 0x23, 0x3f, 0xf9, 0x1a, 0x0,  0xb,  0xa2, 0x9f, 0x43,
                   0x31, 0x4f, 0x9f, 0xa8, 0xc5, 0x15, 0x9d, 0xb3, 0x2a, 0x6a, 0x24, 0x2c, 0x23,
                   0x24, 0xfa, 0x17, 0x4e, 0x19, 0x8a, 0x11, 0x0,  0x0,  0x73, 0x62, 0x25, 0xde};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x81, 0x13, 0x45};
  uint8_t bytesprops1[] = {0xa2, 0x9f, 0x43, 0x31, 0x4f, 0x9f, 0xa8, 0xc5, 0x15, 0x9d, 0xb3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15056}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16377}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9466}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29538}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 222}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 131, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoUnspecifiedError [PropTopicAlias 13294,PropReasonString
// "\180\NAK\228\238h0\185s\254\DC1\136|-p\137]\137V\202\ACK6\SUB",PropServerKeepAlive 6998,PropSubscriptionIdentifier
// 2,PropWildcardSubscriptionAvailable 103,PropRequestResponseInformation 135,PropTopicAlias
// 22266,PropSubscriptionIdentifier 23,PropAuthenticationMethod "\140v\220%",PropMaximumQoS 167,PropAuthenticationMethod
// "\215\188/^\198\ESC\SI\DLE\163\156|",PropPayloadFormatIndicator 40,PropRequestResponseInformation
// 128,PropPayloadFormatIndicator 230,PropResponseTopic "_\174n\DLE\213s
// g\159\187\202\STX\\U0%\vqa\190\192",PropSessionExpiryInterval 3575,PropRequestProblemInformation
// 70,PropCorrelationData "\161(0\170 \a\188\168",PropRequestResponseInformation 248,PropAuthenticationData
// "\r\217{\205-\242T\152z\DC2\173*F\153\145\141\128\236H\n\154\186\227\254\&7",PropMessageExpiryInterval
// 23847,PropRequestResponseInformation 58]
TEST(Disco5QCTest, Encode3) {
  uint8_t pkt[] = {0xe0, 0x99, 0x1,  0x80, 0x96, 0x1,  0x23, 0x33, 0xee, 0x1f, 0x0,  0x16, 0xb4, 0x15, 0xe4, 0xee,
                   0x68, 0x30, 0xb9, 0x73, 0xfe, 0x11, 0x88, 0x7c, 0x2d, 0x70, 0x89, 0x5d, 0x89, 0x56, 0xca, 0x6,
                   0x36, 0x1a, 0x13, 0x1b, 0x56, 0xb,  0x2,  0x28, 0x67, 0x19, 0x87, 0x23, 0x56, 0xfa, 0xb,  0x17,
                   0x15, 0x0,  0x4,  0x8c, 0x76, 0xdc, 0x25, 0x24, 0xa7, 0x15, 0x0,  0xb,  0xd7, 0xbc, 0x2f, 0x5e,
                   0xc6, 0x1b, 0xf,  0x10, 0xa3, 0x9c, 0x7c, 0x1,  0x28, 0x19, 0x80, 0x1,  0xe6, 0x8,  0x0,  0x15,
                   0x5f, 0xae, 0x6e, 0x10, 0xd5, 0x73, 0x20, 0x67, 0x9f, 0xbb, 0xca, 0x2,  0x5c, 0x55, 0x30, 0x25,
                   0xb,  0x71, 0x61, 0xbe, 0xc0, 0x11, 0x0,  0x0,  0xd,  0xf7, 0x17, 0x46, 0x9,  0x0,  0x8,  0xa1,
                   0x28, 0x30, 0xaa, 0x20, 0x7,  0xbc, 0xa8, 0x19, 0xf8, 0x16, 0x0,  0x19, 0xd,  0xd9, 0x7b, 0xcd,
                   0x2d, 0xf2, 0x54, 0x98, 0x7a, 0x12, 0xad, 0x2a, 0x46, 0x99, 0x91, 0x8d, 0x80, 0xec, 0x48, 0xa,
                   0x9a, 0xba, 0xe3, 0xfe, 0x37, 0x2,  0x0,  0x0,  0x5d, 0x27, 0x19, 0x3a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb4, 0x15, 0xe4, 0xee, 0x68, 0x30, 0xb9, 0x73, 0xfe, 0x11, 0x88,
                           0x7c, 0x2d, 0x70, 0x89, 0x5d, 0x89, 0x56, 0xca, 0x6,  0x36, 0x1a};
  uint8_t bytesprops1[] = {0x8c, 0x76, 0xdc, 0x25};
  uint8_t bytesprops2[] = {0xd7, 0xbc, 0x2f, 0x5e, 0xc6, 0x1b, 0xf, 0x10, 0xa3, 0x9c, 0x7c};
  uint8_t bytesprops3[] = {0x5f, 0xae, 0x6e, 0x10, 0xd5, 0x73, 0x20, 0x67, 0x9f, 0xbb, 0xca,
                           0x2,  0x5c, 0x55, 0x30, 0x25, 0xb,  0x71, 0x61, 0xbe, 0xc0};
  uint8_t bytesprops4[] = {0xa1, 0x28, 0x30, 0xaa, 0x20, 0x7, 0xbc, 0xa8};
  uint8_t bytesprops5[] = {0xd,  0xd9, 0x7b, 0xcd, 0x2d, 0xf2, 0x54, 0x98, 0x7a, 0x12, 0xad, 0x2a, 0x46,
                           0x99, 0x91, 0x8d, 0x80, 0xec, 0x48, 0xa,  0x9a, 0xba, 0xe3, 0xfe, 0x37};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13294}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6998}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 2}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22266}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3575}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23847}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 58}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 128, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoQuotaExceeded [PropRequestProblemInformation 118,PropUserProperty
// "`\145\189\145\220\130\179\213\162.'R`\153\218;\"K\214F5\245\218\204\200"
// "\150\207\255\&3s\167$*\235\ESC1",PropRetainAvailable 231,PropServerKeepAlive 22671,PropAuthenticationMethod
// "}>K:\143^\216\147\&3dt\212\SOHL",PropTopicAliasMaximum 28734,PropWillDelayInterval 19849,PropResponseTopic
// "\213\164\166B`\157\168\v\236\142~\255",PropUserProperty "1[L\181\174\152\186\STX\186X\175\140 \212\133<"
// "N\STX=\208",PropServerKeepAlive 5878,PropUserProperty
// "\181\210}X\ETB\201|\ETBP\243\NUL.9\233\215\DC3\RS\222\n\161\171" "\180*5\133L\247\237|]",PropMaximumQoS
// 98,PropCorrelationData "^\176\EMIG\188",PropResponseInformation
// "al\134|\237\250Q\157g\235jO\148\234\239`\201-\143oa\198\253|\155\221\&3\128\214^",PropMessageExpiryInterval
// 26521,PropUserProperty "\161\EMz\207u\DC2;\130\197A\ACKvf3o\178\228#K"
// "\214\163:\242\245\216\147y\253A\223\RSQAXx\DC1",PropMaximumPacketSize 17250]
TEST(Disco5QCTest, Encode4) {
  uint8_t pkt[] = {0xe0, 0xf9, 0x1,  0x97, 0xf6, 0x1,  0x17, 0x76, 0x26, 0x0,  0x19, 0x60, 0x91, 0xbd, 0x91, 0xdc, 0x82,
                   0xb3, 0xd5, 0xa2, 0x2e, 0x27, 0x52, 0x60, 0x99, 0xda, 0x3b, 0x22, 0x4b, 0xd6, 0x46, 0x35, 0xf5, 0xda,
                   0xcc, 0xc8, 0x0,  0xb,  0x96, 0xcf, 0xff, 0x33, 0x73, 0xa7, 0x24, 0x2a, 0xeb, 0x1b, 0x31, 0x25, 0xe7,
                   0x13, 0x58, 0x8f, 0x15, 0x0,  0xe,  0x7d, 0x3e, 0x4b, 0x3a, 0x8f, 0x5e, 0xd8, 0x93, 0x33, 0x64, 0x74,
                   0xd4, 0x1,  0x4c, 0x22, 0x70, 0x3e, 0x18, 0x0,  0x0,  0x4d, 0x89, 0x8,  0x0,  0xc,  0xd5, 0xa4, 0xa6,
                   0x42, 0x60, 0x9d, 0xa8, 0xb,  0xec, 0x8e, 0x7e, 0xff, 0x26, 0x0,  0x10, 0x31, 0x5b, 0x4c, 0xb5, 0xae,
                   0x98, 0xba, 0x2,  0xba, 0x58, 0xaf, 0x8c, 0x20, 0xd4, 0x85, 0x3c, 0x0,  0x4,  0x4e, 0x2,  0x3d, 0xd0,
                   0x13, 0x16, 0xf6, 0x26, 0x0,  0x15, 0xb5, 0xd2, 0x7d, 0x58, 0x17, 0xc9, 0x7c, 0x17, 0x50, 0xf3, 0x0,
                   0x2e, 0x39, 0xe9, 0xd7, 0x13, 0x1e, 0xde, 0xa,  0xa1, 0xab, 0x0,  0x9,  0xb4, 0x2a, 0x35, 0x85, 0x4c,
                   0xf7, 0xed, 0x7c, 0x5d, 0x24, 0x62, 0x9,  0x0,  0x6,  0x5e, 0xb0, 0x19, 0x49, 0x47, 0xbc, 0x1a, 0x0,
                   0x1e, 0x61, 0x6c, 0x86, 0x7c, 0xed, 0xfa, 0x51, 0x9d, 0x67, 0xeb, 0x6a, 0x4f, 0x94, 0xea, 0xef, 0x60,
                   0xc9, 0x2d, 0x8f, 0x6f, 0x61, 0xc6, 0xfd, 0x7c, 0x9b, 0xdd, 0x33, 0x80, 0xd6, 0x5e, 0x2,  0x0,  0x0,
                   0x67, 0x99, 0x26, 0x0,  0x13, 0xa1, 0x19, 0x7a, 0xcf, 0x75, 0x12, 0x3b, 0x82, 0xc5, 0x41, 0x6,  0x76,
                   0x66, 0x33, 0x6f, 0xb2, 0xe4, 0x23, 0x4b, 0x0,  0x11, 0xd6, 0xa3, 0x3a, 0xf2, 0xf5, 0xd8, 0x93, 0x79,
                   0xfd, 0x41, 0xdf, 0x1e, 0x51, 0x41, 0x58, 0x78, 0x11, 0x27, 0x0,  0x0,  0x43, 0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x96, 0xcf, 0xff, 0x33, 0x73, 0xa7, 0x24, 0x2a, 0xeb, 0x1b, 0x31};
  uint8_t bytesprops0[] = {0x60, 0x91, 0xbd, 0x91, 0xdc, 0x82, 0xb3, 0xd5, 0xa2, 0x2e, 0x27, 0x52, 0x60,
                           0x99, 0xda, 0x3b, 0x22, 0x4b, 0xd6, 0x46, 0x35, 0xf5, 0xda, 0xcc, 0xc8};
  uint8_t bytesprops2[] = {0x7d, 0x3e, 0x4b, 0x3a, 0x8f, 0x5e, 0xd8, 0x93, 0x33, 0x64, 0x74, 0xd4, 0x1, 0x4c};
  uint8_t bytesprops3[] = {0xd5, 0xa4, 0xa6, 0x42, 0x60, 0x9d, 0xa8, 0xb, 0xec, 0x8e, 0x7e, 0xff};
  uint8_t bytesprops5[] = {0x4e, 0x2, 0x3d, 0xd0};
  uint8_t bytesprops4[] = {0x31, 0x5b, 0x4c, 0xb5, 0xae, 0x98, 0xba, 0x2,
                           0xba, 0x58, 0xaf, 0x8c, 0x20, 0xd4, 0x85, 0x3c};
  uint8_t bytesprops7[] = {0xb4, 0x2a, 0x35, 0x85, 0x4c, 0xf7, 0xed, 0x7c, 0x5d};
  uint8_t bytesprops6[] = {0xb5, 0xd2, 0x7d, 0x58, 0x17, 0xc9, 0x7c, 0x17, 0x50, 0xf3, 0x0,
                           0x2e, 0x39, 0xe9, 0xd7, 0x13, 0x1e, 0xde, 0xa,  0xa1, 0xab};
  uint8_t bytesprops8[] = {0x5e, 0xb0, 0x19, 0x49, 0x47, 0xbc};
  uint8_t bytesprops9[] = {0x61, 0x6c, 0x86, 0x7c, 0xed, 0xfa, 0x51, 0x9d, 0x67, 0xeb, 0x6a, 0x4f, 0x94, 0xea, 0xef,
                           0x60, 0xc9, 0x2d, 0x8f, 0x6f, 0x61, 0xc6, 0xfd, 0x7c, 0x9b, 0xdd, 0x33, 0x80, 0xd6, 0x5e};
  uint8_t bytesprops11[] = {0xd6, 0xa3, 0x3a, 0xf2, 0xf5, 0xd8, 0x93, 0x79, 0xfd,
                            0x41, 0xdf, 0x1e, 0x51, 0x41, 0x58, 0x78, 0x11};
  uint8_t bytesprops10[] = {0xa1, 0x19, 0x7a, 0xcf, 0x75, 0x12, 0x3b, 0x82, 0xc5, 0x41,
                            0x6,  0x76, 0x66, 0x33, 0x6f, 0xb2, 0xe4, 0x23, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops0}, .v = {11, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22671}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28734}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19849}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops4}, .v = {4, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5878}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops6}, .v = {9, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26521}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {19, (char*)&bytesprops10}, .v = {17, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17250}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 151, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServerBusy [PropReceiveMaximum 10661,PropWillDelayInterval 20242,PropAuthenticationMethod
// "\196e\DC2\241?\196D\245U",PropRequestResponseInformation 216,PropWillDelayInterval 4157,PropWillDelayInterval
// 32170,PropContentType "\211\"\138d\157g\225\t\202<\214\164",PropReasonString
// "AL+_\170",PropRequestResponseInformation 236,PropWillDelayInterval 7295,PropAuthenticationMethod
// "Np\254\214C\248\f\209",PropMaximumPacketSize 17116,PropAuthenticationMethod
// "D*\209W\233\253\186\&0~\208\185\147\195\133\163;\218\t\180\172\158\128(",PropRequestResponseInformation
// 91,PropMaximumQoS 177,PropTopicAliasMaximum 29607,PropRetainAvailable 79,PropSharedSubscriptionAvailable
// 194,PropMaximumPacketSize 4393,PropRetainAvailable 94,PropMaximumPacketSize 11798,PropResponseTopic
// "\154\205\233\153\235m\219\DLEJ8icp\RS43\187\243X\143\231\239\217\201\226\248\175\b0\254",PropRequestResponseInformation
// 161,PropMaximumPacketSize 24013,PropPayloadFormatIndicator 6,PropCorrelationData
// "\214\CAN\232\178\221\&8\138/y\251\236\137\225\&0D\f\156X\nQ\201IuU\STXU\t\143",PropSessionExpiryInterval
// 17417,PropWildcardSubscriptionAvailable 30,PropAssignedClientIdentifier "d\SYN\EM
// G\142\DLE\227\DC4i9\172\153\FS^].(\233\142\187p*d",PropMaximumPacketSize 6745]
TEST(Disco5QCTest, Encode5) {
  uint8_t pkt[] = {
      0xe0, 0xf2, 0x1,  0x89, 0xef, 0x1,  0x21, 0x29, 0xa5, 0x18, 0x0,  0x0,  0x4f, 0x12, 0x15, 0x0,  0x9,  0xc4, 0x65,
      0x12, 0xf1, 0x3f, 0xc4, 0x44, 0xf5, 0x55, 0x19, 0xd8, 0x18, 0x0,  0x0,  0x10, 0x3d, 0x18, 0x0,  0x0,  0x7d, 0xaa,
      0x3,  0x0,  0xc,  0xd3, 0x22, 0x8a, 0x64, 0x9d, 0x67, 0xe1, 0x9,  0xca, 0x3c, 0xd6, 0xa4, 0x1f, 0x0,  0x5,  0x41,
      0x4c, 0x2b, 0x5f, 0xaa, 0x19, 0xec, 0x18, 0x0,  0x0,  0x1c, 0x7f, 0x15, 0x0,  0x8,  0x4e, 0x70, 0xfe, 0xd6, 0x43,
      0xf8, 0xc,  0xd1, 0x27, 0x0,  0x0,  0x42, 0xdc, 0x15, 0x0,  0x17, 0x44, 0x2a, 0xd1, 0x57, 0xe9, 0xfd, 0xba, 0x30,
      0x7e, 0xd0, 0xb9, 0x93, 0xc3, 0x85, 0xa3, 0x3b, 0xda, 0x9,  0xb4, 0xac, 0x9e, 0x80, 0x28, 0x19, 0x5b, 0x24, 0xb1,
      0x22, 0x73, 0xa7, 0x25, 0x4f, 0x2a, 0xc2, 0x27, 0x0,  0x0,  0x11, 0x29, 0x25, 0x5e, 0x27, 0x0,  0x0,  0x2e, 0x16,
      0x8,  0x0,  0x1e, 0x9a, 0xcd, 0xe9, 0x99, 0xeb, 0x6d, 0xdb, 0x10, 0x4a, 0x38, 0x69, 0x63, 0x70, 0x1e, 0x34, 0x33,
      0xbb, 0xf3, 0x58, 0x8f, 0xe7, 0xef, 0xd9, 0xc9, 0xe2, 0xf8, 0xaf, 0x8,  0x30, 0xfe, 0x19, 0xa1, 0x27, 0x0,  0x0,
      0x5d, 0xcd, 0x1,  0x6,  0x9,  0x0,  0x1c, 0xd6, 0x18, 0xe8, 0xb2, 0xdd, 0x38, 0x8a, 0x2f, 0x79, 0xfb, 0xec, 0x89,
      0xe1, 0x30, 0x44, 0xc,  0x9c, 0x58, 0xa,  0x51, 0xc9, 0x49, 0x75, 0x55, 0x2,  0x55, 0x9,  0x8f, 0x11, 0x0,  0x0,
      0x44, 0x9,  0x28, 0x1e, 0x12, 0x0,  0x18, 0x64, 0x16, 0x19, 0x20, 0x47, 0x8e, 0x10, 0xe3, 0x14, 0x69, 0x39, 0xac,
      0x99, 0x1c, 0x5e, 0x5d, 0x2e, 0x28, 0xe9, 0x8e, 0xbb, 0x70, 0x2a, 0x64, 0x27, 0x0,  0x0,  0x1a, 0x59};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc4, 0x65, 0x12, 0xf1, 0x3f, 0xc4, 0x44, 0xf5, 0x55};
  uint8_t bytesprops1[] = {0xd3, 0x22, 0x8a, 0x64, 0x9d, 0x67, 0xe1, 0x9, 0xca, 0x3c, 0xd6, 0xa4};
  uint8_t bytesprops2[] = {0x41, 0x4c, 0x2b, 0x5f, 0xaa};
  uint8_t bytesprops3[] = {0x4e, 0x70, 0xfe, 0xd6, 0x43, 0xf8, 0xc, 0xd1};
  uint8_t bytesprops4[] = {0x44, 0x2a, 0xd1, 0x57, 0xe9, 0xfd, 0xba, 0x30, 0x7e, 0xd0, 0xb9, 0x93,
                           0xc3, 0x85, 0xa3, 0x3b, 0xda, 0x9,  0xb4, 0xac, 0x9e, 0x80, 0x28};
  uint8_t bytesprops5[] = {0x9a, 0xcd, 0xe9, 0x99, 0xeb, 0x6d, 0xdb, 0x10, 0x4a, 0x38, 0x69, 0x63, 0x70, 0x1e, 0x34,
                           0x33, 0xbb, 0xf3, 0x58, 0x8f, 0xe7, 0xef, 0xd9, 0xc9, 0xe2, 0xf8, 0xaf, 0x8,  0x30, 0xfe};
  uint8_t bytesprops6[] = {0xd6, 0x18, 0xe8, 0xb2, 0xdd, 0x38, 0x8a, 0x2f, 0x79, 0xfb, 0xec, 0x89, 0xe1, 0x30,
                           0x44, 0xc,  0x9c, 0x58, 0xa,  0x51, 0xc9, 0x49, 0x75, 0x55, 0x2,  0x55, 0x9,  0x8f};
  uint8_t bytesprops7[] = {0x64, 0x16, 0x19, 0x20, 0x47, 0x8e, 0x10, 0xe3, 0x14, 0x69, 0x39, 0xac,
                           0x99, 0x1c, 0x5e, 0x5d, 0x2e, 0x28, 0xe9, 0x8e, 0xbb, 0x70, 0x2a, 0x64};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10661}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20242}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4157}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32170}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7295}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17116}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29607}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4393}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11798}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24013}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17417}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6745}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 137, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSessiontakenOver [PropMessageExpiryInterval 31530,PropTopicAliasMaximum
// 20641,PropRequestProblemInformation 28,PropRetainAvailable 154,PropSubscriptionIdentifier 22,PropResponseTopic
// "\164$\241\130a\243",PropWildcardSubscriptionAvailable 222,PropCorrelationData "\147\197",PropPayloadFormatIndicator
// 149,PropWildcardSubscriptionAvailable 246,PropSharedSubscriptionAvailable 80,PropRequestProblemInformation
// 82,PropWillDelayInterval 24431,PropCorrelationData
// "M\185rj\222\SOH\NULb\140\166\153\231\181|\231\185\248\DC3{j\DC1\152\153\167\230",PropWillDelayInterval
// 5082,PropRequestResponseInformation 164,PropServerReference
// "\ETX\201pk\210pG\217\168\158\254\190\STX>\152\201Dj\231\&6\252yc",PropCorrelationData
// "xO\163\135\225\212z\220\150",PropServerReference "h\r\189\RS2\138\240\DLE",PropAuthenticationMethod
// "4\a\177\144\190@\162\190\147\&8\226:&\176\206\187",PropWillDelayInterval 16727,PropSessionExpiryInterval
// 30740,PropPayloadFormatIndicator 54]
TEST(Disco5QCTest, Encode6) {
  uint8_t pkt[] = {0xe0, 0xa1, 0x1,  0x8e, 0x9e, 0x1,  0x2,  0x0,  0x0,  0x7b, 0x2a, 0x22, 0x50, 0xa1, 0x17, 0x1c, 0x25,
                   0x9a, 0xb,  0x16, 0x8,  0x0,  0x6,  0xa4, 0x24, 0xf1, 0x82, 0x61, 0xf3, 0x28, 0xde, 0x9,  0x0,  0x2,
                   0x93, 0xc5, 0x1,  0x95, 0x28, 0xf6, 0x2a, 0x50, 0x17, 0x52, 0x18, 0x0,  0x0,  0x5f, 0x6f, 0x9,  0x0,
                   0x19, 0x4d, 0xb9, 0x72, 0x6a, 0xde, 0x1,  0x0,  0x62, 0x8c, 0xa6, 0x99, 0xe7, 0xb5, 0x7c, 0xe7, 0xb9,
                   0xf8, 0x13, 0x7b, 0x6a, 0x11, 0x98, 0x99, 0xa7, 0xe6, 0x18, 0x0,  0x0,  0x13, 0xda, 0x19, 0xa4, 0x1c,
                   0x0,  0x17, 0x3,  0xc9, 0x70, 0x6b, 0xd2, 0x70, 0x47, 0xd9, 0xa8, 0x9e, 0xfe, 0xbe, 0x2,  0x3e, 0x98,
                   0xc9, 0x44, 0x6a, 0xe7, 0x36, 0xfc, 0x79, 0x63, 0x9,  0x0,  0x9,  0x78, 0x4f, 0xa3, 0x87, 0xe1, 0xd4,
                   0x7a, 0xdc, 0x96, 0x1c, 0x0,  0x8,  0x68, 0xd,  0xbd, 0x1e, 0x32, 0x8a, 0xf0, 0x10, 0x15, 0x0,  0x10,
                   0x34, 0x7,  0xb1, 0x90, 0xbe, 0x40, 0xa2, 0xbe, 0x93, 0x38, 0xe2, 0x3a, 0x26, 0xb0, 0xce, 0xbb, 0x18,
                   0x0,  0x0,  0x41, 0x57, 0x11, 0x0,  0x0,  0x78, 0x14, 0x1,  0x36};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa4, 0x24, 0xf1, 0x82, 0x61, 0xf3};
  uint8_t bytesprops1[] = {0x93, 0xc5};
  uint8_t bytesprops2[] = {0x4d, 0xb9, 0x72, 0x6a, 0xde, 0x1,  0x0,  0x62, 0x8c, 0xa6, 0x99, 0xe7, 0xb5,
                           0x7c, 0xe7, 0xb9, 0xf8, 0x13, 0x7b, 0x6a, 0x11, 0x98, 0x99, 0xa7, 0xe6};
  uint8_t bytesprops3[] = {0x3, 0xc9, 0x70, 0x6b, 0xd2, 0x70, 0x47, 0xd9, 0xa8, 0x9e, 0xfe, 0xbe,
                           0x2, 0x3e, 0x98, 0xc9, 0x44, 0x6a, 0xe7, 0x36, 0xfc, 0x79, 0x63};
  uint8_t bytesprops4[] = {0x78, 0x4f, 0xa3, 0x87, 0xe1, 0xd4, 0x7a, 0xdc, 0x96};
  uint8_t bytesprops5[] = {0x68, 0xd, 0xbd, 0x1e, 0x32, 0x8a, 0xf0, 0x10};
  uint8_t bytesprops6[] = {0x34, 0x7,  0xb1, 0x90, 0xbe, 0x40, 0xa2, 0xbe,
                           0x93, 0x38, 0xe2, 0x3a, 0x26, 0xb0, 0xce, 0xbb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31530}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20641}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24431}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5082}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16727}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30740}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 54}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 142, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNotAuthorized [PropRequestResponseInformation 223,PropPayloadFormatIndicator
// 46,PropWillDelayInterval 3656,PropSubscriptionIdentifier 17,PropServerReference
// "\130\186?~>",PropSessionExpiryInterval 18554,PropContentType "",PropResponseInformation
// "\189.\DLE[\184\217Y\129b\144OW'\137i?\166~\216X'$\228",PropAssignedClientIdentifier
// "0\171\ETXf\229\161p\DC1-\227\146\181\178\132\223<\232+\207\160\182\176\190\&6\231K\132",PropServerKeepAlive
// 4852,PropServerKeepAlive 29505,PropTopicAliasMaximum 4105,PropMessageExpiryInterval 24745]
TEST(Disco5QCTest, Encode7) {
  uint8_t pkt[] = {0xe0, 0x63, 0x87, 0x61, 0x19, 0xdf, 0x1,  0x2e, 0x18, 0x0,  0x0,  0xe,  0x48, 0xb,  0x11, 0x1c, 0x0,
                   0x5,  0x82, 0xba, 0x3f, 0x7e, 0x3e, 0x11, 0x0,  0x0,  0x48, 0x7a, 0x3,  0x0,  0x0,  0x1a, 0x0,  0x17,
                   0xbd, 0x2e, 0x10, 0x5b, 0xb8, 0xd9, 0x59, 0x81, 0x62, 0x90, 0x4f, 0x57, 0x27, 0x89, 0x69, 0x3f, 0xa6,
                   0x7e, 0xd8, 0x58, 0x27, 0x24, 0xe4, 0x12, 0x0,  0x1b, 0x30, 0xab, 0x3,  0x66, 0xe5, 0xa1, 0x70, 0x11,
                   0x2d, 0xe3, 0x92, 0xb5, 0xb2, 0x84, 0xdf, 0x3c, 0xe8, 0x2b, 0xcf, 0xa0, 0xb6, 0xb0, 0xbe, 0x36, 0xe7,
                   0x4b, 0x84, 0x13, 0x12, 0xf4, 0x13, 0x73, 0x41, 0x22, 0x10, 0x9,  0x2,  0x0,  0x0,  0x60, 0xa9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x82, 0xba, 0x3f, 0x7e, 0x3e};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0xbd, 0x2e, 0x10, 0x5b, 0xb8, 0xd9, 0x59, 0x81, 0x62, 0x90, 0x4f, 0x57,
                           0x27, 0x89, 0x69, 0x3f, 0xa6, 0x7e, 0xd8, 0x58, 0x27, 0x24, 0xe4};
  uint8_t bytesprops3[] = {0x30, 0xab, 0x3,  0x66, 0xe5, 0xa1, 0x70, 0x11, 0x2d, 0xe3, 0x92, 0xb5, 0xb2, 0x84,
                           0xdf, 0x3c, 0xe8, 0x2b, 0xcf, 0xa0, 0xb6, 0xb0, 0xbe, 0x36, 0xe7, 0x4b, 0x84};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3656}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18554}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4852}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29505}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4105}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24745}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 135, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoDisconnectWithWill [PropRequestResponseInformation 209,PropMaximumPacketSize
// 3936,PropSharedSubscriptionAvailable 137,PropWildcardSubscriptionAvailable 244,PropRequestResponseInformation
// 55,PropReceiveMaximum 25352,PropTopicAlias 28418,PropReceiveMaximum 11027,PropCorrelationData
// "3@\ac\EM\249",PropSubscriptionIdentifier 10,PropResponseTopic
// "\148\203\180\141Y'\192\226\DC1\n\CAN\254\237-\233d\159\241#\168NH\216/\229:",PropWillDelayInterval
// 1927,PropSessionExpiryInterval 11473,PropRequestResponseInformation 40,PropAssignedClientIdentifier "\192Y;
// A\v\169\190\203\187*\192\193W\210<\212j&H\241\143\151!\231\148\DC2\214\142",PropPayloadFormatIndicator
// 186,PropCorrelationData "o\200\210\164\229P\206\224~\ETX",PropReasonString "\149\&7X<\174I
// \DC2\GS\178\196\206s\140h`\211o"]
TEST(Disco5QCTest, Encode8) {
  uint8_t pkt[] = {0xe0, 0x91, 0x1,  0x4,  0x8e, 0x1,  0x19, 0xd1, 0x27, 0x0,  0x0,  0xf,  0x60, 0x2a, 0x89, 0x28, 0xf4,
                   0x19, 0x37, 0x21, 0x63, 0x8,  0x23, 0x6f, 0x2,  0x21, 0x2b, 0x13, 0x9,  0x0,  0x6,  0x33, 0x40, 0x7,
                   0x63, 0x19, 0xf9, 0xb,  0xa,  0x8,  0x0,  0x1a, 0x94, 0xcb, 0xb4, 0x8d, 0x59, 0x27, 0xc0, 0xe2, 0x11,
                   0xa,  0x18, 0xfe, 0xed, 0x2d, 0xe9, 0x64, 0x9f, 0xf1, 0x23, 0xa8, 0x4e, 0x48, 0xd8, 0x2f, 0xe5, 0x3a,
                   0x18, 0x0,  0x0,  0x7,  0x87, 0x11, 0x0,  0x0,  0x2c, 0xd1, 0x19, 0x28, 0x12, 0x0,  0x1d, 0xc0, 0x59,
                   0x3b, 0x20, 0x41, 0xb,  0xa9, 0xbe, 0xcb, 0xbb, 0x2a, 0xc0, 0xc1, 0x57, 0xd2, 0x3c, 0xd4, 0x6a, 0x26,
                   0x48, 0xf1, 0x8f, 0x97, 0x21, 0xe7, 0x94, 0x12, 0xd6, 0x8e, 0x1,  0xba, 0x9,  0x0,  0xa,  0x6f, 0xc8,
                   0xd2, 0xa4, 0xe5, 0x50, 0xce, 0xe0, 0x7e, 0x3,  0x1f, 0x0,  0x12, 0x95, 0x37, 0x58, 0x3c, 0xae, 0x49,
                   0x20, 0x12, 0x1d, 0xb2, 0xc4, 0xce, 0x73, 0x8c, 0x68, 0x60, 0xd3, 0x6f};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x33, 0x40, 0x7, 0x63, 0x19, 0xf9};
  uint8_t bytesprops1[] = {0x94, 0xcb, 0xb4, 0x8d, 0x59, 0x27, 0xc0, 0xe2, 0x11, 0xa,  0x18, 0xfe, 0xed,
                           0x2d, 0xe9, 0x64, 0x9f, 0xf1, 0x23, 0xa8, 0x4e, 0x48, 0xd8, 0x2f, 0xe5, 0x3a};
  uint8_t bytesprops2[] = {0xc0, 0x59, 0x3b, 0x20, 0x41, 0xb,  0xa9, 0xbe, 0xcb, 0xbb, 0x2a, 0xc0, 0xc1, 0x57, 0xd2,
                           0x3c, 0xd4, 0x6a, 0x26, 0x48, 0xf1, 0x8f, 0x97, 0x21, 0xe7, 0x94, 0x12, 0xd6, 0x8e};
  uint8_t bytesprops3[] = {0x6f, 0xc8, 0xd2, 0xa4, 0xe5, 0x50, 0xce, 0xe0, 0x7e, 0x3};
  uint8_t bytesprops4[] = {0x95, 0x37, 0x58, 0x3c, 0xae, 0x49, 0x20, 0x12, 0x1d,
                           0xb2, 0xc4, 0xce, 0x73, 0x8c, 0x68, 0x60, 0xd3, 0x6f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3936}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25352}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28418}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11027}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1927}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11473}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection [PropCorrelationData
// "+\199\231\205\129\214\129\220&\240\t\159\DC1N\GSG",PropTopicAlias 21761,PropTopicAlias 11810,PropWillDelayInterval
// 27354,PropAssignedClientIdentifier "\196\238\195\222{z\184\195\200\199_",PropContentType
// "s\241@%\233\216\129\213\246\&9\161)\193\ETB\EOT\149",PropTopicAlias 31127,PropReasonString
// "g*\SUB\214\218\230\"\135\FS\162X\ENQ",PropTopicAliasMaximum 2689,PropMaximumPacketSize
// 16049,PropSubscriptionIdentifier 23,PropSessionExpiryInterval 21820,PropCorrelationData
// "\213\225\173\213\ENQ\141@V\SYN\165\250`",PropServerKeepAlive 9762,PropWillDelayInterval 30730,PropMaximumPacketSize
// 23599,PropMaximumPacketSize 15159,PropServerReference "\v\187",PropReasonString
// "1\r\187\SUB\175U\DC3r}}\ACK\213\GS\248\189\129\193\236gcd\221\156'\132",PropAuthenticationData
// "\144\201\237P\232\211\221b\ESC,\242",PropSubscriptionIdentifier 23,PropRequestProblemInformation
// 95,PropCorrelationData "\170\&3s\225\220\144\223+\ENQ",PropAuthenticationData "~\181\246{\249"]
TEST(Disco5QCTest, Encode9) {
  uint8_t pkt[] = {
      0xe0, 0xcb, 0x1,  0x0,  0xc8, 0x1,  0x9,  0x0,  0x10, 0x2b, 0xc7, 0xe7, 0xcd, 0x81, 0xd6, 0x81, 0xdc, 0x26, 0xf0,
      0x9,  0x9f, 0x11, 0x4e, 0x1d, 0x47, 0x23, 0x55, 0x1,  0x23, 0x2e, 0x22, 0x18, 0x0,  0x0,  0x6a, 0xda, 0x12, 0x0,
      0xb,  0xc4, 0xee, 0xc3, 0xde, 0x7b, 0x7a, 0xb8, 0xc3, 0xc8, 0xc7, 0x5f, 0x3,  0x0,  0x10, 0x73, 0xf1, 0x40, 0x25,
      0xe9, 0xd8, 0x81, 0xd5, 0xf6, 0x39, 0xa1, 0x29, 0xc1, 0x17, 0x4,  0x95, 0x23, 0x79, 0x97, 0x1f, 0x0,  0xc,  0x67,
      0x2a, 0x1a, 0xd6, 0xda, 0xe6, 0x22, 0x87, 0x1c, 0xa2, 0x58, 0x5,  0x22, 0xa,  0x81, 0x27, 0x0,  0x0,  0x3e, 0xb1,
      0xb,  0x17, 0x11, 0x0,  0x0,  0x55, 0x3c, 0x9,  0x0,  0xc,  0xd5, 0xe1, 0xad, 0xd5, 0x5,  0x8d, 0x40, 0x56, 0x16,
      0xa5, 0xfa, 0x60, 0x13, 0x26, 0x22, 0x18, 0x0,  0x0,  0x78, 0xa,  0x27, 0x0,  0x0,  0x5c, 0x2f, 0x27, 0x0,  0x0,
      0x3b, 0x37, 0x1c, 0x0,  0x2,  0xb,  0xbb, 0x1f, 0x0,  0x19, 0x31, 0xd,  0xbb, 0x1a, 0xaf, 0x55, 0x13, 0x72, 0x7d,
      0x7d, 0x6,  0xd5, 0x1d, 0xf8, 0xbd, 0x81, 0xc1, 0xec, 0x67, 0x63, 0x64, 0xdd, 0x9c, 0x27, 0x84, 0x16, 0x0,  0xb,
      0x90, 0xc9, 0xed, 0x50, 0xe8, 0xd3, 0xdd, 0x62, 0x1b, 0x2c, 0xf2, 0xb,  0x17, 0x17, 0x5f, 0x9,  0x0,  0x9,  0xaa,
      0x33, 0x73, 0xe1, 0xdc, 0x90, 0xdf, 0x2b, 0x5,  0x16, 0x0,  0x5,  0x7e, 0xb5, 0xf6, 0x7b, 0xf9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2b, 0xc7, 0xe7, 0xcd, 0x81, 0xd6, 0x81, 0xdc,
                           0x26, 0xf0, 0x9,  0x9f, 0x11, 0x4e, 0x1d, 0x47};
  uint8_t bytesprops1[] = {0xc4, 0xee, 0xc3, 0xde, 0x7b, 0x7a, 0xb8, 0xc3, 0xc8, 0xc7, 0x5f};
  uint8_t bytesprops2[] = {0x73, 0xf1, 0x40, 0x25, 0xe9, 0xd8, 0x81, 0xd5,
                           0xf6, 0x39, 0xa1, 0x29, 0xc1, 0x17, 0x4,  0x95};
  uint8_t bytesprops3[] = {0x67, 0x2a, 0x1a, 0xd6, 0xda, 0xe6, 0x22, 0x87, 0x1c, 0xa2, 0x58, 0x5};
  uint8_t bytesprops4[] = {0xd5, 0xe1, 0xad, 0xd5, 0x5, 0x8d, 0x40, 0x56, 0x16, 0xa5, 0xfa, 0x60};
  uint8_t bytesprops5[] = {0xb, 0xbb};
  uint8_t bytesprops6[] = {0x31, 0xd,  0xbb, 0x1a, 0xaf, 0x55, 0x13, 0x72, 0x7d, 0x7d, 0x6,  0xd5, 0x1d,
                           0xf8, 0xbd, 0x81, 0xc1, 0xec, 0x67, 0x63, 0x64, 0xdd, 0x9c, 0x27, 0x84};
  uint8_t bytesprops7[] = {0x90, 0xc9, 0xed, 0x50, 0xe8, 0xd3, 0xdd, 0x62, 0x1b, 0x2c, 0xf2};
  uint8_t bytesprops8[] = {0xaa, 0x33, 0x73, 0xe1, 0xdc, 0x90, 0xdf, 0x2b, 0x5};
  uint8_t bytesprops9[] = {0x7e, 0xb5, 0xf6, 0x7b, 0xf9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21761}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11810}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27354}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31127}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2689}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16049}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21820}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9762}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30730}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23599}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15159}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoWildcardSubscriptionsNotSupported [PropRequestProblemInformation 151,PropMaximumQoS
// 174,PropMaximumPacketSize 25264,PropServerKeepAlive 13824,PropSubscriptionIdentifier 30,PropPayloadFormatIndicator
// 105,PropWillDelayInterval 9111,PropResponseTopic "\232@:\241o\NAK<y{)1\173\226\128\207\173q(\198"]
TEST(Disco5QCTest, Encode10) {
  uint8_t pkt[] = {0xe0, 0x2d, 0xa2, 0x2b, 0x17, 0x97, 0x24, 0xae, 0x27, 0x0,  0x0,  0x62, 0xb0, 0x13, 0x36, 0x0,
                   0xb,  0x1e, 0x1,  0x69, 0x18, 0x0,  0x0,  0x23, 0x97, 0x8,  0x0,  0x13, 0xe8, 0x40, 0x3a, 0xf1,
                   0x6f, 0x15, 0x3c, 0x79, 0x7b, 0x29, 0x31, 0xad, 0xe2, 0x80, 0xcf, 0xad, 0x71, 0x28, 0xc6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe8, 0x40, 0x3a, 0xf1, 0x6f, 0x15, 0x3c, 0x79, 0x7b, 0x29,
                           0x31, 0xad, 0xe2, 0x80, 0xcf, 0xad, 0x71, 0x28, 0xc6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25264}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13824}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9111}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 162, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServershuttingDown [PropMessageExpiryInterval 25341,PropRetainAvailable 151,PropMaximumQoS
// 96,PropAssignedClientIdentifier "B\153N\174I\248IAV@y)C\188[\167",PropSharedSubscriptionAvailable
// 228,PropSubscriptionIdentifierAvailable 109,PropResponseInformation "\ETB\246\211\190s
// _\175\f\215\154\ENQ\187^\135",PropWildcardSubscriptionAvailable 39,PropReceiveMaximum 20521,PropRetainAvailable
// 140,PropResponseTopic "\203Vzi\198\190\192&\US\227A\ETB\ETB\143*vjH\SO\168\169\149",PropServerKeepAlive
// 15366,PropRequestResponseInformation 125,PropSharedSubscriptionAvailable 80,PropMaximumQoS 168,PropResponseTopic
// "z\236 g\181\160\232\252\193\n\175\&2\135*",PropWillDelayInterval 14402,PropWillDelayInterval 22794,PropResponseTopic
// "\NULp\185\203\201f&i\216&\134\164\SO\251",PropMaximumPacketSize 22505]
TEST(Disco5QCTest, Encode11) {
  uint8_t pkt[] = {0xe0, 0x8f, 0x1,  0x8b, 0x8c, 0x1,  0x2,  0x0,  0x0,  0x62, 0xfd, 0x25, 0x97, 0x24, 0x60, 0x12, 0x0,
                   0x10, 0x42, 0x99, 0x4e, 0xae, 0x49, 0xf8, 0x49, 0x41, 0x56, 0x40, 0x79, 0x29, 0x43, 0xbc, 0x5b, 0xa7,
                   0x2a, 0xe4, 0x29, 0x6d, 0x1a, 0x0,  0xf,  0x17, 0xf6, 0xd3, 0xbe, 0x73, 0x20, 0x5f, 0xaf, 0xc,  0xd7,
                   0x9a, 0x5,  0xbb, 0x5e, 0x87, 0x28, 0x27, 0x21, 0x50, 0x29, 0x25, 0x8c, 0x8,  0x0,  0x16, 0xcb, 0x56,
                   0x7a, 0x69, 0xc6, 0xbe, 0xc0, 0x26, 0x1f, 0xe3, 0x41, 0x17, 0x17, 0x8f, 0x2a, 0x76, 0x6a, 0x48, 0xe,
                   0xa8, 0xa9, 0x95, 0x13, 0x3c, 0x6,  0x19, 0x7d, 0x2a, 0x50, 0x24, 0xa8, 0x8,  0x0,  0xe,  0x7a, 0xec,
                   0x20, 0x67, 0xb5, 0xa0, 0xe8, 0xfc, 0xc1, 0xa,  0xaf, 0x32, 0x87, 0x2a, 0x18, 0x0,  0x0,  0x38, 0x42,
                   0x18, 0x0,  0x0,  0x59, 0xa,  0x8,  0x0,  0xe,  0x0,  0x70, 0xb9, 0xcb, 0xc9, 0x66, 0x26, 0x69, 0xd8,
                   0x26, 0x86, 0xa4, 0xe,  0xfb, 0x27, 0x0,  0x0,  0x57, 0xe9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x42, 0x99, 0x4e, 0xae, 0x49, 0xf8, 0x49, 0x41,
                           0x56, 0x40, 0x79, 0x29, 0x43, 0xbc, 0x5b, 0xa7};
  uint8_t bytesprops1[] = {0x17, 0xf6, 0xd3, 0xbe, 0x73, 0x20, 0x5f, 0xaf, 0xc, 0xd7, 0x9a, 0x5, 0xbb, 0x5e, 0x87};
  uint8_t bytesprops2[] = {0xcb, 0x56, 0x7a, 0x69, 0xc6, 0xbe, 0xc0, 0x26, 0x1f, 0xe3, 0x41,
                           0x17, 0x17, 0x8f, 0x2a, 0x76, 0x6a, 0x48, 0xe,  0xa8, 0xa9, 0x95};
  uint8_t bytesprops3[] = {0x7a, 0xec, 0x20, 0x67, 0xb5, 0xa0, 0xe8, 0xfc, 0xc1, 0xa, 0xaf, 0x32, 0x87, 0x2a};
  uint8_t bytesprops4[] = {0x0, 0x70, 0xb9, 0xcb, 0xc9, 0x66, 0x26, 0x69, 0xd8, 0x26, 0x86, 0xa4, 0xe, 0xfb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25341}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20521}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15366}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14402}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22794}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22505}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 139, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSharedSubscriptionsNotSupported [PropWildcardSubscriptionAvailable
// 234,PropSubscriptionIdentifierAvailable 75,PropAuthenticationMethod
// "\183\NAK\163\250\173",PropSharedSubscriptionAvailable 200,PropContentType
// "\182\&4\US\214t\a\b\156\251\183g\134*\148;\158\226",PropReasonString
// "\252\238\&9-Tl\212\224:",PropRequestResponseInformation 106,PropMaximumPacketSize 19925,PropServerReference
// "%{\214\SUB\205\191U\r\226\139X\"\155\STX\208\161\154\216R",PropMessageExpiryInterval 23694,PropResponseTopic
// "\190S\DC4K\205\208\DLE\151\194z\SO\222\191t\237\203\181",PropMessageExpiryInterval 16415,PropUserProperty
// "\197\217\237\f\134\130\tE\158\193\DC4G\DC1\248\242\198\193\187"
// "\233NT\"xU\SO}\FS\225\128\164\218\&5\253\156f&\139\223",PropReceiveMaximum 120]
TEST(Disco5QCTest, Encode12) {
  uint8_t pkt[] = {0xe0, 0x9a, 0x1,  0x9e, 0x97, 0x1,  0x28, 0xea, 0x29, 0x4b, 0x15, 0x0,  0x5,  0xb7, 0x15, 0xa3,
                   0xfa, 0xad, 0x2a, 0xc8, 0x3,  0x0,  0x11, 0xb6, 0x34, 0x1f, 0xd6, 0x74, 0x7,  0x8,  0x9c, 0xfb,
                   0xb7, 0x67, 0x86, 0x2a, 0x94, 0x3b, 0x9e, 0xe2, 0x1f, 0x0,  0x9,  0xfc, 0xee, 0x39, 0x2d, 0x54,
                   0x6c, 0xd4, 0xe0, 0x3a, 0x19, 0x6a, 0x27, 0x0,  0x0,  0x4d, 0xd5, 0x1c, 0x0,  0x13, 0x25, 0x7b,
                   0xd6, 0x1a, 0xcd, 0xbf, 0x55, 0xd,  0xe2, 0x8b, 0x58, 0x22, 0x9b, 0x2,  0xd0, 0xa1, 0x9a, 0xd8,
                   0x52, 0x2,  0x0,  0x0,  0x5c, 0x8e, 0x8,  0x0,  0x11, 0xbe, 0x53, 0x14, 0x4b, 0xcd, 0xd0, 0x10,
                   0x97, 0xc2, 0x7a, 0xe,  0xde, 0xbf, 0x74, 0xed, 0xcb, 0xb5, 0x2,  0x0,  0x0,  0x40, 0x1f, 0x26,
                   0x0,  0x12, 0xc5, 0xd9, 0xed, 0xc,  0x86, 0x82, 0x9,  0x45, 0x9e, 0xc1, 0x14, 0x47, 0x11, 0xf8,
                   0xf2, 0xc6, 0xc1, 0xbb, 0x0,  0x14, 0xe9, 0x4e, 0x54, 0x22, 0x78, 0x55, 0xe,  0x7d, 0x1c, 0xe1,
                   0x80, 0xa4, 0xda, 0x35, 0xfd, 0x9c, 0x66, 0x26, 0x8b, 0xdf, 0x21, 0x0,  0x78};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb7, 0x15, 0xa3, 0xfa, 0xad};
  uint8_t bytesprops1[] = {0xb6, 0x34, 0x1f, 0xd6, 0x74, 0x7,  0x8,  0x9c, 0xfb,
                           0xb7, 0x67, 0x86, 0x2a, 0x94, 0x3b, 0x9e, 0xe2};
  uint8_t bytesprops2[] = {0xfc, 0xee, 0x39, 0x2d, 0x54, 0x6c, 0xd4, 0xe0, 0x3a};
  uint8_t bytesprops3[] = {0x25, 0x7b, 0xd6, 0x1a, 0xcd, 0xbf, 0x55, 0xd,  0xe2, 0x8b,
                           0x58, 0x22, 0x9b, 0x2,  0xd0, 0xa1, 0x9a, 0xd8, 0x52};
  uint8_t bytesprops4[] = {0xbe, 0x53, 0x14, 0x4b, 0xcd, 0xd0, 0x10, 0x97, 0xc2,
                           0x7a, 0xe,  0xde, 0xbf, 0x74, 0xed, 0xcb, 0xb5};
  uint8_t bytesprops6[] = {0xe9, 0x4e, 0x54, 0x22, 0x78, 0x55, 0xe,  0x7d, 0x1c, 0xe1,
                           0x80, 0xa4, 0xda, 0x35, 0xfd, 0x9c, 0x66, 0x26, 0x8b, 0xdf};
  uint8_t bytesprops5[] = {0xc5, 0xd9, 0xed, 0xc,  0x86, 0x82, 0x9,  0x45, 0x9e,
                           0xc1, 0x14, 0x47, 0x11, 0xf8, 0xf2, 0xc6, 0xc1, 0xbb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19925}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23694}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16415}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops5}, .v = {20, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 120}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 158, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSubscriptionIdentifiersNotSupported [PropPayloadFormatIndicator
// 14,PropWildcardSubscriptionAvailable 22,PropAuthenticationMethod
// "\177Z\158*cP'\v\166\DC4|\198\200",PropWildcardSubscriptionAvailable 0,PropCorrelationData
// "\169x\202\194\153\192\189\&0C\226\239s$",PropTopicAliasMaximum 32648,PropAuthenticationMethod
// "C\203\219CNr.\166\195\EM\177",PropMaximumPacketSize 27898,PropMessageExpiryInterval
// 8577,PropRequestResponseInformation 78,PropPayloadFormatIndicator 72,PropWildcardSubscriptionAvailable
// 245,PropReceiveMaximum 13594,PropMaximumQoS 170,PropAssignedClientIdentifier
// "\SUB\246\217\219\156\167\DC1>$\NAK\139b\219\188>",PropTopicAlias 200]
TEST(Disco5QCTest, Encode13) {
  uint8_t pkt[] = {0xe0, 0x63, 0xa1, 0x61, 0x1,  0xe,  0x28, 0x16, 0x15, 0x0,  0xd,  0xb1, 0x5a, 0x9e, 0x2a, 0x63, 0x50,
                   0x27, 0xb,  0xa6, 0x14, 0x7c, 0xc6, 0xc8, 0x28, 0x0,  0x9,  0x0,  0xd,  0xa9, 0x78, 0xca, 0xc2, 0x99,
                   0xc0, 0xbd, 0x30, 0x43, 0xe2, 0xef, 0x73, 0x24, 0x22, 0x7f, 0x88, 0x15, 0x0,  0xb,  0x43, 0xcb, 0xdb,
                   0x43, 0x4e, 0x72, 0x2e, 0xa6, 0xc3, 0x19, 0xb1, 0x27, 0x0,  0x0,  0x6c, 0xfa, 0x2,  0x0,  0x0,  0x21,
                   0x81, 0x19, 0x4e, 0x1,  0x48, 0x28, 0xf5, 0x21, 0x35, 0x1a, 0x24, 0xaa, 0x12, 0x0,  0xf,  0x1a, 0xf6,
                   0xd9, 0xdb, 0x9c, 0xa7, 0x11, 0x3e, 0x24, 0x15, 0x8b, 0x62, 0xdb, 0xbc, 0x3e, 0x23, 0x0,  0xc8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb1, 0x5a, 0x9e, 0x2a, 0x63, 0x50, 0x27, 0xb, 0xa6, 0x14, 0x7c, 0xc6, 0xc8};
  uint8_t bytesprops1[] = {0xa9, 0x78, 0xca, 0xc2, 0x99, 0xc0, 0xbd, 0x30, 0x43, 0xe2, 0xef, 0x73, 0x24};
  uint8_t bytesprops2[] = {0x43, 0xcb, 0xdb, 0x43, 0x4e, 0x72, 0x2e, 0xa6, 0xc3, 0x19, 0xb1};
  uint8_t bytesprops3[] = {0x1a, 0xf6, 0xd9, 0xdb, 0x9c, 0xa7, 0x11, 0x3e, 0x24, 0x15, 0x8b, 0x62, 0xdb, 0xbc, 0x3e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32648}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27898}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8577}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13594}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 200}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 161, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoRetainNotSupported [PropTopicAlias 10921]
TEST(Disco5QCTest, Encode14) {
  uint8_t pkt[] = {0xe0, 0x5, 0x9a, 0x3, 0x23, 0x2a, 0xa9};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10921}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 154, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoKeepAliveTimeout [PropRequestProblemInformation 30,PropResponseInformation
// "",PropRequestProblemInformation 166,PropMessageExpiryInterval 1456,PropSubscriptionIdentifierAvailable
// 66,PropUserProperty ":\SOH|\167\136\182\154'\EML J|\184Rd"
// "\128\ACK\215\191\196\am\243\159\244u\STX\"\b\252U\182p\139\138\r@\152\206\197\220\243",PropRetainAvailable
// 226,PropAssignedClientIdentifier
// ")<\145{\253\196Oi\192\n\181\231\SO9\NUL\GS\164\192\228J\243e\185/A\252\196\153",PropResponseTopic
// "\169f\217\DC2G",PropRequestProblemInformation 51,PropSubscriptionIdentifierAvailable 25]
TEST(Disco5QCTest, Encode15) {
  uint8_t pkt[] = {0xe0, 0x6d, 0x8d, 0x6b, 0x17, 0x1e, 0x1a, 0x0,  0x0,  0x17, 0xa6, 0x2,  0x0,  0x0,  0x5,  0xb0,
                   0x29, 0x42, 0x26, 0x0,  0x10, 0x3a, 0x1,  0x7c, 0xa7, 0x88, 0xb6, 0x9a, 0x27, 0x19, 0x4c, 0x20,
                   0x4a, 0x7c, 0xb8, 0x52, 0x64, 0x0,  0x1b, 0x80, 0x6,  0xd7, 0xbf, 0xc4, 0x7,  0x6d, 0xf3, 0x9f,
                   0xf4, 0x75, 0x2,  0x22, 0x8,  0xfc, 0x55, 0xb6, 0x70, 0x8b, 0x8a, 0xd,  0x40, 0x98, 0xce, 0xc5,
                   0xdc, 0xf3, 0x25, 0xe2, 0x12, 0x0,  0x1c, 0x29, 0x3c, 0x91, 0x7b, 0xfd, 0xc4, 0x4f, 0x69, 0xc0,
                   0xa,  0xb5, 0xe7, 0xe,  0x39, 0x0,  0x1d, 0xa4, 0xc0, 0xe4, 0x4a, 0xf3, 0x65, 0xb9, 0x2f, 0x41,
                   0xfc, 0xc4, 0x99, 0x8,  0x0,  0x5,  0xa9, 0x66, 0xd9, 0x12, 0x47, 0x17, 0x33, 0x29, 0x19};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops2[] = {0x80, 0x6,  0xd7, 0xbf, 0xc4, 0x7,  0x6d, 0xf3, 0x9f, 0xf4, 0x75, 0x2,  0x22, 0x8,
                           0xfc, 0x55, 0xb6, 0x70, 0x8b, 0x8a, 0xd,  0x40, 0x98, 0xce, 0xc5, 0xdc, 0xf3};
  uint8_t bytesprops1[] = {0x3a, 0x1,  0x7c, 0xa7, 0x88, 0xb6, 0x9a, 0x27,
                           0x19, 0x4c, 0x20, 0x4a, 0x7c, 0xb8, 0x52, 0x64};
  uint8_t bytesprops3[] = {0x29, 0x3c, 0x91, 0x7b, 0xfd, 0xc4, 0x4f, 0x69, 0xc0, 0xa,  0xb5, 0xe7, 0xe,  0x39,
                           0x0,  0x1d, 0xa4, 0xc0, 0xe4, 0x4a, 0xf3, 0x65, 0xb9, 0x2f, 0x41, 0xfc, 0xc4, 0x99};
  uint8_t bytesprops4[] = {0xa9, 0x66, 0xd9, 0x12, 0x47};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1456}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops1}, .v = {27, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 25}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 141, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoWildcardSubscriptionsNotSupported [PropServerKeepAlive 21112,PropAssignedClientIdentifier
// "\203\147\245j!L\236\&9\146G\169\220\229Y\225",PropSharedSubscriptionAvailable 1,PropSessionExpiryInterval
// 27576,PropAuthenticationData "\225\ENQ\249\144H\196PN\166\EM\154\138",PropResponseInformation
// "\152\151\211|\230\CAN\235\248\DC49\\\134:\SUB\NAK\178\181\150LH\212t\253v\214\DC3\208\EOT\207\137",PropRequestProblemInformation
// 73]
TEST(Disco5QCTest, Encode16) {
  uint8_t pkt[] = {0xe0, 0x50, 0xa2, 0x4e, 0x13, 0x52, 0x78, 0x12, 0x0,  0xf,  0xcb, 0x93, 0xf5, 0x6a, 0x21, 0x4c, 0xec,
                   0x39, 0x92, 0x47, 0xa9, 0xdc, 0xe5, 0x59, 0xe1, 0x2a, 0x1,  0x11, 0x0,  0x0,  0x6b, 0xb8, 0x16, 0x0,
                   0xc,  0xe1, 0x5,  0xf9, 0x90, 0x48, 0xc4, 0x50, 0x4e, 0xa6, 0x19, 0x9a, 0x8a, 0x1a, 0x0,  0x1e, 0x98,
                   0x97, 0xd3, 0x7c, 0xe6, 0x18, 0xeb, 0xf8, 0x14, 0x39, 0x5c, 0x86, 0x3a, 0x1a, 0x15, 0xb2, 0xb5, 0x96,
                   0x4c, 0x48, 0xd4, 0x74, 0xfd, 0x76, 0xd6, 0x13, 0xd0, 0x4,  0xcf, 0x89, 0x17, 0x49};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xcb, 0x93, 0xf5, 0x6a, 0x21, 0x4c, 0xec, 0x39, 0x92, 0x47, 0xa9, 0xdc, 0xe5, 0x59, 0xe1};
  uint8_t bytesprops1[] = {0xe1, 0x5, 0xf9, 0x90, 0x48, 0xc4, 0x50, 0x4e, 0xa6, 0x19, 0x9a, 0x8a};
  uint8_t bytesprops2[] = {0x98, 0x97, 0xd3, 0x7c, 0xe6, 0x18, 0xeb, 0xf8, 0x14, 0x39, 0x5c, 0x86, 0x3a, 0x1a, 0x15,
                           0xb2, 0xb5, 0x96, 0x4c, 0x48, 0xd4, 0x74, 0xfd, 0x76, 0xd6, 0x13, 0xd0, 0x4,  0xcf, 0x89};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21112}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27576}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 73}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 162, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMalformedPacket [PropAuthenticationMethod
// "\227\221a\197\144\178J\169\218x\205\239F\156\203S\219\STX"]
TEST(Disco5QCTest, Encode17) {
  uint8_t pkt[] = {0xe0, 0x17, 0x81, 0x15, 0x15, 0x0,  0x12, 0xe3, 0xdd, 0x61, 0xc5, 0x90, 0xb2,
                   0x4a, 0xa9, 0xda, 0x78, 0xcd, 0xef, 0x46, 0x9c, 0xcb, 0x53, 0xdb, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe3, 0xdd, 0x61, 0xc5, 0x90, 0xb2, 0x4a, 0xa9, 0xda,
                           0x78, 0xcd, 0xef, 0x46, 0x9c, 0xcb, 0x53, 0xdb, 0x2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 129, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServerBusy [PropCorrelationData
// "\242\168\171&\RS\132\166\131\176\220\230\252\155\RS\ACK\162\&4,s\160\131\&4\197",PropAuthenticationData
// "",PropContentType "m 0\129\192cM\134\143\211\193\168\174\235i3t\219\DEL\149B\165",PropSubscriptionIdentifier
// 2,PropUserProperty "O\164z\NULJC\EM\234\155a3\139\&6kk\214\161\129F\146\&1\140"
// "\156\241",PropRequestResponseInformation 44,PropWillDelayInterval 30451,PropServerKeepAlive 24287]
TEST(Disco5QCTest, Encode18) {
  uint8_t pkt[] = {0xe0, 0x61, 0x89, 0x5f, 0x9,  0x0,  0x17, 0xf2, 0xa8, 0xab, 0x26, 0x1e, 0x84, 0xa6, 0x83, 0xb0, 0xdc,
                   0xe6, 0xfc, 0x9b, 0x1e, 0x6,  0xa2, 0x34, 0x2c, 0x73, 0xa0, 0x83, 0x34, 0xc5, 0x16, 0x0,  0x0,  0x3,
                   0x0,  0x16, 0x6d, 0x20, 0x30, 0x81, 0xc0, 0x63, 0x4d, 0x86, 0x8f, 0xd3, 0xc1, 0xa8, 0xae, 0xeb, 0x69,
                   0x33, 0x74, 0xdb, 0x7f, 0x95, 0x42, 0xa5, 0xb,  0x2,  0x26, 0x0,  0x16, 0x4f, 0xa4, 0x7a, 0x0,  0x4a,
                   0x43, 0x19, 0xea, 0x9b, 0x61, 0x33, 0x8b, 0x36, 0x6b, 0x6b, 0xd6, 0xa1, 0x81, 0x46, 0x92, 0x31, 0x8c,
                   0x0,  0x2,  0x9c, 0xf1, 0x19, 0x2c, 0x18, 0x0,  0x0,  0x76, 0xf3, 0x13, 0x5e, 0xdf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf2, 0xa8, 0xab, 0x26, 0x1e, 0x84, 0xa6, 0x83, 0xb0, 0xdc, 0xe6, 0xfc,
                           0x9b, 0x1e, 0x6,  0xa2, 0x34, 0x2c, 0x73, 0xa0, 0x83, 0x34, 0xc5};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x6d, 0x20, 0x30, 0x81, 0xc0, 0x63, 0x4d, 0x86, 0x8f, 0xd3, 0xc1,
                           0xa8, 0xae, 0xeb, 0x69, 0x33, 0x74, 0xdb, 0x7f, 0x95, 0x42, 0xa5};
  uint8_t bytesprops4[] = {0x9c, 0xf1};
  uint8_t bytesprops3[] = {0x4f, 0xa4, 0x7a, 0x0,  0x4a, 0x43, 0x19, 0xea, 0x9b, 0x61, 0x33,
                           0x8b, 0x36, 0x6b, 0x6b, 0xd6, 0xa1, 0x81, 0x46, 0x92, 0x31, 0x8c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 2}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops3}, .v = {2, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30451}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24287}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 137, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoDisconnectWithWill [PropWillDelayInterval 27833,PropResponseInformation
// "|&d\n\193\232\187\207o9c\230\GS\203\174Y\228\RS\204\152\DLE\RSZk\255v\190",PropAssignedClientIdentifier
// "\244\218eE\228\160\159`\DC2\202\138\143V}\219\&3\152\ETX",PropTopicAliasMaximum 9595,PropSubscriptionIdentifier 7]
TEST(Disco5QCTest, Encode19) {
  uint8_t pkt[] = {0xe0, 0x3f, 0x4,  0x3d, 0x18, 0x0,  0x0,  0x6c, 0xb9, 0x1a, 0x0,  0x1b, 0x7c, 0x26, 0x64, 0xa,  0xc1,
                   0xe8, 0xbb, 0xcf, 0x6f, 0x39, 0x63, 0xe6, 0x1d, 0xcb, 0xae, 0x59, 0xe4, 0x1e, 0xcc, 0x98, 0x10, 0x1e,
                   0x5a, 0x6b, 0xff, 0x76, 0xbe, 0x12, 0x0,  0x12, 0xf4, 0xda, 0x65, 0x45, 0xe4, 0xa0, 0x9f, 0x60, 0x12,
                   0xca, 0x8a, 0x8f, 0x56, 0x7d, 0xdb, 0x33, 0x98, 0x3,  0x22, 0x25, 0x7b, 0xb,  0x7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7c, 0x26, 0x64, 0xa,  0xc1, 0xe8, 0xbb, 0xcf, 0x6f, 0x39, 0x63, 0xe6, 0x1d, 0xcb,
                           0xae, 0x59, 0xe4, 0x1e, 0xcc, 0x98, 0x10, 0x1e, 0x5a, 0x6b, 0xff, 0x76, 0xbe};
  uint8_t bytesprops1[] = {0xf4, 0xda, 0x65, 0x45, 0xe4, 0xa0, 0x9f, 0x60, 0x12,
                           0xca, 0x8a, 0x8f, 0x56, 0x7d, 0xdb, 0x33, 0x98, 0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27833}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9595}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicNameInvalid [PropPayloadFormatIndicator 242,PropTopicAlias
// 3083,PropSubscriptionIdentifier 17]
TEST(Disco5QCTest, Encode20) {
  uint8_t pkt[] = {0xe0, 0x9, 0x90, 0x7, 0x1, 0xf2, 0x23, 0xc, 0xb, 0xb, 0x11};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3083}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 144, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoReceiveMaximumExceeded [PropMaximumQoS 118,PropReceiveMaximum 6069,PropServerReference
// "\189\&3`\210\132\222\203\SOH\153>F6\156\244Ll3an.\178\STX\240\227\186: ",PropRequestProblemInformation
// 52,PropServerKeepAlive 8463,PropWillDelayInterval 16370,PropWildcardSubscriptionAvailable
// 78,PropSubscriptionIdentifier 25,PropAuthenticationMethod
// "\150\bs\128\128\233T\US\SI\164\223\ENQ\FS\174^=\153\&2g\136'\190#\254",PropAuthenticationMethod
// "rn\128\&8F\206\154{\185\206\153>@",PropMessageExpiryInterval 25716,PropUserProperty
// "\174F\215\140j\DC1:\183g\171!\155\216\132\244\DC4\229\aQ\176\141\159\&7!"
// "S\162\146\205\n\213\183\174\ACK\154P\\\USg",PropMaximumQoS 90,PropReceiveMaximum
// 16541,PropSharedSubscriptionAvailable 103,PropAssignedClientIdentifier "\250\145\225\187DQ",PropCorrelationData
// "J\SYN7\194S\218\181\"\231\135\\\145\167\186\&0\167Y\b\b\ETBh\US\225",PropMaximumPacketSize
// 14554,PropResponseInformation "\206\GS\195",PropTopicAlias 10203,PropSubscriptionIdentifierAvailable
// 102,PropTopicAliasMaximum 18623,PropContentType
// "\197\173\166\250\171\168\165$|:|\237s\STXL\169x\DC3\232\136\&2\182\254\221\STX\241?\194"]
TEST(Disco5QCTest, Encode21) {
  uint8_t pkt[] = {
      0xe0, 0xeb, 0x1,  0x93, 0xe8, 0x1,  0x24, 0x76, 0x21, 0x17, 0xb5, 0x1c, 0x0,  0x1b, 0xbd, 0x33, 0x60, 0xd2, 0x84,
      0xde, 0xcb, 0x1,  0x99, 0x3e, 0x46, 0x36, 0x9c, 0xf4, 0x4c, 0x6c, 0x33, 0x61, 0x6e, 0x2e, 0xb2, 0x2,  0xf0, 0xe3,
      0xba, 0x3a, 0x20, 0x17, 0x34, 0x13, 0x21, 0xf,  0x18, 0x0,  0x0,  0x3f, 0xf2, 0x28, 0x4e, 0xb,  0x19, 0x15, 0x0,
      0x18, 0x96, 0x8,  0x73, 0x80, 0x80, 0xe9, 0x54, 0x1f, 0xf,  0xa4, 0xdf, 0x5,  0x1c, 0xae, 0x5e, 0x3d, 0x99, 0x32,
      0x67, 0x88, 0x27, 0xbe, 0x23, 0xfe, 0x15, 0x0,  0xd,  0x72, 0x6e, 0x80, 0x38, 0x46, 0xce, 0x9a, 0x7b, 0xb9, 0xce,
      0x99, 0x3e, 0x40, 0x2,  0x0,  0x0,  0x64, 0x74, 0x26, 0x0,  0x18, 0xae, 0x46, 0xd7, 0x8c, 0x6a, 0x11, 0x3a, 0xb7,
      0x67, 0xab, 0x21, 0x9b, 0xd8, 0x84, 0xf4, 0x14, 0xe5, 0x7,  0x51, 0xb0, 0x8d, 0x9f, 0x37, 0x21, 0x0,  0xe,  0x53,
      0xa2, 0x92, 0xcd, 0xa,  0xd5, 0xb7, 0xae, 0x6,  0x9a, 0x50, 0x5c, 0x1f, 0x67, 0x24, 0x5a, 0x21, 0x40, 0x9d, 0x2a,
      0x67, 0x12, 0x0,  0x6,  0xfa, 0x91, 0xe1, 0xbb, 0x44, 0x51, 0x9,  0x0,  0x17, 0x4a, 0x16, 0x37, 0xc2, 0x53, 0xda,
      0xb5, 0x22, 0xe7, 0x87, 0x5c, 0x91, 0xa7, 0xba, 0x30, 0xa7, 0x59, 0x8,  0x8,  0x17, 0x68, 0x1f, 0xe1, 0x27, 0x0,
      0x0,  0x38, 0xda, 0x1a, 0x0,  0x3,  0xce, 0x1d, 0xc3, 0x23, 0x27, 0xdb, 0x29, 0x66, 0x22, 0x48, 0xbf, 0x3,  0x0,
      0x1c, 0xc5, 0xad, 0xa6, 0xfa, 0xab, 0xa8, 0xa5, 0x24, 0x7c, 0x3a, 0x7c, 0xed, 0x73, 0x2,  0x4c, 0xa9, 0x78, 0x13,
      0xe8, 0x88, 0x32, 0xb6, 0xfe, 0xdd, 0x2,  0xf1, 0x3f, 0xc2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbd, 0x33, 0x60, 0xd2, 0x84, 0xde, 0xcb, 0x1, 0x99, 0x3e, 0x46, 0x36, 0x9c, 0xf4,
                           0x4c, 0x6c, 0x33, 0x61, 0x6e, 0x2e, 0xb2, 0x2, 0xf0, 0xe3, 0xba, 0x3a, 0x20};
  uint8_t bytesprops1[] = {0x96, 0x8,  0x73, 0x80, 0x80, 0xe9, 0x54, 0x1f, 0xf,  0xa4, 0xdf, 0x5,
                           0x1c, 0xae, 0x5e, 0x3d, 0x99, 0x32, 0x67, 0x88, 0x27, 0xbe, 0x23, 0xfe};
  uint8_t bytesprops2[] = {0x72, 0x6e, 0x80, 0x38, 0x46, 0xce, 0x9a, 0x7b, 0xb9, 0xce, 0x99, 0x3e, 0x40};
  uint8_t bytesprops4[] = {0x53, 0xa2, 0x92, 0xcd, 0xa, 0xd5, 0xb7, 0xae, 0x6, 0x9a, 0x50, 0x5c, 0x1f, 0x67};
  uint8_t bytesprops3[] = {0xae, 0x46, 0xd7, 0x8c, 0x6a, 0x11, 0x3a, 0xb7, 0x67, 0xab, 0x21, 0x9b,
                           0xd8, 0x84, 0xf4, 0x14, 0xe5, 0x7,  0x51, 0xb0, 0x8d, 0x9f, 0x37, 0x21};
  uint8_t bytesprops5[] = {0xfa, 0x91, 0xe1, 0xbb, 0x44, 0x51};
  uint8_t bytesprops6[] = {0x4a, 0x16, 0x37, 0xc2, 0x53, 0xda, 0xb5, 0x22, 0xe7, 0x87, 0x5c, 0x91,
                           0xa7, 0xba, 0x30, 0xa7, 0x59, 0x8,  0x8,  0x17, 0x68, 0x1f, 0xe1};
  uint8_t bytesprops7[] = {0xce, 0x1d, 0xc3};
  uint8_t bytesprops8[] = {0xc5, 0xad, 0xa6, 0xfa, 0xab, 0xa8, 0xa5, 0x24, 0x7c, 0x3a, 0x7c, 0xed, 0x73, 0x2,
                           0x4c, 0xa9, 0x78, 0x13, 0xe8, 0x88, 0x32, 0xb6, 0xfe, 0xdd, 0x2,  0xf1, 0x3f, 0xc2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6069}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8463}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16370}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 25}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25716}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops3}, .v = {14, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16541}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14554}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10203}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18623}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 147, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection [PropAssignedClientIdentifier
// "$\187:\SOH\237\204\231\196G",PropSessionExpiryInterval 18636,PropAssignedClientIdentifier
// "\ETXTo5\144\186",PropMaximumPacketSize 7534,PropReceiveMaximum 16577,PropMessageExpiryInterval
// 6685,PropRetainAvailable 107,PropRequestProblemInformation 90,PropAssignedClientIdentifier
// "*X\SOH\EOTl\US\SUB\148",PropPayloadFormatIndicator 73,PropContentType
// "\171\162\137\USX\b-a\a\190\nt\FS\175\DC4pqNv\208S\152I\159\&0",PropMaximumPacketSize
// 19535,PropSubscriptionIdentifier 9,PropResponseInformation "\228\198qN6\156C\149}\ACK\255)h\152)\155Gs\181\175\246"]
TEST(Disco5QCTest, Encode22) {
  uint8_t pkt[] = {0xe0, 0x75, 0x0,  0x73, 0x12, 0x0,  0x9,  0x24, 0xbb, 0x3a, 0x1,  0xed, 0xcc, 0xe7, 0xc4,
                   0x47, 0x11, 0x0,  0x0,  0x48, 0xcc, 0x12, 0x0,  0x6,  0x3,  0x54, 0x6f, 0x35, 0x90, 0xba,
                   0x27, 0x0,  0x0,  0x1d, 0x6e, 0x21, 0x40, 0xc1, 0x2,  0x0,  0x0,  0x1a, 0x1d, 0x25, 0x6b,
                   0x17, 0x5a, 0x12, 0x0,  0x8,  0x2a, 0x58, 0x1,  0x4,  0x6c, 0x1f, 0x1a, 0x94, 0x1,  0x49,
                   0x3,  0x0,  0x19, 0xab, 0xa2, 0x89, 0x1f, 0x58, 0x8,  0x2d, 0x61, 0x7,  0xbe, 0xa,  0x74,
                   0x1c, 0xaf, 0x14, 0x70, 0x71, 0x4e, 0x76, 0xd0, 0x53, 0x98, 0x49, 0x9f, 0x30, 0x27, 0x0,
                   0x0,  0x4c, 0x4f, 0xb,  0x9,  0x1a, 0x0,  0x15, 0xe4, 0xc6, 0x71, 0x4e, 0x36, 0x9c, 0x43,
                   0x95, 0x7d, 0x6,  0xff, 0x29, 0x68, 0x98, 0x29, 0x9b, 0x47, 0x73, 0xb5, 0xaf, 0xf6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x24, 0xbb, 0x3a, 0x1, 0xed, 0xcc, 0xe7, 0xc4, 0x47};
  uint8_t bytesprops1[] = {0x3, 0x54, 0x6f, 0x35, 0x90, 0xba};
  uint8_t bytesprops2[] = {0x2a, 0x58, 0x1, 0x4, 0x6c, 0x1f, 0x1a, 0x94};
  uint8_t bytesprops3[] = {0xab, 0xa2, 0x89, 0x1f, 0x58, 0x8,  0x2d, 0x61, 0x7,  0xbe, 0xa,  0x74, 0x1c,
                           0xaf, 0x14, 0x70, 0x71, 0x4e, 0x76, 0xd0, 0x53, 0x98, 0x49, 0x9f, 0x30};
  uint8_t bytesprops4[] = {0xe4, 0xc6, 0x71, 0x4e, 0x36, 0x9c, 0x43, 0x95, 0x7d, 0x6, 0xff,
                           0x29, 0x68, 0x98, 0x29, 0x9b, 0x47, 0x73, 0xb5, 0xaf, 0xf6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18636}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7534}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16577}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6685}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19535}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection [PropAssignedClientIdentifier
// "\239\236\193{\250\139\193O\220\250\EM>\193B",PropMessageExpiryInterval 19122,PropServerKeepAlive
// 32735,PropPayloadFormatIndicator 218,PropMessageExpiryInterval 28266,PropWildcardSubscriptionAvailable
// 233,PropWildcardSubscriptionAvailable 8,PropAssignedClientIdentifier
// "=:\174qX\199\243\226l\\`p\172i\153!-t\DC3DG\169\171\ETXx\239\fr3"]
TEST(Disco5QCTest, Encode23) {
  uint8_t pkt[] = {0xe0, 0x46, 0x0,  0x44, 0x12, 0x0,  0xe,  0xef, 0xec, 0xc1, 0x7b, 0xfa, 0x8b, 0xc1, 0x4f,
                   0xdc, 0xfa, 0x19, 0x3e, 0xc1, 0x42, 0x2,  0x0,  0x0,  0x4a, 0xb2, 0x13, 0x7f, 0xdf, 0x1,
                   0xda, 0x2,  0x0,  0x0,  0x6e, 0x6a, 0x28, 0xe9, 0x28, 0x8,  0x12, 0x0,  0x1d, 0x3d, 0x3a,
                   0xae, 0x71, 0x58, 0xc7, 0xf3, 0xe2, 0x6c, 0x5c, 0x60, 0x70, 0xac, 0x69, 0x99, 0x21, 0x2d,
                   0x74, 0x13, 0x44, 0x47, 0xa9, 0xab, 0x3,  0x78, 0xef, 0xc,  0x72, 0x33};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xef, 0xec, 0xc1, 0x7b, 0xfa, 0x8b, 0xc1, 0x4f, 0xdc, 0xfa, 0x19, 0x3e, 0xc1, 0x42};
  uint8_t bytesprops1[] = {0x3d, 0x3a, 0xae, 0x71, 0x58, 0xc7, 0xf3, 0xe2, 0x6c, 0x5c, 0x60, 0x70, 0xac, 0x69, 0x99,
                           0x21, 0x2d, 0x74, 0x13, 0x44, 0x47, 0xa9, 0xab, 0x3,  0x78, 0xef, 0xc,  0x72, 0x33};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19122}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32735}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28266}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoProtocolError [PropSharedSubscriptionAvailable 126,PropMessageExpiryInterval
// 22952,PropServerReference "\n\a6\222dV\218",PropPayloadFormatIndicator 241,PropUserProperty "\234\FS\b\EM"
// "\FS\SUBN'\170\191\STXZ\213\133\189K\190V)\160\255\&0",PropTopicAlias 12630,PropResponseInformation
// "\184\217Nw\DC1B\178\153m\164k\151\161 \EOTu",PropMessageExpiryInterval 22385,PropWillDelayInterval
// 8666,PropPayloadFormatIndicator 230,PropSessionExpiryInterval 28458,PropWildcardSubscriptionAvailable
// 22,PropSubscriptionIdentifierAvailable 61,PropResponseInformation "\236",PropAssignedClientIdentifier
// "#\EOT",PropWillDelayInterval 28536,PropServerKeepAlive 27227,PropReasonString
// "P\178\135I2\193\&7\206\209\223;\145\171\DC2\241",PropResponseTopic
// "\169\228\DC2\US\215,\140\226\150\131\143\134>\DC4\172.",PropContentType
// "V\218\247\196+\186x\233|",PropReceiveMaximum 21710,PropRequestProblemInformation 234,PropTopicAlias
// 21200,PropReceiveMaximum 13455,PropPayloadFormatIndicator 98]
TEST(Disco5QCTest, Encode24) {
  uint8_t pkt[] = {0xe0, 0xab, 0x1,  0x82, 0xa8, 0x1,  0x2a, 0x7e, 0x2,  0x0,  0x0,  0x59, 0xa8, 0x1c, 0x0,  0x7,
                   0xa,  0x7,  0x36, 0xde, 0x64, 0x56, 0xda, 0x1,  0xf1, 0x26, 0x0,  0x4,  0xea, 0x1c, 0x8,  0x19,
                   0x0,  0x12, 0x1c, 0x1a, 0x4e, 0x27, 0xaa, 0xbf, 0x2,  0x5a, 0xd5, 0x85, 0xbd, 0x4b, 0xbe, 0x56,
                   0x29, 0xa0, 0xff, 0x30, 0x23, 0x31, 0x56, 0x1a, 0x0,  0x10, 0xb8, 0xd9, 0x4e, 0x77, 0x11, 0x42,
                   0xb2, 0x99, 0x6d, 0xa4, 0x6b, 0x97, 0xa1, 0x20, 0x4,  0x75, 0x2,  0x0,  0x0,  0x57, 0x71, 0x18,
                   0x0,  0x0,  0x21, 0xda, 0x1,  0xe6, 0x11, 0x0,  0x0,  0x6f, 0x2a, 0x28, 0x16, 0x29, 0x3d, 0x1a,
                   0x0,  0x1,  0xec, 0x12, 0x0,  0x2,  0x23, 0x4,  0x18, 0x0,  0x0,  0x6f, 0x78, 0x13, 0x6a, 0x5b,
                   0x1f, 0x0,  0xf,  0x50, 0xb2, 0x87, 0x49, 0x32, 0xc1, 0x37, 0xce, 0xd1, 0xdf, 0x3b, 0x91, 0xab,
                   0x12, 0xf1, 0x8,  0x0,  0x10, 0xa9, 0xe4, 0x12, 0x1f, 0xd7, 0x2c, 0x8c, 0xe2, 0x96, 0x83, 0x8f,
                   0x86, 0x3e, 0x14, 0xac, 0x2e, 0x3,  0x0,  0x9,  0x56, 0xda, 0xf7, 0xc4, 0x2b, 0xba, 0x78, 0xe9,
                   0x7c, 0x21, 0x54, 0xce, 0x17, 0xea, 0x23, 0x52, 0xd0, 0x21, 0x34, 0x8f, 0x1,  0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa, 0x7, 0x36, 0xde, 0x64, 0x56, 0xda};
  uint8_t bytesprops2[] = {0x1c, 0x1a, 0x4e, 0x27, 0xaa, 0xbf, 0x2,  0x5a, 0xd5,
                           0x85, 0xbd, 0x4b, 0xbe, 0x56, 0x29, 0xa0, 0xff, 0x30};
  uint8_t bytesprops1[] = {0xea, 0x1c, 0x8, 0x19};
  uint8_t bytesprops3[] = {0xb8, 0xd9, 0x4e, 0x77, 0x11, 0x42, 0xb2, 0x99,
                           0x6d, 0xa4, 0x6b, 0x97, 0xa1, 0x20, 0x4,  0x75};
  uint8_t bytesprops4[] = {0xec};
  uint8_t bytesprops5[] = {0x23, 0x4};
  uint8_t bytesprops6[] = {0x50, 0xb2, 0x87, 0x49, 0x32, 0xc1, 0x37, 0xce, 0xd1, 0xdf, 0x3b, 0x91, 0xab, 0x12, 0xf1};
  uint8_t bytesprops7[] = {0xa9, 0xe4, 0x12, 0x1f, 0xd7, 0x2c, 0x8c, 0xe2,
                           0x96, 0x83, 0x8f, 0x86, 0x3e, 0x14, 0xac, 0x2e};
  uint8_t bytesprops8[] = {0x56, 0xda, 0xf7, 0xc4, 0x2b, 0xba, 0x78, 0xe9, 0x7c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22952}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12630}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22385}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8666}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28458}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28536}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27227}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21710}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21200}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13455}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 98}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 130, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMaximumConnectTime [PropRequestProblemInformation 237,PropSharedSubscriptionAvailable
// 191,PropWildcardSubscriptionAvailable 74,PropAssignedClientIdentifier
// "\211%\DEL;\174\234\EOT\128\ETXt,[\177\138O\DLE+\134\220Ut/\212\247\136\&4P\142\181",PropServerReference
// "9u\ENQz\160\172\253\129 \225\240\180\200hO",PropAssignedClientIdentifier
// "^\SOH\135l\163\233L>\bN\154\NUL\ESC\150\131",PropWillDelayInterval 7514,PropWildcardSubscriptionAvailable
// 226,PropSubscriptionIdentifier 29,PropMessageExpiryInterval 23285,PropSubscriptionIdentifier
// 11,PropResponseInformation
// "s\SIj\196\251L\167\ETX\NAK\137`\226\221\183\189\EM\DC1wWs\ETB4p\184\143&",PropSharedSubscriptionAvailable
// 6,PropWillDelayInterval 23559,PropAuthenticationData
// "\166\144\235\195h\240\&6\SOH\DC2\191\STX\153\&6\238\173ldx",PropMaximumQoS 190,PropContentType
// "\151\GS\229\176I\161h\203\172O\213\GS\232W\SOH\238\214\EOT\254\EOTX\f\193\251(\171\164s:\DEL",PropAuthenticationData
// "\208\139K\193\159H",PropRequestResponseInformation 104,PropTopicAliasMaximum 5762,PropReasonString
// "\174\206\147\209\232BH@R\140W\178\173/\165\230\&1\141\233\245<f\211l\145\149\129\241\160",PropMessageExpiryInterval
// 31159,PropResponseTopic "\242\210T`\252\ACK\133\157f\161t\140k\r\149\227\234C",PropSessionExpiryInterval
// 25789,PropWildcardSubscriptionAvailable 225,PropUserProperty "\SYN\r0\167\&6\146\DC2F\240\154\FS\153g\FS\184\ro\177"
// "ip",PropAssignedClientIdentifier "h\\\204`\NAKGF\205\174\SI\DELmVv\226",PropCorrelationData
// "aJP\214\vO\251hi",PropRequestResponseInformation 63,PropRequestResponseInformation 154]
TEST(Disco5QCTest, Encode25) {
  uint8_t pkt[] = {
      0xe0, 0xc3, 0x2,  0xa0, 0xc0, 0x2,  0x17, 0xed, 0x2a, 0xbf, 0x28, 0x4a, 0x12, 0x0,  0x1d, 0xd3, 0x25, 0x7f, 0x3b,
      0xae, 0xea, 0x4,  0x80, 0x3,  0x74, 0x2c, 0x5b, 0xb1, 0x8a, 0x4f, 0x10, 0x2b, 0x86, 0xdc, 0x55, 0x74, 0x2f, 0xd4,
      0xf7, 0x88, 0x34, 0x50, 0x8e, 0xb5, 0x1c, 0x0,  0xf,  0x39, 0x75, 0x5,  0x7a, 0xa0, 0xac, 0xfd, 0x81, 0x20, 0xe1,
      0xf0, 0xb4, 0xc8, 0x68, 0x4f, 0x12, 0x0,  0xf,  0x5e, 0x1,  0x87, 0x6c, 0xa3, 0xe9, 0x4c, 0x3e, 0x8,  0x4e, 0x9a,
      0x0,  0x1b, 0x96, 0x83, 0x18, 0x0,  0x0,  0x1d, 0x5a, 0x28, 0xe2, 0xb,  0x1d, 0x2,  0x0,  0x0,  0x5a, 0xf5, 0xb,
      0xb,  0x1a, 0x0,  0x1a, 0x73, 0xf,  0x6a, 0xc4, 0xfb, 0x4c, 0xa7, 0x3,  0x15, 0x89, 0x60, 0xe2, 0xdd, 0xb7, 0xbd,
      0x19, 0x11, 0x77, 0x57, 0x73, 0x17, 0x34, 0x70, 0xb8, 0x8f, 0x26, 0x2a, 0x6,  0x18, 0x0,  0x0,  0x5c, 0x7,  0x16,
      0x0,  0x12, 0xa6, 0x90, 0xeb, 0xc3, 0x68, 0xf0, 0x36, 0x1,  0x12, 0xbf, 0x2,  0x99, 0x36, 0xee, 0xad, 0x6c, 0x64,
      0x78, 0x24, 0xbe, 0x3,  0x0,  0x1e, 0x97, 0x1d, 0xe5, 0xb0, 0x49, 0xa1, 0x68, 0xcb, 0xac, 0x4f, 0xd5, 0x1d, 0xe8,
      0x57, 0x1,  0xee, 0xd6, 0x4,  0xfe, 0x4,  0x58, 0xc,  0xc1, 0xfb, 0x28, 0xab, 0xa4, 0x73, 0x3a, 0x7f, 0x16, 0x0,
      0x6,  0xd0, 0x8b, 0x4b, 0xc1, 0x9f, 0x48, 0x19, 0x68, 0x22, 0x16, 0x82, 0x1f, 0x0,  0x1d, 0xae, 0xce, 0x93, 0xd1,
      0xe8, 0x42, 0x48, 0x40, 0x52, 0x8c, 0x57, 0xb2, 0xad, 0x2f, 0xa5, 0xe6, 0x31, 0x8d, 0xe9, 0xf5, 0x3c, 0x66, 0xd3,
      0x6c, 0x91, 0x95, 0x81, 0xf1, 0xa0, 0x2,  0x0,  0x0,  0x79, 0xb7, 0x8,  0x0,  0x12, 0xf2, 0xd2, 0x54, 0x60, 0xfc,
      0x6,  0x85, 0x9d, 0x66, 0xa1, 0x74, 0x8c, 0x6b, 0xd,  0x95, 0xe3, 0xea, 0x43, 0x11, 0x0,  0x0,  0x64, 0xbd, 0x28,
      0xe1, 0x26, 0x0,  0x12, 0x16, 0xd,  0x30, 0xa7, 0x36, 0x92, 0x12, 0x46, 0xf0, 0x9a, 0x1c, 0x99, 0x67, 0x1c, 0xb8,
      0xd,  0x6f, 0xb1, 0x0,  0x2,  0x69, 0x70, 0x12, 0x0,  0xf,  0x68, 0x5c, 0xcc, 0x60, 0x15, 0x47, 0x46, 0xcd, 0xae,
      0xf,  0x7f, 0x6d, 0x56, 0x76, 0xe2, 0x9,  0x0,  0x9,  0x61, 0x4a, 0x50, 0xd6, 0xb,  0x4f, 0xfb, 0x68, 0x69, 0x19,
      0x3f, 0x19, 0x9a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd3, 0x25, 0x7f, 0x3b, 0xae, 0xea, 0x4,  0x80, 0x3,  0x74, 0x2c, 0x5b, 0xb1, 0x8a, 0x4f,
                           0x10, 0x2b, 0x86, 0xdc, 0x55, 0x74, 0x2f, 0xd4, 0xf7, 0x88, 0x34, 0x50, 0x8e, 0xb5};
  uint8_t bytesprops1[] = {0x39, 0x75, 0x5, 0x7a, 0xa0, 0xac, 0xfd, 0x81, 0x20, 0xe1, 0xf0, 0xb4, 0xc8, 0x68, 0x4f};
  uint8_t bytesprops2[] = {0x5e, 0x1, 0x87, 0x6c, 0xa3, 0xe9, 0x4c, 0x3e, 0x8, 0x4e, 0x9a, 0x0, 0x1b, 0x96, 0x83};
  uint8_t bytesprops3[] = {0x73, 0xf,  0x6a, 0xc4, 0xfb, 0x4c, 0xa7, 0x3,  0x15, 0x89, 0x60, 0xe2, 0xdd,
                           0xb7, 0xbd, 0x19, 0x11, 0x77, 0x57, 0x73, 0x17, 0x34, 0x70, 0xb8, 0x8f, 0x26};
  uint8_t bytesprops4[] = {0xa6, 0x90, 0xeb, 0xc3, 0x68, 0xf0, 0x36, 0x1,  0x12,
                           0xbf, 0x2,  0x99, 0x36, 0xee, 0xad, 0x6c, 0x64, 0x78};
  uint8_t bytesprops5[] = {0x97, 0x1d, 0xe5, 0xb0, 0x49, 0xa1, 0x68, 0xcb, 0xac, 0x4f, 0xd5, 0x1d, 0xe8, 0x57, 0x1,
                           0xee, 0xd6, 0x4,  0xfe, 0x4,  0x58, 0xc,  0xc1, 0xfb, 0x28, 0xab, 0xa4, 0x73, 0x3a, 0x7f};
  uint8_t bytesprops6[] = {0xd0, 0x8b, 0x4b, 0xc1, 0x9f, 0x48};
  uint8_t bytesprops7[] = {0xae, 0xce, 0x93, 0xd1, 0xe8, 0x42, 0x48, 0x40, 0x52, 0x8c, 0x57, 0xb2, 0xad, 0x2f, 0xa5,
                           0xe6, 0x31, 0x8d, 0xe9, 0xf5, 0x3c, 0x66, 0xd3, 0x6c, 0x91, 0x95, 0x81, 0xf1, 0xa0};
  uint8_t bytesprops8[] = {0xf2, 0xd2, 0x54, 0x60, 0xfc, 0x6,  0x85, 0x9d, 0x66,
                           0xa1, 0x74, 0x8c, 0x6b, 0xd,  0x95, 0xe3, 0xea, 0x43};
  uint8_t bytesprops10[] = {0x69, 0x70};
  uint8_t bytesprops9[] = {0x16, 0xd,  0x30, 0xa7, 0x36, 0x92, 0x12, 0x46, 0xf0,
                           0x9a, 0x1c, 0x99, 0x67, 0x1c, 0xb8, 0xd,  0x6f, 0xb1};
  uint8_t bytesprops11[] = {0x68, 0x5c, 0xcc, 0x60, 0x15, 0x47, 0x46, 0xcd, 0xae, 0xf, 0x7f, 0x6d, 0x56, 0x76, 0xe2};
  uint8_t bytesprops12[] = {0x61, 0x4a, 0x50, 0xd6, 0xb, 0x4f, 0xfb, 0x68, 0x69};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7514}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23285}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23559}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5762}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31159}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25789}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops9}, .v = {2, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 154}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 160, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicFilterInvalid [PropMaximumQoS 173]
TEST(Disco5QCTest, Encode26) {
  uint8_t pkt[] = {0xe0, 0x4, 0x8f, 0x2, 0x24, 0xad};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 173}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 143, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection [PropSubscriptionIdentifier 17,PropSubscriptionIdentifier
// 14,PropAuthenticationMethod
// "\248\233\DLE\223Aq\150\153\131`Bj$\208\177\DC3C\135\245e\212r\147A",PropAuthenticationData
// "\DEL5\160\ETX\195\233\188\223\STX`d\208",PropAssignedClientIdentifier
// "/4\227\EM\162\141\225'\t\255\DLE$\192\SI{z\193",PropReasonString "\209_>\143i/\166\133",PropTopicAlias
// 11912,PropMessageExpiryInterval 5860,PropReceiveMaximum 20067,PropWillDelayInterval 32077,PropResponseTopic
// "\CAN[\DC4\232\176\181C\198\179h\187_\212\237\255\DLE\247\NUL\159\208\146P!\231\159",PropResponseTopic
// "\ETX-\239\169\\\ACKz",PropAuthenticationMethod
// "F\247*\181\NAKs\216\134`\145\220\211;2y\219\NUL",PropSessionExpiryInterval 19023,PropResponseInformation
// "Y\STX\DLEl_\ENQ\175\SO\f\174w-VL\DC3[\211\RS\158\211Z\SUB\DLE\aM"]
TEST(Disco5QCTest, Encode27) {
  uint8_t pkt[] = {
      0xe0, 0xbb, 0x1,  0x0,  0xb8, 0x1,  0xb,  0x11, 0xb,  0xe,  0x15, 0x0,  0x18, 0xf8, 0xe9, 0x10, 0xdf, 0x41, 0x71,
      0x96, 0x99, 0x83, 0x60, 0x42, 0x6a, 0x24, 0xd0, 0xb1, 0x13, 0x43, 0x87, 0xf5, 0x65, 0xd4, 0x72, 0x93, 0x41, 0x16,
      0x0,  0xc,  0x7f, 0x35, 0xa0, 0x3,  0xc3, 0xe9, 0xbc, 0xdf, 0x2,  0x60, 0x64, 0xd0, 0x12, 0x0,  0x11, 0x2f, 0x34,
      0xe3, 0x19, 0xa2, 0x8d, 0xe1, 0x27, 0x9,  0xff, 0x10, 0x24, 0xc0, 0xf,  0x7b, 0x7a, 0xc1, 0x1f, 0x0,  0x8,  0xd1,
      0x5f, 0x3e, 0x8f, 0x69, 0x2f, 0xa6, 0x85, 0x23, 0x2e, 0x88, 0x2,  0x0,  0x0,  0x16, 0xe4, 0x21, 0x4e, 0x63, 0x18,
      0x0,  0x0,  0x7d, 0x4d, 0x8,  0x0,  0x19, 0x18, 0x5b, 0x14, 0xe8, 0xb0, 0xb5, 0x43, 0xc6, 0xb3, 0x68, 0xbb, 0x5f,
      0xd4, 0xed, 0xff, 0x10, 0xf7, 0x0,  0x9f, 0xd0, 0x92, 0x50, 0x21, 0xe7, 0x9f, 0x8,  0x0,  0x7,  0x3,  0x2d, 0xef,
      0xa9, 0x5c, 0x6,  0x7a, 0x15, 0x0,  0x11, 0x46, 0xf7, 0x2a, 0xb5, 0x15, 0x73, 0xd8, 0x86, 0x60, 0x91, 0xdc, 0xd3,
      0x3b, 0x32, 0x79, 0xdb, 0x0,  0x11, 0x0,  0x0,  0x4a, 0x4f, 0x1a, 0x0,  0x19, 0x59, 0x2,  0x10, 0x6c, 0x5f, 0x5,
      0xaf, 0xe,  0xc,  0xae, 0x77, 0x2d, 0x56, 0x4c, 0x13, 0x5b, 0xd3, 0x1e, 0x9e, 0xd3, 0x5a, 0x1a, 0x10, 0x7,  0x4d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf8, 0xe9, 0x10, 0xdf, 0x41, 0x71, 0x96, 0x99, 0x83, 0x60, 0x42, 0x6a,
                           0x24, 0xd0, 0xb1, 0x13, 0x43, 0x87, 0xf5, 0x65, 0xd4, 0x72, 0x93, 0x41};
  uint8_t bytesprops1[] = {0x7f, 0x35, 0xa0, 0x3, 0xc3, 0xe9, 0xbc, 0xdf, 0x2, 0x60, 0x64, 0xd0};
  uint8_t bytesprops2[] = {0x2f, 0x34, 0xe3, 0x19, 0xa2, 0x8d, 0xe1, 0x27, 0x9,
                           0xff, 0x10, 0x24, 0xc0, 0xf,  0x7b, 0x7a, 0xc1};
  uint8_t bytesprops3[] = {0xd1, 0x5f, 0x3e, 0x8f, 0x69, 0x2f, 0xa6, 0x85};
  uint8_t bytesprops4[] = {0x18, 0x5b, 0x14, 0xe8, 0xb0, 0xb5, 0x43, 0xc6, 0xb3, 0x68, 0xbb, 0x5f, 0xd4,
                           0xed, 0xff, 0x10, 0xf7, 0x0,  0x9f, 0xd0, 0x92, 0x50, 0x21, 0xe7, 0x9f};
  uint8_t bytesprops5[] = {0x3, 0x2d, 0xef, 0xa9, 0x5c, 0x6, 0x7a};
  uint8_t bytesprops6[] = {0x46, 0xf7, 0x2a, 0xb5, 0x15, 0x73, 0xd8, 0x86, 0x60,
                           0x91, 0xdc, 0xd3, 0x3b, 0x32, 0x79, 0xdb, 0x0};
  uint8_t bytesprops7[] = {0x59, 0x2,  0x10, 0x6c, 0x5f, 0x5,  0xaf, 0xe,  0xc,  0xae, 0x77, 0x2d, 0x56,
                           0x4c, 0x13, 0x5b, 0xd3, 0x1e, 0x9e, 0xd3, 0x5a, 0x1a, 0x10, 0x7,  0x4d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11912}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5860}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20067}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32077}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19023}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSharedSubscriptionsNotSupported [PropServerReference
// "\EMD\178\rD\ENQ%H\203\DLE\231\ETBh\SO7m\204\196\167K\166\GS\200\&9O\150\215\225\GS",PropRetainAvailable
// 155,PropAuthenticationMethod "19W\242i?r;^z\170\169\f\183\134\168\227\DC4;",PropWildcardSubscriptionAvailable
// 65,PropMessageExpiryInterval 12219,PropRequestResponseInformation 65,PropResponseTopic "",PropMessageExpiryInterval
// 28021,PropRequestResponseInformation 74,PropWillDelayInterval 13573,PropContentType
// "~\195e2\131[\n-\b\162\135Y\DC2\212\167\174",PropReceiveMaximum 27401,PropResponseTopic
// "~\206\a4\129g\228#Z0\NAKN\175^<>\159\ETX;\254\187\250\253\131\174\166\FS\156",PropUserProperty
// "\204hY\237QL'\na]\233\163\DC15'z\165\224h\250\185\137\149\138\GS~\139i"
// "\144\150\SI,\191\206\CAN\133",PropMessageExpiryInterval 23185,PropWildcardSubscriptionAvailable
// 169,PropSubscriptionIdentifier 14,PropSharedSubscriptionAvailable 196,PropRetainAvailable 142,PropUserProperty
// "\156\135\242$}8\RS\214\240\ENQ\212\196\FS\142\171\222\221\ACK\233b "
// "&Z\190\GS\132\NUL\243\177\\\237^U\r\247",PropAuthenticationData
// "/G\162\230J\STX\176\231\176\180\134Y\STX]Z\DLE\200\&6mB"]
TEST(Disco5QCTest, Encode28) {
  uint8_t pkt[] = {
      0xe0, 0xfd, 0x1,  0x9e, 0xfa, 0x1,  0x1c, 0x0,  0x1d, 0x19, 0x44, 0xb2, 0xd,  0x44, 0x5,  0x25, 0x48, 0xcb, 0x10,
      0xe7, 0x17, 0x68, 0xe,  0x37, 0x6d, 0xcc, 0xc4, 0xa7, 0x4b, 0xa6, 0x1d, 0xc8, 0x39, 0x4f, 0x96, 0xd7, 0xe1, 0x1d,
      0x25, 0x9b, 0x15, 0x0,  0x13, 0x31, 0x39, 0x57, 0xf2, 0x69, 0x3f, 0x72, 0x3b, 0x5e, 0x7a, 0xaa, 0xa9, 0xc,  0xb7,
      0x86, 0xa8, 0xe3, 0x14, 0x3b, 0x28, 0x41, 0x2,  0x0,  0x0,  0x2f, 0xbb, 0x19, 0x41, 0x8,  0x0,  0x0,  0x2,  0x0,
      0x0,  0x6d, 0x75, 0x19, 0x4a, 0x18, 0x0,  0x0,  0x35, 0x5,  0x3,  0x0,  0x10, 0x7e, 0xc3, 0x65, 0x32, 0x83, 0x5b,
      0xa,  0x2d, 0x8,  0xa2, 0x87, 0x59, 0x12, 0xd4, 0xa7, 0xae, 0x21, 0x6b, 0x9,  0x8,  0x0,  0x1c, 0x7e, 0xce, 0x7,
      0x34, 0x81, 0x67, 0xe4, 0x23, 0x5a, 0x30, 0x15, 0x4e, 0xaf, 0x5e, 0x3c, 0x3e, 0x9f, 0x3,  0x3b, 0xfe, 0xbb, 0xfa,
      0xfd, 0x83, 0xae, 0xa6, 0x1c, 0x9c, 0x26, 0x0,  0x1c, 0xcc, 0x68, 0x59, 0xed, 0x51, 0x4c, 0x27, 0xa,  0x61, 0x5d,
      0xe9, 0xa3, 0x11, 0x35, 0x27, 0x7a, 0xa5, 0xe0, 0x68, 0xfa, 0xb9, 0x89, 0x95, 0x8a, 0x1d, 0x7e, 0x8b, 0x69, 0x0,
      0x8,  0x90, 0x96, 0xf,  0x2c, 0xbf, 0xce, 0x18, 0x85, 0x2,  0x0,  0x0,  0x5a, 0x91, 0x28, 0xa9, 0xb,  0xe,  0x2a,
      0xc4, 0x25, 0x8e, 0x26, 0x0,  0x15, 0x9c, 0x87, 0xf2, 0x24, 0x7d, 0x38, 0x1e, 0xd6, 0xf0, 0x5,  0xd4, 0xc4, 0x1c,
      0x8e, 0xab, 0xde, 0xdd, 0x6,  0xe9, 0x62, 0x20, 0x0,  0xe,  0x26, 0x5a, 0xbe, 0x1d, 0x84, 0x0,  0xf3, 0xb1, 0x5c,
      0xed, 0x5e, 0x55, 0xd,  0xf7, 0x16, 0x0,  0x14, 0x2f, 0x47, 0xa2, 0xe6, 0x4a, 0x2,  0xb0, 0xe7, 0xb0, 0xb4, 0x86,
      0x59, 0x2,  0x5d, 0x5a, 0x10, 0xc8, 0x36, 0x6d, 0x42};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x19, 0x44, 0xb2, 0xd,  0x44, 0x5,  0x25, 0x48, 0xcb, 0x10, 0xe7, 0x17, 0x68, 0xe, 0x37,
                           0x6d, 0xcc, 0xc4, 0xa7, 0x4b, 0xa6, 0x1d, 0xc8, 0x39, 0x4f, 0x96, 0xd7, 0xe1, 0x1d};
  uint8_t bytesprops1[] = {0x31, 0x39, 0x57, 0xf2, 0x69, 0x3f, 0x72, 0x3b, 0x5e, 0x7a,
                           0xaa, 0xa9, 0xc,  0xb7, 0x86, 0xa8, 0xe3, 0x14, 0x3b};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x7e, 0xc3, 0x65, 0x32, 0x83, 0x5b, 0xa,  0x2d,
                           0x8,  0xa2, 0x87, 0x59, 0x12, 0xd4, 0xa7, 0xae};
  uint8_t bytesprops4[] = {0x7e, 0xce, 0x7,  0x34, 0x81, 0x67, 0xe4, 0x23, 0x5a, 0x30, 0x15, 0x4e, 0xaf, 0x5e,
                           0x3c, 0x3e, 0x9f, 0x3,  0x3b, 0xfe, 0xbb, 0xfa, 0xfd, 0x83, 0xae, 0xa6, 0x1c, 0x9c};
  uint8_t bytesprops6[] = {0x90, 0x96, 0xf, 0x2c, 0xbf, 0xce, 0x18, 0x85};
  uint8_t bytesprops5[] = {0xcc, 0x68, 0x59, 0xed, 0x51, 0x4c, 0x27, 0xa,  0x61, 0x5d, 0xe9, 0xa3, 0x11, 0x35,
                           0x27, 0x7a, 0xa5, 0xe0, 0x68, 0xfa, 0xb9, 0x89, 0x95, 0x8a, 0x1d, 0x7e, 0x8b, 0x69};
  uint8_t bytesprops8[] = {0x26, 0x5a, 0xbe, 0x1d, 0x84, 0x0, 0xf3, 0xb1, 0x5c, 0xed, 0x5e, 0x55, 0xd, 0xf7};
  uint8_t bytesprops7[] = {0x9c, 0x87, 0xf2, 0x24, 0x7d, 0x38, 0x1e, 0xd6, 0xf0, 0x5, 0xd4,
                           0xc4, 0x1c, 0x8e, 0xab, 0xde, 0xdd, 0x6,  0xe9, 0x62, 0x20};
  uint8_t bytesprops9[] = {0x2f, 0x47, 0xa2, 0xe6, 0x4a, 0x2,  0xb0, 0xe7, 0xb0, 0xb4,
                           0x86, 0x59, 0x2,  0x5d, 0x5a, 0x10, 0xc8, 0x36, 0x6d, 0x42};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12219}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28021}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13573}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27401}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops5}, .v = {8, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23185}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops7}, .v = {14, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 158, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoProtocolError [PropSessionExpiryInterval 17134,PropReasonString
// "k\149",PropAuthenticationMethod "\177\SOH\241\RSP9\147\174\146\202\142%",PropTopicAlias
// 19959,PropPayloadFormatIndicator 75,PropPayloadFormatIndicator 70,PropTopicAliasMaximum 17295,PropUserProperty
// "`7\248\135\153\220-\219\145\\/\152\FS?O\171\DC4g#[\174D"
// "\181\CAN\204\159\227\159hK\146\189FV^\\\233$Y{\DC2\147\176\&0\ETX\200",PropRetainAvailable 177,PropContentType
// "|\133\238\230\191\255D\ESC\255r9\137\218\184\SUB \239=\218\\\ACK\151xd",PropRequestResponseInformation 222]
TEST(Disco5QCTest, Encode29) {
  uint8_t pkt[] = {0xe0, 0x77, 0x82, 0x75, 0x11, 0x0,  0x0,  0x42, 0xee, 0x1f, 0x0,  0x2,  0x6b, 0x95, 0x15, 0x0,
                   0xc,  0xb1, 0x1,  0xf1, 0x1e, 0x50, 0x39, 0x93, 0xae, 0x92, 0xca, 0x8e, 0x25, 0x23, 0x4d, 0xf7,
                   0x1,  0x4b, 0x1,  0x46, 0x22, 0x43, 0x8f, 0x26, 0x0,  0x16, 0x60, 0x37, 0xf8, 0x87, 0x99, 0xdc,
                   0x2d, 0xdb, 0x91, 0x5c, 0x2f, 0x98, 0x1c, 0x3f, 0x4f, 0xab, 0x14, 0x67, 0x23, 0x5b, 0xae, 0x44,
                   0x0,  0x18, 0xb5, 0x18, 0xcc, 0x9f, 0xe3, 0x9f, 0x68, 0x4b, 0x92, 0xbd, 0x46, 0x56, 0x5e, 0x5c,
                   0xe9, 0x24, 0x59, 0x7b, 0x12, 0x93, 0xb0, 0x30, 0x3,  0xc8, 0x25, 0xb1, 0x3,  0x0,  0x18, 0x7c,
                   0x85, 0xee, 0xe6, 0xbf, 0xff, 0x44, 0x1b, 0xff, 0x72, 0x39, 0x89, 0xda, 0xb8, 0x1a, 0x20, 0xef,
                   0x3d, 0xda, 0x5c, 0x6,  0x97, 0x78, 0x64, 0x19, 0xde};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6b, 0x95};
  uint8_t bytesprops1[] = {0xb1, 0x1, 0xf1, 0x1e, 0x50, 0x39, 0x93, 0xae, 0x92, 0xca, 0x8e, 0x25};
  uint8_t bytesprops3[] = {0xb5, 0x18, 0xcc, 0x9f, 0xe3, 0x9f, 0x68, 0x4b, 0x92, 0xbd, 0x46, 0x56,
                           0x5e, 0x5c, 0xe9, 0x24, 0x59, 0x7b, 0x12, 0x93, 0xb0, 0x30, 0x3,  0xc8};
  uint8_t bytesprops2[] = {0x60, 0x37, 0xf8, 0x87, 0x99, 0xdc, 0x2d, 0xdb, 0x91, 0x5c, 0x2f,
                           0x98, 0x1c, 0x3f, 0x4f, 0xab, 0x14, 0x67, 0x23, 0x5b, 0xae, 0x44};
  uint8_t bytesprops4[] = {0x7c, 0x85, 0xee, 0xe6, 0xbf, 0xff, 0x44, 0x1b, 0xff, 0x72, 0x39, 0x89,
                           0xda, 0xb8, 0x1a, 0x20, 0xef, 0x3d, 0xda, 0x5c, 0x6,  0x97, 0x78, 0x64};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17134}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19959}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17295}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops2}, .v = {24, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 222}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 130, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServerBusy [PropTopicAlias 22226,PropWildcardSubscriptionAvailable
// 179,PropPayloadFormatIndicator 241,PropAuthenticationData "}D#\230\EM\153\170\180\175\198T\ETXI",PropServerReference
// "\186h\174\\\SOH\184\180\&7\180\203\bH\240f",PropTopicAlias 5079,PropServerReference "jZ(\b\RS!O\252*>j{{?%c\""]
TEST(Disco5QCTest, Encode30) {
  uint8_t pkt[] = {0xe0, 0x41, 0x89, 0x3f, 0x23, 0x56, 0xd2, 0x28, 0xb3, 0x1,  0xf1, 0x16, 0x0,  0xd,  0x7d, 0x44, 0x23,
                   0xe6, 0x19, 0x99, 0xaa, 0xb4, 0xaf, 0xc6, 0x54, 0x3,  0x49, 0x1c, 0x0,  0xe,  0xba, 0x68, 0xae, 0x5c,
                   0x1,  0xb8, 0xb4, 0x37, 0xb4, 0xcb, 0x8,  0x48, 0xf0, 0x66, 0x23, 0x13, 0xd7, 0x1c, 0x0,  0x11, 0x6a,
                   0x5a, 0x28, 0x8,  0x1e, 0x21, 0x4f, 0xfc, 0x2a, 0x3e, 0x6a, 0x7b, 0x7b, 0x3f, 0x25, 0x63, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7d, 0x44, 0x23, 0xe6, 0x19, 0x99, 0xaa, 0xb4, 0xaf, 0xc6, 0x54, 0x3, 0x49};
  uint8_t bytesprops1[] = {0xba, 0x68, 0xae, 0x5c, 0x1, 0xb8, 0xb4, 0x37, 0xb4, 0xcb, 0x8, 0x48, 0xf0, 0x66};
  uint8_t bytesprops2[] = {0x6a, 0x5a, 0x28, 0x8,  0x1e, 0x21, 0x4f, 0xfc, 0x2a,
                           0x3e, 0x6a, 0x7b, 0x7b, 0x3f, 0x25, 0x63, 0x22};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22226}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5079}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 137, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
