#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DC1\"\211\207\n{Z%\217\200gfi\182\210US5", _pubPktID = 0, _pubBody =
// "\DEL\211\247\135\US>`\222\&5\231AJo1JP\244\231\252\&7\211\&32]", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x38, 0x2c, 0x0,  0x12, 0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9, 0xc8, 0x67, 0x66,
                   0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35, 0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35, 0xe7,
                   0x41, 0x4a, 0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  uint8_t topic_bytes[] = {0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9,
                           0xc8, 0x67, 0x66, 0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35, 0xe7, 0x41, 0x4a,
                         0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DC1\"\211\207\n{Z%\217\200gfi\182\210US5", _pubPktID = 0, _pubBody =
// "\DEL\211\247\135\US>`\222\&5\231AJo1JP\244\231\252\&7\211\&32]", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x38, 0x2c, 0x0,  0x12, 0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9, 0xc8, 0x67, 0x66,
                   0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35, 0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35, 0xe7,
                   0x41, 0x4a, 0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9,
                               0xc8, 0x67, 0x66, 0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35, 0xe7, 0x41, 0x4a,
                              0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\233\212", _pubPktID = 10216,
// _pubBody = "\241", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x32, 0x7, 0x0, 0x2, 0xe9, 0xd4, 0x27, 0xe8, 0xf1};
  uint8_t topic_bytes[] = {0xe9, 0xd4};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 10216, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\233\212", _pubPktID = 10216,
// _pubBody = "\241", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x32, 0x7, 0x0, 0x2, 0xe9, 0xd4, 0x27, 0xe8, 0xf1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe9, 0xd4};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf1};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10216);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "}\162\DC3\157\161\140z\190\148\228\254\EOTk\211\&1\133\SI\188y\142\134e", _pubPktID = 11026, _pubBody =
// "\v/:\b\150\237Ih\224]\US\181R[r\179\234\185", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x3a, 0x2c, 0x0,  0x16, 0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe, 0x4,
                   0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65, 0x2b, 0x12, 0xb,  0x2f, 0x3a, 0x8,
                   0x96, 0xed, 0x49, 0x68, 0xe0, 0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  uint8_t topic_bytes[] = {0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe,
                           0x4,  0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb,  0x2f, 0x3a, 0x8,  0x96, 0xed, 0x49, 0x68, 0xe0,
                         0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 11026, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "}\162\DC3\157\161\140z\190\148\228\254\EOTk\211\&1\133\SI\188y\142\134e", _pubPktID = 11026, _pubBody =
// "\v/:\b\150\237Ih\224]\US\181R[r\179\234\185", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x3a, 0x2c, 0x0,  0x16, 0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe, 0x4,
                   0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65, 0x2b, 0x12, 0xb,  0x2f, 0x3a, 0x8,
                   0x96, 0xed, 0x49, 0x68, 0xe0, 0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe,
                               0x4,  0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb,  0x2f, 0x3a, 0x8,  0x96, 0xed, 0x49, 0x68, 0xe0,
                              0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11026);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "'$k\221BT0a\ETB", _pubPktID = 21319,
// _pubBody = "\149", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x3a, 0xe, 0x0, 0x9, 0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17, 0x53, 0x47, 0x95};
  uint8_t topic_bytes[] = {0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 21319, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "'$k\221BT0a\ETB", _pubPktID = 21319,
// _pubBody = "\149", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x3a, 0xe, 0x0, 0x9, 0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17, 0x53, 0x47, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x95};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 21319);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\US\134\217^\225\USI\SOH%\234]\SUB\251\158\ENQ\188\140@\224\ETX\185}", _pubPktID = 0, _pubBody = "\222", _pubProps =
// []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x30, 0x19, 0x0,  0x16, 0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea,
                   0x5d, 0x1a, 0xfb, 0x9e, 0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d, 0xde};
  uint8_t topic_bytes[] = {0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea, 0x5d,
                           0x1a, 0xfb, 0x9e, 0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\US\134\217^\225\USI\SOH%\234]\SUB\251\158\ENQ\188\140@\224\ETX\185}", _pubPktID = 0, _pubBody = "\222", _pubProps =
// []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x30, 0x19, 0x0,  0x16, 0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea,
                   0x5d, 0x1a, 0xfb, 0x9e, 0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d, 0xde};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea, 0x5d,
                               0x1a, 0xfb, 0x9e, 0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xde};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\152\168e\228f1ic\227\250", _pubPktID
// = 0, _pubBody = "\195\&1\199\231\246bO,\"\146\SOE`:", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x39, 0x1a, 0x0,  0xa,  0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa,
                   0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c, 0x22, 0x92, 0xe,  0x45, 0x60, 0x3a};
  uint8_t topic_bytes[] = {0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c, 0x22, 0x92, 0xe, 0x45, 0x60, 0x3a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\152\168e\228f1ic\227\250", _pubPktID
// = 0, _pubBody = "\195\&1\199\231\246bO,\"\146\SOE`:", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x39, 0x1a, 0x0,  0xa,  0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa,
                   0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c, 0x22, 0x92, 0xe,  0x45, 0x60, 0x3a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c, 0x22, 0x92, 0xe, 0x45, 0x60, 0x3a};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\240\218\212Wy", _pubPktID = 11258,
// _pubBody = "\212F\158\240\144\160AN", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x33, 0x11, 0x0,  0x5,  0xf0, 0xda, 0xd4, 0x57, 0x79, 0x2b,
                   0xfa, 0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  uint8_t topic_bytes[] = {0xf0, 0xda, 0xd4, 0x57, 0x79};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 11258, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\240\218\212Wy", _pubPktID = 11258,
// _pubBody = "\212F\158\240\144\160AN", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x33, 0x11, 0x0,  0x5,  0xf0, 0xda, 0xd4, 0x57, 0x79, 0x2b,
                   0xfa, 0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf0, 0xda, 0xd4, 0x57, 0x79};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 11258);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\204s\226@u&7F!\EM\194o\133\175\187\203<\DC1;\239Q\RS\251\236J\167a\247\220", _pubPktID = 0, _pubBody =
// "\159(\138\244\237\128L\179\197a", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x31, 0x29, 0x0,  0x1d, 0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2,
                   0x6f, 0x85, 0xaf, 0xbb, 0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7,
                   0x61, 0xf7, 0xdc, 0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  uint8_t topic_bytes[] = {0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2, 0x6f, 0x85, 0xaf, 0xbb,
                           0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7, 0x61, 0xf7, 0xdc};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\204s\226@u&7F!\EM\194o\133\175\187\203<\DC1;\239Q\RS\251\236J\167a\247\220", _pubPktID = 0, _pubBody =
// "\159(\138\244\237\128L\179\197a", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x31, 0x29, 0x0,  0x1d, 0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2,
                   0x6f, 0x85, 0xaf, 0xbb, 0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7,
                   0x61, 0xf7, 0xdc, 0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2, 0x6f, 0x85, 0xaf, 0xbb,
                               0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7, 0x61, 0xf7, 0xdc};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "~\237S\145l\t\ACK0\CAN\236\137G!\FS~l\156\DC3\n>\135", _pubPktID = 0, _pubBody =
// "\NAK\255WE\SIQC\246\161\173\128\&6", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x31, 0x23, 0x0,  0x15, 0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18,
                   0xec, 0x89, 0x47, 0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87, 0x15,
                   0xff, 0x57, 0x45, 0xf,  0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  uint8_t topic_bytes[] = {0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18, 0xec, 0x89,
                           0x47, 0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x15, 0xff, 0x57, 0x45, 0xf, 0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "~\237S\145l\t\ACK0\CAN\236\137G!\FS~l\156\DC3\n>\135", _pubPktID = 0, _pubBody =
// "\NAK\255WE\SIQC\246\161\173\128\&6", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x31, 0x23, 0x0,  0x15, 0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18,
                   0xec, 0x89, 0x47, 0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87, 0x15,
                   0xff, 0x57, 0x45, 0xf,  0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18, 0xec, 0x89,
                               0x47, 0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x15, 0xff, 0x57, 0x45, 0xf, 0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\168q\180\235Y\176\233\DC2z6\175%\SOH\200c&\131\DC2\134#\151\139\&2\ETX\130\DC4", _pubPktID = 2807, _pubBody =
// "`\EOT\158\236\t\225\128\235\197\172aw\173\147\&8\DC3\EOT\244+\249C)zO\156\191\199", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x3a, 0x39, 0x0,  0x1a, 0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf,
                   0x25, 0x1,  0xc8, 0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14,
                   0xa,  0xf7, 0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb, 0xc5, 0xac, 0x61, 0x77, 0xad,
                   0x93, 0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  uint8_t topic_bytes[] = {0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf, 0x25, 0x1,
                           0xc8, 0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb, 0xc5, 0xac, 0x61, 0x77, 0xad, 0x93,
                         0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 2807, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\168q\180\235Y\176\233\DC2z6\175%\SOH\200c&\131\DC2\134#\151\139\&2\ETX\130\DC4", _pubPktID = 2807, _pubBody =
// "`\EOT\158\236\t\225\128\235\197\172aw\173\147\&8\DC3\EOT\244+\249C)zO\156\191\199", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x3a, 0x39, 0x0,  0x1a, 0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf,
                   0x25, 0x1,  0xc8, 0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14,
                   0xa,  0xf7, 0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb, 0xc5, 0xac, 0x61, 0x77, 0xad,
                   0x93, 0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf, 0x25, 0x1,
                               0xc8, 0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb, 0xc5, 0xac, 0x61, 0x77, 0xad, 0x93,
                              0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2807);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207\198\194\214\STX\139\&4_\212\172\NAKu:\233\181_\247\164\SUB", _pubPktID = 13284, _pubBody =
// "\154\166c\188;\235r\148\223\SYN\DEL", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x3c, 0x22, 0x0,  0x13, 0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f,
                   0xd4, 0xac, 0x15, 0x75, 0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a, 0x33,
                   0xe4, 0x9a, 0xa6, 0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  uint8_t topic_bytes[] = {0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f, 0xd4, 0xac,
                           0x15, 0x75, 0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9a, 0xa6, 0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 13284, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207\198\194\214\STX\139\&4_\212\172\NAKu:\233\181_\247\164\SUB", _pubPktID = 13284, _pubBody =
// "\154\166c\188;\235r\148\223\SYN\DEL", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x3c, 0x22, 0x0,  0x13, 0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f,
                   0xd4, 0xac, 0x15, 0x75, 0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a, 0x33,
                   0xe4, 0x9a, 0xa6, 0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f, 0xd4, 0xac,
                               0x15, 0x75, 0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a};
  lwmqtt_string_t exp_topic = {19, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9a, 0xa6, 0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 13284);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 19);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\159\US\147\DC3i\FS\CAN@\178\DC2\202\145>\185\195\148\f3@ \SOH\202\166\182\STX\v\130\SYN", _pubPktID = 25675,
// _pubBody = "\138\158G\154\229\140)?>\221\211<\190", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x3d, 0x2d, 0x0,  0x1c, 0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91,
                   0x3e, 0xb9, 0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16,
                   0x64, 0x4b, 0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  uint8_t topic_bytes[] = {0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91, 0x3e, 0xb9,
                           0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 25675, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\159\US\147\DC3i\FS\CAN@\178\DC2\202\145>\185\195\148\f3@ \SOH\202\166\182\STX\v\130\SYN", _pubPktID = 25675,
// _pubBody = "\138\158G\154\229\140)?>\221\211<\190", _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x3d, 0x2d, 0x0,  0x1c, 0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91,
                   0x3e, 0xb9, 0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16,
                   0x64, 0x4b, 0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91, 0x3e, 0xb9,
                               0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25675);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\185\246\SOH*\248(\178k\\\215\174",
// _pubPktID = 11115, _pubBody = ".\DC1\fEQhj\183\224@\215\"\231B\243L\206 \210\231\178", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x32, 0x24, 0x0,  0xb,  0xb9, 0xf6, 0x1,  0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c,
                   0xd7, 0xae, 0x2b, 0x6b, 0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0,
                   0x40, 0xd7, 0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  uint8_t topic_bytes[] = {0xb9, 0xf6, 0x1, 0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c, 0xd7, 0xae};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0, 0x40, 0xd7,
                         0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 11115, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\185\246\SOH*\248(\178k\\\215\174",
// _pubPktID = 11115, _pubBody = ".\DC1\fEQhj\183\224@\215\"\231B\243L\206 \210\231\178", _pubProps = []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x32, 0x24, 0x0,  0xb,  0xb9, 0xf6, 0x1,  0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c,
                   0xd7, 0xae, 0x2b, 0x6b, 0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0,
                   0x40, 0xd7, 0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb9, 0xf6, 0x1, 0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c, 0xd7, 0xae};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0, 0x40, 0xd7,
                              0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11115);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\186\171$\215\213", _pubPktID =
// 24590, _pubBody = "En.&\166\184\215\153", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x34, 0x11, 0x0,  0x5,  0xba, 0xab, 0x24, 0xd7, 0xd5, 0x60,
                   0xe,  0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  uint8_t topic_bytes[] = {0xba, 0xab, 0x24, 0xd7, 0xd5};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 24590, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\186\171$\215\213", _pubPktID =
// 24590, _pubBody = "En.&\166\184\215\153", _pubProps = []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x34, 0x11, 0x0,  0x5,  0xba, 0xab, 0x24, 0xd7, 0xd5, 0x60,
                   0xe,  0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xba, 0xab, 0x24, 0xd7, 0xd5};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 24590);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\197R\255Y+\ACK", _pubPktID = 17354,
// _pubBody = "_\191\168\153\207\229\204<\169\234j\153A\153/^I\217,\159/\161\222\252?6", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x3b, 0x24, 0x0,  0x6,  0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6,  0x43, 0xca, 0x5f,
                   0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41, 0x99,
                   0x2f, 0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  uint8_t topic_bytes[] = {0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5f, 0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41,
                         0x99, 0x2f, 0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 17354, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\197R\255Y+\ACK", _pubPktID = 17354,
// _pubBody = "_\191\168\153\207\229\204<\169\234j\153A\153/^I\217,\159/\161\222\252?6", _pubProps = []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x3b, 0x24, 0x0,  0x6,  0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6,  0x43, 0xca, 0x5f,
                   0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41, 0x99,
                   0x2f, 0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5f, 0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41,
                              0x99, 0x2f, 0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17354);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\181h\206\206#\148<\227\196\202?\ENQ\255\RSp\196\162\184\171\224", _pubPktID = 9053, _pubBody =
// "W\232(5\208_\210\199B\249E\178\157\128", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x3c, 0x26, 0x0,  0x14, 0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca,
                   0x3f, 0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0, 0x23, 0x5d, 0x57, 0xe8,
                   0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  uint8_t topic_bytes[] = {0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca,
                           0x3f, 0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x57, 0xe8, 0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 9053, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\181h\206\206#\148<\227\196\202?\ENQ\255\RSp\196\162\184\171\224", _pubPktID = 9053, _pubBody =
// "W\232(5\208_\210\199B\249E\178\157\128", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x3c, 0x26, 0x0,  0x14, 0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca,
                   0x3f, 0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0, 0x23, 0x5d, 0x57, 0xe8,
                   0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca,
                               0x3f, 0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x57, 0xe8, 0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 9053);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\147\174\SYN ", _pubPktID = 0,
// _pubBody = "\155\DC3A*\157dh!\177=7\233\225\DLE|\EM\145", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x39, 0x17, 0x0,  0x4,  0x93, 0xae, 0x16, 0x20, 0x9b, 0x13, 0x41, 0x2a, 0x9d,
                   0x64, 0x68, 0x21, 0xb1, 0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  uint8_t topic_bytes[] = {0x93, 0xae, 0x16, 0x20};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x13, 0x41, 0x2a, 0x9d, 0x64, 0x68, 0x21, 0xb1,
                         0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\147\174\SYN ", _pubPktID = 0,
// _pubBody = "\155\DC3A*\157dh!\177=7\233\225\DLE|\EM\145", _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x39, 0x17, 0x0,  0x4,  0x93, 0xae, 0x16, 0x20, 0x9b, 0x13, 0x41, 0x2a, 0x9d,
                   0x64, 0x68, 0x21, 0xb1, 0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x93, 0xae, 0x16, 0x20};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x13, 0x41, 0x2a, 0x9d, 0x64, 0x68, 0x21, 0xb1,
                              0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "t\183\232G\148\143\148J\151\141\197\&0\196\244?(x\225\237\EM", _pubPktID = 0, _pubBody =
// "\ESC\231\EM\255\149&\\p\RS\173+\194\173\204\183u\131G\218", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x38, 0x29, 0x0,  0x14, 0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d, 0xc5,
                   0x30, 0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19, 0x1b, 0xe7, 0x19, 0xff, 0x95, 0x26,
                   0x5c, 0x70, 0x1e, 0xad, 0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  uint8_t topic_bytes[] = {0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d,
                           0xc5, 0x30, 0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1b, 0xe7, 0x19, 0xff, 0x95, 0x26, 0x5c, 0x70, 0x1e, 0xad,
                         0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "t\183\232G\148\143\148J\151\141\197\&0\196\244?(x\225\237\EM", _pubPktID = 0, _pubBody =
// "\ESC\231\EM\255\149&\\p\RS\173+\194\173\204\183u\131G\218", _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x38, 0x29, 0x0,  0x14, 0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d, 0xc5,
                   0x30, 0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19, 0x1b, 0xe7, 0x19, 0xff, 0x95, 0x26,
                   0x5c, 0x70, 0x1e, 0xad, 0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d,
                               0xc5, 0x30, 0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1b, 0xe7, 0x19, 0xff, 0x95, 0x26, 0x5c, 0x70, 0x1e, 0xad,
                              0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\245l-\185\147\\\ai\199\183\216s\232\\\248\DC4\199\231[\DC4\139", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x30, 0x17, 0x0,  0x0,  0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7,
                   0xb7, 0xd8, 0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7, 0xb7, 0xd8,
                         0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\245l-\185\147\\\ai\199\183\216s\232\\\248\DC4\199\231[\DC4\139", _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x30, 0x17, 0x0,  0x0,  0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7,
                   0xb7, 0xd8, 0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7, 0xb7, 0xd8,
                              0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "B&&P~\USwi\200\237U\SI0[8\205\ETX\US\171\236", _pubPktID = 20579, _pubBody =
// "\160|,\236\153`\132S\ETBj\210-v\ETB\US\246\DC4>iK\158\SOH\141\250", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x3d, 0x30, 0x0,  0x14, 0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed, 0x55, 0xf,  0x30,
                   0x5b, 0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec, 0x50, 0x63, 0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53,
                   0x17, 0x6a, 0xd2, 0x2d, 0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  uint8_t topic_bytes[] = {0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed,
                           0x55, 0xf,  0x30, 0x5b, 0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53, 0x17, 0x6a, 0xd2, 0x2d,
                         0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 20579, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "B&&P~\USwi\200\237U\SI0[8\205\ETX\US\171\236", _pubPktID = 20579, _pubBody =
// "\160|,\236\153`\132S\ETBj\210-v\ETB\US\246\DC4>iK\158\SOH\141\250", _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x3d, 0x30, 0x0,  0x14, 0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed, 0x55, 0xf,  0x30,
                   0x5b, 0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec, 0x50, 0x63, 0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53,
                   0x17, 0x6a, 0xd2, 0x2d, 0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed,
                               0x55, 0xf,  0x30, 0x5b, 0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53, 0x17, 0x6a, 0xd2, 0x2d,
                              0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 20579);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Wo\249\180\STXZ\FS\218Co_\137a\140\&9^\232\186\143\230", _pubPktID = 10935, _pubBody =
// "\US\177vw\219K\147TS\150\&9", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x3d, 0x23, 0x0,  0x14, 0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43,
                   0x6f, 0x5f, 0x89, 0x61, 0x8c, 0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6, 0x2a, 0xb7,
                   0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  uint8_t topic_bytes[] = {0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43, 0x6f,
                           0x5f, 0x89, 0x61, 0x8c, 0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10935, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Wo\249\180\STXZ\FS\218Co_\137a\140\&9^\232\186\143\230", _pubPktID = 10935, _pubBody =
// "\US\177vw\219K\147TS\150\&9", _pubProps = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x3d, 0x23, 0x0,  0x14, 0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43,
                   0x6f, 0x5f, 0x89, 0x61, 0x8c, 0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6, 0x2a, 0xb7,
                   0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43, 0x6f,
                               0x5f, 0x89, 0x61, 0x8c, 0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10935);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "z\187}l", _pubPktID = 11378,
// _pubBody = "\186\&7\190\f\178\235\212\242\166(\ENQ\181\SUB\234\&4\149H\SYN6\197\247\207", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x34, 0x1e, 0x0,  0x4,  0x7a, 0xbb, 0x7d, 0x6c, 0x2c, 0x72, 0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb,
                   0xd4, 0xf2, 0xa6, 0x28, 0x5,  0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  uint8_t topic_bytes[] = {0x7a, 0xbb, 0x7d, 0x6c};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb, 0xd4, 0xf2, 0xa6, 0x28, 0x5,
                         0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 11378, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "z\187}l", _pubPktID = 11378,
// _pubBody = "\186\&7\190\f\178\235\212\242\166(\ENQ\181\SUB\234\&4\149H\SYN6\197\247\207", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x34, 0x1e, 0x0,  0x4,  0x7a, 0xbb, 0x7d, 0x6c, 0x2c, 0x72, 0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb,
                   0xd4, 0xf2, 0xa6, 0x28, 0x5,  0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7a, 0xbb, 0x7d, 0x6c};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb, 0xd4, 0xf2, 0xa6, 0x28, 0x5,
                              0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11378);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\252\190\&8\149\&2\128\192{C\128\194\197\170g\a_\DC4\DELI(\151\218\172\vBJ\234\221", _pubPktID = 0, _pubBody =
// "q\145\203\144\245\153\&3\220g\186\&9YVh\DEL\232\&2V\212\201\&4\172?\189S\159<\187W", _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x39, 0x3b, 0x0,  0x1c, 0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5,
                   0xaa, 0x67, 0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd,
                   0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f, 0xe8,
                   0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  uint8_t topic_bytes[] = {0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5, 0xaa, 0x67,
                           0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f,
                         0xe8, 0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\252\190\&8\149\&2\128\192{C\128\194\197\170g\a_\DC4\DELI(\151\218\172\vBJ\234\221", _pubPktID = 0, _pubBody =
// "q\145\203\144\245\153\&3\220g\186\&9YVh\DEL\232\&2V\212\201\&4\172?\189S\159<\187W", _pubProps = []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x39, 0x3b, 0x0,  0x1c, 0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5,
                   0xaa, 0x67, 0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd,
                   0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f, 0xe8,
                   0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5, 0xaa, 0x67,
                               0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f,
                              0xe8, 0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\a\159\222j\236\175\242\&158\148@P\139o\150c\EOT\191\131\204\SUB\205\201\135W\193a", _pubPktID = 24983, _pubBody =
// "\214M\130;K\239#\136V\STX\242C\n\153\208l\129s\196\171\DC1P\193\218\128", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x35, 0x39, 0x0,  0x1c, 0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94,
                   0x40, 0x50, 0x8b, 0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57,
                   0xc1, 0x61, 0x61, 0x97, 0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2,
                   0x43, 0xa,  0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  uint8_t topic_bytes[] = {0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94, 0x40, 0x50, 0x8b,
                           0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57, 0xc1, 0x61};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2, 0x43, 0xa,
                         0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 24983, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\a\159\222j\236\175\242\&158\148@P\139o\150c\EOT\191\131\204\SUB\205\201\135W\193a", _pubPktID = 24983, _pubBody =
// "\214M\130;K\239#\136V\STX\242C\n\153\208l\129s\196\171\DC1P\193\218\128", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x35, 0x39, 0x0,  0x1c, 0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94,
                   0x40, 0x50, 0x8b, 0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57,
                   0xc1, 0x61, 0x61, 0x97, 0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2,
                   0x43, 0xa,  0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94, 0x40, 0x50, 0x8b,
                               0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57, 0xc1, 0x61};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2, 0x43, 0xa,
                              0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 24983);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "[5,\230\144\137\236\202\179\STX\t\201\234\136\166", _pubPktID = 10487, _pubBody =
// "\DLE\ACK\165~\155\217?\249\195\GS\145\179=i'\223Wd\159\248<\223$", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x34, 0x2a, 0x0,  0xf,  0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2,  0x9,
                   0xc9, 0xea, 0x88, 0xa6, 0x28, 0xf7, 0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3,
                   0x1d, 0x91, 0xb3, 0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  uint8_t topic_bytes[] = {0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2, 0x9, 0xc9, 0xea, 0x88, 0xa6};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3, 0x1d, 0x91, 0xb3,
                         0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 10487, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "[5,\230\144\137\236\202\179\STX\t\201\234\136\166", _pubPktID = 10487, _pubBody =
// "\DLE\ACK\165~\155\217?\249\195\GS\145\179=i'\223Wd\159\248<\223$", _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x34, 0x2a, 0x0,  0xf,  0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2,  0x9,
                   0xc9, 0xea, 0x88, 0xa6, 0x28, 0xf7, 0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3,
                   0x1d, 0x91, 0xb3, 0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2, 0x9, 0xc9, 0xea, 0x88, 0xa6};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3, 0x1d, 0x91, 0xb3,
                              0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10487);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "n\145", _pubPktID = 14089, _pubBody
// = "\210\210>L\150\rD\161j\204SG\219\226\165\205k\208\&4\ENQ\154t\DC1\148D:\US<\141\149", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x35, 0x24, 0x0,  0x2,  0x6e, 0x91, 0x37, 0x9,  0xd2, 0xd2, 0x3e, 0x4c, 0x96,
                   0xd,  0x44, 0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5, 0xcd, 0x6b, 0xd0,
                   0x34, 0x5,  0x9a, 0x74, 0x11, 0x94, 0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  uint8_t topic_bytes[] = {0x6e, 0x91};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd2, 0xd2, 0x3e, 0x4c, 0x96, 0xd,  0x44, 0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5,
                         0xcd, 0x6b, 0xd0, 0x34, 0x5,  0x9a, 0x74, 0x11, 0x94, 0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 14089, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "n\145", _pubPktID = 14089, _pubBody
// = "\210\210>L\150\rD\161j\204SG\219\226\165\205k\208\&4\ENQ\154t\DC1\148D:\US<\141\149", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x35, 0x24, 0x0,  0x2,  0x6e, 0x91, 0x37, 0x9,  0xd2, 0xd2, 0x3e, 0x4c, 0x96,
                   0xd,  0x44, 0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5, 0xcd, 0x6b, 0xd0,
                   0x34, 0x5,  0x9a, 0x74, 0x11, 0x94, 0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6e, 0x91};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd2, 0xd2, 0x3e, 0x4c, 0x96, 0xd,  0x44, 0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5,
                              0xcd, 0x6b, 0xd0, 0x34, 0x5,  0x9a, 0x74, 0x11, 0x94, 0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14089);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\199d\158\162p\SYNZ2{\228j\t\233'\211K\254\FSK\133%\252", _pubPktID = 0, _pubBody = "\SYN\ESC\r\233\&1\216\237",
// _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x38, 0x1f, 0x0,  0x16, 0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a, 0x9, 0xe9,
                   0x27, 0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc, 0x16, 0x1b, 0xd,  0xe9, 0x31, 0xd8, 0xed};
  uint8_t topic_bytes[] = {0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a,
                           0x9,  0xe9, 0x27, 0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x16, 0x1b, 0xd, 0xe9, 0x31, 0xd8, 0xed};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\199d\158\162p\SYNZ2{\228j\t\233'\211K\254\FSK\133%\252", _pubPktID = 0, _pubBody = "\SYN\ESC\r\233\&1\216\237",
// _pubProps = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x38, 0x1f, 0x0,  0x16, 0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a, 0x9, 0xe9,
                   0x27, 0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc, 0x16, 0x1b, 0xd,  0xe9, 0x31, 0xd8, 0xed};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a,
                               0x9,  0xe9, 0x27, 0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x16, 0x1b, 0xd, 0xe9, 0x31, 0xd8, 0xed};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\DELB\171!\189\RS\129\132", _pubPktID
// = 1997, _pubBody = "P\169", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x3d, 0xe, 0x0, 0x8, 0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84, 0x7, 0xcd, 0x50, 0xa9};
  uint8_t topic_bytes[] = {0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x50, 0xa9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 1997, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\DELB\171!\189\RS\129\132", _pubPktID
// = 1997, _pubBody = "P\169", _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x3d, 0xe, 0x0, 0x8, 0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84, 0x7, 0xcd, 0x50, 0xa9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x50, 0xa9};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1997);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\138.\149\DC3{U\CANP\144",
// _pubPktID = 16970, _pubBody = "4\163\252\250\166\SUB\245\158", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x32, 0x15, 0x0,  0x9,  0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50,
                   0x90, 0x42, 0x4a, 0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  uint8_t topic_bytes[] = {0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50, 0x90};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 16970, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\138.\149\DC3{U\CANP\144",
// _pubPktID = 16970, _pubBody = "4\163\252\250\166\SUB\245\158", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x32, 0x15, 0x0,  0x9,  0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50,
                   0x90, 0x42, 0x4a, 0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50, 0x90};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16970);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC3r\ETX\ETXZ\SOH", _pubPktID = 0,
// _pubBody = "\129\209\171[\DC4B\234\ETX\ACK\177\133\&9\ENQf\128\DC1A\185\236M\134qT}\\g\159&;g", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x31, 0x26, 0x0,  0x6,  0x13, 0x72, 0x3,  0x3,  0x5a, 0x1,  0x81, 0xd1, 0xab, 0x5b,
                   0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80, 0x11, 0x41, 0xb9,
                   0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  uint8_t topic_bytes[] = {0x13, 0x72, 0x3, 0x3, 0x5a, 0x1};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x81, 0xd1, 0xab, 0x5b, 0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80,
                         0x11, 0x41, 0xb9, 0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC3r\ETX\ETXZ\SOH", _pubPktID = 0,
// _pubBody = "\129\209\171[\DC4B\234\ETX\ACK\177\133\&9\ENQf\128\DC1A\185\236M\134qT}\\g\159&;g", _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x31, 0x26, 0x0,  0x6,  0x13, 0x72, 0x3,  0x3,  0x5a, 0x1,  0x81, 0xd1, 0xab, 0x5b,
                   0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80, 0x11, 0x41, 0xb9,
                   0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x13, 0x72, 0x3, 0x3, 0x5a, 0x1};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x81, 0xd1, 0xab, 0x5b, 0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80,
                              0x11, 0x41, 0xb9, 0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DC1\"\211\207\n{Z%\217\200gfi\182\210US5", _pubPktID = 0, _pubBody =
// "\DEL\211\247\135\US>`\222\&5\231AJo1JP\244\231\252\&7\211\&32]", _pubProps = [PropReasonString
// "\167\252e\ESC7\188\&2\r\174\255\205\221",PropWillDelayInterval 4231,PropTopicAlias 29603,PropSubscriptionIdentifier
// 14,PropReasonString "\"\168\DC1x;\218\STX\SUBa\230\159\222\187",PropTopicAlias 3637,PropResponseTopic
// "{\166\r\223\SYN\221",PropTopicAliasMaximum 29040,PropTopicAlias 10048,PropAssignedClientIdentifier
// "\198&\152",PropTopicAliasMaximum 2366,PropMessageExpiryInterval 5348]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {0x38, 0x76, 0x0,  0x12, 0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9, 0xc8, 0x67,
                   0x66, 0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35, 0x49, 0x1f, 0x0,  0xc,  0xa7, 0xfc, 0x65, 0x1b,
                   0x37, 0xbc, 0x32, 0xd,  0xae, 0xff, 0xcd, 0xdd, 0x18, 0x0,  0x0,  0x10, 0x87, 0x23, 0x73,
                   0xa3, 0xb,  0xe,  0x1f, 0x0,  0xd,  0x22, 0xa8, 0x11, 0x78, 0x3b, 0xda, 0x2,  0x1a, 0x61,
                   0xe6, 0x9f, 0xde, 0xbb, 0x23, 0xe,  0x35, 0x8,  0x0,  0x6,  0x7b, 0xa6, 0xd,  0xdf, 0x16,
                   0xdd, 0x22, 0x71, 0x70, 0x23, 0x27, 0x40, 0x12, 0x0,  0x3,  0xc6, 0x26, 0x98, 0x22, 0x9,
                   0x3e, 0x2,  0x0,  0x0,  0x14, 0xe4, 0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35,
                   0xe7, 0x41, 0x4a, 0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  uint8_t topic_bytes[] = {0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9,
                           0xc8, 0x67, 0x66, 0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35, 0xe7, 0x41, 0x4a,
                         0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0xa7, 0xfc, 0x65, 0x1b, 0x37, 0xbc, 0x32, 0xd, 0xae, 0xff, 0xcd, 0xdd};
  uint8_t bytesprops1[] = {0x22, 0xa8, 0x11, 0x78, 0x3b, 0xda, 0x2, 0x1a, 0x61, 0xe6, 0x9f, 0xde, 0xbb};
  uint8_t bytesprops2[] = {0x7b, 0xa6, 0xd, 0xdf, 0x16, 0xdd};
  uint8_t bytesprops3[] = {0xc6, 0x26, 0x98};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4231}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29603}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3637}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29040}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10048}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2366}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5348}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\DC1\"\211\207\n{Z%\217\200gfi\182\210US5", _pubPktID = 0, _pubBody =
// "\DEL\211\247\135\US>`\222\&5\231AJo1JP\244\231\252\&7\211\&32]", _pubProps = [PropReasonString
// "\167\252e\ESC7\188\&2\r\174\255\205\221",PropWillDelayInterval 4231,PropTopicAlias 29603,PropSubscriptionIdentifier
// 14,PropReasonString "\"\168\DC1x;\218\STX\SUBa\230\159\222\187",PropTopicAlias 3637,PropResponseTopic
// "{\166\r\223\SYN\221",PropTopicAliasMaximum 29040,PropTopicAlias 10048,PropAssignedClientIdentifier
// "\198&\152",PropTopicAliasMaximum 2366,PropMessageExpiryInterval 5348]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {0x38, 0x76, 0x0,  0x12, 0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9, 0xc8, 0x67,
                   0x66, 0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35, 0x49, 0x1f, 0x0,  0xc,  0xa7, 0xfc, 0x65, 0x1b,
                   0x37, 0xbc, 0x32, 0xd,  0xae, 0xff, 0xcd, 0xdd, 0x18, 0x0,  0x0,  0x10, 0x87, 0x23, 0x73,
                   0xa3, 0xb,  0xe,  0x1f, 0x0,  0xd,  0x22, 0xa8, 0x11, 0x78, 0x3b, 0xda, 0x2,  0x1a, 0x61,
                   0xe6, 0x9f, 0xde, 0xbb, 0x23, 0xe,  0x35, 0x8,  0x0,  0x6,  0x7b, 0xa6, 0xd,  0xdf, 0x16,
                   0xdd, 0x22, 0x71, 0x70, 0x23, 0x27, 0x40, 0x12, 0x0,  0x3,  0xc6, 0x26, 0x98, 0x22, 0x9,
                   0x3e, 0x2,  0x0,  0x0,  0x14, 0xe4, 0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35,
                   0xe7, 0x41, 0x4a, 0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x11, 0x22, 0xd3, 0xcf, 0xa,  0x7b, 0x5a, 0x25, 0xd9,
                               0xc8, 0x67, 0x66, 0x69, 0xb6, 0xd2, 0x55, 0x53, 0x35};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7f, 0xd3, 0xf7, 0x87, 0x1f, 0x3e, 0x60, 0xde, 0x35, 0xe7, 0x41, 0x4a,
                              0x6f, 0x31, 0x4a, 0x50, 0xf4, 0xe7, 0xfc, 0x37, 0xd3, 0x33, 0x32, 0x5d};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\233\212", _pubPktID = 10216,
// _pubBody = "\241", _pubProps = [PropWillDelayInterval 6725,PropServerReference
// "\253w#\215\181Z\189\135\196H",PropAuthenticationMethod
// "\ESC\160\"S\250R\161\NAK\131\"\214\v\134Nd\199\219\230\139",PropAssignedClientIdentifier
// "e\233/\167Z\187uF\NUL\241\128q+YFH\146\241\224\147\245\223",PropReasonString
// "JJ{'\161\&7\EOTV\160\165xP\DLE-h\193[\129\198\168\180U\152\ETX\171\236G\199",PropMessageExpiryInterval
// 26844,PropResponseInformation
// "\201\213\DC3\149s\201\&0m\159\210A$\212L\DC1\145B\ESC\250\205'm\US\149\144\\\147ZH",PropContentType
// "\235\134\253Y\255\148#F\192\SUB\152<\174na\254\ETB\251\EOT",PropAssignedClientIdentifier
// "\200\147_\194\170\201n`",PropServerKeepAlive 31945,PropPayloadFormatIndicator 36,PropSubscriptionIdentifierAvailable
// 90,PropAuthenticationMethod "t\218\147\160\172\128mZ\DC33R<`\165u\GSrdF\128",PropReasonString
// "\227\144#\DC2\203\195\162\194#X\"c_]}\201\216\181\&4\187\146rO\187,\244+\213%\163",PropWillDelayInterval
// 31366,PropAuthenticationMethod "\144\FS\227\199J\218\161\154_\130J\195Yt\187\197\170tV",PropRetainAvailable
// 210,PropResponseTopic "\148\ESCo\217\v",PropUserProperty
// "\"W\172\182\156\221\151\EOTC\165\207\&6\231\193\222S\ETB\ESCu"
// "\253\128\231=\172\CANT\f\139\202\236iE\157\177'b<x\247w",PropAssignedClientIdentifier
// "~\170\247\222\132J\r\159",PropUserProperty "n\243&\NULx\221\155\185\174\248"
// "\248\177\219\205\DEL\181\240~\129B\240\DC1G\136<A\230Q\176q\163",PropTopicAliasMaximum
// 3463,PropSharedSubscriptionAvailable 240,PropAuthenticationMethod "~\225\248\221\DC2\166\&91",PropServerKeepAlive
// 23474]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x32, 0x82, 0x3,  0x0,  0x2,  0xe9, 0xd4, 0x27, 0xe8, 0xf9, 0x2,  0x18, 0x0,  0x0,  0x1a, 0x45, 0x1c, 0x0,  0xa,
      0xfd, 0x77, 0x23, 0xd7, 0xb5, 0x5a, 0xbd, 0x87, 0xc4, 0x48, 0x15, 0x0,  0x13, 0x1b, 0xa0, 0x22, 0x53, 0xfa, 0x52,
      0xa1, 0x15, 0x83, 0x22, 0xd6, 0xb,  0x86, 0x4e, 0x64, 0xc7, 0xdb, 0xe6, 0x8b, 0x12, 0x0,  0x16, 0x65, 0xe9, 0x2f,
      0xa7, 0x5a, 0xbb, 0x75, 0x46, 0x0,  0xf1, 0x80, 0x71, 0x2b, 0x59, 0x46, 0x48, 0x92, 0xf1, 0xe0, 0x93, 0xf5, 0xdf,
      0x1f, 0x0,  0x1c, 0x4a, 0x4a, 0x7b, 0x27, 0xa1, 0x37, 0x4,  0x56, 0xa0, 0xa5, 0x78, 0x50, 0x10, 0x2d, 0x68, 0xc1,
      0x5b, 0x81, 0xc6, 0xa8, 0xb4, 0x55, 0x98, 0x3,  0xab, 0xec, 0x47, 0xc7, 0x2,  0x0,  0x0,  0x68, 0xdc, 0x1a, 0x0,
      0x1d, 0xc9, 0xd5, 0x13, 0x95, 0x73, 0xc9, 0x30, 0x6d, 0x9f, 0xd2, 0x41, 0x24, 0xd4, 0x4c, 0x11, 0x91, 0x42, 0x1b,
      0xfa, 0xcd, 0x27, 0x6d, 0x1f, 0x95, 0x90, 0x5c, 0x93, 0x5a, 0x48, 0x3,  0x0,  0x13, 0xeb, 0x86, 0xfd, 0x59, 0xff,
      0x94, 0x23, 0x46, 0xc0, 0x1a, 0x98, 0x3c, 0xae, 0x6e, 0x61, 0xfe, 0x17, 0xfb, 0x4,  0x12, 0x0,  0x8,  0xc8, 0x93,
      0x5f, 0xc2, 0xaa, 0xc9, 0x6e, 0x60, 0x13, 0x7c, 0xc9, 0x1,  0x24, 0x29, 0x5a, 0x15, 0x0,  0x14, 0x74, 0xda, 0x93,
      0xa0, 0xac, 0x80, 0x6d, 0x5a, 0x13, 0x33, 0x52, 0x3c, 0x60, 0xa5, 0x75, 0x1d, 0x72, 0x64, 0x46, 0x80, 0x1f, 0x0,
      0x1e, 0xe3, 0x90, 0x23, 0x12, 0xcb, 0xc3, 0xa2, 0xc2, 0x23, 0x58, 0x22, 0x63, 0x5f, 0x5d, 0x7d, 0xc9, 0xd8, 0xb5,
      0x34, 0xbb, 0x92, 0x72, 0x4f, 0xbb, 0x2c, 0xf4, 0x2b, 0xd5, 0x25, 0xa3, 0x18, 0x0,  0x0,  0x7a, 0x86, 0x15, 0x0,
      0x13, 0x90, 0x1c, 0xe3, 0xc7, 0x4a, 0xda, 0xa1, 0x9a, 0x5f, 0x82, 0x4a, 0xc3, 0x59, 0x74, 0xbb, 0xc5, 0xaa, 0x74,
      0x56, 0x25, 0xd2, 0x8,  0x0,  0x5,  0x94, 0x1b, 0x6f, 0xd9, 0xb,  0x26, 0x0,  0x13, 0x22, 0x57, 0xac, 0xb6, 0x9c,
      0xdd, 0x97, 0x4,  0x43, 0xa5, 0xcf, 0x36, 0xe7, 0xc1, 0xde, 0x53, 0x17, 0x1b, 0x75, 0x0,  0x15, 0xfd, 0x80, 0xe7,
      0x3d, 0xac, 0x18, 0x54, 0xc,  0x8b, 0xca, 0xec, 0x69, 0x45, 0x9d, 0xb1, 0x27, 0x62, 0x3c, 0x78, 0xf7, 0x77, 0x12,
      0x0,  0x8,  0x7e, 0xaa, 0xf7, 0xde, 0x84, 0x4a, 0xd,  0x9f, 0x26, 0x0,  0xa,  0x6e, 0xf3, 0x26, 0x0,  0x78, 0xdd,
      0x9b, 0xb9, 0xae, 0xf8, 0x0,  0x15, 0xf8, 0xb1, 0xdb, 0xcd, 0x7f, 0xb5, 0xf0, 0x7e, 0x81, 0x42, 0xf0, 0x11, 0x47,
      0x88, 0x3c, 0x41, 0xe6, 0x51, 0xb0, 0x71, 0xa3, 0x22, 0xd,  0x87, 0x2a, 0xf0, 0x15, 0x0,  0x8,  0x7e, 0xe1, 0xf8,
      0xdd, 0x12, 0xa6, 0x39, 0x31, 0x13, 0x5b, 0xb2, 0xf1};
  uint8_t topic_bytes[] = {0xe9, 0xd4};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0xfd, 0x77, 0x23, 0xd7, 0xb5, 0x5a, 0xbd, 0x87, 0xc4, 0x48};
  uint8_t bytesprops1[] = {0x1b, 0xa0, 0x22, 0x53, 0xfa, 0x52, 0xa1, 0x15, 0x83, 0x22,
                           0xd6, 0xb,  0x86, 0x4e, 0x64, 0xc7, 0xdb, 0xe6, 0x8b};
  uint8_t bytesprops2[] = {0x65, 0xe9, 0x2f, 0xa7, 0x5a, 0xbb, 0x75, 0x46, 0x0,  0xf1, 0x80,
                           0x71, 0x2b, 0x59, 0x46, 0x48, 0x92, 0xf1, 0xe0, 0x93, 0xf5, 0xdf};
  uint8_t bytesprops3[] = {0x4a, 0x4a, 0x7b, 0x27, 0xa1, 0x37, 0x4,  0x56, 0xa0, 0xa5, 0x78, 0x50, 0x10, 0x2d,
                           0x68, 0xc1, 0x5b, 0x81, 0xc6, 0xa8, 0xb4, 0x55, 0x98, 0x3,  0xab, 0xec, 0x47, 0xc7};
  uint8_t bytesprops4[] = {0xc9, 0xd5, 0x13, 0x95, 0x73, 0xc9, 0x30, 0x6d, 0x9f, 0xd2, 0x41, 0x24, 0xd4, 0x4c, 0x11,
                           0x91, 0x42, 0x1b, 0xfa, 0xcd, 0x27, 0x6d, 0x1f, 0x95, 0x90, 0x5c, 0x93, 0x5a, 0x48};
  uint8_t bytesprops5[] = {0xeb, 0x86, 0xfd, 0x59, 0xff, 0x94, 0x23, 0x46, 0xc0, 0x1a,
                           0x98, 0x3c, 0xae, 0x6e, 0x61, 0xfe, 0x17, 0xfb, 0x4};
  uint8_t bytesprops6[] = {0xc8, 0x93, 0x5f, 0xc2, 0xaa, 0xc9, 0x6e, 0x60};
  uint8_t bytesprops7[] = {0x74, 0xda, 0x93, 0xa0, 0xac, 0x80, 0x6d, 0x5a, 0x13, 0x33,
                           0x52, 0x3c, 0x60, 0xa5, 0x75, 0x1d, 0x72, 0x64, 0x46, 0x80};
  uint8_t bytesprops8[] = {0xe3, 0x90, 0x23, 0x12, 0xcb, 0xc3, 0xa2, 0xc2, 0x23, 0x58, 0x22, 0x63, 0x5f, 0x5d, 0x7d,
                           0xc9, 0xd8, 0xb5, 0x34, 0xbb, 0x92, 0x72, 0x4f, 0xbb, 0x2c, 0xf4, 0x2b, 0xd5, 0x25, 0xa3};
  uint8_t bytesprops9[] = {0x90, 0x1c, 0xe3, 0xc7, 0x4a, 0xda, 0xa1, 0x9a, 0x5f, 0x82,
                           0x4a, 0xc3, 0x59, 0x74, 0xbb, 0xc5, 0xaa, 0x74, 0x56};
  uint8_t bytesprops10[] = {0x94, 0x1b, 0x6f, 0xd9, 0xb};
  uint8_t bytesprops12[] = {0xfd, 0x80, 0xe7, 0x3d, 0xac, 0x18, 0x54, 0xc,  0x8b, 0xca, 0xec,
                            0x69, 0x45, 0x9d, 0xb1, 0x27, 0x62, 0x3c, 0x78, 0xf7, 0x77};
  uint8_t bytesprops11[] = {0x22, 0x57, 0xac, 0xb6, 0x9c, 0xdd, 0x97, 0x4,  0x43, 0xa5,
                            0xcf, 0x36, 0xe7, 0xc1, 0xde, 0x53, 0x17, 0x1b, 0x75};
  uint8_t bytesprops13[] = {0x7e, 0xaa, 0xf7, 0xde, 0x84, 0x4a, 0xd, 0x9f};
  uint8_t bytesprops15[] = {0xf8, 0xb1, 0xdb, 0xcd, 0x7f, 0xb5, 0xf0, 0x7e, 0x81, 0x42, 0xf0,
                            0x11, 0x47, 0x88, 0x3c, 0x41, 0xe6, 0x51, 0xb0, 0x71, 0xa3};
  uint8_t bytesprops14[] = {0x6e, 0xf3, 0x26, 0x0, 0x78, 0xdd, 0x9b, 0xb9, 0xae, 0xf8};
  uint8_t bytesprops16[] = {0x7e, 0xe1, 0xf8, 0xdd, 0x12, 0xa6, 0x39, 0x31};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6725}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26844}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31945}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31366}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {19, (char*)&bytesprops11}, .v = {21, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {10, (char*)&bytesprops14}, .v = {21, (char*)&bytesprops15}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3463}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23474}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 10216, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\233\212", _pubPktID = 10216,
// _pubBody = "\241", _pubProps = [PropWillDelayInterval 6725,PropServerReference
// "\253w#\215\181Z\189\135\196H",PropAuthenticationMethod
// "\ESC\160\"S\250R\161\NAK\131\"\214\v\134Nd\199\219\230\139",PropAssignedClientIdentifier
// "e\233/\167Z\187uF\NUL\241\128q+YFH\146\241\224\147\245\223",PropReasonString
// "JJ{'\161\&7\EOTV\160\165xP\DLE-h\193[\129\198\168\180U\152\ETX\171\236G\199",PropMessageExpiryInterval
// 26844,PropResponseInformation
// "\201\213\DC3\149s\201\&0m\159\210A$\212L\DC1\145B\ESC\250\205'm\US\149\144\\\147ZH",PropContentType
// "\235\134\253Y\255\148#F\192\SUB\152<\174na\254\ETB\251\EOT",PropAssignedClientIdentifier
// "\200\147_\194\170\201n`",PropServerKeepAlive 31945,PropPayloadFormatIndicator 36,PropSubscriptionIdentifierAvailable
// 90,PropAuthenticationMethod "t\218\147\160\172\128mZ\DC33R<`\165u\GSrdF\128",PropReasonString
// "\227\144#\DC2\203\195\162\194#X\"c_]}\201\216\181\&4\187\146rO\187,\244+\213%\163",PropWillDelayInterval
// 31366,PropAuthenticationMethod "\144\FS\227\199J\218\161\154_\130J\195Yt\187\197\170tV",PropRetainAvailable
// 210,PropResponseTopic "\148\ESCo\217\v",PropUserProperty
// "\"W\172\182\156\221\151\EOTC\165\207\&6\231\193\222S\ETB\ESCu"
// "\253\128\231=\172\CANT\f\139\202\236iE\157\177'b<x\247w",PropAssignedClientIdentifier
// "~\170\247\222\132J\r\159",PropUserProperty "n\243&\NULx\221\155\185\174\248"
// "\248\177\219\205\DEL\181\240~\129B\240\DC1G\136<A\230Q\176q\163",PropTopicAliasMaximum
// 3463,PropSharedSubscriptionAvailable 240,PropAuthenticationMethod "~\225\248\221\DC2\166\&91",PropServerKeepAlive
// 23474]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {
      0x32, 0x82, 0x3,  0x0,  0x2,  0xe9, 0xd4, 0x27, 0xe8, 0xf9, 0x2,  0x18, 0x0,  0x0,  0x1a, 0x45, 0x1c, 0x0,  0xa,
      0xfd, 0x77, 0x23, 0xd7, 0xb5, 0x5a, 0xbd, 0x87, 0xc4, 0x48, 0x15, 0x0,  0x13, 0x1b, 0xa0, 0x22, 0x53, 0xfa, 0x52,
      0xa1, 0x15, 0x83, 0x22, 0xd6, 0xb,  0x86, 0x4e, 0x64, 0xc7, 0xdb, 0xe6, 0x8b, 0x12, 0x0,  0x16, 0x65, 0xe9, 0x2f,
      0xa7, 0x5a, 0xbb, 0x75, 0x46, 0x0,  0xf1, 0x80, 0x71, 0x2b, 0x59, 0x46, 0x48, 0x92, 0xf1, 0xe0, 0x93, 0xf5, 0xdf,
      0x1f, 0x0,  0x1c, 0x4a, 0x4a, 0x7b, 0x27, 0xa1, 0x37, 0x4,  0x56, 0xa0, 0xa5, 0x78, 0x50, 0x10, 0x2d, 0x68, 0xc1,
      0x5b, 0x81, 0xc6, 0xa8, 0xb4, 0x55, 0x98, 0x3,  0xab, 0xec, 0x47, 0xc7, 0x2,  0x0,  0x0,  0x68, 0xdc, 0x1a, 0x0,
      0x1d, 0xc9, 0xd5, 0x13, 0x95, 0x73, 0xc9, 0x30, 0x6d, 0x9f, 0xd2, 0x41, 0x24, 0xd4, 0x4c, 0x11, 0x91, 0x42, 0x1b,
      0xfa, 0xcd, 0x27, 0x6d, 0x1f, 0x95, 0x90, 0x5c, 0x93, 0x5a, 0x48, 0x3,  0x0,  0x13, 0xeb, 0x86, 0xfd, 0x59, 0xff,
      0x94, 0x23, 0x46, 0xc0, 0x1a, 0x98, 0x3c, 0xae, 0x6e, 0x61, 0xfe, 0x17, 0xfb, 0x4,  0x12, 0x0,  0x8,  0xc8, 0x93,
      0x5f, 0xc2, 0xaa, 0xc9, 0x6e, 0x60, 0x13, 0x7c, 0xc9, 0x1,  0x24, 0x29, 0x5a, 0x15, 0x0,  0x14, 0x74, 0xda, 0x93,
      0xa0, 0xac, 0x80, 0x6d, 0x5a, 0x13, 0x33, 0x52, 0x3c, 0x60, 0xa5, 0x75, 0x1d, 0x72, 0x64, 0x46, 0x80, 0x1f, 0x0,
      0x1e, 0xe3, 0x90, 0x23, 0x12, 0xcb, 0xc3, 0xa2, 0xc2, 0x23, 0x58, 0x22, 0x63, 0x5f, 0x5d, 0x7d, 0xc9, 0xd8, 0xb5,
      0x34, 0xbb, 0x92, 0x72, 0x4f, 0xbb, 0x2c, 0xf4, 0x2b, 0xd5, 0x25, 0xa3, 0x18, 0x0,  0x0,  0x7a, 0x86, 0x15, 0x0,
      0x13, 0x90, 0x1c, 0xe3, 0xc7, 0x4a, 0xda, 0xa1, 0x9a, 0x5f, 0x82, 0x4a, 0xc3, 0x59, 0x74, 0xbb, 0xc5, 0xaa, 0x74,
      0x56, 0x25, 0xd2, 0x8,  0x0,  0x5,  0x94, 0x1b, 0x6f, 0xd9, 0xb,  0x26, 0x0,  0x13, 0x22, 0x57, 0xac, 0xb6, 0x9c,
      0xdd, 0x97, 0x4,  0x43, 0xa5, 0xcf, 0x36, 0xe7, 0xc1, 0xde, 0x53, 0x17, 0x1b, 0x75, 0x0,  0x15, 0xfd, 0x80, 0xe7,
      0x3d, 0xac, 0x18, 0x54, 0xc,  0x8b, 0xca, 0xec, 0x69, 0x45, 0x9d, 0xb1, 0x27, 0x62, 0x3c, 0x78, 0xf7, 0x77, 0x12,
      0x0,  0x8,  0x7e, 0xaa, 0xf7, 0xde, 0x84, 0x4a, 0xd,  0x9f, 0x26, 0x0,  0xa,  0x6e, 0xf3, 0x26, 0x0,  0x78, 0xdd,
      0x9b, 0xb9, 0xae, 0xf8, 0x0,  0x15, 0xf8, 0xb1, 0xdb, 0xcd, 0x7f, 0xb5, 0xf0, 0x7e, 0x81, 0x42, 0xf0, 0x11, 0x47,
      0x88, 0x3c, 0x41, 0xe6, 0x51, 0xb0, 0x71, 0xa3, 0x22, 0xd,  0x87, 0x2a, 0xf0, 0x15, 0x0,  0x8,  0x7e, 0xe1, 0xf8,
      0xdd, 0x12, 0xa6, 0x39, 0x31, 0x13, 0x5b, 0xb2, 0xf1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe9, 0xd4};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf1};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10216);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "}\162\DC3\157\161\140z\190\148\228\254\EOTk\211\&1\133\SI\188y\142\134e", _pubPktID = 11026, _pubBody =
// "\v/:\b\150\237Ih\224]\US\181R[r\179\234\185", _pubProps = [PropReasonString
// "\148P\EOT\247]b\DC3U,`3\DC4\207t\225\232",PropMessageExpiryInterval 23350,PropPayloadFormatIndicator
// 78,PropMessageExpiryInterval 19240,PropResponseInformation "\211\SOH\185\161",PropServerKeepAlive
// 24528,PropMaximumQoS 25]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x3a, 0x58, 0x0,  0x16, 0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe,
                   0x4,  0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65, 0x2b, 0x12, 0x2b, 0x1f,
                   0x0,  0x10, 0x94, 0x50, 0x4,  0xf7, 0x5d, 0x62, 0x13, 0x55, 0x2c, 0x60, 0x33, 0x14, 0xcf,
                   0x74, 0xe1, 0xe8, 0x2,  0x0,  0x0,  0x5b, 0x36, 0x1,  0x4e, 0x2,  0x0,  0x0,  0x4b, 0x28,
                   0x1a, 0x0,  0x4,  0xd3, 0x1,  0xb9, 0xa1, 0x13, 0x5f, 0xd0, 0x24, 0x19, 0xb,  0x2f, 0x3a,
                   0x8,  0x96, 0xed, 0x49, 0x68, 0xe0, 0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  uint8_t topic_bytes[] = {0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe,
                           0x4,  0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb,  0x2f, 0x3a, 0x8,  0x96, 0xed, 0x49, 0x68, 0xe0,
                         0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0x94, 0x50, 0x4,  0xf7, 0x5d, 0x62, 0x13, 0x55,
                           0x2c, 0x60, 0x33, 0x14, 0xcf, 0x74, 0xe1, 0xe8};
  uint8_t bytesprops1[] = {0xd3, 0x1, 0xb9, 0xa1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23350}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19240}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24528}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 25}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 11026, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "}\162\DC3\157\161\140z\190\148\228\254\EOTk\211\&1\133\SI\188y\142\134e", _pubPktID = 11026, _pubBody =
// "\v/:\b\150\237Ih\224]\US\181R[r\179\234\185", _pubProps = [PropReasonString
// "\148P\EOT\247]b\DC3U,`3\DC4\207t\225\232",PropMessageExpiryInterval 23350,PropPayloadFormatIndicator
// 78,PropMessageExpiryInterval 19240,PropResponseInformation "\211\SOH\185\161",PropServerKeepAlive
// 24528,PropMaximumQoS 25]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x3a, 0x58, 0x0,  0x16, 0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe,
                   0x4,  0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65, 0x2b, 0x12, 0x2b, 0x1f,
                   0x0,  0x10, 0x94, 0x50, 0x4,  0xf7, 0x5d, 0x62, 0x13, 0x55, 0x2c, 0x60, 0x33, 0x14, 0xcf,
                   0x74, 0xe1, 0xe8, 0x2,  0x0,  0x0,  0x5b, 0x36, 0x1,  0x4e, 0x2,  0x0,  0x0,  0x4b, 0x28,
                   0x1a, 0x0,  0x4,  0xd3, 0x1,  0xb9, 0xa1, 0x13, 0x5f, 0xd0, 0x24, 0x19, 0xb,  0x2f, 0x3a,
                   0x8,  0x96, 0xed, 0x49, 0x68, 0xe0, 0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7d, 0xa2, 0x13, 0x9d, 0xa1, 0x8c, 0x7a, 0xbe, 0x94, 0xe4, 0xfe,
                               0x4,  0x6b, 0xd3, 0x31, 0x85, 0xf,  0xbc, 0x79, 0x8e, 0x86, 0x65};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb,  0x2f, 0x3a, 0x8,  0x96, 0xed, 0x49, 0x68, 0xe0,
                              0x5d, 0x1f, 0xb5, 0x52, 0x5b, 0x72, 0xb3, 0xea, 0xb9};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11026);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "'$k\221BT0a\ETB", _pubPktID = 21319,
// _pubBody = "\149", _pubProps = [PropWildcardSubscriptionAvailable 115,PropRequestResponseInformation
// 247,PropRequestResponseInformation 157,PropCorrelationData "\EM\163",PropSubscriptionIdentifier
// 22,PropCorrelationData ".u\174d\144%\173\196\173\228\STX\SUB#\235\173w\178\250\200\173",PropAuthenticationData
// "lY$\NULV\DC3\170",PropContentType "",PropSubscriptionIdentifierAvailable 53,PropPayloadFormatIndicator
// 94,PropMaximumQoS 144,PropCorrelationData
// "\136\236\145\"\241\190[\239\217aJ&\EM\159\233\US\133\182\NUL\170H\SI6\129\158\CAN",PropSharedSubscriptionAvailable
// 18,PropResponseTopic "\\M\232\148\v\225~\150\171=\129R\229\&4T\176\195",PropMaximumPacketSize
// 6451,PropServerKeepAlive 3476]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x3a, 0x81, 0x1,  0x0,  0x9,  0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17, 0x53, 0x47, 0x72,
                   0x28, 0x73, 0x19, 0xf7, 0x19, 0x9d, 0x9,  0x0,  0x2,  0x19, 0xa3, 0xb,  0x16, 0x9,  0x0,  0x14, 0x2e,
                   0x75, 0xae, 0x64, 0x90, 0x25, 0xad, 0xc4, 0xad, 0xe4, 0x2,  0x1a, 0x23, 0xeb, 0xad, 0x77, 0xb2, 0xfa,
                   0xc8, 0xad, 0x16, 0x0,  0x7,  0x6c, 0x59, 0x24, 0x0,  0x56, 0x13, 0xaa, 0x3,  0x0,  0x0,  0x29, 0x35,
                   0x1,  0x5e, 0x24, 0x90, 0x9,  0x0,  0x1a, 0x88, 0xec, 0x91, 0x22, 0xf1, 0xbe, 0x5b, 0xef, 0xd9, 0x61,
                   0x4a, 0x26, 0x19, 0x9f, 0xe9, 0x1f, 0x85, 0xb6, 0x0,  0xaa, 0x48, 0xf,  0x36, 0x81, 0x9e, 0x18, 0x2a,
                   0x12, 0x8,  0x0,  0x11, 0x5c, 0x4d, 0xe8, 0x94, 0xb,  0xe1, 0x7e, 0x96, 0xab, 0x3d, 0x81, 0x52, 0xe5,
                   0x34, 0x54, 0xb0, 0xc3, 0x27, 0x0,  0x0,  0x19, 0x33, 0x13, 0xd,  0x94, 0x95};
  uint8_t topic_bytes[] = {0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x19, 0xa3};
  uint8_t bytesprops1[] = {0x2e, 0x75, 0xae, 0x64, 0x90, 0x25, 0xad, 0xc4, 0xad, 0xe4,
                           0x2,  0x1a, 0x23, 0xeb, 0xad, 0x77, 0xb2, 0xfa, 0xc8, 0xad};
  uint8_t bytesprops2[] = {0x6c, 0x59, 0x24, 0x0, 0x56, 0x13, 0xaa};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x88, 0xec, 0x91, 0x22, 0xf1, 0xbe, 0x5b, 0xef, 0xd9, 0x61, 0x4a, 0x26, 0x19,
                           0x9f, 0xe9, 0x1f, 0x85, 0xb6, 0x0,  0xaa, 0x48, 0xf,  0x36, 0x81, 0x9e, 0x18};
  uint8_t bytesprops5[] = {0x5c, 0x4d, 0xe8, 0x94, 0xb,  0xe1, 0x7e, 0x96, 0xab,
                           0x3d, 0x81, 0x52, 0xe5, 0x34, 0x54, 0xb0, 0xc3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6451}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3476}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 21319, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "'$k\221BT0a\ETB", _pubPktID = 21319,
// _pubBody = "\149", _pubProps = [PropWildcardSubscriptionAvailable 115,PropRequestResponseInformation
// 247,PropRequestResponseInformation 157,PropCorrelationData "\EM\163",PropSubscriptionIdentifier
// 22,PropCorrelationData ".u\174d\144%\173\196\173\228\STX\SUB#\235\173w\178\250\200\173",PropAuthenticationData
// "lY$\NULV\DC3\170",PropContentType "",PropSubscriptionIdentifierAvailable 53,PropPayloadFormatIndicator
// 94,PropMaximumQoS 144,PropCorrelationData
// "\136\236\145\"\241\190[\239\217aJ&\EM\159\233\US\133\182\NUL\170H\SI6\129\158\CAN",PropSharedSubscriptionAvailable
// 18,PropResponseTopic "\\M\232\148\v\225~\150\171=\129R\229\&4T\176\195",PropMaximumPacketSize
// 6451,PropServerKeepAlive 3476]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x3a, 0x81, 0x1,  0x0,  0x9,  0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17, 0x53, 0x47, 0x72,
                   0x28, 0x73, 0x19, 0xf7, 0x19, 0x9d, 0x9,  0x0,  0x2,  0x19, 0xa3, 0xb,  0x16, 0x9,  0x0,  0x14, 0x2e,
                   0x75, 0xae, 0x64, 0x90, 0x25, 0xad, 0xc4, 0xad, 0xe4, 0x2,  0x1a, 0x23, 0xeb, 0xad, 0x77, 0xb2, 0xfa,
                   0xc8, 0xad, 0x16, 0x0,  0x7,  0x6c, 0x59, 0x24, 0x0,  0x56, 0x13, 0xaa, 0x3,  0x0,  0x0,  0x29, 0x35,
                   0x1,  0x5e, 0x24, 0x90, 0x9,  0x0,  0x1a, 0x88, 0xec, 0x91, 0x22, 0xf1, 0xbe, 0x5b, 0xef, 0xd9, 0x61,
                   0x4a, 0x26, 0x19, 0x9f, 0xe9, 0x1f, 0x85, 0xb6, 0x0,  0xaa, 0x48, 0xf,  0x36, 0x81, 0x9e, 0x18, 0x2a,
                   0x12, 0x8,  0x0,  0x11, 0x5c, 0x4d, 0xe8, 0x94, 0xb,  0xe1, 0x7e, 0x96, 0xab, 0x3d, 0x81, 0x52, 0xe5,
                   0x34, 0x54, 0xb0, 0xc3, 0x27, 0x0,  0x0,  0x19, 0x33, 0x13, 0xd,  0x94, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x27, 0x24, 0x6b, 0xdd, 0x42, 0x54, 0x30, 0x61, 0x17};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x95};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 21319);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\US\134\217^\225\USI\SOH%\234]\SUB\251\158\ENQ\188\140@\224\ETX\185}", _pubPktID = 0, _pubBody = "\222", _pubProps =
// [PropSubscriptionIdentifierAvailable 189,PropRequestResponseInformation 84,PropSubscriptionIdentifier
// 29,PropServerReference
// "E\131\240\200\175\198\SOH\248\231\188\133\224\237\b\SO\242\185\202(T\241\211\nXIr\138\242\237",PropReasonString
// "\159k\129\206^!,'\165\215",PropSharedSubscriptionAvailable 210,PropAssignedClientIdentifier
// "\168\200\213T1\213\CAN]",PropServerKeepAlive 27765,PropMaximumQoS 169,PropAssignedClientIdentifier
// "?\229\ESC\252\208\157\225\210\157H\254\133\209\229l\172\215\151\152",PropCorrelationData
// "\200\181\202`V\b<\200\134\154m?Oq&G\143\246\243\NUL\185\218\143\&5~gO\254\DC4",PropServerKeepAlive
// 27340,PropWillDelayInterval 3446,PropMaximumQoS 186,PropCorrelationData
// "\SIU\r\146@\227\184\154\163cF\206T2\197\218\231",PropMaximumQoS 85,PropSubscriptionIdentifier 28,PropRetainAvailable
// 137,PropRequestProblemInformation 19,PropCorrelationData "\255\237\186*\177\171\132\FS\172\201\194",PropTopicAlias
// 26253,PropSubscriptionIdentifierAvailable 72,PropRequestProblemInformation 78,PropWildcardSubscriptionAvailable
// 25,PropPayloadFormatIndicator 173,PropWildcardSubscriptionAvailable 192,PropMaximumQoS 143,PropReceiveMaximum
// 23224,PropAuthenticationMethod "]Y\239\223\215\SO\FS`\EOT\242\236\218<\251\&3"]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x30, 0xee, 0x1,  0x0,  0x16, 0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea, 0x5d, 0x1a, 0xfb, 0x9e,
      0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d, 0xd3, 0x1,  0x29, 0xbd, 0x19, 0x54, 0xb,  0x1d, 0x1c, 0x0,  0x1d,
      0x45, 0x83, 0xf0, 0xc8, 0xaf, 0xc6, 0x1,  0xf8, 0xe7, 0xbc, 0x85, 0xe0, 0xed, 0x8,  0xe,  0xf2, 0xb9, 0xca, 0x28,
      0x54, 0xf1, 0xd3, 0xa,  0x58, 0x49, 0x72, 0x8a, 0xf2, 0xed, 0x1f, 0x0,  0xa,  0x9f, 0x6b, 0x81, 0xce, 0x5e, 0x21,
      0x2c, 0x27, 0xa5, 0xd7, 0x2a, 0xd2, 0x12, 0x0,  0x8,  0xa8, 0xc8, 0xd5, 0x54, 0x31, 0xd5, 0x18, 0x5d, 0x13, 0x6c,
      0x75, 0x24, 0xa9, 0x12, 0x0,  0x13, 0x3f, 0xe5, 0x1b, 0xfc, 0xd0, 0x9d, 0xe1, 0xd2, 0x9d, 0x48, 0xfe, 0x85, 0xd1,
      0xe5, 0x6c, 0xac, 0xd7, 0x97, 0x98, 0x9,  0x0,  0x1d, 0xc8, 0xb5, 0xca, 0x60, 0x56, 0x8,  0x3c, 0xc8, 0x86, 0x9a,
      0x6d, 0x3f, 0x4f, 0x71, 0x26, 0x47, 0x8f, 0xf6, 0xf3, 0x0,  0xb9, 0xda, 0x8f, 0x35, 0x7e, 0x67, 0x4f, 0xfe, 0x14,
      0x13, 0x6a, 0xcc, 0x18, 0x0,  0x0,  0xd,  0x76, 0x24, 0xba, 0x9,  0x0,  0x11, 0xf,  0x55, 0xd,  0x92, 0x40, 0xe3,
      0xb8, 0x9a, 0xa3, 0x63, 0x46, 0xce, 0x54, 0x32, 0xc5, 0xda, 0xe7, 0x24, 0x55, 0xb,  0x1c, 0x25, 0x89, 0x17, 0x13,
      0x9,  0x0,  0xb,  0xff, 0xed, 0xba, 0x2a, 0xb1, 0xab, 0x84, 0x1c, 0xac, 0xc9, 0xc2, 0x23, 0x66, 0x8d, 0x29, 0x48,
      0x17, 0x4e, 0x28, 0x19, 0x1,  0xad, 0x28, 0xc0, 0x24, 0x8f, 0x21, 0x5a, 0xb8, 0x15, 0x0,  0xf,  0x5d, 0x59, 0xef,
      0xdf, 0xd7, 0xe,  0x1c, 0x60, 0x4,  0xf2, 0xec, 0xda, 0x3c, 0xfb, 0x33, 0xde};
  uint8_t topic_bytes[] = {0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea, 0x5d,
                           0x1a, 0xfb, 0x9e, 0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x45, 0x83, 0xf0, 0xc8, 0xaf, 0xc6, 0x1,  0xf8, 0xe7, 0xbc, 0x85, 0xe0, 0xed, 0x8, 0xe,
                           0xf2, 0xb9, 0xca, 0x28, 0x54, 0xf1, 0xd3, 0xa,  0x58, 0x49, 0x72, 0x8a, 0xf2, 0xed};
  uint8_t bytesprops1[] = {0x9f, 0x6b, 0x81, 0xce, 0x5e, 0x21, 0x2c, 0x27, 0xa5, 0xd7};
  uint8_t bytesprops2[] = {0xa8, 0xc8, 0xd5, 0x54, 0x31, 0xd5, 0x18, 0x5d};
  uint8_t bytesprops3[] = {0x3f, 0xe5, 0x1b, 0xfc, 0xd0, 0x9d, 0xe1, 0xd2, 0x9d, 0x48,
                           0xfe, 0x85, 0xd1, 0xe5, 0x6c, 0xac, 0xd7, 0x97, 0x98};
  uint8_t bytesprops4[] = {0xc8, 0xb5, 0xca, 0x60, 0x56, 0x8,  0x3c, 0xc8, 0x86, 0x9a, 0x6d, 0x3f, 0x4f, 0x71, 0x26,
                           0x47, 0x8f, 0xf6, 0xf3, 0x0,  0xb9, 0xda, 0x8f, 0x35, 0x7e, 0x67, 0x4f, 0xfe, 0x14};
  uint8_t bytesprops5[] = {0xf,  0x55, 0xd,  0x92, 0x40, 0xe3, 0xb8, 0x9a, 0xa3,
                           0x63, 0x46, 0xce, 0x54, 0x32, 0xc5, 0xda, 0xe7};
  uint8_t bytesprops6[] = {0xff, 0xed, 0xba, 0x2a, 0xb1, 0xab, 0x84, 0x1c, 0xac, 0xc9, 0xc2};
  uint8_t bytesprops7[] = {0x5d, 0x59, 0xef, 0xdf, 0xd7, 0xe, 0x1c, 0x60, 0x4, 0xf2, 0xec, 0xda, 0x3c, 0xfb, 0x33};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27765}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27340}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3446}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26253}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23224}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\US\134\217^\225\USI\SOH%\234]\SUB\251\158\ENQ\188\140@\224\ETX\185}", _pubPktID = 0, _pubBody = "\222", _pubProps =
// [PropSubscriptionIdentifierAvailable 189,PropRequestResponseInformation 84,PropSubscriptionIdentifier
// 29,PropServerReference
// "E\131\240\200\175\198\SOH\248\231\188\133\224\237\b\SO\242\185\202(T\241\211\nXIr\138\242\237",PropReasonString
// "\159k\129\206^!,'\165\215",PropSharedSubscriptionAvailable 210,PropAssignedClientIdentifier
// "\168\200\213T1\213\CAN]",PropServerKeepAlive 27765,PropMaximumQoS 169,PropAssignedClientIdentifier
// "?\229\ESC\252\208\157\225\210\157H\254\133\209\229l\172\215\151\152",PropCorrelationData
// "\200\181\202`V\b<\200\134\154m?Oq&G\143\246\243\NUL\185\218\143\&5~gO\254\DC4",PropServerKeepAlive
// 27340,PropWillDelayInterval 3446,PropMaximumQoS 186,PropCorrelationData
// "\SIU\r\146@\227\184\154\163cF\206T2\197\218\231",PropMaximumQoS 85,PropSubscriptionIdentifier 28,PropRetainAvailable
// 137,PropRequestProblemInformation 19,PropCorrelationData "\255\237\186*\177\171\132\FS\172\201\194",PropTopicAlias
// 26253,PropSubscriptionIdentifierAvailable 72,PropRequestProblemInformation 78,PropWildcardSubscriptionAvailable
// 25,PropPayloadFormatIndicator 173,PropWildcardSubscriptionAvailable 192,PropMaximumQoS 143,PropReceiveMaximum
// 23224,PropAuthenticationMethod "]Y\239\223\215\SO\FS`\EOT\242\236\218<\251\&3"]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {
      0x30, 0xee, 0x1,  0x0,  0x16, 0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea, 0x5d, 0x1a, 0xfb, 0x9e,
      0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d, 0xd3, 0x1,  0x29, 0xbd, 0x19, 0x54, 0xb,  0x1d, 0x1c, 0x0,  0x1d,
      0x45, 0x83, 0xf0, 0xc8, 0xaf, 0xc6, 0x1,  0xf8, 0xe7, 0xbc, 0x85, 0xe0, 0xed, 0x8,  0xe,  0xf2, 0xb9, 0xca, 0x28,
      0x54, 0xf1, 0xd3, 0xa,  0x58, 0x49, 0x72, 0x8a, 0xf2, 0xed, 0x1f, 0x0,  0xa,  0x9f, 0x6b, 0x81, 0xce, 0x5e, 0x21,
      0x2c, 0x27, 0xa5, 0xd7, 0x2a, 0xd2, 0x12, 0x0,  0x8,  0xa8, 0xc8, 0xd5, 0x54, 0x31, 0xd5, 0x18, 0x5d, 0x13, 0x6c,
      0x75, 0x24, 0xa9, 0x12, 0x0,  0x13, 0x3f, 0xe5, 0x1b, 0xfc, 0xd0, 0x9d, 0xe1, 0xd2, 0x9d, 0x48, 0xfe, 0x85, 0xd1,
      0xe5, 0x6c, 0xac, 0xd7, 0x97, 0x98, 0x9,  0x0,  0x1d, 0xc8, 0xb5, 0xca, 0x60, 0x56, 0x8,  0x3c, 0xc8, 0x86, 0x9a,
      0x6d, 0x3f, 0x4f, 0x71, 0x26, 0x47, 0x8f, 0xf6, 0xf3, 0x0,  0xb9, 0xda, 0x8f, 0x35, 0x7e, 0x67, 0x4f, 0xfe, 0x14,
      0x13, 0x6a, 0xcc, 0x18, 0x0,  0x0,  0xd,  0x76, 0x24, 0xba, 0x9,  0x0,  0x11, 0xf,  0x55, 0xd,  0x92, 0x40, 0xe3,
      0xb8, 0x9a, 0xa3, 0x63, 0x46, 0xce, 0x54, 0x32, 0xc5, 0xda, 0xe7, 0x24, 0x55, 0xb,  0x1c, 0x25, 0x89, 0x17, 0x13,
      0x9,  0x0,  0xb,  0xff, 0xed, 0xba, 0x2a, 0xb1, 0xab, 0x84, 0x1c, 0xac, 0xc9, 0xc2, 0x23, 0x66, 0x8d, 0x29, 0x48,
      0x17, 0x4e, 0x28, 0x19, 0x1,  0xad, 0x28, 0xc0, 0x24, 0x8f, 0x21, 0x5a, 0xb8, 0x15, 0x0,  0xf,  0x5d, 0x59, 0xef,
      0xdf, 0xd7, 0xe,  0x1c, 0x60, 0x4,  0xf2, 0xec, 0xda, 0x3c, 0xfb, 0x33, 0xde};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1f, 0x86, 0xd9, 0x5e, 0xe1, 0x1f, 0x49, 0x1,  0x25, 0xea, 0x5d,
                               0x1a, 0xfb, 0x9e, 0x5,  0xbc, 0x8c, 0x40, 0xe0, 0x3,  0xb9, 0x7d};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xde};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\152\168e\228f1ic\227\250", _pubPktID
// = 0, _pubBody = "\195\&1\199\231\246bO,\"\146\SOE`:", _pubProps = [PropSubscriptionIdentifierAvailable
// 203,PropReasonString "\209\254\145\232aU\n\196\215",PropRequestResponseInformation 200,PropAssignedClientIdentifier
// "\EOT\r7\USQ>\207\178\FS\138Zh5\ETX\251X\136\164\177G\161\ff\131\221{\205\&1L",PropContentType
// "\156\215\NAK\179\178\130\169\180<\DC2\181\253x\SUB\232*P?\237\242h)\148\199Q!\FS\150\n",PropContentType
// "BB\183\248\147\230\184Nw\193\&8\178\DEL\DC2\153\&9zV{\250B\151a",PropMaximumPacketSize
// 3529,PropSubscriptionIdentifier 5,PropMaximumPacketSize 9765,PropAssignedClientIdentifier
// "\153\248\251\172\181/\247\138!?\200\250j\191\242\193s\145f\232\187\192\249\238\190",PropTopicAliasMaximum
// 18828,PropMessageExpiryInterval 17667,PropWillDelayInterval 6761,PropTopicAlias 26579]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x39, 0xbe, 0x1,  0x0,  0xa,  0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa, 0xa2, 0x1,
                   0x29, 0xcb, 0x1f, 0x0,  0x9,  0xd1, 0xfe, 0x91, 0xe8, 0x61, 0x55, 0xa,  0xc4, 0xd7, 0x19, 0xc8, 0x12,
                   0x0,  0x1d, 0x4,  0xd,  0x37, 0x1f, 0x51, 0x3e, 0xcf, 0xb2, 0x1c, 0x8a, 0x5a, 0x68, 0x35, 0x3,  0xfb,
                   0x58, 0x88, 0xa4, 0xb1, 0x47, 0xa1, 0xc,  0x66, 0x83, 0xdd, 0x7b, 0xcd, 0x31, 0x4c, 0x3,  0x0,  0x1d,
                   0x9c, 0xd7, 0x15, 0xb3, 0xb2, 0x82, 0xa9, 0xb4, 0x3c, 0x12, 0xb5, 0xfd, 0x78, 0x1a, 0xe8, 0x2a, 0x50,
                   0x3f, 0xed, 0xf2, 0x68, 0x29, 0x94, 0xc7, 0x51, 0x21, 0x1c, 0x96, 0xa,  0x3,  0x0,  0x17, 0x42, 0x42,
                   0xb7, 0xf8, 0x93, 0xe6, 0xb8, 0x4e, 0x77, 0xc1, 0x38, 0xb2, 0x7f, 0x12, 0x99, 0x39, 0x7a, 0x56, 0x7b,
                   0xfa, 0x42, 0x97, 0x61, 0x27, 0x0,  0x0,  0xd,  0xc9, 0xb,  0x5,  0x27, 0x0,  0x0,  0x26, 0x25, 0x12,
                   0x0,  0x19, 0x99, 0xf8, 0xfb, 0xac, 0xb5, 0x2f, 0xf7, 0x8a, 0x21, 0x3f, 0xc8, 0xfa, 0x6a, 0xbf, 0xf2,
                   0xc1, 0x73, 0x91, 0x66, 0xe8, 0xbb, 0xc0, 0xf9, 0xee, 0xbe, 0x22, 0x49, 0x8c, 0x2,  0x0,  0x0,  0x45,
                   0x3,  0x18, 0x0,  0x0,  0x1a, 0x69, 0x23, 0x67, 0xd3, 0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c,
                   0x22, 0x92, 0xe,  0x45, 0x60, 0x3a};
  uint8_t topic_bytes[] = {0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c, 0x22, 0x92, 0xe, 0x45, 0x60, 0x3a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0xd1, 0xfe, 0x91, 0xe8, 0x61, 0x55, 0xa, 0xc4, 0xd7};
  uint8_t bytesprops1[] = {0x4,  0xd,  0x37, 0x1f, 0x51, 0x3e, 0xcf, 0xb2, 0x1c, 0x8a, 0x5a, 0x68, 0x35, 0x3, 0xfb,
                           0x58, 0x88, 0xa4, 0xb1, 0x47, 0xa1, 0xc,  0x66, 0x83, 0xdd, 0x7b, 0xcd, 0x31, 0x4c};
  uint8_t bytesprops2[] = {0x9c, 0xd7, 0x15, 0xb3, 0xb2, 0x82, 0xa9, 0xb4, 0x3c, 0x12, 0xb5, 0xfd, 0x78, 0x1a, 0xe8,
                           0x2a, 0x50, 0x3f, 0xed, 0xf2, 0x68, 0x29, 0x94, 0xc7, 0x51, 0x21, 0x1c, 0x96, 0xa};
  uint8_t bytesprops3[] = {0x42, 0x42, 0xb7, 0xf8, 0x93, 0xe6, 0xb8, 0x4e, 0x77, 0xc1, 0x38, 0xb2,
                           0x7f, 0x12, 0x99, 0x39, 0x7a, 0x56, 0x7b, 0xfa, 0x42, 0x97, 0x61};
  uint8_t bytesprops4[] = {0x99, 0xf8, 0xfb, 0xac, 0xb5, 0x2f, 0xf7, 0x8a, 0x21, 0x3f, 0xc8, 0xfa, 0x6a,
                           0xbf, 0xf2, 0xc1, 0x73, 0x91, 0x66, 0xe8, 0xbb, 0xc0, 0xf9, 0xee, 0xbe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3529}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 5}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9765}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18828}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17667}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6761}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26579}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\152\168e\228f1ic\227\250", _pubPktID
// = 0, _pubBody = "\195\&1\199\231\246bO,\"\146\SOE`:", _pubProps = [PropSubscriptionIdentifierAvailable
// 203,PropReasonString "\209\254\145\232aU\n\196\215",PropRequestResponseInformation 200,PropAssignedClientIdentifier
// "\EOT\r7\USQ>\207\178\FS\138Zh5\ETX\251X\136\164\177G\161\ff\131\221{\205\&1L",PropContentType
// "\156\215\NAK\179\178\130\169\180<\DC2\181\253x\SUB\232*P?\237\242h)\148\199Q!\FS\150\n",PropContentType
// "BB\183\248\147\230\184Nw\193\&8\178\DEL\DC2\153\&9zV{\250B\151a",PropMaximumPacketSize
// 3529,PropSubscriptionIdentifier 5,PropMaximumPacketSize 9765,PropAssignedClientIdentifier
// "\153\248\251\172\181/\247\138!?\200\250j\191\242\193s\145f\232\187\192\249\238\190",PropTopicAliasMaximum
// 18828,PropMessageExpiryInterval 17667,PropWillDelayInterval 6761,PropTopicAlias 26579]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x39, 0xbe, 0x1,  0x0,  0xa,  0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa, 0xa2, 0x1,
                   0x29, 0xcb, 0x1f, 0x0,  0x9,  0xd1, 0xfe, 0x91, 0xe8, 0x61, 0x55, 0xa,  0xc4, 0xd7, 0x19, 0xc8, 0x12,
                   0x0,  0x1d, 0x4,  0xd,  0x37, 0x1f, 0x51, 0x3e, 0xcf, 0xb2, 0x1c, 0x8a, 0x5a, 0x68, 0x35, 0x3,  0xfb,
                   0x58, 0x88, 0xa4, 0xb1, 0x47, 0xa1, 0xc,  0x66, 0x83, 0xdd, 0x7b, 0xcd, 0x31, 0x4c, 0x3,  0x0,  0x1d,
                   0x9c, 0xd7, 0x15, 0xb3, 0xb2, 0x82, 0xa9, 0xb4, 0x3c, 0x12, 0xb5, 0xfd, 0x78, 0x1a, 0xe8, 0x2a, 0x50,
                   0x3f, 0xed, 0xf2, 0x68, 0x29, 0x94, 0xc7, 0x51, 0x21, 0x1c, 0x96, 0xa,  0x3,  0x0,  0x17, 0x42, 0x42,
                   0xb7, 0xf8, 0x93, 0xe6, 0xb8, 0x4e, 0x77, 0xc1, 0x38, 0xb2, 0x7f, 0x12, 0x99, 0x39, 0x7a, 0x56, 0x7b,
                   0xfa, 0x42, 0x97, 0x61, 0x27, 0x0,  0x0,  0xd,  0xc9, 0xb,  0x5,  0x27, 0x0,  0x0,  0x26, 0x25, 0x12,
                   0x0,  0x19, 0x99, 0xf8, 0xfb, 0xac, 0xb5, 0x2f, 0xf7, 0x8a, 0x21, 0x3f, 0xc8, 0xfa, 0x6a, 0xbf, 0xf2,
                   0xc1, 0x73, 0x91, 0x66, 0xe8, 0xbb, 0xc0, 0xf9, 0xee, 0xbe, 0x22, 0x49, 0x8c, 0x2,  0x0,  0x0,  0x45,
                   0x3,  0x18, 0x0,  0x0,  0x1a, 0x69, 0x23, 0x67, 0xd3, 0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c,
                   0x22, 0x92, 0xe,  0x45, 0x60, 0x3a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x98, 0xa8, 0x65, 0xe4, 0x66, 0x31, 0x69, 0x63, 0xe3, 0xfa};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc3, 0x31, 0xc7, 0xe7, 0xf6, 0x62, 0x4f, 0x2c, 0x22, 0x92, 0xe, 0x45, 0x60, 0x3a};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\240\218\212Wy", _pubPktID = 11258,
// _pubBody = "\212F\158\240\144\160AN", _pubProps = []}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x33, 0x12, 0x0,  0x5,  0xf0, 0xda, 0xd4, 0x57, 0x79, 0x2b,
                   0xfa, 0x0,  0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  uint8_t topic_bytes[] = {0xf0, 0xda, 0xd4, 0x57, 0x79};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 11258, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\240\218\212Wy", _pubPktID = 11258,
// _pubBody = "\212F\158\240\144\160AN", _pubProps = []}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {0x33, 0x12, 0x0,  0x5,  0xf0, 0xda, 0xd4, 0x57, 0x79, 0x2b,
                   0xfa, 0x0,  0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf0, 0xda, 0xd4, 0x57, 0x79};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd4, 0x46, 0x9e, 0xf0, 0x90, 0xa0, 0x41, 0x4e};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 11258);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\204s\226@u&7F!\EM\194o\133\175\187\203<\DC1;\239Q\RS\251\236J\167a\247\220", _pubPktID = 0, _pubBody =
// "\159(\138\244\237\128L\179\197a", _pubProps = [PropSubscriptionIdentifierAvailable 15,PropSessionExpiryInterval
// 22119,PropRetainAvailable 152,PropServerKeepAlive 26069,PropRequestResponseInformation 142,PropReceiveMaximum
// 4901,PropAssignedClientIdentifier
// "\145\&2B\192\177\230\ACK\US\157\197f$\209\239m\146\139R\183\159;$\231(\SI\158\185\144\135\191",PropAuthenticationMethod
// "\196\173q\132\199f|\DC1\218fj\224\195\&0\195{\150\190\226]\158\ESC@\146d\150\&4\130",PropContentType
// "t\135(\163",PropSubscriptionIdentifierAvailable 37,PropReceiveMaximum 6908,PropResponseTopic
// "\213#",PropUserProperty "K\190\162H\152\253\130>g\136\128\188" "\181i\180dT",PropUserProperty
// "\ETB\\l\148\&0\t\224\135\204\172\255V\US\133\187\235\&6q;\t\129\200l\252D\220^\160"
// "\EM\129\234\177\251\243\234\226\251\137jf\169d\246\254V\158\160\138Ohw\220\202^E'W",PropReasonString
// "\235\\\229\154\205\241\&3O\242\170\NAK+q\129\210\205\203\DC45\249\145<\181\206",PropWillDelayInterval
// 3396,PropTopicAlias 6285,PropAuthenticationMethod
// "\167\NAK\250x\146Nx\225\233\247%\197\t\245\221Mn}\158\168A2",PropAuthenticationMethod
// "\194\149\137\STX\166\bH\212e\184\142\222\158\158\194N\172\ETX^\SUBI\NUL\EM/\137",PropRetainAvailable 82]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x31, 0xbb, 0x2,  0x0,  0x1d, 0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2, 0x6f, 0x85, 0xaf,
      0xbb, 0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7, 0x61, 0xf7, 0xdc, 0x90, 0x2,  0x29, 0xf,
      0x11, 0x0,  0x0,  0x56, 0x67, 0x25, 0x98, 0x13, 0x65, 0xd5, 0x19, 0x8e, 0x21, 0x13, 0x25, 0x12, 0x0,  0x1e, 0x91,
      0x32, 0x42, 0xc0, 0xb1, 0xe6, 0x6,  0x1f, 0x9d, 0xc5, 0x66, 0x24, 0xd1, 0xef, 0x6d, 0x92, 0x8b, 0x52, 0xb7, 0x9f,
      0x3b, 0x24, 0xe7, 0x28, 0xf,  0x9e, 0xb9, 0x90, 0x87, 0xbf, 0x15, 0x0,  0x1c, 0xc4, 0xad, 0x71, 0x84, 0xc7, 0x66,
      0x7c, 0x11, 0xda, 0x66, 0x6a, 0xe0, 0xc3, 0x30, 0xc3, 0x7b, 0x96, 0xbe, 0xe2, 0x5d, 0x9e, 0x1b, 0x40, 0x92, 0x64,
      0x96, 0x34, 0x82, 0x3,  0x0,  0x4,  0x74, 0x87, 0x28, 0xa3, 0x29, 0x25, 0x21, 0x1a, 0xfc, 0x8,  0x0,  0x2,  0xd5,
      0x23, 0x26, 0x0,  0xc,  0x4b, 0xbe, 0xa2, 0x48, 0x98, 0xfd, 0x82, 0x3e, 0x67, 0x88, 0x80, 0xbc, 0x0,  0x5,  0xb5,
      0x69, 0xb4, 0x64, 0x54, 0x26, 0x0,  0x1c, 0x17, 0x5c, 0x6c, 0x94, 0x30, 0x9,  0xe0, 0x87, 0xcc, 0xac, 0xff, 0x56,
      0x1f, 0x85, 0xbb, 0xeb, 0x36, 0x71, 0x3b, 0x9,  0x81, 0xc8, 0x6c, 0xfc, 0x44, 0xdc, 0x5e, 0xa0, 0x0,  0x1d, 0x19,
      0x81, 0xea, 0xb1, 0xfb, 0xf3, 0xea, 0xe2, 0xfb, 0x89, 0x6a, 0x66, 0xa9, 0x64, 0xf6, 0xfe, 0x56, 0x9e, 0xa0, 0x8a,
      0x4f, 0x68, 0x77, 0xdc, 0xca, 0x5e, 0x45, 0x27, 0x57, 0x1f, 0x0,  0x18, 0xeb, 0x5c, 0xe5, 0x9a, 0xcd, 0xf1, 0x33,
      0x4f, 0xf2, 0xaa, 0x15, 0x2b, 0x71, 0x81, 0xd2, 0xcd, 0xcb, 0x14, 0x35, 0xf9, 0x91, 0x3c, 0xb5, 0xce, 0x18, 0x0,
      0x0,  0xd,  0x44, 0x23, 0x18, 0x8d, 0x15, 0x0,  0x16, 0xa7, 0x15, 0xfa, 0x78, 0x92, 0x4e, 0x78, 0xe1, 0xe9, 0xf7,
      0x25, 0xc5, 0x9,  0xf5, 0xdd, 0x4d, 0x6e, 0x7d, 0x9e, 0xa8, 0x41, 0x32, 0x15, 0x0,  0x19, 0xc2, 0x95, 0x89, 0x2,
      0xa6, 0x8,  0x48, 0xd4, 0x65, 0xb8, 0x8e, 0xde, 0x9e, 0x9e, 0xc2, 0x4e, 0xac, 0x3,  0x5e, 0x1a, 0x49, 0x0,  0x19,
      0x2f, 0x89, 0x25, 0x52, 0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  uint8_t topic_bytes[] = {0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2, 0x6f, 0x85, 0xaf, 0xbb,
                           0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7, 0x61, 0xf7, 0xdc};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x91, 0x32, 0x42, 0xc0, 0xb1, 0xe6, 0x6,  0x1f, 0x9d, 0xc5, 0x66, 0x24, 0xd1, 0xef, 0x6d,
                           0x92, 0x8b, 0x52, 0xb7, 0x9f, 0x3b, 0x24, 0xe7, 0x28, 0xf,  0x9e, 0xb9, 0x90, 0x87, 0xbf};
  uint8_t bytesprops1[] = {0xc4, 0xad, 0x71, 0x84, 0xc7, 0x66, 0x7c, 0x11, 0xda, 0x66, 0x6a, 0xe0, 0xc3, 0x30,
                           0xc3, 0x7b, 0x96, 0xbe, 0xe2, 0x5d, 0x9e, 0x1b, 0x40, 0x92, 0x64, 0x96, 0x34, 0x82};
  uint8_t bytesprops2[] = {0x74, 0x87, 0x28, 0xa3};
  uint8_t bytesprops3[] = {0xd5, 0x23};
  uint8_t bytesprops5[] = {0xb5, 0x69, 0xb4, 0x64, 0x54};
  uint8_t bytesprops4[] = {0x4b, 0xbe, 0xa2, 0x48, 0x98, 0xfd, 0x82, 0x3e, 0x67, 0x88, 0x80, 0xbc};
  uint8_t bytesprops7[] = {0x19, 0x81, 0xea, 0xb1, 0xfb, 0xf3, 0xea, 0xe2, 0xfb, 0x89, 0x6a, 0x66, 0xa9, 0x64, 0xf6,
                           0xfe, 0x56, 0x9e, 0xa0, 0x8a, 0x4f, 0x68, 0x77, 0xdc, 0xca, 0x5e, 0x45, 0x27, 0x57};
  uint8_t bytesprops6[] = {0x17, 0x5c, 0x6c, 0x94, 0x30, 0x9, 0xe0, 0x87, 0xcc, 0xac, 0xff, 0x56, 0x1f, 0x85,
                           0xbb, 0xeb, 0x36, 0x71, 0x3b, 0x9, 0x81, 0xc8, 0x6c, 0xfc, 0x44, 0xdc, 0x5e, 0xa0};
  uint8_t bytesprops8[] = {0xeb, 0x5c, 0xe5, 0x9a, 0xcd, 0xf1, 0x33, 0x4f, 0xf2, 0xaa, 0x15, 0x2b,
                           0x71, 0x81, 0xd2, 0xcd, 0xcb, 0x14, 0x35, 0xf9, 0x91, 0x3c, 0xb5, 0xce};
  uint8_t bytesprops9[] = {0xa7, 0x15, 0xfa, 0x78, 0x92, 0x4e, 0x78, 0xe1, 0xe9, 0xf7, 0x25,
                           0xc5, 0x9,  0xf5, 0xdd, 0x4d, 0x6e, 0x7d, 0x9e, 0xa8, 0x41, 0x32};
  uint8_t bytesprops10[] = {0xc2, 0x95, 0x89, 0x2,  0xa6, 0x8,  0x48, 0xd4, 0x65, 0xb8, 0x8e, 0xde, 0x9e,
                            0x9e, 0xc2, 0x4e, 0xac, 0x3,  0x5e, 0x1a, 0x49, 0x0,  0x19, 0x2f, 0x89};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22119}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26069}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4901}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6908}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops4}, .v = {5, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops6}, .v = {29, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3396}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6285}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 82}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\204s\226@u&7F!\EM\194o\133\175\187\203<\DC1;\239Q\RS\251\236J\167a\247\220", _pubPktID = 0, _pubBody =
// "\159(\138\244\237\128L\179\197a", _pubProps = [PropSubscriptionIdentifierAvailable 15,PropSessionExpiryInterval
// 22119,PropRetainAvailable 152,PropServerKeepAlive 26069,PropRequestResponseInformation 142,PropReceiveMaximum
// 4901,PropAssignedClientIdentifier
// "\145\&2B\192\177\230\ACK\US\157\197f$\209\239m\146\139R\183\159;$\231(\SI\158\185\144\135\191",PropAuthenticationMethod
// "\196\173q\132\199f|\DC1\218fj\224\195\&0\195{\150\190\226]\158\ESC@\146d\150\&4\130",PropContentType
// "t\135(\163",PropSubscriptionIdentifierAvailable 37,PropReceiveMaximum 6908,PropResponseTopic
// "\213#",PropUserProperty "K\190\162H\152\253\130>g\136\128\188" "\181i\180dT",PropUserProperty
// "\ETB\\l\148\&0\t\224\135\204\172\255V\US\133\187\235\&6q;\t\129\200l\252D\220^\160"
// "\EM\129\234\177\251\243\234\226\251\137jf\169d\246\254V\158\160\138Ohw\220\202^E'W",PropReasonString
// "\235\\\229\154\205\241\&3O\242\170\NAK+q\129\210\205\203\DC45\249\145<\181\206",PropWillDelayInterval
// 3396,PropTopicAlias 6285,PropAuthenticationMethod
// "\167\NAK\250x\146Nx\225\233\247%\197\t\245\221Mn}\158\168A2",PropAuthenticationMethod
// "\194\149\137\STX\166\bH\212e\184\142\222\158\158\194N\172\ETX^\SUBI\NUL\EM/\137",PropRetainAvailable 82]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {
      0x31, 0xbb, 0x2,  0x0,  0x1d, 0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2, 0x6f, 0x85, 0xaf,
      0xbb, 0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7, 0x61, 0xf7, 0xdc, 0x90, 0x2,  0x29, 0xf,
      0x11, 0x0,  0x0,  0x56, 0x67, 0x25, 0x98, 0x13, 0x65, 0xd5, 0x19, 0x8e, 0x21, 0x13, 0x25, 0x12, 0x0,  0x1e, 0x91,
      0x32, 0x42, 0xc0, 0xb1, 0xe6, 0x6,  0x1f, 0x9d, 0xc5, 0x66, 0x24, 0xd1, 0xef, 0x6d, 0x92, 0x8b, 0x52, 0xb7, 0x9f,
      0x3b, 0x24, 0xe7, 0x28, 0xf,  0x9e, 0xb9, 0x90, 0x87, 0xbf, 0x15, 0x0,  0x1c, 0xc4, 0xad, 0x71, 0x84, 0xc7, 0x66,
      0x7c, 0x11, 0xda, 0x66, 0x6a, 0xe0, 0xc3, 0x30, 0xc3, 0x7b, 0x96, 0xbe, 0xe2, 0x5d, 0x9e, 0x1b, 0x40, 0x92, 0x64,
      0x96, 0x34, 0x82, 0x3,  0x0,  0x4,  0x74, 0x87, 0x28, 0xa3, 0x29, 0x25, 0x21, 0x1a, 0xfc, 0x8,  0x0,  0x2,  0xd5,
      0x23, 0x26, 0x0,  0xc,  0x4b, 0xbe, 0xa2, 0x48, 0x98, 0xfd, 0x82, 0x3e, 0x67, 0x88, 0x80, 0xbc, 0x0,  0x5,  0xb5,
      0x69, 0xb4, 0x64, 0x54, 0x26, 0x0,  0x1c, 0x17, 0x5c, 0x6c, 0x94, 0x30, 0x9,  0xe0, 0x87, 0xcc, 0xac, 0xff, 0x56,
      0x1f, 0x85, 0xbb, 0xeb, 0x36, 0x71, 0x3b, 0x9,  0x81, 0xc8, 0x6c, 0xfc, 0x44, 0xdc, 0x5e, 0xa0, 0x0,  0x1d, 0x19,
      0x81, 0xea, 0xb1, 0xfb, 0xf3, 0xea, 0xe2, 0xfb, 0x89, 0x6a, 0x66, 0xa9, 0x64, 0xf6, 0xfe, 0x56, 0x9e, 0xa0, 0x8a,
      0x4f, 0x68, 0x77, 0xdc, 0xca, 0x5e, 0x45, 0x27, 0x57, 0x1f, 0x0,  0x18, 0xeb, 0x5c, 0xe5, 0x9a, 0xcd, 0xf1, 0x33,
      0x4f, 0xf2, 0xaa, 0x15, 0x2b, 0x71, 0x81, 0xd2, 0xcd, 0xcb, 0x14, 0x35, 0xf9, 0x91, 0x3c, 0xb5, 0xce, 0x18, 0x0,
      0x0,  0xd,  0x44, 0x23, 0x18, 0x8d, 0x15, 0x0,  0x16, 0xa7, 0x15, 0xfa, 0x78, 0x92, 0x4e, 0x78, 0xe1, 0xe9, 0xf7,
      0x25, 0xc5, 0x9,  0xf5, 0xdd, 0x4d, 0x6e, 0x7d, 0x9e, 0xa8, 0x41, 0x32, 0x15, 0x0,  0x19, 0xc2, 0x95, 0x89, 0x2,
      0xa6, 0x8,  0x48, 0xd4, 0x65, 0xb8, 0x8e, 0xde, 0x9e, 0x9e, 0xc2, 0x4e, 0xac, 0x3,  0x5e, 0x1a, 0x49, 0x0,  0x19,
      0x2f, 0x89, 0x25, 0x52, 0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcc, 0x73, 0xe2, 0x40, 0x75, 0x26, 0x37, 0x46, 0x21, 0x19, 0xc2, 0x6f, 0x85, 0xaf, 0xbb,
                               0xcb, 0x3c, 0x11, 0x3b, 0xef, 0x51, 0x1e, 0xfb, 0xec, 0x4a, 0xa7, 0x61, 0xf7, 0xdc};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9f, 0x28, 0x8a, 0xf4, 0xed, 0x80, 0x4c, 0xb3, 0xc5, 0x61};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "~\237S\145l\t\ACK0\CAN\236\137G!\FS~l\156\DC3\n>\135", _pubPktID = 0, _pubBody =
// "\NAK\255WE\SIQC\246\161\173\128\&6", _pubProps = [PropRetainAvailable 118,PropRequestResponseInformation
// 19,PropResponseInformation
// "b\240U45\182\253\195v\145\159\162\a\237\172\138\251\240\234J\203HA\184\&87\150\241\212",PropMessageExpiryInterval
// 6795]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x31, 0x4d, 0x0,  0x15, 0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18, 0xec, 0x89, 0x47,
                   0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87, 0x29, 0x25, 0x76, 0x19, 0x13, 0x1a, 0x0,
                   0x1d, 0x62, 0xf0, 0x55, 0x34, 0x35, 0xb6, 0xfd, 0xc3, 0x76, 0x91, 0x9f, 0xa2, 0x7,  0xed, 0xac,
                   0x8a, 0xfb, 0xf0, 0xea, 0x4a, 0xcb, 0x48, 0x41, 0xb8, 0x38, 0x37, 0x96, 0xf1, 0xd4, 0x2,  0x0,
                   0x0,  0x1a, 0x8b, 0x15, 0xff, 0x57, 0x45, 0xf,  0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  uint8_t topic_bytes[] = {0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18, 0xec, 0x89,
                           0x47, 0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x15, 0xff, 0x57, 0x45, 0xf, 0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x62, 0xf0, 0x55, 0x34, 0x35, 0xb6, 0xfd, 0xc3, 0x76, 0x91, 0x9f, 0xa2, 0x7,  0xed, 0xac,
                           0x8a, 0xfb, 0xf0, 0xea, 0x4a, 0xcb, 0x48, 0x41, 0xb8, 0x38, 0x37, 0x96, 0xf1, 0xd4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6795}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "~\237S\145l\t\ACK0\CAN\236\137G!\FS~l\156\DC3\n>\135", _pubPktID = 0, _pubBody =
// "\NAK\255WE\SIQC\246\161\173\128\&6", _pubProps = [PropRetainAvailable 118,PropRequestResponseInformation
// 19,PropResponseInformation
// "b\240U45\182\253\195v\145\159\162\a\237\172\138\251\240\234J\203HA\184\&87\150\241\212",PropMessageExpiryInterval
// 6795]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x31, 0x4d, 0x0,  0x15, 0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18, 0xec, 0x89, 0x47,
                   0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87, 0x29, 0x25, 0x76, 0x19, 0x13, 0x1a, 0x0,
                   0x1d, 0x62, 0xf0, 0x55, 0x34, 0x35, 0xb6, 0xfd, 0xc3, 0x76, 0x91, 0x9f, 0xa2, 0x7,  0xed, 0xac,
                   0x8a, 0xfb, 0xf0, 0xea, 0x4a, 0xcb, 0x48, 0x41, 0xb8, 0x38, 0x37, 0x96, 0xf1, 0xd4, 0x2,  0x0,
                   0x0,  0x1a, 0x8b, 0x15, 0xff, 0x57, 0x45, 0xf,  0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7e, 0xed, 0x53, 0x91, 0x6c, 0x9,  0x6,  0x30, 0x18, 0xec, 0x89,
                               0x47, 0x21, 0x1c, 0x7e, 0x6c, 0x9c, 0x13, 0xa,  0x3e, 0x87};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x15, 0xff, 0x57, 0x45, 0xf, 0x51, 0x43, 0xf6, 0xa1, 0xad, 0x80, 0x36};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\168q\180\235Y\176\233\DC2z6\175%\SOH\200c&\131\DC2\134#\151\139\&2\ETX\130\DC4", _pubPktID = 2807, _pubBody =
// "`\EOT\158\236\t\225\128\235\197\172aw\173\147\&8\DC3\EOT\244+\249C)zO\156\191\199", _pubProps = [PropCorrelationData
// "\136\230\t\187\137\198\220",PropMaximumPacketSize 335,PropUserProperty "{\ESC\177\148e\157"
// "I&\137*\206Xi\190k_\247n\251\209w\210C\237e/S\195,\224\176\ESC",PropWildcardSubscriptionAvailable
// 90,PropReceiveMaximum 24643,PropServerReference "o\f\189",PropResponseTopic "\174O\SYNA,",PropRetainAvailable
// 70,PropWildcardSubscriptionAvailable 4,PropResponseInformation
// "\DC4\255y*:\\\234\&6\193]\216\147\155\175\246\224\233+\171",PropSessionExpiryInterval 8433,PropMaximumQoS
// 76,PropMessageExpiryInterval 29147,PropAuthenticationData "\218\250/\142\237\164\161\SO\180\DC3",PropUserProperty
// "\212\185" "\132\231D\242\154\DLE\248",PropSubscriptionIdentifier 9,PropAuthenticationData
// "u\217\159\174>\148\252\SI\\y\156P~\185p",PropMessageExpiryInterval 5756,PropSessionExpiryInterval 27296]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x3a, 0xe1, 0x1,  0x0,  0x1a, 0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf, 0x25, 0x1,  0xc8,
      0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14, 0xa,  0xf7, 0xa6, 0x1,  0x9,  0x0,  0x7,
      0x88, 0xe6, 0x9,  0xbb, 0x89, 0xc6, 0xdc, 0x27, 0x0,  0x0,  0x1,  0x4f, 0x26, 0x0,  0x6,  0x7b, 0x1b, 0xb1, 0x94,
      0x65, 0x9d, 0x0,  0x1a, 0x49, 0x26, 0x89, 0x2a, 0xce, 0x58, 0x69, 0xbe, 0x6b, 0x5f, 0xf7, 0x6e, 0xfb, 0xd1, 0x77,
      0xd2, 0x43, 0xed, 0x65, 0x2f, 0x53, 0xc3, 0x2c, 0xe0, 0xb0, 0x1b, 0x28, 0x5a, 0x21, 0x60, 0x43, 0x1c, 0x0,  0x3,
      0x6f, 0xc,  0xbd, 0x8,  0x0,  0x5,  0xae, 0x4f, 0x16, 0x41, 0x2c, 0x25, 0x46, 0x28, 0x4,  0x1a, 0x0,  0x13, 0x14,
      0xff, 0x79, 0x2a, 0x3a, 0x5c, 0xea, 0x36, 0xc1, 0x5d, 0xd8, 0x93, 0x9b, 0xaf, 0xf6, 0xe0, 0xe9, 0x2b, 0xab, 0x11,
      0x0,  0x0,  0x20, 0xf1, 0x24, 0x4c, 0x2,  0x0,  0x0,  0x71, 0xdb, 0x16, 0x0,  0xa,  0xda, 0xfa, 0x2f, 0x8e, 0xed,
      0xa4, 0xa1, 0xe,  0xb4, 0x13, 0x26, 0x0,  0x2,  0xd4, 0xb9, 0x0,  0x7,  0x84, 0xe7, 0x44, 0xf2, 0x9a, 0x10, 0xf8,
      0xb,  0x9,  0x16, 0x0,  0xf,  0x75, 0xd9, 0x9f, 0xae, 0x3e, 0x94, 0xfc, 0xf,  0x5c, 0x79, 0x9c, 0x50, 0x7e, 0xb9,
      0x70, 0x2,  0x0,  0x0,  0x16, 0x7c, 0x11, 0x0,  0x0,  0x6a, 0xa0, 0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb,
      0xc5, 0xac, 0x61, 0x77, 0xad, 0x93, 0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  uint8_t topic_bytes[] = {0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf, 0x25, 0x1,
                           0xc8, 0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb, 0xc5, 0xac, 0x61, 0x77, 0xad, 0x93,
                         0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0x88, 0xe6, 0x9, 0xbb, 0x89, 0xc6, 0xdc};
  uint8_t bytesprops2[] = {0x49, 0x26, 0x89, 0x2a, 0xce, 0x58, 0x69, 0xbe, 0x6b, 0x5f, 0xf7, 0x6e, 0xfb,
                           0xd1, 0x77, 0xd2, 0x43, 0xed, 0x65, 0x2f, 0x53, 0xc3, 0x2c, 0xe0, 0xb0, 0x1b};
  uint8_t bytesprops1[] = {0x7b, 0x1b, 0xb1, 0x94, 0x65, 0x9d};
  uint8_t bytesprops3[] = {0x6f, 0xc, 0xbd};
  uint8_t bytesprops4[] = {0xae, 0x4f, 0x16, 0x41, 0x2c};
  uint8_t bytesprops5[] = {0x14, 0xff, 0x79, 0x2a, 0x3a, 0x5c, 0xea, 0x36, 0xc1, 0x5d,
                           0xd8, 0x93, 0x9b, 0xaf, 0xf6, 0xe0, 0xe9, 0x2b, 0xab};
  uint8_t bytesprops6[] = {0xda, 0xfa, 0x2f, 0x8e, 0xed, 0xa4, 0xa1, 0xe, 0xb4, 0x13};
  uint8_t bytesprops8[] = {0x84, 0xe7, 0x44, 0xf2, 0x9a, 0x10, 0xf8};
  uint8_t bytesprops7[] = {0xd4, 0xb9};
  uint8_t bytesprops9[] = {0x75, 0xd9, 0x9f, 0xae, 0x3e, 0x94, 0xfc, 0xf, 0x5c, 0x79, 0x9c, 0x50, 0x7e, 0xb9, 0x70};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 335}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops1}, .v = {26, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24643}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8433}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29147}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops7}, .v = {7, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5756}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27296}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 2807, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\168q\180\235Y\176\233\DC2z6\175%\SOH\200c&\131\DC2\134#\151\139\&2\ETX\130\DC4", _pubPktID = 2807, _pubBody =
// "`\EOT\158\236\t\225\128\235\197\172aw\173\147\&8\DC3\EOT\244+\249C)zO\156\191\199", _pubProps = [PropCorrelationData
// "\136\230\t\187\137\198\220",PropMaximumPacketSize 335,PropUserProperty "{\ESC\177\148e\157"
// "I&\137*\206Xi\190k_\247n\251\209w\210C\237e/S\195,\224\176\ESC",PropWildcardSubscriptionAvailable
// 90,PropReceiveMaximum 24643,PropServerReference "o\f\189",PropResponseTopic "\174O\SYNA,",PropRetainAvailable
// 70,PropWildcardSubscriptionAvailable 4,PropResponseInformation
// "\DC4\255y*:\\\234\&6\193]\216\147\155\175\246\224\233+\171",PropSessionExpiryInterval 8433,PropMaximumQoS
// 76,PropMessageExpiryInterval 29147,PropAuthenticationData "\218\250/\142\237\164\161\SO\180\DC3",PropUserProperty
// "\212\185" "\132\231D\242\154\DLE\248",PropSubscriptionIdentifier 9,PropAuthenticationData
// "u\217\159\174>\148\252\SI\\y\156P~\185p",PropMessageExpiryInterval 5756,PropSessionExpiryInterval 27296]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {
      0x3a, 0xe1, 0x1,  0x0,  0x1a, 0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf, 0x25, 0x1,  0xc8,
      0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14, 0xa,  0xf7, 0xa6, 0x1,  0x9,  0x0,  0x7,
      0x88, 0xe6, 0x9,  0xbb, 0x89, 0xc6, 0xdc, 0x27, 0x0,  0x0,  0x1,  0x4f, 0x26, 0x0,  0x6,  0x7b, 0x1b, 0xb1, 0x94,
      0x65, 0x9d, 0x0,  0x1a, 0x49, 0x26, 0x89, 0x2a, 0xce, 0x58, 0x69, 0xbe, 0x6b, 0x5f, 0xf7, 0x6e, 0xfb, 0xd1, 0x77,
      0xd2, 0x43, 0xed, 0x65, 0x2f, 0x53, 0xc3, 0x2c, 0xe0, 0xb0, 0x1b, 0x28, 0x5a, 0x21, 0x60, 0x43, 0x1c, 0x0,  0x3,
      0x6f, 0xc,  0xbd, 0x8,  0x0,  0x5,  0xae, 0x4f, 0x16, 0x41, 0x2c, 0x25, 0x46, 0x28, 0x4,  0x1a, 0x0,  0x13, 0x14,
      0xff, 0x79, 0x2a, 0x3a, 0x5c, 0xea, 0x36, 0xc1, 0x5d, 0xd8, 0x93, 0x9b, 0xaf, 0xf6, 0xe0, 0xe9, 0x2b, 0xab, 0x11,
      0x0,  0x0,  0x20, 0xf1, 0x24, 0x4c, 0x2,  0x0,  0x0,  0x71, 0xdb, 0x16, 0x0,  0xa,  0xda, 0xfa, 0x2f, 0x8e, 0xed,
      0xa4, 0xa1, 0xe,  0xb4, 0x13, 0x26, 0x0,  0x2,  0xd4, 0xb9, 0x0,  0x7,  0x84, 0xe7, 0x44, 0xf2, 0x9a, 0x10, 0xf8,
      0xb,  0x9,  0x16, 0x0,  0xf,  0x75, 0xd9, 0x9f, 0xae, 0x3e, 0x94, 0xfc, 0xf,  0x5c, 0x79, 0x9c, 0x50, 0x7e, 0xb9,
      0x70, 0x2,  0x0,  0x0,  0x16, 0x7c, 0x11, 0x0,  0x0,  0x6a, 0xa0, 0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb,
      0xc5, 0xac, 0x61, 0x77, 0xad, 0x93, 0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa8, 0x71, 0xb4, 0xeb, 0x59, 0xb0, 0xe9, 0x12, 0x7a, 0x36, 0xaf, 0x25, 0x1,
                               0xc8, 0x63, 0x26, 0x83, 0x12, 0x86, 0x23, 0x97, 0x8b, 0x32, 0x3,  0x82, 0x14};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x60, 0x4,  0x9e, 0xec, 0x9,  0xe1, 0x80, 0xeb, 0xc5, 0xac, 0x61, 0x77, 0xad, 0x93,
                              0x38, 0x13, 0x4,  0xf4, 0x2b, 0xf9, 0x43, 0x29, 0x7a, 0x4f, 0x9c, 0xbf, 0xc7};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2807);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207\198\194\214\STX\139\&4_\212\172\NAKu:\233\181_\247\164\SUB", _pubPktID = 13284, _pubBody =
// "\154\166c\188;\235r\148\223\SYN\DEL", _pubProps = [PropRetainAvailable 21,PropSubscriptionIdentifier
// 31,PropReceiveMaximum 2517,PropServerKeepAlive 6414,PropResponseTopic
// "^\249\195\230\169\EM\192Y\DC4\182\188\253\197\198\132\132g\155u\227\SYN\230",PropAuthenticationData
// "\184\146\134G\DLE\SO\198sbit\220\245\201$\205V\174\212\DLE\169\214\145",PropMaximumQoS
// 155,PropSharedSubscriptionAvailable 149,PropContentType
// "\248\149\156\240\161PC\142\179N\201\219\225\a\229q\238\207\235",PropServerKeepAlive 9191,PropReasonString
// "\251\190\196B\191",PropServerKeepAlive 25660,PropWillDelayInterval 13246,PropCorrelationData
// "\208\216nK\n\"\164cO\154\CAN\189Q\146\216'\SYNHF\ENQ\133\166\207\207\174\182\DC2",PropWillDelayInterval
// 4856,PropServerKeepAlive 31311,PropSubscriptionIdentifier 4,PropWildcardSubscriptionAvailable
// 100,PropAuthenticationMethod "W\223\&5\204\212\216K\NAKz\148\231S;",PropSharedSubscriptionAvailable
// 94,PropResponseTopic "\216\198b\180\207\199\206\200\166\190\220\242\167\SUB\169\196st\138\255\234\193"]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x3c, 0xe3, 0x1,  0x0,  0x13, 0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f, 0xd4, 0xac, 0x15, 0x75,
                   0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a, 0x33, 0xe4, 0xbf, 0x1,  0x25, 0x15, 0xb,  0x1f, 0x21, 0x9,
                   0xd5, 0x13, 0x19, 0xe,  0x8,  0x0,  0x16, 0x5e, 0xf9, 0xc3, 0xe6, 0xa9, 0x19, 0xc0, 0x59, 0x14, 0xb6,
                   0xbc, 0xfd, 0xc5, 0xc6, 0x84, 0x84, 0x67, 0x9b, 0x75, 0xe3, 0x16, 0xe6, 0x16, 0x0,  0x17, 0xb8, 0x92,
                   0x86, 0x47, 0x10, 0xe,  0xc6, 0x73, 0x62, 0x69, 0x74, 0xdc, 0xf5, 0xc9, 0x24, 0xcd, 0x56, 0xae, 0xd4,
                   0x10, 0xa9, 0xd6, 0x91, 0x24, 0x9b, 0x2a, 0x95, 0x3,  0x0,  0x13, 0xf8, 0x95, 0x9c, 0xf0, 0xa1, 0x50,
                   0x43, 0x8e, 0xb3, 0x4e, 0xc9, 0xdb, 0xe1, 0x7,  0xe5, 0x71, 0xee, 0xcf, 0xeb, 0x13, 0x23, 0xe7, 0x1f,
                   0x0,  0x5,  0xfb, 0xbe, 0xc4, 0x42, 0xbf, 0x13, 0x64, 0x3c, 0x18, 0x0,  0x0,  0x33, 0xbe, 0x9,  0x0,
                   0x1b, 0xd0, 0xd8, 0x6e, 0x4b, 0xa,  0x22, 0xa4, 0x63, 0x4f, 0x9a, 0x18, 0xbd, 0x51, 0x92, 0xd8, 0x27,
                   0x16, 0x48, 0x46, 0x5,  0x85, 0xa6, 0xcf, 0xcf, 0xae, 0xb6, 0x12, 0x18, 0x0,  0x0,  0x12, 0xf8, 0x13,
                   0x7a, 0x4f, 0xb,  0x4,  0x28, 0x64, 0x15, 0x0,  0xd,  0x57, 0xdf, 0x35, 0xcc, 0xd4, 0xd8, 0x4b, 0x15,
                   0x7a, 0x94, 0xe7, 0x53, 0x3b, 0x2a, 0x5e, 0x8,  0x0,  0x16, 0xd8, 0xc6, 0x62, 0xb4, 0xcf, 0xc7, 0xce,
                   0xc8, 0xa6, 0xbe, 0xdc, 0xf2, 0xa7, 0x1a, 0xa9, 0xc4, 0x73, 0x74, 0x8a, 0xff, 0xea, 0xc1, 0x9a, 0xa6,
                   0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  uint8_t topic_bytes[] = {0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f, 0xd4, 0xac,
                           0x15, 0x75, 0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9a, 0xa6, 0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0x5e, 0xf9, 0xc3, 0xe6, 0xa9, 0x19, 0xc0, 0x59, 0x14, 0xb6, 0xbc,
                           0xfd, 0xc5, 0xc6, 0x84, 0x84, 0x67, 0x9b, 0x75, 0xe3, 0x16, 0xe6};
  uint8_t bytesprops1[] = {0xb8, 0x92, 0x86, 0x47, 0x10, 0xe,  0xc6, 0x73, 0x62, 0x69, 0x74, 0xdc,
                           0xf5, 0xc9, 0x24, 0xcd, 0x56, 0xae, 0xd4, 0x10, 0xa9, 0xd6, 0x91};
  uint8_t bytesprops2[] = {0xf8, 0x95, 0x9c, 0xf0, 0xa1, 0x50, 0x43, 0x8e, 0xb3, 0x4e,
                           0xc9, 0xdb, 0xe1, 0x7,  0xe5, 0x71, 0xee, 0xcf, 0xeb};
  uint8_t bytesprops3[] = {0xfb, 0xbe, 0xc4, 0x42, 0xbf};
  uint8_t bytesprops4[] = {0xd0, 0xd8, 0x6e, 0x4b, 0xa,  0x22, 0xa4, 0x63, 0x4f, 0x9a, 0x18, 0xbd, 0x51, 0x92,
                           0xd8, 0x27, 0x16, 0x48, 0x46, 0x5,  0x85, 0xa6, 0xcf, 0xcf, 0xae, 0xb6, 0x12};
  uint8_t bytesprops5[] = {0x57, 0xdf, 0x35, 0xcc, 0xd4, 0xd8, 0x4b, 0x15, 0x7a, 0x94, 0xe7, 0x53, 0x3b};
  uint8_t bytesprops6[] = {0xd8, 0xc6, 0x62, 0xb4, 0xcf, 0xc7, 0xce, 0xc8, 0xa6, 0xbe, 0xdc,
                           0xf2, 0xa7, 0x1a, 0xa9, 0xc4, 0x73, 0x74, 0x8a, 0xff, 0xea, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2517}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6414}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9191}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25660}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13246}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4856}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31311}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 13284, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207\198\194\214\STX\139\&4_\212\172\NAKu:\233\181_\247\164\SUB", _pubPktID = 13284, _pubBody =
// "\154\166c\188;\235r\148\223\SYN\DEL", _pubProps = [PropRetainAvailable 21,PropSubscriptionIdentifier
// 31,PropReceiveMaximum 2517,PropServerKeepAlive 6414,PropResponseTopic
// "^\249\195\230\169\EM\192Y\DC4\182\188\253\197\198\132\132g\155u\227\SYN\230",PropAuthenticationData
// "\184\146\134G\DLE\SO\198sbit\220\245\201$\205V\174\212\DLE\169\214\145",PropMaximumQoS
// 155,PropSharedSubscriptionAvailable 149,PropContentType
// "\248\149\156\240\161PC\142\179N\201\219\225\a\229q\238\207\235",PropServerKeepAlive 9191,PropReasonString
// "\251\190\196B\191",PropServerKeepAlive 25660,PropWillDelayInterval 13246,PropCorrelationData
// "\208\216nK\n\"\164cO\154\CAN\189Q\146\216'\SYNHF\ENQ\133\166\207\207\174\182\DC2",PropWillDelayInterval
// 4856,PropServerKeepAlive 31311,PropSubscriptionIdentifier 4,PropWildcardSubscriptionAvailable
// 100,PropAuthenticationMethod "W\223\&5\204\212\216K\NAKz\148\231S;",PropSharedSubscriptionAvailable
// 94,PropResponseTopic "\216\198b\180\207\199\206\200\166\190\220\242\167\SUB\169\196st\138\255\234\193"]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {0x3c, 0xe3, 0x1,  0x0,  0x13, 0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f, 0xd4, 0xac, 0x15, 0x75,
                   0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a, 0x33, 0xe4, 0xbf, 0x1,  0x25, 0x15, 0xb,  0x1f, 0x21, 0x9,
                   0xd5, 0x13, 0x19, 0xe,  0x8,  0x0,  0x16, 0x5e, 0xf9, 0xc3, 0xe6, 0xa9, 0x19, 0xc0, 0x59, 0x14, 0xb6,
                   0xbc, 0xfd, 0xc5, 0xc6, 0x84, 0x84, 0x67, 0x9b, 0x75, 0xe3, 0x16, 0xe6, 0x16, 0x0,  0x17, 0xb8, 0x92,
                   0x86, 0x47, 0x10, 0xe,  0xc6, 0x73, 0x62, 0x69, 0x74, 0xdc, 0xf5, 0xc9, 0x24, 0xcd, 0x56, 0xae, 0xd4,
                   0x10, 0xa9, 0xd6, 0x91, 0x24, 0x9b, 0x2a, 0x95, 0x3,  0x0,  0x13, 0xf8, 0x95, 0x9c, 0xf0, 0xa1, 0x50,
                   0x43, 0x8e, 0xb3, 0x4e, 0xc9, 0xdb, 0xe1, 0x7,  0xe5, 0x71, 0xee, 0xcf, 0xeb, 0x13, 0x23, 0xe7, 0x1f,
                   0x0,  0x5,  0xfb, 0xbe, 0xc4, 0x42, 0xbf, 0x13, 0x64, 0x3c, 0x18, 0x0,  0x0,  0x33, 0xbe, 0x9,  0x0,
                   0x1b, 0xd0, 0xd8, 0x6e, 0x4b, 0xa,  0x22, 0xa4, 0x63, 0x4f, 0x9a, 0x18, 0xbd, 0x51, 0x92, 0xd8, 0x27,
                   0x16, 0x48, 0x46, 0x5,  0x85, 0xa6, 0xcf, 0xcf, 0xae, 0xb6, 0x12, 0x18, 0x0,  0x0,  0x12, 0xf8, 0x13,
                   0x7a, 0x4f, 0xb,  0x4,  0x28, 0x64, 0x15, 0x0,  0xd,  0x57, 0xdf, 0x35, 0xcc, 0xd4, 0xd8, 0x4b, 0x15,
                   0x7a, 0x94, 0xe7, 0x53, 0x3b, 0x2a, 0x5e, 0x8,  0x0,  0x16, 0xd8, 0xc6, 0x62, 0xb4, 0xcf, 0xc7, 0xce,
                   0xc8, 0xa6, 0xbe, 0xdc, 0xf2, 0xa7, 0x1a, 0xa9, 0xc4, 0x73, 0x74, 0x8a, 0xff, 0xea, 0xc1, 0x9a, 0xa6,
                   0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0xc6, 0xc2, 0xd6, 0x2,  0x8b, 0x34, 0x5f, 0xd4, 0xac,
                               0x15, 0x75, 0x3a, 0xe9, 0xb5, 0x5f, 0xf7, 0xa4, 0x1a};
  lwmqtt_string_t exp_topic = {19, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9a, 0xa6, 0x63, 0xbc, 0x3b, 0xeb, 0x72, 0x94, 0xdf, 0x16, 0x7f};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 13284);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 19);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\159\US\147\DC3i\FS\CAN@\178\DC2\202\145>\185\195\148\f3@ \SOH\202\166\182\STX\v\130\SYN", _pubPktID = 25675,
// _pubBody = "\138\158G\154\229\140)?>\221\211<\190", _pubProps = [PropReasonString
// "C\179\185>\185\233>\221\ETB\210\ESC1\191\222\\t34\204\243\130\DLE\ETB1\179\164\168X",PropMessageExpiryInterval
// 21252,PropRequestProblemInformation 18,PropWildcardSubscriptionAvailable 23,PropTopicAlias 2791,PropCorrelationData
// "\195Q\228\179\197%\222\222\ESC#^\237kK\168",PropSubscriptionIdentifierAvailable 244,PropServerReference
// "G[\234\142T\228\212",PropResponseTopic "Ae\168\145\b",PropWillDelayInterval 30687,PropAssignedClientIdentifier
// "o\NUL\156<B\227\225\137\191\248\225Q9\r\238\EM",PropResponseTopic "[\"",PropSharedSubscriptionAvailable
// 147,PropAuthenticationData
// "\132\ETB\142g!\218U\DLE\230\161\157\166h\DC17\240\191=\216\DC1\a\135\240R\n\201\134\SO",PropContentType
// "\133\142\SOO\SO\&H\131&\252\168l\247\182\138\220i\141{\208\223",PropMessageExpiryInterval 6189,PropServerKeepAlive
// 1712,PropTopicAliasMaximum 8672,PropPayloadFormatIndicator 62,PropWildcardSubscriptionAvailable
// 90,PropAuthenticationData "2 V\DC1\189'w\133\183\SYNg\SO",PropRetainAvailable 215,PropMaximumPacketSize
// 19086,PropUserProperty "\189l\208Hw" ""]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x3d, 0x84, 0x2,  0x0,  0x1c, 0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91, 0x3e, 0xb9,
      0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16, 0x64, 0x4b, 0xd5, 0x1,  0x1f,
      0x0,  0x1c, 0x43, 0xb3, 0xb9, 0x3e, 0xb9, 0xe9, 0x3e, 0xdd, 0x17, 0xd2, 0x1b, 0x31, 0xbf, 0xde, 0x5c, 0x74, 0x33,
      0x34, 0xcc, 0xf3, 0x82, 0x10, 0x17, 0x31, 0xb3, 0xa4, 0xa8, 0x58, 0x2,  0x0,  0x0,  0x53, 0x4,  0x17, 0x12, 0x28,
      0x17, 0x23, 0xa,  0xe7, 0x9,  0x0,  0xf,  0xc3, 0x51, 0xe4, 0xb3, 0xc5, 0x25, 0xde, 0xde, 0x1b, 0x23, 0x5e, 0xed,
      0x6b, 0x4b, 0xa8, 0x29, 0xf4, 0x1c, 0x0,  0x7,  0x47, 0x5b, 0xea, 0x8e, 0x54, 0xe4, 0xd4, 0x8,  0x0,  0x5,  0x41,
      0x65, 0xa8, 0x91, 0x8,  0x18, 0x0,  0x0,  0x77, 0xdf, 0x12, 0x0,  0x10, 0x6f, 0x0,  0x9c, 0x3c, 0x42, 0xe3, 0xe1,
      0x89, 0xbf, 0xf8, 0xe1, 0x51, 0x39, 0xd,  0xee, 0x19, 0x8,  0x0,  0x2,  0x5b, 0x22, 0x2a, 0x93, 0x16, 0x0,  0x1c,
      0x84, 0x17, 0x8e, 0x67, 0x21, 0xda, 0x55, 0x10, 0xe6, 0xa1, 0x9d, 0xa6, 0x68, 0x11, 0x37, 0xf0, 0xbf, 0x3d, 0xd8,
      0x11, 0x7,  0x87, 0xf0, 0x52, 0xa,  0xc9, 0x86, 0xe,  0x3,  0x0,  0x14, 0x85, 0x8e, 0xe,  0x4f, 0xe,  0x48, 0x83,
      0x26, 0xfc, 0xa8, 0x6c, 0xf7, 0xb6, 0x8a, 0xdc, 0x69, 0x8d, 0x7b, 0xd0, 0xdf, 0x2,  0x0,  0x0,  0x18, 0x2d, 0x13,
      0x6,  0xb0, 0x22, 0x21, 0xe0, 0x1,  0x3e, 0x28, 0x5a, 0x16, 0x0,  0xc,  0x32, 0x20, 0x56, 0x11, 0xbd, 0x27, 0x77,
      0x85, 0xb7, 0x16, 0x67, 0xe,  0x25, 0xd7, 0x27, 0x0,  0x0,  0x4a, 0x8e, 0x26, 0x0,  0x5,  0xbd, 0x6c, 0xd0, 0x48,
      0x77, 0x0,  0x0,  0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  uint8_t topic_bytes[] = {0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91, 0x3e, 0xb9,
                           0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0x43, 0xb3, 0xb9, 0x3e, 0xb9, 0xe9, 0x3e, 0xdd, 0x17, 0xd2, 0x1b, 0x31, 0xbf, 0xde,
                           0x5c, 0x74, 0x33, 0x34, 0xcc, 0xf3, 0x82, 0x10, 0x17, 0x31, 0xb3, 0xa4, 0xa8, 0x58};
  uint8_t bytesprops1[] = {0xc3, 0x51, 0xe4, 0xb3, 0xc5, 0x25, 0xde, 0xde, 0x1b, 0x23, 0x5e, 0xed, 0x6b, 0x4b, 0xa8};
  uint8_t bytesprops2[] = {0x47, 0x5b, 0xea, 0x8e, 0x54, 0xe4, 0xd4};
  uint8_t bytesprops3[] = {0x41, 0x65, 0xa8, 0x91, 0x8};
  uint8_t bytesprops4[] = {0x6f, 0x0,  0x9c, 0x3c, 0x42, 0xe3, 0xe1, 0x89,
                           0xbf, 0xf8, 0xe1, 0x51, 0x39, 0xd,  0xee, 0x19};
  uint8_t bytesprops5[] = {0x5b, 0x22};
  uint8_t bytesprops6[] = {0x84, 0x17, 0x8e, 0x67, 0x21, 0xda, 0x55, 0x10, 0xe6, 0xa1, 0x9d, 0xa6, 0x68, 0x11,
                           0x37, 0xf0, 0xbf, 0x3d, 0xd8, 0x11, 0x7,  0x87, 0xf0, 0x52, 0xa,  0xc9, 0x86, 0xe};
  uint8_t bytesprops7[] = {0x85, 0x8e, 0xe,  0x4f, 0xe,  0x48, 0x83, 0x26, 0xfc, 0xa8,
                           0x6c, 0xf7, 0xb6, 0x8a, 0xdc, 0x69, 0x8d, 0x7b, 0xd0, 0xdf};
  uint8_t bytesprops8[] = {0x32, 0x20, 0x56, 0x11, 0xbd, 0x27, 0x77, 0x85, 0xb7, 0x16, 0x67, 0xe};
  uint8_t bytesprops10[] = {0};
  uint8_t bytesprops9[] = {0xbd, 0x6c, 0xd0, 0x48, 0x77};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21252}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2791}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30687}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6189}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1712}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8672}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19086}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops9}, .v = {0, (char*)&bytesprops10}}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 25675, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\159\US\147\DC3i\FS\CAN@\178\DC2\202\145>\185\195\148\f3@ \SOH\202\166\182\STX\v\130\SYN", _pubPktID = 25675,
// _pubBody = "\138\158G\154\229\140)?>\221\211<\190", _pubProps = [PropReasonString
// "C\179\185>\185\233>\221\ETB\210\ESC1\191\222\\t34\204\243\130\DLE\ETB1\179\164\168X",PropMessageExpiryInterval
// 21252,PropRequestProblemInformation 18,PropWildcardSubscriptionAvailable 23,PropTopicAlias 2791,PropCorrelationData
// "\195Q\228\179\197%\222\222\ESC#^\237kK\168",PropSubscriptionIdentifierAvailable 244,PropServerReference
// "G[\234\142T\228\212",PropResponseTopic "Ae\168\145\b",PropWillDelayInterval 30687,PropAssignedClientIdentifier
// "o\NUL\156<B\227\225\137\191\248\225Q9\r\238\EM",PropResponseTopic "[\"",PropSharedSubscriptionAvailable
// 147,PropAuthenticationData
// "\132\ETB\142g!\218U\DLE\230\161\157\166h\DC17\240\191=\216\DC1\a\135\240R\n\201\134\SO",PropContentType
// "\133\142\SOO\SO\&H\131&\252\168l\247\182\138\220i\141{\208\223",PropMessageExpiryInterval 6189,PropServerKeepAlive
// 1712,PropTopicAliasMaximum 8672,PropPayloadFormatIndicator 62,PropWildcardSubscriptionAvailable
// 90,PropAuthenticationData "2 V\DC1\189'w\133\183\SYNg\SO",PropRetainAvailable 215,PropMaximumPacketSize
// 19086,PropUserProperty "\189l\208Hw" ""]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {
      0x3d, 0x84, 0x2,  0x0,  0x1c, 0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91, 0x3e, 0xb9,
      0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16, 0x64, 0x4b, 0xd5, 0x1,  0x1f,
      0x0,  0x1c, 0x43, 0xb3, 0xb9, 0x3e, 0xb9, 0xe9, 0x3e, 0xdd, 0x17, 0xd2, 0x1b, 0x31, 0xbf, 0xde, 0x5c, 0x74, 0x33,
      0x34, 0xcc, 0xf3, 0x82, 0x10, 0x17, 0x31, 0xb3, 0xa4, 0xa8, 0x58, 0x2,  0x0,  0x0,  0x53, 0x4,  0x17, 0x12, 0x28,
      0x17, 0x23, 0xa,  0xe7, 0x9,  0x0,  0xf,  0xc3, 0x51, 0xe4, 0xb3, 0xc5, 0x25, 0xde, 0xde, 0x1b, 0x23, 0x5e, 0xed,
      0x6b, 0x4b, 0xa8, 0x29, 0xf4, 0x1c, 0x0,  0x7,  0x47, 0x5b, 0xea, 0x8e, 0x54, 0xe4, 0xd4, 0x8,  0x0,  0x5,  0x41,
      0x65, 0xa8, 0x91, 0x8,  0x18, 0x0,  0x0,  0x77, 0xdf, 0x12, 0x0,  0x10, 0x6f, 0x0,  0x9c, 0x3c, 0x42, 0xe3, 0xe1,
      0x89, 0xbf, 0xf8, 0xe1, 0x51, 0x39, 0xd,  0xee, 0x19, 0x8,  0x0,  0x2,  0x5b, 0x22, 0x2a, 0x93, 0x16, 0x0,  0x1c,
      0x84, 0x17, 0x8e, 0x67, 0x21, 0xda, 0x55, 0x10, 0xe6, 0xa1, 0x9d, 0xa6, 0x68, 0x11, 0x37, 0xf0, 0xbf, 0x3d, 0xd8,
      0x11, 0x7,  0x87, 0xf0, 0x52, 0xa,  0xc9, 0x86, 0xe,  0x3,  0x0,  0x14, 0x85, 0x8e, 0xe,  0x4f, 0xe,  0x48, 0x83,
      0x26, 0xfc, 0xa8, 0x6c, 0xf7, 0xb6, 0x8a, 0xdc, 0x69, 0x8d, 0x7b, 0xd0, 0xdf, 0x2,  0x0,  0x0,  0x18, 0x2d, 0x13,
      0x6,  0xb0, 0x22, 0x21, 0xe0, 0x1,  0x3e, 0x28, 0x5a, 0x16, 0x0,  0xc,  0x32, 0x20, 0x56, 0x11, 0xbd, 0x27, 0x77,
      0x85, 0xb7, 0x16, 0x67, 0xe,  0x25, 0xd7, 0x27, 0x0,  0x0,  0x4a, 0x8e, 0x26, 0x0,  0x5,  0xbd, 0x6c, 0xd0, 0x48,
      0x77, 0x0,  0x0,  0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9f, 0x1f, 0x93, 0x13, 0x69, 0x1c, 0x18, 0x40, 0xb2, 0x12, 0xca, 0x91, 0x3e, 0xb9,
                               0xc3, 0x94, 0xc,  0x33, 0x40, 0x20, 0x1,  0xca, 0xa6, 0xb6, 0x2,  0xb,  0x82, 0x16};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8a, 0x9e, 0x47, 0x9a, 0xe5, 0x8c, 0x29, 0x3f, 0x3e, 0xdd, 0xd3, 0x3c, 0xbe};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25675);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\185\246\SOH*\248(\178k\\\215\174",
// _pubPktID = 11115, _pubBody = ".\DC1\fEQhj\183\224@\215\"\231B\243L\206 \210\231\178", _pubProps =
// [PropTopicAliasMaximum 12234,PropServerKeepAlive 26536,PropWildcardSubscriptionAvailable
// 235,PropWildcardSubscriptionAvailable 3,PropSubscriptionIdentifier 21]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {0x32, 0x31, 0x0,  0xb,  0xb9, 0xf6, 0x1,  0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c,
                   0xd7, 0xae, 0x2b, 0x6b, 0xc,  0x22, 0x2f, 0xca, 0x13, 0x67, 0xa8, 0x28, 0xeb,
                   0x28, 0x3,  0xb,  0x15, 0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0,
                   0x40, 0xd7, 0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  uint8_t topic_bytes[] = {0xb9, 0xf6, 0x1, 0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c, 0xd7, 0xae};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0, 0x40, 0xd7,
                         0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12234}}, {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26536}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 235}},    {.prop = (lwmqtt_prop_t)40, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 11115, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\185\246\SOH*\248(\178k\\\215\174",
// _pubPktID = 11115, _pubBody = ".\DC1\fEQhj\183\224@\215\"\231B\243L\206 \210\231\178", _pubProps =
// [PropTopicAliasMaximum 12234,PropServerKeepAlive 26536,PropWildcardSubscriptionAvailable
// 235,PropWildcardSubscriptionAvailable 3,PropSubscriptionIdentifier 21]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {0x32, 0x31, 0x0,  0xb,  0xb9, 0xf6, 0x1,  0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c,
                   0xd7, 0xae, 0x2b, 0x6b, 0xc,  0x22, 0x2f, 0xca, 0x13, 0x67, 0xa8, 0x28, 0xeb,
                   0x28, 0x3,  0xb,  0x15, 0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0,
                   0x40, 0xd7, 0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb9, 0xf6, 0x1, 0x2a, 0xf8, 0x28, 0xb2, 0x6b, 0x5c, 0xd7, 0xae};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2e, 0x11, 0xc,  0x45, 0x51, 0x68, 0x6a, 0xb7, 0xe0, 0x40, 0xd7,
                              0x22, 0xe7, 0x42, 0xf3, 0x4c, 0xce, 0x20, 0xd2, 0xe7, 0xb2};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11115);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\186\171$\215\213", _pubPktID =
// 24590, _pubBody = "En.&\166\184\215\153", _pubProps = [PropSubscriptionIdentifier 22,PropReceiveMaximum
// 18265,PropContentType "\139]D_a&\176\214\131\207\205\219\SUBf\a=8\213\134\227",PropTopicAlias 25478,PropResponseTopic
// "\DEL+\SUB \185\244\146K\147J\168s\\\220\142\&7@-i\161\160\151.\148;J",PropReceiveMaximum 22318,PropTopicAliasMaximum
// 20907,PropPayloadFormatIndicator 158,PropTopicAlias 25235,PropSharedSubscriptionAvailable 149,PropReasonString
// "+E\197\223\235\RS\234e,S\NUL\247U,J\240yR",PropUserProperty
// "4-\152'\221\247\253?&\a?\r\224\NAK\222\254\137\NUL\ETX\216`h\EOT"
// "\175\&6\240\&2\240,\186\137\204?\133\201\255\169\219\GS2VM\ETB\204%\160\150b\180",PropAssignedClientIdentifier
// "\223\135\244\158\174\162F\232\205\CANE\199\ACK\SUB\STXF\216\235=#)&\182\221",PropMessageExpiryInterval
// 18609,PropReasonString "F\EOT\ACK\209WCS\EOT\223\171\232\158\254\&5\178\184\209\CAN\165\251G\226Y"]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x34, 0xe1, 0x1,  0x0,  0x5,  0xba, 0xab, 0x24, 0xd7, 0xd5, 0x60, 0xe,  0xce, 0x1,  0xb,  0x16, 0x21, 0x47, 0x59,
      0x3,  0x0,  0x14, 0x8b, 0x5d, 0x44, 0x5f, 0x61, 0x26, 0xb0, 0xd6, 0x83, 0xcf, 0xcd, 0xdb, 0x1a, 0x66, 0x7,  0x3d,
      0x38, 0xd5, 0x86, 0xe3, 0x23, 0x63, 0x86, 0x8,  0x0,  0x1a, 0x7f, 0x2b, 0x1a, 0x20, 0xb9, 0xf4, 0x92, 0x4b, 0x93,
      0x4a, 0xa8, 0x73, 0x5c, 0xdc, 0x8e, 0x37, 0x40, 0x2d, 0x69, 0xa1, 0xa0, 0x97, 0x2e, 0x94, 0x3b, 0x4a, 0x21, 0x57,
      0x2e, 0x22, 0x51, 0xab, 0x1,  0x9e, 0x23, 0x62, 0x93, 0x2a, 0x95, 0x1f, 0x0,  0x12, 0x2b, 0x45, 0xc5, 0xdf, 0xeb,
      0x1e, 0xea, 0x65, 0x2c, 0x53, 0x0,  0xf7, 0x55, 0x2c, 0x4a, 0xf0, 0x79, 0x52, 0x26, 0x0,  0x17, 0x34, 0x2d, 0x98,
      0x27, 0xdd, 0xf7, 0xfd, 0x3f, 0x26, 0x7,  0x3f, 0xd,  0xe0, 0x15, 0xde, 0xfe, 0x89, 0x0,  0x3,  0xd8, 0x60, 0x68,
      0x4,  0x0,  0x1a, 0xaf, 0x36, 0xf0, 0x32, 0xf0, 0x2c, 0xba, 0x89, 0xcc, 0x3f, 0x85, 0xc9, 0xff, 0xa9, 0xdb, 0x1d,
      0x32, 0x56, 0x4d, 0x17, 0xcc, 0x25, 0xa0, 0x96, 0x62, 0xb4, 0x12, 0x0,  0x18, 0xdf, 0x87, 0xf4, 0x9e, 0xae, 0xa2,
      0x46, 0xe8, 0xcd, 0x18, 0x45, 0xc7, 0x6,  0x1a, 0x2,  0x46, 0xd8, 0xeb, 0x3d, 0x23, 0x29, 0x26, 0xb6, 0xdd, 0x2,
      0x0,  0x0,  0x48, 0xb1, 0x1f, 0x0,  0x17, 0x46, 0x4,  0x6,  0xd1, 0x57, 0x43, 0x53, 0x4,  0xdf, 0xab, 0xe8, 0x9e,
      0xfe, 0x35, 0xb2, 0xb8, 0xd1, 0x18, 0xa5, 0xfb, 0x47, 0xe2, 0x59, 0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  uint8_t topic_bytes[] = {0xba, 0xab, 0x24, 0xd7, 0xd5};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  uint8_t bytesprops0[] = {0x8b, 0x5d, 0x44, 0x5f, 0x61, 0x26, 0xb0, 0xd6, 0x83, 0xcf,
                           0xcd, 0xdb, 0x1a, 0x66, 0x7,  0x3d, 0x38, 0xd5, 0x86, 0xe3};
  uint8_t bytesprops1[] = {0x7f, 0x2b, 0x1a, 0x20, 0xb9, 0xf4, 0x92, 0x4b, 0x93, 0x4a, 0xa8, 0x73, 0x5c,
                           0xdc, 0x8e, 0x37, 0x40, 0x2d, 0x69, 0xa1, 0xa0, 0x97, 0x2e, 0x94, 0x3b, 0x4a};
  uint8_t bytesprops2[] = {0x2b, 0x45, 0xc5, 0xdf, 0xeb, 0x1e, 0xea, 0x65, 0x2c,
                           0x53, 0x0,  0xf7, 0x55, 0x2c, 0x4a, 0xf0, 0x79, 0x52};
  uint8_t bytesprops4[] = {0xaf, 0x36, 0xf0, 0x32, 0xf0, 0x2c, 0xba, 0x89, 0xcc, 0x3f, 0x85, 0xc9, 0xff,
                           0xa9, 0xdb, 0x1d, 0x32, 0x56, 0x4d, 0x17, 0xcc, 0x25, 0xa0, 0x96, 0x62, 0xb4};
  uint8_t bytesprops3[] = {0x34, 0x2d, 0x98, 0x27, 0xdd, 0xf7, 0xfd, 0x3f, 0x26, 0x7,  0x3f, 0xd,
                           0xe0, 0x15, 0xde, 0xfe, 0x89, 0x0,  0x3,  0xd8, 0x60, 0x68, 0x4};
  uint8_t bytesprops5[] = {0xdf, 0x87, 0xf4, 0x9e, 0xae, 0xa2, 0x46, 0xe8, 0xcd, 0x18, 0x45, 0xc7,
                           0x6,  0x1a, 0x2,  0x46, 0xd8, 0xeb, 0x3d, 0x23, 0x29, 0x26, 0xb6, 0xdd};
  uint8_t bytesprops6[] = {0x46, 0x4,  0x6,  0xd1, 0x57, 0x43, 0x53, 0x4,  0xdf, 0xab, 0xe8, 0x9e,
                           0xfe, 0x35, 0xb2, 0xb8, 0xd1, 0x18, 0xa5, 0xfb, 0x47, 0xe2, 0x59};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18265}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25478}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22318}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20907}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25235}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops3}, .v = {26, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18609}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 24590, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\186\171$\215\213", _pubPktID =
// 24590, _pubBody = "En.&\166\184\215\153", _pubProps = [PropSubscriptionIdentifier 22,PropReceiveMaximum
// 18265,PropContentType "\139]D_a&\176\214\131\207\205\219\SUBf\a=8\213\134\227",PropTopicAlias 25478,PropResponseTopic
// "\DEL+\SUB \185\244\146K\147J\168s\\\220\142\&7@-i\161\160\151.\148;J",PropReceiveMaximum 22318,PropTopicAliasMaximum
// 20907,PropPayloadFormatIndicator 158,PropTopicAlias 25235,PropSharedSubscriptionAvailable 149,PropReasonString
// "+E\197\223\235\RS\234e,S\NUL\247U,J\240yR",PropUserProperty
// "4-\152'\221\247\253?&\a?\r\224\NAK\222\254\137\NUL\ETX\216`h\EOT"
// "\175\&6\240\&2\240,\186\137\204?\133\201\255\169\219\GS2VM\ETB\204%\160\150b\180",PropAssignedClientIdentifier
// "\223\135\244\158\174\162F\232\205\CANE\199\ACK\SUB\STXF\216\235=#)&\182\221",PropMessageExpiryInterval
// 18609,PropReasonString "F\EOT\ACK\209WCS\EOT\223\171\232\158\254\&5\178\184\209\CAN\165\251G\226Y"]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {
      0x34, 0xe1, 0x1,  0x0,  0x5,  0xba, 0xab, 0x24, 0xd7, 0xd5, 0x60, 0xe,  0xce, 0x1,  0xb,  0x16, 0x21, 0x47, 0x59,
      0x3,  0x0,  0x14, 0x8b, 0x5d, 0x44, 0x5f, 0x61, 0x26, 0xb0, 0xd6, 0x83, 0xcf, 0xcd, 0xdb, 0x1a, 0x66, 0x7,  0x3d,
      0x38, 0xd5, 0x86, 0xe3, 0x23, 0x63, 0x86, 0x8,  0x0,  0x1a, 0x7f, 0x2b, 0x1a, 0x20, 0xb9, 0xf4, 0x92, 0x4b, 0x93,
      0x4a, 0xa8, 0x73, 0x5c, 0xdc, 0x8e, 0x37, 0x40, 0x2d, 0x69, 0xa1, 0xa0, 0x97, 0x2e, 0x94, 0x3b, 0x4a, 0x21, 0x57,
      0x2e, 0x22, 0x51, 0xab, 0x1,  0x9e, 0x23, 0x62, 0x93, 0x2a, 0x95, 0x1f, 0x0,  0x12, 0x2b, 0x45, 0xc5, 0xdf, 0xeb,
      0x1e, 0xea, 0x65, 0x2c, 0x53, 0x0,  0xf7, 0x55, 0x2c, 0x4a, 0xf0, 0x79, 0x52, 0x26, 0x0,  0x17, 0x34, 0x2d, 0x98,
      0x27, 0xdd, 0xf7, 0xfd, 0x3f, 0x26, 0x7,  0x3f, 0xd,  0xe0, 0x15, 0xde, 0xfe, 0x89, 0x0,  0x3,  0xd8, 0x60, 0x68,
      0x4,  0x0,  0x1a, 0xaf, 0x36, 0xf0, 0x32, 0xf0, 0x2c, 0xba, 0x89, 0xcc, 0x3f, 0x85, 0xc9, 0xff, 0xa9, 0xdb, 0x1d,
      0x32, 0x56, 0x4d, 0x17, 0xcc, 0x25, 0xa0, 0x96, 0x62, 0xb4, 0x12, 0x0,  0x18, 0xdf, 0x87, 0xf4, 0x9e, 0xae, 0xa2,
      0x46, 0xe8, 0xcd, 0x18, 0x45, 0xc7, 0x6,  0x1a, 0x2,  0x46, 0xd8, 0xeb, 0x3d, 0x23, 0x29, 0x26, 0xb6, 0xdd, 0x2,
      0x0,  0x0,  0x48, 0xb1, 0x1f, 0x0,  0x17, 0x46, 0x4,  0x6,  0xd1, 0x57, 0x43, 0x53, 0x4,  0xdf, 0xab, 0xe8, 0x9e,
      0xfe, 0x35, 0xb2, 0xb8, 0xd1, 0x18, 0xa5, 0xfb, 0x47, 0xe2, 0x59, 0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xba, 0xab, 0x24, 0xd7, 0xd5};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x6e, 0x2e, 0x26, 0xa6, 0xb8, 0xd7, 0x99};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 24590);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\197R\255Y+\ACK", _pubPktID = 17354,
// _pubBody = "_\191\168\153\207\229\204<\169\234j\153A\153/^I\217,\159/\161\222\252?6", _pubProps =
// [PropRequestResponseInformation 184,PropSessionExpiryInterval 21029,PropMaximumQoS
// 50,PropWildcardSubscriptionAvailable 238,PropSubscriptionIdentifier 14,PropTopicAlias
// 19933,PropWildcardSubscriptionAvailable 68,PropAuthenticationData
// "\232\214\&2\254\DLE\242",PropAssignedClientIdentifier "\173\233",PropSharedSubscriptionAvailable
// 228,PropReceiveMaximum 25696,PropMessageExpiryInterval 21838,PropSubscriptionIdentifierAvailable 255,PropUserProperty
// "L\246\166@\169\SO8T\SO\233" ",\141c\RSw",PropTopicAliasMaximum 19135,PropWillDelayInterval
// 27308,PropMaximumPacketSize 28029,PropRequestResponseInformation 109,PropSubscriptionIdentifier
// 12,PropRetainAvailable 74,PropRetainAvailable 73,PropSessionExpiryInterval 27517,PropResponseInformation
// "\194\161=H\b}"]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {0x3b, 0x88, 0x1,  0x0,  0x6,  0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6,  0x43, 0xca, 0x63, 0x19, 0xb8,
                   0x11, 0x0,  0x0,  0x52, 0x25, 0x24, 0x32, 0x28, 0xee, 0xb,  0xe,  0x23, 0x4d, 0xdd, 0x28, 0x44,
                   0x16, 0x0,  0x6,  0xe8, 0xd6, 0x32, 0xfe, 0x10, 0xf2, 0x12, 0x0,  0x2,  0xad, 0xe9, 0x2a, 0xe4,
                   0x21, 0x64, 0x60, 0x2,  0x0,  0x0,  0x55, 0x4e, 0x29, 0xff, 0x26, 0x0,  0xa,  0x4c, 0xf6, 0xa6,
                   0x40, 0xa9, 0xe,  0x38, 0x54, 0xe,  0xe9, 0x0,  0x5,  0x2c, 0x8d, 0x63, 0x1e, 0x77, 0x22, 0x4a,
                   0xbf, 0x18, 0x0,  0x0,  0x6a, 0xac, 0x27, 0x0,  0x0,  0x6d, 0x7d, 0x19, 0x6d, 0xb,  0xc,  0x25,
                   0x4a, 0x25, 0x49, 0x11, 0x0,  0x0,  0x6b, 0x7d, 0x1a, 0x0,  0x6,  0xc2, 0xa1, 0x3d, 0x48, 0x8,
                   0x7d, 0x5f, 0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41, 0x99, 0x2f,
                   0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  uint8_t topic_bytes[] = {0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5f, 0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41,
                         0x99, 0x2f, 0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0xe8, 0xd6, 0x32, 0xfe, 0x10, 0xf2};
  uint8_t bytesprops1[] = {0xad, 0xe9};
  uint8_t bytesprops3[] = {0x2c, 0x8d, 0x63, 0x1e, 0x77};
  uint8_t bytesprops2[] = {0x4c, 0xf6, 0xa6, 0x40, 0xa9, 0xe, 0x38, 0x54, 0xe, 0xe9};
  uint8_t bytesprops4[] = {0xc2, 0xa1, 0x3d, 0x48, 0x8, 0x7d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21029}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19933}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25696}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21838}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops2}, .v = {5, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19135}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27308}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28029}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27517}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 17354, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\197R\255Y+\ACK", _pubPktID = 17354,
// _pubBody = "_\191\168\153\207\229\204<\169\234j\153A\153/^I\217,\159/\161\222\252?6", _pubProps =
// [PropRequestResponseInformation 184,PropSessionExpiryInterval 21029,PropMaximumQoS
// 50,PropWildcardSubscriptionAvailable 238,PropSubscriptionIdentifier 14,PropTopicAlias
// 19933,PropWildcardSubscriptionAvailable 68,PropAuthenticationData
// "\232\214\&2\254\DLE\242",PropAssignedClientIdentifier "\173\233",PropSharedSubscriptionAvailable
// 228,PropReceiveMaximum 25696,PropMessageExpiryInterval 21838,PropSubscriptionIdentifierAvailable 255,PropUserProperty
// "L\246\166@\169\SO8T\SO\233" ",\141c\RSw",PropTopicAliasMaximum 19135,PropWillDelayInterval
// 27308,PropMaximumPacketSize 28029,PropRequestResponseInformation 109,PropSubscriptionIdentifier
// 12,PropRetainAvailable 74,PropRetainAvailable 73,PropSessionExpiryInterval 27517,PropResponseInformation
// "\194\161=H\b}"]}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {0x3b, 0x88, 0x1,  0x0,  0x6,  0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6,  0x43, 0xca, 0x63, 0x19, 0xb8,
                   0x11, 0x0,  0x0,  0x52, 0x25, 0x24, 0x32, 0x28, 0xee, 0xb,  0xe,  0x23, 0x4d, 0xdd, 0x28, 0x44,
                   0x16, 0x0,  0x6,  0xe8, 0xd6, 0x32, 0xfe, 0x10, 0xf2, 0x12, 0x0,  0x2,  0xad, 0xe9, 0x2a, 0xe4,
                   0x21, 0x64, 0x60, 0x2,  0x0,  0x0,  0x55, 0x4e, 0x29, 0xff, 0x26, 0x0,  0xa,  0x4c, 0xf6, 0xa6,
                   0x40, 0xa9, 0xe,  0x38, 0x54, 0xe,  0xe9, 0x0,  0x5,  0x2c, 0x8d, 0x63, 0x1e, 0x77, 0x22, 0x4a,
                   0xbf, 0x18, 0x0,  0x0,  0x6a, 0xac, 0x27, 0x0,  0x0,  0x6d, 0x7d, 0x19, 0x6d, 0xb,  0xc,  0x25,
                   0x4a, 0x25, 0x49, 0x11, 0x0,  0x0,  0x6b, 0x7d, 0x1a, 0x0,  0x6,  0xc2, 0xa1, 0x3d, 0x48, 0x8,
                   0x7d, 0x5f, 0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41, 0x99, 0x2f,
                   0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc5, 0x52, 0xff, 0x59, 0x2b, 0x6};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5f, 0xbf, 0xa8, 0x99, 0xcf, 0xe5, 0xcc, 0x3c, 0xa9, 0xea, 0x6a, 0x99, 0x41,
                              0x99, 0x2f, 0x5e, 0x49, 0xd9, 0x2c, 0x9f, 0x2f, 0xa1, 0xde, 0xfc, 0x3f, 0x36};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17354);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\181h\206\206#\148<\227\196\202?\ENQ\255\RSp\196\162\184\171\224", _pubPktID = 9053, _pubBody =
// "W\232(5\208_\210\199B\249E\178\157\128", _pubProps = [PropReceiveMaximum 12053]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x3c, 0x2a, 0x0,  0x14, 0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca, 0x3f,
                   0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0, 0x23, 0x5d, 0x3,  0x21, 0x2f, 0x15,
                   0x57, 0xe8, 0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  uint8_t topic_bytes[] = {0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca,
                           0x3f, 0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x57, 0xe8, 0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12053}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 9053, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\181h\206\206#\148<\227\196\202?\ENQ\255\RSp\196\162\184\171\224", _pubPktID = 9053, _pubBody =
// "W\232(5\208_\210\199B\249E\178\157\128", _pubProps = [PropReceiveMaximum 12053]}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x3c, 0x2a, 0x0,  0x14, 0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca, 0x3f,
                   0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0, 0x23, 0x5d, 0x3,  0x21, 0x2f, 0x15,
                   0x57, 0xe8, 0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb5, 0x68, 0xce, 0xce, 0x23, 0x94, 0x3c, 0xe3, 0xc4, 0xca,
                               0x3f, 0x5,  0xff, 0x1e, 0x70, 0xc4, 0xa2, 0xb8, 0xab, 0xe0};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x57, 0xe8, 0x28, 0x35, 0xd0, 0x5f, 0xd2, 0xc7, 0x42, 0xf9, 0x45, 0xb2, 0x9d, 0x80};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 9053);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\147\174\SYN ", _pubPktID = 0,
// _pubBody = "\155\DC3A*\157dh!\177=7\233\225\DLE|\EM\145", _pubProps = [PropSessionExpiryInterval
// 30284,PropWildcardSubscriptionAvailable 74,PropServerReference
// "\191\&6\231s\t;%\213@\215a\162\165[\253",PropSubscriptionIdentifier 29,PropTopicAliasMaximum
// 9684,PropSharedSubscriptionAvailable 165,PropSharedSubscriptionAvailable 144,PropTopicAlias
// 8584,PropAuthenticationMethod "!(\253\175\DLEK\SYN\EM\149S\205\205\"\151#\v\240\DC4,w{\180\247\&7\US\209\213X"]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {0x39, 0x5c, 0x0,  0x4,  0x93, 0xae, 0x16, 0x20, 0x44, 0x11, 0x0,  0x0,  0x76, 0x4c, 0x28, 0x4a,
                   0x1c, 0x0,  0xf,  0xbf, 0x36, 0xe7, 0x73, 0x9,  0x3b, 0x25, 0xd5, 0x40, 0xd7, 0x61, 0xa2, 0xa5,
                   0x5b, 0xfd, 0xb,  0x1d, 0x22, 0x25, 0xd4, 0x2a, 0xa5, 0x2a, 0x90, 0x23, 0x21, 0x88, 0x15, 0x0,
                   0x1c, 0x21, 0x28, 0xfd, 0xaf, 0x10, 0x4b, 0x16, 0x19, 0x95, 0x53, 0xcd, 0xcd, 0x22, 0x97, 0x23,
                   0xb,  0xf0, 0x14, 0x2c, 0x77, 0x7b, 0xb4, 0xf7, 0x37, 0x1f, 0xd1, 0xd5, 0x58, 0x9b, 0x13, 0x41,
                   0x2a, 0x9d, 0x64, 0x68, 0x21, 0xb1, 0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  uint8_t topic_bytes[] = {0x93, 0xae, 0x16, 0x20};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x13, 0x41, 0x2a, 0x9d, 0x64, 0x68, 0x21, 0xb1,
                         0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0xbf, 0x36, 0xe7, 0x73, 0x9, 0x3b, 0x25, 0xd5, 0x40, 0xd7, 0x61, 0xa2, 0xa5, 0x5b, 0xfd};
  uint8_t bytesprops1[] = {0x21, 0x28, 0xfd, 0xaf, 0x10, 0x4b, 0x16, 0x19, 0x95, 0x53, 0xcd, 0xcd, 0x22, 0x97,
                           0x23, 0xb,  0xf0, 0x14, 0x2c, 0x77, 0x7b, 0xb4, 0xf7, 0x37, 0x1f, 0xd1, 0xd5, 0x58};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30284}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9684}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8584}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\147\174\SYN ", _pubPktID = 0,
// _pubBody = "\155\DC3A*\157dh!\177=7\233\225\DLE|\EM\145", _pubProps = [PropSessionExpiryInterval
// 30284,PropWildcardSubscriptionAvailable 74,PropServerReference
// "\191\&6\231s\t;%\213@\215a\162\165[\253",PropSubscriptionIdentifier 29,PropTopicAliasMaximum
// 9684,PropSharedSubscriptionAvailable 165,PropSharedSubscriptionAvailable 144,PropTopicAlias
// 8584,PropAuthenticationMethod "!(\253\175\DLEK\SYN\EM\149S\205\205\"\151#\v\240\DC4,w{\180\247\&7\US\209\213X"]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {0x39, 0x5c, 0x0,  0x4,  0x93, 0xae, 0x16, 0x20, 0x44, 0x11, 0x0,  0x0,  0x76, 0x4c, 0x28, 0x4a,
                   0x1c, 0x0,  0xf,  0xbf, 0x36, 0xe7, 0x73, 0x9,  0x3b, 0x25, 0xd5, 0x40, 0xd7, 0x61, 0xa2, 0xa5,
                   0x5b, 0xfd, 0xb,  0x1d, 0x22, 0x25, 0xd4, 0x2a, 0xa5, 0x2a, 0x90, 0x23, 0x21, 0x88, 0x15, 0x0,
                   0x1c, 0x21, 0x28, 0xfd, 0xaf, 0x10, 0x4b, 0x16, 0x19, 0x95, 0x53, 0xcd, 0xcd, 0x22, 0x97, 0x23,
                   0xb,  0xf0, 0x14, 0x2c, 0x77, 0x7b, 0xb4, 0xf7, 0x37, 0x1f, 0xd1, 0xd5, 0x58, 0x9b, 0x13, 0x41,
                   0x2a, 0x9d, 0x64, 0x68, 0x21, 0xb1, 0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x93, 0xae, 0x16, 0x20};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x13, 0x41, 0x2a, 0x9d, 0x64, 0x68, 0x21, 0xb1,
                              0x3d, 0x37, 0xe9, 0xe1, 0x10, 0x7c, 0x19, 0x91};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "t\183\232G\148\143\148J\151\141\197\&0\196\244?(x\225\237\EM", _pubPktID = 0, _pubBody =
// "\ESC\231\EM\255\149&\\p\RS\173+\194\173\204\183u\131G\218", _pubProps = [PropRequestProblemInformation
// 130,PropResponseInformation
// "\174\168\140`\EOT\176O.\214\156J\176\132\232~\220B\208I\SOH\240\&9\183",PropRequestResponseInformation
// 222,PropPayloadFormatIndicator 65,PropRequestResponseInformation 53,PropResponseInformation
// "\245\153\155\DC4\146\172\231\195\176\169\ESC\138t3*\251\246\188",PropSessionExpiryInterval
// 2403,PropSessionExpiryInterval 7061,PropMaximumQoS 225,PropRequestResponseInformation 155,PropSubscriptionIdentifier
// 26,PropAssignedClientIdentifier "\SI",PropMaximumPacketSize 7091,PropContentType
// "'\CANh)\213|\160\a\DC3R\146v\218\&8}\EOTa6I\137\250;\233\228U\251x\252",PropMaximumPacketSize
// 1488,PropAuthenticationMethod "\CAN\221rv\175\198\190\n\DC2\178b\ENQ\208@Ky\246\225\156\227S"]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x38, 0xb7, 0x1,  0x0,  0x14, 0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d, 0xc5, 0x30,
                   0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19, 0x8c, 0x1,  0x17, 0x82, 0x1a, 0x0,  0x17, 0xae, 0xa8,
                   0x8c, 0x60, 0x4,  0xb0, 0x4f, 0x2e, 0xd6, 0x9c, 0x4a, 0xb0, 0x84, 0xe8, 0x7e, 0xdc, 0x42, 0xd0, 0x49,
                   0x1,  0xf0, 0x39, 0xb7, 0x19, 0xde, 0x1,  0x41, 0x19, 0x35, 0x1a, 0x0,  0x12, 0xf5, 0x99, 0x9b, 0x14,
                   0x92, 0xac, 0xe7, 0xc3, 0xb0, 0xa9, 0x1b, 0x8a, 0x74, 0x33, 0x2a, 0xfb, 0xf6, 0xbc, 0x11, 0x0,  0x0,
                   0x9,  0x63, 0x11, 0x0,  0x0,  0x1b, 0x95, 0x24, 0xe1, 0x19, 0x9b, 0xb,  0x1a, 0x12, 0x0,  0x1,  0xf,
                   0x27, 0x0,  0x0,  0x1b, 0xb3, 0x3,  0x0,  0x1c, 0x27, 0x18, 0x68, 0x29, 0xd5, 0x7c, 0xa0, 0x7,  0x13,
                   0x52, 0x92, 0x76, 0xda, 0x38, 0x7d, 0x4,  0x61, 0x36, 0x49, 0x89, 0xfa, 0x3b, 0xe9, 0xe4, 0x55, 0xfb,
                   0x78, 0xfc, 0x27, 0x0,  0x0,  0x5,  0xd0, 0x15, 0x0,  0x15, 0x18, 0xdd, 0x72, 0x76, 0xaf, 0xc6, 0xbe,
                   0xa,  0x12, 0xb2, 0x62, 0x5,  0xd0, 0x40, 0x4b, 0x79, 0xf6, 0xe1, 0x9c, 0xe3, 0x53, 0x1b, 0xe7, 0x19,
                   0xff, 0x95, 0x26, 0x5c, 0x70, 0x1e, 0xad, 0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  uint8_t topic_bytes[] = {0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d,
                           0xc5, 0x30, 0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1b, 0xe7, 0x19, 0xff, 0x95, 0x26, 0x5c, 0x70, 0x1e, 0xad,
                         0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xae, 0xa8, 0x8c, 0x60, 0x4,  0xb0, 0x4f, 0x2e, 0xd6, 0x9c, 0x4a, 0xb0,
                           0x84, 0xe8, 0x7e, 0xdc, 0x42, 0xd0, 0x49, 0x1,  0xf0, 0x39, 0xb7};
  uint8_t bytesprops1[] = {0xf5, 0x99, 0x9b, 0x14, 0x92, 0xac, 0xe7, 0xc3, 0xb0,
                           0xa9, 0x1b, 0x8a, 0x74, 0x33, 0x2a, 0xfb, 0xf6, 0xbc};
  uint8_t bytesprops2[] = {0xf};
  uint8_t bytesprops3[] = {0x27, 0x18, 0x68, 0x29, 0xd5, 0x7c, 0xa0, 0x7,  0x13, 0x52, 0x92, 0x76, 0xda, 0x38,
                           0x7d, 0x4,  0x61, 0x36, 0x49, 0x89, 0xfa, 0x3b, 0xe9, 0xe4, 0x55, 0xfb, 0x78, 0xfc};
  uint8_t bytesprops4[] = {0x18, 0xdd, 0x72, 0x76, 0xaf, 0xc6, 0xbe, 0xa,  0x12, 0xb2, 0x62,
                           0x5,  0xd0, 0x40, 0x4b, 0x79, 0xf6, 0xe1, 0x9c, 0xe3, 0x53};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2403}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7061}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7091}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1488}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "t\183\232G\148\143\148J\151\141\197\&0\196\244?(x\225\237\EM", _pubPktID = 0, _pubBody =
// "\ESC\231\EM\255\149&\\p\RS\173+\194\173\204\183u\131G\218", _pubProps = [PropRequestProblemInformation
// 130,PropResponseInformation
// "\174\168\140`\EOT\176O.\214\156J\176\132\232~\220B\208I\SOH\240\&9\183",PropRequestResponseInformation
// 222,PropPayloadFormatIndicator 65,PropRequestResponseInformation 53,PropResponseInformation
// "\245\153\155\DC4\146\172\231\195\176\169\ESC\138t3*\251\246\188",PropSessionExpiryInterval
// 2403,PropSessionExpiryInterval 7061,PropMaximumQoS 225,PropRequestResponseInformation 155,PropSubscriptionIdentifier
// 26,PropAssignedClientIdentifier "\SI",PropMaximumPacketSize 7091,PropContentType
// "'\CANh)\213|\160\a\DC3R\146v\218\&8}\EOTa6I\137\250;\233\228U\251x\252",PropMaximumPacketSize
// 1488,PropAuthenticationMethod "\CAN\221rv\175\198\190\n\DC2\178b\ENQ\208@Ky\246\225\156\227S"]}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x38, 0xb7, 0x1,  0x0,  0x14, 0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d, 0xc5, 0x30,
                   0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19, 0x8c, 0x1,  0x17, 0x82, 0x1a, 0x0,  0x17, 0xae, 0xa8,
                   0x8c, 0x60, 0x4,  0xb0, 0x4f, 0x2e, 0xd6, 0x9c, 0x4a, 0xb0, 0x84, 0xe8, 0x7e, 0xdc, 0x42, 0xd0, 0x49,
                   0x1,  0xf0, 0x39, 0xb7, 0x19, 0xde, 0x1,  0x41, 0x19, 0x35, 0x1a, 0x0,  0x12, 0xf5, 0x99, 0x9b, 0x14,
                   0x92, 0xac, 0xe7, 0xc3, 0xb0, 0xa9, 0x1b, 0x8a, 0x74, 0x33, 0x2a, 0xfb, 0xf6, 0xbc, 0x11, 0x0,  0x0,
                   0x9,  0x63, 0x11, 0x0,  0x0,  0x1b, 0x95, 0x24, 0xe1, 0x19, 0x9b, 0xb,  0x1a, 0x12, 0x0,  0x1,  0xf,
                   0x27, 0x0,  0x0,  0x1b, 0xb3, 0x3,  0x0,  0x1c, 0x27, 0x18, 0x68, 0x29, 0xd5, 0x7c, 0xa0, 0x7,  0x13,
                   0x52, 0x92, 0x76, 0xda, 0x38, 0x7d, 0x4,  0x61, 0x36, 0x49, 0x89, 0xfa, 0x3b, 0xe9, 0xe4, 0x55, 0xfb,
                   0x78, 0xfc, 0x27, 0x0,  0x0,  0x5,  0xd0, 0x15, 0x0,  0x15, 0x18, 0xdd, 0x72, 0x76, 0xaf, 0xc6, 0xbe,
                   0xa,  0x12, 0xb2, 0x62, 0x5,  0xd0, 0x40, 0x4b, 0x79, 0xf6, 0xe1, 0x9c, 0xe3, 0x53, 0x1b, 0xe7, 0x19,
                   0xff, 0x95, 0x26, 0x5c, 0x70, 0x1e, 0xad, 0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x74, 0xb7, 0xe8, 0x47, 0x94, 0x8f, 0x94, 0x4a, 0x97, 0x8d,
                               0xc5, 0x30, 0xc4, 0xf4, 0x3f, 0x28, 0x78, 0xe1, 0xed, 0x19};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1b, 0xe7, 0x19, 0xff, 0x95, 0x26, 0x5c, 0x70, 0x1e, 0xad,
                              0x2b, 0xc2, 0xad, 0xcc, 0xb7, 0x75, 0x83, 0x47, 0xda};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\245l-\185\147\\\ai\199\183\216s\232\\\248\DC4\199\231[\DC4\139", _pubProps = [PropAuthenticationMethod
// "rC\184\SI\211\138\216kp\140\252\ACK2",PropMessageExpiryInterval 14395,PropSharedSubscriptionAvailable
// 182,PropMaximumQoS 230,PropServerReference
// "z\215\224\187zZ\ETB$\137\164\235\133\143\SI\228\232\242\130R\188\b\242\228\131\179\br",PropReasonString
// "\205\&6\ENQWp\149\176\186\202",PropPayloadFormatIndicator 91,PropRequestResponseInformation
// 166,PropResponseInformation
// "\US\220\207\205\200\162\141U\254\SOH\204\ng\156*\133h\228\198\152\CANhb",PropWildcardSubscriptionAvailable
// 52,PropSubscriptionIdentifier 17,PropRequestProblemInformation 195,PropTopicAlias 28295,PropMessageExpiryInterval
// 25451,PropReasonString "W",PropSessionExpiryInterval 13393,PropAssignedClientIdentifier
// "\146P\DC3`xR\ETX\t\161p\199",PropRetainAvailable 160,PropMessageExpiryInterval 16943,PropUserProperty
// "\212z\240\193\227\DC4\196,\RS?\198I\145[H\136\236\&39\254"
// "\154n2\180\135\194\227\149\178\151\152\216'",PropContentType "",PropAuthenticationData
// "\\@T\206\SOH,v\220\160dU?\218\RSM\250\181e\199",PropTopicAliasMaximum 7139,PropSessionExpiryInterval
// 27556,PropAuthenticationMethod "j\194\EOT\206w",PropUserProperty "W\150m\239\193e\141\197\242"
// "\200z{\236=*\134\210\160\237\t\n2",PropWildcardSubscriptionAvailable 5]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x30, 0x92, 0x2,  0x0,  0x0,  0xf9, 0x1,  0x15, 0x0,  0xd,  0x72, 0x43, 0xb8, 0xf,  0xd3, 0x8a, 0xd8, 0x6b, 0x70,
      0x8c, 0xfc, 0x6,  0x32, 0x2,  0x0,  0x0,  0x38, 0x3b, 0x2a, 0xb6, 0x24, 0xe6, 0x1c, 0x0,  0x1b, 0x7a, 0xd7, 0xe0,
      0xbb, 0x7a, 0x5a, 0x17, 0x24, 0x89, 0xa4, 0xeb, 0x85, 0x8f, 0xf,  0xe4, 0xe8, 0xf2, 0x82, 0x52, 0xbc, 0x8,  0xf2,
      0xe4, 0x83, 0xb3, 0x8,  0x72, 0x1f, 0x0,  0x9,  0xcd, 0x36, 0x5,  0x57, 0x70, 0x95, 0xb0, 0xba, 0xca, 0x1,  0x5b,
      0x19, 0xa6, 0x1a, 0x0,  0x17, 0x1f, 0xdc, 0xcf, 0xcd, 0xc8, 0xa2, 0x8d, 0x55, 0xfe, 0x1,  0xcc, 0xa,  0x67, 0x9c,
      0x2a, 0x85, 0x68, 0xe4, 0xc6, 0x98, 0x18, 0x68, 0x62, 0x28, 0x34, 0xb,  0x11, 0x17, 0xc3, 0x23, 0x6e, 0x87, 0x2,
      0x0,  0x0,  0x63, 0x6b, 0x1f, 0x0,  0x1,  0x57, 0x11, 0x0,  0x0,  0x34, 0x51, 0x12, 0x0,  0xb,  0x92, 0x50, 0x13,
      0x60, 0x78, 0x52, 0x3,  0x9,  0xa1, 0x70, 0xc7, 0x25, 0xa0, 0x2,  0x0,  0x0,  0x42, 0x2f, 0x26, 0x0,  0x14, 0xd4,
      0x7a, 0xf0, 0xc1, 0xe3, 0x14, 0xc4, 0x2c, 0x1e, 0x3f, 0xc6, 0x49, 0x91, 0x5b, 0x48, 0x88, 0xec, 0x33, 0x39, 0xfe,
      0x0,  0xd,  0x9a, 0x6e, 0x32, 0xb4, 0x87, 0xc2, 0xe3, 0x95, 0xb2, 0x97, 0x98, 0xd8, 0x27, 0x3,  0x0,  0x0,  0x16,
      0x0,  0x13, 0x5c, 0x40, 0x54, 0xce, 0x1,  0x2c, 0x76, 0xdc, 0xa0, 0x64, 0x55, 0x3f, 0xda, 0x1e, 0x4d, 0xfa, 0xb5,
      0x65, 0xc7, 0x22, 0x1b, 0xe3, 0x11, 0x0,  0x0,  0x6b, 0xa4, 0x15, 0x0,  0x5,  0x6a, 0xc2, 0x4,  0xce, 0x77, 0x26,
      0x0,  0x9,  0x57, 0x96, 0x6d, 0xef, 0xc1, 0x65, 0x8d, 0xc5, 0xf2, 0x0,  0xd,  0xc8, 0x7a, 0x7b, 0xec, 0x3d, 0x2a,
      0x86, 0xd2, 0xa0, 0xed, 0x9,  0xa,  0x32, 0x28, 0x5,  0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7, 0xb7,
      0xd8, 0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7, 0xb7, 0xd8,
                         0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0x72, 0x43, 0xb8, 0xf, 0xd3, 0x8a, 0xd8, 0x6b, 0x70, 0x8c, 0xfc, 0x6, 0x32};
  uint8_t bytesprops1[] = {0x7a, 0xd7, 0xe0, 0xbb, 0x7a, 0x5a, 0x17, 0x24, 0x89, 0xa4, 0xeb, 0x85, 0x8f, 0xf,
                           0xe4, 0xe8, 0xf2, 0x82, 0x52, 0xbc, 0x8,  0xf2, 0xe4, 0x83, 0xb3, 0x8,  0x72};
  uint8_t bytesprops2[] = {0xcd, 0x36, 0x5, 0x57, 0x70, 0x95, 0xb0, 0xba, 0xca};
  uint8_t bytesprops3[] = {0x1f, 0xdc, 0xcf, 0xcd, 0xc8, 0xa2, 0x8d, 0x55, 0xfe, 0x1,  0xcc, 0xa,
                           0x67, 0x9c, 0x2a, 0x85, 0x68, 0xe4, 0xc6, 0x98, 0x18, 0x68, 0x62};
  uint8_t bytesprops4[] = {0x57};
  uint8_t bytesprops5[] = {0x92, 0x50, 0x13, 0x60, 0x78, 0x52, 0x3, 0x9, 0xa1, 0x70, 0xc7};
  uint8_t bytesprops7[] = {0x9a, 0x6e, 0x32, 0xb4, 0x87, 0xc2, 0xe3, 0x95, 0xb2, 0x97, 0x98, 0xd8, 0x27};
  uint8_t bytesprops6[] = {0xd4, 0x7a, 0xf0, 0xc1, 0xe3, 0x14, 0xc4, 0x2c, 0x1e, 0x3f,
                           0xc6, 0x49, 0x91, 0x5b, 0x48, 0x88, 0xec, 0x33, 0x39, 0xfe};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0x5c, 0x40, 0x54, 0xce, 0x1,  0x2c, 0x76, 0xdc, 0xa0, 0x64,
                           0x55, 0x3f, 0xda, 0x1e, 0x4d, 0xfa, 0xb5, 0x65, 0xc7};
  uint8_t bytesprops10[] = {0x6a, 0xc2, 0x4, 0xce, 0x77};
  uint8_t bytesprops12[] = {0xc8, 0x7a, 0x7b, 0xec, 0x3d, 0x2a, 0x86, 0xd2, 0xa0, 0xed, 0x9, 0xa, 0x32};
  uint8_t bytesprops11[] = {0x57, 0x96, 0x6d, 0xef, 0xc1, 0x65, 0x8d, 0xc5, 0xf2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14395}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28295}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25451}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13393}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16943}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops6}, .v = {13, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7139}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27556}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops11}, .v = {13, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 5}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\245l-\185\147\\\ai\199\183\216s\232\\\248\DC4\199\231[\DC4\139", _pubProps = [PropAuthenticationMethod
// "rC\184\SI\211\138\216kp\140\252\ACK2",PropMessageExpiryInterval 14395,PropSharedSubscriptionAvailable
// 182,PropMaximumQoS 230,PropServerReference
// "z\215\224\187zZ\ETB$\137\164\235\133\143\SI\228\232\242\130R\188\b\242\228\131\179\br",PropReasonString
// "\205\&6\ENQWp\149\176\186\202",PropPayloadFormatIndicator 91,PropRequestResponseInformation
// 166,PropResponseInformation
// "\US\220\207\205\200\162\141U\254\SOH\204\ng\156*\133h\228\198\152\CANhb",PropWildcardSubscriptionAvailable
// 52,PropSubscriptionIdentifier 17,PropRequestProblemInformation 195,PropTopicAlias 28295,PropMessageExpiryInterval
// 25451,PropReasonString "W",PropSessionExpiryInterval 13393,PropAssignedClientIdentifier
// "\146P\DC3`xR\ETX\t\161p\199",PropRetainAvailable 160,PropMessageExpiryInterval 16943,PropUserProperty
// "\212z\240\193\227\DC4\196,\RS?\198I\145[H\136\236\&39\254"
// "\154n2\180\135\194\227\149\178\151\152\216'",PropContentType "",PropAuthenticationData
// "\\@T\206\SOH,v\220\160dU?\218\RSM\250\181e\199",PropTopicAliasMaximum 7139,PropSessionExpiryInterval
// 27556,PropAuthenticationMethod "j\194\EOT\206w",PropUserProperty "W\150m\239\193e\141\197\242"
// "\200z{\236=*\134\210\160\237\t\n2",PropWildcardSubscriptionAvailable 5]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {
      0x30, 0x92, 0x2,  0x0,  0x0,  0xf9, 0x1,  0x15, 0x0,  0xd,  0x72, 0x43, 0xb8, 0xf,  0xd3, 0x8a, 0xd8, 0x6b, 0x70,
      0x8c, 0xfc, 0x6,  0x32, 0x2,  0x0,  0x0,  0x38, 0x3b, 0x2a, 0xb6, 0x24, 0xe6, 0x1c, 0x0,  0x1b, 0x7a, 0xd7, 0xe0,
      0xbb, 0x7a, 0x5a, 0x17, 0x24, 0x89, 0xa4, 0xeb, 0x85, 0x8f, 0xf,  0xe4, 0xe8, 0xf2, 0x82, 0x52, 0xbc, 0x8,  0xf2,
      0xe4, 0x83, 0xb3, 0x8,  0x72, 0x1f, 0x0,  0x9,  0xcd, 0x36, 0x5,  0x57, 0x70, 0x95, 0xb0, 0xba, 0xca, 0x1,  0x5b,
      0x19, 0xa6, 0x1a, 0x0,  0x17, 0x1f, 0xdc, 0xcf, 0xcd, 0xc8, 0xa2, 0x8d, 0x55, 0xfe, 0x1,  0xcc, 0xa,  0x67, 0x9c,
      0x2a, 0x85, 0x68, 0xe4, 0xc6, 0x98, 0x18, 0x68, 0x62, 0x28, 0x34, 0xb,  0x11, 0x17, 0xc3, 0x23, 0x6e, 0x87, 0x2,
      0x0,  0x0,  0x63, 0x6b, 0x1f, 0x0,  0x1,  0x57, 0x11, 0x0,  0x0,  0x34, 0x51, 0x12, 0x0,  0xb,  0x92, 0x50, 0x13,
      0x60, 0x78, 0x52, 0x3,  0x9,  0xa1, 0x70, 0xc7, 0x25, 0xa0, 0x2,  0x0,  0x0,  0x42, 0x2f, 0x26, 0x0,  0x14, 0xd4,
      0x7a, 0xf0, 0xc1, 0xe3, 0x14, 0xc4, 0x2c, 0x1e, 0x3f, 0xc6, 0x49, 0x91, 0x5b, 0x48, 0x88, 0xec, 0x33, 0x39, 0xfe,
      0x0,  0xd,  0x9a, 0x6e, 0x32, 0xb4, 0x87, 0xc2, 0xe3, 0x95, 0xb2, 0x97, 0x98, 0xd8, 0x27, 0x3,  0x0,  0x0,  0x16,
      0x0,  0x13, 0x5c, 0x40, 0x54, 0xce, 0x1,  0x2c, 0x76, 0xdc, 0xa0, 0x64, 0x55, 0x3f, 0xda, 0x1e, 0x4d, 0xfa, 0xb5,
      0x65, 0xc7, 0x22, 0x1b, 0xe3, 0x11, 0x0,  0x0,  0x6b, 0xa4, 0x15, 0x0,  0x5,  0x6a, 0xc2, 0x4,  0xce, 0x77, 0x26,
      0x0,  0x9,  0x57, 0x96, 0x6d, 0xef, 0xc1, 0x65, 0x8d, 0xc5, 0xf2, 0x0,  0xd,  0xc8, 0x7a, 0x7b, 0xec, 0x3d, 0x2a,
      0x86, 0xd2, 0xa0, 0xed, 0x9,  0xa,  0x32, 0x28, 0x5,  0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7, 0xb7,
      0xd8, 0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x6c, 0x2d, 0xb9, 0x93, 0x5c, 0x7,  0x69, 0xc7, 0xb7, 0xd8,
                              0x73, 0xe8, 0x5c, 0xf8, 0x14, 0xc7, 0xe7, 0x5b, 0x14, 0x8b};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "B&&P~\USwi\200\237U\SI0[8\205\ETX\US\171\236", _pubPktID = 20579, _pubBody =
// "\160|,\236\153`\132S\ETBj\210-v\ETB\US\246\DC4>iK\158\SOH\141\250", _pubProps = [PropAuthenticationData
// "\189\ETX\233\254\CAN\DLEh\194\167\169\ENQ\189R\142\208\219K_L\142<",PropMessageExpiryInterval
// 5515,PropReceiveMaximum 2239,PropContentType
// "\na\143g\245\241\131\129S\235:S\134\\Y\EM\178jo\176\254~\160\244b\153=O\219\134",PropRequestResponseInformation
// 81,PropTopicAliasMaximum 31006,PropRequestProblemInformation 9,PropServerKeepAlive
// 14324,PropSharedSubscriptionAvailable 46,PropMaximumPacketSize 2368,PropContentType "+\149\163\222\141\174\179\ETB
// \216r.RR\180#f\226(\156;",PropResponseTopic
// "}\EM\250f\EOT4\216\187s\219\209\136\147\216`\224\ACK\232yt\231\173n\248\183\197",PropMaximumPacketSize
// 27506,PropReceiveMaximum 3430,PropRetainAvailable 154,PropResponseTopic
// "-~\ESC\222E\156\152\245b\135",PropUserProperty "\217U\GS2\234\145"
// "\249\151\166\171\245N.<\164x\194",PropWillDelayInterval 13052,PropSharedSubscriptionAvailable
// 178,PropAssignedClientIdentifier "\248\EMC8m,8I\t\252\215",PropAssignedClientIdentifier
// "\v\140\238\&9\136e=\239\143>Qi\219\130\251T\251\143\244d\ETX\251"]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x3d, 0x94, 0x2,  0x0,  0x14, 0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed, 0x55, 0xf,  0x30, 0x5b,
      0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec, 0x50, 0x63, 0xe2, 0x1,  0x16, 0x0,  0x15, 0xbd, 0x3,  0xe9, 0xfe, 0x18, 0x10,
      0x68, 0xc2, 0xa7, 0xa9, 0x5,  0xbd, 0x52, 0x8e, 0xd0, 0xdb, 0x4b, 0x5f, 0x4c, 0x8e, 0x3c, 0x2,  0x0,  0x0,  0x15,
      0x8b, 0x21, 0x8,  0xbf, 0x3,  0x0,  0x1e, 0xa,  0x61, 0x8f, 0x67, 0xf5, 0xf1, 0x83, 0x81, 0x53, 0xeb, 0x3a, 0x53,
      0x86, 0x5c, 0x59, 0x19, 0xb2, 0x6a, 0x6f, 0xb0, 0xfe, 0x7e, 0xa0, 0xf4, 0x62, 0x99, 0x3d, 0x4f, 0xdb, 0x86, 0x19,
      0x51, 0x22, 0x79, 0x1e, 0x17, 0x9,  0x13, 0x37, 0xf4, 0x2a, 0x2e, 0x27, 0x0,  0x0,  0x9,  0x40, 0x3,  0x0,  0x15,
      0x2b, 0x95, 0xa3, 0xde, 0x8d, 0xae, 0xb3, 0x17, 0x20, 0xd8, 0x72, 0x2e, 0x52, 0x52, 0xb4, 0x23, 0x66, 0xe2, 0x28,
      0x9c, 0x3b, 0x8,  0x0,  0x1a, 0x7d, 0x19, 0xfa, 0x66, 0x4,  0x34, 0xd8, 0xbb, 0x73, 0xdb, 0xd1, 0x88, 0x93, 0xd8,
      0x60, 0xe0, 0x6,  0xe8, 0x79, 0x74, 0xe7, 0xad, 0x6e, 0xf8, 0xb7, 0xc5, 0x27, 0x0,  0x0,  0x6b, 0x72, 0x21, 0xd,
      0x66, 0x25, 0x9a, 0x8,  0x0,  0xa,  0x2d, 0x7e, 0x1b, 0xde, 0x45, 0x9c, 0x98, 0xf5, 0x62, 0x87, 0x26, 0x0,  0x6,
      0xd9, 0x55, 0x1d, 0x32, 0xea, 0x91, 0x0,  0xb,  0xf9, 0x97, 0xa6, 0xab, 0xf5, 0x4e, 0x2e, 0x3c, 0xa4, 0x78, 0xc2,
      0x18, 0x0,  0x0,  0x32, 0xfc, 0x2a, 0xb2, 0x12, 0x0,  0xb,  0xf8, 0x19, 0x43, 0x38, 0x6d, 0x2c, 0x38, 0x49, 0x9,
      0xfc, 0xd7, 0x12, 0x0,  0x16, 0xb,  0x8c, 0xee, 0x39, 0x88, 0x65, 0x3d, 0xef, 0x8f, 0x3e, 0x51, 0x69, 0xdb, 0x82,
      0xfb, 0x54, 0xfb, 0x8f, 0xf4, 0x64, 0x3,  0xfb, 0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53, 0x17, 0x6a, 0xd2,
      0x2d, 0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  uint8_t topic_bytes[] = {0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed,
                           0x55, 0xf,  0x30, 0x5b, 0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53, 0x17, 0x6a, 0xd2, 0x2d,
                         0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0xbd, 0x3,  0xe9, 0xfe, 0x18, 0x10, 0x68, 0xc2, 0xa7, 0xa9, 0x5,
                           0xbd, 0x52, 0x8e, 0xd0, 0xdb, 0x4b, 0x5f, 0x4c, 0x8e, 0x3c};
  uint8_t bytesprops1[] = {0xa,  0x61, 0x8f, 0x67, 0xf5, 0xf1, 0x83, 0x81, 0x53, 0xeb, 0x3a, 0x53, 0x86, 0x5c, 0x59,
                           0x19, 0xb2, 0x6a, 0x6f, 0xb0, 0xfe, 0x7e, 0xa0, 0xf4, 0x62, 0x99, 0x3d, 0x4f, 0xdb, 0x86};
  uint8_t bytesprops2[] = {0x2b, 0x95, 0xa3, 0xde, 0x8d, 0xae, 0xb3, 0x17, 0x20, 0xd8, 0x72,
                           0x2e, 0x52, 0x52, 0xb4, 0x23, 0x66, 0xe2, 0x28, 0x9c, 0x3b};
  uint8_t bytesprops3[] = {0x7d, 0x19, 0xfa, 0x66, 0x4,  0x34, 0xd8, 0xbb, 0x73, 0xdb, 0xd1, 0x88, 0x93,
                           0xd8, 0x60, 0xe0, 0x6,  0xe8, 0x79, 0x74, 0xe7, 0xad, 0x6e, 0xf8, 0xb7, 0xc5};
  uint8_t bytesprops4[] = {0x2d, 0x7e, 0x1b, 0xde, 0x45, 0x9c, 0x98, 0xf5, 0x62, 0x87};
  uint8_t bytesprops6[] = {0xf9, 0x97, 0xa6, 0xab, 0xf5, 0x4e, 0x2e, 0x3c, 0xa4, 0x78, 0xc2};
  uint8_t bytesprops5[] = {0xd9, 0x55, 0x1d, 0x32, 0xea, 0x91};
  uint8_t bytesprops7[] = {0xf8, 0x19, 0x43, 0x38, 0x6d, 0x2c, 0x38, 0x49, 0x9, 0xfc, 0xd7};
  uint8_t bytesprops8[] = {0xb,  0x8c, 0xee, 0x39, 0x88, 0x65, 0x3d, 0xef, 0x8f, 0x3e, 0x51,
                           0x69, 0xdb, 0x82, 0xfb, 0x54, 0xfb, 0x8f, 0xf4, 0x64, 0x3,  0xfb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5515}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2239}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31006}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14324}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2368}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27506}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3430}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops5}, .v = {11, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13052}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 20579, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "B&&P~\USwi\200\237U\SI0[8\205\ETX\US\171\236", _pubPktID = 20579, _pubBody =
// "\160|,\236\153`\132S\ETBj\210-v\ETB\US\246\DC4>iK\158\SOH\141\250", _pubProps = [PropAuthenticationData
// "\189\ETX\233\254\CAN\DLEh\194\167\169\ENQ\189R\142\208\219K_L\142<",PropMessageExpiryInterval
// 5515,PropReceiveMaximum 2239,PropContentType
// "\na\143g\245\241\131\129S\235:S\134\\Y\EM\178jo\176\254~\160\244b\153=O\219\134",PropRequestResponseInformation
// 81,PropTopicAliasMaximum 31006,PropRequestProblemInformation 9,PropServerKeepAlive
// 14324,PropSharedSubscriptionAvailable 46,PropMaximumPacketSize 2368,PropContentType "+\149\163\222\141\174\179\ETB
// \216r.RR\180#f\226(\156;",PropResponseTopic
// "}\EM\250f\EOT4\216\187s\219\209\136\147\216`\224\ACK\232yt\231\173n\248\183\197",PropMaximumPacketSize
// 27506,PropReceiveMaximum 3430,PropRetainAvailable 154,PropResponseTopic
// "-~\ESC\222E\156\152\245b\135",PropUserProperty "\217U\GS2\234\145"
// "\249\151\166\171\245N.<\164x\194",PropWillDelayInterval 13052,PropSharedSubscriptionAvailable
// 178,PropAssignedClientIdentifier "\248\EMC8m,8I\t\252\215",PropAssignedClientIdentifier
// "\v\140\238\&9\136e=\239\143>Qi\219\130\251T\251\143\244d\ETX\251"]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x3d, 0x94, 0x2,  0x0,  0x14, 0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed, 0x55, 0xf,  0x30, 0x5b,
      0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec, 0x50, 0x63, 0xe2, 0x1,  0x16, 0x0,  0x15, 0xbd, 0x3,  0xe9, 0xfe, 0x18, 0x10,
      0x68, 0xc2, 0xa7, 0xa9, 0x5,  0xbd, 0x52, 0x8e, 0xd0, 0xdb, 0x4b, 0x5f, 0x4c, 0x8e, 0x3c, 0x2,  0x0,  0x0,  0x15,
      0x8b, 0x21, 0x8,  0xbf, 0x3,  0x0,  0x1e, 0xa,  0x61, 0x8f, 0x67, 0xf5, 0xf1, 0x83, 0x81, 0x53, 0xeb, 0x3a, 0x53,
      0x86, 0x5c, 0x59, 0x19, 0xb2, 0x6a, 0x6f, 0xb0, 0xfe, 0x7e, 0xa0, 0xf4, 0x62, 0x99, 0x3d, 0x4f, 0xdb, 0x86, 0x19,
      0x51, 0x22, 0x79, 0x1e, 0x17, 0x9,  0x13, 0x37, 0xf4, 0x2a, 0x2e, 0x27, 0x0,  0x0,  0x9,  0x40, 0x3,  0x0,  0x15,
      0x2b, 0x95, 0xa3, 0xde, 0x8d, 0xae, 0xb3, 0x17, 0x20, 0xd8, 0x72, 0x2e, 0x52, 0x52, 0xb4, 0x23, 0x66, 0xe2, 0x28,
      0x9c, 0x3b, 0x8,  0x0,  0x1a, 0x7d, 0x19, 0xfa, 0x66, 0x4,  0x34, 0xd8, 0xbb, 0x73, 0xdb, 0xd1, 0x88, 0x93, 0xd8,
      0x60, 0xe0, 0x6,  0xe8, 0x79, 0x74, 0xe7, 0xad, 0x6e, 0xf8, 0xb7, 0xc5, 0x27, 0x0,  0x0,  0x6b, 0x72, 0x21, 0xd,
      0x66, 0x25, 0x9a, 0x8,  0x0,  0xa,  0x2d, 0x7e, 0x1b, 0xde, 0x45, 0x9c, 0x98, 0xf5, 0x62, 0x87, 0x26, 0x0,  0x6,
      0xd9, 0x55, 0x1d, 0x32, 0xea, 0x91, 0x0,  0xb,  0xf9, 0x97, 0xa6, 0xab, 0xf5, 0x4e, 0x2e, 0x3c, 0xa4, 0x78, 0xc2,
      0x18, 0x0,  0x0,  0x32, 0xfc, 0x2a, 0xb2, 0x12, 0x0,  0xb,  0xf8, 0x19, 0x43, 0x38, 0x6d, 0x2c, 0x38, 0x49, 0x9,
      0xfc, 0xd7, 0x12, 0x0,  0x16, 0xb,  0x8c, 0xee, 0x39, 0x88, 0x65, 0x3d, 0xef, 0x8f, 0x3e, 0x51, 0x69, 0xdb, 0x82,
      0xfb, 0x54, 0xfb, 0x8f, 0xf4, 0x64, 0x3,  0xfb, 0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53, 0x17, 0x6a, 0xd2,
      0x2d, 0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x42, 0x26, 0x26, 0x50, 0x7e, 0x1f, 0x77, 0x69, 0xc8, 0xed,
                               0x55, 0xf,  0x30, 0x5b, 0x38, 0xcd, 0x3,  0x1f, 0xab, 0xec};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa0, 0x7c, 0x2c, 0xec, 0x99, 0x60, 0x84, 0x53, 0x17, 0x6a, 0xd2, 0x2d,
                              0x76, 0x17, 0x1f, 0xf6, 0x14, 0x3e, 0x69, 0x4b, 0x9e, 0x1,  0x8d, 0xfa};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 20579);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Wo\249\180\STXZ\FS\218Co_\137a\140\&9^\232\186\143\230", _pubPktID = 10935, _pubBody =
// "\US\177vw\219K\147TS\150\&9", _pubProps = [PropRequestProblemInformation 50,PropMaximumQoS
// 128,PropRequestProblemInformation 117,PropSharedSubscriptionAvailable 34,PropRequestProblemInformation
// 176,PropResponseTopic "\138\239\224\170\217\195W\DLE\247\243\229\144JC\206\214\157\210\140y",PropServerReference
// "\GS{\211\DEL%TI\RS\240\157\133\241",PropCorrelationData "^\ENQ\SIt\179\r\175",PropTopicAliasMaximum
// 9980,PropSubscriptionIdentifier 13,PropRequestProblemInformation 141,PropRequestProblemInformation
// 157,PropServerKeepAlive 25125,PropServerReference
// "\152\177nW\NAK\203\176X0\170X\164\187\ACK\228H4\157F\245\SYN\206\164",PropAuthenticationData
// "\229OD^\140\223\EOT\DLE!=\183\138_\187\233.\162\v\166\131\221\fk@\205\251\219\225]",PropRequestProblemInformation
// 89,PropSharedSubscriptionAvailable 29,PropReasonString
// "2\EOT\150\DEL\143J\160\249\203\DC4K\228\210\181",PropServerReference
// "\218iml`u\n\149\238u\199\US\SYNP\STX\\\142~\232\237\DC12\249",PropReceiveMaximum
// 9895,PropSharedSubscriptionAvailable 120,PropSessionExpiryInterval 11586,PropMessageExpiryInterval
// 30889,PropSessionExpiryInterval 28738,PropReceiveMaximum 1634,PropUserProperty
// ".\171\187d\NUL\164\234?\f2\DLE\STXi\NULL\169\ENQh" "\183\140ND\184/\134",PropServerReference
// "\216\204\231\214^\SYNL\179",PropRetainAvailable 88,PropServerKeepAlive 19095]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x3d, 0x99, 0x2,  0x0,  0x14, 0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43, 0x6f, 0x5f, 0x89, 0x61, 0x8c,
      0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6, 0x2a, 0xb7, 0xf4, 0x1,  0x17, 0x32, 0x24, 0x80, 0x17, 0x75, 0x2a, 0x22, 0x17,
      0xb0, 0x8,  0x0,  0x14, 0x8a, 0xef, 0xe0, 0xaa, 0xd9, 0xc3, 0x57, 0x10, 0xf7, 0xf3, 0xe5, 0x90, 0x4a, 0x43, 0xce,
      0xd6, 0x9d, 0xd2, 0x8c, 0x79, 0x1c, 0x0,  0xc,  0x1d, 0x7b, 0xd3, 0x7f, 0x25, 0x54, 0x49, 0x1e, 0xf0, 0x9d, 0x85,
      0xf1, 0x9,  0x0,  0x7,  0x5e, 0x5,  0xf,  0x74, 0xb3, 0xd,  0xaf, 0x22, 0x26, 0xfc, 0xb,  0xd,  0x17, 0x8d, 0x17,
      0x9d, 0x13, 0x62, 0x25, 0x1c, 0x0,  0x17, 0x98, 0xb1, 0x6e, 0x57, 0x15, 0xcb, 0xb0, 0x58, 0x30, 0xaa, 0x58, 0xa4,
      0xbb, 0x6,  0xe4, 0x48, 0x34, 0x9d, 0x46, 0xf5, 0x16, 0xce, 0xa4, 0x16, 0x0,  0x1d, 0xe5, 0x4f, 0x44, 0x5e, 0x8c,
      0xdf, 0x4,  0x10, 0x21, 0x3d, 0xb7, 0x8a, 0x5f, 0xbb, 0xe9, 0x2e, 0xa2, 0xb,  0xa6, 0x83, 0xdd, 0xc,  0x6b, 0x40,
      0xcd, 0xfb, 0xdb, 0xe1, 0x5d, 0x17, 0x59, 0x2a, 0x1d, 0x1f, 0x0,  0xe,  0x32, 0x4,  0x96, 0x7f, 0x8f, 0x4a, 0xa0,
      0xf9, 0xcb, 0x14, 0x4b, 0xe4, 0xd2, 0xb5, 0x1c, 0x0,  0x17, 0xda, 0x69, 0x6d, 0x6c, 0x60, 0x75, 0xa,  0x95, 0xee,
      0x75, 0xc7, 0x1f, 0x16, 0x50, 0x2,  0x5c, 0x8e, 0x7e, 0xe8, 0xed, 0x11, 0x32, 0xf9, 0x21, 0x26, 0xa7, 0x2a, 0x78,
      0x11, 0x0,  0x0,  0x2d, 0x42, 0x2,  0x0,  0x0,  0x78, 0xa9, 0x11, 0x0,  0x0,  0x70, 0x42, 0x21, 0x6,  0x62, 0x26,
      0x0,  0x12, 0x2e, 0xab, 0xbb, 0x64, 0x0,  0xa4, 0xea, 0x3f, 0xc,  0x32, 0x10, 0x2,  0x69, 0x0,  0x4c, 0xa9, 0x5,
      0x68, 0x0,  0x7,  0xb7, 0x8c, 0x4e, 0x44, 0xb8, 0x2f, 0x86, 0x1c, 0x0,  0x8,  0xd8, 0xcc, 0xe7, 0xd6, 0x5e, 0x16,
      0x4c, 0xb3, 0x25, 0x58, 0x13, 0x4a, 0x97, 0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  uint8_t topic_bytes[] = {0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43, 0x6f,
                           0x5f, 0x89, 0x61, 0x8c, 0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0x8a, 0xef, 0xe0, 0xaa, 0xd9, 0xc3, 0x57, 0x10, 0xf7, 0xf3,
                           0xe5, 0x90, 0x4a, 0x43, 0xce, 0xd6, 0x9d, 0xd2, 0x8c, 0x79};
  uint8_t bytesprops1[] = {0x1d, 0x7b, 0xd3, 0x7f, 0x25, 0x54, 0x49, 0x1e, 0xf0, 0x9d, 0x85, 0xf1};
  uint8_t bytesprops2[] = {0x5e, 0x5, 0xf, 0x74, 0xb3, 0xd, 0xaf};
  uint8_t bytesprops3[] = {0x98, 0xb1, 0x6e, 0x57, 0x15, 0xcb, 0xb0, 0x58, 0x30, 0xaa, 0x58, 0xa4,
                           0xbb, 0x6,  0xe4, 0x48, 0x34, 0x9d, 0x46, 0xf5, 0x16, 0xce, 0xa4};
  uint8_t bytesprops4[] = {0xe5, 0x4f, 0x44, 0x5e, 0x8c, 0xdf, 0x4, 0x10, 0x21, 0x3d, 0xb7, 0x8a, 0x5f, 0xbb, 0xe9,
                           0x2e, 0xa2, 0xb,  0xa6, 0x83, 0xdd, 0xc, 0x6b, 0x40, 0xcd, 0xfb, 0xdb, 0xe1, 0x5d};
  uint8_t bytesprops5[] = {0x32, 0x4, 0x96, 0x7f, 0x8f, 0x4a, 0xa0, 0xf9, 0xcb, 0x14, 0x4b, 0xe4, 0xd2, 0xb5};
  uint8_t bytesprops6[] = {0xda, 0x69, 0x6d, 0x6c, 0x60, 0x75, 0xa,  0x95, 0xee, 0x75, 0xc7, 0x1f,
                           0x16, 0x50, 0x2,  0x5c, 0x8e, 0x7e, 0xe8, 0xed, 0x11, 0x32, 0xf9};
  uint8_t bytesprops8[] = {0xb7, 0x8c, 0x4e, 0x44, 0xb8, 0x2f, 0x86};
  uint8_t bytesprops7[] = {0x2e, 0xab, 0xbb, 0x64, 0x0, 0xa4, 0xea, 0x3f, 0xc,
                           0x32, 0x10, 0x2,  0x69, 0x0, 0x4c, 0xa9, 0x5,  0x68};
  uint8_t bytesprops9[] = {0xd8, 0xcc, 0xe7, 0xd6, 0x5e, 0x16, 0x4c, 0xb3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9980}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25125}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9895}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11586}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30889}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28738}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1634}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops7}, .v = {7, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19095}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10935, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "Wo\249\180\STXZ\FS\218Co_\137a\140\&9^\232\186\143\230", _pubPktID = 10935, _pubBody =
// "\US\177vw\219K\147TS\150\&9", _pubProps = [PropRequestProblemInformation 50,PropMaximumQoS
// 128,PropRequestProblemInformation 117,PropSharedSubscriptionAvailable 34,PropRequestProblemInformation
// 176,PropResponseTopic "\138\239\224\170\217\195W\DLE\247\243\229\144JC\206\214\157\210\140y",PropServerReference
// "\GS{\211\DEL%TI\RS\240\157\133\241",PropCorrelationData "^\ENQ\SIt\179\r\175",PropTopicAliasMaximum
// 9980,PropSubscriptionIdentifier 13,PropRequestProblemInformation 141,PropRequestProblemInformation
// 157,PropServerKeepAlive 25125,PropServerReference
// "\152\177nW\NAK\203\176X0\170X\164\187\ACK\228H4\157F\245\SYN\206\164",PropAuthenticationData
// "\229OD^\140\223\EOT\DLE!=\183\138_\187\233.\162\v\166\131\221\fk@\205\251\219\225]",PropRequestProblemInformation
// 89,PropSharedSubscriptionAvailable 29,PropReasonString
// "2\EOT\150\DEL\143J\160\249\203\DC4K\228\210\181",PropServerReference
// "\218iml`u\n\149\238u\199\US\SYNP\STX\\\142~\232\237\DC12\249",PropReceiveMaximum
// 9895,PropSharedSubscriptionAvailable 120,PropSessionExpiryInterval 11586,PropMessageExpiryInterval
// 30889,PropSessionExpiryInterval 28738,PropReceiveMaximum 1634,PropUserProperty
// ".\171\187d\NUL\164\234?\f2\DLE\STXi\NULL\169\ENQh" "\183\140ND\184/\134",PropServerReference
// "\216\204\231\214^\SYNL\179",PropRetainAvailable 88,PropServerKeepAlive 19095]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {
      0x3d, 0x99, 0x2,  0x0,  0x14, 0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43, 0x6f, 0x5f, 0x89, 0x61, 0x8c,
      0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6, 0x2a, 0xb7, 0xf4, 0x1,  0x17, 0x32, 0x24, 0x80, 0x17, 0x75, 0x2a, 0x22, 0x17,
      0xb0, 0x8,  0x0,  0x14, 0x8a, 0xef, 0xe0, 0xaa, 0xd9, 0xc3, 0x57, 0x10, 0xf7, 0xf3, 0xe5, 0x90, 0x4a, 0x43, 0xce,
      0xd6, 0x9d, 0xd2, 0x8c, 0x79, 0x1c, 0x0,  0xc,  0x1d, 0x7b, 0xd3, 0x7f, 0x25, 0x54, 0x49, 0x1e, 0xf0, 0x9d, 0x85,
      0xf1, 0x9,  0x0,  0x7,  0x5e, 0x5,  0xf,  0x74, 0xb3, 0xd,  0xaf, 0x22, 0x26, 0xfc, 0xb,  0xd,  0x17, 0x8d, 0x17,
      0x9d, 0x13, 0x62, 0x25, 0x1c, 0x0,  0x17, 0x98, 0xb1, 0x6e, 0x57, 0x15, 0xcb, 0xb0, 0x58, 0x30, 0xaa, 0x58, 0xa4,
      0xbb, 0x6,  0xe4, 0x48, 0x34, 0x9d, 0x46, 0xf5, 0x16, 0xce, 0xa4, 0x16, 0x0,  0x1d, 0xe5, 0x4f, 0x44, 0x5e, 0x8c,
      0xdf, 0x4,  0x10, 0x21, 0x3d, 0xb7, 0x8a, 0x5f, 0xbb, 0xe9, 0x2e, 0xa2, 0xb,  0xa6, 0x83, 0xdd, 0xc,  0x6b, 0x40,
      0xcd, 0xfb, 0xdb, 0xe1, 0x5d, 0x17, 0x59, 0x2a, 0x1d, 0x1f, 0x0,  0xe,  0x32, 0x4,  0x96, 0x7f, 0x8f, 0x4a, 0xa0,
      0xf9, 0xcb, 0x14, 0x4b, 0xe4, 0xd2, 0xb5, 0x1c, 0x0,  0x17, 0xda, 0x69, 0x6d, 0x6c, 0x60, 0x75, 0xa,  0x95, 0xee,
      0x75, 0xc7, 0x1f, 0x16, 0x50, 0x2,  0x5c, 0x8e, 0x7e, 0xe8, 0xed, 0x11, 0x32, 0xf9, 0x21, 0x26, 0xa7, 0x2a, 0x78,
      0x11, 0x0,  0x0,  0x2d, 0x42, 0x2,  0x0,  0x0,  0x78, 0xa9, 0x11, 0x0,  0x0,  0x70, 0x42, 0x21, 0x6,  0x62, 0x26,
      0x0,  0x12, 0x2e, 0xab, 0xbb, 0x64, 0x0,  0xa4, 0xea, 0x3f, 0xc,  0x32, 0x10, 0x2,  0x69, 0x0,  0x4c, 0xa9, 0x5,
      0x68, 0x0,  0x7,  0xb7, 0x8c, 0x4e, 0x44, 0xb8, 0x2f, 0x86, 0x1c, 0x0,  0x8,  0xd8, 0xcc, 0xe7, 0xd6, 0x5e, 0x16,
      0x4c, 0xb3, 0x25, 0x58, 0x13, 0x4a, 0x97, 0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0x6f, 0xf9, 0xb4, 0x2,  0x5a, 0x1c, 0xda, 0x43, 0x6f,
                               0x5f, 0x89, 0x61, 0x8c, 0x39, 0x5e, 0xe8, 0xba, 0x8f, 0xe6};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1f, 0xb1, 0x76, 0x77, 0xdb, 0x4b, 0x93, 0x54, 0x53, 0x96, 0x39};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10935);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "z\187}l", _pubPktID = 11378,
// _pubBody = "\186\&7\190\f\178\235\212\242\166(\ENQ\181\SUB\234\&4\149H\SYN6\197\247\207", _pubProps =
// [PropMessageExpiryInterval 17405,PropTopicAlias 796,PropSubscriptionIdentifier 9,PropReasonString
// "\189\150\149\164v",PropMaximumPacketSize 27577,PropRetainAvailable 102,PropMaximumPacketSize 1224]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {0x34, 0x3d, 0x0,  0x4,  0x7a, 0xbb, 0x7d, 0x6c, 0x2c, 0x72, 0x1e, 0x2,  0x0,  0x0,  0x43, 0xfd,
                   0x23, 0x3,  0x1c, 0xb,  0x9,  0x1f, 0x0,  0x5,  0xbd, 0x96, 0x95, 0xa4, 0x76, 0x27, 0x0,  0x0,
                   0x6b, 0xb9, 0x25, 0x66, 0x27, 0x0,  0x0,  0x4,  0xc8, 0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb, 0xd4,
                   0xf2, 0xa6, 0x28, 0x5,  0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  uint8_t topic_bytes[] = {0x7a, 0xbb, 0x7d, 0x6c};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb, 0xd4, 0xf2, 0xa6, 0x28, 0x5,
                         0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0xbd, 0x96, 0x95, 0xa4, 0x76};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17405}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 796}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27577}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1224}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 11378, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "z\187}l", _pubPktID = 11378,
// _pubBody = "\186\&7\190\f\178\235\212\242\166(\ENQ\181\SUB\234\&4\149H\SYN6\197\247\207", _pubProps =
// [PropMessageExpiryInterval 17405,PropTopicAlias 796,PropSubscriptionIdentifier 9,PropReasonString
// "\189\150\149\164v",PropMaximumPacketSize 27577,PropRetainAvailable 102,PropMaximumPacketSize 1224]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {0x34, 0x3d, 0x0,  0x4,  0x7a, 0xbb, 0x7d, 0x6c, 0x2c, 0x72, 0x1e, 0x2,  0x0,  0x0,  0x43, 0xfd,
                   0x23, 0x3,  0x1c, 0xb,  0x9,  0x1f, 0x0,  0x5,  0xbd, 0x96, 0x95, 0xa4, 0x76, 0x27, 0x0,  0x0,
                   0x6b, 0xb9, 0x25, 0x66, 0x27, 0x0,  0x0,  0x4,  0xc8, 0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb, 0xd4,
                   0xf2, 0xa6, 0x28, 0x5,  0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7a, 0xbb, 0x7d, 0x6c};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xba, 0x37, 0xbe, 0xc,  0xb2, 0xeb, 0xd4, 0xf2, 0xa6, 0x28, 0x5,
                              0xb5, 0x1a, 0xea, 0x34, 0x95, 0x48, 0x16, 0x36, 0xc5, 0xf7, 0xcf};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11378);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\252\190\&8\149\&2\128\192{C\128\194\197\170g\a_\DC4\DELI(\151\218\172\vBJ\234\221", _pubPktID = 0, _pubBody =
// "q\145\203\144\245\153\&3\220g\186\&9YVh\DEL\232\&2V\212\201\&4\172?\189S\159<\187W", _pubProps =
// [PropWildcardSubscriptionAvailable 68,PropReasonString "\231\STX\217\206C\164",PropServerKeepAlive
// 28798,PropAuthenticationData "\202\ETX1\130\NUL\184r\147\SYN\162\182)\226\v!m",PropRequestResponseInformation
// 255,PropContentType "\RS\STX\200B\190",PropResponseTopic "\218{",PropTopicAlias
// 31640,PropSubscriptionIdentifierAvailable 99,PropServerKeepAlive 9138,PropAuthenticationMethod
// "\240'\176\DC2=\ENQ\247H\176`\247\SOH\151Dj\220\GS4\132",PropUserProperty
// "`\157;)\RS\168\170G\SI\131\204z\251\SO#-\221tq\224"
// "DQ\194\246\165\220\230\217\222\SUB\160E\213P\"\156\211",PropWillDelayInterval 4096,PropRequestResponseInformation
// 25,PropReceiveMaximum 26707,PropAssignedClientIdentifier "e]\166a",PropAuthenticationMethod
// "\236\135\179\164I\DLEm\GS\189\155inmB",PropMessageExpiryInterval 8438,PropSharedSubscriptionAvailable
// 26,PropSubscriptionIdentifierAvailable 221,PropUserProperty "Q&z\242\130#\206\&2\225N\236\181d\233"
// "\182/^\246\211CZ\255",PropContentType
// "n\219S\144\134\181\223\145\184\193X\245\193\231\186\&3k\159\188\218\252\SUB\221\244zbNt3"]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x39, 0x9b, 0x2,  0x0,  0x1c, 0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5,
                   0xaa, 0x67, 0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd, 0xde,
                   0x1,  0x28, 0x44, 0x1f, 0x0,  0x6,  0xe7, 0x2,  0xd9, 0xce, 0x43, 0xa4, 0x13, 0x70, 0x7e, 0x16, 0x0,
                   0x10, 0xca, 0x3,  0x31, 0x82, 0x0,  0xb8, 0x72, 0x93, 0x16, 0xa2, 0xb6, 0x29, 0xe2, 0xb,  0x21, 0x6d,
                   0x19, 0xff, 0x3,  0x0,  0x5,  0x1e, 0x2,  0xc8, 0x42, 0xbe, 0x8,  0x0,  0x2,  0xda, 0x7b, 0x23, 0x7b,
                   0x98, 0x29, 0x63, 0x13, 0x23, 0xb2, 0x15, 0x0,  0x13, 0xf0, 0x27, 0xb0, 0x12, 0x3d, 0x5,  0xf7, 0x48,
                   0xb0, 0x60, 0xf7, 0x1,  0x97, 0x44, 0x6a, 0xdc, 0x1d, 0x34, 0x84, 0x26, 0x0,  0x14, 0x60, 0x9d, 0x3b,
                   0x29, 0x1e, 0xa8, 0xaa, 0x47, 0xf,  0x83, 0xcc, 0x7a, 0xfb, 0xe,  0x23, 0x2d, 0xdd, 0x74, 0x71, 0xe0,
                   0x0,  0x11, 0x44, 0x51, 0xc2, 0xf6, 0xa5, 0xdc, 0xe6, 0xd9, 0xde, 0x1a, 0xa0, 0x45, 0xd5, 0x50, 0x22,
                   0x9c, 0xd3, 0x18, 0x0,  0x0,  0x10, 0x0,  0x19, 0x19, 0x21, 0x68, 0x53, 0x12, 0x0,  0x4,  0x65, 0x5d,
                   0xa6, 0x61, 0x15, 0x0,  0xe,  0xec, 0x87, 0xb3, 0xa4, 0x49, 0x10, 0x6d, 0x1d, 0xbd, 0x9b, 0x69, 0x6e,
                   0x6d, 0x42, 0x2,  0x0,  0x0,  0x20, 0xf6, 0x2a, 0x1a, 0x29, 0xdd, 0x26, 0x0,  0xe,  0x51, 0x26, 0x7a,
                   0xf2, 0x82, 0x23, 0xce, 0x32, 0xe1, 0x4e, 0xec, 0xb5, 0x64, 0xe9, 0x0,  0x8,  0xb6, 0x2f, 0x5e, 0xf6,
                   0xd3, 0x43, 0x5a, 0xff, 0x3,  0x0,  0x1d, 0x6e, 0xdb, 0x53, 0x90, 0x86, 0xb5, 0xdf, 0x91, 0xb8, 0xc1,
                   0x58, 0xf5, 0xc1, 0xe7, 0xba, 0x33, 0x6b, 0x9f, 0xbc, 0xda, 0xfc, 0x1a, 0xdd, 0xf4, 0x7a, 0x62, 0x4e,
                   0x74, 0x33, 0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f,
                   0xe8, 0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  uint8_t topic_bytes[] = {0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5, 0xaa, 0x67,
                           0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f,
                         0xe8, 0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0xe7, 0x2, 0xd9, 0xce, 0x43, 0xa4};
  uint8_t bytesprops1[] = {0xca, 0x3, 0x31, 0x82, 0x0, 0xb8, 0x72, 0x93, 0x16, 0xa2, 0xb6, 0x29, 0xe2, 0xb, 0x21, 0x6d};
  uint8_t bytesprops2[] = {0x1e, 0x2, 0xc8, 0x42, 0xbe};
  uint8_t bytesprops3[] = {0xda, 0x7b};
  uint8_t bytesprops4[] = {0xf0, 0x27, 0xb0, 0x12, 0x3d, 0x5,  0xf7, 0x48, 0xb0, 0x60,
                           0xf7, 0x1,  0x97, 0x44, 0x6a, 0xdc, 0x1d, 0x34, 0x84};
  uint8_t bytesprops6[] = {0x44, 0x51, 0xc2, 0xf6, 0xa5, 0xdc, 0xe6, 0xd9, 0xde,
                           0x1a, 0xa0, 0x45, 0xd5, 0x50, 0x22, 0x9c, 0xd3};
  uint8_t bytesprops5[] = {0x60, 0x9d, 0x3b, 0x29, 0x1e, 0xa8, 0xaa, 0x47, 0xf,  0x83,
                           0xcc, 0x7a, 0xfb, 0xe,  0x23, 0x2d, 0xdd, 0x74, 0x71, 0xe0};
  uint8_t bytesprops7[] = {0x65, 0x5d, 0xa6, 0x61};
  uint8_t bytesprops8[] = {0xec, 0x87, 0xb3, 0xa4, 0x49, 0x10, 0x6d, 0x1d, 0xbd, 0x9b, 0x69, 0x6e, 0x6d, 0x42};
  uint8_t bytesprops10[] = {0xb6, 0x2f, 0x5e, 0xf6, 0xd3, 0x43, 0x5a, 0xff};
  uint8_t bytesprops9[] = {0x51, 0x26, 0x7a, 0xf2, 0x82, 0x23, 0xce, 0x32, 0xe1, 0x4e, 0xec, 0xb5, 0x64, 0xe9};
  uint8_t bytesprops11[] = {0x6e, 0xdb, 0x53, 0x90, 0x86, 0xb5, 0xdf, 0x91, 0xb8, 0xc1, 0x58, 0xf5, 0xc1, 0xe7, 0xba,
                            0x33, 0x6b, 0x9f, 0xbc, 0xda, 0xfc, 0x1a, 0xdd, 0xf4, 0x7a, 0x62, 0x4e, 0x74, 0x33};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28798}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31640}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9138}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops5}, .v = {17, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4096}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26707}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8438}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops9}, .v = {8, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\252\190\&8\149\&2\128\192{C\128\194\197\170g\a_\DC4\DELI(\151\218\172\vBJ\234\221", _pubPktID = 0, _pubBody =
// "q\145\203\144\245\153\&3\220g\186\&9YVh\DEL\232\&2V\212\201\&4\172?\189S\159<\187W", _pubProps =
// [PropWildcardSubscriptionAvailable 68,PropReasonString "\231\STX\217\206C\164",PropServerKeepAlive
// 28798,PropAuthenticationData "\202\ETX1\130\NUL\184r\147\SYN\162\182)\226\v!m",PropRequestResponseInformation
// 255,PropContentType "\RS\STX\200B\190",PropResponseTopic "\218{",PropTopicAlias
// 31640,PropSubscriptionIdentifierAvailable 99,PropServerKeepAlive 9138,PropAuthenticationMethod
// "\240'\176\DC2=\ENQ\247H\176`\247\SOH\151Dj\220\GS4\132",PropUserProperty
// "`\157;)\RS\168\170G\SI\131\204z\251\SO#-\221tq\224"
// "DQ\194\246\165\220\230\217\222\SUB\160E\213P\"\156\211",PropWillDelayInterval 4096,PropRequestResponseInformation
// 25,PropReceiveMaximum 26707,PropAssignedClientIdentifier "e]\166a",PropAuthenticationMethod
// "\236\135\179\164I\DLEm\GS\189\155inmB",PropMessageExpiryInterval 8438,PropSharedSubscriptionAvailable
// 26,PropSubscriptionIdentifierAvailable 221,PropUserProperty "Q&z\242\130#\206\&2\225N\236\181d\233"
// "\182/^\246\211CZ\255",PropContentType
// "n\219S\144\134\181\223\145\184\193X\245\193\231\186\&3k\159\188\218\252\SUB\221\244zbNt3"]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {0x39, 0x9b, 0x2,  0x0,  0x1c, 0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5,
                   0xaa, 0x67, 0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd, 0xde,
                   0x1,  0x28, 0x44, 0x1f, 0x0,  0x6,  0xe7, 0x2,  0xd9, 0xce, 0x43, 0xa4, 0x13, 0x70, 0x7e, 0x16, 0x0,
                   0x10, 0xca, 0x3,  0x31, 0x82, 0x0,  0xb8, 0x72, 0x93, 0x16, 0xa2, 0xb6, 0x29, 0xe2, 0xb,  0x21, 0x6d,
                   0x19, 0xff, 0x3,  0x0,  0x5,  0x1e, 0x2,  0xc8, 0x42, 0xbe, 0x8,  0x0,  0x2,  0xda, 0x7b, 0x23, 0x7b,
                   0x98, 0x29, 0x63, 0x13, 0x23, 0xb2, 0x15, 0x0,  0x13, 0xf0, 0x27, 0xb0, 0x12, 0x3d, 0x5,  0xf7, 0x48,
                   0xb0, 0x60, 0xf7, 0x1,  0x97, 0x44, 0x6a, 0xdc, 0x1d, 0x34, 0x84, 0x26, 0x0,  0x14, 0x60, 0x9d, 0x3b,
                   0x29, 0x1e, 0xa8, 0xaa, 0x47, 0xf,  0x83, 0xcc, 0x7a, 0xfb, 0xe,  0x23, 0x2d, 0xdd, 0x74, 0x71, 0xe0,
                   0x0,  0x11, 0x44, 0x51, 0xc2, 0xf6, 0xa5, 0xdc, 0xe6, 0xd9, 0xde, 0x1a, 0xa0, 0x45, 0xd5, 0x50, 0x22,
                   0x9c, 0xd3, 0x18, 0x0,  0x0,  0x10, 0x0,  0x19, 0x19, 0x21, 0x68, 0x53, 0x12, 0x0,  0x4,  0x65, 0x5d,
                   0xa6, 0x61, 0x15, 0x0,  0xe,  0xec, 0x87, 0xb3, 0xa4, 0x49, 0x10, 0x6d, 0x1d, 0xbd, 0x9b, 0x69, 0x6e,
                   0x6d, 0x42, 0x2,  0x0,  0x0,  0x20, 0xf6, 0x2a, 0x1a, 0x29, 0xdd, 0x26, 0x0,  0xe,  0x51, 0x26, 0x7a,
                   0xf2, 0x82, 0x23, 0xce, 0x32, 0xe1, 0x4e, 0xec, 0xb5, 0x64, 0xe9, 0x0,  0x8,  0xb6, 0x2f, 0x5e, 0xf6,
                   0xd3, 0x43, 0x5a, 0xff, 0x3,  0x0,  0x1d, 0x6e, 0xdb, 0x53, 0x90, 0x86, 0xb5, 0xdf, 0x91, 0xb8, 0xc1,
                   0x58, 0xf5, 0xc1, 0xe7, 0xba, 0x33, 0x6b, 0x9f, 0xbc, 0xda, 0xfc, 0x1a, 0xdd, 0xf4, 0x7a, 0x62, 0x4e,
                   0x74, 0x33, 0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f,
                   0xe8, 0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfc, 0xbe, 0x38, 0x95, 0x32, 0x80, 0xc0, 0x7b, 0x43, 0x80, 0xc2, 0xc5, 0xaa, 0x67,
                               0x7,  0x5f, 0x14, 0x7f, 0x49, 0x28, 0x97, 0xda, 0xac, 0xb,  0x42, 0x4a, 0xea, 0xdd};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x71, 0x91, 0xcb, 0x90, 0xf5, 0x99, 0x33, 0xdc, 0x67, 0xba, 0x39, 0x59, 0x56, 0x68, 0x7f,
                              0xe8, 0x32, 0x56, 0xd4, 0xc9, 0x34, 0xac, 0x3f, 0xbd, 0x53, 0x9f, 0x3c, 0xbb, 0x57};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\a\159\222j\236\175\242\&158\148@P\139o\150c\EOT\191\131\204\SUB\205\201\135W\193a", _pubPktID = 24983, _pubBody =
// "\214M\130;K\239#\136V\STX\242C\n\153\208l\129s\196\171\DC1P\193\218\128", _pubProps = [PropMaximumPacketSize
// 32111,PropRetainAvailable 32,PropRetainAvailable 253,PropTopicAliasMaximum 1404,PropCorrelationData
// "x\249\211d\150\172<\EM\159*\CAN\172\\\145\178\202jA",PropWillDelayInterval 999,PropTopicAliasMaximum
// 3052,PropResponseInformation "\244\153\172\&7\n\136=_\169\156S2\183\143\167S\185\220O\133\144\252\&4\230\180W\202"]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x35, 0x81, 0x1,  0x0,  0x1c, 0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94, 0x40,
                   0x50, 0x8b, 0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57, 0xc1, 0x61, 0x61,
                   0x97, 0x47, 0x27, 0x0,  0x0,  0x7d, 0x6f, 0x25, 0x20, 0x25, 0xfd, 0x22, 0x5,  0x7c, 0x9,  0x0,  0x12,
                   0x78, 0xf9, 0xd3, 0x64, 0x96, 0xac, 0x3c, 0x19, 0x9f, 0x2a, 0x18, 0xac, 0x5c, 0x91, 0xb2, 0xca, 0x6a,
                   0x41, 0x18, 0x0,  0x0,  0x3,  0xe7, 0x22, 0xb,  0xec, 0x1a, 0x0,  0x1b, 0xf4, 0x99, 0xac, 0x37, 0xa,
                   0x88, 0x3d, 0x5f, 0xa9, 0x9c, 0x53, 0x32, 0xb7, 0x8f, 0xa7, 0x53, 0xb9, 0xdc, 0x4f, 0x85, 0x90, 0xfc,
                   0x34, 0xe6, 0xb4, 0x57, 0xca, 0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2, 0x43,
                   0xa,  0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  uint8_t topic_bytes[] = {0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94, 0x40, 0x50, 0x8b,
                           0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57, 0xc1, 0x61};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2, 0x43, 0xa,
                         0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytesprops0[] = {0x78, 0xf9, 0xd3, 0x64, 0x96, 0xac, 0x3c, 0x19, 0x9f,
                           0x2a, 0x18, 0xac, 0x5c, 0x91, 0xb2, 0xca, 0x6a, 0x41};
  uint8_t bytesprops1[] = {0xf4, 0x99, 0xac, 0x37, 0xa,  0x88, 0x3d, 0x5f, 0xa9, 0x9c, 0x53, 0x32, 0xb7, 0x8f,
                           0xa7, 0x53, 0xb9, 0xdc, 0x4f, 0x85, 0x90, 0xfc, 0x34, 0xe6, 0xb4, 0x57, 0xca};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32111}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1404}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 999}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3052}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 24983, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\a\159\222j\236\175\242\&158\148@P\139o\150c\EOT\191\131\204\SUB\205\201\135W\193a", _pubPktID = 24983, _pubBody =
// "\214M\130;K\239#\136V\STX\242C\n\153\208l\129s\196\171\DC1P\193\218\128", _pubProps = [PropMaximumPacketSize
// 32111,PropRetainAvailable 32,PropRetainAvailable 253,PropTopicAliasMaximum 1404,PropCorrelationData
// "x\249\211d\150\172<\EM\159*\CAN\172\\\145\178\202jA",PropWillDelayInterval 999,PropTopicAliasMaximum
// 3052,PropResponseInformation "\244\153\172\&7\n\136=_\169\156S2\183\143\167S\185\220O\133\144\252\&4\230\180W\202"]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {0x35, 0x81, 0x1,  0x0,  0x1c, 0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94, 0x40,
                   0x50, 0x8b, 0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57, 0xc1, 0x61, 0x61,
                   0x97, 0x47, 0x27, 0x0,  0x0,  0x7d, 0x6f, 0x25, 0x20, 0x25, 0xfd, 0x22, 0x5,  0x7c, 0x9,  0x0,  0x12,
                   0x78, 0xf9, 0xd3, 0x64, 0x96, 0xac, 0x3c, 0x19, 0x9f, 0x2a, 0x18, 0xac, 0x5c, 0x91, 0xb2, 0xca, 0x6a,
                   0x41, 0x18, 0x0,  0x0,  0x3,  0xe7, 0x22, 0xb,  0xec, 0x1a, 0x0,  0x1b, 0xf4, 0x99, 0xac, 0x37, 0xa,
                   0x88, 0x3d, 0x5f, 0xa9, 0x9c, 0x53, 0x32, 0xb7, 0x8f, 0xa7, 0x53, 0xb9, 0xdc, 0x4f, 0x85, 0x90, 0xfc,
                   0x34, 0xe6, 0xb4, 0x57, 0xca, 0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2, 0x43,
                   0xa,  0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7,  0x9f, 0xde, 0x6a, 0xec, 0xaf, 0xf2, 0x31, 0x35, 0x38, 0x94, 0x40, 0x50, 0x8b,
                               0x6f, 0x96, 0x63, 0x4,  0xbf, 0x83, 0xcc, 0x1a, 0xcd, 0xc9, 0x87, 0x57, 0xc1, 0x61};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd6, 0x4d, 0x82, 0x3b, 0x4b, 0xef, 0x23, 0x88, 0x56, 0x2,  0xf2, 0x43, 0xa,
                              0x99, 0xd0, 0x6c, 0x81, 0x73, 0xc4, 0xab, 0x11, 0x50, 0xc1, 0xda, 0x80};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 24983);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "[5,\230\144\137\236\202\179\STX\t\201\234\136\166", _pubPktID = 10487, _pubBody =
// "\DLE\ACK\165~\155\217?\249\195\GS\145\179=i'\223Wd\159\248<\223$", _pubProps = [PropRequestProblemInformation
// 2,PropMessageExpiryInterval 7090,PropReceiveMaximum 29985,PropAssignedClientIdentifier
// "\160C\a\133\158\SIJ\234\136\148+\213\192\173\145\229\SYN\DC3\207",PropMaximumPacketSize
// 1098,PropSubscriptionIdentifier 14,PropCorrelationData
// "\134\FS\151\177\150V\134V6K\226\159\253\151|\130",PropResponseInformation
// "Xy\206_\178c\154\197\a\227<\169\NAK\CAN\178\ETX",PropMessageExpiryInterval 11931,PropTopicAlias 6873]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x34, 0x80, 0x1,  0x0,  0xf,  0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2,  0x9,  0xc9,
                   0xea, 0x88, 0xa6, 0x28, 0xf7, 0x55, 0x17, 0x2,  0x2,  0x0,  0x0,  0x1b, 0xb2, 0x21, 0x75, 0x21, 0x12,
                   0x0,  0x13, 0xa0, 0x43, 0x7,  0x85, 0x9e, 0xf,  0x4a, 0xea, 0x88, 0x94, 0x2b, 0xd5, 0xc0, 0xad, 0x91,
                   0xe5, 0x16, 0x13, 0xcf, 0x27, 0x0,  0x0,  0x4,  0x4a, 0xb,  0xe,  0x9,  0x0,  0x10, 0x86, 0x1c, 0x97,
                   0xb1, 0x96, 0x56, 0x86, 0x56, 0x36, 0x4b, 0xe2, 0x9f, 0xfd, 0x97, 0x7c, 0x82, 0x1a, 0x0,  0x10, 0x58,
                   0x79, 0xce, 0x5f, 0xb2, 0x63, 0x9a, 0xc5, 0x7,  0xe3, 0x3c, 0xa9, 0x15, 0x18, 0xb2, 0x3,  0x2,  0x0,
                   0x0,  0x2e, 0x9b, 0x23, 0x1a, 0xd9, 0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3, 0x1d, 0x91,
                   0xb3, 0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  uint8_t topic_bytes[] = {0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2, 0x9, 0xc9, 0xea, 0x88, 0xa6};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3, 0x1d, 0x91, 0xb3,
                         0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0xa0, 0x43, 0x7,  0x85, 0x9e, 0xf,  0x4a, 0xea, 0x88, 0x94,
                           0x2b, 0xd5, 0xc0, 0xad, 0x91, 0xe5, 0x16, 0x13, 0xcf};
  uint8_t bytesprops1[] = {0x86, 0x1c, 0x97, 0xb1, 0x96, 0x56, 0x86, 0x56,
                           0x36, 0x4b, 0xe2, 0x9f, 0xfd, 0x97, 0x7c, 0x82};
  uint8_t bytesprops2[] = {0x58, 0x79, 0xce, 0x5f, 0xb2, 0x63, 0x9a, 0xc5,
                           0x7,  0xe3, 0x3c, 0xa9, 0x15, 0x18, 0xb2, 0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7090}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29985}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1098}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11931}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6873}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 10487, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "[5,\230\144\137\236\202\179\STX\t\201\234\136\166", _pubPktID = 10487, _pubBody =
// "\DLE\ACK\165~\155\217?\249\195\GS\145\179=i'\223Wd\159\248<\223$", _pubProps = [PropRequestProblemInformation
// 2,PropMessageExpiryInterval 7090,PropReceiveMaximum 29985,PropAssignedClientIdentifier
// "\160C\a\133\158\SIJ\234\136\148+\213\192\173\145\229\SYN\DC3\207",PropMaximumPacketSize
// 1098,PropSubscriptionIdentifier 14,PropCorrelationData
// "\134\FS\151\177\150V\134V6K\226\159\253\151|\130",PropResponseInformation
// "Xy\206_\178c\154\197\a\227<\169\NAK\CAN\178\ETX",PropMessageExpiryInterval 11931,PropTopicAlias 6873]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {0x34, 0x80, 0x1,  0x0,  0xf,  0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2,  0x9,  0xc9,
                   0xea, 0x88, 0xa6, 0x28, 0xf7, 0x55, 0x17, 0x2,  0x2,  0x0,  0x0,  0x1b, 0xb2, 0x21, 0x75, 0x21, 0x12,
                   0x0,  0x13, 0xa0, 0x43, 0x7,  0x85, 0x9e, 0xf,  0x4a, 0xea, 0x88, 0x94, 0x2b, 0xd5, 0xc0, 0xad, 0x91,
                   0xe5, 0x16, 0x13, 0xcf, 0x27, 0x0,  0x0,  0x4,  0x4a, 0xb,  0xe,  0x9,  0x0,  0x10, 0x86, 0x1c, 0x97,
                   0xb1, 0x96, 0x56, 0x86, 0x56, 0x36, 0x4b, 0xe2, 0x9f, 0xfd, 0x97, 0x7c, 0x82, 0x1a, 0x0,  0x10, 0x58,
                   0x79, 0xce, 0x5f, 0xb2, 0x63, 0x9a, 0xc5, 0x7,  0xe3, 0x3c, 0xa9, 0x15, 0x18, 0xb2, 0x3,  0x2,  0x0,
                   0x0,  0x2e, 0x9b, 0x23, 0x1a, 0xd9, 0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3, 0x1d, 0x91,
                   0xb3, 0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b, 0x35, 0x2c, 0xe6, 0x90, 0x89, 0xec, 0xca, 0xb3, 0x2, 0x9, 0xc9, 0xea, 0x88, 0xa6};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x10, 0x6,  0xa5, 0x7e, 0x9b, 0xd9, 0x3f, 0xf9, 0xc3, 0x1d, 0x91, 0xb3,
                              0x3d, 0x69, 0x27, 0xdf, 0x57, 0x64, 0x9f, 0xf8, 0x3c, 0xdf, 0x24};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10487);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "n\145", _pubPktID = 14089, _pubBody
// = "\210\210>L\150\rD\161j\204SG\219\226\165\205k\208\&4\ENQ\154t\DC1\148D:\US<\141\149", _pubProps =
// [PropPayloadFormatIndicator 11,PropAssignedClientIdentifier "\165\GSO\DELW\209\USY^",PropRequestResponseInformation
// 199,PropSubscriptionIdentifier 7,PropAssignedClientIdentifier "\233e\ACK\242\245\135\207\178\189",PropReasonString
// "\159+\203\173\DC3\r\216\165\200\SOH\226$h\171U\179=\189Pq%\211\188x\238\176\169a\201\DC3",PropResponseTopic
// "\ETX\231w+ \ETX\128\252W-\164\228FQ\198\231\140\149\128\US",PropWildcardSubscriptionAvailable
// 86,PropPayloadFormatIndicator 11,PropSubscriptionIdentifierAvailable 130,PropMessageExpiryInterval
// 14783,PropSubscriptionIdentifierAvailable 113,PropRetainAvailable 223,PropResponseInformation
// "\130\SYN2\226\210\n\165\220\STX\175\235j\STX\US",PropRequestProblemInformation 97,PropCorrelationData
// "t\237j\DLE6\227\210\EM\STX\NUL]\FS\215\FS\202w\250N\CAN\217\199\192+",PropReasonString
// "\176\vb\216s\FS\175cQIq6t\183#\170\149\149\218o"]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {0x35, 0xcf, 0x1,  0x0,  0x2,  0x6e, 0x91, 0x37, 0x9,  0xa9, 0x1,  0x1,  0xb,  0x12, 0x0,  0x9,  0xa5,
                   0x1d, 0x4f, 0x7f, 0x57, 0xd1, 0x1f, 0x59, 0x5e, 0x19, 0xc7, 0xb,  0x7,  0x12, 0x0,  0x9,  0xe9, 0x65,
                   0x6,  0xf2, 0xf5, 0x87, 0xcf, 0xb2, 0xbd, 0x1f, 0x0,  0x1e, 0x9f, 0x2b, 0xcb, 0xad, 0x13, 0xd,  0xd8,
                   0xa5, 0xc8, 0x1,  0xe2, 0x24, 0x68, 0xab, 0x55, 0xb3, 0x3d, 0xbd, 0x50, 0x71, 0x25, 0xd3, 0xbc, 0x78,
                   0xee, 0xb0, 0xa9, 0x61, 0xc9, 0x13, 0x8,  0x0,  0x14, 0x3,  0xe7, 0x77, 0x2b, 0x20, 0x3,  0x80, 0xfc,
                   0x57, 0x2d, 0xa4, 0xe4, 0x46, 0x51, 0xc6, 0xe7, 0x8c, 0x95, 0x80, 0x1f, 0x28, 0x56, 0x1,  0xb,  0x29,
                   0x82, 0x2,  0x0,  0x0,  0x39, 0xbf, 0x29, 0x71, 0x25, 0xdf, 0x1a, 0x0,  0xe,  0x82, 0x16, 0x32, 0xe2,
                   0xd2, 0xa,  0xa5, 0xdc, 0x2,  0xaf, 0xeb, 0x6a, 0x2,  0x1f, 0x17, 0x61, 0x9,  0x0,  0x17, 0x74, 0xed,
                   0x6a, 0x10, 0x36, 0xe3, 0xd2, 0x19, 0x2,  0x0,  0x5d, 0x1c, 0xd7, 0x1c, 0xca, 0x77, 0xfa, 0x4e, 0x18,
                   0xd9, 0xc7, 0xc0, 0x2b, 0x1f, 0x0,  0x14, 0xb0, 0xb,  0x62, 0xd8, 0x73, 0x1c, 0xaf, 0x63, 0x51, 0x49,
                   0x71, 0x36, 0x74, 0xb7, 0x23, 0xaa, 0x95, 0x95, 0xda, 0x6f, 0xd2, 0xd2, 0x3e, 0x4c, 0x96, 0xd,  0x44,
                   0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5, 0xcd, 0x6b, 0xd0, 0x34, 0x5,  0x9a, 0x74, 0x11, 0x94,
                   0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  uint8_t topic_bytes[] = {0x6e, 0x91};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd2, 0xd2, 0x3e, 0x4c, 0x96, 0xd,  0x44, 0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5,
                         0xcd, 0x6b, 0xd0, 0x34, 0x5,  0x9a, 0x74, 0x11, 0x94, 0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xa5, 0x1d, 0x4f, 0x7f, 0x57, 0xd1, 0x1f, 0x59, 0x5e};
  uint8_t bytesprops1[] = {0xe9, 0x65, 0x6, 0xf2, 0xf5, 0x87, 0xcf, 0xb2, 0xbd};
  uint8_t bytesprops2[] = {0x9f, 0x2b, 0xcb, 0xad, 0x13, 0xd,  0xd8, 0xa5, 0xc8, 0x1,  0xe2, 0x24, 0x68, 0xab, 0x55,
                           0xb3, 0x3d, 0xbd, 0x50, 0x71, 0x25, 0xd3, 0xbc, 0x78, 0xee, 0xb0, 0xa9, 0x61, 0xc9, 0x13};
  uint8_t bytesprops3[] = {0x3,  0xe7, 0x77, 0x2b, 0x20, 0x3,  0x80, 0xfc, 0x57, 0x2d,
                           0xa4, 0xe4, 0x46, 0x51, 0xc6, 0xe7, 0x8c, 0x95, 0x80, 0x1f};
  uint8_t bytesprops4[] = {0x82, 0x16, 0x32, 0xe2, 0xd2, 0xa, 0xa5, 0xdc, 0x2, 0xaf, 0xeb, 0x6a, 0x2, 0x1f};
  uint8_t bytesprops5[] = {0x74, 0xed, 0x6a, 0x10, 0x36, 0xe3, 0xd2, 0x19, 0x2,  0x0,  0x5d, 0x1c,
                           0xd7, 0x1c, 0xca, 0x77, 0xfa, 0x4e, 0x18, 0xd9, 0xc7, 0xc0, 0x2b};
  uint8_t bytesprops6[] = {0xb0, 0xb,  0x62, 0xd8, 0x73, 0x1c, 0xaf, 0x63, 0x51, 0x49,
                           0x71, 0x36, 0x74, 0xb7, 0x23, 0xaa, 0x95, 0x95, 0xda, 0x6f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14783}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 14089, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "n\145", _pubPktID = 14089, _pubBody
// = "\210\210>L\150\rD\161j\204SG\219\226\165\205k\208\&4\ENQ\154t\DC1\148D:\US<\141\149", _pubProps =
// [PropPayloadFormatIndicator 11,PropAssignedClientIdentifier "\165\GSO\DELW\209\USY^",PropRequestResponseInformation
// 199,PropSubscriptionIdentifier 7,PropAssignedClientIdentifier "\233e\ACK\242\245\135\207\178\189",PropReasonString
// "\159+\203\173\DC3\r\216\165\200\SOH\226$h\171U\179=\189Pq%\211\188x\238\176\169a\201\DC3",PropResponseTopic
// "\ETX\231w+ \ETX\128\252W-\164\228FQ\198\231\140\149\128\US",PropWildcardSubscriptionAvailable
// 86,PropPayloadFormatIndicator 11,PropSubscriptionIdentifierAvailable 130,PropMessageExpiryInterval
// 14783,PropSubscriptionIdentifierAvailable 113,PropRetainAvailable 223,PropResponseInformation
// "\130\SYN2\226\210\n\165\220\STX\175\235j\STX\US",PropRequestProblemInformation 97,PropCorrelationData
// "t\237j\DLE6\227\210\EM\STX\NUL]\FS\215\FS\202w\250N\CAN\217\199\192+",PropReasonString
// "\176\vb\216s\FS\175cQIq6t\183#\170\149\149\218o"]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {0x35, 0xcf, 0x1,  0x0,  0x2,  0x6e, 0x91, 0x37, 0x9,  0xa9, 0x1,  0x1,  0xb,  0x12, 0x0,  0x9,  0xa5,
                   0x1d, 0x4f, 0x7f, 0x57, 0xd1, 0x1f, 0x59, 0x5e, 0x19, 0xc7, 0xb,  0x7,  0x12, 0x0,  0x9,  0xe9, 0x65,
                   0x6,  0xf2, 0xf5, 0x87, 0xcf, 0xb2, 0xbd, 0x1f, 0x0,  0x1e, 0x9f, 0x2b, 0xcb, 0xad, 0x13, 0xd,  0xd8,
                   0xa5, 0xc8, 0x1,  0xe2, 0x24, 0x68, 0xab, 0x55, 0xb3, 0x3d, 0xbd, 0x50, 0x71, 0x25, 0xd3, 0xbc, 0x78,
                   0xee, 0xb0, 0xa9, 0x61, 0xc9, 0x13, 0x8,  0x0,  0x14, 0x3,  0xe7, 0x77, 0x2b, 0x20, 0x3,  0x80, 0xfc,
                   0x57, 0x2d, 0xa4, 0xe4, 0x46, 0x51, 0xc6, 0xe7, 0x8c, 0x95, 0x80, 0x1f, 0x28, 0x56, 0x1,  0xb,  0x29,
                   0x82, 0x2,  0x0,  0x0,  0x39, 0xbf, 0x29, 0x71, 0x25, 0xdf, 0x1a, 0x0,  0xe,  0x82, 0x16, 0x32, 0xe2,
                   0xd2, 0xa,  0xa5, 0xdc, 0x2,  0xaf, 0xeb, 0x6a, 0x2,  0x1f, 0x17, 0x61, 0x9,  0x0,  0x17, 0x74, 0xed,
                   0x6a, 0x10, 0x36, 0xe3, 0xd2, 0x19, 0x2,  0x0,  0x5d, 0x1c, 0xd7, 0x1c, 0xca, 0x77, 0xfa, 0x4e, 0x18,
                   0xd9, 0xc7, 0xc0, 0x2b, 0x1f, 0x0,  0x14, 0xb0, 0xb,  0x62, 0xd8, 0x73, 0x1c, 0xaf, 0x63, 0x51, 0x49,
                   0x71, 0x36, 0x74, 0xb7, 0x23, 0xaa, 0x95, 0x95, 0xda, 0x6f, 0xd2, 0xd2, 0x3e, 0x4c, 0x96, 0xd,  0x44,
                   0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5, 0xcd, 0x6b, 0xd0, 0x34, 0x5,  0x9a, 0x74, 0x11, 0x94,
                   0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6e, 0x91};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd2, 0xd2, 0x3e, 0x4c, 0x96, 0xd,  0x44, 0xa1, 0x6a, 0xcc, 0x53, 0x47, 0xdb, 0xe2, 0xa5,
                              0xcd, 0x6b, 0xd0, 0x34, 0x5,  0x9a, 0x74, 0x11, 0x94, 0x44, 0x3a, 0x1f, 0x3c, 0x8d, 0x95};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14089);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\199d\158\162p\SYNZ2{\228j\t\233'\211K\254\FSK\133%\252", _pubPktID = 0, _pubBody = "\SYN\ESC\r\233\&1\216\237",
// _pubProps = [PropMaximumPacketSize 22909,PropUserProperty "\213;\180\149"
// "\142\f\137prd\141\&6\DC4\237\252G\248Ot\200\SUB;5\204",PropWillDelayInterval
// 4294,PropSubscriptionIdentifierAvailable 78,PropRetainAvailable 105,PropServerKeepAlive 18960,PropTopicAlias
// 32368,PropWildcardSubscriptionAvailable 111,PropAuthenticationData
// "\135\147Z\181\250\224\250\DC1E\ETB?B\229TNp{\140\&2\220R\STX*\177f\251",PropContentType
// "!<DB\184\213\206\n\RS\166\ESC\172g\SOH",PropReasonString "\208V{\vdI--",PropWillDelayInterval 11843,PropMaximumQoS
// 55,PropWildcardSubscriptionAvailable 187,PropSubscriptionIdentifierAvailable 253,PropServerReference
// "\242[\135\172l\209\&4\234\140\155t'S",PropResponseTopic
// "\NAK3\254\171`\rG\191\207K\216\161\&0\185\199\226jv\235g",PropAuthenticationMethod
// "Q\194aC\192\200\NAK\156\135\224\159\DC2\215\184V",PropResponseTopic "pO\164\DC4\186\193",PropAuthenticationData
// "\154\232\155\164\176\170\NAK0\STX2\237\245\190B\163\NAK%p7@\DEL\184",PropContentType "\156\DC4",PropUserProperty
// "6\ETB@+0\NAKo9\152"
// "\152\186c\FS\215\224MkL\225o\176\145\171\243S\128]\143\178Jo(\250",PropSharedSubscriptionAvailable
// 130,PropRequestResponseInformation 63,PropContentType "\\\167\DC3\DC3\SO/\180\139\200e\141\184\DC1\163"]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x38, 0xb3, 0x2,  0x0,  0x16, 0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a, 0x9,  0xe9, 0x27,
      0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc, 0x92, 0x2,  0x27, 0x0,  0x0,  0x59, 0x7d, 0x26, 0x0,  0x4,  0xd5,
      0x3b, 0xb4, 0x95, 0x0,  0x14, 0x8e, 0xc,  0x89, 0x70, 0x72, 0x64, 0x8d, 0x36, 0x14, 0xed, 0xfc, 0x47, 0xf8, 0x4f,
      0x74, 0xc8, 0x1a, 0x3b, 0x35, 0xcc, 0x18, 0x0,  0x0,  0x10, 0xc6, 0x29, 0x4e, 0x25, 0x69, 0x13, 0x4a, 0x10, 0x23,
      0x7e, 0x70, 0x28, 0x6f, 0x16, 0x0,  0x1a, 0x87, 0x93, 0x5a, 0xb5, 0xfa, 0xe0, 0xfa, 0x11, 0x45, 0x17, 0x3f, 0x42,
      0xe5, 0x54, 0x4e, 0x70, 0x7b, 0x8c, 0x32, 0xdc, 0x52, 0x2,  0x2a, 0xb1, 0x66, 0xfb, 0x3,  0x0,  0xe,  0x21, 0x3c,
      0x44, 0x42, 0xb8, 0xd5, 0xce, 0xa,  0x1e, 0xa6, 0x1b, 0xac, 0x67, 0x1,  0x1f, 0x0,  0x8,  0xd0, 0x56, 0x7b, 0xb,
      0x64, 0x49, 0x2d, 0x2d, 0x18, 0x0,  0x0,  0x2e, 0x43, 0x24, 0x37, 0x28, 0xbb, 0x29, 0xfd, 0x1c, 0x0,  0xd,  0xf2,
      0x5b, 0x87, 0xac, 0x6c, 0xd1, 0x34, 0xea, 0x8c, 0x9b, 0x74, 0x27, 0x53, 0x8,  0x0,  0x14, 0x15, 0x33, 0xfe, 0xab,
      0x60, 0xd,  0x47, 0xbf, 0xcf, 0x4b, 0xd8, 0xa1, 0x30, 0xb9, 0xc7, 0xe2, 0x6a, 0x76, 0xeb, 0x67, 0x15, 0x0,  0xf,
      0x51, 0xc2, 0x61, 0x43, 0xc0, 0xc8, 0x15, 0x9c, 0x87, 0xe0, 0x9f, 0x12, 0xd7, 0xb8, 0x56, 0x8,  0x0,  0x6,  0x70,
      0x4f, 0xa4, 0x14, 0xba, 0xc1, 0x16, 0x0,  0x16, 0x9a, 0xe8, 0x9b, 0xa4, 0xb0, 0xaa, 0x15, 0x30, 0x2,  0x32, 0xed,
      0xf5, 0xbe, 0x42, 0xa3, 0x15, 0x25, 0x70, 0x37, 0x40, 0x7f, 0xb8, 0x3,  0x0,  0x2,  0x9c, 0x14, 0x26, 0x0,  0x9,
      0x36, 0x17, 0x40, 0x2b, 0x30, 0x15, 0x6f, 0x39, 0x98, 0x0,  0x18, 0x98, 0xba, 0x63, 0x1c, 0xd7, 0xe0, 0x4d, 0x6b,
      0x4c, 0xe1, 0x6f, 0xb0, 0x91, 0xab, 0xf3, 0x53, 0x80, 0x5d, 0x8f, 0xb2, 0x4a, 0x6f, 0x28, 0xfa, 0x2a, 0x82, 0x19,
      0x3f, 0x3,  0x0,  0xe,  0x5c, 0xa7, 0x13, 0x13, 0xe,  0x2f, 0xb4, 0x8b, 0xc8, 0x65, 0x8d, 0xb8, 0x11, 0xa3, 0x16,
      0x1b, 0xd,  0xe9, 0x31, 0xd8, 0xed};
  uint8_t topic_bytes[] = {0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a,
                           0x9,  0xe9, 0x27, 0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x16, 0x1b, 0xd, 0xe9, 0x31, 0xd8, 0xed};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops1[] = {0x8e, 0xc,  0x89, 0x70, 0x72, 0x64, 0x8d, 0x36, 0x14, 0xed,
                           0xfc, 0x47, 0xf8, 0x4f, 0x74, 0xc8, 0x1a, 0x3b, 0x35, 0xcc};
  uint8_t bytesprops0[] = {0xd5, 0x3b, 0xb4, 0x95};
  uint8_t bytesprops2[] = {0x87, 0x93, 0x5a, 0xb5, 0xfa, 0xe0, 0xfa, 0x11, 0x45, 0x17, 0x3f, 0x42, 0xe5,
                           0x54, 0x4e, 0x70, 0x7b, 0x8c, 0x32, 0xdc, 0x52, 0x2,  0x2a, 0xb1, 0x66, 0xfb};
  uint8_t bytesprops3[] = {0x21, 0x3c, 0x44, 0x42, 0xb8, 0xd5, 0xce, 0xa, 0x1e, 0xa6, 0x1b, 0xac, 0x67, 0x1};
  uint8_t bytesprops4[] = {0xd0, 0x56, 0x7b, 0xb, 0x64, 0x49, 0x2d, 0x2d};
  uint8_t bytesprops5[] = {0xf2, 0x5b, 0x87, 0xac, 0x6c, 0xd1, 0x34, 0xea, 0x8c, 0x9b, 0x74, 0x27, 0x53};
  uint8_t bytesprops6[] = {0x15, 0x33, 0xfe, 0xab, 0x60, 0xd,  0x47, 0xbf, 0xcf, 0x4b,
                           0xd8, 0xa1, 0x30, 0xb9, 0xc7, 0xe2, 0x6a, 0x76, 0xeb, 0x67};
  uint8_t bytesprops7[] = {0x51, 0xc2, 0x61, 0x43, 0xc0, 0xc8, 0x15, 0x9c, 0x87, 0xe0, 0x9f, 0x12, 0xd7, 0xb8, 0x56};
  uint8_t bytesprops8[] = {0x70, 0x4f, 0xa4, 0x14, 0xba, 0xc1};
  uint8_t bytesprops9[] = {0x9a, 0xe8, 0x9b, 0xa4, 0xb0, 0xaa, 0x15, 0x30, 0x2,  0x32, 0xed,
                           0xf5, 0xbe, 0x42, 0xa3, 0x15, 0x25, 0x70, 0x37, 0x40, 0x7f, 0xb8};
  uint8_t bytesprops10[] = {0x9c, 0x14};
  uint8_t bytesprops12[] = {0x98, 0xba, 0x63, 0x1c, 0xd7, 0xe0, 0x4d, 0x6b, 0x4c, 0xe1, 0x6f, 0xb0,
                            0x91, 0xab, 0xf3, 0x53, 0x80, 0x5d, 0x8f, 0xb2, 0x4a, 0x6f, 0x28, 0xfa};
  uint8_t bytesprops11[] = {0x36, 0x17, 0x40, 0x2b, 0x30, 0x15, 0x6f, 0x39, 0x98};
  uint8_t bytesprops13[] = {0x5c, 0xa7, 0x13, 0x13, 0xe, 0x2f, 0xb4, 0x8b, 0xc8, 0x65, 0x8d, 0xb8, 0x11, 0xa3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22909}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4294}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18960}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32368}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11843}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops11}, .v = {24, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\199d\158\162p\SYNZ2{\228j\t\233'\211K\254\FSK\133%\252", _pubPktID = 0, _pubBody = "\SYN\ESC\r\233\&1\216\237",
// _pubProps = [PropMaximumPacketSize 22909,PropUserProperty "\213;\180\149"
// "\142\f\137prd\141\&6\DC4\237\252G\248Ot\200\SUB;5\204",PropWillDelayInterval
// 4294,PropSubscriptionIdentifierAvailable 78,PropRetainAvailable 105,PropServerKeepAlive 18960,PropTopicAlias
// 32368,PropWildcardSubscriptionAvailable 111,PropAuthenticationData
// "\135\147Z\181\250\224\250\DC1E\ETB?B\229TNp{\140\&2\220R\STX*\177f\251",PropContentType
// "!<DB\184\213\206\n\RS\166\ESC\172g\SOH",PropReasonString "\208V{\vdI--",PropWillDelayInterval 11843,PropMaximumQoS
// 55,PropWildcardSubscriptionAvailable 187,PropSubscriptionIdentifierAvailable 253,PropServerReference
// "\242[\135\172l\209\&4\234\140\155t'S",PropResponseTopic
// "\NAK3\254\171`\rG\191\207K\216\161\&0\185\199\226jv\235g",PropAuthenticationMethod
// "Q\194aC\192\200\NAK\156\135\224\159\DC2\215\184V",PropResponseTopic "pO\164\DC4\186\193",PropAuthenticationData
// "\154\232\155\164\176\170\NAK0\STX2\237\245\190B\163\NAK%p7@\DEL\184",PropContentType "\156\DC4",PropUserProperty
// "6\ETB@+0\NAKo9\152"
// "\152\186c\FS\215\224MkL\225o\176\145\171\243S\128]\143\178Jo(\250",PropSharedSubscriptionAvailable
// 130,PropRequestResponseInformation 63,PropContentType "\\\167\DC3\DC3\SO/\180\139\200e\141\184\DC1\163"]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {
      0x38, 0xb3, 0x2,  0x0,  0x16, 0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a, 0x9,  0xe9, 0x27,
      0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc, 0x92, 0x2,  0x27, 0x0,  0x0,  0x59, 0x7d, 0x26, 0x0,  0x4,  0xd5,
      0x3b, 0xb4, 0x95, 0x0,  0x14, 0x8e, 0xc,  0x89, 0x70, 0x72, 0x64, 0x8d, 0x36, 0x14, 0xed, 0xfc, 0x47, 0xf8, 0x4f,
      0x74, 0xc8, 0x1a, 0x3b, 0x35, 0xcc, 0x18, 0x0,  0x0,  0x10, 0xc6, 0x29, 0x4e, 0x25, 0x69, 0x13, 0x4a, 0x10, 0x23,
      0x7e, 0x70, 0x28, 0x6f, 0x16, 0x0,  0x1a, 0x87, 0x93, 0x5a, 0xb5, 0xfa, 0xe0, 0xfa, 0x11, 0x45, 0x17, 0x3f, 0x42,
      0xe5, 0x54, 0x4e, 0x70, 0x7b, 0x8c, 0x32, 0xdc, 0x52, 0x2,  0x2a, 0xb1, 0x66, 0xfb, 0x3,  0x0,  0xe,  0x21, 0x3c,
      0x44, 0x42, 0xb8, 0xd5, 0xce, 0xa,  0x1e, 0xa6, 0x1b, 0xac, 0x67, 0x1,  0x1f, 0x0,  0x8,  0xd0, 0x56, 0x7b, 0xb,
      0x64, 0x49, 0x2d, 0x2d, 0x18, 0x0,  0x0,  0x2e, 0x43, 0x24, 0x37, 0x28, 0xbb, 0x29, 0xfd, 0x1c, 0x0,  0xd,  0xf2,
      0x5b, 0x87, 0xac, 0x6c, 0xd1, 0x34, 0xea, 0x8c, 0x9b, 0x74, 0x27, 0x53, 0x8,  0x0,  0x14, 0x15, 0x33, 0xfe, 0xab,
      0x60, 0xd,  0x47, 0xbf, 0xcf, 0x4b, 0xd8, 0xa1, 0x30, 0xb9, 0xc7, 0xe2, 0x6a, 0x76, 0xeb, 0x67, 0x15, 0x0,  0xf,
      0x51, 0xc2, 0x61, 0x43, 0xc0, 0xc8, 0x15, 0x9c, 0x87, 0xe0, 0x9f, 0x12, 0xd7, 0xb8, 0x56, 0x8,  0x0,  0x6,  0x70,
      0x4f, 0xa4, 0x14, 0xba, 0xc1, 0x16, 0x0,  0x16, 0x9a, 0xe8, 0x9b, 0xa4, 0xb0, 0xaa, 0x15, 0x30, 0x2,  0x32, 0xed,
      0xf5, 0xbe, 0x42, 0xa3, 0x15, 0x25, 0x70, 0x37, 0x40, 0x7f, 0xb8, 0x3,  0x0,  0x2,  0x9c, 0x14, 0x26, 0x0,  0x9,
      0x36, 0x17, 0x40, 0x2b, 0x30, 0x15, 0x6f, 0x39, 0x98, 0x0,  0x18, 0x98, 0xba, 0x63, 0x1c, 0xd7, 0xe0, 0x4d, 0x6b,
      0x4c, 0xe1, 0x6f, 0xb0, 0x91, 0xab, 0xf3, 0x53, 0x80, 0x5d, 0x8f, 0xb2, 0x4a, 0x6f, 0x28, 0xfa, 0x2a, 0x82, 0x19,
      0x3f, 0x3,  0x0,  0xe,  0x5c, 0xa7, 0x13, 0x13, 0xe,  0x2f, 0xb4, 0x8b, 0xc8, 0x65, 0x8d, 0xb8, 0x11, 0xa3, 0x16,
      0x1b, 0xd,  0xe9, 0x31, 0xd8, 0xed};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc7, 0x64, 0x9e, 0xa2, 0x70, 0x16, 0x5a, 0x32, 0x7b, 0xe4, 0x6a,
                               0x9,  0xe9, 0x27, 0xd3, 0x4b, 0xfe, 0x1c, 0x4b, 0x85, 0x25, 0xfc};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x16, 0x1b, 0xd, 0xe9, 0x31, 0xd8, 0xed};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\DELB\171!\189\RS\129\132", _pubPktID
// = 1997, _pubBody = "P\169", _pubProps = [PropAuthenticationData
// "\133\226\151X\185\146s\RS\226zw'\244o\251\141(\250i\128\254\&2:\180\156\235\145\241\185\139",PropAuthenticationMethod
// "l\204\131\167\192P\220\ACK8\v\136\\G\230\166~6L\ETX\138",PropPayloadFormatIndicator 188,PropTopicAliasMaximum
// 2470,PropContentType "\184\147Y`}\SYN\\P\168\r\148\152\&7\148\175i\188hp\SO6",PropWillDelayInterval
// 8842,PropTopicAliasMaximum 3096,PropServerReference
// "\NAK\208\185@\138*\ETX'\243v\196S\FS\134.\193\230pMQ\134\245\185\249\225",PropSharedSubscriptionAvailable
// 205,PropServerReference
// "\r$\r\196\230\134\188I\a\252\231Q\240\215\185\190\175\&4\v\242\212\248\145c\251\221\254",PropServerKeepAlive
// 260,PropAuthenticationMethod
// "8L\222\GS\144C\180Q\168\135\152\179\187\ESC\191\&6|1\152\192\149\215\t\DLE\162\169\213\187\221\186",PropMaximumQoS
// 30,PropAuthenticationData "C\f\fx\t\186\166\215\SUB\156\136\236\222\238~\165#p\237\199O\237",PropReasonString
// "\206\b\FS\218",PropMessageExpiryInterval 21627,PropWildcardSubscriptionAvailable 124,PropServerReference
// "\192\DC3\ESC\SI",PropRequestProblemInformation 114,PropSubscriptionIdentifierAvailable
// 10,PropRequestResponseInformation 197]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x3d, 0x83, 0x2,  0x0,  0x8,  0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84, 0x7,  0xcd, 0xf3, 0x1,  0x16, 0x0,
      0x1e, 0x85, 0xe2, 0x97, 0x58, 0xb9, 0x92, 0x73, 0x1e, 0xe2, 0x7a, 0x77, 0x27, 0xf4, 0x6f, 0xfb, 0x8d, 0x28, 0xfa,
      0x69, 0x80, 0xfe, 0x32, 0x3a, 0xb4, 0x9c, 0xeb, 0x91, 0xf1, 0xb9, 0x8b, 0x15, 0x0,  0x14, 0x6c, 0xcc, 0x83, 0xa7,
      0xc0, 0x50, 0xdc, 0x6,  0x38, 0xb,  0x88, 0x5c, 0x47, 0xe6, 0xa6, 0x7e, 0x36, 0x4c, 0x3,  0x8a, 0x1,  0xbc, 0x22,
      0x9,  0xa6, 0x3,  0x0,  0x15, 0xb8, 0x93, 0x59, 0x60, 0x7d, 0x16, 0x5c, 0x50, 0xa8, 0xd,  0x94, 0x98, 0x37, 0x94,
      0xaf, 0x69, 0xbc, 0x68, 0x70, 0xe,  0x36, 0x18, 0x0,  0x0,  0x22, 0x8a, 0x22, 0xc,  0x18, 0x1c, 0x0,  0x19, 0x15,
      0xd0, 0xb9, 0x40, 0x8a, 0x2a, 0x3,  0x27, 0xf3, 0x76, 0xc4, 0x53, 0x1c, 0x86, 0x2e, 0xc1, 0xe6, 0x70, 0x4d, 0x51,
      0x86, 0xf5, 0xb9, 0xf9, 0xe1, 0x2a, 0xcd, 0x1c, 0x0,  0x1b, 0xd,  0x24, 0xd,  0xc4, 0xe6, 0x86, 0xbc, 0x49, 0x7,
      0xfc, 0xe7, 0x51, 0xf0, 0xd7, 0xb9, 0xbe, 0xaf, 0x34, 0xb,  0xf2, 0xd4, 0xf8, 0x91, 0x63, 0xfb, 0xdd, 0xfe, 0x13,
      0x1,  0x4,  0x15, 0x0,  0x1e, 0x38, 0x4c, 0xde, 0x1d, 0x90, 0x43, 0xb4, 0x51, 0xa8, 0x87, 0x98, 0xb3, 0xbb, 0x1b,
      0xbf, 0x36, 0x7c, 0x31, 0x98, 0xc0, 0x95, 0xd7, 0x9,  0x10, 0xa2, 0xa9, 0xd5, 0xbb, 0xdd, 0xba, 0x24, 0x1e, 0x16,
      0x0,  0x16, 0x43, 0xc,  0xc,  0x78, 0x9,  0xba, 0xa6, 0xd7, 0x1a, 0x9c, 0x88, 0xec, 0xde, 0xee, 0x7e, 0xa5, 0x23,
      0x70, 0xed, 0xc7, 0x4f, 0xed, 0x1f, 0x0,  0x4,  0xce, 0x8,  0x1c, 0xda, 0x2,  0x0,  0x0,  0x54, 0x7b, 0x28, 0x7c,
      0x1c, 0x0,  0x4,  0xc0, 0x13, 0x1b, 0xf,  0x17, 0x72, 0x29, 0xa,  0x19, 0xc5, 0x50, 0xa9};
  uint8_t topic_bytes[] = {0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x50, 0xa9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0x85, 0xe2, 0x97, 0x58, 0xb9, 0x92, 0x73, 0x1e, 0xe2, 0x7a, 0x77, 0x27, 0xf4, 0x6f, 0xfb,
                           0x8d, 0x28, 0xfa, 0x69, 0x80, 0xfe, 0x32, 0x3a, 0xb4, 0x9c, 0xeb, 0x91, 0xf1, 0xb9, 0x8b};
  uint8_t bytesprops1[] = {0x6c, 0xcc, 0x83, 0xa7, 0xc0, 0x50, 0xdc, 0x6,  0x38, 0xb,
                           0x88, 0x5c, 0x47, 0xe6, 0xa6, 0x7e, 0x36, 0x4c, 0x3,  0x8a};
  uint8_t bytesprops2[] = {0xb8, 0x93, 0x59, 0x60, 0x7d, 0x16, 0x5c, 0x50, 0xa8, 0xd, 0x94,
                           0x98, 0x37, 0x94, 0xaf, 0x69, 0xbc, 0x68, 0x70, 0xe,  0x36};
  uint8_t bytesprops3[] = {0x15, 0xd0, 0xb9, 0x40, 0x8a, 0x2a, 0x3,  0x27, 0xf3, 0x76, 0xc4, 0x53, 0x1c,
                           0x86, 0x2e, 0xc1, 0xe6, 0x70, 0x4d, 0x51, 0x86, 0xf5, 0xb9, 0xf9, 0xe1};
  uint8_t bytesprops4[] = {0xd,  0x24, 0xd,  0xc4, 0xe6, 0x86, 0xbc, 0x49, 0x7,  0xfc, 0xe7, 0x51, 0xf0, 0xd7,
                           0xb9, 0xbe, 0xaf, 0x34, 0xb,  0xf2, 0xd4, 0xf8, 0x91, 0x63, 0xfb, 0xdd, 0xfe};
  uint8_t bytesprops5[] = {0x38, 0x4c, 0xde, 0x1d, 0x90, 0x43, 0xb4, 0x51, 0xa8, 0x87, 0x98, 0xb3, 0xbb, 0x1b, 0xbf,
                           0x36, 0x7c, 0x31, 0x98, 0xc0, 0x95, 0xd7, 0x9,  0x10, 0xa2, 0xa9, 0xd5, 0xbb, 0xdd, 0xba};
  uint8_t bytesprops6[] = {0x43, 0xc,  0xc,  0x78, 0x9,  0xba, 0xa6, 0xd7, 0x1a, 0x9c, 0x88,
                           0xec, 0xde, 0xee, 0x7e, 0xa5, 0x23, 0x70, 0xed, 0xc7, 0x4f, 0xed};
  uint8_t bytesprops7[] = {0xce, 0x8, 0x1c, 0xda};
  uint8_t bytesprops8[] = {0xc0, 0x13, 0x1b, 0xf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2470}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8842}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3096}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 260}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21627}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 1997, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\DELB\171!\189\RS\129\132", _pubPktID
// = 1997, _pubBody = "P\169", _pubProps = [PropAuthenticationData
// "\133\226\151X\185\146s\RS\226zw'\244o\251\141(\250i\128\254\&2:\180\156\235\145\241\185\139",PropAuthenticationMethod
// "l\204\131\167\192P\220\ACK8\v\136\\G\230\166~6L\ETX\138",PropPayloadFormatIndicator 188,PropTopicAliasMaximum
// 2470,PropContentType "\184\147Y`}\SYN\\P\168\r\148\152\&7\148\175i\188hp\SO6",PropWillDelayInterval
// 8842,PropTopicAliasMaximum 3096,PropServerReference
// "\NAK\208\185@\138*\ETX'\243v\196S\FS\134.\193\230pMQ\134\245\185\249\225",PropSharedSubscriptionAvailable
// 205,PropServerReference
// "\r$\r\196\230\134\188I\a\252\231Q\240\215\185\190\175\&4\v\242\212\248\145c\251\221\254",PropServerKeepAlive
// 260,PropAuthenticationMethod
// "8L\222\GS\144C\180Q\168\135\152\179\187\ESC\191\&6|1\152\192\149\215\t\DLE\162\169\213\187\221\186",PropMaximumQoS
// 30,PropAuthenticationData "C\f\fx\t\186\166\215\SUB\156\136\236\222\238~\165#p\237\199O\237",PropReasonString
// "\206\b\FS\218",PropMessageExpiryInterval 21627,PropWildcardSubscriptionAvailable 124,PropServerReference
// "\192\DC3\ESC\SI",PropRequestProblemInformation 114,PropSubscriptionIdentifierAvailable
// 10,PropRequestResponseInformation 197]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {
      0x3d, 0x83, 0x2,  0x0,  0x8,  0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84, 0x7,  0xcd, 0xf3, 0x1,  0x16, 0x0,
      0x1e, 0x85, 0xe2, 0x97, 0x58, 0xb9, 0x92, 0x73, 0x1e, 0xe2, 0x7a, 0x77, 0x27, 0xf4, 0x6f, 0xfb, 0x8d, 0x28, 0xfa,
      0x69, 0x80, 0xfe, 0x32, 0x3a, 0xb4, 0x9c, 0xeb, 0x91, 0xf1, 0xb9, 0x8b, 0x15, 0x0,  0x14, 0x6c, 0xcc, 0x83, 0xa7,
      0xc0, 0x50, 0xdc, 0x6,  0x38, 0xb,  0x88, 0x5c, 0x47, 0xe6, 0xa6, 0x7e, 0x36, 0x4c, 0x3,  0x8a, 0x1,  0xbc, 0x22,
      0x9,  0xa6, 0x3,  0x0,  0x15, 0xb8, 0x93, 0x59, 0x60, 0x7d, 0x16, 0x5c, 0x50, 0xa8, 0xd,  0x94, 0x98, 0x37, 0x94,
      0xaf, 0x69, 0xbc, 0x68, 0x70, 0xe,  0x36, 0x18, 0x0,  0x0,  0x22, 0x8a, 0x22, 0xc,  0x18, 0x1c, 0x0,  0x19, 0x15,
      0xd0, 0xb9, 0x40, 0x8a, 0x2a, 0x3,  0x27, 0xf3, 0x76, 0xc4, 0x53, 0x1c, 0x86, 0x2e, 0xc1, 0xe6, 0x70, 0x4d, 0x51,
      0x86, 0xf5, 0xb9, 0xf9, 0xe1, 0x2a, 0xcd, 0x1c, 0x0,  0x1b, 0xd,  0x24, 0xd,  0xc4, 0xe6, 0x86, 0xbc, 0x49, 0x7,
      0xfc, 0xe7, 0x51, 0xf0, 0xd7, 0xb9, 0xbe, 0xaf, 0x34, 0xb,  0xf2, 0xd4, 0xf8, 0x91, 0x63, 0xfb, 0xdd, 0xfe, 0x13,
      0x1,  0x4,  0x15, 0x0,  0x1e, 0x38, 0x4c, 0xde, 0x1d, 0x90, 0x43, 0xb4, 0x51, 0xa8, 0x87, 0x98, 0xb3, 0xbb, 0x1b,
      0xbf, 0x36, 0x7c, 0x31, 0x98, 0xc0, 0x95, 0xd7, 0x9,  0x10, 0xa2, 0xa9, 0xd5, 0xbb, 0xdd, 0xba, 0x24, 0x1e, 0x16,
      0x0,  0x16, 0x43, 0xc,  0xc,  0x78, 0x9,  0xba, 0xa6, 0xd7, 0x1a, 0x9c, 0x88, 0xec, 0xde, 0xee, 0x7e, 0xa5, 0x23,
      0x70, 0xed, 0xc7, 0x4f, 0xed, 0x1f, 0x0,  0x4,  0xce, 0x8,  0x1c, 0xda, 0x2,  0x0,  0x0,  0x54, 0x7b, 0x28, 0x7c,
      0x1c, 0x0,  0x4,  0xc0, 0x13, 0x1b, 0xf,  0x17, 0x72, 0x29, 0xa,  0x19, 0xc5, 0x50, 0xa9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7f, 0x42, 0xab, 0x21, 0xbd, 0x1e, 0x81, 0x84};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x50, 0xa9};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1997);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\138.\149\DC3{U\CANP\144",
// _pubPktID = 16970, _pubBody = "4\163\252\250\166\SUB\245\158", _pubProps = [PropContentType
// "\RS\247\FS\142\143@3\238U\203",PropReasonString
// "\157\230\ACK\171\149\165\250\147L\227{\131\252Y\140",PropAuthenticationData
// "R,\224\163\177\231\185\n\202\160\162\180gn\a\r{\192\135\ETX\145\151\136\211",PropTopicAlias
// 31483,PropAssignedClientIdentifier
// "\SIV\223\185\223X\244\197\182\220\DEL{\247\214\153\"\193\246W\247\r\220",PropTopicAlias
// 20925,PropResponseInformation "O\252\147\164\145",PropServerReference
// "\"\237\153*\136\152\192\190\201\147\186\219\DEL",PropAuthenticationMethod "CN\207\218
// \169\210\143\ACK[\174\157O\212\135\185\&6",PropReasonString
// "\177(\200\154|\245\236\153\249\251C\212\DC3\183\179\255\143\183-w",PropSharedSubscriptionAvailable
// 31,PropPayloadFormatIndicator 157,PropPayloadFormatIndicator 10,PropSubscriptionIdentifier
// 11,PropSessionExpiryInterval 11032,PropContentType "-X8\172\&4\167\USO",PropTopicAliasMaximum
// 27140,PropAuthenticationMethod "\167\249X\STX&\r\194t\166\135\246\&54L",PropRetainAvailable
// 64,PropMessageExpiryInterval 28215,PropServerKeepAlive 19907,PropUserProperty "\206z\147Gp\187\243\215"
// "]\194s\253\226\204\203NP\234Y;t0\183\236\128\211\155\EM\184\b"]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {0x32, 0x8c, 0x2,  0x0,  0x9,  0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50, 0x90, 0x42, 0x4a, 0xf5,
                   0x1,  0x3,  0x0,  0xa,  0x1e, 0xf7, 0x1c, 0x8e, 0x8f, 0x40, 0x33, 0xee, 0x55, 0xcb, 0x1f, 0x0,  0xf,
                   0x9d, 0xe6, 0x6,  0xab, 0x95, 0xa5, 0xfa, 0x93, 0x4c, 0xe3, 0x7b, 0x83, 0xfc, 0x59, 0x8c, 0x16, 0x0,
                   0x18, 0x52, 0x2c, 0xe0, 0xa3, 0xb1, 0xe7, 0xb9, 0xa,  0xca, 0xa0, 0xa2, 0xb4, 0x67, 0x6e, 0x7,  0xd,
                   0x7b, 0xc0, 0x87, 0x3,  0x91, 0x97, 0x88, 0xd3, 0x23, 0x7a, 0xfb, 0x12, 0x0,  0x16, 0xf,  0x56, 0xdf,
                   0xb9, 0xdf, 0x58, 0xf4, 0xc5, 0xb6, 0xdc, 0x7f, 0x7b, 0xf7, 0xd6, 0x99, 0x22, 0xc1, 0xf6, 0x57, 0xf7,
                   0xd,  0xdc, 0x23, 0x51, 0xbd, 0x1a, 0x0,  0x5,  0x4f, 0xfc, 0x93, 0xa4, 0x91, 0x1c, 0x0,  0xd,  0x22,
                   0xed, 0x99, 0x2a, 0x88, 0x98, 0xc0, 0xbe, 0xc9, 0x93, 0xba, 0xdb, 0x7f, 0x15, 0x0,  0x11, 0x43, 0x4e,
                   0xcf, 0xda, 0x20, 0xa9, 0xd2, 0x8f, 0x6,  0x5b, 0xae, 0x9d, 0x4f, 0xd4, 0x87, 0xb9, 0x36, 0x1f, 0x0,
                   0x14, 0xb1, 0x28, 0xc8, 0x9a, 0x7c, 0xf5, 0xec, 0x99, 0xf9, 0xfb, 0x43, 0xd4, 0x13, 0xb7, 0xb3, 0xff,
                   0x8f, 0xb7, 0x2d, 0x77, 0x2a, 0x1f, 0x1,  0x9d, 0x1,  0xa,  0xb,  0xb,  0x11, 0x0,  0x0,  0x2b, 0x18,
                   0x3,  0x0,  0x8,  0x2d, 0x58, 0x38, 0xac, 0x34, 0xa7, 0x1f, 0x4f, 0x22, 0x6a, 0x4,  0x15, 0x0,  0xe,
                   0xa7, 0xf9, 0x58, 0x2,  0x26, 0xd,  0xc2, 0x74, 0xa6, 0x87, 0xf6, 0x35, 0x34, 0x4c, 0x25, 0x40, 0x2,
                   0x0,  0x0,  0x6e, 0x37, 0x13, 0x4d, 0xc3, 0x26, 0x0,  0x8,  0xce, 0x7a, 0x93, 0x47, 0x70, 0xbb, 0xf3,
                   0xd7, 0x0,  0x16, 0x5d, 0xc2, 0x73, 0xfd, 0xe2, 0xcc, 0xcb, 0x4e, 0x50, 0xea, 0x59, 0x3b, 0x74, 0x30,
                   0xb7, 0xec, 0x80, 0xd3, 0x9b, 0x19, 0xb8, 0x8,  0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  uint8_t topic_bytes[] = {0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50, 0x90};
  lwmqtt_string_t topic = {9, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  uint8_t bytesprops0[] = {0x1e, 0xf7, 0x1c, 0x8e, 0x8f, 0x40, 0x33, 0xee, 0x55, 0xcb};
  uint8_t bytesprops1[] = {0x9d, 0xe6, 0x6, 0xab, 0x95, 0xa5, 0xfa, 0x93, 0x4c, 0xe3, 0x7b, 0x83, 0xfc, 0x59, 0x8c};
  uint8_t bytesprops2[] = {0x52, 0x2c, 0xe0, 0xa3, 0xb1, 0xe7, 0xb9, 0xa, 0xca, 0xa0, 0xa2, 0xb4,
                           0x67, 0x6e, 0x7,  0xd,  0x7b, 0xc0, 0x87, 0x3, 0x91, 0x97, 0x88, 0xd3};
  uint8_t bytesprops3[] = {0xf,  0x56, 0xdf, 0xb9, 0xdf, 0x58, 0xf4, 0xc5, 0xb6, 0xdc, 0x7f,
                           0x7b, 0xf7, 0xd6, 0x99, 0x22, 0xc1, 0xf6, 0x57, 0xf7, 0xd,  0xdc};
  uint8_t bytesprops4[] = {0x4f, 0xfc, 0x93, 0xa4, 0x91};
  uint8_t bytesprops5[] = {0x22, 0xed, 0x99, 0x2a, 0x88, 0x98, 0xc0, 0xbe, 0xc9, 0x93, 0xba, 0xdb, 0x7f};
  uint8_t bytesprops6[] = {0x43, 0x4e, 0xcf, 0xda, 0x20, 0xa9, 0xd2, 0x8f, 0x6,
                           0x5b, 0xae, 0x9d, 0x4f, 0xd4, 0x87, 0xb9, 0x36};
  uint8_t bytesprops7[] = {0xb1, 0x28, 0xc8, 0x9a, 0x7c, 0xf5, 0xec, 0x99, 0xf9, 0xfb,
                           0x43, 0xd4, 0x13, 0xb7, 0xb3, 0xff, 0x8f, 0xb7, 0x2d, 0x77};
  uint8_t bytesprops8[] = {0x2d, 0x58, 0x38, 0xac, 0x34, 0xa7, 0x1f, 0x4f};
  uint8_t bytesprops9[] = {0xa7, 0xf9, 0x58, 0x2, 0x26, 0xd, 0xc2, 0x74, 0xa6, 0x87, 0xf6, 0x35, 0x34, 0x4c};
  uint8_t bytesprops11[] = {0x5d, 0xc2, 0x73, 0xfd, 0xe2, 0xcc, 0xcb, 0x4e, 0x50, 0xea, 0x59,
                            0x3b, 0x74, 0x30, 0xb7, 0xec, 0x80, 0xd3, 0x9b, 0x19, 0xb8, 0x8};
  uint8_t bytesprops10[] = {0xce, 0x7a, 0x93, 0x47, 0x70, 0xbb, 0xf3, 0xd7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31483}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20925}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11032}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27140}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28215}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19907}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops10}, .v = {22, (char*)&bytesprops11}}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 16970, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\138.\149\DC3{U\CANP\144",
// _pubPktID = 16970, _pubBody = "4\163\252\250\166\SUB\245\158", _pubProps = [PropContentType
// "\RS\247\FS\142\143@3\238U\203",PropReasonString
// "\157\230\ACK\171\149\165\250\147L\227{\131\252Y\140",PropAuthenticationData
// "R,\224\163\177\231\185\n\202\160\162\180gn\a\r{\192\135\ETX\145\151\136\211",PropTopicAlias
// 31483,PropAssignedClientIdentifier
// "\SIV\223\185\223X\244\197\182\220\DEL{\247\214\153\"\193\246W\247\r\220",PropTopicAlias
// 20925,PropResponseInformation "O\252\147\164\145",PropServerReference
// "\"\237\153*\136\152\192\190\201\147\186\219\DEL",PropAuthenticationMethod "CN\207\218
// \169\210\143\ACK[\174\157O\212\135\185\&6",PropReasonString
// "\177(\200\154|\245\236\153\249\251C\212\DC3\183\179\255\143\183-w",PropSharedSubscriptionAvailable
// 31,PropPayloadFormatIndicator 157,PropPayloadFormatIndicator 10,PropSubscriptionIdentifier
// 11,PropSessionExpiryInterval 11032,PropContentType "-X8\172\&4\167\USO",PropTopicAliasMaximum
// 27140,PropAuthenticationMethod "\167\249X\STX&\r\194t\166\135\246\&54L",PropRetainAvailable
// 64,PropMessageExpiryInterval 28215,PropServerKeepAlive 19907,PropUserProperty "\206z\147Gp\187\243\215"
// "]\194s\253\226\204\203NP\234Y;t0\183\236\128\211\155\EM\184\b"]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {0x32, 0x8c, 0x2,  0x0,  0x9,  0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50, 0x90, 0x42, 0x4a, 0xf5,
                   0x1,  0x3,  0x0,  0xa,  0x1e, 0xf7, 0x1c, 0x8e, 0x8f, 0x40, 0x33, 0xee, 0x55, 0xcb, 0x1f, 0x0,  0xf,
                   0x9d, 0xe6, 0x6,  0xab, 0x95, 0xa5, 0xfa, 0x93, 0x4c, 0xe3, 0x7b, 0x83, 0xfc, 0x59, 0x8c, 0x16, 0x0,
                   0x18, 0x52, 0x2c, 0xe0, 0xa3, 0xb1, 0xe7, 0xb9, 0xa,  0xca, 0xa0, 0xa2, 0xb4, 0x67, 0x6e, 0x7,  0xd,
                   0x7b, 0xc0, 0x87, 0x3,  0x91, 0x97, 0x88, 0xd3, 0x23, 0x7a, 0xfb, 0x12, 0x0,  0x16, 0xf,  0x56, 0xdf,
                   0xb9, 0xdf, 0x58, 0xf4, 0xc5, 0xb6, 0xdc, 0x7f, 0x7b, 0xf7, 0xd6, 0x99, 0x22, 0xc1, 0xf6, 0x57, 0xf7,
                   0xd,  0xdc, 0x23, 0x51, 0xbd, 0x1a, 0x0,  0x5,  0x4f, 0xfc, 0x93, 0xa4, 0x91, 0x1c, 0x0,  0xd,  0x22,
                   0xed, 0x99, 0x2a, 0x88, 0x98, 0xc0, 0xbe, 0xc9, 0x93, 0xba, 0xdb, 0x7f, 0x15, 0x0,  0x11, 0x43, 0x4e,
                   0xcf, 0xda, 0x20, 0xa9, 0xd2, 0x8f, 0x6,  0x5b, 0xae, 0x9d, 0x4f, 0xd4, 0x87, 0xb9, 0x36, 0x1f, 0x0,
                   0x14, 0xb1, 0x28, 0xc8, 0x9a, 0x7c, 0xf5, 0xec, 0x99, 0xf9, 0xfb, 0x43, 0xd4, 0x13, 0xb7, 0xb3, 0xff,
                   0x8f, 0xb7, 0x2d, 0x77, 0x2a, 0x1f, 0x1,  0x9d, 0x1,  0xa,  0xb,  0xb,  0x11, 0x0,  0x0,  0x2b, 0x18,
                   0x3,  0x0,  0x8,  0x2d, 0x58, 0x38, 0xac, 0x34, 0xa7, 0x1f, 0x4f, 0x22, 0x6a, 0x4,  0x15, 0x0,  0xe,
                   0xa7, 0xf9, 0x58, 0x2,  0x26, 0xd,  0xc2, 0x74, 0xa6, 0x87, 0xf6, 0x35, 0x34, 0x4c, 0x25, 0x40, 0x2,
                   0x0,  0x0,  0x6e, 0x37, 0x13, 0x4d, 0xc3, 0x26, 0x0,  0x8,  0xce, 0x7a, 0x93, 0x47, 0x70, 0xbb, 0xf3,
                   0xd7, 0x0,  0x16, 0x5d, 0xc2, 0x73, 0xfd, 0xe2, 0xcc, 0xcb, 0x4e, 0x50, 0xea, 0x59, 0x3b, 0x74, 0x30,
                   0xb7, 0xec, 0x80, 0xd3, 0x9b, 0x19, 0xb8, 0x8,  0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8a, 0x2e, 0x95, 0x13, 0x7b, 0x55, 0x18, 0x50, 0x90};
  lwmqtt_string_t exp_topic = {9, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x34, 0xa3, 0xfc, 0xfa, 0xa6, 0x1a, 0xf5, 0x9e};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16970);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 9);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC3r\ETX\ETXZ\SOH", _pubPktID = 0,
// _pubBody = "\129\209\171[\DC4B\234\ETX\ACK\177\133\&9\ENQf\128\DC1A\185\236M\134qT}\\g\159&;g", _pubProps =
// [PropUserProperty "\170\GS.\n\219\236\177\210s\166\241\227W\204" "\138\222S4\176\f\137%(\176\NUL",PropServerKeepAlive
// 3685,PropSharedSubscriptionAvailable 95,PropAssignedClientIdentifier
// "\204t1\215\220\133gm\202?bYl\134\DELH1I\STXd\GSJ_\FS\193H",PropMessageExpiryInterval 26825,PropReasonString
// "\205\198\163\206\251\192U\133\236&\189\177\ACK\181!\144",PropWildcardSubscriptionAvailable
// 188,PropRequestProblemInformation 198,PropMessageExpiryInterval 32203,PropWillDelayInterval 11069,PropContentType
// "\194\215\241\163\165\RS\241\222D\"\224^\219\154C\190\143r^yd\167\192)\223\195\171",PropUserProperty
// "5[\142(\199<\131\133\160\154\160|A\162U"
// "\179\156\146i\228\241\139\226\190\239]\vt{\230X\179",PropSubscriptionIdentifier 29,PropSharedSubscriptionAvailable
// 236,PropTopicAlias 9579,PropPayloadFormatIndicator 184,PropResponseTopic
// "\146\160\174;-\NUL\223#7j\"%\221n",PropMessageExpiryInterval 13344,PropAssignedClientIdentifier
// "(\235\t\133\216\230\STX@``\180\190\238\&6\246l\156_",PropMessageExpiryInterval 26407]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x31, 0x8a, 0x2,  0x0,  0x6,  0x13, 0x72, 0x3,  0x3,  0x5a, 0x1,  0xe2, 0x1,  0x26, 0x0,  0xe,  0xaa,
                   0x1d, 0x2e, 0xa,  0xdb, 0xec, 0xb1, 0xd2, 0x73, 0xa6, 0xf1, 0xe3, 0x57, 0xcc, 0x0,  0xb,  0x8a, 0xde,
                   0x53, 0x34, 0xb0, 0xc,  0x89, 0x25, 0x28, 0xb0, 0x0,  0x13, 0xe,  0x65, 0x2a, 0x5f, 0x12, 0x0,  0x1a,
                   0xcc, 0x74, 0x31, 0xd7, 0xdc, 0x85, 0x67, 0x6d, 0xca, 0x3f, 0x62, 0x59, 0x6c, 0x86, 0x7f, 0x48, 0x31,
                   0x49, 0x2,  0x64, 0x1d, 0x4a, 0x5f, 0x1c, 0xc1, 0x48, 0x2,  0x0,  0x0,  0x68, 0xc9, 0x1f, 0x0,  0x10,
                   0xcd, 0xc6, 0xa3, 0xce, 0xfb, 0xc0, 0x55, 0x85, 0xec, 0x26, 0xbd, 0xb1, 0x6,  0xb5, 0x21, 0x90, 0x28,
                   0xbc, 0x17, 0xc6, 0x2,  0x0,  0x0,  0x7d, 0xcb, 0x18, 0x0,  0x0,  0x2b, 0x3d, 0x3,  0x0,  0x1b, 0xc2,
                   0xd7, 0xf1, 0xa3, 0xa5, 0x1e, 0xf1, 0xde, 0x44, 0x22, 0xe0, 0x5e, 0xdb, 0x9a, 0x43, 0xbe, 0x8f, 0x72,
                   0x5e, 0x79, 0x64, 0xa7, 0xc0, 0x29, 0xdf, 0xc3, 0xab, 0x26, 0x0,  0xf,  0x35, 0x5b, 0x8e, 0x28, 0xc7,
                   0x3c, 0x83, 0x85, 0xa0, 0x9a, 0xa0, 0x7c, 0x41, 0xa2, 0x55, 0x0,  0x11, 0xb3, 0x9c, 0x92, 0x69, 0xe4,
                   0xf1, 0x8b, 0xe2, 0xbe, 0xef, 0x5d, 0xb,  0x74, 0x7b, 0xe6, 0x58, 0xb3, 0xb,  0x1d, 0x2a, 0xec, 0x23,
                   0x25, 0x6b, 0x1,  0xb8, 0x8,  0x0,  0xe,  0x92, 0xa0, 0xae, 0x3b, 0x2d, 0x0,  0xdf, 0x23, 0x37, 0x6a,
                   0x22, 0x25, 0xdd, 0x6e, 0x2,  0x0,  0x0,  0x34, 0x20, 0x12, 0x0,  0x12, 0x28, 0xeb, 0x9,  0x85, 0xd8,
                   0xe6, 0x2,  0x40, 0x60, 0x60, 0xb4, 0xbe, 0xee, 0x36, 0xf6, 0x6c, 0x9c, 0x5f, 0x2,  0x0,  0x0,  0x67,
                   0x27, 0x81, 0xd1, 0xab, 0x5b, 0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80, 0x11,
                   0x41, 0xb9, 0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  uint8_t topic_bytes[] = {0x13, 0x72, 0x3, 0x3, 0x5a, 0x1};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x81, 0xd1, 0xab, 0x5b, 0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80,
                         0x11, 0x41, 0xb9, 0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops1[] = {0x8a, 0xde, 0x53, 0x34, 0xb0, 0xc, 0x89, 0x25, 0x28, 0xb0, 0x0};
  uint8_t bytesprops0[] = {0xaa, 0x1d, 0x2e, 0xa, 0xdb, 0xec, 0xb1, 0xd2, 0x73, 0xa6, 0xf1, 0xe3, 0x57, 0xcc};
  uint8_t bytesprops2[] = {0xcc, 0x74, 0x31, 0xd7, 0xdc, 0x85, 0x67, 0x6d, 0xca, 0x3f, 0x62, 0x59, 0x6c,
                           0x86, 0x7f, 0x48, 0x31, 0x49, 0x2,  0x64, 0x1d, 0x4a, 0x5f, 0x1c, 0xc1, 0x48};
  uint8_t bytesprops3[] = {0xcd, 0xc6, 0xa3, 0xce, 0xfb, 0xc0, 0x55, 0x85,
                           0xec, 0x26, 0xbd, 0xb1, 0x6,  0xb5, 0x21, 0x90};
  uint8_t bytesprops4[] = {0xc2, 0xd7, 0xf1, 0xa3, 0xa5, 0x1e, 0xf1, 0xde, 0x44, 0x22, 0xe0, 0x5e, 0xdb, 0x9a,
                           0x43, 0xbe, 0x8f, 0x72, 0x5e, 0x79, 0x64, 0xa7, 0xc0, 0x29, 0xdf, 0xc3, 0xab};
  uint8_t bytesprops6[] = {0xb3, 0x9c, 0x92, 0x69, 0xe4, 0xf1, 0x8b, 0xe2, 0xbe,
                           0xef, 0x5d, 0xb,  0x74, 0x7b, 0xe6, 0x58, 0xb3};
  uint8_t bytesprops5[] = {0x35, 0x5b, 0x8e, 0x28, 0xc7, 0x3c, 0x83, 0x85, 0xa0, 0x9a, 0xa0, 0x7c, 0x41, 0xa2, 0x55};
  uint8_t bytesprops7[] = {0x92, 0xa0, 0xae, 0x3b, 0x2d, 0x0, 0xdf, 0x23, 0x37, 0x6a, 0x22, 0x25, 0xdd, 0x6e};
  uint8_t bytesprops8[] = {0x28, 0xeb, 0x9,  0x85, 0xd8, 0xe6, 0x2,  0x40, 0x60,
                           0x60, 0xb4, 0xbe, 0xee, 0x36, 0xf6, 0x6c, 0x9c, 0x5f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops0}, .v = {11, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3685}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26825}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32203}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11069}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops5}, .v = {17, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9579}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13344}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26407}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\DC3r\ETX\ETXZ\SOH", _pubPktID = 0,
// _pubBody = "\129\209\171[\DC4B\234\ETX\ACK\177\133\&9\ENQf\128\DC1A\185\236M\134qT}\\g\159&;g", _pubProps =
// [PropUserProperty "\170\GS.\n\219\236\177\210s\166\241\227W\204" "\138\222S4\176\f\137%(\176\NUL",PropServerKeepAlive
// 3685,PropSharedSubscriptionAvailable 95,PropAssignedClientIdentifier
// "\204t1\215\220\133gm\202?bYl\134\DELH1I\STXd\GSJ_\FS\193H",PropMessageExpiryInterval 26825,PropReasonString
// "\205\198\163\206\251\192U\133\236&\189\177\ACK\181!\144",PropWildcardSubscriptionAvailable
// 188,PropRequestProblemInformation 198,PropMessageExpiryInterval 32203,PropWillDelayInterval 11069,PropContentType
// "\194\215\241\163\165\RS\241\222D\"\224^\219\154C\190\143r^yd\167\192)\223\195\171",PropUserProperty
// "5[\142(\199<\131\133\160\154\160|A\162U"
// "\179\156\146i\228\241\139\226\190\239]\vt{\230X\179",PropSubscriptionIdentifier 29,PropSharedSubscriptionAvailable
// 236,PropTopicAlias 9579,PropPayloadFormatIndicator 184,PropResponseTopic
// "\146\160\174;-\NUL\223#7j\"%\221n",PropMessageExpiryInterval 13344,PropAssignedClientIdentifier
// "(\235\t\133\216\230\STX@``\180\190\238\&6\246l\156_",PropMessageExpiryInterval 26407]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x31, 0x8a, 0x2,  0x0,  0x6,  0x13, 0x72, 0x3,  0x3,  0x5a, 0x1,  0xe2, 0x1,  0x26, 0x0,  0xe,  0xaa,
                   0x1d, 0x2e, 0xa,  0xdb, 0xec, 0xb1, 0xd2, 0x73, 0xa6, 0xf1, 0xe3, 0x57, 0xcc, 0x0,  0xb,  0x8a, 0xde,
                   0x53, 0x34, 0xb0, 0xc,  0x89, 0x25, 0x28, 0xb0, 0x0,  0x13, 0xe,  0x65, 0x2a, 0x5f, 0x12, 0x0,  0x1a,
                   0xcc, 0x74, 0x31, 0xd7, 0xdc, 0x85, 0x67, 0x6d, 0xca, 0x3f, 0x62, 0x59, 0x6c, 0x86, 0x7f, 0x48, 0x31,
                   0x49, 0x2,  0x64, 0x1d, 0x4a, 0x5f, 0x1c, 0xc1, 0x48, 0x2,  0x0,  0x0,  0x68, 0xc9, 0x1f, 0x0,  0x10,
                   0xcd, 0xc6, 0xa3, 0xce, 0xfb, 0xc0, 0x55, 0x85, 0xec, 0x26, 0xbd, 0xb1, 0x6,  0xb5, 0x21, 0x90, 0x28,
                   0xbc, 0x17, 0xc6, 0x2,  0x0,  0x0,  0x7d, 0xcb, 0x18, 0x0,  0x0,  0x2b, 0x3d, 0x3,  0x0,  0x1b, 0xc2,
                   0xd7, 0xf1, 0xa3, 0xa5, 0x1e, 0xf1, 0xde, 0x44, 0x22, 0xe0, 0x5e, 0xdb, 0x9a, 0x43, 0xbe, 0x8f, 0x72,
                   0x5e, 0x79, 0x64, 0xa7, 0xc0, 0x29, 0xdf, 0xc3, 0xab, 0x26, 0x0,  0xf,  0x35, 0x5b, 0x8e, 0x28, 0xc7,
                   0x3c, 0x83, 0x85, 0xa0, 0x9a, 0xa0, 0x7c, 0x41, 0xa2, 0x55, 0x0,  0x11, 0xb3, 0x9c, 0x92, 0x69, 0xe4,
                   0xf1, 0x8b, 0xe2, 0xbe, 0xef, 0x5d, 0xb,  0x74, 0x7b, 0xe6, 0x58, 0xb3, 0xb,  0x1d, 0x2a, 0xec, 0x23,
                   0x25, 0x6b, 0x1,  0xb8, 0x8,  0x0,  0xe,  0x92, 0xa0, 0xae, 0x3b, 0x2d, 0x0,  0xdf, 0x23, 0x37, 0x6a,
                   0x22, 0x25, 0xdd, 0x6e, 0x2,  0x0,  0x0,  0x34, 0x20, 0x12, 0x0,  0x12, 0x28, 0xeb, 0x9,  0x85, 0xd8,
                   0xe6, 0x2,  0x40, 0x60, 0x60, 0xb4, 0xbe, 0xee, 0x36, 0xf6, 0x6c, 0x9c, 0x5f, 0x2,  0x0,  0x0,  0x67,
                   0x27, 0x81, 0xd1, 0xab, 0x5b, 0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80, 0x11,
                   0x41, 0xb9, 0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x13, 0x72, 0x3, 0x3, 0x5a, 0x1};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x81, 0xd1, 0xab, 0x5b, 0x14, 0x42, 0xea, 0x3,  0x6,  0xb1, 0x85, 0x39, 0x5,  0x66, 0x80,
                              0x11, 0x41, 0xb9, 0xec, 0x4d, 0x86, 0x71, 0x54, 0x7d, 0x5c, 0x67, 0x9f, 0x26, 0x3b, 0x67};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Nothing, _password = Just "Ke\173x'\220\170U\137[)Z\178\208[", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "M\150!\226\146b.\172]E2\203\181H\189\229`\158", _willMsg =
// "\254\224C\179\DC48p\a%0\153A\138\190\225Yw(dG\204\187\t5w\154\138F\208", _willProps = []}), _cleanSession = True,
// _keepAlive = 3972, _connID = "j\165k\247>\ENQ\145Xh\181N\246!\SUBX\201", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x4f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0xf,  0x84, 0x0,  0x10, 0x6a, 0xa5, 0x6b,
                   0xf7, 0x3e, 0x5,  0x91, 0x58, 0x68, 0xb5, 0x4e, 0xf6, 0x21, 0x1a, 0x58, 0xc9, 0x0,  0x12, 0x4d, 0x96,
                   0x21, 0xe2, 0x92, 0x62, 0x2e, 0xac, 0x5d, 0x45, 0x32, 0xcb, 0xb5, 0x48, 0xbd, 0xe5, 0x60, 0x9e, 0x0,
                   0x1d, 0xfe, 0xe0, 0x43, 0xb3, 0x14, 0x38, 0x70, 0x7,  0x25, 0x30, 0x99, 0x41, 0x8a, 0xbe, 0xe1, 0x59,
                   0x77, 0x28, 0x64, 0x47, 0xcc, 0xbb, 0x9,  0x35, 0x77, 0x9a, 0x8a, 0x46, 0xd0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4d, 0x96, 0x21, 0xe2, 0x92, 0x62, 0x2e, 0xac, 0x5d,
                                0x45, 0x32, 0xcb, 0xb5, 0x48, 0xbd, 0xe5, 0x60, 0x9e};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfe, 0xe0, 0x43, 0xb3, 0x14, 0x38, 0x70, 0x7,  0x25, 0x30,
                                  0x99, 0x41, 0x8a, 0xbe, 0xe1, 0x59, 0x77, 0x28, 0x64, 0x47,
                                  0xcc, 0xbb, 0x9,  0x35, 0x77, 0x9a, 0x8a, 0x46, 0xd0};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3972;
  uint8_t client_id_bytes[] = {0x6a, 0xa5, 0x6b, 0xf7, 0x3e, 0x5,  0x91, 0x58,
                               0x68, 0xb5, 0x4e, 0xf6, 0x21, 0x1a, 0x58, 0xc9};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4b, 0x65, 0xad, 0x78, 0x27, 0xdc, 0xaa, 0x55, 0x89, 0x5b, 0x29, 0x5a, 0xb2, 0xd0, 0x5b};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "+\217\245\132J\219\160\139\232\213\SO\189\NUL-\DC3", _password = Nothing, _lastWill
// = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "O\SOH\173\164\238\248\f&\NULP\175\136/,\ETB\255\GS\208\247\DELt\129\193\169\EOT", _willMsg =
// "\138\229\222\220\216/\219\197\224\ETB\177\DEL.\165<\210\150\182\209\222\SOH\NAK(R\177\134\ETX\ETB", _willProps =
// []}), _cleanSession = True, _keepAlive = 20710, _connID = "\153\186\STX-\152\157\214\157\245\"4\"\ETX", _properties =
// []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x63, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb6, 0x50, 0xe6, 0x0,  0xd,  0x99, 0xba, 0x2,
                   0x2d, 0x98, 0x9d, 0xd6, 0x9d, 0xf5, 0x22, 0x34, 0x22, 0x3,  0x0,  0x19, 0x4f, 0x1,  0xad, 0xa4, 0xee,
                   0xf8, 0xc,  0x26, 0x0,  0x50, 0xaf, 0x88, 0x2f, 0x2c, 0x17, 0xff, 0x1d, 0xd0, 0xf7, 0x7f, 0x74, 0x81,
                   0xc1, 0xa9, 0x4,  0x0,  0x1c, 0x8a, 0xe5, 0xde, 0xdc, 0xd8, 0x2f, 0xdb, 0xc5, 0xe0, 0x17, 0xb1, 0x7f,
                   0x2e, 0xa5, 0x3c, 0xd2, 0x96, 0xb6, 0xd1, 0xde, 0x1,  0x15, 0x28, 0x52, 0xb1, 0x86, 0x3,  0x17, 0x0,
                   0xf,  0x2b, 0xd9, 0xf5, 0x84, 0x4a, 0xdb, 0xa0, 0x8b, 0xe8, 0xd5, 0xe,  0xbd, 0x0,  0x2d, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4f, 0x1,  0xad, 0xa4, 0xee, 0xf8, 0xc,  0x26, 0x0,  0x50, 0xaf, 0x88, 0x2f,
                                0x2c, 0x17, 0xff, 0x1d, 0xd0, 0xf7, 0x7f, 0x74, 0x81, 0xc1, 0xa9, 0x4};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8a, 0xe5, 0xde, 0xdc, 0xd8, 0x2f, 0xdb, 0xc5, 0xe0, 0x17, 0xb1, 0x7f, 0x2e, 0xa5,
                                  0x3c, 0xd2, 0x96, 0xb6, 0xd1, 0xde, 0x1,  0x15, 0x28, 0x52, 0xb1, 0x86, 0x3,  0x17};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20710;
  uint8_t client_id_bytes[] = {0x99, 0xba, 0x2, 0x2d, 0x98, 0x9d, 0xd6, 0x9d, 0xf5, 0x22, 0x34, 0x22, 0x3};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2b, 0xd9, 0xf5, 0x84, 0x4a, 0xdb, 0xa0, 0x8b, 0xe8, 0xd5, 0xe, 0xbd, 0x0, 0x2d, 0x13};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\242\212u]\129\203\157", _password = Nothing, _lastWill = Nothing, _cleanSession =
// True, _keepAlive = 23152, _connID = "*\194\151\224rT\148\208", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x1d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x82, 0x5a, 0x70, 0x0,  0x8,  0x2a, 0xc2,
                   0x97, 0xe0, 0x72, 0x54, 0x94, 0xd0, 0x0,  0x7,  0xf2, 0xd4, 0x75, 0x5d, 0x81, 0xcb, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23152;
  uint8_t client_id_bytes[] = {0x2a, 0xc2, 0x97, 0xe0, 0x72, 0x54, 0x94, 0xd0};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf2, 0xd4, 0x75, 0x5d, 0x81, 0xcb, 0x9d};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\DLEv\182\131p6", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS0, _willTopic =
// "\CAN=S\217\STX\226v\251\&6\161\SYN\168\SO:\DC2P\198\184\217\161\221\199\148\168\142\ETB\245\178", _willMsg =
// "f\241\n]\DC4\198\146\187\\\239\149x\163\194\179?\132\207S", _willProps = []}), _cleanSession = True, _keepAlive =
// 29624, _connID = "\ETX\151\174C\139\235\225Y\221\247r\201\167\189j\NUL", _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x4f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x73, 0xb8, 0x0,  0x10, 0x3,  0x97, 0xae,
                   0x43, 0x8b, 0xeb, 0xe1, 0x59, 0xdd, 0xf7, 0x72, 0xc9, 0xa7, 0xbd, 0x6a, 0x0,  0x0,  0x1c, 0x18, 0x3d,
                   0x53, 0xd9, 0x2,  0xe2, 0x76, 0xfb, 0x36, 0xa1, 0x16, 0xa8, 0xe,  0x3a, 0x12, 0x50, 0xc6, 0xb8, 0xd9,
                   0xa1, 0xdd, 0xc7, 0x94, 0xa8, 0x8e, 0x17, 0xf5, 0xb2, 0x0,  0x13, 0x66, 0xf1, 0xa,  0x5d, 0x14, 0xc6,
                   0x92, 0xbb, 0x5c, 0xef, 0x95, 0x78, 0xa3, 0xc2, 0xb3, 0x3f, 0x84, 0xcf, 0x53};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x18, 0x3d, 0x53, 0xd9, 0x2,  0xe2, 0x76, 0xfb, 0x36, 0xa1, 0x16, 0xa8, 0xe,  0x3a,
                                0x12, 0x50, 0xc6, 0xb8, 0xd9, 0xa1, 0xdd, 0xc7, 0x94, 0xa8, 0x8e, 0x17, 0xf5, 0xb2};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x66, 0xf1, 0xa,  0x5d, 0x14, 0xc6, 0x92, 0xbb, 0x5c, 0xef,
                                  0x95, 0x78, 0xa3, 0xc2, 0xb3, 0x3f, 0x84, 0xcf, 0x53};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29624;
  uint8_t client_id_bytes[] = {0x3,  0x97, 0xae, 0x43, 0x8b, 0xeb, 0xe1, 0x59,
                               0xdd, 0xf7, 0x72, 0xc9, 0xa7, 0xbd, 0x6a, 0x0};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x10, 0x76, 0xb6, 0x83, 0x70, 0x36};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "K\229g\209}\210\138\137T;\154Eh", _password = Nothing, _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 31695, _connID = "cG\191s\155\131\202\186\155\&5C\DC2\207\217\173\144
// \248\248\148", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x2f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x82, 0x7b, 0xcf, 0x0,  0x14, 0x63, 0x47, 0xbf,
                   0x73, 0x9b, 0x83, 0xca, 0xba, 0x9b, 0x35, 0x43, 0x12, 0xcf, 0xd9, 0xad, 0x90, 0x20, 0xf8, 0xf8, 0x94,
                   0x0,  0xd,  0x4b, 0xe5, 0x67, 0xd1, 0x7d, 0xd2, 0x8a, 0x89, 0x54, 0x3b, 0x9a, 0x45, 0x68};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31695;
  uint8_t client_id_bytes[] = {0x63, 0x47, 0xbf, 0x73, 0x9b, 0x83, 0xca, 0xba, 0x9b, 0x35,
                               0x43, 0x12, 0xcf, 0xd9, 0xad, 0x90, 0x20, 0xf8, 0xf8, 0x94};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4b, 0xe5, 0x67, 0xd1, 0x7d, 0xd2, 0x8a, 0x89, 0x54, 0x3b, 0x9a, 0x45, 0x68};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\175'\US7>\EOT-K\160\NUL\SO\134T\148\232\194\132b\218\SIE\241L\156\204\169\145X3\250", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\CANf\159\155m", _willMsg =
// "\155)T\206\250\163y-\213[_\a\159\GS=\195L\155L\164\220\243\225)\208p", _willProps = []}), _cleanSession = True,
// _keepAlive = 11529, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x4f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x96, 0x2d, 0x9,  0x0,  0x0,  0x0,  0x5,  0x18,
                   0x66, 0x9f, 0x9b, 0x6d, 0x0,  0x1a, 0x9b, 0x29, 0x54, 0xce, 0xfa, 0xa3, 0x79, 0x2d, 0xd5, 0x5b, 0x5f,
                   0x7,  0x9f, 0x1d, 0x3d, 0xc3, 0x4c, 0x9b, 0x4c, 0xa4, 0xdc, 0xf3, 0xe1, 0x29, 0xd0, 0x70, 0x0,  0x1e,
                   0xaf, 0x27, 0x1f, 0x37, 0x3e, 0x4,  0x2d, 0x4b, 0xa0, 0x0,  0xe,  0x86, 0x54, 0x94, 0xe8, 0xc2, 0x84,
                   0x62, 0xda, 0xf,  0x45, 0xf1, 0x4c, 0x9c, 0xcc, 0xa9, 0x91, 0x58, 0x33, 0xfa};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x18, 0x66, 0x9f, 0x9b, 0x6d};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x9b, 0x29, 0x54, 0xce, 0xfa, 0xa3, 0x79, 0x2d, 0xd5, 0x5b, 0x5f, 0x7,  0x9f,
                                  0x1d, 0x3d, 0xc3, 0x4c, 0x9b, 0x4c, 0xa4, 0xdc, 0xf3, 0xe1, 0x29, 0xd0, 0x70};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11529;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xaf, 0x27, 0x1f, 0x37, 0x3e, 0x4,  0x2d, 0x4b, 0xa0, 0x0,  0xe,  0x86, 0x54, 0x94, 0xe8,
                              0xc2, 0x84, 0x62, 0xda, 0xf,  0x45, 0xf1, 0x4c, 0x9c, 0xcc, 0xa9, 0x91, 0x58, 0x33, 0xfa};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ")\212\206\157>[\161\161\240\140\191\206", _password = Just
// "\175\183\193,\\>\244\ESCS\204\NULC\a\SOH\235\t\US\NAK\DC3", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "8m\ETB\253\&5\"\149h\193\210!\DC2\192\173\163\v\157\214z\231?", _willMsg =
// "~\239s\199\207\DLE\137)\195w\DEL\200D\166\195y\230\ETX\179\187\224\188\198@\212\ESC", _willProps = []}),
// _cleanSession = True, _keepAlive = 1137, _connID = "H\161", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x64, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x4,  0x71, 0x0,  0x2,  0x48,
                   0xa1, 0x0,  0x15, 0x38, 0x6d, 0x17, 0xfd, 0x35, 0x22, 0x95, 0x68, 0xc1, 0xd2, 0x21, 0x12,
                   0xc0, 0xad, 0xa3, 0xb,  0x9d, 0xd6, 0x7a, 0xe7, 0x3f, 0x0,  0x1a, 0x7e, 0xef, 0x73, 0xc7,
                   0xcf, 0x10, 0x89, 0x29, 0xc3, 0x77, 0x7f, 0xc8, 0x44, 0xa6, 0xc3, 0x79, 0xe6, 0x3,  0xb3,
                   0xbb, 0xe0, 0xbc, 0xc6, 0x40, 0xd4, 0x1b, 0x0,  0xc,  0x29, 0xd4, 0xce, 0x9d, 0x3e, 0x5b,
                   0xa1, 0xa1, 0xf0, 0x8c, 0xbf, 0xce, 0x0,  0x13, 0xaf, 0xb7, 0xc1, 0x2c, 0x5c, 0x3e, 0xf4,
                   0x1b, 0x53, 0xcc, 0x0,  0x43, 0x7,  0x1,  0xeb, 0x9,  0x1f, 0x15, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x38, 0x6d, 0x17, 0xfd, 0x35, 0x22, 0x95, 0x68, 0xc1, 0xd2, 0x21,
                                0x12, 0xc0, 0xad, 0xa3, 0xb,  0x9d, 0xd6, 0x7a, 0xe7, 0x3f};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7e, 0xef, 0x73, 0xc7, 0xcf, 0x10, 0x89, 0x29, 0xc3, 0x77, 0x7f, 0xc8, 0x44,
                                  0xa6, 0xc3, 0x79, 0xe6, 0x3,  0xb3, 0xbb, 0xe0, 0xbc, 0xc6, 0x40, 0xd4, 0x1b};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1137;
  uint8_t client_id_bytes[] = {0x48, 0xa1};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x29, 0xd4, 0xce, 0x9d, 0x3e, 0x5b, 0xa1, 0xa1, 0xf0, 0x8c, 0xbf, 0xce};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xaf, 0xb7, 0xc1, 0x2c, 0x5c, 0x3e, 0xf4, 0x1b, 0x53, 0xcc,
                              0x0,  0x43, 0x7,  0x1,  0xeb, 0x9,  0x1f, 0x15, 0x13};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\144", _password = Nothing, _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS2, _willTopic = "\ACKb<[2\a\182/h\252g\145S\156\179?6\NAK\232/\SO\241\213P\bk", _willMsg =
// "\EM\140\168c\240\ESC]:\250l\160>CT\DC4\ETB\209\DC2", _willProps = []}), _cleanSession = False, _keepAlive = 1187,
// _connID = "\162\135\139O\243\166\t(\204\167\213e\215\220d\185\n\149\233\144\b\218\229\235,", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x58, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x94, 0x4,  0xa3, 0x0,  0x19, 0xa2,
                   0x87, 0x8b, 0x4f, 0xf3, 0xa6, 0x9,  0x28, 0xcc, 0xa7, 0xd5, 0x65, 0xd7, 0xdc, 0x64, 0xb9,
                   0xa,  0x95, 0xe9, 0x90, 0x8,  0xda, 0xe5, 0xeb, 0x2c, 0x0,  0x1a, 0x6,  0x62, 0x3c, 0x5b,
                   0x32, 0x7,  0xb6, 0x2f, 0x68, 0xfc, 0x67, 0x91, 0x53, 0x9c, 0xb3, 0x3f, 0x36, 0x15, 0xe8,
                   0x2f, 0xe,  0xf1, 0xd5, 0x50, 0x8,  0x6b, 0x0,  0x12, 0x19, 0x8c, 0xa8, 0x63, 0xf0, 0x1b,
                   0x5d, 0x3a, 0xfa, 0x6c, 0xa0, 0x3e, 0x43, 0x54, 0x14, 0x17, 0xd1, 0x12, 0x0,  0x1,  0x90};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6,  0x62, 0x3c, 0x5b, 0x32, 0x7,  0xb6, 0x2f, 0x68, 0xfc, 0x67, 0x91, 0x53,
                                0x9c, 0xb3, 0x3f, 0x36, 0x15, 0xe8, 0x2f, 0xe,  0xf1, 0xd5, 0x50, 0x8,  0x6b};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x19, 0x8c, 0xa8, 0x63, 0xf0, 0x1b, 0x5d, 0x3a, 0xfa,
                                  0x6c, 0xa0, 0x3e, 0x43, 0x54, 0x14, 0x17, 0xd1, 0x12};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1187;
  uint8_t client_id_bytes[] = {0xa2, 0x87, 0x8b, 0x4f, 0xf3, 0xa6, 0x9,  0x28, 0xcc, 0xa7, 0xd5, 0x65, 0xd7,
                               0xdc, 0x64, 0xb9, 0xa,  0x95, 0xe9, 0x90, 0x8,  0xda, 0xe5, 0xeb, 0x2c};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x90};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "$`\SYN}79\139\SUB\138\ETX\146\rK\199\236*\DC2`D\178", _willMsg =
// "\146\226\241\226\SUB$6\236\236\SYN_\134\252\240\ACK\220_\158~\191\130\215\178", _willProps = []}), _cleanSession =
// False, _keepAlive = 6339, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x3b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x4,  0x18, 0xc3, 0x0,  0x0,  0x0,  0x14,
                   0x24, 0x60, 0x16, 0x7d, 0x37, 0x39, 0x8b, 0x1a, 0x8a, 0x3,  0x92, 0xd,  0x4b, 0xc7, 0xec, 0x2a,
                   0x12, 0x60, 0x44, 0xb2, 0x0,  0x17, 0x92, 0xe2, 0xf1, 0xe2, 0x1a, 0x24, 0x36, 0xec, 0xec, 0x16,
                   0x5f, 0x86, 0xfc, 0xf0, 0x6,  0xdc, 0x5f, 0x9e, 0x7e, 0xbf, 0x82, 0xd7, 0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x24, 0x60, 0x16, 0x7d, 0x37, 0x39, 0x8b, 0x1a, 0x8a, 0x3,
                                0x92, 0xd,  0x4b, 0xc7, 0xec, 0x2a, 0x12, 0x60, 0x44, 0xb2};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x92, 0xe2, 0xf1, 0xe2, 0x1a, 0x24, 0x36, 0xec, 0xec, 0x16, 0x5f, 0x86,
                                  0xfc, 0xf0, 0x6,  0xdc, 0x5f, 0x9e, 0x7e, 0xbf, 0x82, 0xd7, 0xb2};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6339;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\195\225Z\248\165S\201G\ne9\161>\FS\201_\239D\203\r", _password = Just
// "\230WH\211", _lastWill = Nothing, _cleanSession = False, _keepAlive = 22088, _connID = "nx\237\250`\150",
// _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x2e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x56, 0x48, 0x0,  0x6,  0x6e, 0x78,
                   0xed, 0xfa, 0x60, 0x96, 0x0,  0x14, 0xc3, 0xe1, 0x5a, 0xf8, 0xa5, 0x53, 0xc9, 0x47, 0xa,  0x65,
                   0x39, 0xa1, 0x3e, 0x1c, 0xc9, 0x5f, 0xef, 0x44, 0xcb, 0xd,  0x0,  0x4,  0xe6, 0x57, 0x48, 0xd3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 22088;
  uint8_t client_id_bytes[] = {0x6e, 0x78, 0xed, 0xfa, 0x60, 0x96};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc3, 0xe1, 0x5a, 0xf8, 0xa5, 0x53, 0xc9, 0x47, 0xa,  0x65,
                              0x39, 0xa1, 0x3e, 0x1c, 0xc9, 0x5f, 0xef, 0x44, 0xcb, 0xd};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe6, 0x57, 0x48, 0xd3};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "7{\215\177Q\252!\233\141P\206\242", _password = Just
// "\ETX\fegm\236K\157\249\140\DC3\144\186-9\156\238\222\167\138\202\SYN", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "j&\214\247\206Z\212\219\RS\US-,\155\190e!\\\142\GS\243X\241", _willMsg =
// "\SYN\183\156\207\209\215", _willProps = []}), _cleanSession = True, _keepAlive = 26306, _connID =
// "\SI&\208\136\142lJ|\nQ\231\&2,\161\FS\184", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x62, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x66, 0xc2, 0x0,  0x10, 0xf,  0x26, 0xd0,
                   0x88, 0x8e, 0x6c, 0x4a, 0x7c, 0xa,  0x51, 0xe7, 0x32, 0x2c, 0xa1, 0x1c, 0xb8, 0x0,  0x16, 0x6a, 0x26,
                   0xd6, 0xf7, 0xce, 0x5a, 0xd4, 0xdb, 0x1e, 0x1f, 0x2d, 0x2c, 0x9b, 0xbe, 0x65, 0x21, 0x5c, 0x8e, 0x1d,
                   0xf3, 0x58, 0xf1, 0x0,  0x6,  0x16, 0xb7, 0x9c, 0xcf, 0xd1, 0xd7, 0x0,  0xc,  0x37, 0x7b, 0xd7, 0xb1,
                   0x51, 0xfc, 0x21, 0xe9, 0x8d, 0x50, 0xce, 0xf2, 0x0,  0x16, 0x3,  0xc,  0x65, 0x67, 0x6d, 0xec, 0x4b,
                   0x9d, 0xf9, 0x8c, 0x13, 0x90, 0xba, 0x2d, 0x39, 0x9c, 0xee, 0xde, 0xa7, 0x8a, 0xca, 0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6a, 0x26, 0xd6, 0xf7, 0xce, 0x5a, 0xd4, 0xdb, 0x1e, 0x1f, 0x2d,
                                0x2c, 0x9b, 0xbe, 0x65, 0x21, 0x5c, 0x8e, 0x1d, 0xf3, 0x58, 0xf1};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x16, 0xb7, 0x9c, 0xcf, 0xd1, 0xd7};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26306;
  uint8_t client_id_bytes[] = {0xf, 0x26, 0xd0, 0x88, 0x8e, 0x6c, 0x4a, 0x7c,
                               0xa, 0x51, 0xe7, 0x32, 0x2c, 0xa1, 0x1c, 0xb8};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x37, 0x7b, 0xd7, 0xb1, 0x51, 0xfc, 0x21, 0xe9, 0x8d, 0x50, 0xce, 0xf2};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3,  0xc,  0x65, 0x67, 0x6d, 0xec, 0x4b, 0x9d, 0xf9, 0x8c, 0x13,
                              0x90, 0xba, 0x2d, 0x39, 0x9c, 0xee, 0xde, 0xa7, 0x8a, 0xca, 0x16};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\169\190fw\241\246)\vwT\139\DC3xx\216\189\225\158\213x\238\179\140", _password =
// Just "q\230-\213\ENQ5-T\188\DEL\b\213\155+\SO`m\GS \242\165#\\", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "\217 \214\EM\178\ACK\155", _willMsg =
// "\245)\238j2\DC2\161\134.\140\147HX\198`\252\237D\164\157*", _willProps = []}), _cleanSession = False, _keepAlive =
// 19404, _connID = "#f\162\233\167\DEL?\182\198\174aF\143S\150\160\186\DC2JqI\244\199\152\&3", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x77, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc4, 0x4b, 0xcc, 0x0,  0x19, 0x23, 0x66,
                   0xa2, 0xe9, 0xa7, 0x7f, 0x3f, 0xb6, 0xc6, 0xae, 0x61, 0x46, 0x8f, 0x53, 0x96, 0xa0, 0xba, 0x12,
                   0x4a, 0x71, 0x49, 0xf4, 0xc7, 0x98, 0x33, 0x0,  0x7,  0xd9, 0x20, 0xd6, 0x19, 0xb2, 0x6,  0x9b,
                   0x0,  0x15, 0xf5, 0x29, 0xee, 0x6a, 0x32, 0x12, 0xa1, 0x86, 0x2e, 0x8c, 0x93, 0x48, 0x58, 0xc6,
                   0x60, 0xfc, 0xed, 0x44, 0xa4, 0x9d, 0x2a, 0x0,  0x17, 0xa9, 0xbe, 0x66, 0x77, 0xf1, 0xf6, 0x29,
                   0xb,  0x77, 0x54, 0x8b, 0x13, 0x78, 0x78, 0xd8, 0xbd, 0xe1, 0x9e, 0xd5, 0x78, 0xee, 0xb3, 0x8c,
                   0x0,  0x17, 0x71, 0xe6, 0x2d, 0xd5, 0x5,  0x35, 0x2d, 0x54, 0xbc, 0x7f, 0x8,  0xd5, 0x9b, 0x2b,
                   0xe,  0x60, 0x6d, 0x1d, 0x20, 0xf2, 0xa5, 0x23, 0x5c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9, 0x20, 0xd6, 0x19, 0xb2, 0x6, 0x9b};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf5, 0x29, 0xee, 0x6a, 0x32, 0x12, 0xa1, 0x86, 0x2e, 0x8c, 0x93,
                                  0x48, 0x58, 0xc6, 0x60, 0xfc, 0xed, 0x44, 0xa4, 0x9d, 0x2a};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19404;
  uint8_t client_id_bytes[] = {0x23, 0x66, 0xa2, 0xe9, 0xa7, 0x7f, 0x3f, 0xb6, 0xc6, 0xae, 0x61, 0x46, 0x8f,
                               0x53, 0x96, 0xa0, 0xba, 0x12, 0x4a, 0x71, 0x49, 0xf4, 0xc7, 0x98, 0x33};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa9, 0xbe, 0x66, 0x77, 0xf1, 0xf6, 0x29, 0xb,  0x77, 0x54, 0x8b, 0x13,
                              0x78, 0x78, 0xd8, 0xbd, 0xe1, 0x9e, 0xd5, 0x78, 0xee, 0xb3, 0x8c};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x71, 0xe6, 0x2d, 0xd5, 0x5,  0x35, 0x2d, 0x54, 0xbc, 0x7f, 0x8, 0xd5,
                              0x9b, 0x2b, 0xe,  0x60, 0x6d, 0x1d, 0x20, 0xf2, 0xa5, 0x23, 0x5c};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SIu}\231\235\&7\157S\163\235u\157\206\215Gn\180\152\STX\142\225\150\&0\244B0",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\173\184D\250<\252,\186c\146\178T!\ETXkKR\SO\139\253\&6", _willMsg = "h\144\228&\249\240u\248L", _willProps = []}),
// _cleanSession = True, _keepAlive = 14654, _connID =
// "b!\199C\NAK8m\183\ETB\162\161\131\255\f\236\203\165\189\153\b\v\b\ACK", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x61, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xa6, 0x39, 0x3e, 0x0,  0x17, 0x62, 0x21, 0xc7,
                   0x43, 0x15, 0x38, 0x6d, 0xb7, 0x17, 0xa2, 0xa1, 0x83, 0xff, 0xc,  0xec, 0xcb, 0xa5, 0xbd, 0x99, 0x8,
                   0xb,  0x8,  0x6,  0x0,  0x15, 0xad, 0xb8, 0x44, 0xfa, 0x3c, 0xfc, 0x2c, 0xba, 0x63, 0x92, 0xb2, 0x54,
                   0x21, 0x3,  0x6b, 0x4b, 0x52, 0xe,  0x8b, 0xfd, 0x36, 0x0,  0x9,  0x68, 0x90, 0xe4, 0x26, 0xf9, 0xf0,
                   0x75, 0xf8, 0x4c, 0x0,  0x1a, 0xf,  0x75, 0x7d, 0xe7, 0xeb, 0x37, 0x9d, 0x53, 0xa3, 0xeb, 0x75, 0x9d,
                   0xce, 0xd7, 0x47, 0x6e, 0xb4, 0x98, 0x2,  0x8e, 0xe1, 0x96, 0x30, 0xf4, 0x42, 0x30};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xad, 0xb8, 0x44, 0xfa, 0x3c, 0xfc, 0x2c, 0xba, 0x63, 0x92, 0xb2,
                                0x54, 0x21, 0x3,  0x6b, 0x4b, 0x52, 0xe,  0x8b, 0xfd, 0x36};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x68, 0x90, 0xe4, 0x26, 0xf9, 0xf0, 0x75, 0xf8, 0x4c};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14654;
  uint8_t client_id_bytes[] = {0x62, 0x21, 0xc7, 0x43, 0x15, 0x38, 0x6d, 0xb7, 0x17, 0xa2, 0xa1, 0x83,
                               0xff, 0xc,  0xec, 0xcb, 0xa5, 0xbd, 0x99, 0x8,  0xb,  0x8,  0x6};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf,  0x75, 0x7d, 0xe7, 0xeb, 0x37, 0x9d, 0x53, 0xa3, 0xeb, 0x75, 0x9d, 0xce,
                              0xd7, 0x47, 0x6e, 0xb4, 0x98, 0x2,  0x8e, 0xe1, 0x96, 0x30, 0xf4, 0x42, 0x30};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "E\233Y!;0\183X\172\237\237\252\&9\t,\DC2\221d^", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\131\ETX\211$\DC4\162\130\183\SUB\187Y\238\196\ETB6", _willMsg = "\242\214\200\\7w\209dKcE\a\130\206\ACKsj\171\t",
// _willProps = []}), _cleanSession = True, _keepAlive = 9686, _connID = "\242\&1\174", _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x35, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x25, 0xd6, 0x0,  0x3,
                   0xf2, 0x31, 0xae, 0x0,  0xf,  0x83, 0x3,  0xd3, 0x24, 0x14, 0xa2, 0x82, 0xb7, 0x1a,
                   0xbb, 0x59, 0xee, 0xc4, 0x17, 0x36, 0x0,  0x13, 0xf2, 0xd6, 0xc8, 0x5c, 0x37, 0x77,
                   0xd1, 0x64, 0x4b, 0x63, 0x45, 0x7,  0x82, 0xce, 0x6,  0x73, 0x6a, 0xab, 0x9};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x83, 0x3,  0xd3, 0x24, 0x14, 0xa2, 0x82, 0xb7,
                                0x1a, 0xbb, 0x59, 0xee, 0xc4, 0x17, 0x36};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf2, 0xd6, 0xc8, 0x5c, 0x37, 0x77, 0xd1, 0x64, 0x4b, 0x63,
                                  0x45, 0x7,  0x82, 0xce, 0x6,  0x73, 0x6a, 0xab, 0x9};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 9686;
  uint8_t client_id_bytes[] = {0xf2, 0x31, 0xae};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x45, 0xe9, 0x59, 0x21, 0x3b, 0x30, 0xb7, 0x58, 0xac, 0xed,
                              0xed, 0xfc, 0x39, 0x9,  0x2c, 0x12, 0xdd, 0x64, 0x5e};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\133\RS\ACKX^\249Y\190\f(u\241", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "-\244b\239\\\168\251\255\247\DC2\234\150\&8\242", _willMsg =
// "\GS\ACK\135\190\RS\238", _willProps = []}), _cleanSession = True, _keepAlive = 7105, _connID =
// "xW\GSn\170\158vUz\227\172\SI\145Z2\174\&2\235G\137\154\141F\204", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x4a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x96, 0x1b, 0xc1, 0x0,  0x18, 0x78, 0x57,
                   0x1d, 0x6e, 0xaa, 0x9e, 0x76, 0x55, 0x7a, 0xe3, 0xac, 0xf,  0x91, 0x5a, 0x32, 0xae, 0x32, 0xeb,
                   0x47, 0x89, 0x9a, 0x8d, 0x46, 0xcc, 0x0,  0xe,  0x2d, 0xf4, 0x62, 0xef, 0x5c, 0xa8, 0xfb, 0xff,
                   0xf7, 0x12, 0xea, 0x96, 0x38, 0xf2, 0x0,  0x6,  0x1d, 0x6,  0x87, 0xbe, 0x1e, 0xee, 0x0,  0xc,
                   0x85, 0x1e, 0x6,  0x58, 0x5e, 0xf9, 0x59, 0xbe, 0xc,  0x28, 0x75, 0xf1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2d, 0xf4, 0x62, 0xef, 0x5c, 0xa8, 0xfb, 0xff, 0xf7, 0x12, 0xea, 0x96, 0x38, 0xf2};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1d, 0x6, 0x87, 0xbe, 0x1e, 0xee};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7105;
  uint8_t client_id_bytes[] = {0x78, 0x57, 0x1d, 0x6e, 0xaa, 0x9e, 0x76, 0x55, 0x7a, 0xe3, 0xac, 0xf,
                               0x91, 0x5a, 0x32, 0xae, 0x32, 0xeb, 0x47, 0x89, 0x9a, 0x8d, 0x46, 0xcc};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x85, 0x1e, 0x6, 0x58, 0x5e, 0xf9, 0x59, 0xbe, 0xc, 0x28, 0x75, 0xf1};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\178\221\248C\139\&8F", _password = Just
// "_\CAN\208w\239\n\FS*\168*U\US\DC1\146\ETX\150\DC2\SO\244E", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 27717, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x2b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x6c, 0x45, 0x0,  0x0,  0x0,
                   0x7,  0xb2, 0xdd, 0xf8, 0x43, 0x8b, 0x38, 0x46, 0x0,  0x14, 0x5f, 0x18, 0xd0, 0x77, 0xef,
                   0xa,  0x1c, 0x2a, 0xa8, 0x2a, 0x55, 0x1f, 0x11, 0x92, 0x3,  0x96, 0x12, 0xe,  0xf4, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27717;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb2, 0xdd, 0xf8, 0x43, 0x8b, 0x38, 0x46};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5f, 0x18, 0xd0, 0x77, 0xef, 0xa,  0x1c, 0x2a, 0xa8, 0x2a,
                              0x55, 0x1f, 0x11, 0x92, 0x3,  0x96, 0x12, 0xe,  0xf4, 0x45};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J\158\167\177\&3=j\176\214\201\193\&6w\169}", _password = Just
// "aA\246Ml\170b\195\217\197\232\210\143/A\222\200\147", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 16521, _connID = "\186\RS\SYN\164\190\223\&0\237:(\242m\129\163\SIz\146x~R\202Dc\184\223\169\230\163", _properties =
// []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x4d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x40, 0x89, 0x0,  0x1c, 0xba, 0x1e,
                   0x16, 0xa4, 0xbe, 0xdf, 0x30, 0xed, 0x3a, 0x28, 0xf2, 0x6d, 0x81, 0xa3, 0xf,  0x7a, 0x92, 0x78,
                   0x7e, 0x52, 0xca, 0x44, 0x63, 0xb8, 0xdf, 0xa9, 0xe6, 0xa3, 0x0,  0xf,  0x4a, 0x9e, 0xa7, 0xb1,
                   0x33, 0x3d, 0x6a, 0xb0, 0xd6, 0xc9, 0xc1, 0x36, 0x77, 0xa9, 0x7d, 0x0,  0x12, 0x61, 0x41, 0xf6,
                   0x4d, 0x6c, 0xaa, 0x62, 0xc3, 0xd9, 0xc5, 0xe8, 0xd2, 0x8f, 0x2f, 0x41, 0xde, 0xc8, 0x93};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 16521;
  uint8_t client_id_bytes[] = {0xba, 0x1e, 0x16, 0xa4, 0xbe, 0xdf, 0x30, 0xed, 0x3a, 0x28, 0xf2, 0x6d, 0x81, 0xa3,
                               0xf,  0x7a, 0x92, 0x78, 0x7e, 0x52, 0xca, 0x44, 0x63, 0xb8, 0xdf, 0xa9, 0xe6, 0xa3};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x9e, 0xa7, 0xb1, 0x33, 0x3d, 0x6a, 0xb0, 0xd6, 0xc9, 0xc1, 0x36, 0x77, 0xa9, 0x7d};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x61, 0x41, 0xf6, 0x4d, 0x6c, 0xaa, 0x62, 0xc3, 0xd9,
                              0xc5, 0xe8, 0xd2, 0x8f, 0x2f, 0x41, 0xde, 0xc8, 0x93};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J\SOHI-\a)\244e", _password = Just
// "o\249\n\239J\249D>\131\239\242>\206\FS\195\145\176\134\EM4", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\254", _willMsg = "\ETXm\199\156Oznd*\US\135*", _willProps = []}), _cleanSession =
// True, _keepAlive = 17571, _connID = "}\227/\252\245n]F\190\242|\141\194\180\DLE\194\190\226W", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x50, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x44, 0xa3, 0x0,  0x13, 0x7d, 0xe3, 0x2f,
                   0xfc, 0xf5, 0x6e, 0x5d, 0x46, 0xbe, 0xf2, 0x7c, 0x8d, 0xc2, 0xb4, 0x10, 0xc2, 0xbe, 0xe2, 0x57, 0x0,
                   0x1,  0xfe, 0x0,  0xc,  0x3,  0x6d, 0xc7, 0x9c, 0x4f, 0x7a, 0x6e, 0x64, 0x2a, 0x1f, 0x87, 0x2a, 0x0,
                   0x8,  0x4a, 0x1,  0x49, 0x2d, 0x7,  0x29, 0xf4, 0x65, 0x0,  0x14, 0x6f, 0xf9, 0xa,  0xef, 0x4a, 0xf9,
                   0x44, 0x3e, 0x83, 0xef, 0xf2, 0x3e, 0xce, 0x1c, 0xc3, 0x91, 0xb0, 0x86, 0x19, 0x34};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfe};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3, 0x6d, 0xc7, 0x9c, 0x4f, 0x7a, 0x6e, 0x64, 0x2a, 0x1f, 0x87, 0x2a};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17571;
  uint8_t client_id_bytes[] = {0x7d, 0xe3, 0x2f, 0xfc, 0xf5, 0x6e, 0x5d, 0x46, 0xbe, 0xf2,
                               0x7c, 0x8d, 0xc2, 0xb4, 0x10, 0xc2, 0xbe, 0xe2, 0x57};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x1, 0x49, 0x2d, 0x7, 0x29, 0xf4, 0x65};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6f, 0xf9, 0xa,  0xef, 0x4a, 0xf9, 0x44, 0x3e, 0x83, 0xef,
                              0xf2, 0x3e, 0xce, 0x1c, 0xc3, 0x91, 0xb0, 0x86, 0x19, 0x34};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\185\234\165\192W\204egO", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\254\234\SUB6\251\190\216\209\209\149\ETX\168\240\240\209\216\198rh\ETX\182!\187\172\232D", _willMsg =
// "\178\150\146w\234\131bw", _willProps = []}), _cleanSession = True, _keepAlive = 26206, _connID =
// "\225\SOY\244\214&\"\224\224\202\NAK\196\174", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x3f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x66, 0x5e, 0x0,  0xd,  0xe1, 0xe,  0x59,
                   0xf4, 0xd6, 0x26, 0x22, 0xe0, 0xe0, 0xca, 0x15, 0xc4, 0xae, 0x0,  0x1a, 0xfe, 0xea, 0x1a, 0x36, 0xfb,
                   0xbe, 0xd8, 0xd1, 0xd1, 0x95, 0x3,  0xa8, 0xf0, 0xf0, 0xd1, 0xd8, 0xc6, 0x72, 0x68, 0x3,  0xb6, 0x21,
                   0xbb, 0xac, 0xe8, 0x44, 0x0,  0x8,  0xb2, 0x96, 0x92, 0x77, 0xea, 0x83, 0x62, 0x77};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfe, 0xea, 0x1a, 0x36, 0xfb, 0xbe, 0xd8, 0xd1, 0xd1, 0x95, 0x3,  0xa8, 0xf0,
                                0xf0, 0xd1, 0xd8, 0xc6, 0x72, 0x68, 0x3,  0xb6, 0x21, 0xbb, 0xac, 0xe8, 0x44};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb2, 0x96, 0x92, 0x77, 0xea, 0x83, 0x62, 0x77};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26206;
  uint8_t client_id_bytes[] = {0xe1, 0xe, 0x59, 0xf4, 0xd6, 0x26, 0x22, 0xe0, 0xe0, 0xca, 0x15, 0xc4, 0xae};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb9, 0xea, 0xa5, 0xc0, 0x57, 0xcc, 0x65, 0x67, 0x4f};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\204\&9\146\248Z\193\151\237F\231u\205\207?\138\180*}\164\191\"\DEL\198$\DC3",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\DC2L", _willMsg
// = "\187\173\179\182\226\182\159\197\SO<\158\197/\170\130\157\210\201\222", _willProps = []}), _cleanSession = False,
// _keepAlive = 15691, _connID = ",\205\DC2;&\213%\165D\167", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x4a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x84, 0x3d, 0x4b, 0x0,  0xa,  0x2c, 0xcd,
                   0x12, 0x3b, 0x26, 0xd5, 0x25, 0xa5, 0x44, 0xa7, 0x0,  0x2,  0x12, 0x4c, 0x0,  0x13, 0xbb, 0xad,
                   0xb3, 0xb6, 0xe2, 0xb6, 0x9f, 0xc5, 0xe,  0x3c, 0x9e, 0xc5, 0x2f, 0xaa, 0x82, 0x9d, 0xd2, 0xc9,
                   0xde, 0x0,  0x19, 0xcc, 0x39, 0x92, 0xf8, 0x5a, 0xc1, 0x97, 0xed, 0x46, 0xe7, 0x75, 0xcd, 0xcf,
                   0x3f, 0x8a, 0xb4, 0x2a, 0x7d, 0xa4, 0xbf, 0x22, 0x7f, 0xc6, 0x24, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x12, 0x4c};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbb, 0xad, 0xb3, 0xb6, 0xe2, 0xb6, 0x9f, 0xc5, 0xe, 0x3c,
                                  0x9e, 0xc5, 0x2f, 0xaa, 0x82, 0x9d, 0xd2, 0xc9, 0xde};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15691;
  uint8_t client_id_bytes[] = {0x2c, 0xcd, 0x12, 0x3b, 0x26, 0xd5, 0x25, 0xa5, 0x44, 0xa7};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcc, 0x39, 0x92, 0xf8, 0x5a, 0xc1, 0x97, 0xed, 0x46, 0xe7, 0x75, 0xcd, 0xcf,
                              0x3f, 0x8a, 0xb4, 0x2a, 0x7d, 0xa4, 0xbf, 0x22, 0x7f, 0xc6, 0x24, 0x13};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "T>\158;\152\162\180\181\207:\ETB{u\142\245\154\140w", _password = Just
// "\220\STXp\210}\178\179y\171", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "\187\ACK\FS\183\136\196\202@\150G&%;\224\149\140\ETB\223] \145\&61:y\199", _willMsg = "\218\200
// \235O\SYN\vs\250\233G\156\217.\200\235x\198r\202fF\SUB\147\252\255\197", _willProps = []}), _cleanSession = True,
// _keepAlive = 7593, _connID = "-e~\r", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x68, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x1d, 0xa9, 0x0,  0x4,  0x2d, 0x65,
                   0x7e, 0xd,  0x0,  0x1a, 0xbb, 0x6,  0x1c, 0xb7, 0x88, 0xc4, 0xca, 0x40, 0x96, 0x47, 0x26, 0x25,
                   0x3b, 0xe0, 0x95, 0x8c, 0x17, 0xdf, 0x5d, 0x20, 0x91, 0x36, 0x31, 0x3a, 0x79, 0xc7, 0x0,  0x1b,
                   0xda, 0xc8, 0x20, 0xeb, 0x4f, 0x16, 0xb,  0x73, 0xfa, 0xe9, 0x47, 0x9c, 0xd9, 0x2e, 0xc8, 0xeb,
                   0x78, 0xc6, 0x72, 0xca, 0x66, 0x46, 0x1a, 0x93, 0xfc, 0xff, 0xc5, 0x0,  0x12, 0x54, 0x3e, 0x9e,
                   0x3b, 0x98, 0xa2, 0xb4, 0xb5, 0xcf, 0x3a, 0x17, 0x7b, 0x75, 0x8e, 0xf5, 0x9a, 0x8c, 0x77, 0x0,
                   0x9,  0xdc, 0x2,  0x70, 0xd2, 0x7d, 0xb2, 0xb3, 0x79, 0xab};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbb, 0x6,  0x1c, 0xb7, 0x88, 0xc4, 0xca, 0x40, 0x96, 0x47, 0x26, 0x25, 0x3b,
                                0xe0, 0x95, 0x8c, 0x17, 0xdf, 0x5d, 0x20, 0x91, 0x36, 0x31, 0x3a, 0x79, 0xc7};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xda, 0xc8, 0x20, 0xeb, 0x4f, 0x16, 0xb,  0x73, 0xfa, 0xe9, 0x47, 0x9c, 0xd9, 0x2e,
                                  0xc8, 0xeb, 0x78, 0xc6, 0x72, 0xca, 0x66, 0x46, 0x1a, 0x93, 0xfc, 0xff, 0xc5};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7593;
  uint8_t client_id_bytes[] = {0x2d, 0x65, 0x7e, 0xd};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x54, 0x3e, 0x9e, 0x3b, 0x98, 0xa2, 0xb4, 0xb5, 0xcf,
                              0x3a, 0x17, 0x7b, 0x75, 0x8e, 0xf5, 0x9a, 0x8c, 0x77};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdc, 0x2, 0x70, 0xd2, 0x7d, 0xb2, 0xb3, 0x79, 0xab};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "/O\134\NAKdJ", _password = Just
// "\196\156\220\155\135\182\vb\vM\183\205\156r\135f`\148\245\162\148\&5\243`G\196\184*\154", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 23419, _connID = "\138\r,\181sl\193\231\232\198\"\231/\251W\218!s", _properties =
// []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x45, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x5b, 0x7b, 0x0,  0x12, 0x8a,
                   0xd,  0x2c, 0xb5, 0x73, 0x6c, 0xc1, 0xe7, 0xe8, 0xc6, 0x22, 0xe7, 0x2f, 0xfb, 0x57, 0xda,
                   0x21, 0x73, 0x0,  0x6,  0x2f, 0x4f, 0x86, 0x15, 0x64, 0x4a, 0x0,  0x1d, 0xc4, 0x9c, 0xdc,
                   0x9b, 0x87, 0xb6, 0xb,  0x62, 0xb,  0x4d, 0xb7, 0xcd, 0x9c, 0x72, 0x87, 0x66, 0x60, 0x94,
                   0xf5, 0xa2, 0x94, 0x35, 0xf3, 0x60, 0x47, 0xc4, 0xb8, 0x2a, 0x9a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23419;
  uint8_t client_id_bytes[] = {0x8a, 0xd,  0x2c, 0xb5, 0x73, 0x6c, 0xc1, 0xe7, 0xe8,
                               0xc6, 0x22, 0xe7, 0x2f, 0xfb, 0x57, 0xda, 0x21, 0x73};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2f, 0x4f, 0x86, 0x15, 0x64, 0x4a};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc4, 0x9c, 0xdc, 0x9b, 0x87, 0xb6, 0xb,  0x62, 0xb,  0x4d, 0xb7, 0xcd, 0x9c, 0x72, 0x87,
                              0x66, 0x60, 0x94, 0xf5, 0xa2, 0x94, 0x35, 0xf3, 0x60, 0x47, 0xc4, 0xb8, 0x2a, 0x9a};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\247\SI;~\246\226", _password = Just
// "\182\193\204\184\SI\251\239\221G\188,\207\181\222\169\DC2a\166\156\180\a\253\242", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\149\199O\138Vs\224&_\202\180\SYN\148\241G3\232\196)$~\216\157\181\176!", _willMsg =
// "_\241\DC4V97\239\206\170C\b\207\&9\170\141\GS3\216\234\DC4\141", _willProps = []}), _cleanSession = True, _keepAlive
// = 7, _connID = "G\\kY\SOH\242", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x66, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x0,  0x7,  0x0,  0x6,  0x47,
                   0x5c, 0x6b, 0x59, 0x1,  0xf2, 0x0,  0x1a, 0x95, 0xc7, 0x4f, 0x8a, 0x56, 0x73, 0xe0, 0x26,
                   0x5f, 0xca, 0xb4, 0x16, 0x94, 0xf1, 0x47, 0x33, 0xe8, 0xc4, 0x29, 0x24, 0x7e, 0xd8, 0x9d,
                   0xb5, 0xb0, 0x21, 0x0,  0x15, 0x5f, 0xf1, 0x14, 0x56, 0x39, 0x37, 0xef, 0xce, 0xaa, 0x43,
                   0x8,  0xcf, 0x39, 0xaa, 0x8d, 0x1d, 0x33, 0xd8, 0xea, 0x14, 0x8d, 0x0,  0x6,  0xf7, 0xf,
                   0x3b, 0x7e, 0xf6, 0xe2, 0x0,  0x17, 0xb6, 0xc1, 0xcc, 0xb8, 0xf,  0xfb, 0xef, 0xdd, 0x47,
                   0xbc, 0x2c, 0xcf, 0xb5, 0xde, 0xa9, 0x12, 0x61, 0xa6, 0x9c, 0xb4, 0x7,  0xfd, 0xf2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x95, 0xc7, 0x4f, 0x8a, 0x56, 0x73, 0xe0, 0x26, 0x5f, 0xca, 0xb4, 0x16, 0x94,
                                0xf1, 0x47, 0x33, 0xe8, 0xc4, 0x29, 0x24, 0x7e, 0xd8, 0x9d, 0xb5, 0xb0, 0x21};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5f, 0xf1, 0x14, 0x56, 0x39, 0x37, 0xef, 0xce, 0xaa, 0x43, 0x8,
                                  0xcf, 0x39, 0xaa, 0x8d, 0x1d, 0x33, 0xd8, 0xea, 0x14, 0x8d};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7;
  uint8_t client_id_bytes[] = {0x47, 0x5c, 0x6b, 0x59, 0x1, 0xf2};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf7, 0xf, 0x3b, 0x7e, 0xf6, 0xe2};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb6, 0xc1, 0xcc, 0xb8, 0xf,  0xfb, 0xef, 0xdd, 0x47, 0xbc, 0x2c, 0xcf,
                              0xb5, 0xde, 0xa9, 0x12, 0x61, 0xa6, 0x9c, 0xb4, 0x7,  0xfd, 0xf2};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "{?~\139\226tEG\tA\FSI\236\230e<\SOH", _password = Just
// "\203)t\136\")\169\SID\246\237\158\241\231\162>!\140", _lastWill = Nothing, _cleanSession = True, _keepAlive = 8810,
// _connID = "n\253\208>\v\187pU\197NY\228\&5w!\237\179\179\SI\213", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x47, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x22, 0x6a, 0x0,  0x14, 0x6e,
                   0xfd, 0xd0, 0x3e, 0xb,  0xbb, 0x70, 0x55, 0xc5, 0x4e, 0x59, 0xe4, 0x35, 0x77, 0x21, 0xed,
                   0xb3, 0xb3, 0xf,  0xd5, 0x0,  0x11, 0x7b, 0x3f, 0x7e, 0x8b, 0xe2, 0x74, 0x45, 0x47, 0x9,
                   0x41, 0x1c, 0x49, 0xec, 0xe6, 0x65, 0x3c, 0x1,  0x0,  0x12, 0xcb, 0x29, 0x74, 0x88, 0x22,
                   0x29, 0xa9, 0xf,  0x44, 0xf6, 0xed, 0x9e, 0xf1, 0xe7, 0xa2, 0x3e, 0x21, 0x8c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8810;
  uint8_t client_id_bytes[] = {0x6e, 0xfd, 0xd0, 0x3e, 0xb,  0xbb, 0x70, 0x55, 0xc5, 0x4e,
                               0x59, 0xe4, 0x35, 0x77, 0x21, 0xed, 0xb3, 0xb3, 0xf,  0xd5};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7b, 0x3f, 0x7e, 0x8b, 0xe2, 0x74, 0x45, 0x47, 0x9,
                              0x41, 0x1c, 0x49, 0xec, 0xe6, 0x65, 0x3c, 0x1};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcb, 0x29, 0x74, 0x88, 0x22, 0x29, 0xa9, 0xf,  0x44,
                              0xf6, 0xed, 0x9e, 0xf1, 0xe7, 0xa2, 0x3e, 0x21, 0x8c};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\132\241o\219m\247lL]\193i\175", _password = Just "\CANv\229k\211\205", _lastWill =
// Nothing, _cleanSession = True, _keepAlive = 7935, _connID = "\ETB\208H\169\248J\183R\169p\FS\190\DEL\182~\SYN",
// _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x32, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x1e, 0xff, 0x0,
                   0x10, 0x17, 0xd0, 0x48, 0xa9, 0xf8, 0x4a, 0xb7, 0x52, 0xa9, 0x70, 0x1c, 0xbe,
                   0x7f, 0xb6, 0x7e, 0x16, 0x0,  0xc,  0x84, 0xf1, 0x6f, 0xdb, 0x6d, 0xf7, 0x6c,
                   0x4c, 0x5d, 0xc1, 0x69, 0xaf, 0x0,  0x6,  0x18, 0x76, 0xe5, 0x6b, 0xd3, 0xcd};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7935;
  uint8_t client_id_bytes[] = {0x17, 0xd0, 0x48, 0xa9, 0xf8, 0x4a, 0xb7, 0x52,
                               0xa9, 0x70, 0x1c, 0xbe, 0x7f, 0xb6, 0x7e, 0x16};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x84, 0xf1, 0x6f, 0xdb, 0x6d, 0xf7, 0x6c, 0x4c, 0x5d, 0xc1, 0x69, 0xaf};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x76, 0xe5, 0x6b, 0xd3, 0xcd};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "d\140\&3,\181\151\SI[\ACK\153\237\181<<\225\185\SO", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "N\173\211", _willMsg = "c\251\173\SOHT\f\251",
// _willProps = []}), _cleanSession = True, _keepAlive = 10911, _connID = "\137\138\233WV \249\146:\152V\141\176'z",
// _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x29, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x6,  0x2a, 0x9f, 0x0,  0xf,  0x89,
                   0x8a, 0xe9, 0x57, 0x56, 0x20, 0xf9, 0x92, 0x3a, 0x98, 0x56, 0x8d, 0xb0, 0x27, 0x7a, 0x0,
                   0x3,  0x4e, 0xad, 0xd3, 0x0,  0x7,  0x63, 0xfb, 0xad, 0x1,  0x54, 0xc,  0xfb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4e, 0xad, 0xd3};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x63, 0xfb, 0xad, 0x1, 0x54, 0xc, 0xfb};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10911;
  uint8_t client_id_bytes[] = {0x89, 0x8a, 0xe9, 0x57, 0x56, 0x20, 0xf9, 0x92,
                               0x3a, 0x98, 0x56, 0x8d, 0xb0, 0x27, 0x7a};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x64, 0x8c, 0x33, 0x2c, 0xb5, 0x97, 0xf,  0x5b, 0x6,
                              0x99, 0xed, 0xb5, 0x3c, 0x3c, 0xe1, 0xb9, 0xe};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\190\254\vG\140\DLEq\206\199\&1\235y\135a\b", _password = Just
// "(\ESC\DC14\172tH/\136\240\225", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "'\SOH\141M", _willMsg = "\199I\t\155\SOHg\135,\200F\135\EM;\233J\152\NAK\ESCD\SUB\t\193M\DEL\220^\163\214",
// _willProps = []}), _cleanSession = True, _keepAlive = 14063, _connID =
// "\137\196\DC1\230\"\199\249,\241\a\f\239\159\223\170N\240\248\184\172", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x62, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x36, 0xef, 0x0,  0x14, 0x89, 0xc4, 0x11,
                   0xe6, 0x22, 0xc7, 0xf9, 0x2c, 0xf1, 0x7,  0xc,  0xef, 0x9f, 0xdf, 0xaa, 0x4e, 0xf0, 0xf8, 0xb8, 0xac,
                   0x0,  0x4,  0x27, 0x1,  0x8d, 0x4d, 0x0,  0x1c, 0xc7, 0x49, 0x9,  0x9b, 0x1,  0x67, 0x87, 0x2c, 0xc8,
                   0x46, 0x87, 0x19, 0x3b, 0xe9, 0x4a, 0x98, 0x15, 0x1b, 0x44, 0x1a, 0x9,  0xc1, 0x4d, 0x7f, 0xdc, 0x5e,
                   0xa3, 0xd6, 0x0,  0xf,  0xbe, 0xfe, 0xb,  0x47, 0x8c, 0x10, 0x71, 0xce, 0xc7, 0x31, 0xeb, 0x79, 0x87,
                   0x61, 0x8,  0x0,  0xb,  0x28, 0x1b, 0x11, 0x34, 0xac, 0x74, 0x48, 0x2f, 0x88, 0xf0, 0xe1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x27, 0x1, 0x8d, 0x4d};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc7, 0x49, 0x9,  0x9b, 0x1,  0x67, 0x87, 0x2c, 0xc8, 0x46, 0x87, 0x19, 0x3b, 0xe9,
                                  0x4a, 0x98, 0x15, 0x1b, 0x44, 0x1a, 0x9,  0xc1, 0x4d, 0x7f, 0xdc, 0x5e, 0xa3, 0xd6};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14063;
  uint8_t client_id_bytes[] = {0x89, 0xc4, 0x11, 0xe6, 0x22, 0xc7, 0xf9, 0x2c, 0xf1, 0x7,
                               0xc,  0xef, 0x9f, 0xdf, 0xaa, 0x4e, 0xf0, 0xf8, 0xb8, 0xac};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbe, 0xfe, 0xb, 0x47, 0x8c, 0x10, 0x71, 0xce, 0xc7, 0x31, 0xeb, 0x79, 0x87, 0x61, 0x8};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x28, 0x1b, 0x11, 0x34, 0xac, 0x74, 0x48, 0x2f, 0x88, 0xf0, 0xe1};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%\DC3/-\bG2\192\137\196&\128\209\143\235\SI\201\&6\r\216vK\196dI\195\144G",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\132~x\156KS\246y\137\249\SYN\154%\145\149T\195\188", _willMsg =
// "X\195\&0\237\DC1l\222\ETX\219\&9\128\"\210/\254\243Q\204\169^H", _willProps = []}), _cleanSession = False,
// _keepAlive = 9629, _connID = "u\226c\130\167Y\128L\255\&1\SI\232\190", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x62, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xa4, 0x25, 0x9d, 0x0,  0xd,  0x75, 0xe2, 0x63,
                   0x82, 0xa7, 0x59, 0x80, 0x4c, 0xff, 0x31, 0xf,  0xe8, 0xbe, 0x0,  0x12, 0x84, 0x7e, 0x78, 0x9c, 0x4b,
                   0x53, 0xf6, 0x79, 0x89, 0xf9, 0x16, 0x9a, 0x25, 0x91, 0x95, 0x54, 0xc3, 0xbc, 0x0,  0x15, 0x58, 0xc3,
                   0x30, 0xed, 0x11, 0x6c, 0xde, 0x3,  0xdb, 0x39, 0x80, 0x22, 0xd2, 0x2f, 0xfe, 0xf3, 0x51, 0xcc, 0xa9,
                   0x5e, 0x48, 0x0,  0x1c, 0x25, 0x13, 0x2f, 0x2d, 0x8,  0x47, 0x32, 0xc0, 0x89, 0xc4, 0x26, 0x80, 0xd1,
                   0x8f, 0xeb, 0xf,  0xc9, 0x36, 0xd,  0xd8, 0x76, 0x4b, 0xc4, 0x64, 0x49, 0xc3, 0x90, 0x47};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x84, 0x7e, 0x78, 0x9c, 0x4b, 0x53, 0xf6, 0x79, 0x89,
                                0xf9, 0x16, 0x9a, 0x25, 0x91, 0x95, 0x54, 0xc3, 0xbc};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x58, 0xc3, 0x30, 0xed, 0x11, 0x6c, 0xde, 0x3,  0xdb, 0x39, 0x80,
                                  0x22, 0xd2, 0x2f, 0xfe, 0xf3, 0x51, 0xcc, 0xa9, 0x5e, 0x48};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9629;
  uint8_t client_id_bytes[] = {0x75, 0xe2, 0x63, 0x82, 0xa7, 0x59, 0x80, 0x4c, 0xff, 0x31, 0xf, 0xe8, 0xbe};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x13, 0x2f, 0x2d, 0x8, 0x47, 0x32, 0xc0, 0x89, 0xc4, 0x26, 0x80, 0xd1, 0x8f,
                              0xeb, 0xf,  0xc9, 0x36, 0xd, 0xd8, 0x76, 0x4b, 0xc4, 0x64, 0x49, 0xc3, 0x90, 0x47};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "A\215\192x\237\STX\181-", _password = Just "\148", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\222\FS4[\199l\134\149\221T_=\130G\192\&4\179\205S>O", _willMsg
// = "\244\177\ETB\252l\159# _\EM\n<C\133\163", _willProps = []}), _cleanSession = False, _keepAlive = 4049, _connID =
// "\209\185#Y\198\163T\169S\ETX", _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x4b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0xf,  0xd1, 0x0,  0xa,  0xd1, 0xb9,
                   0x23, 0x59, 0xc6, 0xa3, 0x54, 0xa9, 0x53, 0x3,  0x0,  0x15, 0xde, 0x1c, 0x34, 0x5b, 0xc7, 0x6c,
                   0x86, 0x95, 0xdd, 0x54, 0x5f, 0x3d, 0x82, 0x47, 0xc0, 0x34, 0xb3, 0xcd, 0x53, 0x3e, 0x4f, 0x0,
                   0xf,  0xf4, 0xb1, 0x17, 0xfc, 0x6c, 0x9f, 0x23, 0x20, 0x5f, 0x19, 0xa,  0x3c, 0x43, 0x85, 0xa3,
                   0x0,  0x8,  0x41, 0xd7, 0xc0, 0x78, 0xed, 0x2,  0xb5, 0x2d, 0x0,  0x1,  0x94};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xde, 0x1c, 0x34, 0x5b, 0xc7, 0x6c, 0x86, 0x95, 0xdd, 0x54, 0x5f,
                                0x3d, 0x82, 0x47, 0xc0, 0x34, 0xb3, 0xcd, 0x53, 0x3e, 0x4f};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf4, 0xb1, 0x17, 0xfc, 0x6c, 0x9f, 0x23, 0x20,
                                  0x5f, 0x19, 0xa,  0x3c, 0x43, 0x85, 0xa3};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4049;
  uint8_t client_id_bytes[] = {0xd1, 0xb9, 0x23, 0x59, 0xc6, 0xa3, 0x54, 0xa9, 0x53, 0x3};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x41, 0xd7, 0xc0, 0x78, 0xed, 0x2, 0xb5, 0x2d};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x94};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\187\252\SOHf\232\ACK\213\245\176\252\195\235\242\&9\182\171\n\a\222HA\SI\186\135\ti", _password = Just
// "P\241&f\236\151C\175\171", _lastWill = Nothing, _cleanSession = True, _keepAlive = 26836, _connID =
// "\203,\DLE\255\EOT\245\146\234>\226\148\240e\135\229\SUB\SUB5", _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x45, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x68, 0xd4, 0x0,  0x12, 0xcb,
                   0x2c, 0x10, 0xff, 0x4,  0xf5, 0x92, 0xea, 0x3e, 0xe2, 0x94, 0xf0, 0x65, 0x87, 0xe5, 0x1a,
                   0x1a, 0x35, 0x0,  0x1a, 0xbb, 0xfc, 0x1,  0x66, 0xe8, 0x6,  0xd5, 0xf5, 0xb0, 0xfc, 0xc3,
                   0xeb, 0xf2, 0x39, 0xb6, 0xab, 0xa,  0x7,  0xde, 0x48, 0x41, 0xf,  0xba, 0x87, 0x9,  0x69,
                   0x0,  0x9,  0x50, 0xf1, 0x26, 0x66, 0xec, 0x97, 0x43, 0xaf, 0xab};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26836;
  uint8_t client_id_bytes[] = {0xcb, 0x2c, 0x10, 0xff, 0x4,  0xf5, 0x92, 0xea, 0x3e,
                               0xe2, 0x94, 0xf0, 0x65, 0x87, 0xe5, 0x1a, 0x1a, 0x35};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbb, 0xfc, 0x1,  0x66, 0xe8, 0x6,  0xd5, 0xf5, 0xb0, 0xfc, 0xc3, 0xeb, 0xf2,
                              0x39, 0xb6, 0xab, 0xa,  0x7,  0xde, 0x48, 0x41, 0xf,  0xba, 0x87, 0x9,  0x69};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x50, 0xf1, 0x26, 0x66, 0xec, 0x97, 0x43, 0xaf, 0xab};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "Ke\173x'\220\170U\137[)Z\178\208[", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "M\150!\226\146b.\172]E2\203\181H\189\229`\158", _willMsg =
// "\254\224C\179\DC48p\a%0\153A\138\190\225Yw(dG\204\187\t5w\154\138F\208", _willProps = [PropServerKeepAlive 18831]}),
// _cleanSession = True, _keepAlive = 3972, _connID = "j\165k\247>\ENQ\145Xh\181N\246!\SUBX\201", _properties =
// [PropContentType "X\SO0j\160R\151\150\US\SIF\219\240L\205",PropMessageExpiryInterval
// 698,PropWildcardSubscriptionAvailable 200,PropAssignedClientIdentifier "\v^\213\173@\135:\208B\ENQQ\146DY\b"]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x90, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4e, 0xf,  0x84, 0x2b, 0x3,  0x0,  0xf,
                   0x58, 0xe,  0x30, 0x6a, 0xa0, 0x52, 0x97, 0x96, 0x1f, 0xf,  0x46, 0xdb, 0xf0, 0x4c, 0xcd, 0x2,  0x0,
                   0x0,  0x2,  0xba, 0x28, 0xc8, 0x12, 0x0,  0xf,  0xb,  0x5e, 0xd5, 0xad, 0x40, 0x87, 0x3a, 0xd0, 0x42,
                   0x5,  0x51, 0x92, 0x44, 0x59, 0x8,  0x0,  0x10, 0x6a, 0xa5, 0x6b, 0xf7, 0x3e, 0x5,  0x91, 0x58, 0x68,
                   0xb5, 0x4e, 0xf6, 0x21, 0x1a, 0x58, 0xc9, 0x3,  0x13, 0x49, 0x8f, 0x0,  0x12, 0x4d, 0x96, 0x21, 0xe2,
                   0x92, 0x62, 0x2e, 0xac, 0x5d, 0x45, 0x32, 0xcb, 0xb5, 0x48, 0xbd, 0xe5, 0x60, 0x9e, 0x0,  0x1d, 0xfe,
                   0xe0, 0x43, 0xb3, 0x14, 0x38, 0x70, 0x7,  0x25, 0x30, 0x99, 0x41, 0x8a, 0xbe, 0xe1, 0x59, 0x77, 0x28,
                   0x64, 0x47, 0xcc, 0xbb, 0x9,  0x35, 0x77, 0x9a, 0x8a, 0x46, 0xd0, 0x0,  0xf,  0x4b, 0x65, 0xad, 0x78,
                   0x27, 0xdc, 0xaa, 0x55, 0x89, 0x5b, 0x29, 0x5a, 0xb2, 0xd0, 0x5b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x58, 0xe, 0x30, 0x6a, 0xa0, 0x52, 0x97, 0x96, 0x1f, 0xf, 0x46, 0xdb, 0xf0, 0x4c, 0xcd};
  uint8_t bytesprops1[] = {0xb, 0x5e, 0xd5, 0xad, 0x40, 0x87, 0x3a, 0xd0, 0x42, 0x5, 0x51, 0x92, 0x44, 0x59, 0x8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 698}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18831}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4d, 0x96, 0x21, 0xe2, 0x92, 0x62, 0x2e, 0xac, 0x5d,
                                0x45, 0x32, 0xcb, 0xb5, 0x48, 0xbd, 0xe5, 0x60, 0x9e};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfe, 0xe0, 0x43, 0xb3, 0x14, 0x38, 0x70, 0x7,  0x25, 0x30,
                                  0x99, 0x41, 0x8a, 0xbe, 0xe1, 0x59, 0x77, 0x28, 0x64, 0x47,
                                  0xcc, 0xbb, 0x9,  0x35, 0x77, 0x9a, 0x8a, 0x46, 0xd0};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 3972;
  uint8_t client_id_bytes[] = {0x6a, 0xa5, 0x6b, 0xf7, 0x3e, 0x5,  0x91, 0x58,
                               0x68, 0xb5, 0x4e, 0xf6, 0x21, 0x1a, 0x58, 0xc9};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4b, 0x65, 0xad, 0x78, 0x27, 0xdc, 0xaa, 0x55, 0x89, 0x5b, 0x29, 0x5a, 0xb2, 0xd0, 0x5b};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "+\217\245\132J\219\160\139\232\213\SO\189\NUL-\DC3", _password = Nothing, _lastWill
// = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "O\SOH\173\164\238\248\f&\NULP\175\136/,\ETB\255\GS\208\247\DELt\129\193\169\EOT", _willMsg =
// "\138\229\222\220\216/\219\197\224\ETB\177\DEL.\165<\210\150\182\209\222\SOH\NAK(R\177\134\ETX\ETB", _willProps =
// [PropReasonString "G\177d\171\171%\182\166\&1\144d\254A\205\254\147\184s{",PropWillDelayInterval
// 4326,PropAuthenticationData "\185zr.\142\188v8RKO\v\134S|\206\239\237\159\254ot\185E",PropSubscriptionIdentifier
// 13,PropAuthenticationMethod "\140\USat\236)d \SUB_\186\&9\247\172I\235F\201a\ACK\v\247",PropMaximumPacketSize
// 12309,PropMessageExpiryInterval 1142,PropWillDelayInterval 16673,PropRetainAvailable 197,PropRetainAvailable
// 160,PropResponseInformation "(v\"*\236\229\223\a\t\177/\149j\236\245\NAK\nC\EOT",PropServerReference
// "\250\r\248\157",PropMaximumPacketSize 17709,PropRequestProblemInformation 93,PropAuthenticationData
// "W\218|\207\156;\200\DC4\181t9\202/\180-c\226\f\202\240\142L\216\&6\194\232",PropMaximumPacketSize
// 9332,PropContentType "/\158\139\227P\ETB\174F[w\177\168<\251\242",PropServerReference
// "-\197\220\155\189pHp\STX\165\147\133w\201A",PropTopicAliasMaximum 22350,PropWillDelayInterval 4774,PropResponseTopic
// ">0p\251\232\185Xt\247\191\150\214u\FS\241\&0\208\&1B\191\255GmL",PropServerReference
// "\198\205\&73\171\GS\197\210\194\137\133\147S\150\223\188",PropAuthenticationMethod
// "9\220\237\141\190",PropTopicAliasMaximum 28999]}), _cleanSession = True, _keepAlive = 20710, _connID =
// "\153\186\STX-\152\157\214\157\245\"4\"\ETX", _properties = [PropUserProperty
// "\SUB\133\220E\183N\ETB\163\187\132K\128\169\234\\\fP6"
// "=[a\250\190Un\205I\154\&7H\150zo\NUL\166K\130\148\168",PropServerReference
// "\171\163`\204p\246\171",PropTopicAliasMaximum 11152,PropWillDelayInterval 11062,PropSharedSubscriptionAvailable
// 203,PropAuthenticationData "\DEL\212\DC1\UST\190\&2\160\152\&5\140\191\252\bz\173r\RS\155",PropWillDelayInterval
// 3785,PropTopicAliasMaximum 11255,PropServerReference
// "j\DC42\228ZG\246\181|\189\169\236\&3\227\152\f\236\207U/\183\"W",PropRequestResponseInformation
// 26,PropSharedSubscriptionAvailable 74,PropAssignedClientIdentifier
// "\132*\197\184\US\199~\178\237\234\b\227u\220J~L\197",PropTopicAlias 3113,PropReceiveMaximum
// 28559,PropSubscriptionIdentifier 12]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0x8f, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb6, 0x50, 0xe6, 0x99, 0x1,  0x26, 0x0,  0x12, 0x1a,
      0x85, 0xdc, 0x45, 0xb7, 0x4e, 0x17, 0xa3, 0xbb, 0x84, 0x4b, 0x80, 0xa9, 0xea, 0x5c, 0xc,  0x50, 0x36, 0x0,  0x15,
      0x3d, 0x5b, 0x61, 0xfa, 0xbe, 0x55, 0x6e, 0xcd, 0x49, 0x9a, 0x37, 0x48, 0x96, 0x7a, 0x6f, 0x0,  0xa6, 0x4b, 0x82,
      0x94, 0xa8, 0x1c, 0x0,  0x7,  0xab, 0xa3, 0x60, 0xcc, 0x70, 0xf6, 0xab, 0x22, 0x2b, 0x90, 0x18, 0x0,  0x0,  0x2b,
      0x36, 0x2a, 0xcb, 0x16, 0x0,  0x13, 0x7f, 0xd4, 0x11, 0x1f, 0x54, 0xbe, 0x32, 0xa0, 0x98, 0x35, 0x8c, 0xbf, 0xfc,
      0x8,  0x7a, 0xad, 0x72, 0x1e, 0x9b, 0x18, 0x0,  0x0,  0xe,  0xc9, 0x22, 0x2b, 0xf7, 0x1c, 0x0,  0x17, 0x6a, 0x14,
      0x32, 0xe4, 0x5a, 0x47, 0xf6, 0xb5, 0x7c, 0xbd, 0xa9, 0xec, 0x33, 0xe3, 0x98, 0xc,  0xec, 0xcf, 0x55, 0x2f, 0xb7,
      0x22, 0x57, 0x19, 0x1a, 0x2a, 0x4a, 0x12, 0x0,  0x12, 0x84, 0x2a, 0xc5, 0xb8, 0x1f, 0xc7, 0x7e, 0xb2, 0xed, 0xea,
      0x8,  0xe3, 0x75, 0xdc, 0x4a, 0x7e, 0x4c, 0xc5, 0x23, 0xc,  0x29, 0x21, 0x6f, 0x8f, 0xb,  0xc,  0x0,  0xd,  0x99,
      0xba, 0x2,  0x2d, 0x98, 0x9d, 0xd6, 0x9d, 0xf5, 0x22, 0x34, 0x22, 0x3,  0x8f, 0x2,  0x1f, 0x0,  0x13, 0x47, 0xb1,
      0x64, 0xab, 0xab, 0x25, 0xb6, 0xa6, 0x31, 0x90, 0x64, 0xfe, 0x41, 0xcd, 0xfe, 0x93, 0xb8, 0x73, 0x7b, 0x18, 0x0,
      0x0,  0x10, 0xe6, 0x16, 0x0,  0x18, 0xb9, 0x7a, 0x72, 0x2e, 0x8e, 0xbc, 0x76, 0x38, 0x52, 0x4b, 0x4f, 0xb,  0x86,
      0x53, 0x7c, 0xce, 0xef, 0xed, 0x9f, 0xfe, 0x6f, 0x74, 0xb9, 0x45, 0xb,  0xd,  0x15, 0x0,  0x16, 0x8c, 0x1f, 0x61,
      0x74, 0xec, 0x29, 0x64, 0x20, 0x1a, 0x5f, 0xba, 0x39, 0xf7, 0xac, 0x49, 0xeb, 0x46, 0xc9, 0x61, 0x6,  0xb,  0xf7,
      0x27, 0x0,  0x0,  0x30, 0x15, 0x2,  0x0,  0x0,  0x4,  0x76, 0x18, 0x0,  0x0,  0x41, 0x21, 0x25, 0xc5, 0x25, 0xa0,
      0x1a, 0x0,  0x13, 0x28, 0x76, 0x22, 0x2a, 0xec, 0xe5, 0xdf, 0x7,  0x9,  0xb1, 0x2f, 0x95, 0x6a, 0xec, 0xf5, 0x15,
      0xa,  0x43, 0x4,  0x1c, 0x0,  0x4,  0xfa, 0xd,  0xf8, 0x9d, 0x27, 0x0,  0x0,  0x45, 0x2d, 0x17, 0x5d, 0x16, 0x0,
      0x1a, 0x57, 0xda, 0x7c, 0xcf, 0x9c, 0x3b, 0xc8, 0x14, 0xb5, 0x74, 0x39, 0xca, 0x2f, 0xb4, 0x2d, 0x63, 0xe2, 0xc,
      0xca, 0xf0, 0x8e, 0x4c, 0xd8, 0x36, 0xc2, 0xe8, 0x27, 0x0,  0x0,  0x24, 0x74, 0x3,  0x0,  0xf,  0x2f, 0x9e, 0x8b,
      0xe3, 0x50, 0x17, 0xae, 0x46, 0x5b, 0x77, 0xb1, 0xa8, 0x3c, 0xfb, 0xf2, 0x1c, 0x0,  0xf,  0x2d, 0xc5, 0xdc, 0x9b,
      0xbd, 0x70, 0x48, 0x70, 0x2,  0xa5, 0x93, 0x85, 0x77, 0xc9, 0x41, 0x22, 0x57, 0x4e, 0x18, 0x0,  0x0,  0x12, 0xa6,
      0x8,  0x0,  0x18, 0x3e, 0x30, 0x70, 0xfb, 0xe8, 0xb9, 0x58, 0x74, 0xf7, 0xbf, 0x96, 0xd6, 0x75, 0x1c, 0xf1, 0x30,
      0xd0, 0x31, 0x42, 0xbf, 0xff, 0x47, 0x6d, 0x4c, 0x1c, 0x0,  0x10, 0xc6, 0xcd, 0x37, 0x33, 0xab, 0x1d, 0xc5, 0xd2,
      0xc2, 0x89, 0x85, 0x93, 0x53, 0x96, 0xdf, 0xbc, 0x15, 0x0,  0x5,  0x39, 0xdc, 0xed, 0x8d, 0xbe, 0x22, 0x71, 0x47,
      0x0,  0x19, 0x4f, 0x1,  0xad, 0xa4, 0xee, 0xf8, 0xc,  0x26, 0x0,  0x50, 0xaf, 0x88, 0x2f, 0x2c, 0x17, 0xff, 0x1d,
      0xd0, 0xf7, 0x7f, 0x74, 0x81, 0xc1, 0xa9, 0x4,  0x0,  0x1c, 0x8a, 0xe5, 0xde, 0xdc, 0xd8, 0x2f, 0xdb, 0xc5, 0xe0,
      0x17, 0xb1, 0x7f, 0x2e, 0xa5, 0x3c, 0xd2, 0x96, 0xb6, 0xd1, 0xde, 0x1,  0x15, 0x28, 0x52, 0xb1, 0x86, 0x3,  0x17,
      0x0,  0xf,  0x2b, 0xd9, 0xf5, 0x84, 0x4a, 0xdb, 0xa0, 0x8b, 0xe8, 0xd5, 0xe,  0xbd, 0x0,  0x2d, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x3d, 0x5b, 0x61, 0xfa, 0xbe, 0x55, 0x6e, 0xcd, 0x49, 0x9a, 0x37,
                           0x48, 0x96, 0x7a, 0x6f, 0x0,  0xa6, 0x4b, 0x82, 0x94, 0xa8};
  uint8_t bytesprops0[] = {0x1a, 0x85, 0xdc, 0x45, 0xb7, 0x4e, 0x17, 0xa3, 0xbb,
                           0x84, 0x4b, 0x80, 0xa9, 0xea, 0x5c, 0xc,  0x50, 0x36};
  uint8_t bytesprops2[] = {0xab, 0xa3, 0x60, 0xcc, 0x70, 0xf6, 0xab};
  uint8_t bytesprops3[] = {0x7f, 0xd4, 0x11, 0x1f, 0x54, 0xbe, 0x32, 0xa0, 0x98, 0x35,
                           0x8c, 0xbf, 0xfc, 0x8,  0x7a, 0xad, 0x72, 0x1e, 0x9b};
  uint8_t bytesprops4[] = {0x6a, 0x14, 0x32, 0xe4, 0x5a, 0x47, 0xf6, 0xb5, 0x7c, 0xbd, 0xa9, 0xec,
                           0x33, 0xe3, 0x98, 0xc,  0xec, 0xcf, 0x55, 0x2f, 0xb7, 0x22, 0x57};
  uint8_t bytesprops5[] = {0x84, 0x2a, 0xc5, 0xb8, 0x1f, 0xc7, 0x7e, 0xb2, 0xed,
                           0xea, 0x8,  0xe3, 0x75, 0xdc, 0x4a, 0x7e, 0x4c, 0xc5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops0}, .v = {21, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11152}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11062}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3785}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11255}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3113}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28559}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x47, 0xb1, 0x64, 0xab, 0xab, 0x25, 0xb6, 0xa6, 0x31, 0x90,
                               0x64, 0xfe, 0x41, 0xcd, 0xfe, 0x93, 0xb8, 0x73, 0x7b};
  uint8_t byteswillprops1[] = {0xb9, 0x7a, 0x72, 0x2e, 0x8e, 0xbc, 0x76, 0x38, 0x52, 0x4b, 0x4f, 0xb,
                               0x86, 0x53, 0x7c, 0xce, 0xef, 0xed, 0x9f, 0xfe, 0x6f, 0x74, 0xb9, 0x45};
  uint8_t byteswillprops2[] = {0x8c, 0x1f, 0x61, 0x74, 0xec, 0x29, 0x64, 0x20, 0x1a, 0x5f, 0xba,
                               0x39, 0xf7, 0xac, 0x49, 0xeb, 0x46, 0xc9, 0x61, 0x6,  0xb,  0xf7};
  uint8_t byteswillprops3[] = {0x28, 0x76, 0x22, 0x2a, 0xec, 0xe5, 0xdf, 0x7,  0x9, 0xb1,
                               0x2f, 0x95, 0x6a, 0xec, 0xf5, 0x15, 0xa,  0x43, 0x4};
  uint8_t byteswillprops4[] = {0xfa, 0xd, 0xf8, 0x9d};
  uint8_t byteswillprops5[] = {0x57, 0xda, 0x7c, 0xcf, 0x9c, 0x3b, 0xc8, 0x14, 0xb5, 0x74, 0x39, 0xca, 0x2f,
                               0xb4, 0x2d, 0x63, 0xe2, 0xc,  0xca, 0xf0, 0x8e, 0x4c, 0xd8, 0x36, 0xc2, 0xe8};
  uint8_t byteswillprops6[] = {0x2f, 0x9e, 0x8b, 0xe3, 0x50, 0x17, 0xae, 0x46,
                               0x5b, 0x77, 0xb1, 0xa8, 0x3c, 0xfb, 0xf2};
  uint8_t byteswillprops7[] = {0x2d, 0xc5, 0xdc, 0x9b, 0xbd, 0x70, 0x48, 0x70, 0x2, 0xa5, 0x93, 0x85, 0x77, 0xc9, 0x41};
  uint8_t byteswillprops8[] = {0x3e, 0x30, 0x70, 0xfb, 0xe8, 0xb9, 0x58, 0x74, 0xf7, 0xbf, 0x96, 0xd6,
                               0x75, 0x1c, 0xf1, 0x30, 0xd0, 0x31, 0x42, 0xbf, 0xff, 0x47, 0x6d, 0x4c};
  uint8_t byteswillprops9[] = {0xc6, 0xcd, 0x37, 0x33, 0xab, 0x1d, 0xc5, 0xd2,
                               0xc2, 0x89, 0x85, 0x93, 0x53, 0x96, 0xdf, 0xbc};
  uint8_t byteswillprops10[] = {0x39, 0xdc, 0xed, 0x8d, 0xbe};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4326}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12309}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1142}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16673}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17709}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9332}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22350}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4774}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28999}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4f, 0x1,  0xad, 0xa4, 0xee, 0xf8, 0xc,  0x26, 0x0,  0x50, 0xaf, 0x88, 0x2f,
                                0x2c, 0x17, 0xff, 0x1d, 0xd0, 0xf7, 0x7f, 0x74, 0x81, 0xc1, 0xa9, 0x4};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x8a, 0xe5, 0xde, 0xdc, 0xd8, 0x2f, 0xdb, 0xc5, 0xe0, 0x17, 0xb1, 0x7f, 0x2e, 0xa5,
                                  0x3c, 0xd2, 0x96, 0xb6, 0xd1, 0xde, 0x1,  0x15, 0x28, 0x52, 0xb1, 0x86, 0x3,  0x17};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20710;
  uint8_t client_id_bytes[] = {0x99, 0xba, 0x2, 0x2d, 0x98, 0x9d, 0xd6, 0x9d, 0xf5, 0x22, 0x34, 0x22, 0x3};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2b, 0xd9, 0xf5, 0x84, 0x4a, 0xdb, 0xa0, 0x8b, 0xe8, 0xd5, 0xe, 0xbd, 0x0, 0x2d, 0x13};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\242\212u]\129\203\157", _password = Nothing, _lastWill = Nothing, _cleanSession =
// True, _keepAlive = 23152, _connID = "*\194\151\224rT\148\208", _properties = [PropTopicAliasMaximum
// 21505,PropPayloadFormatIndicator 227,PropRetainAvailable 225,PropContentType
// "\233\174\193r\132}5\ak!D'\164\142W\FS\195\&9\249\159\&4]\130\200$\DELk\153\254",PropServerKeepAlive
// 18739,PropMessageExpiryInterval 10105,PropTopicAliasMaximum 18324,PropTopicAlias 28758,PropRequestResponseInformation
// 153,PropSubscriptionIdentifier 1,PropPayloadFormatIndicator 236,PropMaximumQoS 0,PropCorrelationData
// "\205S2\232x\219O\128\141@\231\ETBq\187;\209\191\163",PropMessageExpiryInterval 1902,PropResponseInformation
// "\224\231\237\174\246\194F\227\147\140\170\190",PropMaximumQoS 219,PropMessageExpiryInterval
// 13875,PropRequestResponseInformation 124,PropSessionExpiryInterval 11378,PropWillDelayInterval
// 20615,PropRetainAvailable 181,PropResponseTopic "\US\146A<E",PropServerReference
// "\133\129\185B\ACK\140.",PropContentType
// "\205Z\245\157\254]\248\144\177\DLE\SYN>\225\211\138\251\SOH\225\170",PropPayloadFormatIndicator
// 214,PropCorrelationData "\190\SUBb\CAN4D\197",PropAssignedClientIdentifier "\137TD.\ETX\181\131\144\&2m\"l\192"]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0xde, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x82, 0x5a, 0x70, 0xbf, 0x1,  0x22, 0x54, 0x1,  0x1,
      0xe3, 0x25, 0xe1, 0x3,  0x0,  0x1d, 0xe9, 0xae, 0xc1, 0x72, 0x84, 0x7d, 0x35, 0x7,  0x6b, 0x21, 0x44, 0x27, 0xa4,
      0x8e, 0x57, 0x1c, 0xc3, 0x39, 0xf9, 0x9f, 0x34, 0x5d, 0x82, 0xc8, 0x24, 0x7f, 0x6b, 0x99, 0xfe, 0x13, 0x49, 0x33,
      0x2,  0x0,  0x0,  0x27, 0x79, 0x22, 0x47, 0x94, 0x23, 0x70, 0x56, 0x19, 0x99, 0xb,  0x1,  0x1,  0xec, 0x24, 0x0,
      0x9,  0x0,  0x12, 0xcd, 0x53, 0x32, 0xe8, 0x78, 0xdb, 0x4f, 0x80, 0x8d, 0x40, 0xe7, 0x17, 0x71, 0xbb, 0x3b, 0xd1,
      0xbf, 0xa3, 0x2,  0x0,  0x0,  0x7,  0x6e, 0x1a, 0x0,  0xc,  0xe0, 0xe7, 0xed, 0xae, 0xf6, 0xc2, 0x46, 0xe3, 0x93,
      0x8c, 0xaa, 0xbe, 0x24, 0xdb, 0x2,  0x0,  0x0,  0x36, 0x33, 0x19, 0x7c, 0x11, 0x0,  0x0,  0x2c, 0x72, 0x18, 0x0,
      0x0,  0x50, 0x87, 0x25, 0xb5, 0x8,  0x0,  0x5,  0x1f, 0x92, 0x41, 0x3c, 0x45, 0x1c, 0x0,  0x7,  0x85, 0x81, 0xb9,
      0x42, 0x6,  0x8c, 0x2e, 0x3,  0x0,  0x13, 0xcd, 0x5a, 0xf5, 0x9d, 0xfe, 0x5d, 0xf8, 0x90, 0xb1, 0x10, 0x16, 0x3e,
      0xe1, 0xd3, 0x8a, 0xfb, 0x1,  0xe1, 0xaa, 0x1,  0xd6, 0x9,  0x0,  0x7,  0xbe, 0x1a, 0x62, 0x18, 0x34, 0x44, 0xc5,
      0x12, 0x0,  0xd,  0x89, 0x54, 0x44, 0x2e, 0x3,  0xb5, 0x83, 0x90, 0x32, 0x6d, 0x22, 0x6c, 0xc0, 0x0,  0x8,  0x2a,
      0xc2, 0x97, 0xe0, 0x72, 0x54, 0x94, 0xd0, 0x0,  0x7,  0xf2, 0xd4, 0x75, 0x5d, 0x81, 0xcb, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe9, 0xae, 0xc1, 0x72, 0x84, 0x7d, 0x35, 0x7,  0x6b, 0x21, 0x44, 0x27, 0xa4, 0x8e, 0x57,
                           0x1c, 0xc3, 0x39, 0xf9, 0x9f, 0x34, 0x5d, 0x82, 0xc8, 0x24, 0x7f, 0x6b, 0x99, 0xfe};
  uint8_t bytesprops1[] = {0xcd, 0x53, 0x32, 0xe8, 0x78, 0xdb, 0x4f, 0x80, 0x8d,
                           0x40, 0xe7, 0x17, 0x71, 0xbb, 0x3b, 0xd1, 0xbf, 0xa3};
  uint8_t bytesprops2[] = {0xe0, 0xe7, 0xed, 0xae, 0xf6, 0xc2, 0x46, 0xe3, 0x93, 0x8c, 0xaa, 0xbe};
  uint8_t bytesprops3[] = {0x1f, 0x92, 0x41, 0x3c, 0x45};
  uint8_t bytesprops4[] = {0x85, 0x81, 0xb9, 0x42, 0x6, 0x8c, 0x2e};
  uint8_t bytesprops5[] = {0xcd, 0x5a, 0xf5, 0x9d, 0xfe, 0x5d, 0xf8, 0x90, 0xb1, 0x10,
                           0x16, 0x3e, 0xe1, 0xd3, 0x8a, 0xfb, 0x1,  0xe1, 0xaa};
  uint8_t bytesprops6[] = {0xbe, 0x1a, 0x62, 0x18, 0x34, 0x44, 0xc5};
  uint8_t bytesprops7[] = {0x89, 0x54, 0x44, 0x2e, 0x3, 0xb5, 0x83, 0x90, 0x32, 0x6d, 0x22, 0x6c, 0xc0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21505}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18739}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10105}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18324}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28758}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1902}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13875}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11378}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20615}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23152;
  uint8_t client_id_bytes[] = {0x2a, 0xc2, 0x97, 0xe0, 0x72, 0x54, 0x94, 0xd0};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf2, 0xd4, 0x75, 0x5d, 0x81, 0xcb, 0x9d};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\DLEv\182\131p6", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS0, _willTopic =
// "\CAN=S\217\STX\226v\251\&6\161\SYN\168\SO:\DC2P\198\184\217\161\221\199\148\168\142\ETB\245\178", _willMsg =
// "f\241\n]\DC4\198\146\187\\\239\149x\163\194\179?\132\207S", _willProps = [PropWildcardSubscriptionAvailable
// 0,PropServerReference "\160\208/1{)6^\CAN\220\166E>\166\135Zy(\217(2\229\188\152\140\&1\232d",PropTopicAlias
// 11543,PropUserProperty "\207\166S=eV-\136\154"
// "(w\159O\RS\128I#\140y\168\RS\217\v\SOH:\164\158\176\191",PropReasonString
// "\232\&5\177\241\186R2\130ys\DLEK\144k0\237}\163\236\169r|'\173\234\175X\209\US",PropMessageExpiryInterval
// 28516,PropServerReference
// "Ri}\167\197\208`KZ\233\146\"14\136\&9\169\171\187\f\192\164\145\SUB4",PropMaximumPacketSize 4874,PropReasonString
// "\134E:?\154\214\188\245\179i\144-NUy\213",PropAssignedClientIdentifier "\246\182@]
// \194P\245'\240\178\STX\132\162\184",PropReceiveMaximum 8768,PropServerReference
// "\222\175\169)\175\225\245&\237\231\NAK\131 \ETB\239y\254\159;\DC2",PropServerKeepAlive
// 27108,PropAuthenticationMethod "\DLE\152\NUL\199",PropResponseInformation
// "T\163S\147\149Wg\187_\160\196\228\t\239\172\"\231\NUL\208\150\138",PropRequestResponseInformation
// 157,PropSubscriptionIdentifier 12,PropServerReference "\143\233=",PropAssignedClientIdentifier
// "!\180\236\154F\169&\232J\136L\252\249]\ENQ\185pd\f\NAK\134\242 SN",PropCorrelationData
// "\156{\DC1>M\217\147\176?\247\196D\232\147\219N",PropSessionExpiryInterval 11271,PropSharedSubscriptionAvailable
// 207,PropResponseInformation "\aK_\SYNa\240\247\208\180\173{\ACK9\183\SOH\160\254EW'",PropMaximumPacketSize
// 18340,PropMessageExpiryInterval 10654,PropWillDelayInterval 13204,PropRetainAvailable 102]}), _cleanSession = True,
// _keepAlive = 29624, _connID = "\ETX\151\174C\139\235\225Y\221\247r\201\167\189j\NUL", _properties =
// [PropAuthenticationMethod "\176\DC1)\201\&4m)\DEL\222(\210\130\203",PropTopicAlias 23869,PropReceiveMaximum
// 14408,PropRetainAvailable 90,PropSessionExpiryInterval 22019,PropRequestProblemInformation
// 68,PropAuthenticationMethod "W\194\221\205\129\174h3\222",PropRequestResponseInformation 39]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xdc, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x66, 0x73, 0xb8, 0x2d, 0x15, 0x0,  0xd,  0xb0, 0x11,
      0x29, 0xc9, 0x34, 0x6d, 0x29, 0x7f, 0xde, 0x28, 0xd2, 0x82, 0xcb, 0x23, 0x5d, 0x3d, 0x21, 0x38, 0x48, 0x25, 0x5a,
      0x11, 0x0,  0x0,  0x56, 0x3,  0x17, 0x44, 0x15, 0x0,  0x9,  0x57, 0xc2, 0xdd, 0xcd, 0x81, 0xae, 0x68, 0x33, 0xde,
      0x19, 0x27, 0x0,  0x10, 0x3,  0x97, 0xae, 0x43, 0x8b, 0xeb, 0xe1, 0x59, 0xdd, 0xf7, 0x72, 0xc9, 0xa7, 0xbd, 0x6a,
      0x0,  0xd5, 0x2,  0x28, 0x0,  0x1c, 0x0,  0x1c, 0xa0, 0xd0, 0x2f, 0x31, 0x7b, 0x29, 0x36, 0x5e, 0x18, 0xdc, 0xa6,
      0x45, 0x3e, 0xa6, 0x87, 0x5a, 0x79, 0x28, 0xd9, 0x28, 0x32, 0xe5, 0xbc, 0x98, 0x8c, 0x31, 0xe8, 0x64, 0x23, 0x2d,
      0x17, 0x26, 0x0,  0x9,  0xcf, 0xa6, 0x53, 0x3d, 0x65, 0x56, 0x2d, 0x88, 0x9a, 0x0,  0x14, 0x28, 0x77, 0x9f, 0x4f,
      0x1e, 0x80, 0x49, 0x23, 0x8c, 0x79, 0xa8, 0x1e, 0xd9, 0xb,  0x1,  0x3a, 0xa4, 0x9e, 0xb0, 0xbf, 0x1f, 0x0,  0x1d,
      0xe8, 0x35, 0xb1, 0xf1, 0xba, 0x52, 0x32, 0x82, 0x79, 0x73, 0x10, 0x4b, 0x90, 0x6b, 0x30, 0xed, 0x7d, 0xa3, 0xec,
      0xa9, 0x72, 0x7c, 0x27, 0xad, 0xea, 0xaf, 0x58, 0xd1, 0x1f, 0x2,  0x0,  0x0,  0x6f, 0x64, 0x1c, 0x0,  0x19, 0x52,
      0x69, 0x7d, 0xa7, 0xc5, 0xd0, 0x60, 0x4b, 0x5a, 0xe9, 0x92, 0x22, 0x31, 0x34, 0x88, 0x39, 0xa9, 0xab, 0xbb, 0xc,
      0xc0, 0xa4, 0x91, 0x1a, 0x34, 0x27, 0x0,  0x0,  0x13, 0xa,  0x1f, 0x0,  0x10, 0x86, 0x45, 0x3a, 0x3f, 0x9a, 0xd6,
      0xbc, 0xf5, 0xb3, 0x69, 0x90, 0x2d, 0x4e, 0x55, 0x79, 0xd5, 0x12, 0x0,  0xf,  0xf6, 0xb6, 0x40, 0x5d, 0x20, 0xc2,
      0x50, 0xf5, 0x27, 0xf0, 0xb2, 0x2,  0x84, 0xa2, 0xb8, 0x21, 0x22, 0x40, 0x1c, 0x0,  0x14, 0xde, 0xaf, 0xa9, 0x29,
      0xaf, 0xe1, 0xf5, 0x26, 0xed, 0xe7, 0x15, 0x83, 0x20, 0x17, 0xef, 0x79, 0xfe, 0x9f, 0x3b, 0x12, 0x13, 0x69, 0xe4,
      0x15, 0x0,  0x4,  0x10, 0x98, 0x0,  0xc7, 0x1a, 0x0,  0x15, 0x54, 0xa3, 0x53, 0x93, 0x95, 0x57, 0x67, 0xbb, 0x5f,
      0xa0, 0xc4, 0xe4, 0x9,  0xef, 0xac, 0x22, 0xe7, 0x0,  0xd0, 0x96, 0x8a, 0x19, 0x9d, 0xb,  0xc,  0x1c, 0x0,  0x3,
      0x8f, 0xe9, 0x3d, 0x12, 0x0,  0x19, 0x21, 0xb4, 0xec, 0x9a, 0x46, 0xa9, 0x26, 0xe8, 0x4a, 0x88, 0x4c, 0xfc, 0xf9,
      0x5d, 0x5,  0xb9, 0x70, 0x64, 0xc,  0x15, 0x86, 0xf2, 0x20, 0x53, 0x4e, 0x9,  0x0,  0x10, 0x9c, 0x7b, 0x11, 0x3e,
      0x4d, 0xd9, 0x93, 0xb0, 0x3f, 0xf7, 0xc4, 0x44, 0xe8, 0x93, 0xdb, 0x4e, 0x11, 0x0,  0x0,  0x2c, 0x7,  0x2a, 0xcf,
      0x1a, 0x0,  0x14, 0x7,  0x4b, 0x5f, 0x16, 0x61, 0xf0, 0xf7, 0xd0, 0xb4, 0xad, 0x7b, 0x6,  0x39, 0xb7, 0x1,  0xa0,
      0xfe, 0x45, 0x57, 0x27, 0x27, 0x0,  0x0,  0x47, 0xa4, 0x2,  0x0,  0x0,  0x29, 0x9e, 0x18, 0x0,  0x0,  0x33, 0x94,
      0x25, 0x66, 0x0,  0x1c, 0x18, 0x3d, 0x53, 0xd9, 0x2,  0xe2, 0x76, 0xfb, 0x36, 0xa1, 0x16, 0xa8, 0xe,  0x3a, 0x12,
      0x50, 0xc6, 0xb8, 0xd9, 0xa1, 0xdd, 0xc7, 0x94, 0xa8, 0x8e, 0x17, 0xf5, 0xb2, 0x0,  0x13, 0x66, 0xf1, 0xa,  0x5d,
      0x14, 0xc6, 0x92, 0xbb, 0x5c, 0xef, 0x95, 0x78, 0xa3, 0xc2, 0xb3, 0x3f, 0x84, 0xcf, 0x53, 0x0,  0x6,  0x10, 0x76,
      0xb6, 0x83, 0x70, 0x36};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb0, 0x11, 0x29, 0xc9, 0x34, 0x6d, 0x29, 0x7f, 0xde, 0x28, 0xd2, 0x82, 0xcb};
  uint8_t bytesprops1[] = {0x57, 0xc2, 0xdd, 0xcd, 0x81, 0xae, 0x68, 0x33, 0xde};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23869}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14408}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22019}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa0, 0xd0, 0x2f, 0x31, 0x7b, 0x29, 0x36, 0x5e, 0x18, 0xdc, 0xa6, 0x45, 0x3e, 0xa6,
                               0x87, 0x5a, 0x79, 0x28, 0xd9, 0x28, 0x32, 0xe5, 0xbc, 0x98, 0x8c, 0x31, 0xe8, 0x64};
  uint8_t byteswillprops2[] = {0x28, 0x77, 0x9f, 0x4f, 0x1e, 0x80, 0x49, 0x23, 0x8c, 0x79,
                               0xa8, 0x1e, 0xd9, 0xb,  0x1,  0x3a, 0xa4, 0x9e, 0xb0, 0xbf};
  uint8_t byteswillprops1[] = {0xcf, 0xa6, 0x53, 0x3d, 0x65, 0x56, 0x2d, 0x88, 0x9a};
  uint8_t byteswillprops3[] = {0xe8, 0x35, 0xb1, 0xf1, 0xba, 0x52, 0x32, 0x82, 0x79, 0x73, 0x10, 0x4b, 0x90, 0x6b, 0x30,
                               0xed, 0x7d, 0xa3, 0xec, 0xa9, 0x72, 0x7c, 0x27, 0xad, 0xea, 0xaf, 0x58, 0xd1, 0x1f};
  uint8_t byteswillprops4[] = {0x52, 0x69, 0x7d, 0xa7, 0xc5, 0xd0, 0x60, 0x4b, 0x5a, 0xe9, 0x92, 0x22, 0x31,
                               0x34, 0x88, 0x39, 0xa9, 0xab, 0xbb, 0xc,  0xc0, 0xa4, 0x91, 0x1a, 0x34};
  uint8_t byteswillprops5[] = {0x86, 0x45, 0x3a, 0x3f, 0x9a, 0xd6, 0xbc, 0xf5,
                               0xb3, 0x69, 0x90, 0x2d, 0x4e, 0x55, 0x79, 0xd5};
  uint8_t byteswillprops6[] = {0xf6, 0xb6, 0x40, 0x5d, 0x20, 0xc2, 0x50, 0xf5, 0x27, 0xf0, 0xb2, 0x2, 0x84, 0xa2, 0xb8};
  uint8_t byteswillprops7[] = {0xde, 0xaf, 0xa9, 0x29, 0xaf, 0xe1, 0xf5, 0x26, 0xed, 0xe7,
                               0x15, 0x83, 0x20, 0x17, 0xef, 0x79, 0xfe, 0x9f, 0x3b, 0x12};
  uint8_t byteswillprops8[] = {0x10, 0x98, 0x0, 0xc7};
  uint8_t byteswillprops9[] = {0x54, 0xa3, 0x53, 0x93, 0x95, 0x57, 0x67, 0xbb, 0x5f, 0xa0, 0xc4,
                               0xe4, 0x9,  0xef, 0xac, 0x22, 0xe7, 0x0,  0xd0, 0x96, 0x8a};
  uint8_t byteswillprops10[] = {0x8f, 0xe9, 0x3d};
  uint8_t byteswillprops11[] = {0x21, 0xb4, 0xec, 0x9a, 0x46, 0xa9, 0x26, 0xe8, 0x4a, 0x88, 0x4c, 0xfc, 0xf9,
                                0x5d, 0x5,  0xb9, 0x70, 0x64, 0xc,  0x15, 0x86, 0xf2, 0x20, 0x53, 0x4e};
  uint8_t byteswillprops12[] = {0x9c, 0x7b, 0x11, 0x3e, 0x4d, 0xd9, 0x93, 0xb0,
                                0x3f, 0xf7, 0xc4, 0x44, 0xe8, 0x93, 0xdb, 0x4e};
  uint8_t byteswillprops13[] = {0x7,  0x4b, 0x5f, 0x16, 0x61, 0xf0, 0xf7, 0xd0, 0xb4, 0xad,
                                0x7b, 0x6,  0x39, 0xb7, 0x1,  0xa0, 0xfe, 0x45, 0x57, 0x27};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11543}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops1}, .v = {20, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28516}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4874}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8768}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27108}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11271}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18340}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10654}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13204}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 102}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x18, 0x3d, 0x53, 0xd9, 0x2,  0xe2, 0x76, 0xfb, 0x36, 0xa1, 0x16, 0xa8, 0xe,  0x3a,
                                0x12, 0x50, 0xc6, 0xb8, 0xd9, 0xa1, 0xdd, 0xc7, 0x94, 0xa8, 0x8e, 0x17, 0xf5, 0xb2};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x66, 0xf1, 0xa,  0x5d, 0x14, 0xc6, 0x92, 0xbb, 0x5c, 0xef,
                                  0x95, 0x78, 0xa3, 0xc2, 0xb3, 0x3f, 0x84, 0xcf, 0x53};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29624;
  uint8_t client_id_bytes[] = {0x3,  0x97, 0xae, 0x43, 0x8b, 0xeb, 0xe1, 0x59,
                               0xdd, 0xf7, 0x72, 0xc9, 0xa7, 0xbd, 0x6a, 0x0};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x10, 0x76, 0xb6, 0x83, 0x70, 0x36};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "K\229g\209}\210\138\137T;\154Eh", _password = Nothing, _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 31695, _connID = "cG\191s\155\131\202\186\155\&5C\DC2\207\217\173\144
// \248\248\148", _properties = [PropTopicAliasMaximum 1156,PropRetainAvailable 243,PropCorrelationData
// "\194^}\DLE\199\252\216\&0\DC1z\r\t\216\187\FS\238\SO\236\240\163h\r\195\254\132\229t\244",PropWillDelayInterval
// 21486]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x59, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x82, 0x7b, 0xcf, 0x29, 0x22, 0x4,  0x84,
                   0x25, 0xf3, 0x9,  0x0,  0x1c, 0xc2, 0x5e, 0x7d, 0x10, 0xc7, 0xfc, 0xd8, 0x30, 0x11, 0x7a, 0xd,
                   0x9,  0xd8, 0xbb, 0x1c, 0xee, 0xe,  0xec, 0xf0, 0xa3, 0x68, 0xd,  0xc3, 0xfe, 0x84, 0xe5, 0x74,
                   0xf4, 0x18, 0x0,  0x0,  0x53, 0xee, 0x0,  0x14, 0x63, 0x47, 0xbf, 0x73, 0x9b, 0x83, 0xca, 0xba,
                   0x9b, 0x35, 0x43, 0x12, 0xcf, 0xd9, 0xad, 0x90, 0x20, 0xf8, 0xf8, 0x94, 0x0,  0xd,  0x4b, 0xe5,
                   0x67, 0xd1, 0x7d, 0xd2, 0x8a, 0x89, 0x54, 0x3b, 0x9a, 0x45, 0x68};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc2, 0x5e, 0x7d, 0x10, 0xc7, 0xfc, 0xd8, 0x30, 0x11, 0x7a, 0xd,  0x9,  0xd8, 0xbb,
                           0x1c, 0xee, 0xe,  0xec, 0xf0, 0xa3, 0x68, 0xd,  0xc3, 0xfe, 0x84, 0xe5, 0x74, 0xf4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1156}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21486}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31695;
  uint8_t client_id_bytes[] = {0x63, 0x47, 0xbf, 0x73, 0x9b, 0x83, 0xca, 0xba, 0x9b, 0x35,
                               0x43, 0x12, 0xcf, 0xd9, 0xad, 0x90, 0x20, 0xf8, 0xf8, 0x94};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4b, 0xe5, 0x67, 0xd1, 0x7d, 0xd2, 0x8a, 0x89, 0x54, 0x3b, 0x9a, 0x45, 0x68};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\175'\US7>\EOT-K\160\NUL\SO\134T\148\232\194\132b\218\SIE\241L\156\204\169\145X3\250", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\CANf\159\155m", _willMsg =
// "\155)T\206\250\163y-\213[_\a\159\GS=\195L\155L\164\220\243\225)\208p", _willProps = [PropContentType
// "\157S\144\253Y|<\129I\STXt\204\255\142Y\166H\ETX\219qj<"]}), _cleanSession = True, _keepAlive = 11529, _connID = "",
// _properties = [PropPayloadFormatIndicator 16,PropSessionExpiryInterval 23466,PropUserProperty
// "\DC2\GS\USW\133\DC2\RSc\r\133l\175\152\146\DELY\219\190\209\216\157~\240\203r"
// "\137\152\v\218\152\134\FS0\DC3\204b\DC4\216\b:\151\188\165\248\&2\ESC\142\186\ayv\168",PropAssignedClientIdentifier
// "`r\229\GS\159\v\241\179e",PropTopicAlias 4328,PropWildcardSubscriptionAvailable 130,PropPayloadFormatIndicator
// 239,PropWillDelayInterval 18921,PropTopicAlias 12433,PropTopicAlias 2560,PropTopicAlias 3720,PropTopicAliasMaximum
// 3890,PropReasonString "5\205a\143!\211[\209hz\\\246\154\221nZ",PropTopicAliasMaximum
// 10484,PropRequestResponseInformation 247,PropSharedSubscriptionAvailable 91,PropReasonString
// "\141\226v",PropServerKeepAlive 676,PropUserProperty "\158\SUB@\177\137*\190\160j\203\r\160"
// "\189\221\157j1]\FSt\217\168Zo\202\228\173",PropWildcardSubscriptionAvailable 176,PropRetainAvailable 67]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0x96, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x96, 0x2d, 0x9,  0xab, 0x1,  0x1,  0x10, 0x11, 0x0,
      0x0,  0x5b, 0xaa, 0x26, 0x0,  0x19, 0x12, 0x1d, 0x1f, 0x57, 0x85, 0x12, 0x1e, 0x63, 0xd,  0x85, 0x6c, 0xaf, 0x98,
      0x92, 0x7f, 0x59, 0xdb, 0xbe, 0xd1, 0xd8, 0x9d, 0x7e, 0xf0, 0xcb, 0x72, 0x0,  0x1b, 0x89, 0x98, 0xb,  0xda, 0x98,
      0x86, 0x1c, 0x30, 0x13, 0xcc, 0x62, 0x14, 0xd8, 0x8,  0x3a, 0x97, 0xbc, 0xa5, 0xf8, 0x32, 0x1b, 0x8e, 0xba, 0x7,
      0x79, 0x76, 0xa8, 0x12, 0x0,  0x9,  0x60, 0x72, 0xe5, 0x1d, 0x9f, 0xb,  0xf1, 0xb3, 0x65, 0x23, 0x10, 0xe8, 0x28,
      0x82, 0x1,  0xef, 0x18, 0x0,  0x0,  0x49, 0xe9, 0x23, 0x30, 0x91, 0x23, 0xa,  0x0,  0x23, 0xe,  0x88, 0x22, 0xf,
      0x32, 0x1f, 0x0,  0x10, 0x35, 0xcd, 0x61, 0x8f, 0x21, 0xd3, 0x5b, 0xd1, 0x68, 0x7a, 0x5c, 0xf6, 0x9a, 0xdd, 0x6e,
      0x5a, 0x22, 0x28, 0xf4, 0x19, 0xf7, 0x2a, 0x5b, 0x1f, 0x0,  0x3,  0x8d, 0xe2, 0x76, 0x13, 0x2,  0xa4, 0x26, 0x0,
      0xc,  0x9e, 0x1a, 0x40, 0xb1, 0x89, 0x2a, 0xbe, 0xa0, 0x6a, 0xcb, 0xd,  0xa0, 0x0,  0xf,  0xbd, 0xdd, 0x9d, 0x6a,
      0x31, 0x5d, 0x1c, 0x74, 0xd9, 0xa8, 0x5a, 0x6f, 0xca, 0xe4, 0xad, 0x28, 0xb0, 0x25, 0x43, 0x0,  0x0,  0x19, 0x3,
      0x0,  0x16, 0x9d, 0x53, 0x90, 0xfd, 0x59, 0x7c, 0x3c, 0x81, 0x49, 0x2,  0x74, 0xcc, 0xff, 0x8e, 0x59, 0xa6, 0x48,
      0x3,  0xdb, 0x71, 0x6a, 0x3c, 0x0,  0x5,  0x18, 0x66, 0x9f, 0x9b, 0x6d, 0x0,  0x1a, 0x9b, 0x29, 0x54, 0xce, 0xfa,
      0xa3, 0x79, 0x2d, 0xd5, 0x5b, 0x5f, 0x7,  0x9f, 0x1d, 0x3d, 0xc3, 0x4c, 0x9b, 0x4c, 0xa4, 0xdc, 0xf3, 0xe1, 0x29,
      0xd0, 0x70, 0x0,  0x1e, 0xaf, 0x27, 0x1f, 0x37, 0x3e, 0x4,  0x2d, 0x4b, 0xa0, 0x0,  0xe,  0x86, 0x54, 0x94, 0xe8,
      0xc2, 0x84, 0x62, 0xda, 0xf,  0x45, 0xf1, 0x4c, 0x9c, 0xcc, 0xa9, 0x91, 0x58, 0x33, 0xfa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x89, 0x98, 0xb,  0xda, 0x98, 0x86, 0x1c, 0x30, 0x13, 0xcc, 0x62, 0x14, 0xd8, 0x8,
                           0x3a, 0x97, 0xbc, 0xa5, 0xf8, 0x32, 0x1b, 0x8e, 0xba, 0x7,  0x79, 0x76, 0xa8};
  uint8_t bytesprops0[] = {0x12, 0x1d, 0x1f, 0x57, 0x85, 0x12, 0x1e, 0x63, 0xd,  0x85, 0x6c, 0xaf, 0x98,
                           0x92, 0x7f, 0x59, 0xdb, 0xbe, 0xd1, 0xd8, 0x9d, 0x7e, 0xf0, 0xcb, 0x72};
  uint8_t bytesprops2[] = {0x60, 0x72, 0xe5, 0x1d, 0x9f, 0xb, 0xf1, 0xb3, 0x65};
  uint8_t bytesprops3[] = {0x35, 0xcd, 0x61, 0x8f, 0x21, 0xd3, 0x5b, 0xd1,
                           0x68, 0x7a, 0x5c, 0xf6, 0x9a, 0xdd, 0x6e, 0x5a};
  uint8_t bytesprops4[] = {0x8d, 0xe2, 0x76};
  uint8_t bytesprops6[] = {0xbd, 0xdd, 0x9d, 0x6a, 0x31, 0x5d, 0x1c, 0x74, 0xd9, 0xa8, 0x5a, 0x6f, 0xca, 0xe4, 0xad};
  uint8_t bytesprops5[] = {0x9e, 0x1a, 0x40, 0xb1, 0x89, 0x2a, 0xbe, 0xa0, 0x6a, 0xcb, 0xd, 0xa0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23466}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops0}, .v = {27, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4328}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18921}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12433}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2560}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3720}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3890}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10484}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 676}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops5}, .v = {15, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 67}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9d, 0x53, 0x90, 0xfd, 0x59, 0x7c, 0x3c, 0x81, 0x49, 0x2,  0x74,
                               0xcc, 0xff, 0x8e, 0x59, 0xa6, 0x48, 0x3,  0xdb, 0x71, 0x6a, 0x3c};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x18, 0x66, 0x9f, 0x9b, 0x6d};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x9b, 0x29, 0x54, 0xce, 0xfa, 0xa3, 0x79, 0x2d, 0xd5, 0x5b, 0x5f, 0x7,  0x9f,
                                  0x1d, 0x3d, 0xc3, 0x4c, 0x9b, 0x4c, 0xa4, 0xdc, 0xf3, 0xe1, 0x29, 0xd0, 0x70};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11529;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xaf, 0x27, 0x1f, 0x37, 0x3e, 0x4,  0x2d, 0x4b, 0xa0, 0x0,  0xe,  0x86, 0x54, 0x94, 0xe8,
                              0xc2, 0x84, 0x62, 0xda, 0xf,  0x45, 0xf1, 0x4c, 0x9c, 0xcc, 0xa9, 0x91, 0x58, 0x33, 0xfa};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ")\212\206\157>[\161\161\240\140\191\206", _password = Just
// "\175\183\193,\\>\244\ESCS\204\NULC\a\SOH\235\t\US\NAK\DC3", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "8m\ETB\253\&5\"\149h\193\210!\DC2\192\173\163\v\157\214z\231?", _willMsg =
// "~\239s\199\207\DLE\137)\195w\DEL\200D\166\195y\230\ETX\179\187\224\188\198@\212\ESC", _willProps =
// [PropMessageExpiryInterval 4271,PropMessageExpiryInterval 6823,PropCorrelationData "(0\151\DC1\137
// Jeg6\197\239E^\162\253i\211_\138i';d",PropRequestResponseInformation 145,PropAssignedClientIdentifier
// "6_\203\&0\142+4\178\193\178\b\221\233-\SUB|R\215\DC4\146c\183\ETB\148\210\209\191\DEL\f\236",PropReceiveMaximum
// 17759,PropTopicAliasMaximum 16206,PropMessageExpiryInterval 21818,PropPayloadFormatIndicator 130,PropCorrelationData
// "\211\161\189\133\232r\155:\133\238\239\201'\175*i\SUBl\SYN.r\172@\220\251\US",PropTopicAliasMaximum
// 29128,PropSubscriptionIdentifier 23,PropReasonString
// "\ESC?\213\147\182v\225\188\182\177\210\207,\ENQ|\247\185\229\197\255\165\253\135*Y\156\185\168\129\242",PropServerReference
// "w\207\&2\178\158G\153\226\SYNCVfh\198\176\252\EM",PropResponseInformation
// ">p~\254\186\236\237\231\SYN\161&\DLE\254S\163XW\143\175\&9\182\215\"",PropReasonString
// "9\132\250\181\230\208\254\&3\237\131\DELz{\217\183\156\n[",PropServerKeepAlive 14862,PropRequestResponseInformation
// 252,PropWillDelayInterval 26059,PropAssignedClientIdentifier "\157Z\vwb",PropMessageExpiryInterval
// 15429,PropAssignedClientIdentifier
// "\SO=\SO\165\159\255\DC1G\215\245A\223\163k=\181\164\242w\141t\251\166\&9",PropRequestProblemInformation
// 147,PropSessionExpiryInterval 29456,PropSessionExpiryInterval 11046]}), _cleanSession = True, _keepAlive = 1137,
// _connID = "H\161", _properties = [PropSubscriptionIdentifier 1,PropAssignedClientIdentifier
// "\224\225\217",PropSubscriptionIdentifier 8,PropSubscriptionIdentifierAvailable 172,PropRequestProblemInformation
// 231,PropMessageExpiryInterval 18221,PropReasonString "y\136\156\212K\150\176\201D",PropUserProperty
// "\145\250\EOT\NUL\171\165\ENQ\185r\138\142.\v\US\EOTNp\139\r\191O@\145\153]5r:e" "\152\NUL\161^q",PropUserProperty
// "XK$\161\247\t\DEL\191\ACK\137-\218\SUB\155rp\214\200\194\STX"
// "\153A{l\242%\185\202\164\220\205\210E\131\241\ACK+\\\235\165",PropSessionExpiryInterval 11196]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0xf8, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x4,  0x71, 0x78, 0xb,  0x1,  0x12, 0x0,  0x3,
      0xe0, 0xe1, 0xd9, 0xb,  0x8,  0x29, 0xac, 0x17, 0xe7, 0x2,  0x0,  0x0,  0x47, 0x2d, 0x1f, 0x0,  0x9,  0x79, 0x88,
      0x9c, 0xd4, 0x4b, 0x96, 0xb0, 0xc9, 0x44, 0x26, 0x0,  0x1d, 0x91, 0xfa, 0x4,  0x0,  0xab, 0xa5, 0x5,  0xb9, 0x72,
      0x8a, 0x8e, 0x2e, 0xb,  0x1f, 0x4,  0x4e, 0x70, 0x8b, 0xd,  0xbf, 0x4f, 0x40, 0x91, 0x99, 0x5d, 0x35, 0x72, 0x3a,
      0x65, 0x0,  0x5,  0x98, 0x0,  0xa1, 0x5e, 0x71, 0x26, 0x0,  0x14, 0x58, 0x4b, 0x24, 0xa1, 0xf7, 0x9,  0x7f, 0xbf,
      0x6,  0x89, 0x2d, 0xda, 0x1a, 0x9b, 0x72, 0x70, 0xd6, 0xc8, 0xc2, 0x2,  0x0,  0x14, 0x99, 0x41, 0x7b, 0x6c, 0xf2,
      0x25, 0xb9, 0xca, 0xa4, 0xdc, 0xcd, 0xd2, 0x45, 0x83, 0xf1, 0x6,  0x2b, 0x5c, 0xeb, 0xa5, 0x11, 0x0,  0x0,  0x2b,
      0xbc, 0x0,  0x2,  0x48, 0xa1, 0x99, 0x2,  0x2,  0x0,  0x0,  0x10, 0xaf, 0x2,  0x0,  0x0,  0x1a, 0xa7, 0x9,  0x0,
      0x18, 0x28, 0x30, 0x97, 0x11, 0x89, 0x20, 0x4a, 0x65, 0x67, 0x36, 0xc5, 0xef, 0x45, 0x5e, 0xa2, 0xfd, 0x69, 0xd3,
      0x5f, 0x8a, 0x69, 0x27, 0x3b, 0x64, 0x19, 0x91, 0x12, 0x0,  0x1e, 0x36, 0x5f, 0xcb, 0x30, 0x8e, 0x2b, 0x34, 0xb2,
      0xc1, 0xb2, 0x8,  0xdd, 0xe9, 0x2d, 0x1a, 0x7c, 0x52, 0xd7, 0x14, 0x92, 0x63, 0xb7, 0x17, 0x94, 0xd2, 0xd1, 0xbf,
      0x7f, 0xc,  0xec, 0x21, 0x45, 0x5f, 0x22, 0x3f, 0x4e, 0x2,  0x0,  0x0,  0x55, 0x3a, 0x1,  0x82, 0x9,  0x0,  0x1a,
      0xd3, 0xa1, 0xbd, 0x85, 0xe8, 0x72, 0x9b, 0x3a, 0x85, 0xee, 0xef, 0xc9, 0x27, 0xaf, 0x2a, 0x69, 0x1a, 0x6c, 0x16,
      0x2e, 0x72, 0xac, 0x40, 0xdc, 0xfb, 0x1f, 0x22, 0x71, 0xc8, 0xb,  0x17, 0x1f, 0x0,  0x1e, 0x1b, 0x3f, 0xd5, 0x93,
      0xb6, 0x76, 0xe1, 0xbc, 0xb6, 0xb1, 0xd2, 0xcf, 0x2c, 0x5,  0x7c, 0xf7, 0xb9, 0xe5, 0xc5, 0xff, 0xa5, 0xfd, 0x87,
      0x2a, 0x59, 0x9c, 0xb9, 0xa8, 0x81, 0xf2, 0x1c, 0x0,  0x11, 0x77, 0xcf, 0x32, 0xb2, 0x9e, 0x47, 0x99, 0xe2, 0x16,
      0x43, 0x56, 0x66, 0x68, 0xc6, 0xb0, 0xfc, 0x19, 0x1a, 0x0,  0x17, 0x3e, 0x70, 0x7e, 0xfe, 0xba, 0xec, 0xed, 0xe7,
      0x16, 0xa1, 0x26, 0x10, 0xfe, 0x53, 0xa3, 0x58, 0x57, 0x8f, 0xaf, 0x39, 0xb6, 0xd7, 0x22, 0x1f, 0x0,  0x12, 0x39,
      0x84, 0xfa, 0xb5, 0xe6, 0xd0, 0xfe, 0x33, 0xed, 0x83, 0x7f, 0x7a, 0x7b, 0xd9, 0xb7, 0x9c, 0xa,  0x5b, 0x13, 0x3a,
      0xe,  0x19, 0xfc, 0x18, 0x0,  0x0,  0x65, 0xcb, 0x12, 0x0,  0x5,  0x9d, 0x5a, 0xb,  0x77, 0x62, 0x2,  0x0,  0x0,
      0x3c, 0x45, 0x12, 0x0,  0x18, 0xe,  0x3d, 0xe,  0xa5, 0x9f, 0xff, 0x11, 0x47, 0xd7, 0xf5, 0x41, 0xdf, 0xa3, 0x6b,
      0x3d, 0xb5, 0xa4, 0xf2, 0x77, 0x8d, 0x74, 0xfb, 0xa6, 0x39, 0x17, 0x93, 0x11, 0x0,  0x0,  0x73, 0x10, 0x11, 0x0,
      0x0,  0x2b, 0x26, 0x0,  0x15, 0x38, 0x6d, 0x17, 0xfd, 0x35, 0x22, 0x95, 0x68, 0xc1, 0xd2, 0x21, 0x12, 0xc0, 0xad,
      0xa3, 0xb,  0x9d, 0xd6, 0x7a, 0xe7, 0x3f, 0x0,  0x1a, 0x7e, 0xef, 0x73, 0xc7, 0xcf, 0x10, 0x89, 0x29, 0xc3, 0x77,
      0x7f, 0xc8, 0x44, 0xa6, 0xc3, 0x79, 0xe6, 0x3,  0xb3, 0xbb, 0xe0, 0xbc, 0xc6, 0x40, 0xd4, 0x1b, 0x0,  0xc,  0x29,
      0xd4, 0xce, 0x9d, 0x3e, 0x5b, 0xa1, 0xa1, 0xf0, 0x8c, 0xbf, 0xce, 0x0,  0x13, 0xaf, 0xb7, 0xc1, 0x2c, 0x5c, 0x3e,
      0xf4, 0x1b, 0x53, 0xcc, 0x0,  0x43, 0x7,  0x1,  0xeb, 0x9,  0x1f, 0x15, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe0, 0xe1, 0xd9};
  uint8_t bytesprops1[] = {0x79, 0x88, 0x9c, 0xd4, 0x4b, 0x96, 0xb0, 0xc9, 0x44};
  uint8_t bytesprops3[] = {0x98, 0x0, 0xa1, 0x5e, 0x71};
  uint8_t bytesprops2[] = {0x91, 0xfa, 0x4,  0x0, 0xab, 0xa5, 0x5,  0xb9, 0x72, 0x8a, 0x8e, 0x2e, 0xb,  0x1f, 0x4,
                           0x4e, 0x70, 0x8b, 0xd, 0xbf, 0x4f, 0x40, 0x91, 0x99, 0x5d, 0x35, 0x72, 0x3a, 0x65};
  uint8_t bytesprops5[] = {0x99, 0x41, 0x7b, 0x6c, 0xf2, 0x25, 0xb9, 0xca, 0xa4, 0xdc,
                           0xcd, 0xd2, 0x45, 0x83, 0xf1, 0x6,  0x2b, 0x5c, 0xeb, 0xa5};
  uint8_t bytesprops4[] = {0x58, 0x4b, 0x24, 0xa1, 0xf7, 0x9,  0x7f, 0xbf, 0x6,  0x89,
                           0x2d, 0xda, 0x1a, 0x9b, 0x72, 0x70, 0xd6, 0xc8, 0xc2, 0x2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18221}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops2}, .v = {5, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops4}, .v = {20, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11196}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x28, 0x30, 0x97, 0x11, 0x89, 0x20, 0x4a, 0x65, 0x67, 0x36, 0xc5, 0xef,
                               0x45, 0x5e, 0xa2, 0xfd, 0x69, 0xd3, 0x5f, 0x8a, 0x69, 0x27, 0x3b, 0x64};
  uint8_t byteswillprops1[] = {0x36, 0x5f, 0xcb, 0x30, 0x8e, 0x2b, 0x34, 0xb2, 0xc1, 0xb2,
                               0x8,  0xdd, 0xe9, 0x2d, 0x1a, 0x7c, 0x52, 0xd7, 0x14, 0x92,
                               0x63, 0xb7, 0x17, 0x94, 0xd2, 0xd1, 0xbf, 0x7f, 0xc,  0xec};
  uint8_t byteswillprops2[] = {0xd3, 0xa1, 0xbd, 0x85, 0xe8, 0x72, 0x9b, 0x3a, 0x85, 0xee, 0xef, 0xc9, 0x27,
                               0xaf, 0x2a, 0x69, 0x1a, 0x6c, 0x16, 0x2e, 0x72, 0xac, 0x40, 0xdc, 0xfb, 0x1f};
  uint8_t byteswillprops3[] = {0x1b, 0x3f, 0xd5, 0x93, 0xb6, 0x76, 0xe1, 0xbc, 0xb6, 0xb1,
                               0xd2, 0xcf, 0x2c, 0x5,  0x7c, 0xf7, 0xb9, 0xe5, 0xc5, 0xff,
                               0xa5, 0xfd, 0x87, 0x2a, 0x59, 0x9c, 0xb9, 0xa8, 0x81, 0xf2};
  uint8_t byteswillprops4[] = {0x77, 0xcf, 0x32, 0xb2, 0x9e, 0x47, 0x99, 0xe2, 0x16,
                               0x43, 0x56, 0x66, 0x68, 0xc6, 0xb0, 0xfc, 0x19};
  uint8_t byteswillprops5[] = {0x3e, 0x70, 0x7e, 0xfe, 0xba, 0xec, 0xed, 0xe7, 0x16, 0xa1, 0x26, 0x10,
                               0xfe, 0x53, 0xa3, 0x58, 0x57, 0x8f, 0xaf, 0x39, 0xb6, 0xd7, 0x22};
  uint8_t byteswillprops6[] = {0x39, 0x84, 0xfa, 0xb5, 0xe6, 0xd0, 0xfe, 0x33, 0xed,
                               0x83, 0x7f, 0x7a, 0x7b, 0xd9, 0xb7, 0x9c, 0xa,  0x5b};
  uint8_t byteswillprops7[] = {0x9d, 0x5a, 0xb, 0x77, 0x62};
  uint8_t byteswillprops8[] = {0xe,  0x3d, 0xe,  0xa5, 0x9f, 0xff, 0x11, 0x47, 0xd7, 0xf5, 0x41, 0xdf,
                               0xa3, 0x6b, 0x3d, 0xb5, 0xa4, 0xf2, 0x77, 0x8d, 0x74, 0xfb, 0xa6, 0x39};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4271}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6823}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17759}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16206}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21818}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29128}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14862}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26059}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15429}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29456}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11046}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x38, 0x6d, 0x17, 0xfd, 0x35, 0x22, 0x95, 0x68, 0xc1, 0xd2, 0x21,
                                0x12, 0xc0, 0xad, 0xa3, 0xb,  0x9d, 0xd6, 0x7a, 0xe7, 0x3f};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7e, 0xef, 0x73, 0xc7, 0xcf, 0x10, 0x89, 0x29, 0xc3, 0x77, 0x7f, 0xc8, 0x44,
                                  0xa6, 0xc3, 0x79, 0xe6, 0x3,  0xb3, 0xbb, 0xe0, 0xbc, 0xc6, 0x40, 0xd4, 0x1b};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1137;
  uint8_t client_id_bytes[] = {0x48, 0xa1};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x29, 0xd4, 0xce, 0x9d, 0x3e, 0x5b, 0xa1, 0xa1, 0xf0, 0x8c, 0xbf, 0xce};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xaf, 0xb7, 0xc1, 0x2c, 0x5c, 0x3e, 0xf4, 0x1b, 0x53, 0xcc,
                              0x0,  0x43, 0x7,  0x1,  0xeb, 0x9,  0x1f, 0x15, 0x13};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\144", _password = Nothing, _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS2, _willTopic = "\ACKb<[2\a\182/h\252g\145S\156\179?6\NAK\232/\SO\241\213P\bk", _willMsg =
// "\EM\140\168c\240\ESC]:\250l\160>CT\DC4\ETB\209\DC2", _willProps = [PropReasonString
// "\167H\170W\158\144\163\232\187\DC1",PropReceiveMaximum 24898,PropTopicAliasMaximum 14664,PropAuthenticationData
// "\156U2",PropPayloadFormatIndicator 193,PropRetainAvailable 135,PropAuthenticationMethod
// "}\215\208\160n9\164\213\191h\143\165Bp\145D\SOH\208\217\200W7\DEL5X\236",PropAuthenticationMethod
// "\128\CANSS\201\197",PropServerReference
// "\233M\ESC\142\137:\r\190\144\SUB\230\173\EOT\173\227\211l\USv\\\162\169\252\192\t\208",PropRequestProblemInformation
// 186,PropSessionExpiryInterval 25634,PropReceiveMaximum 28271,PropMaximumQoS 167,PropRequestProblemInformation
// 243,PropWildcardSubscriptionAvailable 11,PropReasonString "x0'D\ACK\SO\248l$\130I_\144",PropAuthenticationData
// "h\154B2\234\SOHOW\254",PropResponseTopic "8\185 ~\138\240\192<",PropRequestResponseInformation
// 34,PropAuthenticationMethod "tv\233J",PropServerReference
// "~\170&\236\138{\ENQSr_\174+",PropSharedSubscriptionAvailable 77,PropServerReference
// "\253\152\149r\201;M\188\r\215c\248\SYNS\195\234j\228\202\142\251\211\230",PropAssignedClientIdentifier
// "\244Q\159\RS",PropPayloadFormatIndicator 83]}), _cleanSession = False, _keepAlive = 1187, _connID =
// "\162\135\139O\243\166\t(\204\167\213e\215\220d\185\n\149\233\144\b\218\229\235,", _properties =
// [PropAuthenticationMethod "H\207\251Jy\208P\176.",PropMaximumPacketSize 23348,PropAuthenticationData
// "\221\DC2\SOH\184\ACKY\232@\183\&0\DLE\187\NUL=\174\223\175\228\223-\137-+\131\\\246\180t\192\n",PropTopicAliasMaximum
// 14884,PropServerReference
// "g\143\174S\166\139\SO>\131\160.\141O\199\168\SO\US=m\EOT\200\149\158\174\&9y\143\182",PropTopicAlias
// 13879,PropAuthenticationMethod "\229\227\252\174\233\&40\227\190\225q\CAN",PropTopicAliasMaximum
// 27692,PropServerReference "\f#\160",PropTopicAlias 17970,PropAuthenticationData "r\246\196,?g",PropReasonString
// "\214C\f",PropMessageExpiryInterval 5452,PropAssignedClientIdentifier "\224\231\214=\SYNSJ",PropWillDelayInterval
// 17062,PropSubscriptionIdentifierAvailable 81,PropTopicAlias 30262,PropUserProperty "\176\244\188\242"
// "&\168W\EOT=X\160\t\145OZ\DLE\174\246\185\128\NUL\219]\139\196s\RS\182",PropRequestProblemInformation
// 158,PropPayloadFormatIndicator 158,PropContentType "\235\187\129F\198",PropAuthenticationData
// "8\DC39A\191\202\&6Q\216\229C\136_\244\166\220\194\186w\DC4J\t",PropMaximumQoS 87,PropMaximumPacketSize
// 25405,PropMaximumQoS 210,PropAuthenticationMethod "\180i\239\ENQ",PropRequestResponseInformation
// 90,PropAuthenticationMethod "e\n[\187Nh\143l;\ESC\223>'\133\ACKw1Nc\218\171",PropReceiveMaximum 24426]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0xbd, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x94, 0x4,  0xa3, 0x8d, 0x2,  0x15, 0x0,  0x9,  0x48,
      0xcf, 0xfb, 0x4a, 0x79, 0xd0, 0x50, 0xb0, 0x2e, 0x27, 0x0,  0x0,  0x5b, 0x34, 0x16, 0x0,  0x1e, 0xdd, 0x12, 0x1,
      0xb8, 0x6,  0x59, 0xe8, 0x40, 0xb7, 0x30, 0x10, 0xbb, 0x0,  0x3d, 0xae, 0xdf, 0xaf, 0xe4, 0xdf, 0x2d, 0x89, 0x2d,
      0x2b, 0x83, 0x5c, 0xf6, 0xb4, 0x74, 0xc0, 0xa,  0x22, 0x3a, 0x24, 0x1c, 0x0,  0x1c, 0x67, 0x8f, 0xae, 0x53, 0xa6,
      0x8b, 0xe,  0x3e, 0x83, 0xa0, 0x2e, 0x8d, 0x4f, 0xc7, 0xa8, 0xe,  0x1f, 0x3d, 0x6d, 0x4,  0xc8, 0x95, 0x9e, 0xae,
      0x39, 0x79, 0x8f, 0xb6, 0x23, 0x36, 0x37, 0x15, 0x0,  0xc,  0xe5, 0xe3, 0xfc, 0xae, 0xe9, 0x34, 0x30, 0xe3, 0xbe,
      0xe1, 0x71, 0x18, 0x22, 0x6c, 0x2c, 0x1c, 0x0,  0x3,  0xc,  0x23, 0xa0, 0x23, 0x46, 0x32, 0x16, 0x0,  0x6,  0x72,
      0xf6, 0xc4, 0x2c, 0x3f, 0x67, 0x1f, 0x0,  0x3,  0xd6, 0x43, 0xc,  0x2,  0x0,  0x0,  0x15, 0x4c, 0x12, 0x0,  0x7,
      0xe0, 0xe7, 0xd6, 0x3d, 0x16, 0x53, 0x4a, 0x18, 0x0,  0x0,  0x42, 0xa6, 0x29, 0x51, 0x23, 0x76, 0x36, 0x26, 0x0,
      0x4,  0xb0, 0xf4, 0xbc, 0xf2, 0x0,  0x18, 0x26, 0xa8, 0x57, 0x4,  0x3d, 0x58, 0xa0, 0x9,  0x91, 0x4f, 0x5a, 0x10,
      0xae, 0xf6, 0xb9, 0x80, 0x0,  0xdb, 0x5d, 0x8b, 0xc4, 0x73, 0x1e, 0xb6, 0x17, 0x9e, 0x1,  0x9e, 0x3,  0x0,  0x5,
      0xeb, 0xbb, 0x81, 0x46, 0xc6, 0x16, 0x0,  0x16, 0x38, 0x13, 0x39, 0x41, 0xbf, 0xca, 0x36, 0x51, 0xd8, 0xe5, 0x43,
      0x88, 0x5f, 0xf4, 0xa6, 0xdc, 0xc2, 0xba, 0x77, 0x14, 0x4a, 0x9,  0x24, 0x57, 0x27, 0x0,  0x0,  0x63, 0x3d, 0x24,
      0xd2, 0x15, 0x0,  0x4,  0xb4, 0x69, 0xef, 0x5,  0x19, 0x5a, 0x15, 0x0,  0x15, 0x65, 0xa,  0x5b, 0xbb, 0x4e, 0x68,
      0x8f, 0x6c, 0x3b, 0x1b, 0xdf, 0x3e, 0x27, 0x85, 0x6,  0x77, 0x31, 0x4e, 0x63, 0xda, 0xab, 0x21, 0x5f, 0x6a, 0x0,
      0x19, 0xa2, 0x87, 0x8b, 0x4f, 0xf3, 0xa6, 0x9,  0x28, 0xcc, 0xa7, 0xd5, 0x65, 0xd7, 0xdc, 0x64, 0xb9, 0xa,  0x95,
      0xe9, 0x90, 0x8,  0xda, 0xe5, 0xeb, 0x2c, 0xd4, 0x1,  0x1f, 0x0,  0xa,  0xa7, 0x48, 0xaa, 0x57, 0x9e, 0x90, 0xa3,
      0xe8, 0xbb, 0x11, 0x21, 0x61, 0x42, 0x22, 0x39, 0x48, 0x16, 0x0,  0x3,  0x9c, 0x55, 0x32, 0x1,  0xc1, 0x25, 0x87,
      0x15, 0x0,  0x1a, 0x7d, 0xd7, 0xd0, 0xa0, 0x6e, 0x39, 0xa4, 0xd5, 0xbf, 0x68, 0x8f, 0xa5, 0x42, 0x70, 0x91, 0x44,
      0x1,  0xd0, 0xd9, 0xc8, 0x57, 0x37, 0x7f, 0x35, 0x58, 0xec, 0x15, 0x0,  0x6,  0x80, 0x18, 0x53, 0x53, 0xc9, 0xc5,
      0x1c, 0x0,  0x1a, 0xe9, 0x4d, 0x1b, 0x8e, 0x89, 0x3a, 0xd,  0xbe, 0x90, 0x1a, 0xe6, 0xad, 0x4,  0xad, 0xe3, 0xd3,
      0x6c, 0x1f, 0x76, 0x5c, 0xa2, 0xa9, 0xfc, 0xc0, 0x9,  0xd0, 0x17, 0xba, 0x11, 0x0,  0x0,  0x64, 0x22, 0x21, 0x6e,
      0x6f, 0x24, 0xa7, 0x17, 0xf3, 0x28, 0xb,  0x1f, 0x0,  0xd,  0x78, 0x30, 0x27, 0x44, 0x6,  0xe,  0xf8, 0x6c, 0x24,
      0x82, 0x49, 0x5f, 0x90, 0x16, 0x0,  0x9,  0x68, 0x9a, 0x42, 0x32, 0xea, 0x1,  0x4f, 0x57, 0xfe, 0x8,  0x0,  0x8,
      0x38, 0xb9, 0x20, 0x7e, 0x8a, 0xf0, 0xc0, 0x3c, 0x19, 0x22, 0x15, 0x0,  0x4,  0x74, 0x76, 0xe9, 0x4a, 0x1c, 0x0,
      0xc,  0x7e, 0xaa, 0x26, 0xec, 0x8a, 0x7b, 0x5,  0x53, 0x72, 0x5f, 0xae, 0x2b, 0x2a, 0x4d, 0x1c, 0x0,  0x17, 0xfd,
      0x98, 0x95, 0x72, 0xc9, 0x3b, 0x4d, 0xbc, 0xd,  0xd7, 0x63, 0xf8, 0x16, 0x53, 0xc3, 0xea, 0x6a, 0xe4, 0xca, 0x8e,
      0xfb, 0xd3, 0xe6, 0x12, 0x0,  0x4,  0xf4, 0x51, 0x9f, 0x1e, 0x1,  0x53, 0x0,  0x1a, 0x6,  0x62, 0x3c, 0x5b, 0x32,
      0x7,  0xb6, 0x2f, 0x68, 0xfc, 0x67, 0x91, 0x53, 0x9c, 0xb3, 0x3f, 0x36, 0x15, 0xe8, 0x2f, 0xe,  0xf1, 0xd5, 0x50,
      0x8,  0x6b, 0x0,  0x12, 0x19, 0x8c, 0xa8, 0x63, 0xf0, 0x1b, 0x5d, 0x3a, 0xfa, 0x6c, 0xa0, 0x3e, 0x43, 0x54, 0x14,
      0x17, 0xd1, 0x12, 0x0,  0x1,  0x90};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x48, 0xcf, 0xfb, 0x4a, 0x79, 0xd0, 0x50, 0xb0, 0x2e};
  uint8_t bytesprops1[] = {0xdd, 0x12, 0x1,  0xb8, 0x6,  0x59, 0xe8, 0x40, 0xb7, 0x30, 0x10, 0xbb, 0x0,  0x3d, 0xae,
                           0xdf, 0xaf, 0xe4, 0xdf, 0x2d, 0x89, 0x2d, 0x2b, 0x83, 0x5c, 0xf6, 0xb4, 0x74, 0xc0, 0xa};
  uint8_t bytesprops2[] = {0x67, 0x8f, 0xae, 0x53, 0xa6, 0x8b, 0xe,  0x3e, 0x83, 0xa0, 0x2e, 0x8d, 0x4f, 0xc7,
                           0xa8, 0xe,  0x1f, 0x3d, 0x6d, 0x4,  0xc8, 0x95, 0x9e, 0xae, 0x39, 0x79, 0x8f, 0xb6};
  uint8_t bytesprops3[] = {0xe5, 0xe3, 0xfc, 0xae, 0xe9, 0x34, 0x30, 0xe3, 0xbe, 0xe1, 0x71, 0x18};
  uint8_t bytesprops4[] = {0xc, 0x23, 0xa0};
  uint8_t bytesprops5[] = {0x72, 0xf6, 0xc4, 0x2c, 0x3f, 0x67};
  uint8_t bytesprops6[] = {0xd6, 0x43, 0xc};
  uint8_t bytesprops7[] = {0xe0, 0xe7, 0xd6, 0x3d, 0x16, 0x53, 0x4a};
  uint8_t bytesprops9[] = {0x26, 0xa8, 0x57, 0x4,  0x3d, 0x58, 0xa0, 0x9,  0x91, 0x4f, 0x5a, 0x10,
                           0xae, 0xf6, 0xb9, 0x80, 0x0,  0xdb, 0x5d, 0x8b, 0xc4, 0x73, 0x1e, 0xb6};
  uint8_t bytesprops8[] = {0xb0, 0xf4, 0xbc, 0xf2};
  uint8_t bytesprops10[] = {0xeb, 0xbb, 0x81, 0x46, 0xc6};
  uint8_t bytesprops11[] = {0x38, 0x13, 0x39, 0x41, 0xbf, 0xca, 0x36, 0x51, 0xd8, 0xe5, 0x43,
                            0x88, 0x5f, 0xf4, 0xa6, 0xdc, 0xc2, 0xba, 0x77, 0x14, 0x4a, 0x9};
  uint8_t bytesprops12[] = {0xb4, 0x69, 0xef, 0x5};
  uint8_t bytesprops13[] = {0x65, 0xa,  0x5b, 0xbb, 0x4e, 0x68, 0x8f, 0x6c, 0x3b, 0x1b, 0xdf,
                            0x3e, 0x27, 0x85, 0x6,  0x77, 0x31, 0x4e, 0x63, 0xda, 0xab};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23348}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14884}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13879}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27692}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17970}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5452}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17062}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30262}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops8}, .v = {24, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25405}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24426}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa7, 0x48, 0xaa, 0x57, 0x9e, 0x90, 0xa3, 0xe8, 0xbb, 0x11};
  uint8_t byteswillprops1[] = {0x9c, 0x55, 0x32};
  uint8_t byteswillprops2[] = {0x7d, 0xd7, 0xd0, 0xa0, 0x6e, 0x39, 0xa4, 0xd5, 0xbf, 0x68, 0x8f, 0xa5, 0x42,
                               0x70, 0x91, 0x44, 0x1,  0xd0, 0xd9, 0xc8, 0x57, 0x37, 0x7f, 0x35, 0x58, 0xec};
  uint8_t byteswillprops3[] = {0x80, 0x18, 0x53, 0x53, 0xc9, 0xc5};
  uint8_t byteswillprops4[] = {0xe9, 0x4d, 0x1b, 0x8e, 0x89, 0x3a, 0xd,  0xbe, 0x90, 0x1a, 0xe6, 0xad, 0x4,
                               0xad, 0xe3, 0xd3, 0x6c, 0x1f, 0x76, 0x5c, 0xa2, 0xa9, 0xfc, 0xc0, 0x9,  0xd0};
  uint8_t byteswillprops5[] = {0x78, 0x30, 0x27, 0x44, 0x6, 0xe, 0xf8, 0x6c, 0x24, 0x82, 0x49, 0x5f, 0x90};
  uint8_t byteswillprops6[] = {0x68, 0x9a, 0x42, 0x32, 0xea, 0x1, 0x4f, 0x57, 0xfe};
  uint8_t byteswillprops7[] = {0x38, 0xb9, 0x20, 0x7e, 0x8a, 0xf0, 0xc0, 0x3c};
  uint8_t byteswillprops8[] = {0x74, 0x76, 0xe9, 0x4a};
  uint8_t byteswillprops9[] = {0x7e, 0xaa, 0x26, 0xec, 0x8a, 0x7b, 0x5, 0x53, 0x72, 0x5f, 0xae, 0x2b};
  uint8_t byteswillprops10[] = {0xfd, 0x98, 0x95, 0x72, 0xc9, 0x3b, 0x4d, 0xbc, 0xd,  0xd7, 0x63, 0xf8,
                                0x16, 0x53, 0xc3, 0xea, 0x6a, 0xe4, 0xca, 0x8e, 0xfb, 0xd3, 0xe6};
  uint8_t byteswillprops11[] = {0xf4, 0x51, 0x9f, 0x1e};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24898}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14664}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25634}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28271}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 83}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6,  0x62, 0x3c, 0x5b, 0x32, 0x7,  0xb6, 0x2f, 0x68, 0xfc, 0x67, 0x91, 0x53,
                                0x9c, 0xb3, 0x3f, 0x36, 0x15, 0xe8, 0x2f, 0xe,  0xf1, 0xd5, 0x50, 0x8,  0x6b};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x19, 0x8c, 0xa8, 0x63, 0xf0, 0x1b, 0x5d, 0x3a, 0xfa,
                                  0x6c, 0xa0, 0x3e, 0x43, 0x54, 0x14, 0x17, 0xd1, 0x12};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1187;
  uint8_t client_id_bytes[] = {0xa2, 0x87, 0x8b, 0x4f, 0xf3, 0xa6, 0x9,  0x28, 0xcc, 0xa7, 0xd5, 0x65, 0xd7,
                               0xdc, 0x64, 0xb9, 0xa,  0x95, 0xe9, 0x90, 0x8,  0xda, 0xe5, 0xeb, 0x2c};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x90};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "$`\SYN}79\139\SUB\138\ETX\146\rK\199\236*\DC2`D\178", _willMsg =
// "\146\226\241\226\SUB$6\236\236\SYN_\134\252\240\ACK\220_\158~\191\130\215\178", _willProps = []}), _cleanSession =
// False, _keepAlive = 6339, _connID = "", _properties = [PropAuthenticationData "\147\n",PropWillDelayInterval
// 11436,PropAssignedClientIdentifier "M\SO\165eHS-\SUB\180o\161> \152\230\205",PropSubscriptionIdentifier
// 18,PropSubscriptionIdentifierAvailable 233,PropMessageExpiryInterval 7344,PropRequestProblemInformation
// 222,PropServerReference ",\207\232\227\134\215\231\254x!\182",PropWildcardSubscriptionAvailable
// 195,PropAssignedClientIdentifier "\182%\233s\174\148\136IZ.",PropAuthenticationMethod
// "\235L7(\"\141\194\192\245F\164\USf\189\211\163\225}z\251\212\199t\DC2az\ETB",PropSubscriptionIdentifier
// 19,PropRetainAvailable 112,PropResponseTopic
// "\215\ETX5l9r\161\a\NUL\171\218\250\159$\250d\136Wn*|H\CAN\229\246\NUL8\186",PropTopicAliasMaximum
// 8032,PropReasonString "\\l\154\131\224\221yH\135CY\174\149\a\177;F\238\138\167\" \133/\147",PropAuthenticationData
// "\ETB\212\224\RSb\213-\212\230\188O\229",PropResponseInformation
// "\216\189\232g\v\190\208n\NULOXzK\SO\135\221y\156\143I\154'%\255",PropMessageExpiryInterval
// 23716,PropSubscriptionIdentifierAvailable 208,PropServerKeepAlive 14535]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0x97, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4,  0x18, 0xc3, 0xd9, 0x1,  0x16, 0x0,  0x2,  0x93,
      0xa,  0x18, 0x0,  0x0,  0x2c, 0xac, 0x12, 0x0,  0x10, 0x4d, 0xe,  0xa5, 0x65, 0x48, 0x53, 0x2d, 0x1a, 0xb4, 0x6f,
      0xa1, 0x3e, 0x20, 0x98, 0xe6, 0xcd, 0xb,  0x12, 0x29, 0xe9, 0x2,  0x0,  0x0,  0x1c, 0xb0, 0x17, 0xde, 0x1c, 0x0,
      0xb,  0x2c, 0xcf, 0xe8, 0xe3, 0x86, 0xd7, 0xe7, 0xfe, 0x78, 0x21, 0xb6, 0x28, 0xc3, 0x12, 0x0,  0xa,  0xb6, 0x25,
      0xe9, 0x73, 0xae, 0x94, 0x88, 0x49, 0x5a, 0x2e, 0x15, 0x0,  0x1b, 0xeb, 0x4c, 0x37, 0x28, 0x22, 0x8d, 0xc2, 0xc0,
      0xf5, 0x46, 0xa4, 0x1f, 0x66, 0xbd, 0xd3, 0xa3, 0xe1, 0x7d, 0x7a, 0xfb, 0xd4, 0xc7, 0x74, 0x12, 0x61, 0x7a, 0x17,
      0xb,  0x13, 0x25, 0x70, 0x8,  0x0,  0x1c, 0xd7, 0x3,  0x35, 0x6c, 0x39, 0x72, 0xa1, 0x7,  0x0,  0xab, 0xda, 0xfa,
      0x9f, 0x24, 0xfa, 0x64, 0x88, 0x57, 0x6e, 0x2a, 0x7c, 0x48, 0x18, 0xe5, 0xf6, 0x0,  0x38, 0xba, 0x22, 0x1f, 0x60,
      0x1f, 0x0,  0x19, 0x5c, 0x6c, 0x9a, 0x83, 0xe0, 0xdd, 0x79, 0x48, 0x87, 0x43, 0x59, 0xae, 0x95, 0x7,  0xb1, 0x3b,
      0x46, 0xee, 0x8a, 0xa7, 0x22, 0x20, 0x85, 0x2f, 0x93, 0x16, 0x0,  0xc,  0x17, 0xd4, 0xe0, 0x1e, 0x62, 0xd5, 0x2d,
      0xd4, 0xe6, 0xbc, 0x4f, 0xe5, 0x1a, 0x0,  0x18, 0xd8, 0xbd, 0xe8, 0x67, 0xb,  0xbe, 0xd0, 0x6e, 0x0,  0x4f, 0x58,
      0x7a, 0x4b, 0xe,  0x87, 0xdd, 0x79, 0x9c, 0x8f, 0x49, 0x9a, 0x27, 0x25, 0xff, 0x2,  0x0,  0x0,  0x5c, 0xa4, 0x29,
      0xd0, 0x13, 0x38, 0xc7, 0x0,  0x0,  0x0,  0x0,  0x14, 0x24, 0x60, 0x16, 0x7d, 0x37, 0x39, 0x8b, 0x1a, 0x8a, 0x3,
      0x92, 0xd,  0x4b, 0xc7, 0xec, 0x2a, 0x12, 0x60, 0x44, 0xb2, 0x0,  0x17, 0x92, 0xe2, 0xf1, 0xe2, 0x1a, 0x24, 0x36,
      0xec, 0xec, 0x16, 0x5f, 0x86, 0xfc, 0xf0, 0x6,  0xdc, 0x5f, 0x9e, 0x7e, 0xbf, 0x82, 0xd7, 0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x93, 0xa};
  uint8_t bytesprops1[] = {0x4d, 0xe,  0xa5, 0x65, 0x48, 0x53, 0x2d, 0x1a,
                           0xb4, 0x6f, 0xa1, 0x3e, 0x20, 0x98, 0xe6, 0xcd};
  uint8_t bytesprops2[] = {0x2c, 0xcf, 0xe8, 0xe3, 0x86, 0xd7, 0xe7, 0xfe, 0x78, 0x21, 0xb6};
  uint8_t bytesprops3[] = {0xb6, 0x25, 0xe9, 0x73, 0xae, 0x94, 0x88, 0x49, 0x5a, 0x2e};
  uint8_t bytesprops4[] = {0xeb, 0x4c, 0x37, 0x28, 0x22, 0x8d, 0xc2, 0xc0, 0xf5, 0x46, 0xa4, 0x1f, 0x66, 0xbd,
                           0xd3, 0xa3, 0xe1, 0x7d, 0x7a, 0xfb, 0xd4, 0xc7, 0x74, 0x12, 0x61, 0x7a, 0x17};
  uint8_t bytesprops5[] = {0xd7, 0x3,  0x35, 0x6c, 0x39, 0x72, 0xa1, 0x7,  0x0,  0xab, 0xda, 0xfa, 0x9f, 0x24,
                           0xfa, 0x64, 0x88, 0x57, 0x6e, 0x2a, 0x7c, 0x48, 0x18, 0xe5, 0xf6, 0x0,  0x38, 0xba};
  uint8_t bytesprops6[] = {0x5c, 0x6c, 0x9a, 0x83, 0xe0, 0xdd, 0x79, 0x48, 0x87, 0x43, 0x59, 0xae, 0x95,
                           0x7,  0xb1, 0x3b, 0x46, 0xee, 0x8a, 0xa7, 0x22, 0x20, 0x85, 0x2f, 0x93};
  uint8_t bytesprops7[] = {0x17, 0xd4, 0xe0, 0x1e, 0x62, 0xd5, 0x2d, 0xd4, 0xe6, 0xbc, 0x4f, 0xe5};
  uint8_t bytesprops8[] = {0xd8, 0xbd, 0xe8, 0x67, 0xb,  0xbe, 0xd0, 0x6e, 0x0,  0x4f, 0x58, 0x7a,
                           0x4b, 0xe,  0x87, 0xdd, 0x79, 0x9c, 0x8f, 0x49, 0x9a, 0x27, 0x25, 0xff};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11436}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7344}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8032}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23716}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14535}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x24, 0x60, 0x16, 0x7d, 0x37, 0x39, 0x8b, 0x1a, 0x8a, 0x3,
                                0x92, 0xd,  0x4b, 0xc7, 0xec, 0x2a, 0x12, 0x60, 0x44, 0xb2};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x92, 0xe2, 0xf1, 0xe2, 0x1a, 0x24, 0x36, 0xec, 0xec, 0x16, 0x5f, 0x86,
                                  0xfc, 0xf0, 0x6,  0xdc, 0x5f, 0x9e, 0x7e, 0xbf, 0x82, 0xd7, 0xb2};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6339;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\195\225Z\248\165S\201G\ne9\161>\FS\201_\239D\203\r", _password = Just
// "\230WH\211", _lastWill = Nothing, _cleanSession = False, _keepAlive = 22088, _connID = "nx\237\250`\150",
// _properties = [PropRequestResponseInformation 102,PropPayloadFormatIndicator 219,PropWildcardSubscriptionAvailable
// 12,PropCorrelationData ";\169?\SOH\186p\248\140B\DC3@~r\148\227\162\153e\FSgP",PropRetainAvailable
// 64,PropRetainAvailable 132,PropUserProperty "F." "\174G\250\234\t\DC4\141\200",PropRetainAvailable
// 216,PropSharedSubscriptionAvailable 239,PropSubscriptionIdentifierAvailable 91,PropTopicAliasMaximum
// 16140,PropRequestProblemInformation 171,PropReasonString
// "\na\208\187h6d|%\250q*\171F\245\178\160\147\&9r\144s\237\ETB\170gO\253",PropMessageExpiryInterval
// 27214,PropCorrelationData "\206\195\196\195\n|\215\ETX\173\243\218\240v\197\234O\225\248",PropPayloadFormatIndicator
// 68,PropSessionExpiryInterval 3981,PropAssignedClientIdentifier
// "\215\147\\m\215\186\217S\tI\147n\NAK",PropAssignedClientIdentifier
// "\"@\193\135\139\179\157\252:\193\NULV(\SO\156",PropCorrelationData
// "\DC3\180\&73Y\209o\255\DC4\158\135fc\219nub.\204N\159\200\143\136",PropRequestResponseInformation 139,PropTopicAlias
// 7297,PropAuthenticationData "}U@\204\189\190\253\204\139#\v\164",PropServerReference "{S\167\DC1\\MI
// Z\STX\ACKK\198\180",PropSubscriptionIdentifier 10,PropWillDelayInterval 2992,PropReceiveMaximum
// 14476,PropPayloadFormatIndicator 15]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0x9a, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x56, 0x48, 0xea, 0x1,  0x19, 0x66, 0x1,  0xdb,
      0x28, 0xc,  0x9,  0x0,  0x15, 0x3b, 0xa9, 0x3f, 0x1,  0xba, 0x70, 0xf8, 0x8c, 0x42, 0x13, 0x40, 0x7e, 0x72, 0x94,
      0xe3, 0xa2, 0x99, 0x65, 0x1c, 0x67, 0x50, 0x25, 0x40, 0x25, 0x84, 0x26, 0x0,  0x2,  0x46, 0x2e, 0x0,  0x8,  0xae,
      0x47, 0xfa, 0xea, 0x9,  0x14, 0x8d, 0xc8, 0x25, 0xd8, 0x2a, 0xef, 0x29, 0x5b, 0x22, 0x3f, 0xc,  0x17, 0xab, 0x1f,
      0x0,  0x1c, 0xa,  0x61, 0xd0, 0xbb, 0x68, 0x36, 0x64, 0x7c, 0x25, 0xfa, 0x71, 0x2a, 0xab, 0x46, 0xf5, 0xb2, 0xa0,
      0x93, 0x39, 0x72, 0x90, 0x73, 0xed, 0x17, 0xaa, 0x67, 0x4f, 0xfd, 0x2,  0x0,  0x0,  0x6a, 0x4e, 0x9,  0x0,  0x12,
      0xce, 0xc3, 0xc4, 0xc3, 0xa,  0x7c, 0xd7, 0x3,  0xad, 0xf3, 0xda, 0xf0, 0x76, 0xc5, 0xea, 0x4f, 0xe1, 0xf8, 0x1,
      0x44, 0x11, 0x0,  0x0,  0xf,  0x8d, 0x12, 0x0,  0xd,  0xd7, 0x93, 0x5c, 0x6d, 0xd7, 0xba, 0xd9, 0x53, 0x9,  0x49,
      0x93, 0x6e, 0x15, 0x12, 0x0,  0xf,  0x22, 0x40, 0xc1, 0x87, 0x8b, 0xb3, 0x9d, 0xfc, 0x3a, 0xc1, 0x0,  0x56, 0x28,
      0xe,  0x9c, 0x9,  0x0,  0x18, 0x13, 0xb4, 0x37, 0x33, 0x59, 0xd1, 0x6f, 0xff, 0x14, 0x9e, 0x87, 0x66, 0x63, 0xdb,
      0x6e, 0x75, 0x62, 0x2e, 0xcc, 0x4e, 0x9f, 0xc8, 0x8f, 0x88, 0x19, 0x8b, 0x23, 0x1c, 0x81, 0x16, 0x0,  0xc,  0x7d,
      0x55, 0x40, 0xcc, 0xbd, 0xbe, 0xfd, 0xcc, 0x8b, 0x23, 0xb,  0xa4, 0x1c, 0x0,  0xe,  0x7b, 0x53, 0xa7, 0x11, 0x5c,
      0x4d, 0x49, 0x20, 0x5a, 0x2,  0x6,  0x4b, 0xc6, 0xb4, 0xb,  0xa,  0x18, 0x0,  0x0,  0xb,  0xb0, 0x21, 0x38, 0x8c,
      0x1,  0xf,  0x0,  0x6,  0x6e, 0x78, 0xed, 0xfa, 0x60, 0x96, 0x0,  0x14, 0xc3, 0xe1, 0x5a, 0xf8, 0xa5, 0x53, 0xc9,
      0x47, 0xa,  0x65, 0x39, 0xa1, 0x3e, 0x1c, 0xc9, 0x5f, 0xef, 0x44, 0xcb, 0xd,  0x0,  0x4,  0xe6, 0x57, 0x48, 0xd3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3b, 0xa9, 0x3f, 0x1,  0xba, 0x70, 0xf8, 0x8c, 0x42, 0x13, 0x40,
                           0x7e, 0x72, 0x94, 0xe3, 0xa2, 0x99, 0x65, 0x1c, 0x67, 0x50};
  uint8_t bytesprops2[] = {0xae, 0x47, 0xfa, 0xea, 0x9, 0x14, 0x8d, 0xc8};
  uint8_t bytesprops1[] = {0x46, 0x2e};
  uint8_t bytesprops3[] = {0xa,  0x61, 0xd0, 0xbb, 0x68, 0x36, 0x64, 0x7c, 0x25, 0xfa, 0x71, 0x2a, 0xab, 0x46,
                           0xf5, 0xb2, 0xa0, 0x93, 0x39, 0x72, 0x90, 0x73, 0xed, 0x17, 0xaa, 0x67, 0x4f, 0xfd};
  uint8_t bytesprops4[] = {0xce, 0xc3, 0xc4, 0xc3, 0xa,  0x7c, 0xd7, 0x3,  0xad,
                           0xf3, 0xda, 0xf0, 0x76, 0xc5, 0xea, 0x4f, 0xe1, 0xf8};
  uint8_t bytesprops5[] = {0xd7, 0x93, 0x5c, 0x6d, 0xd7, 0xba, 0xd9, 0x53, 0x9, 0x49, 0x93, 0x6e, 0x15};
  uint8_t bytesprops6[] = {0x22, 0x40, 0xc1, 0x87, 0x8b, 0xb3, 0x9d, 0xfc, 0x3a, 0xc1, 0x0, 0x56, 0x28, 0xe, 0x9c};
  uint8_t bytesprops7[] = {0x13, 0xb4, 0x37, 0x33, 0x59, 0xd1, 0x6f, 0xff, 0x14, 0x9e, 0x87, 0x66,
                           0x63, 0xdb, 0x6e, 0x75, 0x62, 0x2e, 0xcc, 0x4e, 0x9f, 0xc8, 0x8f, 0x88};
  uint8_t bytesprops8[] = {0x7d, 0x55, 0x40, 0xcc, 0xbd, 0xbe, 0xfd, 0xcc, 0x8b, 0x23, 0xb, 0xa4};
  uint8_t bytesprops9[] = {0x7b, 0x53, 0xa7, 0x11, 0x5c, 0x4d, 0x49, 0x20, 0x5a, 0x2, 0x6, 0x4b, 0xc6, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16140}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27214}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3981}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7297}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2992}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14476}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 15}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 22088;
  uint8_t client_id_bytes[] = {0x6e, 0x78, 0xed, 0xfa, 0x60, 0x96};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc3, 0xe1, 0x5a, 0xf8, 0xa5, 0x53, 0xc9, 0x47, 0xa,  0x65,
                              0x39, 0xa1, 0x3e, 0x1c, 0xc9, 0x5f, 0xef, 0x44, 0xcb, 0xd};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe6, 0x57, 0x48, 0xd3};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "7{\215\177Q\252!\233\141P\206\242", _password = Just
// "\ETX\fegm\236K\157\249\140\DC3\144\186-9\156\238\222\167\138\202\SYN", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS1, _willTopic = "j&\214\247\206Z\212\219\RS\US-,\155\190e!\\\142\GS\243X\241", _willMsg =
// "\SYN\183\156\207\209\215", _willProps = [PropReceiveMaximum 31818,PropWildcardSubscriptionAvailable
// 224,PropServerKeepAlive 8513,PropRetainAvailable 133,PropSubscriptionIdentifierAvailable 169,PropServerKeepAlive
// 16360,PropAssignedClientIdentifier
// "7\243</`\STXd\208\&6b\191y\236\DLE\b\228\231\SOH\241\138\f.",PropWildcardSubscriptionAvailable
// 77,PropMessageExpiryInterval 22714,PropResponseInformation
// "\206\243\DEL\254\\\155@\250\216\235\ACK\148+\211",PropReasonString
// "\223\215\196\232;,\195\233@\212\218\224\235<\248\196qm\183\194\&0\FS\EOT\ETB]a\171\215\185/",PropWillDelayInterval
// 1969,PropSessionExpiryInterval 24092,PropAssignedClientIdentifier
// "p?\146\n\SI$\156P\NUL\160\217\&2\128\189-I\SOH\162\190\144W\151\214",PropContentType "\ETX",PropServerReference
// "\200q",PropUserProperty "\246Gw\146>\131\187\GSgs\132\148\245"
// "\NULA\ACK\207bc\214\161\190\248o\171M\149\142r\135\205\SI\131x\132"]}), _cleanSession = True, _keepAlive = 26306,
// _connID = "\SI&\208\136\142lJ|\nQ\231\&2,\161\FS\184", _properties = [PropCorrelationData
// "kC8\129\150/\197\176\179\200\140\159\183\203\154\NUL\135\DC4_w\157\158\v\247\213`U(\209\n",PropMessageExpiryInterval
// 3478,PropMaximumQoS 222,PropMessageExpiryInterval 23782,PropResponseTopic "\157",PropSubscriptionIdentifierAvailable
// 187,PropMessageExpiryInterval 25410,PropPayloadFormatIndicator 1,PropResponseInformation
// "\174\220\196\192t\230\196yu\199\201\244j\218\&5\184zZbT6\SUB[\245\221\a",PropResponseInformation
// "\227\184\FS\f0[\203f\192\DC3\179;\\K",PropCorrelationData "*\235`\150\210\ACK?",PropServerKeepAlive
// 705,PropTopicAlias 31472,PropReasonString
// "\234\212\DC1\232\222q\r\234k\130\242;\239V\DC2DA\152T\131\212\RS\213\180\208\220\RS",PropMessageExpiryInterval
// 24407,PropWillDelayInterval 28666,PropMessageExpiryInterval 24637,PropAuthenticationData
// "\226iup\252\137\163\218\135\203'",PropRetainAvailable 75,PropSubscriptionIdentifierAvailable
// 132,PropAuthenticationMethod "\vG\212aW\r2\230\DC4\176\145\237\DLE'",PropMaximumQoS 134,PropContentType
// "\225\182\179\141\168\&0\133\165\130\152P\175\229\213P",PropRetainAvailable 220]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0xfa, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x66, 0xc2, 0xde, 0x1,  0x9,  0x0,  0x1e, 0x6b,
      0x43, 0x38, 0x81, 0x96, 0x2f, 0xc5, 0xb0, 0xb3, 0xc8, 0x8c, 0x9f, 0xb7, 0xcb, 0x9a, 0x0,  0x87, 0x14, 0x5f, 0x77,
      0x9d, 0x9e, 0xb,  0xf7, 0xd5, 0x60, 0x55, 0x28, 0xd1, 0xa,  0x2,  0x0,  0x0,  0xd,  0x96, 0x24, 0xde, 0x2,  0x0,
      0x0,  0x5c, 0xe6, 0x8,  0x0,  0x1,  0x9d, 0x29, 0xbb, 0x2,  0x0,  0x0,  0x63, 0x42, 0x1,  0x1,  0x1a, 0x0,  0x1a,
      0xae, 0xdc, 0xc4, 0xc0, 0x74, 0xe6, 0xc4, 0x79, 0x75, 0xc7, 0xc9, 0xf4, 0x6a, 0xda, 0x35, 0xb8, 0x7a, 0x5a, 0x62,
      0x54, 0x36, 0x1a, 0x5b, 0xf5, 0xdd, 0x7,  0x1a, 0x0,  0xe,  0xe3, 0xb8, 0x1c, 0xc,  0x30, 0x5b, 0xcb, 0x66, 0xc0,
      0x13, 0xb3, 0x3b, 0x5c, 0x4b, 0x9,  0x0,  0x7,  0x2a, 0xeb, 0x60, 0x96, 0xd2, 0x6,  0x3f, 0x13, 0x2,  0xc1, 0x23,
      0x7a, 0xf0, 0x1f, 0x0,  0x1b, 0xea, 0xd4, 0x11, 0xe8, 0xde, 0x71, 0xd,  0xea, 0x6b, 0x82, 0xf2, 0x3b, 0xef, 0x56,
      0x12, 0x44, 0x41, 0x98, 0x54, 0x83, 0xd4, 0x1e, 0xd5, 0xb4, 0xd0, 0xdc, 0x1e, 0x2,  0x0,  0x0,  0x5f, 0x57, 0x18,
      0x0,  0x0,  0x6f, 0xfa, 0x2,  0x0,  0x0,  0x60, 0x3d, 0x16, 0x0,  0xb,  0xe2, 0x69, 0x75, 0x70, 0xfc, 0x89, 0xa3,
      0xda, 0x87, 0xcb, 0x27, 0x25, 0x4b, 0x29, 0x84, 0x15, 0x0,  0xe,  0xb,  0x47, 0xd4, 0x61, 0x57, 0xd,  0x32, 0xe6,
      0x14, 0xb0, 0x91, 0xed, 0x10, 0x27, 0x24, 0x86, 0x3,  0x0,  0xf,  0xe1, 0xb6, 0xb3, 0x8d, 0xa8, 0x30, 0x85, 0xa5,
      0x82, 0x98, 0x50, 0xaf, 0xe5, 0xd5, 0x50, 0x25, 0xdc, 0x0,  0x10, 0xf,  0x26, 0xd0, 0x88, 0x8e, 0x6c, 0x4a, 0x7c,
      0xa,  0x51, 0xe7, 0x32, 0x2c, 0xa1, 0x1c, 0xb8, 0xb6, 0x1,  0x21, 0x7c, 0x4a, 0x28, 0xe0, 0x13, 0x21, 0x41, 0x25,
      0x85, 0x29, 0xa9, 0x13, 0x3f, 0xe8, 0x12, 0x0,  0x16, 0x37, 0xf3, 0x3c, 0x2f, 0x60, 0x2,  0x64, 0xd0, 0x36, 0x62,
      0xbf, 0x79, 0xec, 0x10, 0x8,  0xe4, 0xe7, 0x1,  0xf1, 0x8a, 0xc,  0x2e, 0x28, 0x4d, 0x2,  0x0,  0x0,  0x58, 0xba,
      0x1a, 0x0,  0xe,  0xce, 0xf3, 0x7f, 0xfe, 0x5c, 0x9b, 0x40, 0xfa, 0xd8, 0xeb, 0x6,  0x94, 0x2b, 0xd3, 0x1f, 0x0,
      0x1e, 0xdf, 0xd7, 0xc4, 0xe8, 0x3b, 0x2c, 0xc3, 0xe9, 0x40, 0xd4, 0xda, 0xe0, 0xeb, 0x3c, 0xf8, 0xc4, 0x71, 0x6d,
      0xb7, 0xc2, 0x30, 0x1c, 0x4,  0x17, 0x5d, 0x61, 0xab, 0xd7, 0xb9, 0x2f, 0x18, 0x0,  0x0,  0x7,  0xb1, 0x11, 0x0,
      0x0,  0x5e, 0x1c, 0x12, 0x0,  0x17, 0x70, 0x3f, 0x92, 0xa,  0xf,  0x24, 0x9c, 0x50, 0x0,  0xa0, 0xd9, 0x32, 0x80,
      0xbd, 0x2d, 0x49, 0x1,  0xa2, 0xbe, 0x90, 0x57, 0x97, 0xd6, 0x3,  0x0,  0x1,  0x3,  0x1c, 0x0,  0x2,  0xc8, 0x71,
      0x26, 0x0,  0xd,  0xf6, 0x47, 0x77, 0x92, 0x3e, 0x83, 0xbb, 0x1d, 0x67, 0x73, 0x84, 0x94, 0xf5, 0x0,  0x16, 0x0,
      0x41, 0x6,  0xcf, 0x62, 0x63, 0xd6, 0xa1, 0xbe, 0xf8, 0x6f, 0xab, 0x4d, 0x95, 0x8e, 0x72, 0x87, 0xcd, 0xf,  0x83,
      0x78, 0x84, 0x0,  0x16, 0x6a, 0x26, 0xd6, 0xf7, 0xce, 0x5a, 0xd4, 0xdb, 0x1e, 0x1f, 0x2d, 0x2c, 0x9b, 0xbe, 0x65,
      0x21, 0x5c, 0x8e, 0x1d, 0xf3, 0x58, 0xf1, 0x0,  0x6,  0x16, 0xb7, 0x9c, 0xcf, 0xd1, 0xd7, 0x0,  0xc,  0x37, 0x7b,
      0xd7, 0xb1, 0x51, 0xfc, 0x21, 0xe9, 0x8d, 0x50, 0xce, 0xf2, 0x0,  0x16, 0x3,  0xc,  0x65, 0x67, 0x6d, 0xec, 0x4b,
      0x9d, 0xf9, 0x8c, 0x13, 0x90, 0xba, 0x2d, 0x39, 0x9c, 0xee, 0xde, 0xa7, 0x8a, 0xca, 0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6b, 0x43, 0x38, 0x81, 0x96, 0x2f, 0xc5, 0xb0, 0xb3, 0xc8, 0x8c, 0x9f, 0xb7, 0xcb, 0x9a,
                           0x0,  0x87, 0x14, 0x5f, 0x77, 0x9d, 0x9e, 0xb,  0xf7, 0xd5, 0x60, 0x55, 0x28, 0xd1, 0xa};
  uint8_t bytesprops1[] = {0x9d};
  uint8_t bytesprops2[] = {0xae, 0xdc, 0xc4, 0xc0, 0x74, 0xe6, 0xc4, 0x79, 0x75, 0xc7, 0xc9, 0xf4, 0x6a,
                           0xda, 0x35, 0xb8, 0x7a, 0x5a, 0x62, 0x54, 0x36, 0x1a, 0x5b, 0xf5, 0xdd, 0x7};
  uint8_t bytesprops3[] = {0xe3, 0xb8, 0x1c, 0xc, 0x30, 0x5b, 0xcb, 0x66, 0xc0, 0x13, 0xb3, 0x3b, 0x5c, 0x4b};
  uint8_t bytesprops4[] = {0x2a, 0xeb, 0x60, 0x96, 0xd2, 0x6, 0x3f};
  uint8_t bytesprops5[] = {0xea, 0xd4, 0x11, 0xe8, 0xde, 0x71, 0xd,  0xea, 0x6b, 0x82, 0xf2, 0x3b, 0xef, 0x56,
                           0x12, 0x44, 0x41, 0x98, 0x54, 0x83, 0xd4, 0x1e, 0xd5, 0xb4, 0xd0, 0xdc, 0x1e};
  uint8_t bytesprops6[] = {0xe2, 0x69, 0x75, 0x70, 0xfc, 0x89, 0xa3, 0xda, 0x87, 0xcb, 0x27};
  uint8_t bytesprops7[] = {0xb, 0x47, 0xd4, 0x61, 0x57, 0xd, 0x32, 0xe6, 0x14, 0xb0, 0x91, 0xed, 0x10, 0x27};
  uint8_t bytesprops8[] = {0xe1, 0xb6, 0xb3, 0x8d, 0xa8, 0x30, 0x85, 0xa5, 0x82, 0x98, 0x50, 0xaf, 0xe5, 0xd5, 0x50};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3478}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23782}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25410}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 705}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31472}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24407}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28666}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24637}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 220}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x37, 0xf3, 0x3c, 0x2f, 0x60, 0x2,  0x64, 0xd0, 0x36, 0x62, 0xbf,
                               0x79, 0xec, 0x10, 0x8,  0xe4, 0xe7, 0x1,  0xf1, 0x8a, 0xc,  0x2e};
  uint8_t byteswillprops1[] = {0xce, 0xf3, 0x7f, 0xfe, 0x5c, 0x9b, 0x40, 0xfa, 0xd8, 0xeb, 0x6, 0x94, 0x2b, 0xd3};
  uint8_t byteswillprops2[] = {0xdf, 0xd7, 0xc4, 0xe8, 0x3b, 0x2c, 0xc3, 0xe9, 0x40, 0xd4,
                               0xda, 0xe0, 0xeb, 0x3c, 0xf8, 0xc4, 0x71, 0x6d, 0xb7, 0xc2,
                               0x30, 0x1c, 0x4,  0x17, 0x5d, 0x61, 0xab, 0xd7, 0xb9, 0x2f};
  uint8_t byteswillprops3[] = {0x70, 0x3f, 0x92, 0xa,  0xf, 0x24, 0x9c, 0x50, 0x0,  0xa0, 0xd9, 0x32,
                               0x80, 0xbd, 0x2d, 0x49, 0x1, 0xa2, 0xbe, 0x90, 0x57, 0x97, 0xd6};
  uint8_t byteswillprops4[] = {0x3};
  uint8_t byteswillprops5[] = {0xc8, 0x71};
  uint8_t byteswillprops7[] = {0x0,  0x41, 0x6,  0xcf, 0x62, 0x63, 0xd6, 0xa1, 0xbe, 0xf8, 0x6f,
                               0xab, 0x4d, 0x95, 0x8e, 0x72, 0x87, 0xcd, 0xf,  0x83, 0x78, 0x84};
  uint8_t byteswillprops6[] = {0xf6, 0x47, 0x77, 0x92, 0x3e, 0x83, 0xbb, 0x1d, 0x67, 0x73, 0x84, 0x94, 0xf5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31818}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8513}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16360}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22714}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1969}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24092}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops6}, .v = {22, (char*)&byteswillprops7}}}},
  };

  lwmqtt_properties_t willprops = {17, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6a, 0x26, 0xd6, 0xf7, 0xce, 0x5a, 0xd4, 0xdb, 0x1e, 0x1f, 0x2d,
                                0x2c, 0x9b, 0xbe, 0x65, 0x21, 0x5c, 0x8e, 0x1d, 0xf3, 0x58, 0xf1};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x16, 0xb7, 0x9c, 0xcf, 0xd1, 0xd7};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26306;
  uint8_t client_id_bytes[] = {0xf, 0x26, 0xd0, 0x88, 0x8e, 0x6c, 0x4a, 0x7c,
                               0xa, 0x51, 0xe7, 0x32, 0x2c, 0xa1, 0x1c, 0xb8};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x37, 0x7b, 0xd7, 0xb1, 0x51, 0xfc, 0x21, 0xe9, 0x8d, 0x50, 0xce, 0xf2};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3,  0xc,  0x65, 0x67, 0x6d, 0xec, 0x4b, 0x9d, 0xf9, 0x8c, 0x13,
                              0x90, 0xba, 0x2d, 0x39, 0x9c, 0xee, 0xde, 0xa7, 0x8a, 0xca, 0x16};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\169\190fw\241\246)\vwT\139\DC3xx\216\189\225\158\213x\238\179\140", _password =
// Just "q\230-\213\ENQ5-T\188\DEL\b\213\155+\SO`m\GS \242\165#\\", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "\217 \214\EM\178\ACK\155", _willMsg =
// "\245)\238j2\DC2\161\134.\140\147HX\198`\252\237D\164\157*", _willProps = [PropAuthenticationMethod
// "\154\133en<\173\aS",PropCorrelationData "/L\159\131\US\180\n\145Yq",PropRequestProblemInformation
// 88,PropRetainAvailable 40,PropTopicAlias 5030,PropSharedSubscriptionAvailable 42,PropMaximumPacketSize
// 18739,PropSubscriptionIdentifierAvailable 50,PropMessageExpiryInterval 19443,PropPayloadFormatIndicator
// 181,PropCorrelationData "\186\CAN\164\193\133\210)$\182p\184\215\ESC",PropTopicAlias 8775,PropCorrelationData
// "W\ETB\137\143\130\NUL,\168\ETB\203\148",PropWildcardSubscriptionAvailable 107,PropWildcardSubscriptionAvailable
// 71,PropMaximumQoS 251]}), _cleanSession = False, _keepAlive = 19404, _connID =
// "#f\162\233\167\DEL?\182\198\174aF\143S\150\160\186\DC2JqI\244\199\152\&3", _properties = [PropSubscriptionIdentifier
// 30,PropWildcardSubscriptionAvailable 54,PropSubscriptionIdentifierAvailable 173,PropServerReference
// "\220>\CAN\188\191\155+C\205D\175\188\162\163\&3\171\DC3\EOT\196\138&",PropReasonString
// "\159\154\255\SO\211\201\179l\130\187i~!q",PropMaximumQoS 56,PropTopicAlias 11834,PropTopicAlias 30167]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x10, 0x86, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc4, 0x4b, 0xcc, 0x37, 0xb,  0x1e, 0x28, 0x36, 0x29,
      0xad, 0x1c, 0x0,  0x15, 0xdc, 0x3e, 0x18, 0xbc, 0xbf, 0x9b, 0x2b, 0x43, 0xcd, 0x44, 0xaf, 0xbc, 0xa2, 0xa3, 0x33,
      0xab, 0x13, 0x4,  0xc4, 0x8a, 0x26, 0x1f, 0x0,  0xe,  0x9f, 0x9a, 0xff, 0xe,  0xd3, 0xc9, 0xb3, 0x6c, 0x82, 0xbb,
      0x69, 0x7e, 0x21, 0x71, 0x24, 0x38, 0x23, 0x2e, 0x3a, 0x23, 0x75, 0xd7, 0x0,  0x19, 0x23, 0x66, 0xa2, 0xe9, 0xa7,
      0x7f, 0x3f, 0xb6, 0xc6, 0xae, 0x61, 0x46, 0x8f, 0x53, 0x96, 0xa0, 0xba, 0x12, 0x4a, 0x71, 0x49, 0xf4, 0xc7, 0x98,
      0x33, 0x56, 0x15, 0x0,  0x8,  0x9a, 0x85, 0x65, 0x6e, 0x3c, 0xad, 0x7,  0x53, 0x9,  0x0,  0xa,  0x2f, 0x4c, 0x9f,
      0x83, 0x1f, 0xb4, 0xa,  0x91, 0x59, 0x71, 0x17, 0x58, 0x25, 0x28, 0x23, 0x13, 0xa6, 0x2a, 0x2a, 0x27, 0x0,  0x0,
      0x49, 0x33, 0x29, 0x32, 0x2,  0x0,  0x0,  0x4b, 0xf3, 0x1,  0xb5, 0x9,  0x0,  0xd,  0xba, 0x18, 0xa4, 0xc1, 0x85,
      0xd2, 0x29, 0x24, 0xb6, 0x70, 0xb8, 0xd7, 0x1b, 0x23, 0x22, 0x47, 0x9,  0x0,  0xb,  0x57, 0x17, 0x89, 0x8f, 0x82,
      0x0,  0x2c, 0xa8, 0x17, 0xcb, 0x94, 0x28, 0x6b, 0x28, 0x47, 0x24, 0xfb, 0x0,  0x7,  0xd9, 0x20, 0xd6, 0x19, 0xb2,
      0x6,  0x9b, 0x0,  0x15, 0xf5, 0x29, 0xee, 0x6a, 0x32, 0x12, 0xa1, 0x86, 0x2e, 0x8c, 0x93, 0x48, 0x58, 0xc6, 0x60,
      0xfc, 0xed, 0x44, 0xa4, 0x9d, 0x2a, 0x0,  0x17, 0xa9, 0xbe, 0x66, 0x77, 0xf1, 0xf6, 0x29, 0xb,  0x77, 0x54, 0x8b,
      0x13, 0x78, 0x78, 0xd8, 0xbd, 0xe1, 0x9e, 0xd5, 0x78, 0xee, 0xb3, 0x8c, 0x0,  0x17, 0x71, 0xe6, 0x2d, 0xd5, 0x5,
      0x35, 0x2d, 0x54, 0xbc, 0x7f, 0x8,  0xd5, 0x9b, 0x2b, 0xe,  0x60, 0x6d, 0x1d, 0x20, 0xf2, 0xa5, 0x23, 0x5c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xdc, 0x3e, 0x18, 0xbc, 0xbf, 0x9b, 0x2b, 0x43, 0xcd, 0x44, 0xaf,
                           0xbc, 0xa2, 0xa3, 0x33, 0xab, 0x13, 0x4,  0xc4, 0x8a, 0x26};
  uint8_t bytesprops1[] = {0x9f, 0x9a, 0xff, 0xe, 0xd3, 0xc9, 0xb3, 0x6c, 0x82, 0xbb, 0x69, 0x7e, 0x21, 0x71};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11834}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30167}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9a, 0x85, 0x65, 0x6e, 0x3c, 0xad, 0x7, 0x53};
  uint8_t byteswillprops1[] = {0x2f, 0x4c, 0x9f, 0x83, 0x1f, 0xb4, 0xa, 0x91, 0x59, 0x71};
  uint8_t byteswillprops2[] = {0xba, 0x18, 0xa4, 0xc1, 0x85, 0xd2, 0x29, 0x24, 0xb6, 0x70, 0xb8, 0xd7, 0x1b};
  uint8_t byteswillprops3[] = {0x57, 0x17, 0x89, 0x8f, 0x82, 0x0, 0x2c, 0xa8, 0x17, 0xcb, 0x94};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5030}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18739}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19443}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8775}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 251}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9, 0x20, 0xd6, 0x19, 0xb2, 0x6, 0x9b};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf5, 0x29, 0xee, 0x6a, 0x32, 0x12, 0xa1, 0x86, 0x2e, 0x8c, 0x93,
                                  0x48, 0x58, 0xc6, 0x60, 0xfc, 0xed, 0x44, 0xa4, 0x9d, 0x2a};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19404;
  uint8_t client_id_bytes[] = {0x23, 0x66, 0xa2, 0xe9, 0xa7, 0x7f, 0x3f, 0xb6, 0xc6, 0xae, 0x61, 0x46, 0x8f,
                               0x53, 0x96, 0xa0, 0xba, 0x12, 0x4a, 0x71, 0x49, 0xf4, 0xc7, 0x98, 0x33};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa9, 0xbe, 0x66, 0x77, 0xf1, 0xf6, 0x29, 0xb,  0x77, 0x54, 0x8b, 0x13,
                              0x78, 0x78, 0xd8, 0xbd, 0xe1, 0x9e, 0xd5, 0x78, 0xee, 0xb3, 0x8c};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x71, 0xe6, 0x2d, 0xd5, 0x5,  0x35, 0x2d, 0x54, 0xbc, 0x7f, 0x8, 0xd5,
                              0x9b, 0x2b, 0xe,  0x60, 0x6d, 0x1d, 0x20, 0xf2, 0xa5, 0x23, 0x5c};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SIu}\231\235\&7\157S\163\235u\157\206\215Gn\180\152\STX\142\225\150\&0\244B0",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\173\184D\250<\252,\186c\146\178T!\ETXkKR\SO\139\253\&6", _willMsg = "h\144\228&\249\240u\248L", _willProps =
// [PropMessageExpiryInterval 22862,PropWillDelayInterval 19734,PropAuthenticationData
// "\EM\130\170\b\133\219\DC3+\245\ETX\146\158\241\129\&8\251\236\229\&4\229\STXo\143\204\SIe\232D\146",PropRequestProblemInformation
// 66,PropMessageExpiryInterval 15740,PropAuthenticationData "21",PropWildcardSubscriptionAvailable 134,PropContentType
// "\230\ENQ\SUB\FS\213\137r\a@\251EYX\218\ETX>q\DC4R/W>\250",PropMessageExpiryInterval 11158,PropAuthenticationData
// "g",PropResponseTopic "\144nN\DC2u\207\STX\199Dp\NUL\167{",PropMessageExpiryInterval 12811]}), _cleanSession = True,
// _keepAlive = 14654, _connID = "b!\199C\NAK8m\183\ETB\162\161\131\255\f\236\203\165\189\153\b\v\b\ACK", _properties =
// [PropCorrelationData "\DC2\207K\144\b\232\205v\229\\\176\218",PropWillDelayInterval 392,PropSessionExpiryInterval
// 27867,PropWillDelayInterval 21051,PropPayloadFormatIndicator 146,PropAuthenticationData ""]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0xf6, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xa6, 0x39, 0x3e, 0x23, 0x9,  0x0,  0xc,
                   0x12, 0xcf, 0x4b, 0x90, 0x8,  0xe8, 0xcd, 0x76, 0xe5, 0x5c, 0xb0, 0xda, 0x18, 0x0,  0x0,  0x1,  0x88,
                   0x11, 0x0,  0x0,  0x6c, 0xdb, 0x18, 0x0,  0x0,  0x52, 0x3b, 0x1,  0x92, 0x16, 0x0,  0x0,  0x0,  0x17,
                   0x62, 0x21, 0xc7, 0x43, 0x15, 0x38, 0x6d, 0xb7, 0x17, 0xa2, 0xa1, 0x83, 0xff, 0xc,  0xec, 0xcb, 0xa5,
                   0xbd, 0x99, 0x8,  0xb,  0x8,  0x6,  0x70, 0x2,  0x0,  0x0,  0x59, 0x4e, 0x18, 0x0,  0x0,  0x4d, 0x16,
                   0x16, 0x0,  0x1d, 0x19, 0x82, 0xaa, 0x8,  0x85, 0xdb, 0x13, 0x2b, 0xf5, 0x3,  0x92, 0x9e, 0xf1, 0x81,
                   0x38, 0xfb, 0xec, 0xe5, 0x34, 0xe5, 0x2,  0x6f, 0x8f, 0xcc, 0xf,  0x65, 0xe8, 0x44, 0x92, 0x17, 0x42,
                   0x2,  0x0,  0x0,  0x3d, 0x7c, 0x16, 0x0,  0x2,  0x32, 0x31, 0x28, 0x86, 0x3,  0x0,  0x17, 0xe6, 0x5,
                   0x1a, 0x1c, 0xd5, 0x89, 0x72, 0x7,  0x40, 0xfb, 0x45, 0x59, 0x58, 0xda, 0x3,  0x3e, 0x71, 0x14, 0x52,
                   0x2f, 0x57, 0x3e, 0xfa, 0x2,  0x0,  0x0,  0x2b, 0x96, 0x16, 0x0,  0x1,  0x67, 0x8,  0x0,  0xd,  0x90,
                   0x6e, 0x4e, 0x12, 0x75, 0xcf, 0x2,  0xc7, 0x44, 0x70, 0x0,  0xa7, 0x7b, 0x2,  0x0,  0x0,  0x32, 0xb,
                   0x0,  0x15, 0xad, 0xb8, 0x44, 0xfa, 0x3c, 0xfc, 0x2c, 0xba, 0x63, 0x92, 0xb2, 0x54, 0x21, 0x3,  0x6b,
                   0x4b, 0x52, 0xe,  0x8b, 0xfd, 0x36, 0x0,  0x9,  0x68, 0x90, 0xe4, 0x26, 0xf9, 0xf0, 0x75, 0xf8, 0x4c,
                   0x0,  0x1a, 0xf,  0x75, 0x7d, 0xe7, 0xeb, 0x37, 0x9d, 0x53, 0xa3, 0xeb, 0x75, 0x9d, 0xce, 0xd7, 0x47,
                   0x6e, 0xb4, 0x98, 0x2,  0x8e, 0xe1, 0x96, 0x30, 0xf4, 0x42, 0x30};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x12, 0xcf, 0x4b, 0x90, 0x8, 0xe8, 0xcd, 0x76, 0xe5, 0x5c, 0xb0, 0xda};
  uint8_t bytesprops1[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 392}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27867}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21051}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x19, 0x82, 0xaa, 0x8,  0x85, 0xdb, 0x13, 0x2b, 0xf5, 0x3, 0x92, 0x9e, 0xf1, 0x81, 0x38,
                               0xfb, 0xec, 0xe5, 0x34, 0xe5, 0x2,  0x6f, 0x8f, 0xcc, 0xf, 0x65, 0xe8, 0x44, 0x92};
  uint8_t byteswillprops1[] = {0x32, 0x31};
  uint8_t byteswillprops2[] = {0xe6, 0x5,  0x1a, 0x1c, 0xd5, 0x89, 0x72, 0x7,  0x40, 0xfb, 0x45, 0x59,
                               0x58, 0xda, 0x3,  0x3e, 0x71, 0x14, 0x52, 0x2f, 0x57, 0x3e, 0xfa};
  uint8_t byteswillprops3[] = {0x67};
  uint8_t byteswillprops4[] = {0x90, 0x6e, 0x4e, 0x12, 0x75, 0xcf, 0x2, 0xc7, 0x44, 0x70, 0x0, 0xa7, 0x7b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22862}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19734}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15740}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11158}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12811}},
  };

  lwmqtt_properties_t willprops = {12, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xad, 0xb8, 0x44, 0xfa, 0x3c, 0xfc, 0x2c, 0xba, 0x63, 0x92, 0xb2,
                                0x54, 0x21, 0x3,  0x6b, 0x4b, 0x52, 0xe,  0x8b, 0xfd, 0x36};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x68, 0x90, 0xe4, 0x26, 0xf9, 0xf0, 0x75, 0xf8, 0x4c};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14654;
  uint8_t client_id_bytes[] = {0x62, 0x21, 0xc7, 0x43, 0x15, 0x38, 0x6d, 0xb7, 0x17, 0xa2, 0xa1, 0x83,
                               0xff, 0xc,  0xec, 0xcb, 0xa5, 0xbd, 0x99, 0x8,  0xb,  0x8,  0x6};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf,  0x75, 0x7d, 0xe7, 0xeb, 0x37, 0x9d, 0x53, 0xa3, 0xeb, 0x75, 0x9d, 0xce,
                              0xd7, 0x47, 0x6e, 0xb4, 0x98, 0x2,  0x8e, 0xe1, 0x96, 0x30, 0xf4, 0x42, 0x30};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "E\233Y!;0\183X\172\237\237\252\&9\t,\DC2\221d^", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\131\ETX\211$\DC4\162\130\183\SUB\187Y\238\196\ETB6", _willMsg = "\242\214\200\\7w\209dKcE\a\130\206\ACKsj\171\t",
// _willProps = [PropReceiveMaximum 18066,PropUserProperty "Y\207\NULV"
// "\ENQ\142]L0b\201\171\252\DC4\\\144|\163\203G\SUBx\214\232\243A\194\213\t]\ACK",PropResponseInformation
// "\207#\156\253i\DLE8\177\250t\234@^\v8J",PropSubscriptionIdentifier 25,PropRequestProblemInformation
// 203,PropSharedSubscriptionAvailable 144,PropRequestResponseInformation 72,PropMaximumQoS 4,PropUserProperty ""
// "\NAK\208\r.\240[\222\CAN\130\234\228\147",PropWildcardSubscriptionAvailable 148,PropWillDelayInterval
// 10395,PropResponseInformation "\SUBE\191V\USE^\222|\217\204'_\204",PropUserProperty
// ";+\t!\232|\186I\138\193u\v~\202\183\228\172s_\174"
// "\254y3\252\STX\152\v_K>\194\192\ENQ\DC1\147^?N(\146~Lo?\159\155",PropUserProperty ""
// "0\194\201X\235\140\248\&1Q\231\205-\180\150\RSDihoD\211\&9\134",PropCorrelationData
// "\236T",PropPayloadFormatIndicator 49,PropRequestResponseInformation 252,PropServerKeepAlive
// 18380,PropWildcardSubscriptionAvailable 130,PropSharedSubscriptionAvailable 94,PropUserProperty
// "=\192x\217w^\130RI!\DEL>Y>C\198\233D\220`\\,!\196\ESC" "v'\179\180\190\161,}I\226\201*\225",PropWillDelayInterval
// 12704,PropPayloadFormatIndicator 191,PropRetainAvailable 29,PropAssignedClientIdentifier
// "\252\"0\167U\250#|",PropPayloadFormatIndicator 132,PropRetainAvailable 176,PropPayloadFormatIndicator
// 247,PropUserProperty ",\156\241\149" "^,\133\158\130$&\SUB\192\236\ENQ0\231\158"]}), _cleanSession = True, _keepAlive
// = 9686, _connID = "\242\&1\174", _properties = [PropAuthenticationMethod
// "u\156Z\244$",PropSharedSubscriptionAvailable 158,PropMessageExpiryInterval 5802,PropUserProperty
// "\207\161\140T\DC4\144N6u$\166\140\214\183\&0;\199\149"
// "\231\222\233\157c\176p\179\128\220#-iA\211\219\SI",PropAuthenticationData
// "[\ACK\211\232\214\FS\140\EOT\DC2\EMp\232",PropMessageExpiryInterval 9094,PropReasonString
// "\139\DC2\"\172\rq\172,^;X\143\167i\226\231\220\ACK\\",PropRetainAvailable 107,PropRequestProblemInformation
// 232,PropMaximumPacketSize 21936,PropServerReference "\141\SO\199\ACK\217\200\235\180"]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0xea, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x66, 0x25, 0xd6, 0x75, 0x15, 0x0,  0x5,  0x75, 0x9c,
      0x5a, 0xf4, 0x24, 0x2a, 0x9e, 0x2,  0x0,  0x0,  0x16, 0xaa, 0x26, 0x0,  0x12, 0xcf, 0xa1, 0x8c, 0x54, 0x14, 0x90,
      0x4e, 0x36, 0x75, 0x24, 0xa6, 0x8c, 0xd6, 0xb7, 0x30, 0x3b, 0xc7, 0x95, 0x0,  0x11, 0xe7, 0xde, 0xe9, 0x9d, 0x63,
      0xb0, 0x70, 0xb3, 0x80, 0xdc, 0x23, 0x2d, 0x69, 0x41, 0xd3, 0xdb, 0xf,  0x16, 0x0,  0xc,  0x5b, 0x6,  0xd3, 0xe8,
      0xd6, 0x1c, 0x8c, 0x4,  0x12, 0x19, 0x70, 0xe8, 0x2,  0x0,  0x0,  0x23, 0x86, 0x1f, 0x0,  0x13, 0x8b, 0x12, 0x22,
      0xac, 0xd,  0x71, 0xac, 0x2c, 0x5e, 0x3b, 0x58, 0x8f, 0xa7, 0x69, 0xe2, 0xe7, 0xdc, 0x6,  0x5c, 0x25, 0x6b, 0x17,
      0xe8, 0x27, 0x0,  0x0,  0x55, 0xb0, 0x1c, 0x0,  0x8,  0x8d, 0xe,  0xc7, 0x6,  0xd9, 0xc8, 0xeb, 0xb4, 0x0,  0x3,
      0xf2, 0x31, 0xae, 0xa8, 0x2,  0x21, 0x46, 0x92, 0x26, 0x0,  0x4,  0x59, 0xcf, 0x0,  0x56, 0x0,  0x1b, 0x5,  0x8e,
      0x5d, 0x4c, 0x30, 0x62, 0xc9, 0xab, 0xfc, 0x14, 0x5c, 0x90, 0x7c, 0xa3, 0xcb, 0x47, 0x1a, 0x78, 0xd6, 0xe8, 0xf3,
      0x41, 0xc2, 0xd5, 0x9,  0x5d, 0x6,  0x1a, 0x0,  0x10, 0xcf, 0x23, 0x9c, 0xfd, 0x69, 0x10, 0x38, 0xb1, 0xfa, 0x74,
      0xea, 0x40, 0x5e, 0xb,  0x38, 0x4a, 0xb,  0x19, 0x17, 0xcb, 0x2a, 0x90, 0x19, 0x48, 0x24, 0x4,  0x26, 0x0,  0x0,
      0x0,  0xc,  0x15, 0xd0, 0xd,  0x2e, 0xf0, 0x5b, 0xde, 0x18, 0x82, 0xea, 0xe4, 0x93, 0x28, 0x94, 0x18, 0x0,  0x0,
      0x28, 0x9b, 0x1a, 0x0,  0xe,  0x1a, 0x45, 0xbf, 0x56, 0x1f, 0x45, 0x5e, 0xde, 0x7c, 0xd9, 0xcc, 0x27, 0x5f, 0xcc,
      0x26, 0x0,  0x14, 0x3b, 0x2b, 0x9,  0x21, 0xe8, 0x7c, 0xba, 0x49, 0x8a, 0xc1, 0x75, 0xb,  0x7e, 0xca, 0xb7, 0xe4,
      0xac, 0x73, 0x5f, 0xae, 0x0,  0x1a, 0xfe, 0x79, 0x33, 0xfc, 0x2,  0x98, 0xb,  0x5f, 0x4b, 0x3e, 0xc2, 0xc0, 0x5,
      0x11, 0x93, 0x5e, 0x3f, 0x4e, 0x28, 0x92, 0x7e, 0x4c, 0x6f, 0x3f, 0x9f, 0x9b, 0x26, 0x0,  0x0,  0x0,  0x17, 0x30,
      0xc2, 0xc9, 0x58, 0xeb, 0x8c, 0xf8, 0x31, 0x51, 0xe7, 0xcd, 0x2d, 0xb4, 0x96, 0x1e, 0x44, 0x69, 0x68, 0x6f, 0x44,
      0xd3, 0x39, 0x86, 0x9,  0x0,  0x2,  0xec, 0x54, 0x1,  0x31, 0x19, 0xfc, 0x13, 0x47, 0xcc, 0x28, 0x82, 0x2a, 0x5e,
      0x26, 0x0,  0x19, 0x3d, 0xc0, 0x78, 0xd9, 0x77, 0x5e, 0x82, 0x52, 0x49, 0x21, 0x7f, 0x3e, 0x59, 0x3e, 0x43, 0xc6,
      0xe9, 0x44, 0xdc, 0x60, 0x5c, 0x2c, 0x21, 0xc4, 0x1b, 0x0,  0xd,  0x76, 0x27, 0xb3, 0xb4, 0xbe, 0xa1, 0x2c, 0x7d,
      0x49, 0xe2, 0xc9, 0x2a, 0xe1, 0x18, 0x0,  0x0,  0x31, 0xa0, 0x1,  0xbf, 0x25, 0x1d, 0x12, 0x0,  0x8,  0xfc, 0x22,
      0x30, 0xa7, 0x55, 0xfa, 0x23, 0x7c, 0x1,  0x84, 0x25, 0xb0, 0x1,  0xf7, 0x26, 0x0,  0x4,  0x2c, 0x9c, 0xf1, 0x95,
      0x0,  0xe,  0x5e, 0x2c, 0x85, 0x9e, 0x82, 0x24, 0x26, 0x1a, 0xc0, 0xec, 0x5,  0x30, 0xe7, 0x9e, 0x0,  0xf,  0x83,
      0x3,  0xd3, 0x24, 0x14, 0xa2, 0x82, 0xb7, 0x1a, 0xbb, 0x59, 0xee, 0xc4, 0x17, 0x36, 0x0,  0x13, 0xf2, 0xd6, 0xc8,
      0x5c, 0x37, 0x77, 0xd1, 0x64, 0x4b, 0x63, 0x45, 0x7,  0x82, 0xce, 0x6,  0x73, 0x6a, 0xab, 0x9,  0x0,  0x13, 0x45,
      0xe9, 0x59, 0x21, 0x3b, 0x30, 0xb7, 0x58, 0xac, 0xed, 0xed, 0xfc, 0x39, 0x9,  0x2c, 0x12, 0xdd, 0x64, 0x5e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x75, 0x9c, 0x5a, 0xf4, 0x24};
  uint8_t bytesprops2[] = {0xe7, 0xde, 0xe9, 0x9d, 0x63, 0xb0, 0x70, 0xb3, 0x80,
                           0xdc, 0x23, 0x2d, 0x69, 0x41, 0xd3, 0xdb, 0xf};
  uint8_t bytesprops1[] = {0xcf, 0xa1, 0x8c, 0x54, 0x14, 0x90, 0x4e, 0x36, 0x75,
                           0x24, 0xa6, 0x8c, 0xd6, 0xb7, 0x30, 0x3b, 0xc7, 0x95};
  uint8_t bytesprops3[] = {0x5b, 0x6, 0xd3, 0xe8, 0xd6, 0x1c, 0x8c, 0x4, 0x12, 0x19, 0x70, 0xe8};
  uint8_t bytesprops4[] = {0x8b, 0x12, 0x22, 0xac, 0xd,  0x71, 0xac, 0x2c, 0x5e, 0x3b,
                           0x58, 0x8f, 0xa7, 0x69, 0xe2, 0xe7, 0xdc, 0x6,  0x5c};
  uint8_t bytesprops5[] = {0x8d, 0xe, 0xc7, 0x6, 0xd9, 0xc8, 0xeb, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5802}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops1}, .v = {17, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9094}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21936}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x5,  0x8e, 0x5d, 0x4c, 0x30, 0x62, 0xc9, 0xab, 0xfc, 0x14, 0x5c, 0x90, 0x7c, 0xa3,
                               0xcb, 0x47, 0x1a, 0x78, 0xd6, 0xe8, 0xf3, 0x41, 0xc2, 0xd5, 0x9,  0x5d, 0x6};
  uint8_t byteswillprops0[] = {0x59, 0xcf, 0x0, 0x56};
  uint8_t byteswillprops2[] = {0xcf, 0x23, 0x9c, 0xfd, 0x69, 0x10, 0x38, 0xb1,
                               0xfa, 0x74, 0xea, 0x40, 0x5e, 0xb,  0x38, 0x4a};
  uint8_t byteswillprops4[] = {0x15, 0xd0, 0xd, 0x2e, 0xf0, 0x5b, 0xde, 0x18, 0x82, 0xea, 0xe4, 0x93};
  uint8_t byteswillprops3[] = {0};
  uint8_t byteswillprops5[] = {0x1a, 0x45, 0xbf, 0x56, 0x1f, 0x45, 0x5e, 0xde, 0x7c, 0xd9, 0xcc, 0x27, 0x5f, 0xcc};
  uint8_t byteswillprops7[] = {0xfe, 0x79, 0x33, 0xfc, 0x2,  0x98, 0xb,  0x5f, 0x4b, 0x3e, 0xc2, 0xc0, 0x5,
                               0x11, 0x93, 0x5e, 0x3f, 0x4e, 0x28, 0x92, 0x7e, 0x4c, 0x6f, 0x3f, 0x9f, 0x9b};
  uint8_t byteswillprops6[] = {0x3b, 0x2b, 0x9,  0x21, 0xe8, 0x7c, 0xba, 0x49, 0x8a, 0xc1,
                               0x75, 0xb,  0x7e, 0xca, 0xb7, 0xe4, 0xac, 0x73, 0x5f, 0xae};
  uint8_t byteswillprops9[] = {0x30, 0xc2, 0xc9, 0x58, 0xeb, 0x8c, 0xf8, 0x31, 0x51, 0xe7, 0xcd, 0x2d,
                               0xb4, 0x96, 0x1e, 0x44, 0x69, 0x68, 0x6f, 0x44, 0xd3, 0x39, 0x86};
  uint8_t byteswillprops8[] = {0};
  uint8_t byteswillprops10[] = {0xec, 0x54};
  uint8_t byteswillprops12[] = {0x76, 0x27, 0xb3, 0xb4, 0xbe, 0xa1, 0x2c, 0x7d, 0x49, 0xe2, 0xc9, 0x2a, 0xe1};
  uint8_t byteswillprops11[] = {0x3d, 0xc0, 0x78, 0xd9, 0x77, 0x5e, 0x82, 0x52, 0x49, 0x21, 0x7f, 0x3e, 0x59,
                                0x3e, 0x43, 0xc6, 0xe9, 0x44, 0xdc, 0x60, 0x5c, 0x2c, 0x21, 0xc4, 0x1b};
  uint8_t byteswillprops13[] = {0xfc, 0x22, 0x30, 0xa7, 0x55, 0xfa, 0x23, 0x7c};
  uint8_t byteswillprops15[] = {0x5e, 0x2c, 0x85, 0x9e, 0x82, 0x24, 0x26, 0x1a, 0xc0, 0xec, 0x5, 0x30, 0xe7, 0x9e};
  uint8_t byteswillprops14[] = {0x2c, 0x9c, 0xf1, 0x95};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18066}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops0}, .v = {27, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops3}, .v = {12, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10395}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {20, (char*)&byteswillprops6}, .v = {26, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops8}, .v = {23, (char*)&byteswillprops9}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18380}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {25, (char*)&byteswillprops11}, .v = {13, (char*)&byteswillprops12}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12704}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops14}, .v = {14, (char*)&byteswillprops15}}}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x83, 0x3,  0xd3, 0x24, 0x14, 0xa2, 0x82, 0xb7,
                                0x1a, 0xbb, 0x59, 0xee, 0xc4, 0x17, 0x36};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf2, 0xd6, 0xc8, 0x5c, 0x37, 0x77, 0xd1, 0x64, 0x4b, 0x63,
                                  0x45, 0x7,  0x82, 0xce, 0x6,  0x73, 0x6a, 0xab, 0x9};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 9686;
  uint8_t client_id_bytes[] = {0xf2, 0x31, 0xae};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x45, 0xe9, 0x59, 0x21, 0x3b, 0x30, 0xb7, 0x58, 0xac, 0xed,
                              0xed, 0xfc, 0x39, 0x9,  0x2c, 0x12, 0xdd, 0x64, 0x5e};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\133\RS\ACKX^\249Y\190\f(u\241", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "-\244b\239\\\168\251\255\247\DC2\234\150\&8\242", _willMsg =
// "\GS\ACK\135\190\RS\238", _willProps = [PropRequestProblemInformation 243,PropSubscriptionIdentifier
// 24,PropTopicAliasMaximum 6842,PropMaximumQoS 95,PropMessageExpiryInterval 14927,PropSubscriptionIdentifierAvailable
// 207,PropPayloadFormatIndicator 188,PropTopicAlias 11781,PropContentType "U",PropMaximumPacketSize
// 5789,PropSessionExpiryInterval 9783,PropWillDelayInterval 17824,PropMessageExpiryInterval
// 26925,PropSubscriptionIdentifierAvailable 181,PropRequestProblemInformation 37,PropResponseTopic
// "\f\157\146Ws\NAK,\252\224\145\144\225<\139\187:\180",PropSharedSubscriptionAvailable 145,PropWillDelayInterval
// 2760,PropTopicAlias 11910,PropSharedSubscriptionAvailable 103,PropReceiveMaximum 13404,PropRequestProblemInformation
// 3,PropWildcardSubscriptionAvailable 148,PropRequestProblemInformation 158,PropWillDelayInterval 18830]}),
// _cleanSession = True, _keepAlive = 7105, _connID = "xW\GSn\170\158vUz\227\172\SI\145Z2\174\&2\235G\137\154\141F\204",
// _properties = [PropWildcardSubscriptionAvailable 213,PropTopicAliasMaximum 9089,PropTopicAlias 10175]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0xb3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x96, 0x1b, 0xc1, 0x8,  0x28, 0xd5, 0x22,
                   0x23, 0x81, 0x23, 0x27, 0xbf, 0x0,  0x18, 0x78, 0x57, 0x1d, 0x6e, 0xaa, 0x9e, 0x76, 0x55, 0x7a, 0xe3,
                   0xac, 0xf,  0x91, 0x5a, 0x32, 0xae, 0x32, 0xeb, 0x47, 0x89, 0x9a, 0x8d, 0x46, 0xcc, 0x5f, 0x17, 0xf3,
                   0xb,  0x18, 0x22, 0x1a, 0xba, 0x24, 0x5f, 0x2,  0x0,  0x0,  0x3a, 0x4f, 0x29, 0xcf, 0x1,  0xbc, 0x23,
                   0x2e, 0x5,  0x3,  0x0,  0x1,  0x55, 0x27, 0x0,  0x0,  0x16, 0x9d, 0x11, 0x0,  0x0,  0x26, 0x37, 0x18,
                   0x0,  0x0,  0x45, 0xa0, 0x2,  0x0,  0x0,  0x69, 0x2d, 0x29, 0xb5, 0x17, 0x25, 0x8,  0x0,  0x11, 0xc,
                   0x9d, 0x92, 0x57, 0x73, 0x15, 0x2c, 0xfc, 0xe0, 0x91, 0x90, 0xe1, 0x3c, 0x8b, 0xbb, 0x3a, 0xb4, 0x2a,
                   0x91, 0x18, 0x0,  0x0,  0xa,  0xc8, 0x23, 0x2e, 0x86, 0x2a, 0x67, 0x21, 0x34, 0x5c, 0x17, 0x3,  0x28,
                   0x94, 0x17, 0x9e, 0x18, 0x0,  0x0,  0x49, 0x8e, 0x0,  0xe,  0x2d, 0xf4, 0x62, 0xef, 0x5c, 0xa8, 0xfb,
                   0xff, 0xf7, 0x12, 0xea, 0x96, 0x38, 0xf2, 0x0,  0x6,  0x1d, 0x6,  0x87, 0xbe, 0x1e, 0xee, 0x0,  0xc,
                   0x85, 0x1e, 0x6,  0x58, 0x5e, 0xf9, 0x59, 0xbe, 0xc,  0x28, 0x75, 0xf1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9089}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10175}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x55};
  uint8_t byteswillprops1[] = {0xc,  0x9d, 0x92, 0x57, 0x73, 0x15, 0x2c, 0xfc, 0xe0,
                               0x91, 0x90, 0xe1, 0x3c, 0x8b, 0xbb, 0x3a, 0xb4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6842}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14927}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11781}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5789}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9783}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17824}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26925}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2760}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11910}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13404}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18830}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2d, 0xf4, 0x62, 0xef, 0x5c, 0xa8, 0xfb, 0xff, 0xf7, 0x12, 0xea, 0x96, 0x38, 0xf2};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1d, 0x6, 0x87, 0xbe, 0x1e, 0xee};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7105;
  uint8_t client_id_bytes[] = {0x78, 0x57, 0x1d, 0x6e, 0xaa, 0x9e, 0x76, 0x55, 0x7a, 0xe3, 0xac, 0xf,
                               0x91, 0x5a, 0x32, 0xae, 0x32, 0xeb, 0x47, 0x89, 0x9a, 0x8d, 0x46, 0xcc};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x85, 0x1e, 0x6, 0x58, 0x5e, 0xf9, 0x59, 0xbe, 0xc, 0x28, 0x75, 0xf1};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\178\221\248C\139\&8F", _password = Just
// "_\CAN\208w\239\n\FS*\168*U\US\DC1\146\ETX\150\DC2\SO\244E", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 27717, _connID = "", _properties = [PropAssignedClientIdentifier "\229\135\178\RS\201\&7\US\180",PropServerKeepAlive
// 4190,PropRetainAvailable 231,PropWillDelayInterval 31630,PropMaximumPacketSize 25439,PropServerReference
// "\234L\205\DEL~ed\225\\\134\&55M1\187\238\DEL",PropWildcardSubscriptionAvailable 82,PropWildcardSubscriptionAvailable
// 20,PropServerReference
// "\252\ETX\EOTpM>\228\147\142.\200\180\240]\229\160\ETX\171\215B\199\214\&4\ETB",PropAssignedClientIdentifier "Re
// \SO?R",PropSessionExpiryInterval 14304,PropMessageExpiryInterval 23156,PropReasonString "D\"V"]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x92, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x6c, 0x45, 0x66, 0x12, 0x0,  0x8,
                   0xe5, 0x87, 0xb2, 0x1e, 0xc9, 0x37, 0x1f, 0xb4, 0x13, 0x10, 0x5e, 0x25, 0xe7, 0x18, 0x0,  0x0,  0x7b,
                   0x8e, 0x27, 0x0,  0x0,  0x63, 0x5f, 0x1c, 0x0,  0x11, 0xea, 0x4c, 0xcd, 0x7f, 0x7e, 0x65, 0x64, 0xe1,
                   0x5c, 0x86, 0x35, 0x35, 0x4d, 0x31, 0xbb, 0xee, 0x7f, 0x28, 0x52, 0x28, 0x14, 0x1c, 0x0,  0x18, 0xfc,
                   0x3,  0x4,  0x70, 0x4d, 0x3e, 0xe4, 0x93, 0x8e, 0x2e, 0xc8, 0xb4, 0xf0, 0x5d, 0xe5, 0xa0, 0x3,  0xab,
                   0xd7, 0x42, 0xc7, 0xd6, 0x34, 0x17, 0x12, 0x0,  0x6,  0x52, 0x65, 0x20, 0xe,  0x3f, 0x52, 0x11, 0x0,
                   0x0,  0x37, 0xe0, 0x2,  0x0,  0x0,  0x5a, 0x74, 0x1f, 0x0,  0x3,  0x44, 0x22, 0x56, 0x0,  0x0,  0x0,
                   0x7,  0xb2, 0xdd, 0xf8, 0x43, 0x8b, 0x38, 0x46, 0x0,  0x14, 0x5f, 0x18, 0xd0, 0x77, 0xef, 0xa,  0x1c,
                   0x2a, 0xa8, 0x2a, 0x55, 0x1f, 0x11, 0x92, 0x3,  0x96, 0x12, 0xe,  0xf4, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe5, 0x87, 0xb2, 0x1e, 0xc9, 0x37, 0x1f, 0xb4};
  uint8_t bytesprops1[] = {0xea, 0x4c, 0xcd, 0x7f, 0x7e, 0x65, 0x64, 0xe1, 0x5c,
                           0x86, 0x35, 0x35, 0x4d, 0x31, 0xbb, 0xee, 0x7f};
  uint8_t bytesprops2[] = {0xfc, 0x3,  0x4,  0x70, 0x4d, 0x3e, 0xe4, 0x93, 0x8e, 0x2e, 0xc8, 0xb4,
                           0xf0, 0x5d, 0xe5, 0xa0, 0x3,  0xab, 0xd7, 0x42, 0xc7, 0xd6, 0x34, 0x17};
  uint8_t bytesprops3[] = {0x52, 0x65, 0x20, 0xe, 0x3f, 0x52};
  uint8_t bytesprops4[] = {0x44, 0x22, 0x56};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4190}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31630}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25439}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14304}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23156}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27717;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb2, 0xdd, 0xf8, 0x43, 0x8b, 0x38, 0x46};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5f, 0x18, 0xd0, 0x77, 0xef, 0xa,  0x1c, 0x2a, 0xa8, 0x2a,
                              0x55, 0x1f, 0x11, 0x92, 0x3,  0x96, 0x12, 0xe,  0xf4, 0x45};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J\158\167\177\&3=j\176\214\201\193\&6w\169}", _password = Just
// "aA\246Ml\170b\195\217\197\232\210\143/A\222\200\147", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 16521, _connID = "\186\RS\SYN\164\190\223\&0\237:(\242m\129\163\SIz\146x~R\202Dc\184\223\169\230\163", _properties =
// [PropServerReference "\149lz\STX3{]\194\249\&1\172\212E",PropAuthenticationData
// "L\233\DC4J\185\158\173Gc\237\184\206\140y\177\129\247\183bt\237~\236\207Z\236",PropCorrelationData
// "\151\191\170`<Jh\200\ETX\177\t\DEL\244\157\217\DC3\EOT\204\134Z\169( \\\STX\200g\ACK\233(",PropMessageExpiryInterval
// 6151,PropMessageExpiryInterval 31052,PropSubscriptionIdentifier 19,PropServerKeepAlive
// 22791,PropRequestProblemInformation 109,PropResponseTopic
// "\254\&8\142W&\253\200\231\202\188FDB",PropMessageExpiryInterval 5494,PropCorrelationData "H
// k\239\247u\128\&6\192.=v:\149u\139_\236\239\156\RS9\249\134",PropMessageExpiryInterval 29031,PropCorrelationData
// "\199\&5\165\137"]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0xea, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x40, 0x89, 0x9b, 0x1,  0x1c, 0x0,
                   0xd,  0x95, 0x6c, 0x7a, 0x2,  0x33, 0x7b, 0x5d, 0xc2, 0xf9, 0x31, 0xac, 0xd4, 0x45, 0x16, 0x0,  0x1a,
                   0x4c, 0xe9, 0x14, 0x4a, 0xb9, 0x9e, 0xad, 0x47, 0x63, 0xed, 0xb8, 0xce, 0x8c, 0x79, 0xb1, 0x81, 0xf7,
                   0xb7, 0x62, 0x74, 0xed, 0x7e, 0xec, 0xcf, 0x5a, 0xec, 0x9,  0x0,  0x1e, 0x97, 0xbf, 0xaa, 0x60, 0x3c,
                   0x4a, 0x68, 0xc8, 0x3,  0xb1, 0x9,  0x7f, 0xf4, 0x9d, 0xd9, 0x13, 0x4,  0xcc, 0x86, 0x5a, 0xa9, 0x28,
                   0x20, 0x5c, 0x2,  0xc8, 0x67, 0x6,  0xe9, 0x28, 0x2,  0x0,  0x0,  0x18, 0x7,  0x2,  0x0,  0x0,  0x79,
                   0x4c, 0xb,  0x13, 0x13, 0x59, 0x7,  0x17, 0x6d, 0x8,  0x0,  0xd,  0xfe, 0x38, 0x8e, 0x57, 0x26, 0xfd,
                   0xc8, 0xe7, 0xca, 0xbc, 0x46, 0x44, 0x42, 0x2,  0x0,  0x0,  0x15, 0x76, 0x9,  0x0,  0x18, 0x48, 0x20,
                   0x6b, 0xef, 0xf7, 0x75, 0x80, 0x36, 0xc0, 0x2e, 0x3d, 0x76, 0x3a, 0x95, 0x75, 0x8b, 0x5f, 0xec, 0xef,
                   0x9c, 0x1e, 0x39, 0xf9, 0x86, 0x2,  0x0,  0x0,  0x71, 0x67, 0x9,  0x0,  0x4,  0xc7, 0x35, 0xa5, 0x89,
                   0x0,  0x1c, 0xba, 0x1e, 0x16, 0xa4, 0xbe, 0xdf, 0x30, 0xed, 0x3a, 0x28, 0xf2, 0x6d, 0x81, 0xa3, 0xf,
                   0x7a, 0x92, 0x78, 0x7e, 0x52, 0xca, 0x44, 0x63, 0xb8, 0xdf, 0xa9, 0xe6, 0xa3, 0x0,  0xf,  0x4a, 0x9e,
                   0xa7, 0xb1, 0x33, 0x3d, 0x6a, 0xb0, 0xd6, 0xc9, 0xc1, 0x36, 0x77, 0xa9, 0x7d, 0x0,  0x12, 0x61, 0x41,
                   0xf6, 0x4d, 0x6c, 0xaa, 0x62, 0xc3, 0xd9, 0xc5, 0xe8, 0xd2, 0x8f, 0x2f, 0x41, 0xde, 0xc8, 0x93};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x95, 0x6c, 0x7a, 0x2, 0x33, 0x7b, 0x5d, 0xc2, 0xf9, 0x31, 0xac, 0xd4, 0x45};
  uint8_t bytesprops1[] = {0x4c, 0xe9, 0x14, 0x4a, 0xb9, 0x9e, 0xad, 0x47, 0x63, 0xed, 0xb8, 0xce, 0x8c,
                           0x79, 0xb1, 0x81, 0xf7, 0xb7, 0x62, 0x74, 0xed, 0x7e, 0xec, 0xcf, 0x5a, 0xec};
  uint8_t bytesprops2[] = {0x97, 0xbf, 0xaa, 0x60, 0x3c, 0x4a, 0x68, 0xc8, 0x3,  0xb1, 0x9,  0x7f, 0xf4, 0x9d, 0xd9,
                           0x13, 0x4,  0xcc, 0x86, 0x5a, 0xa9, 0x28, 0x20, 0x5c, 0x2,  0xc8, 0x67, 0x6,  0xe9, 0x28};
  uint8_t bytesprops3[] = {0xfe, 0x38, 0x8e, 0x57, 0x26, 0xfd, 0xc8, 0xe7, 0xca, 0xbc, 0x46, 0x44, 0x42};
  uint8_t bytesprops4[] = {0x48, 0x20, 0x6b, 0xef, 0xf7, 0x75, 0x80, 0x36, 0xc0, 0x2e, 0x3d, 0x76,
                           0x3a, 0x95, 0x75, 0x8b, 0x5f, 0xec, 0xef, 0x9c, 0x1e, 0x39, 0xf9, 0x86};
  uint8_t bytesprops5[] = {0xc7, 0x35, 0xa5, 0x89};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6151}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31052}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22791}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5494}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29031}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 16521;
  uint8_t client_id_bytes[] = {0xba, 0x1e, 0x16, 0xa4, 0xbe, 0xdf, 0x30, 0xed, 0x3a, 0x28, 0xf2, 0x6d, 0x81, 0xa3,
                               0xf,  0x7a, 0x92, 0x78, 0x7e, 0x52, 0xca, 0x44, 0x63, 0xb8, 0xdf, 0xa9, 0xe6, 0xa3};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x9e, 0xa7, 0xb1, 0x33, 0x3d, 0x6a, 0xb0, 0xd6, 0xc9, 0xc1, 0x36, 0x77, 0xa9, 0x7d};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x61, 0x41, 0xf6, 0x4d, 0x6c, 0xaa, 0x62, 0xc3, 0xd9,
                              0xc5, 0xe8, 0xd2, 0x8f, 0x2f, 0x41, 0xde, 0xc8, 0x93};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "J\SOHI-\a)\244e", _password = Just
// "o\249\n\239J\249D>\131\239\242>\206\FS\195\145\176\134\EM4", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\254", _willMsg = "\ETXm\199\156Oznd*\US\135*", _willProps = [PropMaximumQoS
// 208,PropSubscriptionIdentifierAvailable 66,PropContentType
// "\\=\188\DEL\a\ETB{\162\176\166\213\204C\204/",PropMessageExpiryInterval 17231,PropAuthenticationData
// "\191\SUBv\SYN\194X\240\233`\n",PropContentType "\232",PropAuthenticationMethod
// "j\202~%\186\ACKO\191\176\228S\US\204&\EOTI\218j\174\157\182\SI",PropServerReference
// "\US\DEL\EM\n\191\"\192\210z\NUL9\188\EOT\SO",PropTopicAliasMaximum 1458,PropRequestProblemInformation
// 2,PropReceiveMaximum 9909,PropWillDelayInterval 15809,PropMaximumQoS 199,PropReasonString
// "w\150S\a!0\188",PropCorrelationData "\180\226\b^\SYN\SYNO\242\132P]\152m\254G",PropSessionExpiryInterval
// 6495,PropServerReference "\217(Y\146C\165~zra",PropResponseTopic "\128",PropAssignedClientIdentifier
// "\DC4bJ\SUB\143\161\213\234\140y\248\219\227w+\230",PropWildcardSubscriptionAvailable 226,PropAuthenticationData
// "\163`\196Y\132\230\226\ENQ",PropReasonString
// "7\243\132x\205\248DI1\232\157\250ONuh\135%)J\242@\251Wu.\nP\160",PropResponseInformation
// "J\169",PropAuthenticationMethod "\249\173\EM.>\253\182/",PropTopicAlias 7781,PropRetainAvailable 43,PropUserProperty
// "w\231\170#\132>\GS\129F\186" "\229\177\182\139"]}), _cleanSession = True, _keepAlive = 17571, _connID =
// "}\227/\252\245n]F\190\242|\141\194\180\DLE\194\190\226W", _properties = [PropRequestResponseInformation
// 43,PropAssignedClientIdentifier
// "\238\145\253Gn\171\250\184\EOT\134\229\136\150\EOT\ENQb\155\236\CAN\b",PropWildcardSubscriptionAvailable
// 71,PropServerReference "\154\246\ENQ\207,_U\SI\180#d\210\243\193\223e\EOT\189J\141~",PropCorrelationData
// "n9\214\149h\205-D\172\228 ~\169\222\132w \141z",PropAssignedClientIdentifier
// "j\208\253Bb\237IT\147g\196\221\&5\229\129\205\152m\nZX",PropTopicAlias 31605,PropMessageExpiryInterval
// 32174,PropServerReference
// "\148\218\SUBe\215\194;L\138\224Z\182\ESC%-\154\243\135\DC4+\184\&0\ETX\189\254\224\195",PropWillDelayInterval
// 18475,PropWildcardSubscriptionAvailable 78,PropMaximumQoS 136,PropSessionExpiryInterval 372,PropTopicAlias
// 23001,PropContentType "I\188&\DC2YH\NULm\a\218#La\SYN3\225n\246\DC3\217&\SOc\143!\165x!\SOH",PropMaximumPacketSize
// 24916,PropSubscriptionIdentifier 10,PropRetainAvailable 242,PropUserProperty ""
// "\144f\168`\158Q\bo\234u\STX\131\223\175\FS`\140\223\199\246\142\134\168u\149\SI\SO\217",PropRequestProblemInformation
// 225,PropResponseInformation
// "\191\225\147\248H\136\196.iOA\173\CAN\133*\208\144\137\139'\233&",PropResponseInformation
// "\ACK{",PropSubscriptionIdentifierAvailable 203,PropRequestProblemInformation 90,PropServerKeepAlive
// 9708,PropServerReference "\230\199\140\GS,#\147\ESCYM\t\249"]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x10, 0xeb, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x44, 0xa3, 0x98, 0x2,  0x19, 0x2b, 0x12, 0x0,
      0x14, 0xee, 0x91, 0xfd, 0x47, 0x6e, 0xab, 0xfa, 0xb8, 0x4,  0x86, 0xe5, 0x88, 0x96, 0x4,  0x5,  0x62, 0x9b, 0xec,
      0x18, 0x8,  0x28, 0x47, 0x1c, 0x0,  0x15, 0x9a, 0xf6, 0x5,  0xcf, 0x2c, 0x5f, 0x55, 0xf,  0xb4, 0x23, 0x64, 0xd2,
      0xf3, 0xc1, 0xdf, 0x65, 0x4,  0xbd, 0x4a, 0x8d, 0x7e, 0x9,  0x0,  0x13, 0x6e, 0x39, 0xd6, 0x95, 0x68, 0xcd, 0x2d,
      0x44, 0xac, 0xe4, 0x20, 0x7e, 0xa9, 0xde, 0x84, 0x77, 0x20, 0x8d, 0x7a, 0x12, 0x0,  0x15, 0x6a, 0xd0, 0xfd, 0x42,
      0x62, 0xed, 0x49, 0x54, 0x93, 0x67, 0xc4, 0xdd, 0x35, 0xe5, 0x81, 0xcd, 0x98, 0x6d, 0xa,  0x5a, 0x58, 0x23, 0x7b,
      0x75, 0x2,  0x0,  0x0,  0x7d, 0xae, 0x1c, 0x0,  0x1b, 0x94, 0xda, 0x1a, 0x65, 0xd7, 0xc2, 0x3b, 0x4c, 0x8a, 0xe0,
      0x5a, 0xb6, 0x1b, 0x25, 0x2d, 0x9a, 0xf3, 0x87, 0x14, 0x2b, 0xb8, 0x30, 0x3,  0xbd, 0xfe, 0xe0, 0xc3, 0x18, 0x0,
      0x0,  0x48, 0x2b, 0x28, 0x4e, 0x24, 0x88, 0x11, 0x0,  0x0,  0x1,  0x74, 0x23, 0x59, 0xd9, 0x3,  0x0,  0x1d, 0x49,
      0xbc, 0x26, 0x12, 0x59, 0x48, 0x0,  0x6d, 0x7,  0xda, 0x23, 0x4c, 0x61, 0x16, 0x33, 0xe1, 0x6e, 0xf6, 0x13, 0xd9,
      0x26, 0xe,  0x63, 0x8f, 0x21, 0xa5, 0x78, 0x21, 0x1,  0x27, 0x0,  0x0,  0x61, 0x54, 0xb,  0xa,  0x25, 0xf2, 0x26,
      0x0,  0x0,  0x0,  0x1c, 0x90, 0x66, 0xa8, 0x60, 0x9e, 0x51, 0x8,  0x6f, 0xea, 0x75, 0x2,  0x83, 0xdf, 0xaf, 0x1c,
      0x60, 0x8c, 0xdf, 0xc7, 0xf6, 0x8e, 0x86, 0xa8, 0x75, 0x95, 0xf,  0xe,  0xd9, 0x17, 0xe1, 0x1a, 0x0,  0x16, 0xbf,
      0xe1, 0x93, 0xf8, 0x48, 0x88, 0xc4, 0x2e, 0x69, 0x4f, 0x41, 0xad, 0x18, 0x85, 0x2a, 0xd0, 0x90, 0x89, 0x8b, 0x27,
      0xe9, 0x26, 0x1a, 0x0,  0x2,  0x6,  0x7b, 0x29, 0xcb, 0x17, 0x5a, 0x13, 0x25, 0xec, 0x1c, 0x0,  0xc,  0xe6, 0xc7,
      0x8c, 0x1d, 0x2c, 0x23, 0x93, 0x1b, 0x59, 0x4d, 0x9,  0xf9, 0x0,  0x13, 0x7d, 0xe3, 0x2f, 0xfc, 0xf5, 0x6e, 0x5d,
      0x46, 0xbe, 0xf2, 0x7c, 0x8d, 0xc2, 0xb4, 0x10, 0xc2, 0xbe, 0xe2, 0x57, 0xff, 0x1,  0x24, 0xd0, 0x29, 0x42, 0x3,
      0x0,  0xf,  0x5c, 0x3d, 0xbc, 0x7f, 0x7,  0x17, 0x7b, 0xa2, 0xb0, 0xa6, 0xd5, 0xcc, 0x43, 0xcc, 0x2f, 0x2,  0x0,
      0x0,  0x43, 0x4f, 0x16, 0x0,  0xa,  0xbf, 0x1a, 0x76, 0x16, 0xc2, 0x58, 0xf0, 0xe9, 0x60, 0xa,  0x3,  0x0,  0x1,
      0xe8, 0x15, 0x0,  0x16, 0x6a, 0xca, 0x7e, 0x25, 0xba, 0x6,  0x4f, 0xbf, 0xb0, 0xe4, 0x53, 0x1f, 0xcc, 0x26, 0x4,
      0x49, 0xda, 0x6a, 0xae, 0x9d, 0xb6, 0xf,  0x1c, 0x0,  0xe,  0x1f, 0x7f, 0x19, 0xa,  0xbf, 0x22, 0xc0, 0xd2, 0x7a,
      0x0,  0x39, 0xbc, 0x4,  0xe,  0x22, 0x5,  0xb2, 0x17, 0x2,  0x21, 0x26, 0xb5, 0x18, 0x0,  0x0,  0x3d, 0xc1, 0x24,
      0xc7, 0x1f, 0x0,  0x7,  0x77, 0x96, 0x53, 0x7,  0x21, 0x30, 0xbc, 0x9,  0x0,  0xf,  0xb4, 0xe2, 0x8,  0x5e, 0x16,
      0x16, 0x4f, 0xf2, 0x84, 0x50, 0x5d, 0x98, 0x6d, 0xfe, 0x47, 0x11, 0x0,  0x0,  0x19, 0x5f, 0x1c, 0x0,  0xa,  0xd9,
      0x28, 0x59, 0x92, 0x43, 0xa5, 0x7e, 0x7a, 0x72, 0x61, 0x8,  0x0,  0x1,  0x80, 0x12, 0x0,  0x10, 0x14, 0x62, 0x4a,
      0x1a, 0x8f, 0xa1, 0xd5, 0xea, 0x8c, 0x79, 0xf8, 0xdb, 0xe3, 0x77, 0x2b, 0xe6, 0x28, 0xe2, 0x16, 0x0,  0x8,  0xa3,
      0x60, 0xc4, 0x59, 0x84, 0xe6, 0xe2, 0x5,  0x1f, 0x0,  0x1d, 0x37, 0xf3, 0x84, 0x78, 0xcd, 0xf8, 0x44, 0x49, 0x31,
      0xe8, 0x9d, 0xfa, 0x4f, 0x4e, 0x75, 0x68, 0x87, 0x25, 0x29, 0x4a, 0xf2, 0x40, 0xfb, 0x57, 0x75, 0x2e, 0xa,  0x50,
      0xa0, 0x1a, 0x0,  0x2,  0x4a, 0xa9, 0x15, 0x0,  0x8,  0xf9, 0xad, 0x19, 0x2e, 0x3e, 0xfd, 0xb6, 0x2f, 0x23, 0x1e,
      0x65, 0x25, 0x2b, 0x26, 0x0,  0xa,  0x77, 0xe7, 0xaa, 0x23, 0x84, 0x3e, 0x1d, 0x81, 0x46, 0xba, 0x0,  0x4,  0xe5,
      0xb1, 0xb6, 0x8b, 0x0,  0x1,  0xfe, 0x0,  0xc,  0x3,  0x6d, 0xc7, 0x9c, 0x4f, 0x7a, 0x6e, 0x64, 0x2a, 0x1f, 0x87,
      0x2a, 0x0,  0x8,  0x4a, 0x1,  0x49, 0x2d, 0x7,  0x29, 0xf4, 0x65, 0x0,  0x14, 0x6f, 0xf9, 0xa,  0xef, 0x4a, 0xf9,
      0x44, 0x3e, 0x83, 0xef, 0xf2, 0x3e, 0xce, 0x1c, 0xc3, 0x91, 0xb0, 0x86, 0x19, 0x34};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xee, 0x91, 0xfd, 0x47, 0x6e, 0xab, 0xfa, 0xb8, 0x4,  0x86,
                           0xe5, 0x88, 0x96, 0x4,  0x5,  0x62, 0x9b, 0xec, 0x18, 0x8};
  uint8_t bytesprops1[] = {0x9a, 0xf6, 0x5,  0xcf, 0x2c, 0x5f, 0x55, 0xf,  0xb4, 0x23, 0x64,
                           0xd2, 0xf3, 0xc1, 0xdf, 0x65, 0x4,  0xbd, 0x4a, 0x8d, 0x7e};
  uint8_t bytesprops2[] = {0x6e, 0x39, 0xd6, 0x95, 0x68, 0xcd, 0x2d, 0x44, 0xac, 0xe4,
                           0x20, 0x7e, 0xa9, 0xde, 0x84, 0x77, 0x20, 0x8d, 0x7a};
  uint8_t bytesprops3[] = {0x6a, 0xd0, 0xfd, 0x42, 0x62, 0xed, 0x49, 0x54, 0x93, 0x67, 0xc4,
                           0xdd, 0x35, 0xe5, 0x81, 0xcd, 0x98, 0x6d, 0xa,  0x5a, 0x58};
  uint8_t bytesprops4[] = {0x94, 0xda, 0x1a, 0x65, 0xd7, 0xc2, 0x3b, 0x4c, 0x8a, 0xe0, 0x5a, 0xb6, 0x1b, 0x25,
                           0x2d, 0x9a, 0xf3, 0x87, 0x14, 0x2b, 0xb8, 0x30, 0x3,  0xbd, 0xfe, 0xe0, 0xc3};
  uint8_t bytesprops5[] = {0x49, 0xbc, 0x26, 0x12, 0x59, 0x48, 0x0, 0x6d, 0x7,  0xda, 0x23, 0x4c, 0x61, 0x16, 0x33,
                           0xe1, 0x6e, 0xf6, 0x13, 0xd9, 0x26, 0xe, 0x63, 0x8f, 0x21, 0xa5, 0x78, 0x21, 0x1};
  uint8_t bytesprops7[] = {0x90, 0x66, 0xa8, 0x60, 0x9e, 0x51, 0x8,  0x6f, 0xea, 0x75, 0x2,  0x83, 0xdf, 0xaf,
                           0x1c, 0x60, 0x8c, 0xdf, 0xc7, 0xf6, 0x8e, 0x86, 0xa8, 0x75, 0x95, 0xf,  0xe,  0xd9};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops8[] = {0xbf, 0xe1, 0x93, 0xf8, 0x48, 0x88, 0xc4, 0x2e, 0x69, 0x4f, 0x41,
                           0xad, 0x18, 0x85, 0x2a, 0xd0, 0x90, 0x89, 0x8b, 0x27, 0xe9, 0x26};
  uint8_t bytesprops9[] = {0x6, 0x7b};
  uint8_t bytesprops10[] = {0xe6, 0xc7, 0x8c, 0x1d, 0x2c, 0x23, 0x93, 0x1b, 0x59, 0x4d, 0x9, 0xf9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31605}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32174}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18475}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 372}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23001}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24916}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops6}, .v = {28, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9708}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x5c, 0x3d, 0xbc, 0x7f, 0x7, 0x17, 0x7b, 0xa2, 0xb0, 0xa6, 0xd5, 0xcc, 0x43, 0xcc, 0x2f};
  uint8_t byteswillprops1[] = {0xbf, 0x1a, 0x76, 0x16, 0xc2, 0x58, 0xf0, 0xe9, 0x60, 0xa};
  uint8_t byteswillprops2[] = {0xe8};
  uint8_t byteswillprops3[] = {0x6a, 0xca, 0x7e, 0x25, 0xba, 0x6,  0x4f, 0xbf, 0xb0, 0xe4, 0x53,
                               0x1f, 0xcc, 0x26, 0x4,  0x49, 0xda, 0x6a, 0xae, 0x9d, 0xb6, 0xf};
  uint8_t byteswillprops4[] = {0x1f, 0x7f, 0x19, 0xa, 0xbf, 0x22, 0xc0, 0xd2, 0x7a, 0x0, 0x39, 0xbc, 0x4, 0xe};
  uint8_t byteswillprops5[] = {0x77, 0x96, 0x53, 0x7, 0x21, 0x30, 0xbc};
  uint8_t byteswillprops6[] = {0xb4, 0xe2, 0x8, 0x5e, 0x16, 0x16, 0x4f, 0xf2, 0x84, 0x50, 0x5d, 0x98, 0x6d, 0xfe, 0x47};
  uint8_t byteswillprops7[] = {0xd9, 0x28, 0x59, 0x92, 0x43, 0xa5, 0x7e, 0x7a, 0x72, 0x61};
  uint8_t byteswillprops8[] = {0x80};
  uint8_t byteswillprops9[] = {0x14, 0x62, 0x4a, 0x1a, 0x8f, 0xa1, 0xd5, 0xea,
                               0x8c, 0x79, 0xf8, 0xdb, 0xe3, 0x77, 0x2b, 0xe6};
  uint8_t byteswillprops10[] = {0xa3, 0x60, 0xc4, 0x59, 0x84, 0xe6, 0xe2, 0x5};
  uint8_t byteswillprops11[] = {0x37, 0xf3, 0x84, 0x78, 0xcd, 0xf8, 0x44, 0x49, 0x31, 0xe8,
                                0x9d, 0xfa, 0x4f, 0x4e, 0x75, 0x68, 0x87, 0x25, 0x29, 0x4a,
                                0xf2, 0x40, 0xfb, 0x57, 0x75, 0x2e, 0xa,  0x50, 0xa0};
  uint8_t byteswillprops12[] = {0x4a, 0xa9};
  uint8_t byteswillprops13[] = {0xf9, 0xad, 0x19, 0x2e, 0x3e, 0xfd, 0xb6, 0x2f};
  uint8_t byteswillprops15[] = {0xe5, 0xb1, 0xb6, 0x8b};
  uint8_t byteswillprops14[] = {0x77, 0xe7, 0xaa, 0x23, 0x84, 0x3e, 0x1d, 0x81, 0x46, 0xba};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17231}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1458}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9909}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15809}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6495}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7781}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {10, (char*)&byteswillprops14}, .v = {4, (char*)&byteswillprops15}}}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfe};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3, 0x6d, 0xc7, 0x9c, 0x4f, 0x7a, 0x6e, 0x64, 0x2a, 0x1f, 0x87, 0x2a};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17571;
  uint8_t client_id_bytes[] = {0x7d, 0xe3, 0x2f, 0xfc, 0xf5, 0x6e, 0x5d, 0x46, 0xbe, 0xf2,
                               0x7c, 0x8d, 0xc2, 0xb4, 0x10, 0xc2, 0xbe, 0xe2, 0x57};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4a, 0x1, 0x49, 0x2d, 0x7, 0x29, 0xf4, 0x65};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6f, 0xf9, 0xa,  0xef, 0x4a, 0xf9, 0x44, 0x3e, 0x83, 0xef,
                              0xf2, 0x3e, 0xce, 0x1c, 0xc3, 0x91, 0xb0, 0x86, 0x19, 0x34};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\185\234\165\192W\204egO", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\254\234\SUB6\251\190\216\209\209\149\ETX\168\240\240\209\216\198rh\ETX\182!\187\172\232D", _willMsg =
// "\178\150\146w\234\131bw", _willProps = [PropMessageExpiryInterval 4700]}), _cleanSession = True, _keepAlive = 26206,
// _connID = "\225\SOY\244\214&\"\224\224\202\NAK\196\174", _properties = [PropPayloadFormatIndicator 165,PropMaximumQoS
// 15,PropReceiveMaximum 16602,PropServerKeepAlive 13964,PropServerKeepAlive 31602,PropUserProperty
// "\225\174\228\134A\183\144Y"
// "0\196\152\230\136!5.j\219a\216\192\190\&1\238\234g\DC2\166\217\204A\USb;",PropTopicAliasMaximum
// 28403,PropReceiveMaximum 24001,PropRetainAvailable 144,PropMaximumQoS 45,PropReceiveMaximum
// 6896,PropSubscriptionIdentifierAvailable 166,PropRetainAvailable 121,PropReceiveMaximum 4838,PropMaximumQoS
// 231,PropSharedSubscriptionAvailable 227,PropResponseInformation
// "\218\205\245\149\170m\201)WO\134\204\210",PropCorrelationData
// "\200\227!\\~\157\144\DC1\SOH",PropMessageExpiryInterval 24616,PropRetainAvailable 122]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0xc0, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x76, 0x66, 0x5e, 0x6f, 0x1,  0xa5, 0x24,
                   0xf,  0x21, 0x40, 0xda, 0x13, 0x36, 0x8c, 0x13, 0x7b, 0x72, 0x26, 0x0,  0x8,  0xe1, 0xae, 0xe4, 0x86,
                   0x41, 0xb7, 0x90, 0x59, 0x0,  0x1a, 0x30, 0xc4, 0x98, 0xe6, 0x88, 0x21, 0x35, 0x2e, 0x6a, 0xdb, 0x61,
                   0xd8, 0xc0, 0xbe, 0x31, 0xee, 0xea, 0x67, 0x12, 0xa6, 0xd9, 0xcc, 0x41, 0x1f, 0x62, 0x3b, 0x22, 0x6e,
                   0xf3, 0x21, 0x5d, 0xc1, 0x25, 0x90, 0x24, 0x2d, 0x21, 0x1a, 0xf0, 0x29, 0xa6, 0x25, 0x79, 0x21, 0x12,
                   0xe6, 0x24, 0xe7, 0x2a, 0xe3, 0x1a, 0x0,  0xd,  0xda, 0xcd, 0xf5, 0x95, 0xaa, 0x6d, 0xc9, 0x29, 0x57,
                   0x4f, 0x86, 0xcc, 0xd2, 0x9,  0x0,  0x9,  0xc8, 0xe3, 0x21, 0x5c, 0x7e, 0x9d, 0x90, 0x11, 0x1,  0x2,
                   0x0,  0x0,  0x60, 0x28, 0x25, 0x7a, 0x0,  0xd,  0xe1, 0xe,  0x59, 0xf4, 0xd6, 0x26, 0x22, 0xe0, 0xe0,
                   0xca, 0x15, 0xc4, 0xae, 0x5,  0x2,  0x0,  0x0,  0x12, 0x5c, 0x0,  0x1a, 0xfe, 0xea, 0x1a, 0x36, 0xfb,
                   0xbe, 0xd8, 0xd1, 0xd1, 0x95, 0x3,  0xa8, 0xf0, 0xf0, 0xd1, 0xd8, 0xc6, 0x72, 0x68, 0x3,  0xb6, 0x21,
                   0xbb, 0xac, 0xe8, 0x44, 0x0,  0x8,  0xb2, 0x96, 0x92, 0x77, 0xea, 0x83, 0x62, 0x77, 0x0,  0x9,  0xb9,
                   0xea, 0xa5, 0xc0, 0x57, 0xcc, 0x65, 0x67, 0x4f};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x30, 0xc4, 0x98, 0xe6, 0x88, 0x21, 0x35, 0x2e, 0x6a, 0xdb, 0x61, 0xd8, 0xc0,
                           0xbe, 0x31, 0xee, 0xea, 0x67, 0x12, 0xa6, 0xd9, 0xcc, 0x41, 0x1f, 0x62, 0x3b};
  uint8_t bytesprops0[] = {0xe1, 0xae, 0xe4, 0x86, 0x41, 0xb7, 0x90, 0x59};
  uint8_t bytesprops2[] = {0xda, 0xcd, 0xf5, 0x95, 0xaa, 0x6d, 0xc9, 0x29, 0x57, 0x4f, 0x86, 0xcc, 0xd2};
  uint8_t bytesprops3[] = {0xc8, 0xe3, 0x21, 0x5c, 0x7e, 0x9d, 0x90, 0x11, 0x1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16602}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13964}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31602}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {26, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28403}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24001}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6896}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4838}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24616}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 122}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4700}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfe, 0xea, 0x1a, 0x36, 0xfb, 0xbe, 0xd8, 0xd1, 0xd1, 0x95, 0x3,  0xa8, 0xf0,
                                0xf0, 0xd1, 0xd8, 0xc6, 0x72, 0x68, 0x3,  0xb6, 0x21, 0xbb, 0xac, 0xe8, 0x44};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb2, 0x96, 0x92, 0x77, 0xea, 0x83, 0x62, 0x77};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26206;
  uint8_t client_id_bytes[] = {0xe1, 0xe, 0x59, 0xf4, 0xd6, 0x26, 0x22, 0xe0, 0xe0, 0xca, 0x15, 0xc4, 0xae};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb9, 0xea, 0xa5, 0xc0, 0x57, 0xcc, 0x65, 0x67, 0x4f};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\204\&9\146\248Z\193\151\237F\231u\205\207?\138\180*}\164\191\"\DEL\198$\DC3",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\DC2L", _willMsg
// = "\187\173\179\182\226\182\159\197\SO<\158\197/\170\130\157\210\201\222", _willProps =
// [PropWildcardSubscriptionAvailable 155,PropReceiveMaximum 13368,PropTopicAlias 1094,PropPayloadFormatIndicator
// 168,PropServerReference ">N\140\223\STX\191\188",PropAuthenticationMethod
// "[?\151\222\162~-\216\151\207\220I\ENQ}\158\245\165Gz\180b\145\ETX\236G8",PropReceiveMaximum
// 18277,PropWildcardSubscriptionAvailable 8,PropContentType "\167\r\255F",PropServerKeepAlive 12961,PropServerReference
// "<^Z\144\US\193\139\172\RSI\136\207\251\199\a\SOHN\160\\6\131\138F3#",PropMaximumPacketSize
// 21589,PropRequestProblemInformation 203,PropContentType "<\159B\t\165\SI",PropResponseTopic
// "e\216\&8\CAN\ENQo\200\181:",PropWillDelayInterval 29867,PropRequestProblemInformation 101,PropSessionExpiryInterval
// 28255,PropTopicAlias 4921,PropReasonString
// "\168\r\255\184\180\\F=oR\250\150\&0\146E\210\246(\243O\a|\242\229\160\&3\249\179",PropCorrelationData
// "7\179B\155P\183M\203\129\DC3\182}]\205\218d\DC4WK\238\242\SYN(\155\134\NAK",PropMessageExpiryInterval
// 3794,PropReasonString "r\162\244\209\231\193\171\186\196\135\154\231\148\205\222",PropResponseTopic
// "An\155\199\233\172/\176\244\n\250\217\224\171\253\155\134\207Y\131\158\250\218",PropUserProperty
// "-\226qm\253\254\150\&1\141*.\158\195WHW\212\229" "u\183/`\160J",PropWillDelayInterval 29343,PropTopicAlias
// 28208,PropSessionExpiryInterval 21834,PropMaximumQoS 123]}), _cleanSession = False, _keepAlive = 15691, _connID =
// ",\205\DC2;&\213%\165D\167", _properties = [PropContentType
// "AN\t\205}\198'\191Fu\251\162\238\156\RSW\213o\241\&0n0G\210\134\211",PropServerReference
// "\ETB9~\206\US@\167\NAKl\139\DC1 <C.\NULN\240\192\140\233\ENQ\EM\158",PropCorrelationData
// "'0q?\251\234\151\247\&4k\251\135\215w\US\219\198i&\SUB79\174\&8\NAK\v\209",PropRequestProblemInformation
// 201,PropReasonString "\222\239\153\198\252$\DC4\a,\134=\217\163\226\138\128WyawR\239",PropMessageExpiryInterval
// 3587,PropAssignedClientIdentifier "J\166\152",PropPayloadFormatIndicator 244,PropPayloadFormatIndicator
// 60,PropReceiveMaximum 5704,PropPayloadFormatIndicator 254,PropServerReference
// "F'4\142p*\149i\DC4\193\n\230*\DC2\ETBv/M\137h\152{\194Ynx\155",PropRequestProblemInformation
// 232,PropWillDelayInterval 21965,PropRequestProblemInformation 79,PropMaximumQoS 43,PropMessageExpiryInterval
// 5347,PropServerKeepAlive 23661,PropCorrelationData "a:W\248\rF\199\142-\182",PropAuthenticationMethod
// "\129,\255\203}\DC3\193",PropSubscriptionIdentifier 22,PropRequestProblemInformation
// 115,PropRequestResponseInformation 36,PropSharedSubscriptionAvailable 250,PropWillDelayInterval
// 18659,PropSharedSubscriptionAvailable 109]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x10, 0xca, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x84, 0x3d, 0x4b, 0xdc, 0x1,  0x3,  0x0,  0x1a, 0x41,
      0x4e, 0x9,  0xcd, 0x7d, 0xc6, 0x27, 0xbf, 0x46, 0x75, 0xfb, 0xa2, 0xee, 0x9c, 0x1e, 0x57, 0xd5, 0x6f, 0xf1, 0x30,
      0x6e, 0x30, 0x47, 0xd2, 0x86, 0xd3, 0x1c, 0x0,  0x18, 0x17, 0x39, 0x7e, 0xce, 0x1f, 0x40, 0xa7, 0x15, 0x6c, 0x8b,
      0x11, 0x20, 0x3c, 0x43, 0x2e, 0x0,  0x4e, 0xf0, 0xc0, 0x8c, 0xe9, 0x5,  0x19, 0x9e, 0x9,  0x0,  0x1b, 0x27, 0x30,
      0x71, 0x3f, 0xfb, 0xea, 0x97, 0xf7, 0x34, 0x6b, 0xfb, 0x87, 0xd7, 0x77, 0x1f, 0xdb, 0xc6, 0x69, 0x26, 0x1a, 0x37,
      0x39, 0xae, 0x38, 0x15, 0xb,  0xd1, 0x17, 0xc9, 0x1f, 0x0,  0x16, 0xde, 0xef, 0x99, 0xc6, 0xfc, 0x24, 0x14, 0x7,
      0x2c, 0x86, 0x3d, 0xd9, 0xa3, 0xe2, 0x8a, 0x80, 0x57, 0x79, 0x61, 0x77, 0x52, 0xef, 0x2,  0x0,  0x0,  0xe,  0x3,
      0x12, 0x0,  0x3,  0x4a, 0xa6, 0x98, 0x1,  0xf4, 0x1,  0x3c, 0x21, 0x16, 0x48, 0x1,  0xfe, 0x1c, 0x0,  0x1b, 0x46,
      0x27, 0x34, 0x8e, 0x70, 0x2a, 0x95, 0x69, 0x14, 0xc1, 0xa,  0xe6, 0x2a, 0x12, 0x17, 0x76, 0x2f, 0x4d, 0x89, 0x68,
      0x98, 0x7b, 0xc2, 0x59, 0x6e, 0x78, 0x9b, 0x17, 0xe8, 0x18, 0x0,  0x0,  0x55, 0xcd, 0x17, 0x4f, 0x24, 0x2b, 0x2,
      0x0,  0x0,  0x14, 0xe3, 0x13, 0x5c, 0x6d, 0x9,  0x0,  0xa,  0x61, 0x3a, 0x57, 0xf8, 0xd,  0x46, 0xc7, 0x8e, 0x2d,
      0xb6, 0x15, 0x0,  0x7,  0x81, 0x2c, 0xff, 0xcb, 0x7d, 0x13, 0xc1, 0xb,  0x16, 0x17, 0x73, 0x19, 0x24, 0x2a, 0xfa,
      0x18, 0x0,  0x0,  0x48, 0xe3, 0x2a, 0x6d, 0x0,  0xa,  0x2c, 0xcd, 0x12, 0x3b, 0x26, 0xd5, 0x25, 0xa5, 0x44, 0xa7,
      0xa0, 0x2,  0x28, 0x9b, 0x21, 0x34, 0x38, 0x23, 0x4,  0x46, 0x1,  0xa8, 0x1c, 0x0,  0x7,  0x3e, 0x4e, 0x8c, 0xdf,
      0x2,  0xbf, 0xbc, 0x15, 0x0,  0x1a, 0x5b, 0x3f, 0x97, 0xde, 0xa2, 0x7e, 0x2d, 0xd8, 0x97, 0xcf, 0xdc, 0x49, 0x5,
      0x7d, 0x9e, 0xf5, 0xa5, 0x47, 0x7a, 0xb4, 0x62, 0x91, 0x3,  0xec, 0x47, 0x38, 0x21, 0x47, 0x65, 0x28, 0x8,  0x3,
      0x0,  0x4,  0xa7, 0xd,  0xff, 0x46, 0x13, 0x32, 0xa1, 0x1c, 0x0,  0x19, 0x3c, 0x5e, 0x5a, 0x90, 0x1f, 0xc1, 0x8b,
      0xac, 0x1e, 0x49, 0x88, 0xcf, 0xfb, 0xc7, 0x7,  0x1,  0x4e, 0xa0, 0x5c, 0x36, 0x83, 0x8a, 0x46, 0x33, 0x23, 0x27,
      0x0,  0x0,  0x54, 0x55, 0x17, 0xcb, 0x3,  0x0,  0x6,  0x3c, 0x9f, 0x42, 0x9,  0xa5, 0xf,  0x8,  0x0,  0x9,  0x65,
      0xd8, 0x38, 0x18, 0x5,  0x6f, 0xc8, 0xb5, 0x3a, 0x18, 0x0,  0x0,  0x74, 0xab, 0x17, 0x65, 0x11, 0x0,  0x0,  0x6e,
      0x5f, 0x23, 0x13, 0x39, 0x1f, 0x0,  0x1c, 0xa8, 0xd,  0xff, 0xb8, 0xb4, 0x5c, 0x46, 0x3d, 0x6f, 0x52, 0xfa, 0x96,
      0x30, 0x92, 0x45, 0xd2, 0xf6, 0x28, 0xf3, 0x4f, 0x7,  0x7c, 0xf2, 0xe5, 0xa0, 0x33, 0xf9, 0xb3, 0x9,  0x0,  0x1a,
      0x37, 0xb3, 0x42, 0x9b, 0x50, 0xb7, 0x4d, 0xcb, 0x81, 0x13, 0xb6, 0x7d, 0x5d, 0xcd, 0xda, 0x64, 0x14, 0x57, 0x4b,
      0xee, 0xf2, 0x16, 0x28, 0x9b, 0x86, 0x15, 0x2,  0x0,  0x0,  0xe,  0xd2, 0x1f, 0x0,  0xf,  0x72, 0xa2, 0xf4, 0xd1,
      0xe7, 0xc1, 0xab, 0xba, 0xc4, 0x87, 0x9a, 0xe7, 0x94, 0xcd, 0xde, 0x8,  0x0,  0x17, 0x41, 0x6e, 0x9b, 0xc7, 0xe9,
      0xac, 0x2f, 0xb0, 0xf4, 0xa,  0xfa, 0xd9, 0xe0, 0xab, 0xfd, 0x9b, 0x86, 0xcf, 0x59, 0x83, 0x9e, 0xfa, 0xda, 0x26,
      0x0,  0x12, 0x2d, 0xe2, 0x71, 0x6d, 0xfd, 0xfe, 0x96, 0x31, 0x8d, 0x2a, 0x2e, 0x9e, 0xc3, 0x57, 0x48, 0x57, 0xd4,
      0xe5, 0x0,  0x6,  0x75, 0xb7, 0x2f, 0x60, 0xa0, 0x4a, 0x18, 0x0,  0x0,  0x72, 0x9f, 0x23, 0x6e, 0x30, 0x11, 0x0,
      0x0,  0x55, 0x4a, 0x24, 0x7b, 0x0,  0x2,  0x12, 0x4c, 0x0,  0x13, 0xbb, 0xad, 0xb3, 0xb6, 0xe2, 0xb6, 0x9f, 0xc5,
      0xe,  0x3c, 0x9e, 0xc5, 0x2f, 0xaa, 0x82, 0x9d, 0xd2, 0xc9, 0xde, 0x0,  0x19, 0xcc, 0x39, 0x92, 0xf8, 0x5a, 0xc1,
      0x97, 0xed, 0x46, 0xe7, 0x75, 0xcd, 0xcf, 0x3f, 0x8a, 0xb4, 0x2a, 0x7d, 0xa4, 0xbf, 0x22, 0x7f, 0xc6, 0x24, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x41, 0x4e, 0x9,  0xcd, 0x7d, 0xc6, 0x27, 0xbf, 0x46, 0x75, 0xfb, 0xa2, 0xee,
                           0x9c, 0x1e, 0x57, 0xd5, 0x6f, 0xf1, 0x30, 0x6e, 0x30, 0x47, 0xd2, 0x86, 0xd3};
  uint8_t bytesprops1[] = {0x17, 0x39, 0x7e, 0xce, 0x1f, 0x40, 0xa7, 0x15, 0x6c, 0x8b, 0x11, 0x20,
                           0x3c, 0x43, 0x2e, 0x0,  0x4e, 0xf0, 0xc0, 0x8c, 0xe9, 0x5,  0x19, 0x9e};
  uint8_t bytesprops2[] = {0x27, 0x30, 0x71, 0x3f, 0xfb, 0xea, 0x97, 0xf7, 0x34, 0x6b, 0xfb, 0x87, 0xd7, 0x77,
                           0x1f, 0xdb, 0xc6, 0x69, 0x26, 0x1a, 0x37, 0x39, 0xae, 0x38, 0x15, 0xb,  0xd1};
  uint8_t bytesprops3[] = {0xde, 0xef, 0x99, 0xc6, 0xfc, 0x24, 0x14, 0x7,  0x2c, 0x86, 0x3d,
                           0xd9, 0xa3, 0xe2, 0x8a, 0x80, 0x57, 0x79, 0x61, 0x77, 0x52, 0xef};
  uint8_t bytesprops4[] = {0x4a, 0xa6, 0x98};
  uint8_t bytesprops5[] = {0x46, 0x27, 0x34, 0x8e, 0x70, 0x2a, 0x95, 0x69, 0x14, 0xc1, 0xa,  0xe6, 0x2a, 0x12,
                           0x17, 0x76, 0x2f, 0x4d, 0x89, 0x68, 0x98, 0x7b, 0xc2, 0x59, 0x6e, 0x78, 0x9b};
  uint8_t bytesprops6[] = {0x61, 0x3a, 0x57, 0xf8, 0xd, 0x46, 0xc7, 0x8e, 0x2d, 0xb6};
  uint8_t bytesprops7[] = {0x81, 0x2c, 0xff, 0xcb, 0x7d, 0x13, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3587}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5704}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21965}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5347}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23661}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18659}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 109}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x3e, 0x4e, 0x8c, 0xdf, 0x2, 0xbf, 0xbc};
  uint8_t byteswillprops1[] = {0x5b, 0x3f, 0x97, 0xde, 0xa2, 0x7e, 0x2d, 0xd8, 0x97, 0xcf, 0xdc, 0x49, 0x5,
                               0x7d, 0x9e, 0xf5, 0xa5, 0x47, 0x7a, 0xb4, 0x62, 0x91, 0x3,  0xec, 0x47, 0x38};
  uint8_t byteswillprops2[] = {0xa7, 0xd, 0xff, 0x46};
  uint8_t byteswillprops3[] = {0x3c, 0x5e, 0x5a, 0x90, 0x1f, 0xc1, 0x8b, 0xac, 0x1e, 0x49, 0x88, 0xcf, 0xfb,
                               0xc7, 0x7,  0x1,  0x4e, 0xa0, 0x5c, 0x36, 0x83, 0x8a, 0x46, 0x33, 0x23};
  uint8_t byteswillprops4[] = {0x3c, 0x9f, 0x42, 0x9, 0xa5, 0xf};
  uint8_t byteswillprops5[] = {0x65, 0xd8, 0x38, 0x18, 0x5, 0x6f, 0xc8, 0xb5, 0x3a};
  uint8_t byteswillprops6[] = {0xa8, 0xd,  0xff, 0xb8, 0xb4, 0x5c, 0x46, 0x3d, 0x6f, 0x52, 0xfa, 0x96, 0x30, 0x92,
                               0x45, 0xd2, 0xf6, 0x28, 0xf3, 0x4f, 0x7,  0x7c, 0xf2, 0xe5, 0xa0, 0x33, 0xf9, 0xb3};
  uint8_t byteswillprops7[] = {0x37, 0xb3, 0x42, 0x9b, 0x50, 0xb7, 0x4d, 0xcb, 0x81, 0x13, 0xb6, 0x7d, 0x5d,
                               0xcd, 0xda, 0x64, 0x14, 0x57, 0x4b, 0xee, 0xf2, 0x16, 0x28, 0x9b, 0x86, 0x15};
  uint8_t byteswillprops8[] = {0x72, 0xa2, 0xf4, 0xd1, 0xe7, 0xc1, 0xab, 0xba,
                               0xc4, 0x87, 0x9a, 0xe7, 0x94, 0xcd, 0xde};
  uint8_t byteswillprops9[] = {0x41, 0x6e, 0x9b, 0xc7, 0xe9, 0xac, 0x2f, 0xb0, 0xf4, 0xa,  0xfa, 0xd9,
                               0xe0, 0xab, 0xfd, 0x9b, 0x86, 0xcf, 0x59, 0x83, 0x9e, 0xfa, 0xda};
  uint8_t byteswillprops11[] = {0x75, 0xb7, 0x2f, 0x60, 0xa0, 0x4a};
  uint8_t byteswillprops10[] = {0x2d, 0xe2, 0x71, 0x6d, 0xfd, 0xfe, 0x96, 0x31, 0x8d,
                                0x2a, 0x2e, 0x9e, 0xc3, 0x57, 0x48, 0x57, 0xd4, 0xe5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13368}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1094}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18277}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12961}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21589}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29867}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28255}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4921}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3794}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&byteswillprops10}, .v = {6, (char*)&byteswillprops11}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29343}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28208}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21834}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 123}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x12, 0x4c};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbb, 0xad, 0xb3, 0xb6, 0xe2, 0xb6, 0x9f, 0xc5, 0xe, 0x3c,
                                  0x9e, 0xc5, 0x2f, 0xaa, 0x82, 0x9d, 0xd2, 0xc9, 0xde};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15691;
  uint8_t client_id_bytes[] = {0x2c, 0xcd, 0x12, 0x3b, 0x26, 0xd5, 0x25, 0xa5, 0x44, 0xa7};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcc, 0x39, 0x92, 0xf8, 0x5a, 0xc1, 0x97, 0xed, 0x46, 0xe7, 0x75, 0xcd, 0xcf,
                              0x3f, 0x8a, 0xb4, 0x2a, 0x7d, 0xa4, 0xbf, 0x22, 0x7f, 0xc6, 0x24, 0x13};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "T>\158;\152\162\180\181\207:\ETB{u\142\245\154\140w", _password = Just
// "\220\STXp\210}\178\179y\171", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "\187\ACK\FS\183\136\196\202@\150G&%;\224\149\140\ETB\223] \145\&61:y\199", _willMsg = "\218\200
// \235O\SYN\vs\250\233G\156\217.\200\235x\198r\202fF\SUB\147\252\255\197", _willProps = [PropTopicAliasMaximum
// 23455,PropContentType "\137P\DEL\143\230",PropSessionExpiryInterval 23587,PropResponseTopic
// "\253::\n\226\&0A\247\244\238h?\DLE\SI$\224f\223\&3j",PropSubscriptionIdentifierAvailable
// 38,PropWildcardSubscriptionAvailable 173]}), _cleanSession = True, _keepAlive = 7593, _connID = "-e~\r", _properties
// = [PropAssignedClientIdentifier
// "6\206\179q\RS\212\246\&3\SOHS\244\200\172g\233\174\146\253S>",PropSubscriptionIdentifierAvailable
// 136,PropTopicAliasMaximum 12556,PropUserProperty "`t\aOK\207\193\250\244\175p0s\188\187\US\222\138\182\DLE\146YO'P&S"
// "\161\196ZR\186\EOTdx",PropRetainAvailable 66,PropMessageExpiryInterval 24590,PropAuthenticationData
// "\b\241\238\ETB&\234\134\SOHJ7f",PropSessionExpiryInterval 9944,PropPayloadFormatIndicator 154,PropMaximumPacketSize
// 3417,PropReasonString "\180\133\139i\197\205\201\193%\205\196m|\NAK\197\151-\a"]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x10, 0x8f, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x1d, 0xa9, 0x7a, 0x12, 0x0,  0x14, 0x36, 0xce,
      0xb3, 0x71, 0x1e, 0xd4, 0xf6, 0x33, 0x1,  0x53, 0xf4, 0xc8, 0xac, 0x67, 0xe9, 0xae, 0x92, 0xfd, 0x53, 0x3e, 0x29,
      0x88, 0x22, 0x31, 0xc,  0x26, 0x0,  0x1b, 0x60, 0x74, 0x7,  0x4f, 0x4b, 0xcf, 0xc1, 0xfa, 0xf4, 0xaf, 0x70, 0x30,
      0x73, 0xbc, 0xbb, 0x1f, 0xde, 0x8a, 0xb6, 0x10, 0x92, 0x59, 0x4f, 0x27, 0x50, 0x26, 0x53, 0x0,  0x8,  0xa1, 0xc4,
      0x5a, 0x52, 0xba, 0x4,  0x64, 0x78, 0x25, 0x42, 0x2,  0x0,  0x0,  0x60, 0xe,  0x16, 0x0,  0xb,  0x8,  0xf1, 0xee,
      0x17, 0x26, 0xea, 0x86, 0x1,  0x4a, 0x37, 0x66, 0x11, 0x0,  0x0,  0x26, 0xd8, 0x1,  0x9a, 0x27, 0x0,  0x0,  0xd,
      0x59, 0x1f, 0x0,  0x12, 0xb4, 0x85, 0x8b, 0x69, 0xc5, 0xcd, 0xc9, 0xc1, 0x25, 0xcd, 0xc4, 0x6d, 0x7c, 0x15, 0xc5,
      0x97, 0x2d, 0x7,  0x0,  0x4,  0x2d, 0x65, 0x7e, 0xd,  0x2b, 0x22, 0x5b, 0x9f, 0x3,  0x0,  0x5,  0x89, 0x50, 0x7f,
      0x8f, 0xe6, 0x11, 0x0,  0x0,  0x5c, 0x23, 0x8,  0x0,  0x14, 0xfd, 0x3a, 0x3a, 0xa,  0xe2, 0x30, 0x41, 0xf7, 0xf4,
      0xee, 0x68, 0x3f, 0x10, 0xf,  0x24, 0xe0, 0x66, 0xdf, 0x33, 0x6a, 0x29, 0x26, 0x28, 0xad, 0x0,  0x1a, 0xbb, 0x6,
      0x1c, 0xb7, 0x88, 0xc4, 0xca, 0x40, 0x96, 0x47, 0x26, 0x25, 0x3b, 0xe0, 0x95, 0x8c, 0x17, 0xdf, 0x5d, 0x20, 0x91,
      0x36, 0x31, 0x3a, 0x79, 0xc7, 0x0,  0x1b, 0xda, 0xc8, 0x20, 0xeb, 0x4f, 0x16, 0xb,  0x73, 0xfa, 0xe9, 0x47, 0x9c,
      0xd9, 0x2e, 0xc8, 0xeb, 0x78, 0xc6, 0x72, 0xca, 0x66, 0x46, 0x1a, 0x93, 0xfc, 0xff, 0xc5, 0x0,  0x12, 0x54, 0x3e,
      0x9e, 0x3b, 0x98, 0xa2, 0xb4, 0xb5, 0xcf, 0x3a, 0x17, 0x7b, 0x75, 0x8e, 0xf5, 0x9a, 0x8c, 0x77, 0x0,  0x9,  0xdc,
      0x2,  0x70, 0xd2, 0x7d, 0xb2, 0xb3, 0x79, 0xab};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x36, 0xce, 0xb3, 0x71, 0x1e, 0xd4, 0xf6, 0x33, 0x1,  0x53,
                           0xf4, 0xc8, 0xac, 0x67, 0xe9, 0xae, 0x92, 0xfd, 0x53, 0x3e};
  uint8_t bytesprops2[] = {0xa1, 0xc4, 0x5a, 0x52, 0xba, 0x4, 0x64, 0x78};
  uint8_t bytesprops1[] = {0x60, 0x74, 0x7,  0x4f, 0x4b, 0xcf, 0xc1, 0xfa, 0xf4, 0xaf, 0x70, 0x30, 0x73, 0xbc,
                           0xbb, 0x1f, 0xde, 0x8a, 0xb6, 0x10, 0x92, 0x59, 0x4f, 0x27, 0x50, 0x26, 0x53};
  uint8_t bytesprops3[] = {0x8, 0xf1, 0xee, 0x17, 0x26, 0xea, 0x86, 0x1, 0x4a, 0x37, 0x66};
  uint8_t bytesprops4[] = {0xb4, 0x85, 0x8b, 0x69, 0xc5, 0xcd, 0xc9, 0xc1, 0x25,
                           0xcd, 0xc4, 0x6d, 0x7c, 0x15, 0xc5, 0x97, 0x2d, 0x7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12556}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24590}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9944}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3417}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x89, 0x50, 0x7f, 0x8f, 0xe6};
  uint8_t byteswillprops1[] = {0xfd, 0x3a, 0x3a, 0xa, 0xe2, 0x30, 0x41, 0xf7, 0xf4, 0xee,
                               0x68, 0x3f, 0x10, 0xf, 0x24, 0xe0, 0x66, 0xdf, 0x33, 0x6a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23455}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23587}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 173}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbb, 0x6,  0x1c, 0xb7, 0x88, 0xc4, 0xca, 0x40, 0x96, 0x47, 0x26, 0x25, 0x3b,
                                0xe0, 0x95, 0x8c, 0x17, 0xdf, 0x5d, 0x20, 0x91, 0x36, 0x31, 0x3a, 0x79, 0xc7};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xda, 0xc8, 0x20, 0xeb, 0x4f, 0x16, 0xb,  0x73, 0xfa, 0xe9, 0x47, 0x9c, 0xd9, 0x2e,
                                  0xc8, 0xeb, 0x78, 0xc6, 0x72, 0xca, 0x66, 0x46, 0x1a, 0x93, 0xfc, 0xff, 0xc5};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7593;
  uint8_t client_id_bytes[] = {0x2d, 0x65, 0x7e, 0xd};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x54, 0x3e, 0x9e, 0x3b, 0x98, 0xa2, 0xb4, 0xb5, 0xcf,
                              0x3a, 0x17, 0x7b, 0x75, 0x8e, 0xf5, 0x9a, 0x8c, 0x77};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdc, 0x2, 0x70, 0xd2, 0x7d, 0xb2, 0xb3, 0x79, 0xab};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "/O\134\NAKdJ", _password = Just
// "\196\156\220\155\135\182\vb\vM\183\205\156r\135f`\148\245\162\148\&5\243`G\196\184*\154", _lastWill = Nothing,
// _cleanSession = False, _keepAlive = 23419, _connID = "\138\r,\181sl\193\231\232\198\"\231/\251W\218!s", _properties =
// [PropCorrelationData "\GS5\254T\162HT\191\187\252\211\216\254\DLE\220G\231\139s@\205\vW",PropSessionExpiryInterval
// 5360,PropAuthenticationMethod "\n$\206\231\251\249\174\STX+d@",PropCorrelationData
// "\136\156lg\DC1\184\233\219\242Ni\145\SO(\231",PropMessageExpiryInterval 5401,PropUserProperty
// "\n\237J\219o\201\186\n\242\238L\193\161\164\SOH\ACK\151\198"
// "1?\178\249\157\250l\128\169\186{\140\133\201ug\227\202\147\232t,\235\DC1\"\188\SOH"]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0xbc, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x5b, 0x7b, 0x76, 0x9,  0x0,
                   0x17, 0x1d, 0x35, 0xfe, 0x54, 0xa2, 0x48, 0x54, 0xbf, 0xbb, 0xfc, 0xd3, 0xd8, 0xfe, 0x10, 0xdc,
                   0x47, 0xe7, 0x8b, 0x73, 0x40, 0xcd, 0xb,  0x57, 0x11, 0x0,  0x0,  0x14, 0xf0, 0x15, 0x0,  0xb,
                   0xa,  0x24, 0xce, 0xe7, 0xfb, 0xf9, 0xae, 0x2,  0x2b, 0x64, 0x40, 0x9,  0x0,  0xf,  0x88, 0x9c,
                   0x6c, 0x67, 0x11, 0xb8, 0xe9, 0xdb, 0xf2, 0x4e, 0x69, 0x91, 0xe,  0x28, 0xe7, 0x2,  0x0,  0x0,
                   0x15, 0x19, 0x26, 0x0,  0x12, 0xa,  0xed, 0x4a, 0xdb, 0x6f, 0xc9, 0xba, 0xa,  0xf2, 0xee, 0x4c,
                   0xc1, 0xa1, 0xa4, 0x1,  0x6,  0x97, 0xc6, 0x0,  0x1b, 0x31, 0x3f, 0xb2, 0xf9, 0x9d, 0xfa, 0x6c,
                   0x80, 0xa9, 0xba, 0x7b, 0x8c, 0x85, 0xc9, 0x75, 0x67, 0xe3, 0xca, 0x93, 0xe8, 0x74, 0x2c, 0xeb,
                   0x11, 0x22, 0xbc, 0x1,  0x0,  0x12, 0x8a, 0xd,  0x2c, 0xb5, 0x73, 0x6c, 0xc1, 0xe7, 0xe8, 0xc6,
                   0x22, 0xe7, 0x2f, 0xfb, 0x57, 0xda, 0x21, 0x73, 0x0,  0x6,  0x2f, 0x4f, 0x86, 0x15, 0x64, 0x4a,
                   0x0,  0x1d, 0xc4, 0x9c, 0xdc, 0x9b, 0x87, 0xb6, 0xb,  0x62, 0xb,  0x4d, 0xb7, 0xcd, 0x9c, 0x72,
                   0x87, 0x66, 0x60, 0x94, 0xf5, 0xa2, 0x94, 0x35, 0xf3, 0x60, 0x47, 0xc4, 0xb8, 0x2a, 0x9a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1d, 0x35, 0xfe, 0x54, 0xa2, 0x48, 0x54, 0xbf, 0xbb, 0xfc, 0xd3, 0xd8,
                           0xfe, 0x10, 0xdc, 0x47, 0xe7, 0x8b, 0x73, 0x40, 0xcd, 0xb,  0x57};
  uint8_t bytesprops1[] = {0xa, 0x24, 0xce, 0xe7, 0xfb, 0xf9, 0xae, 0x2, 0x2b, 0x64, 0x40};
  uint8_t bytesprops2[] = {0x88, 0x9c, 0x6c, 0x67, 0x11, 0xb8, 0xe9, 0xdb, 0xf2, 0x4e, 0x69, 0x91, 0xe, 0x28, 0xe7};
  uint8_t bytesprops4[] = {0x31, 0x3f, 0xb2, 0xf9, 0x9d, 0xfa, 0x6c, 0x80, 0xa9, 0xba, 0x7b, 0x8c, 0x85, 0xc9,
                           0x75, 0x67, 0xe3, 0xca, 0x93, 0xe8, 0x74, 0x2c, 0xeb, 0x11, 0x22, 0xbc, 0x1};
  uint8_t bytesprops3[] = {0xa,  0xed, 0x4a, 0xdb, 0x6f, 0xc9, 0xba, 0xa,  0xf2,
                           0xee, 0x4c, 0xc1, 0xa1, 0xa4, 0x1,  0x6,  0x97, 0xc6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5360}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5401}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops3}, .v = {27, (char*)&bytesprops4}}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23419;
  uint8_t client_id_bytes[] = {0x8a, 0xd,  0x2c, 0xb5, 0x73, 0x6c, 0xc1, 0xe7, 0xe8,
                               0xc6, 0x22, 0xe7, 0x2f, 0xfb, 0x57, 0xda, 0x21, 0x73};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2f, 0x4f, 0x86, 0x15, 0x64, 0x4a};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc4, 0x9c, 0xdc, 0x9b, 0x87, 0xb6, 0xb,  0x62, 0xb,  0x4d, 0xb7, 0xcd, 0x9c, 0x72, 0x87,
                              0x66, 0x60, 0x94, 0xf5, 0xa2, 0x94, 0x35, 0xf3, 0x60, 0x47, 0xc4, 0xb8, 0x2a, 0x9a};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\247\SI;~\246\226", _password = Just
// "\182\193\204\184\SI\251\239\221G\188,\207\181\222\169\DC2a\166\156\180\a\253\242", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\149\199O\138Vs\224&_\202\180\SYN\148\241G3\232\196)$~\216\157\181\176!", _willMsg =
// "_\241\DC4V97\239\206\170C\b\207\&9\170\141\GS3\216\234\DC4\141", _willProps = [PropServerKeepAlive
// 4144,PropServerReference "\228\t\\|9p\177cY\201",PropPayloadFormatIndicator 17,PropMaximumPacketSize
// 20879,PropSharedSubscriptionAvailable 15,PropSubscriptionIdentifierAvailable 73,PropSharedSubscriptionAvailable
// 183,PropSharedSubscriptionAvailable 31,PropRetainAvailable 84,PropContentType "",PropMaximumQoS
// 100,PropTopicAliasMaximum 28424,PropAuthenticationData
// "b`\DC1\163\155\163\176\237ey~\165\t\160\ETX\236Uz\228g\167\184=",PropReceiveMaximum 9949,PropAuthenticationData
// "\139i",PropSessionExpiryInterval 12502,PropReceiveMaximum 21847,PropMessageExpiryInterval
// 22456,PropResponseInformation "]Ygv\176G\225\v",PropReasonString "\153\DC2\173\149\144U"]}), _cleanSession = True,
// _keepAlive = 7, _connID = "G\\kY\SOH\242", _properties = [PropReceiveMaximum
// 28332,PropSubscriptionIdentifierAvailable 65,PropRetainAvailable 40,PropSharedSubscriptionAvailable
// 92,PropReasonString "v\166Gl>\177$\240",PropWillDelayInterval 25126,PropResponseInformation
// "\232a\180\140\245\200/Xo\187\138Cu.\212j\143",PropCorrelationData "z[T",PropSharedSubscriptionAvailable
// 108,PropRequestResponseInformation 45,PropMessageExpiryInterval 23632,PropCorrelationData
// "\132(\ETXKN\156p\142)\250\246o",PropMaximumQoS 78,PropResponseTopic
// "\148\173\132\171\SOH\232\rf\243\162nX\136\ETB",PropRequestResponseInformation 237,PropReasonString
// "\184\254\197\130\223LN\SYN\217\212\177\210g",PropAuthenticationMethod
// "\148\159&P\CAN\ACK\132\177x\182H\ENQ",PropSubscriptionIdentifierAvailable 126,PropWildcardSubscriptionAvailable
// 118,PropUserProperty "\238\192T\SO\250\171r!\208\DC3+\214\207\230\217Sj\nU<\232"
// "\141\&8\243\227f\229m",PropTopicAlias 1412,PropRequestProblemInformation 88,PropResponseTopic
// ".\242\156\164\DC1e%7]\200\201\NAK\212\211\&0t\230\CAN",PropReceiveMaximum 11196]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x10, 0x96, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x0,  0x7,  0xc1, 0x1,  0x21, 0x6e, 0xac, 0x29,
      0x41, 0x25, 0x28, 0x2a, 0x5c, 0x1f, 0x0,  0x8,  0x76, 0xa6, 0x47, 0x6c, 0x3e, 0xb1, 0x24, 0xf0, 0x18, 0x0,  0x0,
      0x62, 0x26, 0x1a, 0x0,  0x11, 0xe8, 0x61, 0xb4, 0x8c, 0xf5, 0xc8, 0x2f, 0x58, 0x6f, 0xbb, 0x8a, 0x43, 0x75, 0x2e,
      0xd4, 0x6a, 0x8f, 0x9,  0x0,  0x3,  0x7a, 0x5b, 0x54, 0x2a, 0x6c, 0x19, 0x2d, 0x2,  0x0,  0x0,  0x5c, 0x50, 0x9,
      0x0,  0xc,  0x84, 0x28, 0x3,  0x4b, 0x4e, 0x9c, 0x70, 0x8e, 0x29, 0xfa, 0xf6, 0x6f, 0x24, 0x4e, 0x8,  0x0,  0xe,
      0x94, 0xad, 0x84, 0xab, 0x1,  0xe8, 0xd,  0x66, 0xf3, 0xa2, 0x6e, 0x58, 0x88, 0x17, 0x19, 0xed, 0x1f, 0x0,  0xd,
      0xb8, 0xfe, 0xc5, 0x82, 0xdf, 0x4c, 0x4e, 0x16, 0xd9, 0xd4, 0xb1, 0xd2, 0x67, 0x15, 0x0,  0xc,  0x94, 0x9f, 0x26,
      0x50, 0x18, 0x6,  0x84, 0xb1, 0x78, 0xb6, 0x48, 0x5,  0x29, 0x7e, 0x28, 0x76, 0x26, 0x0,  0x15, 0xee, 0xc0, 0x54,
      0xe,  0xfa, 0xab, 0x72, 0x21, 0xd0, 0x13, 0x2b, 0xd6, 0xcf, 0xe6, 0xd9, 0x53, 0x6a, 0xa,  0x55, 0x3c, 0xe8, 0x0,
      0x7,  0x8d, 0x38, 0xf3, 0xe3, 0x66, 0xe5, 0x6d, 0x23, 0x5,  0x84, 0x17, 0x58, 0x8,  0x0,  0x12, 0x2e, 0xf2, 0x9c,
      0xa4, 0x11, 0x65, 0x25, 0x37, 0x5d, 0xc8, 0xc9, 0x15, 0xd4, 0xd3, 0x30, 0x74, 0xe6, 0x18, 0x21, 0x2b, 0xbc, 0x0,
      0x6,  0x47, 0x5c, 0x6b, 0x59, 0x1,  0xf2, 0x6c, 0x13, 0x10, 0x30, 0x1c, 0x0,  0xa,  0xe4, 0x9,  0x5c, 0x7c, 0x39,
      0x70, 0xb1, 0x63, 0x59, 0xc9, 0x1,  0x11, 0x27, 0x0,  0x0,  0x51, 0x8f, 0x2a, 0xf,  0x29, 0x49, 0x2a, 0xb7, 0x2a,
      0x1f, 0x25, 0x54, 0x3,  0x0,  0x0,  0x24, 0x64, 0x22, 0x6f, 0x8,  0x16, 0x0,  0x17, 0x62, 0x60, 0x11, 0xa3, 0x9b,
      0xa3, 0xb0, 0xed, 0x65, 0x79, 0x7e, 0xa5, 0x9,  0xa0, 0x3,  0xec, 0x55, 0x7a, 0xe4, 0x67, 0xa7, 0xb8, 0x3d, 0x21,
      0x26, 0xdd, 0x16, 0x0,  0x2,  0x8b, 0x69, 0x11, 0x0,  0x0,  0x30, 0xd6, 0x21, 0x55, 0x57, 0x2,  0x0,  0x0,  0x57,
      0xb8, 0x1a, 0x0,  0x8,  0x5d, 0x59, 0x67, 0x76, 0xb0, 0x47, 0xe1, 0xb,  0x1f, 0x0,  0x6,  0x99, 0x12, 0xad, 0x95,
      0x90, 0x55, 0x0,  0x1a, 0x95, 0xc7, 0x4f, 0x8a, 0x56, 0x73, 0xe0, 0x26, 0x5f, 0xca, 0xb4, 0x16, 0x94, 0xf1, 0x47,
      0x33, 0xe8, 0xc4, 0x29, 0x24, 0x7e, 0xd8, 0x9d, 0xb5, 0xb0, 0x21, 0x0,  0x15, 0x5f, 0xf1, 0x14, 0x56, 0x39, 0x37,
      0xef, 0xce, 0xaa, 0x43, 0x8,  0xcf, 0x39, 0xaa, 0x8d, 0x1d, 0x33, 0xd8, 0xea, 0x14, 0x8d, 0x0,  0x6,  0xf7, 0xf,
      0x3b, 0x7e, 0xf6, 0xe2, 0x0,  0x17, 0xb6, 0xc1, 0xcc, 0xb8, 0xf,  0xfb, 0xef, 0xdd, 0x47, 0xbc, 0x2c, 0xcf, 0xb5,
      0xde, 0xa9, 0x12, 0x61, 0xa6, 0x9c, 0xb4, 0x7,  0xfd, 0xf2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x76, 0xa6, 0x47, 0x6c, 0x3e, 0xb1, 0x24, 0xf0};
  uint8_t bytesprops1[] = {0xe8, 0x61, 0xb4, 0x8c, 0xf5, 0xc8, 0x2f, 0x58, 0x6f,
                           0xbb, 0x8a, 0x43, 0x75, 0x2e, 0xd4, 0x6a, 0x8f};
  uint8_t bytesprops2[] = {0x7a, 0x5b, 0x54};
  uint8_t bytesprops3[] = {0x84, 0x28, 0x3, 0x4b, 0x4e, 0x9c, 0x70, 0x8e, 0x29, 0xfa, 0xf6, 0x6f};
  uint8_t bytesprops4[] = {0x94, 0xad, 0x84, 0xab, 0x1, 0xe8, 0xd, 0x66, 0xf3, 0xa2, 0x6e, 0x58, 0x88, 0x17};
  uint8_t bytesprops5[] = {0xb8, 0xfe, 0xc5, 0x82, 0xdf, 0x4c, 0x4e, 0x16, 0xd9, 0xd4, 0xb1, 0xd2, 0x67};
  uint8_t bytesprops6[] = {0x94, 0x9f, 0x26, 0x50, 0x18, 0x6, 0x84, 0xb1, 0x78, 0xb6, 0x48, 0x5};
  uint8_t bytesprops8[] = {0x8d, 0x38, 0xf3, 0xe3, 0x66, 0xe5, 0x6d};
  uint8_t bytesprops7[] = {0xee, 0xc0, 0x54, 0xe,  0xfa, 0xab, 0x72, 0x21, 0xd0, 0x13, 0x2b,
                           0xd6, 0xcf, 0xe6, 0xd9, 0x53, 0x6a, 0xa,  0x55, 0x3c, 0xe8};
  uint8_t bytesprops9[] = {0x2e, 0xf2, 0x9c, 0xa4, 0x11, 0x65, 0x25, 0x37, 0x5d,
                           0xc8, 0xc9, 0x15, 0xd4, 0xd3, 0x30, 0x74, 0xe6, 0x18};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28332}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25126}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23632}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops7}, .v = {7, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1412}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11196}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xe4, 0x9, 0x5c, 0x7c, 0x39, 0x70, 0xb1, 0x63, 0x59, 0xc9};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops2[] = {0x62, 0x60, 0x11, 0xa3, 0x9b, 0xa3, 0xb0, 0xed, 0x65, 0x79, 0x7e, 0xa5,
                               0x9,  0xa0, 0x3,  0xec, 0x55, 0x7a, 0xe4, 0x67, 0xa7, 0xb8, 0x3d};
  uint8_t byteswillprops3[] = {0x8b, 0x69};
  uint8_t byteswillprops4[] = {0x5d, 0x59, 0x67, 0x76, 0xb0, 0x47, 0xe1, 0xb};
  uint8_t byteswillprops5[] = {0x99, 0x12, 0xad, 0x95, 0x90, 0x55};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4144}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20879}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28424}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9949}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12502}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21847}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22456}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {20, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x95, 0xc7, 0x4f, 0x8a, 0x56, 0x73, 0xe0, 0x26, 0x5f, 0xca, 0xb4, 0x16, 0x94,
                                0xf1, 0x47, 0x33, 0xe8, 0xc4, 0x29, 0x24, 0x7e, 0xd8, 0x9d, 0xb5, 0xb0, 0x21};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5f, 0xf1, 0x14, 0x56, 0x39, 0x37, 0xef, 0xce, 0xaa, 0x43, 0x8,
                                  0xcf, 0x39, 0xaa, 0x8d, 0x1d, 0x33, 0xd8, 0xea, 0x14, 0x8d};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7;
  uint8_t client_id_bytes[] = {0x47, 0x5c, 0x6b, 0x59, 0x1, 0xf2};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf7, 0xf, 0x3b, 0x7e, 0xf6, 0xe2};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb6, 0xc1, 0xcc, 0xb8, 0xf,  0xfb, 0xef, 0xdd, 0x47, 0xbc, 0x2c, 0xcf,
                              0xb5, 0xde, 0xa9, 0x12, 0x61, 0xa6, 0x9c, 0xb4, 0x7,  0xfd, 0xf2};
  lwmqtt_string_t password = {23, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "{?~\139\226tEG\tA\FSI\236\230e<\SOH", _password = Just
// "\203)t\136\")\169\SID\246\237\158\241\231\162>!\140", _lastWill = Nothing, _cleanSession = True, _keepAlive = 8810,
// _connID = "n\253\208>\v\187pU\197NY\228\&5w!\237\179\179\SI\213", _properties = [PropCorrelationData
// "B\236?\nv",PropRetainAvailable 20,PropRetainAvailable 236,PropCorrelationData "",PropCorrelationData
// "\194\208\144\170\133[{\239\209\177\248\176\210\142\SUB\202\181\170",PropMessageExpiryInterval
// 17662,PropAuthenticationData "\203\150S\135\&7S",PropSessionExpiryInterval 20993,PropRequestProblemInformation
// 178,PropServerKeepAlive 2714,PropReasonString "`\141\230\192 \243p\233,b\nP\DC4\199\n}"]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x97, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x22, 0x6a, 0x4f, 0x9,  0x0,
                   0x5,  0x42, 0xec, 0x3f, 0xa,  0x76, 0x25, 0x14, 0x25, 0xec, 0x9,  0x0,  0x0,  0x9,  0x0,  0x12,
                   0xc2, 0xd0, 0x90, 0xaa, 0x85, 0x5b, 0x7b, 0xef, 0xd1, 0xb1, 0xf8, 0xb0, 0xd2, 0x8e, 0x1a, 0xca,
                   0xb5, 0xaa, 0x2,  0x0,  0x0,  0x44, 0xfe, 0x16, 0x0,  0x6,  0xcb, 0x96, 0x53, 0x87, 0x37, 0x53,
                   0x11, 0x0,  0x0,  0x52, 0x1,  0x17, 0xb2, 0x13, 0xa,  0x9a, 0x1f, 0x0,  0x10, 0x60, 0x8d, 0xe6,
                   0xc0, 0x20, 0xf3, 0x70, 0xe9, 0x2c, 0x62, 0xa,  0x50, 0x14, 0xc7, 0xa,  0x7d, 0x0,  0x14, 0x6e,
                   0xfd, 0xd0, 0x3e, 0xb,  0xbb, 0x70, 0x55, 0xc5, 0x4e, 0x59, 0xe4, 0x35, 0x77, 0x21, 0xed, 0xb3,
                   0xb3, 0xf,  0xd5, 0x0,  0x11, 0x7b, 0x3f, 0x7e, 0x8b, 0xe2, 0x74, 0x45, 0x47, 0x9,  0x41, 0x1c,
                   0x49, 0xec, 0xe6, 0x65, 0x3c, 0x1,  0x0,  0x12, 0xcb, 0x29, 0x74, 0x88, 0x22, 0x29, 0xa9, 0xf,
                   0x44, 0xf6, 0xed, 0x9e, 0xf1, 0xe7, 0xa2, 0x3e, 0x21, 0x8c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x42, 0xec, 0x3f, 0xa, 0x76};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0xc2, 0xd0, 0x90, 0xaa, 0x85, 0x5b, 0x7b, 0xef, 0xd1,
                           0xb1, 0xf8, 0xb0, 0xd2, 0x8e, 0x1a, 0xca, 0xb5, 0xaa};
  uint8_t bytesprops3[] = {0xcb, 0x96, 0x53, 0x87, 0x37, 0x53};
  uint8_t bytesprops4[] = {0x60, 0x8d, 0xe6, 0xc0, 0x20, 0xf3, 0x70, 0xe9,
                           0x2c, 0x62, 0xa,  0x50, 0x14, 0xc7, 0xa,  0x7d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17662}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20993}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2714}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8810;
  uint8_t client_id_bytes[] = {0x6e, 0xfd, 0xd0, 0x3e, 0xb,  0xbb, 0x70, 0x55, 0xc5, 0x4e,
                               0x59, 0xe4, 0x35, 0x77, 0x21, 0xed, 0xb3, 0xb3, 0xf,  0xd5};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7b, 0x3f, 0x7e, 0x8b, 0xe2, 0x74, 0x45, 0x47, 0x9,
                              0x41, 0x1c, 0x49, 0xec, 0xe6, 0x65, 0x3c, 0x1};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xcb, 0x29, 0x74, 0x88, 0x22, 0x29, 0xa9, 0xf,  0x44,
                              0xf6, 0xed, 0x9e, 0xf1, 0xe7, 0xa2, 0x3e, 0x21, 0x8c};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\132\241o\219m\247lL]\193i\175", _password = Just "\CANv\229k\211\205", _lastWill =
// Nothing, _cleanSession = True, _keepAlive = 7935, _connID = "\ETB\208H\169\248J\183R\169p\FS\190\DEL\182~\SYN",
// _properties = [PropResponseTopic
// "i*\133\206UW\139\190%\GS\165k\201\235\SUB6\SI\144_\163\253\202\213\166\195\142b\129",PropTopicAlias
// 10431,PropSharedSubscriptionAvailable 196,PropRequestResponseInformation 254,PropRetainAvailable
// 177,PropRetainAvailable 212,PropSubscriptionIdentifierAvailable 115,PropMessageExpiryInterval
// 29471,PropSubscriptionIdentifierAvailable 136,PropMessageExpiryInterval 6213,PropSubscriptionIdentifierAvailable
// 83,PropRequestResponseInformation 215,PropUserProperty "\168+0\142;\DC3\NUL\213}\187\n^W\132[MN\234"
// "\165\138\213",PropContentType "-n\146f'\180h\159\250F\157d8$\177\210JU\SO\197",PropCorrelationData
// "",PropServerKeepAlive 30727,PropRequestProblemInformation 223,PropSubscriptionIdentifier 17,PropServerKeepAlive
// 5564,PropWildcardSubscriptionAvailable 12]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0xaf, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x1e, 0xff, 0x7c, 0x8,  0x0,  0x1c,
                   0x69, 0x2a, 0x85, 0xce, 0x55, 0x57, 0x8b, 0xbe, 0x25, 0x1d, 0xa5, 0x6b, 0xc9, 0xeb, 0x1a, 0x36, 0xf,
                   0x90, 0x5f, 0xa3, 0xfd, 0xca, 0xd5, 0xa6, 0xc3, 0x8e, 0x62, 0x81, 0x23, 0x28, 0xbf, 0x2a, 0xc4, 0x19,
                   0xfe, 0x25, 0xb1, 0x25, 0xd4, 0x29, 0x73, 0x2,  0x0,  0x0,  0x73, 0x1f, 0x29, 0x88, 0x2,  0x0,  0x0,
                   0x18, 0x45, 0x29, 0x53, 0x19, 0xd7, 0x26, 0x0,  0x12, 0xa8, 0x2b, 0x30, 0x8e, 0x3b, 0x13, 0x0,  0xd5,
                   0x7d, 0xbb, 0xa,  0x5e, 0x57, 0x84, 0x5b, 0x4d, 0x4e, 0xea, 0x0,  0x3,  0xa5, 0x8a, 0xd5, 0x3,  0x0,
                   0x14, 0x2d, 0x6e, 0x92, 0x66, 0x27, 0xb4, 0x68, 0x9f, 0xfa, 0x46, 0x9d, 0x64, 0x38, 0x24, 0xb1, 0xd2,
                   0x4a, 0x55, 0xe,  0xc5, 0x9,  0x0,  0x0,  0x13, 0x78, 0x7,  0x17, 0xdf, 0xb,  0x11, 0x13, 0x15, 0xbc,
                   0x28, 0xc,  0x0,  0x10, 0x17, 0xd0, 0x48, 0xa9, 0xf8, 0x4a, 0xb7, 0x52, 0xa9, 0x70, 0x1c, 0xbe, 0x7f,
                   0xb6, 0x7e, 0x16, 0x0,  0xc,  0x84, 0xf1, 0x6f, 0xdb, 0x6d, 0xf7, 0x6c, 0x4c, 0x5d, 0xc1, 0x69, 0xaf,
                   0x0,  0x6,  0x18, 0x76, 0xe5, 0x6b, 0xd3, 0xcd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x69, 0x2a, 0x85, 0xce, 0x55, 0x57, 0x8b, 0xbe, 0x25, 0x1d, 0xa5, 0x6b, 0xc9, 0xeb,
                           0x1a, 0x36, 0xf,  0x90, 0x5f, 0xa3, 0xfd, 0xca, 0xd5, 0xa6, 0xc3, 0x8e, 0x62, 0x81};
  uint8_t bytesprops2[] = {0xa5, 0x8a, 0xd5};
  uint8_t bytesprops1[] = {0xa8, 0x2b, 0x30, 0x8e, 0x3b, 0x13, 0x0,  0xd5, 0x7d,
                           0xbb, 0xa,  0x5e, 0x57, 0x84, 0x5b, 0x4d, 0x4e, 0xea};
  uint8_t bytesprops3[] = {0x2d, 0x6e, 0x92, 0x66, 0x27, 0xb4, 0x68, 0x9f, 0xfa, 0x46,
                           0x9d, 0x64, 0x38, 0x24, 0xb1, 0xd2, 0x4a, 0x55, 0xe,  0xc5};
  uint8_t bytesprops4[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10431}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29471}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6213}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops1}, .v = {3, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30727}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5564}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 12}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7935;
  uint8_t client_id_bytes[] = {0x17, 0xd0, 0x48, 0xa9, 0xf8, 0x4a, 0xb7, 0x52,
                               0xa9, 0x70, 0x1c, 0xbe, 0x7f, 0xb6, 0x7e, 0x16};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x84, 0xf1, 0x6f, 0xdb, 0x6d, 0xf7, 0x6c, 0x4c, 0x5d, 0xc1, 0x69, 0xaf};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x76, 0xe5, 0x6b, 0xd3, 0xcd};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "d\140\&3,\181\151\SI[\ACK\153\237\181<<\225\185\SO", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "N\173\211", _willMsg = "c\251\173\SOHT\f\251",
// _willProps = [PropAssignedClientIdentifier
// "\205;\219v\156S\248O;T\CAN\246\178\ETB\186\217R\191\EOT\183\DC1b",PropRetainAvailable 103,PropSessionExpiryInterval
// 14021,PropReceiveMaximum 4410,PropMaximumPacketSize 23922,PropSessionExpiryInterval 13791,PropWillDelayInterval
// 27674,PropMessageExpiryInterval 21160,PropServerKeepAlive 5476,PropUserProperty
// "\a/.~L\186\223\167\157\168j\CANVm\180\245\149\163\&3y\157\179\143\144a" "\179\253\ENQ6tb\DC2\rI\180"]}),
// _cleanSession = True, _keepAlive = 10911, _connID = "\137\138\233WV \249\146:\152V\141\176'z", _properties =
// [PropTopicAlias 1198,PropMessageExpiryInterval 15224,PropCorrelationData
// "\135\213\131F\208\201\&4\240\162\206\NAK\161\193\207\202\129\242",PropServerReference
// "\156&I\211\220~\154\230\206\241\203\153h&6\190P\208",PropMessageExpiryInterval 14430,PropReasonString
// "\207Fj\143\140\223\244V\a\DELv\201\188\ENQ\238\ENQ\EM\219\245(\186\223",PropRequestProblemInformation
// 157,PropMessageExpiryInterval 16144,PropMaximumPacketSize 13260,PropRequestProblemInformation 25,PropReasonString
// "\235\244\141W\185\220\235\&4hH^1\ESC\165\253\ACKr\200\201\r\208p\253\184\201"]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x10, 0x99, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x46, 0x2a, 0x9f, 0x79, 0x23, 0x4,  0xae, 0x2,  0x0,
      0x0,  0x3b, 0x78, 0x9,  0x0,  0x11, 0x87, 0xd5, 0x83, 0x46, 0xd0, 0xc9, 0x34, 0xf0, 0xa2, 0xce, 0x15, 0xa1, 0xc1,
      0xcf, 0xca, 0x81, 0xf2, 0x1c, 0x0,  0x12, 0x9c, 0x26, 0x49, 0xd3, 0xdc, 0x7e, 0x9a, 0xe6, 0xce, 0xf1, 0xcb, 0x99,
      0x68, 0x26, 0x36, 0xbe, 0x50, 0xd0, 0x2,  0x0,  0x0,  0x38, 0x5e, 0x1f, 0x0,  0x16, 0xcf, 0x46, 0x6a, 0x8f, 0x8c,
      0xdf, 0xf4, 0x56, 0x7,  0x7f, 0x76, 0xc9, 0xbc, 0x5,  0xee, 0x5,  0x19, 0xdb, 0xf5, 0x28, 0xba, 0xdf, 0x17, 0x9d,
      0x2,  0x0,  0x0,  0x3f, 0x10, 0x27, 0x0,  0x0,  0x33, 0xcc, 0x17, 0x19, 0x1f, 0x0,  0x19, 0xeb, 0xf4, 0x8d, 0x57,
      0xb9, 0xdc, 0xeb, 0x34, 0x68, 0x48, 0x5e, 0x31, 0x1b, 0xa5, 0xfd, 0x6,  0x72, 0xc8, 0xc9, 0xd,  0xd0, 0x70, 0xfd,
      0xb8, 0xc9, 0x0,  0xf,  0x89, 0x8a, 0xe9, 0x57, 0x56, 0x20, 0xf9, 0x92, 0x3a, 0x98, 0x56, 0x8d, 0xb0, 0x27, 0x7a,
      0x62, 0x12, 0x0,  0x16, 0xcd, 0x3b, 0xdb, 0x76, 0x9c, 0x53, 0xf8, 0x4f, 0x3b, 0x54, 0x18, 0xf6, 0xb2, 0x17, 0xba,
      0xd9, 0x52, 0xbf, 0x4,  0xb7, 0x11, 0x62, 0x25, 0x67, 0x11, 0x0,  0x0,  0x36, 0xc5, 0x21, 0x11, 0x3a, 0x27, 0x0,
      0x0,  0x5d, 0x72, 0x11, 0x0,  0x0,  0x35, 0xdf, 0x18, 0x0,  0x0,  0x6c, 0x1a, 0x2,  0x0,  0x0,  0x52, 0xa8, 0x13,
      0x15, 0x64, 0x26, 0x0,  0x19, 0x7,  0x2f, 0x2e, 0x7e, 0x4c, 0xba, 0xdf, 0xa7, 0x9d, 0xa8, 0x6a, 0x18, 0x56, 0x6d,
      0xb4, 0xf5, 0x95, 0xa3, 0x33, 0x79, 0x9d, 0xb3, 0x8f, 0x90, 0x61, 0x0,  0xa,  0xb3, 0xfd, 0x5,  0x36, 0x74, 0x62,
      0x12, 0xd,  0x49, 0xb4, 0x0,  0x3,  0x4e, 0xad, 0xd3, 0x0,  0x7,  0x63, 0xfb, 0xad, 0x1,  0x54, 0xc,  0xfb, 0x0,
      0x11, 0x64, 0x8c, 0x33, 0x2c, 0xb5, 0x97, 0xf,  0x5b, 0x6,  0x99, 0xed, 0xb5, 0x3c, 0x3c, 0xe1, 0xb9, 0xe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x87, 0xd5, 0x83, 0x46, 0xd0, 0xc9, 0x34, 0xf0, 0xa2,
                           0xce, 0x15, 0xa1, 0xc1, 0xcf, 0xca, 0x81, 0xf2};
  uint8_t bytesprops1[] = {0x9c, 0x26, 0x49, 0xd3, 0xdc, 0x7e, 0x9a, 0xe6, 0xce,
                           0xf1, 0xcb, 0x99, 0x68, 0x26, 0x36, 0xbe, 0x50, 0xd0};
  uint8_t bytesprops2[] = {0xcf, 0x46, 0x6a, 0x8f, 0x8c, 0xdf, 0xf4, 0x56, 0x7,  0x7f, 0x76,
                           0xc9, 0xbc, 0x5,  0xee, 0x5,  0x19, 0xdb, 0xf5, 0x28, 0xba, 0xdf};
  uint8_t bytesprops3[] = {0xeb, 0xf4, 0x8d, 0x57, 0xb9, 0xdc, 0xeb, 0x34, 0x68, 0x48, 0x5e, 0x31, 0x1b,
                           0xa5, 0xfd, 0x6,  0x72, 0xc8, 0xc9, 0xd,  0xd0, 0x70, 0xfd, 0xb8, 0xc9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1198}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15224}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14430}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16144}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13260}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xcd, 0x3b, 0xdb, 0x76, 0x9c, 0x53, 0xf8, 0x4f, 0x3b, 0x54, 0x18,
                               0xf6, 0xb2, 0x17, 0xba, 0xd9, 0x52, 0xbf, 0x4,  0xb7, 0x11, 0x62};
  uint8_t byteswillprops2[] = {0xb3, 0xfd, 0x5, 0x36, 0x74, 0x62, 0x12, 0xd, 0x49, 0xb4};
  uint8_t byteswillprops1[] = {0x7,  0x2f, 0x2e, 0x7e, 0x4c, 0xba, 0xdf, 0xa7, 0x9d, 0xa8, 0x6a, 0x18, 0x56,
                               0x6d, 0xb4, 0xf5, 0x95, 0xa3, 0x33, 0x79, 0x9d, 0xb3, 0x8f, 0x90, 0x61};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14021}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4410}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23922}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13791}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27674}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21160}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5476}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {25, (char*)&byteswillprops1}, .v = {10, (char*)&byteswillprops2}}}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4e, 0xad, 0xd3};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x63, 0xfb, 0xad, 0x1, 0x54, 0xc, 0xfb};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10911;
  uint8_t client_id_bytes[] = {0x89, 0x8a, 0xe9, 0x57, 0x56, 0x20, 0xf9, 0x92,
                               0x3a, 0x98, 0x56, 0x8d, 0xb0, 0x27, 0x7a};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x64, 0x8c, 0x33, 0x2c, 0xb5, 0x97, 0xf,  0x5b, 0x6,
                              0x99, 0xed, 0xb5, 0x3c, 0x3c, 0xe1, 0xb9, 0xe};
  lwmqtt_string_t password = {17, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\190\254\vG\140\DLEq\206\199\&1\235y\135a\b", _password = Just
// "(\ESC\DC14\172tH/\136\240\225", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "'\SOH\141M", _willMsg = "\199I\t\155\SOHg\135,\200F\135\EM;\233J\152\NAK\ESCD\SUB\t\193M\DEL\220^\163\214",
// _willProps = [PropMaximumPacketSize 24417,PropTopicAlias 17524,PropMessageExpiryInterval 20187,PropServerReference
// "\f\209s`\249\163\r\214\139\205\DC4",PropAssignedClientIdentifier
// "\238\230\251\142\160\EM\160\RSQ!9ni,J'\170\241%wB\148?\250\208s\210\215\209",PropWillDelayInterval
// 26133,PropUserProperty "\217b9\a\DC31\191\128\FSM\DC4\223\131U\aN\145D\143"
// "\233Ag\229R<\190\192V\ETX\233%\168rg\194\186.`OV\146\161b\149",PropMaximumQoS 16,PropCorrelationData
// "\190\SOH]\241\CAN\148@\249\150\153@\175\245z\215\v\NUL*X\a\209G0\156\SYNu'",PropServerKeepAlive
// 24125,PropReceiveMaximum 22673]}), _cleanSession = True, _keepAlive = 14063, _connID =
// "\137\196\DC1\230\"\199\249,\241\a\f\239\159\223\170N\240\248\184\172", _properties = [PropRequestProblemInformation
// 41,PropContentType "=",PropPayloadFormatIndicator 203]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0x84, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x36, 0xef, 0x8,  0x17, 0x29, 0x3,  0x0,  0x1,
      0x3d, 0x1,  0xcb, 0x0,  0x14, 0x89, 0xc4, 0x11, 0xe6, 0x22, 0xc7, 0xf9, 0x2c, 0xf1, 0x7,  0xc,  0xef, 0x9f, 0xdf,
      0xaa, 0x4e, 0xf0, 0xf8, 0xb8, 0xac, 0x97, 0x1,  0x27, 0x0,  0x0,  0x5f, 0x61, 0x23, 0x44, 0x74, 0x2,  0x0,  0x0,
      0x4e, 0xdb, 0x1c, 0x0,  0xb,  0xc,  0xd1, 0x73, 0x60, 0xf9, 0xa3, 0xd,  0xd6, 0x8b, 0xcd, 0x14, 0x12, 0x0,  0x1d,
      0xee, 0xe6, 0xfb, 0x8e, 0xa0, 0x19, 0xa0, 0x1e, 0x51, 0x21, 0x39, 0x6e, 0x69, 0x2c, 0x4a, 0x27, 0xaa, 0xf1, 0x25,
      0x77, 0x42, 0x94, 0x3f, 0xfa, 0xd0, 0x73, 0xd2, 0xd7, 0xd1, 0x18, 0x0,  0x0,  0x66, 0x15, 0x26, 0x0,  0x13, 0xd9,
      0x62, 0x39, 0x7,  0x13, 0x31, 0xbf, 0x80, 0x1c, 0x4d, 0x14, 0xdf, 0x83, 0x55, 0x7,  0x4e, 0x91, 0x44, 0x8f, 0x0,
      0x19, 0xe9, 0x41, 0x67, 0xe5, 0x52, 0x3c, 0xbe, 0xc0, 0x56, 0x3,  0xe9, 0x25, 0xa8, 0x72, 0x67, 0xc2, 0xba, 0x2e,
      0x60, 0x4f, 0x56, 0x92, 0xa1, 0x62, 0x95, 0x24, 0x10, 0x9,  0x0,  0x1b, 0xbe, 0x1,  0x5d, 0xf1, 0x18, 0x94, 0x40,
      0xf9, 0x96, 0x99, 0x40, 0xaf, 0xf5, 0x7a, 0xd7, 0xb,  0x0,  0x2a, 0x58, 0x7,  0xd1, 0x47, 0x30, 0x9c, 0x16, 0x75,
      0x27, 0x13, 0x5e, 0x3d, 0x21, 0x58, 0x91, 0x0,  0x4,  0x27, 0x1,  0x8d, 0x4d, 0x0,  0x1c, 0xc7, 0x49, 0x9,  0x9b,
      0x1,  0x67, 0x87, 0x2c, 0xc8, 0x46, 0x87, 0x19, 0x3b, 0xe9, 0x4a, 0x98, 0x15, 0x1b, 0x44, 0x1a, 0x9,  0xc1, 0x4d,
      0x7f, 0xdc, 0x5e, 0xa3, 0xd6, 0x0,  0xf,  0xbe, 0xfe, 0xb,  0x47, 0x8c, 0x10, 0x71, 0xce, 0xc7, 0x31, 0xeb, 0x79,
      0x87, 0x61, 0x8,  0x0,  0xb,  0x28, 0x1b, 0x11, 0x34, 0xac, 0x74, 0x48, 0x2f, 0x88, 0xf0, 0xe1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 203}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc, 0xd1, 0x73, 0x60, 0xf9, 0xa3, 0xd, 0xd6, 0x8b, 0xcd, 0x14};
  uint8_t byteswillprops1[] = {0xee, 0xe6, 0xfb, 0x8e, 0xa0, 0x19, 0xa0, 0x1e, 0x51, 0x21, 0x39, 0x6e, 0x69, 0x2c, 0x4a,
                               0x27, 0xaa, 0xf1, 0x25, 0x77, 0x42, 0x94, 0x3f, 0xfa, 0xd0, 0x73, 0xd2, 0xd7, 0xd1};
  uint8_t byteswillprops3[] = {0xe9, 0x41, 0x67, 0xe5, 0x52, 0x3c, 0xbe, 0xc0, 0x56, 0x3,  0xe9, 0x25, 0xa8,
                               0x72, 0x67, 0xc2, 0xba, 0x2e, 0x60, 0x4f, 0x56, 0x92, 0xa1, 0x62, 0x95};
  uint8_t byteswillprops2[] = {0xd9, 0x62, 0x39, 0x7,  0x13, 0x31, 0xbf, 0x80, 0x1c, 0x4d,
                               0x14, 0xdf, 0x83, 0x55, 0x7,  0x4e, 0x91, 0x44, 0x8f};
  uint8_t byteswillprops4[] = {0xbe, 0x1, 0x5d, 0xf1, 0x18, 0x94, 0x40, 0xf9, 0x96, 0x99, 0x40, 0xaf, 0xf5, 0x7a,
                               0xd7, 0xb, 0x0,  0x2a, 0x58, 0x7,  0xd1, 0x47, 0x30, 0x9c, 0x16, 0x75, 0x27};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24417}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17524}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20187}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26133}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {19, (char*)&byteswillprops2}, .v = {25, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24125}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22673}},
  };

  lwmqtt_properties_t willprops = {11, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x27, 0x1, 0x8d, 0x4d};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc7, 0x49, 0x9,  0x9b, 0x1,  0x67, 0x87, 0x2c, 0xc8, 0x46, 0x87, 0x19, 0x3b, 0xe9,
                                  0x4a, 0x98, 0x15, 0x1b, 0x44, 0x1a, 0x9,  0xc1, 0x4d, 0x7f, 0xdc, 0x5e, 0xa3, 0xd6};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14063;
  uint8_t client_id_bytes[] = {0x89, 0xc4, 0x11, 0xe6, 0x22, 0xc7, 0xf9, 0x2c, 0xf1, 0x7,
                               0xc,  0xef, 0x9f, 0xdf, 0xaa, 0x4e, 0xf0, 0xf8, 0xb8, 0xac};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbe, 0xfe, 0xb, 0x47, 0x8c, 0x10, 0x71, 0xce, 0xc7, 0x31, 0xeb, 0x79, 0x87, 0x61, 0x8};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x28, 0x1b, 0x11, 0x34, 0xac, 0x74, 0x48, 0x2f, 0x88, 0xf0, 0xe1};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "%\DC3/-\bG2\192\137\196&\128\209\143\235\SI\201\&6\r\216vK\196dI\195\144G",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\132~x\156KS\246y\137\249\SYN\154%\145\149T\195\188", _willMsg =
// "X\195\&0\237\DC1l\222\ETX\219\&9\128\"\210/\254\243Q\204\169^H", _willProps = [PropServerKeepAlive
// 7936,PropResponseTopic "\202z\237\NULa\195\199"]}), _cleanSession = False, _keepAlive = 9629, _connID =
// "u\226c\130\167Y\128L\255\&1\SI\232\190", _properties = [PropResponseInformation
// "\217f\236\222\208\152\142\202\SOQ\236g\195\DLE\DC2",PropSubscriptionIdentifierAvailable 203,PropReceiveMaximum
// 2798,PropSharedSubscriptionAvailable 222,PropRequestResponseInformation 46,PropTopicAliasMaximum
// 2552,PropAuthenticationData "/\SO8\235}\188\229\156\147}\151^Or",PropTopicAliasMaximum 31519]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0xa3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xa4, 0x25, 0x9d, 0x32, 0x1a, 0x0,  0xf,
                   0xd9, 0x66, 0xec, 0xde, 0xd0, 0x98, 0x8e, 0xca, 0xe,  0x51, 0xec, 0x67, 0xc3, 0x10, 0x12, 0x29, 0xcb,
                   0x21, 0xa,  0xee, 0x2a, 0xde, 0x19, 0x2e, 0x22, 0x9,  0xf8, 0x16, 0x0,  0xe,  0x2f, 0xe,  0x38, 0xeb,
                   0x7d, 0xbc, 0xe5, 0x9c, 0x93, 0x7d, 0x97, 0x5e, 0x4f, 0x72, 0x22, 0x7b, 0x1f, 0x0,  0xd,  0x75, 0xe2,
                   0x63, 0x82, 0xa7, 0x59, 0x80, 0x4c, 0xff, 0x31, 0xf,  0xe8, 0xbe, 0xd,  0x13, 0x1f, 0x0,  0x8,  0x0,
                   0x7,  0xca, 0x7a, 0xed, 0x0,  0x61, 0xc3, 0xc7, 0x0,  0x12, 0x84, 0x7e, 0x78, 0x9c, 0x4b, 0x53, 0xf6,
                   0x79, 0x89, 0xf9, 0x16, 0x9a, 0x25, 0x91, 0x95, 0x54, 0xc3, 0xbc, 0x0,  0x15, 0x58, 0xc3, 0x30, 0xed,
                   0x11, 0x6c, 0xde, 0x3,  0xdb, 0x39, 0x80, 0x22, 0xd2, 0x2f, 0xfe, 0xf3, 0x51, 0xcc, 0xa9, 0x5e, 0x48,
                   0x0,  0x1c, 0x25, 0x13, 0x2f, 0x2d, 0x8,  0x47, 0x32, 0xc0, 0x89, 0xc4, 0x26, 0x80, 0xd1, 0x8f, 0xeb,
                   0xf,  0xc9, 0x36, 0xd,  0xd8, 0x76, 0x4b, 0xc4, 0x64, 0x49, 0xc3, 0x90, 0x47};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd9, 0x66, 0xec, 0xde, 0xd0, 0x98, 0x8e, 0xca, 0xe, 0x51, 0xec, 0x67, 0xc3, 0x10, 0x12};
  uint8_t bytesprops1[] = {0x2f, 0xe, 0x38, 0xeb, 0x7d, 0xbc, 0xe5, 0x9c, 0x93, 0x7d, 0x97, 0x5e, 0x4f, 0x72};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2798}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2552}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31519}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xca, 0x7a, 0xed, 0x0, 0x61, 0xc3, 0xc7};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7936}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {2, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x84, 0x7e, 0x78, 0x9c, 0x4b, 0x53, 0xf6, 0x79, 0x89,
                                0xf9, 0x16, 0x9a, 0x25, 0x91, 0x95, 0x54, 0xc3, 0xbc};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x58, 0xc3, 0x30, 0xed, 0x11, 0x6c, 0xde, 0x3,  0xdb, 0x39, 0x80,
                                  0x22, 0xd2, 0x2f, 0xfe, 0xf3, 0x51, 0xcc, 0xa9, 0x5e, 0x48};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9629;
  uint8_t client_id_bytes[] = {0x75, 0xe2, 0x63, 0x82, 0xa7, 0x59, 0x80, 0x4c, 0xff, 0x31, 0xf, 0xe8, 0xbe};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x25, 0x13, 0x2f, 0x2d, 0x8, 0x47, 0x32, 0xc0, 0x89, 0xc4, 0x26, 0x80, 0xd1, 0x8f,
                              0xeb, 0xf,  0xc9, 0x36, 0xd, 0xd8, 0x76, 0x4b, 0xc4, 0x64, 0x49, 0xc3, 0x90, 0x47};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "A\215\192x\237\STX\181-", _password = Just "\148", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\222\FS4[\199l\134\149\221T_=\130G\192\&4\179\205S>O", _willMsg
// = "\244\177\ETB\252l\159# _\EM\n<C\133\163", _willProps = [PropUserProperty "\185{\148\EM\166{g\147O\CAN\149\n\160:"
// "\189.\183/\228\204O\US\224vaj",PropWildcardSubscriptionAvailable 5,PropSubscriptionIdentifier 24,PropMaximumQoS
// 39,PropAuthenticationMethod "\166\160:\223\221\253\CAN}d",PropWildcardSubscriptionAvailable 214,PropMaximumPacketSize
// 31819,PropAuthenticationMethod "\195\220\135\174q\215\132",PropWillDelayInterval 13095,PropSubscriptionIdentifier
// 24,PropUserProperty "\180\134 \250\219\175\157\198\ACK\129(\162\209\249\157\&4\183H\134A,\215\241\DLE\223"
// "\155\249'\v=I\165\US\168:\DEL\229u\151\146\182\248\224\151>\239X\ETB\156m",PropSessionExpiryInterval
// 3800,PropAuthenticationData
// "\246\198\195\DEL\241\DEL\251FU\136\141\144\"\EMg>Cm\183\152\f\225s\242\152p\207#\161\177",PropSharedSubscriptionAvailable
// 89,PropServerReference "\130\b\168",PropCorrelationData "k\SOH\215t\247*(!\242\156",PropRetainAvailable
// 112,PropContentType "U\182\229\154\DC4\245\NAK\248Q\250Q}",PropPayloadFormatIndicator 148,PropUserProperty
// "\fB\253\254\159\131\142iMU\198\171\151\ENQne\221`Y\192\"\EM<\158#g"
// "\222\239,1\GS\148\253$\227\254\231+\176\145\241\DC4\206ED\155\163\226\254\199\170:\239\168\248\EM",PropReceiveMaximum
// 13798,PropAuthenticationData
// "\208gik_\195}\f\131\181\GSL\140\132;\168\&81\212\143\225\149\236",PropPayloadFormatIndicator
// 86,PropResponseInformation
// "\201\\\ETX\NUL\171\f\\/\186\159\153\SYN\157y\191_\FS\163\167\144\223?\164\&8\168&",PropRequestProblemInformation
// 86,PropRetainAvailable 121,PropCorrelationData "\f\133\190\191.\r\244&D/$s\226r\a_\246",PropMessageExpiryInterval
// 31196]}), _cleanSession = False, _keepAlive = 4049, _connID = "\209\185#Y\198\163T\169S\ETX", _properties =
// [PropResponseInformation "\133\131\216",PropReasonString "\186\SYN\250F\DC3\144",PropMaximumPacketSize
// 29022,PropMaximumQoS 88,PropAuthenticationMethod "\185f\RSc\195\DC1D\240",PropCorrelationData
// "\254-}\r\"r\GSjh(\223\GS\NAK\242X\t0s\245\184\141\135\128t\225\209JA]d",PropRequestProblemInformation
// 128,PropSubscriptionIdentifier 29,PropSubscriptionIdentifierAvailable 57,PropServerKeepAlive
// 2265,PropAuthenticationData
// "\235\208\NUL\151-zx\DC4\143\US\247\ETX\137\222\254\146M\190\165\183",PropResponseInformation
// "",PropWillDelayInterval 29590,PropTopicAlias 12605,PropSubscriptionIdentifier 0,PropAuthenticationMethod
// "i\234/",PropResponseTopic
// "\222U\134\254\212\202\205$\"\202\138\SOH,\227\220'2\233\162\135l\199D\237",PropAuthenticationData
// "grt\SOH&*\246-\229N\218\167>J\181",PropAuthenticationData
// "\155\161\242\128\197\157\ETX;\229m\238\198\&1",PropTopicAliasMaximum 15991,PropRetainAvailable 101,PropTopicAlias
// 15725,PropAuthenticationMethod "9)^\145;/iwN:\149\251\245y\DC2\ACK\205\191X\250\219\145"]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x10, 0x86, 0x5,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0xf,  0xd1, 0xd3, 0x1,  0x1a, 0x0,  0x3,  0x85,
      0x83, 0xd8, 0x1f, 0x0,  0x6,  0xba, 0x16, 0xfa, 0x46, 0x13, 0x90, 0x27, 0x0,  0x0,  0x71, 0x5e, 0x24, 0x58, 0x15,
      0x0,  0x8,  0xb9, 0x66, 0x1e, 0x63, 0xc3, 0x11, 0x44, 0xf0, 0x9,  0x0,  0x1e, 0xfe, 0x2d, 0x7d, 0xd,  0x22, 0x72,
      0x1d, 0x6a, 0x68, 0x28, 0xdf, 0x1d, 0x15, 0xf2, 0x58, 0x9,  0x30, 0x73, 0xf5, 0xb8, 0x8d, 0x87, 0x80, 0x74, 0xe1,
      0xd1, 0x4a, 0x41, 0x5d, 0x64, 0x17, 0x80, 0xb,  0x1d, 0x29, 0x39, 0x13, 0x8,  0xd9, 0x16, 0x0,  0x14, 0xeb, 0xd0,
      0x0,  0x97, 0x2d, 0x7a, 0x78, 0x14, 0x8f, 0x1f, 0xf7, 0x3,  0x89, 0xde, 0xfe, 0x92, 0x4d, 0xbe, 0xa5, 0xb7, 0x1a,
      0x0,  0x0,  0x18, 0x0,  0x0,  0x73, 0x96, 0x23, 0x31, 0x3d, 0xb,  0x0,  0x15, 0x0,  0x3,  0x69, 0xea, 0x2f, 0x8,
      0x0,  0x18, 0xde, 0x55, 0x86, 0xfe, 0xd4, 0xca, 0xcd, 0x24, 0x22, 0xca, 0x8a, 0x1,  0x2c, 0xe3, 0xdc, 0x27, 0x32,
      0xe9, 0xa2, 0x87, 0x6c, 0xc7, 0x44, 0xed, 0x16, 0x0,  0xf,  0x67, 0x72, 0x74, 0x1,  0x26, 0x2a, 0xf6, 0x2d, 0xe5,
      0x4e, 0xda, 0xa7, 0x3e, 0x4a, 0xb5, 0x16, 0x0,  0xd,  0x9b, 0xa1, 0xf2, 0x80, 0xc5, 0x9d, 0x3,  0x3b, 0xe5, 0x6d,
      0xee, 0xc6, 0x31, 0x22, 0x3e, 0x77, 0x25, 0x65, 0x23, 0x3d, 0x6d, 0x15, 0x0,  0x16, 0x39, 0x29, 0x5e, 0x91, 0x3b,
      0x2f, 0x69, 0x77, 0x4e, 0x3a, 0x95, 0xfb, 0xf5, 0x79, 0x12, 0x6,  0xcd, 0xbf, 0x58, 0xfa, 0xdb, 0x91, 0x0,  0xa,
      0xd1, 0xb9, 0x23, 0x59, 0xc6, 0xa3, 0x54, 0xa9, 0x53, 0x3,  0xe4, 0x2,  0x26, 0x0,  0xe,  0xb9, 0x7b, 0x94, 0x19,
      0xa6, 0x7b, 0x67, 0x93, 0x4f, 0x18, 0x95, 0xa,  0xa0, 0x3a, 0x0,  0xc,  0xbd, 0x2e, 0xb7, 0x2f, 0xe4, 0xcc, 0x4f,
      0x1f, 0xe0, 0x76, 0x61, 0x6a, 0x28, 0x5,  0xb,  0x18, 0x24, 0x27, 0x15, 0x0,  0x9,  0xa6, 0xa0, 0x3a, 0xdf, 0xdd,
      0xfd, 0x18, 0x7d, 0x64, 0x28, 0xd6, 0x27, 0x0,  0x0,  0x7c, 0x4b, 0x15, 0x0,  0x7,  0xc3, 0xdc, 0x87, 0xae, 0x71,
      0xd7, 0x84, 0x18, 0x0,  0x0,  0x33, 0x27, 0xb,  0x18, 0x26, 0x0,  0x19, 0xb4, 0x86, 0x20, 0xfa, 0xdb, 0xaf, 0x9d,
      0xc6, 0x6,  0x81, 0x28, 0xa2, 0xd1, 0xf9, 0x9d, 0x34, 0xb7, 0x48, 0x86, 0x41, 0x2c, 0xd7, 0xf1, 0x10, 0xdf, 0x0,
      0x19, 0x9b, 0xf9, 0x27, 0xb,  0x3d, 0x49, 0xa5, 0x1f, 0xa8, 0x3a, 0x7f, 0xe5, 0x75, 0x97, 0x92, 0xb6, 0xf8, 0xe0,
      0x97, 0x3e, 0xef, 0x58, 0x17, 0x9c, 0x6d, 0x11, 0x0,  0x0,  0xe,  0xd8, 0x16, 0x0,  0x1e, 0xf6, 0xc6, 0xc3, 0x7f,
      0xf1, 0x7f, 0xfb, 0x46, 0x55, 0x88, 0x8d, 0x90, 0x22, 0x19, 0x67, 0x3e, 0x43, 0x6d, 0xb7, 0x98, 0xc,  0xe1, 0x73,
      0xf2, 0x98, 0x70, 0xcf, 0x23, 0xa1, 0xb1, 0x2a, 0x59, 0x1c, 0x0,  0x3,  0x82, 0x8,  0xa8, 0x9,  0x0,  0xa,  0x6b,
      0x1,  0xd7, 0x74, 0xf7, 0x2a, 0x28, 0x21, 0xf2, 0x9c, 0x25, 0x70, 0x3,  0x0,  0xc,  0x55, 0xb6, 0xe5, 0x9a, 0x14,
      0xf5, 0x15, 0xf8, 0x51, 0xfa, 0x51, 0x7d, 0x1,  0x94, 0x26, 0x0,  0x1a, 0xc,  0x42, 0xfd, 0xfe, 0x9f, 0x83, 0x8e,
      0x69, 0x4d, 0x55, 0xc6, 0xab, 0x97, 0x5,  0x6e, 0x65, 0xdd, 0x60, 0x59, 0xc0, 0x22, 0x19, 0x3c, 0x9e, 0x23, 0x67,
      0x0,  0x1e, 0xde, 0xef, 0x2c, 0x31, 0x1d, 0x94, 0xfd, 0x24, 0xe3, 0xfe, 0xe7, 0x2b, 0xb0, 0x91, 0xf1, 0x14, 0xce,
      0x45, 0x44, 0x9b, 0xa3, 0xe2, 0xfe, 0xc7, 0xaa, 0x3a, 0xef, 0xa8, 0xf8, 0x19, 0x21, 0x35, 0xe6, 0x16, 0x0,  0x17,
      0xd0, 0x67, 0x69, 0x6b, 0x5f, 0xc3, 0x7d, 0xc,  0x83, 0xb5, 0x1d, 0x4c, 0x8c, 0x84, 0x3b, 0xa8, 0x38, 0x31, 0xd4,
      0x8f, 0xe1, 0x95, 0xec, 0x1,  0x56, 0x1a, 0x0,  0x1a, 0xc9, 0x5c, 0x3,  0x0,  0xab, 0xc,  0x5c, 0x2f, 0xba, 0x9f,
      0x99, 0x16, 0x9d, 0x79, 0xbf, 0x5f, 0x1c, 0xa3, 0xa7, 0x90, 0xdf, 0x3f, 0xa4, 0x38, 0xa8, 0x26, 0x17, 0x56, 0x25,
      0x79, 0x9,  0x0,  0x11, 0xc,  0x85, 0xbe, 0xbf, 0x2e, 0xd,  0xf4, 0x26, 0x44, 0x2f, 0x24, 0x73, 0xe2, 0x72, 0x7,
      0x5f, 0xf6, 0x2,  0x0,  0x0,  0x79, 0xdc, 0x0,  0x15, 0xde, 0x1c, 0x34, 0x5b, 0xc7, 0x6c, 0x86, 0x95, 0xdd, 0x54,
      0x5f, 0x3d, 0x82, 0x47, 0xc0, 0x34, 0xb3, 0xcd, 0x53, 0x3e, 0x4f, 0x0,  0xf,  0xf4, 0xb1, 0x17, 0xfc, 0x6c, 0x9f,
      0x23, 0x20, 0x5f, 0x19, 0xa,  0x3c, 0x43, 0x85, 0xa3, 0x0,  0x8,  0x41, 0xd7, 0xc0, 0x78, 0xed, 0x2,  0xb5, 0x2d,
      0x0,  0x1,  0x94};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x85, 0x83, 0xd8};
  uint8_t bytesprops1[] = {0xba, 0x16, 0xfa, 0x46, 0x13, 0x90};
  uint8_t bytesprops2[] = {0xb9, 0x66, 0x1e, 0x63, 0xc3, 0x11, 0x44, 0xf0};
  uint8_t bytesprops3[] = {0xfe, 0x2d, 0x7d, 0xd,  0x22, 0x72, 0x1d, 0x6a, 0x68, 0x28, 0xdf, 0x1d, 0x15, 0xf2, 0x58,
                           0x9,  0x30, 0x73, 0xf5, 0xb8, 0x8d, 0x87, 0x80, 0x74, 0xe1, 0xd1, 0x4a, 0x41, 0x5d, 0x64};
  uint8_t bytesprops4[] = {0xeb, 0xd0, 0x0,  0x97, 0x2d, 0x7a, 0x78, 0x14, 0x8f, 0x1f,
                           0xf7, 0x3,  0x89, 0xde, 0xfe, 0x92, 0x4d, 0xbe, 0xa5, 0xb7};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x69, 0xea, 0x2f};
  uint8_t bytesprops7[] = {0xde, 0x55, 0x86, 0xfe, 0xd4, 0xca, 0xcd, 0x24, 0x22, 0xca, 0x8a, 0x1,
                           0x2c, 0xe3, 0xdc, 0x27, 0x32, 0xe9, 0xa2, 0x87, 0x6c, 0xc7, 0x44, 0xed};
  uint8_t bytesprops8[] = {0x67, 0x72, 0x74, 0x1, 0x26, 0x2a, 0xf6, 0x2d, 0xe5, 0x4e, 0xda, 0xa7, 0x3e, 0x4a, 0xb5};
  uint8_t bytesprops9[] = {0x9b, 0xa1, 0xf2, 0x80, 0xc5, 0x9d, 0x3, 0x3b, 0xe5, 0x6d, 0xee, 0xc6, 0x31};
  uint8_t bytesprops10[] = {0x39, 0x29, 0x5e, 0x91, 0x3b, 0x2f, 0x69, 0x77, 0x4e, 0x3a, 0x95,
                            0xfb, 0xf5, 0x79, 0x12, 0x6,  0xcd, 0xbf, 0x58, 0xfa, 0xdb, 0x91};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29022}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2265}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29590}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12605}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15991}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15725}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xbd, 0x2e, 0xb7, 0x2f, 0xe4, 0xcc, 0x4f, 0x1f, 0xe0, 0x76, 0x61, 0x6a};
  uint8_t byteswillprops0[] = {0xb9, 0x7b, 0x94, 0x19, 0xa6, 0x7b, 0x67, 0x93, 0x4f, 0x18, 0x95, 0xa, 0xa0, 0x3a};
  uint8_t byteswillprops2[] = {0xa6, 0xa0, 0x3a, 0xdf, 0xdd, 0xfd, 0x18, 0x7d, 0x64};
  uint8_t byteswillprops3[] = {0xc3, 0xdc, 0x87, 0xae, 0x71, 0xd7, 0x84};
  uint8_t byteswillprops5[] = {0x9b, 0xf9, 0x27, 0xb,  0x3d, 0x49, 0xa5, 0x1f, 0xa8, 0x3a, 0x7f, 0xe5, 0x75,
                               0x97, 0x92, 0xb6, 0xf8, 0xe0, 0x97, 0x3e, 0xef, 0x58, 0x17, 0x9c, 0x6d};
  uint8_t byteswillprops4[] = {0xb4, 0x86, 0x20, 0xfa, 0xdb, 0xaf, 0x9d, 0xc6, 0x6,  0x81, 0x28, 0xa2, 0xd1,
                               0xf9, 0x9d, 0x34, 0xb7, 0x48, 0x86, 0x41, 0x2c, 0xd7, 0xf1, 0x10, 0xdf};
  uint8_t byteswillprops6[] = {0xf6, 0xc6, 0xc3, 0x7f, 0xf1, 0x7f, 0xfb, 0x46, 0x55, 0x88,
                               0x8d, 0x90, 0x22, 0x19, 0x67, 0x3e, 0x43, 0x6d, 0xb7, 0x98,
                               0xc,  0xe1, 0x73, 0xf2, 0x98, 0x70, 0xcf, 0x23, 0xa1, 0xb1};
  uint8_t byteswillprops7[] = {0x82, 0x8, 0xa8};
  uint8_t byteswillprops8[] = {0x6b, 0x1, 0xd7, 0x74, 0xf7, 0x2a, 0x28, 0x21, 0xf2, 0x9c};
  uint8_t byteswillprops9[] = {0x55, 0xb6, 0xe5, 0x9a, 0x14, 0xf5, 0x15, 0xf8, 0x51, 0xfa, 0x51, 0x7d};
  uint8_t byteswillprops11[] = {0xde, 0xef, 0x2c, 0x31, 0x1d, 0x94, 0xfd, 0x24, 0xe3, 0xfe,
                                0xe7, 0x2b, 0xb0, 0x91, 0xf1, 0x14, 0xce, 0x45, 0x44, 0x9b,
                                0xa3, 0xe2, 0xfe, 0xc7, 0xaa, 0x3a, 0xef, 0xa8, 0xf8, 0x19};
  uint8_t byteswillprops10[] = {0xc, 0x42, 0xfd, 0xfe, 0x9f, 0x83, 0x8e, 0x69, 0x4d, 0x55, 0xc6, 0xab, 0x97,
                                0x5, 0x6e, 0x65, 0xdd, 0x60, 0x59, 0xc0, 0x22, 0x19, 0x3c, 0x9e, 0x23, 0x67};
  uint8_t byteswillprops12[] = {0xd0, 0x67, 0x69, 0x6b, 0x5f, 0xc3, 0x7d, 0xc,  0x83, 0xb5, 0x1d, 0x4c,
                                0x8c, 0x84, 0x3b, 0xa8, 0x38, 0x31, 0xd4, 0x8f, 0xe1, 0x95, 0xec};
  uint8_t byteswillprops13[] = {0xc9, 0x5c, 0x3,  0x0,  0xab, 0xc,  0x5c, 0x2f, 0xba, 0x9f, 0x99, 0x16, 0x9d,
                                0x79, 0xbf, 0x5f, 0x1c, 0xa3, 0xa7, 0x90, 0xdf, 0x3f, 0xa4, 0x38, 0xa8, 0x26};
  uint8_t byteswillprops14[] = {0xc,  0x85, 0xbe, 0xbf, 0x2e, 0xd, 0xf4, 0x26, 0x44,
                                0x2f, 0x24, 0x73, 0xe2, 0x72, 0x7, 0x5f, 0xf6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {14, (char*)&byteswillprops0}, .v = {12, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31819}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13095}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {25, (char*)&byteswillprops4}, .v = {25, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3800}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {26, (char*)&byteswillprops10}, .v = {30, (char*)&byteswillprops11}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13798}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&byteswillprops14}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31196}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xde, 0x1c, 0x34, 0x5b, 0xc7, 0x6c, 0x86, 0x95, 0xdd, 0x54, 0x5f,
                                0x3d, 0x82, 0x47, 0xc0, 0x34, 0xb3, 0xcd, 0x53, 0x3e, 0x4f};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf4, 0xb1, 0x17, 0xfc, 0x6c, 0x9f, 0x23, 0x20,
                                  0x5f, 0x19, 0xa,  0x3c, 0x43, 0x85, 0xa3};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4049;
  uint8_t client_id_bytes[] = {0xd1, 0xb9, 0x23, 0x59, 0xc6, 0xa3, 0x54, 0xa9, 0x53, 0x3};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x41, 0xd7, 0xc0, 0x78, 0xed, 0x2, 0xb5, 0x2d};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x94};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\187\252\SOHf\232\ACK\213\245\176\252\195\235\242\&9\182\171\n\a\222HA\SI\186\135\ti", _password = Just
// "P\241&f\236\151C\175\171", _lastWill = Nothing, _cleanSession = True, _keepAlive = 26836, _connID =
// "\203,\DLE\255\EOT\245\146\234>\226\148\240e\135\229\SUB\SUB5", _properties = [PropPayloadFormatIndicator
// 97,PropResponseInformation "&\151E\158\144\186\180k\214'\202\&3\"x%vh=\SI\166\250W\219\202",PropTopicAliasMaximum
// 12587,PropAuthenticationMethod
// "1\180\243\SI\STX\f\188\249\225\155\152\&3)UlV3\155\232\211\SYN\243~3\CAN9",PropUserProperty
// "\199\187@\252\233r\a9\153\213t\251\&4\233\244"
// "\255s\163\178\&2\176\213\172\&9\157\253~,\RSE\CANj6P;B",PropSessionExpiryInterval 31793,PropAuthenticationData
// "\ETBBp\181k\135\193\"\DC2`",PropWildcardSubscriptionAvailable 59,PropSharedSubscriptionAvailable
// 138,PropRequestProblemInformation 105,PropRequestResponseInformation 131,PropSubscriptionIdentifier
// 33,PropWildcardSubscriptionAvailable 16,PropContentType "M\199\154",PropAuthenticationData
// "\ETX8C*\243\140\SI\227\184\129\182\181l",PropReceiveMaximum 5301,PropContentType
// "\157\SI\202\168\a\NAK\196tI\133\218W",PropRequestResponseInformation 173,PropRequestResponseInformation
// 206,PropTopicAlias 31868,PropRequestResponseInformation 241,PropMessageExpiryInterval 22153,PropUserProperty
// "\209\168\230" "B\180\184gppr\GS\182\RS\154p\157\NUL]rj9\SO\249)\SI:"]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x10, 0xa0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x68, 0xd4, 0xd9, 0x1,  0x1,  0x61, 0x1a, 0x0,
      0x18, 0x26, 0x97, 0x45, 0x9e, 0x90, 0xba, 0xb4, 0x6b, 0xd6, 0x27, 0xca, 0x33, 0x22, 0x78, 0x25, 0x76, 0x68, 0x3d,
      0xf,  0xa6, 0xfa, 0x57, 0xdb, 0xca, 0x22, 0x31, 0x2b, 0x15, 0x0,  0x1a, 0x31, 0xb4, 0xf3, 0xf,  0x2,  0xc,  0xbc,
      0xf9, 0xe1, 0x9b, 0x98, 0x33, 0x29, 0x55, 0x6c, 0x56, 0x33, 0x9b, 0xe8, 0xd3, 0x16, 0xf3, 0x7e, 0x33, 0x18, 0x39,
      0x26, 0x0,  0xf,  0xc7, 0xbb, 0x40, 0xfc, 0xe9, 0x72, 0x7,  0x39, 0x99, 0xd5, 0x74, 0xfb, 0x34, 0xe9, 0xf4, 0x0,
      0x15, 0xff, 0x73, 0xa3, 0xb2, 0x32, 0xb0, 0xd5, 0xac, 0x39, 0x9d, 0xfd, 0x7e, 0x2c, 0x1e, 0x45, 0x18, 0x6a, 0x36,
      0x50, 0x3b, 0x42, 0x11, 0x0,  0x0,  0x7c, 0x31, 0x16, 0x0,  0xa,  0x17, 0x42, 0x70, 0xb5, 0x6b, 0x87, 0xc1, 0x22,
      0x12, 0x60, 0x28, 0x3b, 0x2a, 0x8a, 0x17, 0x69, 0x19, 0x83, 0xb,  0x21, 0x28, 0x10, 0x3,  0x0,  0x3,  0x4d, 0xc7,
      0x9a, 0x16, 0x0,  0xd,  0x3,  0x38, 0x43, 0x2a, 0xf3, 0x8c, 0xf,  0xe3, 0xb8, 0x81, 0xb6, 0xb5, 0x6c, 0x21, 0x14,
      0xb5, 0x3,  0x0,  0xc,  0x9d, 0xf,  0xca, 0xa8, 0x7,  0x15, 0xc4, 0x74, 0x49, 0x85, 0xda, 0x57, 0x19, 0xad, 0x19,
      0xce, 0x23, 0x7c, 0x7c, 0x19, 0xf1, 0x2,  0x0,  0x0,  0x56, 0x89, 0x26, 0x0,  0x3,  0xd1, 0xa8, 0xe6, 0x0,  0x17,
      0x42, 0xb4, 0xb8, 0x67, 0x70, 0x70, 0x72, 0x1d, 0xb6, 0x1e, 0x9a, 0x70, 0x9d, 0x0,  0x5d, 0x72, 0x6a, 0x39, 0xe,
      0xf9, 0x29, 0xf,  0x3a, 0x0,  0x12, 0xcb, 0x2c, 0x10, 0xff, 0x4,  0xf5, 0x92, 0xea, 0x3e, 0xe2, 0x94, 0xf0, 0x65,
      0x87, 0xe5, 0x1a, 0x1a, 0x35, 0x0,  0x1a, 0xbb, 0xfc, 0x1,  0x66, 0xe8, 0x6,  0xd5, 0xf5, 0xb0, 0xfc, 0xc3, 0xeb,
      0xf2, 0x39, 0xb6, 0xab, 0xa,  0x7,  0xde, 0x48, 0x41, 0xf,  0xba, 0x87, 0x9,  0x69, 0x0,  0x9,  0x50, 0xf1, 0x26,
      0x66, 0xec, 0x97, 0x43, 0xaf, 0xab};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x26, 0x97, 0x45, 0x9e, 0x90, 0xba, 0xb4, 0x6b, 0xd6, 0x27, 0xca, 0x33,
                           0x22, 0x78, 0x25, 0x76, 0x68, 0x3d, 0xf,  0xa6, 0xfa, 0x57, 0xdb, 0xca};
  uint8_t bytesprops1[] = {0x31, 0xb4, 0xf3, 0xf,  0x2,  0xc,  0xbc, 0xf9, 0xe1, 0x9b, 0x98, 0x33, 0x29,
                           0x55, 0x6c, 0x56, 0x33, 0x9b, 0xe8, 0xd3, 0x16, 0xf3, 0x7e, 0x33, 0x18, 0x39};
  uint8_t bytesprops3[] = {0xff, 0x73, 0xa3, 0xb2, 0x32, 0xb0, 0xd5, 0xac, 0x39, 0x9d, 0xfd,
                           0x7e, 0x2c, 0x1e, 0x45, 0x18, 0x6a, 0x36, 0x50, 0x3b, 0x42};
  uint8_t bytesprops2[] = {0xc7, 0xbb, 0x40, 0xfc, 0xe9, 0x72, 0x7, 0x39, 0x99, 0xd5, 0x74, 0xfb, 0x34, 0xe9, 0xf4};
  uint8_t bytesprops4[] = {0x17, 0x42, 0x70, 0xb5, 0x6b, 0x87, 0xc1, 0x22, 0x12, 0x60};
  uint8_t bytesprops5[] = {0x4d, 0xc7, 0x9a};
  uint8_t bytesprops6[] = {0x3, 0x38, 0x43, 0x2a, 0xf3, 0x8c, 0xf, 0xe3, 0xb8, 0x81, 0xb6, 0xb5, 0x6c};
  uint8_t bytesprops7[] = {0x9d, 0xf, 0xca, 0xa8, 0x7, 0x15, 0xc4, 0x74, 0x49, 0x85, 0xda, 0x57};
  uint8_t bytesprops9[] = {0x42, 0xb4, 0xb8, 0x67, 0x70, 0x70, 0x72, 0x1d, 0xb6, 0x1e, 0x9a, 0x70,
                           0x9d, 0x0,  0x5d, 0x72, 0x6a, 0x39, 0xe,  0xf9, 0x29, 0xf,  0x3a};
  uint8_t bytesprops8[] = {0xd1, 0xa8, 0xe6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12587}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops2}, .v = {21, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31793}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 33}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5301}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31868}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22153}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops8}, .v = {23, (char*)&bytesprops9}}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26836;
  uint8_t client_id_bytes[] = {0xcb, 0x2c, 0x10, 0xff, 0x4,  0xf5, 0x92, 0xea, 0x3e,
                               0xe2, 0x94, 0xf0, 0x65, 0x87, 0xe5, 0x1a, 0x1a, 0x35};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xbb, 0xfc, 0x1,  0x66, 0xe8, 0x6,  0xd5, 0xf5, 0xb0, 0xfc, 0xc3, 0xeb, 0xf2,
                              0x39, 0xb6, 0xab, 0xa,  0x7,  0xde, 0x48, 0x41, 0xf,  0xba, 0x87, 0x9,  0x69};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x50, 0xf1, 0x26, 0x66, 0xec, 0x97, 0x43, 0xaf, 0xab};
  lwmqtt_string_t password = {9, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7633 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x5, 0x1d, 0xd1, 0x0, 0x0, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7633, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29762 [("J\239",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x7, 0x74, 0x42, 0x0, 0x2, 0x4a, 0xef, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x4a, 0xef};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29762, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30334 [("/\SUB\DC2:k\140\DC3\184\237\130\214-\204\144j\179\231\244\242tp@\RSZx\ENQX",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("T\210\128\148\230\144\147\&2&+N\138\198\129\156\149",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\a[}\129\251}\153\232\133",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\156\198\198\142\194\236T\189\228\175e\155\ETX\145\225\\:\SUB\131\221",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("D\174\175\216\224\ETB\193\170\214\231",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\207\193\224w'\248\246",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x6d, 0x76, 0x7e, 0x0,  0x1b, 0x2f, 0x1a, 0x12, 0x3a, 0x6b, 0x8c, 0x13, 0xb8, 0xed, 0x82,
                   0xd6, 0x2d, 0xcc, 0x90, 0x6a, 0xb3, 0xe7, 0xf4, 0xf2, 0x74, 0x70, 0x40, 0x1e, 0x5a, 0x78, 0x5,
                   0x58, 0x2,  0x0,  0x10, 0x54, 0xd2, 0x80, 0x94, 0xe6, 0x90, 0x93, 0x32, 0x26, 0x2b, 0x4e, 0x8a,
                   0xc6, 0x81, 0x9c, 0x95, 0x0,  0x0,  0x9,  0x7,  0x5b, 0x7d, 0x81, 0xfb, 0x7d, 0x99, 0xe8, 0x85,
                   0x1,  0x0,  0x14, 0x9c, 0xc6, 0xc6, 0x8e, 0xc2, 0xec, 0x54, 0xbd, 0xe4, 0xaf, 0x65, 0x9b, 0x3,
                   0x91, 0xe1, 0x5c, 0x3a, 0x1a, 0x83, 0xdd, 0x1,  0x0,  0xa,  0x44, 0xae, 0xaf, 0xd8, 0xe0, 0x17,
                   0xc1, 0xaa, 0xd6, 0xe7, 0x2,  0x0,  0x7,  0xcf, 0xc1, 0xe0, 0x77, 0x27, 0xf8, 0xf6, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x2f, 0x1a, 0x12, 0x3a, 0x6b, 0x8c, 0x13, 0xb8, 0xed, 0x82, 0xd6, 0x2d, 0xcc, 0x90,
                                     0x6a, 0xb3, 0xe7, 0xf4, 0xf2, 0x74, 0x70, 0x40, 0x1e, 0x5a, 0x78, 0x5,  0x58};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x54, 0xd2, 0x80, 0x94, 0xe6, 0x90, 0x93, 0x32,
                                     0x26, 0x2b, 0x4e, 0x8a, 0xc6, 0x81, 0x9c, 0x95};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7, 0x5b, 0x7d, 0x81, 0xfb, 0x7d, 0x99, 0xe8, 0x85};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9c, 0xc6, 0xc6, 0x8e, 0xc2, 0xec, 0x54, 0xbd, 0xe4, 0xaf,
                                     0x65, 0x9b, 0x3,  0x91, 0xe1, 0x5c, 0x3a, 0x1a, 0x83, 0xdd};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x44, 0xae, 0xaf, 0xd8, 0xe0, 0x17, 0xc1, 0xaa, 0xd6, 0xe7};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xcf, 0xc1, 0xe0, 0x77, 0x27, 0xf8, 0xf6};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30334, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26291 [("\SI\235&\DLEy\150\n\207\212>H\132",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("@\181\178*D\211",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("5\138\164\236\175\v\154\215\DLE\DC1\250Z\168N\145\228\235C\186\rrf\247\243",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("o\235s\DC1p\179\196\&3\216n\ENQ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x43, 0x66, 0xb3, 0x0,  0xc,  0xf,  0xeb, 0x26, 0x10, 0x79, 0x96, 0xa,  0xcf,
                   0xd4, 0x3e, 0x48, 0x84, 0x2,  0x0,  0x6,  0x40, 0xb5, 0xb2, 0x2a, 0x44, 0xd3, 0x2,
                   0x0,  0x18, 0x35, 0x8a, 0xa4, 0xec, 0xaf, 0xb,  0x9a, 0xd7, 0x10, 0x11, 0xfa, 0x5a,
                   0xa8, 0x4e, 0x91, 0xe4, 0xeb, 0x43, 0xba, 0xd,  0x72, 0x66, 0xf7, 0xf3, 0x2,  0x0,
                   0xb,  0x6f, 0xeb, 0x73, 0x11, 0x70, 0xb3, 0xc4, 0x33, 0xd8, 0x6e, 0x5,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xf, 0xeb, 0x26, 0x10, 0x79, 0x96, 0xa, 0xcf, 0xd4, 0x3e, 0x48, 0x84};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x40, 0xb5, 0xb2, 0x2a, 0x44, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0x8a, 0xa4, 0xec, 0xaf, 0xb,  0x9a, 0xd7, 0x10, 0x11, 0xfa, 0x5a,
                                     0xa8, 0x4e, 0x91, 0xe4, 0xeb, 0x43, 0xba, 0xd,  0x72, 0x66, 0xf7, 0xf3};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6f, 0xeb, 0x73, 0x11, 0x70, 0xb3, 0xc4, 0x33, 0xd8, 0x6e, 0x5};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26291, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29015 [("\163\tU\254\239\150/*\157\226\191\&1a\DC3\227{",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\213\SUB\207\229\DC3\246\243\142",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x20, 0x71, 0x57, 0x0,  0x10, 0xa3, 0x9, 0x55, 0xfe, 0xef, 0x96, 0x2f, 0x2a, 0x9d, 0xe2, 0xbf,
                   0x31, 0x61, 0x13, 0xe3, 0x7b, 0x1,  0x0,  0x8, 0xd5, 0x1a, 0xcf, 0xe5, 0x13, 0xf6, 0xf3, 0x8e, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xa3, 0x9,  0x55, 0xfe, 0xef, 0x96, 0x2f, 0x2a,
                                     0x9d, 0xe2, 0xbf, 0x31, 0x61, 0x13, 0xe3, 0x7b};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd5, 0x1a, 0xcf, 0xe5, 0x13, 0xf6, 0xf3, 0x8e};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29015, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24249 [("\133\139\\\225\188\f;\\\232=\247\f\131i3BK7cp\150l\FSc",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\173$rH\250",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\169\145\164k\139\246",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\US\DEL\ffL]\EMM4V |1\RS\169\151\NAK\246",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\190\200Cvj\152\154\218\249x\STX\251}`\168\156\182>]`r\175",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\248\&3\182",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x62, 0x5e, 0xb9, 0x0,  0x18, 0x85, 0x8b, 0x5c, 0xe1, 0xbc, 0xc,  0x3b, 0x5c, 0xe8, 0x3d, 0xf7,
                   0xc,  0x83, 0x69, 0x33, 0x42, 0x4b, 0x37, 0x63, 0x70, 0x96, 0x6c, 0x1c, 0x63, 0x1,  0x0,  0x5,  0xad,
                   0x24, 0x72, 0x48, 0xfa, 0x2,  0x0,  0x6,  0xa9, 0x91, 0xa4, 0x6b, 0x8b, 0xf6, 0x0,  0x0,  0x12, 0x1f,
                   0x7f, 0xc,  0x66, 0x4c, 0x5d, 0x19, 0x4d, 0x34, 0x56, 0x20, 0x7c, 0x31, 0x1e, 0xa9, 0x97, 0x15, 0xf6,
                   0x2,  0x0,  0x16, 0xbe, 0xc8, 0x43, 0x76, 0x6a, 0x98, 0x9a, 0xda, 0xf9, 0x78, 0x2,  0xfb, 0x7d, 0x60,
                   0xa8, 0x9c, 0xb6, 0x3e, 0x5d, 0x60, 0x72, 0xaf, 0x1,  0x0,  0x3,  0xf8, 0x33, 0xb6, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x85, 0x8b, 0x5c, 0xe1, 0xbc, 0xc,  0x3b, 0x5c, 0xe8, 0x3d, 0xf7, 0xc,
                                     0x83, 0x69, 0x33, 0x42, 0x4b, 0x37, 0x63, 0x70, 0x96, 0x6c, 0x1c, 0x63};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xad, 0x24, 0x72, 0x48, 0xfa};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x91, 0xa4, 0x6b, 0x8b, 0xf6};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1f, 0x7f, 0xc,  0x66, 0x4c, 0x5d, 0x19, 0x4d, 0x34,
                                     0x56, 0x20, 0x7c, 0x31, 0x1e, 0xa9, 0x97, 0x15, 0xf6};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbe, 0xc8, 0x43, 0x76, 0x6a, 0x98, 0x9a, 0xda, 0xf9, 0x78, 0x2,
                                     0xfb, 0x7d, 0x60, 0xa8, 0x9c, 0xb6, 0x3e, 0x5d, 0x60, 0x72, 0xaf};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf8, 0x33, 0xb6};
  lwmqtt_string_t topic_filter_s5 = {3, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24249, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18033 [("\181\STX\205 B\134&\195T\EOT\226\245Is\192\233\ETBM\ENQ\150\240\161",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0x1b, 0x46, 0x71, 0x0,  0x16, 0xb5, 0x2,  0xcd, 0x20, 0x42, 0x86, 0x26, 0xc3, 0x54,
                   0x4,  0xe2, 0xf5, 0x49, 0x73, 0xc0, 0xe9, 0x17, 0x4d, 0x5,  0x96, 0xf0, 0xa1, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xb5, 0x2,  0xcd, 0x20, 0x42, 0x86, 0x26, 0xc3, 0x54, 0x4,  0xe2,
                                     0xf5, 0x49, 0x73, 0xc0, 0xe9, 0x17, 0x4d, 0x5,  0x96, 0xf0, 0xa1};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18033, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22392
// [("G\SO_\r\DLE\244.\250W\133;\154\229\255\200(\128({\RS\DEL\205\&3\233\NAK\158\197\191l",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\233\157F\ACK\128m\130\216\142\NUL\197\184\&8\243\248\SIvz\CAN\229w\US\EM\159\141",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\146\&0m\DC3J\242\217\STXV\251\177G\241m?\246\228",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\t\190\224d\180\148N\147{\128\156",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x60, 0x57, 0x78, 0x0,  0x1d, 0x47, 0xe,  0x5f, 0xd,  0x10, 0xf4, 0x2e, 0xfa, 0x57, 0x85, 0x3b,
                   0x9a, 0xe5, 0xff, 0xc8, 0x28, 0x80, 0x28, 0x7b, 0x1e, 0x7f, 0xcd, 0x33, 0xe9, 0x15, 0x9e, 0xc5, 0xbf,
                   0x6c, 0x2,  0x0,  0x19, 0xe9, 0x9d, 0x46, 0x6,  0x80, 0x6d, 0x82, 0xd8, 0x8e, 0x0,  0xc5, 0xb8, 0x38,
                   0xf3, 0xf8, 0xf,  0x76, 0x7a, 0x18, 0xe5, 0x77, 0x1f, 0x19, 0x9f, 0x8d, 0x0,  0x0,  0x11, 0x92, 0x30,
                   0x6d, 0x13, 0x4a, 0xf2, 0xd9, 0x2,  0x56, 0xfb, 0xb1, 0x47, 0xf1, 0x6d, 0x3f, 0xf6, 0xe4, 0x2,  0x0,
                   0xb,  0x9,  0xbe, 0xe0, 0x64, 0xb4, 0x94, 0x4e, 0x93, 0x7b, 0x80, 0x9c, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0xe,  0x5f, 0xd,  0x10, 0xf4, 0x2e, 0xfa, 0x57, 0x85,
                                     0x3b, 0x9a, 0xe5, 0xff, 0xc8, 0x28, 0x80, 0x28, 0x7b, 0x1e,
                                     0x7f, 0xcd, 0x33, 0xe9, 0x15, 0x9e, 0xc5, 0xbf, 0x6c};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe9, 0x9d, 0x46, 0x6,  0x80, 0x6d, 0x82, 0xd8, 0x8e, 0x0,  0xc5, 0xb8, 0x38,
                                     0xf3, 0xf8, 0xf,  0x76, 0x7a, 0x18, 0xe5, 0x77, 0x1f, 0x19, 0x9f, 0x8d};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x92, 0x30, 0x6d, 0x13, 0x4a, 0xf2, 0xd9, 0x2, 0x56,
                                     0xfb, 0xb1, 0x47, 0xf1, 0x6d, 0x3f, 0xf6, 0xe4};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9, 0xbe, 0xe0, 0x64, 0xb4, 0x94, 0x4e, 0x93, 0x7b, 0x80, 0x9c};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22392, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26543 [("\249\201\SUB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\219\159\230|\181\144-\SUB\144",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\220\152\146\130\197\251\SOH\226+",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\143\200\174\222\226\&4\142+",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\145\228A\244\158\b\173fY&\220q\DC4\161\\\174\199\&7\172#",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\138\DC1\164\194\ETB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("C\139\178\210\217U(S\133\a",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("MU:H5\202\246\247!\NUL\169",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x68, 0x67, 0xaf, 0x0,  0x3,  0xf9, 0xc9, 0x1a, 0x2,  0x0,  0x9,  0xdb, 0x9f, 0xe6, 0x7c,
                   0xb5, 0x90, 0x2d, 0x1a, 0x90, 0x1,  0x0,  0x9,  0xdc, 0x98, 0x92, 0x82, 0xc5, 0xfb, 0x1,  0xe2,
                   0x2b, 0x1,  0x0,  0x0,  0x1,  0x0,  0x8,  0x8f, 0xc8, 0xae, 0xde, 0xe2, 0x34, 0x8e, 0x2b, 0x1,
                   0x0,  0x14, 0x91, 0xe4, 0x41, 0xf4, 0x9e, 0x8,  0xad, 0x66, 0x59, 0x26, 0xdc, 0x71, 0x14, 0xa1,
                   0x5c, 0xae, 0xc7, 0x37, 0xac, 0x23, 0x2,  0x0,  0x5,  0x8a, 0x11, 0xa4, 0xc2, 0x17, 0x2,  0x0,
                   0xa,  0x43, 0x8b, 0xb2, 0xd2, 0xd9, 0x55, 0x28, 0x53, 0x85, 0x7,  0x1,  0x0,  0xb,  0x4d, 0x55,
                   0x3a, 0x48, 0x35, 0xca, 0xf6, 0xf7, 0x21, 0x0,  0xa9, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xf9, 0xc9, 0x1a};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdb, 0x9f, 0xe6, 0x7c, 0xb5, 0x90, 0x2d, 0x1a, 0x90};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdc, 0x98, 0x92, 0x82, 0xc5, 0xfb, 0x1, 0xe2, 0x2b};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8f, 0xc8, 0xae, 0xde, 0xe2, 0x34, 0x8e, 0x2b};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x91, 0xe4, 0x41, 0xf4, 0x9e, 0x8,  0xad, 0x66, 0x59, 0x26,
                                     0xdc, 0x71, 0x14, 0xa1, 0x5c, 0xae, 0xc7, 0x37, 0xac, 0x23};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8a, 0x11, 0xa4, 0xc2, 0x17};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x43, 0x8b, 0xb2, 0xd2, 0xd9, 0x55, 0x28, 0x53, 0x85, 0x7};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x4d, 0x55, 0x3a, 0x48, 0x35, 0xca, 0xf6, 0xf7, 0x21, 0x0, 0xa9};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26543, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14708 [("\NULK\203\169*aQ\217\USt\161",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("1\DLE\243[3\NUL\FS\CAN\220\179\247u\159Kf\236\149\FS\231\156*w\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x2a, 0x39, 0x74, 0x0,  0xb,  0x0,  0x4b, 0xcb, 0xa9, 0x2a, 0x61, 0x51, 0xd9, 0x1f,
                   0x74, 0xa1, 0x1,  0x0,  0x17, 0x31, 0x10, 0xf3, 0x5b, 0x33, 0x0,  0x1c, 0x18, 0xdc, 0xb3,
                   0xf7, 0x75, 0x9f, 0x4b, 0x66, 0xec, 0x95, 0x1c, 0xe7, 0x9c, 0x2a, 0x77, 0xaa, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x0, 0x4b, 0xcb, 0xa9, 0x2a, 0x61, 0x51, 0xd9, 0x1f, 0x74, 0xa1};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x31, 0x10, 0xf3, 0x5b, 0x33, 0x0,  0x1c, 0x18, 0xdc, 0xb3, 0xf7, 0x75,
                                     0x9f, 0x4b, 0x66, 0xec, 0x95, 0x1c, 0xe7, 0x9c, 0x2a, 0x77, 0xaa};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14708, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24735 [("I\184\193",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("C\231x)\"5\EOT\146\158\NAK\181,",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\251\n(!k\205\193u\208<\205g.\223Q\US\187[\232\\\206\DLE\148\202",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),(")",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("_\204\209\225{\194\165\&4\222'\DLE\217\157Vu6G7\181\189\DC3)q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("_6\149\215\&3\ENQ\133\244<\b!",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0x5e, 0x60, 0x9f, 0x0,  0x3,  0x49, 0xb8, 0xc1, 0x2,  0x0,  0xc,  0x43, 0xe7, 0x78, 0x29,
                   0x22, 0x35, 0x4,  0x92, 0x9e, 0x15, 0xb5, 0x2c, 0x2,  0x0,  0x18, 0xfb, 0xa,  0x28, 0x21, 0x6b,
                   0xcd, 0xc1, 0x75, 0xd0, 0x3c, 0xcd, 0x67, 0x2e, 0xdf, 0x51, 0x1f, 0xbb, 0x5b, 0xe8, 0x5c, 0xce,
                   0x10, 0x94, 0xca, 0x1,  0x0,  0x1,  0x29, 0x0,  0x0,  0x17, 0x5f, 0xcc, 0xd1, 0xe1, 0x7b, 0xc2,
                   0xa5, 0x34, 0xde, 0x27, 0x10, 0xd9, 0x9d, 0x56, 0x75, 0x36, 0x47, 0x37, 0xb5, 0xbd, 0x13, 0x29,
                   0x71, 0x2,  0x0,  0xb,  0x5f, 0x36, 0x95, 0xd7, 0x33, 0x5,  0x85, 0xf4, 0x3c, 0x8,  0x21, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x49, 0xb8, 0xc1};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x43, 0xe7, 0x78, 0x29, 0x22, 0x35, 0x4, 0x92, 0x9e, 0x15, 0xb5, 0x2c};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfb, 0xa,  0x28, 0x21, 0x6b, 0xcd, 0xc1, 0x75, 0xd0, 0x3c, 0xcd, 0x67,
                                     0x2e, 0xdf, 0x51, 0x1f, 0xbb, 0x5b, 0xe8, 0x5c, 0xce, 0x10, 0x94, 0xca};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x29};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5f, 0xcc, 0xd1, 0xe1, 0x7b, 0xc2, 0xa5, 0x34, 0xde, 0x27, 0x10, 0xd9,
                                     0x9d, 0x56, 0x75, 0x36, 0x47, 0x37, 0xb5, 0xbd, 0x13, 0x29, 0x71};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5f, 0x36, 0x95, 0xd7, 0x33, 0x5, 0x85, 0xf4, 0x3c, 0x8, 0x21};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24735, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31752 [("_\219L\240F\160\245'\201\213\145D\221\235\219\250\233\&8\211\&6\154\154\235",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\205g~\180H*@/\252|\213\208\227\DC1\184-\238\128\169\237E",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\186\144",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("p\172",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("E\ETB\215\130\164\130",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\v\203N\139\228\165wx\175\155\n\231\195\176",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0x58, 0x7c, 0x8,  0x0,  0x17, 0x5f, 0xdb, 0x4c, 0xf0, 0x46, 0xa0, 0xf5, 0x27, 0xc9,
                   0xd5, 0x91, 0x44, 0xdd, 0xeb, 0xdb, 0xfa, 0xe9, 0x38, 0xd3, 0x36, 0x9a, 0x9a, 0xeb, 0x1,
                   0x0,  0x15, 0xcd, 0x67, 0x7e, 0xb4, 0x48, 0x2a, 0x40, 0x2f, 0xfc, 0x7c, 0xd5, 0xd0, 0xe3,
                   0x11, 0xb8, 0x2d, 0xee, 0x80, 0xa9, 0xed, 0x45, 0x1,  0x0,  0x2,  0xba, 0x90, 0x0,  0x0,
                   0x2,  0x70, 0xac, 0x1,  0x0,  0x6,  0x45, 0x17, 0xd7, 0x82, 0xa4, 0x82, 0x0,  0x0,  0xe,
                   0xb,  0xcb, 0x4e, 0x8b, 0xe4, 0xa5, 0x77, 0x78, 0xaf, 0x9b, 0xa,  0xe7, 0xc3, 0xb0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x5f, 0xdb, 0x4c, 0xf0, 0x46, 0xa0, 0xf5, 0x27, 0xc9, 0xd5, 0x91, 0x44,
                                     0xdd, 0xeb, 0xdb, 0xfa, 0xe9, 0x38, 0xd3, 0x36, 0x9a, 0x9a, 0xeb};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcd, 0x67, 0x7e, 0xb4, 0x48, 0x2a, 0x40, 0x2f, 0xfc, 0x7c, 0xd5,
                                     0xd0, 0xe3, 0x11, 0xb8, 0x2d, 0xee, 0x80, 0xa9, 0xed, 0x45};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xba, 0x90};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x70, 0xac};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x45, 0x17, 0xd7, 0x82, 0xa4, 0x82};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb, 0xcb, 0x4e, 0x8b, 0xe4, 0xa5, 0x77, 0x78, 0xaf, 0x9b, 0xa, 0xe7, 0xc3, 0xb0};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 31752, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12709 [("\132\197\232\176\128>\167\NAKa",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\178\242Do\205\129\176\135\169\245\194\STXX|\196\207\227\196\169\\\DLE\175\138\200\v\186\135yL\172",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("@f\171\247\189\153\191\162\&66\248\191:\167\234nw\220R\195\&3\SOH72\235\a\EOTx",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\241\135Z\182\210O\202\248\&6\NAK\215\DC2\217\EOT\171\128\173.\183\138qM]l\198_",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("{\ESCA\ETX\233J}\147\DC3",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\242L\245\r\189\187\206",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("{4\GS\t\194H\206\FS\176",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\203\247\\`[\193",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\153\164\176\228\218\162\198\231\SI\135_\\P\249\176\169\200S",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("8\193\250\178\180`\161\204\240\245\129/\NAK\137\242\233f\NUL\179\171\US\157\197tX'",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\193\229\147&\176\150P\DC1}\195\SI\203!V\185\SO-YK\193\131K\195\149\211",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0xe4, 0x1,  0x31, 0xa5, 0x0,  0x9,  0x84, 0xc5, 0xe8, 0xb0, 0x80, 0x3e, 0xa7, 0x15, 0x61, 0x1,
                   0x0,  0x1e, 0xb2, 0xf2, 0x44, 0x6f, 0xcd, 0x81, 0xb0, 0x87, 0xa9, 0xf5, 0xc2, 0x2,  0x58, 0x7c, 0xc4,
                   0xcf, 0xe3, 0xc4, 0xa9, 0x5c, 0x10, 0xaf, 0x8a, 0xc8, 0xb,  0xba, 0x87, 0x79, 0x4c, 0xac, 0x0,  0x0,
                   0x1c, 0x40, 0x66, 0xab, 0xf7, 0xbd, 0x99, 0xbf, 0xa2, 0x36, 0x36, 0xf8, 0xbf, 0x3a, 0xa7, 0xea, 0x6e,
                   0x77, 0xdc, 0x52, 0xc3, 0x33, 0x1,  0x37, 0x32, 0xeb, 0x7,  0x4,  0x78, 0x1,  0x0,  0x1a, 0xf1, 0x87,
                   0x5a, 0xb6, 0xd2, 0x4f, 0xca, 0xf8, 0x36, 0x15, 0xd7, 0x12, 0xd9, 0x4,  0xab, 0x80, 0xad, 0x2e, 0xb7,
                   0x8a, 0x71, 0x4d, 0x5d, 0x6c, 0xc6, 0x5f, 0x1,  0x0,  0x9,  0x7b, 0x1b, 0x41, 0x3,  0xe9, 0x4a, 0x7d,
                   0x93, 0x13, 0x2,  0x0,  0x7,  0xf2, 0x4c, 0xf5, 0xd,  0xbd, 0xbb, 0xce, 0x1,  0x0,  0x9,  0x7b, 0x34,
                   0x1d, 0x9,  0xc2, 0x48, 0xce, 0x1c, 0xb0, 0x1,  0x0,  0x6,  0xcb, 0xf7, 0x5c, 0x60, 0x5b, 0xc1, 0x2,
                   0x0,  0x12, 0x99, 0xa4, 0xb0, 0xe4, 0xda, 0xa2, 0xc6, 0xe7, 0xf,  0x87, 0x5f, 0x5c, 0x50, 0xf9, 0xb0,
                   0xa9, 0xc8, 0x53, 0x2,  0x0,  0x1a, 0x38, 0xc1, 0xfa, 0xb2, 0xb4, 0x60, 0xa1, 0xcc, 0xf0, 0xf5, 0x81,
                   0x2f, 0x15, 0x89, 0xf2, 0xe9, 0x66, 0x0,  0xb3, 0xab, 0x1f, 0x9d, 0xc5, 0x74, 0x58, 0x27, 0x2,  0x0,
                   0x19, 0xc1, 0xe5, 0x93, 0x26, 0xb0, 0x96, 0x50, 0x11, 0x7d, 0xc3, 0xf,  0xcb, 0x21, 0x56, 0xb9, 0xe,
                   0x2d, 0x59, 0x4b, 0xc1, 0x83, 0x4b, 0xc3, 0x95, 0xd3, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x84, 0xc5, 0xe8, 0xb0, 0x80, 0x3e, 0xa7, 0x15, 0x61};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb2, 0xf2, 0x44, 0x6f, 0xcd, 0x81, 0xb0, 0x87, 0xa9, 0xf5,
                                     0xc2, 0x2,  0x58, 0x7c, 0xc4, 0xcf, 0xe3, 0xc4, 0xa9, 0x5c,
                                     0x10, 0xaf, 0x8a, 0xc8, 0xb,  0xba, 0x87, 0x79, 0x4c, 0xac};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x40, 0x66, 0xab, 0xf7, 0xbd, 0x99, 0xbf, 0xa2, 0x36, 0x36,
                                     0xf8, 0xbf, 0x3a, 0xa7, 0xea, 0x6e, 0x77, 0xdc, 0x52, 0xc3,
                                     0x33, 0x1,  0x37, 0x32, 0xeb, 0x7,  0x4,  0x78};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf1, 0x87, 0x5a, 0xb6, 0xd2, 0x4f, 0xca, 0xf8, 0x36, 0x15, 0xd7, 0x12, 0xd9,
                                     0x4,  0xab, 0x80, 0xad, 0x2e, 0xb7, 0x8a, 0x71, 0x4d, 0x5d, 0x6c, 0xc6, 0x5f};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7b, 0x1b, 0x41, 0x3, 0xe9, 0x4a, 0x7d, 0x93, 0x13};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf2, 0x4c, 0xf5, 0xd, 0xbd, 0xbb, 0xce};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x7b, 0x34, 0x1d, 0x9, 0xc2, 0x48, 0xce, 0x1c, 0xb0};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xcb, 0xf7, 0x5c, 0x60, 0x5b, 0xc1};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x99, 0xa4, 0xb0, 0xe4, 0xda, 0xa2, 0xc6, 0xe7, 0xf,
                                     0x87, 0x5f, 0x5c, 0x50, 0xf9, 0xb0, 0xa9, 0xc8, 0x53};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x38, 0xc1, 0xfa, 0xb2, 0xb4, 0x60, 0xa1, 0xcc, 0xf0, 0xf5, 0x81, 0x2f, 0x15,
                                     0x89, 0xf2, 0xe9, 0x66, 0x0,  0xb3, 0xab, 0x1f, 0x9d, 0xc5, 0x74, 0x58, 0x27};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xc1, 0xe5, 0x93, 0x26, 0xb0, 0x96, 0x50, 0x11, 0x7d, 0xc3, 0xf,  0xcb, 0x21,
                                      0x56, 0xb9, 0xe,  0x2d, 0x59, 0x4b, 0xc1, 0x83, 0x4b, 0xc3, 0x95, 0xd3};
  lwmqtt_string_t topic_filter_s10 = {25, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12709, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14473 [("\173\230\ESC\133\246\196\156\135\200q|\DC2\188\236\FS\153\183\SO\142b",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\CAN\192\&41\164\131Z8\251)\173>\128\193\211\222\167G\162\167\149}\129\174",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("g\226\&6wT\129\254\179\NUL\228\163\218\238\131\130\198\131\172\r\"\223\195\172\130",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("u\138\167\DEL\SI\167\172\136\244\217\249\185\239B\228y",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\193\254#\159\210\150\130\"\250",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\236\179\227\206P\141i\DC3\EM\237\243\232\"cG\151\199\190I",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0x84, 0x1,  0x38, 0x89, 0x0,  0x14, 0xad, 0xe6, 0x1b, 0x85, 0xf6, 0xc4, 0x9c, 0x87, 0xc8, 0x71,
                   0x7c, 0x12, 0xbc, 0xec, 0x1c, 0x99, 0xb7, 0xe,  0x8e, 0x62, 0x0,  0x0,  0x18, 0x18, 0xc0, 0x34, 0x31,
                   0xa4, 0x83, 0x5a, 0x38, 0xfb, 0x29, 0xad, 0x3e, 0x80, 0xc1, 0xd3, 0xde, 0xa7, 0x47, 0xa2, 0xa7, 0x95,
                   0x7d, 0x81, 0xae, 0x2,  0x0,  0x18, 0x67, 0xe2, 0x36, 0x77, 0x54, 0x81, 0xfe, 0xb3, 0x0,  0xe4, 0xa3,
                   0xda, 0xee, 0x83, 0x82, 0xc6, 0x83, 0xac, 0xd,  0x22, 0xdf, 0xc3, 0xac, 0x82, 0x1,  0x0,  0x10, 0x75,
                   0x8a, 0xa7, 0x7f, 0xf,  0xa7, 0xac, 0x88, 0xf4, 0xd9, 0xf9, 0xb9, 0xef, 0x42, 0xe4, 0x79, 0x0,  0x0,
                   0x9,  0xc1, 0xfe, 0x23, 0x9f, 0xd2, 0x96, 0x82, 0x22, 0xfa, 0x0,  0x0,  0x13, 0xec, 0xb3, 0xe3, 0xce,
                   0x50, 0x8d, 0x69, 0x13, 0x19, 0xed, 0xf3, 0xe8, 0x22, 0x63, 0x47, 0x97, 0xc7, 0xbe, 0x49, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xad, 0xe6, 0x1b, 0x85, 0xf6, 0xc4, 0x9c, 0x87, 0xc8, 0x71,
                                     0x7c, 0x12, 0xbc, 0xec, 0x1c, 0x99, 0xb7, 0xe,  0x8e, 0x62};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x18, 0xc0, 0x34, 0x31, 0xa4, 0x83, 0x5a, 0x38, 0xfb, 0x29, 0xad, 0x3e,
                                     0x80, 0xc1, 0xd3, 0xde, 0xa7, 0x47, 0xa2, 0xa7, 0x95, 0x7d, 0x81, 0xae};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x67, 0xe2, 0x36, 0x77, 0x54, 0x81, 0xfe, 0xb3, 0x0,  0xe4, 0xa3, 0xda,
                                     0xee, 0x83, 0x82, 0xc6, 0x83, 0xac, 0xd,  0x22, 0xdf, 0xc3, 0xac, 0x82};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x75, 0x8a, 0xa7, 0x7f, 0xf,  0xa7, 0xac, 0x88,
                                     0xf4, 0xd9, 0xf9, 0xb9, 0xef, 0x42, 0xe4, 0x79};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc1, 0xfe, 0x23, 0x9f, 0xd2, 0x96, 0x82, 0x22, 0xfa};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xec, 0xb3, 0xe3, 0xce, 0x50, 0x8d, 0x69, 0x13, 0x19, 0xed,
                                     0xf3, 0xe8, 0x22, 0x63, 0x47, 0x97, 0xc7, 0xbe, 0x49};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14473, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3580 [("\244E\204\&6O\ACKRSi\250\193:i*L\v{\159\212\243!\DLE\200o\175\172\236d\232\RS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("N\248\172\a7\159\250\EM\227{\179\201O\161ZR\140\251\188\207\144\212\STX\173\150w",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\155W\251\fk<\195p\184\253\175A\162\210\ETB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("v\DLE\188\STXG!\142W\193\182\236H\NUL\fO$`\253e+\SO\214",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\163+\244m
// 1\138n\233\129sR\182\CAN\137\199(BB}\202\196m\231\208XEz\148",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("j\148\131KK\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Y\f\153\US\197\228\\\211\233\&9\CAN>\237\190\193\v\239\GSb",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("/\r\190",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("yL\254\155\&0U{\DLE\199\211\253\189\183F\149\222\US\218\186\b\175\DC2\252'\156",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\US&\190d\ETX~\239/\NAK\128\228\240io\227\DC1\SUB6\DC1\175 \153",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0xe5, 0x1,  0xd,  0xfc, 0x0,  0x1e, 0xf4, 0x45, 0xcc, 0x36, 0x4f, 0x6,  0x52, 0x53, 0x69, 0xfa,
                   0xc1, 0x3a, 0x69, 0x2a, 0x4c, 0xb,  0x7b, 0x9f, 0xd4, 0xf3, 0x21, 0x10, 0xc8, 0x6f, 0xaf, 0xac, 0xec,
                   0x64, 0xe8, 0x1e, 0x2,  0x0,  0x1a, 0x4e, 0xf8, 0xac, 0x7,  0x37, 0x9f, 0xfa, 0x19, 0xe3, 0x7b, 0xb3,
                   0xc9, 0x4f, 0xa1, 0x5a, 0x52, 0x8c, 0xfb, 0xbc, 0xcf, 0x90, 0xd4, 0x2,  0xad, 0x96, 0x77, 0x0,  0x0,
                   0xf,  0x9b, 0x57, 0xfb, 0xc,  0x6b, 0x3c, 0xc3, 0x70, 0xb8, 0xfd, 0xaf, 0x41, 0xa2, 0xd2, 0x17, 0x0,
                   0x0,  0x16, 0x76, 0x10, 0xbc, 0x2,  0x47, 0x21, 0x8e, 0x57, 0xc1, 0xb6, 0xec, 0x48, 0x0,  0xc,  0x4f,
                   0x24, 0x60, 0xfd, 0x65, 0x2b, 0xe,  0xd6, 0x1,  0x0,  0x1d, 0xa3, 0x2b, 0xf4, 0x6d, 0x20, 0x31, 0x8a,
                   0x6e, 0xe9, 0x81, 0x73, 0x52, 0xb6, 0x18, 0x89, 0xc7, 0x28, 0x42, 0x42, 0x7d, 0xca, 0xc4, 0x6d, 0xe7,
                   0xd0, 0x58, 0x45, 0x7a, 0x94, 0x1,  0x0,  0x6,  0x6a, 0x94, 0x83, 0x4b, 0x4b, 0x9b, 0x2,  0x0,  0x13,
                   0x59, 0xc,  0x99, 0x1f, 0xc5, 0xe4, 0x5c, 0xd3, 0xe9, 0x39, 0x18, 0x3e, 0xed, 0xbe, 0xc1, 0xb,  0xef,
                   0x1d, 0x62, 0x1,  0x0,  0x3,  0x2f, 0xd,  0xbe, 0x0,  0x0,  0x19, 0x79, 0x4c, 0xfe, 0x9b, 0x30, 0x55,
                   0x7b, 0x10, 0xc7, 0xd3, 0xfd, 0xbd, 0xb7, 0x46, 0x95, 0xde, 0x1f, 0xda, 0xba, 0x8,  0xaf, 0x12, 0xfc,
                   0x27, 0x9c, 0x2,  0x0,  0x16, 0x1f, 0x26, 0xbe, 0x64, 0x3,  0x7e, 0xef, 0x2f, 0x15, 0x80, 0xe4, 0xf0,
                   0x69, 0x6f, 0xe3, 0x11, 0x1a, 0x36, 0x11, 0xaf, 0x20, 0x99, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0x45, 0xcc, 0x36, 0x4f, 0x6,  0x52, 0x53, 0x69, 0xfa,
                                     0xc1, 0x3a, 0x69, 0x2a, 0x4c, 0xb,  0x7b, 0x9f, 0xd4, 0xf3,
                                     0x21, 0x10, 0xc8, 0x6f, 0xaf, 0xac, 0xec, 0x64, 0xe8, 0x1e};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4e, 0xf8, 0xac, 0x7,  0x37, 0x9f, 0xfa, 0x19, 0xe3, 0x7b, 0xb3, 0xc9, 0x4f,
                                     0xa1, 0x5a, 0x52, 0x8c, 0xfb, 0xbc, 0xcf, 0x90, 0xd4, 0x2,  0xad, 0x96, 0x77};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9b, 0x57, 0xfb, 0xc,  0x6b, 0x3c, 0xc3, 0x70,
                                     0xb8, 0xfd, 0xaf, 0x41, 0xa2, 0xd2, 0x17};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x76, 0x10, 0xbc, 0x2,  0x47, 0x21, 0x8e, 0x57, 0xc1, 0xb6, 0xec,
                                     0x48, 0x0,  0xc,  0x4f, 0x24, 0x60, 0xfd, 0x65, 0x2b, 0xe,  0xd6};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa3, 0x2b, 0xf4, 0x6d, 0x20, 0x31, 0x8a, 0x6e, 0xe9, 0x81,
                                     0x73, 0x52, 0xb6, 0x18, 0x89, 0xc7, 0x28, 0x42, 0x42, 0x7d,
                                     0xca, 0xc4, 0x6d, 0xe7, 0xd0, 0x58, 0x45, 0x7a, 0x94};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6a, 0x94, 0x83, 0x4b, 0x4b, 0x9b};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x59, 0xc,  0x99, 0x1f, 0xc5, 0xe4, 0x5c, 0xd3, 0xe9, 0x39,
                                     0x18, 0x3e, 0xed, 0xbe, 0xc1, 0xb,  0xef, 0x1d, 0x62};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2f, 0xd, 0xbe};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x79, 0x4c, 0xfe, 0x9b, 0x30, 0x55, 0x7b, 0x10, 0xc7, 0xd3, 0xfd, 0xbd, 0xb7,
                                     0x46, 0x95, 0xde, 0x1f, 0xda, 0xba, 0x8,  0xaf, 0x12, 0xfc, 0x27, 0x9c};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x1f, 0x26, 0xbe, 0x64, 0x3,  0x7e, 0xef, 0x2f, 0x15, 0x80, 0xe4,
                                     0xf0, 0x69, 0x6f, 0xe3, 0x11, 0x1a, 0x36, 0x11, 0xaf, 0x20, 0x99};
  lwmqtt_string_t topic_filter_s9 = {22, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3580, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8671 [("\137/\167\132\169\250\&8Z\230",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("vQ\229\222\160\&5\214\180",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\227~\DC4\240\205\167\163\150\&9\US\197\SIO\186>\237\168\235[",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\197\199!H\185\STX\187\SI4oM\179\237 \167(vk\193\195\&4\208\205*^\161\153\178\RS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\166\188\156I\185\220\&3S#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),(".\204\SYNt\DEL\ETXV\"6\RS\192\193\199\228\130\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("f\186\US\183;a^\179\132Wd\CAN\219",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),(",\166\140N",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\175\142\248\&0\231s\212\169^s\151\213\133[J\153L=\USc3",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("J\227\239\US\219\166\EM\235K\b8G@\158\156l\216xH\131\&5{\174\253",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0xb8, 0x1,  0x21, 0xdf, 0x0,  0x9,  0x89, 0x2f, 0xa7, 0x84, 0xa9, 0xfa, 0x38, 0x5a, 0xe6, 0x1,
                   0x0,  0x8,  0x76, 0x51, 0xe5, 0xde, 0xa0, 0x35, 0xd6, 0xb4, 0x1,  0x0,  0x13, 0xe3, 0x7e, 0x14, 0xf0,
                   0xcd, 0xa7, 0xa3, 0x96, 0x39, 0x1f, 0xc5, 0xf,  0x4f, 0xba, 0x3e, 0xed, 0xa8, 0xeb, 0x5b, 0x0,  0x0,
                   0x1d, 0xc5, 0xc7, 0x21, 0x48, 0xb9, 0x2,  0xbb, 0xf,  0x34, 0x6f, 0x4d, 0xb3, 0xed, 0x20, 0xa7, 0x28,
                   0x76, 0x6b, 0xc1, 0xc3, 0x34, 0xd0, 0xcd, 0x2a, 0x5e, 0xa1, 0x99, 0xb2, 0x1e, 0x1,  0x0,  0x9,  0xa6,
                   0xbc, 0x9c, 0x49, 0xb9, 0xdc, 0x33, 0x53, 0x23, 0x2,  0x0,  0x10, 0x2e, 0xcc, 0x16, 0x74, 0x7f, 0x3,
                   0x56, 0x22, 0x36, 0x1e, 0xc0, 0xc1, 0xc7, 0xe4, 0x82, 0xa0, 0x1,  0x0,  0xd,  0x66, 0xba, 0x1f, 0xb7,
                   0x3b, 0x61, 0x5e, 0xb3, 0x84, 0x57, 0x64, 0x18, 0xdb, 0x2,  0x0,  0x4,  0x2c, 0xa6, 0x8c, 0x4e, 0x2,
                   0x0,  0x15, 0xaf, 0x8e, 0xf8, 0x30, 0xe7, 0x73, 0xd4, 0xa9, 0x5e, 0x73, 0x97, 0xd5, 0x85, 0x5b, 0x4a,
                   0x99, 0x4c, 0x3d, 0x1f, 0x63, 0x33, 0x1,  0x0,  0x18, 0x4a, 0xe3, 0xef, 0x1f, 0xdb, 0xa6, 0x19, 0xeb,
                   0x4b, 0x8,  0x38, 0x47, 0x40, 0x9e, 0x9c, 0x6c, 0xd8, 0x78, 0x48, 0x83, 0x35, 0x7b, 0xae, 0xfd, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x89, 0x2f, 0xa7, 0x84, 0xa9, 0xfa, 0x38, 0x5a, 0xe6};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x76, 0x51, 0xe5, 0xde, 0xa0, 0x35, 0xd6, 0xb4};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe3, 0x7e, 0x14, 0xf0, 0xcd, 0xa7, 0xa3, 0x96, 0x39, 0x1f,
                                     0xc5, 0xf,  0x4f, 0xba, 0x3e, 0xed, 0xa8, 0xeb, 0x5b};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc5, 0xc7, 0x21, 0x48, 0xb9, 0x2,  0xbb, 0xf,  0x34, 0x6f,
                                     0x4d, 0xb3, 0xed, 0x20, 0xa7, 0x28, 0x76, 0x6b, 0xc1, 0xc3,
                                     0x34, 0xd0, 0xcd, 0x2a, 0x5e, 0xa1, 0x99, 0xb2, 0x1e};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa6, 0xbc, 0x9c, 0x49, 0xb9, 0xdc, 0x33, 0x53, 0x23};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2e, 0xcc, 0x16, 0x74, 0x7f, 0x3,  0x56, 0x22,
                                     0x36, 0x1e, 0xc0, 0xc1, 0xc7, 0xe4, 0x82, 0xa0};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x66, 0xba, 0x1f, 0xb7, 0x3b, 0x61, 0x5e, 0xb3, 0x84, 0x57, 0x64, 0x18, 0xdb};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2c, 0xa6, 0x8c, 0x4e};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xaf, 0x8e, 0xf8, 0x30, 0xe7, 0x73, 0xd4, 0xa9, 0x5e, 0x73, 0x97,
                                     0xd5, 0x85, 0x5b, 0x4a, 0x99, 0x4c, 0x3d, 0x1f, 0x63, 0x33};
  lwmqtt_string_t topic_filter_s8 = {21, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x4a, 0xe3, 0xef, 0x1f, 0xdb, 0xa6, 0x19, 0xeb, 0x4b, 0x8,  0x38, 0x47,
                                     0x40, 0x9e, 0x9c, 0x6c, 0xd8, 0x78, 0x48, 0x83, 0x35, 0x7b, 0xae, 0xfd};
  lwmqtt_string_t topic_filter_s9 = {24, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8671, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12528 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\148\&2\192\239\ETBl1G.]3f\EOT\158\156\169i\146#uO\217",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\225L\215\SOHGKI\217p5\225\219\187\228,p\ENQ*\218I\194\153q",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("S\231ewx\206\160\202P",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\171Kky\198c\184w\165e^\140n\236\SI\DEL\157d;\186d\234\NUL]\161",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\183",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),(";\246\134\170\224\207z\RSCq",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("J\FS\206NB\154\253\b\US\197\172*=\232CO\212\210\181\202\&0,&>\135\&4\224\226\170\203",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x92, 0x1,  0x30, 0xf0, 0x0,  0x0,  0x2,  0x0,  0x16, 0x94, 0x32, 0xc0, 0xef, 0x17, 0x6c, 0x31,
                   0x47, 0x2e, 0x5d, 0x33, 0x66, 0x4,  0x9e, 0x9c, 0xa9, 0x69, 0x92, 0x23, 0x75, 0x4f, 0xd9, 0x0,  0x0,
                   0x17, 0xe1, 0x4c, 0xd7, 0x1,  0x47, 0x4b, 0x49, 0xd9, 0x70, 0x35, 0xe1, 0xdb, 0xbb, 0xe4, 0x2c, 0x70,
                   0x5,  0x2a, 0xda, 0x49, 0xc2, 0x99, 0x71, 0x1,  0x0,  0x9,  0x53, 0xe7, 0x65, 0x77, 0x78, 0xce, 0xa0,
                   0xca, 0x50, 0x0,  0x0,  0x19, 0xab, 0x4b, 0x6b, 0x79, 0xc6, 0x63, 0xb8, 0x77, 0xa5, 0x65, 0x5e, 0x8c,
                   0x6e, 0xec, 0xf,  0x7f, 0x9d, 0x64, 0x3b, 0xba, 0x64, 0xea, 0x0,  0x5d, 0xa1, 0x0,  0x0,  0x1,  0xb7,
                   0x1,  0x0,  0xa,  0x3b, 0xf6, 0x86, 0xaa, 0xe0, 0xcf, 0x7a, 0x1e, 0x43, 0x71, 0x1,  0x0,  0x1e, 0x4a,
                   0x1c, 0xce, 0x4e, 0x42, 0x9a, 0xfd, 0x8,  0x1f, 0xc5, 0xac, 0x2a, 0x3d, 0xe8, 0x43, 0x4f, 0xd4, 0xd2,
                   0xb5, 0xca, 0x30, 0x2c, 0x26, 0x3e, 0x87, 0x34, 0xe0, 0xe2, 0xaa, 0xcb, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x94, 0x32, 0xc0, 0xef, 0x17, 0x6c, 0x31, 0x47, 0x2e, 0x5d, 0x33,
                                     0x66, 0x4,  0x9e, 0x9c, 0xa9, 0x69, 0x92, 0x23, 0x75, 0x4f, 0xd9};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe1, 0x4c, 0xd7, 0x1,  0x47, 0x4b, 0x49, 0xd9, 0x70, 0x35, 0xe1, 0xdb,
                                     0xbb, 0xe4, 0x2c, 0x70, 0x5,  0x2a, 0xda, 0x49, 0xc2, 0x99, 0x71};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x53, 0xe7, 0x65, 0x77, 0x78, 0xce, 0xa0, 0xca, 0x50};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xab, 0x4b, 0x6b, 0x79, 0xc6, 0x63, 0xb8, 0x77, 0xa5, 0x65, 0x5e, 0x8c, 0x6e,
                                     0xec, 0xf,  0x7f, 0x9d, 0x64, 0x3b, 0xba, 0x64, 0xea, 0x0,  0x5d, 0xa1};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb7};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3b, 0xf6, 0x86, 0xaa, 0xe0, 0xcf, 0x7a, 0x1e, 0x43, 0x71};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x4a, 0x1c, 0xce, 0x4e, 0x42, 0x9a, 0xfd, 0x8,  0x1f, 0xc5,
                                     0xac, 0x2a, 0x3d, 0xe8, 0x43, 0x4f, 0xd4, 0xd2, 0xb5, 0xca,
                                     0x30, 0x2c, 0x26, 0x3e, 0x87, 0x34, 0xe0, 0xe2, 0xaa, 0xcb};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12528, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9386 [("\209\EM\NUL~%q\250\200\SYNf]\226\199+9\165'\162\178V\208\DLE",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\n\ETB\130\245\135\213\245\138\&6E\221M\DC2]\175\198\214CL8\139",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("(pn\242\166\175uq\214\245\142\vZR\209",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0x45, 0x24, 0xaa, 0x0,  0x16, 0xd1, 0x19, 0x0,  0x7e, 0x25, 0x71, 0xfa, 0xc8, 0x16,
                   0x66, 0x5d, 0xe2, 0xc7, 0x2b, 0x39, 0xa5, 0x27, 0xa2, 0xb2, 0x56, 0xd0, 0x10, 0x1,  0x0,
                   0x15, 0xa,  0x17, 0x82, 0xf5, 0x87, 0xd5, 0xf5, 0x8a, 0x36, 0x45, 0xdd, 0x4d, 0x12, 0x5d,
                   0xaf, 0xc6, 0xd6, 0x43, 0x4c, 0x38, 0x8b, 0x0,  0x0,  0xf,  0x28, 0x70, 0x6e, 0xf2, 0xa6,
                   0xaf, 0x75, 0x71, 0xd6, 0xf5, 0x8e, 0xb,  0x5a, 0x52, 0xd1, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xd1, 0x19, 0x0,  0x7e, 0x25, 0x71, 0xfa, 0xc8, 0x16, 0x66, 0x5d,
                                     0xe2, 0xc7, 0x2b, 0x39, 0xa5, 0x27, 0xa2, 0xb2, 0x56, 0xd0, 0x10};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa,  0x17, 0x82, 0xf5, 0x87, 0xd5, 0xf5, 0x8a, 0x36, 0x45, 0xdd,
                                     0x4d, 0x12, 0x5d, 0xaf, 0xc6, 0xd6, 0x43, 0x4c, 0x38, 0x8b};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x28, 0x70, 0x6e, 0xf2, 0xa6, 0xaf, 0x75, 0x71,
                                     0xd6, 0xf5, 0x8e, 0xb,  0x5a, 0x52, 0xd1};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9386, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17533 [("(\v5\187IR\198\&8\215Mh\DC1\234\194",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("_E",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\166GM",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\216\209{\247V0\206\253\155\DC4\CAN",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),(",\170\200\239\ETX\218}\155\195\194\177faHsp\134\SI",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\140\140\rH\207f*P<\249\191k\ETB\229\141\224Y\138\SI\SYN\251;\DC12M",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("j\234\196n\SUB\146\132\168?\155F\190)\137\235.\233\224\135\138\DC1\a#\GS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("83\213v",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0x7f, 0x44, 0x7d, 0x0,  0xe,  0x28, 0xb,  0x35, 0xbb, 0x49, 0x52, 0xc6, 0x38, 0xd7, 0x4d, 0x68,
                   0x11, 0xea, 0xc2, 0x2,  0x0,  0x2,  0x5f, 0x45, 0x1,  0x0,  0x3,  0xa6, 0x47, 0x4d, 0x1,  0x0,  0xb,
                   0xd8, 0xd1, 0x7b, 0xf7, 0x56, 0x30, 0xce, 0xfd, 0x9b, 0x14, 0x18, 0x2,  0x0,  0x12, 0x2c, 0xaa, 0xc8,
                   0xef, 0x3,  0xda, 0x7d, 0x9b, 0xc3, 0xc2, 0xb1, 0x66, 0x61, 0x48, 0x73, 0x70, 0x86, 0xf,  0x0,  0x0,
                   0x19, 0x8c, 0x8c, 0xd,  0x48, 0xcf, 0x66, 0x2a, 0x50, 0x3c, 0xf9, 0xbf, 0x6b, 0x17, 0xe5, 0x8d, 0xe0,
                   0x59, 0x8a, 0xf,  0x16, 0xfb, 0x3b, 0x11, 0x32, 0x4d, 0x2,  0x0,  0x18, 0x6a, 0xea, 0xc4, 0x6e, 0x1a,
                   0x92, 0x84, 0xa8, 0x3f, 0x9b, 0x46, 0xbe, 0x29, 0x89, 0xeb, 0x2e, 0xe9, 0xe0, 0x87, 0x8a, 0x11, 0x7,
                   0x23, 0x1d, 0x1,  0x0,  0x4,  0x38, 0x33, 0xd5, 0x76, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x28, 0xb, 0x35, 0xbb, 0x49, 0x52, 0xc6, 0x38, 0xd7, 0x4d, 0x68, 0x11, 0xea, 0xc2};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0x45};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa6, 0x47, 0x4d};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd8, 0xd1, 0x7b, 0xf7, 0x56, 0x30, 0xce, 0xfd, 0x9b, 0x14, 0x18};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2c, 0xaa, 0xc8, 0xef, 0x3,  0xda, 0x7d, 0x9b, 0xc3,
                                     0xc2, 0xb1, 0x66, 0x61, 0x48, 0x73, 0x70, 0x86, 0xf};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8c, 0x8c, 0xd,  0x48, 0xcf, 0x66, 0x2a, 0x50, 0x3c, 0xf9, 0xbf, 0x6b, 0x17,
                                     0xe5, 0x8d, 0xe0, 0x59, 0x8a, 0xf,  0x16, 0xfb, 0x3b, 0x11, 0x32, 0x4d};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6a, 0xea, 0xc4, 0x6e, 0x1a, 0x92, 0x84, 0xa8, 0x3f, 0x9b, 0x46, 0xbe,
                                     0x29, 0x89, 0xeb, 0x2e, 0xe9, 0xe0, 0x87, 0x8a, 0x11, 0x7,  0x23, 0x1d};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x38, 0x33, 0xd5, 0x76};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17533, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1875 [("\131\239*\255VM\230[\170\a\ACK|\132\249\176v\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0x16, 0x7,  0x53, 0x0, 0x11, 0x83, 0xef, 0x2a, 0xff, 0x56, 0x4d,
                   0xe6, 0x5b, 0xaa, 0x7,  0x6, 0x7c, 0x84, 0xf9, 0xb0, 0x76, 0xd4, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x83, 0xef, 0x2a, 0xff, 0x56, 0x4d, 0xe6, 0x5b, 0xaa,
                                     0x7,  0x6,  0x7c, 0x84, 0xf9, 0xb0, 0x76, 0xd4};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 1875, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14558 [("\253\195\NUL\169\SUB\205/\SYNc\168\233|a\172\161\187\236\149\159 \222\215$\195<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("E\201R^&\SUB,\148vp@\224",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\215\136.^@|s6\135?U\231\230Q{\238d\161\131\NUL\177M\\\DC1",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\136\133c\130\ACK\ETX",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),(")\171\146\187\241\153\239",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\141\248\DC2\161?,jC\203G\198\135\203\134=\157\192\221\249~\246",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\189M!|\178~\166\141rn\247w\234",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x83, 0x1,  0x38, 0xde, 0x0,  0x19, 0xfd, 0xc3, 0x0,  0xa9, 0x1a, 0xcd, 0x2f, 0x16, 0x63, 0xa8,
                   0xe9, 0x7c, 0x61, 0xac, 0xa1, 0xbb, 0xec, 0x95, 0x9f, 0x20, 0xde, 0xd7, 0x24, 0xc3, 0x3c, 0x1,  0x0,
                   0xc,  0x45, 0xc9, 0x52, 0x5e, 0x26, 0x1a, 0x2c, 0x94, 0x76, 0x70, 0x40, 0xe0, 0x1,  0x0,  0x18, 0xd7,
                   0x88, 0x2e, 0x5e, 0x40, 0x7c, 0x73, 0x36, 0x87, 0x3f, 0x55, 0xe7, 0xe6, 0x51, 0x7b, 0xee, 0x64, 0xa1,
                   0x83, 0x0,  0xb1, 0x4d, 0x5c, 0x11, 0x2,  0x0,  0x6,  0x88, 0x85, 0x63, 0x82, 0x6,  0x3,  0x0,  0x0,
                   0x7,  0x29, 0xab, 0x92, 0xbb, 0xf1, 0x99, 0xef, 0x0,  0x0,  0x15, 0x8d, 0xf8, 0x12, 0xa1, 0x3f, 0x2c,
                   0x6a, 0x43, 0xcb, 0x47, 0xc6, 0x87, 0xcb, 0x86, 0x3d, 0x9d, 0xc0, 0xdd, 0xf9, 0x7e, 0xf6, 0x1,  0x0,
                   0xd,  0xbd, 0x4d, 0x21, 0x7c, 0xb2, 0x7e, 0xa6, 0x8d, 0x72, 0x6e, 0xf7, 0x77, 0xea, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xfd, 0xc3, 0x0,  0xa9, 0x1a, 0xcd, 0x2f, 0x16, 0x63, 0xa8, 0xe9, 0x7c, 0x61,
                                     0xac, 0xa1, 0xbb, 0xec, 0x95, 0x9f, 0x20, 0xde, 0xd7, 0x24, 0xc3, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x45, 0xc9, 0x52, 0x5e, 0x26, 0x1a, 0x2c, 0x94, 0x76, 0x70, 0x40, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd7, 0x88, 0x2e, 0x5e, 0x40, 0x7c, 0x73, 0x36, 0x87, 0x3f, 0x55, 0xe7,
                                     0xe6, 0x51, 0x7b, 0xee, 0x64, 0xa1, 0x83, 0x0,  0xb1, 0x4d, 0x5c, 0x11};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x85, 0x63, 0x82, 0x6, 0x3};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x29, 0xab, 0x92, 0xbb, 0xf1, 0x99, 0xef};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8d, 0xf8, 0x12, 0xa1, 0x3f, 0x2c, 0x6a, 0x43, 0xcb, 0x47, 0xc6,
                                     0x87, 0xcb, 0x86, 0x3d, 0x9d, 0xc0, 0xdd, 0xf9, 0x7e, 0xf6};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbd, 0x4d, 0x21, 0x7c, 0xb2, 0x7e, 0xa6, 0x8d, 0x72, 0x6e, 0xf7, 0x77, 0xea};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14558, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14679 [("\207`\174\172K_\ENQ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),(";\232\&5\184JOL\164\ETX\139\154`\228+\DC23`\228",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x21, 0x39, 0x57, 0x0,  0x7,  0xcf, 0x60, 0xae, 0xac, 0x4b, 0x5f,
                   0x5,  0x2,  0x0,  0x12, 0x3b, 0xe8, 0x35, 0xb8, 0x4a, 0x4f, 0x4c, 0xa4,
                   0x3,  0x8b, 0x9a, 0x60, 0xe4, 0x2b, 0x12, 0x33, 0x60, 0xe4, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xcf, 0x60, 0xae, 0xac, 0x4b, 0x5f, 0x5};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3b, 0xe8, 0x35, 0xb8, 0x4a, 0x4f, 0x4c, 0xa4, 0x3,
                                     0x8b, 0x9a, 0x60, 0xe4, 0x2b, 0x12, 0x33, 0x60, 0xe4};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14679, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12650 [("\128\169\159\162P\211\&9;",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\208m\216",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\236_\171\216\143\"\186H\168\235\192<\204\ACK\DEL[h\235\178@\147",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\216\RS\142\&4\175O\SOHGI9M\r\US\159\148,2\RS\196\SUB\136\EM\176\GS\129",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",V\156\135\DC1\226\RS\199Z\rf\r\191.\220.\204\243\227\NAK\198\232\&6$@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\172\192\171\236\193\&0\139\ENQvR\250\SOH6\160\NAK\191\&9u",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\194\ETXM3U\240\EM\243\176\SO/\205H\143\242wn\138\199\137\156\211\175",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0x92, 0x1,  0x31, 0x6a, 0x0,  0x8,  0x80, 0xa9, 0x9f, 0xa2, 0x50, 0xd3, 0x39, 0x3b, 0x1,  0x0,
                   0x3,  0xd0, 0x6d, 0xd8, 0x2,  0x0,  0x15, 0xec, 0x5f, 0xab, 0xd8, 0x8f, 0x22, 0xba, 0x48, 0xa8, 0xeb,
                   0xc0, 0x3c, 0xcc, 0x6,  0x7f, 0x5b, 0x68, 0xeb, 0xb2, 0x40, 0x93, 0x0,  0x0,  0x19, 0xd8, 0x1e, 0x8e,
                   0x34, 0xaf, 0x4f, 0x1,  0x47, 0x49, 0x39, 0x4d, 0xd,  0x1f, 0x9f, 0x94, 0x2c, 0x32, 0x1e, 0xc4, 0x1a,
                   0x88, 0x19, 0xb0, 0x1d, 0x81, 0x0,  0x0,  0x19, 0x2c, 0x56, 0x9c, 0x87, 0x11, 0xe2, 0x1e, 0xc7, 0x5a,
                   0xd,  0x66, 0xd,  0xbf, 0x2e, 0xdc, 0x2e, 0xcc, 0xf3, 0xe3, 0x15, 0xc6, 0xe8, 0x36, 0x24, 0x40, 0x2,
                   0x0,  0x12, 0xac, 0xc0, 0xab, 0xec, 0xc1, 0x30, 0x8b, 0x5,  0x76, 0x52, 0xfa, 0x1,  0x36, 0xa0, 0x15,
                   0xbf, 0x39, 0x75, 0x2,  0x0,  0x17, 0xc2, 0x3,  0x4d, 0x33, 0x55, 0xf0, 0x19, 0xf3, 0xb0, 0xe,  0x2f,
                   0xcd, 0x48, 0x8f, 0xf2, 0x77, 0x6e, 0x8a, 0xc7, 0x89, 0x9c, 0xd3, 0xaf, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x80, 0xa9, 0x9f, 0xa2, 0x50, 0xd3, 0x39, 0x3b};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x6d, 0xd8};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec, 0x5f, 0xab, 0xd8, 0x8f, 0x22, 0xba, 0x48, 0xa8, 0xeb, 0xc0,
                                     0x3c, 0xcc, 0x6,  0x7f, 0x5b, 0x68, 0xeb, 0xb2, 0x40, 0x93};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd8, 0x1e, 0x8e, 0x34, 0xaf, 0x4f, 0x1,  0x47, 0x49, 0x39, 0x4d, 0xd, 0x1f,
                                     0x9f, 0x94, 0x2c, 0x32, 0x1e, 0xc4, 0x1a, 0x88, 0x19, 0xb0, 0x1d, 0x81};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2c, 0x56, 0x9c, 0x87, 0x11, 0xe2, 0x1e, 0xc7, 0x5a, 0xd,  0x66, 0xd, 0xbf,
                                     0x2e, 0xdc, 0x2e, 0xcc, 0xf3, 0xe3, 0x15, 0xc6, 0xe8, 0x36, 0x24, 0x40};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xac, 0xc0, 0xab, 0xec, 0xc1, 0x30, 0x8b, 0x5,  0x76,
                                     0x52, 0xfa, 0x1,  0x36, 0xa0, 0x15, 0xbf, 0x39, 0x75};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc2, 0x3,  0x4d, 0x33, 0x55, 0xf0, 0x19, 0xf3, 0xb0, 0xe,  0x2f, 0xcd,
                                     0x48, 0x8f, 0xf2, 0x77, 0x6e, 0x8a, 0xc7, 0x89, 0x9c, 0xd3, 0xaf};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12650, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3665 [("\RS2\128\242",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x9, 0xe, 0x51, 0x0, 0x4, 0x1e, 0x32, 0x80, 0xf2, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x1e, 0x32, 0x80, 0xf2};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3665, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23603 [("\197\163\195D\141\173\234\249,\160]\180\nZ\t\FS\244Iu\131s[\184\\",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\182\253\219\136*\159\139\DC1\249\240$r\252\233",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\219\DC4\184\&5M\153\135\234\188\ENQ\184",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\218\185}\160^\f\252\130\170}\"u\132m\185\FS\250\157-\169o\DC4",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\128\158`\237A\207\227\151P\STX\248\177\n\202\STX\130N\183\169\198^",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\207\255b\143\CAN\FS\140\203!\SYN<\138\131V\187.Y\252\186\253\DC1\150",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\191h",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("PsYa\175\245B\255\RS\136\128\GS\201\201wA\\\198\&3tES\184+\244\&5\SYN5",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\224\CAN\160\211\DLE",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0xb5, 0x1,  0x5c, 0x33, 0x0,  0x18, 0xc5, 0xa3, 0xc3, 0x44, 0x8d, 0xad, 0xea, 0xf9, 0x2c, 0xa0,
                   0x5d, 0xb4, 0xa,  0x5a, 0x9,  0x1c, 0xf4, 0x49, 0x75, 0x83, 0x73, 0x5b, 0xb8, 0x5c, 0x0,  0x0,  0xe,
                   0xb6, 0xfd, 0xdb, 0x88, 0x2a, 0x9f, 0x8b, 0x11, 0xf9, 0xf0, 0x24, 0x72, 0xfc, 0xe9, 0x1,  0x0,  0xb,
                   0xdb, 0x14, 0xb8, 0x35, 0x4d, 0x99, 0x87, 0xea, 0xbc, 0x5,  0xb8, 0x1,  0x0,  0x16, 0xda, 0xb9, 0x7d,
                   0xa0, 0x5e, 0xc,  0xfc, 0x82, 0xaa, 0x7d, 0x22, 0x75, 0x84, 0x6d, 0xb9, 0x1c, 0xfa, 0x9d, 0x2d, 0xa9,
                   0x6f, 0x14, 0x0,  0x0,  0x15, 0x80, 0x9e, 0x60, 0xed, 0x41, 0xcf, 0xe3, 0x97, 0x50, 0x2,  0xf8, 0xb1,
                   0xa,  0xca, 0x2,  0x82, 0x4e, 0xb7, 0xa9, 0xc6, 0x5e, 0x1,  0x0,  0x16, 0xcf, 0xff, 0x62, 0x8f, 0x18,
                   0x1c, 0x8c, 0xcb, 0x21, 0x16, 0x3c, 0x8a, 0x83, 0x56, 0xbb, 0x2e, 0x59, 0xfc, 0xba, 0xfd, 0x11, 0x96,
                   0x0,  0x0,  0x2,  0xbf, 0x68, 0x0,  0x0,  0x1c, 0x50, 0x73, 0x59, 0x61, 0xaf, 0xf5, 0x42, 0xff, 0x1e,
                   0x88, 0x80, 0x1d, 0xc9, 0xc9, 0x77, 0x41, 0x5c, 0xc6, 0x33, 0x74, 0x45, 0x53, 0xb8, 0x2b, 0xf4, 0x35,
                   0x16, 0x35, 0x2,  0x0,  0x5,  0xe0, 0x18, 0xa0, 0xd3, 0x10, 0x2,  0x0,  0x0,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xc5, 0xa3, 0xc3, 0x44, 0x8d, 0xad, 0xea, 0xf9, 0x2c, 0xa0, 0x5d, 0xb4,
                                     0xa,  0x5a, 0x9,  0x1c, 0xf4, 0x49, 0x75, 0x83, 0x73, 0x5b, 0xb8, 0x5c};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb6, 0xfd, 0xdb, 0x88, 0x2a, 0x9f, 0x8b,
                                     0x11, 0xf9, 0xf0, 0x24, 0x72, 0xfc, 0xe9};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdb, 0x14, 0xb8, 0x35, 0x4d, 0x99, 0x87, 0xea, 0xbc, 0x5, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xda, 0xb9, 0x7d, 0xa0, 0x5e, 0xc,  0xfc, 0x82, 0xaa, 0x7d, 0x22,
                                     0x75, 0x84, 0x6d, 0xb9, 0x1c, 0xfa, 0x9d, 0x2d, 0xa9, 0x6f, 0x14};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x80, 0x9e, 0x60, 0xed, 0x41, 0xcf, 0xe3, 0x97, 0x50, 0x2, 0xf8,
                                     0xb1, 0xa,  0xca, 0x2,  0x82, 0x4e, 0xb7, 0xa9, 0xc6, 0x5e};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xcf, 0xff, 0x62, 0x8f, 0x18, 0x1c, 0x8c, 0xcb, 0x21, 0x16, 0x3c,
                                     0x8a, 0x83, 0x56, 0xbb, 0x2e, 0x59, 0xfc, 0xba, 0xfd, 0x11, 0x96};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbf, 0x68};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x50, 0x73, 0x59, 0x61, 0xaf, 0xf5, 0x42, 0xff, 0x1e, 0x88,
                                     0x80, 0x1d, 0xc9, 0xc9, 0x77, 0x41, 0x5c, 0xc6, 0x33, 0x74,
                                     0x45, 0x53, 0xb8, 0x2b, 0xf4, 0x35, 0x16, 0x35};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe0, 0x18, 0xa0, 0xd3, 0x10};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0};
  lwmqtt_string_t topic_filter_s9 = {0, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23603, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26458 [("\183`M\228xY\249D",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\237\157\196\228p\189\168\211",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\255\152\155\238\160\241#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\221\172",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS1}),("\212\176\130\245\147\226D\DC1\170\164\SOH\210`>\241\244\135\149\243\210\198#\166\227\243\195\ACK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("S/\168!^A\129\141\161\212\235\177",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\160\228\STX\163#\156\211",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\131(\196qI\152p\148\234\235i\148\219\186\139A\137\SI\188\207\164\132%.\135G_\229\211\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x7f, 0x67, 0x5a, 0x0,  0x8,  0xb7, 0x60, 0x4d, 0xe4, 0x78, 0x59, 0xf9, 0x44, 0x1,  0x0,  0x8,
                   0xed, 0x9d, 0xc4, 0xe4, 0x70, 0xbd, 0xa8, 0xd3, 0x1,  0x0,  0x7,  0xff, 0x98, 0x9b, 0xee, 0xa0, 0xf1,
                   0x23, 0x1,  0x0,  0x2,  0xdd, 0xac, 0x1,  0x0,  0x1b, 0xd4, 0xb0, 0x82, 0xf5, 0x93, 0xe2, 0x44, 0x11,
                   0xaa, 0xa4, 0x1,  0xd2, 0x60, 0x3e, 0xf1, 0xf4, 0x87, 0x95, 0xf3, 0xd2, 0xc6, 0x23, 0xa6, 0xe3, 0xf3,
                   0xc3, 0x6,  0x0,  0x0,  0xc,  0x53, 0x2f, 0xa8, 0x21, 0x5e, 0x41, 0x81, 0x8d, 0xa1, 0xd4, 0xeb, 0xb1,
                   0x1,  0x0,  0x7,  0xa0, 0xe4, 0x2,  0xa3, 0x23, 0x9c, 0xd3, 0x0,  0x0,  0x1e, 0x83, 0x28, 0xc4, 0x71,
                   0x49, 0x98, 0x70, 0x94, 0xea, 0xeb, 0x69, 0x94, 0xdb, 0xba, 0x8b, 0x41, 0x89, 0xf,  0xbc, 0xcf, 0xa4,
                   0x84, 0x25, 0x2e, 0x87, 0x47, 0x5f, 0xe5, 0xd3, 0xfe, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xb7, 0x60, 0x4d, 0xe4, 0x78, 0x59, 0xf9, 0x44};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xed, 0x9d, 0xc4, 0xe4, 0x70, 0xbd, 0xa8, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xff, 0x98, 0x9b, 0xee, 0xa0, 0xf1, 0x23};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xdd, 0xac};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd4, 0xb0, 0x82, 0xf5, 0x93, 0xe2, 0x44, 0x11, 0xaa, 0xa4, 0x1,  0xd2, 0x60, 0x3e,
                                     0xf1, 0xf4, 0x87, 0x95, 0xf3, 0xd2, 0xc6, 0x23, 0xa6, 0xe3, 0xf3, 0xc3, 0x6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x53, 0x2f, 0xa8, 0x21, 0x5e, 0x41, 0x81, 0x8d, 0xa1, 0xd4, 0xeb, 0xb1};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa0, 0xe4, 0x2, 0xa3, 0x23, 0x9c, 0xd3};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x83, 0x28, 0xc4, 0x71, 0x49, 0x98, 0x70, 0x94, 0xea, 0xeb,
                                     0x69, 0x94, 0xdb, 0xba, 0x8b, 0x41, 0x89, 0xf,  0xbc, 0xcf,
                                     0xa4, 0x84, 0x25, 0x2e, 0x87, 0x47, 0x5f, 0xe5, 0xd3, 0xfe};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26458, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4488 [("y\134]",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2}),("M\251\156z\tw\201\201\201\b\244\145\253\166",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\207h\177E\207\162\163\233\143",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\CAN\241\ENQ/\"M\212\227\&2\237\164<\230\204\237\206eX\208\194\&7.",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\234\233uo\245\154\131\&5#\223~@\NAKY\140\175\191\179\141\129\166)\188k",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\233:\215\250\&2\131\227\DLE^\175J",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0x67, 0x11, 0x88, 0x0,  0x3,  0x79, 0x86, 0x5d, 0x2,  0x0,  0xe,  0x4d, 0xfb, 0x9c,
                   0x7a, 0x9,  0x77, 0xc9, 0xc9, 0xc9, 0x8,  0xf4, 0x91, 0xfd, 0xa6, 0x0,  0x0,  0x9,  0xcf,
                   0x68, 0xb1, 0x45, 0xcf, 0xa2, 0xa3, 0xe9, 0x8f, 0x0,  0x0,  0x16, 0x18, 0xf1, 0x5,  0x2f,
                   0x22, 0x4d, 0xd4, 0xe3, 0x32, 0xed, 0xa4, 0x3c, 0xe6, 0xcc, 0xed, 0xce, 0x65, 0x58, 0xd0,
                   0xc2, 0x37, 0x2e, 0x1,  0x0,  0x18, 0xea, 0xe9, 0x75, 0x6f, 0xf5, 0x9a, 0x83, 0x35, 0x23,
                   0xdf, 0x7e, 0x40, 0x15, 0x59, 0x8c, 0xaf, 0xbf, 0xb3, 0x8d, 0x81, 0xa6, 0x29, 0xbc, 0x6b,
                   0x0,  0x0,  0xb,  0xe9, 0x3a, 0xd7, 0xfa, 0x32, 0x83, 0xe3, 0x10, 0x5e, 0xaf, 0x4a, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x79, 0x86, 0x5d};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4d, 0xfb, 0x9c, 0x7a, 0x9, 0x77, 0xc9, 0xc9, 0xc9, 0x8, 0xf4, 0x91, 0xfd, 0xa6};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xcf, 0x68, 0xb1, 0x45, 0xcf, 0xa2, 0xa3, 0xe9, 0x8f};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x18, 0xf1, 0x5,  0x2f, 0x22, 0x4d, 0xd4, 0xe3, 0x32, 0xed, 0xa4,
                                     0x3c, 0xe6, 0xcc, 0xed, 0xce, 0x65, 0x58, 0xd0, 0xc2, 0x37, 0x2e};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xea, 0xe9, 0x75, 0x6f, 0xf5, 0x9a, 0x83, 0x35, 0x23, 0xdf, 0x7e, 0x40,
                                     0x15, 0x59, 0x8c, 0xaf, 0xbf, 0xb3, 0x8d, 0x81, 0xa6, 0x29, 0xbc, 0x6b};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe9, 0x3a, 0xd7, 0xfa, 0x32, 0x83, 0xe3, 0x10, 0x5e, 0xaf, 0x4a};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4488, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28692
// [("a^z\164{\209P\192\235d\163\187\135\198\205\238\DC4\185h\146\199\197\&9\223\220\253",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("]\163\DC3\140]\129\245\224\164\163S",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\171\&1\208\132\SI\194\193m\ACK\203\239\SIx\ENQ\218\160O|1\235Y:\184\174",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\176\STX\244\239\208df\183(B\197x;\189\224\232 Y\218\155f\135\149v\249d\245\FS\208L",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\n#\223\137\184\136\225",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1}),("`\RS8\b\137\129\FS#\SO\234\SYN\192\217\144A'\216\235\227\226\ai\205\207}c",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("V\224\171\163j",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x98, 0x1,  0x70, 0x14, 0x0,  0x1a, 0x61, 0x5e, 0x7a, 0xa4, 0x7b, 0xd1, 0x50, 0xc0, 0xeb,
                   0x64, 0xa3, 0xbb, 0x87, 0xc6, 0xcd, 0xee, 0x14, 0xb9, 0x68, 0x92, 0xc7, 0xc5, 0x39, 0xdf, 0xdc,
                   0xfd, 0x2,  0x0,  0xb,  0x5d, 0xa3, 0x13, 0x8c, 0x5d, 0x81, 0xf5, 0xe0, 0xa4, 0xa3, 0x53, 0x2,
                   0x0,  0x18, 0xab, 0x31, 0xd0, 0x84, 0xf,  0xc2, 0xc1, 0x6d, 0x6,  0xcb, 0xef, 0xf,  0x78, 0x5,
                   0xda, 0xa0, 0x4f, 0x7c, 0x31, 0xeb, 0x59, 0x3a, 0xb8, 0xae, 0x2,  0x0,  0x1e, 0xb0, 0x2,  0xf4,
                   0xef, 0xd0, 0x64, 0x66, 0xb7, 0x28, 0x42, 0xc5, 0x78, 0x3b, 0xbd, 0xe0, 0xe8, 0x20, 0x59, 0xda,
                   0x9b, 0x66, 0x87, 0x95, 0x76, 0xf9, 0x64, 0xf5, 0x1c, 0xd0, 0x4c, 0x2,  0x0,  0x7,  0xa,  0x23,
                   0xdf, 0x89, 0xb8, 0x88, 0xe1, 0x1,  0x0,  0x1a, 0x60, 0x1e, 0x38, 0x8,  0x89, 0x81, 0x1c, 0x23,
                   0xe,  0xea, 0x16, 0xc0, 0xd9, 0x90, 0x41, 0x27, 0xd8, 0xeb, 0xe3, 0xe2, 0x7,  0x69, 0xcd, 0xcf,
                   0x7d, 0x63, 0x0,  0x0,  0x5,  0x56, 0xe0, 0xab, 0xa3, 0x6a, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x61, 0x5e, 0x7a, 0xa4, 0x7b, 0xd1, 0x50, 0xc0, 0xeb, 0x64, 0xa3, 0xbb, 0x87,
                                     0xc6, 0xcd, 0xee, 0x14, 0xb9, 0x68, 0x92, 0xc7, 0xc5, 0x39, 0xdf, 0xdc, 0xfd};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5d, 0xa3, 0x13, 0x8c, 0x5d, 0x81, 0xf5, 0xe0, 0xa4, 0xa3, 0x53};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xab, 0x31, 0xd0, 0x84, 0xf,  0xc2, 0xc1, 0x6d, 0x6,  0xcb, 0xef, 0xf,
                                     0x78, 0x5,  0xda, 0xa0, 0x4f, 0x7c, 0x31, 0xeb, 0x59, 0x3a, 0xb8, 0xae};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb0, 0x2,  0xf4, 0xef, 0xd0, 0x64, 0x66, 0xb7, 0x28, 0x42,
                                     0xc5, 0x78, 0x3b, 0xbd, 0xe0, 0xe8, 0x20, 0x59, 0xda, 0x9b,
                                     0x66, 0x87, 0x95, 0x76, 0xf9, 0x64, 0xf5, 0x1c, 0xd0, 0x4c};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa, 0x23, 0xdf, 0x89, 0xb8, 0x88, 0xe1};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x60, 0x1e, 0x38, 0x8,  0x89, 0x81, 0x1c, 0x23, 0xe,  0xea, 0x16, 0xc0, 0xd9,
                                     0x90, 0x41, 0x27, 0xd8, 0xeb, 0xe3, 0xe2, 0x7,  0x69, 0xcd, 0xcf, 0x7d, 0x63};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x56, 0xe0, 0xab, 0xa3, 0x6a};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28692, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11607 [("\200P\177\221",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("A\173\ETX\f\226l\DELM\233\194ndO4\248\238\130\173\224\214",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\246\222N\189z",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("\216\NAKQ\172\ACK\138\167\168\&5&",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\SYN\130\197\169\254\\\180\144\164g\158k",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\NUL\214a\170\SOH\192\ETX\136M\252\SOH\238q\183\ETX\172\138\213$]\154J\166\142\232R",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Mu-|\132\218\214j\253",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS =
// QoS0}),("\240\161\131\US\213\DC1\239\222\n\133\218\180j\176p\215\204s\138t\154N\163!\227y(\233l\166",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\237\136f\131sp\148i\158+cYt\ESC;",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x2d, 0x57, 0x0,  0x4,  0xc8, 0x50, 0xb1, 0xdd, 0x2,  0x0,  0x14, 0x41, 0xad, 0x3,
                   0xc,  0xe2, 0x6c, 0x7f, 0x4d, 0xe9, 0xc2, 0x6e, 0x64, 0x4f, 0x34, 0xf8, 0xee, 0x82, 0xad, 0xe0, 0xd6,
                   0x0,  0x0,  0x5,  0xf6, 0xde, 0x4e, 0xbd, 0x7a, 0x2,  0x0,  0xa,  0xd8, 0x15, 0x51, 0xac, 0x6,  0x8a,
                   0xa7, 0xa8, 0x35, 0x26, 0x1,  0x0,  0xc,  0x16, 0x82, 0xc5, 0xa9, 0xfe, 0x5c, 0xb4, 0x90, 0xa4, 0x67,
                   0x9e, 0x6b, 0x0,  0x0,  0x1a, 0x0,  0xd6, 0x61, 0xaa, 0x1,  0xc0, 0x3,  0x88, 0x4d, 0xfc, 0x1,  0xee,
                   0x71, 0xb7, 0x3,  0xac, 0x8a, 0xd5, 0x24, 0x5d, 0x9a, 0x4a, 0xa6, 0x8e, 0xe8, 0x52, 0x2,  0x0,  0x9,
                   0x4d, 0x75, 0x2d, 0x7c, 0x84, 0xda, 0xd6, 0x6a, 0xfd, 0x0,  0x0,  0x1e, 0xf0, 0xa1, 0x83, 0x1f, 0xd5,
                   0x11, 0xef, 0xde, 0xa,  0x85, 0xda, 0xb4, 0x6a, 0xb0, 0x70, 0xd7, 0xcc, 0x73, 0x8a, 0x74, 0x9a, 0x4e,
                   0xa3, 0x21, 0xe3, 0x79, 0x28, 0xe9, 0x6c, 0xa6, 0x0,  0x0,  0xf,  0xed, 0x88, 0x66, 0x83, 0x73, 0x70,
                   0x94, 0x69, 0x9e, 0x2b, 0x63, 0x59, 0x74, 0x1b, 0x3b, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xc8, 0x50, 0xb1, 0xdd};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x41, 0xad, 0x3,  0xc,  0xe2, 0x6c, 0x7f, 0x4d, 0xe9, 0xc2,
                                     0x6e, 0x64, 0x4f, 0x34, 0xf8, 0xee, 0x82, 0xad, 0xe0, 0xd6};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf6, 0xde, 0x4e, 0xbd, 0x7a};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd8, 0x15, 0x51, 0xac, 0x6, 0x8a, 0xa7, 0xa8, 0x35, 0x26};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x16, 0x82, 0xc5, 0xa9, 0xfe, 0x5c, 0xb4, 0x90, 0xa4, 0x67, 0x9e, 0x6b};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x0,  0xd6, 0x61, 0xaa, 0x1,  0xc0, 0x3,  0x88, 0x4d, 0xfc, 0x1,  0xee, 0x71,
                                     0xb7, 0x3,  0xac, 0x8a, 0xd5, 0x24, 0x5d, 0x9a, 0x4a, 0xa6, 0x8e, 0xe8, 0x52};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4d, 0x75, 0x2d, 0x7c, 0x84, 0xda, 0xd6, 0x6a, 0xfd};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf0, 0xa1, 0x83, 0x1f, 0xd5, 0x11, 0xef, 0xde, 0xa,  0x85,
                                     0xda, 0xb4, 0x6a, 0xb0, 0x70, 0xd7, 0xcc, 0x73, 0x8a, 0x74,
                                     0x9a, 0x4e, 0xa3, 0x21, 0xe3, 0x79, 0x28, 0xe9, 0x6c, 0xa6};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xed, 0x88, 0x66, 0x83, 0x73, 0x70, 0x94, 0x69,
                                     0x9e, 0x2b, 0x63, 0x59, 0x74, 0x1b, 0x3b};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11607, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22426 [("\FS\227\218",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x8, 0x57, 0x9a, 0x0, 0x3, 0x1c, 0xe3, 0xda, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x1c, 0xe3, 0xda};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22426, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7633 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2})] [PropReasonString
// "\155\148e\NUL\226\147\"\165\SOb\167\&5\a\163\145\131\145\a{7\255\&4\252\182",PropWillDelayInterval
// 24271,PropTopicAlias 3636]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x29, 0x1d, 0xd1, 0x23, 0x1f, 0x0,  0x18, 0x9b, 0x94, 0x65, 0x0,  0xe2, 0x93, 0x22,
                   0xa5, 0xe,  0x62, 0xa7, 0x35, 0x7,  0xa3, 0x91, 0x83, 0x91, 0x7,  0x7b, 0x37, 0xff, 0x34,
                   0xfc, 0xb6, 0x18, 0x0,  0x0,  0x5e, 0xcf, 0x23, 0xe,  0x34, 0x0,  0x0,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0x9b, 0x94, 0x65, 0x0,  0xe2, 0x93, 0x22, 0xa5, 0xe,  0x62, 0xa7, 0x35,
                           0x7,  0xa3, 0x91, 0x83, 0x91, 0x7,  0x7b, 0x37, 0xff, 0x34, 0xfc, 0xb6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24271}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3636}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7633, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29762 [("J\239",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] [PropSharedSubscriptionAvailable 164,PropPayloadFormatIndicator
// 175,PropMessageExpiryInterval 7362,PropMaximumPacketSize 25435,PropMessageExpiryInterval 15479,PropServerReference
// "\FS\169\DC1\163\242\224",PropAssignedClientIdentifier "\SUB\154 k#\250t\128\242HQ\209$\173\SI",PropTopicAlias
// 7747,PropMessageExpiryInterval 3634,PropAuthenticationMethod
// "2vE\128\215\138rD\242\243\211\202\STX]\"!\238\159%\174\243",PropWildcardSubscriptionAvailable
// 141,PropTopicAliasMaximum 21116,PropSessionExpiryInterval 14836]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x60, 0x74, 0x42, 0x58, 0x2a, 0xa4, 0x1,  0xaf, 0x2,  0x0,  0x0,  0x1c, 0xc2, 0x27, 0x0,  0x0,
                   0x63, 0x5b, 0x2,  0x0,  0x0,  0x3c, 0x77, 0x1c, 0x0,  0x6,  0x1c, 0xa9, 0x11, 0xa3, 0xf2, 0xe0, 0x12,
                   0x0,  0xf,  0x1a, 0x9a, 0x20, 0x6b, 0x23, 0xfa, 0x74, 0x80, 0xf2, 0x48, 0x51, 0xd1, 0x24, 0xad, 0xf,
                   0x23, 0x1e, 0x43, 0x2,  0x0,  0x0,  0xe,  0x32, 0x15, 0x0,  0x15, 0x32, 0x76, 0x45, 0x80, 0xd7, 0x8a,
                   0x72, 0x44, 0xf2, 0xf3, 0xd3, 0xca, 0x2,  0x5d, 0x22, 0x21, 0xee, 0x9f, 0x25, 0xae, 0xf3, 0x28, 0x8d,
                   0x22, 0x52, 0x7c, 0x11, 0x0,  0x0,  0x39, 0xf4, 0x0,  0x2,  0x4a, 0xef, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x4a, 0xef};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0x1c, 0xa9, 0x11, 0xa3, 0xf2, 0xe0};
  uint8_t bytesprops1[] = {0x1a, 0x9a, 0x20, 0x6b, 0x23, 0xfa, 0x74, 0x80, 0xf2, 0x48, 0x51, 0xd1, 0x24, 0xad, 0xf};
  uint8_t bytesprops2[] = {0x32, 0x76, 0x45, 0x80, 0xd7, 0x8a, 0x72, 0x44, 0xf2, 0xf3, 0xd3,
                           0xca, 0x2,  0x5d, 0x22, 0x21, 0xee, 0x9f, 0x25, 0xae, 0xf3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7362}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25435}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15479}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7747}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3634}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21116}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14836}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29762, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30334 [("/\SUB\DC2:k\140\DC3\184\237\130\214-\204\144j\179\231\244\242tp@\RSZx\ENQX",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("T\210\128\148\230\144\147\&2&+N\138\198\129\156\149",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\a[}\129\251}\153\232\133",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\156\198\198\142\194\236T\189\228\175e\155\ETX\145\225\\:\SUB\131\221",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("D\174\175\216\224\ETB\193\170\214\231",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = False, _noLocal = True, _subQoS = QoS2}),("\207\193\224w'\248\246",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropSessionExpiryInterval
// 18702,PropReceiveMaximum 21620,PropSharedSubscriptionAvailable 214]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x78, 0x76, 0x7e, 0xa,  0x11, 0x0,  0x0,  0x49, 0xe,  0x21, 0x54, 0x74, 0x2a, 0xd6, 0x0,
                   0x1b, 0x2f, 0x1a, 0x12, 0x3a, 0x6b, 0x8c, 0x13, 0xb8, 0xed, 0x82, 0xd6, 0x2d, 0xcc, 0x90, 0x6a,
                   0xb3, 0xe7, 0xf4, 0xf2, 0x74, 0x70, 0x40, 0x1e, 0x5a, 0x78, 0x5,  0x58, 0x16, 0x0,  0x10, 0x54,
                   0xd2, 0x80, 0x94, 0xe6, 0x90, 0x93, 0x32, 0x26, 0x2b, 0x4e, 0x8a, 0xc6, 0x81, 0x9c, 0x95, 0x10,
                   0x0,  0x9,  0x7,  0x5b, 0x7d, 0x81, 0xfb, 0x7d, 0x99, 0xe8, 0x85, 0x2d, 0x0,  0x14, 0x9c, 0xc6,
                   0xc6, 0x8e, 0xc2, 0xec, 0x54, 0xbd, 0xe4, 0xaf, 0x65, 0x9b, 0x3,  0x91, 0xe1, 0x5c, 0x3a, 0x1a,
                   0x83, 0xdd, 0x5,  0x0,  0xa,  0x44, 0xae, 0xaf, 0xd8, 0xe0, 0x17, 0xc1, 0xaa, 0xd6, 0xe7, 0x16,
                   0x0,  0x7,  0xcf, 0xc1, 0xe0, 0x77, 0x27, 0xf8, 0xf6, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x2f, 0x1a, 0x12, 0x3a, 0x6b, 0x8c, 0x13, 0xb8, 0xed, 0x82, 0xd6, 0x2d, 0xcc, 0x90,
                                     0x6a, 0xb3, 0xe7, 0xf4, 0xf2, 0x74, 0x70, 0x40, 0x1e, 0x5a, 0x78, 0x5,  0x58};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x54, 0xd2, 0x80, 0x94, 0xe6, 0x90, 0x93, 0x32,
                                     0x26, 0x2b, 0x4e, 0x8a, 0xc6, 0x81, 0x9c, 0x95};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7, 0x5b, 0x7d, 0x81, 0xfb, 0x7d, 0x99, 0xe8, 0x85};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9c, 0xc6, 0xc6, 0x8e, 0xc2, 0xec, 0x54, 0xbd, 0xe4, 0xaf,
                                     0x65, 0x9b, 0x3,  0x91, 0xe1, 0x5c, 0x3a, 0x1a, 0x83, 0xdd};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x44, 0xae, 0xaf, 0xd8, 0xe0, 0x17, 0xc1, 0xaa, 0xd6, 0xe7};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xcf, 0xc1, 0xe0, 0x77, 0x27, 0xf8, 0xf6};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18702}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21620}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 214}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30334, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26291 [("\SI\235&\DLEy\150\n\207\212>H\132",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("@\181\178*D\211",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("5\138\164\236\175\v\154\215\DLE\DC1\250Z\168N\145\228\235C\186\rrf\247\243",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("o\235s\DC1p\179\196\&3\216n\ENQ",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2})] [PropAuthenticationData
// "3\STX\146(\244\153@\186\251\SUBcG1\191\223Z\SUBh\221C\203>",PropServerKeepAlive 986,PropTopicAlias
// 9329,PropWillDelayInterval 3455,PropAssignedClientIdentifier
// "\211Rp\255\FS\FS\238\&6",PropWildcardSubscriptionAvailable 228,PropRequestResponseInformation
// 250,PropServerReference "",PropMessageExpiryInterval 13564,PropReceiveMaximum 10366,PropSubscriptionIdentifier
// 27,PropServerKeepAlive 6764,PropWillDelayInterval 29672,PropSessionExpiryInterval 3082,PropTopicAlias
// 11165,PropWillDelayInterval 28623,PropSessionExpiryInterval 10852,PropResponseInformation
// "I",PropRequestProblemInformation 98,PropMaximumQoS 75,PropMaximumQoS 88,PropMessageExpiryInterval
// 1740,PropReceiveMaximum 21047,PropSubscriptionIdentifier 28]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0xb2, 0x1,  0x66, 0xb3, 0x6e, 0x16, 0x0,  0x16, 0x33, 0x2,  0x92, 0x28, 0xf4, 0x99, 0x40, 0xba,
                   0xfb, 0x1a, 0x63, 0x47, 0x31, 0xbf, 0xdf, 0x5a, 0x1a, 0x68, 0xdd, 0x43, 0xcb, 0x3e, 0x13, 0x3,  0xda,
                   0x23, 0x24, 0x71, 0x18, 0x0,  0x0,  0xd,  0x7f, 0x12, 0x0,  0x8,  0xd3, 0x52, 0x70, 0xff, 0x1c, 0x1c,
                   0xee, 0x36, 0x28, 0xe4, 0x19, 0xfa, 0x1c, 0x0,  0x0,  0x2,  0x0,  0x0,  0x34, 0xfc, 0x21, 0x28, 0x7e,
                   0xb,  0x1b, 0x13, 0x1a, 0x6c, 0x18, 0x0,  0x0,  0x73, 0xe8, 0x11, 0x0,  0x0,  0xc,  0xa,  0x23, 0x2b,
                   0x9d, 0x18, 0x0,  0x0,  0x6f, 0xcf, 0x11, 0x0,  0x0,  0x2a, 0x64, 0x1a, 0x0,  0x1,  0x49, 0x17, 0x62,
                   0x24, 0x4b, 0x24, 0x58, 0x2,  0x0,  0x0,  0x6,  0xcc, 0x21, 0x52, 0x37, 0xb,  0x1c, 0x0,  0xc,  0xf,
                   0xeb, 0x26, 0x10, 0x79, 0x96, 0xa,  0xcf, 0xd4, 0x3e, 0x48, 0x84, 0xa,  0x0,  0x6,  0x40, 0xb5, 0xb2,
                   0x2a, 0x44, 0xd3, 0x16, 0x0,  0x18, 0x35, 0x8a, 0xa4, 0xec, 0xaf, 0xb,  0x9a, 0xd7, 0x10, 0x11, 0xfa,
                   0x5a, 0xa8, 0x4e, 0x91, 0xe4, 0xeb, 0x43, 0xba, 0xd,  0x72, 0x66, 0xf7, 0xf3, 0xa,  0x0,  0xb,  0x6f,
                   0xeb, 0x73, 0x11, 0x70, 0xb3, 0xc4, 0x33, 0xd8, 0x6e, 0x5,  0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xf, 0xeb, 0x26, 0x10, 0x79, 0x96, 0xa, 0xcf, 0xd4, 0x3e, 0x48, 0x84};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x40, 0xb5, 0xb2, 0x2a, 0x44, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0x8a, 0xa4, 0xec, 0xaf, 0xb,  0x9a, 0xd7, 0x10, 0x11, 0xfa, 0x5a,
                                     0xa8, 0x4e, 0x91, 0xe4, 0xeb, 0x43, 0xba, 0xd,  0x72, 0x66, 0xf7, 0xf3};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6f, 0xeb, 0x73, 0x11, 0x70, 0xb3, 0xc4, 0x33, 0xd8, 0x6e, 0x5};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0x33, 0x2,  0x92, 0x28, 0xf4, 0x99, 0x40, 0xba, 0xfb, 0x1a, 0x63,
                           0x47, 0x31, 0xbf, 0xdf, 0x5a, 0x1a, 0x68, 0xdd, 0x43, 0xcb, 0x3e};
  uint8_t bytesprops1[] = {0xd3, 0x52, 0x70, 0xff, 0x1c, 0x1c, 0xee, 0x36};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x49};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 986}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9329}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3455}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13564}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10366}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6764}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29672}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3082}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11165}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28623}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10852}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1740}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21047}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26291, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29015 [("\163\tU\254\239\150/*\157\226\191\&1a\DC3\227{",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\213\SUB\207\229\DC3\246\243\142",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] [PropRequestResponseInformation 223,PropServerReference
// "\239\139\206\179\GS\133jT&p\150\232\206\CAN\217",PropSharedSubscriptionAvailable 72,PropServerKeepAlive
// 10269,PropServerReference "CP",PropPayloadFormatIndicator 144,PropWillDelayInterval 20331,PropAuthenticationData
// "\222\SI\128\ETXF\194\249O\180'\198\192\&9\233\163\217\189\239\GS\223\DC2\b\130Ou]=\142\\Q",PropSessionExpiryInterval
// 14899,PropRetainAvailable 53,PropRetainAvailable 23,PropSharedSubscriptionAvailable 74,PropPayloadFormatIndicator
// 90,PropMessageExpiryInterval 26931,PropRequestProblemInformation 202,PropSubscriptionIdentifierAvailable
// 70,PropMaximumQoS 160,PropServerReference
// "\196\207\143&\235@\178\248\154\190\163\201\153M\148\168",PropWillDelayInterval 24816,PropMaximumPacketSize
// 26054,PropCorrelationData "\243?H\SYN\181w\130R/\146\NULcpF\182\219.\181\232\200\220\a\255G8",PropServerKeepAlive
// 12011,PropRetainAvailable 29,PropSubscriptionIdentifier 6,PropMaximumQoS 2,PropRequestProblemInformation 42]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0xc4, 0x1,  0x71, 0x57, 0xa2, 0x1,  0x19, 0xdf, 0x1c, 0x0,  0xf,  0xef, 0x8b, 0xce, 0xb3, 0x1d,
                   0x85, 0x6a, 0x54, 0x26, 0x70, 0x96, 0xe8, 0xce, 0x18, 0xd9, 0x2a, 0x48, 0x13, 0x28, 0x1d, 0x1c, 0x0,
                   0x2,  0x43, 0x50, 0x1,  0x90, 0x18, 0x0,  0x0,  0x4f, 0x6b, 0x16, 0x0,  0x1e, 0xde, 0xf,  0x80, 0x3,
                   0x46, 0xc2, 0xf9, 0x4f, 0xb4, 0x27, 0xc6, 0xc0, 0x39, 0xe9, 0xa3, 0xd9, 0xbd, 0xef, 0x1d, 0xdf, 0x12,
                   0x8,  0x82, 0x4f, 0x75, 0x5d, 0x3d, 0x8e, 0x5c, 0x51, 0x11, 0x0,  0x0,  0x3a, 0x33, 0x25, 0x35, 0x25,
                   0x17, 0x2a, 0x4a, 0x1,  0x5a, 0x2,  0x0,  0x0,  0x69, 0x33, 0x17, 0xca, 0x29, 0x46, 0x24, 0xa0, 0x1c,
                   0x0,  0x10, 0xc4, 0xcf, 0x8f, 0x26, 0xeb, 0x40, 0xb2, 0xf8, 0x9a, 0xbe, 0xa3, 0xc9, 0x99, 0x4d, 0x94,
                   0xa8, 0x18, 0x0,  0x0,  0x60, 0xf0, 0x27, 0x0,  0x0,  0x65, 0xc6, 0x9,  0x0,  0x19, 0xf3, 0x3f, 0x48,
                   0x16, 0xb5, 0x77, 0x82, 0x52, 0x2f, 0x92, 0x0,  0x63, 0x70, 0x46, 0xb6, 0xdb, 0x2e, 0xb5, 0xe8, 0xc8,
                   0xdc, 0x7,  0xff, 0x47, 0x38, 0x13, 0x2e, 0xeb, 0x25, 0x1d, 0xb,  0x6,  0x24, 0x2,  0x17, 0x2a, 0x0,
                   0x10, 0xa3, 0x9,  0x55, 0xfe, 0xef, 0x96, 0x2f, 0x2a, 0x9d, 0xe2, 0xbf, 0x31, 0x61, 0x13, 0xe3, 0x7b,
                   0x1,  0x0,  0x8,  0xd5, 0x1a, 0xcf, 0xe5, 0x13, 0xf6, 0xf3, 0x8e, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xa3, 0x9,  0x55, 0xfe, 0xef, 0x96, 0x2f, 0x2a,
                                     0x9d, 0xe2, 0xbf, 0x31, 0x61, 0x13, 0xe3, 0x7b};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd5, 0x1a, 0xcf, 0xe5, 0x13, 0xf6, 0xf3, 0x8e};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0xef, 0x8b, 0xce, 0xb3, 0x1d, 0x85, 0x6a, 0x54, 0x26, 0x70, 0x96, 0xe8, 0xce, 0x18, 0xd9};
  uint8_t bytesprops1[] = {0x43, 0x50};
  uint8_t bytesprops2[] = {0xde, 0xf,  0x80, 0x3,  0x46, 0xc2, 0xf9, 0x4f, 0xb4, 0x27, 0xc6, 0xc0, 0x39, 0xe9, 0xa3,
                           0xd9, 0xbd, 0xef, 0x1d, 0xdf, 0x12, 0x8,  0x82, 0x4f, 0x75, 0x5d, 0x3d, 0x8e, 0x5c, 0x51};
  uint8_t bytesprops3[] = {0xc4, 0xcf, 0x8f, 0x26, 0xeb, 0x40, 0xb2, 0xf8,
                           0x9a, 0xbe, 0xa3, 0xc9, 0x99, 0x4d, 0x94, 0xa8};
  uint8_t bytesprops4[] = {0xf3, 0x3f, 0x48, 0x16, 0xb5, 0x77, 0x82, 0x52, 0x2f, 0x92, 0x0,  0x63, 0x70,
                           0x46, 0xb6, 0xdb, 0x2e, 0xb5, 0xe8, 0xc8, 0xdc, 0x7,  0xff, 0x47, 0x38};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10269}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20331}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14899}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26931}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24816}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26054}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12011}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 42}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29015, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24249 [("\133\139\\\225\188\f;\\\232=\247\f\131i3BK7cp\150l\FSc",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\173$rH\250",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\169\145\164k\139\246",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\US\DEL\ffL]\EMM4V |1\RS\169\151\NAK\246",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\190\200Cvj\152\154\218\249x\STX\251}`\168\156\182>]`r\175",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\248\&3\182",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropSessionExpiryInterval 15919,PropMessageExpiryInterval 13210,PropSharedSubscriptionAvailable
// 2,PropResponseInformation
// "\173p\184\166Z\174\249\226\182\211Z\\\231\136^\240y\243\186\SUB\DLE\247,\167{\172V\203",PropPayloadFormatIndicator
// 57,PropTopicAliasMaximum 16229,PropMaximumQoS 46,PropSubscriptionIdentifier 32,PropUserProperty
// "\ru\135\v@\145\160\215\177\&4EQ\150\138\&3;\225\222\217" "\SI\195\SO\DLE\228",PropCorrelationData
// "\EM\229\DC3\222B\172m\DC2\230\238",PropMessageExpiryInterval 7126,PropSubscriptionIdentifier 10,PropRetainAvailable
// 192,PropResponseTopic "\168\184\&9l\238\DC1\ACK\185&\179*{\DC1-\187\DLE11N$n\138\151\GS`^y\152A"]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x82, 0xeb, 0x1,  0x5e, 0xb9, 0x87, 0x1,  0x11, 0x0,  0x0,  0x3e, 0x2f, 0x2,  0x0,  0x0,  0x33, 0x9a, 0x2a, 0x2,
      0x1a, 0x0,  0x1c, 0xad, 0x70, 0xb8, 0xa6, 0x5a, 0xae, 0xf9, 0xe2, 0xb6, 0xd3, 0x5a, 0x5c, 0xe7, 0x88, 0x5e, 0xf0,
      0x79, 0xf3, 0xba, 0x1a, 0x10, 0xf7, 0x2c, 0xa7, 0x7b, 0xac, 0x56, 0xcb, 0x1,  0x39, 0x22, 0x3f, 0x65, 0x24, 0x2e,
      0xb,  0x20, 0x26, 0x0,  0x13, 0xd,  0x75, 0x87, 0xb,  0x40, 0x91, 0xa0, 0xd7, 0xb1, 0x34, 0x45, 0x51, 0x96, 0x8a,
      0x33, 0x3b, 0xe1, 0xde, 0xd9, 0x0,  0x5,  0xf,  0xc3, 0xe,  0x10, 0xe4, 0x9,  0x0,  0xa,  0x19, 0xe5, 0x13, 0xde,
      0x42, 0xac, 0x6d, 0x12, 0xe6, 0xee, 0x2,  0x0,  0x0,  0x1b, 0xd6, 0xb,  0xa,  0x25, 0xc0, 0x8,  0x0,  0x1d, 0xa8,
      0xb8, 0x39, 0x6c, 0xee, 0x11, 0x6,  0xb9, 0x26, 0xb3, 0x2a, 0x7b, 0x11, 0x2d, 0xbb, 0x10, 0x31, 0x31, 0x4e, 0x24,
      0x6e, 0x8a, 0x97, 0x1d, 0x60, 0x5e, 0x79, 0x98, 0x41, 0x0,  0x18, 0x85, 0x8b, 0x5c, 0xe1, 0xbc, 0xc,  0x3b, 0x5c,
      0xe8, 0x3d, 0xf7, 0xc,  0x83, 0x69, 0x33, 0x42, 0x4b, 0x37, 0x63, 0x70, 0x96, 0x6c, 0x1c, 0x63, 0x21, 0x0,  0x5,
      0xad, 0x24, 0x72, 0x48, 0xfa, 0x22, 0x0,  0x6,  0xa9, 0x91, 0xa4, 0x6b, 0x8b, 0xf6, 0x0,  0x0,  0x12, 0x1f, 0x7f,
      0xc,  0x66, 0x4c, 0x5d, 0x19, 0x4d, 0x34, 0x56, 0x20, 0x7c, 0x31, 0x1e, 0xa9, 0x97, 0x15, 0xf6, 0x12, 0x0,  0x16,
      0xbe, 0xc8, 0x43, 0x76, 0x6a, 0x98, 0x9a, 0xda, 0xf9, 0x78, 0x2,  0xfb, 0x7d, 0x60, 0xa8, 0x9c, 0xb6, 0x3e, 0x5d,
      0x60, 0x72, 0xaf, 0x19, 0x0,  0x3,  0xf8, 0x33, 0xb6, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x85, 0x8b, 0x5c, 0xe1, 0xbc, 0xc,  0x3b, 0x5c, 0xe8, 0x3d, 0xf7, 0xc,
                                     0x83, 0x69, 0x33, 0x42, 0x4b, 0x37, 0x63, 0x70, 0x96, 0x6c, 0x1c, 0x63};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xad, 0x24, 0x72, 0x48, 0xfa};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x91, 0xa4, 0x6b, 0x8b, 0xf6};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1f, 0x7f, 0xc,  0x66, 0x4c, 0x5d, 0x19, 0x4d, 0x34,
                                     0x56, 0x20, 0x7c, 0x31, 0x1e, 0xa9, 0x97, 0x15, 0xf6};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbe, 0xc8, 0x43, 0x76, 0x6a, 0x98, 0x9a, 0xda, 0xf9, 0x78, 0x2,
                                     0xfb, 0x7d, 0x60, 0xa8, 0x9c, 0xb6, 0x3e, 0x5d, 0x60, 0x72, 0xaf};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf8, 0x33, 0xb6};
  lwmqtt_string_t topic_filter_s5 = {3, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0xad, 0x70, 0xb8, 0xa6, 0x5a, 0xae, 0xf9, 0xe2, 0xb6, 0xd3, 0x5a, 0x5c, 0xe7, 0x88,
                           0x5e, 0xf0, 0x79, 0xf3, 0xba, 0x1a, 0x10, 0xf7, 0x2c, 0xa7, 0x7b, 0xac, 0x56, 0xcb};
  uint8_t bytesprops2[] = {0xf, 0xc3, 0xe, 0x10, 0xe4};
  uint8_t bytesprops1[] = {0xd,  0x75, 0x87, 0xb,  0x40, 0x91, 0xa0, 0xd7, 0xb1, 0x34,
                           0x45, 0x51, 0x96, 0x8a, 0x33, 0x3b, 0xe1, 0xde, 0xd9};
  uint8_t bytesprops3[] = {0x19, 0xe5, 0x13, 0xde, 0x42, 0xac, 0x6d, 0x12, 0xe6, 0xee};
  uint8_t bytesprops4[] = {0xa8, 0xb8, 0x39, 0x6c, 0xee, 0x11, 0x6,  0xb9, 0x26, 0xb3, 0x2a, 0x7b, 0x11, 0x2d, 0xbb,
                           0x10, 0x31, 0x31, 0x4e, 0x24, 0x6e, 0x8a, 0x97, 0x1d, 0x60, 0x5e, 0x79, 0x98, 0x41};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15919}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13210}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16229}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 32}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops1}, .v = {5, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7126}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24249, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18033 [("\181\STX\205 B\134&\195T\EOT\226\245Is\192\233\ETBM\ENQ\150\240\161",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropMaximumQoS
// 84,PropRequestProblemInformation 130,PropRetainAvailable 128,PropAuthenticationMethod
// "\196\133\ETB\SO\225\&9d\226\251\210-\210$",PropSubscriptionIdentifierAvailable 223,PropWillDelayInterval
// 11937,PropServerKeepAlive 5382,PropSubscriptionIdentifier 8,PropWildcardSubscriptionAvailable
// 247,PropMessageExpiryInterval 19198,PropAuthenticationData
// "\200\157p\189e\ENQ\197DJa]\244-?",PropMessageExpiryInterval 9872,PropAuthenticationMethod
// "s\215\231\243m\159\&9~\190\139 \ACK",PropPayloadFormatIndicator 197,PropReceiveMaximum 26191,PropServerKeepAlive
// 20944,PropSubscriptionIdentifier 14,PropMaximumPacketSize 22810,PropWildcardSubscriptionAvailable 26,PropContentType
// "\177I",PropResponseTopic
// "\DLE\b\147\161\SOH\213\183\228qi\129\FS\160\149\CAN\224\v\177\r\NUL4t",PropWillDelayInterval
// 10334,PropPayloadFormatIndicator 136,PropSubscriptionIdentifierAvailable 203,PropUserProperty
// "\247h%\SOH\244\150{\163\&5Ji;7ey\161;s%!\231\193D\215\232\129\214\181"
// "&\148\155\CAN\242ap\SOl\137\STX\191B\204\135\199U\EOT\148\RS\174",PropSubscriptionIdentifierAvailable 192]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xdb, 0x1,  0x46, 0x71, 0xbe, 0x1,  0x24, 0x54, 0x17, 0x82, 0x25, 0x80, 0x15, 0x0,  0xd,  0xc4, 0x85, 0x17,
      0xe,  0xe1, 0x39, 0x64, 0xe2, 0xfb, 0xd2, 0x2d, 0xd2, 0x24, 0x29, 0xdf, 0x18, 0x0,  0x0,  0x2e, 0xa1, 0x13, 0x15,
      0x6,  0xb,  0x8,  0x28, 0xf7, 0x2,  0x0,  0x0,  0x4a, 0xfe, 0x16, 0x0,  0xe,  0xc8, 0x9d, 0x70, 0xbd, 0x65, 0x5,
      0xc5, 0x44, 0x4a, 0x61, 0x5d, 0xf4, 0x2d, 0x3f, 0x2,  0x0,  0x0,  0x26, 0x90, 0x15, 0x0,  0xc,  0x73, 0xd7, 0xe7,
      0xf3, 0x6d, 0x9f, 0x39, 0x7e, 0xbe, 0x8b, 0x20, 0x6,  0x1,  0xc5, 0x21, 0x66, 0x4f, 0x13, 0x51, 0xd0, 0xb,  0xe,
      0x27, 0x0,  0x0,  0x59, 0x1a, 0x28, 0x1a, 0x3,  0x0,  0x2,  0xb1, 0x49, 0x8,  0x0,  0x16, 0x10, 0x8,  0x93, 0xa1,
      0x1,  0xd5, 0xb7, 0xe4, 0x71, 0x69, 0x81, 0x1c, 0xa0, 0x95, 0x18, 0xe0, 0xb,  0xb1, 0xd,  0x0,  0x34, 0x74, 0x18,
      0x0,  0x0,  0x28, 0x5e, 0x1,  0x88, 0x29, 0xcb, 0x26, 0x0,  0x1c, 0xf7, 0x68, 0x25, 0x1,  0xf4, 0x96, 0x7b, 0xa3,
      0x35, 0x4a, 0x69, 0x3b, 0x37, 0x65, 0x79, 0xa1, 0x3b, 0x73, 0x25, 0x21, 0xe7, 0xc1, 0x44, 0xd7, 0xe8, 0x81, 0xd6,
      0xb5, 0x0,  0x15, 0x26, 0x94, 0x9b, 0x18, 0xf2, 0x61, 0x70, 0xe,  0x6c, 0x89, 0x2,  0xbf, 0x42, 0xcc, 0x87, 0xc7,
      0x55, 0x4,  0x94, 0x1e, 0xae, 0x29, 0xc0, 0x0,  0x16, 0xb5, 0x2,  0xcd, 0x20, 0x42, 0x86, 0x26, 0xc3, 0x54, 0x4,
      0xe2, 0xf5, 0x49, 0x73, 0xc0, 0xe9, 0x17, 0x4d, 0x5,  0x96, 0xf0, 0xa1, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xb5, 0x2,  0xcd, 0x20, 0x42, 0x86, 0x26, 0xc3, 0x54, 0x4,  0xe2,
                                     0xf5, 0x49, 0x73, 0xc0, 0xe9, 0x17, 0x4d, 0x5,  0x96, 0xf0, 0xa1};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0xc4, 0x85, 0x17, 0xe, 0xe1, 0x39, 0x64, 0xe2, 0xfb, 0xd2, 0x2d, 0xd2, 0x24};
  uint8_t bytesprops1[] = {0xc8, 0x9d, 0x70, 0xbd, 0x65, 0x5, 0xc5, 0x44, 0x4a, 0x61, 0x5d, 0xf4, 0x2d, 0x3f};
  uint8_t bytesprops2[] = {0x73, 0xd7, 0xe7, 0xf3, 0x6d, 0x9f, 0x39, 0x7e, 0xbe, 0x8b, 0x20, 0x6};
  uint8_t bytesprops3[] = {0xb1, 0x49};
  uint8_t bytesprops4[] = {0x10, 0x8,  0x93, 0xa1, 0x1,  0xd5, 0xb7, 0xe4, 0x71, 0x69, 0x81,
                           0x1c, 0xa0, 0x95, 0x18, 0xe0, 0xb,  0xb1, 0xd,  0x0,  0x34, 0x74};
  uint8_t bytesprops6[] = {0x26, 0x94, 0x9b, 0x18, 0xf2, 0x61, 0x70, 0xe,  0x6c, 0x89, 0x2,
                           0xbf, 0x42, 0xcc, 0x87, 0xc7, 0x55, 0x4,  0x94, 0x1e, 0xae};
  uint8_t bytesprops5[] = {0xf7, 0x68, 0x25, 0x1,  0xf4, 0x96, 0x7b, 0xa3, 0x35, 0x4a, 0x69, 0x3b, 0x37, 0x65,
                           0x79, 0xa1, 0x3b, 0x73, 0x25, 0x21, 0xe7, 0xc1, 0x44, 0xd7, 0xe8, 0x81, 0xd6, 0xb5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11937}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5382}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19198}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9872}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26191}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20944}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22810}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10334}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops5}, .v = {21, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 192}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18033, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22392
// [("G\SO_\r\DLE\244.\250W\133;\154\229\255\200(\128({\RS\DEL\205\&3\233\NAK\158\197\191l",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\233\157F\ACK\128m\130\216\142\NUL\197\184\&8\243\248\SIvz\CAN\229w\US\EM\159\141",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\146\&0m\DC3J\242\217\STXV\251\177G\241m?\246\228",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\t\190\224d\180\148N\147{\128\156",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})]
// [PropRetainAvailable 105,PropSubscriptionIdentifier 12,PropAssignedClientIdentifier
// "\149\161{\161n\129\147\142\198",PropAuthenticationMethod
// "\ETXU]n%\ETX\DC2\238'\140R\211])>\ACK\146{e\162\147+A\142\153",PropWillDelayInterval 1145,PropReasonString
// "\206\149\GS\232\&4\247\&9\251\FS\210\190\DC2\255\145\156\f\251\233K",PropAssignedClientIdentifier
// "\f\196\248\244\ACK",PropMessageExpiryInterval 30990,PropSubscriptionIdentifierAvailable 170,PropUserProperty
// "\183\&5\171\213)\200\214\b2OqE\236l\173\154\198X\236\191^\201\182\153\142\238\SYNe\145"
// "Nv\132\199S\234s\f\162ts\186\198f\242\a\183\SO\SO 1\n\182",PropResponseTopic
// "&\245\218\227R\v\246Jw}\182\143O\208O\186%\170\197\236\238",PropResponseInformation
// "\ETB6\187\EOT\188\159c\209Pm)e\185\160\198\214Q\n\ETB\EOTb\am\227\FS,\224\&5",PropServerReference
// "\f\190\148X\243\178mC\136",PropServerKeepAlive 3868,PropContentType "\227\141\154\US\235
// \224~\153",PropMessageExpiryInterval 14518,PropAssignedClientIdentifier
// "\151x\165\132Z\217\tU0x,\ETX\163\154",PropAuthenticationData
// "\157\146[\237y\154\156\b\221f\178\181\136w\232&\193\r"]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x82, 0xee, 0x2,  0x57, 0x78, 0x8c, 0x2,  0x25, 0x69, 0xb,  0xc,  0x12, 0x0,  0x9,  0x95, 0xa1, 0x7b, 0xa1, 0x6e,
      0x81, 0x93, 0x8e, 0xc6, 0x15, 0x0,  0x19, 0x3,  0x55, 0x5d, 0x6e, 0x25, 0x3,  0x12, 0xee, 0x27, 0x8c, 0x52, 0xd3,
      0x5d, 0x29, 0x3e, 0x6,  0x92, 0x7b, 0x65, 0xa2, 0x93, 0x2b, 0x41, 0x8e, 0x99, 0x18, 0x0,  0x0,  0x4,  0x79, 0x1f,
      0x0,  0x13, 0xce, 0x95, 0x1d, 0xe8, 0x34, 0xf7, 0x39, 0xfb, 0x1c, 0xd2, 0xbe, 0x12, 0xff, 0x91, 0x9c, 0xc,  0xfb,
      0xe9, 0x4b, 0x12, 0x0,  0x5,  0xc,  0xc4, 0xf8, 0xf4, 0x6,  0x2,  0x0,  0x0,  0x79, 0xe,  0x29, 0xaa, 0x26, 0x0,
      0x1d, 0xb7, 0x35, 0xab, 0xd5, 0x29, 0xc8, 0xd6, 0x8,  0x32, 0x4f, 0x71, 0x45, 0xec, 0x6c, 0xad, 0x9a, 0xc6, 0x58,
      0xec, 0xbf, 0x5e, 0xc9, 0xb6, 0x99, 0x8e, 0xee, 0x16, 0x65, 0x91, 0x0,  0x17, 0x4e, 0x76, 0x84, 0xc7, 0x53, 0xea,
      0x73, 0xc,  0xa2, 0x74, 0x73, 0xba, 0xc6, 0x66, 0xf2, 0x7,  0xb7, 0xe,  0xe,  0x20, 0x31, 0xa,  0xb6, 0x8,  0x0,
      0x15, 0x26, 0xf5, 0xda, 0xe3, 0x52, 0xb,  0xf6, 0x4a, 0x77, 0x7d, 0xb6, 0x8f, 0x4f, 0xd0, 0x4f, 0xba, 0x25, 0xaa,
      0xc5, 0xec, 0xee, 0x1a, 0x0,  0x1c, 0x17, 0x36, 0xbb, 0x4,  0xbc, 0x9f, 0x63, 0xd1, 0x50, 0x6d, 0x29, 0x65, 0xb9,
      0xa0, 0xc6, 0xd6, 0x51, 0xa,  0x17, 0x4,  0x62, 0x7,  0x6d, 0xe3, 0x1c, 0x2c, 0xe0, 0x35, 0x1c, 0x0,  0x9,  0xc,
      0xbe, 0x94, 0x58, 0xf3, 0xb2, 0x6d, 0x43, 0x88, 0x13, 0xf,  0x1c, 0x3,  0x0,  0x9,  0xe3, 0x8d, 0x9a, 0x1f, 0xeb,
      0x20, 0xe0, 0x7e, 0x99, 0x2,  0x0,  0x0,  0x38, 0xb6, 0x12, 0x0,  0xe,  0x97, 0x78, 0xa5, 0x84, 0x5a, 0xd9, 0x9,
      0x55, 0x30, 0x78, 0x2c, 0x3,  0xa3, 0x9a, 0x16, 0x0,  0x12, 0x9d, 0x92, 0x5b, 0xed, 0x79, 0x9a, 0x9c, 0x8,  0xdd,
      0x66, 0xb2, 0xb5, 0x88, 0x77, 0xe8, 0x26, 0xc1, 0xd,  0x0,  0x1d, 0x47, 0xe,  0x5f, 0xd,  0x10, 0xf4, 0x2e, 0xfa,
      0x57, 0x85, 0x3b, 0x9a, 0xe5, 0xff, 0xc8, 0x28, 0x80, 0x28, 0x7b, 0x1e, 0x7f, 0xcd, 0x33, 0xe9, 0x15, 0x9e, 0xc5,
      0xbf, 0x6c, 0x2a, 0x0,  0x19, 0xe9, 0x9d, 0x46, 0x6,  0x80, 0x6d, 0x82, 0xd8, 0x8e, 0x0,  0xc5, 0xb8, 0x38, 0xf3,
      0xf8, 0xf,  0x76, 0x7a, 0x18, 0xe5, 0x77, 0x1f, 0x19, 0x9f, 0x8d, 0x2c, 0x0,  0x11, 0x92, 0x30, 0x6d, 0x13, 0x4a,
      0xf2, 0xd9, 0x2,  0x56, 0xfb, 0xb1, 0x47, 0xf1, 0x6d, 0x3f, 0xf6, 0xe4, 0xe,  0x0,  0xb,  0x9,  0xbe, 0xe0, 0x64,
      0xb4, 0x94, 0x4e, 0x93, 0x7b, 0x80, 0x9c, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0xe,  0x5f, 0xd,  0x10, 0xf4, 0x2e, 0xfa, 0x57, 0x85,
                                     0x3b, 0x9a, 0xe5, 0xff, 0xc8, 0x28, 0x80, 0x28, 0x7b, 0x1e,
                                     0x7f, 0xcd, 0x33, 0xe9, 0x15, 0x9e, 0xc5, 0xbf, 0x6c};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe9, 0x9d, 0x46, 0x6,  0x80, 0x6d, 0x82, 0xd8, 0x8e, 0x0,  0xc5, 0xb8, 0x38,
                                     0xf3, 0xf8, 0xf,  0x76, 0x7a, 0x18, 0xe5, 0x77, 0x1f, 0x19, 0x9f, 0x8d};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x92, 0x30, 0x6d, 0x13, 0x4a, 0xf2, 0xd9, 0x2, 0x56,
                                     0xfb, 0xb1, 0x47, 0xf1, 0x6d, 0x3f, 0xf6, 0xe4};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9, 0xbe, 0xe0, 0x64, 0xb4, 0x94, 0x4e, 0x93, 0x7b, 0x80, 0x9c};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0x95, 0xa1, 0x7b, 0xa1, 0x6e, 0x81, 0x93, 0x8e, 0xc6};
  uint8_t bytesprops1[] = {0x3,  0x55, 0x5d, 0x6e, 0x25, 0x3,  0x12, 0xee, 0x27, 0x8c, 0x52, 0xd3, 0x5d,
                           0x29, 0x3e, 0x6,  0x92, 0x7b, 0x65, 0xa2, 0x93, 0x2b, 0x41, 0x8e, 0x99};
  uint8_t bytesprops2[] = {0xce, 0x95, 0x1d, 0xe8, 0x34, 0xf7, 0x39, 0xfb, 0x1c, 0xd2,
                           0xbe, 0x12, 0xff, 0x91, 0x9c, 0xc,  0xfb, 0xe9, 0x4b};
  uint8_t bytesprops3[] = {0xc, 0xc4, 0xf8, 0xf4, 0x6};
  uint8_t bytesprops5[] = {0x4e, 0x76, 0x84, 0xc7, 0x53, 0xea, 0x73, 0xc,  0xa2, 0x74, 0x73, 0xba,
                           0xc6, 0x66, 0xf2, 0x7,  0xb7, 0xe,  0xe,  0x20, 0x31, 0xa,  0xb6};
  uint8_t bytesprops4[] = {0xb7, 0x35, 0xab, 0xd5, 0x29, 0xc8, 0xd6, 0x8,  0x32, 0x4f, 0x71, 0x45, 0xec, 0x6c, 0xad,
                           0x9a, 0xc6, 0x58, 0xec, 0xbf, 0x5e, 0xc9, 0xb6, 0x99, 0x8e, 0xee, 0x16, 0x65, 0x91};
  uint8_t bytesprops6[] = {0x26, 0xf5, 0xda, 0xe3, 0x52, 0xb,  0xf6, 0x4a, 0x77, 0x7d, 0xb6,
                           0x8f, 0x4f, 0xd0, 0x4f, 0xba, 0x25, 0xaa, 0xc5, 0xec, 0xee};
  uint8_t bytesprops7[] = {0x17, 0x36, 0xbb, 0x4, 0xbc, 0x9f, 0x63, 0xd1, 0x50, 0x6d, 0x29, 0x65, 0xb9, 0xa0,
                           0xc6, 0xd6, 0x51, 0xa, 0x17, 0x4,  0x62, 0x7,  0x6d, 0xe3, 0x1c, 0x2c, 0xe0, 0x35};
  uint8_t bytesprops8[] = {0xc, 0xbe, 0x94, 0x58, 0xf3, 0xb2, 0x6d, 0x43, 0x88};
  uint8_t bytesprops9[] = {0xe3, 0x8d, 0x9a, 0x1f, 0xeb, 0x20, 0xe0, 0x7e, 0x99};
  uint8_t bytesprops10[] = {0x97, 0x78, 0xa5, 0x84, 0x5a, 0xd9, 0x9, 0x55, 0x30, 0x78, 0x2c, 0x3, 0xa3, 0x9a};
  uint8_t bytesprops11[] = {0x9d, 0x92, 0x5b, 0xed, 0x79, 0x9a, 0x9c, 0x8,  0xdd,
                            0x66, 0xb2, 0xb5, 0x88, 0x77, 0xe8, 0x26, 0xc1, 0xd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1145}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30990}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops4}, .v = {23, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3868}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14518}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22392, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26543 [("\249\201\SUB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS2}),("\219\159\230|\181\144-\SUB\144",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\220\152\146\130\197\251\SOH\226+",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\143\200\174\222\226\&4\142+",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS1}),("\145\228A\244\158\b\173fY&\220q\DC4\161\\\174\199\&7\172#",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\138\DC1\164\194\ETB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS2}),("C\139\178\210\217U(S\133\a",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("MU:H5\202\246\247!\NUL\169",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x69, 0x67, 0xaf, 0x0,  0x0,  0x3,  0xf9, 0xc9, 0x1a, 0xe,  0x0,  0x9,  0xdb, 0x9f, 0xe6,
                   0x7c, 0xb5, 0x90, 0x2d, 0x1a, 0x90, 0x9,  0x0,  0x9,  0xdc, 0x98, 0x92, 0x82, 0xc5, 0xfb, 0x1,
                   0xe2, 0x2b, 0x19, 0x0,  0x0,  0x11, 0x0,  0x8,  0x8f, 0xc8, 0xae, 0xde, 0xe2, 0x34, 0x8e, 0x2b,
                   0x9,  0x0,  0x14, 0x91, 0xe4, 0x41, 0xf4, 0x9e, 0x8,  0xad, 0x66, 0x59, 0x26, 0xdc, 0x71, 0x14,
                   0xa1, 0x5c, 0xae, 0xc7, 0x37, 0xac, 0x23, 0x16, 0x0,  0x5,  0x8a, 0x11, 0xa4, 0xc2, 0x17, 0x6,
                   0x0,  0xa,  0x43, 0x8b, 0xb2, 0xd2, 0xd9, 0x55, 0x28, 0x53, 0x85, 0x7,  0x9,  0x0,  0xb,  0x4d,
                   0x55, 0x3a, 0x48, 0x35, 0xca, 0xf6, 0xf7, 0x21, 0x0,  0xa9, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xf9, 0xc9, 0x1a};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdb, 0x9f, 0xe6, 0x7c, 0xb5, 0x90, 0x2d, 0x1a, 0x90};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdc, 0x98, 0x92, 0x82, 0xc5, 0xfb, 0x1, 0xe2, 0x2b};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8f, 0xc8, 0xae, 0xde, 0xe2, 0x34, 0x8e, 0x2b};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x91, 0xe4, 0x41, 0xf4, 0x9e, 0x8,  0xad, 0x66, 0x59, 0x26,
                                     0xdc, 0x71, 0x14, 0xa1, 0x5c, 0xae, 0xc7, 0x37, 0xac, 0x23};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8a, 0x11, 0xa4, 0xc2, 0x17};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x43, 0x8b, 0xb2, 0xd2, 0xd9, 0x55, 0x28, 0x53, 0x85, 0x7};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x4d, 0x55, 0x3a, 0x48, 0x35, 0xca, 0xf6, 0xf7, 0x21, 0x0, 0xa9};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26543, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14708 [("\NULK\203\169*aQ\217\USt\161",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("1\DLE\243[3\NUL\FS\CAN\220\179\247u\159Kf\236\149\FS\231\156*w\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropSharedSubscriptionAvailable
// 49,PropUserProperty "\b\DC4\193\219<\164\227l" "u\184N\223\&9\166\246\139P\139J\233\210\ny"]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x49, 0x39, 0x74, 0x1e, 0x2a, 0x31, 0x26, 0x0,  0x8,  0x8,  0x14, 0xc1, 0xdb, 0x3c,
                   0xa4, 0xe3, 0x6c, 0x0,  0xf,  0x75, 0xb8, 0x4e, 0xdf, 0x39, 0xa6, 0xf6, 0x8b, 0x50, 0x8b,
                   0x4a, 0xe9, 0xd2, 0xa,  0x79, 0x0,  0xb,  0x0,  0x4b, 0xcb, 0xa9, 0x2a, 0x61, 0x51, 0xd9,
                   0x1f, 0x74, 0xa1, 0x15, 0x0,  0x17, 0x31, 0x10, 0xf3, 0x5b, 0x33, 0x0,  0x1c, 0x18, 0xdc,
                   0xb3, 0xf7, 0x75, 0x9f, 0x4b, 0x66, 0xec, 0x95, 0x1c, 0xe7, 0x9c, 0x2a, 0x77, 0xaa, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x0, 0x4b, 0xcb, 0xa9, 0x2a, 0x61, 0x51, 0xd9, 0x1f, 0x74, 0xa1};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x31, 0x10, 0xf3, 0x5b, 0x33, 0x0,  0x1c, 0x18, 0xdc, 0xb3, 0xf7, 0x75,
                                     0x9f, 0x4b, 0x66, 0xec, 0x95, 0x1c, 0xe7, 0x9c, 0x2a, 0x77, 0xaa};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  uint8_t bytesprops1[] = {0x75, 0xb8, 0x4e, 0xdf, 0x39, 0xa6, 0xf6, 0x8b, 0x50, 0x8b, 0x4a, 0xe9, 0xd2, 0xa, 0x79};
  uint8_t bytesprops0[] = {0x8, 0x14, 0xc1, 0xdb, 0x3c, 0xa4, 0xe3, 0x6c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {15, (char*)&bytesprops1}}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14708, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24735 [("I\184\193",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("C\231x)\"5\EOT\146\158\NAK\181,",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\251\n(!k\205\193u\208<\205g.\223Q\US\187[\232\\\206\DLE\148\202",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),(")",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("_\204\209\225{\194\165\&4\222'\DLE\217\157Vu6G7\181\189\DC3)q",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("_6\149\215\&3\ENQ\133\244<\b!",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS1})] [PropResponseTopic
// "`eE\153\SUBC\179\SYN\203\221\CAN\209\t\ACK",PropSharedSubscriptionAvailable 132,PropTopicAliasMaximum
// 3544,PropUserProperty "\189\234X\244\ETB\192\216" "",PropSubscriptionIdentifier 4,PropSessionExpiryInterval
// 7130,PropSessionExpiryInterval 22723,PropAuthenticationData ":\GSnz\203iH\213\136\159",PropRetainAvailable
// 210,PropTopicAlias 27169,PropSubscriptionIdentifier 10,PropResponseTopic
// "\148\US\206\ETB\251\154o\244\168\150p\199r\196\185-\178\253\&3\a\196P\r \253\220\a\SOH\192"]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0xc1, 0x1,  0x60, 0x9f, 0x62, 0x8,  0x0,  0xe,  0x60, 0x65, 0x45, 0x99, 0x1a, 0x43, 0xb3, 0x16,
                   0xcb, 0xdd, 0x18, 0xd1, 0x9,  0x6,  0x2a, 0x84, 0x22, 0xd,  0xd8, 0x26, 0x0,  0x7,  0xbd, 0xea, 0x58,
                   0xf4, 0x17, 0xc0, 0xd8, 0x0,  0x0,  0xb,  0x4,  0x11, 0x0,  0x0,  0x1b, 0xda, 0x11, 0x0,  0x0,  0x58,
                   0xc3, 0x16, 0x0,  0xa,  0x3a, 0x1d, 0x6e, 0x7a, 0xcb, 0x69, 0x48, 0xd5, 0x88, 0x9f, 0x25, 0xd2, 0x23,
                   0x6a, 0x21, 0xb,  0xa,  0x8,  0x0,  0x1d, 0x94, 0x1f, 0xce, 0x17, 0xfb, 0x9a, 0x6f, 0xf4, 0xa8, 0x96,
                   0x70, 0xc7, 0x72, 0xc4, 0xb9, 0x2d, 0xb2, 0xfd, 0x33, 0x7,  0xc4, 0x50, 0xd,  0x20, 0xfd, 0xdc, 0x7,
                   0x1,  0xc0, 0x0,  0x3,  0x49, 0xb8, 0xc1, 0x6,  0x0,  0xc,  0x43, 0xe7, 0x78, 0x29, 0x22, 0x35, 0x4,
                   0x92, 0x9e, 0x15, 0xb5, 0x2c, 0x26, 0x0,  0x18, 0xfb, 0xa,  0x28, 0x21, 0x6b, 0xcd, 0xc1, 0x75, 0xd0,
                   0x3c, 0xcd, 0x67, 0x2e, 0xdf, 0x51, 0x1f, 0xbb, 0x5b, 0xe8, 0x5c, 0xce, 0x10, 0x94, 0xca, 0x19, 0x0,
                   0x1,  0x29, 0xc,  0x0,  0x17, 0x5f, 0xcc, 0xd1, 0xe1, 0x7b, 0xc2, 0xa5, 0x34, 0xde, 0x27, 0x10, 0xd9,
                   0x9d, 0x56, 0x75, 0x36, 0x47, 0x37, 0xb5, 0xbd, 0x13, 0x29, 0x71, 0x2e, 0x0,  0xb,  0x5f, 0x36, 0x95,
                   0xd7, 0x33, 0x5,  0x85, 0xf4, 0x3c, 0x8,  0x21, 0x25};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x49, 0xb8, 0xc1};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x43, 0xe7, 0x78, 0x29, 0x22, 0x35, 0x4, 0x92, 0x9e, 0x15, 0xb5, 0x2c};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfb, 0xa,  0x28, 0x21, 0x6b, 0xcd, 0xc1, 0x75, 0xd0, 0x3c, 0xcd, 0x67,
                                     0x2e, 0xdf, 0x51, 0x1f, 0xbb, 0x5b, 0xe8, 0x5c, 0xce, 0x10, 0x94, 0xca};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x29};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5f, 0xcc, 0xd1, 0xe1, 0x7b, 0xc2, 0xa5, 0x34, 0xde, 0x27, 0x10, 0xd9,
                                     0x9d, 0x56, 0x75, 0x36, 0x47, 0x37, 0xb5, 0xbd, 0x13, 0x29, 0x71};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5f, 0x36, 0x95, 0xd7, 0x33, 0x5, 0x85, 0xf4, 0x3c, 0x8, 0x21};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0x60, 0x65, 0x45, 0x99, 0x1a, 0x43, 0xb3, 0x16, 0xcb, 0xdd, 0x18, 0xd1, 0x9, 0x6};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops1[] = {0xbd, 0xea, 0x58, 0xf4, 0x17, 0xc0, 0xd8};
  uint8_t bytesprops3[] = {0x3a, 0x1d, 0x6e, 0x7a, 0xcb, 0x69, 0x48, 0xd5, 0x88, 0x9f};
  uint8_t bytesprops4[] = {0x94, 0x1f, 0xce, 0x17, 0xfb, 0x9a, 0x6f, 0xf4, 0xa8, 0x96, 0x70, 0xc7, 0x72, 0xc4, 0xb9,
                           0x2d, 0xb2, 0xfd, 0x33, 0x7,  0xc4, 0x50, 0xd,  0x20, 0xfd, 0xdc, 0x7,  0x1,  0xc0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3544}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops1}, .v = {0, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7130}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22723}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27169}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24735, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31752 [("_\219L\240F\160\245'\201\213\145D\221\235\219\250\233\&8\211\&6\154\154\235",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\205g~\180H*@/\252|\213\208\227\DC1\184-\238\128\169\237E",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\186\144",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("p\172",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("E\ETB\215\130\164\130",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal
// = False, _subQoS = QoS0}),("\v\203N\139\228\165wx\175\155\n\231\195\176",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] [PropSubscriptionIdentifier
// 2,PropTopicAliasMaximum 19084,PropSharedSubscriptionAvailable 18,PropAssignedClientIdentifier
// "\183\tTVl\186\181\247\178\171\165\229r}\218\&2F\219\173a",PropWillDelayInterval 16542,PropResponseTopic
// "<\242n,\241U\149\STX\148`\177\157n\252%\164'\187\187\165q\a\SYNz\178d",PropUserProperty
// "!\231\NAKl\161jI\130\&5\151z\237\142\STX\239\137\165N\235\202\216\DC4\150\224\164o\167Y\SYN\v"
// "\176\NAK\174&\SOH\149\188\225\DELr`1\DC4?\144<\194\244\133\168,CrG",PropCorrelationData
// "\171\171\133Z?ge!p4S\FSV\231\169\183\170\190b\201\ETX!\128\\",PropAuthenticationMethod
// "e^}v\204\245\205\vic\130@:\185 W\230\225)\ESCY!RP",PropResponseTopic "0N\168\235\166\216>\165\ACKg",PropTopicAlias
// 14415,PropServerKeepAlive 16075,PropSessionExpiryInterval 7034,PropAssignedClientIdentifier "",PropCorrelationData
// ".\184l$\168\168\209\&5Na\ETX",PropRetainAvailable 204,PropAuthenticationData "",PropContentType
// "\130\NUL\215\NAK\197\154\172\188F\200z\RS\131,1\200mng",PropTopicAliasMaximum 20411,PropRetainAvailable
// 78,PropSharedSubscriptionAvailable 227,PropWildcardSubscriptionAvailable 58,PropMessageExpiryInterval 9835]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x82, 0xdd, 0x2,  0x7c, 0x8,  0x83, 0x2,  0xb,  0x2,  0x22, 0x4a, 0x8c, 0x2a, 0x12, 0x12, 0x0,  0x14, 0xb7, 0x9,
      0x54, 0x56, 0x6c, 0xba, 0xb5, 0xf7, 0xb2, 0xab, 0xa5, 0xe5, 0x72, 0x7d, 0xda, 0x32, 0x46, 0xdb, 0xad, 0x61, 0x18,
      0x0,  0x0,  0x40, 0x9e, 0x8,  0x0,  0x1a, 0x3c, 0xf2, 0x6e, 0x2c, 0xf1, 0x55, 0x95, 0x2,  0x94, 0x60, 0xb1, 0x9d,
      0x6e, 0xfc, 0x25, 0xa4, 0x27, 0xbb, 0xbb, 0xa5, 0x71, 0x7,  0x16, 0x7a, 0xb2, 0x64, 0x26, 0x0,  0x1e, 0x21, 0xe7,
      0x15, 0x6c, 0xa1, 0x6a, 0x49, 0x82, 0x35, 0x97, 0x7a, 0xed, 0x8e, 0x2,  0xef, 0x89, 0xa5, 0x4e, 0xeb, 0xca, 0xd8,
      0x14, 0x96, 0xe0, 0xa4, 0x6f, 0xa7, 0x59, 0x16, 0xb,  0x0,  0x18, 0xb0, 0x15, 0xae, 0x26, 0x1,  0x95, 0xbc, 0xe1,
      0x7f, 0x72, 0x60, 0x31, 0x14, 0x3f, 0x90, 0x3c, 0xc2, 0xf4, 0x85, 0xa8, 0x2c, 0x43, 0x72, 0x47, 0x9,  0x0,  0x18,
      0xab, 0xab, 0x85, 0x5a, 0x3f, 0x67, 0x65, 0x21, 0x70, 0x34, 0x53, 0x1c, 0x56, 0xe7, 0xa9, 0xb7, 0xaa, 0xbe, 0x62,
      0xc9, 0x3,  0x21, 0x80, 0x5c, 0x15, 0x0,  0x18, 0x65, 0x5e, 0x7d, 0x76, 0xcc, 0xf5, 0xcd, 0xb,  0x69, 0x63, 0x82,
      0x40, 0x3a, 0xb9, 0x20, 0x57, 0xe6, 0xe1, 0x29, 0x1b, 0x59, 0x21, 0x52, 0x50, 0x8,  0x0,  0xa,  0x30, 0x4e, 0xa8,
      0xeb, 0xa6, 0xd8, 0x3e, 0xa5, 0x6,  0x67, 0x23, 0x38, 0x4f, 0x13, 0x3e, 0xcb, 0x11, 0x0,  0x0,  0x1b, 0x7a, 0x12,
      0x0,  0x0,  0x9,  0x0,  0xb,  0x2e, 0xb8, 0x6c, 0x24, 0xa8, 0xa8, 0xd1, 0x35, 0x4e, 0x61, 0x3,  0x25, 0xcc, 0x16,
      0x0,  0x0,  0x3,  0x0,  0x13, 0x82, 0x0,  0xd7, 0x15, 0xc5, 0x9a, 0xac, 0xbc, 0x46, 0xc8, 0x7a, 0x1e, 0x83, 0x2c,
      0x31, 0xc8, 0x6d, 0x6e, 0x67, 0x22, 0x4f, 0xbb, 0x25, 0x4e, 0x2a, 0xe3, 0x28, 0x3a, 0x2,  0x0,  0x0,  0x26, 0x6b,
      0x0,  0x17, 0x5f, 0xdb, 0x4c, 0xf0, 0x46, 0xa0, 0xf5, 0x27, 0xc9, 0xd5, 0x91, 0x44, 0xdd, 0xeb, 0xdb, 0xfa, 0xe9,
      0x38, 0xd3, 0x36, 0x9a, 0x9a, 0xeb, 0x5,  0x0,  0x15, 0xcd, 0x67, 0x7e, 0xb4, 0x48, 0x2a, 0x40, 0x2f, 0xfc, 0x7c,
      0xd5, 0xd0, 0xe3, 0x11, 0xb8, 0x2d, 0xee, 0x80, 0xa9, 0xed, 0x45, 0x19, 0x0,  0x2,  0xba, 0x90, 0x4,  0x0,  0x2,
      0x70, 0xac, 0x11, 0x0,  0x6,  0x45, 0x17, 0xd7, 0x82, 0xa4, 0x82, 0x18, 0x0,  0xe,  0xb,  0xcb, 0x4e, 0x8b, 0xe4,
      0xa5, 0x77, 0x78, 0xaf, 0x9b, 0xa,  0xe7, 0xc3, 0xb0, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x5f, 0xdb, 0x4c, 0xf0, 0x46, 0xa0, 0xf5, 0x27, 0xc9, 0xd5, 0x91, 0x44,
                                     0xdd, 0xeb, 0xdb, 0xfa, 0xe9, 0x38, 0xd3, 0x36, 0x9a, 0x9a, 0xeb};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcd, 0x67, 0x7e, 0xb4, 0x48, 0x2a, 0x40, 0x2f, 0xfc, 0x7c, 0xd5,
                                     0xd0, 0xe3, 0x11, 0xb8, 0x2d, 0xee, 0x80, 0xa9, 0xed, 0x45};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xba, 0x90};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x70, 0xac};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x45, 0x17, 0xd7, 0x82, 0xa4, 0x82};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb, 0xcb, 0x4e, 0x8b, 0xe4, 0xa5, 0x77, 0x78, 0xaf, 0x9b, 0xa, 0xe7, 0xc3, 0xb0};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0xb7, 0x9,  0x54, 0x56, 0x6c, 0xba, 0xb5, 0xf7, 0xb2, 0xab,
                           0xa5, 0xe5, 0x72, 0x7d, 0xda, 0x32, 0x46, 0xdb, 0xad, 0x61};
  uint8_t bytesprops1[] = {0x3c, 0xf2, 0x6e, 0x2c, 0xf1, 0x55, 0x95, 0x2,  0x94, 0x60, 0xb1, 0x9d, 0x6e,
                           0xfc, 0x25, 0xa4, 0x27, 0xbb, 0xbb, 0xa5, 0x71, 0x7,  0x16, 0x7a, 0xb2, 0x64};
  uint8_t bytesprops3[] = {0xb0, 0x15, 0xae, 0x26, 0x1,  0x95, 0xbc, 0xe1, 0x7f, 0x72, 0x60, 0x31,
                           0x14, 0x3f, 0x90, 0x3c, 0xc2, 0xf4, 0x85, 0xa8, 0x2c, 0x43, 0x72, 0x47};
  uint8_t bytesprops2[] = {0x21, 0xe7, 0x15, 0x6c, 0xa1, 0x6a, 0x49, 0x82, 0x35, 0x97, 0x7a, 0xed, 0x8e, 0x2,  0xef,
                           0x89, 0xa5, 0x4e, 0xeb, 0xca, 0xd8, 0x14, 0x96, 0xe0, 0xa4, 0x6f, 0xa7, 0x59, 0x16, 0xb};
  uint8_t bytesprops4[] = {0xab, 0xab, 0x85, 0x5a, 0x3f, 0x67, 0x65, 0x21, 0x70, 0x34, 0x53, 0x1c,
                           0x56, 0xe7, 0xa9, 0xb7, 0xaa, 0xbe, 0x62, 0xc9, 0x3,  0x21, 0x80, 0x5c};
  uint8_t bytesprops5[] = {0x65, 0x5e, 0x7d, 0x76, 0xcc, 0xf5, 0xcd, 0xb,  0x69, 0x63, 0x82, 0x40,
                           0x3a, 0xb9, 0x20, 0x57, 0xe6, 0xe1, 0x29, 0x1b, 0x59, 0x21, 0x52, 0x50};
  uint8_t bytesprops6[] = {0x30, 0x4e, 0xa8, 0xeb, 0xa6, 0xd8, 0x3e, 0xa5, 0x6, 0x67};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0x2e, 0xb8, 0x6c, 0x24, 0xa8, 0xa8, 0xd1, 0x35, 0x4e, 0x61, 0x3};
  uint8_t bytesprops9[] = {0};
  uint8_t bytesprops10[] = {0x82, 0x0,  0xd7, 0x15, 0xc5, 0x9a, 0xac, 0xbc, 0x46, 0xc8,
                            0x7a, 0x1e, 0x83, 0x2c, 0x31, 0xc8, 0x6d, 0x6e, 0x67};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19084}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16542}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops2}, .v = {24, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14415}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16075}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7034}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20411}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9835}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 31752, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12709 [("\132\197\232\176\128>\167\NAKa",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\178\242Do\205\129\176\135\169\245\194\STXX|\196\207\227\196\169\\\DLE\175\138\200\v\186\135yL\172",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("@f\171\247\189\153\191\162\&66\248\191:\167\234nw\220R\195\&3\SOH72\235\a\EOTx",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\241\135Z\182\210O\202\248\&6\NAK\215\DC2\217\EOT\171\128\173.\183\138qM]l\198_",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("{\ESCA\ETX\233J}\147\DC3",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\242L\245\r\189\187\206",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("{4\GS\t\194H\206\FS\176",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\203\247\\`[\193",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\153\164\176\228\218\162\198\231\SI\135_\\P\249\176\169\200S",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("8\193\250\178\180`\161\204\240\245\129/\NAK\137\242\233f\NUL\179\171\US\157\197tX'",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\193\229\147&\176\150P\DC1}\195\SI\203!V\185\SO-YK\193\131K\195\149\211",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})] [PropWillDelayInterval
// 2229,PropSubscriptionIdentifier 19,PropRequestResponseInformation 88,PropSessionExpiryInterval
// 25640,PropWillDelayInterval 29275,PropResponseInformation
// "\DC4\240\232\247\149\179\237\218xHW\DLEp\157\171\&3\NAKs\129P~\174",PropRequestProblemInformation
// 118,PropRequestResponseInformation 219,PropCorrelationData "*\250\201h\v",PropAssignedClientIdentifier
// "",PropServerReference "@\245\220\131\163\182Q~\134\RS\220\&2\138+Le!H\155\152\187\195",PropWillDelayInterval
// 27690,PropMessageExpiryInterval 15595,PropUserProperty ""
// "\199_\140\137\236\USt\188c\249n\137kF#\r\153e\157RqA}\165\235\232",PropServerReference "K\n\SYN",PropServerReference
// "\239\162\DC1\229i\233\150\187=\n\204\226\153\243\199\234\167N+jY\136\214\175\155\182",PropSubscriptionIdentifierAvailable
// 171,PropTopicAliasMaximum 22343,PropUserProperty "\SYN\134g,,\177"
// "*<\184i\157@\NUL\249\137\171e]\196\235\151./>!*\FS'\170\252\252\213#",PropUserProperty
// "&\134\v\150^\SOo{\209\211l\229\239^:"
// "9\140\NUL\248A\DEL\199F\246\130\DC2\138Qt\233\DELY\187\DELON\229\199\&6E\149\172",PropWillDelayInterval
// 26714,PropSessionExpiryInterval 31256,PropTopicAliasMaximum 6163,PropAssignedClientIdentifier
// "\178\FS\211\248\191\&8\154\186\134Fv\163\199X\235\196/\236\164\SYN\152\192\232'\251PJ)W",PropMessageExpiryInterval
// 16327,PropReasonString "DH\248\248x\174\176\191 \155\128\t\237\140\191\239",PropWildcardSubscriptionAvailable
// 228,PropTopicAliasMaximum 3438,PropContentType "\173$\173\240\178\187\171\nJ\172~8\\",PropPayloadFormatIndicator 150]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x82, 0xbc, 0x4,  0x31, 0xa5, 0xd6, 0x2,  0x18, 0x0,  0x0,  0x8,  0xb5, 0xb,  0x13, 0x19, 0x58, 0x11, 0x0,  0x0,
      0x64, 0x28, 0x18, 0x0,  0x0,  0x72, 0x5b, 0x1a, 0x0,  0x16, 0x14, 0xf0, 0xe8, 0xf7, 0x95, 0xb3, 0xed, 0xda, 0x78,
      0x48, 0x57, 0x10, 0x70, 0x9d, 0xab, 0x33, 0x15, 0x73, 0x81, 0x50, 0x7e, 0xae, 0x17, 0x76, 0x19, 0xdb, 0x9,  0x0,
      0x5,  0x2a, 0xfa, 0xc9, 0x68, 0xb,  0x12, 0x0,  0x0,  0x1c, 0x0,  0x16, 0x40, 0xf5, 0xdc, 0x83, 0xa3, 0xb6, 0x51,
      0x7e, 0x86, 0x1e, 0xdc, 0x32, 0x8a, 0x2b, 0x4c, 0x65, 0x21, 0x48, 0x9b, 0x98, 0xbb, 0xc3, 0x18, 0x0,  0x0,  0x6c,
      0x2a, 0x2,  0x0,  0x0,  0x3c, 0xeb, 0x26, 0x0,  0x0,  0x0,  0x1a, 0xc7, 0x5f, 0x8c, 0x89, 0xec, 0x1f, 0x74, 0xbc,
      0x63, 0xf9, 0x6e, 0x89, 0x6b, 0x46, 0x23, 0xd,  0x99, 0x65, 0x9d, 0x52, 0x71, 0x41, 0x7d, 0xa5, 0xeb, 0xe8, 0x1c,
      0x0,  0x3,  0x4b, 0xa,  0x16, 0x1c, 0x0,  0x1a, 0xef, 0xa2, 0x11, 0xe5, 0x69, 0xe9, 0x96, 0xbb, 0x3d, 0xa,  0xcc,
      0xe2, 0x99, 0xf3, 0xc7, 0xea, 0xa7, 0x4e, 0x2b, 0x6a, 0x59, 0x88, 0xd6, 0xaf, 0x9b, 0xb6, 0x29, 0xab, 0x22, 0x57,
      0x47, 0x26, 0x0,  0x6,  0x16, 0x86, 0x67, 0x2c, 0x2c, 0xb1, 0x0,  0x1b, 0x2a, 0x3c, 0xb8, 0x69, 0x9d, 0x40, 0x0,
      0xf9, 0x89, 0xab, 0x65, 0x5d, 0xc4, 0xeb, 0x97, 0x2e, 0x2f, 0x3e, 0x21, 0x2a, 0x1c, 0x27, 0xaa, 0xfc, 0xfc, 0xd5,
      0x23, 0x26, 0x0,  0xf,  0x26, 0x86, 0xb,  0x96, 0x5e, 0xe,  0x6f, 0x7b, 0xd1, 0xd3, 0x6c, 0xe5, 0xef, 0x5e, 0x3a,
      0x0,  0x1b, 0x39, 0x8c, 0x0,  0xf8, 0x41, 0x7f, 0xc7, 0x46, 0xf6, 0x82, 0x12, 0x8a, 0x51, 0x74, 0xe9, 0x7f, 0x59,
      0xbb, 0x7f, 0x4f, 0x4e, 0xe5, 0xc7, 0x36, 0x45, 0x95, 0xac, 0x18, 0x0,  0x0,  0x68, 0x5a, 0x11, 0x0,  0x0,  0x7a,
      0x18, 0x22, 0x18, 0x13, 0x12, 0x0,  0x1d, 0xb2, 0x1c, 0xd3, 0xf8, 0xbf, 0x38, 0x9a, 0xba, 0x86, 0x46, 0x76, 0xa3,
      0xc7, 0x58, 0xeb, 0xc4, 0x2f, 0xec, 0xa4, 0x16, 0x98, 0xc0, 0xe8, 0x27, 0xfb, 0x50, 0x4a, 0x29, 0x57, 0x2,  0x0,
      0x0,  0x3f, 0xc7, 0x1f, 0x0,  0x10, 0x44, 0x48, 0xf8, 0xf8, 0x78, 0xae, 0xb0, 0xbf, 0x20, 0x9b, 0x80, 0x9,  0xed,
      0x8c, 0xbf, 0xef, 0x28, 0xe4, 0x22, 0xd,  0x6e, 0x3,  0x0,  0xd,  0xad, 0x24, 0xad, 0xf0, 0xb2, 0xbb, 0xab, 0xa,
      0x4a, 0xac, 0x7e, 0x38, 0x5c, 0x1,  0x96, 0x0,  0x9,  0x84, 0xc5, 0xe8, 0xb0, 0x80, 0x3e, 0xa7, 0x15, 0x61, 0x11,
      0x0,  0x1e, 0xb2, 0xf2, 0x44, 0x6f, 0xcd, 0x81, 0xb0, 0x87, 0xa9, 0xf5, 0xc2, 0x2,  0x58, 0x7c, 0xc4, 0xcf, 0xe3,
      0xc4, 0xa9, 0x5c, 0x10, 0xaf, 0x8a, 0xc8, 0xb,  0xba, 0x87, 0x79, 0x4c, 0xac, 0x0,  0x0,  0x1c, 0x40, 0x66, 0xab,
      0xf7, 0xbd, 0x99, 0xbf, 0xa2, 0x36, 0x36, 0xf8, 0xbf, 0x3a, 0xa7, 0xea, 0x6e, 0x77, 0xdc, 0x52, 0xc3, 0x33, 0x1,
      0x37, 0x32, 0xeb, 0x7,  0x4,  0x78, 0x29, 0x0,  0x1a, 0xf1, 0x87, 0x5a, 0xb6, 0xd2, 0x4f, 0xca, 0xf8, 0x36, 0x15,
      0xd7, 0x12, 0xd9, 0x4,  0xab, 0x80, 0xad, 0x2e, 0xb7, 0x8a, 0x71, 0x4d, 0x5d, 0x6c, 0xc6, 0x5f, 0x11, 0x0,  0x9,
      0x7b, 0x1b, 0x41, 0x3,  0xe9, 0x4a, 0x7d, 0x93, 0x13, 0x12, 0x0,  0x7,  0xf2, 0x4c, 0xf5, 0xd,  0xbd, 0xbb, 0xce,
      0xd,  0x0,  0x9,  0x7b, 0x34, 0x1d, 0x9,  0xc2, 0x48, 0xce, 0x1c, 0xb0, 0x11, 0x0,  0x6,  0xcb, 0xf7, 0x5c, 0x60,
      0x5b, 0xc1, 0x2e, 0x0,  0x12, 0x99, 0xa4, 0xb0, 0xe4, 0xda, 0xa2, 0xc6, 0xe7, 0xf,  0x87, 0x5f, 0x5c, 0x50, 0xf9,
      0xb0, 0xa9, 0xc8, 0x53, 0x1a, 0x0,  0x1a, 0x38, 0xc1, 0xfa, 0xb2, 0xb4, 0x60, 0xa1, 0xcc, 0xf0, 0xf5, 0x81, 0x2f,
      0x15, 0x89, 0xf2, 0xe9, 0x66, 0x0,  0xb3, 0xab, 0x1f, 0x9d, 0xc5, 0x74, 0x58, 0x27, 0x12, 0x0,  0x19, 0xc1, 0xe5,
      0x93, 0x26, 0xb0, 0x96, 0x50, 0x11, 0x7d, 0xc3, 0xf,  0xcb, 0x21, 0x56, 0xb9, 0xe,  0x2d, 0x59, 0x4b, 0xc1, 0x83,
      0x4b, 0xc3, 0x95, 0xd3, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x84, 0xc5, 0xe8, 0xb0, 0x80, 0x3e, 0xa7, 0x15, 0x61};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb2, 0xf2, 0x44, 0x6f, 0xcd, 0x81, 0xb0, 0x87, 0xa9, 0xf5,
                                     0xc2, 0x2,  0x58, 0x7c, 0xc4, 0xcf, 0xe3, 0xc4, 0xa9, 0x5c,
                                     0x10, 0xaf, 0x8a, 0xc8, 0xb,  0xba, 0x87, 0x79, 0x4c, 0xac};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x40, 0x66, 0xab, 0xf7, 0xbd, 0x99, 0xbf, 0xa2, 0x36, 0x36,
                                     0xf8, 0xbf, 0x3a, 0xa7, 0xea, 0x6e, 0x77, 0xdc, 0x52, 0xc3,
                                     0x33, 0x1,  0x37, 0x32, 0xeb, 0x7,  0x4,  0x78};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf1, 0x87, 0x5a, 0xb6, 0xd2, 0x4f, 0xca, 0xf8, 0x36, 0x15, 0xd7, 0x12, 0xd9,
                                     0x4,  0xab, 0x80, 0xad, 0x2e, 0xb7, 0x8a, 0x71, 0x4d, 0x5d, 0x6c, 0xc6, 0x5f};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7b, 0x1b, 0x41, 0x3, 0xe9, 0x4a, 0x7d, 0x93, 0x13};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf2, 0x4c, 0xf5, 0xd, 0xbd, 0xbb, 0xce};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x7b, 0x34, 0x1d, 0x9, 0xc2, 0x48, 0xce, 0x1c, 0xb0};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xcb, 0xf7, 0x5c, 0x60, 0x5b, 0xc1};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x99, 0xa4, 0xb0, 0xe4, 0xda, 0xa2, 0xc6, 0xe7, 0xf,
                                     0x87, 0x5f, 0x5c, 0x50, 0xf9, 0xb0, 0xa9, 0xc8, 0x53};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x38, 0xc1, 0xfa, 0xb2, 0xb4, 0x60, 0xa1, 0xcc, 0xf0, 0xf5, 0x81, 0x2f, 0x15,
                                     0x89, 0xf2, 0xe9, 0x66, 0x0,  0xb3, 0xab, 0x1f, 0x9d, 0xc5, 0x74, 0x58, 0x27};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xc1, 0xe5, 0x93, 0x26, 0xb0, 0x96, 0x50, 0x11, 0x7d, 0xc3, 0xf,  0xcb, 0x21,
                                      0x56, 0xb9, 0xe,  0x2d, 0x59, 0x4b, 0xc1, 0x83, 0x4b, 0xc3, 0x95, 0xd3};
  lwmqtt_string_t topic_filter_s10 = {25, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0x14, 0xf0, 0xe8, 0xf7, 0x95, 0xb3, 0xed, 0xda, 0x78, 0x48, 0x57,
                           0x10, 0x70, 0x9d, 0xab, 0x33, 0x15, 0x73, 0x81, 0x50, 0x7e, 0xae};
  uint8_t bytesprops1[] = {0x2a, 0xfa, 0xc9, 0x68, 0xb};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x40, 0xf5, 0xdc, 0x83, 0xa3, 0xb6, 0x51, 0x7e, 0x86, 0x1e, 0xdc,
                           0x32, 0x8a, 0x2b, 0x4c, 0x65, 0x21, 0x48, 0x9b, 0x98, 0xbb, 0xc3};
  uint8_t bytesprops5[] = {0xc7, 0x5f, 0x8c, 0x89, 0xec, 0x1f, 0x74, 0xbc, 0x63, 0xf9, 0x6e, 0x89, 0x6b,
                           0x46, 0x23, 0xd,  0x99, 0x65, 0x9d, 0x52, 0x71, 0x41, 0x7d, 0xa5, 0xeb, 0xe8};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops6[] = {0x4b, 0xa, 0x16};
  uint8_t bytesprops7[] = {0xef, 0xa2, 0x11, 0xe5, 0x69, 0xe9, 0x96, 0xbb, 0x3d, 0xa,  0xcc, 0xe2, 0x99,
                           0xf3, 0xc7, 0xea, 0xa7, 0x4e, 0x2b, 0x6a, 0x59, 0x88, 0xd6, 0xaf, 0x9b, 0xb6};
  uint8_t bytesprops9[] = {0x2a, 0x3c, 0xb8, 0x69, 0x9d, 0x40, 0x0,  0xf9, 0x89, 0xab, 0x65, 0x5d, 0xc4, 0xeb,
                           0x97, 0x2e, 0x2f, 0x3e, 0x21, 0x2a, 0x1c, 0x27, 0xaa, 0xfc, 0xfc, 0xd5, 0x23};
  uint8_t bytesprops8[] = {0x16, 0x86, 0x67, 0x2c, 0x2c, 0xb1};
  uint8_t bytesprops11[] = {0x39, 0x8c, 0x0,  0xf8, 0x41, 0x7f, 0xc7, 0x46, 0xf6, 0x82, 0x12, 0x8a, 0x51, 0x74,
                            0xe9, 0x7f, 0x59, 0xbb, 0x7f, 0x4f, 0x4e, 0xe5, 0xc7, 0x36, 0x45, 0x95, 0xac};
  uint8_t bytesprops10[] = {0x26, 0x86, 0xb, 0x96, 0x5e, 0xe, 0x6f, 0x7b, 0xd1, 0xd3, 0x6c, 0xe5, 0xef, 0x5e, 0x3a};
  uint8_t bytesprops12[] = {0xb2, 0x1c, 0xd3, 0xf8, 0xbf, 0x38, 0x9a, 0xba, 0x86, 0x46, 0x76, 0xa3, 0xc7, 0x58, 0xeb,
                            0xc4, 0x2f, 0xec, 0xa4, 0x16, 0x98, 0xc0, 0xe8, 0x27, 0xfb, 0x50, 0x4a, 0x29, 0x57};
  uint8_t bytesprops13[] = {0x44, 0x48, 0xf8, 0xf8, 0x78, 0xae, 0xb0, 0xbf,
                            0x20, 0x9b, 0x80, 0x9,  0xed, 0x8c, 0xbf, 0xef};
  uint8_t bytesprops14[] = {0xad, 0x24, 0xad, 0xf0, 0xb2, 0xbb, 0xab, 0xa, 0x4a, 0xac, 0x7e, 0x38, 0x5c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2229}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 19}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25640}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29275}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27690}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15595}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops4}, .v = {26, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22343}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops8}, .v = {27, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {15, (char*)&bytesprops10}, .v = {27, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26714}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31256}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6163}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16327}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3438}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 150}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12709, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14473 [("\173\230\ESC\133\246\196\156\135\200q|\DC2\188\236\FS\153\183\SO\142b",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\CAN\192\&41\164\131Z8\251)\173>\128\193\211\222\167G\162\167\149}\129\174",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("g\226\&6wT\129\254\179\NUL\228\163\218\238\131\130\198\131\172\r\"\223\195\172\130",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("u\138\167\DEL\SI\167\172\136\244\217\249\185\239B\228y",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("\193\254#\159\210\150\130\"\250",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\236\179\227\206P\141i\DC3\EM\237\243\232\"cG\151\199\190I",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropTopicAliasMaximum
// 7848,PropSessionExpiryInterval 28305,PropRetainAvailable 225,PropMessageExpiryInterval
// 4567,PropAssignedClientIdentifier "G\192\174\165~\DEL",PropMaximumQoS 183,PropUserProperty
// "\185\193\SYN\221\SO\a\200\192\139\162\DLE\160\&0\203\246\212Qi"
// "?\213\174\bf\SIV!ZS\175zUv\EOT\151\&3&",PropSessionExpiryInterval 20670,PropReasonString
// "y\USs\152\220fZ\248\SUB\128\213",PropSharedSubscriptionAvailable 149,PropCorrelationData
// "\249\154\ETB]\205\222(\249^\178\147+}E\244%\DLE\187y\250\&6\173\ENQa\228",PropAssignedClientIdentifier
// "\217\199\GS\158\EOTt\213Un@H\EOT\191",PropAuthenticationMethod
// "\186\&9\SI\210!\245\STX\153T\243X\250;\199\177Z\204\208\238\227ub\SUB6\STXyg\207G",PropRequestResponseInformation
// 63,PropMaximumPacketSize 31623,PropAuthenticationData
// "\228M\248\139\SO\177l\213A=\140\215\202\189\&8\a\149\241\DC1^0\185p\134\130\140B9",PropAssignedClientIdentifier
// "\255\&4\168\224_#\149\SO\EOT\245",PropServerReference
// "\201*n_\186\138hW\237\196<\177nD\174\153\203B\230^\236\151\DC4\SUB\n]\235\240\146\216",PropRequestResponseInformation
// 82,PropCorrelationData "\ESC\155E:\153\195\130\ETB^0\249}\SUB\185=n",PropRequestResponseInformation
// 153,PropReasonString "\240\&3\t5",PropTopicAlias 29714,PropWillDelayInterval 22439,PropTopicAlias
// 29750,PropRequestResponseInformation 201,PropSubscriptionIdentifierAvailable 27]
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x82, 0xab, 0x3,  0x38, 0x89, 0xa5, 0x2,  0x22, 0x1e, 0xa8, 0x11, 0x0,  0x0,  0x6e, 0x91, 0x25, 0xe1, 0x2,  0x0,
      0x0,  0x11, 0xd7, 0x12, 0x0,  0x6,  0x47, 0xc0, 0xae, 0xa5, 0x7e, 0x7f, 0x24, 0xb7, 0x26, 0x0,  0x12, 0xb9, 0xc1,
      0x16, 0xdd, 0xe,  0x7,  0xc8, 0xc0, 0x8b, 0xa2, 0x10, 0xa0, 0x30, 0xcb, 0xf6, 0xd4, 0x51, 0x69, 0x0,  0x12, 0x3f,
      0xd5, 0xae, 0x8,  0x66, 0xf,  0x56, 0x21, 0x5a, 0x53, 0xaf, 0x7a, 0x55, 0x76, 0x4,  0x97, 0x33, 0x26, 0x11, 0x0,
      0x0,  0x50, 0xbe, 0x1f, 0x0,  0xb,  0x79, 0x1f, 0x73, 0x98, 0xdc, 0x66, 0x5a, 0xf8, 0x1a, 0x80, 0xd5, 0x2a, 0x95,
      0x9,  0x0,  0x19, 0xf9, 0x9a, 0x17, 0x5d, 0xcd, 0xde, 0x28, 0xf9, 0x5e, 0xb2, 0x93, 0x2b, 0x7d, 0x45, 0xf4, 0x25,
      0x10, 0xbb, 0x79, 0xfa, 0x36, 0xad, 0x5,  0x61, 0xe4, 0x12, 0x0,  0xd,  0xd9, 0xc7, 0x1d, 0x9e, 0x4,  0x74, 0xd5,
      0x55, 0x6e, 0x40, 0x48, 0x4,  0xbf, 0x15, 0x0,  0x1d, 0xba, 0x39, 0xf,  0xd2, 0x21, 0xf5, 0x2,  0x99, 0x54, 0xf3,
      0x58, 0xfa, 0x3b, 0xc7, 0xb1, 0x5a, 0xcc, 0xd0, 0xee, 0xe3, 0x75, 0x62, 0x1a, 0x36, 0x2,  0x79, 0x67, 0xcf, 0x47,
      0x19, 0x3f, 0x27, 0x0,  0x0,  0x7b, 0x87, 0x16, 0x0,  0x1c, 0xe4, 0x4d, 0xf8, 0x8b, 0xe,  0xb1, 0x6c, 0xd5, 0x41,
      0x3d, 0x8c, 0xd7, 0xca, 0xbd, 0x38, 0x7,  0x95, 0xf1, 0x11, 0x5e, 0x30, 0xb9, 0x70, 0x86, 0x82, 0x8c, 0x42, 0x39,
      0x12, 0x0,  0xa,  0xff, 0x34, 0xa8, 0xe0, 0x5f, 0x23, 0x95, 0xe,  0x4,  0xf5, 0x1c, 0x0,  0x1e, 0xc9, 0x2a, 0x6e,
      0x5f, 0xba, 0x8a, 0x68, 0x57, 0xed, 0xc4, 0x3c, 0xb1, 0x6e, 0x44, 0xae, 0x99, 0xcb, 0x42, 0xe6, 0x5e, 0xec, 0x97,
      0x14, 0x1a, 0xa,  0x5d, 0xeb, 0xf0, 0x92, 0xd8, 0x19, 0x52, 0x9,  0x0,  0x10, 0x1b, 0x9b, 0x45, 0x3a, 0x99, 0xc3,
      0x82, 0x17, 0x5e, 0x30, 0xf9, 0x7d, 0x1a, 0xb9, 0x3d, 0x6e, 0x19, 0x99, 0x1f, 0x0,  0x4,  0xf0, 0x33, 0x9,  0x35,
      0x23, 0x74, 0x12, 0x18, 0x0,  0x0,  0x57, 0xa7, 0x23, 0x74, 0x36, 0x19, 0xc9, 0x29, 0x1b, 0x0,  0x14, 0xad, 0xe6,
      0x1b, 0x85, 0xf6, 0xc4, 0x9c, 0x87, 0xc8, 0x71, 0x7c, 0x12, 0xbc, 0xec, 0x1c, 0x99, 0xb7, 0xe,  0x8e, 0x62, 0x18,
      0x0,  0x18, 0x18, 0xc0, 0x34, 0x31, 0xa4, 0x83, 0x5a, 0x38, 0xfb, 0x29, 0xad, 0x3e, 0x80, 0xc1, 0xd3, 0xde, 0xa7,
      0x47, 0xa2, 0xa7, 0x95, 0x7d, 0x81, 0xae, 0x6,  0x0,  0x18, 0x67, 0xe2, 0x36, 0x77, 0x54, 0x81, 0xfe, 0xb3, 0x0,
      0xe4, 0xa3, 0xda, 0xee, 0x83, 0x82, 0xc6, 0x83, 0xac, 0xd,  0x22, 0xdf, 0xc3, 0xac, 0x82, 0x29, 0x0,  0x10, 0x75,
      0x8a, 0xa7, 0x7f, 0xf,  0xa7, 0xac, 0x88, 0xf4, 0xd9, 0xf9, 0xb9, 0xef, 0x42, 0xe4, 0x79, 0x18, 0x0,  0x9,  0xc1,
      0xfe, 0x23, 0x9f, 0xd2, 0x96, 0x82, 0x22, 0xfa, 0x2c, 0x0,  0x13, 0xec, 0xb3, 0xe3, 0xce, 0x50, 0x8d, 0x69, 0x13,
      0x19, 0xed, 0xf3, 0xe8, 0x22, 0x63, 0x47, 0x97, 0xc7, 0xbe, 0x49, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xad, 0xe6, 0x1b, 0x85, 0xf6, 0xc4, 0x9c, 0x87, 0xc8, 0x71,
                                     0x7c, 0x12, 0xbc, 0xec, 0x1c, 0x99, 0xb7, 0xe,  0x8e, 0x62};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x18, 0xc0, 0x34, 0x31, 0xa4, 0x83, 0x5a, 0x38, 0xfb, 0x29, 0xad, 0x3e,
                                     0x80, 0xc1, 0xd3, 0xde, 0xa7, 0x47, 0xa2, 0xa7, 0x95, 0x7d, 0x81, 0xae};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x67, 0xe2, 0x36, 0x77, 0x54, 0x81, 0xfe, 0xb3, 0x0,  0xe4, 0xa3, 0xda,
                                     0xee, 0x83, 0x82, 0xc6, 0x83, 0xac, 0xd,  0x22, 0xdf, 0xc3, 0xac, 0x82};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x75, 0x8a, 0xa7, 0x7f, 0xf,  0xa7, 0xac, 0x88,
                                     0xf4, 0xd9, 0xf9, 0xb9, 0xef, 0x42, 0xe4, 0x79};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc1, 0xfe, 0x23, 0x9f, 0xd2, 0x96, 0x82, 0x22, 0xfa};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xec, 0xb3, 0xe3, 0xce, 0x50, 0x8d, 0x69, 0x13, 0x19, 0xed,
                                     0xf3, 0xe8, 0x22, 0x63, 0x47, 0x97, 0xc7, 0xbe, 0x49};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0x47, 0xc0, 0xae, 0xa5, 0x7e, 0x7f};
  uint8_t bytesprops2[] = {0x3f, 0xd5, 0xae, 0x8,  0x66, 0xf, 0x56, 0x21, 0x5a,
                           0x53, 0xaf, 0x7a, 0x55, 0x76, 0x4, 0x97, 0x33, 0x26};
  uint8_t bytesprops1[] = {0xb9, 0xc1, 0x16, 0xdd, 0xe,  0x7,  0xc8, 0xc0, 0x8b,
                           0xa2, 0x10, 0xa0, 0x30, 0xcb, 0xf6, 0xd4, 0x51, 0x69};
  uint8_t bytesprops3[] = {0x79, 0x1f, 0x73, 0x98, 0xdc, 0x66, 0x5a, 0xf8, 0x1a, 0x80, 0xd5};
  uint8_t bytesprops4[] = {0xf9, 0x9a, 0x17, 0x5d, 0xcd, 0xde, 0x28, 0xf9, 0x5e, 0xb2, 0x93, 0x2b, 0x7d,
                           0x45, 0xf4, 0x25, 0x10, 0xbb, 0x79, 0xfa, 0x36, 0xad, 0x5,  0x61, 0xe4};
  uint8_t bytesprops5[] = {0xd9, 0xc7, 0x1d, 0x9e, 0x4, 0x74, 0xd5, 0x55, 0x6e, 0x40, 0x48, 0x4, 0xbf};
  uint8_t bytesprops6[] = {0xba, 0x39, 0xf,  0xd2, 0x21, 0xf5, 0x2,  0x99, 0x54, 0xf3, 0x58, 0xfa, 0x3b, 0xc7, 0xb1,
                           0x5a, 0xcc, 0xd0, 0xee, 0xe3, 0x75, 0x62, 0x1a, 0x36, 0x2,  0x79, 0x67, 0xcf, 0x47};
  uint8_t bytesprops7[] = {0xe4, 0x4d, 0xf8, 0x8b, 0xe,  0xb1, 0x6c, 0xd5, 0x41, 0x3d, 0x8c, 0xd7, 0xca, 0xbd,
                           0x38, 0x7,  0x95, 0xf1, 0x11, 0x5e, 0x30, 0xb9, 0x70, 0x86, 0x82, 0x8c, 0x42, 0x39};
  uint8_t bytesprops8[] = {0xff, 0x34, 0xa8, 0xe0, 0x5f, 0x23, 0x95, 0xe, 0x4, 0xf5};
  uint8_t bytesprops9[] = {0xc9, 0x2a, 0x6e, 0x5f, 0xba, 0x8a, 0x68, 0x57, 0xed, 0xc4, 0x3c, 0xb1, 0x6e, 0x44, 0xae,
                           0x99, 0xcb, 0x42, 0xe6, 0x5e, 0xec, 0x97, 0x14, 0x1a, 0xa,  0x5d, 0xeb, 0xf0, 0x92, 0xd8};
  uint8_t bytesprops10[] = {0x1b, 0x9b, 0x45, 0x3a, 0x99, 0xc3, 0x82, 0x17,
                            0x5e, 0x30, 0xf9, 0x7d, 0x1a, 0xb9, 0x3d, 0x6e};
  uint8_t bytesprops11[] = {0xf0, 0x33, 0x9, 0x35};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7848}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28305}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4567}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20670}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31623}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29714}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22439}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29750}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 27}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14473, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3580 [("\244E\204\&6O\ACKRSi\250\193:i*L\v{\159\212\243!\DLE\200o\175\172\236d\232\RS",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("N\248\172\a7\159\250\EM\227{\179\201O\161ZR\140\251\188\207\144\212\STX\173\150w",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\155W\251\fk<\195p\184\253\175A\162\210\ETB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("v\DLE\188\STXG!\142W\193\182\236H\NUL\fO$`\253e+\SO\214",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\163+\244m
// 1\138n\233\129sR\182\CAN\137\199(BB}\202\196m\231\208XEz\148",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("j\148\131KK\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Y\f\153\US\197\228\\\211\233\&9\CAN>\237\190\193\v\239\GSb",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("/\r\190",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("yL\254\155\&0U{\DLE\199\211\253\189\183F\149\222\US\218\186\b\175\DC2\252'\156",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\US&\190d\ETX~\239/\NAK\128\228\240io\227\DC1\SUB6\DC1\175 \153",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropTopicAliasMaximum
// 25272,PropTopicAliasMaximum 14579,PropRequestResponseInformation 189,PropTopicAlias 14505,PropReasonString
// "\163^'\163\136\DC3n\145k\214\ACK\250`\155",PropServerReference
// "\DC4\154\NUL\159v\144-\213\246\128\192nF\b{\CAN}P>\162Yw",PropResponseInformation
// "\NULn~})5",PropRequestProblemInformation 59,PropPayloadFormatIndicator 184,PropResponseTopic
// "\EOT\180V\182x;\252\163\&0\131\n8\EM\232",PropRequestProblemInformation 113,PropCorrelationData
// "2",PropWildcardSubscriptionAvailable 43,PropMaximumQoS 237,PropRequestResponseInformation
// 20,PropWildcardSubscriptionAvailable 253,PropAuthenticationData "h!Q,\206\184\215\128G\ETX",PropTopicAliasMaximum
// 7133,PropWillDelayInterval 32528,PropWildcardSubscriptionAvailable 162,PropRequestResponseInformation
// 48,PropServerKeepAlive 28613,PropMessageExpiryInterval 6419,PropContentType
// "\157Z\149\DC3\213\174\231\241\&1[\225\151\DEL+]\fT[\FS\243\198\206'sI\252>\148\ETB\194",PropResponseInformation
// ")v\160\t\228\210(VA\142\ESC\r\253Uw(so\248\244U\201K",PropServerKeepAlive 13558,PropSubscriptionIdentifierAvailable
// 122,PropRequestProblemInformation 192]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x82, 0xab, 0x3,  0xd,  0xfc, 0xc4, 0x1,  0x22, 0x62, 0xb8, 0x22, 0x38, 0xf3, 0x19, 0xbd, 0x23, 0x38, 0xa9, 0x1f,
      0x0,  0xe,  0xa3, 0x5e, 0x27, 0xa3, 0x88, 0x13, 0x6e, 0x91, 0x6b, 0xd6, 0x6,  0xfa, 0x60, 0x9b, 0x1c, 0x0,  0x16,
      0x14, 0x9a, 0x0,  0x9f, 0x76, 0x90, 0x2d, 0xd5, 0xf6, 0x80, 0xc0, 0x6e, 0x46, 0x8,  0x7b, 0x18, 0x7d, 0x50, 0x3e,
      0xa2, 0x59, 0x77, 0x1a, 0x0,  0x6,  0x0,  0x6e, 0x7e, 0x7d, 0x29, 0x35, 0x17, 0x3b, 0x1,  0xb8, 0x8,  0x0,  0xe,
      0x4,  0xb4, 0x56, 0xb6, 0x78, 0x3b, 0xfc, 0xa3, 0x30, 0x83, 0xa,  0x38, 0x19, 0xe8, 0x17, 0x71, 0x9,  0x0,  0x1,
      0x32, 0x28, 0x2b, 0x24, 0xed, 0x19, 0x14, 0x28, 0xfd, 0x16, 0x0,  0xa,  0x68, 0x21, 0x51, 0x2c, 0xce, 0xb8, 0xd7,
      0x80, 0x47, 0x3,  0x22, 0x1b, 0xdd, 0x18, 0x0,  0x0,  0x7f, 0x10, 0x28, 0xa2, 0x19, 0x30, 0x13, 0x6f, 0xc5, 0x2,
      0x0,  0x0,  0x19, 0x13, 0x3,  0x0,  0x1e, 0x9d, 0x5a, 0x95, 0x13, 0xd5, 0xae, 0xe7, 0xf1, 0x31, 0x5b, 0xe1, 0x97,
      0x7f, 0x2b, 0x5d, 0xc,  0x54, 0x5b, 0x1c, 0xf3, 0xc6, 0xce, 0x27, 0x73, 0x49, 0xfc, 0x3e, 0x94, 0x17, 0xc2, 0x1a,
      0x0,  0x17, 0x29, 0x76, 0xa0, 0x9,  0xe4, 0xd2, 0x28, 0x56, 0x41, 0x8e, 0x1b, 0xd,  0xfd, 0x55, 0x77, 0x28, 0x73,
      0x6f, 0xf8, 0xf4, 0x55, 0xc9, 0x4b, 0x13, 0x34, 0xf6, 0x29, 0x7a, 0x17, 0xc0, 0x0,  0x1e, 0xf4, 0x45, 0xcc, 0x36,
      0x4f, 0x6,  0x52, 0x53, 0x69, 0xfa, 0xc1, 0x3a, 0x69, 0x2a, 0x4c, 0xb,  0x7b, 0x9f, 0xd4, 0xf3, 0x21, 0x10, 0xc8,
      0x6f, 0xaf, 0xac, 0xec, 0x64, 0xe8, 0x1e, 0x12, 0x0,  0x1a, 0x4e, 0xf8, 0xac, 0x7,  0x37, 0x9f, 0xfa, 0x19, 0xe3,
      0x7b, 0xb3, 0xc9, 0x4f, 0xa1, 0x5a, 0x52, 0x8c, 0xfb, 0xbc, 0xcf, 0x90, 0xd4, 0x2,  0xad, 0x96, 0x77, 0x14, 0x0,
      0xf,  0x9b, 0x57, 0xfb, 0xc,  0x6b, 0x3c, 0xc3, 0x70, 0xb8, 0xfd, 0xaf, 0x41, 0xa2, 0xd2, 0x17, 0x8,  0x0,  0x16,
      0x76, 0x10, 0xbc, 0x2,  0x47, 0x21, 0x8e, 0x57, 0xc1, 0xb6, 0xec, 0x48, 0x0,  0xc,  0x4f, 0x24, 0x60, 0xfd, 0x65,
      0x2b, 0xe,  0xd6, 0x2d, 0x0,  0x1d, 0xa3, 0x2b, 0xf4, 0x6d, 0x20, 0x31, 0x8a, 0x6e, 0xe9, 0x81, 0x73, 0x52, 0xb6,
      0x18, 0x89, 0xc7, 0x28, 0x42, 0x42, 0x7d, 0xca, 0xc4, 0x6d, 0xe7, 0xd0, 0x58, 0x45, 0x7a, 0x94, 0x21, 0x0,  0x6,
      0x6a, 0x94, 0x83, 0x4b, 0x4b, 0x9b, 0x2,  0x0,  0x13, 0x59, 0xc,  0x99, 0x1f, 0xc5, 0xe4, 0x5c, 0xd3, 0xe9, 0x39,
      0x18, 0x3e, 0xed, 0xbe, 0xc1, 0xb,  0xef, 0x1d, 0x62, 0x9,  0x0,  0x3,  0x2f, 0xd,  0xbe, 0x8,  0x0,  0x19, 0x79,
      0x4c, 0xfe, 0x9b, 0x30, 0x55, 0x7b, 0x10, 0xc7, 0xd3, 0xfd, 0xbd, 0xb7, 0x46, 0x95, 0xde, 0x1f, 0xda, 0xba, 0x8,
      0xaf, 0x12, 0xfc, 0x27, 0x9c, 0x1a, 0x0,  0x16, 0x1f, 0x26, 0xbe, 0x64, 0x3,  0x7e, 0xef, 0x2f, 0x15, 0x80, 0xe4,
      0xf0, 0x69, 0x6f, 0xe3, 0x11, 0x1a, 0x36, 0x11, 0xaf, 0x20, 0x99, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0x45, 0xcc, 0x36, 0x4f, 0x6,  0x52, 0x53, 0x69, 0xfa,
                                     0xc1, 0x3a, 0x69, 0x2a, 0x4c, 0xb,  0x7b, 0x9f, 0xd4, 0xf3,
                                     0x21, 0x10, 0xc8, 0x6f, 0xaf, 0xac, 0xec, 0x64, 0xe8, 0x1e};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4e, 0xf8, 0xac, 0x7,  0x37, 0x9f, 0xfa, 0x19, 0xe3, 0x7b, 0xb3, 0xc9, 0x4f,
                                     0xa1, 0x5a, 0x52, 0x8c, 0xfb, 0xbc, 0xcf, 0x90, 0xd4, 0x2,  0xad, 0x96, 0x77};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9b, 0x57, 0xfb, 0xc,  0x6b, 0x3c, 0xc3, 0x70,
                                     0xb8, 0xfd, 0xaf, 0x41, 0xa2, 0xd2, 0x17};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x76, 0x10, 0xbc, 0x2,  0x47, 0x21, 0x8e, 0x57, 0xc1, 0xb6, 0xec,
                                     0x48, 0x0,  0xc,  0x4f, 0x24, 0x60, 0xfd, 0x65, 0x2b, 0xe,  0xd6};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa3, 0x2b, 0xf4, 0x6d, 0x20, 0x31, 0x8a, 0x6e, 0xe9, 0x81,
                                     0x73, 0x52, 0xb6, 0x18, 0x89, 0xc7, 0x28, 0x42, 0x42, 0x7d,
                                     0xca, 0xc4, 0x6d, 0xe7, 0xd0, 0x58, 0x45, 0x7a, 0x94};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6a, 0x94, 0x83, 0x4b, 0x4b, 0x9b};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x59, 0xc,  0x99, 0x1f, 0xc5, 0xe4, 0x5c, 0xd3, 0xe9, 0x39,
                                     0x18, 0x3e, 0xed, 0xbe, 0xc1, 0xb,  0xef, 0x1d, 0x62};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2f, 0xd, 0xbe};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x79, 0x4c, 0xfe, 0x9b, 0x30, 0x55, 0x7b, 0x10, 0xc7, 0xd3, 0xfd, 0xbd, 0xb7,
                                     0x46, 0x95, 0xde, 0x1f, 0xda, 0xba, 0x8,  0xaf, 0x12, 0xfc, 0x27, 0x9c};
  lwmqtt_string_t topic_filter_s8 = {25, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x1f, 0x26, 0xbe, 0x64, 0x3,  0x7e, 0xef, 0x2f, 0x15, 0x80, 0xe4,
                                     0xf0, 0x69, 0x6f, 0xe3, 0x11, 0x1a, 0x36, 0x11, 0xaf, 0x20, 0x99};
  lwmqtt_string_t topic_filter_s9 = {22, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  uint8_t bytesprops0[] = {0xa3, 0x5e, 0x27, 0xa3, 0x88, 0x13, 0x6e, 0x91, 0x6b, 0xd6, 0x6, 0xfa, 0x60, 0x9b};
  uint8_t bytesprops1[] = {0x14, 0x9a, 0x0, 0x9f, 0x76, 0x90, 0x2d, 0xd5, 0xf6, 0x80, 0xc0,
                           0x6e, 0x46, 0x8, 0x7b, 0x18, 0x7d, 0x50, 0x3e, 0xa2, 0x59, 0x77};
  uint8_t bytesprops2[] = {0x0, 0x6e, 0x7e, 0x7d, 0x29, 0x35};
  uint8_t bytesprops3[] = {0x4, 0xb4, 0x56, 0xb6, 0x78, 0x3b, 0xfc, 0xa3, 0x30, 0x83, 0xa, 0x38, 0x19, 0xe8};
  uint8_t bytesprops4[] = {0x32};
  uint8_t bytesprops5[] = {0x68, 0x21, 0x51, 0x2c, 0xce, 0xb8, 0xd7, 0x80, 0x47, 0x3};
  uint8_t bytesprops6[] = {0x9d, 0x5a, 0x95, 0x13, 0xd5, 0xae, 0xe7, 0xf1, 0x31, 0x5b, 0xe1, 0x97, 0x7f, 0x2b, 0x5d,
                           0xc,  0x54, 0x5b, 0x1c, 0xf3, 0xc6, 0xce, 0x27, 0x73, 0x49, 0xfc, 0x3e, 0x94, 0x17, 0xc2};
  uint8_t bytesprops7[] = {0x29, 0x76, 0xa0, 0x9,  0xe4, 0xd2, 0x28, 0x56, 0x41, 0x8e, 0x1b, 0xd,
                           0xfd, 0x55, 0x77, 0x28, 0x73, 0x6f, 0xf8, 0xf4, 0x55, 0xc9, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25272}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14579}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14505}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7133}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32528}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28613}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6419}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13558}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 192}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3580, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8671 [("\137/\167\132\169\250\&8Z\230",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("vQ\229\222\160\&5\214\180",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\227~\DC4\240\205\167\163\150\&9\US\197\SIO\186>\237\168\235[",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\197\199!H\185\STX\187\SI4oM\179\237 \167(vk\193\195\&4\208\205*^\161\153\178\RS",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\166\188\156I\185\220\&3S#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),(".\204\SYNt\DEL\ETXV\"6\RS\192\193\199\228\130\160",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("f\186\US\183;a^\179\132Wd\CAN\219",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),(",\166\140N",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\175\142\248\&0\231s\212\169^s\151\213\133[J\153L=\USc3",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("J\227\239\US\219\166\EM\235K\b8G@\158\156l\216xH\131\&5{\174\253",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropPayloadFormatIndicator
// 50,PropUserProperty "\166\224\204\NAK$q\182\171\SYNz^\206\&0x\SOH7\170D"
// "d\163i.\246\242\145\163\212",PropMaximumPacketSize 26490,PropReasonString
// "\ESC\236:\166N\DC1\b\231\231\128\237\174\253+\165u\f\138\184'\DC3\161\188\222P\172Hq\222",PropAssignedClientIdentifier
// "\180\131N?\ENQI\222\202x",PropCorrelationData
// "\229$z^]\135\SYN?]\188CR\163\198X9\239\219\GSo\175\SO:,\192\169\241\SO\228\183",PropAuthenticationMethod
// "\141\SUB@\DC29z\187",PropRequestProblemInformation 190,PropMessageExpiryInterval 31181,PropResponseTopic
// "\239\176t\186\179d\181\213\195x+n#\249\&7\SYNT\203\SO+b>\187\FS\201\180\223\156\vw",PropReceiveMaximum
// 3626,PropAuthenticationMethod "\158\253\DELH\181y\163\SI\161\136\137",PropUserProperty
// "O\181\137\208\192\&4\145Z\f'`\207'\213\&9++\187\SOx" "U=",PropWillDelayInterval
// 9887,PropWildcardSubscriptionAvailable 228,PropMaximumPacketSize 19549,PropAuthenticationMethod
// "\218\RS\SYN\DC3\b\CAN\220_\237\209\US\230\191\231t\129\159s$\US\\M\142&2",PropSubscriptionIdentifierAvailable 52]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x82, 0xb6, 0x3,  0x21, 0xdf, 0xfc, 0x1,  0x1,  0x32, 0x26, 0x0,  0x12, 0xa6, 0xe0, 0xcc, 0x15, 0x24, 0x71, 0xb6,
      0xab, 0x16, 0x7a, 0x5e, 0xce, 0x30, 0x78, 0x1,  0x37, 0xaa, 0x44, 0x0,  0x9,  0x64, 0xa3, 0x69, 0x2e, 0xf6, 0xf2,
      0x91, 0xa3, 0xd4, 0x27, 0x0,  0x0,  0x67, 0x7a, 0x1f, 0x0,  0x1d, 0x1b, 0xec, 0x3a, 0xa6, 0x4e, 0x11, 0x8,  0xe7,
      0xe7, 0x80, 0xed, 0xae, 0xfd, 0x2b, 0xa5, 0x75, 0xc,  0x8a, 0xb8, 0x27, 0x13, 0xa1, 0xbc, 0xde, 0x50, 0xac, 0x48,
      0x71, 0xde, 0x12, 0x0,  0x9,  0xb4, 0x83, 0x4e, 0x3f, 0x5,  0x49, 0xde, 0xca, 0x78, 0x9,  0x0,  0x1e, 0xe5, 0x24,
      0x7a, 0x5e, 0x5d, 0x87, 0x16, 0x3f, 0x5d, 0xbc, 0x43, 0x52, 0xa3, 0xc6, 0x58, 0x39, 0xef, 0xdb, 0x1d, 0x6f, 0xaf,
      0xe,  0x3a, 0x2c, 0xc0, 0xa9, 0xf1, 0xe,  0xe4, 0xb7, 0x15, 0x0,  0x7,  0x8d, 0x1a, 0x40, 0x12, 0x39, 0x7a, 0xbb,
      0x17, 0xbe, 0x2,  0x0,  0x0,  0x79, 0xcd, 0x8,  0x0,  0x1e, 0xef, 0xb0, 0x74, 0xba, 0xb3, 0x64, 0xb5, 0xd5, 0xc3,
      0x78, 0x2b, 0x6e, 0x23, 0xf9, 0x37, 0x16, 0x54, 0xcb, 0xe,  0x2b, 0x62, 0x3e, 0xbb, 0x1c, 0xc9, 0xb4, 0xdf, 0x9c,
      0xb,  0x77, 0x21, 0xe,  0x2a, 0x15, 0x0,  0xb,  0x9e, 0xfd, 0x7f, 0x48, 0xb5, 0x79, 0xa3, 0xf,  0xa1, 0x88, 0x89,
      0x26, 0x0,  0x14, 0x4f, 0xb5, 0x89, 0xd0, 0xc0, 0x34, 0x91, 0x5a, 0xc,  0x27, 0x60, 0xcf, 0x27, 0xd5, 0x39, 0x2b,
      0x2b, 0xbb, 0xe,  0x78, 0x0,  0x2,  0x55, 0x3d, 0x18, 0x0,  0x0,  0x26, 0x9f, 0x28, 0xe4, 0x27, 0x0,  0x0,  0x4c,
      0x5d, 0x15, 0x0,  0x19, 0xda, 0x1e, 0x16, 0x13, 0x8,  0x18, 0xdc, 0x5f, 0xed, 0xd1, 0x1f, 0xe6, 0xbf, 0xe7, 0x74,
      0x81, 0x9f, 0x73, 0x24, 0x1f, 0x5c, 0x4d, 0x8e, 0x26, 0x32, 0x29, 0x34, 0x0,  0x9,  0x89, 0x2f, 0xa7, 0x84, 0xa9,
      0xfa, 0x38, 0x5a, 0xe6, 0x25, 0x0,  0x8,  0x76, 0x51, 0xe5, 0xde, 0xa0, 0x35, 0xd6, 0xb4, 0x2d, 0x0,  0x13, 0xe3,
      0x7e, 0x14, 0xf0, 0xcd, 0xa7, 0xa3, 0x96, 0x39, 0x1f, 0xc5, 0xf,  0x4f, 0xba, 0x3e, 0xed, 0xa8, 0xeb, 0x5b, 0x28,
      0x0,  0x1d, 0xc5, 0xc7, 0x21, 0x48, 0xb9, 0x2,  0xbb, 0xf,  0x34, 0x6f, 0x4d, 0xb3, 0xed, 0x20, 0xa7, 0x28, 0x76,
      0x6b, 0xc1, 0xc3, 0x34, 0xd0, 0xcd, 0x2a, 0x5e, 0xa1, 0x99, 0xb2, 0x1e, 0x21, 0x0,  0x9,  0xa6, 0xbc, 0x9c, 0x49,
      0xb9, 0xdc, 0x33, 0x53, 0x23, 0x2,  0x0,  0x10, 0x2e, 0xcc, 0x16, 0x74, 0x7f, 0x3,  0x56, 0x22, 0x36, 0x1e, 0xc0,
      0xc1, 0xc7, 0xe4, 0x82, 0xa0, 0x21, 0x0,  0xd,  0x66, 0xba, 0x1f, 0xb7, 0x3b, 0x61, 0x5e, 0xb3, 0x84, 0x57, 0x64,
      0x18, 0xdb, 0x12, 0x0,  0x4,  0x2c, 0xa6, 0x8c, 0x4e, 0xe,  0x0,  0x15, 0xaf, 0x8e, 0xf8, 0x30, 0xe7, 0x73, 0xd4,
      0xa9, 0x5e, 0x73, 0x97, 0xd5, 0x85, 0x5b, 0x4a, 0x99, 0x4c, 0x3d, 0x1f, 0x63, 0x33, 0x11, 0x0,  0x18, 0x4a, 0xe3,
      0xef, 0x1f, 0xdb, 0xa6, 0x19, 0xeb, 0x4b, 0x8,  0x38, 0x47, 0x40, 0x9e, 0x9c, 0x6c, 0xd8, 0x78, 0x48, 0x83, 0x35,
      0x7b, 0xae, 0xfd, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x89, 0x2f, 0xa7, 0x84, 0xa9, 0xfa, 0x38, 0x5a, 0xe6};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x76, 0x51, 0xe5, 0xde, 0xa0, 0x35, 0xd6, 0xb4};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe3, 0x7e, 0x14, 0xf0, 0xcd, 0xa7, 0xa3, 0x96, 0x39, 0x1f,
                                     0xc5, 0xf,  0x4f, 0xba, 0x3e, 0xed, 0xa8, 0xeb, 0x5b};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc5, 0xc7, 0x21, 0x48, 0xb9, 0x2,  0xbb, 0xf,  0x34, 0x6f,
                                     0x4d, 0xb3, 0xed, 0x20, 0xa7, 0x28, 0x76, 0x6b, 0xc1, 0xc3,
                                     0x34, 0xd0, 0xcd, 0x2a, 0x5e, 0xa1, 0x99, 0xb2, 0x1e};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa6, 0xbc, 0x9c, 0x49, 0xb9, 0xdc, 0x33, 0x53, 0x23};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2e, 0xcc, 0x16, 0x74, 0x7f, 0x3,  0x56, 0x22,
                                     0x36, 0x1e, 0xc0, 0xc1, 0xc7, 0xe4, 0x82, 0xa0};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x66, 0xba, 0x1f, 0xb7, 0x3b, 0x61, 0x5e, 0xb3, 0x84, 0x57, 0x64, 0x18, 0xdb};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2c, 0xa6, 0x8c, 0x4e};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xaf, 0x8e, 0xf8, 0x30, 0xe7, 0x73, 0xd4, 0xa9, 0x5e, 0x73, 0x97,
                                     0xd5, 0x85, 0x5b, 0x4a, 0x99, 0x4c, 0x3d, 0x1f, 0x63, 0x33};
  lwmqtt_string_t topic_filter_s8 = {21, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x4a, 0xe3, 0xef, 0x1f, 0xdb, 0xa6, 0x19, 0xeb, 0x4b, 0x8,  0x38, 0x47,
                                     0x40, 0x9e, 0x9c, 0x6c, 0xd8, 0x78, 0x48, 0x83, 0x35, 0x7b, 0xae, 0xfd};
  lwmqtt_string_t topic_filter_s9 = {24, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  uint8_t bytesprops1[] = {0x64, 0xa3, 0x69, 0x2e, 0xf6, 0xf2, 0x91, 0xa3, 0xd4};
  uint8_t bytesprops0[] = {0xa6, 0xe0, 0xcc, 0x15, 0x24, 0x71, 0xb6, 0xab, 0x16,
                           0x7a, 0x5e, 0xce, 0x30, 0x78, 0x1,  0x37, 0xaa, 0x44};
  uint8_t bytesprops2[] = {0x1b, 0xec, 0x3a, 0xa6, 0x4e, 0x11, 0x8,  0xe7, 0xe7, 0x80, 0xed, 0xae, 0xfd, 0x2b, 0xa5,
                           0x75, 0xc,  0x8a, 0xb8, 0x27, 0x13, 0xa1, 0xbc, 0xde, 0x50, 0xac, 0x48, 0x71, 0xde};
  uint8_t bytesprops3[] = {0xb4, 0x83, 0x4e, 0x3f, 0x5, 0x49, 0xde, 0xca, 0x78};
  uint8_t bytesprops4[] = {0xe5, 0x24, 0x7a, 0x5e, 0x5d, 0x87, 0x16, 0x3f, 0x5d, 0xbc, 0x43, 0x52, 0xa3, 0xc6, 0x58,
                           0x39, 0xef, 0xdb, 0x1d, 0x6f, 0xaf, 0xe,  0x3a, 0x2c, 0xc0, 0xa9, 0xf1, 0xe,  0xe4, 0xb7};
  uint8_t bytesprops5[] = {0x8d, 0x1a, 0x40, 0x12, 0x39, 0x7a, 0xbb};
  uint8_t bytesprops6[] = {0xef, 0xb0, 0x74, 0xba, 0xb3, 0x64, 0xb5, 0xd5, 0xc3, 0x78, 0x2b, 0x6e, 0x23, 0xf9, 0x37,
                           0x16, 0x54, 0xcb, 0xe,  0x2b, 0x62, 0x3e, 0xbb, 0x1c, 0xc9, 0xb4, 0xdf, 0x9c, 0xb,  0x77};
  uint8_t bytesprops7[] = {0x9e, 0xfd, 0x7f, 0x48, 0xb5, 0x79, 0xa3, 0xf, 0xa1, 0x88, 0x89};
  uint8_t bytesprops9[] = {0x55, 0x3d};
  uint8_t bytesprops8[] = {0x4f, 0xb5, 0x89, 0xd0, 0xc0, 0x34, 0x91, 0x5a, 0xc, 0x27,
                           0x60, 0xcf, 0x27, 0xd5, 0x39, 0x2b, 0x2b, 0xbb, 0xe, 0x78};
  uint8_t bytesprops10[] = {0xda, 0x1e, 0x16, 0x13, 0x8,  0x18, 0xdc, 0x5f, 0xed, 0xd1, 0x1f, 0xe6, 0xbf,
                            0xe7, 0x74, 0x81, 0x9f, 0x73, 0x24, 0x1f, 0x5c, 0x4d, 0x8e, 0x26, 0x32};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops0}, .v = {9, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26490}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31181}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3626}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops8}, .v = {2, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9887}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19549}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 52}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8671, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12528 [("",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\148\&2\192\239\ETBl1G.]3f\EOT\158\156\169i\146#uO\217",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\225L\215\SOHGKI\217p5\225\219\187\228,p\ENQ*\218I\194\153q",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("S\231ewx\206\160\202P",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\171Kky\198c\184w\165e^\140n\236\SI\DEL\157d;\186d\234\NUL]\161",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("\183",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),(";\246\134\170\224\207z\RSCq",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS =
// QoS1}),("J\FS\206NB\154\253\b\US\197\172*=\232CO\212\210\181\202\&0,&>\135\&4\224\226\170\203",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})]
// [PropUserProperty "\NAK\DC1\136*\192>}\148\128\143\182\248\143\167\164\161R\143\135\SO\175zc#\DLE\167\182`{V"
// "z\RS\ESC\186\247\DC48\177",PropPayloadFormatIndicator 150,PropAuthenticationData
// "\216\234\232|\237\f\154C\179/.\217\238\166\NUL\240\174}{\139\167\223\DLE4",PropReasonString
// "]\131\200\238\255\&2\207s\EM>I\183\218\ETB\DEL\186\251\196\251Ux\248\180\132k\ETBb\227\231\214",PropContentType
// "\NAKo|\144\202XH\163\243\SOH\fM\254\184v\222\180c\163\NUL\252\247\198_S\233",PropWillDelayInterval
// 16406,PropRetainAvailable 34,PropCorrelationData "\164\164\142\237V\166\188w",PropMaximumQoS 215,PropUserProperty
// "\225\214\210\224\STX\246<\162\SYN<\209\&5!j\194\176\128\SOH\DEL<=\178"
// "P\250\214\251RO\172y\128\245G",PropResponseTopic "Tn",PropSubscriptionIdentifierAvailable 104,PropTopicAlias
// 14762,PropSubscriptionIdentifierAvailable 31,PropResponseTopic
// "[,\v\255{|py$\184NX\148\DC1|\235\225\251h\159\GSw1\211\221\EOT",PropWillDelayInterval
// 17498,PropSubscriptionIdentifierAvailable 184,PropCorrelationData
// "=\223\226S\134r\134\SIe\185\192(\130",PropServerReference
// "-\164\233J\197\192\200\216\US3%\131\156\235\b\USQ\162\SYN\215,=\GS\DC4\212",PropSessionExpiryInterval
// 9456,PropReceiveMaximum 17438,PropMessageExpiryInterval 14322,PropTopicAliasMaximum 14800,PropReasonString
// "\216B\148X\191\STX\196\231\221q\EMO\145.\216\175\150\147\176\229^\nK\228\166cJ\203|",PropServerReference "\199\225"]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x82, 0xe5, 0x3,  0x30, 0xf0, 0xd1, 0x2,  0x26, 0x0,  0x1e, 0x15, 0x11, 0x88, 0x2a, 0xc0, 0x3e, 0x7d, 0x94, 0x80,
      0x8f, 0xb6, 0xf8, 0x8f, 0xa7, 0xa4, 0xa1, 0x52, 0x8f, 0x87, 0xe,  0xaf, 0x7a, 0x63, 0x23, 0x10, 0xa7, 0xb6, 0x60,
      0x7b, 0x56, 0x0,  0x8,  0x7a, 0x1e, 0x1b, 0xba, 0xf7, 0x14, 0x38, 0xb1, 0x1,  0x96, 0x16, 0x0,  0x18, 0xd8, 0xea,
      0xe8, 0x7c, 0xed, 0xc,  0x9a, 0x43, 0xb3, 0x2f, 0x2e, 0xd9, 0xee, 0xa6, 0x0,  0xf0, 0xae, 0x7d, 0x7b, 0x8b, 0xa7,
      0xdf, 0x10, 0x34, 0x1f, 0x0,  0x1e, 0x5d, 0x83, 0xc8, 0xee, 0xff, 0x32, 0xcf, 0x73, 0x19, 0x3e, 0x49, 0xb7, 0xda,
      0x17, 0x7f, 0xba, 0xfb, 0xc4, 0xfb, 0x55, 0x78, 0xf8, 0xb4, 0x84, 0x6b, 0x17, 0x62, 0xe3, 0xe7, 0xd6, 0x3,  0x0,
      0x1a, 0x15, 0x6f, 0x7c, 0x90, 0xca, 0x58, 0x48, 0xa3, 0xf3, 0x1,  0xc,  0x4d, 0xfe, 0xb8, 0x76, 0xde, 0xb4, 0x63,
      0xa3, 0x0,  0xfc, 0xf7, 0xc6, 0x5f, 0x53, 0xe9, 0x18, 0x0,  0x0,  0x40, 0x16, 0x25, 0x22, 0x9,  0x0,  0x8,  0xa4,
      0xa4, 0x8e, 0xed, 0x56, 0xa6, 0xbc, 0x77, 0x24, 0xd7, 0x26, 0x0,  0x16, 0xe1, 0xd6, 0xd2, 0xe0, 0x2,  0xf6, 0x3c,
      0xa2, 0x16, 0x3c, 0xd1, 0x35, 0x21, 0x6a, 0xc2, 0xb0, 0x80, 0x1,  0x7f, 0x3c, 0x3d, 0xb2, 0x0,  0xb,  0x50, 0xfa,
      0xd6, 0xfb, 0x52, 0x4f, 0xac, 0x79, 0x80, 0xf5, 0x47, 0x8,  0x0,  0x2,  0x54, 0x6e, 0x29, 0x68, 0x23, 0x39, 0xaa,
      0x29, 0x1f, 0x8,  0x0,  0x1a, 0x5b, 0x2c, 0xb,  0xff, 0x7b, 0x7c, 0x70, 0x79, 0x24, 0xb8, 0x4e, 0x58, 0x94, 0x11,
      0x7c, 0xeb, 0xe1, 0xfb, 0x68, 0x9f, 0x1d, 0x77, 0x31, 0xd3, 0xdd, 0x4,  0x18, 0x0,  0x0,  0x44, 0x5a, 0x29, 0xb8,
      0x9,  0x0,  0xd,  0x3d, 0xdf, 0xe2, 0x53, 0x86, 0x72, 0x86, 0xf,  0x65, 0xb9, 0xc0, 0x28, 0x82, 0x1c, 0x0,  0x19,
      0x2d, 0xa4, 0xe9, 0x4a, 0xc5, 0xc0, 0xc8, 0xd8, 0x1f, 0x33, 0x25, 0x83, 0x9c, 0xeb, 0x8,  0x1f, 0x51, 0xa2, 0x16,
      0xd7, 0x2c, 0x3d, 0x1d, 0x14, 0xd4, 0x11, 0x0,  0x0,  0x24, 0xf0, 0x21, 0x44, 0x1e, 0x2,  0x0,  0x0,  0x37, 0xf2,
      0x22, 0x39, 0xd0, 0x1f, 0x0,  0x1d, 0xd8, 0x42, 0x94, 0x58, 0xbf, 0x2,  0xc4, 0xe7, 0xdd, 0x71, 0x19, 0x4f, 0x91,
      0x2e, 0xd8, 0xaf, 0x96, 0x93, 0xb0, 0xe5, 0x5e, 0xa,  0x4b, 0xe4, 0xa6, 0x63, 0x4a, 0xcb, 0x7c, 0x1c, 0x0,  0x2,
      0xc7, 0xe1, 0x0,  0x0,  0x12, 0x0,  0x16, 0x94, 0x32, 0xc0, 0xef, 0x17, 0x6c, 0x31, 0x47, 0x2e, 0x5d, 0x33, 0x66,
      0x4,  0x9e, 0x9c, 0xa9, 0x69, 0x92, 0x23, 0x75, 0x4f, 0xd9, 0x8,  0x0,  0x17, 0xe1, 0x4c, 0xd7, 0x1,  0x47, 0x4b,
      0x49, 0xd9, 0x70, 0x35, 0xe1, 0xdb, 0xbb, 0xe4, 0x2c, 0x70, 0x5,  0x2a, 0xda, 0x49, 0xc2, 0x99, 0x71, 0x1d, 0x0,
      0x9,  0x53, 0xe7, 0x65, 0x77, 0x78, 0xce, 0xa0, 0xca, 0x50, 0x1c, 0x0,  0x19, 0xab, 0x4b, 0x6b, 0x79, 0xc6, 0x63,
      0xb8, 0x77, 0xa5, 0x65, 0x5e, 0x8c, 0x6e, 0xec, 0xf,  0x7f, 0x9d, 0x64, 0x3b, 0xba, 0x64, 0xea, 0x0,  0x5d, 0xa1,
      0x28, 0x0,  0x1,  0xb7, 0x1d, 0x0,  0xa,  0x3b, 0xf6, 0x86, 0xaa, 0xe0, 0xcf, 0x7a, 0x1e, 0x43, 0x71, 0x5,  0x0,
      0x1e, 0x4a, 0x1c, 0xce, 0x4e, 0x42, 0x9a, 0xfd, 0x8,  0x1f, 0xc5, 0xac, 0x2a, 0x3d, 0xe8, 0x43, 0x4f, 0xd4, 0xd2,
      0xb5, 0xca, 0x30, 0x2c, 0x26, 0x3e, 0x87, 0x34, 0xe0, 0xe2, 0xaa, 0xcb, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x94, 0x32, 0xc0, 0xef, 0x17, 0x6c, 0x31, 0x47, 0x2e, 0x5d, 0x33,
                                     0x66, 0x4,  0x9e, 0x9c, 0xa9, 0x69, 0x92, 0x23, 0x75, 0x4f, 0xd9};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe1, 0x4c, 0xd7, 0x1,  0x47, 0x4b, 0x49, 0xd9, 0x70, 0x35, 0xe1, 0xdb,
                                     0xbb, 0xe4, 0x2c, 0x70, 0x5,  0x2a, 0xda, 0x49, 0xc2, 0x99, 0x71};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x53, 0xe7, 0x65, 0x77, 0x78, 0xce, 0xa0, 0xca, 0x50};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xab, 0x4b, 0x6b, 0x79, 0xc6, 0x63, 0xb8, 0x77, 0xa5, 0x65, 0x5e, 0x8c, 0x6e,
                                     0xec, 0xf,  0x7f, 0x9d, 0x64, 0x3b, 0xba, 0x64, 0xea, 0x0,  0x5d, 0xa1};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb7};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3b, 0xf6, 0x86, 0xaa, 0xe0, 0xcf, 0x7a, 0x1e, 0x43, 0x71};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x4a, 0x1c, 0xce, 0x4e, 0x42, 0x9a, 0xfd, 0x8,  0x1f, 0xc5,
                                     0xac, 0x2a, 0x3d, 0xe8, 0x43, 0x4f, 0xd4, 0xd2, 0xb5, 0xca,
                                     0x30, 0x2c, 0x26, 0x3e, 0x87, 0x34, 0xe0, 0xe2, 0xaa, 0xcb};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  uint8_t bytesprops1[] = {0x7a, 0x1e, 0x1b, 0xba, 0xf7, 0x14, 0x38, 0xb1};
  uint8_t bytesprops0[] = {0x15, 0x11, 0x88, 0x2a, 0xc0, 0x3e, 0x7d, 0x94, 0x80, 0x8f, 0xb6, 0xf8, 0x8f, 0xa7, 0xa4,
                           0xa1, 0x52, 0x8f, 0x87, 0xe,  0xaf, 0x7a, 0x63, 0x23, 0x10, 0xa7, 0xb6, 0x60, 0x7b, 0x56};
  uint8_t bytesprops2[] = {0xd8, 0xea, 0xe8, 0x7c, 0xed, 0xc,  0x9a, 0x43, 0xb3, 0x2f, 0x2e, 0xd9,
                           0xee, 0xa6, 0x0,  0xf0, 0xae, 0x7d, 0x7b, 0x8b, 0xa7, 0xdf, 0x10, 0x34};
  uint8_t bytesprops3[] = {0x5d, 0x83, 0xc8, 0xee, 0xff, 0x32, 0xcf, 0x73, 0x19, 0x3e, 0x49, 0xb7, 0xda, 0x17, 0x7f,
                           0xba, 0xfb, 0xc4, 0xfb, 0x55, 0x78, 0xf8, 0xb4, 0x84, 0x6b, 0x17, 0x62, 0xe3, 0xe7, 0xd6};
  uint8_t bytesprops4[] = {0x15, 0x6f, 0x7c, 0x90, 0xca, 0x58, 0x48, 0xa3, 0xf3, 0x1,  0xc,  0x4d, 0xfe,
                           0xb8, 0x76, 0xde, 0xb4, 0x63, 0xa3, 0x0,  0xfc, 0xf7, 0xc6, 0x5f, 0x53, 0xe9};
  uint8_t bytesprops5[] = {0xa4, 0xa4, 0x8e, 0xed, 0x56, 0xa6, 0xbc, 0x77};
  uint8_t bytesprops7[] = {0x50, 0xfa, 0xd6, 0xfb, 0x52, 0x4f, 0xac, 0x79, 0x80, 0xf5, 0x47};
  uint8_t bytesprops6[] = {0xe1, 0xd6, 0xd2, 0xe0, 0x2,  0xf6, 0x3c, 0xa2, 0x16, 0x3c, 0xd1,
                           0x35, 0x21, 0x6a, 0xc2, 0xb0, 0x80, 0x1,  0x7f, 0x3c, 0x3d, 0xb2};
  uint8_t bytesprops8[] = {0x54, 0x6e};
  uint8_t bytesprops9[] = {0x5b, 0x2c, 0xb,  0xff, 0x7b, 0x7c, 0x70, 0x79, 0x24, 0xb8, 0x4e, 0x58, 0x94,
                           0x11, 0x7c, 0xeb, 0xe1, 0xfb, 0x68, 0x9f, 0x1d, 0x77, 0x31, 0xd3, 0xdd, 0x4};
  uint8_t bytesprops10[] = {0x3d, 0xdf, 0xe2, 0x53, 0x86, 0x72, 0x86, 0xf, 0x65, 0xb9, 0xc0, 0x28, 0x82};
  uint8_t bytesprops11[] = {0x2d, 0xa4, 0xe9, 0x4a, 0xc5, 0xc0, 0xc8, 0xd8, 0x1f, 0x33, 0x25, 0x83, 0x9c,
                            0xeb, 0x8,  0x1f, 0x51, 0xa2, 0x16, 0xd7, 0x2c, 0x3d, 0x1d, 0x14, 0xd4};
  uint8_t bytesprops12[] = {0xd8, 0x42, 0x94, 0x58, 0xbf, 0x2,  0xc4, 0xe7, 0xdd, 0x71, 0x19, 0x4f, 0x91, 0x2e, 0xd8,
                            0xaf, 0x96, 0x93, 0xb0, 0xe5, 0x5e, 0xa,  0x4b, 0xe4, 0xa6, 0x63, 0x4a, 0xcb, 0x7c};
  uint8_t bytesprops13[] = {0xc7, 0xe1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops0}, .v = {8, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16406}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops6}, .v = {11, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14762}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17498}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9456}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17438}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14322}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14800}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12528, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9386 [("\209\EM\NUL~%q\250\200\SYNf]\226\199+9\165'\162\178V\208\DLE",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\n\ETB\130\245\135\213\245\138\&6E\221M\DC2]\175\198\214CL8\139",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("(pn\242\166\175uq\214\245\142\vZR\209",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = True, _noLocal = False, _subQoS = QoS2})] [PropResponseTopic
// "\133=\EM\229\SUB\162\252K\172v\240\a\194P\134X\255>u#\177Q[\204\&6\241v\167J\b",PropCorrelationData
// "\254\218+C@/\128\231}\222\129\132G\228\DC3\199]w\137\NAK\158$@B\206",PropMessageExpiryInterval
// 5811,PropServerReference
// "\221\254\174Z\158\172\228_\241e#\EOTa\168\245j\219\159\FS\n\175n\NUL\184\241",PropCorrelationData
// "*\163A\181|\130\233l\145H\201\ETB\166\178x\161\"\aTU",PropAuthenticationMethod "",PropWillDelayInterval
// 25248,PropSubscriptionIdentifierAvailable 210,PropWildcardSubscriptionAvailable 146,PropAuthenticationMethod
// "\244V\207\207\n'1\ACK\169\DC2=\173\140\231\197G\DC2M5+\DC3"]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0xe0, 0x1,  0x24, 0xaa, 0x99, 0x1,  0x8,  0x0,  0x1e, 0x85, 0x3d, 0x19, 0xe5, 0x1a, 0xa2, 0xfc, 0x4b, 0xac,
      0x76, 0xf0, 0x7,  0xc2, 0x50, 0x86, 0x58, 0xff, 0x3e, 0x75, 0x23, 0xb1, 0x51, 0x5b, 0xcc, 0x36, 0xf1, 0x76, 0xa7,
      0x4a, 0x8,  0x9,  0x0,  0x19, 0xfe, 0xda, 0x2b, 0x43, 0x40, 0x2f, 0x80, 0xe7, 0x7d, 0xde, 0x81, 0x84, 0x47, 0xe4,
      0x13, 0xc7, 0x5d, 0x77, 0x89, 0x15, 0x9e, 0x24, 0x40, 0x42, 0xce, 0x2,  0x0,  0x0,  0x16, 0xb3, 0x1c, 0x0,  0x19,
      0xdd, 0xfe, 0xae, 0x5a, 0x9e, 0xac, 0xe4, 0x5f, 0xf1, 0x65, 0x23, 0x4,  0x61, 0xa8, 0xf5, 0x6a, 0xdb, 0x9f, 0x1c,
      0xa,  0xaf, 0x6e, 0x0,  0xb8, 0xf1, 0x9,  0x0,  0x14, 0x2a, 0xa3, 0x41, 0xb5, 0x7c, 0x82, 0xe9, 0x6c, 0x91, 0x48,
      0xc9, 0x17, 0xa6, 0xb2, 0x78, 0xa1, 0x22, 0x7,  0x54, 0x55, 0x15, 0x0,  0x0,  0x18, 0x0,  0x0,  0x62, 0xa0, 0x29,
      0xd2, 0x28, 0x92, 0x15, 0x0,  0x15, 0xf4, 0x56, 0xcf, 0xcf, 0xa,  0x27, 0x31, 0x6,  0xa9, 0x12, 0x3d, 0xad, 0x8c,
      0xe7, 0xc5, 0x47, 0x12, 0x4d, 0x35, 0x2b, 0x13, 0x0,  0x16, 0xd1, 0x19, 0x0,  0x7e, 0x25, 0x71, 0xfa, 0xc8, 0x16,
      0x66, 0x5d, 0xe2, 0xc7, 0x2b, 0x39, 0xa5, 0x27, 0xa2, 0xb2, 0x56, 0xd0, 0x10, 0x2d, 0x0,  0x15, 0xa,  0x17, 0x82,
      0xf5, 0x87, 0xd5, 0xf5, 0x8a, 0x36, 0x45, 0xdd, 0x4d, 0x12, 0x5d, 0xaf, 0xc6, 0xd6, 0x43, 0x4c, 0x38, 0x8b, 0x14,
      0x0,  0xf,  0x28, 0x70, 0x6e, 0xf2, 0xa6, 0xaf, 0x75, 0x71, 0xd6, 0xf5, 0x8e, 0xb,  0x5a, 0x52, 0xd1, 0x1a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xd1, 0x19, 0x0,  0x7e, 0x25, 0x71, 0xfa, 0xc8, 0x16, 0x66, 0x5d,
                                     0xe2, 0xc7, 0x2b, 0x39, 0xa5, 0x27, 0xa2, 0xb2, 0x56, 0xd0, 0x10};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa,  0x17, 0x82, 0xf5, 0x87, 0xd5, 0xf5, 0x8a, 0x36, 0x45, 0xdd,
                                     0x4d, 0x12, 0x5d, 0xaf, 0xc6, 0xd6, 0x43, 0x4c, 0x38, 0x8b};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x28, 0x70, 0x6e, 0xf2, 0xa6, 0xaf, 0x75, 0x71,
                                     0xd6, 0xf5, 0x8e, 0xb,  0x5a, 0x52, 0xd1};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  uint8_t bytesprops0[] = {0x85, 0x3d, 0x19, 0xe5, 0x1a, 0xa2, 0xfc, 0x4b, 0xac, 0x76, 0xf0, 0x7,  0xc2, 0x50, 0x86,
                           0x58, 0xff, 0x3e, 0x75, 0x23, 0xb1, 0x51, 0x5b, 0xcc, 0x36, 0xf1, 0x76, 0xa7, 0x4a, 0x8};
  uint8_t bytesprops1[] = {0xfe, 0xda, 0x2b, 0x43, 0x40, 0x2f, 0x80, 0xe7, 0x7d, 0xde, 0x81, 0x84, 0x47,
                           0xe4, 0x13, 0xc7, 0x5d, 0x77, 0x89, 0x15, 0x9e, 0x24, 0x40, 0x42, 0xce};
  uint8_t bytesprops2[] = {0xdd, 0xfe, 0xae, 0x5a, 0x9e, 0xac, 0xe4, 0x5f, 0xf1, 0x65, 0x23, 0x4, 0x61,
                           0xa8, 0xf5, 0x6a, 0xdb, 0x9f, 0x1c, 0xa,  0xaf, 0x6e, 0x0,  0xb8, 0xf1};
  uint8_t bytesprops3[] = {0x2a, 0xa3, 0x41, 0xb5, 0x7c, 0x82, 0xe9, 0x6c, 0x91, 0x48,
                           0xc9, 0x17, 0xa6, 0xb2, 0x78, 0xa1, 0x22, 0x7,  0x54, 0x55};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0xf4, 0x56, 0xcf, 0xcf, 0xa,  0x27, 0x31, 0x6,  0xa9, 0x12, 0x3d,
                           0xad, 0x8c, 0xe7, 0xc5, 0x47, 0x12, 0x4d, 0x35, 0x2b, 0x13};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5811}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25248}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9386, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17533 [("(\v5\187IR\198\&8\215Mh\DC1\234\194",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("_E",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\166GM",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\216\209{\247V0\206\253\155\DC4\CAN",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS2}),(",\170\200\239\ETX\218}\155\195\194\177faHsp\134\SI",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\140\140\rH\207f*P<\249\191k\ETB\229\141\224Y\138\SI\SYN\251;\DC12M",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("j\234\196n\SUB\146\132\168?\155F\190)\137\235.\233\224\135\138\DC1\a#\GS",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("83\213v",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropResponseInformation "\r\163U7\225\141/\215\229\216\162",PropAuthenticationData
// "\204V\133\RS{k\233\236\248!:\CAN\DEL\GS\189",PropRetainAvailable 207,PropPayloadFormatIndicator
// 122,PropWillDelayInterval 24641,PropAssignedClientIdentifier
// "\ESC\180\219\212\&2#]8\129\US?",PropSessionExpiryInterval 29296,PropContentType
// "\190\CAN\221U\133P",PropSharedSubscriptionAvailable 51,PropRequestProblemInformation 42,PropWillDelayInterval
// 6999,PropMaximumPacketSize 24918,PropUserProperty
// "SE\183+\172\213\142>\SIL0\153q\166\229\172\224K\171\144\145>\233a\132%\181\r"
// "\216\141\145\210\176{\195",PropRequestResponseInformation 108,PropUserProperty "|\SYN\EMo\214\192\154M\235"
// "\196p\SI\230\158\207\157\196\252\211\175\143p",PropSubscriptionIdentifier 9,PropMaximumPacketSize
// 28386,PropReceiveMaximum 8213,PropSharedSubscriptionAvailable 114,PropSharedSubscriptionAvailable
// 174,PropTopicAliasMaximum 14924]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0xaa, 0x2,  0x44, 0x7d, 0xa9, 0x1,  0x1a, 0x0,  0xb,  0xd,  0xa3, 0x55, 0x37, 0xe1, 0x8d, 0x2f, 0xd7, 0xe5,
      0xd8, 0xa2, 0x16, 0x0,  0xf,  0xcc, 0x56, 0x85, 0x1e, 0x7b, 0x6b, 0xe9, 0xec, 0xf8, 0x21, 0x3a, 0x18, 0x7f, 0x1d,
      0xbd, 0x25, 0xcf, 0x1,  0x7a, 0x18, 0x0,  0x0,  0x60, 0x41, 0x12, 0x0,  0xb,  0x1b, 0xb4, 0xdb, 0xd4, 0x32, 0x23,
      0x5d, 0x38, 0x81, 0x1f, 0x3f, 0x11, 0x0,  0x0,  0x72, 0x70, 0x3,  0x0,  0x6,  0xbe, 0x18, 0xdd, 0x55, 0x85, 0x50,
      0x2a, 0x33, 0x17, 0x2a, 0x18, 0x0,  0x0,  0x1b, 0x57, 0x27, 0x0,  0x0,  0x61, 0x56, 0x26, 0x0,  0x1c, 0x53, 0x45,
      0xb7, 0x2b, 0xac, 0xd5, 0x8e, 0x3e, 0xf,  0x4c, 0x30, 0x99, 0x71, 0xa6, 0xe5, 0xac, 0xe0, 0x4b, 0xab, 0x90, 0x91,
      0x3e, 0xe9, 0x61, 0x84, 0x25, 0xb5, 0xd,  0x0,  0x7,  0xd8, 0x8d, 0x91, 0xd2, 0xb0, 0x7b, 0xc3, 0x19, 0x6c, 0x26,
      0x0,  0x9,  0x7c, 0x16, 0x19, 0x6f, 0xd6, 0xc0, 0x9a, 0x4d, 0xeb, 0x0,  0xd,  0xc4, 0x70, 0xf,  0xe6, 0x9e, 0xcf,
      0x9d, 0xc4, 0xfc, 0xd3, 0xaf, 0x8f, 0x70, 0xb,  0x9,  0x27, 0x0,  0x0,  0x6e, 0xe2, 0x21, 0x20, 0x15, 0x2a, 0x72,
      0x2a, 0xae, 0x22, 0x3a, 0x4c, 0x0,  0xe,  0x28, 0xb,  0x35, 0xbb, 0x49, 0x52, 0xc6, 0x38, 0xd7, 0x4d, 0x68, 0x11,
      0xea, 0xc2, 0x26, 0x0,  0x2,  0x5f, 0x45, 0x11, 0x0,  0x3,  0xa6, 0x47, 0x4d, 0x29, 0x0,  0xb,  0xd8, 0xd1, 0x7b,
      0xf7, 0x56, 0x30, 0xce, 0xfd, 0x9b, 0x14, 0x18, 0x2e, 0x0,  0x12, 0x2c, 0xaa, 0xc8, 0xef, 0x3,  0xda, 0x7d, 0x9b,
      0xc3, 0xc2, 0xb1, 0x66, 0x61, 0x48, 0x73, 0x70, 0x86, 0xf,  0x1c, 0x0,  0x19, 0x8c, 0x8c, 0xd,  0x48, 0xcf, 0x66,
      0x2a, 0x50, 0x3c, 0xf9, 0xbf, 0x6b, 0x17, 0xe5, 0x8d, 0xe0, 0x59, 0x8a, 0xf,  0x16, 0xfb, 0x3b, 0x11, 0x32, 0x4d,
      0x1e, 0x0,  0x18, 0x6a, 0xea, 0xc4, 0x6e, 0x1a, 0x92, 0x84, 0xa8, 0x3f, 0x9b, 0x46, 0xbe, 0x29, 0x89, 0xeb, 0x2e,
      0xe9, 0xe0, 0x87, 0x8a, 0x11, 0x7,  0x23, 0x1d, 0x29, 0x0,  0x4,  0x38, 0x33, 0xd5, 0x76, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x28, 0xb, 0x35, 0xbb, 0x49, 0x52, 0xc6, 0x38, 0xd7, 0x4d, 0x68, 0x11, 0xea, 0xc2};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0x45};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa6, 0x47, 0x4d};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd8, 0xd1, 0x7b, 0xf7, 0x56, 0x30, 0xce, 0xfd, 0x9b, 0x14, 0x18};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2c, 0xaa, 0xc8, 0xef, 0x3,  0xda, 0x7d, 0x9b, 0xc3,
                                     0xc2, 0xb1, 0x66, 0x61, 0x48, 0x73, 0x70, 0x86, 0xf};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8c, 0x8c, 0xd,  0x48, 0xcf, 0x66, 0x2a, 0x50, 0x3c, 0xf9, 0xbf, 0x6b, 0x17,
                                     0xe5, 0x8d, 0xe0, 0x59, 0x8a, 0xf,  0x16, 0xfb, 0x3b, 0x11, 0x32, 0x4d};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6a, 0xea, 0xc4, 0x6e, 0x1a, 0x92, 0x84, 0xa8, 0x3f, 0x9b, 0x46, 0xbe,
                                     0x29, 0x89, 0xeb, 0x2e, 0xe9, 0xe0, 0x87, 0x8a, 0x11, 0x7,  0x23, 0x1d};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x38, 0x33, 0xd5, 0x76};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0xd, 0xa3, 0x55, 0x37, 0xe1, 0x8d, 0x2f, 0xd7, 0xe5, 0xd8, 0xa2};
  uint8_t bytesprops1[] = {0xcc, 0x56, 0x85, 0x1e, 0x7b, 0x6b, 0xe9, 0xec, 0xf8, 0x21, 0x3a, 0x18, 0x7f, 0x1d, 0xbd};
  uint8_t bytesprops2[] = {0x1b, 0xb4, 0xdb, 0xd4, 0x32, 0x23, 0x5d, 0x38, 0x81, 0x1f, 0x3f};
  uint8_t bytesprops3[] = {0xbe, 0x18, 0xdd, 0x55, 0x85, 0x50};
  uint8_t bytesprops5[] = {0xd8, 0x8d, 0x91, 0xd2, 0xb0, 0x7b, 0xc3};
  uint8_t bytesprops4[] = {0x53, 0x45, 0xb7, 0x2b, 0xac, 0xd5, 0x8e, 0x3e, 0xf,  0x4c, 0x30, 0x99, 0x71, 0xa6,
                           0xe5, 0xac, 0xe0, 0x4b, 0xab, 0x90, 0x91, 0x3e, 0xe9, 0x61, 0x84, 0x25, 0xb5, 0xd};
  uint8_t bytesprops7[] = {0xc4, 0x70, 0xf, 0xe6, 0x9e, 0xcf, 0x9d, 0xc4, 0xfc, 0xd3, 0xaf, 0x8f, 0x70};
  uint8_t bytesprops6[] = {0x7c, 0x16, 0x19, 0x6f, 0xd6, 0xc0, 0x9a, 0x4d, 0xeb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24641}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29296}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6999}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24918}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops4}, .v = {7, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops6}, .v = {13, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28386}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8213}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14924}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17533, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1875 [("\131\239*\255VM\230[\170\a\ACK|\132\249\176v\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropResponseInformation
// "Z\196",PropWildcardSubscriptionAvailable 183,PropServerKeepAlive 24665,PropWillDelayInterval 7907,PropMaximumQoS
// 22,PropPayloadFormatIndicator 100,PropRequestProblemInformation 248,PropWillDelayInterval 3496,PropMaximumPacketSize
// 21061,PropTopicAliasMaximum 21354,PropResponseTopic "\247\227\&7",PropSubscriptionIdentifier 15,PropWillDelayInterval
// 24629,PropUserProperty "\234\140\175<\234#\180\&0\FS\249!\169\243\165\210\240\ACK\200"
// "N\GS\CAN\160\219\167D\169\223\160\164\"\222\153\192~\235\131\&6p\248\a\246\162",PropAuthenticationMethod
// "\193\252\143U}\151+=\249i5\DC2;\149g\183\a]",PropSubscriptionIdentifier 0,PropWildcardSubscriptionAvailable
// 237,PropWillDelayInterval 6547,PropServerReference
// "sa\133\247\251\132\245\185\148\232\145F?\181",PropRequestResponseInformation 207,PropTopicAliasMaximum
// 12816,PropRetainAvailable 145,PropTopicAliasMaximum 27568,PropMaximumPacketSize 25047,PropMessageExpiryInterval
// 18783,PropSubscriptionIdentifier 6,PropMaximumPacketSize 32075,PropUserProperty "\a\185\225\135Q&\200"
// "\247\191\178F",PropMessageExpiryInterval 13005,PropMaximumQoS 23]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0xd7, 0x1,  0x7,  0x53, 0xbf, 0x1,  0x1a, 0x0,  0x2,  0x5a, 0xc4, 0x28, 0xb7, 0x13, 0x60, 0x59,
                   0x18, 0x0,  0x0,  0x1e, 0xe3, 0x24, 0x16, 0x1,  0x64, 0x17, 0xf8, 0x18, 0x0,  0x0,  0xd,  0xa8, 0x27,
                   0x0,  0x0,  0x52, 0x45, 0x22, 0x53, 0x6a, 0x8,  0x0,  0x3,  0xf7, 0xe3, 0x37, 0xb,  0xf,  0x18, 0x0,
                   0x0,  0x60, 0x35, 0x26, 0x0,  0x12, 0xea, 0x8c, 0xaf, 0x3c, 0xea, 0x23, 0xb4, 0x30, 0x1c, 0xf9, 0x21,
                   0xa9, 0xf3, 0xa5, 0xd2, 0xf0, 0x6,  0xc8, 0x0,  0x18, 0x4e, 0x1d, 0x18, 0xa0, 0xdb, 0xa7, 0x44, 0xa9,
                   0xdf, 0xa0, 0xa4, 0x22, 0xde, 0x99, 0xc0, 0x7e, 0xeb, 0x83, 0x36, 0x70, 0xf8, 0x7,  0xf6, 0xa2, 0x15,
                   0x0,  0x12, 0xc1, 0xfc, 0x8f, 0x55, 0x7d, 0x97, 0x2b, 0x3d, 0xf9, 0x69, 0x35, 0x12, 0x3b, 0x95, 0x67,
                   0xb7, 0x7,  0x5d, 0xb,  0x0,  0x28, 0xed, 0x18, 0x0,  0x0,  0x19, 0x93, 0x1c, 0x0,  0xe,  0x73, 0x61,
                   0x85, 0xf7, 0xfb, 0x84, 0xf5, 0xb9, 0x94, 0xe8, 0x91, 0x46, 0x3f, 0xb5, 0x19, 0xcf, 0x22, 0x32, 0x10,
                   0x25, 0x91, 0x22, 0x6b, 0xb0, 0x27, 0x0,  0x0,  0x61, 0xd7, 0x2,  0x0,  0x0,  0x49, 0x5f, 0xb,  0x6,
                   0x27, 0x0,  0x0,  0x7d, 0x4b, 0x26, 0x0,  0x7,  0x7,  0xb9, 0xe1, 0x87, 0x51, 0x26, 0xc8, 0x0,  0x4,
                   0xf7, 0xbf, 0xb2, 0x46, 0x2,  0x0,  0x0,  0x32, 0xcd, 0x24, 0x17, 0x0,  0x11, 0x83, 0xef, 0x2a, 0xff,
                   0x56, 0x4d, 0xe6, 0x5b, 0xaa, 0x7,  0x6,  0x7c, 0x84, 0xf9, 0xb0, 0x76, 0xd4, 0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x83, 0xef, 0x2a, 0xff, 0x56, 0x4d, 0xe6, 0x5b, 0xaa,
                                     0x7,  0x6,  0x7c, 0x84, 0xf9, 0xb0, 0x76, 0xd4};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0x5a, 0xc4};
  uint8_t bytesprops1[] = {0xf7, 0xe3, 0x37};
  uint8_t bytesprops3[] = {0x4e, 0x1d, 0x18, 0xa0, 0xdb, 0xa7, 0x44, 0xa9, 0xdf, 0xa0, 0xa4, 0x22,
                           0xde, 0x99, 0xc0, 0x7e, 0xeb, 0x83, 0x36, 0x70, 0xf8, 0x7,  0xf6, 0xa2};
  uint8_t bytesprops2[] = {0xea, 0x8c, 0xaf, 0x3c, 0xea, 0x23, 0xb4, 0x30, 0x1c,
                           0xf9, 0x21, 0xa9, 0xf3, 0xa5, 0xd2, 0xf0, 0x6,  0xc8};
  uint8_t bytesprops4[] = {0xc1, 0xfc, 0x8f, 0x55, 0x7d, 0x97, 0x2b, 0x3d, 0xf9,
                           0x69, 0x35, 0x12, 0x3b, 0x95, 0x67, 0xb7, 0x7,  0x5d};
  uint8_t bytesprops5[] = {0x73, 0x61, 0x85, 0xf7, 0xfb, 0x84, 0xf5, 0xb9, 0x94, 0xe8, 0x91, 0x46, 0x3f, 0xb5};
  uint8_t bytesprops7[] = {0xf7, 0xbf, 0xb2, 0x46};
  uint8_t bytesprops6[] = {0x7, 0xb9, 0xe1, 0x87, 0x51, 0x26, 0xc8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24665}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7907}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3496}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21061}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21354}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24629}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops2}, .v = {24, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6547}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12816}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27568}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25047}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18783}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32075}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops6}, .v = {4, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13005}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 23}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 1875, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14558 [("\253\195\NUL\169\SUB\205/\SYNc\168\233|a\172\161\187\236\149\159 \222\215$\195<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("E\201R^&\SUB,\148vp@\224",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\215\136.^@|s6\135?U\231\230Q{\238d\161\131\NUL\177M\\\DC1",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\136\133c\130\ACK\ETX",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS0}),(")\171\146\187\241\153\239",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\141\248\DC2\161?,jC\203G\198\135\203\134=\157\192\221\249~\246",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\189M!|\178~\166\141rn\247w\234",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS1})] [PropServerReference "\142a\DC42\194\234\191\169",PropSubscriptionIdentifier
// 21,PropSessionExpiryInterval 5774,PropAssignedClientIdentifier "\SI[\204\129<\184S\EOTS*",PropServerReference
// "\219\196\196\212\134\r\150\238L",PropServerReference
// "\131E\208\SI%\246y\DLE*\137\208\168\153\&5\189\182\226xO\238H\231\148",PropWillDelayInterval
// 22265,PropSharedSubscriptionAvailable 169,PropServerKeepAlive 768,PropSubscriptionIdentifier
// 25,PropSessionExpiryInterval 2168,PropWillDelayInterval 19691,PropRequestResponseInformation
// 117,PropSubscriptionIdentifierAvailable 178,PropResponseInformation
// "g\155\DC17\251\131S\142^\211\143L\STXG4\ETX\SYN\146a\207\160",PropContentType "\246",PropWillDelayInterval
// 6475,PropSubscriptionIdentifier 17,PropContentType "\255\240\185\STXEt\192R",PropSubscriptionIdentifierAvailable
// 189,PropCorrelationData "\146(U*\249\225Y\215\215y\232\213\ACK3\217\234\202\146?\151t"]
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x82, 0xac, 0x2,  0x38, 0xde, 0xa7, 0x1,  0x1c, 0x0,  0x8,  0x8e, 0x61, 0x14, 0x32, 0xc2, 0xea, 0xbf, 0xa9, 0xb,
      0x15, 0x11, 0x0,  0x0,  0x16, 0x8e, 0x12, 0x0,  0xa,  0xf,  0x5b, 0xcc, 0x81, 0x3c, 0xb8, 0x53, 0x4,  0x53, 0x2a,
      0x1c, 0x0,  0x9,  0xdb, 0xc4, 0xc4, 0xd4, 0x86, 0xd,  0x96, 0xee, 0x4c, 0x1c, 0x0,  0x17, 0x83, 0x45, 0xd0, 0xf,
      0x25, 0xf6, 0x79, 0x10, 0x2a, 0x89, 0xd0, 0xa8, 0x99, 0x35, 0xbd, 0xb6, 0xe2, 0x78, 0x4f, 0xee, 0x48, 0xe7, 0x94,
      0x18, 0x0,  0x0,  0x56, 0xf9, 0x2a, 0xa9, 0x13, 0x3,  0x0,  0xb,  0x19, 0x11, 0x0,  0x0,  0x8,  0x78, 0x18, 0x0,
      0x0,  0x4c, 0xeb, 0x19, 0x75, 0x29, 0xb2, 0x1a, 0x0,  0x15, 0x67, 0x9b, 0x11, 0x37, 0xfb, 0x83, 0x53, 0x8e, 0x5e,
      0xd3, 0x8f, 0x4c, 0x2,  0x47, 0x34, 0x3,  0x16, 0x92, 0x61, 0xcf, 0xa0, 0x3,  0x0,  0x1,  0xf6, 0x18, 0x0,  0x0,
      0x19, 0x4b, 0xb,  0x11, 0x3,  0x0,  0x8,  0xff, 0xf0, 0xb9, 0x2,  0x45, 0x74, 0xc0, 0x52, 0x29, 0xbd, 0x9,  0x0,
      0x15, 0x92, 0x28, 0x55, 0x2a, 0xf9, 0xe1, 0x59, 0xd7, 0xd7, 0x79, 0xe8, 0xd5, 0x6,  0x33, 0xd9, 0xea, 0xca, 0x92,
      0x3f, 0x97, 0x74, 0x0,  0x19, 0xfd, 0xc3, 0x0,  0xa9, 0x1a, 0xcd, 0x2f, 0x16, 0x63, 0xa8, 0xe9, 0x7c, 0x61, 0xac,
      0xa1, 0xbb, 0xec, 0x95, 0x9f, 0x20, 0xde, 0xd7, 0x24, 0xc3, 0x3c, 0x1,  0x0,  0xc,  0x45, 0xc9, 0x52, 0x5e, 0x26,
      0x1a, 0x2c, 0x94, 0x76, 0x70, 0x40, 0xe0, 0x1,  0x0,  0x18, 0xd7, 0x88, 0x2e, 0x5e, 0x40, 0x7c, 0x73, 0x36, 0x87,
      0x3f, 0x55, 0xe7, 0xe6, 0x51, 0x7b, 0xee, 0x64, 0xa1, 0x83, 0x0,  0xb1, 0x4d, 0x5c, 0x11, 0xe,  0x0,  0x6,  0x88,
      0x85, 0x63, 0x82, 0x6,  0x3,  0x4,  0x0,  0x7,  0x29, 0xab, 0x92, 0xbb, 0xf1, 0x99, 0xef, 0x2c, 0x0,  0x15, 0x8d,
      0xf8, 0x12, 0xa1, 0x3f, 0x2c, 0x6a, 0x43, 0xcb, 0x47, 0xc6, 0x87, 0xcb, 0x86, 0x3d, 0x9d, 0xc0, 0xdd, 0xf9, 0x7e,
      0xf6, 0x9,  0x0,  0xd,  0xbd, 0x4d, 0x21, 0x7c, 0xb2, 0x7e, 0xa6, 0x8d, 0x72, 0x6e, 0xf7, 0x77, 0xea, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xfd, 0xc3, 0x0,  0xa9, 0x1a, 0xcd, 0x2f, 0x16, 0x63, 0xa8, 0xe9, 0x7c, 0x61,
                                     0xac, 0xa1, 0xbb, 0xec, 0x95, 0x9f, 0x20, 0xde, 0xd7, 0x24, 0xc3, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x45, 0xc9, 0x52, 0x5e, 0x26, 0x1a, 0x2c, 0x94, 0x76, 0x70, 0x40, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd7, 0x88, 0x2e, 0x5e, 0x40, 0x7c, 0x73, 0x36, 0x87, 0x3f, 0x55, 0xe7,
                                     0xe6, 0x51, 0x7b, 0xee, 0x64, 0xa1, 0x83, 0x0,  0xb1, 0x4d, 0x5c, 0x11};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x85, 0x63, 0x82, 0x6, 0x3};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x29, 0xab, 0x92, 0xbb, 0xf1, 0x99, 0xef};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8d, 0xf8, 0x12, 0xa1, 0x3f, 0x2c, 0x6a, 0x43, 0xcb, 0x47, 0xc6,
                                     0x87, 0xcb, 0x86, 0x3d, 0x9d, 0xc0, 0xdd, 0xf9, 0x7e, 0xf6};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbd, 0x4d, 0x21, 0x7c, 0xb2, 0x7e, 0xa6, 0x8d, 0x72, 0x6e, 0xf7, 0x77, 0xea};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0x8e, 0x61, 0x14, 0x32, 0xc2, 0xea, 0xbf, 0xa9};
  uint8_t bytesprops1[] = {0xf, 0x5b, 0xcc, 0x81, 0x3c, 0xb8, 0x53, 0x4, 0x53, 0x2a};
  uint8_t bytesprops2[] = {0xdb, 0xc4, 0xc4, 0xd4, 0x86, 0xd, 0x96, 0xee, 0x4c};
  uint8_t bytesprops3[] = {0x83, 0x45, 0xd0, 0xf,  0x25, 0xf6, 0x79, 0x10, 0x2a, 0x89, 0xd0, 0xa8,
                           0x99, 0x35, 0xbd, 0xb6, 0xe2, 0x78, 0x4f, 0xee, 0x48, 0xe7, 0x94};
  uint8_t bytesprops4[] = {0x67, 0x9b, 0x11, 0x37, 0xfb, 0x83, 0x53, 0x8e, 0x5e, 0xd3, 0x8f,
                           0x4c, 0x2,  0x47, 0x34, 0x3,  0x16, 0x92, 0x61, 0xcf, 0xa0};
  uint8_t bytesprops5[] = {0xf6};
  uint8_t bytesprops6[] = {0xff, 0xf0, 0xb9, 0x2, 0x45, 0x74, 0xc0, 0x52};
  uint8_t bytesprops7[] = {0x92, 0x28, 0x55, 0x2a, 0xf9, 0xe1, 0x59, 0xd7, 0xd7, 0x79, 0xe8,
                           0xd5, 0x6,  0x33, 0xd9, 0xea, 0xca, 0x92, 0x3f, 0x97, 0x74};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5774}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22265}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 768}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2168}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19691}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6475}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14558, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14679 [("\207`\174\172K_\ENQ",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS2}),(";\232\&5\184JOL\164\ETX\139\154`\228+\DC23`\228",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropUserProperty
// "\185\227\SO.\161\152\a4\DEL\215\158\230U"
// "\213a\t\153\169\&3\128\173\135\197\254x\135!\229on9z\246L\224\&2U\151",PropAuthenticationData
// "1\131\187;\SOH\241\172",PropMessageExpiryInterval 23772,PropWillDelayInterval 2648,PropSessionExpiryInterval
// 32304,PropAssignedClientIdentifier "",PropAssignedClientIdentifier "\206\152&",PropUserProperty "\231x"
// "\169\253\236\RS\208\&7!\196\137\230~d}\STX\140\203o\228\188Z\231\146@",PropCorrelationData
// "\228\204e\240y\176\160\143]",PropMessageExpiryInterval 30439]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x9e, 0x1,  0x39, 0x57, 0x7c, 0x26, 0x0,  0xd,  0xb9, 0xe3, 0xe,  0x2e, 0xa1, 0x98, 0x7,  0x34,
                   0x7f, 0xd7, 0x9e, 0xe6, 0x55, 0x0,  0x19, 0xd5, 0x61, 0x9,  0x99, 0xa9, 0x33, 0x80, 0xad, 0x87, 0xc5,
                   0xfe, 0x78, 0x87, 0x21, 0xe5, 0x6f, 0x6e, 0x39, 0x7a, 0xf6, 0x4c, 0xe0, 0x32, 0x55, 0x97, 0x16, 0x0,
                   0x7,  0x31, 0x83, 0xbb, 0x3b, 0x1,  0xf1, 0xac, 0x2,  0x0,  0x0,  0x5c, 0xdc, 0x18, 0x0,  0x0,  0xa,
                   0x58, 0x11, 0x0,  0x0,  0x7e, 0x30, 0x12, 0x0,  0x0,  0x12, 0x0,  0x3,  0xce, 0x98, 0x26, 0x26, 0x0,
                   0x2,  0xe7, 0x78, 0x0,  0x17, 0xa9, 0xfd, 0xec, 0x1e, 0xd0, 0x37, 0x21, 0xc4, 0x89, 0xe6, 0x7e, 0x64,
                   0x7d, 0x2,  0x8c, 0xcb, 0x6f, 0xe4, 0xbc, 0x5a, 0xe7, 0x92, 0x40, 0x9,  0x0,  0x9,  0xe4, 0xcc, 0x65,
                   0xf0, 0x79, 0xb0, 0xa0, 0x8f, 0x5d, 0x2,  0x0,  0x0,  0x76, 0xe7, 0x0,  0x7,  0xcf, 0x60, 0xae, 0xac,
                   0x4b, 0x5f, 0x5,  0x2e, 0x0,  0x12, 0x3b, 0xe8, 0x35, 0xb8, 0x4a, 0x4f, 0x4c, 0xa4, 0x3,  0x8b, 0x9a,
                   0x60, 0xe4, 0x2b, 0x12, 0x33, 0x60, 0xe4, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xcf, 0x60, 0xae, 0xac, 0x4b, 0x5f, 0x5};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3b, 0xe8, 0x35, 0xb8, 0x4a, 0x4f, 0x4c, 0xa4, 0x3,
                                     0x8b, 0x9a, 0x60, 0xe4, 0x2b, 0x12, 0x33, 0x60, 0xe4};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  uint8_t bytesprops1[] = {0xd5, 0x61, 0x9,  0x99, 0xa9, 0x33, 0x80, 0xad, 0x87, 0xc5, 0xfe, 0x78, 0x87,
                           0x21, 0xe5, 0x6f, 0x6e, 0x39, 0x7a, 0xf6, 0x4c, 0xe0, 0x32, 0x55, 0x97};
  uint8_t bytesprops0[] = {0xb9, 0xe3, 0xe, 0x2e, 0xa1, 0x98, 0x7, 0x34, 0x7f, 0xd7, 0x9e, 0xe6, 0x55};
  uint8_t bytesprops2[] = {0x31, 0x83, 0xbb, 0x3b, 0x1, 0xf1, 0xac};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xce, 0x98, 0x26};
  uint8_t bytesprops6[] = {0xa9, 0xfd, 0xec, 0x1e, 0xd0, 0x37, 0x21, 0xc4, 0x89, 0xe6, 0x7e, 0x64,
                           0x7d, 0x2,  0x8c, 0xcb, 0x6f, 0xe4, 0xbc, 0x5a, 0xe7, 0x92, 0x40};
  uint8_t bytesprops5[] = {0xe7, 0x78};
  uint8_t bytesprops7[] = {0xe4, 0xcc, 0x65, 0xf0, 0x79, 0xb0, 0xa0, 0x8f, 0x5d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops0}, .v = {25, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23772}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2648}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32304}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops5}, .v = {23, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30439}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14679, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12650 [("\128\169\159\162P\211\&9;",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\208m\216",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\236_\171\216\143\"\186H\168\235\192<\204\ACK\DEL[h\235\178@\147",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\216\RS\142\&4\175O\SOHGI9M\r\US\159\148,2\RS\196\SUB\136\EM\176\GS\129",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",V\156\135\DC1\226\RS\199Z\rf\r\191.\220.\204\243\227\NAK\198\232\&6$@",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\172\192\171\236\193\&0\139\ENQvR\250\SOH6\160\NAK\191\&9u",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\194\ETXM3U\240\EM\243\176\SO/\205H\143\242wn\138\199\137\156\211\175",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropSessionExpiryInterval
// 1524,PropReceiveMaximum 18350,PropRetainAvailable 238,PropRetainAvailable 182,PropTopicAliasMaximum
// 26470,PropTopicAlias 3473,PropTopicAlias 25376,PropReasonString
// "\139\197G\238\254\211\135\143#\208\159l\178\DC3;\138\220\143",PropContentType
// "3\164f\169Hz\250\131\DC3\129E\SYN\nD\206[\244\192\210",PropSharedSubscriptionAvailable
// 33,PropSharedSubscriptionAvailable 219,PropReceiveMaximum 21214,PropRequestProblemInformation
// 29,PropWillDelayInterval 21731,PropMessageExpiryInterval 7458,PropResponseInformation
// "\ENQ\f\CAN\STXj\237\148\199",PropWildcardSubscriptionAvailable 244,PropContentType
// "=\209\191N\169\248_\245J9\235\197d\244\190\136\185\164\&2\205e\200\251",PropMessageExpiryInterval
// 20023,PropMessageExpiryInterval 19469,PropTopicAlias 12641,PropMaximumQoS 15,PropSubscriptionIdentifierAvailable
// 193,PropMessageExpiryInterval 3100,PropResponseInformation "Nk\142=&1\154/#\251\231\153I",PropWillDelayInterval 6949]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x82, 0xb9, 0x2,  0x31, 0x6a, 0xa5, 0x1,  0x11, 0x0,  0x0,  0x5,  0xf4, 0x21, 0x47, 0xae, 0x25, 0xee, 0x25, 0xb6,
      0x22, 0x67, 0x66, 0x23, 0xd,  0x91, 0x23, 0x63, 0x20, 0x1f, 0x0,  0x12, 0x8b, 0xc5, 0x47, 0xee, 0xfe, 0xd3, 0x87,
      0x8f, 0x23, 0xd0, 0x9f, 0x6c, 0xb2, 0x13, 0x3b, 0x8a, 0xdc, 0x8f, 0x3,  0x0,  0x13, 0x33, 0xa4, 0x66, 0xa9, 0x48,
      0x7a, 0xfa, 0x83, 0x13, 0x81, 0x45, 0x16, 0xa,  0x44, 0xce, 0x5b, 0xf4, 0xc0, 0xd2, 0x2a, 0x21, 0x2a, 0xdb, 0x21,
      0x52, 0xde, 0x17, 0x1d, 0x18, 0x0,  0x0,  0x54, 0xe3, 0x2,  0x0,  0x0,  0x1d, 0x22, 0x1a, 0x0,  0x8,  0x5,  0xc,
      0x18, 0x2,  0x6a, 0xed, 0x94, 0xc7, 0x28, 0xf4, 0x3,  0x0,  0x17, 0x3d, 0xd1, 0xbf, 0x4e, 0xa9, 0xf8, 0x5f, 0xf5,
      0x4a, 0x39, 0xeb, 0xc5, 0x64, 0xf4, 0xbe, 0x88, 0xb9, 0xa4, 0x32, 0xcd, 0x65, 0xc8, 0xfb, 0x2,  0x0,  0x0,  0x4e,
      0x37, 0x2,  0x0,  0x0,  0x4c, 0xd,  0x23, 0x31, 0x61, 0x24, 0xf,  0x29, 0xc1, 0x2,  0x0,  0x0,  0xc,  0x1c, 0x1a,
      0x0,  0xd,  0x4e, 0x6b, 0x8e, 0x3d, 0x26, 0x31, 0x9a, 0x2f, 0x23, 0xfb, 0xe7, 0x99, 0x49, 0x18, 0x0,  0x0,  0x1b,
      0x25, 0x0,  0x8,  0x80, 0xa9, 0x9f, 0xa2, 0x50, 0xd3, 0x39, 0x3b, 0x2d, 0x0,  0x3,  0xd0, 0x6d, 0xd8, 0x26, 0x0,
      0x15, 0xec, 0x5f, 0xab, 0xd8, 0x8f, 0x22, 0xba, 0x48, 0xa8, 0xeb, 0xc0, 0x3c, 0xcc, 0x6,  0x7f, 0x5b, 0x68, 0xeb,
      0xb2, 0x40, 0x93, 0x8,  0x0,  0x19, 0xd8, 0x1e, 0x8e, 0x34, 0xaf, 0x4f, 0x1,  0x47, 0x49, 0x39, 0x4d, 0xd,  0x1f,
      0x9f, 0x94, 0x2c, 0x32, 0x1e, 0xc4, 0x1a, 0x88, 0x19, 0xb0, 0x1d, 0x81, 0x20, 0x0,  0x19, 0x2c, 0x56, 0x9c, 0x87,
      0x11, 0xe2, 0x1e, 0xc7, 0x5a, 0xd,  0x66, 0xd,  0xbf, 0x2e, 0xdc, 0x2e, 0xcc, 0xf3, 0xe3, 0x15, 0xc6, 0xe8, 0x36,
      0x24, 0x40, 0x2e, 0x0,  0x12, 0xac, 0xc0, 0xab, 0xec, 0xc1, 0x30, 0x8b, 0x5,  0x76, 0x52, 0xfa, 0x1,  0x36, 0xa0,
      0x15, 0xbf, 0x39, 0x75, 0x1a, 0x0,  0x17, 0xc2, 0x3,  0x4d, 0x33, 0x55, 0xf0, 0x19, 0xf3, 0xb0, 0xe,  0x2f, 0xcd,
      0x48, 0x8f, 0xf2, 0x77, 0x6e, 0x8a, 0xc7, 0x89, 0x9c, 0xd3, 0xaf, 0x1a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x80, 0xa9, 0x9f, 0xa2, 0x50, 0xd3, 0x39, 0x3b};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x6d, 0xd8};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec, 0x5f, 0xab, 0xd8, 0x8f, 0x22, 0xba, 0x48, 0xa8, 0xeb, 0xc0,
                                     0x3c, 0xcc, 0x6,  0x7f, 0x5b, 0x68, 0xeb, 0xb2, 0x40, 0x93};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd8, 0x1e, 0x8e, 0x34, 0xaf, 0x4f, 0x1,  0x47, 0x49, 0x39, 0x4d, 0xd, 0x1f,
                                     0x9f, 0x94, 0x2c, 0x32, 0x1e, 0xc4, 0x1a, 0x88, 0x19, 0xb0, 0x1d, 0x81};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2c, 0x56, 0x9c, 0x87, 0x11, 0xe2, 0x1e, 0xc7, 0x5a, 0xd,  0x66, 0xd, 0xbf,
                                     0x2e, 0xdc, 0x2e, 0xcc, 0xf3, 0xe3, 0x15, 0xc6, 0xe8, 0x36, 0x24, 0x40};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xac, 0xc0, 0xab, 0xec, 0xc1, 0x30, 0x8b, 0x5,  0x76,
                                     0x52, 0xfa, 0x1,  0x36, 0xa0, 0x15, 0xbf, 0x39, 0x75};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc2, 0x3,  0x4d, 0x33, 0x55, 0xf0, 0x19, 0xf3, 0xb0, 0xe,  0x2f, 0xcd,
                                     0x48, 0x8f, 0xf2, 0x77, 0x6e, 0x8a, 0xc7, 0x89, 0x9c, 0xd3, 0xaf};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  uint8_t bytesprops0[] = {0x8b, 0xc5, 0x47, 0xee, 0xfe, 0xd3, 0x87, 0x8f, 0x23,
                           0xd0, 0x9f, 0x6c, 0xb2, 0x13, 0x3b, 0x8a, 0xdc, 0x8f};
  uint8_t bytesprops1[] = {0x33, 0xa4, 0x66, 0xa9, 0x48, 0x7a, 0xfa, 0x83, 0x13, 0x81,
                           0x45, 0x16, 0xa,  0x44, 0xce, 0x5b, 0xf4, 0xc0, 0xd2};
  uint8_t bytesprops2[] = {0x5, 0xc, 0x18, 0x2, 0x6a, 0xed, 0x94, 0xc7};
  uint8_t bytesprops3[] = {0x3d, 0xd1, 0xbf, 0x4e, 0xa9, 0xf8, 0x5f, 0xf5, 0x4a, 0x39, 0xeb, 0xc5,
                           0x64, 0xf4, 0xbe, 0x88, 0xb9, 0xa4, 0x32, 0xcd, 0x65, 0xc8, 0xfb};
  uint8_t bytesprops4[] = {0x4e, 0x6b, 0x8e, 0x3d, 0x26, 0x31, 0x9a, 0x2f, 0x23, 0xfb, 0xe7, 0x99, 0x49};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1524}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18350}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26470}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3473}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25376}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21214}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21731}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7458}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20023}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19469}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12641}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3100}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6949}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12650, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3665 [("\RS2\128\242",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] [PropAuthenticationData
// "P\197\SUB\SOH\205\194X\150\224[\222\f\SO(\161\145D\CAN\233\ACKy\204\243@\149\164",PropSubscriptionIdentifier 10]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x29, 0xe,  0x51, 0x1f, 0x16, 0x0,  0x1a, 0x50, 0xc5, 0x1a, 0x1,  0xcd, 0xc2, 0x58,
                   0x96, 0xe0, 0x5b, 0xde, 0xc,  0xe,  0x28, 0xa1, 0x91, 0x44, 0x18, 0xe9, 0x6,  0x79, 0xcc,
                   0xf3, 0x40, 0x95, 0xa4, 0xb,  0xa,  0x0,  0x4,  0x1e, 0x32, 0x80, 0xf2, 0x10};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x1e, 0x32, 0x80, 0xf2};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0x50, 0xc5, 0x1a, 0x1,  0xcd, 0xc2, 0x58, 0x96, 0xe0, 0x5b, 0xde, 0xc,  0xe,
                           0x28, 0xa1, 0x91, 0x44, 0x18, 0xe9, 0x6,  0x79, 0xcc, 0xf3, 0x40, 0x95, 0xa4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 10}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3665, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23603 [("\197\163\195D\141\173\234\249,\160]\180\nZ\t\FS\244Iu\131s[\184\\",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\182\253\219\136*\159\139\DC1\249\240$r\252\233",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\219\DC4\184\&5M\153\135\234\188\ENQ\184",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\218\185}\160^\f\252\130\170}\"u\132m\185\FS\250\157-\169o\DC4",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\128\158`\237A\207\227\151P\STX\248\177\n\202\STX\130N\183\169\198^",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\207\255b\143\CAN\FS\140\203!\SYN<\138\131V\187.Y\252\186\253\DC1\150",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\191h",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("PsYa\175\245B\255\RS\136\128\GS\201\201wA\\\198\&3tES\184+\244\&5\SYN5",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\224\CAN\160\211\DLE",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropMaximumQoS
// 61,PropTopicAlias 25005,PropSubscriptionIdentifierAvailable 85,PropPayloadFormatIndicator
// 45,PropMessageExpiryInterval 32022,PropWillDelayInterval 2228,PropServerKeepAlive 1756,PropResponseTopic
// "dV",PropRequestResponseInformation 183,PropWillDelayInterval 19475,PropMessageExpiryInterval
// 12359,PropServerKeepAlive 707]
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x82, 0xe0, 0x1,  0x5c, 0x33, 0x2a, 0x24, 0x3d, 0x23, 0x61, 0xad, 0x29, 0x55, 0x1,  0x2d, 0x2,  0x0,  0x0,  0x7d,
      0x16, 0x18, 0x0,  0x0,  0x8,  0xb4, 0x13, 0x6,  0xdc, 0x8,  0x0,  0x2,  0x64, 0x56, 0x19, 0xb7, 0x18, 0x0,  0x0,
      0x4c, 0x13, 0x2,  0x0,  0x0,  0x30, 0x47, 0x13, 0x2,  0xc3, 0x0,  0x18, 0xc5, 0xa3, 0xc3, 0x44, 0x8d, 0xad, 0xea,
      0xf9, 0x2c, 0xa0, 0x5d, 0xb4, 0xa,  0x5a, 0x9,  0x1c, 0xf4, 0x49, 0x75, 0x83, 0x73, 0x5b, 0xb8, 0x5c, 0x28, 0x0,
      0xe,  0xb6, 0xfd, 0xdb, 0x88, 0x2a, 0x9f, 0x8b, 0x11, 0xf9, 0xf0, 0x24, 0x72, 0xfc, 0xe9, 0xd,  0x0,  0xb,  0xdb,
      0x14, 0xb8, 0x35, 0x4d, 0x99, 0x87, 0xea, 0xbc, 0x5,  0xb8, 0x19, 0x0,  0x16, 0xda, 0xb9, 0x7d, 0xa0, 0x5e, 0xc,
      0xfc, 0x82, 0xaa, 0x7d, 0x22, 0x75, 0x84, 0x6d, 0xb9, 0x1c, 0xfa, 0x9d, 0x2d, 0xa9, 0x6f, 0x14, 0x2c, 0x0,  0x15,
      0x80, 0x9e, 0x60, 0xed, 0x41, 0xcf, 0xe3, 0x97, 0x50, 0x2,  0xf8, 0xb1, 0xa,  0xca, 0x2,  0x82, 0x4e, 0xb7, 0xa9,
      0xc6, 0x5e, 0x9,  0x0,  0x16, 0xcf, 0xff, 0x62, 0x8f, 0x18, 0x1c, 0x8c, 0xcb, 0x21, 0x16, 0x3c, 0x8a, 0x83, 0x56,
      0xbb, 0x2e, 0x59, 0xfc, 0xba, 0xfd, 0x11, 0x96, 0x14, 0x0,  0x2,  0xbf, 0x68, 0x28, 0x0,  0x1c, 0x50, 0x73, 0x59,
      0x61, 0xaf, 0xf5, 0x42, 0xff, 0x1e, 0x88, 0x80, 0x1d, 0xc9, 0xc9, 0x77, 0x41, 0x5c, 0xc6, 0x33, 0x74, 0x45, 0x53,
      0xb8, 0x2b, 0xf4, 0x35, 0x16, 0x35, 0x16, 0x0,  0x5,  0xe0, 0x18, 0xa0, 0xd3, 0x10, 0x12, 0x0,  0x0,  0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xc5, 0xa3, 0xc3, 0x44, 0x8d, 0xad, 0xea, 0xf9, 0x2c, 0xa0, 0x5d, 0xb4,
                                     0xa,  0x5a, 0x9,  0x1c, 0xf4, 0x49, 0x75, 0x83, 0x73, 0x5b, 0xb8, 0x5c};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb6, 0xfd, 0xdb, 0x88, 0x2a, 0x9f, 0x8b,
                                     0x11, 0xf9, 0xf0, 0x24, 0x72, 0xfc, 0xe9};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdb, 0x14, 0xb8, 0x35, 0x4d, 0x99, 0x87, 0xea, 0xbc, 0x5, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xda, 0xb9, 0x7d, 0xa0, 0x5e, 0xc,  0xfc, 0x82, 0xaa, 0x7d, 0x22,
                                     0x75, 0x84, 0x6d, 0xb9, 0x1c, 0xfa, 0x9d, 0x2d, 0xa9, 0x6f, 0x14};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x80, 0x9e, 0x60, 0xed, 0x41, 0xcf, 0xe3, 0x97, 0x50, 0x2, 0xf8,
                                     0xb1, 0xa,  0xca, 0x2,  0x82, 0x4e, 0xb7, 0xa9, 0xc6, 0x5e};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xcf, 0xff, 0x62, 0x8f, 0x18, 0x1c, 0x8c, 0xcb, 0x21, 0x16, 0x3c,
                                     0x8a, 0x83, 0x56, 0xbb, 0x2e, 0x59, 0xfc, 0xba, 0xfd, 0x11, 0x96};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbf, 0x68};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x50, 0x73, 0x59, 0x61, 0xaf, 0xf5, 0x42, 0xff, 0x1e, 0x88,
                                     0x80, 0x1d, 0xc9, 0xc9, 0x77, 0x41, 0x5c, 0xc6, 0x33, 0x74,
                                     0x45, 0x53, 0xb8, 0x2b, 0xf4, 0x35, 0x16, 0x35};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe0, 0x18, 0xa0, 0xd3, 0x10};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0};
  lwmqtt_string_t topic_filter_s9 = {0, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  uint8_t bytesprops0[] = {0x64, 0x56};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25005}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32022}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2228}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1756}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19475}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12359}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 707}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23603, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26458 [("\183`M\228xY\249D",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS1}),("\237\157\196\228p\189\168\211",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\255\152\155\238\160\241#",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS1}),("\221\172",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = True, _subQoS =
// QoS1}),("\212\176\130\245\147\226D\DC1\170\164\SOH\210`>\241\244\135\149\243\210\198#\166\227\243\195\ACK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("S/\168!^A\129\141\161\212\235\177",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS1}),("\160\228\STX\163#\156\211",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\131(\196qI\152p\148\234\235i\148\219\186\139A\137\SI\188\207\164\132%.\135G_\229\211\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropTopicAlias
// 19703]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x83, 0x1,  0x67, 0x5a, 0x3,  0x23, 0x4c, 0xf7, 0x0,  0x8,  0xb7, 0x60, 0x4d, 0xe4, 0x78, 0x59,
                   0xf9, 0x44, 0x15, 0x0,  0x8,  0xed, 0x9d, 0xc4, 0xe4, 0x70, 0xbd, 0xa8, 0xd3, 0x21, 0x0,  0x7,  0xff,
                   0x98, 0x9b, 0xee, 0xa0, 0xf1, 0x23, 0x29, 0x0,  0x2,  0xdd, 0xac, 0x1d, 0x0,  0x1b, 0xd4, 0xb0, 0x82,
                   0xf5, 0x93, 0xe2, 0x44, 0x11, 0xaa, 0xa4, 0x1,  0xd2, 0x60, 0x3e, 0xf1, 0xf4, 0x87, 0x95, 0xf3, 0xd2,
                   0xc6, 0x23, 0xa6, 0xe3, 0xf3, 0xc3, 0x6,  0x8,  0x0,  0xc,  0x53, 0x2f, 0xa8, 0x21, 0x5e, 0x41, 0x81,
                   0x8d, 0xa1, 0xd4, 0xeb, 0xb1, 0x1d, 0x0,  0x7,  0xa0, 0xe4, 0x2,  0xa3, 0x23, 0x9c, 0xd3, 0x10, 0x0,
                   0x1e, 0x83, 0x28, 0xc4, 0x71, 0x49, 0x98, 0x70, 0x94, 0xea, 0xeb, 0x69, 0x94, 0xdb, 0xba, 0x8b, 0x41,
                   0x89, 0xf,  0xbc, 0xcf, 0xa4, 0x84, 0x25, 0x2e, 0x87, 0x47, 0x5f, 0xe5, 0xd3, 0xfe, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xb7, 0x60, 0x4d, 0xe4, 0x78, 0x59, 0xf9, 0x44};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xed, 0x9d, 0xc4, 0xe4, 0x70, 0xbd, 0xa8, 0xd3};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xff, 0x98, 0x9b, 0xee, 0xa0, 0xf1, 0x23};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xdd, 0xac};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd4, 0xb0, 0x82, 0xf5, 0x93, 0xe2, 0x44, 0x11, 0xaa, 0xa4, 0x1,  0xd2, 0x60, 0x3e,
                                     0xf1, 0xf4, 0x87, 0x95, 0xf3, 0xd2, 0xc6, 0x23, 0xa6, 0xe3, 0xf3, 0xc3, 0x6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x53, 0x2f, 0xa8, 0x21, 0x5e, 0x41, 0x81, 0x8d, 0xa1, 0xd4, 0xeb, 0xb1};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa0, 0xe4, 0x2, 0xa3, 0x23, 0x9c, 0xd3};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x83, 0x28, 0xc4, 0x71, 0x49, 0x98, 0x70, 0x94, 0xea, 0xeb,
                                     0x69, 0x94, 0xdb, 0xba, 0x8b, 0x41, 0x89, 0xf,  0xbc, 0xcf,
                                     0xa4, 0x84, 0x25, 0x2e, 0x87, 0x47, 0x5f, 0xe5, 0xd3, 0xfe};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19703}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26458, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4488 [("y\134]",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// True, _subQoS = QoS2}),("M\251\156z\tw\201\201\201\b\244\145\253\166",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\207h\177E\207\162\163\233\143",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\CAN\241\ENQ/\"M\212\227\&2\237\164<\230\204\237\206eX\208\194\&7.",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\234\233uo\245\154\131\&5#\223~@\NAKY\140\175\191\179\141\129\166)\188k",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\233:\215\250\&2\131\227\DLE^\175J",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS1})] [PropUserProperty "X\209\219\188\147\227\"\178Px\134"
// "_\162Wd#\149\162B%w",PropUserProperty "\157@\128\203\184\135K\181\ENQ\218\192"
// "\159\221\165\223\247\US\209;c\STX,\250\\8\178f\ENQ}\247\145\211\243e\137\189\DC2\128Tp",PropServerKeepAlive
// 4430,PropRetainAvailable 20,PropServerKeepAlive 12100,PropAssignedClientIdentifier
// "\a\146\174gc\227\SYNX\144\191\&4@\220UV\227QtI\146\CAN\130\152<:\ENQ",PropMessageExpiryInterval
// 27248,PropResponseInformation "\234\243\SI\212",PropSubscriptionIdentifier 4]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0xe2, 0x1,  0x11, 0x88, 0x7a, 0x26, 0x0,  0xb,  0x58, 0xd1, 0xdb, 0xbc, 0x93, 0xe3, 0x22, 0xb2,
                   0x50, 0x78, 0x86, 0x0,  0xa,  0x5f, 0xa2, 0x57, 0x64, 0x23, 0x95, 0xa2, 0x42, 0x25, 0x77, 0x26, 0x0,
                   0xb,  0x9d, 0x40, 0x80, 0xcb, 0xb8, 0x87, 0x4b, 0xb5, 0x5,  0xda, 0xc0, 0x0,  0x1d, 0x9f, 0xdd, 0xa5,
                   0xdf, 0xf7, 0x1f, 0xd1, 0x3b, 0x63, 0x2,  0x2c, 0xfa, 0x5c, 0x38, 0xb2, 0x66, 0x5,  0x7d, 0xf7, 0x91,
                   0xd3, 0xf3, 0x65, 0x89, 0xbd, 0x12, 0x80, 0x54, 0x70, 0x13, 0x11, 0x4e, 0x25, 0x14, 0x13, 0x2f, 0x44,
                   0x12, 0x0,  0x1a, 0x7,  0x92, 0xae, 0x67, 0x63, 0xe3, 0x16, 0x58, 0x90, 0xbf, 0x34, 0x40, 0xdc, 0x55,
                   0x56, 0xe3, 0x51, 0x74, 0x49, 0x92, 0x18, 0x82, 0x98, 0x3c, 0x3a, 0x5,  0x2,  0x0,  0x0,  0x6a, 0x70,
                   0x1a, 0x0,  0x4,  0xea, 0xf3, 0xf,  0xd4, 0xb,  0x4,  0x0,  0x3,  0x79, 0x86, 0x5d, 0xe,  0x0,  0xe,
                   0x4d, 0xfb, 0x9c, 0x7a, 0x9,  0x77, 0xc9, 0xc9, 0xc9, 0x8,  0xf4, 0x91, 0xfd, 0xa6, 0x4,  0x0,  0x9,
                   0xcf, 0x68, 0xb1, 0x45, 0xcf, 0xa2, 0xa3, 0xe9, 0x8f, 0x24, 0x0,  0x16, 0x18, 0xf1, 0x5,  0x2f, 0x22,
                   0x4d, 0xd4, 0xe3, 0x32, 0xed, 0xa4, 0x3c, 0xe6, 0xcc, 0xed, 0xce, 0x65, 0x58, 0xd0, 0xc2, 0x37, 0x2e,
                   0x1d, 0x0,  0x18, 0xea, 0xe9, 0x75, 0x6f, 0xf5, 0x9a, 0x83, 0x35, 0x23, 0xdf, 0x7e, 0x40, 0x15, 0x59,
                   0x8c, 0xaf, 0xbf, 0xb3, 0x8d, 0x81, 0xa6, 0x29, 0xbc, 0x6b, 0x18, 0x0,  0xb,  0xe9, 0x3a, 0xd7, 0xfa,
                   0x32, 0x83, 0xe3, 0x10, 0x5e, 0xaf, 0x4a, 0x19};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x79, 0x86, 0x5d};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4d, 0xfb, 0x9c, 0x7a, 0x9, 0x77, 0xc9, 0xc9, 0xc9, 0x8, 0xf4, 0x91, 0xfd, 0xa6};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xcf, 0x68, 0xb1, 0x45, 0xcf, 0xa2, 0xa3, 0xe9, 0x8f};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x18, 0xf1, 0x5,  0x2f, 0x22, 0x4d, 0xd4, 0xe3, 0x32, 0xed, 0xa4,
                                     0x3c, 0xe6, 0xcc, 0xed, 0xce, 0x65, 0x58, 0xd0, 0xc2, 0x37, 0x2e};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xea, 0xe9, 0x75, 0x6f, 0xf5, 0x9a, 0x83, 0x35, 0x23, 0xdf, 0x7e, 0x40,
                                     0x15, 0x59, 0x8c, 0xaf, 0xbf, 0xb3, 0x8d, 0x81, 0xa6, 0x29, 0xbc, 0x6b};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe9, 0x3a, 0xd7, 0xfa, 0x32, 0x83, 0xe3, 0x10, 0x5e, 0xaf, 0x4a};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  uint8_t bytesprops1[] = {0x5f, 0xa2, 0x57, 0x64, 0x23, 0x95, 0xa2, 0x42, 0x25, 0x77};
  uint8_t bytesprops0[] = {0x58, 0xd1, 0xdb, 0xbc, 0x93, 0xe3, 0x22, 0xb2, 0x50, 0x78, 0x86};
  uint8_t bytesprops3[] = {0x9f, 0xdd, 0xa5, 0xdf, 0xf7, 0x1f, 0xd1, 0x3b, 0x63, 0x2,  0x2c, 0xfa, 0x5c, 0x38, 0xb2,
                           0x66, 0x5,  0x7d, 0xf7, 0x91, 0xd3, 0xf3, 0x65, 0x89, 0xbd, 0x12, 0x80, 0x54, 0x70};
  uint8_t bytesprops2[] = {0x9d, 0x40, 0x80, 0xcb, 0xb8, 0x87, 0x4b, 0xb5, 0x5, 0xda, 0xc0};
  uint8_t bytesprops4[] = {0x7,  0x92, 0xae, 0x67, 0x63, 0xe3, 0x16, 0x58, 0x90, 0xbf, 0x34, 0x40, 0xdc,
                           0x55, 0x56, 0xe3, 0x51, 0x74, 0x49, 0x92, 0x18, 0x82, 0x98, 0x3c, 0x3a, 0x5};
  uint8_t bytesprops5[] = {0xea, 0xf3, 0xf, 0xd4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops0}, .v = {10, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops2}, .v = {29, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4430}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12100}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27248}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4488, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28692
// [("a^z\164{\209P\192\235d\163\187\135\198\205\238\DC4\185h\146\199\197\&9\223\220\253",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("]\163\DC3\140]\129\245\224\164\163S",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS =
// QoS2}),("\171\&1\208\132\SI\194\193m\ACK\203\239\SIx\ENQ\218\160O|1\235Y:\184\174",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\176\STX\244\239\208df\183(B\197x;\189\224\232 Y\218\155f\135\149v\249d\245\FS\208L",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\n#\223\137\184\136\225",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS =
// QoS1}),("`\RS8\b\137\129\FS#\SO\234\SYN\192\217\144A'\216\235\227\226\ai\205\207}c",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("V\224\171\163j",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x99, 0x1,  0x70, 0x14, 0x0,  0x0,  0x1a, 0x61, 0x5e, 0x7a, 0xa4, 0x7b, 0xd1, 0x50, 0xc0,
                   0xeb, 0x64, 0xa3, 0xbb, 0x87, 0xc6, 0xcd, 0xee, 0x14, 0xb9, 0x68, 0x92, 0xc7, 0xc5, 0x39, 0xdf,
                   0xdc, 0xfd, 0x16, 0x0,  0xb,  0x5d, 0xa3, 0x13, 0x8c, 0x5d, 0x81, 0xf5, 0xe0, 0xa4, 0xa3, 0x53,
                   0x2e, 0x0,  0x18, 0xab, 0x31, 0xd0, 0x84, 0xf,  0xc2, 0xc1, 0x6d, 0x6,  0xcb, 0xef, 0xf,  0x78,
                   0x5,  0xda, 0xa0, 0x4f, 0x7c, 0x31, 0xeb, 0x59, 0x3a, 0xb8, 0xae, 0x22, 0x0,  0x1e, 0xb0, 0x2,
                   0xf4, 0xef, 0xd0, 0x64, 0x66, 0xb7, 0x28, 0x42, 0xc5, 0x78, 0x3b, 0xbd, 0xe0, 0xe8, 0x20, 0x59,
                   0xda, 0x9b, 0x66, 0x87, 0x95, 0x76, 0xf9, 0x64, 0xf5, 0x1c, 0xd0, 0x4c, 0x22, 0x0,  0x7,  0xa,
                   0x23, 0xdf, 0x89, 0xb8, 0x88, 0xe1, 0x29, 0x0,  0x1a, 0x60, 0x1e, 0x38, 0x8,  0x89, 0x81, 0x1c,
                   0x23, 0xe,  0xea, 0x16, 0xc0, 0xd9, 0x90, 0x41, 0x27, 0xd8, 0xeb, 0xe3, 0xe2, 0x7,  0x69, 0xcd,
                   0xcf, 0x7d, 0x63, 0x24, 0x0,  0x5,  0x56, 0xe0, 0xab, 0xa3, 0x6a, 0x10};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x61, 0x5e, 0x7a, 0xa4, 0x7b, 0xd1, 0x50, 0xc0, 0xeb, 0x64, 0xa3, 0xbb, 0x87,
                                     0xc6, 0xcd, 0xee, 0x14, 0xb9, 0x68, 0x92, 0xc7, 0xc5, 0x39, 0xdf, 0xdc, 0xfd};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5d, 0xa3, 0x13, 0x8c, 0x5d, 0x81, 0xf5, 0xe0, 0xa4, 0xa3, 0x53};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xab, 0x31, 0xd0, 0x84, 0xf,  0xc2, 0xc1, 0x6d, 0x6,  0xcb, 0xef, 0xf,
                                     0x78, 0x5,  0xda, 0xa0, 0x4f, 0x7c, 0x31, 0xeb, 0x59, 0x3a, 0xb8, 0xae};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb0, 0x2,  0xf4, 0xef, 0xd0, 0x64, 0x66, 0xb7, 0x28, 0x42,
                                     0xc5, 0x78, 0x3b, 0xbd, 0xe0, 0xe8, 0x20, 0x59, 0xda, 0x9b,
                                     0x66, 0x87, 0x95, 0x76, 0xf9, 0x64, 0xf5, 0x1c, 0xd0, 0x4c};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa, 0x23, 0xdf, 0x89, 0xb8, 0x88, 0xe1};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x60, 0x1e, 0x38, 0x8,  0x89, 0x81, 0x1c, 0x23, 0xe,  0xea, 0x16, 0xc0, 0xd9,
                                     0x90, 0x41, 0x27, 0xd8, 0xeb, 0xe3, 0xe2, 0x7,  0x69, 0xcd, 0xcf, 0x7d, 0x63};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x56, 0xe0, 0xab, 0xa3, 0x6a};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28692, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11607 [("\200P\177\221",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("A\173\ETX\f\226l\DELM\233\194ndO4\248\238\130\173\224\214",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\246\222N\189z",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS2}),("\216\NAKQ\172\ACK\138\167\168\&5&",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\SYN\130\197\169\254\\\180\144\164g\158k",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\NUL\214a\170\SOH\192\ETX\136M\252\SOH\238q\183\ETX\172\138\213$]\154J\166\142\232R",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("Mu-|\132\218\214j\253",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS =
// QoS0}),("\240\161\131\US\213\DC1\239\222\n\133\218\180j\176p\215\204s\138t\154N\163!\227y(\233l\166",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\237\136f\131sp\148i\158+cYt\ESC;",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS1})] [PropServerReference "0\150\153\ETBu\184\244",PropAssignedClientIdentifier
// "\187\&9c\"\178\219\255",PropSubscriptionIdentifierAvailable 204,PropAuthenticationMethod
// "0\158\176\141Ot\197\133\129\145){t\158\164\133\192\233\135\251bC",PropServerKeepAlive
// 16637,PropWildcardSubscriptionAvailable 86,PropUserProperty
// "\227\EM\189\244\157\SIuP\206?R\205b\208\187\144W9\179\239S\190\214\DC3\FS=3\249"
// "(\n\t\145\179<\162\157-\n\173\254\225j\148 \176\157",PropTopicAliasMaximum 11024,PropWildcardSubscriptionAvailable
// 220,PropResponseInformation "'\255\218N\162",PropAuthenticationData "\188\220\225\157\193",PropReasonString
// "\236\223KC\DC1\142\140\217\v\229{\182eY\204]",PropReceiveMaximum 11339,PropMessageExpiryInterval
// 12885,PropResponseInformation "\242\227#\150\130\226\178\215>",PropSubscriptionIdentifier 8]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x82, 0xc7, 0x2,  0x2d, 0x57, 0xa5, 0x1,  0x1c, 0x0,  0x7,  0x30, 0x96, 0x99, 0x17, 0x75, 0xb8, 0xf4, 0x12, 0x0,
      0x7,  0xbb, 0x39, 0x63, 0x22, 0xb2, 0xdb, 0xff, 0x29, 0xcc, 0x15, 0x0,  0x16, 0x30, 0x9e, 0xb0, 0x8d, 0x4f, 0x74,
      0xc5, 0x85, 0x81, 0x91, 0x29, 0x7b, 0x74, 0x9e, 0xa4, 0x85, 0xc0, 0xe9, 0x87, 0xfb, 0x62, 0x43, 0x13, 0x40, 0xfd,
      0x28, 0x56, 0x26, 0x0,  0x1c, 0xe3, 0x19, 0xbd, 0xf4, 0x9d, 0xf,  0x75, 0x50, 0xce, 0x3f, 0x52, 0xcd, 0x62, 0xd0,
      0xbb, 0x90, 0x57, 0x39, 0xb3, 0xef, 0x53, 0xbe, 0xd6, 0x13, 0x1c, 0x3d, 0x33, 0xf9, 0x0,  0x12, 0x28, 0xa,  0x9,
      0x91, 0xb3, 0x3c, 0xa2, 0x9d, 0x2d, 0xa,  0xad, 0xfe, 0xe1, 0x6a, 0x94, 0x20, 0xb0, 0x9d, 0x22, 0x2b, 0x10, 0x28,
      0xdc, 0x1a, 0x0,  0x5,  0x27, 0xff, 0xda, 0x4e, 0xa2, 0x16, 0x0,  0x5,  0xbc, 0xdc, 0xe1, 0x9d, 0xc1, 0x1f, 0x0,
      0x10, 0xec, 0xdf, 0x4b, 0x43, 0x11, 0x8e, 0x8c, 0xd9, 0xb,  0xe5, 0x7b, 0xb6, 0x65, 0x59, 0xcc, 0x5d, 0x21, 0x2c,
      0x4b, 0x2,  0x0,  0x0,  0x32, 0x55, 0x1a, 0x0,  0x9,  0xf2, 0xe3, 0x23, 0x96, 0x82, 0xe2, 0xb2, 0xd7, 0x3e, 0xb,
      0x8,  0x0,  0x4,  0xc8, 0x50, 0xb1, 0xdd, 0x2,  0x0,  0x14, 0x41, 0xad, 0x3,  0xc,  0xe2, 0x6c, 0x7f, 0x4d, 0xe9,
      0xc2, 0x6e, 0x64, 0x4f, 0x34, 0xf8, 0xee, 0x82, 0xad, 0xe0, 0xd6, 0x24, 0x0,  0x5,  0xf6, 0xde, 0x4e, 0xbd, 0x7a,
      0xe,  0x0,  0xa,  0xd8, 0x15, 0x51, 0xac, 0x6,  0x8a, 0xa7, 0xa8, 0x35, 0x26, 0x1d, 0x0,  0xc,  0x16, 0x82, 0xc5,
      0xa9, 0xfe, 0x5c, 0xb4, 0x90, 0xa4, 0x67, 0x9e, 0x6b, 0x8,  0x0,  0x1a, 0x0,  0xd6, 0x61, 0xaa, 0x1,  0xc0, 0x3,
      0x88, 0x4d, 0xfc, 0x1,  0xee, 0x71, 0xb7, 0x3,  0xac, 0x8a, 0xd5, 0x24, 0x5d, 0x9a, 0x4a, 0xa6, 0x8e, 0xe8, 0x52,
      0x22, 0x0,  0x9,  0x4d, 0x75, 0x2d, 0x7c, 0x84, 0xda, 0xd6, 0x6a, 0xfd, 0x24, 0x0,  0x1e, 0xf0, 0xa1, 0x83, 0x1f,
      0xd5, 0x11, 0xef, 0xde, 0xa,  0x85, 0xda, 0xb4, 0x6a, 0xb0, 0x70, 0xd7, 0xcc, 0x73, 0x8a, 0x74, 0x9a, 0x4e, 0xa3,
      0x21, 0xe3, 0x79, 0x28, 0xe9, 0x6c, 0xa6, 0x1c, 0x0,  0xf,  0xed, 0x88, 0x66, 0x83, 0x73, 0x70, 0x94, 0x69, 0x9e,
      0x2b, 0x63, 0x59, 0x74, 0x1b, 0x3b, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xc8, 0x50, 0xb1, 0xdd};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x41, 0xad, 0x3,  0xc,  0xe2, 0x6c, 0x7f, 0x4d, 0xe9, 0xc2,
                                     0x6e, 0x64, 0x4f, 0x34, 0xf8, 0xee, 0x82, 0xad, 0xe0, 0xd6};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf6, 0xde, 0x4e, 0xbd, 0x7a};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd8, 0x15, 0x51, 0xac, 0x6, 0x8a, 0xa7, 0xa8, 0x35, 0x26};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x16, 0x82, 0xc5, 0xa9, 0xfe, 0x5c, 0xb4, 0x90, 0xa4, 0x67, 0x9e, 0x6b};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x0,  0xd6, 0x61, 0xaa, 0x1,  0xc0, 0x3,  0x88, 0x4d, 0xfc, 0x1,  0xee, 0x71,
                                     0xb7, 0x3,  0xac, 0x8a, 0xd5, 0x24, 0x5d, 0x9a, 0x4a, 0xa6, 0x8e, 0xe8, 0x52};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4d, 0x75, 0x2d, 0x7c, 0x84, 0xda, 0xd6, 0x6a, 0xfd};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf0, 0xa1, 0x83, 0x1f, 0xd5, 0x11, 0xef, 0xde, 0xa,  0x85,
                                     0xda, 0xb4, 0x6a, 0xb0, 0x70, 0xd7, 0xcc, 0x73, 0x8a, 0x74,
                                     0x9a, 0x4e, 0xa3, 0x21, 0xe3, 0x79, 0x28, 0xe9, 0x6c, 0xa6};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xed, 0x88, 0x66, 0x83, 0x73, 0x70, 0x94, 0x69,
                                     0x9e, 0x2b, 0x63, 0x59, 0x74, 0x1b, 0x3b};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0x30, 0x96, 0x99, 0x17, 0x75, 0xb8, 0xf4};
  uint8_t bytesprops1[] = {0xbb, 0x39, 0x63, 0x22, 0xb2, 0xdb, 0xff};
  uint8_t bytesprops2[] = {0x30, 0x9e, 0xb0, 0x8d, 0x4f, 0x74, 0xc5, 0x85, 0x81, 0x91, 0x29,
                           0x7b, 0x74, 0x9e, 0xa4, 0x85, 0xc0, 0xe9, 0x87, 0xfb, 0x62, 0x43};
  uint8_t bytesprops4[] = {0x28, 0xa,  0x9,  0x91, 0xb3, 0x3c, 0xa2, 0x9d, 0x2d,
                           0xa,  0xad, 0xfe, 0xe1, 0x6a, 0x94, 0x20, 0xb0, 0x9d};
  uint8_t bytesprops3[] = {0xe3, 0x19, 0xbd, 0xf4, 0x9d, 0xf,  0x75, 0x50, 0xce, 0x3f, 0x52, 0xcd, 0x62, 0xd0,
                           0xbb, 0x90, 0x57, 0x39, 0xb3, 0xef, 0x53, 0xbe, 0xd6, 0x13, 0x1c, 0x3d, 0x33, 0xf9};
  uint8_t bytesprops5[] = {0x27, 0xff, 0xda, 0x4e, 0xa2};
  uint8_t bytesprops6[] = {0xbc, 0xdc, 0xe1, 0x9d, 0xc1};
  uint8_t bytesprops7[] = {0xec, 0xdf, 0x4b, 0x43, 0x11, 0x8e, 0x8c, 0xd9,
                           0xb,  0xe5, 0x7b, 0xb6, 0x65, 0x59, 0xcc, 0x5d};
  uint8_t bytesprops8[] = {0xf2, 0xe3, 0x23, 0x96, 0x82, 0xe2, 0xb2, 0xd7, 0x3e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16637}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops3}, .v = {18, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11024}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11339}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12885}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11607, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22426 [("\FS\227\218",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1})] [PropMaximumPacketSize 19858,PropAuthenticationMethod
// "\217<\SIme\220j\224Wj{\233\SIuW@&\133\254\155;\199\177\173",PropTopicAlias 574,PropSubscriptionIdentifierAvailable
// 218,PropReasonString "\253",PropReasonString "*\240\251\250S\202`\218",PropContentType
// "\SID`\\\150(\v\RSL\198\"r\141Do\247\CANP\193\230\189\ETX\161u",PropServerReference "\191",PropWillDelayInterval
// 12739,PropMaximumPacketSize 16985]
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x66, 0x57, 0x9a, 0x5d, 0x27, 0x0,  0x0,  0x4d, 0x92, 0x15, 0x0,  0x18, 0xd9, 0x3c,
                   0xf,  0x6d, 0x65, 0xdc, 0x6a, 0xe0, 0x57, 0x6a, 0x7b, 0xe9, 0xf,  0x75, 0x57, 0x40, 0x26,
                   0x85, 0xfe, 0x9b, 0x3b, 0xc7, 0xb1, 0xad, 0x23, 0x2,  0x3e, 0x29, 0xda, 0x1f, 0x0,  0x1,
                   0xfd, 0x1f, 0x0,  0x8,  0x2a, 0xf0, 0xfb, 0xfa, 0x53, 0xca, 0x60, 0xda, 0x3,  0x0,  0x18,
                   0xf,  0x44, 0x60, 0x5c, 0x96, 0x28, 0xb,  0x1e, 0x4c, 0xc6, 0x22, 0x72, 0x8d, 0x44, 0x6f,
                   0xf7, 0x18, 0x50, 0xc1, 0xe6, 0xbd, 0x3,  0xa1, 0x75, 0x1c, 0x0,  0x1,  0xbf, 0x18, 0x0,
                   0x0,  0x31, 0xc3, 0x27, 0x0,  0x0,  0x42, 0x59, 0x0,  0x3,  0x1c, 0xe3, 0xda, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x1c, 0xe3, 0xda};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  uint8_t bytesprops0[] = {0xd9, 0x3c, 0xf,  0x6d, 0x65, 0xdc, 0x6a, 0xe0, 0x57, 0x6a, 0x7b, 0xe9,
                           0xf,  0x75, 0x57, 0x40, 0x26, 0x85, 0xfe, 0x9b, 0x3b, 0xc7, 0xb1, 0xad};
  uint8_t bytesprops1[] = {0xfd};
  uint8_t bytesprops2[] = {0x2a, 0xf0, 0xfb, 0xfa, 0x53, 0xca, 0x60, 0xda};
  uint8_t bytesprops3[] = {0xf,  0x44, 0x60, 0x5c, 0x96, 0x28, 0xb,  0x1e, 0x4c, 0xc6, 0x22, 0x72,
                           0x8d, 0x44, 0x6f, 0xf7, 0x18, 0x50, 0xc1, 0xe6, 0xbd, 0x3,  0xa1, 0x75};
  uint8_t bytesprops4[] = {0xbf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19858}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 574}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12739}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16985}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22426, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
