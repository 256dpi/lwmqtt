#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\181m\255\144\250L\DC3iF\146\ACK\157\198\202\ACK\176\195z\141\216e\SYN\176", _pubPktID = 5540, _pubBody = "-\222",
// _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x3d, 0x1d, 0x0, 0x17, 0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6, 0x9d,
                   0xc6, 0xca, 0x6, 0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0, 0x15, 0xa4, 0x2d, 0xde};

  uint8_t buf[41] = {0};

  uint8_t topic_bytes[] = {0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6, 0x9d,
                           0xc6, 0xca, 0x6,  0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2d, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5540, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\181m\255\144\250L\DC3iF\146\ACK\157\198\202\ACK\176\195z\141\216e\SYN\176", _pubPktID = 5540, _pubBody = "-\222",
// _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x3d, 0x1d, 0x0, 0x17, 0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6, 0x9d,
                   0xc6, 0xca, 0x6, 0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0, 0x15, 0xa4, 0x2d, 0xde};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6, 0x9d,
                               0xc6, 0xca, 0x6,  0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2d, 0xde};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 5540);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "|5\229o-\r\179\163\252\150\208^\255(\140Y+\a\226xNy\RS\200\237\233\&5\214", _pubPktID = 0, _pubBody =
// "/\130\238\202\224\230", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x39, 0x24, 0x0,  0x1c, 0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc,
                   0x96, 0xd0, 0x5e, 0xff, 0x28, 0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79,
                   0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6, 0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};

  uint8_t buf[48] = {0};

  uint8_t topic_bytes[] = {0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc, 0x96, 0xd0, 0x5e, 0xff, 0x28,
                           0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79, 0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "|5\229o-\r\179\163\252\150\208^\255(\140Y+\a\226xNy\RS\200\237\233\&5\214", _pubPktID = 0, _pubBody =
// "/\130\238\202\224\230", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x39, 0x24, 0x0,  0x1c, 0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc,
                   0x96, 0xd0, 0x5e, 0xff, 0x28, 0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79,
                   0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6, 0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc, 0x96, 0xd0, 0x5e, 0xff, 0x28,
                               0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79, 0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "#s+\243\184\144t\234lj\248\SO=\182TOG$\130\135YOE+\204", _pubPktID = 9717, _pubBody = "\n}\168", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x35, 0x20, 0x0,  0x19, 0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea,
                   0x6c, 0x6a, 0xf8, 0xe,  0x3d, 0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87,
                   0x59, 0x4f, 0x45, 0x2b, 0xcc, 0x25, 0xf5, 0xa,  0x7d, 0xa8};

  uint8_t buf[44] = {0};

  uint8_t topic_bytes[] = {0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea, 0x6c, 0x6a, 0xf8, 0xe, 0x3d,
                           0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87, 0x59, 0x4f, 0x45, 0x2b, 0xcc};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa, 0x7d, 0xa8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 9717, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "#s+\243\184\144t\234lj\248\SO=\182TOG$\130\135YOE+\204", _pubPktID = 9717, _pubBody = "\n}\168", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x35, 0x20, 0x0,  0x19, 0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea,
                   0x6c, 0x6a, 0xf8, 0xe,  0x3d, 0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87,
                   0x59, 0x4f, 0x45, 0x2b, 0xcc, 0x25, 0xf5, 0xa,  0x7d, 0xa8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea, 0x6c, 0x6a, 0xf8, 0xe, 0x3d,
                               0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87, 0x59, 0x4f, 0x45, 0x2b, 0xcc};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa, 0x7d, 0xa8};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 9717);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\173\179\129=\155\186E\131\242g\224\149\&5\f\ESCk\250\130", _pubPktID = 696, _pubBody =
// "\210\212B\245\204\143IYw\217p\214\&5\152\133@\ETB{\FS\238\226", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x33, 0x2b, 0x0,  0x12, 0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2, 0x67, 0xe0,
                   0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82, 0x2,  0xb8, 0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f,
                   0x49, 0x59, 0x77, 0xd9, 0x70, 0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};

  uint8_t buf[55] = {0};

  uint8_t topic_bytes[] = {0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2,
                           0x67, 0xe0, 0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f, 0x49, 0x59, 0x77, 0xd9, 0x70,
                         0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 696, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\173\179\129=\155\186E\131\242g\224\149\&5\f\ESCk\250\130", _pubPktID = 696, _pubBody =
// "\210\212B\245\204\143IYw\217p\214\&5\152\133@\ETB{\FS\238\226", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x33, 0x2b, 0x0,  0x12, 0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2, 0x67, 0xe0,
                   0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82, 0x2,  0xb8, 0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f,
                   0x49, 0x59, 0x77, 0xd9, 0x70, 0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2,
                               0x67, 0xe0, 0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f, 0x49, 0x59, 0x77, 0xd9, 0x70,
                              0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 696);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "!\189a\ENQ\235r\186\232?!\140O>\201\220\163\133\166!\139i", _pubPktID = 0, _pubBody =
// "\249\159L\166\132\147`Q\206\238\229\138\217\DEL\219\t\243\131\192H\SIJ\168@y", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x38, 0x30, 0x0,  0x15, 0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c, 0x4f, 0x3e,
                   0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69, 0xf9, 0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce,
                   0xee, 0xe5, 0x8a, 0xd9, 0x7f, 0xdb, 0x9,  0xf3, 0x83, 0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};

  uint8_t buf[60] = {0};

  uint8_t topic_bytes[] = {0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c,
                           0x4f, 0x3e, 0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf9, 0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce, 0xee, 0xe5, 0x8a, 0xd9,
                         0x7f, 0xdb, 0x9,  0xf3, 0x83, 0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "!\189a\ENQ\235r\186\232?!\140O>\201\220\163\133\166!\139i", _pubPktID = 0, _pubBody =
// "\249\159L\166\132\147`Q\206\238\229\138\217\DEL\219\t\243\131\192H\SIJ\168@y", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x38, 0x30, 0x0,  0x15, 0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c, 0x4f, 0x3e,
                   0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69, 0xf9, 0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce,
                   0xee, 0xe5, 0x8a, 0xd9, 0x7f, 0xdb, 0x9,  0xf3, 0x83, 0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c,
                               0x4f, 0x3e, 0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf9, 0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce, 0xee, 0xe5, 0x8a, 0xd9,
                              0x7f, 0xdb, 0x9,  0xf3, 0x83, 0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\216WQ\"", _pubPktID = 0, _pubBody =
// "\v\225\187\153*%\252qh\193\210\232\r0tw\196\176*\254C", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x38, 0x1b, 0x0,  0x4,  0xd8, 0x57, 0x51, 0x22, 0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc,
                   0x71, 0x68, 0xc1, 0xd2, 0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};

  uint8_t buf[39] = {0};

  uint8_t topic_bytes[] = {0xd8, 0x57, 0x51, 0x22};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc, 0x71, 0x68, 0xc1, 0xd2,
                         0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\216WQ\"", _pubPktID = 0, _pubBody =
// "\v\225\187\153*%\252qh\193\210\232\r0tw\196\176*\254C", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x38, 0x1b, 0x0,  0x4,  0xd8, 0x57, 0x51, 0x22, 0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc,
                   0x71, 0x68, 0xc1, 0xd2, 0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd8, 0x57, 0x51, 0x22};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc, 0x71, 0x68, 0xc1, 0xd2,
                              0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\130\tw\142", _pubPktID = 9801,
// _pubBody = "\154z+\141\DC3\201)z\n", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x32, 0x11, 0x0,  0x4,  0x82, 0x9,  0x77, 0x8e, 0x26, 0x49,
                   0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};

  uint8_t buf[29] = {0};

  uint8_t topic_bytes[] = {0x82, 0x9, 0x77, 0x8e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 9801, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\130\tw\142", _pubPktID = 9801,
// _pubBody = "\154z+\141\DC3\201)z\n", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x32, 0x11, 0x0,  0x4,  0x82, 0x9,  0x77, 0x8e, 0x26, 0x49,
                   0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x82, 0x9, 0x77, 0x8e};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 9801);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "W\165\ETX\202d\140Z\185\FSm\158\159\206Gj\177D\DC3\250=", _pubPktID = 0, _pubBody =
// "\204r\156\176\144\163\ESC+\228\214X\196\&6\212\179\NULI\132\128`nQ\153\188\153", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x39, 0x2f, 0x0,  0x14, 0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d, 0x9e, 0x9f, 0xce,
                   0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d, 0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4, 0xd6,
                   0x58, 0xc4, 0x36, 0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};

  uint8_t buf[59] = {0};

  uint8_t topic_bytes[] = {0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d,
                           0x9e, 0x9f, 0xce, 0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4, 0xd6, 0x58, 0xc4, 0x36,
                         0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "W\165\ETX\202d\140Z\185\FSm\158\159\206Gj\177D\DC3\250=", _pubPktID = 0, _pubBody =
// "\204r\156\176\144\163\ESC+\228\214X\196\&6\212\179\NULI\132\128`nQ\153\188\153", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x39, 0x2f, 0x0,  0x14, 0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d, 0x9e, 0x9f, 0xce,
                   0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d, 0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4, 0xd6,
                   0x58, 0xc4, 0x36, 0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d,
                               0x9e, 0x9f, 0xce, 0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4, 0xd6, 0x58, 0xc4, 0x36,
                              0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\STX", _pubPktID = 30584, _pubBody =
// "u\219\"\173\243\187\226Z\193\t\210\"\201K)", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x3b, 0x14, 0x0,  0x1,  0x2,  0x77, 0x78, 0x75, 0xdb, 0x22, 0xad,
                   0xf3, 0xbb, 0xe2, 0x5a, 0xc1, 0x9,  0xd2, 0x22, 0xc9, 0x4b, 0x29};

  uint8_t buf[32] = {0};

  uint8_t topic_bytes[] = {0x2};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x75, 0xdb, 0x22, 0xad, 0xf3, 0xbb, 0xe2, 0x5a, 0xc1, 0x9, 0xd2, 0x22, 0xc9, 0x4b, 0x29};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 30584, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\STX", _pubPktID = 30584, _pubBody =
// "u\219\"\173\243\187\226Z\193\t\210\"\201K)", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x3b, 0x14, 0x0,  0x1,  0x2,  0x77, 0x78, 0x75, 0xdb, 0x22, 0xad,
                   0xf3, 0xbb, 0xe2, 0x5a, 0xc1, 0x9,  0xd2, 0x22, 0xc9, 0x4b, 0x29};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x75, 0xdb, 0x22, 0xad, 0xf3, 0xbb, 0xe2, 0x5a, 0xc1, 0x9, 0xd2, 0x22, 0xc9, 0x4b, 0x29};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 30584);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "E_/\183|O\206\131\173f\212\204",
// _pubPktID = 31613, _pubBody = "\155\216/Ef", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x32, 0x15, 0x0,  0xc,  0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83,
                   0xad, 0x66, 0xd4, 0xcc, 0x7b, 0x7d, 0x9b, 0xd8, 0x2f, 0x45, 0x66};

  uint8_t buf[33] = {0};

  uint8_t topic_bytes[] = {0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83, 0xad, 0x66, 0xd4, 0xcc};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9b, 0xd8, 0x2f, 0x45, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 31613, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "E_/\183|O\206\131\173f\212\204",
// _pubPktID = 31613, _pubBody = "\155\216/Ef", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x32, 0x15, 0x0,  0xc,  0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83,
                   0xad, 0x66, 0xd4, 0xcc, 0x7b, 0x7d, 0x9b, 0xd8, 0x2f, 0x45, 0x66};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83, 0xad, 0x66, 0xd4, 0xcc};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0xd8, 0x2f, 0x45, 0x66};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31613);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\181m\255\144\250L\DC3iF\146\ACK\157\198\202\ACK\176\195z\141\216e\SYN\176", _pubPktID = 5540, _pubBody = "-\222",
// _pubProps = [PropMessageExpiryInterval 31218,PropMessageExpiryInterval 6930,PropSessionExpiryInterval
// 32694,PropUserProperty "\155 N\153]\236?\192FZu}\139L\176m\189\211Jq\183~\202\t\159"
// "!\\\179x\147\242_",PropSubscriptionIdentifier 6,PropSubscriptionIdentifierAvailable
// 171,PropRequestResponseInformation 68,PropRetainAvailable 146,PropMaximumPacketSize
// 18652,PropRequestResponseInformation 207,PropSubscriptionIdentifierAvailable 232,PropMaximumPacketSize
// 26180,PropTopicAlias 20402,PropMessageExpiryInterval 15307,PropUserProperty "\ENQ\247G"
// "xK+e\211r\SO\192]k\203\DC1\170in\NUL",PropAssignedClientIdentifier
// "\CANH\224A}S\SUBLe^1\150\227)_uM\190\232(",PropResponseTopic "Ql\133\206l",PropUserProperty
// "\214\NUL\146\136\192#(l" "\189\155\DC3\218b;\154\142\187\169t3$U\189\RS\249\202\232:i",PropAuthenticationData
// "\171\190`\236\157\185\192Q\246\245x\216M\241\ETXB\233d\137",PropResponseTopic
// "\148\208K\143r3?\247,v\230\171@F\162",PropMessageExpiryInterval 18906,PropRequestProblemInformation
// 117,PropPayloadFormatIndicator 196,PropSessionExpiryInterval 9189,PropWildcardSubscriptionAvailable
// 26,PropRequestResponseInformation 184,PropResponseTopic "\149\&4K",PropResponseInformation
// "\175;\a,C\155\t\178\RSe\172\192\201n\146\138\164d\DEL\184X\216\201\224y\184\206\v",PropPayloadFormatIndicator
// 172,PropRetainAvailable 73]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x3d, 0xad, 0x2,  0x0,  0x17, 0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6,  0x9d, 0xc6, 0xca,
      0x6,  0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0, 0x15, 0xa4, 0x8e, 0x2,  0x2,  0x0,  0x0,  0x79, 0xf2, 0x2,
      0x0,  0x0,  0x1b, 0x12, 0x11, 0x0,  0x0,  0x7f, 0xb6, 0x26, 0x0,  0x19, 0x9b, 0x20, 0x4e, 0x99, 0x5d, 0xec, 0x3f,
      0xc0, 0x46, 0x5a, 0x75, 0x7d, 0x8b, 0x4c, 0xb0, 0x6d, 0xbd, 0xd3, 0x4a, 0x71, 0xb7, 0x7e, 0xca, 0x9,  0x9f, 0x0,
      0x7,  0x21, 0x5c, 0xb3, 0x78, 0x93, 0xf2, 0x5f, 0xb,  0x6,  0x29, 0xab, 0x19, 0x44, 0x25, 0x92, 0x27, 0x0,  0x0,
      0x48, 0xdc, 0x19, 0xcf, 0x29, 0xe8, 0x27, 0x0,  0x0,  0x66, 0x44, 0x23, 0x4f, 0xb2, 0x2,  0x0,  0x0,  0x3b, 0xcb,
      0x26, 0x0,  0x3,  0x5,  0xf7, 0x47, 0x0,  0x10, 0x78, 0x4b, 0x2b, 0x65, 0xd3, 0x72, 0xe,  0xc0, 0x5d, 0x6b, 0xcb,
      0x11, 0xaa, 0x69, 0x6e, 0x0,  0x12, 0x0,  0x14, 0x18, 0x48, 0xe0, 0x41, 0x7d, 0x53, 0x1a, 0x4c, 0x65, 0x5e, 0x31,
      0x96, 0xe3, 0x29, 0x5f, 0x75, 0x4d, 0xbe, 0xe8, 0x28, 0x8,  0x0,  0x5,  0x51, 0x6c, 0x85, 0xce, 0x6c, 0x26, 0x0,
      0x8,  0xd6, 0x0,  0x92, 0x88, 0xc0, 0x23, 0x28, 0x6c, 0x0,  0x15, 0xbd, 0x9b, 0x13, 0xda, 0x62, 0x3b, 0x9a, 0x8e,
      0xbb, 0xa9, 0x74, 0x33, 0x24, 0x55, 0xbd, 0x1e, 0xf9, 0xca, 0xe8, 0x3a, 0x69, 0x16, 0x0,  0x13, 0xab, 0xbe, 0x60,
      0xec, 0x9d, 0xb9, 0xc0, 0x51, 0xf6, 0xf5, 0x78, 0xd8, 0x4d, 0xf1, 0x3,  0x42, 0xe9, 0x64, 0x89, 0x8,  0x0,  0xf,
      0x94, 0xd0, 0x4b, 0x8f, 0x72, 0x33, 0x3f, 0xf7, 0x2c, 0x76, 0xe6, 0xab, 0x40, 0x46, 0xa2, 0x2,  0x0,  0x0,  0x49,
      0xda, 0x17, 0x75, 0x1,  0xc4, 0x11, 0x0,  0x0,  0x23, 0xe5, 0x28, 0x1a, 0x19, 0xb8, 0x8,  0x0,  0x3,  0x95, 0x34,
      0x4b, 0x1a, 0x0,  0x1c, 0xaf, 0x3b, 0x7,  0x2c, 0x43, 0x9b, 0x9,  0xb2, 0x1e, 0x65, 0xac, 0xc0, 0xc9, 0x6e, 0x92,
      0x8a, 0xa4, 0x64, 0x7f, 0xb8, 0x58, 0xd8, 0xc9, 0xe0, 0x79, 0xb8, 0xce, 0xb,  0x1,  0xac, 0x25, 0x49, 0x2d, 0xde};

  uint8_t buf[314] = {0};

  uint8_t topic_bytes[] = {0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6, 0x9d,
                           0xc6, 0xca, 0x6,  0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2d, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops1[] = {0x21, 0x5c, 0xb3, 0x78, 0x93, 0xf2, 0x5f};
  uint8_t bytesprops0[] = {0x9b, 0x20, 0x4e, 0x99, 0x5d, 0xec, 0x3f, 0xc0, 0x46, 0x5a, 0x75, 0x7d, 0x8b,
                           0x4c, 0xb0, 0x6d, 0xbd, 0xd3, 0x4a, 0x71, 0xb7, 0x7e, 0xca, 0x9,  0x9f};
  uint8_t bytesprops3[] = {0x78, 0x4b, 0x2b, 0x65, 0xd3, 0x72, 0xe,  0xc0,
                           0x5d, 0x6b, 0xcb, 0x11, 0xaa, 0x69, 0x6e, 0x0};
  uint8_t bytesprops2[] = {0x5, 0xf7, 0x47};
  uint8_t bytesprops4[] = {0x18, 0x48, 0xe0, 0x41, 0x7d, 0x53, 0x1a, 0x4c, 0x65, 0x5e,
                           0x31, 0x96, 0xe3, 0x29, 0x5f, 0x75, 0x4d, 0xbe, 0xe8, 0x28};
  uint8_t bytesprops5[] = {0x51, 0x6c, 0x85, 0xce, 0x6c};
  uint8_t bytesprops7[] = {0xbd, 0x9b, 0x13, 0xda, 0x62, 0x3b, 0x9a, 0x8e, 0xbb, 0xa9, 0x74,
                           0x33, 0x24, 0x55, 0xbd, 0x1e, 0xf9, 0xca, 0xe8, 0x3a, 0x69};
  uint8_t bytesprops6[] = {0xd6, 0x0, 0x92, 0x88, 0xc0, 0x23, 0x28, 0x6c};
  uint8_t bytesprops8[] = {0xab, 0xbe, 0x60, 0xec, 0x9d, 0xb9, 0xc0, 0x51, 0xf6, 0xf5,
                           0x78, 0xd8, 0x4d, 0xf1, 0x3,  0x42, 0xe9, 0x64, 0x89};
  uint8_t bytesprops9[] = {0x94, 0xd0, 0x4b, 0x8f, 0x72, 0x33, 0x3f, 0xf7, 0x2c, 0x76, 0xe6, 0xab, 0x40, 0x46, 0xa2};
  uint8_t bytesprops10[] = {0x95, 0x34, 0x4b};
  uint8_t bytesprops11[] = {0xaf, 0x3b, 0x7,  0x2c, 0x43, 0x9b, 0x9,  0xb2, 0x1e, 0x65, 0xac, 0xc0, 0xc9, 0x6e,
                            0x92, 0x8a, 0xa4, 0x64, 0x7f, 0xb8, 0x58, 0xd8, 0xc9, 0xe0, 0x79, 0xb8, 0xce, 0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31218}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6930}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32694}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops0}, .v = {7, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18652}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26180}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20402}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15307}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops2}, .v = {16, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops6}, .v = {21, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18906}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9189}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 73}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5540, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\181m\255\144\250L\DC3iF\146\ACK\157\198\202\ACK\176\195z\141\216e\SYN\176", _pubPktID = 5540, _pubBody = "-\222",
// _pubProps = [PropMessageExpiryInterval 31218,PropMessageExpiryInterval 6930,PropSessionExpiryInterval
// 32694,PropUserProperty "\155 N\153]\236?\192FZu}\139L\176m\189\211Jq\183~\202\t\159"
// "!\\\179x\147\242_",PropSubscriptionIdentifier 6,PropSubscriptionIdentifierAvailable
// 171,PropRequestResponseInformation 68,PropRetainAvailable 146,PropMaximumPacketSize
// 18652,PropRequestResponseInformation 207,PropSubscriptionIdentifierAvailable 232,PropMaximumPacketSize
// 26180,PropTopicAlias 20402,PropMessageExpiryInterval 15307,PropUserProperty "\ENQ\247G"
// "xK+e\211r\SO\192]k\203\DC1\170in\NUL",PropAssignedClientIdentifier
// "\CANH\224A}S\SUBLe^1\150\227)_uM\190\232(",PropResponseTopic "Ql\133\206l",PropUserProperty
// "\214\NUL\146\136\192#(l" "\189\155\DC3\218b;\154\142\187\169t3$U\189\RS\249\202\232:i",PropAuthenticationData
// "\171\190`\236\157\185\192Q\246\245x\216M\241\ETXB\233d\137",PropResponseTopic
// "\148\208K\143r3?\247,v\230\171@F\162",PropMessageExpiryInterval 18906,PropRequestProblemInformation
// 117,PropPayloadFormatIndicator 196,PropSessionExpiryInterval 9189,PropWildcardSubscriptionAvailable
// 26,PropRequestResponseInformation 184,PropResponseTopic "\149\&4K",PropResponseInformation
// "\175;\a,C\155\t\178\RSe\172\192\201n\146\138\164d\DEL\184X\216\201\224y\184\206\v",PropPayloadFormatIndicator
// 172,PropRetainAvailable 73]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {
      0x3d, 0xad, 0x2,  0x0,  0x17, 0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6,  0x9d, 0xc6, 0xca,
      0x6,  0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0, 0x15, 0xa4, 0x8e, 0x2,  0x2,  0x0,  0x0,  0x79, 0xf2, 0x2,
      0x0,  0x0,  0x1b, 0x12, 0x11, 0x0,  0x0,  0x7f, 0xb6, 0x26, 0x0,  0x19, 0x9b, 0x20, 0x4e, 0x99, 0x5d, 0xec, 0x3f,
      0xc0, 0x46, 0x5a, 0x75, 0x7d, 0x8b, 0x4c, 0xb0, 0x6d, 0xbd, 0xd3, 0x4a, 0x71, 0xb7, 0x7e, 0xca, 0x9,  0x9f, 0x0,
      0x7,  0x21, 0x5c, 0xb3, 0x78, 0x93, 0xf2, 0x5f, 0xb,  0x6,  0x29, 0xab, 0x19, 0x44, 0x25, 0x92, 0x27, 0x0,  0x0,
      0x48, 0xdc, 0x19, 0xcf, 0x29, 0xe8, 0x27, 0x0,  0x0,  0x66, 0x44, 0x23, 0x4f, 0xb2, 0x2,  0x0,  0x0,  0x3b, 0xcb,
      0x26, 0x0,  0x3,  0x5,  0xf7, 0x47, 0x0,  0x10, 0x78, 0x4b, 0x2b, 0x65, 0xd3, 0x72, 0xe,  0xc0, 0x5d, 0x6b, 0xcb,
      0x11, 0xaa, 0x69, 0x6e, 0x0,  0x12, 0x0,  0x14, 0x18, 0x48, 0xe0, 0x41, 0x7d, 0x53, 0x1a, 0x4c, 0x65, 0x5e, 0x31,
      0x96, 0xe3, 0x29, 0x5f, 0x75, 0x4d, 0xbe, 0xe8, 0x28, 0x8,  0x0,  0x5,  0x51, 0x6c, 0x85, 0xce, 0x6c, 0x26, 0x0,
      0x8,  0xd6, 0x0,  0x92, 0x88, 0xc0, 0x23, 0x28, 0x6c, 0x0,  0x15, 0xbd, 0x9b, 0x13, 0xda, 0x62, 0x3b, 0x9a, 0x8e,
      0xbb, 0xa9, 0x74, 0x33, 0x24, 0x55, 0xbd, 0x1e, 0xf9, 0xca, 0xe8, 0x3a, 0x69, 0x16, 0x0,  0x13, 0xab, 0xbe, 0x60,
      0xec, 0x9d, 0xb9, 0xc0, 0x51, 0xf6, 0xf5, 0x78, 0xd8, 0x4d, 0xf1, 0x3,  0x42, 0xe9, 0x64, 0x89, 0x8,  0x0,  0xf,
      0x94, 0xd0, 0x4b, 0x8f, 0x72, 0x33, 0x3f, 0xf7, 0x2c, 0x76, 0xe6, 0xab, 0x40, 0x46, 0xa2, 0x2,  0x0,  0x0,  0x49,
      0xda, 0x17, 0x75, 0x1,  0xc4, 0x11, 0x0,  0x0,  0x23, 0xe5, 0x28, 0x1a, 0x19, 0xb8, 0x8,  0x0,  0x3,  0x95, 0x34,
      0x4b, 0x1a, 0x0,  0x1c, 0xaf, 0x3b, 0x7,  0x2c, 0x43, 0x9b, 0x9,  0xb2, 0x1e, 0x65, 0xac, 0xc0, 0xc9, 0x6e, 0x92,
      0x8a, 0xa4, 0x64, 0x7f, 0xb8, 0x58, 0xd8, 0xc9, 0xe0, 0x79, 0xb8, 0xce, 0xb,  0x1,  0xac, 0x25, 0x49, 0x2d, 0xde};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb5, 0x6d, 0xff, 0x90, 0xfa, 0x4c, 0x13, 0x69, 0x46, 0x92, 0x6, 0x9d,
                               0xc6, 0xca, 0x6,  0xb0, 0xc3, 0x7a, 0x8d, 0xd8, 0x65, 0x16, 0xb0};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2d, 0xde};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 5540);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "|5\229o-\r\179\163\252\150\208^\255(\140Y+\a\226xNy\RS\200\237\233\&5\214", _pubPktID = 0, _pubBody =
// "/\130\238\202\224\230", _pubProps = [PropSessionExpiryInterval 13319,PropReceiveMaximum
// 2476,PropPayloadFormatIndicator 219,PropRetainAvailable 217,PropSubscriptionIdentifier 21,PropServerReference
// "-\CANBb\a\211\&4\201M\227\140B\189\b9\135\188X\SOH'X",PropMaximumPacketSize 28709,PropMessageExpiryInterval
// 28695,PropSubscriptionIdentifier 7,PropPayloadFormatIndicator 174,PropRequestProblemInformation
// 173,PropWillDelayInterval 1999,PropTopicAlias 31049,PropSubscriptionIdentifierAvailable
// 105,PropSubscriptionIdentifier 4,PropSubscriptionIdentifierAvailable 86,PropTopicAliasMaximum
// 14292,PropTopicAliasMaximum 12764,PropMaximumQoS 159,PropWildcardSubscriptionAvailable 197]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {0x39, 0x73, 0x0,  0x1c, 0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc, 0x96, 0xd0, 0x5e, 0xff,
                   0x28, 0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79, 0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6, 0x4e, 0x11,
                   0x0,  0x0,  0x34, 0x7,  0x21, 0x9,  0xac, 0x1,  0xdb, 0x25, 0xd9, 0xb,  0x15, 0x1c, 0x0,  0x15, 0x2d,
                   0x18, 0x42, 0x62, 0x7,  0xd3, 0x34, 0xc9, 0x4d, 0xe3, 0x8c, 0x42, 0xbd, 0x8,  0x39, 0x87, 0xbc, 0x58,
                   0x1,  0x27, 0x58, 0x27, 0x0,  0x0,  0x70, 0x25, 0x2,  0x0,  0x0,  0x70, 0x17, 0xb,  0x7,  0x1,  0xae,
                   0x17, 0xad, 0x18, 0x0,  0x0,  0x7,  0xcf, 0x23, 0x79, 0x49, 0x29, 0x69, 0xb,  0x4,  0x29, 0x56, 0x22,
                   0x37, 0xd4, 0x22, 0x31, 0xdc, 0x24, 0x9f, 0x28, 0xc5, 0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};

  uint8_t buf[127] = {0};

  uint8_t topic_bytes[] = {0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc, 0x96, 0xd0, 0x5e, 0xff, 0x28,
                           0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79, 0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytesprops0[] = {0x2d, 0x18, 0x42, 0x62, 0x7,  0xd3, 0x34, 0xc9, 0x4d, 0xe3, 0x8c,
                           0x42, 0xbd, 0x8,  0x39, 0x87, 0xbc, 0x58, 0x1,  0x27, 0x58};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13319}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2476}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28709}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28695}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1999}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31049}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14292}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12764}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 197}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "|5\229o-\r\179\163\252\150\208^\255(\140Y+\a\226xNy\RS\200\237\233\&5\214", _pubPktID = 0, _pubBody =
// "/\130\238\202\224\230", _pubProps = [PropSessionExpiryInterval 13319,PropReceiveMaximum
// 2476,PropPayloadFormatIndicator 219,PropRetainAvailable 217,PropSubscriptionIdentifier 21,PropServerReference
// "-\CANBb\a\211\&4\201M\227\140B\189\b9\135\188X\SOH'X",PropMaximumPacketSize 28709,PropMessageExpiryInterval
// 28695,PropSubscriptionIdentifier 7,PropPayloadFormatIndicator 174,PropRequestProblemInformation
// 173,PropWillDelayInterval 1999,PropTopicAlias 31049,PropSubscriptionIdentifierAvailable
// 105,PropSubscriptionIdentifier 4,PropSubscriptionIdentifierAvailable 86,PropTopicAliasMaximum
// 14292,PropTopicAliasMaximum 12764,PropMaximumQoS 159,PropWildcardSubscriptionAvailable 197]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {0x39, 0x73, 0x0,  0x1c, 0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc, 0x96, 0xd0, 0x5e, 0xff,
                   0x28, 0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79, 0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6, 0x4e, 0x11,
                   0x0,  0x0,  0x34, 0x7,  0x21, 0x9,  0xac, 0x1,  0xdb, 0x25, 0xd9, 0xb,  0x15, 0x1c, 0x0,  0x15, 0x2d,
                   0x18, 0x42, 0x62, 0x7,  0xd3, 0x34, 0xc9, 0x4d, 0xe3, 0x8c, 0x42, 0xbd, 0x8,  0x39, 0x87, 0xbc, 0x58,
                   0x1,  0x27, 0x58, 0x27, 0x0,  0x0,  0x70, 0x25, 0x2,  0x0,  0x0,  0x70, 0x17, 0xb,  0x7,  0x1,  0xae,
                   0x17, 0xad, 0x18, 0x0,  0x0,  0x7,  0xcf, 0x23, 0x79, 0x49, 0x29, 0x69, 0xb,  0x4,  0x29, 0x56, 0x22,
                   0x37, 0xd4, 0x22, 0x31, 0xdc, 0x24, 0x9f, 0x28, 0xc5, 0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7c, 0x35, 0xe5, 0x6f, 0x2d, 0xd,  0xb3, 0xa3, 0xfc, 0x96, 0xd0, 0x5e, 0xff, 0x28,
                               0x8c, 0x59, 0x2b, 0x7,  0xe2, 0x78, 0x4e, 0x79, 0x1e, 0xc8, 0xed, 0xe9, 0x35, 0xd6};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2f, 0x82, 0xee, 0xca, 0xe0, 0xe6};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "#s+\243\184\144t\234lj\248\SO=\182TOG$\130\135YOE+\204", _pubPktID = 9717, _pubBody = "\n}\168", _pubProps =
// [PropReasonString "B\198+o;\198\n",PropSharedSubscriptionAvailable 12,PropResponseInformation
// "\DEL\175&H\NAK\178Wd4\RS\228",PropContentType
// "\t\nu\214'\180P^\247\250\&9\201\188\174\US>p\225",PropMaximumPacketSize 28051,PropTopicAlias
// 2937,PropSharedSubscriptionAvailable 108,PropWildcardSubscriptionAvailable 106,PropServerKeepAlive
// 8610,PropMessageExpiryInterval 31767,PropReasonString
// "K\190\200\150\223\234\232\DC3eE\218\221*\239\US\246\214\224%",PropTopicAlias 13083,PropSharedSubscriptionAvailable
// 85,PropResponseInformation "?D}\233\NAK\177\235\227\253\\\187\237}#",PropUserProperty "\NULz{\159\224L\193_;\CAN"
// "e\n\197\214\153\193\247\174\157\179I\SOC@SD\170\243a\136\141\r\"",PropRequestProblemInformation
// 28,PropPayloadFormatIndicator 242,PropAuthenticationData
// "\220\166s\EOTB\234o&QX\174\ACK\GS[\223\RS",PropAuthenticationMethod "\238\244"]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x35, 0xd3, 0x1,  0x0,  0x19, 0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea, 0x6c, 0x6a, 0xf8, 0xe,
                   0x3d, 0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87, 0x59, 0x4f, 0x45, 0x2b, 0xcc, 0x25, 0xf5, 0xb1, 0x1,
                   0x1f, 0x0,  0x7,  0x42, 0xc6, 0x2b, 0x6f, 0x3b, 0xc6, 0xa,  0x2a, 0xc,  0x1a, 0x0,  0xb,  0x7f, 0xaf,
                   0x26, 0x48, 0x15, 0xb2, 0x57, 0x64, 0x34, 0x1e, 0xe4, 0x3,  0x0,  0x12, 0x9,  0xa,  0x75, 0xd6, 0x27,
                   0xb4, 0x50, 0x5e, 0xf7, 0xfa, 0x39, 0xc9, 0xbc, 0xae, 0x1f, 0x3e, 0x70, 0xe1, 0x27, 0x0,  0x0,  0x6d,
                   0x93, 0x23, 0xb,  0x79, 0x2a, 0x6c, 0x28, 0x6a, 0x13, 0x21, 0xa2, 0x2,  0x0,  0x0,  0x7c, 0x17, 0x1f,
                   0x0,  0x13, 0x4b, 0xbe, 0xc8, 0x96, 0xdf, 0xea, 0xe8, 0x13, 0x65, 0x45, 0xda, 0xdd, 0x2a, 0xef, 0x1f,
                   0xf6, 0xd6, 0xe0, 0x25, 0x23, 0x33, 0x1b, 0x2a, 0x55, 0x1a, 0x0,  0xe,  0x3f, 0x44, 0x7d, 0xe9, 0x15,
                   0xb1, 0xeb, 0xe3, 0xfd, 0x5c, 0xbb, 0xed, 0x7d, 0x23, 0x26, 0x0,  0xa,  0x0,  0x7a, 0x7b, 0x9f, 0xe0,
                   0x4c, 0xc1, 0x5f, 0x3b, 0x18, 0x0,  0x17, 0x65, 0xa,  0xc5, 0xd6, 0x99, 0xc1, 0xf7, 0xae, 0x9d, 0xb3,
                   0x49, 0xe,  0x43, 0x40, 0x53, 0x44, 0xaa, 0xf3, 0x61, 0x88, 0x8d, 0xd,  0x22, 0x17, 0x1c, 0x1,  0xf2,
                   0x16, 0x0,  0x10, 0xdc, 0xa6, 0x73, 0x4,  0x42, 0xea, 0x6f, 0x26, 0x51, 0x58, 0xae, 0x6,  0x1d, 0x5b,
                   0xdf, 0x1e, 0x15, 0x0,  0x2,  0xee, 0xf4, 0xa,  0x7d, 0xa8};

  uint8_t buf[224] = {0};

  uint8_t topic_bytes[] = {0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea, 0x6c, 0x6a, 0xf8, 0xe, 0x3d,
                           0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87, 0x59, 0x4f, 0x45, 0x2b, 0xcc};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa, 0x7d, 0xa8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0x42, 0xc6, 0x2b, 0x6f, 0x3b, 0xc6, 0xa};
  uint8_t bytesprops1[] = {0x7f, 0xaf, 0x26, 0x48, 0x15, 0xb2, 0x57, 0x64, 0x34, 0x1e, 0xe4};
  uint8_t bytesprops2[] = {0x9,  0xa,  0x75, 0xd6, 0x27, 0xb4, 0x50, 0x5e, 0xf7,
                           0xfa, 0x39, 0xc9, 0xbc, 0xae, 0x1f, 0x3e, 0x70, 0xe1};
  uint8_t bytesprops3[] = {0x4b, 0xbe, 0xc8, 0x96, 0xdf, 0xea, 0xe8, 0x13, 0x65, 0x45,
                           0xda, 0xdd, 0x2a, 0xef, 0x1f, 0xf6, 0xd6, 0xe0, 0x25};
  uint8_t bytesprops4[] = {0x3f, 0x44, 0x7d, 0xe9, 0x15, 0xb1, 0xeb, 0xe3, 0xfd, 0x5c, 0xbb, 0xed, 0x7d, 0x23};
  uint8_t bytesprops6[] = {0x65, 0xa,  0xc5, 0xd6, 0x99, 0xc1, 0xf7, 0xae, 0x9d, 0xb3, 0x49, 0xe,
                           0x43, 0x40, 0x53, 0x44, 0xaa, 0xf3, 0x61, 0x88, 0x8d, 0xd,  0x22};
  uint8_t bytesprops5[] = {0x0, 0x7a, 0x7b, 0x9f, 0xe0, 0x4c, 0xc1, 0x5f, 0x3b, 0x18};
  uint8_t bytesprops7[] = {0xdc, 0xa6, 0x73, 0x4, 0x42, 0xea, 0x6f, 0x26,
                           0x51, 0x58, 0xae, 0x6, 0x1d, 0x5b, 0xdf, 0x1e};
  uint8_t bytesprops8[] = {0xee, 0xf4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28051}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2937}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8610}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31767}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13083}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops5}, .v = {23, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 9717, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "#s+\243\184\144t\234lj\248\SO=\182TOG$\130\135YOE+\204", _pubPktID = 9717, _pubBody = "\n}\168", _pubProps =
// [PropReasonString "B\198+o;\198\n",PropSharedSubscriptionAvailable 12,PropResponseInformation
// "\DEL\175&H\NAK\178Wd4\RS\228",PropContentType
// "\t\nu\214'\180P^\247\250\&9\201\188\174\US>p\225",PropMaximumPacketSize 28051,PropTopicAlias
// 2937,PropSharedSubscriptionAvailable 108,PropWildcardSubscriptionAvailable 106,PropServerKeepAlive
// 8610,PropMessageExpiryInterval 31767,PropReasonString
// "K\190\200\150\223\234\232\DC3eE\218\221*\239\US\246\214\224%",PropTopicAlias 13083,PropSharedSubscriptionAvailable
// 85,PropResponseInformation "?D}\233\NAK\177\235\227\253\\\187\237}#",PropUserProperty "\NULz{\159\224L\193_;\CAN"
// "e\n\197\214\153\193\247\174\157\179I\SOC@SD\170\243a\136\141\r\"",PropRequestProblemInformation
// 28,PropPayloadFormatIndicator 242,PropAuthenticationData
// "\220\166s\EOTB\234o&QX\174\ACK\GS[\223\RS",PropAuthenticationMethod "\238\244"]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x35, 0xd3, 0x1,  0x0,  0x19, 0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea, 0x6c, 0x6a, 0xf8, 0xe,
                   0x3d, 0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87, 0x59, 0x4f, 0x45, 0x2b, 0xcc, 0x25, 0xf5, 0xb1, 0x1,
                   0x1f, 0x0,  0x7,  0x42, 0xc6, 0x2b, 0x6f, 0x3b, 0xc6, 0xa,  0x2a, 0xc,  0x1a, 0x0,  0xb,  0x7f, 0xaf,
                   0x26, 0x48, 0x15, 0xb2, 0x57, 0x64, 0x34, 0x1e, 0xe4, 0x3,  0x0,  0x12, 0x9,  0xa,  0x75, 0xd6, 0x27,
                   0xb4, 0x50, 0x5e, 0xf7, 0xfa, 0x39, 0xc9, 0xbc, 0xae, 0x1f, 0x3e, 0x70, 0xe1, 0x27, 0x0,  0x0,  0x6d,
                   0x93, 0x23, 0xb,  0x79, 0x2a, 0x6c, 0x28, 0x6a, 0x13, 0x21, 0xa2, 0x2,  0x0,  0x0,  0x7c, 0x17, 0x1f,
                   0x0,  0x13, 0x4b, 0xbe, 0xc8, 0x96, 0xdf, 0xea, 0xe8, 0x13, 0x65, 0x45, 0xda, 0xdd, 0x2a, 0xef, 0x1f,
                   0xf6, 0xd6, 0xe0, 0x25, 0x23, 0x33, 0x1b, 0x2a, 0x55, 0x1a, 0x0,  0xe,  0x3f, 0x44, 0x7d, 0xe9, 0x15,
                   0xb1, 0xeb, 0xe3, 0xfd, 0x5c, 0xbb, 0xed, 0x7d, 0x23, 0x26, 0x0,  0xa,  0x0,  0x7a, 0x7b, 0x9f, 0xe0,
                   0x4c, 0xc1, 0x5f, 0x3b, 0x18, 0x0,  0x17, 0x65, 0xa,  0xc5, 0xd6, 0x99, 0xc1, 0xf7, 0xae, 0x9d, 0xb3,
                   0x49, 0xe,  0x43, 0x40, 0x53, 0x44, 0xaa, 0xf3, 0x61, 0x88, 0x8d, 0xd,  0x22, 0x17, 0x1c, 0x1,  0xf2,
                   0x16, 0x0,  0x10, 0xdc, 0xa6, 0x73, 0x4,  0x42, 0xea, 0x6f, 0x26, 0x51, 0x58, 0xae, 0x6,  0x1d, 0x5b,
                   0xdf, 0x1e, 0x15, 0x0,  0x2,  0xee, 0xf4, 0xa,  0x7d, 0xa8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x23, 0x73, 0x2b, 0xf3, 0xb8, 0x90, 0x74, 0xea, 0x6c, 0x6a, 0xf8, 0xe, 0x3d,
                               0xb6, 0x54, 0x4f, 0x47, 0x24, 0x82, 0x87, 0x59, 0x4f, 0x45, 0x2b, 0xcc};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa, 0x7d, 0xa8};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 9717);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\173\179\129=\155\186E\131\242g\224\149\&5\f\ESCk\250\130", _pubPktID = 696, _pubBody =
// "\210\212B\245\204\143IYw\217p\214\&5\152\133@\ETB{\FS\238\226", _pubProps = [PropContentType
// "\253iAd\SOH\225\GS\160\178\DC1\143\NULa\DC3\RSz\f\SYN\185",PropSessionExpiryInterval 21518]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x33, 0x47, 0x0,  0x12, 0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2, 0x67, 0xe0,
                   0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82, 0x2,  0xb8, 0x1b, 0x3,  0x0,  0x13, 0xfd, 0x69,
                   0x41, 0x64, 0x1,  0xe1, 0x1d, 0xa0, 0xb2, 0x11, 0x8f, 0x0,  0x61, 0x13, 0x1e, 0x7a, 0xc,
                   0x16, 0xb9, 0x11, 0x0,  0x0,  0x54, 0xe,  0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f, 0x49, 0x59,
                   0x77, 0xd9, 0x70, 0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};

  uint8_t buf[83] = {0};

  uint8_t topic_bytes[] = {0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2,
                           0x67, 0xe0, 0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f, 0x49, 0x59, 0x77, 0xd9, 0x70,
                         0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xfd, 0x69, 0x41, 0x64, 0x1,  0xe1, 0x1d, 0xa0, 0xb2, 0x11,
                           0x8f, 0x0,  0x61, 0x13, 0x1e, 0x7a, 0xc,  0x16, 0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21518}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 696, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\173\179\129=\155\186E\131\242g\224\149\&5\f\ESCk\250\130", _pubPktID = 696, _pubBody =
// "\210\212B\245\204\143IYw\217p\214\&5\152\133@\ETB{\FS\238\226", _pubProps = [PropContentType
// "\253iAd\SOH\225\GS\160\178\DC1\143\NULa\DC3\RSz\f\SYN\185",PropSessionExpiryInterval 21518]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x33, 0x47, 0x0,  0x12, 0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2, 0x67, 0xe0,
                   0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82, 0x2,  0xb8, 0x1b, 0x3,  0x0,  0x13, 0xfd, 0x69,
                   0x41, 0x64, 0x1,  0xe1, 0x1d, 0xa0, 0xb2, 0x11, 0x8f, 0x0,  0x61, 0x13, 0x1e, 0x7a, 0xc,
                   0x16, 0xb9, 0x11, 0x0,  0x0,  0x54, 0xe,  0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f, 0x49, 0x59,
                   0x77, 0xd9, 0x70, 0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xad, 0xb3, 0x81, 0x3d, 0x9b, 0xba, 0x45, 0x83, 0xf2,
                               0x67, 0xe0, 0x95, 0x35, 0xc,  0x1b, 0x6b, 0xfa, 0x82};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd2, 0xd4, 0x42, 0xf5, 0xcc, 0x8f, 0x49, 0x59, 0x77, 0xd9, 0x70,
                              0xd6, 0x35, 0x98, 0x85, 0x40, 0x17, 0x7b, 0x1c, 0xee, 0xe2};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 696);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "!\189a\ENQ\235r\186\232?!\140O>\201\220\163\133\166!\139i", _pubPktID = 0, _pubBody =
// "\249\159L\166\132\147`Q\206\238\229\138\217\DEL\219\t\243\131\192H\SIJ\168@y", _pubProps = [PropRetainAvailable
// 63,PropSubscriptionIdentifierAvailable 254,PropUserProperty "\200TB\215\255V,X\247^\NAK\175\GS\155R\SI\183)wiCQ"
// "@\181\SYN\250\227\154\&63\188\242\205\235\210>\195No\148\148\219\167\135N\206\\",PropRequestProblemInformation
// 17,PropAuthenticationData "",PropAssignedClientIdentifier
// "\222\GSoB\\[0\229\225\240\DC4\246\a\230\DLEJ\220\198-\250\172\SOQ\223c\183\156B",PropContentType
// "\252@\145\231\f\172",PropTopicAliasMaximum 13537,PropRequestResponseInformation 228,PropRequestProblemInformation
// 101,PropRequestProblemInformation 78,PropMessageExpiryInterval 27680,PropTopicAlias 10759,PropSubscriptionIdentifier
// 7,PropReceiveMaximum 11393,PropMaximumQoS 183,PropPayloadFormatIndicator 102,PropAuthenticationMethod
// "\212",PropServerKeepAlive 30667,PropRequestResponseInformation 129,PropMessageExpiryInterval 5688]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x38, 0xbf, 0x1,  0x0,  0x15, 0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c, 0x4f,
                   0x3e, 0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69, 0x8d, 0x1,  0x25, 0x3f, 0x29, 0xfe, 0x26, 0x0,
                   0x16, 0xc8, 0x54, 0x42, 0xd7, 0xff, 0x56, 0x2c, 0x58, 0xf7, 0x5e, 0x15, 0xaf, 0x1d, 0x9b, 0x52, 0xf,
                   0xb7, 0x29, 0x77, 0x69, 0x43, 0x51, 0x0,  0x19, 0x40, 0xb5, 0x16, 0xfa, 0xe3, 0x9a, 0x36, 0x33, 0xbc,
                   0xf2, 0xcd, 0xeb, 0xd2, 0x3e, 0xc3, 0x4e, 0x6f, 0x94, 0x94, 0xdb, 0xa7, 0x87, 0x4e, 0xce, 0x5c, 0x17,
                   0x11, 0x16, 0x0,  0x0,  0x12, 0x0,  0x1c, 0xde, 0x1d, 0x6f, 0x42, 0x5c, 0x5b, 0x30, 0xe5, 0xe1, 0xf0,
                   0x14, 0xf6, 0x7,  0xe6, 0x10, 0x4a, 0xdc, 0xc6, 0x2d, 0xfa, 0xac, 0xe,  0x51, 0xdf, 0x63, 0xb7, 0x9c,
                   0x42, 0x3,  0x0,  0x6,  0xfc, 0x40, 0x91, 0xe7, 0xc,  0xac, 0x22, 0x34, 0xe1, 0x19, 0xe4, 0x17, 0x65,
                   0x17, 0x4e, 0x2,  0x0,  0x0,  0x6c, 0x20, 0x23, 0x2a, 0x7,  0xb,  0x7,  0x21, 0x2c, 0x81, 0x24, 0xb7,
                   0x1,  0x66, 0x15, 0x0,  0x1,  0xd4, 0x13, 0x77, 0xcb, 0x19, 0x81, 0x2,  0x0,  0x0,  0x16, 0x38, 0xf9,
                   0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce, 0xee, 0xe5, 0x8a, 0xd9, 0x7f, 0xdb, 0x9,  0xf3, 0x83,
                   0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};

  uint8_t buf[204] = {0};

  uint8_t topic_bytes[] = {0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c,
                           0x4f, 0x3e, 0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf9, 0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce, 0xee, 0xe5, 0x8a, 0xd9,
                         0x7f, 0xdb, 0x9,  0xf3, 0x83, 0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytesprops1[] = {0x40, 0xb5, 0x16, 0xfa, 0xe3, 0x9a, 0x36, 0x33, 0xbc, 0xf2, 0xcd, 0xeb, 0xd2,
                           0x3e, 0xc3, 0x4e, 0x6f, 0x94, 0x94, 0xdb, 0xa7, 0x87, 0x4e, 0xce, 0x5c};
  uint8_t bytesprops0[] = {0xc8, 0x54, 0x42, 0xd7, 0xff, 0x56, 0x2c, 0x58, 0xf7, 0x5e, 0x15,
                           0xaf, 0x1d, 0x9b, 0x52, 0xf,  0xb7, 0x29, 0x77, 0x69, 0x43, 0x51};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0xde, 0x1d, 0x6f, 0x42, 0x5c, 0x5b, 0x30, 0xe5, 0xe1, 0xf0, 0x14, 0xf6, 0x7,  0xe6,
                           0x10, 0x4a, 0xdc, 0xc6, 0x2d, 0xfa, 0xac, 0xe,  0x51, 0xdf, 0x63, 0xb7, 0x9c, 0x42};
  uint8_t bytesprops4[] = {0xfc, 0x40, 0x91, 0xe7, 0xc, 0xac};
  uint8_t bytesprops5[] = {0xd4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops0}, .v = {25, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13537}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27680}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10759}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11393}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30667}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5688}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "!\189a\ENQ\235r\186\232?!\140O>\201\220\163\133\166!\139i", _pubPktID = 0, _pubBody =
// "\249\159L\166\132\147`Q\206\238\229\138\217\DEL\219\t\243\131\192H\SIJ\168@y", _pubProps = [PropRetainAvailable
// 63,PropSubscriptionIdentifierAvailable 254,PropUserProperty "\200TB\215\255V,X\247^\NAK\175\GS\155R\SI\183)wiCQ"
// "@\181\SYN\250\227\154\&63\188\242\205\235\210>\195No\148\148\219\167\135N\206\\",PropRequestProblemInformation
// 17,PropAuthenticationData "",PropAssignedClientIdentifier
// "\222\GSoB\\[0\229\225\240\DC4\246\a\230\DLEJ\220\198-\250\172\SOQ\223c\183\156B",PropContentType
// "\252@\145\231\f\172",PropTopicAliasMaximum 13537,PropRequestResponseInformation 228,PropRequestProblemInformation
// 101,PropRequestProblemInformation 78,PropMessageExpiryInterval 27680,PropTopicAlias 10759,PropSubscriptionIdentifier
// 7,PropReceiveMaximum 11393,PropMaximumQoS 183,PropPayloadFormatIndicator 102,PropAuthenticationMethod
// "\212",PropServerKeepAlive 30667,PropRequestResponseInformation 129,PropMessageExpiryInterval 5688]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x38, 0xbf, 0x1,  0x0,  0x15, 0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c, 0x4f,
                   0x3e, 0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69, 0x8d, 0x1,  0x25, 0x3f, 0x29, 0xfe, 0x26, 0x0,
                   0x16, 0xc8, 0x54, 0x42, 0xd7, 0xff, 0x56, 0x2c, 0x58, 0xf7, 0x5e, 0x15, 0xaf, 0x1d, 0x9b, 0x52, 0xf,
                   0xb7, 0x29, 0x77, 0x69, 0x43, 0x51, 0x0,  0x19, 0x40, 0xb5, 0x16, 0xfa, 0xe3, 0x9a, 0x36, 0x33, 0xbc,
                   0xf2, 0xcd, 0xeb, 0xd2, 0x3e, 0xc3, 0x4e, 0x6f, 0x94, 0x94, 0xdb, 0xa7, 0x87, 0x4e, 0xce, 0x5c, 0x17,
                   0x11, 0x16, 0x0,  0x0,  0x12, 0x0,  0x1c, 0xde, 0x1d, 0x6f, 0x42, 0x5c, 0x5b, 0x30, 0xe5, 0xe1, 0xf0,
                   0x14, 0xf6, 0x7,  0xe6, 0x10, 0x4a, 0xdc, 0xc6, 0x2d, 0xfa, 0xac, 0xe,  0x51, 0xdf, 0x63, 0xb7, 0x9c,
                   0x42, 0x3,  0x0,  0x6,  0xfc, 0x40, 0x91, 0xe7, 0xc,  0xac, 0x22, 0x34, 0xe1, 0x19, 0xe4, 0x17, 0x65,
                   0x17, 0x4e, 0x2,  0x0,  0x0,  0x6c, 0x20, 0x23, 0x2a, 0x7,  0xb,  0x7,  0x21, 0x2c, 0x81, 0x24, 0xb7,
                   0x1,  0x66, 0x15, 0x0,  0x1,  0xd4, 0x13, 0x77, 0xcb, 0x19, 0x81, 0x2,  0x0,  0x0,  0x16, 0x38, 0xf9,
                   0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce, 0xee, 0xe5, 0x8a, 0xd9, 0x7f, 0xdb, 0x9,  0xf3, 0x83,
                   0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x21, 0xbd, 0x61, 0x5,  0xeb, 0x72, 0xba, 0xe8, 0x3f, 0x21, 0x8c,
                               0x4f, 0x3e, 0xc9, 0xdc, 0xa3, 0x85, 0xa6, 0x21, 0x8b, 0x69};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf9, 0x9f, 0x4c, 0xa6, 0x84, 0x93, 0x60, 0x51, 0xce, 0xee, 0xe5, 0x8a, 0xd9,
                              0x7f, 0xdb, 0x9,  0xf3, 0x83, 0xc0, 0x48, 0xf,  0x4a, 0xa8, 0x40, 0x79};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\216WQ\"", _pubPktID = 0, _pubBody =
// "\v\225\187\153*%\252qh\193\210\232\r0tw\196\176*\254C", _pubProps = [PropMessageExpiryInterval
// 17186,PropCorrelationData "C\214\155\209\176\162H\244v\167\201\244\243?\225\179\t\243%]\175\187",PropUserProperty
// "W\DC2yE\170\135\241z\181\152O\170%\US\185\156\DLEr\209sK\145\198\235="
// "\153\132\199!\225\188\RSC\173\253\213\220\EOTWW\241\221\247\159b",PropTopicAliasMaximum 23680,PropTopicAliasMaximum
// 20899,PropSessionExpiryInterval 28081,PropMaximumQoS 158,PropMessageExpiryInterval 16231,PropUserProperty
// "\195\SI\ENQ=\216\&0D\152\151\f\SI=\249\238\a\176R" "\172\176\205\198\133%9\226\180h\139\248"]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x38, 0xa1, 0x1,  0x0,  0x4,  0xd8, 0x57, 0x51, 0x22, 0x84, 0x1,  0x2,  0x0,  0x0,  0x43, 0x22, 0x9,
                   0x0,  0x16, 0x43, 0xd6, 0x9b, 0xd1, 0xb0, 0xa2, 0x48, 0xf4, 0x76, 0xa7, 0xc9, 0xf4, 0xf3, 0x3f, 0xe1,
                   0xb3, 0x9,  0xf3, 0x25, 0x5d, 0xaf, 0xbb, 0x26, 0x0,  0x19, 0x57, 0x12, 0x79, 0x45, 0xaa, 0x87, 0xf1,
                   0x7a, 0xb5, 0x98, 0x4f, 0xaa, 0x25, 0x1f, 0xb9, 0x9c, 0x10, 0x72, 0xd1, 0x73, 0x4b, 0x91, 0xc6, 0xeb,
                   0x3d, 0x0,  0x14, 0x99, 0x84, 0xc7, 0x21, 0xe1, 0xbc, 0x1e, 0x43, 0xad, 0xfd, 0xd5, 0xdc, 0x4,  0x57,
                   0x57, 0xf1, 0xdd, 0xf7, 0x9f, 0x62, 0x22, 0x5c, 0x80, 0x22, 0x51, 0xa3, 0x11, 0x0,  0x0,  0x6d, 0xb1,
                   0x24, 0x9e, 0x2,  0x0,  0x0,  0x3f, 0x67, 0x26, 0x0,  0x11, 0xc3, 0xf,  0x5,  0x3d, 0xd8, 0x30, 0x44,
                   0x98, 0x97, 0xc,  0xf,  0x3d, 0xf9, 0xee, 0x7,  0xb0, 0x52, 0x0,  0xc,  0xac, 0xb0, 0xcd, 0xc6, 0x85,
                   0x25, 0x39, 0xe2, 0xb4, 0x68, 0x8b, 0xf8, 0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc, 0x71, 0x68, 0xc1,
                   0xd2, 0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};

  uint8_t buf[174] = {0};

  uint8_t topic_bytes[] = {0xd8, 0x57, 0x51, 0x22};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc, 0x71, 0x68, 0xc1, 0xd2,
                         0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0x43, 0xd6, 0x9b, 0xd1, 0xb0, 0xa2, 0x48, 0xf4, 0x76, 0xa7, 0xc9,
                           0xf4, 0xf3, 0x3f, 0xe1, 0xb3, 0x9,  0xf3, 0x25, 0x5d, 0xaf, 0xbb};
  uint8_t bytesprops2[] = {0x99, 0x84, 0xc7, 0x21, 0xe1, 0xbc, 0x1e, 0x43, 0xad, 0xfd,
                           0xd5, 0xdc, 0x4,  0x57, 0x57, 0xf1, 0xdd, 0xf7, 0x9f, 0x62};
  uint8_t bytesprops1[] = {0x57, 0x12, 0x79, 0x45, 0xaa, 0x87, 0xf1, 0x7a, 0xb5, 0x98, 0x4f, 0xaa, 0x25,
                           0x1f, 0xb9, 0x9c, 0x10, 0x72, 0xd1, 0x73, 0x4b, 0x91, 0xc6, 0xeb, 0x3d};
  uint8_t bytesprops4[] = {0xac, 0xb0, 0xcd, 0xc6, 0x85, 0x25, 0x39, 0xe2, 0xb4, 0x68, 0x8b, 0xf8};
  uint8_t bytesprops3[] = {0xc3, 0xf, 0x5,  0x3d, 0xd8, 0x30, 0x44, 0x98, 0x97,
                           0xc,  0xf, 0x3d, 0xf9, 0xee, 0x7,  0xb0, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17186}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops1}, .v = {20, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23680}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20899}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28081}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16231}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops3}, .v = {12, (char*)&bytesprops4}}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\216WQ\"", _pubPktID = 0, _pubBody =
// "\v\225\187\153*%\252qh\193\210\232\r0tw\196\176*\254C", _pubProps = [PropMessageExpiryInterval
// 17186,PropCorrelationData "C\214\155\209\176\162H\244v\167\201\244\243?\225\179\t\243%]\175\187",PropUserProperty
// "W\DC2yE\170\135\241z\181\152O\170%\US\185\156\DLEr\209sK\145\198\235="
// "\153\132\199!\225\188\RSC\173\253\213\220\EOTWW\241\221\247\159b",PropTopicAliasMaximum 23680,PropTopicAliasMaximum
// 20899,PropSessionExpiryInterval 28081,PropMaximumQoS 158,PropMessageExpiryInterval 16231,PropUserProperty
// "\195\SI\ENQ=\216\&0D\152\151\f\SI=\249\238\a\176R" "\172\176\205\198\133%9\226\180h\139\248"]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x38, 0xa1, 0x1,  0x0,  0x4,  0xd8, 0x57, 0x51, 0x22, 0x84, 0x1,  0x2,  0x0,  0x0,  0x43, 0x22, 0x9,
                   0x0,  0x16, 0x43, 0xd6, 0x9b, 0xd1, 0xb0, 0xa2, 0x48, 0xf4, 0x76, 0xa7, 0xc9, 0xf4, 0xf3, 0x3f, 0xe1,
                   0xb3, 0x9,  0xf3, 0x25, 0x5d, 0xaf, 0xbb, 0x26, 0x0,  0x19, 0x57, 0x12, 0x79, 0x45, 0xaa, 0x87, 0xf1,
                   0x7a, 0xb5, 0x98, 0x4f, 0xaa, 0x25, 0x1f, 0xb9, 0x9c, 0x10, 0x72, 0xd1, 0x73, 0x4b, 0x91, 0xc6, 0xeb,
                   0x3d, 0x0,  0x14, 0x99, 0x84, 0xc7, 0x21, 0xe1, 0xbc, 0x1e, 0x43, 0xad, 0xfd, 0xd5, 0xdc, 0x4,  0x57,
                   0x57, 0xf1, 0xdd, 0xf7, 0x9f, 0x62, 0x22, 0x5c, 0x80, 0x22, 0x51, 0xa3, 0x11, 0x0,  0x0,  0x6d, 0xb1,
                   0x24, 0x9e, 0x2,  0x0,  0x0,  0x3f, 0x67, 0x26, 0x0,  0x11, 0xc3, 0xf,  0x5,  0x3d, 0xd8, 0x30, 0x44,
                   0x98, 0x97, 0xc,  0xf,  0x3d, 0xf9, 0xee, 0x7,  0xb0, 0x52, 0x0,  0xc,  0xac, 0xb0, 0xcd, 0xc6, 0x85,
                   0x25, 0x39, 0xe2, 0xb4, 0x68, 0x8b, 0xf8, 0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc, 0x71, 0x68, 0xc1,
                   0xd2, 0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd8, 0x57, 0x51, 0x22};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb,  0xe1, 0xbb, 0x99, 0x2a, 0x25, 0xfc, 0x71, 0x68, 0xc1, 0xd2,
                              0xe8, 0xd,  0x30, 0x74, 0x77, 0xc4, 0xb0, 0x2a, 0xfe, 0x43};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\130\tw\142", _pubPktID = 9801,
// _pubBody = "\154z+\141\DC3\201)z\n", _pubProps = [PropAuthenticationMethod
// "ZB@2{y\190\206\147\202;e\226\144\219s",PropMaximumQoS 20,PropUserProperty "=,\216\239\186\129\162\131"
// "\208&\170\&0K\204\184\&7\142\v\148\246\131%\224\222\255^\237`05\150\154\246\208Q",PropServerReference
// "\196\&8_\204\196\200+.\204x\v\143\245\242\196\227\233BG\t(\161Z\226@x",PropMaximumPacketSize
// 17975,PropWillDelayInterval 32302,PropReasonString "\204z\245\175\135k\225\ENQ\EOT\240\200\221\212!\207\167
// 4\172]\213]\251B\142\GSV\219",PropPayloadFormatIndicator 233,PropContentType
// "\171\ENQ\DC3\151\236m\131\DC2\DLE1\214s\DC3\ESC\174\144k\164B\249\151",PropMaximumPacketSize 31507,PropTopicAlias
// 31094,PropCorrelationData "~\137s\238\239(\221\ESC\192\193\212",PropRequestProblemInformation
// 96,PropSessionExpiryInterval 30094,PropAuthenticationMethod
// "\DLE#\225\230b\190\225\214\188f\194M\211\219\SIk",PropWillDelayInterval 3844,PropReasonString
// "\172\ETX\142%\182M\SUB+\230\175\238\151",PropServerReference "\v\164\245\183\136\131J\184\249\225\134"]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x32, 0x82, 0x2,  0x0,  0x4,  0x82, 0x9,  0x77, 0x8e, 0x26, 0x49, 0xef, 0x1,  0x15, 0x0,  0x10, 0x5a, 0x42, 0x40,
      0x32, 0x7b, 0x79, 0xbe, 0xce, 0x93, 0xca, 0x3b, 0x65, 0xe2, 0x90, 0xdb, 0x73, 0x24, 0x14, 0x26, 0x0,  0x8,  0x3d,
      0x2c, 0xd8, 0xef, 0xba, 0x81, 0xa2, 0x83, 0x0,  0x1b, 0xd0, 0x26, 0xaa, 0x30, 0x4b, 0xcc, 0xb8, 0x37, 0x8e, 0xb,
      0x94, 0xf6, 0x83, 0x25, 0xe0, 0xde, 0xff, 0x5e, 0xed, 0x60, 0x30, 0x35, 0x96, 0x9a, 0xf6, 0xd0, 0x51, 0x1c, 0x0,
      0x1a, 0xc4, 0x38, 0x5f, 0xcc, 0xc4, 0xc8, 0x2b, 0x2e, 0xcc, 0x78, 0xb,  0x8f, 0xf5, 0xf2, 0xc4, 0xe3, 0xe9, 0x42,
      0x47, 0x9,  0x28, 0xa1, 0x5a, 0xe2, 0x40, 0x78, 0x27, 0x0,  0x0,  0x46, 0x37, 0x18, 0x0,  0x0,  0x7e, 0x2e, 0x1f,
      0x0,  0x1c, 0xcc, 0x7a, 0xf5, 0xaf, 0x87, 0x6b, 0xe1, 0x5,  0x4,  0xf0, 0xc8, 0xdd, 0xd4, 0x21, 0xcf, 0xa7, 0x20,
      0x34, 0xac, 0x5d, 0xd5, 0x5d, 0xfb, 0x42, 0x8e, 0x1d, 0x56, 0xdb, 0x1,  0xe9, 0x3,  0x0,  0x15, 0xab, 0x5,  0x13,
      0x97, 0xec, 0x6d, 0x83, 0x12, 0x10, 0x31, 0xd6, 0x73, 0x13, 0x1b, 0xae, 0x90, 0x6b, 0xa4, 0x42, 0xf9, 0x97, 0x27,
      0x0,  0x0,  0x7b, 0x13, 0x23, 0x79, 0x76, 0x9,  0x0,  0xb,  0x7e, 0x89, 0x73, 0xee, 0xef, 0x28, 0xdd, 0x1b, 0xc0,
      0xc1, 0xd4, 0x17, 0x60, 0x11, 0x0,  0x0,  0x75, 0x8e, 0x15, 0x0,  0x10, 0x10, 0x23, 0xe1, 0xe6, 0x62, 0xbe, 0xe1,
      0xd6, 0xbc, 0x66, 0xc2, 0x4d, 0xd3, 0xdb, 0xf,  0x6b, 0x18, 0x0,  0x0,  0xf,  0x4,  0x1f, 0x0,  0xc,  0xac, 0x3,
      0x8e, 0x25, 0xb6, 0x4d, 0x1a, 0x2b, 0xe6, 0xaf, 0xee, 0x97, 0x1c, 0x0,  0xb,  0xb,  0xa4, 0xf5, 0xb7, 0x88, 0x83,
      0x4a, 0xb8, 0xf9, 0xe1, 0x86, 0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};

  uint8_t buf[271] = {0};

  uint8_t topic_bytes[] = {0x82, 0x9, 0x77, 0x8e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0x5a, 0x42, 0x40, 0x32, 0x7b, 0x79, 0xbe, 0xce,
                           0x93, 0xca, 0x3b, 0x65, 0xe2, 0x90, 0xdb, 0x73};
  uint8_t bytesprops2[] = {0xd0, 0x26, 0xaa, 0x30, 0x4b, 0xcc, 0xb8, 0x37, 0x8e, 0xb,  0x94, 0xf6, 0x83, 0x25,
                           0xe0, 0xde, 0xff, 0x5e, 0xed, 0x60, 0x30, 0x35, 0x96, 0x9a, 0xf6, 0xd0, 0x51};
  uint8_t bytesprops1[] = {0x3d, 0x2c, 0xd8, 0xef, 0xba, 0x81, 0xa2, 0x83};
  uint8_t bytesprops3[] = {0xc4, 0x38, 0x5f, 0xcc, 0xc4, 0xc8, 0x2b, 0x2e, 0xcc, 0x78, 0xb,  0x8f, 0xf5,
                           0xf2, 0xc4, 0xe3, 0xe9, 0x42, 0x47, 0x9,  0x28, 0xa1, 0x5a, 0xe2, 0x40, 0x78};
  uint8_t bytesprops4[] = {0xcc, 0x7a, 0xf5, 0xaf, 0x87, 0x6b, 0xe1, 0x5,  0x4,  0xf0, 0xc8, 0xdd, 0xd4, 0x21,
                           0xcf, 0xa7, 0x20, 0x34, 0xac, 0x5d, 0xd5, 0x5d, 0xfb, 0x42, 0x8e, 0x1d, 0x56, 0xdb};
  uint8_t bytesprops5[] = {0xab, 0x5,  0x13, 0x97, 0xec, 0x6d, 0x83, 0x12, 0x10, 0x31, 0xd6,
                           0x73, 0x13, 0x1b, 0xae, 0x90, 0x6b, 0xa4, 0x42, 0xf9, 0x97};
  uint8_t bytesprops6[] = {0x7e, 0x89, 0x73, 0xee, 0xef, 0x28, 0xdd, 0x1b, 0xc0, 0xc1, 0xd4};
  uint8_t bytesprops7[] = {0x10, 0x23, 0xe1, 0xe6, 0x62, 0xbe, 0xe1, 0xd6,
                           0xbc, 0x66, 0xc2, 0x4d, 0xd3, 0xdb, 0xf,  0x6b};
  uint8_t bytesprops8[] = {0xac, 0x3, 0x8e, 0x25, 0xb6, 0x4d, 0x1a, 0x2b, 0xe6, 0xaf, 0xee, 0x97};
  uint8_t bytesprops9[] = {0xb, 0xa4, 0xf5, 0xb7, 0x88, 0x83, 0x4a, 0xb8, 0xf9, 0xe1, 0x86};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops1}, .v = {27, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17975}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32302}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31507}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31094}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30094}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3844}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 9801, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\130\tw\142", _pubPktID = 9801,
// _pubBody = "\154z+\141\DC3\201)z\n", _pubProps = [PropAuthenticationMethod
// "ZB@2{y\190\206\147\202;e\226\144\219s",PropMaximumQoS 20,PropUserProperty "=,\216\239\186\129\162\131"
// "\208&\170\&0K\204\184\&7\142\v\148\246\131%\224\222\255^\237`05\150\154\246\208Q",PropServerReference
// "\196\&8_\204\196\200+.\204x\v\143\245\242\196\227\233BG\t(\161Z\226@x",PropMaximumPacketSize
// 17975,PropWillDelayInterval 32302,PropReasonString "\204z\245\175\135k\225\ENQ\EOT\240\200\221\212!\207\167
// 4\172]\213]\251B\142\GSV\219",PropPayloadFormatIndicator 233,PropContentType
// "\171\ENQ\DC3\151\236m\131\DC2\DLE1\214s\DC3\ESC\174\144k\164B\249\151",PropMaximumPacketSize 31507,PropTopicAlias
// 31094,PropCorrelationData "~\137s\238\239(\221\ESC\192\193\212",PropRequestProblemInformation
// 96,PropSessionExpiryInterval 30094,PropAuthenticationMethod
// "\DLE#\225\230b\190\225\214\188f\194M\211\219\SIk",PropWillDelayInterval 3844,PropReasonString
// "\172\ETX\142%\182M\SUB+\230\175\238\151",PropServerReference "\v\164\245\183\136\131J\184\249\225\134"]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {
      0x32, 0x82, 0x2,  0x0,  0x4,  0x82, 0x9,  0x77, 0x8e, 0x26, 0x49, 0xef, 0x1,  0x15, 0x0,  0x10, 0x5a, 0x42, 0x40,
      0x32, 0x7b, 0x79, 0xbe, 0xce, 0x93, 0xca, 0x3b, 0x65, 0xe2, 0x90, 0xdb, 0x73, 0x24, 0x14, 0x26, 0x0,  0x8,  0x3d,
      0x2c, 0xd8, 0xef, 0xba, 0x81, 0xa2, 0x83, 0x0,  0x1b, 0xd0, 0x26, 0xaa, 0x30, 0x4b, 0xcc, 0xb8, 0x37, 0x8e, 0xb,
      0x94, 0xf6, 0x83, 0x25, 0xe0, 0xde, 0xff, 0x5e, 0xed, 0x60, 0x30, 0x35, 0x96, 0x9a, 0xf6, 0xd0, 0x51, 0x1c, 0x0,
      0x1a, 0xc4, 0x38, 0x5f, 0xcc, 0xc4, 0xc8, 0x2b, 0x2e, 0xcc, 0x78, 0xb,  0x8f, 0xf5, 0xf2, 0xc4, 0xe3, 0xe9, 0x42,
      0x47, 0x9,  0x28, 0xa1, 0x5a, 0xe2, 0x40, 0x78, 0x27, 0x0,  0x0,  0x46, 0x37, 0x18, 0x0,  0x0,  0x7e, 0x2e, 0x1f,
      0x0,  0x1c, 0xcc, 0x7a, 0xf5, 0xaf, 0x87, 0x6b, 0xe1, 0x5,  0x4,  0xf0, 0xc8, 0xdd, 0xd4, 0x21, 0xcf, 0xa7, 0x20,
      0x34, 0xac, 0x5d, 0xd5, 0x5d, 0xfb, 0x42, 0x8e, 0x1d, 0x56, 0xdb, 0x1,  0xe9, 0x3,  0x0,  0x15, 0xab, 0x5,  0x13,
      0x97, 0xec, 0x6d, 0x83, 0x12, 0x10, 0x31, 0xd6, 0x73, 0x13, 0x1b, 0xae, 0x90, 0x6b, 0xa4, 0x42, 0xf9, 0x97, 0x27,
      0x0,  0x0,  0x7b, 0x13, 0x23, 0x79, 0x76, 0x9,  0x0,  0xb,  0x7e, 0x89, 0x73, 0xee, 0xef, 0x28, 0xdd, 0x1b, 0xc0,
      0xc1, 0xd4, 0x17, 0x60, 0x11, 0x0,  0x0,  0x75, 0x8e, 0x15, 0x0,  0x10, 0x10, 0x23, 0xe1, 0xe6, 0x62, 0xbe, 0xe1,
      0xd6, 0xbc, 0x66, 0xc2, 0x4d, 0xd3, 0xdb, 0xf,  0x6b, 0x18, 0x0,  0x0,  0xf,  0x4,  0x1f, 0x0,  0xc,  0xac, 0x3,
      0x8e, 0x25, 0xb6, 0x4d, 0x1a, 0x2b, 0xe6, 0xaf, 0xee, 0x97, 0x1c, 0x0,  0xb,  0xb,  0xa4, 0xf5, 0xb7, 0x88, 0x83,
      0x4a, 0xb8, 0xf9, 0xe1, 0x86, 0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x82, 0x9, 0x77, 0x8e};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9a, 0x7a, 0x2b, 0x8d, 0x13, 0xc9, 0x29, 0x7a, 0xa};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 9801);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "W\165\ETX\202d\140Z\185\FSm\158\159\206Gj\177D\DC3\250=", _pubPktID = 0, _pubBody =
// "\204r\156\176\144\163\ESC+\228\214X\196\&6\212\179\NULI\132\128`nQ\153\188\153", _pubProps = [PropContentType
// "\238\173[.y\187\201",PropCorrelationData
// "\196u\DC2K\206\224\240\249\238\DC3>\175\GS\EMS6/v*\SI\222\EM\236\153\245$=",PropMaximumPacketSize
// 16725,PropSharedSubscriptionAvailable 42,PropAuthenticationData "\147\"?\178\238)\SOH
// \246\196\211\208\183<\180W\n",PropServerKeepAlive 9570,PropCorrelationData
// "\ESC?\180\ETB\217B\r\176B\166^\190\FS\a'\189\247\t]\246\171P\200\138",PropRequestResponseInformation
// 148,PropRequestResponseInformation 49,PropRequestResponseInformation 139,PropResponseTopic
// "",PropAssignedClientIdentifier ""]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {0x39, 0x9d, 0x1,  0x0,  0x14, 0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d, 0x9e,
                   0x9f, 0xce, 0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d, 0x6d, 0x3,  0x0,  0x7,  0xee, 0xad, 0x5b,
                   0x2e, 0x79, 0xbb, 0xc9, 0x9,  0x0,  0x1b, 0xc4, 0x75, 0x12, 0x4b, 0xce, 0xe0, 0xf0, 0xf9, 0xee,
                   0x13, 0x3e, 0xaf, 0x1d, 0x19, 0x53, 0x36, 0x2f, 0x76, 0x2a, 0xf,  0xde, 0x19, 0xec, 0x99, 0xf5,
                   0x24, 0x3d, 0x27, 0x0,  0x0,  0x41, 0x55, 0x2a, 0x2a, 0x16, 0x0,  0x11, 0x93, 0x22, 0x3f, 0xb2,
                   0xee, 0x29, 0x1,  0x20, 0xf6, 0xc4, 0xd3, 0xd0, 0xb7, 0x3c, 0xb4, 0x57, 0xa,  0x13, 0x25, 0x62,
                   0x9,  0x0,  0x18, 0x1b, 0x3f, 0xb4, 0x17, 0xd9, 0x42, 0xd,  0xb0, 0x42, 0xa6, 0x5e, 0xbe, 0x1c,
                   0x7,  0x27, 0xbd, 0xf7, 0x9,  0x5d, 0xf6, 0xab, 0x50, 0xc8, 0x8a, 0x19, 0x94, 0x19, 0x31, 0x19,
                   0x8b, 0x8,  0x0,  0x0,  0x12, 0x0,  0x0,  0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4,
                   0xd6, 0x58, 0xc4, 0x36, 0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};

  uint8_t buf[170] = {0};

  uint8_t topic_bytes[] = {0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d,
                           0x9e, 0x9f, 0xce, 0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4, 0xd6, 0x58, 0xc4, 0x36,
                         0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytesprops0[] = {0xee, 0xad, 0x5b, 0x2e, 0x79, 0xbb, 0xc9};
  uint8_t bytesprops1[] = {0xc4, 0x75, 0x12, 0x4b, 0xce, 0xe0, 0xf0, 0xf9, 0xee, 0x13, 0x3e, 0xaf, 0x1d, 0x19,
                           0x53, 0x36, 0x2f, 0x76, 0x2a, 0xf,  0xde, 0x19, 0xec, 0x99, 0xf5, 0x24, 0x3d};
  uint8_t bytesprops2[] = {0x93, 0x22, 0x3f, 0xb2, 0xee, 0x29, 0x1,  0x20, 0xf6,
                           0xc4, 0xd3, 0xd0, 0xb7, 0x3c, 0xb4, 0x57, 0xa};
  uint8_t bytesprops3[] = {0x1b, 0x3f, 0xb4, 0x17, 0xd9, 0x42, 0xd,  0xb0, 0x42, 0xa6, 0x5e, 0xbe,
                           0x1c, 0x7,  0x27, 0xbd, 0xf7, 0x9,  0x5d, 0xf6, 0xab, 0x50, 0xc8, 0x8a};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16725}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9570}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "W\165\ETX\202d\140Z\185\FSm\158\159\206Gj\177D\DC3\250=", _pubPktID = 0, _pubBody =
// "\204r\156\176\144\163\ESC+\228\214X\196\&6\212\179\NULI\132\128`nQ\153\188\153", _pubProps = [PropContentType
// "\238\173[.y\187\201",PropCorrelationData
// "\196u\DC2K\206\224\240\249\238\DC3>\175\GS\EMS6/v*\SI\222\EM\236\153\245$=",PropMaximumPacketSize
// 16725,PropSharedSubscriptionAvailable 42,PropAuthenticationData "\147\"?\178\238)\SOH
// \246\196\211\208\183<\180W\n",PropServerKeepAlive 9570,PropCorrelationData
// "\ESC?\180\ETB\217B\r\176B\166^\190\FS\a'\189\247\t]\246\171P\200\138",PropRequestResponseInformation
// 148,PropRequestResponseInformation 49,PropRequestResponseInformation 139,PropResponseTopic
// "",PropAssignedClientIdentifier ""]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {0x39, 0x9d, 0x1,  0x0,  0x14, 0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d, 0x9e,
                   0x9f, 0xce, 0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d, 0x6d, 0x3,  0x0,  0x7,  0xee, 0xad, 0x5b,
                   0x2e, 0x79, 0xbb, 0xc9, 0x9,  0x0,  0x1b, 0xc4, 0x75, 0x12, 0x4b, 0xce, 0xe0, 0xf0, 0xf9, 0xee,
                   0x13, 0x3e, 0xaf, 0x1d, 0x19, 0x53, 0x36, 0x2f, 0x76, 0x2a, 0xf,  0xde, 0x19, 0xec, 0x99, 0xf5,
                   0x24, 0x3d, 0x27, 0x0,  0x0,  0x41, 0x55, 0x2a, 0x2a, 0x16, 0x0,  0x11, 0x93, 0x22, 0x3f, 0xb2,
                   0xee, 0x29, 0x1,  0x20, 0xf6, 0xc4, 0xd3, 0xd0, 0xb7, 0x3c, 0xb4, 0x57, 0xa,  0x13, 0x25, 0x62,
                   0x9,  0x0,  0x18, 0x1b, 0x3f, 0xb4, 0x17, 0xd9, 0x42, 0xd,  0xb0, 0x42, 0xa6, 0x5e, 0xbe, 0x1c,
                   0x7,  0x27, 0xbd, 0xf7, 0x9,  0x5d, 0xf6, 0xab, 0x50, 0xc8, 0x8a, 0x19, 0x94, 0x19, 0x31, 0x19,
                   0x8b, 0x8,  0x0,  0x0,  0x12, 0x0,  0x0,  0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4,
                   0xd6, 0x58, 0xc4, 0x36, 0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0xa5, 0x3,  0xca, 0x64, 0x8c, 0x5a, 0xb9, 0x1c, 0x6d,
                               0x9e, 0x9f, 0xce, 0x47, 0x6a, 0xb1, 0x44, 0x13, 0xfa, 0x3d};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcc, 0x72, 0x9c, 0xb0, 0x90, 0xa3, 0x1b, 0x2b, 0xe4, 0xd6, 0x58, 0xc4, 0x36,
                              0xd4, 0xb3, 0x0,  0x49, 0x84, 0x80, 0x60, 0x6e, 0x51, 0x99, 0xbc, 0x99};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\STX", _pubPktID = 30584, _pubBody =
// "u\219\"\173\243\187\226Z\193\t\210\"\201K)", _pubProps = [PropSharedSubscriptionAvailable
// 48,PropPayloadFormatIndicator 15,PropSubscriptionIdentifierAvailable 46,PropContentType "\220\191\t;G\215.\NUL
// (\148N&\156\242\186\142",PropSubscriptionIdentifierAvailable 8,PropCorrelationData
// ":\223\CAN\213\&6\135ah\135\224\239S\185\249\DEL\162;\250\ESC\233",PropPayloadFormatIndicator 112,PropCorrelationData
// "\RS\129\208>\230\f\246I\196\246\250K\130\163\242\221",PropReceiveMaximum 15410,PropWillDelayInterval
// 6524,PropServerReference "\144\201\151\159{&\248\208\215\ETXb\198\175\ETX\215!"]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x3b, 0x78, 0x0,  0x1,  0x2,  0x77, 0x78, 0x63, 0x2a, 0x30, 0x1,  0xf,  0x29, 0x2e, 0x3,  0x0,
                   0x11, 0xdc, 0xbf, 0x9,  0x3b, 0x47, 0xd7, 0x2e, 0x0,  0x20, 0x28, 0x94, 0x4e, 0x26, 0x9c, 0xf2,
                   0xba, 0x8e, 0x29, 0x8,  0x9,  0x0,  0x14, 0x3a, 0xdf, 0x18, 0xd5, 0x36, 0x87, 0x61, 0x68, 0x87,
                   0xe0, 0xef, 0x53, 0xb9, 0xf9, 0x7f, 0xa2, 0x3b, 0xfa, 0x1b, 0xe9, 0x1,  0x70, 0x9,  0x0,  0x10,
                   0x1e, 0x81, 0xd0, 0x3e, 0xe6, 0xc,  0xf6, 0x49, 0xc4, 0xf6, 0xfa, 0x4b, 0x82, 0xa3, 0xf2, 0xdd,
                   0x21, 0x3c, 0x32, 0x18, 0x0,  0x0,  0x19, 0x7c, 0x1c, 0x0,  0x10, 0x90, 0xc9, 0x97, 0x9f, 0x7b,
                   0x26, 0xf8, 0xd0, 0xd7, 0x3,  0x62, 0xc6, 0xaf, 0x3,  0xd7, 0x21, 0x75, 0xdb, 0x22, 0xad, 0xf3,
                   0xbb, 0xe2, 0x5a, 0xc1, 0x9,  0xd2, 0x22, 0xc9, 0x4b, 0x29};

  uint8_t buf[132] = {0};

  uint8_t topic_bytes[] = {0x2};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x75, 0xdb, 0x22, 0xad, 0xf3, 0xbb, 0xe2, 0x5a, 0xc1, 0x9, 0xd2, 0x22, 0xc9, 0x4b, 0x29};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0xdc, 0xbf, 0x9,  0x3b, 0x47, 0xd7, 0x2e, 0x0, 0x20,
                           0x28, 0x94, 0x4e, 0x26, 0x9c, 0xf2, 0xba, 0x8e};
  uint8_t bytesprops1[] = {0x3a, 0xdf, 0x18, 0xd5, 0x36, 0x87, 0x61, 0x68, 0x87, 0xe0,
                           0xef, 0x53, 0xb9, 0xf9, 0x7f, 0xa2, 0x3b, 0xfa, 0x1b, 0xe9};
  uint8_t bytesprops2[] = {0x1e, 0x81, 0xd0, 0x3e, 0xe6, 0xc,  0xf6, 0x49,
                           0xc4, 0xf6, 0xfa, 0x4b, 0x82, 0xa3, 0xf2, 0xdd};
  uint8_t bytesprops3[] = {0x90, 0xc9, 0x97, 0x9f, 0x7b, 0x26, 0xf8, 0xd0,
                           0xd7, 0x3,  0x62, 0xc6, 0xaf, 0x3,  0xd7, 0x21};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15410}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6524}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 30584, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\STX", _pubPktID = 30584, _pubBody =
// "u\219\"\173\243\187\226Z\193\t\210\"\201K)", _pubProps = [PropSharedSubscriptionAvailable
// 48,PropPayloadFormatIndicator 15,PropSubscriptionIdentifierAvailable 46,PropContentType "\220\191\t;G\215.\NUL
// (\148N&\156\242\186\142",PropSubscriptionIdentifierAvailable 8,PropCorrelationData
// ":\223\CAN\213\&6\135ah\135\224\239S\185\249\DEL\162;\250\ESC\233",PropPayloadFormatIndicator 112,PropCorrelationData
// "\RS\129\208>\230\f\246I\196\246\250K\130\163\242\221",PropReceiveMaximum 15410,PropWillDelayInterval
// 6524,PropServerReference "\144\201\151\159{&\248\208\215\ETXb\198\175\ETX\215!"]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x3b, 0x78, 0x0,  0x1,  0x2,  0x77, 0x78, 0x63, 0x2a, 0x30, 0x1,  0xf,  0x29, 0x2e, 0x3,  0x0,
                   0x11, 0xdc, 0xbf, 0x9,  0x3b, 0x47, 0xd7, 0x2e, 0x0,  0x20, 0x28, 0x94, 0x4e, 0x26, 0x9c, 0xf2,
                   0xba, 0x8e, 0x29, 0x8,  0x9,  0x0,  0x14, 0x3a, 0xdf, 0x18, 0xd5, 0x36, 0x87, 0x61, 0x68, 0x87,
                   0xe0, 0xef, 0x53, 0xb9, 0xf9, 0x7f, 0xa2, 0x3b, 0xfa, 0x1b, 0xe9, 0x1,  0x70, 0x9,  0x0,  0x10,
                   0x1e, 0x81, 0xd0, 0x3e, 0xe6, 0xc,  0xf6, 0x49, 0xc4, 0xf6, 0xfa, 0x4b, 0x82, 0xa3, 0xf2, 0xdd,
                   0x21, 0x3c, 0x32, 0x18, 0x0,  0x0,  0x19, 0x7c, 0x1c, 0x0,  0x10, 0x90, 0xc9, 0x97, 0x9f, 0x7b,
                   0x26, 0xf8, 0xd0, 0xd7, 0x3,  0x62, 0xc6, 0xaf, 0x3,  0xd7, 0x21, 0x75, 0xdb, 0x22, 0xad, 0xf3,
                   0xbb, 0xe2, 0x5a, 0xc1, 0x9,  0xd2, 0x22, 0xc9, 0x4b, 0x29};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x75, 0xdb, 0x22, 0xad, 0xf3, 0xbb, 0xe2, 0x5a, 0xc1, 0x9, 0xd2, 0x22, 0xc9, 0x4b, 0x29};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 30584);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "E_/\183|O\206\131\173f\212\204",
// _pubPktID = 31613, _pubBody = "\155\216/Ef", _pubProps = [PropServerReference
// "r>\SOX\140\NUL\SO\ETX\176\133B\f\156\234\STX\202_:\EOT\160\206n\219\229H\151\SI\185",PropMaximumQoS
// 173,PropReceiveMaximum 18751,PropRequestResponseInformation 60,PropMaximumPacketSize 6732,PropReceiveMaximum
// 11501,PropSessionExpiryInterval 17948,PropServerKeepAlive 10159,PropServerKeepAlive
// 4218,PropRequestProblemInformation 31,PropMessageExpiryInterval 31284,PropServerReference
// "\SO\220\235",PropReceiveMaximum 15238,PropMessageExpiryInterval 8262,PropContentType
// "\137)\ESCSg\226S\205\235\RS\194\DC2e\246\ESC\146\SO\216",PropRetainAvailable 89,PropMaximumPacketSize
// 21478,PropServerKeepAlive 12711,PropAuthenticationMethod
// "\DC4\182\SYNJ\156\159\224{\RS\146Q\151\229\207\185\146\SIaEOCa",PropServerReference
// "P\229fx\DC4\131\176Wk\ETBXI\ETX\142",PropAssignedClientIdentifier
// "\ESCV5\DC1\ENQ-\215\246\172F\140\242\\V\188\SI!\222\STX\DLE\249",PropRequestResponseInformation
// 120,PropWillDelayInterval 16810,PropSubscriptionIdentifier 16]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x32, 0xcf, 0x1,  0x0,  0xc,  0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83, 0xad, 0x66, 0xd4, 0xcc,
                   0x7b, 0x7d, 0xb8, 0x1,  0x1c, 0x0,  0x1c, 0x72, 0x3e, 0xe,  0x58, 0x8c, 0x0,  0xe,  0x3,  0xb0, 0x85,
                   0x42, 0xc,  0x9c, 0xea, 0x2,  0xca, 0x5f, 0x3a, 0x4,  0xa0, 0xce, 0x6e, 0xdb, 0xe5, 0x48, 0x97, 0xf,
                   0xb9, 0x24, 0xad, 0x21, 0x49, 0x3f, 0x19, 0x3c, 0x27, 0x0,  0x0,  0x1a, 0x4c, 0x21, 0x2c, 0xed, 0x11,
                   0x0,  0x0,  0x46, 0x1c, 0x13, 0x27, 0xaf, 0x13, 0x10, 0x7a, 0x17, 0x1f, 0x2,  0x0,  0x0,  0x7a, 0x34,
                   0x1c, 0x0,  0x3,  0xe,  0xdc, 0xeb, 0x21, 0x3b, 0x86, 0x2,  0x0,  0x0,  0x20, 0x46, 0x3,  0x0,  0x12,
                   0x89, 0x29, 0x1b, 0x53, 0x67, 0xe2, 0x53, 0xcd, 0xeb, 0x1e, 0xc2, 0x12, 0x65, 0xf6, 0x1b, 0x92, 0xe,
                   0xd8, 0x25, 0x59, 0x27, 0x0,  0x0,  0x53, 0xe6, 0x13, 0x31, 0xa7, 0x15, 0x0,  0x16, 0x14, 0xb6, 0x16,
                   0x4a, 0x9c, 0x9f, 0xe0, 0x7b, 0x1e, 0x92, 0x51, 0x97, 0xe5, 0xcf, 0xb9, 0x92, 0xf,  0x61, 0x45, 0x4f,
                   0x43, 0x61, 0x1c, 0x0,  0xe,  0x50, 0xe5, 0x66, 0x78, 0x14, 0x83, 0xb0, 0x57, 0x6b, 0x17, 0x58, 0x49,
                   0x3,  0x8e, 0x12, 0x0,  0x15, 0x1b, 0x56, 0x35, 0x11, 0x5,  0x2d, 0xd7, 0xf6, 0xac, 0x46, 0x8c, 0xf2,
                   0x5c, 0x56, 0xbc, 0xf,  0x21, 0xde, 0x2,  0x10, 0xf9, 0x19, 0x78, 0x18, 0x0,  0x0,  0x41, 0xaa, 0xb,
                   0x10, 0x9b, 0xd8, 0x2f, 0x45, 0x66};

  uint8_t buf[220] = {0};

  uint8_t topic_bytes[] = {0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83, 0xad, 0x66, 0xd4, 0xcc};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9b, 0xd8, 0x2f, 0x45, 0x66};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0x72, 0x3e, 0xe,  0x58, 0x8c, 0x0,  0xe,  0x3,  0xb0, 0x85, 0x42, 0xc,  0x9c, 0xea,
                           0x2,  0xca, 0x5f, 0x3a, 0x4,  0xa0, 0xce, 0x6e, 0xdb, 0xe5, 0x48, 0x97, 0xf,  0xb9};
  uint8_t bytesprops1[] = {0xe, 0xdc, 0xeb};
  uint8_t bytesprops2[] = {0x89, 0x29, 0x1b, 0x53, 0x67, 0xe2, 0x53, 0xcd, 0xeb,
                           0x1e, 0xc2, 0x12, 0x65, 0xf6, 0x1b, 0x92, 0xe,  0xd8};
  uint8_t bytesprops3[] = {0x14, 0xb6, 0x16, 0x4a, 0x9c, 0x9f, 0xe0, 0x7b, 0x1e, 0x92, 0x51,
                           0x97, 0xe5, 0xcf, 0xb9, 0x92, 0xf,  0x61, 0x45, 0x4f, 0x43, 0x61};
  uint8_t bytesprops4[] = {0x50, 0xe5, 0x66, 0x78, 0x14, 0x83, 0xb0, 0x57, 0x6b, 0x17, 0x58, 0x49, 0x3, 0x8e};
  uint8_t bytesprops5[] = {0x1b, 0x56, 0x35, 0x11, 0x5, 0x2d, 0xd7, 0xf6, 0xac, 0x46, 0x8c,
                           0xf2, 0x5c, 0x56, 0xbc, 0xf, 0x21, 0xde, 0x2,  0x10, 0xf9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18751}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6732}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11501}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17948}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10159}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4218}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31284}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15238}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8262}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21478}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12711}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16810}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 31613, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "E_/\183|O\206\131\173f\212\204",
// _pubPktID = 31613, _pubBody = "\155\216/Ef", _pubProps = [PropServerReference
// "r>\SOX\140\NUL\SO\ETX\176\133B\f\156\234\STX\202_:\EOT\160\206n\219\229H\151\SI\185",PropMaximumQoS
// 173,PropReceiveMaximum 18751,PropRequestResponseInformation 60,PropMaximumPacketSize 6732,PropReceiveMaximum
// 11501,PropSessionExpiryInterval 17948,PropServerKeepAlive 10159,PropServerKeepAlive
// 4218,PropRequestProblemInformation 31,PropMessageExpiryInterval 31284,PropServerReference
// "\SO\220\235",PropReceiveMaximum 15238,PropMessageExpiryInterval 8262,PropContentType
// "\137)\ESCSg\226S\205\235\RS\194\DC2e\246\ESC\146\SO\216",PropRetainAvailable 89,PropMaximumPacketSize
// 21478,PropServerKeepAlive 12711,PropAuthenticationMethod
// "\DC4\182\SYNJ\156\159\224{\RS\146Q\151\229\207\185\146\SIaEOCa",PropServerReference
// "P\229fx\DC4\131\176Wk\ETBXI\ETX\142",PropAssignedClientIdentifier
// "\ESCV5\DC1\ENQ-\215\246\172F\140\242\\V\188\SI!\222\STX\DLE\249",PropRequestResponseInformation
// 120,PropWillDelayInterval 16810,PropSubscriptionIdentifier 16]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x32, 0xcf, 0x1,  0x0,  0xc,  0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83, 0xad, 0x66, 0xd4, 0xcc,
                   0x7b, 0x7d, 0xb8, 0x1,  0x1c, 0x0,  0x1c, 0x72, 0x3e, 0xe,  0x58, 0x8c, 0x0,  0xe,  0x3,  0xb0, 0x85,
                   0x42, 0xc,  0x9c, 0xea, 0x2,  0xca, 0x5f, 0x3a, 0x4,  0xa0, 0xce, 0x6e, 0xdb, 0xe5, 0x48, 0x97, 0xf,
                   0xb9, 0x24, 0xad, 0x21, 0x49, 0x3f, 0x19, 0x3c, 0x27, 0x0,  0x0,  0x1a, 0x4c, 0x21, 0x2c, 0xed, 0x11,
                   0x0,  0x0,  0x46, 0x1c, 0x13, 0x27, 0xaf, 0x13, 0x10, 0x7a, 0x17, 0x1f, 0x2,  0x0,  0x0,  0x7a, 0x34,
                   0x1c, 0x0,  0x3,  0xe,  0xdc, 0xeb, 0x21, 0x3b, 0x86, 0x2,  0x0,  0x0,  0x20, 0x46, 0x3,  0x0,  0x12,
                   0x89, 0x29, 0x1b, 0x53, 0x67, 0xe2, 0x53, 0xcd, 0xeb, 0x1e, 0xc2, 0x12, 0x65, 0xf6, 0x1b, 0x92, 0xe,
                   0xd8, 0x25, 0x59, 0x27, 0x0,  0x0,  0x53, 0xe6, 0x13, 0x31, 0xa7, 0x15, 0x0,  0x16, 0x14, 0xb6, 0x16,
                   0x4a, 0x9c, 0x9f, 0xe0, 0x7b, 0x1e, 0x92, 0x51, 0x97, 0xe5, 0xcf, 0xb9, 0x92, 0xf,  0x61, 0x45, 0x4f,
                   0x43, 0x61, 0x1c, 0x0,  0xe,  0x50, 0xe5, 0x66, 0x78, 0x14, 0x83, 0xb0, 0x57, 0x6b, 0x17, 0x58, 0x49,
                   0x3,  0x8e, 0x12, 0x0,  0x15, 0x1b, 0x56, 0x35, 0x11, 0x5,  0x2d, 0xd7, 0xf6, 0xac, 0x46, 0x8c, 0xf2,
                   0x5c, 0x56, 0xbc, 0xf,  0x21, 0xde, 0x2,  0x10, 0xf9, 0x19, 0x78, 0x18, 0x0,  0x0,  0x41, 0xaa, 0xb,
                   0x10, 0x9b, 0xd8, 0x2f, 0x45, 0x66};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x45, 0x5f, 0x2f, 0xb7, 0x7c, 0x4f, 0xce, 0x83, 0xad, 0x66, 0xd4, 0xcc};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0xd8, 0x2f, 0x45, 0x66};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31613);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Just
// "\185\251\207\168Q\134\135\143\222\196\233\144\GS2\233\186\RS9\206\169\133%\142\159\215\144I", _password = Just
// "\226\211\189:\248cm\238\136\&0\f\162/\b\199!", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0,
// _willTopic = ")V\230\ETB\138\201\162\143nR~n\217\SUBq\193\137\223\STX\EOT\218o-", _willMsg =
// "8\US\146\&6\140\255wr\180\153\226P\197c\191\139y\166q\243\140\235", _willProps = []}), _cleanSession = False,
// _keepAlive = 26495, _connID = "\178t?\235s\202\a;KB\143\142\223\245\b\219\194\166\232\CAN@", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x81, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x67, 0x7f, 0x0,  0x15, 0xb2, 0x74,
                   0x3f, 0xeb, 0x73, 0xca, 0x7,  0x3b, 0x4b, 0x42, 0x8f, 0x8e, 0xdf, 0xf5, 0x8,  0xdb, 0xc2, 0xa6, 0xe8,
                   0x18, 0x40, 0x0,  0x17, 0x29, 0x56, 0xe6, 0x17, 0x8a, 0xc9, 0xa2, 0x8f, 0x6e, 0x52, 0x7e, 0x6e, 0xd9,
                   0x1a, 0x71, 0xc1, 0x89, 0xdf, 0x2,  0x4,  0xda, 0x6f, 0x2d, 0x0,  0x16, 0x38, 0x1f, 0x92, 0x36, 0x8c,
                   0xff, 0x77, 0x72, 0xb4, 0x99, 0xe2, 0x50, 0xc5, 0x63, 0xbf, 0x8b, 0x79, 0xa6, 0x71, 0xf3, 0x8c, 0xeb,
                   0x0,  0x1b, 0xb9, 0xfb, 0xcf, 0xa8, 0x51, 0x86, 0x87, 0x8f, 0xde, 0xc4, 0xe9, 0x90, 0x1d, 0x32, 0xe9,
                   0xba, 0x1e, 0x39, 0xce, 0xa9, 0x85, 0x25, 0x8e, 0x9f, 0xd7, 0x90, 0x49, 0x0,  0x10, 0xe2, 0xd3, 0xbd,
                   0x3a, 0xf8, 0x63, 0x6d, 0xee, 0x88, 0x30, 0xc,  0xa2, 0x2f, 0x8,  0xc7, 0x21};

  uint8_t buf[142] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x29, 0x56, 0xe6, 0x17, 0x8a, 0xc9, 0xa2, 0x8f, 0x6e, 0x52, 0x7e, 0x6e,
                                0xd9, 0x1a, 0x71, 0xc1, 0x89, 0xdf, 0x2,  0x4,  0xda, 0x6f, 0x2d};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x38, 0x1f, 0x92, 0x36, 0x8c, 0xff, 0x77, 0x72, 0xb4, 0x99, 0xe2,
                                  0x50, 0xc5, 0x63, 0xbf, 0x8b, 0x79, 0xa6, 0x71, 0xf3, 0x8c, 0xeb};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26495;
  uint8_t client_id_bytes[] = {0xb2, 0x74, 0x3f, 0xeb, 0x73, 0xca, 0x7,  0x3b, 0x4b, 0x42, 0x8f,
                               0x8e, 0xdf, 0xf5, 0x8,  0xdb, 0xc2, 0xa6, 0xe8, 0x18, 0x40};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb9, 0xfb, 0xcf, 0xa8, 0x51, 0x86, 0x87, 0x8f, 0xde, 0xc4, 0xe9, 0x90, 0x1d, 0x32,
                              0xe9, 0xba, 0x1e, 0x39, 0xce, 0xa9, 0x85, 0x25, 0x8e, 0x9f, 0xd7, 0x90, 0x49};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe2, 0xd3, 0xbd, 0x3a, 0xf8, 0x63, 0x6d, 0xee,
                              0x88, 0x30, 0xc,  0xa2, 0x2f, 0x8,  0xc7, 0x21};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "S\EMr\236\180m\171\241#\147\247\CAN6\217\212}\226\139
// H\249\252\SI\164\190G\DLE\253\139P", _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\DC1\204\194j\212B2e>?\248=l\142X\199U\rs\EMI\a\190", _willMsg = ";\212\214\144\179\bu\237",
// _willProps = []}), _cleanSession = True, _keepAlive = 30140, _connID =
// "N\199j\187\238\237\193\\-\250\182V\DC3\193R\DEL\DC1>o\168\185\199\195i\201BW\253\189\&8", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x6d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x96, 0x75, 0xbc, 0x0,  0x1e, 0x4e, 0xc7,
                   0x6a, 0xbb, 0xee, 0xed, 0xc1, 0x5c, 0x2d, 0xfa, 0xb6, 0x56, 0x13, 0xc1, 0x52, 0x7f, 0x11, 0x3e,
                   0x6f, 0xa8, 0xb9, 0xc7, 0xc3, 0x69, 0xc9, 0x42, 0x57, 0xfd, 0xbd, 0x38, 0x0,  0x17, 0x11, 0xcc,
                   0xc2, 0x6a, 0xd4, 0x42, 0x32, 0x65, 0x3e, 0x3f, 0xf8, 0x3d, 0x6c, 0x8e, 0x58, 0xc7, 0x55, 0xd,
                   0x73, 0x19, 0x49, 0x7,  0xbe, 0x0,  0x8,  0x3b, 0xd4, 0xd6, 0x90, 0xb3, 0x8,  0x75, 0xed, 0x0,
                   0x1e, 0x53, 0x19, 0x72, 0xec, 0xb4, 0x6d, 0xab, 0xf1, 0x23, 0x93, 0xf7, 0x18, 0x36, 0xd9, 0xd4,
                   0x7d, 0xe2, 0x8b, 0x20, 0x48, 0xf9, 0xfc, 0xf,  0xa4, 0xbe, 0x47, 0x10, 0xfd, 0x8b, 0x50};

  uint8_t buf[121] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x11, 0xcc, 0xc2, 0x6a, 0xd4, 0x42, 0x32, 0x65, 0x3e, 0x3f, 0xf8, 0x3d,
                                0x6c, 0x8e, 0x58, 0xc7, 0x55, 0xd,  0x73, 0x19, 0x49, 0x7,  0xbe};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3b, 0xd4, 0xd6, 0x90, 0xb3, 0x8, 0x75, 0xed};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30140;
  uint8_t client_id_bytes[] = {0x4e, 0xc7, 0x6a, 0xbb, 0xee, 0xed, 0xc1, 0x5c, 0x2d, 0xfa,
                               0xb6, 0x56, 0x13, 0xc1, 0x52, 0x7f, 0x11, 0x3e, 0x6f, 0xa8,
                               0xb9, 0xc7, 0xc3, 0x69, 0xc9, 0x42, 0x57, 0xfd, 0xbd, 0x38};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x53, 0x19, 0x72, 0xec, 0xb4, 0x6d, 0xab, 0xf1, 0x23, 0x93, 0xf7, 0x18, 0x36, 0xd9, 0xd4,
                              0x7d, 0xe2, 0x8b, 0x20, 0x48, 0xf9, 0xfc, 0xf,  0xa4, 0xbe, 0x47, 0x10, 0xfd, 0x8b, 0x50};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "-/\n", _password = Just
// "\DC1\248,\158\217\201a;Ayt\223u8\DC1\202\235z;\132E4z\135~b\208\175}\228", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\199\150!\SI0f4q\193\205\138\240\172!\SO/V\131\230\160", _willMsg =
// "\SOHv\ETB.O\221\DEL\243$\SYN\186\156g\r\218*\222c", _willProps = []}), _cleanSession = False, _keepAlive = 9480,
// _connID = "\221G3\134\ad\205\255\246S\165\157\209\247\DC4w\180\"T\253\227k\210\179\154(\202", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x76, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x25, 0x8,  0x0,  0x1b, 0xdd,
                   0x47, 0x33, 0x86, 0x7,  0x64, 0xcd, 0xff, 0xf6, 0x53, 0xa5, 0x9d, 0xd1, 0xf7, 0x14, 0x77,
                   0xb4, 0x22, 0x54, 0xfd, 0xe3, 0x6b, 0xd2, 0xb3, 0x9a, 0x28, 0xca, 0x0,  0x14, 0xc7, 0x96,
                   0x21, 0xf,  0x30, 0x66, 0x34, 0x71, 0xc1, 0xcd, 0x8a, 0xf0, 0xac, 0x21, 0xe,  0x2f, 0x56,
                   0x83, 0xe6, 0xa0, 0x0,  0x12, 0x1,  0x76, 0x17, 0x2e, 0x4f, 0xdd, 0x7f, 0xf3, 0x24, 0x16,
                   0xba, 0x9c, 0x67, 0xd,  0xda, 0x2a, 0xde, 0x63, 0x0,  0x3,  0x2d, 0x2f, 0xa,  0x0,  0x1e,
                   0x11, 0xf8, 0x2c, 0x9e, 0xd9, 0xc9, 0x61, 0x3b, 0x41, 0x79, 0x74, 0xdf, 0x75, 0x38, 0x11,
                   0xca, 0xeb, 0x7a, 0x3b, 0x84, 0x45, 0x34, 0x7a, 0x87, 0x7e, 0x62, 0xd0, 0xaf, 0x7d, 0xe4};

  uint8_t buf[130] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc7, 0x96, 0x21, 0xf,  0x30, 0x66, 0x34, 0x71, 0xc1, 0xcd,
                                0x8a, 0xf0, 0xac, 0x21, 0xe,  0x2f, 0x56, 0x83, 0xe6, 0xa0};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1,  0x76, 0x17, 0x2e, 0x4f, 0xdd, 0x7f, 0xf3, 0x24,
                                  0x16, 0xba, 0x9c, 0x67, 0xd,  0xda, 0x2a, 0xde, 0x63};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9480;
  uint8_t client_id_bytes[] = {0xdd, 0x47, 0x33, 0x86, 0x7,  0x64, 0xcd, 0xff, 0xf6, 0x53, 0xa5, 0x9d, 0xd1, 0xf7,
                               0x14, 0x77, 0xb4, 0x22, 0x54, 0xfd, 0xe3, 0x6b, 0xd2, 0xb3, 0x9a, 0x28, 0xca};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2d, 0x2f, 0xa};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x11, 0xf8, 0x2c, 0x9e, 0xd9, 0xc9, 0x61, 0x3b, 0x41, 0x79, 0x74, 0xdf, 0x75, 0x38, 0x11,
                              0xca, 0xeb, 0x7a, 0x3b, 0x84, 0x45, 0x34, 0x7a, 0x87, 0x7e, 0x62, 0xd0, 0xaf, 0x7d, 0xe4};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\192\131", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 25448, _connID = "\131\216\FS}\NAKIn$\DC37\186M\161\151kP\148\142|\224Q\234\249\223\172hF\168",
// _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x28, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x63, 0x68, 0x0,  0x1c,
                   0x83, 0xd8, 0x1c, 0x7d, 0x15, 0x49, 0x6e, 0x24, 0x13, 0x37, 0xba, 0x4d, 0xa1, 0x97,
                   0x6b, 0x50, 0x94, 0x8e, 0x7c, 0xe0, 0x51, 0xea, 0xf9, 0xdf, 0xac, 0x68, 0x46, 0xa8};

  uint8_t buf[52] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25448;
  uint8_t client_id_bytes[] = {0x83, 0xd8, 0x1c, 0x7d, 0x15, 0x49, 0x6e, 0x24, 0x13, 0x37, 0xba, 0x4d, 0xa1, 0x97,
                               0x6b, 0x50, 0x94, 0x8e, 0x7c, 0xe0, 0x51, 0xea, 0xf9, 0xdf, 0xac, 0x68, 0x46, 0xa8};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc0, 0x83};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\168\156M\204\209\177\255\141Bh\181\255\ACK4\218\ACKG\184\227\213\203", _password =
// Just "\GS\180\153*L\206\143\205", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "`\ACK\139\b", _willMsg = "\156E)Ei\136\NAK\137\140x\237K\166\154", _willProps = []}), _cleanSession = True,
// _keepAlive = 12280, _connID = "_\f\142\129\132{J\221 Xo", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x2f, 0xf8, 0x0,  0xb,  0x5f, 0xc,
                   0x8e, 0x81, 0x84, 0x7b, 0x4a, 0xdd, 0x20, 0x58, 0x6f, 0x0,  0x4,  0x60, 0x6,  0x8b, 0x8,  0x0,
                   0xe,  0x9c, 0x45, 0x29, 0x45, 0x69, 0x88, 0x15, 0x89, 0x8c, 0x78, 0xed, 0x4b, 0xa6, 0x9a, 0x0,
                   0x15, 0xa8, 0x9c, 0x4d, 0xcc, 0xd1, 0xb1, 0xff, 0x8d, 0x42, 0x68, 0xb5, 0xff, 0x6,  0x34, 0xda,
                   0x6,  0x47, 0xb8, 0xe3, 0xd5, 0xcb, 0x0,  0x8,  0x1d, 0xb4, 0x99, 0x2a, 0x4c, 0xce, 0x8f, 0xcd};

  uint8_t buf[90] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x60, 0x6, 0x8b, 0x8};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x9c, 0x45, 0x29, 0x45, 0x69, 0x88, 0x15, 0x89, 0x8c, 0x78, 0xed, 0x4b, 0xa6, 0x9a};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12280;
  uint8_t client_id_bytes[] = {0x5f, 0xc, 0x8e, 0x81, 0x84, 0x7b, 0x4a, 0xdd, 0x20, 0x58, 0x6f};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa8, 0x9c, 0x4d, 0xcc, 0xd1, 0xb1, 0xff, 0x8d, 0x42, 0x68, 0xb5,
                              0xff, 0x6,  0x34, 0xda, 0x6,  0x47, 0xb8, 0xe3, 0xd5, 0xcb};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1d, 0xb4, 0x99, 0x2a, 0x4c, 0xce, 0x8f, 0xcd};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "2\161\185\SYNP2z\ACK0l\186\203\155R\148\SUBXt\251\SI",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "V\140x\158\250\EOT>\241\241\148\199U",
// _willMsg = "\164[\137g\135\241I\233\146\232\214\165\163\235E\163v0\138#\DC3T4", _willProps = []}), _cleanSession =
// True, _keepAlive = 18446, _connID = "\223\DC1\215tI\188[\152", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x3b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x48, 0xe,  0x0,  0x8,  0xdf, 0x11,
                   0xd7, 0x74, 0x49, 0xbc, 0x5b, 0x98, 0x0,  0xc,  0x56, 0x8c, 0x78, 0x9e, 0xfa, 0x4,  0x3e, 0xf1,
                   0xf1, 0x94, 0xc7, 0x55, 0x0,  0x17, 0xa4, 0x5b, 0x89, 0x67, 0x87, 0xf1, 0x49, 0xe9, 0x92, 0xe8,
                   0xd6, 0xa5, 0xa3, 0xeb, 0x45, 0xa3, 0x76, 0x30, 0x8a, 0x23, 0x13, 0x54, 0x34};

  uint8_t buf[71] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x56, 0x8c, 0x78, 0x9e, 0xfa, 0x4, 0x3e, 0xf1, 0xf1, 0x94, 0xc7, 0x55};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0x5b, 0x89, 0x67, 0x87, 0xf1, 0x49, 0xe9, 0x92, 0xe8, 0xd6, 0xa5,
                                  0xa3, 0xeb, 0x45, 0xa3, 0x76, 0x30, 0x8a, 0x23, 0x13, 0x54, 0x34};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18446;
  uint8_t client_id_bytes[] = {0xdf, 0x11, 0xd7, 0x74, 0x49, 0xbc, 0x5b, 0x98};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x32, 0xa1, 0xb9, 0x16, 0x50, 0x32, 0x7a, 0x6,  0x30, 0x6c,
                              0xba, 0xcb, 0x9b, 0x52, 0x94, 0x1a, 0x58, 0x74, 0xfb, 0xf};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\153\228E\255\142\252(L", _password = Just "NP\144 \208\ETB", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "C\192\208T\157\190'\DC3E\153\205\237\208\137\EOT\130\GS\200", _willMsg = "", _willProps = []}), _cleanSession =
// True, _keepAlive = 24334, _connID = "\191\181\157\159\245\202\211", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x3b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf6, 0x5f, 0xe,  0x0,  0x7,  0xbf, 0xb5,
                   0x9d, 0x9f, 0xf5, 0xca, 0xd3, 0x0,  0x12, 0x43, 0xc0, 0xd0, 0x54, 0x9d, 0xbe, 0x27, 0x13, 0x45,
                   0x99, 0xcd, 0xed, 0xd0, 0x89, 0x4,  0x82, 0x1d, 0xc8, 0x0,  0x0,  0x0,  0x8,  0x99, 0xe4, 0x45,
                   0xff, 0x8e, 0xfc, 0x28, 0x4c, 0x0,  0x6,  0x4e, 0x50, 0x90, 0x20, 0xd0, 0x17};

  uint8_t buf[71] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x43, 0xc0, 0xd0, 0x54, 0x9d, 0xbe, 0x27, 0x13, 0x45,
                                0x99, 0xcd, 0xed, 0xd0, 0x89, 0x4,  0x82, 0x1d, 0xc8};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24334;
  uint8_t client_id_bytes[] = {0xbf, 0xb5, 0x9d, 0x9f, 0xf5, 0xca, 0xd3};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x99, 0xe4, 0x45, 0xff, 0x8e, 0xfc, 0x28, 0x4c};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4e, 0x50, 0x90, 0x20, 0xd0, 0x17};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\166B\SO^~\248\144\152\224\232\161\186", _password = Just "s\130\248.\129\v\222",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\b8\n\140)k\ESC\v", _willMsg =
// "$\173\176\USm\202h\211\254\147\r\241c\217", _willProps = []}), _cleanSession = True, _keepAlive = 11162, _connID =
// "\\\NUL\237\211\216\199\228=\232-\185\&9^/Qf\251L", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x4f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x2b, 0x9a, 0x0,  0x12, 0x5c, 0x0,  0xed,
                   0xd3, 0xd8, 0xc7, 0xe4, 0x3d, 0xe8, 0x2d, 0xb9, 0x39, 0x5e, 0x2f, 0x51, 0x66, 0xfb, 0x4c, 0x0,  0x8,
                   0x8,  0x38, 0xa,  0x8c, 0x29, 0x6b, 0x1b, 0xb,  0x0,  0xe,  0x24, 0xad, 0xb0, 0x1f, 0x6d, 0xca, 0x68,
                   0xd3, 0xfe, 0x93, 0xd,  0xf1, 0x63, 0xd9, 0x0,  0xc,  0xa6, 0x42, 0xe,  0x5e, 0x7e, 0xf8, 0x90, 0x98,
                   0xe0, 0xe8, 0xa1, 0xba, 0x0,  0x7,  0x73, 0x82, 0xf8, 0x2e, 0x81, 0xb,  0xde};

  uint8_t buf[91] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8, 0x38, 0xa, 0x8c, 0x29, 0x6b, 0x1b, 0xb};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x24, 0xad, 0xb0, 0x1f, 0x6d, 0xca, 0x68, 0xd3, 0xfe, 0x93, 0xd, 0xf1, 0x63, 0xd9};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11162;
  uint8_t client_id_bytes[] = {0x5c, 0x0,  0xed, 0xd3, 0xd8, 0xc7, 0xe4, 0x3d, 0xe8,
                               0x2d, 0xb9, 0x39, 0x5e, 0x2f, 0x51, 0x66, 0xfb, 0x4c};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa6, 0x42, 0xe, 0x5e, 0x7e, 0xf8, 0x90, 0x98, 0xe0, 0xe8, 0xa1, 0xba};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x73, 0x82, 0xf8, 0x2e, 0x81, 0xb, 0xde};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "}\195VI\SUBP\166\207\141<\140\203\164\224Z", _password = Just
// "\239\US\GSs(\139lq\152'\206\238\DC3(f\172P\GS\152\130\235K\NUL\234", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "O1\SYN\218\151&\229\155j\237\DLEF\143\216\232a\189\195\226\142", _willMsg =
// "\178\165\170\181(-\248\204\DLE\230jKY\EOT>\EM>", _willProps = []}), _cleanSession = False, _keepAlive = 21561,
// _connID = "X\167X\244/`\v\181e#h\159\179\219;Q\173\v\134\181+\149\190xs", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x79, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc4, 0x54, 0x39, 0x0,  0x19, 0x58, 0xa7,
                   0x58, 0xf4, 0x2f, 0x60, 0xb,  0xb5, 0x65, 0x23, 0x68, 0x9f, 0xb3, 0xdb, 0x3b, 0x51, 0xad, 0xb,
                   0x86, 0xb5, 0x2b, 0x95, 0xbe, 0x78, 0x73, 0x0,  0x14, 0x4f, 0x31, 0x16, 0xda, 0x97, 0x26, 0xe5,
                   0x9b, 0x6a, 0xed, 0x10, 0x46, 0x8f, 0xd8, 0xe8, 0x61, 0xbd, 0xc3, 0xe2, 0x8e, 0x0,  0x11, 0xb2,
                   0xa5, 0xaa, 0xb5, 0x28, 0x2d, 0xf8, 0xcc, 0x10, 0xe6, 0x6a, 0x4b, 0x59, 0x4,  0x3e, 0x19, 0x3e,
                   0x0,  0xf,  0x7d, 0xc3, 0x56, 0x49, 0x1a, 0x50, 0xa6, 0xcf, 0x8d, 0x3c, 0x8c, 0xcb, 0xa4, 0xe0,
                   0x5a, 0x0,  0x18, 0xef, 0x1f, 0x1d, 0x73, 0x28, 0x8b, 0x6c, 0x71, 0x98, 0x27, 0xce, 0xee, 0x13,
                   0x28, 0x66, 0xac, 0x50, 0x1d, 0x98, 0x82, 0xeb, 0x4b, 0x0,  0xea};

  uint8_t buf[133] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4f, 0x31, 0x16, 0xda, 0x97, 0x26, 0xe5, 0x9b, 0x6a, 0xed,
                                0x10, 0x46, 0x8f, 0xd8, 0xe8, 0x61, 0xbd, 0xc3, 0xe2, 0x8e};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb2, 0xa5, 0xaa, 0xb5, 0x28, 0x2d, 0xf8, 0xcc, 0x10,
                                  0xe6, 0x6a, 0x4b, 0x59, 0x4,  0x3e, 0x19, 0x3e};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 21561;
  uint8_t client_id_bytes[] = {0x58, 0xa7, 0x58, 0xf4, 0x2f, 0x60, 0xb,  0xb5, 0x65, 0x23, 0x68, 0x9f, 0xb3,
                               0xdb, 0x3b, 0x51, 0xad, 0xb,  0x86, 0xb5, 0x2b, 0x95, 0xbe, 0x78, 0x73};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7d, 0xc3, 0x56, 0x49, 0x1a, 0x50, 0xa6, 0xcf, 0x8d, 0x3c, 0x8c, 0xcb, 0xa4, 0xe0, 0x5a};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xef, 0x1f, 0x1d, 0x73, 0x28, 0x8b, 0x6c, 0x71, 0x98, 0x27, 0xce, 0xee,
                              0x13, 0x28, 0x66, 0xac, 0x50, 0x1d, 0x98, 0x82, 0xeb, 0x4b, 0x0,  0xea};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\239zk\159\ETX\223!\141\ETX\233\248\f1=\DC4i", _password = Just
// "\191\141\246E\193\236\243\223\153\216myo\194\214\244\200\140\198\147\236Q\194X\130\136", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic = "L&sv\176Yc2O\\\201,", _willMsg =
// "/\a}\172t\US\218\131\240\224S\221\205S\227\223\231\246~_\168}|8\172\219\157\168", _willProps = []}), _cleanSession =
// False, _keepAlive = 478, _connID = "+\251Q\185q\193\199\n\237\186\162\a", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x72, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x1,  0xde, 0x0,  0xc,  0x2b, 0xfb, 0x51,
                   0xb9, 0x71, 0xc1, 0xc7, 0xa,  0xed, 0xba, 0xa2, 0x7,  0x0,  0xc,  0x4c, 0x26, 0x73, 0x76, 0xb0, 0x59,
                   0x63, 0x32, 0x4f, 0x5c, 0xc9, 0x2c, 0x0,  0x1c, 0x2f, 0x7,  0x7d, 0xac, 0x74, 0x1f, 0xda, 0x83, 0xf0,
                   0xe0, 0x53, 0xdd, 0xcd, 0x53, 0xe3, 0xdf, 0xe7, 0xf6, 0x7e, 0x5f, 0xa8, 0x7d, 0x7c, 0x38, 0xac, 0xdb,
                   0x9d, 0xa8, 0x0,  0x10, 0xef, 0x7a, 0x6b, 0x9f, 0x3,  0xdf, 0x21, 0x8d, 0x3,  0xe9, 0xf8, 0xc,  0x31,
                   0x3d, 0x14, 0x69, 0x0,  0x1a, 0xbf, 0x8d, 0xf6, 0x45, 0xc1, 0xec, 0xf3, 0xdf, 0x99, 0xd8, 0x6d, 0x79,
                   0x6f, 0xc2, 0xd6, 0xf4, 0xc8, 0x8c, 0xc6, 0x93, 0xec, 0x51, 0xc2, 0x58, 0x82, 0x88};

  uint8_t buf[126] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4c, 0x26, 0x73, 0x76, 0xb0, 0x59, 0x63, 0x32, 0x4f, 0x5c, 0xc9, 0x2c};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2f, 0x7,  0x7d, 0xac, 0x74, 0x1f, 0xda, 0x83, 0xf0, 0xe0, 0x53, 0xdd, 0xcd, 0x53,
                                  0xe3, 0xdf, 0xe7, 0xf6, 0x7e, 0x5f, 0xa8, 0x7d, 0x7c, 0x38, 0xac, 0xdb, 0x9d, 0xa8};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 478;
  uint8_t client_id_bytes[] = {0x2b, 0xfb, 0x51, 0xb9, 0x71, 0xc1, 0xc7, 0xa, 0xed, 0xba, 0xa2, 0x7};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xef, 0x7a, 0x6b, 0x9f, 0x3,  0xdf, 0x21, 0x8d,
                              0x3,  0xe9, 0xf8, 0xc,  0x31, 0x3d, 0x14, 0x69};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbf, 0x8d, 0xf6, 0x45, 0xc1, 0xec, 0xf3, 0xdf, 0x99, 0xd8, 0x6d, 0x79, 0x6f,
                              0xc2, 0xd6, 0xf4, 0xc8, 0x8c, 0xc6, 0x93, 0xec, 0x51, 0xc2, 0x58, 0x82, 0x88};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\185\251\207\168Q\134\135\143\222\196\233\144\GS2\233\186\RS9\206\169\133%\142\159\215\144I", _password = Just
// "\226\211\189:\248cm\238\136\&0\f\162/\b\199!", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0,
// _willTopic = ")V\230\ETB\138\201\162\143nR~n\217\SUBq\193\137\223\STX\EOT\218o-", _willMsg =
// "8\US\146\&6\140\255wr\180\153\226P\197c\191\139y\166q\243\140\235", _willProps = [PropUserProperty ""
// "&O\EM,\149YV.w!",PropSubscriptionIdentifier 27,PropWillDelayInterval 2671,PropRetainAvailable
// 214,PropMessageExpiryInterval 2278,PropReasonString "lH6Qh\185\&3r\171\254\138Dp\157",PropTopicAlias
// 26598,PropSharedSubscriptionAvailable 185,PropAuthenticationData
// "\134DTa4\227\151\180\255\135\144c\226\232\142",PropReasonString "S\143",PropMaximumQoS 217,PropServerReference
// "\186\DC2Iv",PropResponseInformation
// "\182Zc\177\146\181\190\131\236\250\182\252\v\167=dy\199\210\235\133:\165\SYN\167\220",PropMessageExpiryInterval
// 5186,PropPayloadFormatIndicator 87,PropSharedSubscriptionAvailable 234,PropMessageExpiryInterval
// 7625,PropAssignedClientIdentifier "\161\203T\253"]}), _cleanSession = False, _keepAlive = 26495, _connID =
// "\178t?\235s\202\a;KB\143\142\223\245\b\219\194\166\232\CAN@", _properties = [PropReasonString
// "\232\FS\252\134H\249\185 \189\228^\CANl\146\153\US3\188g\255",PropReasonString
// "r\248\DC27",PropAssignedClientIdentifier
// "\176\187D0\149\ETB\SO\173\155\227VD\215}\157\SYNU\175\DEL\225>\254",PropMessageExpiryInterval
// 15875,PropRequestProblemInformation 32,PropServerKeepAlive 14420,PropSubscriptionIdentifier 14,PropServerKeepAlive
// 12053,PropRetainAvailable 196]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x10, 0xd1, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x67, 0x7f, 0x48, 0x1f, 0x0,  0x14, 0xe8, 0x1c,
      0xfc, 0x86, 0x48, 0xf9, 0xb9, 0x20, 0xbd, 0xe4, 0x5e, 0x18, 0x6c, 0x92, 0x99, 0x1f, 0x33, 0xbc, 0x67, 0xff, 0x1f,
      0x0,  0x4,  0x72, 0xf8, 0x12, 0x37, 0x12, 0x0,  0x16, 0xb0, 0xbb, 0x44, 0x30, 0x95, 0x17, 0xe,  0xad, 0x9b, 0xe3,
      0x56, 0x44, 0xd7, 0x7d, 0x9d, 0x16, 0x55, 0xaf, 0x7f, 0xe1, 0x3e, 0xfe, 0x2,  0x0,  0x0,  0x3e, 0x3,  0x17, 0x20,
      0x13, 0x38, 0x54, 0xb,  0xe,  0x13, 0x2f, 0x15, 0x25, 0xc4, 0x0,  0x15, 0xb2, 0x74, 0x3f, 0xeb, 0x73, 0xca, 0x7,
      0x3b, 0x4b, 0x42, 0x8f, 0x8e, 0xdf, 0xf5, 0x8,  0xdb, 0xc2, 0xa6, 0xe8, 0x18, 0x40, 0x85, 0x1,  0x26, 0x0,  0x0,
      0x0,  0xa,  0x26, 0x4f, 0x19, 0x2c, 0x95, 0x59, 0x56, 0x2e, 0x77, 0x21, 0xb,  0x1b, 0x18, 0x0,  0x0,  0xa,  0x6f,
      0x25, 0xd6, 0x2,  0x0,  0x0,  0x8,  0xe6, 0x1f, 0x0,  0xe,  0x6c, 0x48, 0x36, 0x51, 0x68, 0xb9, 0x33, 0x72, 0xab,
      0xfe, 0x8a, 0x44, 0x70, 0x9d, 0x23, 0x67, 0xe6, 0x2a, 0xb9, 0x16, 0x0,  0xf,  0x86, 0x44, 0x54, 0x61, 0x34, 0xe3,
      0x97, 0xb4, 0xff, 0x87, 0x90, 0x63, 0xe2, 0xe8, 0x8e, 0x1f, 0x0,  0x2,  0x53, 0x8f, 0x24, 0xd9, 0x1c, 0x0,  0x4,
      0xba, 0x12, 0x49, 0x76, 0x1a, 0x0,  0x1a, 0xb6, 0x5a, 0x63, 0xb1, 0x92, 0xb5, 0xbe, 0x83, 0xec, 0xfa, 0xb6, 0xfc,
      0xb,  0xa7, 0x3d, 0x64, 0x79, 0xc7, 0xd2, 0xeb, 0x85, 0x3a, 0xa5, 0x16, 0xa7, 0xdc, 0x2,  0x0,  0x0,  0x14, 0x42,
      0x1,  0x57, 0x2a, 0xea, 0x2,  0x0,  0x0,  0x1d, 0xc9, 0x12, 0x0,  0x4,  0xa1, 0xcb, 0x54, 0xfd, 0x0,  0x17, 0x29,
      0x56, 0xe6, 0x17, 0x8a, 0xc9, 0xa2, 0x8f, 0x6e, 0x52, 0x7e, 0x6e, 0xd9, 0x1a, 0x71, 0xc1, 0x89, 0xdf, 0x2,  0x4,
      0xda, 0x6f, 0x2d, 0x0,  0x16, 0x38, 0x1f, 0x92, 0x36, 0x8c, 0xff, 0x77, 0x72, 0xb4, 0x99, 0xe2, 0x50, 0xc5, 0x63,
      0xbf, 0x8b, 0x79, 0xa6, 0x71, 0xf3, 0x8c, 0xeb, 0x0,  0x1b, 0xb9, 0xfb, 0xcf, 0xa8, 0x51, 0x86, 0x87, 0x8f, 0xde,
      0xc4, 0xe9, 0x90, 0x1d, 0x32, 0xe9, 0xba, 0x1e, 0x39, 0xce, 0xa9, 0x85, 0x25, 0x8e, 0x9f, 0xd7, 0x90, 0x49, 0x0,
      0x10, 0xe2, 0xd3, 0xbd, 0x3a, 0xf8, 0x63, 0x6d, 0xee, 0x88, 0x30, 0xc,  0xa2, 0x2f, 0x8,  0xc7, 0x21};

  uint8_t buf[350] = {0};

  uint8_t bytesprops0[] = {0xe8, 0x1c, 0xfc, 0x86, 0x48, 0xf9, 0xb9, 0x20, 0xbd, 0xe4,
                           0x5e, 0x18, 0x6c, 0x92, 0x99, 0x1f, 0x33, 0xbc, 0x67, 0xff};
  uint8_t bytesprops1[] = {0x72, 0xf8, 0x12, 0x37};
  uint8_t bytesprops2[] = {0xb0, 0xbb, 0x44, 0x30, 0x95, 0x17, 0xe,  0xad, 0x9b, 0xe3, 0x56,
                           0x44, 0xd7, 0x7d, 0x9d, 0x16, 0x55, 0xaf, 0x7f, 0xe1, 0x3e, 0xfe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15875}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14420}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12053}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 196}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x26, 0x4f, 0x19, 0x2c, 0x95, 0x59, 0x56, 0x2e, 0x77, 0x21};
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops2[] = {0x6c, 0x48, 0x36, 0x51, 0x68, 0xb9, 0x33, 0x72, 0xab, 0xfe, 0x8a, 0x44, 0x70, 0x9d};
  uint8_t byteswillprops3[] = {0x86, 0x44, 0x54, 0x61, 0x34, 0xe3, 0x97, 0xb4,
                               0xff, 0x87, 0x90, 0x63, 0xe2, 0xe8, 0x8e};
  uint8_t byteswillprops4[] = {0x53, 0x8f};
  uint8_t byteswillprops5[] = {0xba, 0x12, 0x49, 0x76};
  uint8_t byteswillprops6[] = {0xb6, 0x5a, 0x63, 0xb1, 0x92, 0xb5, 0xbe, 0x83, 0xec, 0xfa, 0xb6, 0xfc, 0xb,
                               0xa7, 0x3d, 0x64, 0x79, 0xc7, 0xd2, 0xeb, 0x85, 0x3a, 0xa5, 0x16, 0xa7, 0xdc};
  uint8_t byteswillprops7[] = {0xa1, 0xcb, 0x54, 0xfd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops0}, .v = {10, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2671}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2278}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26598}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5186}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7625}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x29, 0x56, 0xe6, 0x17, 0x8a, 0xc9, 0xa2, 0x8f, 0x6e, 0x52, 0x7e, 0x6e,
                                0xd9, 0x1a, 0x71, 0xc1, 0x89, 0xdf, 0x2,  0x4,  0xda, 0x6f, 0x2d};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x38, 0x1f, 0x92, 0x36, 0x8c, 0xff, 0x77, 0x72, 0xb4, 0x99, 0xe2,
                                  0x50, 0xc5, 0x63, 0xbf, 0x8b, 0x79, 0xa6, 0x71, 0xf3, 0x8c, 0xeb};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26495;
  uint8_t client_id_bytes[] = {0xb2, 0x74, 0x3f, 0xeb, 0x73, 0xca, 0x7,  0x3b, 0x4b, 0x42, 0x8f,
                               0x8e, 0xdf, 0xf5, 0x8,  0xdb, 0xc2, 0xa6, 0xe8, 0x18, 0x40};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb9, 0xfb, 0xcf, 0xa8, 0x51, 0x86, 0x87, 0x8f, 0xde, 0xc4, 0xe9, 0x90, 0x1d, 0x32,
                              0xe9, 0xba, 0x1e, 0x39, 0xce, 0xa9, 0x85, 0x25, 0x8e, 0x9f, 0xd7, 0x90, 0x49};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe2, 0xd3, 0xbd, 0x3a, 0xf8, 0x63, 0x6d, 0xee,
                              0x88, 0x30, 0xc,  0xa2, 0x2f, 0x8,  0xc7, 0x21};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "S\EMr\236\180m\171\241#\147\247\CAN6\217\212}\226\139
// H\249\252\SI\164\190G\DLE\253\139P", _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\DC1\204\194j\212B2e>?\248=l\142X\199U\rs\EMI\a\190", _willMsg = ";\212\214\144\179\bu\237",
// _willProps = [PropResponseTopic "A\238\131\188"]}), _cleanSession = True, _keepAlive = 30140, _connID =
// "N\199j\187\238\237\193\\-\250\182V\DC3\193R\DEL\DC1>o\168\185\199\195i\201BW\253\189\&8", _properties =
// [PropRetainAvailable 118,PropUserProperty "\222\137\224" "\FS,Z\167W",PropTopicAlias 26986,PropAuthenticationData
// "\142\192\248\243\147\141K\145\174\164\220\151.;0\217\232#\167\128\130\188\ACK",PropRequestProblemInformation
// 144,PropUserProperty "\209K\133\216\224\164I\SI\248\DC3\226\ESCo&\191\SUBJ\177"
// "\DC4\249?\240+\239\DC4\243z.\\\SI\155 ",PropMaximumQoS 38,PropReceiveMaximum 21644,PropServerReference
// "\181\171d\182f_R\206\172\142c\196\250\r\NAK\245",PropResponseTopic
// "\DLE;2a\178;\EOTk>Z\170\STX\EOT\132\203\USn",PropReceiveMaximum 18705,PropReasonString "\170",PropReasonString
// "\251\226Ug\148\ETB\216\t\142\167\153*\154J\207\179\171U^y\143\&51\168",PropRetainAvailable 63]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0x9a, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x96, 0x75, 0xbc, 0xa3, 0x1,  0x25, 0x76, 0x26, 0x0,
      0x3,  0xde, 0x89, 0xe0, 0x0,  0x5,  0x1c, 0x2c, 0x5a, 0xa7, 0x57, 0x23, 0x69, 0x6a, 0x16, 0x0,  0x17, 0x8e, 0xc0,
      0xf8, 0xf3, 0x93, 0x8d, 0x4b, 0x91, 0xae, 0xa4, 0xdc, 0x97, 0x2e, 0x3b, 0x30, 0xd9, 0xe8, 0x23, 0xa7, 0x80, 0x82,
      0xbc, 0x6,  0x17, 0x90, 0x26, 0x0,  0x12, 0xd1, 0x4b, 0x85, 0xd8, 0xe0, 0xa4, 0x49, 0xf,  0xf8, 0x13, 0xe2, 0x1b,
      0x6f, 0x26, 0xbf, 0x1a, 0x4a, 0xb1, 0x0,  0xe,  0x14, 0xf9, 0x3f, 0xf0, 0x2b, 0xef, 0x14, 0xf3, 0x7a, 0x2e, 0x5c,
      0xf,  0x9b, 0x20, 0x24, 0x26, 0x21, 0x54, 0x8c, 0x1c, 0x0,  0x10, 0xb5, 0xab, 0x64, 0xb6, 0x66, 0x5f, 0x52, 0xce,
      0xac, 0x8e, 0x63, 0xc4, 0xfa, 0xd,  0x15, 0xf5, 0x8,  0x0,  0x11, 0x10, 0x3b, 0x32, 0x61, 0xb2, 0x3b, 0x4,  0x6b,
      0x3e, 0x5a, 0xaa, 0x2,  0x4,  0x84, 0xcb, 0x1f, 0x6e, 0x21, 0x49, 0x11, 0x1f, 0x0,  0x1,  0xaa, 0x1f, 0x0,  0x18,
      0xfb, 0xe2, 0x55, 0x67, 0x94, 0x17, 0xd8, 0x9,  0x8e, 0xa7, 0x99, 0x2a, 0x9a, 0x4a, 0xcf, 0xb3, 0xab, 0x55, 0x5e,
      0x79, 0x8f, 0x35, 0x31, 0xa8, 0x25, 0x3f, 0x0,  0x1e, 0x4e, 0xc7, 0x6a, 0xbb, 0xee, 0xed, 0xc1, 0x5c, 0x2d, 0xfa,
      0xb6, 0x56, 0x13, 0xc1, 0x52, 0x7f, 0x11, 0x3e, 0x6f, 0xa8, 0xb9, 0xc7, 0xc3, 0x69, 0xc9, 0x42, 0x57, 0xfd, 0xbd,
      0x38, 0x7,  0x8,  0x0,  0x4,  0x41, 0xee, 0x83, 0xbc, 0x0,  0x17, 0x11, 0xcc, 0xc2, 0x6a, 0xd4, 0x42, 0x32, 0x65,
      0x3e, 0x3f, 0xf8, 0x3d, 0x6c, 0x8e, 0x58, 0xc7, 0x55, 0xd,  0x73, 0x19, 0x49, 0x7,  0xbe, 0x0,  0x8,  0x3b, 0xd4,
      0xd6, 0x90, 0xb3, 0x8,  0x75, 0xed, 0x0,  0x1e, 0x53, 0x19, 0x72, 0xec, 0xb4, 0x6d, 0xab, 0xf1, 0x23, 0x93, 0xf7,
      0x18, 0x36, 0xd9, 0xd4, 0x7d, 0xe2, 0x8b, 0x20, 0x48, 0xf9, 0xfc, 0xf,  0xa4, 0xbe, 0x47, 0x10, 0xfd, 0x8b, 0x50};

  uint8_t buf[295] = {0};

  uint8_t bytesprops1[] = {0x1c, 0x2c, 0x5a, 0xa7, 0x57};
  uint8_t bytesprops0[] = {0xde, 0x89, 0xe0};
  uint8_t bytesprops2[] = {0x8e, 0xc0, 0xf8, 0xf3, 0x93, 0x8d, 0x4b, 0x91, 0xae, 0xa4, 0xdc, 0x97,
                           0x2e, 0x3b, 0x30, 0xd9, 0xe8, 0x23, 0xa7, 0x80, 0x82, 0xbc, 0x6};
  uint8_t bytesprops4[] = {0x14, 0xf9, 0x3f, 0xf0, 0x2b, 0xef, 0x14, 0xf3, 0x7a, 0x2e, 0x5c, 0xf, 0x9b, 0x20};
  uint8_t bytesprops3[] = {0xd1, 0x4b, 0x85, 0xd8, 0xe0, 0xa4, 0x49, 0xf,  0xf8,
                           0x13, 0xe2, 0x1b, 0x6f, 0x26, 0xbf, 0x1a, 0x4a, 0xb1};
  uint8_t bytesprops5[] = {0xb5, 0xab, 0x64, 0xb6, 0x66, 0x5f, 0x52, 0xce,
                           0xac, 0x8e, 0x63, 0xc4, 0xfa, 0xd,  0x15, 0xf5};
  uint8_t bytesprops6[] = {0x10, 0x3b, 0x32, 0x61, 0xb2, 0x3b, 0x4,  0x6b, 0x3e,
                           0x5a, 0xaa, 0x2,  0x4,  0x84, 0xcb, 0x1f, 0x6e};
  uint8_t bytesprops7[] = {0xaa};
  uint8_t bytesprops8[] = {0xfb, 0xe2, 0x55, 0x67, 0x94, 0x17, 0xd8, 0x9,  0x8e, 0xa7, 0x99, 0x2a,
                           0x9a, 0x4a, 0xcf, 0xb3, 0xab, 0x55, 0x5e, 0x79, 0x8f, 0x35, 0x31, 0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops0}, .v = {5, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26986}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops3}, .v = {14, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21644}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18705}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 63}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x41, 0xee, 0x83, 0xbc};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x11, 0xcc, 0xc2, 0x6a, 0xd4, 0x42, 0x32, 0x65, 0x3e, 0x3f, 0xf8, 0x3d,
                                0x6c, 0x8e, 0x58, 0xc7, 0x55, 0xd,  0x73, 0x19, 0x49, 0x7,  0xbe};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3b, 0xd4, 0xd6, 0x90, 0xb3, 0x8, 0x75, 0xed};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30140;
  uint8_t client_id_bytes[] = {0x4e, 0xc7, 0x6a, 0xbb, 0xee, 0xed, 0xc1, 0x5c, 0x2d, 0xfa,
                               0xb6, 0x56, 0x13, 0xc1, 0x52, 0x7f, 0x11, 0x3e, 0x6f, 0xa8,
                               0xb9, 0xc7, 0xc3, 0x69, 0xc9, 0x42, 0x57, 0xfd, 0xbd, 0x38};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x53, 0x19, 0x72, 0xec, 0xb4, 0x6d, 0xab, 0xf1, 0x23, 0x93, 0xf7, 0x18, 0x36, 0xd9, 0xd4,
                              0x7d, 0xe2, 0x8b, 0x20, 0x48, 0xf9, 0xfc, 0xf,  0xa4, 0xbe, 0x47, 0x10, 0xfd, 0x8b, 0x50};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "-/\n", _password = Just
// "\DC1\248,\158\217\201a;Ayt\223u8\DC1\202\235z;\132E4z\135~b\208\175}\228", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\199\150!\SI0f4q\193\205\138\240\172!\SO/V\131\230\160", _willMsg =
// "\SOHv\ETB.O\221\DEL\243$\SYN\186\156g\r\218*\222c", _willProps = [PropWillDelayInterval
// 29655,PropWildcardSubscriptionAvailable 46,PropUserProperty "\206\164\216\220O$\136\220\189\166"
// "4\f\216+\152(\190\\J\249\196\156/\150_\171\140L",PropSessionExpiryInterval 24620,PropRequestResponseInformation
// 238,PropMessageExpiryInterval 8243,PropServerKeepAlive 9792,PropSessionExpiryInterval 21683,PropContentType
// "\147S\189\f+hL\234'HE*\252\nK\203\STX\140|\162S\173\155",PropReasonString
// "\227\149\216W\198\229p\231\208\251d\235\DC18$6\228\188\147<\154\211\&0\130%|6\161",PropCorrelationData
// "\152jc\170u\SI\234\&8=\143-\"\DC4\192\222\DLE.I",PropMaximumQoS 70,PropSubscriptionIdentifierAvailable
// 169,PropAuthenticationData
// "(\189\SO\RSZk\234\DC1\213\139\DC2\212\242C\205p\r]~l\252\ESC3\185,m\SOH\160\162",PropContentType
// "\f\251Uh\199",PropAuthenticationData
// "=\243\b\DC4\r\146L\233:W\160}\175\204\251\SOH#\194\223",PropSessionExpiryInterval 31741,PropResponseInformation
// "\144w\227\235",PropReasonString
// "\235D\r\214\f\239\US\EOT\ETB\212\ACK\255+\148\150\173\EOT",PropMessageExpiryInterval 3305,PropPayloadFormatIndicator
// 158,PropMessageExpiryInterval 24180,PropRequestResponseInformation 186,PropResponseInformation
// "",PropResponseInformation "\DC3u\SUB",PropMaximumPacketSize 4574,PropServerKeepAlive
// 14158,PropRequestProblemInformation 104,PropUserProperty "b\167\239\137-\177\&1\156$K\146\252,\162@\190F\233\210\189"
// "\GS\132\208q\240\208\255\188\155\&2\242\SI\214\129\b\STX\240/1%\182m\EOTh\200@\189\152"]}), _cleanSession = False,
// _keepAlive = 9480, _connID = "\221G3\134\ad\205\255\246S\165\157\209\247\DC4w\180\"T\253\227k\210\179\154(\202",
// _properties = [PropMessageExpiryInterval 13222,PropAuthenticationMethod "\\x\t\194d\SUB_\154D",PropRetainAvailable
// 79,PropMessageExpiryInterval 18495,PropAuthenticationData
// "8V\RS\r\189.\185\174\131\NUL\179\SUB\152\169\174\235\170\164\NUL\DC1\SIS\151\EOT\156",PropAuthenticationMethod
// "\165",PropRequestProblemInformation 213,PropPayloadFormatIndicator 186,PropReasonString
// "\SYN0",PropAuthenticationMethod "0!2\192\182\211u\244e\179\ACK\189\DEL\GS\238Q",PropAuthenticationMethod
// "|oN>G\255R\171\NUL\226\188z9K\134\169\128x\241\128\254\\f\tm0\147\149\229H",PropContentType
// "\207",PropReceiveMaximum 27076,PropUserProperty
// "\164\&0^cq0\187\165\177\225\227\DC3\167\224\164\208R\231\ETB\ESCf\232"
// "\167\201v\204\156\249\SOgAw\175\199\191l^\227T\191H\DC3",PropAuthenticationMethod
// "%v\SOH\255\164\237\154\SI\t\234\150K\235}\132\228n\162\&4\212 ",PropMaximumQoS 92,PropReceiveMaximum
// 17436,PropSubscriptionIdentifierAvailable 73,PropWillDelayInterval 12518,PropWillDelayInterval
// 21753,PropSessionExpiryInterval 13068,PropMessageExpiryInterval 32198,PropWildcardSubscriptionAvailable
// 77,PropPayloadFormatIndicator 49]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0x9e, 0x5,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x25, 0x8,  0xe2, 0x1,  0x2,  0x0,  0x0,  0x33,
      0xa6, 0x15, 0x0,  0x9,  0x5c, 0x78, 0x9,  0xc2, 0x64, 0x1a, 0x5f, 0x9a, 0x44, 0x25, 0x4f, 0x2,  0x0,  0x0,  0x48,
      0x3f, 0x16, 0x0,  0x19, 0x38, 0x56, 0x1e, 0xd,  0xbd, 0x2e, 0xb9, 0xae, 0x83, 0x0,  0xb3, 0x1a, 0x98, 0xa9, 0xae,
      0xeb, 0xaa, 0xa4, 0x0,  0x11, 0xf,  0x53, 0x97, 0x4,  0x9c, 0x15, 0x0,  0x1,  0xa5, 0x17, 0xd5, 0x1,  0xba, 0x1f,
      0x0,  0x2,  0x16, 0x30, 0x15, 0x0,  0x10, 0x30, 0x21, 0x32, 0xc0, 0xb6, 0xd3, 0x75, 0xf4, 0x65, 0xb3, 0x6,  0xbd,
      0x7f, 0x1d, 0xee, 0x51, 0x15, 0x0,  0x1e, 0x7c, 0x6f, 0x4e, 0x3e, 0x47, 0xff, 0x52, 0xab, 0x0,  0xe2, 0xbc, 0x7a,
      0x39, 0x4b, 0x86, 0xa9, 0x80, 0x78, 0xf1, 0x80, 0xfe, 0x5c, 0x66, 0x9,  0x6d, 0x30, 0x93, 0x95, 0xe5, 0x48, 0x3,
      0x0,  0x1,  0xcf, 0x21, 0x69, 0xc4, 0x26, 0x0,  0x16, 0xa4, 0x30, 0x5e, 0x63, 0x71, 0x30, 0xbb, 0xa5, 0xb1, 0xe1,
      0xe3, 0x13, 0xa7, 0xe0, 0xa4, 0xd0, 0x52, 0xe7, 0x17, 0x1b, 0x66, 0xe8, 0x0,  0x14, 0xa7, 0xc9, 0x76, 0xcc, 0x9c,
      0xf9, 0xe,  0x67, 0x41, 0x77, 0xaf, 0xc7, 0xbf, 0x6c, 0x5e, 0xe3, 0x54, 0xbf, 0x48, 0x13, 0x15, 0x0,  0x15, 0x25,
      0x76, 0x1,  0xff, 0xa4, 0xed, 0x9a, 0xf,  0x9,  0xea, 0x96, 0x4b, 0xeb, 0x7d, 0x84, 0xe4, 0x6e, 0xa2, 0x34, 0xd4,
      0x20, 0x24, 0x5c, 0x21, 0x44, 0x1c, 0x29, 0x49, 0x18, 0x0,  0x0,  0x30, 0xe6, 0x18, 0x0,  0x0,  0x54, 0xf9, 0x11,
      0x0,  0x0,  0x33, 0xc,  0x2,  0x0,  0x0,  0x7d, 0xc6, 0x28, 0x4d, 0x1,  0x31, 0x0,  0x1b, 0xdd, 0x47, 0x33, 0x86,
      0x7,  0x64, 0xcd, 0xff, 0xf6, 0x53, 0xa5, 0x9d, 0xd1, 0xf7, 0x14, 0x77, 0xb4, 0x22, 0x54, 0xfd, 0xe3, 0x6b, 0xd2,
      0xb3, 0x9a, 0x28, 0xca, 0xc2, 0x2,  0x18, 0x0,  0x0,  0x73, 0xd7, 0x28, 0x2e, 0x26, 0x0,  0xa,  0xce, 0xa4, 0xd8,
      0xdc, 0x4f, 0x24, 0x88, 0xdc, 0xbd, 0xa6, 0x0,  0x12, 0x34, 0xc,  0xd8, 0x2b, 0x98, 0x28, 0xbe, 0x5c, 0x4a, 0xf9,
      0xc4, 0x9c, 0x2f, 0x96, 0x5f, 0xab, 0x8c, 0x4c, 0x11, 0x0,  0x0,  0x60, 0x2c, 0x19, 0xee, 0x2,  0x0,  0x0,  0x20,
      0x33, 0x13, 0x26, 0x40, 0x11, 0x0,  0x0,  0x54, 0xb3, 0x3,  0x0,  0x17, 0x93, 0x53, 0xbd, 0xc,  0x2b, 0x68, 0x4c,
      0xea, 0x27, 0x48, 0x45, 0x2a, 0xfc, 0xa,  0x4b, 0xcb, 0x2,  0x8c, 0x7c, 0xa2, 0x53, 0xad, 0x9b, 0x1f, 0x0,  0x1c,
      0xe3, 0x95, 0xd8, 0x57, 0xc6, 0xe5, 0x70, 0xe7, 0xd0, 0xfb, 0x64, 0xeb, 0x11, 0x38, 0x24, 0x36, 0xe4, 0xbc, 0x93,
      0x3c, 0x9a, 0xd3, 0x30, 0x82, 0x25, 0x7c, 0x36, 0xa1, 0x9,  0x0,  0x12, 0x98, 0x6a, 0x63, 0xaa, 0x75, 0xf,  0xea,
      0x38, 0x3d, 0x8f, 0x2d, 0x22, 0x14, 0xc0, 0xde, 0x10, 0x2e, 0x49, 0x24, 0x46, 0x29, 0xa9, 0x16, 0x0,  0x1d, 0x28,
      0xbd, 0xe,  0x1e, 0x5a, 0x6b, 0xea, 0x11, 0xd5, 0x8b, 0x12, 0xd4, 0xf2, 0x43, 0xcd, 0x70, 0xd,  0x5d, 0x7e, 0x6c,
      0xfc, 0x1b, 0x33, 0xb9, 0x2c, 0x6d, 0x1,  0xa0, 0xa2, 0x3,  0x0,  0x5,  0xc,  0xfb, 0x55, 0x68, 0xc7, 0x16, 0x0,
      0x13, 0x3d, 0xf3, 0x8,  0x14, 0xd,  0x92, 0x4c, 0xe9, 0x3a, 0x57, 0xa0, 0x7d, 0xaf, 0xcc, 0xfb, 0x1,  0x23, 0xc2,
      0xdf, 0x11, 0x0,  0x0,  0x7b, 0xfd, 0x1a, 0x0,  0x4,  0x90, 0x77, 0xe3, 0xeb, 0x1f, 0x0,  0x11, 0xeb, 0x44, 0xd,
      0xd6, 0xc,  0xef, 0x1f, 0x4,  0x17, 0xd4, 0x6,  0xff, 0x2b, 0x94, 0x96, 0xad, 0x4,  0x2,  0x0,  0x0,  0xc,  0xe9,
      0x1,  0x9e, 0x2,  0x0,  0x0,  0x5e, 0x74, 0x19, 0xba, 0x1a, 0x0,  0x0,  0x1a, 0x0,  0x3,  0x13, 0x75, 0x1a, 0x27,
      0x0,  0x0,  0x11, 0xde, 0x13, 0x37, 0x4e, 0x17, 0x68, 0x26, 0x0,  0x14, 0x62, 0xa7, 0xef, 0x89, 0x2d, 0xb1, 0x31,
      0x9c, 0x24, 0x4b, 0x92, 0xfc, 0x2c, 0xa2, 0x40, 0xbe, 0x46, 0xe9, 0xd2, 0xbd, 0x0,  0x1c, 0x1d, 0x84, 0xd0, 0x71,
      0xf0, 0xd0, 0xff, 0xbc, 0x9b, 0x32, 0xf2, 0xf,  0xd6, 0x81, 0x8,  0x2,  0xf0, 0x2f, 0x31, 0x25, 0xb6, 0x6d, 0x4,
      0x68, 0xc8, 0x40, 0xbd, 0x98, 0x0,  0x14, 0xc7, 0x96, 0x21, 0xf,  0x30, 0x66, 0x34, 0x71, 0xc1, 0xcd, 0x8a, 0xf0,
      0xac, 0x21, 0xe,  0x2f, 0x56, 0x83, 0xe6, 0xa0, 0x0,  0x12, 0x1,  0x76, 0x17, 0x2e, 0x4f, 0xdd, 0x7f, 0xf3, 0x24,
      0x16, 0xba, 0x9c, 0x67, 0xd,  0xda, 0x2a, 0xde, 0x63, 0x0,  0x3,  0x2d, 0x2f, 0xa,  0x0,  0x1e, 0x11, 0xf8, 0x2c,
      0x9e, 0xd9, 0xc9, 0x61, 0x3b, 0x41, 0x79, 0x74, 0xdf, 0x75, 0x38, 0x11, 0xca, 0xeb, 0x7a, 0x3b, 0x84, 0x45, 0x34,
      0x7a, 0x87, 0x7e, 0x62, 0xd0, 0xaf, 0x7d, 0xe4};

  uint8_t buf[683] = {0};

  uint8_t bytesprops0[] = {0x5c, 0x78, 0x9, 0xc2, 0x64, 0x1a, 0x5f, 0x9a, 0x44};
  uint8_t bytesprops1[] = {0x38, 0x56, 0x1e, 0xd,  0xbd, 0x2e, 0xb9, 0xae, 0x83, 0x0,  0xb3, 0x1a, 0x98,
                           0xa9, 0xae, 0xeb, 0xaa, 0xa4, 0x0,  0x11, 0xf,  0x53, 0x97, 0x4,  0x9c};
  uint8_t bytesprops2[] = {0xa5};
  uint8_t bytesprops3[] = {0x16, 0x30};
  uint8_t bytesprops4[] = {0x30, 0x21, 0x32, 0xc0, 0xb6, 0xd3, 0x75, 0xf4,
                           0x65, 0xb3, 0x6,  0xbd, 0x7f, 0x1d, 0xee, 0x51};
  uint8_t bytesprops5[] = {0x7c, 0x6f, 0x4e, 0x3e, 0x47, 0xff, 0x52, 0xab, 0x0, 0xe2, 0xbc, 0x7a, 0x39, 0x4b, 0x86,
                           0xa9, 0x80, 0x78, 0xf1, 0x80, 0xfe, 0x5c, 0x66, 0x9, 0x6d, 0x30, 0x93, 0x95, 0xe5, 0x48};
  uint8_t bytesprops6[] = {0xcf};
  uint8_t bytesprops8[] = {0xa7, 0xc9, 0x76, 0xcc, 0x9c, 0xf9, 0xe,  0x67, 0x41, 0x77,
                           0xaf, 0xc7, 0xbf, 0x6c, 0x5e, 0xe3, 0x54, 0xbf, 0x48, 0x13};
  uint8_t bytesprops7[] = {0xa4, 0x30, 0x5e, 0x63, 0x71, 0x30, 0xbb, 0xa5, 0xb1, 0xe1, 0xe3,
                           0x13, 0xa7, 0xe0, 0xa4, 0xd0, 0x52, 0xe7, 0x17, 0x1b, 0x66, 0xe8};
  uint8_t bytesprops9[] = {0x25, 0x76, 0x1,  0xff, 0xa4, 0xed, 0x9a, 0xf,  0x9,  0xea, 0x96,
                           0x4b, 0xeb, 0x7d, 0x84, 0xe4, 0x6e, 0xa2, 0x34, 0xd4, 0x20};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13222}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18495}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27076}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops7}, .v = {20, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17436}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12518}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21753}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13068}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32198}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 49}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x34, 0xc,  0xd8, 0x2b, 0x98, 0x28, 0xbe, 0x5c, 0x4a,
                               0xf9, 0xc4, 0x9c, 0x2f, 0x96, 0x5f, 0xab, 0x8c, 0x4c};
  uint8_t byteswillprops0[] = {0xce, 0xa4, 0xd8, 0xdc, 0x4f, 0x24, 0x88, 0xdc, 0xbd, 0xa6};
  uint8_t byteswillprops2[] = {0x93, 0x53, 0xbd, 0xc,  0x2b, 0x68, 0x4c, 0xea, 0x27, 0x48, 0x45, 0x2a,
                               0xfc, 0xa,  0x4b, 0xcb, 0x2,  0x8c, 0x7c, 0xa2, 0x53, 0xad, 0x9b};
  uint8_t byteswillprops3[] = {0xe3, 0x95, 0xd8, 0x57, 0xc6, 0xe5, 0x70, 0xe7, 0xd0, 0xfb, 0x64, 0xeb, 0x11, 0x38,
                               0x24, 0x36, 0xe4, 0xbc, 0x93, 0x3c, 0x9a, 0xd3, 0x30, 0x82, 0x25, 0x7c, 0x36, 0xa1};
  uint8_t byteswillprops4[] = {0x98, 0x6a, 0x63, 0xaa, 0x75, 0xf,  0xea, 0x38, 0x3d,
                               0x8f, 0x2d, 0x22, 0x14, 0xc0, 0xde, 0x10, 0x2e, 0x49};
  uint8_t byteswillprops5[] = {0x28, 0xbd, 0xe,  0x1e, 0x5a, 0x6b, 0xea, 0x11, 0xd5, 0x8b, 0x12, 0xd4, 0xf2, 0x43, 0xcd,
                               0x70, 0xd,  0x5d, 0x7e, 0x6c, 0xfc, 0x1b, 0x33, 0xb9, 0x2c, 0x6d, 0x1,  0xa0, 0xa2};
  uint8_t byteswillprops6[] = {0xc, 0xfb, 0x55, 0x68, 0xc7};
  uint8_t byteswillprops7[] = {0x3d, 0xf3, 0x8,  0x14, 0xd,  0x92, 0x4c, 0xe9, 0x3a, 0x57,
                               0xa0, 0x7d, 0xaf, 0xcc, 0xfb, 0x1,  0x23, 0xc2, 0xdf};
  uint8_t byteswillprops8[] = {0x90, 0x77, 0xe3, 0xeb};
  uint8_t byteswillprops9[] = {0xeb, 0x44, 0xd,  0xd6, 0xc,  0xef, 0x1f, 0x4, 0x17,
                               0xd4, 0x6,  0xff, 0x2b, 0x94, 0x96, 0xad, 0x4};
  uint8_t byteswillprops10[] = {0};
  uint8_t byteswillprops11[] = {0x13, 0x75, 0x1a};
  uint8_t byteswillprops13[] = {0x1d, 0x84, 0xd0, 0x71, 0xf0, 0xd0, 0xff, 0xbc, 0x9b, 0x32, 0xf2, 0xf,  0xd6, 0x81,
                                0x8,  0x2,  0xf0, 0x2f, 0x31, 0x25, 0xb6, 0x6d, 0x4,  0x68, 0xc8, 0x40, 0xbd, 0x98};
  uint8_t byteswillprops12[] = {0x62, 0xa7, 0xef, 0x89, 0x2d, 0xb1, 0x31, 0x9c, 0x24, 0x4b,
                                0x92, 0xfc, 0x2c, 0xa2, 0x40, 0xbe, 0x46, 0xe9, 0xd2, 0xbd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29655}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {10, (char*)&byteswillprops0}, .v = {18, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24620}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8243}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9792}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21683}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31741}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3305}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24180}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4574}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14158}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {20, (char*)&byteswillprops12}, .v = {28, (char*)&byteswillprops13}}}},
  };

  lwmqtt_properties_t willprops = {29, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc7, 0x96, 0x21, 0xf,  0x30, 0x66, 0x34, 0x71, 0xc1, 0xcd,
                                0x8a, 0xf0, 0xac, 0x21, 0xe,  0x2f, 0x56, 0x83, 0xe6, 0xa0};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1,  0x76, 0x17, 0x2e, 0x4f, 0xdd, 0x7f, 0xf3, 0x24,
                                  0x16, 0xba, 0x9c, 0x67, 0xd,  0xda, 0x2a, 0xde, 0x63};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9480;
  uint8_t client_id_bytes[] = {0xdd, 0x47, 0x33, 0x86, 0x7,  0x64, 0xcd, 0xff, 0xf6, 0x53, 0xa5, 0x9d, 0xd1, 0xf7,
                               0x14, 0x77, 0xb4, 0x22, 0x54, 0xfd, 0xe3, 0x6b, 0xd2, 0xb3, 0x9a, 0x28, 0xca};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2d, 0x2f, 0xa};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x11, 0xf8, 0x2c, 0x9e, 0xd9, 0xc9, 0x61, 0x3b, 0x41, 0x79, 0x74, 0xdf, 0x75, 0x38, 0x11,
                              0xca, 0xeb, 0x7a, 0x3b, 0x84, 0x45, 0x34, 0x7a, 0x87, 0x7e, 0x62, 0xd0, 0xaf, 0x7d, 0xe4};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\192\131", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 25448, _connID = "\131\216\FS}\NAKIn$\DC37\186M\161\151kP\148\142|\224Q\234\249\223\172hF\168",
// _properties = [PropAuthenticationMethod
// "v\166\197\235u\245\160t\\\141]\133g\242\246\183\148\198\DC1:\155\164\GS",PropServerKeepAlive 14593,PropMaximumQoS
// 166,PropMessageExpiryInterval 2517,PropAssignedClientIdentifier
// "\248\DLEQ\154\151\146\234Z\172\204\242\148\&1L\213\234\202\147\n\SO`|`",PropRequestProblemInformation
// 97,PropMaximumPacketSize 27560,PropMessageExpiryInterval 14874,PropMessageExpiryInterval
// 230,PropRequestProblemInformation 214,PropWillDelayInterval 2090,PropAssignedClientIdentifier
// "\EM\207\\<\152\NAKG3$Wa\249",PropMaximumQoS 210]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x90, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x63, 0x68, 0x67, 0x15, 0x0,  0x17,
                   0x76, 0xa6, 0xc5, 0xeb, 0x75, 0xf5, 0xa0, 0x74, 0x5c, 0x8d, 0x5d, 0x85, 0x67, 0xf2, 0xf6, 0xb7, 0x94,
                   0xc6, 0x11, 0x3a, 0x9b, 0xa4, 0x1d, 0x13, 0x39, 0x1,  0x24, 0xa6, 0x2,  0x0,  0x0,  0x9,  0xd5, 0x12,
                   0x0,  0x17, 0xf8, 0x10, 0x51, 0x9a, 0x97, 0x92, 0xea, 0x5a, 0xac, 0xcc, 0xf2, 0x94, 0x31, 0x4c, 0xd5,
                   0xea, 0xca, 0x93, 0xa,  0xe,  0x60, 0x7c, 0x60, 0x17, 0x61, 0x27, 0x0,  0x0,  0x6b, 0xa8, 0x2,  0x0,
                   0x0,  0x3a, 0x1a, 0x2,  0x0,  0x0,  0x0,  0xe6, 0x17, 0xd6, 0x18, 0x0,  0x0,  0x8,  0x2a, 0x12, 0x0,
                   0xc,  0x19, 0xcf, 0x5c, 0x3c, 0x98, 0x15, 0x47, 0x33, 0x24, 0x57, 0x61, 0xf9, 0x24, 0xd2, 0x0,  0x1c,
                   0x83, 0xd8, 0x1c, 0x7d, 0x15, 0x49, 0x6e, 0x24, 0x13, 0x37, 0xba, 0x4d, 0xa1, 0x97, 0x6b, 0x50, 0x94,
                   0x8e, 0x7c, 0xe0, 0x51, 0xea, 0xf9, 0xdf, 0xac, 0x68, 0x46, 0xa8};

  uint8_t buf[157] = {0};

  uint8_t bytesprops0[] = {0x76, 0xa6, 0xc5, 0xeb, 0x75, 0xf5, 0xa0, 0x74, 0x5c, 0x8d, 0x5d, 0x85,
                           0x67, 0xf2, 0xf6, 0xb7, 0x94, 0xc6, 0x11, 0x3a, 0x9b, 0xa4, 0x1d};
  uint8_t bytesprops1[] = {0xf8, 0x10, 0x51, 0x9a, 0x97, 0x92, 0xea, 0x5a, 0xac, 0xcc, 0xf2, 0x94,
                           0x31, 0x4c, 0xd5, 0xea, 0xca, 0x93, 0xa,  0xe,  0x60, 0x7c, 0x60};
  uint8_t bytesprops2[] = {0x19, 0xcf, 0x5c, 0x3c, 0x98, 0x15, 0x47, 0x33, 0x24, 0x57, 0x61, 0xf9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14593}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2517}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27560}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14874}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 230}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2090}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 210}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25448;
  uint8_t client_id_bytes[] = {0x83, 0xd8, 0x1c, 0x7d, 0x15, 0x49, 0x6e, 0x24, 0x13, 0x37, 0xba, 0x4d, 0xa1, 0x97,
                               0x6b, 0x50, 0x94, 0x8e, 0x7c, 0xe0, 0x51, 0xea, 0xf9, 0xdf, 0xac, 0x68, 0x46, 0xa8};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc0, 0x83};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\168\156M\204\209\177\255\141Bh\181\255\ACK4\218\ACKG\184\227\213\203", _password =
// Just "\GS\180\153*L\206\143\205", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "`\ACK\139\b", _willMsg = "\156E)Ei\136\NAK\137\140x\237K\166\154", _willProps = [PropPayloadFormatIndicator
// 173,PropPayloadFormatIndicator 200,PropMaximumPacketSize 3870,PropRetainAvailable 100,PropResponseTopic
// "O\191\160\201\166\235\204",PropRetainAvailable 168,PropMessageExpiryInterval 26217]}), _cleanSession = True,
// _keepAlive = 12280, _connID = "_\f\142\129\132{J\221 Xo", _properties = [PropMessageExpiryInterval
// 29411,PropResponseInformation "\247\147\216a\133",PropUserProperty
// "\145\193!\159\173\170o'\155\187{\144\191\ETB\187$)\145"
// "8\140\222\140J\190\&1z\218w\145\&8\225\159\201\236\227\230",PropRetainAvailable 134,PropReceiveMaximum
// 15749,PropSubscriptionIdentifier 1,PropSubscriptionIdentifierAvailable 176,PropMaximumPacketSize
// 16367,PropServerKeepAlive 7145,PropPayloadFormatIndicator 16,PropMaximumQoS 164,PropSubscriptionIdentifierAvailable
// 218,PropTopicAliasMaximum 2297,PropMessageExpiryInterval 16013,PropTopicAliasMaximum 19029,PropResponseTopic
// "\229\ACK $\132\183\211_y\202\184)\137\253\131\v\a\216\206\b\181\DC1\197\236~",PropRequestProblemInformation
// 174,PropContentType "\192\180\DLE\DEL=\DLE\148\221\CAN\RS\CAN_\158",PropAssignedClientIdentifier
// "\219\180\143",PropTopicAlias 7933,PropServerKeepAlive 21408,PropWillDelayInterval
// 29037,PropRequestResponseInformation 77,PropMessageExpiryInterval 14660,PropUserProperty
// "\199z\a\150I\189\132[\195s\136\178" "R\180v\130{)y\223+\203y\225\225}",PropAssignedClientIdentifier
// "\174zu\174M\137\228\191\167\205Z\166\136\a\240?\152\194\182D\170\&4\146\&53A{\151\239 ",PropResponseInformation
// "\226\193"]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x10, 0xd0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x2f, 0xf8, 0xe3, 0x1,  0x2,  0x0,  0x0,  0x72,
      0xe3, 0x1a, 0x0,  0x5,  0xf7, 0x93, 0xd8, 0x61, 0x85, 0x26, 0x0,  0x12, 0x91, 0xc1, 0x21, 0x9f, 0xad, 0xaa, 0x6f,
      0x27, 0x9b, 0xbb, 0x7b, 0x90, 0xbf, 0x17, 0xbb, 0x24, 0x29, 0x91, 0x0,  0x12, 0x38, 0x8c, 0xde, 0x8c, 0x4a, 0xbe,
      0x31, 0x7a, 0xda, 0x77, 0x91, 0x38, 0xe1, 0x9f, 0xc9, 0xec, 0xe3, 0xe6, 0x25, 0x86, 0x21, 0x3d, 0x85, 0xb,  0x1,
      0x29, 0xb0, 0x27, 0x0,  0x0,  0x3f, 0xef, 0x13, 0x1b, 0xe9, 0x1,  0x10, 0x24, 0xa4, 0x29, 0xda, 0x22, 0x8,  0xf9,
      0x2,  0x0,  0x0,  0x3e, 0x8d, 0x22, 0x4a, 0x55, 0x8,  0x0,  0x19, 0xe5, 0x6,  0x20, 0x24, 0x84, 0xb7, 0xd3, 0x5f,
      0x79, 0xca, 0xb8, 0x29, 0x89, 0xfd, 0x83, 0xb,  0x7,  0xd8, 0xce, 0x8,  0xb5, 0x11, 0xc5, 0xec, 0x7e, 0x17, 0xae,
      0x3,  0x0,  0xd,  0xc0, 0xb4, 0x10, 0x7f, 0x3d, 0x10, 0x94, 0xdd, 0x18, 0x1e, 0x18, 0x5f, 0x9e, 0x12, 0x0,  0x3,
      0xdb, 0xb4, 0x8f, 0x23, 0x1e, 0xfd, 0x13, 0x53, 0xa0, 0x18, 0x0,  0x0,  0x71, 0x6d, 0x19, 0x4d, 0x2,  0x0,  0x0,
      0x39, 0x44, 0x26, 0x0,  0xc,  0xc7, 0x7a, 0x7,  0x96, 0x49, 0xbd, 0x84, 0x5b, 0xc3, 0x73, 0x88, 0xb2, 0x0,  0xe,
      0x52, 0xb4, 0x76, 0x82, 0x7b, 0x29, 0x79, 0xdf, 0x2b, 0xcb, 0x79, 0xe1, 0xe1, 0x7d, 0x12, 0x0,  0x1e, 0xae, 0x7a,
      0x75, 0xae, 0x4d, 0x89, 0xe4, 0xbf, 0xa7, 0xcd, 0x5a, 0xa6, 0x88, 0x7,  0xf0, 0x3f, 0x98, 0xc2, 0xb6, 0x44, 0xaa,
      0x34, 0x92, 0x35, 0x33, 0x41, 0x7b, 0x97, 0xef, 0x20, 0x1a, 0x0,  0x2,  0xe2, 0xc1, 0x0,  0xb,  0x5f, 0xc,  0x8e,
      0x81, 0x84, 0x7b, 0x4a, 0xdd, 0x20, 0x58, 0x6f, 0x1c, 0x1,  0xad, 0x1,  0xc8, 0x27, 0x0,  0x0,  0xf,  0x1e, 0x25,
      0x64, 0x8,  0x0,  0x7,  0x4f, 0xbf, 0xa0, 0xc9, 0xa6, 0xeb, 0xcc, 0x25, 0xa8, 0x2,  0x0,  0x0,  0x66, 0x69, 0x0,
      0x4,  0x60, 0x6,  0x8b, 0x8,  0x0,  0xe,  0x9c, 0x45, 0x29, 0x45, 0x69, 0x88, 0x15, 0x89, 0x8c, 0x78, 0xed, 0x4b,
      0xa6, 0x9a, 0x0,  0x15, 0xa8, 0x9c, 0x4d, 0xcc, 0xd1, 0xb1, 0xff, 0x8d, 0x42, 0x68, 0xb5, 0xff, 0x6,  0x34, 0xda,
      0x6,  0x47, 0xb8, 0xe3, 0xd5, 0xcb, 0x0,  0x8,  0x1d, 0xb4, 0x99, 0x2a, 0x4c, 0xce, 0x8f, 0xcd};

  uint8_t buf[349] = {0};

  uint8_t bytesprops0[] = {0xf7, 0x93, 0xd8, 0x61, 0x85};
  uint8_t bytesprops2[] = {0x38, 0x8c, 0xde, 0x8c, 0x4a, 0xbe, 0x31, 0x7a, 0xda,
                           0x77, 0x91, 0x38, 0xe1, 0x9f, 0xc9, 0xec, 0xe3, 0xe6};
  uint8_t bytesprops1[] = {0x91, 0xc1, 0x21, 0x9f, 0xad, 0xaa, 0x6f, 0x27, 0x9b,
                           0xbb, 0x7b, 0x90, 0xbf, 0x17, 0xbb, 0x24, 0x29, 0x91};
  uint8_t bytesprops3[] = {0xe5, 0x6,  0x20, 0x24, 0x84, 0xb7, 0xd3, 0x5f, 0x79, 0xca, 0xb8, 0x29, 0x89,
                           0xfd, 0x83, 0xb,  0x7,  0xd8, 0xce, 0x8,  0xb5, 0x11, 0xc5, 0xec, 0x7e};
  uint8_t bytesprops4[] = {0xc0, 0xb4, 0x10, 0x7f, 0x3d, 0x10, 0x94, 0xdd, 0x18, 0x1e, 0x18, 0x5f, 0x9e};
  uint8_t bytesprops5[] = {0xdb, 0xb4, 0x8f};
  uint8_t bytesprops7[] = {0x52, 0xb4, 0x76, 0x82, 0x7b, 0x29, 0x79, 0xdf, 0x2b, 0xcb, 0x79, 0xe1, 0xe1, 0x7d};
  uint8_t bytesprops6[] = {0xc7, 0x7a, 0x7, 0x96, 0x49, 0xbd, 0x84, 0x5b, 0xc3, 0x73, 0x88, 0xb2};
  uint8_t bytesprops8[] = {0xae, 0x7a, 0x75, 0xae, 0x4d, 0x89, 0xe4, 0xbf, 0xa7, 0xcd, 0x5a, 0xa6, 0x88, 0x7,  0xf0,
                           0x3f, 0x98, 0xc2, 0xb6, 0x44, 0xaa, 0x34, 0x92, 0x35, 0x33, 0x41, 0x7b, 0x97, 0xef, 0x20};
  uint8_t bytesprops9[] = {0xe2, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29411}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15749}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16367}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7145}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2297}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16013}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19029}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7933}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21408}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29037}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14660}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops6}, .v = {14, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x4f, 0xbf, 0xa0, 0xc9, 0xa6, 0xeb, 0xcc};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3870}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26217}},
  };

  lwmqtt_properties_t willprops = {7, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x60, 0x6, 0x8b, 0x8};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x9c, 0x45, 0x29, 0x45, 0x69, 0x88, 0x15, 0x89, 0x8c, 0x78, 0xed, 0x4b, 0xa6, 0x9a};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12280;
  uint8_t client_id_bytes[] = {0x5f, 0xc, 0x8e, 0x81, 0x84, 0x7b, 0x4a, 0xdd, 0x20, 0x58, 0x6f};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa8, 0x9c, 0x4d, 0xcc, 0xd1, 0xb1, 0xff, 0x8d, 0x42, 0x68, 0xb5,
                              0xff, 0x6,  0x34, 0xda, 0x6,  0x47, 0xb8, 0xe3, 0xd5, 0xcb};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1d, 0xb4, 0x99, 0x2a, 0x4c, 0xce, 0x8f, 0xcd};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "2\161\185\SYNP2z\ACK0l\186\203\155R\148\SUBXt\251\SI",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "V\140x\158\250\EOT>\241\241\148\199U",
// _willMsg = "\164[\137g\135\241I\233\146\232\214\165\163\235E\163v0\138#\DC3T4", _willProps =
// [PropWildcardSubscriptionAvailable 71,PropTopicAlias 18041,PropAuthenticationMethod
// "\212\181\&7\180\DLE\181\r\v3\CAN[\ENQP\210/\207I\221",PropPayloadFormatIndicator 198,PropMessageExpiryInterval
// 21952,PropRetainAvailable 197,PropSubscriptionIdentifier 29,PropSharedSubscriptionAvailable 82,PropContentType
// "Y\157.\140D\184\133\166\217\214\186`\168\b=\196T",PropReasonString
// "\SYN\EOT\DC1v\189\245\&00Vl\b\145\&6\200\ENQ\228N\155\204\147",PropResponseInformation
// "\224a\143U\206\193\159x\164\b\227\207\SUB\183\193I\183",PropTopicAlias 23073,PropServerKeepAlive
// 17368,PropServerReference "\161\196\235\243a}\172\239M\157y\225z",PropRequestProblemInformation
// 210,PropRequestProblemInformation 50,PropSharedSubscriptionAvailable 108,PropServerKeepAlive
// 21906,PropSubscriptionIdentifier 17]}), _cleanSession = True, _keepAlive = 18446, _connID =
// "\223\DC1\215tI\188[\152", _properties = [PropReasonString
// "\154\149x\231\fWY\160\156\184\140\168\DLE=\128\169\186]1\179",PropSubscriptionIdentifier 1,PropUserProperty
// "S\226\&8\228\&8b5\244\CAN0v\EM\211\t\186\t\132\t\202\DC3^\182\FS\183"
// "\229\159l\240\DLEq8\239\228\254\204\184\SOH\141(\200\170/\\\144\184\ACK\155\146w+\203\179\ENQ\r",PropWillDelayInterval
// 12947,PropUserProperty "#\RSY\240\180\159\238\250PH\155$\234\DC2\158'\ENQ\169f\SO6Gt\214\175r\184"
// "",PropReasonString "x\STX\133n\224\247\138\249t\153\SYN",PropSubscriptionIdentifierAvailable 127,PropUserProperty
// "5\RS\244\224\172\USp\ETX\141(\v\162\146 \ACK\232Ix\152\197\202\171"
// "Jm\143\143r\209\188\183\DLE\198\187}\158\DC4\155f\162\fL\EOT\144\212\221\237\218g",PropResponseTopic
// "\SYNa\168R\188\SUB3\DC1\ACK4\177\156\182\223\243\250\DC1",PropWildcardSubscriptionAvailable
// 38,PropPayloadFormatIndicator 30,PropServerKeepAlive 29748,PropSubscriptionIdentifierAvailable 226,PropUserProperty
// "&\237\191\199\197\&8\177\ACK_\186\ESCa\149\211\134\178^(@K("
// "\238C\NAK`#\ESCQj\163s\157\213Z7\NUL\RS\DC1\246\208\ESC\ETX\EM\SYN\200\128\SYN\169\a",PropReceiveMaximum
// 2976,PropReasonString "EWM\253p\225=\196\148.\237\ACK\DC3",PropWildcardSubscriptionAvailable 153]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0xec, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x26, 0x48, 0xe,  0xa6, 0x2,  0x1f, 0x0,  0x14, 0x9a,
      0x95, 0x78, 0xe7, 0xc,  0x57, 0x59, 0xa0, 0x9c, 0xb8, 0x8c, 0xa8, 0x10, 0x3d, 0x80, 0xa9, 0xba, 0x5d, 0x31, 0xb3,
      0xb,  0x1,  0x26, 0x0,  0x18, 0x53, 0xe2, 0x38, 0xe4, 0x38, 0x62, 0x35, 0xf4, 0x18, 0x30, 0x76, 0x19, 0xd3, 0x9,
      0xba, 0x9,  0x84, 0x9,  0xca, 0x13, 0x5e, 0xb6, 0x1c, 0xb7, 0x0,  0x1e, 0xe5, 0x9f, 0x6c, 0xf0, 0x10, 0x71, 0x38,
      0xef, 0xe4, 0xfe, 0xcc, 0xb8, 0x1,  0x8d, 0x28, 0xc8, 0xaa, 0x2f, 0x5c, 0x90, 0xb8, 0x6,  0x9b, 0x92, 0x77, 0x2b,
      0xcb, 0xb3, 0x5,  0xd,  0x18, 0x0,  0x0,  0x32, 0x93, 0x26, 0x0,  0x1b, 0x23, 0x1e, 0x59, 0xf0, 0xb4, 0x9f, 0xee,
      0xfa, 0x50, 0x48, 0x9b, 0x24, 0xea, 0x12, 0x9e, 0x27, 0x5,  0xa9, 0x66, 0xe,  0x36, 0x47, 0x74, 0xd6, 0xaf, 0x72,
      0xb8, 0x0,  0x0,  0x1f, 0x0,  0xb,  0x78, 0x2,  0x85, 0x6e, 0xe0, 0xf7, 0x8a, 0xf9, 0x74, 0x99, 0x16, 0x29, 0x7f,
      0x26, 0x0,  0x16, 0x35, 0x1e, 0xf4, 0xe0, 0xac, 0x1f, 0x70, 0x3,  0x8d, 0x28, 0xb,  0xa2, 0x92, 0x20, 0x6,  0xe8,
      0x49, 0x78, 0x98, 0xc5, 0xca, 0xab, 0x0,  0x1a, 0x4a, 0x6d, 0x8f, 0x8f, 0x72, 0xd1, 0xbc, 0xb7, 0x10, 0xc6, 0xbb,
      0x7d, 0x9e, 0x14, 0x9b, 0x66, 0xa2, 0xc,  0x4c, 0x4,  0x90, 0xd4, 0xdd, 0xed, 0xda, 0x67, 0x8,  0x0,  0x11, 0x16,
      0x61, 0xa8, 0x52, 0xbc, 0x1a, 0x33, 0x11, 0x6,  0x34, 0xb1, 0x9c, 0xb6, 0xdf, 0xf3, 0xfa, 0x11, 0x28, 0x26, 0x1,
      0x1e, 0x13, 0x74, 0x34, 0x29, 0xe2, 0x26, 0x0,  0x15, 0x26, 0xed, 0xbf, 0xc7, 0xc5, 0x38, 0xb1, 0x6,  0x5f, 0xba,
      0x1b, 0x61, 0x95, 0xd3, 0x86, 0xb2, 0x5e, 0x28, 0x40, 0x4b, 0x28, 0x0,  0x1c, 0xee, 0x43, 0x15, 0x60, 0x23, 0x1b,
      0x51, 0x6a, 0xa3, 0x73, 0x9d, 0xd5, 0x5a, 0x37, 0x0,  0x1e, 0x11, 0xf6, 0xd0, 0x1b, 0x3,  0x19, 0x16, 0xc8, 0x80,
      0x16, 0xa9, 0x7,  0x21, 0xb,  0xa0, 0x1f, 0x0,  0xd,  0x45, 0x57, 0x4d, 0xfd, 0x70, 0xe1, 0x3d, 0xc4, 0x94, 0x2e,
      0xed, 0x6,  0x13, 0x28, 0x99, 0x0,  0x8,  0xdf, 0x11, 0xd7, 0x74, 0x49, 0xbc, 0x5b, 0x98, 0x87, 0x1,  0x28, 0x47,
      0x23, 0x46, 0x79, 0x15, 0x0,  0x12, 0xd4, 0xb5, 0x37, 0xb4, 0x10, 0xb5, 0xd,  0xb,  0x33, 0x18, 0x5b, 0x5,  0x50,
      0xd2, 0x2f, 0xcf, 0x49, 0xdd, 0x1,  0xc6, 0x2,  0x0,  0x0,  0x55, 0xc0, 0x25, 0xc5, 0xb,  0x1d, 0x2a, 0x52, 0x3,
      0x0,  0x11, 0x59, 0x9d, 0x2e, 0x8c, 0x44, 0xb8, 0x85, 0xa6, 0xd9, 0xd6, 0xba, 0x60, 0xa8, 0x8,  0x3d, 0xc4, 0x54,
      0x1f, 0x0,  0x14, 0x16, 0x4,  0x11, 0x76, 0xbd, 0xf5, 0x30, 0x30, 0x56, 0x6c, 0x8,  0x91, 0x36, 0xc8, 0x5,  0xe4,
      0x4e, 0x9b, 0xcc, 0x93, 0x1a, 0x0,  0x11, 0xe0, 0x61, 0x8f, 0x55, 0xce, 0xc1, 0x9f, 0x78, 0xa4, 0x8,  0xe3, 0xcf,
      0x1a, 0xb7, 0xc1, 0x49, 0xb7, 0x23, 0x5a, 0x21, 0x13, 0x43, 0xd8, 0x1c, 0x0,  0xd,  0xa1, 0xc4, 0xeb, 0xf3, 0x61,
      0x7d, 0xac, 0xef, 0x4d, 0x9d, 0x79, 0xe1, 0x7a, 0x17, 0xd2, 0x17, 0x32, 0x2a, 0x6c, 0x13, 0x55, 0x92, 0xb,  0x11,
      0x0,  0xc,  0x56, 0x8c, 0x78, 0x9e, 0xfa, 0x4,  0x3e, 0xf1, 0xf1, 0x94, 0xc7, 0x55, 0x0,  0x17, 0xa4, 0x5b, 0x89,
      0x67, 0x87, 0xf1, 0x49, 0xe9, 0x92, 0xe8, 0xd6, 0xa5, 0xa3, 0xeb, 0x45, 0xa3, 0x76, 0x30, 0x8a, 0x23, 0x13, 0x54,
      0x34};

  uint8_t buf[505] = {0};

  uint8_t bytesprops0[] = {0x9a, 0x95, 0x78, 0xe7, 0xc,  0x57, 0x59, 0xa0, 0x9c, 0xb8,
                           0x8c, 0xa8, 0x10, 0x3d, 0x80, 0xa9, 0xba, 0x5d, 0x31, 0xb3};
  uint8_t bytesprops2[] = {0xe5, 0x9f, 0x6c, 0xf0, 0x10, 0x71, 0x38, 0xef, 0xe4, 0xfe, 0xcc, 0xb8, 0x1,  0x8d, 0x28,
                           0xc8, 0xaa, 0x2f, 0x5c, 0x90, 0xb8, 0x6,  0x9b, 0x92, 0x77, 0x2b, 0xcb, 0xb3, 0x5,  0xd};
  uint8_t bytesprops1[] = {0x53, 0xe2, 0x38, 0xe4, 0x38, 0x62, 0x35, 0xf4, 0x18, 0x30, 0x76, 0x19,
                           0xd3, 0x9,  0xba, 0x9,  0x84, 0x9,  0xca, 0x13, 0x5e, 0xb6, 0x1c, 0xb7};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops3[] = {0x23, 0x1e, 0x59, 0xf0, 0xb4, 0x9f, 0xee, 0xfa, 0x50, 0x48, 0x9b, 0x24, 0xea, 0x12,
                           0x9e, 0x27, 0x5,  0xa9, 0x66, 0xe,  0x36, 0x47, 0x74, 0xd6, 0xaf, 0x72, 0xb8};
  uint8_t bytesprops5[] = {0x78, 0x2, 0x85, 0x6e, 0xe0, 0xf7, 0x8a, 0xf9, 0x74, 0x99, 0x16};
  uint8_t bytesprops7[] = {0x4a, 0x6d, 0x8f, 0x8f, 0x72, 0xd1, 0xbc, 0xb7, 0x10, 0xc6, 0xbb, 0x7d, 0x9e,
                           0x14, 0x9b, 0x66, 0xa2, 0xc,  0x4c, 0x4,  0x90, 0xd4, 0xdd, 0xed, 0xda, 0x67};
  uint8_t bytesprops6[] = {0x35, 0x1e, 0xf4, 0xe0, 0xac, 0x1f, 0x70, 0x3,  0x8d, 0x28, 0xb,
                           0xa2, 0x92, 0x20, 0x6,  0xe8, 0x49, 0x78, 0x98, 0xc5, 0xca, 0xab};
  uint8_t bytesprops8[] = {0x16, 0x61, 0xa8, 0x52, 0xbc, 0x1a, 0x33, 0x11, 0x6,
                           0x34, 0xb1, 0x9c, 0xb6, 0xdf, 0xf3, 0xfa, 0x11};
  uint8_t bytesprops10[] = {0xee, 0x43, 0x15, 0x60, 0x23, 0x1b, 0x51, 0x6a, 0xa3, 0x73, 0x9d, 0xd5, 0x5a, 0x37,
                            0x0,  0x1e, 0x11, 0xf6, 0xd0, 0x1b, 0x3,  0x19, 0x16, 0xc8, 0x80, 0x16, 0xa9, 0x7};
  uint8_t bytesprops9[] = {0x26, 0xed, 0xbf, 0xc7, 0xc5, 0x38, 0xb1, 0x6,  0x5f, 0xba, 0x1b,
                           0x61, 0x95, 0xd3, 0x86, 0xb2, 0x5e, 0x28, 0x40, 0x4b, 0x28};
  uint8_t bytesprops11[] = {0x45, 0x57, 0x4d, 0xfd, 0x70, 0xe1, 0x3d, 0xc4, 0x94, 0x2e, 0xed, 0x6, 0x13};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops1}, .v = {30, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12947}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops3}, .v = {0, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops6}, .v = {26, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29748}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops9}, .v = {28, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2976}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 153}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd4, 0xb5, 0x37, 0xb4, 0x10, 0xb5, 0xd,  0xb,  0x33,
                               0x18, 0x5b, 0x5,  0x50, 0xd2, 0x2f, 0xcf, 0x49, 0xdd};
  uint8_t byteswillprops1[] = {0x59, 0x9d, 0x2e, 0x8c, 0x44, 0xb8, 0x85, 0xa6, 0xd9,
                               0xd6, 0xba, 0x60, 0xa8, 0x8,  0x3d, 0xc4, 0x54};
  uint8_t byteswillprops2[] = {0x16, 0x4,  0x11, 0x76, 0xbd, 0xf5, 0x30, 0x30, 0x56, 0x6c,
                               0x8,  0x91, 0x36, 0xc8, 0x5,  0xe4, 0x4e, 0x9b, 0xcc, 0x93};
  uint8_t byteswillprops3[] = {0xe0, 0x61, 0x8f, 0x55, 0xce, 0xc1, 0x9f, 0x78, 0xa4,
                               0x8,  0xe3, 0xcf, 0x1a, 0xb7, 0xc1, 0x49, 0xb7};
  uint8_t byteswillprops4[] = {0xa1, 0xc4, 0xeb, 0xf3, 0x61, 0x7d, 0xac, 0xef, 0x4d, 0x9d, 0x79, 0xe1, 0x7a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18041}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21952}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23073}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17368}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21906}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
  };

  lwmqtt_properties_t willprops = {19, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x56, 0x8c, 0x78, 0x9e, 0xfa, 0x4, 0x3e, 0xf1, 0xf1, 0x94, 0xc7, 0x55};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0x5b, 0x89, 0x67, 0x87, 0xf1, 0x49, 0xe9, 0x92, 0xe8, 0xd6, 0xa5,
                                  0xa3, 0xeb, 0x45, 0xa3, 0x76, 0x30, 0x8a, 0x23, 0x13, 0x54, 0x34};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18446;
  uint8_t client_id_bytes[] = {0xdf, 0x11, 0xd7, 0x74, 0x49, 0xbc, 0x5b, 0x98};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x32, 0xa1, 0xb9, 0x16, 0x50, 0x32, 0x7a, 0x6,  0x30, 0x6c,
                              0xba, 0xcb, 0x9b, 0x52, 0x94, 0x1a, 0x58, 0x74, 0xfb, 0xf};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\153\228E\255\142\252(L", _password = Just "NP\144 \208\ETB", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "C\192\208T\157\190'\DC3E\153\205\237\208\137\EOT\130\GS\200", _willMsg = "", _willProps = [PropTopicAliasMaximum
// 21421,PropSubscriptionIdentifier 8,PropAssignedClientIdentifier
// "\170\224\142\133\166\207:\SYN",PropMessageExpiryInterval 28506,PropSharedSubscriptionAvailable 21,PropContentType
// "t\143\213\&1:\237",PropRetainAvailable 224,PropReasonString
// "?ua\ETB\232\157g\DEL\GSg\239\139\246A\183\254{i\209]\DC2]\150g\155#\140\&6\171\172",PropMessageExpiryInterval
// 9448,PropSubscriptionIdentifierAvailable 129,PropSharedSubscriptionAvailable 177,PropWillDelayInterval
// 14239,PropWillDelayInterval 29282,PropCorrelationData
// "\130m\182\216,\199\198t\CAN\218\208\&1\178\178",PropMessageExpiryInterval 29362]}), _cleanSession = True, _keepAlive
// = 24334, _connID = "\191\181\157\159\245\202\211", _properties = [PropUserProperty
// ";\152\DLE\194<\195Z\236\167%7R\129\225\146\188\DEL\164" "y\184\250",PropResponseInformation
// "\bi\214\215%\182-{Rn\tu\EMp\213-\193\tc\NAK\226",PropWildcardSubscriptionAvailable 207,PropAuthenticationData
// "\228\ETX\227\172\134\212K~8\DEL\193\DELA\ESC\DC2",PropMaximumQoS 110,PropUserProperty
// "H\222\254\195{\179\254\239>[\198\242\173\204\171h\210b" "\148",PropRetainAvailable 165,PropAuthenticationData
// "\220\130\223\ACKy\ESC\154\254/i\171.\DELt\193\244Z\247A\175kd\228\129J\228",PropMaximumQoS
// 22,PropAssignedClientIdentifier "A\188a7\CAN\DLE\242Z\171\RS\202\169\SOHSJ\134\EM\213;\248",PropResponseTopic
// "\132}\CAN\201\154\139\179\SUB82\237~\129\212",PropAuthenticationData "",PropContentType
// "Gq\237\NAKA\142\199\165\229\154",PropRequestResponseInformation 150,PropUserProperty
// "&\182\241\STX\233\132\228N\148mR\SIH" "",PropAuthenticationMethod "b\250\228!\145\147\190>",PropMaximumPacketSize
// 22973,PropReasonString "\163=\US,\130\139rA\160\ACK\241",PropResponseInformation
// "\194\ti,r\168\213;k\150\227\190\194\215\233\171<\224I\NAK",PropMaximumQoS 166,PropServerReference
// "\246FG\242\128\&9\150\130u`\158\139G\224\ESC\172",PropMaximumPacketSize 24530,PropSubscriptionIdentifier 0]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0xc8, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf6, 0x5f, 0xe,  0x9e, 0x2,  0x26, 0x0,  0x12, 0x3b,
      0x98, 0x10, 0xc2, 0x3c, 0xc3, 0x5a, 0xec, 0xa7, 0x25, 0x37, 0x52, 0x81, 0xe1, 0x92, 0xbc, 0x7f, 0xa4, 0x0,  0x3,
      0x79, 0xb8, 0xfa, 0x1a, 0x0,  0x15, 0x8,  0x69, 0xd6, 0xd7, 0x25, 0xb6, 0x2d, 0x7b, 0x52, 0x6e, 0x9,  0x75, 0x19,
      0x70, 0xd5, 0x2d, 0xc1, 0x9,  0x63, 0x15, 0xe2, 0x28, 0xcf, 0x16, 0x0,  0xf,  0xe4, 0x3,  0xe3, 0xac, 0x86, 0xd4,
      0x4b, 0x7e, 0x38, 0x7f, 0xc1, 0x7f, 0x41, 0x1b, 0x12, 0x24, 0x6e, 0x26, 0x0,  0x12, 0x48, 0xde, 0xfe, 0xc3, 0x7b,
      0xb3, 0xfe, 0xef, 0x3e, 0x5b, 0xc6, 0xf2, 0xad, 0xcc, 0xab, 0x68, 0xd2, 0x62, 0x0,  0x1,  0x94, 0x25, 0xa5, 0x16,
      0x0,  0x1a, 0xdc, 0x82, 0xdf, 0x6,  0x79, 0x1b, 0x9a, 0xfe, 0x2f, 0x69, 0xab, 0x2e, 0x7f, 0x74, 0xc1, 0xf4, 0x5a,
      0xf7, 0x41, 0xaf, 0x6b, 0x64, 0xe4, 0x81, 0x4a, 0xe4, 0x24, 0x16, 0x12, 0x0,  0x14, 0x41, 0xbc, 0x61, 0x37, 0x18,
      0x10, 0xf2, 0x5a, 0xab, 0x1e, 0xca, 0xa9, 0x1,  0x53, 0x4a, 0x86, 0x19, 0xd5, 0x3b, 0xf8, 0x8,  0x0,  0xe,  0x84,
      0x7d, 0x18, 0xc9, 0x9a, 0x8b, 0xb3, 0x1a, 0x38, 0x32, 0xed, 0x7e, 0x81, 0xd4, 0x16, 0x0,  0x0,  0x3,  0x0,  0xa,
      0x47, 0x71, 0xed, 0x15, 0x41, 0x8e, 0xc7, 0xa5, 0xe5, 0x9a, 0x19, 0x96, 0x26, 0x0,  0xd,  0x26, 0xb6, 0xf1, 0x2,
      0xe9, 0x84, 0xe4, 0x4e, 0x94, 0x6d, 0x52, 0xf,  0x48, 0x0,  0x0,  0x15, 0x0,  0x8,  0x62, 0xfa, 0xe4, 0x21, 0x91,
      0x93, 0xbe, 0x3e, 0x27, 0x0,  0x0,  0x59, 0xbd, 0x1f, 0x0,  0xb,  0xa3, 0x3d, 0x1f, 0x2c, 0x82, 0x8b, 0x72, 0x41,
      0xa0, 0x6,  0xf1, 0x1a, 0x0,  0x14, 0xc2, 0x9,  0x69, 0x2c, 0x72, 0xa8, 0xd5, 0x3b, 0x6b, 0x96, 0xe3, 0xbe, 0xc2,
      0xd7, 0xe9, 0xab, 0x3c, 0xe0, 0x49, 0x15, 0x24, 0xa6, 0x1c, 0x0,  0x10, 0xf6, 0x46, 0x47, 0xf2, 0x80, 0x39, 0x96,
      0x82, 0x75, 0x60, 0x9e, 0x8b, 0x47, 0xe0, 0x1b, 0xac, 0x27, 0x0,  0x0,  0x5f, 0xd2, 0xb,  0x0,  0x0,  0x7,  0xbf,
      0xb5, 0x9d, 0x9f, 0xf5, 0xca, 0xd3, 0x6c, 0x22, 0x53, 0xad, 0xb,  0x8,  0x12, 0x0,  0x8,  0xaa, 0xe0, 0x8e, 0x85,
      0xa6, 0xcf, 0x3a, 0x16, 0x2,  0x0,  0x0,  0x6f, 0x5a, 0x2a, 0x15, 0x3,  0x0,  0x6,  0x74, 0x8f, 0xd5, 0x31, 0x3a,
      0xed, 0x25, 0xe0, 0x1f, 0x0,  0x1e, 0x3f, 0x75, 0x61, 0x17, 0xe8, 0x9d, 0x67, 0x7f, 0x1d, 0x67, 0xef, 0x8b, 0xf6,
      0x41, 0xb7, 0xfe, 0x7b, 0x69, 0xd1, 0x5d, 0x12, 0x5d, 0x96, 0x67, 0x9b, 0x23, 0x8c, 0x36, 0xab, 0xac, 0x2,  0x0,
      0x0,  0x24, 0xe8, 0x29, 0x81, 0x2a, 0xb1, 0x18, 0x0,  0x0,  0x37, 0x9f, 0x18, 0x0,  0x0,  0x72, 0x62, 0x9,  0x0,
      0xe,  0x82, 0x6d, 0xb6, 0xd8, 0x2c, 0xc7, 0xc6, 0x74, 0x18, 0xda, 0xd0, 0x31, 0xb2, 0xb2, 0x2,  0x0,  0x0,  0x72,
      0xb2, 0x0,  0x12, 0x43, 0xc0, 0xd0, 0x54, 0x9d, 0xbe, 0x27, 0x13, 0x45, 0x99, 0xcd, 0xed, 0xd0, 0x89, 0x4,  0x82,
      0x1d, 0xc8, 0x0,  0x0,  0x0,  0x8,  0x99, 0xe4, 0x45, 0xff, 0x8e, 0xfc, 0x28, 0x4c, 0x0,  0x6,  0x4e, 0x50, 0x90,
      0x20, 0xd0, 0x17};

  uint8_t buf[469] = {0};

  uint8_t bytesprops1[] = {0x79, 0xb8, 0xfa};
  uint8_t bytesprops0[] = {0x3b, 0x98, 0x10, 0xc2, 0x3c, 0xc3, 0x5a, 0xec, 0xa7,
                           0x25, 0x37, 0x52, 0x81, 0xe1, 0x92, 0xbc, 0x7f, 0xa4};
  uint8_t bytesprops2[] = {0x8,  0x69, 0xd6, 0xd7, 0x25, 0xb6, 0x2d, 0x7b, 0x52, 0x6e, 0x9,
                           0x75, 0x19, 0x70, 0xd5, 0x2d, 0xc1, 0x9,  0x63, 0x15, 0xe2};
  uint8_t bytesprops3[] = {0xe4, 0x3, 0xe3, 0xac, 0x86, 0xd4, 0x4b, 0x7e, 0x38, 0x7f, 0xc1, 0x7f, 0x41, 0x1b, 0x12};
  uint8_t bytesprops5[] = {0x94};
  uint8_t bytesprops4[] = {0x48, 0xde, 0xfe, 0xc3, 0x7b, 0xb3, 0xfe, 0xef, 0x3e,
                           0x5b, 0xc6, 0xf2, 0xad, 0xcc, 0xab, 0x68, 0xd2, 0x62};
  uint8_t bytesprops6[] = {0xdc, 0x82, 0xdf, 0x6,  0x79, 0x1b, 0x9a, 0xfe, 0x2f, 0x69, 0xab, 0x2e, 0x7f,
                           0x74, 0xc1, 0xf4, 0x5a, 0xf7, 0x41, 0xaf, 0x6b, 0x64, 0xe4, 0x81, 0x4a, 0xe4};
  uint8_t bytesprops7[] = {0x41, 0xbc, 0x61, 0x37, 0x18, 0x10, 0xf2, 0x5a, 0xab, 0x1e,
                           0xca, 0xa9, 0x1,  0x53, 0x4a, 0x86, 0x19, 0xd5, 0x3b, 0xf8};
  uint8_t bytesprops8[] = {0x84, 0x7d, 0x18, 0xc9, 0x9a, 0x8b, 0xb3, 0x1a, 0x38, 0x32, 0xed, 0x7e, 0x81, 0xd4};
  uint8_t bytesprops9[] = {0};
  uint8_t bytesprops10[] = {0x47, 0x71, 0xed, 0x15, 0x41, 0x8e, 0xc7, 0xa5, 0xe5, 0x9a};
  uint8_t bytesprops12[] = {0};
  uint8_t bytesprops11[] = {0x26, 0xb6, 0xf1, 0x2, 0xe9, 0x84, 0xe4, 0x4e, 0x94, 0x6d, 0x52, 0xf, 0x48};
  uint8_t bytesprops13[] = {0x62, 0xfa, 0xe4, 0x21, 0x91, 0x93, 0xbe, 0x3e};
  uint8_t bytesprops14[] = {0xa3, 0x3d, 0x1f, 0x2c, 0x82, 0x8b, 0x72, 0x41, 0xa0, 0x6, 0xf1};
  uint8_t bytesprops15[] = {0xc2, 0x9,  0x69, 0x2c, 0x72, 0xa8, 0xd5, 0x3b, 0x6b, 0x96,
                            0xe3, 0xbe, 0xc2, 0xd7, 0xe9, 0xab, 0x3c, 0xe0, 0x49, 0x15};
  uint8_t bytesprops16[] = {0xf6, 0x46, 0x47, 0xf2, 0x80, 0x39, 0x96, 0x82,
                            0x75, 0x60, 0x9e, 0x8b, 0x47, 0xe0, 0x1b, 0xac};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops0}, .v = {3, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops4}, .v = {1, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops11}, .v = {0, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22973}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24530}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xaa, 0xe0, 0x8e, 0x85, 0xa6, 0xcf, 0x3a, 0x16};
  uint8_t byteswillprops1[] = {0x74, 0x8f, 0xd5, 0x31, 0x3a, 0xed};
  uint8_t byteswillprops2[] = {0x3f, 0x75, 0x61, 0x17, 0xe8, 0x9d, 0x67, 0x7f, 0x1d, 0x67,
                               0xef, 0x8b, 0xf6, 0x41, 0xb7, 0xfe, 0x7b, 0x69, 0xd1, 0x5d,
                               0x12, 0x5d, 0x96, 0x67, 0x9b, 0x23, 0x8c, 0x36, 0xab, 0xac};
  uint8_t byteswillprops3[] = {0x82, 0x6d, 0xb6, 0xd8, 0x2c, 0xc7, 0xc6, 0x74, 0x18, 0xda, 0xd0, 0x31, 0xb2, 0xb2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21421}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28506}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9448}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14239}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29282}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29362}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x43, 0xc0, 0xd0, 0x54, 0x9d, 0xbe, 0x27, 0x13, 0x45,
                                0x99, 0xcd, 0xed, 0xd0, 0x89, 0x4,  0x82, 0x1d, 0xc8};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 24334;
  uint8_t client_id_bytes[] = {0xbf, 0xb5, 0x9d, 0x9f, 0xf5, 0xca, 0xd3};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x99, 0xe4, 0x45, 0xff, 0x8e, 0xfc, 0x28, 0x4c};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4e, 0x50, 0x90, 0x20, 0xd0, 0x17};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\166B\SO^~\248\144\152\224\232\161\186", _password = Just "s\130\248.\129\v\222",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\b8\n\140)k\ESC\v", _willMsg =
// "$\173\176\USm\202h\211\254\147\r\241c\217", _willProps = [PropMessageExpiryInterval 1361,PropAuthenticationData
// "\153\193xr\243\DC2\204\255\168s\a\231h",PropAssignedClientIdentifier
// "\171+[\192\146H\229M\">U\186\192\249\n\ETX\231z\213\140\166\147K\"m\157\217S\204\&3",PropMaximumQoS
// 203,PropSubscriptionIdentifierAvailable 178,PropAuthenticationData
// "\224\209\233\158~O\217Y\241I\130c\253N\163\r\229`\f\182O\231Y\r\157\236\165\246\161F",PropUserProperty
// "e0\DC1\137\225\252+/\183p\216\255M\189z\134\&3&\140;\198\255bt\236w"
// "\219\&8y\206\EM\ETBO\207\a\173\195%\195\ETB\219\SOHb^*e\129k\161R\211\SYN",PropSessionExpiryInterval
// 3244,PropReasonString "\167\SI\180w\230~\140[\237\139\"\246|\142\173\225Z\223\208\160\209Ga\151\f",PropReasonString
// "g\216\159\185\220V",PropCorrelationData
// "_\153\STX\b1b#4\NUL\CAN\222\185,G\206\228\&9\128\231\&3\200GtW\165\222\\\135\219)",PropRetainAvailable
// 241,PropWillDelayInterval 22307,PropAssignedClientIdentifier
// "|\152\214\141\151/\187\189\FS\DEL",PropPayloadFormatIndicator 179,PropUserProperty "\252\203"
// "D\137\NUL\218\239;\SYNC\208\148\155\192[JHW \185i\159Q",PropContentType
// "\192\150|\185y\167\235\128\219\DC1\235\149\FSW1\208\243\210\227W\228\165\240 \223)@&\149",PropAuthenticationMethod
// "\CAN\247}\160\153\154\"\DC3/\179J\t\DELWV_\237m\141\170e\141\&0pkf\209{\130",PropMaximumPacketSize
// 7609,PropTopicAliasMaximum 12535,PropRetainAvailable 122,PropResponseInformation
// "C\151\199\249\131\151o\176\132pp\167aK\173\190\SOP\240\180z\STX\178\NAKz\232L\156",PropPayloadFormatIndicator
// 195,PropServerReference "\134\FSl\ETB\US\232",PropAuthenticationData
// "?I\ESC\143\USB\167\171d\DC31\172-N\240\&8P\176\253\ETB\131\230\204DS\DEL0\129_:",PropWillDelayInterval
// 29716,PropSubscriptionIdentifier 18]}), _cleanSession = True, _keepAlive = 11162, _connID =
// "\\\NUL\237\211\216\199\228=\232-\185\&9^/Qf\251L", _properties = [PropSubscriptionIdentifier 4]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0x81, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x2b, 0x9a, 0x2,  0xb,  0x4,  0x0,  0x12, 0x5c,
      0x0,  0xed, 0xd3, 0xd8, 0xc7, 0xe4, 0x3d, 0xe8, 0x2d, 0xb9, 0x39, 0x5e, 0x2f, 0x51, 0x66, 0xfb, 0x4c, 0xad, 0x3,
      0x2,  0x0,  0x0,  0x5,  0x51, 0x16, 0x0,  0xd,  0x99, 0xc1, 0x78, 0x72, 0xf3, 0x12, 0xcc, 0xff, 0xa8, 0x73, 0x7,
      0xe7, 0x68, 0x12, 0x0,  0x1e, 0xab, 0x2b, 0x5b, 0xc0, 0x92, 0x48, 0xe5, 0x4d, 0x22, 0x3e, 0x55, 0xba, 0xc0, 0xf9,
      0xa,  0x3,  0xe7, 0x7a, 0xd5, 0x8c, 0xa6, 0x93, 0x4b, 0x22, 0x6d, 0x9d, 0xd9, 0x53, 0xcc, 0x33, 0x24, 0xcb, 0x29,
      0xb2, 0x16, 0x0,  0x1e, 0xe0, 0xd1, 0xe9, 0x9e, 0x7e, 0x4f, 0xd9, 0x59, 0xf1, 0x49, 0x82, 0x63, 0xfd, 0x4e, 0xa3,
      0xd,  0xe5, 0x60, 0xc,  0xb6, 0x4f, 0xe7, 0x59, 0xd,  0x9d, 0xec, 0xa5, 0xf6, 0xa1, 0x46, 0x26, 0x0,  0x1a, 0x65,
      0x30, 0x11, 0x89, 0xe1, 0xfc, 0x2b, 0x2f, 0xb7, 0x70, 0xd8, 0xff, 0x4d, 0xbd, 0x7a, 0x86, 0x33, 0x26, 0x8c, 0x3b,
      0xc6, 0xff, 0x62, 0x74, 0xec, 0x77, 0x0,  0x1a, 0xdb, 0x38, 0x79, 0xce, 0x19, 0x17, 0x4f, 0xcf, 0x7,  0xad, 0xc3,
      0x25, 0xc3, 0x17, 0xdb, 0x1,  0x62, 0x5e, 0x2a, 0x65, 0x81, 0x6b, 0xa1, 0x52, 0xd3, 0x16, 0x11, 0x0,  0x0,  0xc,
      0xac, 0x1f, 0x0,  0x19, 0xa7, 0xf,  0xb4, 0x77, 0xe6, 0x7e, 0x8c, 0x5b, 0xed, 0x8b, 0x22, 0xf6, 0x7c, 0x8e, 0xad,
      0xe1, 0x5a, 0xdf, 0xd0, 0xa0, 0xd1, 0x47, 0x61, 0x97, 0xc,  0x1f, 0x0,  0x6,  0x67, 0xd8, 0x9f, 0xb9, 0xdc, 0x56,
      0x9,  0x0,  0x1e, 0x5f, 0x99, 0x2,  0x8,  0x31, 0x62, 0x23, 0x34, 0x0,  0x18, 0xde, 0xb9, 0x2c, 0x47, 0xce, 0xe4,
      0x39, 0x80, 0xe7, 0x33, 0xc8, 0x47, 0x74, 0x57, 0xa5, 0xde, 0x5c, 0x87, 0xdb, 0x29, 0x25, 0xf1, 0x18, 0x0,  0x0,
      0x57, 0x23, 0x12, 0x0,  0xa,  0x7c, 0x98, 0xd6, 0x8d, 0x97, 0x2f, 0xbb, 0xbd, 0x1c, 0x7f, 0x1,  0xb3, 0x26, 0x0,
      0x2,  0xfc, 0xcb, 0x0,  0x15, 0x44, 0x89, 0x0,  0xda, 0xef, 0x3b, 0x16, 0x43, 0xd0, 0x94, 0x9b, 0xc0, 0x5b, 0x4a,
      0x48, 0x57, 0x20, 0xb9, 0x69, 0x9f, 0x51, 0x3,  0x0,  0x1d, 0xc0, 0x96, 0x7c, 0xb9, 0x79, 0xa7, 0xeb, 0x80, 0xdb,
      0x11, 0xeb, 0x95, 0x1c, 0x57, 0x31, 0xd0, 0xf3, 0xd2, 0xe3, 0x57, 0xe4, 0xa5, 0xf0, 0x20, 0xdf, 0x29, 0x40, 0x26,
      0x95, 0x15, 0x0,  0x1d, 0x18, 0xf7, 0x7d, 0xa0, 0x99, 0x9a, 0x22, 0x13, 0x2f, 0xb3, 0x4a, 0x9,  0x7f, 0x57, 0x56,
      0x5f, 0xed, 0x6d, 0x8d, 0xaa, 0x65, 0x8d, 0x30, 0x70, 0x6b, 0x66, 0xd1, 0x7b, 0x82, 0x27, 0x0,  0x0,  0x1d, 0xb9,
      0x22, 0x30, 0xf7, 0x25, 0x7a, 0x1a, 0x0,  0x1c, 0x43, 0x97, 0xc7, 0xf9, 0x83, 0x97, 0x6f, 0xb0, 0x84, 0x70, 0x70,
      0xa7, 0x61, 0x4b, 0xad, 0xbe, 0xe,  0x50, 0xf0, 0xb4, 0x7a, 0x2,  0xb2, 0x15, 0x7a, 0xe8, 0x4c, 0x9c, 0x1,  0xc3,
      0x1c, 0x0,  0x6,  0x86, 0x1c, 0x6c, 0x17, 0x1f, 0xe8, 0x16, 0x0,  0x1e, 0x3f, 0x49, 0x1b, 0x8f, 0x1f, 0x42, 0xa7,
      0xab, 0x64, 0x13, 0x31, 0xac, 0x2d, 0x4e, 0xf0, 0x38, 0x50, 0xb0, 0xfd, 0x17, 0x83, 0xe6, 0xcc, 0x44, 0x53, 0x7f,
      0x30, 0x81, 0x5f, 0x3a, 0x18, 0x0,  0x0,  0x74, 0x14, 0xb,  0x12, 0x0,  0x8,  0x8,  0x38, 0xa,  0x8c, 0x29, 0x6b,
      0x1b, 0xb,  0x0,  0xe,  0x24, 0xad, 0xb0, 0x1f, 0x6d, 0xca, 0x68, 0xd3, 0xfe, 0x93, 0xd,  0xf1, 0x63, 0xd9, 0x0,
      0xc,  0xa6, 0x42, 0xe,  0x5e, 0x7e, 0xf8, 0x90, 0x98, 0xe0, 0xe8, 0xa1, 0xba, 0x0,  0x7,  0x73, 0x82, 0xf8, 0x2e,
      0x81, 0xb,  0xde};

  uint8_t buf[526] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x99, 0xc1, 0x78, 0x72, 0xf3, 0x12, 0xcc, 0xff, 0xa8, 0x73, 0x7, 0xe7, 0x68};
  uint8_t byteswillprops1[] = {0xab, 0x2b, 0x5b, 0xc0, 0x92, 0x48, 0xe5, 0x4d, 0x22, 0x3e,
                               0x55, 0xba, 0xc0, 0xf9, 0xa,  0x3,  0xe7, 0x7a, 0xd5, 0x8c,
                               0xa6, 0x93, 0x4b, 0x22, 0x6d, 0x9d, 0xd9, 0x53, 0xcc, 0x33};
  uint8_t byteswillprops2[] = {0xe0, 0xd1, 0xe9, 0x9e, 0x7e, 0x4f, 0xd9, 0x59, 0xf1, 0x49,
                               0x82, 0x63, 0xfd, 0x4e, 0xa3, 0xd,  0xe5, 0x60, 0xc,  0xb6,
                               0x4f, 0xe7, 0x59, 0xd,  0x9d, 0xec, 0xa5, 0xf6, 0xa1, 0x46};
  uint8_t byteswillprops4[] = {0xdb, 0x38, 0x79, 0xce, 0x19, 0x17, 0x4f, 0xcf, 0x7,  0xad, 0xc3, 0x25, 0xc3,
                               0x17, 0xdb, 0x1,  0x62, 0x5e, 0x2a, 0x65, 0x81, 0x6b, 0xa1, 0x52, 0xd3, 0x16};
  uint8_t byteswillprops3[] = {0x65, 0x30, 0x11, 0x89, 0xe1, 0xfc, 0x2b, 0x2f, 0xb7, 0x70, 0xd8, 0xff, 0x4d,
                               0xbd, 0x7a, 0x86, 0x33, 0x26, 0x8c, 0x3b, 0xc6, 0xff, 0x62, 0x74, 0xec, 0x77};
  uint8_t byteswillprops5[] = {0xa7, 0xf,  0xb4, 0x77, 0xe6, 0x7e, 0x8c, 0x5b, 0xed, 0x8b, 0x22, 0xf6, 0x7c,
                               0x8e, 0xad, 0xe1, 0x5a, 0xdf, 0xd0, 0xa0, 0xd1, 0x47, 0x61, 0x97, 0xc};
  uint8_t byteswillprops6[] = {0x67, 0xd8, 0x9f, 0xb9, 0xdc, 0x56};
  uint8_t byteswillprops7[] = {0x5f, 0x99, 0x2,  0x8,  0x31, 0x62, 0x23, 0x34, 0x0,  0x18,
                               0xde, 0xb9, 0x2c, 0x47, 0xce, 0xe4, 0x39, 0x80, 0xe7, 0x33,
                               0xc8, 0x47, 0x74, 0x57, 0xa5, 0xde, 0x5c, 0x87, 0xdb, 0x29};
  uint8_t byteswillprops8[] = {0x7c, 0x98, 0xd6, 0x8d, 0x97, 0x2f, 0xbb, 0xbd, 0x1c, 0x7f};
  uint8_t byteswillprops10[] = {0x44, 0x89, 0x0,  0xda, 0xef, 0x3b, 0x16, 0x43, 0xd0, 0x94, 0x9b,
                                0xc0, 0x5b, 0x4a, 0x48, 0x57, 0x20, 0xb9, 0x69, 0x9f, 0x51};
  uint8_t byteswillprops9[] = {0xfc, 0xcb};
  uint8_t byteswillprops11[] = {0xc0, 0x96, 0x7c, 0xb9, 0x79, 0xa7, 0xeb, 0x80, 0xdb, 0x11,
                                0xeb, 0x95, 0x1c, 0x57, 0x31, 0xd0, 0xf3, 0xd2, 0xe3, 0x57,
                                0xe4, 0xa5, 0xf0, 0x20, 0xdf, 0x29, 0x40, 0x26, 0x95};
  uint8_t byteswillprops12[] = {0x18, 0xf7, 0x7d, 0xa0, 0x99, 0x9a, 0x22, 0x13, 0x2f, 0xb3,
                                0x4a, 0x9,  0x7f, 0x57, 0x56, 0x5f, 0xed, 0x6d, 0x8d, 0xaa,
                                0x65, 0x8d, 0x30, 0x70, 0x6b, 0x66, 0xd1, 0x7b, 0x82};
  uint8_t byteswillprops13[] = {0x43, 0x97, 0xc7, 0xf9, 0x83, 0x97, 0x6f, 0xb0, 0x84, 0x70, 0x70, 0xa7, 0x61, 0x4b,
                                0xad, 0xbe, 0xe,  0x50, 0xf0, 0xb4, 0x7a, 0x2,  0xb2, 0x15, 0x7a, 0xe8, 0x4c, 0x9c};
  uint8_t byteswillprops14[] = {0x86, 0x1c, 0x6c, 0x17, 0x1f, 0xe8};
  uint8_t byteswillprops15[] = {0x3f, 0x49, 0x1b, 0x8f, 0x1f, 0x42, 0xa7, 0xab, 0x64, 0x13,
                                0x31, 0xac, 0x2d, 0x4e, 0xf0, 0x38, 0x50, 0xb0, 0xfd, 0x17,
                                0x83, 0xe6, 0xcc, 0x44, 0x53, 0x7f, 0x30, 0x81, 0x5f, 0x3a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1361}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {26, (char*)&byteswillprops3}, .v = {26, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3244}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22307}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {2, (char*)&byteswillprops9}, .v = {21, (char*)&byteswillprops10}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7609}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12535}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&byteswillprops14}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&byteswillprops15}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29716}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8, 0x38, 0xa, 0x8c, 0x29, 0x6b, 0x1b, 0xb};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x24, 0xad, 0xb0, 0x1f, 0x6d, 0xca, 0x68, 0xd3, 0xfe, 0x93, 0xd, 0xf1, 0x63, 0xd9};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11162;
  uint8_t client_id_bytes[] = {0x5c, 0x0,  0xed, 0xd3, 0xd8, 0xc7, 0xe4, 0x3d, 0xe8,
                               0x2d, 0xb9, 0x39, 0x5e, 0x2f, 0x51, 0x66, 0xfb, 0x4c};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa6, 0x42, 0xe, 0x5e, 0x7e, 0xf8, 0x90, 0x98, 0xe0, 0xe8, 0xa1, 0xba};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x73, 0x82, 0xf8, 0x2e, 0x81, 0xb, 0xde};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "}\195VI\SUBP\166\207\141<\140\203\164\224Z", _password = Just
// "\239\US\GSs(\139lq\152'\206\238\DC3(f\172P\GS\152\130\235K\NUL\234", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "O1\SYN\218\151&\229\155j\237\DLEF\143\216\232a\189\195\226\142", _willMsg =
// "\178\165\170\181(-\248\204\DLE\230jKY\EOT>\EM>", _willProps = [PropReceiveMaximum 3726,PropRequestProblemInformation
// 170,PropCorrelationData
// "d\142\&3\202p\217\210\153\129ZP\207v\139\242\204F\135\f\187\131\153\204\187\156\225#\144",PropTopicAlias
// 31770,PropSessionExpiryInterval 29169,PropMessageExpiryInterval 6570,PropTopicAliasMaximum
// 11129,PropSessionExpiryInterval 12415,PropRetainAvailable 45,PropAssignedClientIdentifier "",PropReasonString
// "",PropReasonString
// "\EOT\240`\164\DC3\DLE\169\173@\159\194X\203\168R.\218\ENQ\US\247\&3?\252\&8fB\165",PropWillDelayInterval
// 24015,PropReceiveMaximum 31266,PropReasonString
// "\192\226\149\129\254\201dc\fg\177\179\DC2\RS\DC3.\CAN\230\217\170\164\178\174",PropServerKeepAlive 3690]}),
// _cleanSession = False, _keepAlive = 21561, _connID = "X\167X\244/`\v\181e#h\159\179\219;Q\173\v\134\181+\149\190xs",
// _properties = [PropMaximumPacketSize 9684,PropMaximumQoS 94,PropAssignedClientIdentifier
// "\163\215w?\166\EM\205dI?\147\&7\136\168",PropMessageExpiryInterval 13352,PropCorrelationData
// "I\181\231\181\185\136\221\150\213\&2\164-\179\ESC",PropTopicAliasMaximum 13292,PropSubscriptionIdentifier
// 6,PropTopicAlias 17975]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xb6, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc4, 0x54, 0x39, 0x36, 0x27, 0x0,  0x0,  0x25, 0xd4,
      0x24, 0x5e, 0x12, 0x0,  0xe,  0xa3, 0xd7, 0x77, 0x3f, 0xa6, 0x19, 0xcd, 0x64, 0x49, 0x3f, 0x93, 0x37, 0x88, 0xa8,
      0x2,  0x0,  0x0,  0x34, 0x28, 0x9,  0x0,  0xe,  0x49, 0xb5, 0xe7, 0xb5, 0xb9, 0x88, 0xdd, 0x96, 0xd5, 0x32, 0xa4,
      0x2d, 0xb3, 0x1b, 0x22, 0x33, 0xec, 0xb,  0x6,  0x23, 0x46, 0x37, 0x0,  0x19, 0x58, 0xa7, 0x58, 0xf4, 0x2f, 0x60,
      0xb,  0xb5, 0x65, 0x23, 0x68, 0x9f, 0xb3, 0xdb, 0x3b, 0x51, 0xad, 0xb,  0x86, 0xb5, 0x2b, 0x95, 0xbe, 0x78, 0x73,
      0x84, 0x1,  0x21, 0xe,  0x8e, 0x17, 0xaa, 0x9,  0x0,  0x1c, 0x64, 0x8e, 0x33, 0xca, 0x70, 0xd9, 0xd2, 0x99, 0x81,
      0x5a, 0x50, 0xcf, 0x76, 0x8b, 0xf2, 0xcc, 0x46, 0x87, 0xc,  0xbb, 0x83, 0x99, 0xcc, 0xbb, 0x9c, 0xe1, 0x23, 0x90,
      0x23, 0x7c, 0x1a, 0x11, 0x0,  0x0,  0x71, 0xf1, 0x2,  0x0,  0x0,  0x19, 0xaa, 0x22, 0x2b, 0x79, 0x11, 0x0,  0x0,
      0x30, 0x7f, 0x25, 0x2d, 0x12, 0x0,  0x0,  0x1f, 0x0,  0x0,  0x1f, 0x0,  0x1b, 0x4,  0xf0, 0x60, 0xa4, 0x13, 0x10,
      0xa9, 0xad, 0x40, 0x9f, 0xc2, 0x58, 0xcb, 0xa8, 0x52, 0x2e, 0xda, 0x5,  0x1f, 0xf7, 0x33, 0x3f, 0xfc, 0x38, 0x66,
      0x42, 0xa5, 0x18, 0x0,  0x0,  0x5d, 0xcf, 0x21, 0x7a, 0x22, 0x1f, 0x0,  0x17, 0xc0, 0xe2, 0x95, 0x81, 0xfe, 0xc9,
      0x64, 0x63, 0xc,  0x67, 0xb1, 0xb3, 0x12, 0x1e, 0x13, 0x2e, 0x18, 0xe6, 0xd9, 0xaa, 0xa4, 0xb2, 0xae, 0x13, 0xe,
      0x6a, 0x0,  0x14, 0x4f, 0x31, 0x16, 0xda, 0x97, 0x26, 0xe5, 0x9b, 0x6a, 0xed, 0x10, 0x46, 0x8f, 0xd8, 0xe8, 0x61,
      0xbd, 0xc3, 0xe2, 0x8e, 0x0,  0x11, 0xb2, 0xa5, 0xaa, 0xb5, 0x28, 0x2d, 0xf8, 0xcc, 0x10, 0xe6, 0x6a, 0x4b, 0x59,
      0x4,  0x3e, 0x19, 0x3e, 0x0,  0xf,  0x7d, 0xc3, 0x56, 0x49, 0x1a, 0x50, 0xa6, 0xcf, 0x8d, 0x3c, 0x8c, 0xcb, 0xa4,
      0xe0, 0x5a, 0x0,  0x18, 0xef, 0x1f, 0x1d, 0x73, 0x28, 0x8b, 0x6c, 0x71, 0x98, 0x27, 0xce, 0xee, 0x13, 0x28, 0x66,
      0xac, 0x50, 0x1d, 0x98, 0x82, 0xeb, 0x4b, 0x0,  0xea};

  uint8_t buf[323] = {0};

  uint8_t bytesprops0[] = {0xa3, 0xd7, 0x77, 0x3f, 0xa6, 0x19, 0xcd, 0x64, 0x49, 0x3f, 0x93, 0x37, 0x88, 0xa8};
  uint8_t bytesprops1[] = {0x49, 0xb5, 0xe7, 0xb5, 0xb9, 0x88, 0xdd, 0x96, 0xd5, 0x32, 0xa4, 0x2d, 0xb3, 0x1b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9684}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13352}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13292}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17975}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x64, 0x8e, 0x33, 0xca, 0x70, 0xd9, 0xd2, 0x99, 0x81, 0x5a, 0x50, 0xcf, 0x76, 0x8b,
                               0xf2, 0xcc, 0x46, 0x87, 0xc,  0xbb, 0x83, 0x99, 0xcc, 0xbb, 0x9c, 0xe1, 0x23, 0x90};
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops3[] = {0x4,  0xf0, 0x60, 0xa4, 0x13, 0x10, 0xa9, 0xad, 0x40, 0x9f, 0xc2, 0x58, 0xcb, 0xa8,
                               0x52, 0x2e, 0xda, 0x5,  0x1f, 0xf7, 0x33, 0x3f, 0xfc, 0x38, 0x66, 0x42, 0xa5};
  uint8_t byteswillprops4[] = {0xc0, 0xe2, 0x95, 0x81, 0xfe, 0xc9, 0x64, 0x63, 0xc,  0x67, 0xb1, 0xb3,
                               0x12, 0x1e, 0x13, 0x2e, 0x18, 0xe6, 0xd9, 0xaa, 0xa4, 0xb2, 0xae};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3726}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31770}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29169}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6570}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11129}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12415}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24015}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31266}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3690}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4f, 0x31, 0x16, 0xda, 0x97, 0x26, 0xe5, 0x9b, 0x6a, 0xed,
                                0x10, 0x46, 0x8f, 0xd8, 0xe8, 0x61, 0xbd, 0xc3, 0xe2, 0x8e};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb2, 0xa5, 0xaa, 0xb5, 0x28, 0x2d, 0xf8, 0xcc, 0x10,
                                  0xe6, 0x6a, 0x4b, 0x59, 0x4,  0x3e, 0x19, 0x3e};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 21561;
  uint8_t client_id_bytes[] = {0x58, 0xa7, 0x58, 0xf4, 0x2f, 0x60, 0xb,  0xb5, 0x65, 0x23, 0x68, 0x9f, 0xb3,
                               0xdb, 0x3b, 0x51, 0xad, 0xb,  0x86, 0xb5, 0x2b, 0x95, 0xbe, 0x78, 0x73};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7d, 0xc3, 0x56, 0x49, 0x1a, 0x50, 0xa6, 0xcf, 0x8d, 0x3c, 0x8c, 0xcb, 0xa4, 0xe0, 0x5a};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xef, 0x1f, 0x1d, 0x73, 0x28, 0x8b, 0x6c, 0x71, 0x98, 0x27, 0xce, 0xee,
                              0x13, 0x28, 0x66, 0xac, 0x50, 0x1d, 0x98, 0x82, 0xeb, 0x4b, 0x0,  0xea};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\239zk\159\ETX\223!\141\ETX\233\248\f1=\DC4i", _password = Just
// "\191\141\246E\193\236\243\223\153\216myo\194\214\244\200\140\198\147\236Q\194X\130\136", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic = "L&sv\176Yc2O\\\201,", _willMsg =
// "/\a}\172t\US\218\131\240\224S\221\205S\227\223\231\246~_\168}|8\172\219\157\168", _willProps =
// [PropAssignedClientIdentifier "\253{\222\SUB\ESC\ENQ\223\244",PropRequestResponseInformation 223]}), _cleanSession =
// False, _keepAlive = 478, _connID = "+\251Q\185q\193\199\n\237\186\162\a", _properties = [PropAssignedClientIdentifier
// "\235s\DEL\151g\v\bBE\215",PropWildcardSubscriptionAvailable 91,PropUserProperty "|p\194\v1\161"
// "\247z\SOr\192\246c\152%_\132zbR\US\218)\195\147k\149\199",PropAssignedClientIdentifier
// "\r,\176N#\158._Gf\218\228,\180-",PropTopicAliasMaximum 15986]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0xc6, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x1,  0xde, 0x45, 0x12, 0x0,  0xa,
                   0xeb, 0x73, 0x7f, 0x97, 0x67, 0xb,  0x8,  0x42, 0x45, 0xd7, 0x28, 0x5b, 0x26, 0x0,  0x6,  0x7c, 0x70,
                   0xc2, 0xb,  0x31, 0xa1, 0x0,  0x16, 0xf7, 0x7a, 0xe,  0x72, 0xc0, 0xf6, 0x63, 0x98, 0x25, 0x5f, 0x84,
                   0x7a, 0x62, 0x52, 0x1f, 0xda, 0x29, 0xc3, 0x93, 0x6b, 0x95, 0xc7, 0x12, 0x0,  0xf,  0xd,  0x2c, 0xb0,
                   0x4e, 0x23, 0x9e, 0x2e, 0x5f, 0x47, 0x66, 0xda, 0xe4, 0x2c, 0xb4, 0x2d, 0x22, 0x3e, 0x72, 0x0,  0xc,
                   0x2b, 0xfb, 0x51, 0xb9, 0x71, 0xc1, 0xc7, 0xa,  0xed, 0xba, 0xa2, 0x7,  0xd,  0x12, 0x0,  0x8,  0xfd,
                   0x7b, 0xde, 0x1a, 0x1b, 0x5,  0xdf, 0xf4, 0x19, 0xdf, 0x0,  0xc,  0x4c, 0x26, 0x73, 0x76, 0xb0, 0x59,
                   0x63, 0x32, 0x4f, 0x5c, 0xc9, 0x2c, 0x0,  0x1c, 0x2f, 0x7,  0x7d, 0xac, 0x74, 0x1f, 0xda, 0x83, 0xf0,
                   0xe0, 0x53, 0xdd, 0xcd, 0x53, 0xe3, 0xdf, 0xe7, 0xf6, 0x7e, 0x5f, 0xa8, 0x7d, 0x7c, 0x38, 0xac, 0xdb,
                   0x9d, 0xa8, 0x0,  0x10, 0xef, 0x7a, 0x6b, 0x9f, 0x3,  0xdf, 0x21, 0x8d, 0x3,  0xe9, 0xf8, 0xc,  0x31,
                   0x3d, 0x14, 0x69, 0x0,  0x1a, 0xbf, 0x8d, 0xf6, 0x45, 0xc1, 0xec, 0xf3, 0xdf, 0x99, 0xd8, 0x6d, 0x79,
                   0x6f, 0xc2, 0xd6, 0xf4, 0xc8, 0x8c, 0xc6, 0x93, 0xec, 0x51, 0xc2, 0x58, 0x82, 0x88};

  uint8_t buf[211] = {0};

  uint8_t bytesprops0[] = {0xeb, 0x73, 0x7f, 0x97, 0x67, 0xb, 0x8, 0x42, 0x45, 0xd7};
  uint8_t bytesprops2[] = {0xf7, 0x7a, 0xe,  0x72, 0xc0, 0xf6, 0x63, 0x98, 0x25, 0x5f, 0x84,
                           0x7a, 0x62, 0x52, 0x1f, 0xda, 0x29, 0xc3, 0x93, 0x6b, 0x95, 0xc7};
  uint8_t bytesprops1[] = {0x7c, 0x70, 0xc2, 0xb, 0x31, 0xa1};
  uint8_t bytesprops3[] = {0xd, 0x2c, 0xb0, 0x4e, 0x23, 0x9e, 0x2e, 0x5f, 0x47, 0x66, 0xda, 0xe4, 0x2c, 0xb4, 0x2d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops1}, .v = {22, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15986}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xfd, 0x7b, 0xde, 0x1a, 0x1b, 0x5, 0xdf, 0xf4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 223}},
  };

  lwmqtt_properties_t willprops = {2, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4c, 0x26, 0x73, 0x76, 0xb0, 0x59, 0x63, 0x32, 0x4f, 0x5c, 0xc9, 0x2c};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2f, 0x7,  0x7d, 0xac, 0x74, 0x1f, 0xda, 0x83, 0xf0, 0xe0, 0x53, 0xdd, 0xcd, 0x53,
                                  0xe3, 0xdf, 0xe7, 0xf6, 0x7e, 0x5f, 0xa8, 0x7d, 0x7c, 0x38, 0xac, 0xdb, 0x9d, 0xa8};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 478;
  uint8_t client_id_bytes[] = {0x2b, 0xfb, 0x51, 0xb9, 0x71, 0xc1, 0xc7, 0xa, 0xed, 0xba, 0xa2, 0x7};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xef, 0x7a, 0x6b, 0x9f, 0x3,  0xdf, 0x21, 0x8d,
                              0x3,  0xe9, 0xf8, 0xc,  0x31, 0x3d, 0x14, 0x69};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbf, 0x8d, 0xf6, 0x45, 0xc1, 0xec, 0xf3, 0xdf, 0x99, 0xd8, 0x6d, 0x79, 0x6f,
                              0xc2, 0xd6, 0xf4, 0xc8, 0x8c, 0xc6, 0x93, 0xec, 0x51, 0xc2, 0x58, 0x82, 0x88};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27385 [("\203r\138\235\US\213\196\158\177\226",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\210\190\198\&0ofo\DC1|E\r\rL\152\233\224d\199",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\237\&4\212\155\143\216\v\200\DEL\206\242\145\213W\133\216HU\FSK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\149\ETX\DC3%\228\238+\165\167r\NAKr\178\170",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("4\244y\238\205\153\213",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\135",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\187\224\219\172\\$\133[rk\157\200\159O\ENQ@\167\217\254<q\173\US\186\137\238\v\SYN\233\187",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("m4\218W\235\134Kd\175\189\214RiO",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\195\254V\a\211\157\&1?JL\210m\nZ\195\&3\v",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x6a, 0xf9, 0x0,  0xa,  0xcb, 0x72, 0x8a, 0xeb, 0x1f, 0xd5, 0xc4, 0x9e, 0xb1, 0xe2,
                   0x1,  0x0,  0x12, 0xd2, 0xbe, 0xc6, 0x30, 0x6f, 0x66, 0x6f, 0x11, 0x7c, 0x45, 0xd,  0xd,  0x4c, 0x98,
                   0xe9, 0xe0, 0x64, 0xc7, 0x2,  0x0,  0x14, 0xed, 0x34, 0xd4, 0x9b, 0x8f, 0xd8, 0xb,  0xc8, 0x7f, 0xce,
                   0xf2, 0x91, 0xd5, 0x57, 0x85, 0xd8, 0x48, 0x55, 0x1c, 0x4b, 0x2,  0x0,  0xe,  0x95, 0x3,  0x13, 0x25,
                   0xe4, 0xee, 0x2b, 0xa5, 0xa7, 0x72, 0x15, 0x72, 0xb2, 0xaa, 0x1,  0x0,  0x7,  0x34, 0xf4, 0x79, 0xee,
                   0xcd, 0x99, 0xd5, 0x0,  0x0,  0x1,  0x87, 0x1,  0x0,  0x1e, 0xbb, 0xe0, 0xdb, 0xac, 0x5c, 0x24, 0x85,
                   0x5b, 0x72, 0x6b, 0x9d, 0xc8, 0x9f, 0x4f, 0x5,  0x40, 0xa7, 0xd9, 0xfe, 0x3c, 0x71, 0xad, 0x1f, 0xba,
                   0x89, 0xee, 0xb,  0x16, 0xe9, 0xbb, 0x2,  0x0,  0xe,  0x6d, 0x34, 0xda, 0x57, 0xeb, 0x86, 0x4b, 0x64,
                   0xaf, 0xbd, 0xd6, 0x52, 0x69, 0x4f, 0x0,  0x0,  0x11, 0xc3, 0xfe, 0x56, 0x7,  0xd3, 0x9d, 0x31, 0x3f,
                   0x4a, 0x4c, 0xd2, 0x6d, 0xa,  0x5a, 0xc3, 0x33, 0xb,  0x1};

  uint8_t buf[173] = {0};

  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xcb, 0x72, 0x8a, 0xeb, 0x1f, 0xd5, 0xc4, 0x9e, 0xb1, 0xe2};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd2, 0xbe, 0xc6, 0x30, 0x6f, 0x66, 0x6f, 0x11, 0x7c,
                                     0x45, 0xd,  0xd,  0x4c, 0x98, 0xe9, 0xe0, 0x64, 0xc7};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xed, 0x34, 0xd4, 0x9b, 0x8f, 0xd8, 0xb,  0xc8, 0x7f, 0xce,
                                     0xf2, 0x91, 0xd5, 0x57, 0x85, 0xd8, 0x48, 0x55, 0x1c, 0x4b};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x95, 0x3, 0x13, 0x25, 0xe4, 0xee, 0x2b, 0xa5, 0xa7, 0x72, 0x15, 0x72, 0xb2, 0xaa};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x34, 0xf4, 0x79, 0xee, 0xcd, 0x99, 0xd5};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x87};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbb, 0xe0, 0xdb, 0xac, 0x5c, 0x24, 0x85, 0x5b, 0x72, 0x6b,
                                     0x9d, 0xc8, 0x9f, 0x4f, 0x5,  0x40, 0xa7, 0xd9, 0xfe, 0x3c,
                                     0x71, 0xad, 0x1f, 0xba, 0x89, 0xee, 0xb,  0x16, 0xe9, 0xbb};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6d, 0x34, 0xda, 0x57, 0xeb, 0x86, 0x4b,
                                     0x64, 0xaf, 0xbd, 0xd6, 0x52, 0x69, 0x4f};
  lwmqtt_string_t topic_filter_s7 = {14, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc3, 0xfe, 0x56, 0x7, 0xd3, 0x9d, 0x31, 0x3f, 0x4a,
                                     0x4c, 0xd2, 0x6d, 0xa, 0x5a, 0xc3, 0x33, 0xb};
  lwmqtt_string_t topic_filter_s8 = {17, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27385, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22666 [("G\DLE\141c\141\r",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\DLEq\227\252\175\246{\157\250\NUL\231",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\175\SO.Id[",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("p\210\142F\178\242R\233\138\188\253$$r\142\SYN\244\167k\195",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x39, 0x58, 0x8a, 0x0,  0x6,  0x47, 0x10, 0x8d, 0x63, 0x8d, 0xd,  0x2,  0x0,  0xb,
                   0x10, 0x71, 0xe3, 0xfc, 0xaf, 0xf6, 0x7b, 0x9d, 0xfa, 0x0,  0xe7, 0x0,  0x0,  0x6,  0xaf,
                   0xe,  0x2e, 0x49, 0x64, 0x5b, 0x1,  0x0,  0x14, 0x70, 0xd2, 0x8e, 0x46, 0xb2, 0xf2, 0x52,
                   0xe9, 0x8a, 0xbc, 0xfd, 0x24, 0x24, 0x72, 0x8e, 0x16, 0xf4, 0xa7, 0x6b, 0xc3, 0x2};

  uint8_t buf[69] = {0};

  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0x10, 0x8d, 0x63, 0x8d, 0xd};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x10, 0x71, 0xe3, 0xfc, 0xaf, 0xf6, 0x7b, 0x9d, 0xfa, 0x0, 0xe7};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xaf, 0xe, 0x2e, 0x49, 0x64, 0x5b};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x70, 0xd2, 0x8e, 0x46, 0xb2, 0xf2, 0x52, 0xe9, 0x8a, 0xbc,
                                     0xfd, 0x24, 0x24, 0x72, 0x8e, 0x16, 0xf4, 0xa7, 0x6b, 0xc3};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22666, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7099 [("\131J\165\202",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\r\242#[",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("+",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\165>^\202\145\206\SOH\DC1\152\r\214\128\148\140",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\246\&2\186",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x2b, 0x1b, 0xbb, 0x0,  0x4,  0x83, 0x4a, 0xa5, 0xca, 0x2,  0x0,  0x4,  0xd,  0xf2,
                   0x23, 0x5b, 0x0,  0x0,  0x1,  0x2b, 0x2,  0x0,  0xe,  0xa5, 0x3e, 0x5e, 0xca, 0x91, 0xce,
                   0x1,  0x11, 0x98, 0xd,  0xd6, 0x80, 0x94, 0x8c, 0x0,  0x0,  0x3,  0xf6, 0x32, 0xba, 0x2};

  uint8_t buf[55] = {0};

  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x83, 0x4a, 0xa5, 0xca};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd, 0xf2, 0x23, 0x5b};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2b};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa5, 0x3e, 0x5e, 0xca, 0x91, 0xce, 0x1, 0x11, 0x98, 0xd, 0xd6, 0x80, 0x94, 0x8c};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf6, 0x32, 0xba};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7099, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 835 [("\160\159FO\167\\r\224\141\226\228-\226\247\r@\206\&1w",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS9\DLE\253:\192\SOH/M#\196\191O\159f",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\NULT\227e\232\&8\141\133n#\DLE.\193\163\199\173\&0\184\&9\231\190\253\DEL\144\SUB\130\137\210",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x49, 0x3,  0x43, 0x0,  0x13, 0xa0, 0x9f, 0x46, 0x4f, 0xa7, 0x5c, 0x72, 0xe0, 0x8d,
                   0xe2, 0xe4, 0x2d, 0xe2, 0xf7, 0xd,  0x40, 0xce, 0x31, 0x77, 0x0,  0x0,  0xf,  0x1d, 0x39,
                   0x10, 0xfd, 0x3a, 0xc0, 0x1,  0x2f, 0x4d, 0x23, 0xc4, 0xbf, 0x4f, 0x9f, 0x66, 0x0,  0x0,
                   0x1c, 0x0,  0x54, 0xe3, 0x65, 0xe8, 0x38, 0x8d, 0x85, 0x6e, 0x23, 0x10, 0x2e, 0xc1, 0xa3,
                   0xc7, 0xad, 0x30, 0xb8, 0x39, 0xe7, 0xbe, 0xfd, 0x7f, 0x90, 0x1a, 0x82, 0x89, 0xd2, 0x1};

  uint8_t buf[85] = {0};

  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xa0, 0x9f, 0x46, 0x4f, 0xa7, 0x5c, 0x72, 0xe0, 0x8d, 0xe2,
                                     0xe4, 0x2d, 0xe2, 0xf7, 0xd,  0x40, 0xce, 0x31, 0x77};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1d, 0x39, 0x10, 0xfd, 0x3a, 0xc0, 0x1, 0x2f,
                                     0x4d, 0x23, 0xc4, 0xbf, 0x4f, 0x9f, 0x66};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x0,  0x54, 0xe3, 0x65, 0xe8, 0x38, 0x8d, 0x85, 0x6e, 0x23,
                                     0x10, 0x2e, 0xc1, 0xa3, 0xc7, 0xad, 0x30, 0xb8, 0x39, 0xe7,
                                     0xbe, 0xfd, 0x7f, 0x90, 0x1a, 0x82, 0x89, 0xd2};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 835, 3, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26916 [("g\184\175\169W\207b4\EOTv|>\229C",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x13, 0x69, 0x24, 0x0,  0xe,  0x67, 0xb8, 0xaf, 0xa9, 0x57,
                   0xcf, 0x62, 0x34, 0x4,  0x76, 0x7c, 0x3e, 0xe5, 0x43, 0x1};

  uint8_t buf[31] = {0};

  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x67, 0xb8, 0xaf, 0xa9, 0x57, 0xcf, 0x62, 0x34, 0x4, 0x76, 0x7c, 0x3e, 0xe5, 0x43};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26916, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23203 [("\130\206\197\ETX(;3ie\228\139L\185\152\193\203\DC4\200\v}\b",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("U\v,\200o\aH\192\130\227\236\180=2\240\253\167!\139t\f\173-\140M",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\169\159D\FS\199m]J\SOHG\136Y7r7\160\252\231\185/\172\205N.\193\&9V",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\182\132\145J\160\&3\216-f\DC4X\142\188",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("X\DEL\227P \242\&23\175\NULVC\243jl\150\148B\250m",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\ESC\229&\185`\246\NULRL\168\216C;\165\167",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\t8\146\169\253\156^\157\EM|\141~t\205l\160\ETX\255\137\142v\188\"\DC22",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("U(!\US\174\250\156Z\ESC",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\US\219\141B\210\224Z\240",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\128\181\150r\134\164",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\146v\DLEM\165!\205`q\245ah.\235f\245#O\214c;\134\203\155\b",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0xe5, 0x1,  0x5a, 0xa3, 0x0,  0x15, 0x82, 0xce, 0xc5, 0x3,  0x28, 0x3b, 0x33, 0x69, 0x65, 0xe4,
                   0x8b, 0x4c, 0xb9, 0x98, 0xc1, 0xcb, 0x14, 0xc8, 0xb,  0x7d, 0x8,  0x1,  0x0,  0x19, 0x55, 0xb,  0x2c,
                   0xc8, 0x6f, 0x7,  0x48, 0xc0, 0x82, 0xe3, 0xec, 0xb4, 0x3d, 0x32, 0xf0, 0xfd, 0xa7, 0x21, 0x8b, 0x74,
                   0xc,  0xad, 0x2d, 0x8c, 0x4d, 0x0,  0x0,  0x1b, 0xa9, 0x9f, 0x44, 0x1c, 0xc7, 0x6d, 0x5d, 0x4a, 0x1,
                   0x47, 0x88, 0x59, 0x37, 0x72, 0x37, 0xa0, 0xfc, 0xe7, 0xb9, 0x2f, 0xac, 0xcd, 0x4e, 0x2e, 0xc1, 0x39,
                   0x56, 0x1,  0x0,  0xd,  0xb6, 0x84, 0x91, 0x4a, 0xa0, 0x33, 0xd8, 0x2d, 0x66, 0x14, 0x58, 0x8e, 0xbc,
                   0x1,  0x0,  0x14, 0x58, 0x7f, 0xe3, 0x50, 0x20, 0xf2, 0x32, 0x33, 0xaf, 0x0,  0x56, 0x43, 0xf3, 0x6a,
                   0x6c, 0x96, 0x94, 0x42, 0xfa, 0x6d, 0x0,  0x0,  0xf,  0x1b, 0xe5, 0x26, 0xb9, 0x60, 0xf6, 0x0,  0x52,
                   0x4c, 0xa8, 0xd8, 0x43, 0x3b, 0xa5, 0xa7, 0x2,  0x0,  0x19, 0x9,  0x38, 0x92, 0xa9, 0xfd, 0x9c, 0x5e,
                   0x9d, 0x19, 0x7c, 0x8d, 0x7e, 0x74, 0xcd, 0x6c, 0xa0, 0x3,  0xff, 0x89, 0x8e, 0x76, 0xbc, 0x22, 0x12,
                   0x32, 0x1,  0x0,  0x9,  0x55, 0x28, 0x21, 0x1f, 0xae, 0xfa, 0x9c, 0x5a, 0x1b, 0x2,  0x0,  0x8,  0x1f,
                   0xdb, 0x8d, 0x42, 0xd2, 0xe0, 0x5a, 0xf0, 0x2,  0x0,  0x6,  0x80, 0xb5, 0x96, 0x72, 0x86, 0xa4, 0x1,
                   0x0,  0x19, 0x92, 0x76, 0x10, 0x4d, 0xa5, 0x21, 0xcd, 0x60, 0x71, 0xf5, 0x61, 0x68, 0x2e, 0xeb, 0x66,
                   0xf5, 0x23, 0x4f, 0xd6, 0x63, 0x3b, 0x86, 0xcb, 0x9b, 0x8,  0x1};

  uint8_t buf[242] = {0};

  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x82, 0xce, 0xc5, 0x3,  0x28, 0x3b, 0x33, 0x69, 0x65, 0xe4, 0x8b,
                                     0x4c, 0xb9, 0x98, 0xc1, 0xcb, 0x14, 0xc8, 0xb,  0x7d, 0x8};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x55, 0xb,  0x2c, 0xc8, 0x6f, 0x7,  0x48, 0xc0, 0x82, 0xe3, 0xec, 0xb4, 0x3d,
                                     0x32, 0xf0, 0xfd, 0xa7, 0x21, 0x8b, 0x74, 0xc,  0xad, 0x2d, 0x8c, 0x4d};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x9f, 0x44, 0x1c, 0xc7, 0x6d, 0x5d, 0x4a, 0x1,  0x47, 0x88, 0x59, 0x37, 0x72,
                                     0x37, 0xa0, 0xfc, 0xe7, 0xb9, 0x2f, 0xac, 0xcd, 0x4e, 0x2e, 0xc1, 0x39, 0x56};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0x84, 0x91, 0x4a, 0xa0, 0x33, 0xd8, 0x2d, 0x66, 0x14, 0x58, 0x8e, 0xbc};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x58, 0x7f, 0xe3, 0x50, 0x20, 0xf2, 0x32, 0x33, 0xaf, 0x0,
                                     0x56, 0x43, 0xf3, 0x6a, 0x6c, 0x96, 0x94, 0x42, 0xfa, 0x6d};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1b, 0xe5, 0x26, 0xb9, 0x60, 0xf6, 0x0, 0x52,
                                     0x4c, 0xa8, 0xd8, 0x43, 0x3b, 0xa5, 0xa7};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x9,  0x38, 0x92, 0xa9, 0xfd, 0x9c, 0x5e, 0x9d, 0x19, 0x7c, 0x8d, 0x7e, 0x74,
                                     0xcd, 0x6c, 0xa0, 0x3,  0xff, 0x89, 0x8e, 0x76, 0xbc, 0x22, 0x12, 0x32};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x55, 0x28, 0x21, 0x1f, 0xae, 0xfa, 0x9c, 0x5a, 0x1b};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x1f, 0xdb, 0x8d, 0x42, 0xd2, 0xe0, 0x5a, 0xf0};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x80, 0xb5, 0x96, 0x72, 0x86, 0xa4};
  lwmqtt_string_t topic_filter_s9 = {6, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x92, 0x76, 0x10, 0x4d, 0xa5, 0x21, 0xcd, 0x60, 0x71, 0xf5, 0x61, 0x68, 0x2e,
                                      0xeb, 0x66, 0xf5, 0x23, 0x4f, 0xd6, 0x63, 0x3b, 0x86, 0xcb, 0x9b, 0x8};
  lwmqtt_string_t topic_filter_s10 = {25, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2,
                               LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23203, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13111 [("\222\SYN24:\156\202\f\132\ETX\186\240",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\v\bAF\245\&5\231\181\211\&88\180\244\224q\245\&2\137||\146\&2\ESC\186p`",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("z-Q\ETX\250}\168H\222\137\DC4\"\170",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\br\NUL\ENQ]\221\ETXkL\190o\238.#\227\230\EM\169wd",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\189\224\230\&0x$\EOTbXn\EM)\200\184\154ZeB\a\136Q+\233\158B",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\r\182,I",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("G\130\251\147\twO",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\188",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\222\RS\248\196\163\204P",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\160hI\180~R7W\238",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\174\215\218\172V{\162\237\153\169\144\SO\STXM\190\n\135U\180\173\SYN\244\&5\227$\154\ACK\194\249\249",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0xbd, 0x1,  0x33, 0x37, 0x0,  0xc,  0xde, 0x16, 0x32, 0x34, 0x3a, 0x9c, 0xca, 0xc,  0x84,
                   0x3,  0xba, 0xf0, 0x1,  0x0,  0x1a, 0xb,  0x8,  0x41, 0x46, 0xf5, 0x35, 0xe7, 0xb5, 0xd3, 0x38,
                   0x38, 0xb4, 0xf4, 0xe0, 0x71, 0xf5, 0x32, 0x89, 0x7c, 0x7c, 0x92, 0x32, 0x1b, 0xba, 0x70, 0x60,
                   0x0,  0x0,  0xd,  0x7a, 0x2d, 0x51, 0x3,  0xfa, 0x7d, 0xa8, 0x48, 0xde, 0x89, 0x14, 0x22, 0xaa,
                   0x1,  0x0,  0x14, 0x8,  0x72, 0x0,  0x5,  0x5d, 0xdd, 0x3,  0x6b, 0x4c, 0xbe, 0x6f, 0xee, 0x2e,
                   0x23, 0xe3, 0xe6, 0x19, 0xa9, 0x77, 0x64, 0x1,  0x0,  0x19, 0xbd, 0xe0, 0xe6, 0x30, 0x78, 0x24,
                   0x4,  0x62, 0x58, 0x6e, 0x19, 0x29, 0xc8, 0xb8, 0x9a, 0x5a, 0x65, 0x42, 0x7,  0x88, 0x51, 0x2b,
                   0xe9, 0x9e, 0x42, 0x2,  0x0,  0x4,  0xd,  0xb6, 0x2c, 0x49, 0x2,  0x0,  0x7,  0x47, 0x82, 0xfb,
                   0x93, 0x9,  0x77, 0x4f, 0x2,  0x0,  0x1,  0xbc, 0x0,  0x0,  0x7,  0xde, 0x1e, 0xf8, 0xc4, 0xa3,
                   0xcc, 0x50, 0x0,  0x0,  0x9,  0xa0, 0x68, 0x49, 0xb4, 0x7e, 0x52, 0x37, 0x57, 0xee, 0x2,  0x0,
                   0x1e, 0xae, 0xd7, 0xda, 0xac, 0x56, 0x7b, 0xa2, 0xed, 0x99, 0xa9, 0x90, 0xe,  0x2,  0x4d, 0xbe,
                   0xa,  0x87, 0x55, 0xb4, 0xad, 0x16, 0xf4, 0x35, 0xe3, 0x24, 0x9a, 0x6,  0xc2, 0xf9, 0xf9, 0x0};

  uint8_t buf[202] = {0};

  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xde, 0x16, 0x32, 0x34, 0x3a, 0x9c, 0xca, 0xc, 0x84, 0x3, 0xba, 0xf0};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb,  0x8,  0x41, 0x46, 0xf5, 0x35, 0xe7, 0xb5, 0xd3, 0x38, 0x38, 0xb4, 0xf4,
                                     0xe0, 0x71, 0xf5, 0x32, 0x89, 0x7c, 0x7c, 0x92, 0x32, 0x1b, 0xba, 0x70, 0x60};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7a, 0x2d, 0x51, 0x3, 0xfa, 0x7d, 0xa8, 0x48, 0xde, 0x89, 0x14, 0x22, 0xaa};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8,  0x72, 0x0,  0x5,  0x5d, 0xdd, 0x3,  0x6b, 0x4c, 0xbe,
                                     0x6f, 0xee, 0x2e, 0x23, 0xe3, 0xe6, 0x19, 0xa9, 0x77, 0x64};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbd, 0xe0, 0xe6, 0x30, 0x78, 0x24, 0x4,  0x62, 0x58, 0x6e, 0x19, 0x29, 0xc8,
                                     0xb8, 0x9a, 0x5a, 0x65, 0x42, 0x7,  0x88, 0x51, 0x2b, 0xe9, 0x9e, 0x42};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd, 0xb6, 0x2c, 0x49};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x47, 0x82, 0xfb, 0x93, 0x9, 0x77, 0x4f};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbc};
  lwmqtt_string_t topic_filter_s7 = {1, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xde, 0x1e, 0xf8, 0xc4, 0xa3, 0xcc, 0x50};
  lwmqtt_string_t topic_filter_s8 = {7, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa0, 0x68, 0x49, 0xb4, 0x7e, 0x52, 0x37, 0x57, 0xee};
  lwmqtt_string_t topic_filter_s9 = {9, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xae, 0xd7, 0xda, 0xac, 0x56, 0x7b, 0xa2, 0xed, 0x99, 0xa9,
                                      0x90, 0xe,  0x2,  0x4d, 0xbe, 0xa,  0x87, 0x55, 0xb4, 0xad,
                                      0x16, 0xf4, 0x35, 0xe3, 0x24, 0x9a, 0x6,  0xc2, 0xf9, 0xf9};
  lwmqtt_string_t topic_filter_s10 = {30, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13111, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22578 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS =
// QoS2}),("Y\180\175\251o\184au\195\159\207(+B\f\233\165\201\242\165\130\246Y\187q\CANg\155",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("R,\DC1w\SI\227c}",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\134\NUL\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\US6\195Ct\137l\EOT\155\185\230\144\143H\n\vU!\196",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\195T\236\253h\n\197\181\188\199\206\134\174\196\215\FS\165\227'\220\DC1m}\206\164;\249\SOHR",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x6e, 0x58, 0x32, 0x0,  0x0,  0x2,  0x0,  0x1c, 0x59, 0xb4, 0xaf, 0xfb, 0x6f, 0xb8, 0x61,
                   0x75, 0xc3, 0x9f, 0xcf, 0x28, 0x2b, 0x42, 0xc,  0xe9, 0xa5, 0xc9, 0xf2, 0xa5, 0x82, 0xf6, 0x59,
                   0xbb, 0x71, 0x18, 0x67, 0x9b, 0x2,  0x0,  0x8,  0x52, 0x2c, 0x11, 0x77, 0xf,  0xe3, 0x63, 0x7d,
                   0x1,  0x0,  0x3,  0x86, 0x0,  0xe8, 0x0,  0x0,  0x0,  0x1,  0x0,  0x13, 0x1f, 0x36, 0xc3, 0x43,
                   0x74, 0x89, 0x6c, 0x4,  0x9b, 0xb9, 0xe6, 0x90, 0x8f, 0x48, 0xa,  0xb,  0x55, 0x21, 0xc4, 0x1,
                   0x0,  0x1d, 0xc3, 0x54, 0xec, 0xfd, 0x68, 0xa,  0xc5, 0xb5, 0xbc, 0xc7, 0xce, 0x86, 0xae, 0xc4,
                   0xd7, 0x1c, 0xa5, 0xe3, 0x27, 0xdc, 0x11, 0x6d, 0x7d, 0xce, 0xa4, 0x3b, 0xf9, 0x1,  0x52, 0x2};

  uint8_t buf[122] = {0};

  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x59, 0xb4, 0xaf, 0xfb, 0x6f, 0xb8, 0x61, 0x75, 0xc3, 0x9f,
                                     0xcf, 0x28, 0x2b, 0x42, 0xc,  0xe9, 0xa5, 0xc9, 0xf2, 0xa5,
                                     0x82, 0xf6, 0x59, 0xbb, 0x71, 0x18, 0x67, 0x9b};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x52, 0x2c, 0x11, 0x77, 0xf, 0xe3, 0x63, 0x7d};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x86, 0x0, 0xe8};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1f, 0x36, 0xc3, 0x43, 0x74, 0x89, 0x6c, 0x4,  0x9b, 0xb9,
                                     0xe6, 0x90, 0x8f, 0x48, 0xa,  0xb,  0x55, 0x21, 0xc4};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc3, 0x54, 0xec, 0xfd, 0x68, 0xa,  0xc5, 0xb5, 0xbc, 0xc7,
                                     0xce, 0x86, 0xae, 0xc4, 0xd7, 0x1c, 0xa5, 0xe3, 0x27, 0xdc,
                                     0x11, 0x6d, 0x7d, 0xce, 0xa4, 0x3b, 0xf9, 0x1,  0x52};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22578, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5714 [("Z\154\192",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("n\209\131",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\236[5",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("+l\193\192-m.\NUL\128\147\191\196\DC4\255
// \250\233P\183w\192\176F-\192\208\158\201\172\231",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("A\222\209\219\SO\f\212\243or\200\&4",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x44, 0x16, 0x52, 0x0,  0x3,  0x5a, 0x9a, 0xc0, 0x0,  0x0,  0x3,  0x6e, 0xd1,
                   0x83, 0x2,  0x0,  0x3,  0xec, 0x5b, 0x35, 0x1,  0x0,  0x1e, 0x2b, 0x6c, 0xc1, 0xc0,
                   0x2d, 0x6d, 0x2e, 0x0,  0x80, 0x93, 0xbf, 0xc4, 0x14, 0xff, 0x20, 0xfa, 0xe9, 0x50,
                   0xb7, 0x77, 0xc0, 0xb0, 0x46, 0x2d, 0xc0, 0xd0, 0x9e, 0xc9, 0xac, 0xe7, 0x1,  0x0,
                   0xc,  0x41, 0xde, 0xd1, 0xdb, 0xe,  0xc,  0xd4, 0xf3, 0x6f, 0x72, 0xc8, 0x34, 0x1};

  uint8_t buf[80] = {0};

  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x5a, 0x9a, 0xc0};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e, 0xd1, 0x83};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec, 0x5b, 0x35};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0x6c, 0xc1, 0xc0, 0x2d, 0x6d, 0x2e, 0x0,  0x80, 0x93,
                                     0xbf, 0xc4, 0x14, 0xff, 0x20, 0xfa, 0xe9, 0x50, 0xb7, 0x77,
                                     0xc0, 0xb0, 0x46, 0x2d, 0xc0, 0xd0, 0x9e, 0xc9, 0xac, 0xe7};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x41, 0xde, 0xd1, 0xdb, 0xe, 0xc, 0xd4, 0xf3, 0x6f, 0x72, 0xc8, 0x34};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5714, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3531 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\254\134x\175,x\231\DC3\SOHJ\EOT",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\132bW\232H.\t\251\ACK\185\246\221\163",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\240\158)|E\240\&8\229\159#3\US$\GS\163\142\184\204\a\254\249\NAK\212}",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(".\US\239\142\182M\DC2\228v\142",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("\145\239\128\212\215v\211R\239\248\165M\231oh\163\192PE\213\174\249\165\218\ETB\148",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("'\251\128\148
// \133P@7h",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\v\210V\DLE\245\137\166\n\v!:\NAK\231Y\SYN\215\n\247\191g\147\RS\STX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("FH\178&\154",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x9a, 0x1,  0xd,  0xcb, 0x0,  0x0,  0x0,  0x0,  0xb,  0xfe, 0x86, 0x78, 0xaf, 0x2c, 0x78,
                   0xe7, 0x13, 0x1,  0x4a, 0x4,  0x2,  0x0,  0xd,  0x84, 0x62, 0x57, 0xe8, 0x48, 0x2e, 0x9,  0xfb,
                   0x6,  0xb9, 0xf6, 0xdd, 0xa3, 0x0,  0x0,  0x18, 0xf0, 0x9e, 0x29, 0x7c, 0x45, 0xf0, 0x38, 0xe5,
                   0x9f, 0x23, 0x33, 0x1f, 0x24, 0x1d, 0xa3, 0x8e, 0xb8, 0xcc, 0x7,  0xfe, 0xf9, 0x15, 0xd4, 0x7d,
                   0x2,  0x0,  0xa,  0x2e, 0x1f, 0xef, 0x8e, 0xb6, 0x4d, 0x12, 0xe4, 0x76, 0x8e, 0x2,  0x0,  0x1a,
                   0x91, 0xef, 0x80, 0xd4, 0xd7, 0x76, 0xd3, 0x52, 0xef, 0xf8, 0xa5, 0x4d, 0xe7, 0x6f, 0x68, 0xa3,
                   0xc0, 0x50, 0x45, 0xd5, 0xae, 0xf9, 0xa5, 0xda, 0x17, 0x94, 0x2,  0x0,  0xa,  0x27, 0xfb, 0x80,
                   0x94, 0x20, 0x85, 0x50, 0x40, 0x37, 0x68, 0x2,  0x0,  0x17, 0xb,  0xd2, 0x56, 0x10, 0xf5, 0x89,
                   0xa6, 0xa,  0xb,  0x21, 0x3a, 0x15, 0xe7, 0x59, 0x16, 0xd7, 0xa,  0xf7, 0xbf, 0x67, 0x93, 0x1e,
                   0x2,  0x2,  0x0,  0x0,  0x0,  0x0,  0x5,  0x46, 0x48, 0xb2, 0x26, 0x9a, 0x2};

  uint8_t buf[167] = {0};

  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfe, 0x86, 0x78, 0xaf, 0x2c, 0x78, 0xe7, 0x13, 0x1, 0x4a, 0x4};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0x62, 0x57, 0xe8, 0x48, 0x2e, 0x9, 0xfb, 0x6, 0xb9, 0xf6, 0xdd, 0xa3};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf0, 0x9e, 0x29, 0x7c, 0x45, 0xf0, 0x38, 0xe5, 0x9f, 0x23, 0x33, 0x1f,
                                     0x24, 0x1d, 0xa3, 0x8e, 0xb8, 0xcc, 0x7,  0xfe, 0xf9, 0x15, 0xd4, 0x7d};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2e, 0x1f, 0xef, 0x8e, 0xb6, 0x4d, 0x12, 0xe4, 0x76, 0x8e};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x91, 0xef, 0x80, 0xd4, 0xd7, 0x76, 0xd3, 0x52, 0xef, 0xf8, 0xa5, 0x4d, 0xe7,
                                     0x6f, 0x68, 0xa3, 0xc0, 0x50, 0x45, 0xd5, 0xae, 0xf9, 0xa5, 0xda, 0x17, 0x94};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x27, 0xfb, 0x80, 0x94, 0x20, 0x85, 0x50, 0x40, 0x37, 0x68};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb,  0xd2, 0x56, 0x10, 0xf5, 0x89, 0xa6, 0xa,  0xb,  0x21, 0x3a, 0x15,
                                     0xe7, 0x59, 0x16, 0xd7, 0xa,  0xf7, 0xbf, 0x67, 0x93, 0x1e, 0x2};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0};
  lwmqtt_string_t topic_filter_s8 = {0, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x46, 0x48, 0xb2, 0x26, 0x9a};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3531, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27385 [("\203r\138\235\US\213\196\158\177\226",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\210\190\198\&0ofo\DC1|E\r\rL\152\233\224d\199",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\237\&4\212\155\143\216\v\200\DEL\206\242\145\213W\133\216HU\FSK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\149\ETX\DC3%\228\238+\165\167r\NAKr\178\170",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("4\244y\238\205\153\213",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\135",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\187\224\219\172\\$\133[rk\157\200\159O\ENQ@\167\217\254<q\173\US\186\137\238\v\SYN\233\187",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("m4\218W\235\134Kd\175\189\214RiO",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\195\254V\a\211\157\&1?JL\210m\nZ\195\&3\v",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropReceiveMaximum
// 20429,PropUserProperty "\193"
// "\188C\192\153\192\230A\231WSt\132\189[\DC4B\176\228\247O\174\128\136\213\179\255\173\232\"0",PropSubscriptionIdentifierAvailable
// 152,PropAuthenticationMethod "\153x\250\184\242\SOH\195\190",PropSessionExpiryInterval
// 15605,PropSubscriptionIdentifierAvailable 220,PropMaximumQoS 247,PropReceiveMaximum 2807,PropMaximumQoS
// 94,PropCorrelationData "",PropWillDelayInterval 23153,PropReasonString
// "bOZRd\a\227\217\255u\156\248DW\ESCg\146\215\233\200\157\193",PropUserProperty
// "\168\160\245`?:\216G\SYN4\241\177\237\DC3" "u:\148_\181\&7\199\GS\136\DC3I$9 \176\186",PropSessionExpiryInterval
// 1621,PropRetainAvailable 254,PropServerKeepAlive 28200,PropServerKeepAlive 26260]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x82, 0xb5, 0x2,  0x6a, 0xf9, 0x93, 0x1,  0x21, 0x4f, 0xcd, 0x26, 0x0,  0x1,  0xc1, 0x0,  0x1e, 0xbc, 0x43, 0xc0,
      0x99, 0xc0, 0xe6, 0x41, 0xe7, 0x57, 0x53, 0x74, 0x84, 0xbd, 0x5b, 0x14, 0x42, 0xb0, 0xe4, 0xf7, 0x4f, 0xae, 0x80,
      0x88, 0xd5, 0xb3, 0xff, 0xad, 0xe8, 0x22, 0x30, 0x29, 0x98, 0x15, 0x0,  0x8,  0x99, 0x78, 0xfa, 0xb8, 0xf2, 0x1,
      0xc3, 0xbe, 0x11, 0x0,  0x0,  0x3c, 0xf5, 0x29, 0xdc, 0x24, 0xf7, 0x21, 0xa,  0xf7, 0x24, 0x5e, 0x9,  0x0,  0x0,
      0x18, 0x0,  0x0,  0x5a, 0x71, 0x1f, 0x0,  0x16, 0x62, 0x4f, 0x5a, 0x52, 0x64, 0x7,  0xe3, 0xd9, 0xff, 0x75, 0x9c,
      0xf8, 0x44, 0x57, 0x1b, 0x67, 0x92, 0xd7, 0xe9, 0xc8, 0x9d, 0xc1, 0x26, 0x0,  0xe,  0xa8, 0xa0, 0xf5, 0x60, 0x3f,
      0x3a, 0xd8, 0x47, 0x16, 0x34, 0xf1, 0xb1, 0xed, 0x13, 0x0,  0x10, 0x75, 0x3a, 0x94, 0x5f, 0xb5, 0x37, 0xc7, 0x1d,
      0x88, 0x13, 0x49, 0x24, 0x39, 0x20, 0xb0, 0xba, 0x11, 0x0,  0x0,  0x6,  0x55, 0x25, 0xfe, 0x13, 0x6e, 0x28, 0x13,
      0x66, 0x94, 0x0,  0xa,  0xcb, 0x72, 0x8a, 0xeb, 0x1f, 0xd5, 0xc4, 0x9e, 0xb1, 0xe2, 0x1,  0x0,  0x12, 0xd2, 0xbe,
      0xc6, 0x30, 0x6f, 0x66, 0x6f, 0x11, 0x7c, 0x45, 0xd,  0xd,  0x4c, 0x98, 0xe9, 0xe0, 0x64, 0xc7, 0x2,  0x0,  0x14,
      0xed, 0x34, 0xd4, 0x9b, 0x8f, 0xd8, 0xb,  0xc8, 0x7f, 0xce, 0xf2, 0x91, 0xd5, 0x57, 0x85, 0xd8, 0x48, 0x55, 0x1c,
      0x4b, 0x2,  0x0,  0xe,  0x95, 0x3,  0x13, 0x25, 0xe4, 0xee, 0x2b, 0xa5, 0xa7, 0x72, 0x15, 0x72, 0xb2, 0xaa, 0x1,
      0x0,  0x7,  0x34, 0xf4, 0x79, 0xee, 0xcd, 0x99, 0xd5, 0x0,  0x0,  0x1,  0x87, 0x1,  0x0,  0x1e, 0xbb, 0xe0, 0xdb,
      0xac, 0x5c, 0x24, 0x85, 0x5b, 0x72, 0x6b, 0x9d, 0xc8, 0x9f, 0x4f, 0x5,  0x40, 0xa7, 0xd9, 0xfe, 0x3c, 0x71, 0xad,
      0x1f, 0xba, 0x89, 0xee, 0xb,  0x16, 0xe9, 0xbb, 0x2,  0x0,  0xe,  0x6d, 0x34, 0xda, 0x57, 0xeb, 0x86, 0x4b, 0x64,
      0xaf, 0xbd, 0xd6, 0x52, 0x69, 0x4f, 0x0,  0x0,  0x11, 0xc3, 0xfe, 0x56, 0x7,  0xd3, 0x9d, 0x31, 0x3f, 0x4a, 0x4c,
      0xd2, 0x6d, 0xa,  0x5a, 0xc3, 0x33, 0xb,  0x1};

  uint8_t buf[322] = {0};

  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xcb, 0x72, 0x8a, 0xeb, 0x1f, 0xd5, 0xc4, 0x9e, 0xb1, 0xe2};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd2, 0xbe, 0xc6, 0x30, 0x6f, 0x66, 0x6f, 0x11, 0x7c,
                                     0x45, 0xd,  0xd,  0x4c, 0x98, 0xe9, 0xe0, 0x64, 0xc7};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xed, 0x34, 0xd4, 0x9b, 0x8f, 0xd8, 0xb,  0xc8, 0x7f, 0xce,
                                     0xf2, 0x91, 0xd5, 0x57, 0x85, 0xd8, 0x48, 0x55, 0x1c, 0x4b};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x95, 0x3, 0x13, 0x25, 0xe4, 0xee, 0x2b, 0xa5, 0xa7, 0x72, 0x15, 0x72, 0xb2, 0xaa};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x34, 0xf4, 0x79, 0xee, 0xcd, 0x99, 0xd5};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x87};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbb, 0xe0, 0xdb, 0xac, 0x5c, 0x24, 0x85, 0x5b, 0x72, 0x6b,
                                     0x9d, 0xc8, 0x9f, 0x4f, 0x5,  0x40, 0xa7, 0xd9, 0xfe, 0x3c,
                                     0x71, 0xad, 0x1f, 0xba, 0x89, 0xee, 0xb,  0x16, 0xe9, 0xbb};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6d, 0x34, 0xda, 0x57, 0xeb, 0x86, 0x4b,
                                     0x64, 0xaf, 0xbd, 0xd6, 0x52, 0x69, 0x4f};
  lwmqtt_string_t topic_filter_s7 = {14, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc3, 0xfe, 0x56, 0x7, 0xd3, 0x9d, 0x31, 0x3f, 0x4a,
                                     0x4c, 0xd2, 0x6d, 0xa, 0x5a, 0xc3, 0x33, 0xb};
  lwmqtt_string_t topic_filter_s8 = {17, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops1[] = {0xbc, 0x43, 0xc0, 0x99, 0xc0, 0xe6, 0x41, 0xe7, 0x57, 0x53, 0x74, 0x84, 0xbd, 0x5b, 0x14,
                           0x42, 0xb0, 0xe4, 0xf7, 0x4f, 0xae, 0x80, 0x88, 0xd5, 0xb3, 0xff, 0xad, 0xe8, 0x22, 0x30};
  uint8_t bytesprops0[] = {0xc1};
  uint8_t bytesprops2[] = {0x99, 0x78, 0xfa, 0xb8, 0xf2, 0x1, 0xc3, 0xbe};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x62, 0x4f, 0x5a, 0x52, 0x64, 0x7,  0xe3, 0xd9, 0xff, 0x75, 0x9c,
                           0xf8, 0x44, 0x57, 0x1b, 0x67, 0x92, 0xd7, 0xe9, 0xc8, 0x9d, 0xc1};
  uint8_t bytesprops6[] = {0x75, 0x3a, 0x94, 0x5f, 0xb5, 0x37, 0xc7, 0x1d,
                           0x88, 0x13, 0x49, 0x24, 0x39, 0x20, 0xb0, 0xba};
  uint8_t bytesprops5[] = {0xa8, 0xa0, 0xf5, 0x60, 0x3f, 0x3a, 0xd8, 0x47, 0x16, 0x34, 0xf1, 0xb1, 0xed, 0x13};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20429}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops0}, .v = {30, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15605}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2807}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23153}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops5}, .v = {16, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1621}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28200}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26260}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27385, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22666 [("G\DLE\141c\141\r",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\DLEq\227\252\175\246{\157\250\NUL\231",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\175\SO.Id[",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("p\210\142F\178\242R\233\138\188\253$$r\142\SYN\244\167k\195",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropSubscriptionIdentifier
// 11,PropAssignedClientIdentifier "r",PropSubscriptionIdentifier 21,PropMaximumQoS 17,PropSessionExpiryInterval
// 25518,PropSubscriptionIdentifierAvailable 52,PropAuthenticationMethod
// "Vl\175z'\GS\DC3\176\131\238\194\201\247\165\&4\143\240\234\201",PropServerKeepAlive 7849,PropSubscriptionIdentifier
// 31,PropReceiveMaximum 29865,PropMaximumPacketSize 6256,PropRetainAvailable 83,PropRetainAvailable
// 104,PropUserProperty "\ax\198\170\185\135\247;\250\245Fv\186W\CAN\SOH\155\178\150\223\SYN\174\170>{n\138"
// "}\a\nj\GS\191U\238\192\204\&4\213.\238\178j\DEL\255\222\167\190\&7\218\144\US(\SOH",PropContentType
// "p\232-\135\244\&4\220O{F\192\ESC z\166a\213\183\133Z@4\132\155\EOTiy"]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x82, 0xcc, 0x1,  0x58, 0x8a, 0x91, 0x1,  0xb,  0xb,  0x12, 0x0,  0x1,  0x72, 0xb,  0x15, 0x24, 0x11, 0x11, 0x0,
      0x0,  0x63, 0xae, 0x29, 0x34, 0x15, 0x0,  0x13, 0x56, 0x6c, 0xaf, 0x7a, 0x27, 0x1d, 0x13, 0xb0, 0x83, 0xee, 0xc2,
      0xc9, 0xf7, 0xa5, 0x34, 0x8f, 0xf0, 0xea, 0xc9, 0x13, 0x1e, 0xa9, 0xb,  0x1f, 0x21, 0x74, 0xa9, 0x27, 0x0,  0x0,
      0x18, 0x70, 0x25, 0x53, 0x25, 0x68, 0x26, 0x0,  0x1b, 0x7,  0x78, 0xc6, 0xaa, 0xb9, 0x87, 0xf7, 0x3b, 0xfa, 0xf5,
      0x46, 0x76, 0xba, 0x57, 0x18, 0x1,  0x9b, 0xb2, 0x96, 0xdf, 0x16, 0xae, 0xaa, 0x3e, 0x7b, 0x6e, 0x8a, 0x0,  0x1b,
      0x7d, 0x7,  0xa,  0x6a, 0x1d, 0xbf, 0x55, 0xee, 0xc0, 0xcc, 0x34, 0xd5, 0x2e, 0xee, 0xb2, 0x6a, 0x7f, 0xff, 0xde,
      0xa7, 0xbe, 0x37, 0xda, 0x90, 0x1f, 0x28, 0x1,  0x3,  0x0,  0x1b, 0x70, 0xe8, 0x2d, 0x87, 0xf4, 0x34, 0xdc, 0x4f,
      0x7b, 0x46, 0xc0, 0x1b, 0x20, 0x7a, 0xa6, 0x61, 0xd5, 0xb7, 0x85, 0x5a, 0x40, 0x34, 0x84, 0x9b, 0x4,  0x69, 0x79,
      0x0,  0x6,  0x47, 0x10, 0x8d, 0x63, 0x8d, 0xd,  0x2,  0x0,  0xb,  0x10, 0x71, 0xe3, 0xfc, 0xaf, 0xf6, 0x7b, 0x9d,
      0xfa, 0x0,  0xe7, 0x0,  0x0,  0x6,  0xaf, 0xe,  0x2e, 0x49, 0x64, 0x5b, 0x1,  0x0,  0x14, 0x70, 0xd2, 0x8e, 0x46,
      0xb2, 0xf2, 0x52, 0xe9, 0x8a, 0xbc, 0xfd, 0x24, 0x24, 0x72, 0x8e, 0x16, 0xf4, 0xa7, 0x6b, 0xc3, 0x2};

  uint8_t buf[217] = {0};

  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0x10, 0x8d, 0x63, 0x8d, 0xd};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x10, 0x71, 0xe3, 0xfc, 0xaf, 0xf6, 0x7b, 0x9d, 0xfa, 0x0, 0xe7};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xaf, 0xe, 0x2e, 0x49, 0x64, 0x5b};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x70, 0xd2, 0x8e, 0x46, 0xb2, 0xf2, 0x52, 0xe9, 0x8a, 0xbc,
                                     0xfd, 0x24, 0x24, 0x72, 0x8e, 0x16, 0xf4, 0xa7, 0x6b, 0xc3};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x72};
  uint8_t bytesprops1[] = {0x56, 0x6c, 0xaf, 0x7a, 0x27, 0x1d, 0x13, 0xb0, 0x83, 0xee,
                           0xc2, 0xc9, 0xf7, 0xa5, 0x34, 0x8f, 0xf0, 0xea, 0xc9};
  uint8_t bytesprops3[] = {0x7d, 0x7,  0xa,  0x6a, 0x1d, 0xbf, 0x55, 0xee, 0xc0, 0xcc, 0x34, 0xd5, 0x2e, 0xee,
                           0xb2, 0x6a, 0x7f, 0xff, 0xde, 0xa7, 0xbe, 0x37, 0xda, 0x90, 0x1f, 0x28, 0x1};
  uint8_t bytesprops2[] = {0x7,  0x78, 0xc6, 0xaa, 0xb9, 0x87, 0xf7, 0x3b, 0xfa, 0xf5, 0x46, 0x76, 0xba, 0x57,
                           0x18, 0x1,  0x9b, 0xb2, 0x96, 0xdf, 0x16, 0xae, 0xaa, 0x3e, 0x7b, 0x6e, 0x8a};
  uint8_t bytesprops4[] = {0x70, 0xe8, 0x2d, 0x87, 0xf4, 0x34, 0xdc, 0x4f, 0x7b, 0x46, 0xc0, 0x1b, 0x20, 0x7a,
                           0xa6, 0x61, 0xd5, 0xb7, 0x85, 0x5a, 0x40, 0x34, 0x84, 0x9b, 0x4,  0x69, 0x79};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 11}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25518}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7849}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29865}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6256}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops2}, .v = {27, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22666, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7099 [("\131J\165\202",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\r\242#[",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("+",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\165>^\202\145\206\SOH\DC1\152\r\214\128\148\140",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\246\&2\186",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2})] [PropRetainAvailable 23,PropRequestProblemInformation 43,PropServerReference
// "\149\145Y",PropResponseTopic "\132_\140",PropServerReference "\fz",PropReceiveMaximum 18811,PropRetainAvailable
// 158,PropWildcardSubscriptionAvailable 164,PropTopicAlias 6160,PropAssignedClientIdentifier
// "\214\136\&8\169n\199\207h\134\ETB\190\nL\236J\DC4",PropTopicAlias 2203,PropMessageExpiryInterval
// 26792,PropWildcardSubscriptionAvailable 89,PropRequestProblemInformation 98,PropWillDelayInterval
// 5160,PropResponseTopic
// "\167\254S\214Z7\219\209\b\226`\176\203\195\170JQM\162\139\135\235,",PropRequestProblemInformation
// 200,PropRequestResponseInformation 104,PropRetainAvailable 212,PropServerKeepAlive 9758,PropServerReference
// "\226B\250p\221E\137\146\254\179&\173\249\EOT\213\194\DC4"]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0xa6, 0x1,  0x1b, 0xbb, 0x7a, 0x25, 0x17, 0x17, 0x2b, 0x1c, 0x0,  0x3,  0x95, 0x91, 0x59, 0x8,
                   0x0,  0x3,  0x84, 0x5f, 0x8c, 0x1c, 0x0,  0x2,  0xc,  0x7a, 0x21, 0x49, 0x7b, 0x25, 0x9e, 0x28, 0xa4,
                   0x23, 0x18, 0x10, 0x12, 0x0,  0x10, 0xd6, 0x88, 0x38, 0xa9, 0x6e, 0xc7, 0xcf, 0x68, 0x86, 0x17, 0xbe,
                   0xa,  0x4c, 0xec, 0x4a, 0x14, 0x23, 0x8,  0x9b, 0x2,  0x0,  0x0,  0x68, 0xa8, 0x28, 0x59, 0x17, 0x62,
                   0x18, 0x0,  0x0,  0x14, 0x28, 0x8,  0x0,  0x17, 0xa7, 0xfe, 0x53, 0xd6, 0x5a, 0x37, 0xdb, 0xd1, 0x8,
                   0xe2, 0x60, 0xb0, 0xcb, 0xc3, 0xaa, 0x4a, 0x51, 0x4d, 0xa2, 0x8b, 0x87, 0xeb, 0x2c, 0x17, 0xc8, 0x19,
                   0x68, 0x25, 0xd4, 0x13, 0x26, 0x1e, 0x1c, 0x0,  0x11, 0xe2, 0x42, 0xfa, 0x70, 0xdd, 0x45, 0x89, 0x92,
                   0xfe, 0xb3, 0x26, 0xad, 0xf9, 0x4,  0xd5, 0xc2, 0x14, 0x0,  0x4,  0x83, 0x4a, 0xa5, 0xca, 0x2,  0x0,
                   0x4,  0xd,  0xf2, 0x23, 0x5b, 0x0,  0x0,  0x1,  0x2b, 0x2,  0x0,  0xe,  0xa5, 0x3e, 0x5e, 0xca, 0x91,
                   0xce, 0x1,  0x11, 0x98, 0xd,  0xd6, 0x80, 0x94, 0x8c, 0x0,  0x0,  0x3,  0xf6, 0x32, 0xba, 0x2};

  uint8_t buf[179] = {0};

  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x83, 0x4a, 0xa5, 0xca};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd, 0xf2, 0x23, 0x5b};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2b};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa5, 0x3e, 0x5e, 0xca, 0x91, 0xce, 0x1, 0x11, 0x98, 0xd, 0xd6, 0x80, 0x94, 0x8c};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf6, 0x32, 0xba};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x95, 0x91, 0x59};
  uint8_t bytesprops1[] = {0x84, 0x5f, 0x8c};
  uint8_t bytesprops2[] = {0xc, 0x7a};
  uint8_t bytesprops3[] = {0xd6, 0x88, 0x38, 0xa9, 0x6e, 0xc7, 0xcf, 0x68,
                           0x86, 0x17, 0xbe, 0xa,  0x4c, 0xec, 0x4a, 0x14};
  uint8_t bytesprops4[] = {0xa7, 0xfe, 0x53, 0xd6, 0x5a, 0x37, 0xdb, 0xd1, 0x8,  0xe2, 0x60, 0xb0,
                           0xcb, 0xc3, 0xaa, 0x4a, 0x51, 0x4d, 0xa2, 0x8b, 0x87, 0xeb, 0x2c};
  uint8_t bytesprops5[] = {0xe2, 0x42, 0xfa, 0x70, 0xdd, 0x45, 0x89, 0x92, 0xfe,
                           0xb3, 0x26, 0xad, 0xf9, 0x4,  0xd5, 0xc2, 0x14};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18811}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6160}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2203}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26792}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5160}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9758}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7099, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 835 [("\160\159FO\167\\r\224\141\226\228-\226\247\r@\206\&1w",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS9\DLE\253:\192\SOH/M#\196\191O\159f",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\NULT\227e\232\&8\141\133n#\DLE.\193\163\199\173\&0\184\&9\231\190\253\DEL\144\SUB\130\137\210",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})]
// [PropResponseTopic "\\<O\151\244\218\164c\160\226\226\219\232]\141\167RL+\200:\152\162\209",PropServerReference
// "\164/wO\DELx4D\156&\211\218",PropRetainAvailable 41,PropResponseInformation
// "\249\234\188V\190;\233\243\237\204\210\208?\192\215\187\200\b\178v\220\NAK1\179\220{\144&",PropContentType
// "\160",PropServerReference "\249&\246L{ar\202\195\222l\162\DC3\236\160",PropMessageExpiryInterval
// 15479,PropUserProperty "\DLE\173\254wQ\174:\229'\EM\220\DLE\DC2"
// "d\b\166r\146\145\237\142\SIRz\156\NUL(\156A\209",PropTopicAlias 13475,PropServerReference
// "",PropMessageExpiryInterval 18338,PropResponseInformation "\253\238\v\t2",PropReceiveMaximum
// 16143,PropSessionExpiryInterval 30740,PropRetainAvailable 164,PropUserProperty
// "\RS\NAK\152\183\186\RSAHl\133|\221\234\163\138"
// "\173\236D\174\134\207\198V\ACK{\182\162-<$\228Y\154\143\t\178\235\&6\131\SUB\199r",PropSessionExpiryInterval
// 24821,PropWildcardSubscriptionAvailable 30,PropPayloadFormatIndicator 190,PropReasonString
// "\229\157\200\240\144\145O\145\SO\GS\175\171eY$!\236\237I\236\CAN\213r|",PropReceiveMaximum
// 13577,PropRequestProblemInformation 121,PropAuthenticationData
// "[\130/]\243\228\200{)X\178[\206S\165\b\211\196\157\232y\194z\192\252\249"]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xe6, 0x2,  0x3,  0x43, 0x9b, 0x2,  0x8,  0x0,  0x18, 0x5c, 0x3c, 0x4f, 0x97, 0xf4, 0xda, 0xa4, 0x63, 0xa0,
      0xe2, 0xe2, 0xdb, 0xe8, 0x5d, 0x8d, 0xa7, 0x52, 0x4c, 0x2b, 0xc8, 0x3a, 0x98, 0xa2, 0xd1, 0x1c, 0x0,  0xc,  0xa4,
      0x2f, 0x77, 0x4f, 0x7f, 0x78, 0x34, 0x44, 0x9c, 0x26, 0xd3, 0xda, 0x25, 0x29, 0x1a, 0x0,  0x1c, 0xf9, 0xea, 0xbc,
      0x56, 0xbe, 0x3b, 0xe9, 0xf3, 0xed, 0xcc, 0xd2, 0xd0, 0x3f, 0xc0, 0xd7, 0xbb, 0xc8, 0x8,  0xb2, 0x76, 0xdc, 0x15,
      0x31, 0xb3, 0xdc, 0x7b, 0x90, 0x26, 0x3,  0x0,  0x1,  0xa0, 0x1c, 0x0,  0xf,  0xf9, 0x26, 0xf6, 0x4c, 0x7b, 0x61,
      0x72, 0xca, 0xc3, 0xde, 0x6c, 0xa2, 0x13, 0xec, 0xa0, 0x2,  0x0,  0x0,  0x3c, 0x77, 0x26, 0x0,  0xd,  0x10, 0xad,
      0xfe, 0x77, 0x51, 0xae, 0x3a, 0xe5, 0x27, 0x19, 0xdc, 0x10, 0x12, 0x0,  0x11, 0x64, 0x8,  0xa6, 0x72, 0x92, 0x91,
      0xed, 0x8e, 0xf,  0x52, 0x7a, 0x9c, 0x0,  0x28, 0x9c, 0x41, 0xd1, 0x23, 0x34, 0xa3, 0x1c, 0x0,  0x0,  0x2,  0x0,
      0x0,  0x47, 0xa2, 0x1a, 0x0,  0x5,  0xfd, 0xee, 0xb,  0x9,  0x32, 0x21, 0x3f, 0xf,  0x11, 0x0,  0x0,  0x78, 0x14,
      0x25, 0xa4, 0x26, 0x0,  0xf,  0x1e, 0x15, 0x98, 0xb7, 0xba, 0x1e, 0x41, 0x48, 0x6c, 0x85, 0x7c, 0xdd, 0xea, 0xa3,
      0x8a, 0x0,  0x1b, 0xad, 0xec, 0x44, 0xae, 0x86, 0xcf, 0xc6, 0x56, 0x6,  0x7b, 0xb6, 0xa2, 0x2d, 0x3c, 0x24, 0xe4,
      0x59, 0x9a, 0x8f, 0x9,  0xb2, 0xeb, 0x36, 0x83, 0x1a, 0xc7, 0x72, 0x11, 0x0,  0x0,  0x60, 0xf5, 0x28, 0x1e, 0x1,
      0xbe, 0x1f, 0x0,  0x18, 0xe5, 0x9d, 0xc8, 0xf0, 0x90, 0x91, 0x4f, 0x91, 0xe,  0x1d, 0xaf, 0xab, 0x65, 0x59, 0x24,
      0x21, 0xec, 0xed, 0x49, 0xec, 0x18, 0xd5, 0x72, 0x7c, 0x21, 0x35, 0x9,  0x17, 0x79, 0x16, 0x0,  0x1a, 0x5b, 0x82,
      0x2f, 0x5d, 0xf3, 0xe4, 0xc8, 0x7b, 0x29, 0x58, 0xb2, 0x5b, 0xce, 0x53, 0xa5, 0x8,  0xd3, 0xc4, 0x9d, 0xe8, 0x79,
      0xc2, 0x7a, 0xc0, 0xfc, 0xf9, 0x0,  0x13, 0xa0, 0x9f, 0x46, 0x4f, 0xa7, 0x5c, 0x72, 0xe0, 0x8d, 0xe2, 0xe4, 0x2d,
      0xe2, 0xf7, 0xd,  0x40, 0xce, 0x31, 0x77, 0x0,  0x0,  0xf,  0x1d, 0x39, 0x10, 0xfd, 0x3a, 0xc0, 0x1,  0x2f, 0x4d,
      0x23, 0xc4, 0xbf, 0x4f, 0x9f, 0x66, 0x0,  0x0,  0x1c, 0x0,  0x54, 0xe3, 0x65, 0xe8, 0x38, 0x8d, 0x85, 0x6e, 0x23,
      0x10, 0x2e, 0xc1, 0xa3, 0xc7, 0xad, 0x30, 0xb8, 0x39, 0xe7, 0xbe, 0xfd, 0x7f, 0x90, 0x1a, 0x82, 0x89, 0xd2, 0x1};

  uint8_t buf[371] = {0};

  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xa0, 0x9f, 0x46, 0x4f, 0xa7, 0x5c, 0x72, 0xe0, 0x8d, 0xe2,
                                     0xe4, 0x2d, 0xe2, 0xf7, 0xd,  0x40, 0xce, 0x31, 0x77};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1d, 0x39, 0x10, 0xfd, 0x3a, 0xc0, 0x1, 0x2f,
                                     0x4d, 0x23, 0xc4, 0xbf, 0x4f, 0x9f, 0x66};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x0,  0x54, 0xe3, 0x65, 0xe8, 0x38, 0x8d, 0x85, 0x6e, 0x23,
                                     0x10, 0x2e, 0xc1, 0xa3, 0xc7, 0xad, 0x30, 0xb8, 0x39, 0xe7,
                                     0xbe, 0xfd, 0x7f, 0x90, 0x1a, 0x82, 0x89, 0xd2};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x5c, 0x3c, 0x4f, 0x97, 0xf4, 0xda, 0xa4, 0x63, 0xa0, 0xe2, 0xe2, 0xdb,
                           0xe8, 0x5d, 0x8d, 0xa7, 0x52, 0x4c, 0x2b, 0xc8, 0x3a, 0x98, 0xa2, 0xd1};
  uint8_t bytesprops1[] = {0xa4, 0x2f, 0x77, 0x4f, 0x7f, 0x78, 0x34, 0x44, 0x9c, 0x26, 0xd3, 0xda};
  uint8_t bytesprops2[] = {0xf9, 0xea, 0xbc, 0x56, 0xbe, 0x3b, 0xe9, 0xf3, 0xed, 0xcc, 0xd2, 0xd0, 0x3f, 0xc0,
                           0xd7, 0xbb, 0xc8, 0x8,  0xb2, 0x76, 0xdc, 0x15, 0x31, 0xb3, 0xdc, 0x7b, 0x90, 0x26};
  uint8_t bytesprops3[] = {0xa0};
  uint8_t bytesprops4[] = {0xf9, 0x26, 0xf6, 0x4c, 0x7b, 0x61, 0x72, 0xca, 0xc3, 0xde, 0x6c, 0xa2, 0x13, 0xec, 0xa0};
  uint8_t bytesprops6[] = {0x64, 0x8,  0xa6, 0x72, 0x92, 0x91, 0xed, 0x8e, 0xf,
                           0x52, 0x7a, 0x9c, 0x0,  0x28, 0x9c, 0x41, 0xd1};
  uint8_t bytesprops5[] = {0x10, 0xad, 0xfe, 0x77, 0x51, 0xae, 0x3a, 0xe5, 0x27, 0x19, 0xdc, 0x10, 0x12};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0xfd, 0xee, 0xb, 0x9, 0x32};
  uint8_t bytesprops10[] = {0xad, 0xec, 0x44, 0xae, 0x86, 0xcf, 0xc6, 0x56, 0x6,  0x7b, 0xb6, 0xa2, 0x2d, 0x3c,
                            0x24, 0xe4, 0x59, 0x9a, 0x8f, 0x9,  0xb2, 0xeb, 0x36, 0x83, 0x1a, 0xc7, 0x72};
  uint8_t bytesprops9[] = {0x1e, 0x15, 0x98, 0xb7, 0xba, 0x1e, 0x41, 0x48, 0x6c, 0x85, 0x7c, 0xdd, 0xea, 0xa3, 0x8a};
  uint8_t bytesprops11[] = {0xe5, 0x9d, 0xc8, 0xf0, 0x90, 0x91, 0x4f, 0x91, 0xe,  0x1d, 0xaf, 0xab,
                            0x65, 0x59, 0x24, 0x21, 0xec, 0xed, 0x49, 0xec, 0x18, 0xd5, 0x72, 0x7c};
  uint8_t bytesprops12[] = {0x5b, 0x82, 0x2f, 0x5d, 0xf3, 0xe4, 0xc8, 0x7b, 0x29, 0x58, 0xb2, 0x5b, 0xce,
                            0x53, 0xa5, 0x8,  0xd3, 0xc4, 0x9d, 0xe8, 0x79, 0xc2, 0x7a, 0xc0, 0xfc, 0xf9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15479}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops5}, .v = {17, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13475}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18338}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16143}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30740}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops9}, .v = {27, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24821}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13577}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops12}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 835, 3, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26916 [("g\184\175\169W\207b4\EOTv|>\229C",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropRetainAvailable 96,PropMessageExpiryInterval
// 7158,PropAuthenticationData
// "\ETB^\173{f\146\"\152oK\166\235\161\159\v\182M\rqRoh\154\181\226O\EM^\245",PropPayloadFormatIndicator
// 223,PropSubscriptionIdentifier 12,PropMaximumQoS 231,PropTopicAlias 8619,PropMessageExpiryInterval
// 30952,PropRequestResponseInformation 197,PropWildcardSubscriptionAvailable 255]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x4d, 0x69, 0x24, 0x39, 0x25, 0x60, 0x2,  0x0,  0x0,  0x1b, 0xf6, 0x16, 0x0,  0x1d, 0x17,
                   0x5e, 0xad, 0x7b, 0x66, 0x92, 0x22, 0x98, 0x6f, 0x4b, 0xa6, 0xeb, 0xa1, 0x9f, 0xb,  0xb6, 0x4d,
                   0xd,  0x71, 0x52, 0x6f, 0x68, 0x9a, 0xb5, 0xe2, 0x4f, 0x19, 0x5e, 0xf5, 0x1,  0xdf, 0xb,  0xc,
                   0x24, 0xe7, 0x23, 0x21, 0xab, 0x2,  0x0,  0x0,  0x78, 0xe8, 0x19, 0xc5, 0x28, 0xff, 0x0,  0xe,
                   0x67, 0xb8, 0xaf, 0xa9, 0x57, 0xcf, 0x62, 0x34, 0x4,  0x76, 0x7c, 0x3e, 0xe5, 0x43, 0x1};

  uint8_t buf[89] = {0};

  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x67, 0xb8, 0xaf, 0xa9, 0x57, 0xcf, 0x62, 0x34, 0x4, 0x76, 0x7c, 0x3e, 0xe5, 0x43};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x17, 0x5e, 0xad, 0x7b, 0x66, 0x92, 0x22, 0x98, 0x6f, 0x4b, 0xa6, 0xeb, 0xa1, 0x9f, 0xb,
                           0xb6, 0x4d, 0xd,  0x71, 0x52, 0x6f, 0x68, 0x9a, 0xb5, 0xe2, 0x4f, 0x19, 0x5e, 0xf5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7158}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8619}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30952}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 255}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26916, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23203 [("\130\206\197\ETX(;3ie\228\139L\185\152\193\203\DC4\200\v}\b",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("U\v,\200o\aH\192\130\227\236\180=2\240\253\167!\139t\f\173-\140M",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\169\159D\FS\199m]J\SOHG\136Y7r7\160\252\231\185/\172\205N.\193\&9V",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\182\132\145J\160\&3\216-f\DC4X\142\188",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("X\DEL\227P \242\&23\175\NULVC\243jl\150\148B\250m",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\ESC\229&\185`\246\NULRL\168\216C;\165\167",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\t8\146\169\253\156^\157\EM|\141~t\205l\160\ETX\255\137\142v\188\"\DC22",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("U(!\US\174\250\156Z\ESC",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\US\219\141B\210\224Z\240",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\128\181\150r\134\164",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\146v\DLEM\165!\205`q\245ah.\235f\245#O\214c;\134\203\155\b",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropUserProperty "O\148)\234\f\SYNf\227\130\194&"
// "\210\168\135\205\202\132#\EOT",PropWillDelayInterval 10640,PropTopicAliasMaximum 24111,PropSubscriptionIdentifier
// 23,PropServerKeepAlive 21621,PropServerReference
// "\248\255\t\NUL\155]\131g8?\216\251\228\199\250yP?\182\133\240i^\234p",PropSharedSubscriptionAvailable
// 247,PropServerKeepAlive 17592,PropAuthenticationMethod
// "\247\222\246\251\&58(\a\229E\185XEx\128\197O\131\FS)\192\253-!\174\SOH\249",PropMaximumPacketSize
// 10655,PropRequestProblemInformation 61,PropCorrelationData
// "\150\170\SOHf\r\176\208\ENQ\205\240\180\a\191h\GS\196<\204\145\US\168\231\210F\149\176\170\&1",PropSessionExpiryInterval
// 16529,PropAuthenticationData
// "\209\159i\191)*\172J\168\&9\232d\239\186\224\133?\242/\174\247%\188\238\US\175\131\181\194",PropCorrelationData
// "yn\222<_3\146a\144&n\204\DC4O\237\205C\CAN\240*\186\235&\225I\188",PropWillDelayInterval 11904,PropContentType
// "\145\150\246\205X\225f\146sU\182\134\155\164~\172Y\182\251\226,>\252\200\177\SO$\136M<",PropAuthenticationData
// "\240@\181\187\&7G",PropPayloadFormatIndicator 120,PropMaximumQoS 55,PropCorrelationData
// "*}/]=\f\GS\147t\133\133\246\184\250\246\NUL\131x\240\207\151\149~6"]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x82, 0x81, 0x4,  0x5a, 0xa3, 0x9a, 0x2,  0x26, 0x0,  0xb,  0x4f, 0x94, 0x29, 0xea, 0xc,  0x16, 0x66, 0xe3, 0x82,
      0xc2, 0x26, 0x0,  0x8,  0xd2, 0xa8, 0x87, 0xcd, 0xca, 0x84, 0x23, 0x4,  0x18, 0x0,  0x0,  0x29, 0x90, 0x22, 0x5e,
      0x2f, 0xb,  0x17, 0x13, 0x54, 0x75, 0x1c, 0x0,  0x19, 0xf8, 0xff, 0x9,  0x0,  0x9b, 0x5d, 0x83, 0x67, 0x38, 0x3f,
      0xd8, 0xfb, 0xe4, 0xc7, 0xfa, 0x79, 0x50, 0x3f, 0xb6, 0x85, 0xf0, 0x69, 0x5e, 0xea, 0x70, 0x2a, 0xf7, 0x13, 0x44,
      0xb8, 0x15, 0x0,  0x1b, 0xf7, 0xde, 0xf6, 0xfb, 0x35, 0x38, 0x28, 0x7,  0xe5, 0x45, 0xb9, 0x58, 0x45, 0x78, 0x80,
      0xc5, 0x4f, 0x83, 0x1c, 0x29, 0xc0, 0xfd, 0x2d, 0x21, 0xae, 0x1,  0xf9, 0x27, 0x0,  0x0,  0x29, 0x9f, 0x17, 0x3d,
      0x9,  0x0,  0x1c, 0x96, 0xaa, 0x1,  0x66, 0xd,  0xb0, 0xd0, 0x5,  0xcd, 0xf0, 0xb4, 0x7,  0xbf, 0x68, 0x1d, 0xc4,
      0x3c, 0xcc, 0x91, 0x1f, 0xa8, 0xe7, 0xd2, 0x46, 0x95, 0xb0, 0xaa, 0x31, 0x11, 0x0,  0x0,  0x40, 0x91, 0x16, 0x0,
      0x1d, 0xd1, 0x9f, 0x69, 0xbf, 0x29, 0x2a, 0xac, 0x4a, 0xa8, 0x39, 0xe8, 0x64, 0xef, 0xba, 0xe0, 0x85, 0x3f, 0xf2,
      0x2f, 0xae, 0xf7, 0x25, 0xbc, 0xee, 0x1f, 0xaf, 0x83, 0xb5, 0xc2, 0x9,  0x0,  0x1a, 0x79, 0x6e, 0xde, 0x3c, 0x5f,
      0x33, 0x92, 0x61, 0x90, 0x26, 0x6e, 0xcc, 0x14, 0x4f, 0xed, 0xcd, 0x43, 0x18, 0xf0, 0x2a, 0xba, 0xeb, 0x26, 0xe1,
      0x49, 0xbc, 0x18, 0x0,  0x0,  0x2e, 0x80, 0x3,  0x0,  0x1e, 0x91, 0x96, 0xf6, 0xcd, 0x58, 0xe1, 0x66, 0x92, 0x73,
      0x55, 0xb6, 0x86, 0x9b, 0xa4, 0x7e, 0xac, 0x59, 0xb6, 0xfb, 0xe2, 0x2c, 0x3e, 0xfc, 0xc8, 0xb1, 0xe,  0x24, 0x88,
      0x4d, 0x3c, 0x16, 0x0,  0x6,  0xf0, 0x40, 0xb5, 0xbb, 0x37, 0x47, 0x1,  0x78, 0x24, 0x37, 0x9,  0x0,  0x18, 0x2a,
      0x7d, 0x2f, 0x5d, 0x3d, 0xc,  0x1d, 0x93, 0x74, 0x85, 0x85, 0xf6, 0xb8, 0xfa, 0xf6, 0x0,  0x83, 0x78, 0xf0, 0xcf,
      0x97, 0x95, 0x7e, 0x36, 0x0,  0x15, 0x82, 0xce, 0xc5, 0x3,  0x28, 0x3b, 0x33, 0x69, 0x65, 0xe4, 0x8b, 0x4c, 0xb9,
      0x98, 0xc1, 0xcb, 0x14, 0xc8, 0xb,  0x7d, 0x8,  0x1,  0x0,  0x19, 0x55, 0xb,  0x2c, 0xc8, 0x6f, 0x7,  0x48, 0xc0,
      0x82, 0xe3, 0xec, 0xb4, 0x3d, 0x32, 0xf0, 0xfd, 0xa7, 0x21, 0x8b, 0x74, 0xc,  0xad, 0x2d, 0x8c, 0x4d, 0x0,  0x0,
      0x1b, 0xa9, 0x9f, 0x44, 0x1c, 0xc7, 0x6d, 0x5d, 0x4a, 0x1,  0x47, 0x88, 0x59, 0x37, 0x72, 0x37, 0xa0, 0xfc, 0xe7,
      0xb9, 0x2f, 0xac, 0xcd, 0x4e, 0x2e, 0xc1, 0x39, 0x56, 0x1,  0x0,  0xd,  0xb6, 0x84, 0x91, 0x4a, 0xa0, 0x33, 0xd8,
      0x2d, 0x66, 0x14, 0x58, 0x8e, 0xbc, 0x1,  0x0,  0x14, 0x58, 0x7f, 0xe3, 0x50, 0x20, 0xf2, 0x32, 0x33, 0xaf, 0x0,
      0x56, 0x43, 0xf3, 0x6a, 0x6c, 0x96, 0x94, 0x42, 0xfa, 0x6d, 0x0,  0x0,  0xf,  0x1b, 0xe5, 0x26, 0xb9, 0x60, 0xf6,
      0x0,  0x52, 0x4c, 0xa8, 0xd8, 0x43, 0x3b, 0xa5, 0xa7, 0x2,  0x0,  0x19, 0x9,  0x38, 0x92, 0xa9, 0xfd, 0x9c, 0x5e,
      0x9d, 0x19, 0x7c, 0x8d, 0x7e, 0x74, 0xcd, 0x6c, 0xa0, 0x3,  0xff, 0x89, 0x8e, 0x76, 0xbc, 0x22, 0x12, 0x32, 0x1,
      0x0,  0x9,  0x55, 0x28, 0x21, 0x1f, 0xae, 0xfa, 0x9c, 0x5a, 0x1b, 0x2,  0x0,  0x8,  0x1f, 0xdb, 0x8d, 0x42, 0xd2,
      0xe0, 0x5a, 0xf0, 0x2,  0x0,  0x6,  0x80, 0xb5, 0x96, 0x72, 0x86, 0xa4, 0x1,  0x0,  0x19, 0x92, 0x76, 0x10, 0x4d,
      0xa5, 0x21, 0xcd, 0x60, 0x71, 0xf5, 0x61, 0x68, 0x2e, 0xeb, 0x66, 0xf5, 0x23, 0x4f, 0xd6, 0x63, 0x3b, 0x86, 0xcb,
      0x9b, 0x8,  0x1};

  uint8_t buf[526] = {0};

  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x82, 0xce, 0xc5, 0x3,  0x28, 0x3b, 0x33, 0x69, 0x65, 0xe4, 0x8b,
                                     0x4c, 0xb9, 0x98, 0xc1, 0xcb, 0x14, 0xc8, 0xb,  0x7d, 0x8};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x55, 0xb,  0x2c, 0xc8, 0x6f, 0x7,  0x48, 0xc0, 0x82, 0xe3, 0xec, 0xb4, 0x3d,
                                     0x32, 0xf0, 0xfd, 0xa7, 0x21, 0x8b, 0x74, 0xc,  0xad, 0x2d, 0x8c, 0x4d};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x9f, 0x44, 0x1c, 0xc7, 0x6d, 0x5d, 0x4a, 0x1,  0x47, 0x88, 0x59, 0x37, 0x72,
                                     0x37, 0xa0, 0xfc, 0xe7, 0xb9, 0x2f, 0xac, 0xcd, 0x4e, 0x2e, 0xc1, 0x39, 0x56};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0x84, 0x91, 0x4a, 0xa0, 0x33, 0xd8, 0x2d, 0x66, 0x14, 0x58, 0x8e, 0xbc};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x58, 0x7f, 0xe3, 0x50, 0x20, 0xf2, 0x32, 0x33, 0xaf, 0x0,
                                     0x56, 0x43, 0xf3, 0x6a, 0x6c, 0x96, 0x94, 0x42, 0xfa, 0x6d};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1b, 0xe5, 0x26, 0xb9, 0x60, 0xf6, 0x0, 0x52,
                                     0x4c, 0xa8, 0xd8, 0x43, 0x3b, 0xa5, 0xa7};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x9,  0x38, 0x92, 0xa9, 0xfd, 0x9c, 0x5e, 0x9d, 0x19, 0x7c, 0x8d, 0x7e, 0x74,
                                     0xcd, 0x6c, 0xa0, 0x3,  0xff, 0x89, 0x8e, 0x76, 0xbc, 0x22, 0x12, 0x32};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x55, 0x28, 0x21, 0x1f, 0xae, 0xfa, 0x9c, 0x5a, 0x1b};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x1f, 0xdb, 0x8d, 0x42, 0xd2, 0xe0, 0x5a, 0xf0};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x80, 0xb5, 0x96, 0x72, 0x86, 0xa4};
  lwmqtt_string_t topic_filter_s9 = {6, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x92, 0x76, 0x10, 0x4d, 0xa5, 0x21, 0xcd, 0x60, 0x71, 0xf5, 0x61, 0x68, 0x2e,
                                      0xeb, 0x66, 0xf5, 0x23, 0x4f, 0xd6, 0x63, 0x3b, 0x86, 0xcb, 0x9b, 0x8};
  lwmqtt_string_t topic_filter_s10 = {25, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2,
                               LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1};
  uint8_t bytesprops1[] = {0xd2, 0xa8, 0x87, 0xcd, 0xca, 0x84, 0x23, 0x4};
  uint8_t bytesprops0[] = {0x4f, 0x94, 0x29, 0xea, 0xc, 0x16, 0x66, 0xe3, 0x82, 0xc2, 0x26};
  uint8_t bytesprops2[] = {0xf8, 0xff, 0x9,  0x0,  0x9b, 0x5d, 0x83, 0x67, 0x38, 0x3f, 0xd8, 0xfb, 0xe4,
                           0xc7, 0xfa, 0x79, 0x50, 0x3f, 0xb6, 0x85, 0xf0, 0x69, 0x5e, 0xea, 0x70};
  uint8_t bytesprops3[] = {0xf7, 0xde, 0xf6, 0xfb, 0x35, 0x38, 0x28, 0x7,  0xe5, 0x45, 0xb9, 0x58, 0x45, 0x78,
                           0x80, 0xc5, 0x4f, 0x83, 0x1c, 0x29, 0xc0, 0xfd, 0x2d, 0x21, 0xae, 0x1,  0xf9};
  uint8_t bytesprops4[] = {0x96, 0xaa, 0x1,  0x66, 0xd,  0xb0, 0xd0, 0x5,  0xcd, 0xf0, 0xb4, 0x7,  0xbf, 0x68,
                           0x1d, 0xc4, 0x3c, 0xcc, 0x91, 0x1f, 0xa8, 0xe7, 0xd2, 0x46, 0x95, 0xb0, 0xaa, 0x31};
  uint8_t bytesprops5[] = {0xd1, 0x9f, 0x69, 0xbf, 0x29, 0x2a, 0xac, 0x4a, 0xa8, 0x39, 0xe8, 0x64, 0xef, 0xba, 0xe0,
                           0x85, 0x3f, 0xf2, 0x2f, 0xae, 0xf7, 0x25, 0xbc, 0xee, 0x1f, 0xaf, 0x83, 0xb5, 0xc2};
  uint8_t bytesprops6[] = {0x79, 0x6e, 0xde, 0x3c, 0x5f, 0x33, 0x92, 0x61, 0x90, 0x26, 0x6e, 0xcc, 0x14,
                           0x4f, 0xed, 0xcd, 0x43, 0x18, 0xf0, 0x2a, 0xba, 0xeb, 0x26, 0xe1, 0x49, 0xbc};
  uint8_t bytesprops7[] = {0x91, 0x96, 0xf6, 0xcd, 0x58, 0xe1, 0x66, 0x92, 0x73, 0x55, 0xb6, 0x86, 0x9b, 0xa4, 0x7e,
                           0xac, 0x59, 0xb6, 0xfb, 0xe2, 0x2c, 0x3e, 0xfc, 0xc8, 0xb1, 0xe,  0x24, 0x88, 0x4d, 0x3c};
  uint8_t bytesprops8[] = {0xf0, 0x40, 0xb5, 0xbb, 0x37, 0x47};
  uint8_t bytesprops9[] = {0x2a, 0x7d, 0x2f, 0x5d, 0x3d, 0xc,  0x1d, 0x93, 0x74, 0x85, 0x85, 0xf6,
                           0xb8, 0xfa, 0xf6, 0x0,  0x83, 0x78, 0xf0, 0xcf, 0x97, 0x95, 0x7e, 0x36};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops0}, .v = {8, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10640}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24111}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21621}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17592}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10655}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16529}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11904}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23203, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13111 [("\222\SYN24:\156\202\f\132\ETX\186\240",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\v\bAF\245\&5\231\181\211\&88\180\244\224q\245\&2\137||\146\&2\ESC\186p`",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("z-Q\ETX\250}\168H\222\137\DC4\"\170",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\br\NUL\ENQ]\221\ETXkL\190o\238.#\227\230\EM\169wd",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\189\224\230\&0x$\EOTbXn\EM)\200\184\154ZeB\a\136Q+\233\158B",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\r\182,I",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("G\130\251\147\twO",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\188",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\222\RS\248\196\163\204P",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\160hI\180~R7W\238",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\174\215\218\172V{\162\237\153\169\144\SO\STXM\190\n\135U\180\173\SYN\244\&5\227$\154\ACK\194\249\249",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropMessageExpiryInterval 6824,PropServerReference "\205{\201\150P\202\142e\f6#5\154",PropMessageExpiryInterval
// 4252,PropSubscriptionIdentifier 22,PropMessageExpiryInterval 4271,PropAssignedClientIdentifier
// "\216\135\ETX/\136\138q_\222?\STX\153\142t5\241\162\195M\162\171\&6N\235o3\247[?",PropRetainAvailable
// 141,PropTopicAliasMaximum 15144,PropSharedSubscriptionAvailable 59,PropServerKeepAlive 26100,PropContentType
// "\176^H\181tT\167\&0\135\186?",PropSubscriptionIdentifier 21,PropPayloadFormatIndicator 171,PropCorrelationData
// "V\242t\188@\DC3\241\212\NUL",PropTopicAliasMaximum 18065,PropSharedSubscriptionAvailable 15]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xac, 0x2,  0x33, 0x37, 0x6e, 0x2,  0x0,  0x0,  0x1a, 0xa8, 0x1c, 0x0,  0xd,  0xcd, 0x7b, 0xc9, 0x96, 0x50,
      0xca, 0x8e, 0x65, 0xc,  0x36, 0x23, 0x35, 0x9a, 0x2,  0x0,  0x0,  0x10, 0x9c, 0xb,  0x16, 0x2,  0x0,  0x0,  0x10,
      0xaf, 0x12, 0x0,  0x1d, 0xd8, 0x87, 0x3,  0x2f, 0x88, 0x8a, 0x71, 0x5f, 0xde, 0x3f, 0x2,  0x99, 0x8e, 0x74, 0x35,
      0xf1, 0xa2, 0xc3, 0x4d, 0xa2, 0xab, 0x36, 0x4e, 0xeb, 0x6f, 0x33, 0xf7, 0x5b, 0x3f, 0x25, 0x8d, 0x22, 0x3b, 0x28,
      0x2a, 0x3b, 0x13, 0x65, 0xf4, 0x3,  0x0,  0xb,  0xb0, 0x5e, 0x48, 0xb5, 0x74, 0x54, 0xa7, 0x30, 0x87, 0xba, 0x3f,
      0xb,  0x15, 0x1,  0xab, 0x9,  0x0,  0x9,  0x56, 0xf2, 0x74, 0xbc, 0x40, 0x13, 0xf1, 0xd4, 0x0,  0x22, 0x46, 0x91,
      0x2a, 0xf,  0x0,  0xc,  0xde, 0x16, 0x32, 0x34, 0x3a, 0x9c, 0xca, 0xc,  0x84, 0x3,  0xba, 0xf0, 0x1,  0x0,  0x1a,
      0xb,  0x8,  0x41, 0x46, 0xf5, 0x35, 0xe7, 0xb5, 0xd3, 0x38, 0x38, 0xb4, 0xf4, 0xe0, 0x71, 0xf5, 0x32, 0x89, 0x7c,
      0x7c, 0x92, 0x32, 0x1b, 0xba, 0x70, 0x60, 0x0,  0x0,  0xd,  0x7a, 0x2d, 0x51, 0x3,  0xfa, 0x7d, 0xa8, 0x48, 0xde,
      0x89, 0x14, 0x22, 0xaa, 0x1,  0x0,  0x14, 0x8,  0x72, 0x0,  0x5,  0x5d, 0xdd, 0x3,  0x6b, 0x4c, 0xbe, 0x6f, 0xee,
      0x2e, 0x23, 0xe3, 0xe6, 0x19, 0xa9, 0x77, 0x64, 0x1,  0x0,  0x19, 0xbd, 0xe0, 0xe6, 0x30, 0x78, 0x24, 0x4,  0x62,
      0x58, 0x6e, 0x19, 0x29, 0xc8, 0xb8, 0x9a, 0x5a, 0x65, 0x42, 0x7,  0x88, 0x51, 0x2b, 0xe9, 0x9e, 0x42, 0x2,  0x0,
      0x4,  0xd,  0xb6, 0x2c, 0x49, 0x2,  0x0,  0x7,  0x47, 0x82, 0xfb, 0x93, 0x9,  0x77, 0x4f, 0x2,  0x0,  0x1,  0xbc,
      0x0,  0x0,  0x7,  0xde, 0x1e, 0xf8, 0xc4, 0xa3, 0xcc, 0x50, 0x0,  0x0,  0x9,  0xa0, 0x68, 0x49, 0xb4, 0x7e, 0x52,
      0x37, 0x57, 0xee, 0x2,  0x0,  0x1e, 0xae, 0xd7, 0xda, 0xac, 0x56, 0x7b, 0xa2, 0xed, 0x99, 0xa9, 0x90, 0xe,  0x2,
      0x4d, 0xbe, 0xa,  0x87, 0x55, 0xb4, 0xad, 0x16, 0xf4, 0x35, 0xe3, 0x24, 0x9a, 0x6,  0xc2, 0xf9, 0xf9, 0x0};

  uint8_t buf[313] = {0};

  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xde, 0x16, 0x32, 0x34, 0x3a, 0x9c, 0xca, 0xc, 0x84, 0x3, 0xba, 0xf0};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb,  0x8,  0x41, 0x46, 0xf5, 0x35, 0xe7, 0xb5, 0xd3, 0x38, 0x38, 0xb4, 0xf4,
                                     0xe0, 0x71, 0xf5, 0x32, 0x89, 0x7c, 0x7c, 0x92, 0x32, 0x1b, 0xba, 0x70, 0x60};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7a, 0x2d, 0x51, 0x3, 0xfa, 0x7d, 0xa8, 0x48, 0xde, 0x89, 0x14, 0x22, 0xaa};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8,  0x72, 0x0,  0x5,  0x5d, 0xdd, 0x3,  0x6b, 0x4c, 0xbe,
                                     0x6f, 0xee, 0x2e, 0x23, 0xe3, 0xe6, 0x19, 0xa9, 0x77, 0x64};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbd, 0xe0, 0xe6, 0x30, 0x78, 0x24, 0x4,  0x62, 0x58, 0x6e, 0x19, 0x29, 0xc8,
                                     0xb8, 0x9a, 0x5a, 0x65, 0x42, 0x7,  0x88, 0x51, 0x2b, 0xe9, 0x9e, 0x42};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd, 0xb6, 0x2c, 0x49};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x47, 0x82, 0xfb, 0x93, 0x9, 0x77, 0x4f};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbc};
  lwmqtt_string_t topic_filter_s7 = {1, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xde, 0x1e, 0xf8, 0xc4, 0xa3, 0xcc, 0x50};
  lwmqtt_string_t topic_filter_s8 = {7, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa0, 0x68, 0x49, 0xb4, 0x7e, 0x52, 0x37, 0x57, 0xee};
  lwmqtt_string_t topic_filter_s9 = {9, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xae, 0xd7, 0xda, 0xac, 0x56, 0x7b, 0xa2, 0xed, 0x99, 0xa9,
                                      0x90, 0xe,  0x2,  0x4d, 0xbe, 0xa,  0x87, 0x55, 0xb4, 0xad,
                                      0x16, 0xf4, 0x35, 0xe3, 0x24, 0x9a, 0x6,  0xc2, 0xf9, 0xf9};
  lwmqtt_string_t topic_filter_s10 = {30, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0xcd, 0x7b, 0xc9, 0x96, 0x50, 0xca, 0x8e, 0x65, 0xc, 0x36, 0x23, 0x35, 0x9a};
  uint8_t bytesprops1[] = {0xd8, 0x87, 0x3,  0x2f, 0x88, 0x8a, 0x71, 0x5f, 0xde, 0x3f, 0x2,  0x99, 0x8e, 0x74, 0x35,
                           0xf1, 0xa2, 0xc3, 0x4d, 0xa2, 0xab, 0x36, 0x4e, 0xeb, 0x6f, 0x33, 0xf7, 0x5b, 0x3f};
  uint8_t bytesprops2[] = {0xb0, 0x5e, 0x48, 0xb5, 0x74, 0x54, 0xa7, 0x30, 0x87, 0xba, 0x3f};
  uint8_t bytesprops3[] = {0x56, 0xf2, 0x74, 0xbc, 0x40, 0x13, 0xf1, 0xd4, 0x0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6824}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4252}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4271}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15144}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26100}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 21}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18065}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13111, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22578 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS =
// QoS2}),("Y\180\175\251o\184au\195\159\207(+B\f\233\165\201\242\165\130\246Y\187q\CANg\155",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("R,\DC1w\SI\227c}",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\134\NUL\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\US6\195Ct\137l\EOT\155\185\230\144\143H\n\vU!\196",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\195T\236\253h\n\197\181\188\199\206\134\174\196\215\FS\165\227'\220\DC1m}\206\164;\249\SOHR",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropMessageExpiryInterval 26993,PropPayloadFormatIndicator 117,PropMaximumQoS 245,PropAuthenticationMethod
// "\196R\165\DC4\SUBV 5e",PropMessageExpiryInterval 26854,PropMessageExpiryInterval 23171,PropResponseInformation
// "\CANh\145Q\246[\212\&5S\177WJ\fA\STX\EM\"\184\f\196\DC4\f7",PropCorrelationData "\171",PropAuthenticationData
// "\174\243\DC3P\181<:w\170\226",PropSubscriptionIdentifier 8,PropServerReference
// "GK\253\187\129\ETXd\240",PropTopicAliasMaximum 3019,PropReasonString "",PropUserProperty
// "\169\218a\DC3|\ETB\216y\DC3\136/\136=GGvdH5>\156\183\203}" "\FSD.;",PropSessionExpiryInterval
// 9051,PropSharedSubscriptionAvailable 97,PropRequestResponseInformation 125,PropContentType
// "\137\255S\254h",PropWillDelayInterval 18039,PropResponseTopic
// "\t\ETXL\138b\200\189\172?\v*\225\228\143z\ESC\231>\217&\231",PropRequestProblemInformation 169,PropTopicAlias
// 8806,PropTopicAliasMaximum 26514,PropWillDelayInterval 11232,PropTopicAliasMaximum 8472,PropReceiveMaximum
// 13639,PropWildcardSubscriptionAvailable 224,PropCorrelationData
// "Cl$9?\DC4k[\129x\181\DLE\233\CANIZF\200",PropPayloadFormatIndicator 94]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x82, 0xc8, 0x2,  0x58, 0x32, 0xd8, 0x1,  0x2,  0x0,  0x0,  0x69, 0x71, 0x1,  0x75, 0x24, 0xf5, 0x15, 0x0,  0x9,
      0xc4, 0x52, 0xa5, 0x14, 0x1a, 0x56, 0x20, 0x35, 0x65, 0x2,  0x0,  0x0,  0x68, 0xe6, 0x2,  0x0,  0x0,  0x5a, 0x83,
      0x1a, 0x0,  0x17, 0x18, 0x68, 0x91, 0x51, 0xf6, 0x5b, 0xd4, 0x35, 0x53, 0xb1, 0x57, 0x4a, 0xc,  0x41, 0x2,  0x19,
      0x22, 0xb8, 0xc,  0xc4, 0x14, 0xc,  0x37, 0x9,  0x0,  0x1,  0xab, 0x16, 0x0,  0xa,  0xae, 0xf3, 0x13, 0x50, 0xb5,
      0x3c, 0x3a, 0x77, 0xaa, 0xe2, 0xb,  0x8,  0x1c, 0x0,  0x8,  0x47, 0x4b, 0xfd, 0xbb, 0x81, 0x3,  0x64, 0xf0, 0x22,
      0xb,  0xcb, 0x1f, 0x0,  0x0,  0x26, 0x0,  0x18, 0xa9, 0xda, 0x61, 0x13, 0x7c, 0x17, 0xd8, 0x79, 0x13, 0x88, 0x2f,
      0x88, 0x3d, 0x47, 0x47, 0x76, 0x64, 0x48, 0x35, 0x3e, 0x9c, 0xb7, 0xcb, 0x7d, 0x0,  0x4,  0x1c, 0x44, 0x2e, 0x3b,
      0x11, 0x0,  0x0,  0x23, 0x5b, 0x2a, 0x61, 0x19, 0x7d, 0x3,  0x0,  0x5,  0x89, 0xff, 0x53, 0xfe, 0x68, 0x18, 0x0,
      0x0,  0x46, 0x77, 0x8,  0x0,  0x15, 0x9,  0x3,  0x4c, 0x8a, 0x62, 0xc8, 0xbd, 0xac, 0x3f, 0xb,  0x2a, 0xe1, 0xe4,
      0x8f, 0x7a, 0x1b, 0xe7, 0x3e, 0xd9, 0x26, 0xe7, 0x17, 0xa9, 0x23, 0x22, 0x66, 0x22, 0x67, 0x92, 0x18, 0x0,  0x0,
      0x2b, 0xe0, 0x22, 0x21, 0x18, 0x21, 0x35, 0x47, 0x28, 0xe0, 0x9,  0x0,  0x12, 0x43, 0x6c, 0x24, 0x39, 0x3f, 0x14,
      0x6b, 0x5b, 0x81, 0x78, 0xb5, 0x10, 0xe9, 0x18, 0x49, 0x5a, 0x46, 0xc8, 0x1,  0x5e, 0x0,  0x0,  0x2,  0x0,  0x1c,
      0x59, 0xb4, 0xaf, 0xfb, 0x6f, 0xb8, 0x61, 0x75, 0xc3, 0x9f, 0xcf, 0x28, 0x2b, 0x42, 0xc,  0xe9, 0xa5, 0xc9, 0xf2,
      0xa5, 0x82, 0xf6, 0x59, 0xbb, 0x71, 0x18, 0x67, 0x9b, 0x2,  0x0,  0x8,  0x52, 0x2c, 0x11, 0x77, 0xf,  0xe3, 0x63,
      0x7d, 0x1,  0x0,  0x3,  0x86, 0x0,  0xe8, 0x0,  0x0,  0x0,  0x1,  0x0,  0x13, 0x1f, 0x36, 0xc3, 0x43, 0x74, 0x89,
      0x6c, 0x4,  0x9b, 0xb9, 0xe6, 0x90, 0x8f, 0x48, 0xa,  0xb,  0x55, 0x21, 0xc4, 0x1,  0x0,  0x1d, 0xc3, 0x54, 0xec,
      0xfd, 0x68, 0xa,  0xc5, 0xb5, 0xbc, 0xc7, 0xce, 0x86, 0xae, 0xc4, 0xd7, 0x1c, 0xa5, 0xe3, 0x27, 0xdc, 0x11, 0x6d,
      0x7d, 0xce, 0xa4, 0x3b, 0xf9, 0x1,  0x52, 0x2};

  uint8_t buf[341] = {0};

  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x59, 0xb4, 0xaf, 0xfb, 0x6f, 0xb8, 0x61, 0x75, 0xc3, 0x9f,
                                     0xcf, 0x28, 0x2b, 0x42, 0xc,  0xe9, 0xa5, 0xc9, 0xf2, 0xa5,
                                     0x82, 0xf6, 0x59, 0xbb, 0x71, 0x18, 0x67, 0x9b};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x52, 0x2c, 0x11, 0x77, 0xf, 0xe3, 0x63, 0x7d};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x86, 0x0, 0xe8};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1f, 0x36, 0xc3, 0x43, 0x74, 0x89, 0x6c, 0x4,  0x9b, 0xb9,
                                     0xe6, 0x90, 0x8f, 0x48, 0xa,  0xb,  0x55, 0x21, 0xc4};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc3, 0x54, 0xec, 0xfd, 0x68, 0xa,  0xc5, 0xb5, 0xbc, 0xc7,
                                     0xce, 0x86, 0xae, 0xc4, 0xd7, 0x1c, 0xa5, 0xe3, 0x27, 0xdc,
                                     0x11, 0x6d, 0x7d, 0xce, 0xa4, 0x3b, 0xf9, 0x1,  0x52};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0xc4, 0x52, 0xa5, 0x14, 0x1a, 0x56, 0x20, 0x35, 0x65};
  uint8_t bytesprops1[] = {0x18, 0x68, 0x91, 0x51, 0xf6, 0x5b, 0xd4, 0x35, 0x53, 0xb1, 0x57, 0x4a,
                           0xc,  0x41, 0x2,  0x19, 0x22, 0xb8, 0xc,  0xc4, 0x14, 0xc,  0x37};
  uint8_t bytesprops2[] = {0xab};
  uint8_t bytesprops3[] = {0xae, 0xf3, 0x13, 0x50, 0xb5, 0x3c, 0x3a, 0x77, 0xaa, 0xe2};
  uint8_t bytesprops4[] = {0x47, 0x4b, 0xfd, 0xbb, 0x81, 0x3, 0x64, 0xf0};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops7[] = {0x1c, 0x44, 0x2e, 0x3b};
  uint8_t bytesprops6[] = {0xa9, 0xda, 0x61, 0x13, 0x7c, 0x17, 0xd8, 0x79, 0x13, 0x88, 0x2f, 0x88,
                           0x3d, 0x47, 0x47, 0x76, 0x64, 0x48, 0x35, 0x3e, 0x9c, 0xb7, 0xcb, 0x7d};
  uint8_t bytesprops8[] = {0x89, 0xff, 0x53, 0xfe, 0x68};
  uint8_t bytesprops9[] = {0x9,  0x3,  0x4c, 0x8a, 0x62, 0xc8, 0xbd, 0xac, 0x3f, 0xb, 0x2a,
                           0xe1, 0xe4, 0x8f, 0x7a, 0x1b, 0xe7, 0x3e, 0xd9, 0x26, 0xe7};
  uint8_t bytesprops10[] = {0x43, 0x6c, 0x24, 0x39, 0x3f, 0x14, 0x6b, 0x5b, 0x81,
                            0x78, 0xb5, 0x10, 0xe9, 0x18, 0x49, 0x5a, 0x46, 0xc8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26993}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26854}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23171}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3019}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops6}, .v = {4, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9051}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18039}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8806}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26514}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11232}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8472}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13639}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 94}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22578, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5714 [("Z\154\192",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("n\209\131",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\236[5",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("+l\193\192-m.\NUL\128\147\191\196\DC4\255
// \250\233P\183w\192\176F-\192\208\158\201\172\231",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("A\222\209\219\SO\f\212\243or\200\&4",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropMessageExpiryInterval
// 28129,PropWillDelayInterval 7503,PropSharedSubscriptionAvailable 212,PropResponseInformation
// "l6\225w\170\&4\241\182",PropSubscriptionIdentifier 12,PropUserProperty
// "\248\202dYf\DEL\153\152x\217\"b\220O\152r\DC4\228\230\209\178P\240\230>"
// "SB\166n;C\173\155Dw\ETX\208\140\180\194\220t\241\213\148\&0\223n\230x\SYNmz\154"]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x99, 0x1,  0x16, 0x52, 0x54, 0x2,  0x0,  0x0,  0x6d, 0xe1, 0x18, 0x0,  0x0,  0x1d, 0x4f,
                   0x2a, 0xd4, 0x1a, 0x0,  0x8,  0x6c, 0x36, 0xe1, 0x77, 0xaa, 0x34, 0xf1, 0xb6, 0xb,  0xc,  0x26,
                   0x0,  0x19, 0xf8, 0xca, 0x64, 0x59, 0x66, 0x7f, 0x99, 0x98, 0x78, 0xd9, 0x22, 0x62, 0xdc, 0x4f,
                   0x98, 0x72, 0x14, 0xe4, 0xe6, 0xd1, 0xb2, 0x50, 0xf0, 0xe6, 0x3e, 0x0,  0x1d, 0x53, 0x42, 0xa6,
                   0x6e, 0x3b, 0x43, 0xad, 0x9b, 0x44, 0x77, 0x3,  0xd0, 0x8c, 0xb4, 0xc2, 0xdc, 0x74, 0xf1, 0xd5,
                   0x94, 0x30, 0xdf, 0x6e, 0xe6, 0x78, 0x16, 0x6d, 0x7a, 0x9a, 0x0,  0x3,  0x5a, 0x9a, 0xc0, 0x0,
                   0x0,  0x3,  0x6e, 0xd1, 0x83, 0x2,  0x0,  0x3,  0xec, 0x5b, 0x35, 0x1,  0x0,  0x1e, 0x2b, 0x6c,
                   0xc1, 0xc0, 0x2d, 0x6d, 0x2e, 0x0,  0x80, 0x93, 0xbf, 0xc4, 0x14, 0xff, 0x20, 0xfa, 0xe9, 0x50,
                   0xb7, 0x77, 0xc0, 0xb0, 0x46, 0x2d, 0xc0, 0xd0, 0x9e, 0xc9, 0xac, 0xe7, 0x1,  0x0,  0xc,  0x41,
                   0xde, 0xd1, 0xdb, 0xe,  0xc,  0xd4, 0xf3, 0x6f, 0x72, 0xc8, 0x34, 0x1};

  uint8_t buf[166] = {0};

  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x5a, 0x9a, 0xc0};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e, 0xd1, 0x83};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec, 0x5b, 0x35};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0x6c, 0xc1, 0xc0, 0x2d, 0x6d, 0x2e, 0x0,  0x80, 0x93,
                                     0xbf, 0xc4, 0x14, 0xff, 0x20, 0xfa, 0xe9, 0x50, 0xb7, 0x77,
                                     0xc0, 0xb0, 0x46, 0x2d, 0xc0, 0xd0, 0x9e, 0xc9, 0xac, 0xe7};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x41, 0xde, 0xd1, 0xdb, 0xe, 0xc, 0xd4, 0xf3, 0x6f, 0x72, 0xc8, 0x34};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x6c, 0x36, 0xe1, 0x77, 0xaa, 0x34, 0xf1, 0xb6};
  uint8_t bytesprops2[] = {0x53, 0x42, 0xa6, 0x6e, 0x3b, 0x43, 0xad, 0x9b, 0x44, 0x77, 0x3,  0xd0, 0x8c, 0xb4, 0xc2,
                           0xdc, 0x74, 0xf1, 0xd5, 0x94, 0x30, 0xdf, 0x6e, 0xe6, 0x78, 0x16, 0x6d, 0x7a, 0x9a};
  uint8_t bytesprops1[] = {0xf8, 0xca, 0x64, 0x59, 0x66, 0x7f, 0x99, 0x98, 0x78, 0xd9, 0x22, 0x62, 0xdc,
                           0x4f, 0x98, 0x72, 0x14, 0xe4, 0xe6, 0xd1, 0xb2, 0x50, 0xf0, 0xe6, 0x3e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28129}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7503}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops1}, .v = {29, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5714, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3531 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\254\134x\175,x\231\DC3\SOHJ\EOT",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\132bW\232H.\t\251\ACK\185\246\221\163",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\240\158)|E\240\&8\229\159#3\US$\GS\163\142\184\204\a\254\249\NAK\212}",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(".\US\239\142\182M\DC2\228v\142",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("\145\239\128\212\215v\211R\239\248\165M\231oh\163\192PE\213\174\249\165\218\ETB\148",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("'\251\128\148
// \133P@7h",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\v\210V\DLE\245\137\166\n\v!:\NAK\231Y\SYN\215\n\247\191g\147\RS\STX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("FH\178&\154",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropMaximumPacketSize 8327,PropSubscriptionIdentifierAvailable 142,PropContentType
// "\234VQb\ETB\227\144^\211\173\227\US\238\USE\CAN\149\134A",PropRetainAvailable 227,PropTopicAliasMaximum
// 1282,PropCorrelationData
// "\221i\226\245e\131b\248\157P\DEL\189\145!\ENQ[q\222+\212\SYN\231j\DC4\233\244A",PropAuthenticationMethod
// "\165HfSK.o\RS\169\ESC\238|l\238\134\148<\193\STXa#\198\SO>",PropUserProperty
// "_ws\206\209\223\224\214\207\182\179\147" "",PropMaximumPacketSize 6778,PropTopicAliasMaximum
// 3766,PropSharedSubscriptionAvailable 102,PropResponseTopic "",PropTopicAliasMaximum 4261,PropWillDelayInterval
// 21768,PropContentType
// "\ENQP\171\163\SUBQ\SYNf\225\158\223\214\171\a\r\218\245\231\213\163\DLE_\US\250\167\n1\206$",PropCorrelationData
// "\167\204\190C E\144Y\214\175\139\199r\v",PropServerReference
// "\RS\237\254\DC3\232\138\251c7\154R~\177\v)\170",PropMaximumQoS 8,PropResponseInformation
// "\180I\209d\175\SI?\132U\225)\175\141\179",PropRequestProblemInformation 155,PropTopicAlias
// 13440,PropSubscriptionIdentifierAvailable 115,PropCorrelationData
// "{Ha~\t\220\231\242\226\240G\157\146cY^'\SYN\243Q\211\241",PropReceiveMaximum 4880]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0x97, 0x3,  0xd,  0xcb, 0xfb, 0x1,  0x27, 0x0,  0x0,  0x20, 0x87, 0x29, 0x8e, 0x3,  0x0,  0x13, 0xea, 0x56,
      0x51, 0x62, 0x17, 0xe3, 0x90, 0x5e, 0xd3, 0xad, 0xe3, 0x1f, 0xee, 0x1f, 0x45, 0x18, 0x95, 0x86, 0x41, 0x25, 0xe3,
      0x22, 0x5,  0x2,  0x9,  0x0,  0x1b, 0xdd, 0x69, 0xe2, 0xf5, 0x65, 0x83, 0x62, 0xf8, 0x9d, 0x50, 0x7f, 0xbd, 0x91,
      0x21, 0x5,  0x5b, 0x71, 0xde, 0x2b, 0xd4, 0x16, 0xe7, 0x6a, 0x14, 0xe9, 0xf4, 0x41, 0x15, 0x0,  0x18, 0xa5, 0x48,
      0x66, 0x53, 0x4b, 0x2e, 0x6f, 0x1e, 0xa9, 0x1b, 0xee, 0x7c, 0x6c, 0xee, 0x86, 0x94, 0x3c, 0xc1, 0x2,  0x61, 0x23,
      0xc6, 0xe,  0x3e, 0x26, 0x0,  0xc,  0x5f, 0x77, 0x73, 0xce, 0xd1, 0xdf, 0xe0, 0xd6, 0xcf, 0xb6, 0xb3, 0x93, 0x0,
      0x0,  0x27, 0x0,  0x0,  0x1a, 0x7a, 0x22, 0xe,  0xb6, 0x2a, 0x66, 0x8,  0x0,  0x0,  0x22, 0x10, 0xa5, 0x18, 0x0,
      0x0,  0x55, 0x8,  0x3,  0x0,  0x1d, 0x5,  0x50, 0xab, 0xa3, 0x1a, 0x51, 0x16, 0x66, 0xe1, 0x9e, 0xdf, 0xd6, 0xab,
      0x7,  0xd,  0xda, 0xf5, 0xe7, 0xd5, 0xa3, 0x10, 0x5f, 0x1f, 0xfa, 0xa7, 0xa,  0x31, 0xce, 0x24, 0x9,  0x0,  0xe,
      0xa7, 0xcc, 0xbe, 0x43, 0x20, 0x45, 0x90, 0x59, 0xd6, 0xaf, 0x8b, 0xc7, 0x72, 0xb,  0x1c, 0x0,  0x10, 0x1e, 0xed,
      0xfe, 0x13, 0xe8, 0x8a, 0xfb, 0x63, 0x37, 0x9a, 0x52, 0x7e, 0xb1, 0xb,  0x29, 0xaa, 0x24, 0x8,  0x1a, 0x0,  0xe,
      0xb4, 0x49, 0xd1, 0x64, 0xaf, 0xf,  0x3f, 0x84, 0x55, 0xe1, 0x29, 0xaf, 0x8d, 0xb3, 0x17, 0x9b, 0x23, 0x34, 0x80,
      0x29, 0x73, 0x9,  0x0,  0x16, 0x7b, 0x48, 0x61, 0x7e, 0x9,  0xdc, 0xe7, 0xf2, 0xe2, 0xf0, 0x47, 0x9d, 0x92, 0x63,
      0x59, 0x5e, 0x27, 0x16, 0xf3, 0x51, 0xd3, 0xf1, 0x21, 0x13, 0x10, 0x0,  0x0,  0x0,  0x0,  0xb,  0xfe, 0x86, 0x78,
      0xaf, 0x2c, 0x78, 0xe7, 0x13, 0x1,  0x4a, 0x4,  0x2,  0x0,  0xd,  0x84, 0x62, 0x57, 0xe8, 0x48, 0x2e, 0x9,  0xfb,
      0x6,  0xb9, 0xf6, 0xdd, 0xa3, 0x0,  0x0,  0x18, 0xf0, 0x9e, 0x29, 0x7c, 0x45, 0xf0, 0x38, 0xe5, 0x9f, 0x23, 0x33,
      0x1f, 0x24, 0x1d, 0xa3, 0x8e, 0xb8, 0xcc, 0x7,  0xfe, 0xf9, 0x15, 0xd4, 0x7d, 0x2,  0x0,  0xa,  0x2e, 0x1f, 0xef,
      0x8e, 0xb6, 0x4d, 0x12, 0xe4, 0x76, 0x8e, 0x2,  0x0,  0x1a, 0x91, 0xef, 0x80, 0xd4, 0xd7, 0x76, 0xd3, 0x52, 0xef,
      0xf8, 0xa5, 0x4d, 0xe7, 0x6f, 0x68, 0xa3, 0xc0, 0x50, 0x45, 0xd5, 0xae, 0xf9, 0xa5, 0xda, 0x17, 0x94, 0x2,  0x0,
      0xa,  0x27, 0xfb, 0x80, 0x94, 0x20, 0x85, 0x50, 0x40, 0x37, 0x68, 0x2,  0x0,  0x17, 0xb,  0xd2, 0x56, 0x10, 0xf5,
      0x89, 0xa6, 0xa,  0xb,  0x21, 0x3a, 0x15, 0xe7, 0x59, 0x16, 0xd7, 0xa,  0xf7, 0xbf, 0x67, 0x93, 0x1e, 0x2,  0x2,
      0x0,  0x0,  0x0,  0x0,  0x5,  0x46, 0x48, 0xb2, 0x26, 0x9a, 0x2};

  uint8_t buf[420] = {0};

  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfe, 0x86, 0x78, 0xaf, 0x2c, 0x78, 0xe7, 0x13, 0x1, 0x4a, 0x4};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0x62, 0x57, 0xe8, 0x48, 0x2e, 0x9, 0xfb, 0x6, 0xb9, 0xf6, 0xdd, 0xa3};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf0, 0x9e, 0x29, 0x7c, 0x45, 0xf0, 0x38, 0xe5, 0x9f, 0x23, 0x33, 0x1f,
                                     0x24, 0x1d, 0xa3, 0x8e, 0xb8, 0xcc, 0x7,  0xfe, 0xf9, 0x15, 0xd4, 0x7d};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2e, 0x1f, 0xef, 0x8e, 0xb6, 0x4d, 0x12, 0xe4, 0x76, 0x8e};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x91, 0xef, 0x80, 0xd4, 0xd7, 0x76, 0xd3, 0x52, 0xef, 0xf8, 0xa5, 0x4d, 0xe7,
                                     0x6f, 0x68, 0xa3, 0xc0, 0x50, 0x45, 0xd5, 0xae, 0xf9, 0xa5, 0xda, 0x17, 0x94};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x27, 0xfb, 0x80, 0x94, 0x20, 0x85, 0x50, 0x40, 0x37, 0x68};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb,  0xd2, 0x56, 0x10, 0xf5, 0x89, 0xa6, 0xa,  0xb,  0x21, 0x3a, 0x15,
                                     0xe7, 0x59, 0x16, 0xd7, 0xa,  0xf7, 0xbf, 0x67, 0x93, 0x1e, 0x2};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0};
  lwmqtt_string_t topic_filter_s8 = {0, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x46, 0x48, 0xb2, 0x26, 0x9a};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0xea, 0x56, 0x51, 0x62, 0x17, 0xe3, 0x90, 0x5e, 0xd3, 0xad,
                           0xe3, 0x1f, 0xee, 0x1f, 0x45, 0x18, 0x95, 0x86, 0x41};
  uint8_t bytesprops1[] = {0xdd, 0x69, 0xe2, 0xf5, 0x65, 0x83, 0x62, 0xf8, 0x9d, 0x50, 0x7f, 0xbd, 0x91, 0x21,
                           0x5,  0x5b, 0x71, 0xde, 0x2b, 0xd4, 0x16, 0xe7, 0x6a, 0x14, 0xe9, 0xf4, 0x41};
  uint8_t bytesprops2[] = {0xa5, 0x48, 0x66, 0x53, 0x4b, 0x2e, 0x6f, 0x1e, 0xa9, 0x1b, 0xee, 0x7c,
                           0x6c, 0xee, 0x86, 0x94, 0x3c, 0xc1, 0x2,  0x61, 0x23, 0xc6, 0xe,  0x3e};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops3[] = {0x5f, 0x77, 0x73, 0xce, 0xd1, 0xdf, 0xe0, 0xd6, 0xcf, 0xb6, 0xb3, 0x93};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x5,  0x50, 0xab, 0xa3, 0x1a, 0x51, 0x16, 0x66, 0xe1, 0x9e, 0xdf, 0xd6, 0xab, 0x7, 0xd,
                           0xda, 0xf5, 0xe7, 0xd5, 0xa3, 0x10, 0x5f, 0x1f, 0xfa, 0xa7, 0xa,  0x31, 0xce, 0x24};
  uint8_t bytesprops7[] = {0xa7, 0xcc, 0xbe, 0x43, 0x20, 0x45, 0x90, 0x59, 0xd6, 0xaf, 0x8b, 0xc7, 0x72, 0xb};
  uint8_t bytesprops8[] = {0x1e, 0xed, 0xfe, 0x13, 0xe8, 0x8a, 0xfb, 0x63,
                           0x37, 0x9a, 0x52, 0x7e, 0xb1, 0xb,  0x29, 0xaa};
  uint8_t bytesprops9[] = {0xb4, 0x49, 0xd1, 0x64, 0xaf, 0xf, 0x3f, 0x84, 0x55, 0xe1, 0x29, 0xaf, 0x8d, 0xb3};
  uint8_t bytesprops10[] = {0x7b, 0x48, 0x61, 0x7e, 0x9,  0xdc, 0xe7, 0xf2, 0xe2, 0xf0, 0x47,
                            0x9d, 0x92, 0x63, 0x59, 0x5e, 0x27, 0x16, 0xf3, 0x51, 0xd3, 0xf1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8327}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1282}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops3}, .v = {0, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6778}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3766}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4261}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21768}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13440}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4880}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3531, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
