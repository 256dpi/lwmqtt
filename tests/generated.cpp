#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = ";\152\218", _pubPktID = 5070,
// _pubBody = "]&\234\205\156\200\SYN\185\NUL\214}\239\191\&6\154waT{\246\173\DC4k\155\211\190", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x3d, 0x21, 0x0,  0x3,  0x3b, 0x98, 0xda, 0x13, 0xce, 0x5d, 0x26, 0xea,
                   0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf, 0x36, 0x9a,
                   0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  uint8_t topic_bytes[] = {0x3b, 0x98, 0xda};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5d, 0x26, 0xea, 0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf,
                         0x36, 0x9a, 0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5070, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = ";\152\218", _pubPktID = 5070,
// _pubBody = "]&\234\205\156\200\SYN\185\NUL\214}\239\191\&6\154waT{\246\173\DC4k\155\211\190", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x3d, 0x21, 0x0,  0x3,  0x3b, 0x98, 0xda, 0x13, 0xce, 0x5d, 0x26, 0xea,
                   0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf, 0x36, 0x9a,
                   0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3b, 0x98, 0xda};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5d, 0x26, 0xea, 0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf,
                              0x36, 0x9a, 0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 5070);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\156n m\218\DC4\ENQ\RS\r\221",
// _pubPktID = 29842, _pubBody = "\n\r\194\171\&847\188\r\239=\228G\244\204\183o\136\148\223SQ", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x3c, 0x24, 0x0,  0xa,  0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5,  0x1e, 0xd,
                   0xdd, 0x74, 0x92, 0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37, 0xbc, 0xd,  0xef,
                   0x3d, 0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  uint8_t topic_bytes[] = {0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5, 0x1e, 0xd, 0xdd};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37, 0xbc, 0xd,  0xef, 0x3d,
                         0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29842, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\156n m\218\DC4\ENQ\RS\r\221",
// _pubPktID = 29842, _pubBody = "\n\r\194\171\&847\188\r\239=\228G\244\204\183o\136\148\223SQ", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x3c, 0x24, 0x0,  0xa,  0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5,  0x1e, 0xd,
                   0xdd, 0x74, 0x92, 0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37, 0xbc, 0xd,  0xef,
                   0x3d, 0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5, 0x1e, 0xd, 0xdd};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37, 0xbc, 0xd,  0xef, 0x3d,
                              0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 29842);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\SUB\143\217", _pubPktID = 816,
// _pubBody = "\246^\255t\204\180\169\214\150&=\195\235\249\176Q\NAK\169\145", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x35, 0x1a, 0x0,  0x3,  0x1a, 0x8f, 0xd9, 0x3,  0x30, 0xf6, 0x5e, 0xff, 0x74, 0xcc,
                   0xb4, 0xa9, 0xd6, 0x96, 0x26, 0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  uint8_t topic_bytes[] = {0x1a, 0x8f, 0xd9};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf6, 0x5e, 0xff, 0x74, 0xcc, 0xb4, 0xa9, 0xd6, 0x96, 0x26,
                         0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 816, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\SUB\143\217", _pubPktID = 816,
// _pubBody = "\246^\255t\204\180\169\214\150&=\195\235\249\176Q\NAK\169\145", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x35, 0x1a, 0x0,  0x3,  0x1a, 0x8f, 0xd9, 0x3,  0x30, 0xf6, 0x5e, 0xff, 0x74, 0xcc,
                   0xb4, 0xa9, 0xd6, 0x96, 0x26, 0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1a, 0x8f, 0xd9};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf6, 0x5e, 0xff, 0x74, 0xcc, 0xb4, 0xa9, 0xd6, 0x96, 0x26,
                              0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 816);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "", _pubPktID = 31057, _pubBody =
// "\199\189\167\ETX\187.\248)\192z\ESC\250{\169\157\255\224d\204\159\r\239\ESC\154Q\171\168", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0x0,  0x79, 0x51, 0xc7, 0xbd, 0xa7, 0x3, 0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b,
                   0xfa, 0x7b, 0xa9, 0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd, 0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc7, 0xbd, 0xa7, 0x3,  0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b, 0xfa, 0x7b, 0xa9,
                         0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd,  0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 31057, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "", _pubPktID = 31057, _pubBody =
// "\199\189\167\ETX\187.\248)\192z\ESC\250{\169\157\255\224d\204\159\r\239\ESC\154Q\171\168", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0x0,  0x79, 0x51, 0xc7, 0xbd, 0xa7, 0x3, 0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b,
                   0xfa, 0x7b, 0xa9, 0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd, 0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc7, 0xbd, 0xa7, 0x3,  0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b, 0xfa, 0x7b, 0xa9,
                              0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd,  0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31057);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\129\199\DEL\236d\144\134\234\&2\161\f\158;^\GS\152", _pubPktID = 0, _pubBody =
// "\168#\DC4\164\152d\226\231\214\203.3\\K\148y\227\211\138\130B\160L0\153\231\154\201\v0", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x39, 0x31, 0x0,  0x11, 0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea,
                   0x32, 0xa1, 0xc,  0x9e, 0x3b, 0x5e, 0x1d, 0x98, 0xa8, 0x23, 0x14, 0xa4, 0x98,
                   0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b, 0x94, 0x79, 0xe3, 0xd3,
                   0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  uint8_t topic_bytes[] = {0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea,
                           0x32, 0xa1, 0xc,  0x9e, 0x3b, 0x5e, 0x1d, 0x98};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa8, 0x23, 0x14, 0xa4, 0x98, 0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b, 0x94,
                         0x79, 0xe3, 0xd3, 0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\129\199\DEL\236d\144\134\234\&2\161\f\158;^\GS\152", _pubPktID = 0, _pubBody =
// "\168#\DC4\164\152d\226\231\214\203.3\\K\148y\227\211\138\130B\160L0\153\231\154\201\v0", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x39, 0x31, 0x0,  0x11, 0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea,
                   0x32, 0xa1, 0xc,  0x9e, 0x3b, 0x5e, 0x1d, 0x98, 0xa8, 0x23, 0x14, 0xa4, 0x98,
                   0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b, 0x94, 0x79, 0xe3, 0xd3,
                   0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea,
                               0x32, 0xa1, 0xc,  0x9e, 0x3b, 0x5e, 0x1d, 0x98};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa8, 0x23, 0x14, 0xa4, 0x98, 0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b, 0x94,
                              0x79, 0xe3, 0xd3, 0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ESC\176mM-\183\&6\136p\203\156\172", _pubPktID = 0, _pubBody = "\DC2\166\130\180V\157\163bV", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x31, 0x17, 0x0,  0xc,  0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70,
                   0xcb, 0x9c, 0xac, 0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  uint8_t topic_bytes[] = {0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70, 0xcb, 0x9c, 0xac};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ESC\176mM-\183\&6\136p\203\156\172", _pubPktID = 0, _pubBody = "\DC2\166\130\180V\157\163bV", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x31, 0x17, 0x0,  0xc,  0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70,
                   0xcb, 0x9c, 0xac, 0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70, 0xcb, 0x9c, 0xac};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\178\SI\169\146\239\178\SYN\STX",
// _pubPktID = 0, _pubBody = "K\148\ETX%\135\&7\194\158\DLE\ENQ\215\157\176\ESCA\f", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x30, 0x1a, 0x0,  0x8,  0xb2, 0xf,  0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2,  0x4b, 0x94,
                   0x3,  0x25, 0x87, 0x37, 0xc2, 0x9e, 0x10, 0x5,  0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  uint8_t topic_bytes[] = {0xb2, 0xf, 0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4b, 0x94, 0x3, 0x25, 0x87, 0x37, 0xc2, 0x9e, 0x10, 0x5, 0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\178\SI\169\146\239\178\SYN\STX",
// _pubPktID = 0, _pubBody = "K\148\ETX%\135\&7\194\158\DLE\ENQ\215\157\176\ESCA\f", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x30, 0x1a, 0x0,  0x8,  0xb2, 0xf,  0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2,  0x4b, 0x94,
                   0x3,  0x25, 0x87, 0x37, 0xc2, 0x9e, 0x10, 0x5,  0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb2, 0xf, 0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4b, 0x94, 0x3,  0x25, 0x87, 0x37, 0xc2, 0x9e,
                              0x10, 0x5,  0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\164Y\252JlD$\198\DC1l\vM\194\NAK\194I\144\STX:c\158)N*", _pubPktID = 7891, _pubBody =
// "\176\162\NAK'B\224M\185\SYNa\n\151\146\160U", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x35, 0x2b, 0x0,  0x18, 0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,
                   0x4d, 0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a, 0x1e, 0xd3,
                   0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d, 0xb9, 0x16, 0x61, 0xa,  0x97, 0x92, 0xa0, 0x55};
  uint8_t topic_bytes[] = {0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,  0x4d,
                           0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d, 0xb9, 0x16, 0x61, 0xa, 0x97, 0x92, 0xa0, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7891, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\164Y\252JlD$\198\DC1l\vM\194\NAK\194I\144\STX:c\158)N*", _pubPktID = 7891, _pubBody =
// "\176\162\NAK'B\224M\185\SYNa\n\151\146\160U", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x35, 0x2b, 0x0,  0x18, 0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,
                   0x4d, 0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a, 0x1e, 0xd3,
                   0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d, 0xb9, 0x16, 0x61, 0xa,  0x97, 0x92, 0xa0, 0x55};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,  0x4d,
                               0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d, 0xb9, 0x16, 0x61, 0xa, 0x97, 0x92, 0xa0, 0x55};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 7891);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\168\NAKx\SI\199\207\184(\186\150r\FS\189\205\252\135\250\205\254\148\161\239\228\176s", _pubPktID = 0, _pubBody =
// "\135", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x31, 0x1c, 0x0,  0x19, 0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72,
                   0x1c, 0xbd, 0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73, 0x87};
  uint8_t topic_bytes[] = {0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72, 0x1c, 0xbd,
                           0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x87};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\168\NAKx\SI\199\207\184(\186\150r\FS\189\205\252\135\250\205\254\148\161\239\228\176s", _pubPktID = 0, _pubBody =
// "\135", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x31, 0x1c, 0x0,  0x19, 0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72,
                   0x1c, 0xbd, 0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73, 0x87};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72, 0x1c, 0xbd,
                               0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x87};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\140r\DC3\130\161\ENQ", _pubPktID =
// 6491, _pubBody = "\241G\235!\175\252\158\183\145\224\246\172\SYN\130\131/\254\205\ENQ\GS?", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0x6,  0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5,  0x19, 0x5b, 0xf1, 0x47, 0xeb, 0x21, 0xaf,
                   0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6, 0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  uint8_t topic_bytes[] = {0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf1, 0x47, 0xeb, 0x21, 0xaf, 0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6,
                         0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6491, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\140r\DC3\130\161\ENQ", _pubPktID =
// 6491, _pubBody = "\241G\235!\175\252\158\183\145\224\246\172\SYN\130\131/\254\205\ENQ\GS?", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0x6,  0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5,  0x19, 0x5b, 0xf1, 0x47, 0xeb, 0x21, 0xaf,
                   0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6, 0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf1, 0x47, 0xeb, 0x21, 0xaf, 0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6,
                              0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6491);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\239\238\236\203\SI", _pubPktID =
// 8912, _pubBody = "\fH\EOT\166q\ESC\ESC\185\177A", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x32, 0x13, 0x0, 0x5,  0xef, 0xee, 0xec, 0xcb, 0xf,  0x22, 0xd0,
                   0xc,  0x48, 0x4, 0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  uint8_t topic_bytes[] = {0xef, 0xee, 0xec, 0xcb, 0xf};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc, 0x48, 0x4, 0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 8912, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\239\238\236\203\SI", _pubPktID =
// 8912, _pubBody = "\fH\EOT\166q\ESC\ESC\185\177A", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x32, 0x13, 0x0, 0x5,  0xef, 0xee, 0xec, 0xcb, 0xf,  0x22, 0xd0,
                   0xc,  0x48, 0x4, 0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xef, 0xee, 0xec, 0xcb, 0xf};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc, 0x48, 0x4, 0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8912);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "[", _pubPktID = 16570, _pubBody =
// "\173\247\147\148\f{|ku\211\&0\DC3\224\227di\ETX\214[\DEL\138I\133\r8{", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0x1,  0x5b, 0x40, 0xba, 0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3,
                   0x30, 0x13, 0xe0, 0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  uint8_t topic_bytes[] = {0x5b};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3, 0x30, 0x13, 0xe0,
                         0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 16570, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "[", _pubPktID = 16570, _pubBody =
// "\173\247\147\148\f{|ku\211\&0\DC3\224\227di\ETX\214[\DEL\138I\133\r8{", _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0x1,  0x5b, 0x40, 0xba, 0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3,
                   0x30, 0x13, 0xe0, 0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3, 0x30, 0x13, 0xe0,
                              0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16570);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\187Ue\150\168f\243G", _pubPktID =
// 0, _pubBody = "Y\133", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x38, 0xc, 0x0, 0x8, 0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47, 0x59, 0x85};
  uint8_t topic_bytes[] = {0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x59, 0x85};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\187Ue\150\168f\243G", _pubPktID =
// 0, _pubBody = "Y\133", _pubProps = []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x38, 0xc, 0x0, 0x8, 0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47, 0x59, 0x85};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x59, 0x85};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\165\&4\a\246}\148\174\&8\186i\137\223\STX*Sv", _pubPktID = 0, _pubBody = "\243\233\SOH\134\243=c\212", _pubProps =
// []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x30, 0x1a, 0x0, 0x10, 0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38, 0xba, 0x69,
                   0x89, 0xdf, 0x2, 0x2a, 0x53, 0x76, 0xf3, 0xe9, 0x1,  0x86, 0xf3, 0x3d, 0x63, 0xd4};
  uint8_t topic_bytes[] = {0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38,
                           0xba, 0x69, 0x89, 0xdf, 0x2,  0x2a, 0x53, 0x76};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf3, 0xe9, 0x1, 0x86, 0xf3, 0x3d, 0x63, 0xd4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\165\&4\a\246}\148\174\&8\186i\137\223\STX*Sv", _pubPktID = 0, _pubBody = "\243\233\SOH\134\243=c\212", _pubProps =
// []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x30, 0x1a, 0x0, 0x10, 0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38, 0xba, 0x69,
                   0x89, 0xdf, 0x2, 0x2a, 0x53, 0x76, 0xf3, 0xe9, 0x1,  0x86, 0xf3, 0x3d, 0x63, 0xd4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38,
                               0xba, 0x69, 0x89, 0xdf, 0x2,  0x2a, 0x53, 0x76};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf3, 0xe9, 0x1, 0x86, 0xf3, 0x3d, 0x63, 0xd4};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 10766, _pubBody =
// "\178", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x3b, 0x5, 0x0, 0x0, 0x2a, 0xe, 0xb2};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10766, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 10766, _pubBody =
// "\178", _pubProps = []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x3b, 0x5, 0x0, 0x0, 0x2a, 0xe, 0xb2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb2};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10766);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\138\GSJ\143\233", _pubPktID = 6943,
// _pubBody = "\137\139\192l\219\138Z\225\185\164}d\US[\179", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x3c, 0x18, 0x0,  0x5,  0x8a, 0x1d, 0x4a, 0x8f, 0xe9, 0x1b, 0x1f, 0x89, 0x8b,
                   0xc0, 0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  uint8_t topic_bytes[] = {0x8a, 0x1d, 0x4a, 0x8f, 0xe9};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x89, 0x8b, 0xc0, 0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6943, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\138\GSJ\143\233", _pubPktID = 6943,
// _pubBody = "\137\139\192l\219\138Z\225\185\164}d\US[\179", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x3c, 0x18, 0x0,  0x5,  0x8a, 0x1d, 0x4a, 0x8f, 0xe9, 0x1b, 0x1f, 0x89, 0x8b,
                   0xc0, 0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8a, 0x1d, 0x4a, 0x8f, 0xe9};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x89, 0x8b, 0xc0, 0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6943);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\225y\a\222\215\130\238h\b\159\152x\153\151\162\213\177\165X\184]\135\187\189 \214", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x38, 0x1c, 0x0,  0x0,  0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98,
                   0x78, 0x99, 0x97, 0xa2, 0xd5, 0xb1, 0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98, 0x78, 0x99,
                         0x97, 0xa2, 0xd5, 0xb1, 0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\225y\a\222\215\130\238h\b\159\152x\153\151\162\213\177\165X\184]\135\187\189 \214", _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x38, 0x1c, 0x0,  0x0,  0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98,
                   0x78, 0x99, 0x97, 0xa2, 0xd5, 0xb1, 0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98, 0x78, 0x99,
                              0x97, 0xa2, 0xd5, 0xb1, 0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "6\218tea\v\174S\163\234\130\GS\208\155\GS\DLE\ENQ\ESC\178\165 \153\DC2\155v,\165", _pubPktID = 27993, _pubBody =
// "\158 %1\177\201\t\236L", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x32, 0x28, 0x0,  0x1b, 0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea,
                   0x82, 0x1d, 0xd0, 0x9b, 0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b,
                   0x76, 0x2c, 0xa5, 0x6d, 0x59, 0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9,  0xec, 0x4c};
  uint8_t topic_bytes[] = {0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea, 0x82, 0x1d, 0xd0, 0x9b,
                           0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b, 0x76, 0x2c, 0xa5};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9, 0xec, 0x4c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 27993, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "6\218tea\v\174S\163\234\130\GS\208\155\GS\DLE\ENQ\ESC\178\165 \153\DC2\155v,\165", _pubPktID = 27993, _pubBody =
// "\158 %1\177\201\t\236L", _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x32, 0x28, 0x0,  0x1b, 0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea,
                   0x82, 0x1d, 0xd0, 0x9b, 0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b,
                   0x76, 0x2c, 0xa5, 0x6d, 0x59, 0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9,  0xec, 0x4c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea, 0x82, 0x1d, 0xd0, 0x9b,
                               0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b, 0x76, 0x2c, 0xa5};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9, 0xec, 0x4c};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 27993);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "IP~U\245v\179O\ETB\247\SUB\152i\169\208", _pubPktID = 1633, _pubBody =
// "\164\215\&1Ym\133Ie\197\EOT\147\DC3}g\SUB\150\143", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x3d, 0x24, 0x0,  0xf,  0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f, 0x17,
                   0xf7, 0x1a, 0x98, 0x69, 0xa9, 0xd0, 0x6,  0x61, 0xa4, 0xd7, 0x31, 0x59, 0x6d,
                   0x85, 0x49, 0x65, 0xc5, 0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  uint8_t topic_bytes[] = {0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f, 0x17, 0xf7, 0x1a, 0x98, 0x69, 0xa9, 0xd0};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa4, 0xd7, 0x31, 0x59, 0x6d, 0x85, 0x49, 0x65, 0xc5,
                         0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 1633, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "IP~U\245v\179O\ETB\247\SUB\152i\169\208", _pubPktID = 1633, _pubBody =
// "\164\215\&1Ym\133Ie\197\EOT\147\DC3}g\SUB\150\143", _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x3d, 0x24, 0x0,  0xf,  0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f, 0x17,
                   0xf7, 0x1a, 0x98, 0x69, 0xa9, 0xd0, 0x6,  0x61, 0xa4, 0xd7, 0x31, 0x59, 0x6d,
                   0x85, 0x49, 0x65, 0xc5, 0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f,
                               0x17, 0xf7, 0x1a, 0x98, 0x69, 0xa9, 0xd0};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa4, 0xd7, 0x31, 0x59, 0x6d, 0x85, 0x49, 0x65, 0xc5,
                              0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1633);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\bm\162F\236O\211D\179\164@\195\244", _pubPktID = 19046, _pubBody = ".\167H\139", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x35, 0x15, 0x0,  0xd,  0x8,  0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44,
                   0xb3, 0xa4, 0x40, 0xc3, 0xf4, 0x4a, 0x66, 0x2e, 0xa7, 0x48, 0x8b};
  uint8_t topic_bytes[] = {0x8, 0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44, 0xb3, 0xa4, 0x40, 0xc3, 0xf4};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2e, 0xa7, 0x48, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 19046, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\bm\162F\236O\211D\179\164@\195\244", _pubPktID = 19046, _pubBody = ".\167H\139", _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x35, 0x15, 0x0,  0xd,  0x8,  0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44,
                   0xb3, 0xa4, 0x40, 0xc3, 0xf4, 0x4a, 0x66, 0x2e, 0xa7, 0x48, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8, 0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44, 0xb3, 0xa4, 0x40, 0xc3, 0xf4};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2e, 0xa7, 0x48, 0x8b};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 19046);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "%\134\216", _pubPktID = 0, _pubBody
// = "\ETB\162T\161\139s\238\233\229.\233\243\186", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x38, 0x12, 0x0,  0x3,  0x25, 0x86, 0xd8, 0x17, 0xa2, 0x54,
                   0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  uint8_t topic_bytes[] = {0x25, 0x86, 0xd8};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x17, 0xa2, 0x54, 0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "%\134\216", _pubPktID = 0, _pubBody
// = "\ETB\162T\161\139s\238\233\229.\233\243\186", _pubProps = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x38, 0x12, 0x0,  0x3,  0x25, 0x86, 0xd8, 0x17, 0xa2, 0x54,
                   0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x25, 0x86, 0xd8};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x17, 0xa2, 0x54, 0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\230\237\153c\242P\179\141\223\&2\205Z{\223\153", _pubPktID = 22947, _pubBody =
// "\195\148\247\&4\177\f%\149>q\236W\ETB-\a\209y\n\133o\172*:\131aY", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x3a, 0x2d, 0x0,  0xf,  0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d, 0xdf, 0x32, 0xcd, 0x5a,
                   0x7b, 0xdf, 0x99, 0x59, 0xa3, 0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec,
                   0x57, 0x17, 0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  uint8_t topic_bytes[] = {0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d, 0xdf, 0x32, 0xcd, 0x5a, 0x7b, 0xdf, 0x99};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec, 0x57, 0x17,
                         0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 22947, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\230\237\153c\242P\179\141\223\&2\205Z{\223\153", _pubPktID = 22947, _pubBody =
// "\195\148\247\&4\177\f%\149>q\236W\ETB-\a\209y\n\133o\172*:\131aY", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x3a, 0x2d, 0x0,  0xf,  0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d, 0xdf, 0x32, 0xcd, 0x5a,
                   0x7b, 0xdf, 0x99, 0x59, 0xa3, 0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec,
                   0x57, 0x17, 0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d,
                               0xdf, 0x32, 0xcd, 0x5a, 0x7b, 0xdf, 0x99};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec, 0x57, 0x17,
                              0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 22947);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\159q1\146\234\232\173\FS`\184\186\140\SYN=Z", _pubPktID = 12817, _pubBody = "EJwh\185\236\204#\166", _pubProps =
// []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x33, 0x1c, 0x0,  0xf,  0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c, 0x60, 0xb8, 0xba,
                   0x8c, 0x16, 0x3d, 0x5a, 0x32, 0x11, 0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  uint8_t topic_bytes[] = {0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c, 0x60, 0xb8, 0xba, 0x8c, 0x16, 0x3d, 0x5a};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 12817, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\159q1\146\234\232\173\FS`\184\186\140\SYN=Z", _pubPktID = 12817, _pubBody = "EJwh\185\236\204#\166", _pubProps =
// []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x33, 0x1c, 0x0,  0xf,  0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c, 0x60, 0xb8, 0xba,
                   0x8c, 0x16, 0x3d, 0x5a, 0x32, 0x11, 0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c,
                               0x60, 0xb8, 0xba, 0x8c, 0x16, 0x3d, 0x5a};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 12817);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "7_", _pubPktID = 0, _pubBody =
// "1l\172\222\&2J\173\154BN|", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x30, 0xf, 0x0, 0x2, 0x37, 0x5f, 0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  uint8_t topic_bytes[] = {0x37, 0x5f};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "7_", _pubPktID = 0, _pubBody =
// "1l\172\222\&2J\173\154BN|", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x30, 0xf, 0x0, 0x2, 0x37, 0x5f, 0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x37, 0x5f};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\246\202\200\133Ey", _pubPktID =
// 19152, _pubBody = "G\255\&5Bg\183\227x}.\158X\246mx\199u\250\US\ETXI\ENQ\249\155!rJ", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x35, 0x25, 0x0,  0x6,  0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79, 0x4a, 0xd0, 0x47,
                   0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                   0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  uint8_t topic_bytes[] = {0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x47, 0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                         0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 19152, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\246\202\200\133Ey", _pubPktID =
// 19152, _pubBody = "G\255\&5Bg\183\227x}.\158X\246mx\199u\250\US\ETXI\ENQ\249\155!rJ", _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x35, 0x25, 0x0,  0x6,  0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79, 0x4a, 0xd0, 0x47,
                   0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                   0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x47, 0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                              0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 19152);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\\\211\215", _pubPktID = 7594,
// _pubBody = "\139\150\137\180\142\209{^\232\155\136\252\140\233\138", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x3c, 0x16, 0x0,  0x3,  0x5c, 0xd3, 0xd7, 0x1d, 0xaa, 0x8b, 0x96, 0x89,
                   0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  uint8_t topic_bytes[] = {0x5c, 0xd3, 0xd7};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b, 0x96, 0x89, 0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 7594, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\\\211\215", _pubPktID = 7594,
// _pubBody = "\139\150\137\180\142\209{^\232\155\136\252\140\233\138", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x3c, 0x16, 0x0,  0x3,  0x5c, 0xd3, 0xd7, 0x1d, 0xaa, 0x8b, 0x96, 0x89,
                   0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5c, 0xd3, 0xd7};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8b, 0x96, 0x89, 0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7594);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "e9\242\201W\247\177\219AK\182\169",
// _pubPktID = 7929, _pubBody = "T\v\FS.x%\218\n\245\225\147\232\145qH\197\203m~\212\&0pk}\161\236\244$\162", _pubProps
// = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x34, 0x2d, 0x0,  0xc,  0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9,
                   0x1e, 0xf9, 0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71,
                   0x48, 0xc5, 0xcb, 0x6d, 0x7e, 0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  uint8_t topic_bytes[] = {0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71, 0x48,
                         0xc5, 0xcb, 0x6d, 0x7e, 0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 7929, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "e9\242\201W\247\177\219AK\182\169",
// _pubPktID = 7929, _pubBody = "T\v\FS.x%\218\n\245\225\147\232\145qH\197\203m~\212\&0pk}\161\236\244$\162", _pubProps
// = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x34, 0x2d, 0x0,  0xc,  0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9,
                   0x1e, 0xf9, 0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71,
                   0x48, 0xc5, 0xcb, 0x6d, 0x7e, 0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71, 0x48,
                              0xc5, 0xcb, 0x6d, 0x7e, 0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7929);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\235\160n\156\199\DC14\f\233\197\243\207\145\204|J/\129\156\&5$&Z", _pubPktID = 0, _pubBody =
// "\143\195\191\225_\213\191E\230c\156\216\152\CAN\208\204-", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x39, 0x2a, 0x0,  0x17, 0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3,
                   0xcf, 0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a, 0x8f, 0xc3, 0xbf,
                   0xe1, 0x5f, 0xd5, 0xbf, 0x45, 0xe6, 0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  uint8_t topic_bytes[] = {0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3, 0xcf,
                           0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8f, 0xc3, 0xbf, 0xe1, 0x5f, 0xd5, 0xbf, 0x45, 0xe6,
                         0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\235\160n\156\199\DC14\f\233\197\243\207\145\204|J/\129\156\&5$&Z", _pubPktID = 0, _pubBody =
// "\143\195\191\225_\213\191E\230c\156\216\152\CAN\208\204-", _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x39, 0x2a, 0x0,  0x17, 0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3,
                   0xcf, 0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a, 0x8f, 0xc3, 0xbf,
                   0xe1, 0x5f, 0xd5, 0xbf, 0x45, 0xe6, 0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3, 0xcf,
                               0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8f, 0xc3, 0xbf, 0xe1, 0x5f, 0xd5, 0xbf, 0x45, 0xe6,
                              0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\182~R\STX\198L\RS%^\137\162\228\&70", _pubPktID = 1453, _pubBody = "\188=\n\155\249", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x3d, 0x17, 0x0,  0xe,  0xb6, 0x7e, 0x52, 0x2,  0xc6, 0x4c, 0x1e, 0x25, 0x5e,
                   0x89, 0xa2, 0xe4, 0x37, 0x30, 0x5,  0xad, 0xbc, 0x3d, 0xa,  0x9b, 0xf9};
  uint8_t topic_bytes[] = {0xb6, 0x7e, 0x52, 0x2, 0xc6, 0x4c, 0x1e, 0x25, 0x5e, 0x89, 0xa2, 0xe4, 0x37, 0x30};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbc, 0x3d, 0xa, 0x9b, 0xf9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 1453, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\182~R\STX\198L\RS%^\137\162\228\&70", _pubPktID = 1453, _pubBody = "\188=\n\155\249", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x3d, 0x17, 0x0,  0xe,  0xb6, 0x7e, 0x52, 0x2,  0xc6, 0x4c, 0x1e, 0x25, 0x5e,
                   0x89, 0xa2, 0xe4, 0x37, 0x30, 0x5,  0xad, 0xbc, 0x3d, 0xa,  0x9b, 0xf9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb6, 0x7e, 0x52, 0x2, 0xc6, 0x4c, 0x1e, 0x25, 0x5e, 0x89, 0xa2, 0xe4, 0x37, 0x30};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbc, 0x3d, 0xa, 0x9b, 0xf9};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1453);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\191k-$.\245\SUB\192\234\155$",
// _pubPktID = 29170, _pubBody = "[F\181\186O\149", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x33, 0x15, 0x0,  0xb,  0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0,
                   0xea, 0x9b, 0x24, 0x71, 0xf2, 0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  uint8_t topic_bytes[] = {0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0, 0xea, 0x9b, 0x24};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29170, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\191k-$.\245\SUB\192\234\155$",
// _pubPktID = 29170, _pubBody = "[F\181\186O\149", _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x33, 0x15, 0x0,  0xb,  0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0,
                   0xea, 0x9b, 0x24, 0x71, 0xf2, 0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0, 0xea, 0x9b, 0x24};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29170);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = ";\152\218", _pubPktID = 5070,
// _pubBody = "]&\234\205\156\200\SYN\185\NUL\214}\239\191\&6\154waT{\246\173\DC4k\155\211\190", _pubProps =
// [PropPayloadFormatIndicator 221,PropMaximumPacketSize 3004,PropResponseInformation
// "<.\174Oy\SI&D{D\209\175\f\235\242\181\136\195\173*\ETB`\206\DC2",PropTopicAlias 16144]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {0x3d, 0x47, 0x0,  0x3,  0x3b, 0x98, 0xda, 0x13, 0xce, 0x25, 0x1,  0xdd, 0x27, 0x0,  0x0,
                   0xb,  0xbc, 0x1a, 0x0,  0x18, 0x3c, 0x2e, 0xae, 0x4f, 0x79, 0xf,  0x26, 0x44, 0x7b, 0x44,
                   0xd1, 0xaf, 0xc,  0xeb, 0xf2, 0xb5, 0x88, 0xc3, 0xad, 0x2a, 0x17, 0x60, 0xce, 0x12, 0x23,
                   0x3f, 0x10, 0x5d, 0x26, 0xea, 0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf,
                   0x36, 0x9a, 0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  uint8_t topic_bytes[] = {0x3b, 0x98, 0xda};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5d, 0x26, 0xea, 0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf,
                         0x36, 0x9a, 0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0x3c, 0x2e, 0xae, 0x4f, 0x79, 0xf,  0x26, 0x44, 0x7b, 0x44, 0xd1, 0xaf,
                           0xc,  0xeb, 0xf2, 0xb5, 0x88, 0xc3, 0xad, 0x2a, 0x17, 0x60, 0xce, 0x12};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3004}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16144}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5070, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = ";\152\218", _pubPktID = 5070,
// _pubBody = "]&\234\205\156\200\SYN\185\NUL\214}\239\191\&6\154waT{\246\173\DC4k\155\211\190", _pubProps =
// [PropPayloadFormatIndicator 221,PropMaximumPacketSize 3004,PropResponseInformation
// "<.\174Oy\SI&D{D\209\175\f\235\242\181\136\195\173*\ETB`\206\DC2",PropTopicAlias 16144]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {0x3d, 0x47, 0x0,  0x3,  0x3b, 0x98, 0xda, 0x13, 0xce, 0x25, 0x1,  0xdd, 0x27, 0x0,  0x0,
                   0xb,  0xbc, 0x1a, 0x0,  0x18, 0x3c, 0x2e, 0xae, 0x4f, 0x79, 0xf,  0x26, 0x44, 0x7b, 0x44,
                   0xd1, 0xaf, 0xc,  0xeb, 0xf2, 0xb5, 0x88, 0xc3, 0xad, 0x2a, 0x17, 0x60, 0xce, 0x12, 0x23,
                   0x3f, 0x10, 0x5d, 0x26, 0xea, 0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf,
                   0x36, 0x9a, 0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3b, 0x98, 0xda};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5d, 0x26, 0xea, 0xcd, 0x9c, 0xc8, 0x16, 0xb9, 0x0,  0xd6, 0x7d, 0xef, 0xbf,
                              0x36, 0x9a, 0x77, 0x61, 0x54, 0x7b, 0xf6, 0xad, 0x14, 0x6b, 0x9b, 0xd3, 0xbe};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 5070);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\156n m\218\DC4\ENQ\RS\r\221",
// _pubPktID = 29842, _pubBody = "\n\r\194\171\&847\188\r\239=\228G\244\204\183o\136\148\223SQ", _pubProps =
// [PropSubscriptionIdentifier 25,PropPayloadFormatIndicator 184,PropAuthenticationMethod
// "t\195I,\139+",PropWildcardSubscriptionAvailable 103,PropReasonString
// "B\241\187.\253b\145\f>~\159T`\201\NAK'm\222\t\153\160\136",PropMaximumQoS 116,PropPayloadFormatIndicator
// 39,PropReasonString ":\SUB\160#\206\247\173@\DLEP\243\176N\252Ag\149n\222",PropWildcardSubscriptionAvailable
// 101,PropSubscriptionIdentifier 14,PropTopicAliasMaximum 14696,PropReasonString "LN\176",PropRetainAvailable
// 253,PropPayloadFormatIndicator 106,PropServerReference
// "C\a\138X2S\225\157\222\187n\SYN\DEL\171\181\DEL\STXk\b\217",PropCorrelationData
// "\147\245\&8OJ\253",PropWildcardSubscriptionAvailable 8,PropWillDelayInterval
// 12301,PropSubscriptionIdentifierAvailable 138,PropSubscriptionIdentifier 31,PropRequestResponseInformation
// 103,PropMaximumPacketSize 8390,PropAuthenticationData "\EOT\253]\186J-K\206r;e\225\158",PropMessageExpiryInterval
// 26352,PropRequestResponseInformation 214,PropWillDelayInterval 13619]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {0x3c, 0xc7, 0x1,  0x0,  0xa,  0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5,  0x1e, 0xd,  0xdd, 0x74, 0x92,
                   0xa1, 0x1,  0xb,  0x19, 0x1,  0xb8, 0x15, 0x0,  0x6,  0x74, 0xc3, 0x49, 0x2c, 0x8b, 0x2b, 0x28, 0x67,
                   0x1f, 0x0,  0x16, 0x42, 0xf1, 0xbb, 0x2e, 0xfd, 0x62, 0x91, 0xc,  0x3e, 0x7e, 0x9f, 0x54, 0x60, 0xc9,
                   0x15, 0x27, 0x6d, 0xde, 0x9,  0x99, 0xa0, 0x88, 0x24, 0x74, 0x1,  0x27, 0x1f, 0x0,  0x13, 0x3a, 0x1a,
                   0xa0, 0x23, 0xce, 0xf7, 0xad, 0x40, 0x10, 0x50, 0xf3, 0xb0, 0x4e, 0xfc, 0x41, 0x67, 0x95, 0x6e, 0xde,
                   0x28, 0x65, 0xb,  0xe,  0x22, 0x39, 0x68, 0x1f, 0x0,  0x3,  0x4c, 0x4e, 0xb0, 0x25, 0xfd, 0x1,  0x6a,
                   0x1c, 0x0,  0x14, 0x43, 0x7,  0x8a, 0x58, 0x32, 0x53, 0xe1, 0x9d, 0xde, 0xbb, 0x6e, 0x16, 0x7f, 0xab,
                   0xb5, 0x7f, 0x2,  0x6b, 0x8,  0xd9, 0x9,  0x0,  0x6,  0x93, 0xf5, 0x38, 0x4f, 0x4a, 0xfd, 0x28, 0x8,
                   0x18, 0x0,  0x0,  0x30, 0xd,  0x29, 0x8a, 0xb,  0x1f, 0x19, 0x67, 0x27, 0x0,  0x0,  0x20, 0xc6, 0x16,
                   0x0,  0xd,  0x4,  0xfd, 0x5d, 0xba, 0x4a, 0x2d, 0x4b, 0xce, 0x72, 0x3b, 0x65, 0xe1, 0x9e, 0x2,  0x0,
                   0x0,  0x66, 0xf0, 0x19, 0xd6, 0x18, 0x0,  0x0,  0x35, 0x33, 0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37,
                   0xbc, 0xd,  0xef, 0x3d, 0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  uint8_t topic_bytes[] = {0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5, 0x1e, 0xd, 0xdd};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37, 0xbc, 0xd,  0xef, 0x3d,
                         0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0x74, 0xc3, 0x49, 0x2c, 0x8b, 0x2b};
  uint8_t bytesprops1[] = {0x42, 0xf1, 0xbb, 0x2e, 0xfd, 0x62, 0x91, 0xc, 0x3e, 0x7e, 0x9f,
                           0x54, 0x60, 0xc9, 0x15, 0x27, 0x6d, 0xde, 0x9, 0x99, 0xa0, 0x88};
  uint8_t bytesprops2[] = {0x3a, 0x1a, 0xa0, 0x23, 0xce, 0xf7, 0xad, 0x40, 0x10, 0x50,
                           0xf3, 0xb0, 0x4e, 0xfc, 0x41, 0x67, 0x95, 0x6e, 0xde};
  uint8_t bytesprops3[] = {0x4c, 0x4e, 0xb0};
  uint8_t bytesprops4[] = {0x43, 0x7,  0x8a, 0x58, 0x32, 0x53, 0xe1, 0x9d, 0xde, 0xbb,
                           0x6e, 0x16, 0x7f, 0xab, 0xb5, 0x7f, 0x2,  0x6b, 0x8,  0xd9};
  uint8_t bytesprops5[] = {0x93, 0xf5, 0x38, 0x4f, 0x4a, 0xfd};
  uint8_t bytesprops6[] = {0x4, 0xfd, 0x5d, 0xba, 0x4a, 0x2d, 0x4b, 0xce, 0x72, 0x3b, 0x65, 0xe1, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14696}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12301}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8390}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26352}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13619}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29842, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\156n m\218\DC4\ENQ\RS\r\221",
// _pubPktID = 29842, _pubBody = "\n\r\194\171\&847\188\r\239=\228G\244\204\183o\136\148\223SQ", _pubProps =
// [PropSubscriptionIdentifier 25,PropPayloadFormatIndicator 184,PropAuthenticationMethod
// "t\195I,\139+",PropWildcardSubscriptionAvailable 103,PropReasonString
// "B\241\187.\253b\145\f>~\159T`\201\NAK'm\222\t\153\160\136",PropMaximumQoS 116,PropPayloadFormatIndicator
// 39,PropReasonString ":\SUB\160#\206\247\173@\DLEP\243\176N\252Ag\149n\222",PropWildcardSubscriptionAvailable
// 101,PropSubscriptionIdentifier 14,PropTopicAliasMaximum 14696,PropReasonString "LN\176",PropRetainAvailable
// 253,PropPayloadFormatIndicator 106,PropServerReference
// "C\a\138X2S\225\157\222\187n\SYN\DEL\171\181\DEL\STXk\b\217",PropCorrelationData
// "\147\245\&8OJ\253",PropWildcardSubscriptionAvailable 8,PropWillDelayInterval
// 12301,PropSubscriptionIdentifierAvailable 138,PropSubscriptionIdentifier 31,PropRequestResponseInformation
// 103,PropMaximumPacketSize 8390,PropAuthenticationData "\EOT\253]\186J-K\206r;e\225\158",PropMessageExpiryInterval
// 26352,PropRequestResponseInformation 214,PropWillDelayInterval 13619]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {0x3c, 0xc7, 0x1,  0x0,  0xa,  0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5,  0x1e, 0xd,  0xdd, 0x74, 0x92,
                   0xa1, 0x1,  0xb,  0x19, 0x1,  0xb8, 0x15, 0x0,  0x6,  0x74, 0xc3, 0x49, 0x2c, 0x8b, 0x2b, 0x28, 0x67,
                   0x1f, 0x0,  0x16, 0x42, 0xf1, 0xbb, 0x2e, 0xfd, 0x62, 0x91, 0xc,  0x3e, 0x7e, 0x9f, 0x54, 0x60, 0xc9,
                   0x15, 0x27, 0x6d, 0xde, 0x9,  0x99, 0xa0, 0x88, 0x24, 0x74, 0x1,  0x27, 0x1f, 0x0,  0x13, 0x3a, 0x1a,
                   0xa0, 0x23, 0xce, 0xf7, 0xad, 0x40, 0x10, 0x50, 0xf3, 0xb0, 0x4e, 0xfc, 0x41, 0x67, 0x95, 0x6e, 0xde,
                   0x28, 0x65, 0xb,  0xe,  0x22, 0x39, 0x68, 0x1f, 0x0,  0x3,  0x4c, 0x4e, 0xb0, 0x25, 0xfd, 0x1,  0x6a,
                   0x1c, 0x0,  0x14, 0x43, 0x7,  0x8a, 0x58, 0x32, 0x53, 0xe1, 0x9d, 0xde, 0xbb, 0x6e, 0x16, 0x7f, 0xab,
                   0xb5, 0x7f, 0x2,  0x6b, 0x8,  0xd9, 0x9,  0x0,  0x6,  0x93, 0xf5, 0x38, 0x4f, 0x4a, 0xfd, 0x28, 0x8,
                   0x18, 0x0,  0x0,  0x30, 0xd,  0x29, 0x8a, 0xb,  0x1f, 0x19, 0x67, 0x27, 0x0,  0x0,  0x20, 0xc6, 0x16,
                   0x0,  0xd,  0x4,  0xfd, 0x5d, 0xba, 0x4a, 0x2d, 0x4b, 0xce, 0x72, 0x3b, 0x65, 0xe1, 0x9e, 0x2,  0x0,
                   0x0,  0x66, 0xf0, 0x19, 0xd6, 0x18, 0x0,  0x0,  0x35, 0x33, 0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37,
                   0xbc, 0xd,  0xef, 0x3d, 0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0x6e, 0x20, 0x6d, 0xda, 0x14, 0x5, 0x1e, 0xd, 0xdd};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa,  0xd,  0xc2, 0xab, 0x38, 0x34, 0x37, 0xbc, 0xd,  0xef, 0x3d,
                              0xe4, 0x47, 0xf4, 0xcc, 0xb7, 0x6f, 0x88, 0x94, 0xdf, 0x53, 0x51};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 29842);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\SUB\143\217", _pubPktID = 816,
// _pubBody = "\246^\255t\204\180\169\214\150&=\195\235\249\176Q\NAK\169\145", _pubProps = [PropTopicAliasMaximum
// 31796,PropRequestProblemInformation 166,PropTopicAlias 26535,PropSubscriptionIdentifier 4,PropServerReference
// "\227\160T'4-\188\159&\235RN\181\179d\153,\237w\193\&3\145\136",PropSubscriptionIdentifier
// 25,PropSharedSubscriptionAvailable 1,PropServerKeepAlive 630,PropServerReference "\226",PropAssignedClientIdentifier
// "\211",PropContentType "X",PropReceiveMaximum 7394,PropMessageExpiryInterval 1294,PropAuthenticationMethod
// "s",PropPayloadFormatIndicator 99,PropResponseTopic
// "7Q\148\235\CAN\DLE\234X\GSQ\134U\204\214@\213\248\151\165\185X\SYN4\188\218\218\&0\193",PropRequestResponseInformation
// 163,PropAuthenticationMethod " 6\248\138\207\STXX\147\203\217}\173\SI2\175\150",PropReceiveMaximum
// 26236,PropUserProperty "\157\173\137\143\144\rgTd\DC4\164\202\&2\130\ESC2\157"
// "\161\177#\149\206m\b!\158\145/3\148+\246\171u\144\&2\219\156\232\249",PropRequestProblemInformation
// 16,PropCorrelationData "\214\ESC\207",PropTopicAlias 17977,PropContentType
// "\238\&7\DELe\172\181\189\178\187\ACKB\155Q\199?b\197",PropRequestResponseInformation
// 197,PropAssignedClientIdentifier "",PropAuthenticationMethod
// "\163\192\138\&2\t\136\129\137_H\ETB\190\234\128\198\227bE\216u\193\FST\230\227q\223\206\ACK",PropAuthenticationData
// "&m#",PropRequestResponseInformation 161]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x35, 0x91, 0x2,  0x0,  0x3,  0x1a, 0x8f, 0xd9, 0x3,  0x30, 0xf5, 0x1,  0x22, 0x7c, 0x34, 0x17, 0xa6, 0x23, 0x67,
      0xa7, 0xb,  0x4,  0x1c, 0x0,  0x17, 0xe3, 0xa0, 0x54, 0x27, 0x34, 0x2d, 0xbc, 0x9f, 0x26, 0xeb, 0x52, 0x4e, 0xb5,
      0xb3, 0x64, 0x99, 0x2c, 0xed, 0x77, 0xc1, 0x33, 0x91, 0x88, 0xb,  0x19, 0x2a, 0x1,  0x13, 0x2,  0x76, 0x1c, 0x0,
      0x1,  0xe2, 0x12, 0x0,  0x1,  0xd3, 0x3,  0x0,  0x1,  0x58, 0x21, 0x1c, 0xe2, 0x2,  0x0,  0x0,  0x5,  0xe,  0x15,
      0x0,  0x1,  0x73, 0x1,  0x63, 0x8,  0x0,  0x1c, 0x37, 0x51, 0x94, 0xeb, 0x18, 0x10, 0xea, 0x58, 0x1d, 0x51, 0x86,
      0x55, 0xcc, 0xd6, 0x40, 0xd5, 0xf8, 0x97, 0xa5, 0xb9, 0x58, 0x16, 0x34, 0xbc, 0xda, 0xda, 0x30, 0xc1, 0x19, 0xa3,
      0x15, 0x0,  0x10, 0x20, 0x36, 0xf8, 0x8a, 0xcf, 0x2,  0x58, 0x93, 0xcb, 0xd9, 0x7d, 0xad, 0xf,  0x32, 0xaf, 0x96,
      0x21, 0x66, 0x7c, 0x26, 0x0,  0x11, 0x9d, 0xad, 0x89, 0x8f, 0x90, 0xd,  0x67, 0x54, 0x64, 0x14, 0xa4, 0xca, 0x32,
      0x82, 0x1b, 0x32, 0x9d, 0x0,  0x17, 0xa1, 0xb1, 0x23, 0x95, 0xce, 0x6d, 0x8,  0x21, 0x9e, 0x91, 0x2f, 0x33, 0x94,
      0x2b, 0xf6, 0xab, 0x75, 0x90, 0x32, 0xdb, 0x9c, 0xe8, 0xf9, 0x17, 0x10, 0x9,  0x0,  0x3,  0xd6, 0x1b, 0xcf, 0x23,
      0x46, 0x39, 0x3,  0x0,  0x11, 0xee, 0x37, 0x7f, 0x65, 0xac, 0xb5, 0xbd, 0xb2, 0xbb, 0x6,  0x42, 0x9b, 0x51, 0xc7,
      0x3f, 0x62, 0xc5, 0x19, 0xc5, 0x12, 0x0,  0x0,  0x15, 0x0,  0x1d, 0xa3, 0xc0, 0x8a, 0x32, 0x9,  0x88, 0x81, 0x89,
      0x5f, 0x48, 0x17, 0xbe, 0xea, 0x80, 0xc6, 0xe3, 0x62, 0x45, 0xd8, 0x75, 0xc1, 0x1c, 0x54, 0xe6, 0xe3, 0x71, 0xdf,
      0xce, 0x6,  0x16, 0x0,  0x3,  0x26, 0x6d, 0x23, 0x19, 0xa1, 0xf6, 0x5e, 0xff, 0x74, 0xcc, 0xb4, 0xa9, 0xd6, 0x96,
      0x26, 0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  uint8_t topic_bytes[] = {0x1a, 0x8f, 0xd9};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf6, 0x5e, 0xff, 0x74, 0xcc, 0xb4, 0xa9, 0xd6, 0x96, 0x26,
                         0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xe3, 0xa0, 0x54, 0x27, 0x34, 0x2d, 0xbc, 0x9f, 0x26, 0xeb, 0x52, 0x4e,
                           0xb5, 0xb3, 0x64, 0x99, 0x2c, 0xed, 0x77, 0xc1, 0x33, 0x91, 0x88};
  uint8_t bytesprops1[] = {0xe2};
  uint8_t bytesprops2[] = {0xd3};
  uint8_t bytesprops3[] = {0x58};
  uint8_t bytesprops4[] = {0x73};
  uint8_t bytesprops5[] = {0x37, 0x51, 0x94, 0xeb, 0x18, 0x10, 0xea, 0x58, 0x1d, 0x51, 0x86, 0x55, 0xcc, 0xd6,
                           0x40, 0xd5, 0xf8, 0x97, 0xa5, 0xb9, 0x58, 0x16, 0x34, 0xbc, 0xda, 0xda, 0x30, 0xc1};
  uint8_t bytesprops6[] = {0x20, 0x36, 0xf8, 0x8a, 0xcf, 0x2,  0x58, 0x93,
                           0xcb, 0xd9, 0x7d, 0xad, 0xf,  0x32, 0xaf, 0x96};
  uint8_t bytesprops8[] = {0xa1, 0xb1, 0x23, 0x95, 0xce, 0x6d, 0x8,  0x21, 0x9e, 0x91, 0x2f, 0x33,
                           0x94, 0x2b, 0xf6, 0xab, 0x75, 0x90, 0x32, 0xdb, 0x9c, 0xe8, 0xf9};
  uint8_t bytesprops7[] = {0x9d, 0xad, 0x89, 0x8f, 0x90, 0xd,  0x67, 0x54, 0x64,
                           0x14, 0xa4, 0xca, 0x32, 0x82, 0x1b, 0x32, 0x9d};
  uint8_t bytesprops9[] = {0xd6, 0x1b, 0xcf};
  uint8_t bytesprops10[] = {0xee, 0x37, 0x7f, 0x65, 0xac, 0xb5, 0xbd, 0xb2, 0xbb,
                            0x6,  0x42, 0x9b, 0x51, 0xc7, 0x3f, 0x62, 0xc5};
  uint8_t bytesprops11[] = {0};
  uint8_t bytesprops12[] = {0xa3, 0xc0, 0x8a, 0x32, 0x9,  0x88, 0x81, 0x89, 0x5f, 0x48, 0x17, 0xbe, 0xea, 0x80, 0xc6,
                            0xe3, 0x62, 0x45, 0xd8, 0x75, 0xc1, 0x1c, 0x54, 0xe6, 0xe3, 0x71, 0xdf, 0xce, 0x6};
  uint8_t bytesprops13[] = {0x26, 0x6d, 0x23};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31796}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26535}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 25}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 630}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7394}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1294}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26236}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops7}, .v = {23, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17977}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 161}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 816, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\SUB\143\217", _pubPktID = 816,
// _pubBody = "\246^\255t\204\180\169\214\150&=\195\235\249\176Q\NAK\169\145", _pubProps = [PropTopicAliasMaximum
// 31796,PropRequestProblemInformation 166,PropTopicAlias 26535,PropSubscriptionIdentifier 4,PropServerReference
// "\227\160T'4-\188\159&\235RN\181\179d\153,\237w\193\&3\145\136",PropSubscriptionIdentifier
// 25,PropSharedSubscriptionAvailable 1,PropServerKeepAlive 630,PropServerReference "\226",PropAssignedClientIdentifier
// "\211",PropContentType "X",PropReceiveMaximum 7394,PropMessageExpiryInterval 1294,PropAuthenticationMethod
// "s",PropPayloadFormatIndicator 99,PropResponseTopic
// "7Q\148\235\CAN\DLE\234X\GSQ\134U\204\214@\213\248\151\165\185X\SYN4\188\218\218\&0\193",PropRequestResponseInformation
// 163,PropAuthenticationMethod " 6\248\138\207\STXX\147\203\217}\173\SI2\175\150",PropReceiveMaximum
// 26236,PropUserProperty "\157\173\137\143\144\rgTd\DC4\164\202\&2\130\ESC2\157"
// "\161\177#\149\206m\b!\158\145/3\148+\246\171u\144\&2\219\156\232\249",PropRequestProblemInformation
// 16,PropCorrelationData "\214\ESC\207",PropTopicAlias 17977,PropContentType
// "\238\&7\DELe\172\181\189\178\187\ACKB\155Q\199?b\197",PropRequestResponseInformation
// 197,PropAssignedClientIdentifier "",PropAuthenticationMethod
// "\163\192\138\&2\t\136\129\137_H\ETB\190\234\128\198\227bE\216u\193\FST\230\227q\223\206\ACK",PropAuthenticationData
// "&m#",PropRequestResponseInformation 161]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {
      0x35, 0x91, 0x2,  0x0,  0x3,  0x1a, 0x8f, 0xd9, 0x3,  0x30, 0xf5, 0x1,  0x22, 0x7c, 0x34, 0x17, 0xa6, 0x23, 0x67,
      0xa7, 0xb,  0x4,  0x1c, 0x0,  0x17, 0xe3, 0xa0, 0x54, 0x27, 0x34, 0x2d, 0xbc, 0x9f, 0x26, 0xeb, 0x52, 0x4e, 0xb5,
      0xb3, 0x64, 0x99, 0x2c, 0xed, 0x77, 0xc1, 0x33, 0x91, 0x88, 0xb,  0x19, 0x2a, 0x1,  0x13, 0x2,  0x76, 0x1c, 0x0,
      0x1,  0xe2, 0x12, 0x0,  0x1,  0xd3, 0x3,  0x0,  0x1,  0x58, 0x21, 0x1c, 0xe2, 0x2,  0x0,  0x0,  0x5,  0xe,  0x15,
      0x0,  0x1,  0x73, 0x1,  0x63, 0x8,  0x0,  0x1c, 0x37, 0x51, 0x94, 0xeb, 0x18, 0x10, 0xea, 0x58, 0x1d, 0x51, 0x86,
      0x55, 0xcc, 0xd6, 0x40, 0xd5, 0xf8, 0x97, 0xa5, 0xb9, 0x58, 0x16, 0x34, 0xbc, 0xda, 0xda, 0x30, 0xc1, 0x19, 0xa3,
      0x15, 0x0,  0x10, 0x20, 0x36, 0xf8, 0x8a, 0xcf, 0x2,  0x58, 0x93, 0xcb, 0xd9, 0x7d, 0xad, 0xf,  0x32, 0xaf, 0x96,
      0x21, 0x66, 0x7c, 0x26, 0x0,  0x11, 0x9d, 0xad, 0x89, 0x8f, 0x90, 0xd,  0x67, 0x54, 0x64, 0x14, 0xa4, 0xca, 0x32,
      0x82, 0x1b, 0x32, 0x9d, 0x0,  0x17, 0xa1, 0xb1, 0x23, 0x95, 0xce, 0x6d, 0x8,  0x21, 0x9e, 0x91, 0x2f, 0x33, 0x94,
      0x2b, 0xf6, 0xab, 0x75, 0x90, 0x32, 0xdb, 0x9c, 0xe8, 0xf9, 0x17, 0x10, 0x9,  0x0,  0x3,  0xd6, 0x1b, 0xcf, 0x23,
      0x46, 0x39, 0x3,  0x0,  0x11, 0xee, 0x37, 0x7f, 0x65, 0xac, 0xb5, 0xbd, 0xb2, 0xbb, 0x6,  0x42, 0x9b, 0x51, 0xc7,
      0x3f, 0x62, 0xc5, 0x19, 0xc5, 0x12, 0x0,  0x0,  0x15, 0x0,  0x1d, 0xa3, 0xc0, 0x8a, 0x32, 0x9,  0x88, 0x81, 0x89,
      0x5f, 0x48, 0x17, 0xbe, 0xea, 0x80, 0xc6, 0xe3, 0x62, 0x45, 0xd8, 0x75, 0xc1, 0x1c, 0x54, 0xe6, 0xe3, 0x71, 0xdf,
      0xce, 0x6,  0x16, 0x0,  0x3,  0x26, 0x6d, 0x23, 0x19, 0xa1, 0xf6, 0x5e, 0xff, 0x74, 0xcc, 0xb4, 0xa9, 0xd6, 0x96,
      0x26, 0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1a, 0x8f, 0xd9};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf6, 0x5e, 0xff, 0x74, 0xcc, 0xb4, 0xa9, 0xd6, 0x96, 0x26,
                              0x3d, 0xc3, 0xeb, 0xf9, 0xb0, 0x51, 0x15, 0xa9, 0x91};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 816);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "", _pubPktID = 31057, _pubBody =
// "\199\189\167\ETX\187.\248)\192z\ESC\250{\169\157\255\224d\204\159\r\239\ESC\154Q\171\168", _pubProps =
// [PropAssignedClientIdentifier "_\215U\142P\139~)\tU-",PropResponseInformation
// "\232,2\181O7B\252\204}\223o\147b\134s,\173\159\215\200%o$k\129\149",PropCorrelationData
// "\NUL\203\&7\ENQ\158\134\201\218\&9\192\221%3\172^\225[\186\235\EM2",PropSubscriptionIdentifier
// 29,PropResponseInformation
// "\193\224]\164i:\216}A\234D\203I9\222\&3\129\207e\216\SOHI\t\215\197",PropTopicAliasMaximum
// 26731,PropAuthenticationMethod
// "\ETB\224\178`k\159\206V\DELySa8t;\143!\214\173\202mAd\161\195",PropPayloadFormatIndicator
// 37,PropMessageExpiryInterval 23579,PropServerReference "R\246vJ\166\204\250\ACK\ACKIT\217\193",PropAuthenticationData
// "0\194Lkb\182\232<H\155D\211\ACK\194\202\215D",PropAssignedClientIdentifier
// "\166\197\SO;\178\&8\231`5\210\SI\172\157v\246m9X\198T\229\225+2:\144\228\145v+",PropSessionExpiryInterval
// 16210,PropMessageExpiryInterval 30690]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x3a, 0xf8, 0x1,  0x0,  0x0,  0x79, 0x51, 0xd7, 0x1,  0x12, 0x0,  0xb,  0x5f, 0xd7, 0x55, 0x8e, 0x50,
                   0x8b, 0x7e, 0x29, 0x9,  0x55, 0x2d, 0x1a, 0x0,  0x1b, 0xe8, 0x2c, 0x32, 0xb5, 0x4f, 0x37, 0x42, 0xfc,
                   0xcc, 0x7d, 0xdf, 0x6f, 0x93, 0x62, 0x86, 0x73, 0x2c, 0xad, 0x9f, 0xd7, 0xc8, 0x25, 0x6f, 0x24, 0x6b,
                   0x81, 0x95, 0x9,  0x0,  0x15, 0x0,  0xcb, 0x37, 0x5,  0x9e, 0x86, 0xc9, 0xda, 0x39, 0xc0, 0xdd, 0x25,
                   0x33, 0xac, 0x5e, 0xe1, 0x5b, 0xba, 0xeb, 0x19, 0x32, 0xb,  0x1d, 0x1a, 0x0,  0x19, 0xc1, 0xe0, 0x5d,
                   0xa4, 0x69, 0x3a, 0xd8, 0x7d, 0x41, 0xea, 0x44, 0xcb, 0x49, 0x39, 0xde, 0x33, 0x81, 0xcf, 0x65, 0xd8,
                   0x1,  0x49, 0x9,  0xd7, 0xc5, 0x22, 0x68, 0x6b, 0x15, 0x0,  0x19, 0x17, 0xe0, 0xb2, 0x60, 0x6b, 0x9f,
                   0xce, 0x56, 0x7f, 0x79, 0x53, 0x61, 0x38, 0x74, 0x3b, 0x8f, 0x21, 0xd6, 0xad, 0xca, 0x6d, 0x41, 0x64,
                   0xa1, 0xc3, 0x1,  0x25, 0x2,  0x0,  0x0,  0x5c, 0x1b, 0x1c, 0x0,  0xd,  0x52, 0xf6, 0x76, 0x4a, 0xa6,
                   0xcc, 0xfa, 0x6,  0x6,  0x49, 0x54, 0xd9, 0xc1, 0x16, 0x0,  0x11, 0x30, 0xc2, 0x4c, 0x6b, 0x62, 0xb6,
                   0xe8, 0x3c, 0x48, 0x9b, 0x44, 0xd3, 0x6,  0xc2, 0xca, 0xd7, 0x44, 0x12, 0x0,  0x1e, 0xa6, 0xc5, 0xe,
                   0x3b, 0xb2, 0x38, 0xe7, 0x60, 0x35, 0xd2, 0xf,  0xac, 0x9d, 0x76, 0xf6, 0x6d, 0x39, 0x58, 0xc6, 0x54,
                   0xe5, 0xe1, 0x2b, 0x32, 0x3a, 0x90, 0xe4, 0x91, 0x76, 0x2b, 0x11, 0x0,  0x0,  0x3f, 0x52, 0x2,  0x0,
                   0x0,  0x77, 0xe2, 0xc7, 0xbd, 0xa7, 0x3,  0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b, 0xfa, 0x7b, 0xa9,
                   0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd,  0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc7, 0xbd, 0xa7, 0x3,  0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b, 0xfa, 0x7b, 0xa9,
                         0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd,  0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0x5f, 0xd7, 0x55, 0x8e, 0x50, 0x8b, 0x7e, 0x29, 0x9, 0x55, 0x2d};
  uint8_t bytesprops1[] = {0xe8, 0x2c, 0x32, 0xb5, 0x4f, 0x37, 0x42, 0xfc, 0xcc, 0x7d, 0xdf, 0x6f, 0x93, 0x62,
                           0x86, 0x73, 0x2c, 0xad, 0x9f, 0xd7, 0xc8, 0x25, 0x6f, 0x24, 0x6b, 0x81, 0x95};
  uint8_t bytesprops2[] = {0x0,  0xcb, 0x37, 0x5,  0x9e, 0x86, 0xc9, 0xda, 0x39, 0xc0, 0xdd,
                           0x25, 0x33, 0xac, 0x5e, 0xe1, 0x5b, 0xba, 0xeb, 0x19, 0x32};
  uint8_t bytesprops3[] = {0xc1, 0xe0, 0x5d, 0xa4, 0x69, 0x3a, 0xd8, 0x7d, 0x41, 0xea, 0x44, 0xcb, 0x49,
                           0x39, 0xde, 0x33, 0x81, 0xcf, 0x65, 0xd8, 0x1,  0x49, 0x9,  0xd7, 0xc5};
  uint8_t bytesprops4[] = {0x17, 0xe0, 0xb2, 0x60, 0x6b, 0x9f, 0xce, 0x56, 0x7f, 0x79, 0x53, 0x61, 0x38,
                           0x74, 0x3b, 0x8f, 0x21, 0xd6, 0xad, 0xca, 0x6d, 0x41, 0x64, 0xa1, 0xc3};
  uint8_t bytesprops5[] = {0x52, 0xf6, 0x76, 0x4a, 0xa6, 0xcc, 0xfa, 0x6, 0x6, 0x49, 0x54, 0xd9, 0xc1};
  uint8_t bytesprops6[] = {0x30, 0xc2, 0x4c, 0x6b, 0x62, 0xb6, 0xe8, 0x3c, 0x48,
                           0x9b, 0x44, 0xd3, 0x6,  0xc2, 0xca, 0xd7, 0x44};
  uint8_t bytesprops7[] = {0xa6, 0xc5, 0xe,  0x3b, 0xb2, 0x38, 0xe7, 0x60, 0x35, 0xd2, 0xf,  0xac, 0x9d, 0x76, 0xf6,
                           0x6d, 0x39, 0x58, 0xc6, 0x54, 0xe5, 0xe1, 0x2b, 0x32, 0x3a, 0x90, 0xe4, 0x91, 0x76, 0x2b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26731}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23579}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16210}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30690}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 31057, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "", _pubPktID = 31057, _pubBody =
// "\199\189\167\ETX\187.\248)\192z\ESC\250{\169\157\255\224d\204\159\r\239\ESC\154Q\171\168", _pubProps =
// [PropAssignedClientIdentifier "_\215U\142P\139~)\tU-",PropResponseInformation
// "\232,2\181O7B\252\204}\223o\147b\134s,\173\159\215\200%o$k\129\149",PropCorrelationData
// "\NUL\203\&7\ENQ\158\134\201\218\&9\192\221%3\172^\225[\186\235\EM2",PropSubscriptionIdentifier
// 29,PropResponseInformation
// "\193\224]\164i:\216}A\234D\203I9\222\&3\129\207e\216\SOHI\t\215\197",PropTopicAliasMaximum
// 26731,PropAuthenticationMethod
// "\ETB\224\178`k\159\206V\DELySa8t;\143!\214\173\202mAd\161\195",PropPayloadFormatIndicator
// 37,PropMessageExpiryInterval 23579,PropServerReference "R\246vJ\166\204\250\ACK\ACKIT\217\193",PropAuthenticationData
// "0\194Lkb\182\232<H\155D\211\ACK\194\202\215D",PropAssignedClientIdentifier
// "\166\197\SO;\178\&8\231`5\210\SI\172\157v\246m9X\198T\229\225+2:\144\228\145v+",PropSessionExpiryInterval
// 16210,PropMessageExpiryInterval 30690]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x3a, 0xf8, 0x1,  0x0,  0x0,  0x79, 0x51, 0xd7, 0x1,  0x12, 0x0,  0xb,  0x5f, 0xd7, 0x55, 0x8e, 0x50,
                   0x8b, 0x7e, 0x29, 0x9,  0x55, 0x2d, 0x1a, 0x0,  0x1b, 0xe8, 0x2c, 0x32, 0xb5, 0x4f, 0x37, 0x42, 0xfc,
                   0xcc, 0x7d, 0xdf, 0x6f, 0x93, 0x62, 0x86, 0x73, 0x2c, 0xad, 0x9f, 0xd7, 0xc8, 0x25, 0x6f, 0x24, 0x6b,
                   0x81, 0x95, 0x9,  0x0,  0x15, 0x0,  0xcb, 0x37, 0x5,  0x9e, 0x86, 0xc9, 0xda, 0x39, 0xc0, 0xdd, 0x25,
                   0x33, 0xac, 0x5e, 0xe1, 0x5b, 0xba, 0xeb, 0x19, 0x32, 0xb,  0x1d, 0x1a, 0x0,  0x19, 0xc1, 0xe0, 0x5d,
                   0xa4, 0x69, 0x3a, 0xd8, 0x7d, 0x41, 0xea, 0x44, 0xcb, 0x49, 0x39, 0xde, 0x33, 0x81, 0xcf, 0x65, 0xd8,
                   0x1,  0x49, 0x9,  0xd7, 0xc5, 0x22, 0x68, 0x6b, 0x15, 0x0,  0x19, 0x17, 0xe0, 0xb2, 0x60, 0x6b, 0x9f,
                   0xce, 0x56, 0x7f, 0x79, 0x53, 0x61, 0x38, 0x74, 0x3b, 0x8f, 0x21, 0xd6, 0xad, 0xca, 0x6d, 0x41, 0x64,
                   0xa1, 0xc3, 0x1,  0x25, 0x2,  0x0,  0x0,  0x5c, 0x1b, 0x1c, 0x0,  0xd,  0x52, 0xf6, 0x76, 0x4a, 0xa6,
                   0xcc, 0xfa, 0x6,  0x6,  0x49, 0x54, 0xd9, 0xc1, 0x16, 0x0,  0x11, 0x30, 0xc2, 0x4c, 0x6b, 0x62, 0xb6,
                   0xe8, 0x3c, 0x48, 0x9b, 0x44, 0xd3, 0x6,  0xc2, 0xca, 0xd7, 0x44, 0x12, 0x0,  0x1e, 0xa6, 0xc5, 0xe,
                   0x3b, 0xb2, 0x38, 0xe7, 0x60, 0x35, 0xd2, 0xf,  0xac, 0x9d, 0x76, 0xf6, 0x6d, 0x39, 0x58, 0xc6, 0x54,
                   0xe5, 0xe1, 0x2b, 0x32, 0x3a, 0x90, 0xe4, 0x91, 0x76, 0x2b, 0x11, 0x0,  0x0,  0x3f, 0x52, 0x2,  0x0,
                   0x0,  0x77, 0xe2, 0xc7, 0xbd, 0xa7, 0x3,  0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b, 0xfa, 0x7b, 0xa9,
                   0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd,  0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc7, 0xbd, 0xa7, 0x3,  0xbb, 0x2e, 0xf8, 0x29, 0xc0, 0x7a, 0x1b, 0xfa, 0x7b, 0xa9,
                              0x9d, 0xff, 0xe0, 0x64, 0xcc, 0x9f, 0xd,  0xef, 0x1b, 0x9a, 0x51, 0xab, 0xa8};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31057);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\129\199\DEL\236d\144\134\234\&2\161\f\158;^\GS\152", _pubPktID = 0, _pubBody =
// "\168#\DC4\164\152d\226\231\214\203.3\\K\148y\227\211\138\130B\160L0\153\231\154\201\v0", _pubProps =
// [PropMessageExpiryInterval 7690,PropServerKeepAlive 8084,PropWildcardSubscriptionAvailable
// 145,PropAuthenticationMethod "\225\252\141\141\EOT.\243\188>",PropWildcardSubscriptionAvailable 224,PropTopicAlias
// 8626,PropUserProperty "/\223"
// "\194\201I\235\a\147\160j\157l\248\254[\206\210\DC4\184\140tE\t\130\ETB\234?\199\165\208\205",PropMessageExpiryInterval
// 12891,PropRequestProblemInformation 203,PropReceiveMaximum 28713,PropMaximumQoS 5,PropAuthenticationMethod
// "5]\139\214\162T\234\SO\ETB8\ENQ\243\217\151\rC\206\171\201",PropAssignedClientIdentifier
// "\228\213\164\148sUj\233P\251\DC1\239M\204\208@?0",PropPayloadFormatIndicator 124,PropResponseTopic
// "\165w\178\234\a\147",PropRequestProblemInformation 73,PropSharedSubscriptionAvailable 133,PropMaximumPacketSize
// 6940,PropMaximumQoS 27,PropCorrelationData
// "\141\STX\246\253\217B\210\170\196\142pT\200'\NUL\188\236\&5\216PP\224",PropPayloadFormatIndicator
// 189,PropWildcardSubscriptionAvailable 96,PropResponseInformation
// "\141\148\EOT\203",PropSubscriptionIdentifierAvailable 25,PropMessageExpiryInterval 17864]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x39, 0xea, 0x1,  0x0,  0x11, 0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea, 0x32, 0xa1, 0xc,
                   0x9e, 0x3b, 0x5e, 0x1d, 0x98, 0xb7, 0x1,  0x2,  0x0,  0x0,  0x1e, 0xa,  0x13, 0x1f, 0x94, 0x28, 0x91,
                   0x15, 0x0,  0x9,  0xe1, 0xfc, 0x8d, 0x8d, 0x4,  0x2e, 0xf3, 0xbc, 0x3e, 0x28, 0xe0, 0x23, 0x21, 0xb2,
                   0x26, 0x0,  0x2,  0x2f, 0xdf, 0x0,  0x1d, 0xc2, 0xc9, 0x49, 0xeb, 0x7,  0x93, 0xa0, 0x6a, 0x9d, 0x6c,
                   0xf8, 0xfe, 0x5b, 0xce, 0xd2, 0x14, 0xb8, 0x8c, 0x74, 0x45, 0x9,  0x82, 0x17, 0xea, 0x3f, 0xc7, 0xa5,
                   0xd0, 0xcd, 0x2,  0x0,  0x0,  0x32, 0x5b, 0x17, 0xcb, 0x21, 0x70, 0x29, 0x24, 0x5,  0x15, 0x0,  0x13,
                   0x35, 0x5d, 0x8b, 0xd6, 0xa2, 0x54, 0xea, 0xe,  0x17, 0x38, 0x5,  0xf3, 0xd9, 0x97, 0xd,  0x43, 0xce,
                   0xab, 0xc9, 0x12, 0x0,  0x12, 0xe4, 0xd5, 0xa4, 0x94, 0x73, 0x55, 0x6a, 0xe9, 0x50, 0xfb, 0x11, 0xef,
                   0x4d, 0xcc, 0xd0, 0x40, 0x3f, 0x30, 0x1,  0x7c, 0x8,  0x0,  0x6,  0xa5, 0x77, 0xb2, 0xea, 0x7,  0x93,
                   0x17, 0x49, 0x2a, 0x85, 0x27, 0x0,  0x0,  0x1b, 0x1c, 0x24, 0x1b, 0x9,  0x0,  0x16, 0x8d, 0x2,  0xf6,
                   0xfd, 0xd9, 0x42, 0xd2, 0xaa, 0xc4, 0x8e, 0x70, 0x54, 0xc8, 0x27, 0x0,  0xbc, 0xec, 0x35, 0xd8, 0x50,
                   0x50, 0xe0, 0x1,  0xbd, 0x28, 0x60, 0x1a, 0x0,  0x4,  0x8d, 0x94, 0x4,  0xcb, 0x29, 0x19, 0x2,  0x0,
                   0x0,  0x45, 0xc8, 0xa8, 0x23, 0x14, 0xa4, 0x98, 0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b,
                   0x94, 0x79, 0xe3, 0xd3, 0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  uint8_t topic_bytes[] = {0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea,
                           0x32, 0xa1, 0xc,  0x9e, 0x3b, 0x5e, 0x1d, 0x98};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa8, 0x23, 0x14, 0xa4, 0x98, 0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b, 0x94,
                         0x79, 0xe3, 0xd3, 0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0xe1, 0xfc, 0x8d, 0x8d, 0x4, 0x2e, 0xf3, 0xbc, 0x3e};
  uint8_t bytesprops2[] = {0xc2, 0xc9, 0x49, 0xeb, 0x7,  0x93, 0xa0, 0x6a, 0x9d, 0x6c, 0xf8, 0xfe, 0x5b, 0xce, 0xd2,
                           0x14, 0xb8, 0x8c, 0x74, 0x45, 0x9,  0x82, 0x17, 0xea, 0x3f, 0xc7, 0xa5, 0xd0, 0xcd};
  uint8_t bytesprops1[] = {0x2f, 0xdf};
  uint8_t bytesprops3[] = {0x35, 0x5d, 0x8b, 0xd6, 0xa2, 0x54, 0xea, 0xe,  0x17, 0x38,
                           0x5,  0xf3, 0xd9, 0x97, 0xd,  0x43, 0xce, 0xab, 0xc9};
  uint8_t bytesprops4[] = {0xe4, 0xd5, 0xa4, 0x94, 0x73, 0x55, 0x6a, 0xe9, 0x50,
                           0xfb, 0x11, 0xef, 0x4d, 0xcc, 0xd0, 0x40, 0x3f, 0x30};
  uint8_t bytesprops5[] = {0xa5, 0x77, 0xb2, 0xea, 0x7, 0x93};
  uint8_t bytesprops6[] = {0x8d, 0x2,  0xf6, 0xfd, 0xd9, 0x42, 0xd2, 0xaa, 0xc4, 0x8e, 0x70,
                           0x54, 0xc8, 0x27, 0x0,  0xbc, 0xec, 0x35, 0xd8, 0x50, 0x50, 0xe0};
  uint8_t bytesprops7[] = {0x8d, 0x94, 0x4, 0xcb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7690}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8084}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8626}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops1}, .v = {29, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12891}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28713}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6940}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17864}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "V\129\199\DEL\236d\144\134\234\&2\161\f\158;^\GS\152", _pubPktID = 0, _pubBody =
// "\168#\DC4\164\152d\226\231\214\203.3\\K\148y\227\211\138\130B\160L0\153\231\154\201\v0", _pubProps =
// [PropMessageExpiryInterval 7690,PropServerKeepAlive 8084,PropWildcardSubscriptionAvailable
// 145,PropAuthenticationMethod "\225\252\141\141\EOT.\243\188>",PropWildcardSubscriptionAvailable 224,PropTopicAlias
// 8626,PropUserProperty "/\223"
// "\194\201I\235\a\147\160j\157l\248\254[\206\210\DC4\184\140tE\t\130\ETB\234?\199\165\208\205",PropMessageExpiryInterval
// 12891,PropRequestProblemInformation 203,PropReceiveMaximum 28713,PropMaximumQoS 5,PropAuthenticationMethod
// "5]\139\214\162T\234\SO\ETB8\ENQ\243\217\151\rC\206\171\201",PropAssignedClientIdentifier
// "\228\213\164\148sUj\233P\251\DC1\239M\204\208@?0",PropPayloadFormatIndicator 124,PropResponseTopic
// "\165w\178\234\a\147",PropRequestProblemInformation 73,PropSharedSubscriptionAvailable 133,PropMaximumPacketSize
// 6940,PropMaximumQoS 27,PropCorrelationData
// "\141\STX\246\253\217B\210\170\196\142pT\200'\NUL\188\236\&5\216PP\224",PropPayloadFormatIndicator
// 189,PropWildcardSubscriptionAvailable 96,PropResponseInformation
// "\141\148\EOT\203",PropSubscriptionIdentifierAvailable 25,PropMessageExpiryInterval 17864]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x39, 0xea, 0x1,  0x0,  0x11, 0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea, 0x32, 0xa1, 0xc,
                   0x9e, 0x3b, 0x5e, 0x1d, 0x98, 0xb7, 0x1,  0x2,  0x0,  0x0,  0x1e, 0xa,  0x13, 0x1f, 0x94, 0x28, 0x91,
                   0x15, 0x0,  0x9,  0xe1, 0xfc, 0x8d, 0x8d, 0x4,  0x2e, 0xf3, 0xbc, 0x3e, 0x28, 0xe0, 0x23, 0x21, 0xb2,
                   0x26, 0x0,  0x2,  0x2f, 0xdf, 0x0,  0x1d, 0xc2, 0xc9, 0x49, 0xeb, 0x7,  0x93, 0xa0, 0x6a, 0x9d, 0x6c,
                   0xf8, 0xfe, 0x5b, 0xce, 0xd2, 0x14, 0xb8, 0x8c, 0x74, 0x45, 0x9,  0x82, 0x17, 0xea, 0x3f, 0xc7, 0xa5,
                   0xd0, 0xcd, 0x2,  0x0,  0x0,  0x32, 0x5b, 0x17, 0xcb, 0x21, 0x70, 0x29, 0x24, 0x5,  0x15, 0x0,  0x13,
                   0x35, 0x5d, 0x8b, 0xd6, 0xa2, 0x54, 0xea, 0xe,  0x17, 0x38, 0x5,  0xf3, 0xd9, 0x97, 0xd,  0x43, 0xce,
                   0xab, 0xc9, 0x12, 0x0,  0x12, 0xe4, 0xd5, 0xa4, 0x94, 0x73, 0x55, 0x6a, 0xe9, 0x50, 0xfb, 0x11, 0xef,
                   0x4d, 0xcc, 0xd0, 0x40, 0x3f, 0x30, 0x1,  0x7c, 0x8,  0x0,  0x6,  0xa5, 0x77, 0xb2, 0xea, 0x7,  0x93,
                   0x17, 0x49, 0x2a, 0x85, 0x27, 0x0,  0x0,  0x1b, 0x1c, 0x24, 0x1b, 0x9,  0x0,  0x16, 0x8d, 0x2,  0xf6,
                   0xfd, 0xd9, 0x42, 0xd2, 0xaa, 0xc4, 0x8e, 0x70, 0x54, 0xc8, 0x27, 0x0,  0xbc, 0xec, 0x35, 0xd8, 0x50,
                   0x50, 0xe0, 0x1,  0xbd, 0x28, 0x60, 0x1a, 0x0,  0x4,  0x8d, 0x94, 0x4,  0xcb, 0x29, 0x19, 0x2,  0x0,
                   0x0,  0x45, 0xc8, 0xa8, 0x23, 0x14, 0xa4, 0x98, 0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b,
                   0x94, 0x79, 0xe3, 0xd3, 0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0x81, 0xc7, 0x7f, 0xec, 0x64, 0x90, 0x86, 0xea,
                               0x32, 0xa1, 0xc,  0x9e, 0x3b, 0x5e, 0x1d, 0x98};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa8, 0x23, 0x14, 0xa4, 0x98, 0x64, 0xe2, 0xe7, 0xd6, 0xcb, 0x2e, 0x33, 0x5c, 0x4b, 0x94,
                              0x79, 0xe3, 0xd3, 0x8a, 0x82, 0x42, 0xa0, 0x4c, 0x30, 0x99, 0xe7, 0x9a, 0xc9, 0xb,  0x30};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ESC\176mM-\183\&6\136p\203\156\172", _pubPktID = 0, _pubBody = "\DC2\166\130\180V\157\163bV", _pubProps =
// [PropMessageExpiryInterval 17805,PropTopicAlias 29809,PropMaximumQoS 128,PropRetainAvailable 153,PropRetainAvailable
// 46,PropSharedSubscriptionAvailable 149,PropMaximumQoS 3,PropMaximumQoS 125,PropResponseInformation
// "\167C\211\194(\200\141(\149\DC2\219j\132\&2{\240\186\202L",PropRequestProblemInformation
// 248,PropAuthenticationMethod "\206",PropMaximumQoS 93,PropServerKeepAlive 14778,PropAuthenticationMethod
// "\213\&3i\218\248\201\195\&0\144\DC1\201X\v\ETX",PropContentType
// "=-f\157g\238l\191\136\191\SOH\189\&6t\225xbg",PropMessageExpiryInterval 10427,PropSubscriptionIdentifierAvailable
// 0,PropSessionExpiryInterval 10212,PropTopicAlias 2252,PropServerReference
// "\EM=\"\187\NUL\249;\128\224\141\226\215\213\ETX\ESC7\v0\205\191C\222k8",PropRequestProblemInformation
// 186,PropCorrelationData "\r\236\154\129\SUB\204W\142\209Vt3L\183@A\213y",PropAuthenticationData
// "\FS\156\229\253\233\&4\218\RS\196BB\SI\147\\7\254R-\USD\233q5",PropAuthenticationMethod
// "\249L|\175l\249\USC\CAN\252\EOT\139s",PropAuthenticationData "\147"]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x31, 0xe3, 0x1,  0x0,  0xc,  0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70, 0xcb, 0x9c, 0xac,
                   0xca, 0x1,  0x2,  0x0,  0x0,  0x45, 0x8d, 0x23, 0x74, 0x71, 0x24, 0x80, 0x25, 0x99, 0x25, 0x2e, 0x2a,
                   0x95, 0x24, 0x3,  0x24, 0x7d, 0x1a, 0x0,  0x13, 0xa7, 0x43, 0xd3, 0xc2, 0x28, 0xc8, 0x8d, 0x28, 0x95,
                   0x12, 0xdb, 0x6a, 0x84, 0x32, 0x7b, 0xf0, 0xba, 0xca, 0x4c, 0x17, 0xf8, 0x15, 0x0,  0x1,  0xce, 0x24,
                   0x5d, 0x13, 0x39, 0xba, 0x15, 0x0,  0xe,  0xd5, 0x33, 0x69, 0xda, 0xf8, 0xc9, 0xc3, 0x30, 0x90, 0x11,
                   0xc9, 0x58, 0xb,  0x3,  0x3,  0x0,  0x12, 0x3d, 0x2d, 0x66, 0x9d, 0x67, 0xee, 0x6c, 0xbf, 0x88, 0xbf,
                   0x1,  0xbd, 0x36, 0x74, 0xe1, 0x78, 0x62, 0x67, 0x2,  0x0,  0x0,  0x28, 0xbb, 0x29, 0x0,  0x11, 0x0,
                   0x0,  0x27, 0xe4, 0x23, 0x8,  0xcc, 0x1c, 0x0,  0x18, 0x19, 0x3d, 0x22, 0xbb, 0x0,  0xf9, 0x3b, 0x80,
                   0xe0, 0x8d, 0xe2, 0xd7, 0xd5, 0x3,  0x1b, 0x37, 0xb,  0x30, 0xcd, 0xbf, 0x43, 0xde, 0x6b, 0x38, 0x17,
                   0xba, 0x9,  0x0,  0x12, 0xd,  0xec, 0x9a, 0x81, 0x1a, 0xcc, 0x57, 0x8e, 0xd1, 0x56, 0x74, 0x33, 0x4c,
                   0xb7, 0x40, 0x41, 0xd5, 0x79, 0x16, 0x0,  0x17, 0x1c, 0x9c, 0xe5, 0xfd, 0xe9, 0x34, 0xda, 0x1e, 0xc4,
                   0x42, 0x42, 0xf,  0x93, 0x5c, 0x37, 0xfe, 0x52, 0x2d, 0x1f, 0x44, 0xe9, 0x71, 0x35, 0x15, 0x0,  0xd,
                   0xf9, 0x4c, 0x7c, 0xaf, 0x6c, 0xf9, 0x1f, 0x43, 0x18, 0xfc, 0x4,  0x8b, 0x73, 0x16, 0x0,  0x1,  0x93,
                   0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  uint8_t topic_bytes[] = {0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70, 0xcb, 0x9c, 0xac};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0xa7, 0x43, 0xd3, 0xc2, 0x28, 0xc8, 0x8d, 0x28, 0x95, 0x12,
                           0xdb, 0x6a, 0x84, 0x32, 0x7b, 0xf0, 0xba, 0xca, 0x4c};
  uint8_t bytesprops1[] = {0xce};
  uint8_t bytesprops2[] = {0xd5, 0x33, 0x69, 0xda, 0xf8, 0xc9, 0xc3, 0x30, 0x90, 0x11, 0xc9, 0x58, 0xb, 0x3};
  uint8_t bytesprops3[] = {0x3d, 0x2d, 0x66, 0x9d, 0x67, 0xee, 0x6c, 0xbf, 0x88,
                           0xbf, 0x1,  0xbd, 0x36, 0x74, 0xe1, 0x78, 0x62, 0x67};
  uint8_t bytesprops4[] = {0x19, 0x3d, 0x22, 0xbb, 0x0, 0xf9, 0x3b, 0x80, 0xe0, 0x8d, 0xe2, 0xd7,
                           0xd5, 0x3,  0x1b, 0x37, 0xb, 0x30, 0xcd, 0xbf, 0x43, 0xde, 0x6b, 0x38};
  uint8_t bytesprops5[] = {0xd,  0xec, 0x9a, 0x81, 0x1a, 0xcc, 0x57, 0x8e, 0xd1,
                           0x56, 0x74, 0x33, 0x4c, 0xb7, 0x40, 0x41, 0xd5, 0x79};
  uint8_t bytesprops6[] = {0x1c, 0x9c, 0xe5, 0xfd, 0xe9, 0x34, 0xda, 0x1e, 0xc4, 0x42, 0x42, 0xf,
                           0x93, 0x5c, 0x37, 0xfe, 0x52, 0x2d, 0x1f, 0x44, 0xe9, 0x71, 0x35};
  uint8_t bytesprops7[] = {0xf9, 0x4c, 0x7c, 0xaf, 0x6c, 0xf9, 0x1f, 0x43, 0x18, 0xfc, 0x4, 0x8b, 0x73};
  uint8_t bytesprops8[] = {0x93};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17805}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29809}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14778}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10427}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10212}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2252}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\ESC\176mM-\183\&6\136p\203\156\172", _pubPktID = 0, _pubBody = "\DC2\166\130\180V\157\163bV", _pubProps =
// [PropMessageExpiryInterval 17805,PropTopicAlias 29809,PropMaximumQoS 128,PropRetainAvailable 153,PropRetainAvailable
// 46,PropSharedSubscriptionAvailable 149,PropMaximumQoS 3,PropMaximumQoS 125,PropResponseInformation
// "\167C\211\194(\200\141(\149\DC2\219j\132\&2{\240\186\202L",PropRequestProblemInformation
// 248,PropAuthenticationMethod "\206",PropMaximumQoS 93,PropServerKeepAlive 14778,PropAuthenticationMethod
// "\213\&3i\218\248\201\195\&0\144\DC1\201X\v\ETX",PropContentType
// "=-f\157g\238l\191\136\191\SOH\189\&6t\225xbg",PropMessageExpiryInterval 10427,PropSubscriptionIdentifierAvailable
// 0,PropSessionExpiryInterval 10212,PropTopicAlias 2252,PropServerReference
// "\EM=\"\187\NUL\249;\128\224\141\226\215\213\ETX\ESC7\v0\205\191C\222k8",PropRequestProblemInformation
// 186,PropCorrelationData "\r\236\154\129\SUB\204W\142\209Vt3L\183@A\213y",PropAuthenticationData
// "\FS\156\229\253\233\&4\218\RS\196BB\SI\147\\7\254R-\USD\233q5",PropAuthenticationMethod
// "\249L|\175l\249\USC\CAN\252\EOT\139s",PropAuthenticationData "\147"]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x31, 0xe3, 0x1,  0x0,  0xc,  0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70, 0xcb, 0x9c, 0xac,
                   0xca, 0x1,  0x2,  0x0,  0x0,  0x45, 0x8d, 0x23, 0x74, 0x71, 0x24, 0x80, 0x25, 0x99, 0x25, 0x2e, 0x2a,
                   0x95, 0x24, 0x3,  0x24, 0x7d, 0x1a, 0x0,  0x13, 0xa7, 0x43, 0xd3, 0xc2, 0x28, 0xc8, 0x8d, 0x28, 0x95,
                   0x12, 0xdb, 0x6a, 0x84, 0x32, 0x7b, 0xf0, 0xba, 0xca, 0x4c, 0x17, 0xf8, 0x15, 0x0,  0x1,  0xce, 0x24,
                   0x5d, 0x13, 0x39, 0xba, 0x15, 0x0,  0xe,  0xd5, 0x33, 0x69, 0xda, 0xf8, 0xc9, 0xc3, 0x30, 0x90, 0x11,
                   0xc9, 0x58, 0xb,  0x3,  0x3,  0x0,  0x12, 0x3d, 0x2d, 0x66, 0x9d, 0x67, 0xee, 0x6c, 0xbf, 0x88, 0xbf,
                   0x1,  0xbd, 0x36, 0x74, 0xe1, 0x78, 0x62, 0x67, 0x2,  0x0,  0x0,  0x28, 0xbb, 0x29, 0x0,  0x11, 0x0,
                   0x0,  0x27, 0xe4, 0x23, 0x8,  0xcc, 0x1c, 0x0,  0x18, 0x19, 0x3d, 0x22, 0xbb, 0x0,  0xf9, 0x3b, 0x80,
                   0xe0, 0x8d, 0xe2, 0xd7, 0xd5, 0x3,  0x1b, 0x37, 0xb,  0x30, 0xcd, 0xbf, 0x43, 0xde, 0x6b, 0x38, 0x17,
                   0xba, 0x9,  0x0,  0x12, 0xd,  0xec, 0x9a, 0x81, 0x1a, 0xcc, 0x57, 0x8e, 0xd1, 0x56, 0x74, 0x33, 0x4c,
                   0xb7, 0x40, 0x41, 0xd5, 0x79, 0x16, 0x0,  0x17, 0x1c, 0x9c, 0xe5, 0xfd, 0xe9, 0x34, 0xda, 0x1e, 0xc4,
                   0x42, 0x42, 0xf,  0x93, 0x5c, 0x37, 0xfe, 0x52, 0x2d, 0x1f, 0x44, 0xe9, 0x71, 0x35, 0x15, 0x0,  0xd,
                   0xf9, 0x4c, 0x7c, 0xaf, 0x6c, 0xf9, 0x1f, 0x43, 0x18, 0xfc, 0x4,  0x8b, 0x73, 0x16, 0x0,  0x1,  0x93,
                   0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x1b, 0xb0, 0x6d, 0x4d, 0x2d, 0xb7, 0x36, 0x88, 0x70, 0xcb, 0x9c, 0xac};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x12, 0xa6, 0x82, 0xb4, 0x56, 0x9d, 0xa3, 0x62, 0x56};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\178\SI\169\146\239\178\SYN\STX",
// _pubPktID = 0, _pubBody = "K\148\ETX%\135\&7\194\158\DLE\ENQ\215\157\176\ESCA\f", _pubProps =
// [PropSessionExpiryInterval 18509,PropWildcardSubscriptionAvailable 204,PropServerKeepAlive
// 24461,PropRequestResponseInformation 156,PropPayloadFormatIndicator 7,PropAssignedClientIdentifier "",PropTopicAlias
// 26242,PropTopicAlias 7376,PropServerReference "\145D\f",PropSubscriptionIdentifier 7]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x30, 0x3a, 0x0,  0x8,  0xb2, 0xf,  0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2,  0x1f, 0x11, 0x0,
                   0x0,  0x48, 0x4d, 0x28, 0xcc, 0x13, 0x5f, 0x8d, 0x19, 0x9c, 0x1,  0x7,  0x12, 0x0,  0x0,
                   0x23, 0x66, 0x82, 0x23, 0x1c, 0xd0, 0x1c, 0x0,  0x3,  0x91, 0x44, 0xc,  0xb,  0x7,  0x4b,
                   0x94, 0x3,  0x25, 0x87, 0x37, 0xc2, 0x9e, 0x10, 0x5,  0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  uint8_t topic_bytes[] = {0xb2, 0xf, 0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4b, 0x94, 0x3, 0x25, 0x87, 0x37, 0xc2, 0x9e, 0x10, 0x5, 0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x91, 0x44, 0xc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18509}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24461}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26242}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7376}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\178\SI\169\146\239\178\SYN\STX",
// _pubPktID = 0, _pubBody = "K\148\ETX%\135\&7\194\158\DLE\ENQ\215\157\176\ESCA\f", _pubProps =
// [PropSessionExpiryInterval 18509,PropWildcardSubscriptionAvailable 204,PropServerKeepAlive
// 24461,PropRequestResponseInformation 156,PropPayloadFormatIndicator 7,PropAssignedClientIdentifier "",PropTopicAlias
// 26242,PropTopicAlias 7376,PropServerReference "\145D\f",PropSubscriptionIdentifier 7]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {0x30, 0x3a, 0x0,  0x8,  0xb2, 0xf,  0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2,  0x1f, 0x11, 0x0,
                   0x0,  0x48, 0x4d, 0x28, 0xcc, 0x13, 0x5f, 0x8d, 0x19, 0x9c, 0x1,  0x7,  0x12, 0x0,  0x0,
                   0x23, 0x66, 0x82, 0x23, 0x1c, 0xd0, 0x1c, 0x0,  0x3,  0x91, 0x44, 0xc,  0xb,  0x7,  0x4b,
                   0x94, 0x3,  0x25, 0x87, 0x37, 0xc2, 0x9e, 0x10, 0x5,  0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb2, 0xf, 0xa9, 0x92, 0xef, 0xb2, 0x16, 0x2};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4b, 0x94, 0x3,  0x25, 0x87, 0x37, 0xc2, 0x9e,
                              0x10, 0x5,  0xd7, 0x9d, 0xb0, 0x1b, 0x41, 0xc};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\164Y\252JlD$\198\DC1l\vM\194\NAK\194I\144\STX:c\158)N*", _pubPktID = 7891, _pubBody =
// "\176\162\NAK'B\224M\185\SYNa\n\151\146\160U", _pubProps = [PropSessionExpiryInterval 2392,PropServerReference
// "\153\182\131\197\135\174\198\132\EOT[\239\255F\240\196B\162",PropCorrelationData
// "\212",PropRequestResponseInformation 95,PropMessageExpiryInterval 25207,PropRetainAvailable
// 216,PropAssignedClientIdentifier "\149\164\215\200\249\n\RS\155{",PropAssignedClientIdentifier
// "\\\246\175\154*\160\ETB]mH\162\130\157\NUL\253\&2C\SO\\I",PropMaximumQoS 211,PropWillDelayInterval
// 18802,PropMaximumQoS 128,PropPayloadFormatIndicator 208,PropSharedSubscriptionAvailable 4,PropAuthenticationData
// "\150\167E\SIJ\131?\n\147\188\144\177\232\203\187\219\181\ESC\230!\250Xmb",PropSubscriptionIdentifier
// 12,PropMessageExpiryInterval 1249,PropSessionExpiryInterval 20430,PropReceiveMaximum
// 8060,PropWildcardSubscriptionAvailable 85]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {0x35, 0xaf, 0x1,  0x0,  0x18, 0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,  0x4d,
                   0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a, 0x1e, 0xd3, 0x82, 0x1,  0x11,
                   0x0,  0x0,  0x9,  0x58, 0x1c, 0x0,  0x11, 0x99, 0xb6, 0x83, 0xc5, 0x87, 0xae, 0xc6, 0x84, 0x4,  0x5b,
                   0xef, 0xff, 0x46, 0xf0, 0xc4, 0x42, 0xa2, 0x9,  0x0,  0x1,  0xd4, 0x19, 0x5f, 0x2,  0x0,  0x0,  0x62,
                   0x77, 0x25, 0xd8, 0x12, 0x0,  0x9,  0x95, 0xa4, 0xd7, 0xc8, 0xf9, 0xa,  0x1e, 0x9b, 0x7b, 0x12, 0x0,
                   0x14, 0x5c, 0xf6, 0xaf, 0x9a, 0x2a, 0xa0, 0x17, 0x5d, 0x6d, 0x48, 0xa2, 0x82, 0x9d, 0x0,  0xfd, 0x32,
                   0x43, 0xe,  0x5c, 0x49, 0x24, 0xd3, 0x18, 0x0,  0x0,  0x49, 0x72, 0x24, 0x80, 0x1,  0xd0, 0x2a, 0x4,
                   0x16, 0x0,  0x18, 0x96, 0xa7, 0x45, 0xf,  0x4a, 0x83, 0x3f, 0xa,  0x93, 0xbc, 0x90, 0xb1, 0xe8, 0xcb,
                   0xbb, 0xdb, 0xb5, 0x1b, 0xe6, 0x21, 0xfa, 0x58, 0x6d, 0x62, 0xb,  0xc,  0x2,  0x0,  0x0,  0x4,  0xe1,
                   0x11, 0x0,  0x0,  0x4f, 0xce, 0x21, 0x1f, 0x7c, 0x28, 0x55, 0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d,
                   0xb9, 0x16, 0x61, 0xa,  0x97, 0x92, 0xa0, 0x55};
  uint8_t topic_bytes[] = {0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,  0x4d,
                           0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d, 0xb9, 0x16, 0x61, 0xa, 0x97, 0x92, 0xa0, 0x55};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x99, 0xb6, 0x83, 0xc5, 0x87, 0xae, 0xc6, 0x84, 0x4,
                           0x5b, 0xef, 0xff, 0x46, 0xf0, 0xc4, 0x42, 0xa2};
  uint8_t bytesprops1[] = {0xd4};
  uint8_t bytesprops2[] = {0x95, 0xa4, 0xd7, 0xc8, 0xf9, 0xa, 0x1e, 0x9b, 0x7b};
  uint8_t bytesprops3[] = {0x5c, 0xf6, 0xaf, 0x9a, 0x2a, 0xa0, 0x17, 0x5d, 0x6d, 0x48,
                           0xa2, 0x82, 0x9d, 0x0,  0xfd, 0x32, 0x43, 0xe,  0x5c, 0x49};
  uint8_t bytesprops4[] = {0x96, 0xa7, 0x45, 0xf,  0x4a, 0x83, 0x3f, 0xa,  0x93, 0xbc, 0x90, 0xb1,
                           0xe8, 0xcb, 0xbb, 0xdb, 0xb5, 0x1b, 0xe6, 0x21, 0xfa, 0x58, 0x6d, 0x62};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2392}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25207}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18802}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1249}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20430}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8060}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 85}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7891, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\164Y\252JlD$\198\DC1l\vM\194\NAK\194I\144\STX:c\158)N*", _pubPktID = 7891, _pubBody =
// "\176\162\NAK'B\224M\185\SYNa\n\151\146\160U", _pubProps = [PropSessionExpiryInterval 2392,PropServerReference
// "\153\182\131\197\135\174\198\132\EOT[\239\255F\240\196B\162",PropCorrelationData
// "\212",PropRequestResponseInformation 95,PropMessageExpiryInterval 25207,PropRetainAvailable
// 216,PropAssignedClientIdentifier "\149\164\215\200\249\n\RS\155{",PropAssignedClientIdentifier
// "\\\246\175\154*\160\ETB]mH\162\130\157\NUL\253\&2C\SO\\I",PropMaximumQoS 211,PropWillDelayInterval
// 18802,PropMaximumQoS 128,PropPayloadFormatIndicator 208,PropSharedSubscriptionAvailable 4,PropAuthenticationData
// "\150\167E\SIJ\131?\n\147\188\144\177\232\203\187\219\181\ESC\230!\250Xmb",PropSubscriptionIdentifier
// 12,PropMessageExpiryInterval 1249,PropSessionExpiryInterval 20430,PropReceiveMaximum
// 8060,PropWildcardSubscriptionAvailable 85]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {0x35, 0xaf, 0x1,  0x0,  0x18, 0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,  0x4d,
                   0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a, 0x1e, 0xd3, 0x82, 0x1,  0x11,
                   0x0,  0x0,  0x9,  0x58, 0x1c, 0x0,  0x11, 0x99, 0xb6, 0x83, 0xc5, 0x87, 0xae, 0xc6, 0x84, 0x4,  0x5b,
                   0xef, 0xff, 0x46, 0xf0, 0xc4, 0x42, 0xa2, 0x9,  0x0,  0x1,  0xd4, 0x19, 0x5f, 0x2,  0x0,  0x0,  0x62,
                   0x77, 0x25, 0xd8, 0x12, 0x0,  0x9,  0x95, 0xa4, 0xd7, 0xc8, 0xf9, 0xa,  0x1e, 0x9b, 0x7b, 0x12, 0x0,
                   0x14, 0x5c, 0xf6, 0xaf, 0x9a, 0x2a, 0xa0, 0x17, 0x5d, 0x6d, 0x48, 0xa2, 0x82, 0x9d, 0x0,  0xfd, 0x32,
                   0x43, 0xe,  0x5c, 0x49, 0x24, 0xd3, 0x18, 0x0,  0x0,  0x49, 0x72, 0x24, 0x80, 0x1,  0xd0, 0x2a, 0x4,
                   0x16, 0x0,  0x18, 0x96, 0xa7, 0x45, 0xf,  0x4a, 0x83, 0x3f, 0xa,  0x93, 0xbc, 0x90, 0xb1, 0xe8, 0xcb,
                   0xbb, 0xdb, 0xb5, 0x1b, 0xe6, 0x21, 0xfa, 0x58, 0x6d, 0x62, 0xb,  0xc,  0x2,  0x0,  0x0,  0x4,  0xe1,
                   0x11, 0x0,  0x0,  0x4f, 0xce, 0x21, 0x1f, 0x7c, 0x28, 0x55, 0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d,
                   0xb9, 0x16, 0x61, 0xa,  0x97, 0x92, 0xa0, 0x55};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa4, 0x59, 0xfc, 0x4a, 0x6c, 0x44, 0x24, 0xc6, 0x11, 0x6c, 0xb,  0x4d,
                               0xc2, 0x15, 0xc2, 0x49, 0x90, 0x2,  0x3a, 0x63, 0x9e, 0x29, 0x4e, 0x2a};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb0, 0xa2, 0x15, 0x27, 0x42, 0xe0, 0x4d, 0xb9, 0x16, 0x61, 0xa, 0x97, 0x92, 0xa0, 0x55};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 7891);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\168\NAKx\SI\199\207\184(\186\150r\FS\189\205\252\135\250\205\254\148\161\239\228\176s", _pubPktID = 0, _pubBody =
// "\135", _pubProps = [PropSharedSubscriptionAvailable 243,PropAuthenticationMethod
// "\EM\146\213\227R",PropSessionExpiryInterval 30811]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x31, 0x2c, 0x0,  0x19, 0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72, 0x1c,
                   0xbd, 0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73, 0xf,  0x2a, 0xf3,
                   0x15, 0x0,  0x5,  0x19, 0x92, 0xd5, 0xe3, 0x52, 0x11, 0x0,  0x0,  0x78, 0x5b, 0x87};
  uint8_t topic_bytes[] = {0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72, 0x1c, 0xbd,
                           0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x87};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x19, 0x92, 0xd5, 0xe3, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30811}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\168\NAKx\SI\199\207\184(\186\150r\FS\189\205\252\135\250\205\254\148\161\239\228\176s", _pubPktID = 0, _pubBody =
// "\135", _pubProps = [PropSharedSubscriptionAvailable 243,PropAuthenticationMethod
// "\EM\146\213\227R",PropSessionExpiryInterval 30811]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x31, 0x2c, 0x0,  0x19, 0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72, 0x1c,
                   0xbd, 0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73, 0xf,  0x2a, 0xf3,
                   0x15, 0x0,  0x5,  0x19, 0x92, 0xd5, 0xe3, 0x52, 0x11, 0x0,  0x0,  0x78, 0x5b, 0x87};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa8, 0x15, 0x78, 0xf,  0xc7, 0xcf, 0xb8, 0x28, 0xba, 0x96, 0x72, 0x1c, 0xbd,
                               0xcd, 0xfc, 0x87, 0xfa, 0xcd, 0xfe, 0x94, 0xa1, 0xef, 0xe4, 0xb0, 0x73};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x87};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\140r\DC3\130\161\ENQ", _pubPktID =
// 6491, _pubBody = "\241G\235!\175\252\158\183\145\224\246\172\SYN\130\131/\254\205\ENQ\GS?", _pubProps =
// [PropResponseTopic "\131\205\&2\194yD\165\177\183\161\144z",PropReasonString
// "\229\216EX`\EOT\171\146\185\bl\224\&6VsG\200z0-]|",PropRequestResponseInformation 60,PropSessionExpiryInterval
// 21347,PropSubscriptionIdentifier 29,PropUserProperty
// "\207*\196\202)\141^C+\128\131\208\195[\ETB\136\184\SYN\243\206\DC4\168"
// "\236,\167o\134F\241\140\GS\187J\131\194\247f<\158{\189\ACK\SOHUk\192",PropAuthenticationData
// "\"Vf\232]\CAN\189=\235F\150c",PropSessionExpiryInterval 22735,PropServerKeepAlive 31363,PropRetainAvailable
// 54,PropAuthenticationMethod
// "\165\212~\DC4\a\227R\US\150\195\221\&4\145\220\&31yVM\226\SOH\188\190-\ETXV\196\236s",PropAuthenticationData
// "k\201W\138\129\r\135\146\166\233\214"]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x3a, 0xcc, 0x1,  0x0,  0x6,  0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5,  0x19, 0x5b, 0xab, 0x1,  0x8,  0x0,  0xc,  0x83,
      0xcd, 0x32, 0xc2, 0x79, 0x44, 0xa5, 0xb1, 0xb7, 0xa1, 0x90, 0x7a, 0x1f, 0x0,  0x16, 0xe5, 0xd8, 0x45, 0x58, 0x60,
      0x4,  0xab, 0x92, 0xb9, 0x8,  0x6c, 0xe0, 0x36, 0x56, 0x73, 0x47, 0xc8, 0x7a, 0x30, 0x2d, 0x5d, 0x7c, 0x19, 0x3c,
      0x11, 0x0,  0x0,  0x53, 0x63, 0xb,  0x1d, 0x26, 0x0,  0x16, 0xcf, 0x2a, 0xc4, 0xca, 0x29, 0x8d, 0x5e, 0x43, 0x2b,
      0x80, 0x83, 0xd0, 0xc3, 0x5b, 0x17, 0x88, 0xb8, 0x16, 0xf3, 0xce, 0x14, 0xa8, 0x0,  0x18, 0xec, 0x2c, 0xa7, 0x6f,
      0x86, 0x46, 0xf1, 0x8c, 0x1d, 0xbb, 0x4a, 0x83, 0xc2, 0xf7, 0x66, 0x3c, 0x9e, 0x7b, 0xbd, 0x6,  0x1,  0x55, 0x6b,
      0xc0, 0x16, 0x0,  0xc,  0x22, 0x56, 0x66, 0xe8, 0x5d, 0x18, 0xbd, 0x3d, 0xeb, 0x46, 0x96, 0x63, 0x11, 0x0,  0x0,
      0x58, 0xcf, 0x13, 0x7a, 0x83, 0x25, 0x36, 0x15, 0x0,  0x1d, 0xa5, 0xd4, 0x7e, 0x14, 0x7,  0xe3, 0x52, 0x1f, 0x96,
      0xc3, 0xdd, 0x34, 0x91, 0xdc, 0x33, 0x31, 0x79, 0x56, 0x4d, 0xe2, 0x1,  0xbc, 0xbe, 0x2d, 0x3,  0x56, 0xc4, 0xec,
      0x73, 0x16, 0x0,  0xb,  0x6b, 0xc9, 0x57, 0x8a, 0x81, 0xd,  0x87, 0x92, 0xa6, 0xe9, 0xd6, 0xf1, 0x47, 0xeb, 0x21,
      0xaf, 0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6, 0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  uint8_t topic_bytes[] = {0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf1, 0x47, 0xeb, 0x21, 0xaf, 0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6,
                         0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0x83, 0xcd, 0x32, 0xc2, 0x79, 0x44, 0xa5, 0xb1, 0xb7, 0xa1, 0x90, 0x7a};
  uint8_t bytesprops1[] = {0xe5, 0xd8, 0x45, 0x58, 0x60, 0x4,  0xab, 0x92, 0xb9, 0x8,  0x6c,
                           0xe0, 0x36, 0x56, 0x73, 0x47, 0xc8, 0x7a, 0x30, 0x2d, 0x5d, 0x7c};
  uint8_t bytesprops3[] = {0xec, 0x2c, 0xa7, 0x6f, 0x86, 0x46, 0xf1, 0x8c, 0x1d, 0xbb, 0x4a, 0x83,
                           0xc2, 0xf7, 0x66, 0x3c, 0x9e, 0x7b, 0xbd, 0x6,  0x1,  0x55, 0x6b, 0xc0};
  uint8_t bytesprops2[] = {0xcf, 0x2a, 0xc4, 0xca, 0x29, 0x8d, 0x5e, 0x43, 0x2b, 0x80, 0x83,
                           0xd0, 0xc3, 0x5b, 0x17, 0x88, 0xb8, 0x16, 0xf3, 0xce, 0x14, 0xa8};
  uint8_t bytesprops4[] = {0x22, 0x56, 0x66, 0xe8, 0x5d, 0x18, 0xbd, 0x3d, 0xeb, 0x46, 0x96, 0x63};
  uint8_t bytesprops5[] = {0xa5, 0xd4, 0x7e, 0x14, 0x7,  0xe3, 0x52, 0x1f, 0x96, 0xc3, 0xdd, 0x34, 0x91, 0xdc, 0x33,
                           0x31, 0x79, 0x56, 0x4d, 0xe2, 0x1,  0xbc, 0xbe, 0x2d, 0x3,  0x56, 0xc4, 0xec, 0x73};
  uint8_t bytesprops6[] = {0x6b, 0xc9, 0x57, 0x8a, 0x81, 0xd, 0x87, 0x92, 0xa6, 0xe9, 0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21347}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops2}, .v = {24, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22735}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31363}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6491, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\140r\DC3\130\161\ENQ", _pubPktID =
// 6491, _pubBody = "\241G\235!\175\252\158\183\145\224\246\172\SYN\130\131/\254\205\ENQ\GS?", _pubProps =
// [PropResponseTopic "\131\205\&2\194yD\165\177\183\161\144z",PropReasonString
// "\229\216EX`\EOT\171\146\185\bl\224\&6VsG\200z0-]|",PropRequestResponseInformation 60,PropSessionExpiryInterval
// 21347,PropSubscriptionIdentifier 29,PropUserProperty
// "\207*\196\202)\141^C+\128\131\208\195[\ETB\136\184\SYN\243\206\DC4\168"
// "\236,\167o\134F\241\140\GS\187J\131\194\247f<\158{\189\ACK\SOHUk\192",PropAuthenticationData
// "\"Vf\232]\CAN\189=\235F\150c",PropSessionExpiryInterval 22735,PropServerKeepAlive 31363,PropRetainAvailable
// 54,PropAuthenticationMethod
// "\165\212~\DC4\a\227R\US\150\195\221\&4\145\220\&31yVM\226\SOH\188\190-\ETXV\196\236s",PropAuthenticationData
// "k\201W\138\129\r\135\146\166\233\214"]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {
      0x3a, 0xcc, 0x1,  0x0,  0x6,  0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5,  0x19, 0x5b, 0xab, 0x1,  0x8,  0x0,  0xc,  0x83,
      0xcd, 0x32, 0xc2, 0x79, 0x44, 0xa5, 0xb1, 0xb7, 0xa1, 0x90, 0x7a, 0x1f, 0x0,  0x16, 0xe5, 0xd8, 0x45, 0x58, 0x60,
      0x4,  0xab, 0x92, 0xb9, 0x8,  0x6c, 0xe0, 0x36, 0x56, 0x73, 0x47, 0xc8, 0x7a, 0x30, 0x2d, 0x5d, 0x7c, 0x19, 0x3c,
      0x11, 0x0,  0x0,  0x53, 0x63, 0xb,  0x1d, 0x26, 0x0,  0x16, 0xcf, 0x2a, 0xc4, 0xca, 0x29, 0x8d, 0x5e, 0x43, 0x2b,
      0x80, 0x83, 0xd0, 0xc3, 0x5b, 0x17, 0x88, 0xb8, 0x16, 0xf3, 0xce, 0x14, 0xa8, 0x0,  0x18, 0xec, 0x2c, 0xa7, 0x6f,
      0x86, 0x46, 0xf1, 0x8c, 0x1d, 0xbb, 0x4a, 0x83, 0xc2, 0xf7, 0x66, 0x3c, 0x9e, 0x7b, 0xbd, 0x6,  0x1,  0x55, 0x6b,
      0xc0, 0x16, 0x0,  0xc,  0x22, 0x56, 0x66, 0xe8, 0x5d, 0x18, 0xbd, 0x3d, 0xeb, 0x46, 0x96, 0x63, 0x11, 0x0,  0x0,
      0x58, 0xcf, 0x13, 0x7a, 0x83, 0x25, 0x36, 0x15, 0x0,  0x1d, 0xa5, 0xd4, 0x7e, 0x14, 0x7,  0xe3, 0x52, 0x1f, 0x96,
      0xc3, 0xdd, 0x34, 0x91, 0xdc, 0x33, 0x31, 0x79, 0x56, 0x4d, 0xe2, 0x1,  0xbc, 0xbe, 0x2d, 0x3,  0x56, 0xc4, 0xec,
      0x73, 0x16, 0x0,  0xb,  0x6b, 0xc9, 0x57, 0x8a, 0x81, 0xd,  0x87, 0x92, 0xa6, 0xe9, 0xd6, 0xf1, 0x47, 0xeb, 0x21,
      0xaf, 0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6, 0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8c, 0x72, 0x13, 0x82, 0xa1, 0x5};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf1, 0x47, 0xeb, 0x21, 0xaf, 0xfc, 0x9e, 0xb7, 0x91, 0xe0, 0xf6,
                              0xac, 0x16, 0x82, 0x83, 0x2f, 0xfe, 0xcd, 0x5,  0x1d, 0x3f};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6491);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\239\238\236\203\SI", _pubPktID =
// 8912, _pubBody = "\fH\EOT\166q\ESC\ESC\185\177A", _pubProps = [PropReasonString
// "\225\165\129\142\147\&7T\193\242o\a1\190\128@",PropWillDelayInterval 9183,PropResponseTopic
// "E{<",PropWildcardSubscriptionAvailable 82,PropSessionExpiryInterval 21830,PropSubscriptionIdentifier
// 4,PropResponseTopic "q\172\150W\180TB+\249?\228\223\&2h\162\149\ETX\EOT\217\179"]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x32, 0x51, 0x0,  0x5,  0xef, 0xee, 0xec, 0xcb, 0xf,  0x22, 0xd0, 0x3d, 0x1f, 0x0,  0xf,  0xe1, 0xa5,
                   0x81, 0x8e, 0x93, 0x37, 0x54, 0xc1, 0xf2, 0x6f, 0x7,  0x31, 0xbe, 0x80, 0x40, 0x18, 0x0,  0x0,  0x23,
                   0xdf, 0x8,  0x0,  0x3,  0x45, 0x7b, 0x3c, 0x28, 0x52, 0x11, 0x0,  0x0,  0x55, 0x46, 0xb,  0x4,  0x8,
                   0x0,  0x14, 0x71, 0xac, 0x96, 0x57, 0xb4, 0x54, 0x42, 0x2b, 0xf9, 0x3f, 0xe4, 0xdf, 0x32, 0x68, 0xa2,
                   0x95, 0x3,  0x4,  0xd9, 0xb3, 0xc,  0x48, 0x4,  0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  uint8_t topic_bytes[] = {0xef, 0xee, 0xec, 0xcb, 0xf};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc, 0x48, 0x4, 0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0xe1, 0xa5, 0x81, 0x8e, 0x93, 0x37, 0x54, 0xc1, 0xf2, 0x6f, 0x7, 0x31, 0xbe, 0x80, 0x40};
  uint8_t bytesprops1[] = {0x45, 0x7b, 0x3c};
  uint8_t bytesprops2[] = {0x71, 0xac, 0x96, 0x57, 0xb4, 0x54, 0x42, 0x2b, 0xf9, 0x3f,
                           0xe4, 0xdf, 0x32, 0x68, 0xa2, 0x95, 0x3,  0x4,  0xd9, 0xb3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9183}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21830}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 8912, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\239\238\236\203\SI", _pubPktID =
// 8912, _pubBody = "\fH\EOT\166q\ESC\ESC\185\177A", _pubProps = [PropReasonString
// "\225\165\129\142\147\&7T\193\242o\a1\190\128@",PropWillDelayInterval 9183,PropResponseTopic
// "E{<",PropWildcardSubscriptionAvailable 82,PropSessionExpiryInterval 21830,PropSubscriptionIdentifier
// 4,PropResponseTopic "q\172\150W\180TB+\249?\228\223\&2h\162\149\ETX\EOT\217\179"]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {0x32, 0x51, 0x0,  0x5,  0xef, 0xee, 0xec, 0xcb, 0xf,  0x22, 0xd0, 0x3d, 0x1f, 0x0,  0xf,  0xe1, 0xa5,
                   0x81, 0x8e, 0x93, 0x37, 0x54, 0xc1, 0xf2, 0x6f, 0x7,  0x31, 0xbe, 0x80, 0x40, 0x18, 0x0,  0x0,  0x23,
                   0xdf, 0x8,  0x0,  0x3,  0x45, 0x7b, 0x3c, 0x28, 0x52, 0x11, 0x0,  0x0,  0x55, 0x46, 0xb,  0x4,  0x8,
                   0x0,  0x14, 0x71, 0xac, 0x96, 0x57, 0xb4, 0x54, 0x42, 0x2b, 0xf9, 0x3f, 0xe4, 0xdf, 0x32, 0x68, 0xa2,
                   0x95, 0x3,  0x4,  0xd9, 0xb3, 0xc,  0x48, 0x4,  0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xef, 0xee, 0xec, 0xcb, 0xf};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc, 0x48, 0x4, 0xa6, 0x71, 0x1b, 0x1b, 0xb9, 0xb1, 0x41};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8912);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "[", _pubPktID = 16570, _pubBody =
// "\173\247\147\148\f{|ku\211\&0\DC3\224\227di\ETX\214[\DEL\138I\133\r8{", _pubProps = [PropAuthenticationData
// "\201\130\227x)\225\205\159\186k",PropMessageExpiryInterval 23158,PropMessageExpiryInterval
// 24649,PropTopicAliasMaximum 28197,PropTopicAliasMaximum 26355,PropContentType "\198\230\148
// \ACK\252(\ENQo\237\214\224Zinzi\EOT\192\129T\147$",PropMaximumQoS 167,PropRetainAvailable 23,PropContentType
// "\250o\139\nJ\DC3\240\&6\180\159\247y\176p\198\SO\238\138A",PropReceiveMaximum 32721]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {0x3a, 0x74, 0x0,  0x1,  0x5b, 0x40, 0xba, 0x54, 0x16, 0x0,  0xa,  0xc9, 0x82, 0xe3, 0x78, 0x29, 0xe1,
                   0xcd, 0x9f, 0xba, 0x6b, 0x2,  0x0,  0x0,  0x5a, 0x76, 0x2,  0x0,  0x0,  0x60, 0x49, 0x22, 0x6e, 0x25,
                   0x22, 0x66, 0xf3, 0x3,  0x0,  0x17, 0xc6, 0xe6, 0x94, 0x20, 0x6,  0xfc, 0x28, 0x5,  0x6f, 0xed, 0xd6,
                   0xe0, 0x5a, 0x69, 0x6e, 0x7a, 0x69, 0x4,  0xc0, 0x81, 0x54, 0x93, 0x24, 0x24, 0xa7, 0x25, 0x17, 0x3,
                   0x0,  0x13, 0xfa, 0x6f, 0x8b, 0xa,  0x4a, 0x13, 0xf0, 0x36, 0xb4, 0x9f, 0xf7, 0x79, 0xb0, 0x70, 0xc6,
                   0xe,  0xee, 0x8a, 0x41, 0x21, 0x7f, 0xd1, 0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3,
                   0x30, 0x13, 0xe0, 0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  uint8_t topic_bytes[] = {0x5b};
  lwmqtt_string_t topic = {1, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3, 0x30, 0x13, 0xe0,
                         0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0xc9, 0x82, 0xe3, 0x78, 0x29, 0xe1, 0xcd, 0x9f, 0xba, 0x6b};
  uint8_t bytesprops1[] = {0xc6, 0xe6, 0x94, 0x20, 0x6,  0xfc, 0x28, 0x5,  0x6f, 0xed, 0xd6, 0xe0,
                           0x5a, 0x69, 0x6e, 0x7a, 0x69, 0x4,  0xc0, 0x81, 0x54, 0x93, 0x24};
  uint8_t bytesprops2[] = {0xfa, 0x6f, 0x8b, 0xa,  0x4a, 0x13, 0xf0, 0x36, 0xb4, 0x9f,
                           0xf7, 0x79, 0xb0, 0x70, 0xc6, 0xe,  0xee, 0x8a, 0x41};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23158}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24649}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28197}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26355}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32721}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 16570, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "[", _pubPktID = 16570, _pubBody =
// "\173\247\147\148\f{|ku\211\&0\DC3\224\227di\ETX\214[\DEL\138I\133\r8{", _pubProps = [PropAuthenticationData
// "\201\130\227x)\225\205\159\186k",PropMessageExpiryInterval 23158,PropMessageExpiryInterval
// 24649,PropTopicAliasMaximum 28197,PropTopicAliasMaximum 26355,PropContentType "\198\230\148
// \ACK\252(\ENQo\237\214\224Zinzi\EOT\192\129T\147$",PropMaximumQoS 167,PropRetainAvailable 23,PropContentType
// "\250o\139\nJ\DC3\240\&6\180\159\247y\176p\198\SO\238\138A",PropReceiveMaximum 32721]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {0x3a, 0x74, 0x0,  0x1,  0x5b, 0x40, 0xba, 0x54, 0x16, 0x0,  0xa,  0xc9, 0x82, 0xe3, 0x78, 0x29, 0xe1,
                   0xcd, 0x9f, 0xba, 0x6b, 0x2,  0x0,  0x0,  0x5a, 0x76, 0x2,  0x0,  0x0,  0x60, 0x49, 0x22, 0x6e, 0x25,
                   0x22, 0x66, 0xf3, 0x3,  0x0,  0x17, 0xc6, 0xe6, 0x94, 0x20, 0x6,  0xfc, 0x28, 0x5,  0x6f, 0xed, 0xd6,
                   0xe0, 0x5a, 0x69, 0x6e, 0x7a, 0x69, 0x4,  0xc0, 0x81, 0x54, 0x93, 0x24, 0x24, 0xa7, 0x25, 0x17, 0x3,
                   0x0,  0x13, 0xfa, 0x6f, 0x8b, 0xa,  0x4a, 0x13, 0xf0, 0x36, 0xb4, 0x9f, 0xf7, 0x79, 0xb0, 0x70, 0xc6,
                   0xe,  0xee, 0x8a, 0x41, 0x21, 0x7f, 0xd1, 0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3,
                   0x30, 0x13, 0xe0, 0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b};
  lwmqtt_string_t exp_topic = {1, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xad, 0xf7, 0x93, 0x94, 0xc,  0x7b, 0x7c, 0x6b, 0x75, 0xd3, 0x30, 0x13, 0xe0,
                              0xe3, 0x64, 0x69, 0x3,  0xd6, 0x5b, 0x7f, 0x8a, 0x49, 0x85, 0xd,  0x38, 0x7b};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16570);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 1);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\187Ue\150\168f\243G", _pubPktID =
// 0, _pubBody = "Y\133", _pubProps = [PropSessionExpiryInterval 5902,PropResponseInformation
// "\248\175\DC1n\150h\n#\US\SI\225\&1\t\139\161\215\254\240\177O@",PropReasonString
// "|\231\193\196\&3e\197",PropReasonString "7\218\ENQ\242\n`\221\140\158\184\235"]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {0x38, 0x42, 0x0,  0x8,  0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47, 0x35, 0x11,
                   0x0,  0x0,  0x17, 0xe,  0x1a, 0x0,  0x15, 0xf8, 0xaf, 0x11, 0x6e, 0x96, 0x68, 0xa,
                   0x23, 0x1f, 0xf,  0xe1, 0x31, 0x9,  0x8b, 0xa1, 0xd7, 0xfe, 0xf0, 0xb1, 0x4f, 0x40,
                   0x1f, 0x0,  0x7,  0x7c, 0xe7, 0xc1, 0xc4, 0x33, 0x65, 0xc5, 0x1f, 0x0,  0xb,  0x37,
                   0xda, 0x5,  0xf2, 0xa,  0x60, 0xdd, 0x8c, 0x9e, 0xb8, 0xeb, 0x59, 0x85};
  uint8_t topic_bytes[] = {0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x59, 0x85};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0xf8, 0xaf, 0x11, 0x6e, 0x96, 0x68, 0xa,  0x23, 0x1f, 0xf, 0xe1,
                           0x31, 0x9,  0x8b, 0xa1, 0xd7, 0xfe, 0xf0, 0xb1, 0x4f, 0x40};
  uint8_t bytesprops1[] = {0x7c, 0xe7, 0xc1, 0xc4, 0x33, 0x65, 0xc5};
  uint8_t bytesprops2[] = {0x37, 0xda, 0x5, 0xf2, 0xa, 0x60, 0xdd, 0x8c, 0x9e, 0xb8, 0xeb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5902}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\187Ue\150\168f\243G", _pubPktID =
// 0, _pubBody = "Y\133", _pubProps = [PropSessionExpiryInterval 5902,PropResponseInformation
// "\248\175\DC1n\150h\n#\US\SI\225\&1\t\139\161\215\254\240\177O@",PropReasonString
// "|\231\193\196\&3e\197",PropReasonString "7\218\ENQ\242\n`\221\140\158\184\235"]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {0x38, 0x42, 0x0,  0x8,  0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47, 0x35, 0x11,
                   0x0,  0x0,  0x17, 0xe,  0x1a, 0x0,  0x15, 0xf8, 0xaf, 0x11, 0x6e, 0x96, 0x68, 0xa,
                   0x23, 0x1f, 0xf,  0xe1, 0x31, 0x9,  0x8b, 0xa1, 0xd7, 0xfe, 0xf0, 0xb1, 0x4f, 0x40,
                   0x1f, 0x0,  0x7,  0x7c, 0xe7, 0xc1, 0xc4, 0x33, 0x65, 0xc5, 0x1f, 0x0,  0xb,  0x37,
                   0xda, 0x5,  0xf2, 0xa,  0x60, 0xdd, 0x8c, 0x9e, 0xb8, 0xeb, 0x59, 0x85};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbb, 0x55, 0x65, 0x96, 0xa8, 0x66, 0xf3, 0x47};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x59, 0x85};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\165\&4\a\246}\148\174\&8\186i\137\223\STX*Sv", _pubPktID = 0, _pubBody = "\243\233\SOH\134\243=c\212", _pubProps =
// [PropResponseInformation "\FSD'\182\202\140M\222[\r\156",PropCorrelationData
// "\CAN\164\185\bs\183\FS\163\b\\\ETB\255\156\164\193\SO\181\ESC\179\138\207rk\233\178Pb",PropUserProperty
// "\200\250\152\250\\\211\&2" "D\157HMnegk\131Q1F\EOTg\130\254\219\164\229",PropServerReference
// "9\133\188\151E\b\US\DEL8<8\154+\151>\209Q\DC4\185M\221\SYN\245\135M\239\238",PropResponseTopic
// "",PropResponseInformation "\142(\152<<\221\SI\GS\199",PropMaximumPacketSize 17129,PropResponseInformation
// "C\166'\167\137\221\199\226r\231\195\237\255`1\176\STX",PropSubscriptionIdentifierAvailable 198,PropServerReference
// "\177\139r\DLE\141\r\216\163l\196",PropMaximumPacketSize 27506,PropMessageExpiryInterval 15713,PropCorrelationData
// "h\184\199>SUY\163\163\244\201\152\f9\RS\151n\250O\218\182 \216\197c\226Nt",PropRequestResponseInformation
// 142,PropMessageExpiryInterval 21146,PropMessageExpiryInterval 2479,PropReceiveMaximum 14556,PropAuthenticationMethod
// "\SI\237\130%\ENQTo\141!^\FS\171+5&e\203l\CAN\137-,,",PropSessionExpiryInterval 8323,PropRequestResponseInformation
// 141,PropWillDelayInterval 32675]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x30, 0x9a, 0x2,  0x0,  0x10, 0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38, 0xba, 0x69, 0x89, 0xdf, 0x2,  0x2a,
      0x53, 0x76, 0xfe, 0x1,  0x1a, 0x0,  0xb,  0x1c, 0x44, 0x27, 0xb6, 0xca, 0x8c, 0x4d, 0xde, 0x5b, 0xd,  0x9c, 0x9,
      0x0,  0x1b, 0x18, 0xa4, 0xb9, 0x8,  0x73, 0xb7, 0x1c, 0xa3, 0x8,  0x5c, 0x17, 0xff, 0x9c, 0xa4, 0xc1, 0xe,  0xb5,
      0x1b, 0xb3, 0x8a, 0xcf, 0x72, 0x6b, 0xe9, 0xb2, 0x50, 0x62, 0x26, 0x0,  0x7,  0xc8, 0xfa, 0x98, 0xfa, 0x5c, 0xd3,
      0x32, 0x0,  0x13, 0x44, 0x9d, 0x48, 0x4d, 0x6e, 0x65, 0x67, 0x6b, 0x83, 0x51, 0x31, 0x46, 0x4,  0x67, 0x82, 0xfe,
      0xdb, 0xa4, 0xe5, 0x1c, 0x0,  0x1b, 0x39, 0x85, 0xbc, 0x97, 0x45, 0x8,  0x1f, 0x7f, 0x38, 0x3c, 0x38, 0x9a, 0x2b,
      0x97, 0x3e, 0xd1, 0x51, 0x14, 0xb9, 0x4d, 0xdd, 0x16, 0xf5, 0x87, 0x4d, 0xef, 0xee, 0x8,  0x0,  0x0,  0x1a, 0x0,
      0x9,  0x8e, 0x28, 0x98, 0x3c, 0x3c, 0xdd, 0xf,  0x1d, 0xc7, 0x27, 0x0,  0x0,  0x42, 0xe9, 0x1a, 0x0,  0x11, 0x43,
      0xa6, 0x27, 0xa7, 0x89, 0xdd, 0xc7, 0xe2, 0x72, 0xe7, 0xc3, 0xed, 0xff, 0x60, 0x31, 0xb0, 0x2,  0x29, 0xc6, 0x1c,
      0x0,  0xa,  0xb1, 0x8b, 0x72, 0x10, 0x8d, 0xd,  0xd8, 0xa3, 0x6c, 0xc4, 0x27, 0x0,  0x0,  0x6b, 0x72, 0x2,  0x0,
      0x0,  0x3d, 0x61, 0x9,  0x0,  0x1c, 0x68, 0xb8, 0xc7, 0x3e, 0x53, 0x55, 0x59, 0xa3, 0xa3, 0xf4, 0xc9, 0x98, 0xc,
      0x39, 0x1e, 0x97, 0x6e, 0xfa, 0x4f, 0xda, 0xb6, 0x20, 0xd8, 0xc5, 0x63, 0xe2, 0x4e, 0x74, 0x19, 0x8e, 0x2,  0x0,
      0x0,  0x52, 0x9a, 0x2,  0x0,  0x0,  0x9,  0xaf, 0x21, 0x38, 0xdc, 0x15, 0x0,  0x17, 0xf,  0xed, 0x82, 0x25, 0x5,
      0x54, 0x6f, 0x8d, 0x21, 0x5e, 0x1c, 0xab, 0x2b, 0x35, 0x26, 0x65, 0xcb, 0x6c, 0x18, 0x89, 0x2d, 0x2c, 0x2c, 0x11,
      0x0,  0x0,  0x20, 0x83, 0x19, 0x8d, 0x18, 0x0,  0x0,  0x7f, 0xa3, 0xf3, 0xe9, 0x1,  0x86, 0xf3, 0x3d, 0x63, 0xd4};
  uint8_t topic_bytes[] = {0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38,
                           0xba, 0x69, 0x89, 0xdf, 0x2,  0x2a, 0x53, 0x76};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf3, 0xe9, 0x1, 0x86, 0xf3, 0x3d, 0x63, 0xd4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  uint8_t bytesprops0[] = {0x1c, 0x44, 0x27, 0xb6, 0xca, 0x8c, 0x4d, 0xde, 0x5b, 0xd, 0x9c};
  uint8_t bytesprops1[] = {0x18, 0xa4, 0xb9, 0x8,  0x73, 0xb7, 0x1c, 0xa3, 0x8,  0x5c, 0x17, 0xff, 0x9c, 0xa4,
                           0xc1, 0xe,  0xb5, 0x1b, 0xb3, 0x8a, 0xcf, 0x72, 0x6b, 0xe9, 0xb2, 0x50, 0x62};
  uint8_t bytesprops3[] = {0x44, 0x9d, 0x48, 0x4d, 0x6e, 0x65, 0x67, 0x6b, 0x83, 0x51,
                           0x31, 0x46, 0x4,  0x67, 0x82, 0xfe, 0xdb, 0xa4, 0xe5};
  uint8_t bytesprops2[] = {0xc8, 0xfa, 0x98, 0xfa, 0x5c, 0xd3, 0x32};
  uint8_t bytesprops4[] = {0x39, 0x85, 0xbc, 0x97, 0x45, 0x8,  0x1f, 0x7f, 0x38, 0x3c, 0x38, 0x9a, 0x2b, 0x97,
                           0x3e, 0xd1, 0x51, 0x14, 0xb9, 0x4d, 0xdd, 0x16, 0xf5, 0x87, 0x4d, 0xef, 0xee};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x8e, 0x28, 0x98, 0x3c, 0x3c, 0xdd, 0xf, 0x1d, 0xc7};
  uint8_t bytesprops7[] = {0x43, 0xa6, 0x27, 0xa7, 0x89, 0xdd, 0xc7, 0xe2, 0x72,
                           0xe7, 0xc3, 0xed, 0xff, 0x60, 0x31, 0xb0, 0x2};
  uint8_t bytesprops8[] = {0xb1, 0x8b, 0x72, 0x10, 0x8d, 0xd, 0xd8, 0xa3, 0x6c, 0xc4};
  uint8_t bytesprops9[] = {0x68, 0xb8, 0xc7, 0x3e, 0x53, 0x55, 0x59, 0xa3, 0xa3, 0xf4, 0xc9, 0x98, 0xc,  0x39,
                           0x1e, 0x97, 0x6e, 0xfa, 0x4f, 0xda, 0xb6, 0x20, 0xd8, 0xc5, 0x63, 0xe2, 0x4e, 0x74};
  uint8_t bytesprops10[] = {0xf,  0xed, 0x82, 0x25, 0x5,  0x54, 0x6f, 0x8d, 0x21, 0x5e, 0x1c, 0xab,
                            0x2b, 0x35, 0x26, 0x65, 0xcb, 0x6c, 0x18, 0x89, 0x2d, 0x2c, 0x2c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops2}, .v = {19, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17129}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27506}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15713}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21146}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2479}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14556}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8323}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32675}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\165\&4\a\246}\148\174\&8\186i\137\223\STX*Sv", _pubPktID = 0, _pubBody = "\243\233\SOH\134\243=c\212", _pubProps =
// [PropResponseInformation "\FSD'\182\202\140M\222[\r\156",PropCorrelationData
// "\CAN\164\185\bs\183\FS\163\b\\\ETB\255\156\164\193\SO\181\ESC\179\138\207rk\233\178Pb",PropUserProperty
// "\200\250\152\250\\\211\&2" "D\157HMnegk\131Q1F\EOTg\130\254\219\164\229",PropServerReference
// "9\133\188\151E\b\US\DEL8<8\154+\151>\209Q\DC4\185M\221\SYN\245\135M\239\238",PropResponseTopic
// "",PropResponseInformation "\142(\152<<\221\SI\GS\199",PropMaximumPacketSize 17129,PropResponseInformation
// "C\166'\167\137\221\199\226r\231\195\237\255`1\176\STX",PropSubscriptionIdentifierAvailable 198,PropServerReference
// "\177\139r\DLE\141\r\216\163l\196",PropMaximumPacketSize 27506,PropMessageExpiryInterval 15713,PropCorrelationData
// "h\184\199>SUY\163\163\244\201\152\f9\RS\151n\250O\218\182 \216\197c\226Nt",PropRequestResponseInformation
// 142,PropMessageExpiryInterval 21146,PropMessageExpiryInterval 2479,PropReceiveMaximum 14556,PropAuthenticationMethod
// "\SI\237\130%\ENQTo\141!^\FS\171+5&e\203l\CAN\137-,,",PropSessionExpiryInterval 8323,PropRequestResponseInformation
// 141,PropWillDelayInterval 32675]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {
      0x30, 0x9a, 0x2,  0x0,  0x10, 0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38, 0xba, 0x69, 0x89, 0xdf, 0x2,  0x2a,
      0x53, 0x76, 0xfe, 0x1,  0x1a, 0x0,  0xb,  0x1c, 0x44, 0x27, 0xb6, 0xca, 0x8c, 0x4d, 0xde, 0x5b, 0xd,  0x9c, 0x9,
      0x0,  0x1b, 0x18, 0xa4, 0xb9, 0x8,  0x73, 0xb7, 0x1c, 0xa3, 0x8,  0x5c, 0x17, 0xff, 0x9c, 0xa4, 0xc1, 0xe,  0xb5,
      0x1b, 0xb3, 0x8a, 0xcf, 0x72, 0x6b, 0xe9, 0xb2, 0x50, 0x62, 0x26, 0x0,  0x7,  0xc8, 0xfa, 0x98, 0xfa, 0x5c, 0xd3,
      0x32, 0x0,  0x13, 0x44, 0x9d, 0x48, 0x4d, 0x6e, 0x65, 0x67, 0x6b, 0x83, 0x51, 0x31, 0x46, 0x4,  0x67, 0x82, 0xfe,
      0xdb, 0xa4, 0xe5, 0x1c, 0x0,  0x1b, 0x39, 0x85, 0xbc, 0x97, 0x45, 0x8,  0x1f, 0x7f, 0x38, 0x3c, 0x38, 0x9a, 0x2b,
      0x97, 0x3e, 0xd1, 0x51, 0x14, 0xb9, 0x4d, 0xdd, 0x16, 0xf5, 0x87, 0x4d, 0xef, 0xee, 0x8,  0x0,  0x0,  0x1a, 0x0,
      0x9,  0x8e, 0x28, 0x98, 0x3c, 0x3c, 0xdd, 0xf,  0x1d, 0xc7, 0x27, 0x0,  0x0,  0x42, 0xe9, 0x1a, 0x0,  0x11, 0x43,
      0xa6, 0x27, 0xa7, 0x89, 0xdd, 0xc7, 0xe2, 0x72, 0xe7, 0xc3, 0xed, 0xff, 0x60, 0x31, 0xb0, 0x2,  0x29, 0xc6, 0x1c,
      0x0,  0xa,  0xb1, 0x8b, 0x72, 0x10, 0x8d, 0xd,  0xd8, 0xa3, 0x6c, 0xc4, 0x27, 0x0,  0x0,  0x6b, 0x72, 0x2,  0x0,
      0x0,  0x3d, 0x61, 0x9,  0x0,  0x1c, 0x68, 0xb8, 0xc7, 0x3e, 0x53, 0x55, 0x59, 0xa3, 0xa3, 0xf4, 0xc9, 0x98, 0xc,
      0x39, 0x1e, 0x97, 0x6e, 0xfa, 0x4f, 0xda, 0xb6, 0x20, 0xd8, 0xc5, 0x63, 0xe2, 0x4e, 0x74, 0x19, 0x8e, 0x2,  0x0,
      0x0,  0x52, 0x9a, 0x2,  0x0,  0x0,  0x9,  0xaf, 0x21, 0x38, 0xdc, 0x15, 0x0,  0x17, 0xf,  0xed, 0x82, 0x25, 0x5,
      0x54, 0x6f, 0x8d, 0x21, 0x5e, 0x1c, 0xab, 0x2b, 0x35, 0x26, 0x65, 0xcb, 0x6c, 0x18, 0x89, 0x2d, 0x2c, 0x2c, 0x11,
      0x0,  0x0,  0x20, 0x83, 0x19, 0x8d, 0x18, 0x0,  0x0,  0x7f, 0xa3, 0xf3, 0xe9, 0x1,  0x86, 0xf3, 0x3d, 0x63, 0xd4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa5, 0x34, 0x7,  0xf6, 0x7d, 0x94, 0xae, 0x38,
                               0xba, 0x69, 0x89, 0xdf, 0x2,  0x2a, 0x53, 0x76};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf3, 0xe9, 0x1, 0x86, 0xf3, 0x3d, 0x63, 0xd4};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 10766, _pubBody =
// "\178", _pubProps = []}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {0x3b, 0x6, 0x0, 0x0, 0x2a, 0xe, 0x0, 0xb2};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10766, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 10766, _pubBody =
// "\178", _pubProps = []}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {0x3b, 0x6, 0x0, 0x0, 0x2a, 0xe, 0x0, 0xb2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb2};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10766);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\138\GSJ\143\233", _pubPktID = 6943,
// _pubBody = "\137\139\192l\219\138Z\225\185\164}d\US[\179", _pubProps = [PropAuthenticationMethod
// "\140+fdg\201T\248\&2\167\255\&3\EMm\193\&0\EOT\187\147\215\EM",PropServerKeepAlive 19473,PropServerKeepAlive
// 30363,PropAssignedClientIdentifier "\193~?\213\&2M\211\160\235\255I\163VA\190\223\145\138",PropWillDelayInterval
// 5830,PropReasonString "\188\&0W\192\156\144\147\STX\203\254`\143qK/\247",PropSessionExpiryInterval
// 5743,PropResponseTopic "\213#*",PropUserProperty
// "\183\152L\208\228\254v\a\181I\137ew\161<`\136\228\US\185TV\147A\251\254" "\149x\ESC\239\142\128\v\209\EOT6
// HP\205\139a\nD\165"]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x3c, 0xa2, 0x1,  0x0,  0x5,  0x8a, 0x1d, 0x4a, 0x8f, 0xe9, 0x1b, 0x1f, 0x88, 0x1,  0x15, 0x0,  0x15,
                   0x8c, 0x2b, 0x66, 0x64, 0x67, 0xc9, 0x54, 0xf8, 0x32, 0xa7, 0xff, 0x33, 0x19, 0x6d, 0xc1, 0x30, 0x4,
                   0xbb, 0x93, 0xd7, 0x19, 0x13, 0x4c, 0x11, 0x13, 0x76, 0x9b, 0x12, 0x0,  0x12, 0xc1, 0x7e, 0x3f, 0xd5,
                   0x32, 0x4d, 0xd3, 0xa0, 0xeb, 0xff, 0x49, 0xa3, 0x56, 0x41, 0xbe, 0xdf, 0x91, 0x8a, 0x18, 0x0,  0x0,
                   0x16, 0xc6, 0x1f, 0x0,  0x10, 0xbc, 0x30, 0x57, 0xc0, 0x9c, 0x90, 0x93, 0x2,  0xcb, 0xfe, 0x60, 0x8f,
                   0x71, 0x4b, 0x2f, 0xf7, 0x11, 0x0,  0x0,  0x16, 0x6f, 0x8,  0x0,  0x3,  0xd5, 0x23, 0x2a, 0x26, 0x0,
                   0x1a, 0xb7, 0x98, 0x4c, 0xd0, 0xe4, 0xfe, 0x76, 0x7,  0xb5, 0x49, 0x89, 0x65, 0x77, 0xa1, 0x3c, 0x60,
                   0x88, 0xe4, 0x1f, 0xb9, 0x54, 0x56, 0x93, 0x41, 0xfb, 0xfe, 0x0,  0x13, 0x95, 0x78, 0x1b, 0xef, 0x8e,
                   0x80, 0xb,  0xd1, 0x4,  0x36, 0x20, 0x48, 0x50, 0xcd, 0x8b, 0x61, 0xa,  0x44, 0xa5, 0x89, 0x8b, 0xc0,
                   0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  uint8_t topic_bytes[] = {0x8a, 0x1d, 0x4a, 0x8f, 0xe9};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x89, 0x8b, 0xc0, 0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x8c, 0x2b, 0x66, 0x64, 0x67, 0xc9, 0x54, 0xf8, 0x32, 0xa7, 0xff,
                           0x33, 0x19, 0x6d, 0xc1, 0x30, 0x4,  0xbb, 0x93, 0xd7, 0x19};
  uint8_t bytesprops1[] = {0xc1, 0x7e, 0x3f, 0xd5, 0x32, 0x4d, 0xd3, 0xa0, 0xeb,
                           0xff, 0x49, 0xa3, 0x56, 0x41, 0xbe, 0xdf, 0x91, 0x8a};
  uint8_t bytesprops2[] = {0xbc, 0x30, 0x57, 0xc0, 0x9c, 0x90, 0x93, 0x2,
                           0xcb, 0xfe, 0x60, 0x8f, 0x71, 0x4b, 0x2f, 0xf7};
  uint8_t bytesprops3[] = {0xd5, 0x23, 0x2a};
  uint8_t bytesprops5[] = {0x95, 0x78, 0x1b, 0xef, 0x8e, 0x80, 0xb, 0xd1, 0x4, 0x36,
                           0x20, 0x48, 0x50, 0xcd, 0x8b, 0x61, 0xa, 0x44, 0xa5};
  uint8_t bytesprops4[] = {0xb7, 0x98, 0x4c, 0xd0, 0xe4, 0xfe, 0x76, 0x7,  0xb5, 0x49, 0x89, 0x65, 0x77,
                           0xa1, 0x3c, 0x60, 0x88, 0xe4, 0x1f, 0xb9, 0x54, 0x56, 0x93, 0x41, 0xfb, 0xfe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19473}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30363}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5830}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5743}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops4}, .v = {19, (char*)&bytesprops5}}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6943, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\138\GSJ\143\233", _pubPktID = 6943,
// _pubBody = "\137\139\192l\219\138Z\225\185\164}d\US[\179", _pubProps = [PropAuthenticationMethod
// "\140+fdg\201T\248\&2\167\255\&3\EMm\193\&0\EOT\187\147\215\EM",PropServerKeepAlive 19473,PropServerKeepAlive
// 30363,PropAssignedClientIdentifier "\193~?\213\&2M\211\160\235\255I\163VA\190\223\145\138",PropWillDelayInterval
// 5830,PropReasonString "\188\&0W\192\156\144\147\STX\203\254`\143qK/\247",PropSessionExpiryInterval
// 5743,PropResponseTopic "\213#*",PropUserProperty
// "\183\152L\208\228\254v\a\181I\137ew\161<`\136\228\US\185TV\147A\251\254" "\149x\ESC\239\142\128\v\209\EOT6
// HP\205\139a\nD\165"]}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x3c, 0xa2, 0x1,  0x0,  0x5,  0x8a, 0x1d, 0x4a, 0x8f, 0xe9, 0x1b, 0x1f, 0x88, 0x1,  0x15, 0x0,  0x15,
                   0x8c, 0x2b, 0x66, 0x64, 0x67, 0xc9, 0x54, 0xf8, 0x32, 0xa7, 0xff, 0x33, 0x19, 0x6d, 0xc1, 0x30, 0x4,
                   0xbb, 0x93, 0xd7, 0x19, 0x13, 0x4c, 0x11, 0x13, 0x76, 0x9b, 0x12, 0x0,  0x12, 0xc1, 0x7e, 0x3f, 0xd5,
                   0x32, 0x4d, 0xd3, 0xa0, 0xeb, 0xff, 0x49, 0xa3, 0x56, 0x41, 0xbe, 0xdf, 0x91, 0x8a, 0x18, 0x0,  0x0,
                   0x16, 0xc6, 0x1f, 0x0,  0x10, 0xbc, 0x30, 0x57, 0xc0, 0x9c, 0x90, 0x93, 0x2,  0xcb, 0xfe, 0x60, 0x8f,
                   0x71, 0x4b, 0x2f, 0xf7, 0x11, 0x0,  0x0,  0x16, 0x6f, 0x8,  0x0,  0x3,  0xd5, 0x23, 0x2a, 0x26, 0x0,
                   0x1a, 0xb7, 0x98, 0x4c, 0xd0, 0xe4, 0xfe, 0x76, 0x7,  0xb5, 0x49, 0x89, 0x65, 0x77, 0xa1, 0x3c, 0x60,
                   0x88, 0xe4, 0x1f, 0xb9, 0x54, 0x56, 0x93, 0x41, 0xfb, 0xfe, 0x0,  0x13, 0x95, 0x78, 0x1b, 0xef, 0x8e,
                   0x80, 0xb,  0xd1, 0x4,  0x36, 0x20, 0x48, 0x50, 0xcd, 0x8b, 0x61, 0xa,  0x44, 0xa5, 0x89, 0x8b, 0xc0,
                   0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8a, 0x1d, 0x4a, 0x8f, 0xe9};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x89, 0x8b, 0xc0, 0x6c, 0xdb, 0x8a, 0x5a, 0xe1, 0xb9, 0xa4, 0x7d, 0x64, 0x1f, 0x5b, 0xb3};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 6943);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\225y\a\222\215\130\238h\b\159\152x\153\151\162\213\177\165X\184]\135\187\189 \214", _pubProps =
// [PropRequestResponseInformation 185,PropTopicAliasMaximum 14150,PropReasonString "\165,",PropAssignedClientIdentifier
// "\201\152\208!o\194:\DEL\185IC\SYN~\152NV\179\183\212\220a",PropTopicAliasMaximum 9681,PropServerReference
// "\138\&4@Q\n\225\185\166\153\164J\155H*\EOT\249\231\253\232\218\201\188",PropAuthenticationData
// "\184\EM\201\135<\189a}\146\DC2\135\245\f\US>\243C\253\197\134",PropPayloadFormatIndicator 248,PropServerKeepAlive
// 277,PropWillDelayInterval 13390,PropResponseTopic "V\b\193\\\236|\RS",PropResponseInformation
// "\177\216\175kf\FS\198\234\DEL\205:\STX\175\216Fq\242\DC20\152\253\142/",PropCorrelationData
// "\149\DC4\243\181\182:\ENQ\185\"d",PropMessageExpiryInterval 1713,PropAuthenticationData
// "\233\251",PropWildcardSubscriptionAvailable 169,PropTopicAliasMaximum 22382,PropReceiveMaximum
// 22362,PropServerKeepAlive 8489,PropMessageExpiryInterval 30880,PropRetainAvailable
// 14,PropWildcardSubscriptionAvailable 30,PropCorrelationData
// "@[i5\197\167<Q\184\244\227k\244\DC2\221:\SI\210I\177B\194\169\239j",PropSubscriptionIdentifier 4,PropServerKeepAlive
// 4157,PropCorrelationData "\229\CAN\131\211\173",PropReceiveMaximum 1967,PropMaximumPacketSize 24988]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x38, 0xfd, 0x1,  0x0,  0x0,  0xdf, 0x1,  0x19, 0xb9, 0x22, 0x37, 0x46, 0x1f, 0x0,  0x2,  0xa5, 0x2c, 0x12, 0x0,
      0x15, 0xc9, 0x98, 0xd0, 0x21, 0x6f, 0xc2, 0x3a, 0x7f, 0xb9, 0x49, 0x43, 0x16, 0x7e, 0x98, 0x4e, 0x56, 0xb3, 0xb7,
      0xd4, 0xdc, 0x61, 0x22, 0x25, 0xd1, 0x1c, 0x0,  0x16, 0x8a, 0x34, 0x40, 0x51, 0xa,  0xe1, 0xb9, 0xa6, 0x99, 0xa4,
      0x4a, 0x9b, 0x48, 0x2a, 0x4,  0xf9, 0xe7, 0xfd, 0xe8, 0xda, 0xc9, 0xbc, 0x16, 0x0,  0x14, 0xb8, 0x19, 0xc9, 0x87,
      0x3c, 0xbd, 0x61, 0x7d, 0x92, 0x12, 0x87, 0xf5, 0xc,  0x1f, 0x3e, 0xf3, 0x43, 0xfd, 0xc5, 0x86, 0x1,  0xf8, 0x13,
      0x1,  0x15, 0x18, 0x0,  0x0,  0x34, 0x4e, 0x8,  0x0,  0x7,  0x56, 0x8,  0xc1, 0x5c, 0xec, 0x7c, 0x1e, 0x1a, 0x0,
      0x17, 0xb1, 0xd8, 0xaf, 0x6b, 0x66, 0x1c, 0xc6, 0xea, 0x7f, 0xcd, 0x3a, 0x2,  0xaf, 0xd8, 0x46, 0x71, 0xf2, 0x12,
      0x30, 0x98, 0xfd, 0x8e, 0x2f, 0x9,  0x0,  0xa,  0x95, 0x14, 0xf3, 0xb5, 0xb6, 0x3a, 0x5,  0xb9, 0x22, 0x64, 0x2,
      0x0,  0x0,  0x6,  0xb1, 0x16, 0x0,  0x2,  0xe9, 0xfb, 0x28, 0xa9, 0x22, 0x57, 0x6e, 0x21, 0x57, 0x5a, 0x13, 0x21,
      0x29, 0x2,  0x0,  0x0,  0x78, 0xa0, 0x25, 0xe,  0x28, 0x1e, 0x9,  0x0,  0x19, 0x40, 0x5b, 0x69, 0x35, 0xc5, 0xa7,
      0x3c, 0x51, 0xb8, 0xf4, 0xe3, 0x6b, 0xf4, 0x12, 0xdd, 0x3a, 0xf,  0xd2, 0x49, 0xb1, 0x42, 0xc2, 0xa9, 0xef, 0x6a,
      0xb,  0x4,  0x13, 0x10, 0x3d, 0x9,  0x0,  0x5,  0xe5, 0x18, 0x83, 0xd3, 0xad, 0x21, 0x7,  0xaf, 0x27, 0x0,  0x0,
      0x61, 0x9c, 0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98, 0x78, 0x99, 0x97, 0xa2, 0xd5, 0xb1,
      0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98, 0x78, 0x99,
                         0x97, 0xa2, 0xd5, 0xb1, 0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0xa5, 0x2c};
  uint8_t bytesprops1[] = {0xc9, 0x98, 0xd0, 0x21, 0x6f, 0xc2, 0x3a, 0x7f, 0xb9, 0x49, 0x43,
                           0x16, 0x7e, 0x98, 0x4e, 0x56, 0xb3, 0xb7, 0xd4, 0xdc, 0x61};
  uint8_t bytesprops2[] = {0x8a, 0x34, 0x40, 0x51, 0xa,  0xe1, 0xb9, 0xa6, 0x99, 0xa4, 0x4a,
                           0x9b, 0x48, 0x2a, 0x4,  0xf9, 0xe7, 0xfd, 0xe8, 0xda, 0xc9, 0xbc};
  uint8_t bytesprops3[] = {0xb8, 0x19, 0xc9, 0x87, 0x3c, 0xbd, 0x61, 0x7d, 0x92, 0x12,
                           0x87, 0xf5, 0xc,  0x1f, 0x3e, 0xf3, 0x43, 0xfd, 0xc5, 0x86};
  uint8_t bytesprops4[] = {0x56, 0x8, 0xc1, 0x5c, 0xec, 0x7c, 0x1e};
  uint8_t bytesprops5[] = {0xb1, 0xd8, 0xaf, 0x6b, 0x66, 0x1c, 0xc6, 0xea, 0x7f, 0xcd, 0x3a, 0x2,
                           0xaf, 0xd8, 0x46, 0x71, 0xf2, 0x12, 0x30, 0x98, 0xfd, 0x8e, 0x2f};
  uint8_t bytesprops6[] = {0x95, 0x14, 0xf3, 0xb5, 0xb6, 0x3a, 0x5, 0xb9, 0x22, 0x64};
  uint8_t bytesprops7[] = {0xe9, 0xfb};
  uint8_t bytesprops8[] = {0x40, 0x5b, 0x69, 0x35, 0xc5, 0xa7, 0x3c, 0x51, 0xb8, 0xf4, 0xe3, 0x6b, 0xf4,
                           0x12, 0xdd, 0x3a, 0xf,  0xd2, 0x49, 0xb1, 0x42, 0xc2, 0xa9, 0xef, 0x6a};
  uint8_t bytesprops9[] = {0xe5, 0x18, 0x83, 0xd3, 0xad};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14150}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9681}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 277}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13390}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1713}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22382}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22362}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8489}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30880}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4157}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1967}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24988}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\225y\a\222\215\130\238h\b\159\152x\153\151\162\213\177\165X\184]\135\187\189 \214", _pubProps =
// [PropRequestResponseInformation 185,PropTopicAliasMaximum 14150,PropReasonString "\165,",PropAssignedClientIdentifier
// "\201\152\208!o\194:\DEL\185IC\SYN~\152NV\179\183\212\220a",PropTopicAliasMaximum 9681,PropServerReference
// "\138\&4@Q\n\225\185\166\153\164J\155H*\EOT\249\231\253\232\218\201\188",PropAuthenticationData
// "\184\EM\201\135<\189a}\146\DC2\135\245\f\US>\243C\253\197\134",PropPayloadFormatIndicator 248,PropServerKeepAlive
// 277,PropWillDelayInterval 13390,PropResponseTopic "V\b\193\\\236|\RS",PropResponseInformation
// "\177\216\175kf\FS\198\234\DEL\205:\STX\175\216Fq\242\DC20\152\253\142/",PropCorrelationData
// "\149\DC4\243\181\182:\ENQ\185\"d",PropMessageExpiryInterval 1713,PropAuthenticationData
// "\233\251",PropWildcardSubscriptionAvailable 169,PropTopicAliasMaximum 22382,PropReceiveMaximum
// 22362,PropServerKeepAlive 8489,PropMessageExpiryInterval 30880,PropRetainAvailable
// 14,PropWildcardSubscriptionAvailable 30,PropCorrelationData
// "@[i5\197\167<Q\184\244\227k\244\DC2\221:\SI\210I\177B\194\169\239j",PropSubscriptionIdentifier 4,PropServerKeepAlive
// 4157,PropCorrelationData "\229\CAN\131\211\173",PropReceiveMaximum 1967,PropMaximumPacketSize 24988]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {
      0x38, 0xfd, 0x1,  0x0,  0x0,  0xdf, 0x1,  0x19, 0xb9, 0x22, 0x37, 0x46, 0x1f, 0x0,  0x2,  0xa5, 0x2c, 0x12, 0x0,
      0x15, 0xc9, 0x98, 0xd0, 0x21, 0x6f, 0xc2, 0x3a, 0x7f, 0xb9, 0x49, 0x43, 0x16, 0x7e, 0x98, 0x4e, 0x56, 0xb3, 0xb7,
      0xd4, 0xdc, 0x61, 0x22, 0x25, 0xd1, 0x1c, 0x0,  0x16, 0x8a, 0x34, 0x40, 0x51, 0xa,  0xe1, 0xb9, 0xa6, 0x99, 0xa4,
      0x4a, 0x9b, 0x48, 0x2a, 0x4,  0xf9, 0xe7, 0xfd, 0xe8, 0xda, 0xc9, 0xbc, 0x16, 0x0,  0x14, 0xb8, 0x19, 0xc9, 0x87,
      0x3c, 0xbd, 0x61, 0x7d, 0x92, 0x12, 0x87, 0xf5, 0xc,  0x1f, 0x3e, 0xf3, 0x43, 0xfd, 0xc5, 0x86, 0x1,  0xf8, 0x13,
      0x1,  0x15, 0x18, 0x0,  0x0,  0x34, 0x4e, 0x8,  0x0,  0x7,  0x56, 0x8,  0xc1, 0x5c, 0xec, 0x7c, 0x1e, 0x1a, 0x0,
      0x17, 0xb1, 0xd8, 0xaf, 0x6b, 0x66, 0x1c, 0xc6, 0xea, 0x7f, 0xcd, 0x3a, 0x2,  0xaf, 0xd8, 0x46, 0x71, 0xf2, 0x12,
      0x30, 0x98, 0xfd, 0x8e, 0x2f, 0x9,  0x0,  0xa,  0x95, 0x14, 0xf3, 0xb5, 0xb6, 0x3a, 0x5,  0xb9, 0x22, 0x64, 0x2,
      0x0,  0x0,  0x6,  0xb1, 0x16, 0x0,  0x2,  0xe9, 0xfb, 0x28, 0xa9, 0x22, 0x57, 0x6e, 0x21, 0x57, 0x5a, 0x13, 0x21,
      0x29, 0x2,  0x0,  0x0,  0x78, 0xa0, 0x25, 0xe,  0x28, 0x1e, 0x9,  0x0,  0x19, 0x40, 0x5b, 0x69, 0x35, 0xc5, 0xa7,
      0x3c, 0x51, 0xb8, 0xf4, 0xe3, 0x6b, 0xf4, 0x12, 0xdd, 0x3a, 0xf,  0xd2, 0x49, 0xb1, 0x42, 0xc2, 0xa9, 0xef, 0x6a,
      0xb,  0x4,  0x13, 0x10, 0x3d, 0x9,  0x0,  0x5,  0xe5, 0x18, 0x83, 0xd3, 0xad, 0x21, 0x7,  0xaf, 0x27, 0x0,  0x0,
      0x61, 0x9c, 0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98, 0x78, 0x99, 0x97, 0xa2, 0xd5, 0xb1,
      0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe1, 0x79, 0x7,  0xde, 0xd7, 0x82, 0xee, 0x68, 0x8,  0x9f, 0x98, 0x78, 0x99,
                              0x97, 0xa2, 0xd5, 0xb1, 0xa5, 0x58, 0xb8, 0x5d, 0x87, 0xbb, 0xbd, 0x20, 0xd6};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "6\218tea\v\174S\163\234\130\GS\208\155\GS\DLE\ENQ\ESC\178\165 \153\DC2\155v,\165", _pubPktID = 27993, _pubBody =
// "\158 %1\177\201\t\236L", _pubProps = [PropServerKeepAlive 9153,PropMessageExpiryInterval 3494,PropContentType
// "P\141'\196\209\238\243\237\249?\SO\219x\162*\204",PropSharedSubscriptionAvailable 179,PropResponseInformation
// "\190\"(F\247\\\220y\190\242M\GS\223W\201\167\211p\222\DEL\170\237\f\219Z\163",PropRequestResponseInformation
// 202,PropMessageExpiryInterval 23742,PropResponseTopic
// "\255+^\145\153\SO\225\250!=#\217",PropRequestProblemInformation 8,PropSharedSubscriptionAvailable 68,PropTopicAlias
// 31091,PropContentType "\159\216\205\237\234\CAN\175_\190\248\189R\141\145\242]\174",PropServerKeepAlive
// 24225,PropContentType "\146b\132\218\243M\STX}\185>",PropAuthenticationMethod
// "\209^\237\138\b\196\153\128\168\175\184\198)\155\144\169[n\140\v\175\225",PropSubscriptionIdentifierAvailable
// 224,PropTopicAliasMaximum 20441,PropTopicAliasMaximum 31289]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x32, 0xc6, 0x1,  0x0,  0x1b, 0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea, 0x82, 0x1d,
                   0xd0, 0x9b, 0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b, 0x76, 0x2c, 0xa5, 0x6d, 0x59,
                   0x9c, 0x1,  0x13, 0x23, 0xc1, 0x2,  0x0,  0x0,  0xd,  0xa6, 0x3,  0x0,  0x10, 0x50, 0x8d, 0x27, 0xc4,
                   0xd1, 0xee, 0xf3, 0xed, 0xf9, 0x3f, 0xe,  0xdb, 0x78, 0xa2, 0x2a, 0xcc, 0x2a, 0xb3, 0x1a, 0x0,  0x1a,
                   0xbe, 0x22, 0x28, 0x46, 0xf7, 0x5c, 0xdc, 0x79, 0xbe, 0xf2, 0x4d, 0x1d, 0xdf, 0x57, 0xc9, 0xa7, 0xd3,
                   0x70, 0xde, 0x7f, 0xaa, 0xed, 0xc,  0xdb, 0x5a, 0xa3, 0x19, 0xca, 0x2,  0x0,  0x0,  0x5c, 0xbe, 0x8,
                   0x0,  0xc,  0xff, 0x2b, 0x5e, 0x91, 0x99, 0xe,  0xe1, 0xfa, 0x21, 0x3d, 0x23, 0xd9, 0x17, 0x8,  0x2a,
                   0x44, 0x23, 0x79, 0x73, 0x3,  0x0,  0x11, 0x9f, 0xd8, 0xcd, 0xed, 0xea, 0x18, 0xaf, 0x5f, 0xbe, 0xf8,
                   0xbd, 0x52, 0x8d, 0x91, 0xf2, 0x5d, 0xae, 0x13, 0x5e, 0xa1, 0x3,  0x0,  0xa,  0x92, 0x62, 0x84, 0xda,
                   0xf3, 0x4d, 0x2,  0x7d, 0xb9, 0x3e, 0x15, 0x0,  0x16, 0xd1, 0x5e, 0xed, 0x8a, 0x8,  0xc4, 0x99, 0x80,
                   0xa8, 0xaf, 0xb8, 0xc6, 0x29, 0x9b, 0x90, 0xa9, 0x5b, 0x6e, 0x8c, 0xb,  0xaf, 0xe1, 0x29, 0xe0, 0x22,
                   0x4f, 0xd9, 0x22, 0x7a, 0x39, 0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9,  0xec, 0x4c};
  uint8_t topic_bytes[] = {0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea, 0x82, 0x1d, 0xd0, 0x9b,
                           0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b, 0x76, 0x2c, 0xa5};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9, 0xec, 0x4c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0x50, 0x8d, 0x27, 0xc4, 0xd1, 0xee, 0xf3, 0xed,
                           0xf9, 0x3f, 0xe,  0xdb, 0x78, 0xa2, 0x2a, 0xcc};
  uint8_t bytesprops1[] = {0xbe, 0x22, 0x28, 0x46, 0xf7, 0x5c, 0xdc, 0x79, 0xbe, 0xf2, 0x4d, 0x1d, 0xdf,
                           0x57, 0xc9, 0xa7, 0xd3, 0x70, 0xde, 0x7f, 0xaa, 0xed, 0xc,  0xdb, 0x5a, 0xa3};
  uint8_t bytesprops2[] = {0xff, 0x2b, 0x5e, 0x91, 0x99, 0xe, 0xe1, 0xfa, 0x21, 0x3d, 0x23, 0xd9};
  uint8_t bytesprops3[] = {0x9f, 0xd8, 0xcd, 0xed, 0xea, 0x18, 0xaf, 0x5f, 0xbe,
                           0xf8, 0xbd, 0x52, 0x8d, 0x91, 0xf2, 0x5d, 0xae};
  uint8_t bytesprops4[] = {0x92, 0x62, 0x84, 0xda, 0xf3, 0x4d, 0x2, 0x7d, 0xb9, 0x3e};
  uint8_t bytesprops5[] = {0xd1, 0x5e, 0xed, 0x8a, 0x8,  0xc4, 0x99, 0x80, 0xa8, 0xaf, 0xb8,
                           0xc6, 0x29, 0x9b, 0x90, 0xa9, 0x5b, 0x6e, 0x8c, 0xb,  0xaf, 0xe1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9153}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3494}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23742}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31091}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24225}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20441}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31289}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 27993, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "6\218tea\v\174S\163\234\130\GS\208\155\GS\DLE\ENQ\ESC\178\165 \153\DC2\155v,\165", _pubPktID = 27993, _pubBody =
// "\158 %1\177\201\t\236L", _pubProps = [PropServerKeepAlive 9153,PropMessageExpiryInterval 3494,PropContentType
// "P\141'\196\209\238\243\237\249?\SO\219x\162*\204",PropSharedSubscriptionAvailable 179,PropResponseInformation
// "\190\"(F\247\\\220y\190\242M\GS\223W\201\167\211p\222\DEL\170\237\f\219Z\163",PropRequestResponseInformation
// 202,PropMessageExpiryInterval 23742,PropResponseTopic
// "\255+^\145\153\SO\225\250!=#\217",PropRequestProblemInformation 8,PropSharedSubscriptionAvailable 68,PropTopicAlias
// 31091,PropContentType "\159\216\205\237\234\CAN\175_\190\248\189R\141\145\242]\174",PropServerKeepAlive
// 24225,PropContentType "\146b\132\218\243M\STX}\185>",PropAuthenticationMethod
// "\209^\237\138\b\196\153\128\168\175\184\198)\155\144\169[n\140\v\175\225",PropSubscriptionIdentifierAvailable
// 224,PropTopicAliasMaximum 20441,PropTopicAliasMaximum 31289]}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x32, 0xc6, 0x1,  0x0,  0x1b, 0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea, 0x82, 0x1d,
                   0xd0, 0x9b, 0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b, 0x76, 0x2c, 0xa5, 0x6d, 0x59,
                   0x9c, 0x1,  0x13, 0x23, 0xc1, 0x2,  0x0,  0x0,  0xd,  0xa6, 0x3,  0x0,  0x10, 0x50, 0x8d, 0x27, 0xc4,
                   0xd1, 0xee, 0xf3, 0xed, 0xf9, 0x3f, 0xe,  0xdb, 0x78, 0xa2, 0x2a, 0xcc, 0x2a, 0xb3, 0x1a, 0x0,  0x1a,
                   0xbe, 0x22, 0x28, 0x46, 0xf7, 0x5c, 0xdc, 0x79, 0xbe, 0xf2, 0x4d, 0x1d, 0xdf, 0x57, 0xc9, 0xa7, 0xd3,
                   0x70, 0xde, 0x7f, 0xaa, 0xed, 0xc,  0xdb, 0x5a, 0xa3, 0x19, 0xca, 0x2,  0x0,  0x0,  0x5c, 0xbe, 0x8,
                   0x0,  0xc,  0xff, 0x2b, 0x5e, 0x91, 0x99, 0xe,  0xe1, 0xfa, 0x21, 0x3d, 0x23, 0xd9, 0x17, 0x8,  0x2a,
                   0x44, 0x23, 0x79, 0x73, 0x3,  0x0,  0x11, 0x9f, 0xd8, 0xcd, 0xed, 0xea, 0x18, 0xaf, 0x5f, 0xbe, 0xf8,
                   0xbd, 0x52, 0x8d, 0x91, 0xf2, 0x5d, 0xae, 0x13, 0x5e, 0xa1, 0x3,  0x0,  0xa,  0x92, 0x62, 0x84, 0xda,
                   0xf3, 0x4d, 0x2,  0x7d, 0xb9, 0x3e, 0x15, 0x0,  0x16, 0xd1, 0x5e, 0xed, 0x8a, 0x8,  0xc4, 0x99, 0x80,
                   0xa8, 0xaf, 0xb8, 0xc6, 0x29, 0x9b, 0x90, 0xa9, 0x5b, 0x6e, 0x8c, 0xb,  0xaf, 0xe1, 0x29, 0xe0, 0x22,
                   0x4f, 0xd9, 0x22, 0x7a, 0x39, 0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9,  0xec, 0x4c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x36, 0xda, 0x74, 0x65, 0x61, 0xb,  0xae, 0x53, 0xa3, 0xea, 0x82, 0x1d, 0xd0, 0x9b,
                               0x1d, 0x10, 0x5,  0x1b, 0xb2, 0xa5, 0x20, 0x99, 0x12, 0x9b, 0x76, 0x2c, 0xa5};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9e, 0x20, 0x25, 0x31, 0xb1, 0xc9, 0x9, 0xec, 0x4c};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 27993);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "IP~U\245v\179O\ETB\247\SUB\152i\169\208", _pubPktID = 1633, _pubBody =
// "\164\215\&1Ym\133Ie\197\EOT\147\DC3}g\SUB\150\143", _pubProps = [PropServerKeepAlive 425,PropAuthenticationMethod
// "#\147\225\221\EM\204,4\195\215\182\DC2\209h8\242=\131m\241]\223\&2B*\154A",PropReceiveMaximum
// 21231,PropCorrelationData "\185GM-\220p",PropTopicAliasMaximum 24215,PropMaximumPacketSize
// 32734,PropRequestResponseInformation 122,PropSubscriptionIdentifierAvailable 16,PropRequestResponseInformation
// 139,PropMessageExpiryInterval 14314]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {0x3d, 0x65, 0x0,  0xf,  0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f, 0x17, 0xf7, 0x1a,
                   0x98, 0x69, 0xa9, 0xd0, 0x6,  0x61, 0x40, 0x13, 0x1,  0xa9, 0x15, 0x0,  0x1b, 0x23, 0x93,
                   0xe1, 0xdd, 0x19, 0xcc, 0x2c, 0x34, 0xc3, 0xd7, 0xb6, 0x12, 0xd1, 0x68, 0x38, 0xf2, 0x3d,
                   0x83, 0x6d, 0xf1, 0x5d, 0xdf, 0x32, 0x42, 0x2a, 0x9a, 0x41, 0x21, 0x52, 0xef, 0x9,  0x0,
                   0x6,  0xb9, 0x47, 0x4d, 0x2d, 0xdc, 0x70, 0x22, 0x5e, 0x97, 0x27, 0x0,  0x0,  0x7f, 0xde,
                   0x19, 0x7a, 0x29, 0x10, 0x19, 0x8b, 0x2,  0x0,  0x0,  0x37, 0xea, 0xa4, 0xd7, 0x31, 0x59,
                   0x6d, 0x85, 0x49, 0x65, 0xc5, 0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  uint8_t topic_bytes[] = {0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f, 0x17, 0xf7, 0x1a, 0x98, 0x69, 0xa9, 0xd0};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa4, 0xd7, 0x31, 0x59, 0x6d, 0x85, 0x49, 0x65, 0xc5,
                         0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0x23, 0x93, 0xe1, 0xdd, 0x19, 0xcc, 0x2c, 0x34, 0xc3, 0xd7, 0xb6, 0x12, 0xd1, 0x68,
                           0x38, 0xf2, 0x3d, 0x83, 0x6d, 0xf1, 0x5d, 0xdf, 0x32, 0x42, 0x2a, 0x9a, 0x41};
  uint8_t bytesprops1[] = {0xb9, 0x47, 0x4d, 0x2d, 0xdc, 0x70};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 425}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21231}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24215}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32734}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14314}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 1633, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "IP~U\245v\179O\ETB\247\SUB\152i\169\208", _pubPktID = 1633, _pubBody =
// "\164\215\&1Ym\133Ie\197\EOT\147\DC3}g\SUB\150\143", _pubProps = [PropServerKeepAlive 425,PropAuthenticationMethod
// "#\147\225\221\EM\204,4\195\215\182\DC2\209h8\242=\131m\241]\223\&2B*\154A",PropReceiveMaximum
// 21231,PropCorrelationData "\185GM-\220p",PropTopicAliasMaximum 24215,PropMaximumPacketSize
// 32734,PropRequestResponseInformation 122,PropSubscriptionIdentifierAvailable 16,PropRequestResponseInformation
// 139,PropMessageExpiryInterval 14314]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {0x3d, 0x65, 0x0,  0xf,  0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f, 0x17, 0xf7, 0x1a,
                   0x98, 0x69, 0xa9, 0xd0, 0x6,  0x61, 0x40, 0x13, 0x1,  0xa9, 0x15, 0x0,  0x1b, 0x23, 0x93,
                   0xe1, 0xdd, 0x19, 0xcc, 0x2c, 0x34, 0xc3, 0xd7, 0xb6, 0x12, 0xd1, 0x68, 0x38, 0xf2, 0x3d,
                   0x83, 0x6d, 0xf1, 0x5d, 0xdf, 0x32, 0x42, 0x2a, 0x9a, 0x41, 0x21, 0x52, 0xef, 0x9,  0x0,
                   0x6,  0xb9, 0x47, 0x4d, 0x2d, 0xdc, 0x70, 0x22, 0x5e, 0x97, 0x27, 0x0,  0x0,  0x7f, 0xde,
                   0x19, 0x7a, 0x29, 0x10, 0x19, 0x8b, 0x2,  0x0,  0x0,  0x37, 0xea, 0xa4, 0xd7, 0x31, 0x59,
                   0x6d, 0x85, 0x49, 0x65, 0xc5, 0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x49, 0x50, 0x7e, 0x55, 0xf5, 0x76, 0xb3, 0x4f,
                               0x17, 0xf7, 0x1a, 0x98, 0x69, 0xa9, 0xd0};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa4, 0xd7, 0x31, 0x59, 0x6d, 0x85, 0x49, 0x65, 0xc5,
                              0x4,  0x93, 0x13, 0x7d, 0x67, 0x1a, 0x96, 0x8f};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1633);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\bm\162F\236O\211D\179\164@\195\244", _pubPktID = 19046, _pubBody = ".\167H\139", _pubProps =
// [PropAuthenticationMethod
// "\219\229\205\149\172\227\202\174\223\175\168\209\167y\200l\NAK\169\NUL!\234",PropTopicAlias 27954,PropContentType
// "\CAN\175Kb_\199\210\223\181~\239",PropAuthenticationMethod
// "\129=\FS\190\220\195\244\195\RS\235\203\248\239\154a\138\225\EOT\DC3",PropAssignedClientIdentifier
// "\194\237T\196\147\185\239\166",PropAuthenticationMethod
// "-U\247\206s\fm\SI\169\229\240\146I\ACK\132\237",PropServerKeepAlive 5221,PropRetainAvailable
// 36,PropMessageExpiryInterval 3914,PropResponseTopic
// ",\233\163\165e\195X\ACK\DC1\te\152^T\193\220\176",PropAuthenticationMethod
// "s\232\207Z\196\202*g\SYN\199\219\ay\224\191?gO(X\150\t\FS",PropSubscriptionIdentifier 2,PropTopicAlias
// 17849,PropContentType "\170\216\214\235\220e\250\177\142
// \157\233\r4a\153\233\152)\236",PropWildcardSubscriptionAvailable 181,PropAuthenticationData
// "\139\254\154=\192#C\209\EOTU1U\162J[zj\238\168\203\DC2!",PropWillDelayInterval 20612,PropServerKeepAlive
// 16088,PropSubscriptionIdentifierAvailable 56]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x35, 0xed, 0x1,  0x0,  0xd,  0x8,  0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44, 0xb3, 0xa4, 0x40, 0xc3, 0xf4, 0x4a,
      0x66, 0xd6, 0x1,  0x15, 0x0,  0x15, 0xdb, 0xe5, 0xcd, 0x95, 0xac, 0xe3, 0xca, 0xae, 0xdf, 0xaf, 0xa8, 0xd1, 0xa7,
      0x79, 0xc8, 0x6c, 0x15, 0xa9, 0x0,  0x21, 0xea, 0x23, 0x6d, 0x32, 0x3,  0x0,  0xb,  0x18, 0xaf, 0x4b, 0x62, 0x5f,
      0xc7, 0xd2, 0xdf, 0xb5, 0x7e, 0xef, 0x15, 0x0,  0x13, 0x81, 0x3d, 0x1c, 0xbe, 0xdc, 0xc3, 0xf4, 0xc3, 0x1e, 0xeb,
      0xcb, 0xf8, 0xef, 0x9a, 0x61, 0x8a, 0xe1, 0x4,  0x13, 0x12, 0x0,  0x8,  0xc2, 0xed, 0x54, 0xc4, 0x93, 0xb9, 0xef,
      0xa6, 0x15, 0x0,  0x10, 0x2d, 0x55, 0xf7, 0xce, 0x73, 0xc,  0x6d, 0xf,  0xa9, 0xe5, 0xf0, 0x92, 0x49, 0x6,  0x84,
      0xed, 0x13, 0x14, 0x65, 0x25, 0x24, 0x2,  0x0,  0x0,  0xf,  0x4a, 0x8,  0x0,  0x11, 0x2c, 0xe9, 0xa3, 0xa5, 0x65,
      0xc3, 0x58, 0x6,  0x11, 0x9,  0x65, 0x98, 0x5e, 0x54, 0xc1, 0xdc, 0xb0, 0x15, 0x0,  0x17, 0x73, 0xe8, 0xcf, 0x5a,
      0xc4, 0xca, 0x2a, 0x67, 0x16, 0xc7, 0xdb, 0x7,  0x79, 0xe0, 0xbf, 0x3f, 0x67, 0x4f, 0x28, 0x58, 0x96, 0x9,  0x1c,
      0xb,  0x2,  0x23, 0x45, 0xb9, 0x3,  0x0,  0x14, 0xaa, 0xd8, 0xd6, 0xeb, 0xdc, 0x65, 0xfa, 0xb1, 0x8e, 0x20, 0x9d,
      0xe9, 0xd,  0x34, 0x61, 0x99, 0xe9, 0x98, 0x29, 0xec, 0x28, 0xb5, 0x16, 0x0,  0x16, 0x8b, 0xfe, 0x9a, 0x3d, 0xc0,
      0x23, 0x43, 0xd1, 0x4,  0x55, 0x31, 0x55, 0xa2, 0x4a, 0x5b, 0x7a, 0x6a, 0xee, 0xa8, 0xcb, 0x12, 0x21, 0x18, 0x0,
      0x0,  0x50, 0x84, 0x13, 0x3e, 0xd8, 0x29, 0x38, 0x2e, 0xa7, 0x48, 0x8b};
  uint8_t topic_bytes[] = {0x8, 0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44, 0xb3, 0xa4, 0x40, 0xc3, 0xf4};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2e, 0xa7, 0x48, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytesprops0[] = {0xdb, 0xe5, 0xcd, 0x95, 0xac, 0xe3, 0xca, 0xae, 0xdf, 0xaf, 0xa8,
                           0xd1, 0xa7, 0x79, 0xc8, 0x6c, 0x15, 0xa9, 0x0,  0x21, 0xea};
  uint8_t bytesprops1[] = {0x18, 0xaf, 0x4b, 0x62, 0x5f, 0xc7, 0xd2, 0xdf, 0xb5, 0x7e, 0xef};
  uint8_t bytesprops2[] = {0x81, 0x3d, 0x1c, 0xbe, 0xdc, 0xc3, 0xf4, 0xc3, 0x1e, 0xeb,
                           0xcb, 0xf8, 0xef, 0x9a, 0x61, 0x8a, 0xe1, 0x4,  0x13};
  uint8_t bytesprops3[] = {0xc2, 0xed, 0x54, 0xc4, 0x93, 0xb9, 0xef, 0xa6};
  uint8_t bytesprops4[] = {0x2d, 0x55, 0xf7, 0xce, 0x73, 0xc, 0x6d, 0xf, 0xa9, 0xe5, 0xf0, 0x92, 0x49, 0x6, 0x84, 0xed};
  uint8_t bytesprops5[] = {0x2c, 0xe9, 0xa3, 0xa5, 0x65, 0xc3, 0x58, 0x6, 0x11,
                           0x9,  0x65, 0x98, 0x5e, 0x54, 0xc1, 0xdc, 0xb0};
  uint8_t bytesprops6[] = {0x73, 0xe8, 0xcf, 0x5a, 0xc4, 0xca, 0x2a, 0x67, 0x16, 0xc7, 0xdb, 0x7,
                           0x79, 0xe0, 0xbf, 0x3f, 0x67, 0x4f, 0x28, 0x58, 0x96, 0x9,  0x1c};
  uint8_t bytesprops7[] = {0xaa, 0xd8, 0xd6, 0xeb, 0xdc, 0x65, 0xfa, 0xb1, 0x8e, 0x20,
                           0x9d, 0xe9, 0xd,  0x34, 0x61, 0x99, 0xe9, 0x98, 0x29, 0xec};
  uint8_t bytesprops8[] = {0x8b, 0xfe, 0x9a, 0x3d, 0xc0, 0x23, 0x43, 0xd1, 0x4,  0x55, 0x31,
                           0x55, 0xa2, 0x4a, 0x5b, 0x7a, 0x6a, 0xee, 0xa8, 0xcb, 0x12, 0x21};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27954}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5221}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3914}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17849}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20612}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16088}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 56}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 19046, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\bm\162F\236O\211D\179\164@\195\244", _pubPktID = 19046, _pubBody = ".\167H\139", _pubProps =
// [PropAuthenticationMethod
// "\219\229\205\149\172\227\202\174\223\175\168\209\167y\200l\NAK\169\NUL!\234",PropTopicAlias 27954,PropContentType
// "\CAN\175Kb_\199\210\223\181~\239",PropAuthenticationMethod
// "\129=\FS\190\220\195\244\195\RS\235\203\248\239\154a\138\225\EOT\DC3",PropAssignedClientIdentifier
// "\194\237T\196\147\185\239\166",PropAuthenticationMethod
// "-U\247\206s\fm\SI\169\229\240\146I\ACK\132\237",PropServerKeepAlive 5221,PropRetainAvailable
// 36,PropMessageExpiryInterval 3914,PropResponseTopic
// ",\233\163\165e\195X\ACK\DC1\te\152^T\193\220\176",PropAuthenticationMethod
// "s\232\207Z\196\202*g\SYN\199\219\ay\224\191?gO(X\150\t\FS",PropSubscriptionIdentifier 2,PropTopicAlias
// 17849,PropContentType "\170\216\214\235\220e\250\177\142
// \157\233\r4a\153\233\152)\236",PropWildcardSubscriptionAvailable 181,PropAuthenticationData
// "\139\254\154=\192#C\209\EOTU1U\162J[zj\238\168\203\DC2!",PropWillDelayInterval 20612,PropServerKeepAlive
// 16088,PropSubscriptionIdentifierAvailable 56]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x35, 0xed, 0x1,  0x0,  0xd,  0x8,  0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44, 0xb3, 0xa4, 0x40, 0xc3, 0xf4, 0x4a,
      0x66, 0xd6, 0x1,  0x15, 0x0,  0x15, 0xdb, 0xe5, 0xcd, 0x95, 0xac, 0xe3, 0xca, 0xae, 0xdf, 0xaf, 0xa8, 0xd1, 0xa7,
      0x79, 0xc8, 0x6c, 0x15, 0xa9, 0x0,  0x21, 0xea, 0x23, 0x6d, 0x32, 0x3,  0x0,  0xb,  0x18, 0xaf, 0x4b, 0x62, 0x5f,
      0xc7, 0xd2, 0xdf, 0xb5, 0x7e, 0xef, 0x15, 0x0,  0x13, 0x81, 0x3d, 0x1c, 0xbe, 0xdc, 0xc3, 0xf4, 0xc3, 0x1e, 0xeb,
      0xcb, 0xf8, 0xef, 0x9a, 0x61, 0x8a, 0xe1, 0x4,  0x13, 0x12, 0x0,  0x8,  0xc2, 0xed, 0x54, 0xc4, 0x93, 0xb9, 0xef,
      0xa6, 0x15, 0x0,  0x10, 0x2d, 0x55, 0xf7, 0xce, 0x73, 0xc,  0x6d, 0xf,  0xa9, 0xe5, 0xf0, 0x92, 0x49, 0x6,  0x84,
      0xed, 0x13, 0x14, 0x65, 0x25, 0x24, 0x2,  0x0,  0x0,  0xf,  0x4a, 0x8,  0x0,  0x11, 0x2c, 0xe9, 0xa3, 0xa5, 0x65,
      0xc3, 0x58, 0x6,  0x11, 0x9,  0x65, 0x98, 0x5e, 0x54, 0xc1, 0xdc, 0xb0, 0x15, 0x0,  0x17, 0x73, 0xe8, 0xcf, 0x5a,
      0xc4, 0xca, 0x2a, 0x67, 0x16, 0xc7, 0xdb, 0x7,  0x79, 0xe0, 0xbf, 0x3f, 0x67, 0x4f, 0x28, 0x58, 0x96, 0x9,  0x1c,
      0xb,  0x2,  0x23, 0x45, 0xb9, 0x3,  0x0,  0x14, 0xaa, 0xd8, 0xd6, 0xeb, 0xdc, 0x65, 0xfa, 0xb1, 0x8e, 0x20, 0x9d,
      0xe9, 0xd,  0x34, 0x61, 0x99, 0xe9, 0x98, 0x29, 0xec, 0x28, 0xb5, 0x16, 0x0,  0x16, 0x8b, 0xfe, 0x9a, 0x3d, 0xc0,
      0x23, 0x43, 0xd1, 0x4,  0x55, 0x31, 0x55, 0xa2, 0x4a, 0x5b, 0x7a, 0x6a, 0xee, 0xa8, 0xcb, 0x12, 0x21, 0x18, 0x0,
      0x0,  0x50, 0x84, 0x13, 0x3e, 0xd8, 0x29, 0x38, 0x2e, 0xa7, 0x48, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8, 0x6d, 0xa2, 0x46, 0xec, 0x4f, 0xd3, 0x44, 0xb3, 0xa4, 0x40, 0xc3, 0xf4};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2e, 0xa7, 0x48, 0x8b};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 19046);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "%\134\216", _pubPktID = 0, _pubBody
// = "\ETB\162T\161\139s\238\233\229.\233\243\186", _pubProps = [PropReceiveMaximum 13370,PropServerReference
// ";O\228n+\180\201\169\171\196\225 \EM\232\ETX\155#\SI(\t[Uu",PropPayloadFormatIndicator 134,PropUserProperty
// "\249\245\STXW\228J\157"
// "\231\255\213\ACK[2\204\&6\175\169\228\168\195\246\156\189)\255\&5\186\135\SO\210\246I\144C:\225\179",PropMaximumPacketSize
// 20364,PropUserProperty "\DC3{,\181\USP\229\211\FS\138\189-\240\220\205\128i\156`\ESC8"
// "ss\164\EOT\152",PropAuthenticationData "\221\220\186\194/\STX\246\189\ETX\SOH='\150\187$-",PropAuthenticationMethod
// "\187G\163\200\195[\211\203^\NUL\NAK\239\184\&6Q\176\v\255\t,\246\246\&1\172\216\207\t",PropReceiveMaximum
// 32386,PropRequestResponseInformation 185,PropServerReference
// "\248\181w\213\166\219\221\247\159\254\204\179\213|\243I\STXa\255\143w\SYN\208\223\218\185\ESC",PropMessageExpiryInterval
// 6843,PropRetainAvailable 210]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x38, 0xdc, 0x1,  0x0,  0x3,  0x25, 0x86, 0xd8, 0xc8, 0x1,  0x21, 0x34, 0x3a, 0x1c, 0x0,  0x17, 0x3b, 0x4f, 0xe4,
      0x6e, 0x2b, 0xb4, 0xc9, 0xa9, 0xab, 0xc4, 0xe1, 0x20, 0x19, 0xe8, 0x3,  0x9b, 0x23, 0xf,  0x28, 0x9,  0x5b, 0x55,
      0x75, 0x1,  0x86, 0x26, 0x0,  0x7,  0xf9, 0xf5, 0x2,  0x57, 0xe4, 0x4a, 0x9d, 0x0,  0x1e, 0xe7, 0xff, 0xd5, 0x6,
      0x5b, 0x32, 0xcc, 0x36, 0xaf, 0xa9, 0xe4, 0xa8, 0xc3, 0xf6, 0x9c, 0xbd, 0x29, 0xff, 0x35, 0xba, 0x87, 0xe,  0xd2,
      0xf6, 0x49, 0x90, 0x43, 0x3a, 0xe1, 0xb3, 0x27, 0x0,  0x0,  0x4f, 0x8c, 0x26, 0x0,  0x15, 0x13, 0x7b, 0x2c, 0xb5,
      0x1f, 0x50, 0xe5, 0xd3, 0x1c, 0x8a, 0xbd, 0x2d, 0xf0, 0xdc, 0xcd, 0x80, 0x69, 0x9c, 0x60, 0x1b, 0x38, 0x0,  0x5,
      0x73, 0x73, 0xa4, 0x4,  0x98, 0x16, 0x0,  0x10, 0xdd, 0xdc, 0xba, 0xc2, 0x2f, 0x2,  0xf6, 0xbd, 0x3,  0x1,  0x3d,
      0x27, 0x96, 0xbb, 0x24, 0x2d, 0x15, 0x0,  0x1b, 0xbb, 0x47, 0xa3, 0xc8, 0xc3, 0x5b, 0xd3, 0xcb, 0x5e, 0x0,  0x15,
      0xef, 0xb8, 0x36, 0x51, 0xb0, 0xb,  0xff, 0x9,  0x2c, 0xf6, 0xf6, 0x31, 0xac, 0xd8, 0xcf, 0x9,  0x21, 0x7e, 0x82,
      0x19, 0xb9, 0x1c, 0x0,  0x1b, 0xf8, 0xb5, 0x77, 0xd5, 0xa6, 0xdb, 0xdd, 0xf7, 0x9f, 0xfe, 0xcc, 0xb3, 0xd5, 0x7c,
      0xf3, 0x49, 0x2,  0x61, 0xff, 0x8f, 0x77, 0x16, 0xd0, 0xdf, 0xda, 0xb9, 0x1b, 0x2,  0x0,  0x0,  0x1a, 0xbb, 0x25,
      0xd2, 0x17, 0xa2, 0x54, 0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  uint8_t topic_bytes[] = {0x25, 0x86, 0xd8};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x17, 0xa2, 0x54, 0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0x3b, 0x4f, 0xe4, 0x6e, 0x2b, 0xb4, 0xc9, 0xa9, 0xab, 0xc4, 0xe1, 0x20,
                           0x19, 0xe8, 0x3,  0x9b, 0x23, 0xf,  0x28, 0x9,  0x5b, 0x55, 0x75};
  uint8_t bytesprops2[] = {0xe7, 0xff, 0xd5, 0x6,  0x5b, 0x32, 0xcc, 0x36, 0xaf, 0xa9, 0xe4, 0xa8, 0xc3, 0xf6, 0x9c,
                           0xbd, 0x29, 0xff, 0x35, 0xba, 0x87, 0xe,  0xd2, 0xf6, 0x49, 0x90, 0x43, 0x3a, 0xe1, 0xb3};
  uint8_t bytesprops1[] = {0xf9, 0xf5, 0x2, 0x57, 0xe4, 0x4a, 0x9d};
  uint8_t bytesprops4[] = {0x73, 0x73, 0xa4, 0x4, 0x98};
  uint8_t bytesprops3[] = {0x13, 0x7b, 0x2c, 0xb5, 0x1f, 0x50, 0xe5, 0xd3, 0x1c, 0x8a, 0xbd,
                           0x2d, 0xf0, 0xdc, 0xcd, 0x80, 0x69, 0x9c, 0x60, 0x1b, 0x38};
  uint8_t bytesprops5[] = {0xdd, 0xdc, 0xba, 0xc2, 0x2f, 0x2, 0xf6, 0xbd, 0x3, 0x1, 0x3d, 0x27, 0x96, 0xbb, 0x24, 0x2d};
  uint8_t bytesprops6[] = {0xbb, 0x47, 0xa3, 0xc8, 0xc3, 0x5b, 0xd3, 0xcb, 0x5e, 0x0,  0x15, 0xef, 0xb8, 0x36,
                           0x51, 0xb0, 0xb,  0xff, 0x9,  0x2c, 0xf6, 0xf6, 0x31, 0xac, 0xd8, 0xcf, 0x9};
  uint8_t bytesprops7[] = {0xf8, 0xb5, 0x77, 0xd5, 0xa6, 0xdb, 0xdd, 0xf7, 0x9f, 0xfe, 0xcc, 0xb3, 0xd5, 0x7c,
                           0xf3, 0x49, 0x2,  0x61, 0xff, 0x8f, 0x77, 0x16, 0xd0, 0xdf, 0xda, 0xb9, 0x1b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13370}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops1}, .v = {30, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20364}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops3}, .v = {5, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32386}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6843}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 210}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "%\134\216", _pubPktID = 0, _pubBody
// = "\ETB\162T\161\139s\238\233\229.\233\243\186", _pubProps = [PropReceiveMaximum 13370,PropServerReference
// ";O\228n+\180\201\169\171\196\225 \EM\232\ETX\155#\SI(\t[Uu",PropPayloadFormatIndicator 134,PropUserProperty
// "\249\245\STXW\228J\157"
// "\231\255\213\ACK[2\204\&6\175\169\228\168\195\246\156\189)\255\&5\186\135\SO\210\246I\144C:\225\179",PropMaximumPacketSize
// 20364,PropUserProperty "\DC3{,\181\USP\229\211\FS\138\189-\240\220\205\128i\156`\ESC8"
// "ss\164\EOT\152",PropAuthenticationData "\221\220\186\194/\STX\246\189\ETX\SOH='\150\187$-",PropAuthenticationMethod
// "\187G\163\200\195[\211\203^\NUL\NAK\239\184\&6Q\176\v\255\t,\246\246\&1\172\216\207\t",PropReceiveMaximum
// 32386,PropRequestResponseInformation 185,PropServerReference
// "\248\181w\213\166\219\221\247\159\254\204\179\213|\243I\STXa\255\143w\SYN\208\223\218\185\ESC",PropMessageExpiryInterval
// 6843,PropRetainAvailable 210]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {
      0x38, 0xdc, 0x1,  0x0,  0x3,  0x25, 0x86, 0xd8, 0xc8, 0x1,  0x21, 0x34, 0x3a, 0x1c, 0x0,  0x17, 0x3b, 0x4f, 0xe4,
      0x6e, 0x2b, 0xb4, 0xc9, 0xa9, 0xab, 0xc4, 0xe1, 0x20, 0x19, 0xe8, 0x3,  0x9b, 0x23, 0xf,  0x28, 0x9,  0x5b, 0x55,
      0x75, 0x1,  0x86, 0x26, 0x0,  0x7,  0xf9, 0xf5, 0x2,  0x57, 0xe4, 0x4a, 0x9d, 0x0,  0x1e, 0xe7, 0xff, 0xd5, 0x6,
      0x5b, 0x32, 0xcc, 0x36, 0xaf, 0xa9, 0xe4, 0xa8, 0xc3, 0xf6, 0x9c, 0xbd, 0x29, 0xff, 0x35, 0xba, 0x87, 0xe,  0xd2,
      0xf6, 0x49, 0x90, 0x43, 0x3a, 0xe1, 0xb3, 0x27, 0x0,  0x0,  0x4f, 0x8c, 0x26, 0x0,  0x15, 0x13, 0x7b, 0x2c, 0xb5,
      0x1f, 0x50, 0xe5, 0xd3, 0x1c, 0x8a, 0xbd, 0x2d, 0xf0, 0xdc, 0xcd, 0x80, 0x69, 0x9c, 0x60, 0x1b, 0x38, 0x0,  0x5,
      0x73, 0x73, 0xa4, 0x4,  0x98, 0x16, 0x0,  0x10, 0xdd, 0xdc, 0xba, 0xc2, 0x2f, 0x2,  0xf6, 0xbd, 0x3,  0x1,  0x3d,
      0x27, 0x96, 0xbb, 0x24, 0x2d, 0x15, 0x0,  0x1b, 0xbb, 0x47, 0xa3, 0xc8, 0xc3, 0x5b, 0xd3, 0xcb, 0x5e, 0x0,  0x15,
      0xef, 0xb8, 0x36, 0x51, 0xb0, 0xb,  0xff, 0x9,  0x2c, 0xf6, 0xf6, 0x31, 0xac, 0xd8, 0xcf, 0x9,  0x21, 0x7e, 0x82,
      0x19, 0xb9, 0x1c, 0x0,  0x1b, 0xf8, 0xb5, 0x77, 0xd5, 0xa6, 0xdb, 0xdd, 0xf7, 0x9f, 0xfe, 0xcc, 0xb3, 0xd5, 0x7c,
      0xf3, 0x49, 0x2,  0x61, 0xff, 0x8f, 0x77, 0x16, 0xd0, 0xdf, 0xda, 0xb9, 0x1b, 0x2,  0x0,  0x0,  0x1a, 0xbb, 0x25,
      0xd2, 0x17, 0xa2, 0x54, 0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x25, 0x86, 0xd8};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x17, 0xa2, 0x54, 0xa1, 0x8b, 0x73, 0xee, 0xe9, 0xe5, 0x2e, 0xe9, 0xf3, 0xba};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\230\237\153c\242P\179\141\223\&2\205Z{\223\153", _pubPktID = 22947, _pubBody =
// "\195\148\247\&4\177\f%\149>q\236W\ETB-\a\209y\n\133o\172*:\131aY", _pubProps = [PropServerReference
// "\198\&6(\SOHH}",PropTopicAliasMaximum 11940,PropRetainAvailable 229,PropResponseInformation
// "\128\171w\200\170x:n*T\DC47xe&T\214\243\196\145\224E\222\226\148[\148\&27",PropSubscriptionIdentifierAvailable
// 153,PropRetainAvailable 170]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {0x3a, 0x60, 0x0,  0xf,  0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d, 0xdf, 0x32, 0xcd, 0x5a, 0x7b,
                   0xdf, 0x99, 0x59, 0xa3, 0x32, 0x1c, 0x0,  0x6,  0xc6, 0x36, 0x28, 0x1,  0x48, 0x7d, 0x22, 0x2e, 0xa4,
                   0x25, 0xe5, 0x1a, 0x0,  0x1d, 0x80, 0xab, 0x77, 0xc8, 0xaa, 0x78, 0x3a, 0x6e, 0x2a, 0x54, 0x14, 0x37,
                   0x78, 0x65, 0x26, 0x54, 0xd6, 0xf3, 0xc4, 0x91, 0xe0, 0x45, 0xde, 0xe2, 0x94, 0x5b, 0x94, 0x32, 0x37,
                   0x29, 0x99, 0x25, 0xaa, 0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec, 0x57, 0x17,
                   0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  uint8_t topic_bytes[] = {0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d, 0xdf, 0x32, 0xcd, 0x5a, 0x7b, 0xdf, 0x99};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec, 0x57, 0x17,
                         0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0xc6, 0x36, 0x28, 0x1, 0x48, 0x7d};
  uint8_t bytesprops1[] = {0x80, 0xab, 0x77, 0xc8, 0xaa, 0x78, 0x3a, 0x6e, 0x2a, 0x54, 0x14, 0x37, 0x78, 0x65, 0x26,
                           0x54, 0xd6, 0xf3, 0xc4, 0x91, 0xe0, 0x45, 0xde, 0xe2, 0x94, 0x5b, 0x94, 0x32, 0x37};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11940}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 170}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 22947, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\230\237\153c\242P\179\141\223\&2\205Z{\223\153", _pubPktID = 22947, _pubBody =
// "\195\148\247\&4\177\f%\149>q\236W\ETB-\a\209y\n\133o\172*:\131aY", _pubProps = [PropServerReference
// "\198\&6(\SOHH}",PropTopicAliasMaximum 11940,PropRetainAvailable 229,PropResponseInformation
// "\128\171w\200\170x:n*T\DC47xe&T\214\243\196\145\224E\222\226\148[\148\&27",PropSubscriptionIdentifierAvailable
// 153,PropRetainAvailable 170]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {0x3a, 0x60, 0x0,  0xf,  0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d, 0xdf, 0x32, 0xcd, 0x5a, 0x7b,
                   0xdf, 0x99, 0x59, 0xa3, 0x32, 0x1c, 0x0,  0x6,  0xc6, 0x36, 0x28, 0x1,  0x48, 0x7d, 0x22, 0x2e, 0xa4,
                   0x25, 0xe5, 0x1a, 0x0,  0x1d, 0x80, 0xab, 0x77, 0xc8, 0xaa, 0x78, 0x3a, 0x6e, 0x2a, 0x54, 0x14, 0x37,
                   0x78, 0x65, 0x26, 0x54, 0xd6, 0xf3, 0xc4, 0x91, 0xe0, 0x45, 0xde, 0xe2, 0x94, 0x5b, 0x94, 0x32, 0x37,
                   0x29, 0x99, 0x25, 0xaa, 0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec, 0x57, 0x17,
                   0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe6, 0xed, 0x99, 0x63, 0xf2, 0x50, 0xb3, 0x8d,
                               0xdf, 0x32, 0xcd, 0x5a, 0x7b, 0xdf, 0x99};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc3, 0x94, 0xf7, 0x34, 0xb1, 0xc,  0x25, 0x95, 0x3e, 0x71, 0xec, 0x57, 0x17,
                              0x2d, 0x7,  0xd1, 0x79, 0xa,  0x85, 0x6f, 0xac, 0x2a, 0x3a, 0x83, 0x61, 0x59};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 22947);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\159q1\146\234\232\173\FS`\184\186\140\SYN=Z", _pubPktID = 12817, _pubBody = "EJwh\185\236\204#\166", _pubProps =
// [PropWildcardSubscriptionAvailable 230,PropTopicAliasMaximum 13164,PropResponseInformation
// "f(\159\149\STX\ETB\146r\b\228\&1Y\255\ENQ\161\133\189\239l\195\227s\192",PropSubscriptionIdentifier
// 13,PropCorrelationData ""]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x33, 0x41, 0x0,  0xf,  0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c, 0x60, 0xb8, 0xba, 0x8c, 0x16,
                   0x3d, 0x5a, 0x32, 0x11, 0x24, 0x28, 0xe6, 0x22, 0x33, 0x6c, 0x1a, 0x0,  0x17, 0x66, 0x28, 0x9f, 0x95,
                   0x2,  0x17, 0x92, 0x72, 0x8,  0xe4, 0x31, 0x59, 0xff, 0x5,  0xa1, 0x85, 0xbd, 0xef, 0x6c, 0xc3, 0xe3,
                   0x73, 0xc0, 0xb,  0xd,  0x9,  0x0,  0x0,  0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  uint8_t topic_bytes[] = {0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c, 0x60, 0xb8, 0xba, 0x8c, 0x16, 0x3d, 0x5a};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0x66, 0x28, 0x9f, 0x95, 0x2,  0x17, 0x92, 0x72, 0x8,  0xe4, 0x31, 0x59,
                           0xff, 0x5,  0xa1, 0x85, 0xbd, 0xef, 0x6c, 0xc3, 0xe3, 0x73, 0xc0};
  uint8_t bytesprops1[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13164}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 12817, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\159q1\146\234\232\173\FS`\184\186\140\SYN=Z", _pubPktID = 12817, _pubBody = "EJwh\185\236\204#\166", _pubProps =
// [PropWildcardSubscriptionAvailable 230,PropTopicAliasMaximum 13164,PropResponseInformation
// "f(\159\149\STX\ETB\146r\b\228\&1Y\255\ENQ\161\133\189\239l\195\227s\192",PropSubscriptionIdentifier
// 13,PropCorrelationData ""]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {0x33, 0x41, 0x0,  0xf,  0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c, 0x60, 0xb8, 0xba, 0x8c, 0x16,
                   0x3d, 0x5a, 0x32, 0x11, 0x24, 0x28, 0xe6, 0x22, 0x33, 0x6c, 0x1a, 0x0,  0x17, 0x66, 0x28, 0x9f, 0x95,
                   0x2,  0x17, 0x92, 0x72, 0x8,  0xe4, 0x31, 0x59, 0xff, 0x5,  0xa1, 0x85, 0xbd, 0xef, 0x6c, 0xc3, 0xe3,
                   0x73, 0xc0, 0xb,  0xd,  0x9,  0x0,  0x0,  0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9f, 0x71, 0x31, 0x92, 0xea, 0xe8, 0xad, 0x1c,
                               0x60, 0xb8, 0xba, 0x8c, 0x16, 0x3d, 0x5a};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x4a, 0x77, 0x68, 0xb9, 0xec, 0xcc, 0x23, 0xa6};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 12817);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "7_", _pubPktID = 0, _pubBody =
// "1l\172\222\&2J\173\154BN|", _pubProps = [PropAuthenticationData "N\249\ESC\DC4\178\165l\GS\193
// @\237\FSc\130\US\168L\221\212\134M\184\177",PropServerReference
// "\229\142\151\208\141\194\159xc\240\176\128+N\215xB>\239\174",PropTopicAliasMaximum 26288,PropCorrelationData
// "\ESCK\213\ETXj\232~\r\137\200>",PropMaximumPacketSize 9064,PropResponseTopic
// "\131\226]\251:\231\173\211:9^\ESC\153\165\ACK\175\199\CAN\248H[",PropUserProperty "C"
// "\SO\ETX\187\233\164mYM\130\&6\v\150\178\186K\203\179m\"\201\&6\129"]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x30, 0x8c, 0x1,  0x0,  0x2,  0x37, 0x5f, 0x7c, 0x16, 0x0,  0x18, 0x4e, 0xf9, 0x1b, 0x14, 0xb2,
                   0xa5, 0x6c, 0x1d, 0xc1, 0x20, 0x40, 0xed, 0x1c, 0x63, 0x82, 0x1f, 0xa8, 0x4c, 0xdd, 0xd4, 0x86,
                   0x4d, 0xb8, 0xb1, 0x1c, 0x0,  0x14, 0xe5, 0x8e, 0x97, 0xd0, 0x8d, 0xc2, 0x9f, 0x78, 0x63, 0xf0,
                   0xb0, 0x80, 0x2b, 0x4e, 0xd7, 0x78, 0x42, 0x3e, 0xef, 0xae, 0x22, 0x66, 0xb0, 0x9,  0x0,  0xb,
                   0x1b, 0x4b, 0xd5, 0x3,  0x6a, 0xe8, 0x7e, 0xd,  0x89, 0xc8, 0x3e, 0x27, 0x0,  0x0,  0x23, 0x68,
                   0x8,  0x0,  0x15, 0x83, 0xe2, 0x5d, 0xfb, 0x3a, 0xe7, 0xad, 0xd3, 0x3a, 0x39, 0x5e, 0x1b, 0x99,
                   0xa5, 0x6,  0xaf, 0xc7, 0x18, 0xf8, 0x48, 0x5b, 0x26, 0x0,  0x1,  0x43, 0x0,  0x16, 0xe,  0x3,
                   0xbb, 0xe9, 0xa4, 0x6d, 0x59, 0x4d, 0x82, 0x36, 0xb,  0x96, 0xb2, 0xba, 0x4b, 0xcb, 0xb3, 0x6d,
                   0x22, 0xc9, 0x36, 0x81, 0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  uint8_t topic_bytes[] = {0x37, 0x5f};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0x4e, 0xf9, 0x1b, 0x14, 0xb2, 0xa5, 0x6c, 0x1d, 0xc1, 0x20, 0x40, 0xed,
                           0x1c, 0x63, 0x82, 0x1f, 0xa8, 0x4c, 0xdd, 0xd4, 0x86, 0x4d, 0xb8, 0xb1};
  uint8_t bytesprops1[] = {0xe5, 0x8e, 0x97, 0xd0, 0x8d, 0xc2, 0x9f, 0x78, 0x63, 0xf0,
                           0xb0, 0x80, 0x2b, 0x4e, 0xd7, 0x78, 0x42, 0x3e, 0xef, 0xae};
  uint8_t bytesprops2[] = {0x1b, 0x4b, 0xd5, 0x3, 0x6a, 0xe8, 0x7e, 0xd, 0x89, 0xc8, 0x3e};
  uint8_t bytesprops3[] = {0x83, 0xe2, 0x5d, 0xfb, 0x3a, 0xe7, 0xad, 0xd3, 0x3a, 0x39, 0x5e,
                           0x1b, 0x99, 0xa5, 0x6,  0xaf, 0xc7, 0x18, 0xf8, 0x48, 0x5b};
  uint8_t bytesprops5[] = {0xe,  0x3,  0xbb, 0xe9, 0xa4, 0x6d, 0x59, 0x4d, 0x82, 0x36, 0xb,
                           0x96, 0xb2, 0xba, 0x4b, 0xcb, 0xb3, 0x6d, 0x22, 0xc9, 0x36, 0x81};
  uint8_t bytesprops4[] = {0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26288}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9064}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops4}, .v = {22, (char*)&bytesprops5}}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "7_", _pubPktID = 0, _pubBody =
// "1l\172\222\&2J\173\154BN|", _pubProps = [PropAuthenticationData "N\249\ESC\DC4\178\165l\GS\193
// @\237\FSc\130\US\168L\221\212\134M\184\177",PropServerReference
// "\229\142\151\208\141\194\159xc\240\176\128+N\215xB>\239\174",PropTopicAliasMaximum 26288,PropCorrelationData
// "\ESCK\213\ETXj\232~\r\137\200>",PropMaximumPacketSize 9064,PropResponseTopic
// "\131\226]\251:\231\173\211:9^\ESC\153\165\ACK\175\199\CAN\248H[",PropUserProperty "C"
// "\SO\ETX\187\233\164mYM\130\&6\v\150\178\186K\203\179m\"\201\&6\129"]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {0x30, 0x8c, 0x1,  0x0,  0x2,  0x37, 0x5f, 0x7c, 0x16, 0x0,  0x18, 0x4e, 0xf9, 0x1b, 0x14, 0xb2,
                   0xa5, 0x6c, 0x1d, 0xc1, 0x20, 0x40, 0xed, 0x1c, 0x63, 0x82, 0x1f, 0xa8, 0x4c, 0xdd, 0xd4, 0x86,
                   0x4d, 0xb8, 0xb1, 0x1c, 0x0,  0x14, 0xe5, 0x8e, 0x97, 0xd0, 0x8d, 0xc2, 0x9f, 0x78, 0x63, 0xf0,
                   0xb0, 0x80, 0x2b, 0x4e, 0xd7, 0x78, 0x42, 0x3e, 0xef, 0xae, 0x22, 0x66, 0xb0, 0x9,  0x0,  0xb,
                   0x1b, 0x4b, 0xd5, 0x3,  0x6a, 0xe8, 0x7e, 0xd,  0x89, 0xc8, 0x3e, 0x27, 0x0,  0x0,  0x23, 0x68,
                   0x8,  0x0,  0x15, 0x83, 0xe2, 0x5d, 0xfb, 0x3a, 0xe7, 0xad, 0xd3, 0x3a, 0x39, 0x5e, 0x1b, 0x99,
                   0xa5, 0x6,  0xaf, 0xc7, 0x18, 0xf8, 0x48, 0x5b, 0x26, 0x0,  0x1,  0x43, 0x0,  0x16, 0xe,  0x3,
                   0xbb, 0xe9, 0xa4, 0x6d, 0x59, 0x4d, 0x82, 0x36, 0xb,  0x96, 0xb2, 0xba, 0x4b, 0xcb, 0xb3, 0x6d,
                   0x22, 0xc9, 0x36, 0x81, 0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x37, 0x5f};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x31, 0x6c, 0xac, 0xde, 0x32, 0x4a, 0xad, 0x9a, 0x42, 0x4e, 0x7c};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\246\202\200\133Ey", _pubPktID =
// 19152, _pubBody = "G\255\&5Bg\183\227x}.\158X\246mx\199u\250\US\ETXI\ENQ\249\155!rJ", _pubProps =
// [PropResponseInformation "L\GS\243\ACK\r\226\138b\173\209\243\214"]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x35, 0x35, 0x0,  0x6,  0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79, 0x4a, 0xd0, 0xf,  0x1a,
                   0x0,  0xc,  0x4c, 0x1d, 0xf3, 0x6,  0xd,  0xe2, 0x8a, 0x62, 0xad, 0xd1, 0xf3, 0xd6,
                   0x47, 0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                   0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  uint8_t topic_bytes[] = {0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x47, 0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                         0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 27;

  uint8_t bytesprops0[] = {0x4c, 0x1d, 0xf3, 0x6, 0xd, 0xe2, 0x8a, 0x62, 0xad, 0xd1, 0xf3, 0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 19152, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\246\202\200\133Ey", _pubPktID =
// 19152, _pubBody = "G\255\&5Bg\183\227x}.\158X\246mx\199u\250\US\ETXI\ENQ\249\155!rJ", _pubProps =
// [PropResponseInformation "L\GS\243\ACK\r\226\138b\173\209\243\214"]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {0x35, 0x35, 0x0,  0x6,  0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79, 0x4a, 0xd0, 0xf,  0x1a,
                   0x0,  0xc,  0x4c, 0x1d, 0xf3, 0x6,  0xd,  0xe2, 0x8a, 0x62, 0xad, 0xd1, 0xf3, 0xd6,
                   0x47, 0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                   0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf6, 0xca, 0xc8, 0x85, 0x45, 0x79};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x47, 0xff, 0x35, 0x42, 0x67, 0xb7, 0xe3, 0x78, 0x7d, 0x2e, 0x9e, 0x58, 0xf6, 0x6d,
                              0x78, 0xc7, 0x75, 0xfa, 0x1f, 0x3,  0x49, 0x5,  0xf9, 0x9b, 0x21, 0x72, 0x4a};
  lwmqtt_string_t exp_body = {27, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 19152);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 27);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 27);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\\\211\215", _pubPktID = 7594,
// _pubBody = "\139\150\137\180\142\209{^\232\155\136\252\140\233\138", _pubProps = [PropMaximumQoS
// 183,PropWildcardSubscriptionAvailable 166,PropResponseInformation
// "\NAK\a\164$\"\164\FS\183\221N\133Vq",PropResponseTopic
// "\181\172\134\252\225C\136I\NAKC\139\151\128F\139\ESCpr\219kB\GS",PropResponseInformation
// "xY\251\200Q*\230\222>\186X:\188\217\161f5#\186\186\249\DC3\142\137y\NAK",PropRequestResponseInformation
// 180,PropSubscriptionIdentifierAvailable 102,PropWillDelayInterval 18867,PropMessageExpiryInterval
// 9600,PropContentType "5G\139\SUB\SI%\246K+\166\181\SUB>\194\SOHSG\207,X\186l\DC2\164R",PropWillDelayInterval
// 11214,PropResponseTopic
// "8\225\206\&8\206P\134lK\153\143>\156\SYN\208]1\185\SOM\t\195r\219\&2\159\US\206\GS^",PropMessageExpiryInterval
// 24117,PropAuthenticationMethod "\DC2J\251\224p\NAK",PropTopicAlias 22040,PropWillDelayInterval
// 5953,PropMaximumPacketSize 17987,PropResponseTopic
// "\231\191\180\EM~\SYN\231\248&\228\173u'\186\217\200\239\210\209\154=8\RS\211\239?\212\202",PropAuthenticationMethod
// "\176\ETB\\z1\b\139\177{l\DC1\171T\154C\203&\201\242\142\201\151F\182##",PropContentType
// "\171(\154\&0\185i\161\209s\182\GS",PropMaximumQoS 189,PropWillDelayInterval 15657,PropMaximumQoS
// 121,PropReceiveMaximum 23342,PropUserProperty "\135\183u\196Q_\250\164\vvW\210A"
// ",_\CAN@\248\181^\174\176e1",PropCorrelationData "\247\167:\230\166\157",PropRequestResponseInformation
// 132,PropServerKeepAlive 19343]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x3c, 0xce, 0x2,  0x0,  0x3,  0x5c, 0xd3, 0xd7, 0x1d, 0xaa, 0xb6, 0x2,  0x24, 0xb7, 0x28, 0xa6, 0x1a, 0x0,  0xd,
      0x15, 0x7,  0xa4, 0x24, 0x22, 0xa4, 0x1c, 0xb7, 0xdd, 0x4e, 0x85, 0x56, 0x71, 0x8,  0x0,  0x16, 0xb5, 0xac, 0x86,
      0xfc, 0xe1, 0x43, 0x88, 0x49, 0x15, 0x43, 0x8b, 0x97, 0x80, 0x46, 0x8b, 0x1b, 0x70, 0x72, 0xdb, 0x6b, 0x42, 0x1d,
      0x1a, 0x0,  0x1a, 0x78, 0x59, 0xfb, 0xc8, 0x51, 0x2a, 0xe6, 0xde, 0x3e, 0xba, 0x58, 0x3a, 0xbc, 0xd9, 0xa1, 0x66,
      0x35, 0x23, 0xba, 0xba, 0xf9, 0x13, 0x8e, 0x89, 0x79, 0x15, 0x19, 0xb4, 0x29, 0x66, 0x18, 0x0,  0x0,  0x49, 0xb3,
      0x2,  0x0,  0x0,  0x25, 0x80, 0x3,  0x0,  0x19, 0x35, 0x47, 0x8b, 0x1a, 0xf,  0x25, 0xf6, 0x4b, 0x2b, 0xa6, 0xb5,
      0x1a, 0x3e, 0xc2, 0x1,  0x53, 0x47, 0xcf, 0x2c, 0x58, 0xba, 0x6c, 0x12, 0xa4, 0x52, 0x18, 0x0,  0x0,  0x2b, 0xce,
      0x8,  0x0,  0x1e, 0x38, 0xe1, 0xce, 0x38, 0xce, 0x50, 0x86, 0x6c, 0x4b, 0x99, 0x8f, 0x3e, 0x9c, 0x16, 0xd0, 0x5d,
      0x31, 0xb9, 0xe,  0x4d, 0x9,  0xc3, 0x72, 0xdb, 0x32, 0x9f, 0x1f, 0xce, 0x1d, 0x5e, 0x2,  0x0,  0x0,  0x5e, 0x35,
      0x15, 0x0,  0x6,  0x12, 0x4a, 0xfb, 0xe0, 0x70, 0x15, 0x23, 0x56, 0x18, 0x18, 0x0,  0x0,  0x17, 0x41, 0x27, 0x0,
      0x0,  0x46, 0x43, 0x8,  0x0,  0x1c, 0xe7, 0xbf, 0xb4, 0x19, 0x7e, 0x16, 0xe7, 0xf8, 0x26, 0xe4, 0xad, 0x75, 0x27,
      0xba, 0xd9, 0xc8, 0xef, 0xd2, 0xd1, 0x9a, 0x3d, 0x38, 0x1e, 0xd3, 0xef, 0x3f, 0xd4, 0xca, 0x15, 0x0,  0x1a, 0xb0,
      0x17, 0x5c, 0x7a, 0x31, 0x8,  0x8b, 0xb1, 0x7b, 0x6c, 0x11, 0xab, 0x54, 0x9a, 0x43, 0xcb, 0x26, 0xc9, 0xf2, 0x8e,
      0xc9, 0x97, 0x46, 0xb6, 0x23, 0x23, 0x3,  0x0,  0xb,  0xab, 0x28, 0x9a, 0x30, 0xb9, 0x69, 0xa1, 0xd1, 0x73, 0xb6,
      0x1d, 0x24, 0xbd, 0x18, 0x0,  0x0,  0x3d, 0x29, 0x24, 0x79, 0x21, 0x5b, 0x2e, 0x26, 0x0,  0xd,  0x87, 0xb7, 0x75,
      0xc4, 0x51, 0x5f, 0xfa, 0xa4, 0xb,  0x76, 0x57, 0xd2, 0x41, 0x0,  0xb,  0x2c, 0x5f, 0x18, 0x40, 0xf8, 0xb5, 0x5e,
      0xae, 0xb0, 0x65, 0x31, 0x9,  0x0,  0x6,  0xf7, 0xa7, 0x3a, 0xe6, 0xa6, 0x9d, 0x19, 0x84, 0x13, 0x4b, 0x8f, 0x8b,
      0x96, 0x89, 0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  uint8_t topic_bytes[] = {0x5c, 0xd3, 0xd7};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8b, 0x96, 0x89, 0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x15, 0x7, 0xa4, 0x24, 0x22, 0xa4, 0x1c, 0xb7, 0xdd, 0x4e, 0x85, 0x56, 0x71};
  uint8_t bytesprops1[] = {0xb5, 0xac, 0x86, 0xfc, 0xe1, 0x43, 0x88, 0x49, 0x15, 0x43, 0x8b,
                           0x97, 0x80, 0x46, 0x8b, 0x1b, 0x70, 0x72, 0xdb, 0x6b, 0x42, 0x1d};
  uint8_t bytesprops2[] = {0x78, 0x59, 0xfb, 0xc8, 0x51, 0x2a, 0xe6, 0xde, 0x3e, 0xba, 0x58, 0x3a, 0xbc,
                           0xd9, 0xa1, 0x66, 0x35, 0x23, 0xba, 0xba, 0xf9, 0x13, 0x8e, 0x89, 0x79, 0x15};
  uint8_t bytesprops3[] = {0x35, 0x47, 0x8b, 0x1a, 0xf,  0x25, 0xf6, 0x4b, 0x2b, 0xa6, 0xb5, 0x1a, 0x3e,
                           0xc2, 0x1,  0x53, 0x47, 0xcf, 0x2c, 0x58, 0xba, 0x6c, 0x12, 0xa4, 0x52};
  uint8_t bytesprops4[] = {0x38, 0xe1, 0xce, 0x38, 0xce, 0x50, 0x86, 0x6c, 0x4b, 0x99, 0x8f, 0x3e, 0x9c, 0x16, 0xd0,
                           0x5d, 0x31, 0xb9, 0xe,  0x4d, 0x9,  0xc3, 0x72, 0xdb, 0x32, 0x9f, 0x1f, 0xce, 0x1d, 0x5e};
  uint8_t bytesprops5[] = {0x12, 0x4a, 0xfb, 0xe0, 0x70, 0x15};
  uint8_t bytesprops6[] = {0xe7, 0xbf, 0xb4, 0x19, 0x7e, 0x16, 0xe7, 0xf8, 0x26, 0xe4, 0xad, 0x75, 0x27, 0xba,
                           0xd9, 0xc8, 0xef, 0xd2, 0xd1, 0x9a, 0x3d, 0x38, 0x1e, 0xd3, 0xef, 0x3f, 0xd4, 0xca};
  uint8_t bytesprops7[] = {0xb0, 0x17, 0x5c, 0x7a, 0x31, 0x8,  0x8b, 0xb1, 0x7b, 0x6c, 0x11, 0xab, 0x54,
                           0x9a, 0x43, 0xcb, 0x26, 0xc9, 0xf2, 0x8e, 0xc9, 0x97, 0x46, 0xb6, 0x23, 0x23};
  uint8_t bytesprops8[] = {0xab, 0x28, 0x9a, 0x30, 0xb9, 0x69, 0xa1, 0xd1, 0x73, 0xb6, 0x1d};
  uint8_t bytesprops10[] = {0x2c, 0x5f, 0x18, 0x40, 0xf8, 0xb5, 0x5e, 0xae, 0xb0, 0x65, 0x31};
  uint8_t bytesprops9[] = {0x87, 0xb7, 0x75, 0xc4, 0x51, 0x5f, 0xfa, 0xa4, 0xb, 0x76, 0x57, 0xd2, 0x41};
  uint8_t bytesprops11[] = {0xf7, 0xa7, 0x3a, 0xe6, 0xa6, 0x9d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18867}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9600}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11214}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24117}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22040}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5953}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17987}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15657}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23342}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops9}, .v = {11, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19343}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 7594, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\\\211\215", _pubPktID = 7594,
// _pubBody = "\139\150\137\180\142\209{^\232\155\136\252\140\233\138", _pubProps = [PropMaximumQoS
// 183,PropWildcardSubscriptionAvailable 166,PropResponseInformation
// "\NAK\a\164$\"\164\FS\183\221N\133Vq",PropResponseTopic
// "\181\172\134\252\225C\136I\NAKC\139\151\128F\139\ESCpr\219kB\GS",PropResponseInformation
// "xY\251\200Q*\230\222>\186X:\188\217\161f5#\186\186\249\DC3\142\137y\NAK",PropRequestResponseInformation
// 180,PropSubscriptionIdentifierAvailable 102,PropWillDelayInterval 18867,PropMessageExpiryInterval
// 9600,PropContentType "5G\139\SUB\SI%\246K+\166\181\SUB>\194\SOHSG\207,X\186l\DC2\164R",PropWillDelayInterval
// 11214,PropResponseTopic
// "8\225\206\&8\206P\134lK\153\143>\156\SYN\208]1\185\SOM\t\195r\219\&2\159\US\206\GS^",PropMessageExpiryInterval
// 24117,PropAuthenticationMethod "\DC2J\251\224p\NAK",PropTopicAlias 22040,PropWillDelayInterval
// 5953,PropMaximumPacketSize 17987,PropResponseTopic
// "\231\191\180\EM~\SYN\231\248&\228\173u'\186\217\200\239\210\209\154=8\RS\211\239?\212\202",PropAuthenticationMethod
// "\176\ETB\\z1\b\139\177{l\DC1\171T\154C\203&\201\242\142\201\151F\182##",PropContentType
// "\171(\154\&0\185i\161\209s\182\GS",PropMaximumQoS 189,PropWillDelayInterval 15657,PropMaximumQoS
// 121,PropReceiveMaximum 23342,PropUserProperty "\135\183u\196Q_\250\164\vvW\210A"
// ",_\CAN@\248\181^\174\176e1",PropCorrelationData "\247\167:\230\166\157",PropRequestResponseInformation
// 132,PropServerKeepAlive 19343]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {
      0x3c, 0xce, 0x2,  0x0,  0x3,  0x5c, 0xd3, 0xd7, 0x1d, 0xaa, 0xb6, 0x2,  0x24, 0xb7, 0x28, 0xa6, 0x1a, 0x0,  0xd,
      0x15, 0x7,  0xa4, 0x24, 0x22, 0xa4, 0x1c, 0xb7, 0xdd, 0x4e, 0x85, 0x56, 0x71, 0x8,  0x0,  0x16, 0xb5, 0xac, 0x86,
      0xfc, 0xe1, 0x43, 0x88, 0x49, 0x15, 0x43, 0x8b, 0x97, 0x80, 0x46, 0x8b, 0x1b, 0x70, 0x72, 0xdb, 0x6b, 0x42, 0x1d,
      0x1a, 0x0,  0x1a, 0x78, 0x59, 0xfb, 0xc8, 0x51, 0x2a, 0xe6, 0xde, 0x3e, 0xba, 0x58, 0x3a, 0xbc, 0xd9, 0xa1, 0x66,
      0x35, 0x23, 0xba, 0xba, 0xf9, 0x13, 0x8e, 0x89, 0x79, 0x15, 0x19, 0xb4, 0x29, 0x66, 0x18, 0x0,  0x0,  0x49, 0xb3,
      0x2,  0x0,  0x0,  0x25, 0x80, 0x3,  0x0,  0x19, 0x35, 0x47, 0x8b, 0x1a, 0xf,  0x25, 0xf6, 0x4b, 0x2b, 0xa6, 0xb5,
      0x1a, 0x3e, 0xc2, 0x1,  0x53, 0x47, 0xcf, 0x2c, 0x58, 0xba, 0x6c, 0x12, 0xa4, 0x52, 0x18, 0x0,  0x0,  0x2b, 0xce,
      0x8,  0x0,  0x1e, 0x38, 0xe1, 0xce, 0x38, 0xce, 0x50, 0x86, 0x6c, 0x4b, 0x99, 0x8f, 0x3e, 0x9c, 0x16, 0xd0, 0x5d,
      0x31, 0xb9, 0xe,  0x4d, 0x9,  0xc3, 0x72, 0xdb, 0x32, 0x9f, 0x1f, 0xce, 0x1d, 0x5e, 0x2,  0x0,  0x0,  0x5e, 0x35,
      0x15, 0x0,  0x6,  0x12, 0x4a, 0xfb, 0xe0, 0x70, 0x15, 0x23, 0x56, 0x18, 0x18, 0x0,  0x0,  0x17, 0x41, 0x27, 0x0,
      0x0,  0x46, 0x43, 0x8,  0x0,  0x1c, 0xe7, 0xbf, 0xb4, 0x19, 0x7e, 0x16, 0xe7, 0xf8, 0x26, 0xe4, 0xad, 0x75, 0x27,
      0xba, 0xd9, 0xc8, 0xef, 0xd2, 0xd1, 0x9a, 0x3d, 0x38, 0x1e, 0xd3, 0xef, 0x3f, 0xd4, 0xca, 0x15, 0x0,  0x1a, 0xb0,
      0x17, 0x5c, 0x7a, 0x31, 0x8,  0x8b, 0xb1, 0x7b, 0x6c, 0x11, 0xab, 0x54, 0x9a, 0x43, 0xcb, 0x26, 0xc9, 0xf2, 0x8e,
      0xc9, 0x97, 0x46, 0xb6, 0x23, 0x23, 0x3,  0x0,  0xb,  0xab, 0x28, 0x9a, 0x30, 0xb9, 0x69, 0xa1, 0xd1, 0x73, 0xb6,
      0x1d, 0x24, 0xbd, 0x18, 0x0,  0x0,  0x3d, 0x29, 0x24, 0x79, 0x21, 0x5b, 0x2e, 0x26, 0x0,  0xd,  0x87, 0xb7, 0x75,
      0xc4, 0x51, 0x5f, 0xfa, 0xa4, 0xb,  0x76, 0x57, 0xd2, 0x41, 0x0,  0xb,  0x2c, 0x5f, 0x18, 0x40, 0xf8, 0xb5, 0x5e,
      0xae, 0xb0, 0x65, 0x31, 0x9,  0x0,  0x6,  0xf7, 0xa7, 0x3a, 0xe6, 0xa6, 0x9d, 0x19, 0x84, 0x13, 0x4b, 0x8f, 0x8b,
      0x96, 0x89, 0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5c, 0xd3, 0xd7};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8b, 0x96, 0x89, 0xb4, 0x8e, 0xd1, 0x7b, 0x5e, 0xe8, 0x9b, 0x88, 0xfc, 0x8c, 0xe9, 0x8a};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7594);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "e9\242\201W\247\177\219AK\182\169",
// _pubPktID = 7929, _pubBody = "T\v\FS.x%\218\n\245\225\147\232\145qH\197\203m~\212\&0pk}\161\236\244$\162", _pubProps
// = [PropTopicAliasMaximum 15774,PropCorrelationData "\SUBJV>\197X\v\196^(\197_\145M",PropRequestResponseInformation
// 244,PropMaximumQoS 66,PropWildcardSubscriptionAvailable 152,PropSessionExpiryInterval 15397,PropWillDelayInterval
// 765,PropResponseInformation
// "\SOH\255\DC4~PD{\209\153\229\224E\145s\216\156\199\162\182\171'\217`",PropWillDelayInterval
// 29588,PropAuthenticationData "[:\214\211\229\151\215",PropSubscriptionIdentifier 7,PropMaximumPacketSize
// 10099,PropMaximumQoS 105,PropServerKeepAlive 32351,PropUserProperty "\DC2\165" "\SUB;\228",PropMessageExpiryInterval
// 32078,PropUserProperty
// "\177u\217\166\246\144\225\128\137\217\182\219d\224\142\175\DC2;vI\213R\ACK\168\189\167\132\146-"
// "\179\NUL7\237\&7\151e:\188@\229\&7\DC4M#\r\187~\131\230v\182\244",PropTopicAliasMaximum
// 29830,PropAuthenticationMethod
// "}\188\US\189\196\165?\196/m\224\DC1\163`\186\165\US\222$",PropSharedSubscriptionAvailable 224]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x34, 0xeb, 0x1,  0x0,  0xc,  0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9, 0x1e, 0xf9,
      0xbc, 0x1,  0x22, 0x3d, 0x9e, 0x9,  0x0,  0xe,  0x1a, 0x4a, 0x56, 0x3e, 0xc5, 0x58, 0xb,  0xc4, 0x5e, 0x28, 0xc5,
      0x5f, 0x91, 0x4d, 0x19, 0xf4, 0x24, 0x42, 0x28, 0x98, 0x11, 0x0,  0x0,  0x3c, 0x25, 0x18, 0x0,  0x0,  0x2,  0xfd,
      0x1a, 0x0,  0x17, 0x1,  0xff, 0x14, 0x7e, 0x50, 0x44, 0x7b, 0xd1, 0x99, 0xe5, 0xe0, 0x45, 0x91, 0x73, 0xd8, 0x9c,
      0xc7, 0xa2, 0xb6, 0xab, 0x27, 0xd9, 0x60, 0x18, 0x0,  0x0,  0x73, 0x94, 0x16, 0x0,  0x7,  0x5b, 0x3a, 0xd6, 0xd3,
      0xe5, 0x97, 0xd7, 0xb,  0x7,  0x27, 0x0,  0x0,  0x27, 0x73, 0x24, 0x69, 0x13, 0x7e, 0x5f, 0x26, 0x0,  0x2,  0x12,
      0xa5, 0x0,  0x3,  0x1a, 0x3b, 0xe4, 0x2,  0x0,  0x0,  0x7d, 0x4e, 0x26, 0x0,  0x1d, 0xb1, 0x75, 0xd9, 0xa6, 0xf6,
      0x90, 0xe1, 0x80, 0x89, 0xd9, 0xb6, 0xdb, 0x64, 0xe0, 0x8e, 0xaf, 0x12, 0x3b, 0x76, 0x49, 0xd5, 0x52, 0x6,  0xa8,
      0xbd, 0xa7, 0x84, 0x92, 0x2d, 0x0,  0x17, 0xb3, 0x0,  0x37, 0xed, 0x37, 0x97, 0x65, 0x3a, 0xbc, 0x40, 0xe5, 0x37,
      0x14, 0x4d, 0x23, 0xd,  0xbb, 0x7e, 0x83, 0xe6, 0x76, 0xb6, 0xf4, 0x22, 0x74, 0x86, 0x15, 0x0,  0x13, 0x7d, 0xbc,
      0x1f, 0xbd, 0xc4, 0xa5, 0x3f, 0xc4, 0x2f, 0x6d, 0xe0, 0x11, 0xa3, 0x60, 0xba, 0xa5, 0x1f, 0xde, 0x24, 0x2a, 0xe0,
      0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71, 0x48, 0xc5, 0xcb, 0x6d, 0x7e,
      0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  uint8_t topic_bytes[] = {0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71, 0x48,
                         0xc5, 0xcb, 0x6d, 0x7e, 0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0x1a, 0x4a, 0x56, 0x3e, 0xc5, 0x58, 0xb, 0xc4, 0x5e, 0x28, 0xc5, 0x5f, 0x91, 0x4d};
  uint8_t bytesprops1[] = {0x1,  0xff, 0x14, 0x7e, 0x50, 0x44, 0x7b, 0xd1, 0x99, 0xe5, 0xe0, 0x45,
                           0x91, 0x73, 0xd8, 0x9c, 0xc7, 0xa2, 0xb6, 0xab, 0x27, 0xd9, 0x60};
  uint8_t bytesprops2[] = {0x5b, 0x3a, 0xd6, 0xd3, 0xe5, 0x97, 0xd7};
  uint8_t bytesprops4[] = {0x1a, 0x3b, 0xe4};
  uint8_t bytesprops3[] = {0x12, 0xa5};
  uint8_t bytesprops6[] = {0xb3, 0x0,  0x37, 0xed, 0x37, 0x97, 0x65, 0x3a, 0xbc, 0x40, 0xe5, 0x37,
                           0x14, 0x4d, 0x23, 0xd,  0xbb, 0x7e, 0x83, 0xe6, 0x76, 0xb6, 0xf4};
  uint8_t bytesprops5[] = {0xb1, 0x75, 0xd9, 0xa6, 0xf6, 0x90, 0xe1, 0x80, 0x89, 0xd9, 0xb6, 0xdb, 0x64, 0xe0, 0x8e,
                           0xaf, 0x12, 0x3b, 0x76, 0x49, 0xd5, 0x52, 0x6,  0xa8, 0xbd, 0xa7, 0x84, 0x92, 0x2d};
  uint8_t bytesprops7[] = {0x7d, 0xbc, 0x1f, 0xbd, 0xc4, 0xa5, 0x3f, 0xc4, 0x2f, 0x6d,
                           0xe0, 0x11, 0xa3, 0x60, 0xba, 0xa5, 0x1f, 0xde, 0x24};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15774}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15397}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 765}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29588}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10099}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32351}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops3}, .v = {3, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32078}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops5}, .v = {23, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29830}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 224}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 7929, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "e9\242\201W\247\177\219AK\182\169",
// _pubPktID = 7929, _pubBody = "T\v\FS.x%\218\n\245\225\147\232\145qH\197\203m~\212\&0pk}\161\236\244$\162", _pubProps
// = [PropTopicAliasMaximum 15774,PropCorrelationData "\SUBJV>\197X\v\196^(\197_\145M",PropRequestResponseInformation
// 244,PropMaximumQoS 66,PropWildcardSubscriptionAvailable 152,PropSessionExpiryInterval 15397,PropWillDelayInterval
// 765,PropResponseInformation
// "\SOH\255\DC4~PD{\209\153\229\224E\145s\216\156\199\162\182\171'\217`",PropWillDelayInterval
// 29588,PropAuthenticationData "[:\214\211\229\151\215",PropSubscriptionIdentifier 7,PropMaximumPacketSize
// 10099,PropMaximumQoS 105,PropServerKeepAlive 32351,PropUserProperty "\DC2\165" "\SUB;\228",PropMessageExpiryInterval
// 32078,PropUserProperty
// "\177u\217\166\246\144\225\128\137\217\182\219d\224\142\175\DC2;vI\213R\ACK\168\189\167\132\146-"
// "\179\NUL7\237\&7\151e:\188@\229\&7\DC4M#\r\187~\131\230v\182\244",PropTopicAliasMaximum
// 29830,PropAuthenticationMethod
// "}\188\US\189\196\165?\196/m\224\DC1\163`\186\165\US\222$",PropSharedSubscriptionAvailable 224]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {
      0x34, 0xeb, 0x1,  0x0,  0xc,  0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9, 0x1e, 0xf9,
      0xbc, 0x1,  0x22, 0x3d, 0x9e, 0x9,  0x0,  0xe,  0x1a, 0x4a, 0x56, 0x3e, 0xc5, 0x58, 0xb,  0xc4, 0x5e, 0x28, 0xc5,
      0x5f, 0x91, 0x4d, 0x19, 0xf4, 0x24, 0x42, 0x28, 0x98, 0x11, 0x0,  0x0,  0x3c, 0x25, 0x18, 0x0,  0x0,  0x2,  0xfd,
      0x1a, 0x0,  0x17, 0x1,  0xff, 0x14, 0x7e, 0x50, 0x44, 0x7b, 0xd1, 0x99, 0xe5, 0xe0, 0x45, 0x91, 0x73, 0xd8, 0x9c,
      0xc7, 0xa2, 0xb6, 0xab, 0x27, 0xd9, 0x60, 0x18, 0x0,  0x0,  0x73, 0x94, 0x16, 0x0,  0x7,  0x5b, 0x3a, 0xd6, 0xd3,
      0xe5, 0x97, 0xd7, 0xb,  0x7,  0x27, 0x0,  0x0,  0x27, 0x73, 0x24, 0x69, 0x13, 0x7e, 0x5f, 0x26, 0x0,  0x2,  0x12,
      0xa5, 0x0,  0x3,  0x1a, 0x3b, 0xe4, 0x2,  0x0,  0x0,  0x7d, 0x4e, 0x26, 0x0,  0x1d, 0xb1, 0x75, 0xd9, 0xa6, 0xf6,
      0x90, 0xe1, 0x80, 0x89, 0xd9, 0xb6, 0xdb, 0x64, 0xe0, 0x8e, 0xaf, 0x12, 0x3b, 0x76, 0x49, 0xd5, 0x52, 0x6,  0xa8,
      0xbd, 0xa7, 0x84, 0x92, 0x2d, 0x0,  0x17, 0xb3, 0x0,  0x37, 0xed, 0x37, 0x97, 0x65, 0x3a, 0xbc, 0x40, 0xe5, 0x37,
      0x14, 0x4d, 0x23, 0xd,  0xbb, 0x7e, 0x83, 0xe6, 0x76, 0xb6, 0xf4, 0x22, 0x74, 0x86, 0x15, 0x0,  0x13, 0x7d, 0xbc,
      0x1f, 0xbd, 0xc4, 0xa5, 0x3f, 0xc4, 0x2f, 0x6d, 0xe0, 0x11, 0xa3, 0x60, 0xba, 0xa5, 0x1f, 0xde, 0x24, 0x2a, 0xe0,
      0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71, 0x48, 0xc5, 0xcb, 0x6d, 0x7e,
      0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x65, 0x39, 0xf2, 0xc9, 0x57, 0xf7, 0xb1, 0xdb, 0x41, 0x4b, 0xb6, 0xa9};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x54, 0xb,  0x1c, 0x2e, 0x78, 0x25, 0xda, 0xa,  0xf5, 0xe1, 0x93, 0xe8, 0x91, 0x71, 0x48,
                              0xc5, 0xcb, 0x6d, 0x7e, 0xd4, 0x30, 0x70, 0x6b, 0x7d, 0xa1, 0xec, 0xf4, 0x24, 0xa2};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7929);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\235\160n\156\199\DC14\f\233\197\243\207\145\204|J/\129\156\&5$&Z", _pubPktID = 0, _pubBody =
// "\143\195\191\225_\213\191E\230c\156\216\152\CAN\208\204-", _pubProps = [PropResponseTopic
// "\138zf\158h\178|\233}.\244\SO\DLE\137\211\206\134;y\223g\211\250\\\211\181\RSr\223Z",PropRequestResponseInformation
// 253,PropMaximumQoS 194,PropReceiveMaximum 22488,PropMaximumQoS 223]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {0x39, 0x55, 0x0,  0x17, 0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3,
                   0xcf, 0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a, 0x2a, 0x8,  0x0,
                   0x1e, 0x8a, 0x7a, 0x66, 0x9e, 0x68, 0xb2, 0x7c, 0xe9, 0x7d, 0x2e, 0xf4, 0xe,  0x10, 0x89,
                   0xd3, 0xce, 0x86, 0x3b, 0x79, 0xdf, 0x67, 0xd3, 0xfa, 0x5c, 0xd3, 0xb5, 0x1e, 0x72, 0xdf,
                   0x5a, 0x19, 0xfd, 0x24, 0xc2, 0x21, 0x57, 0xd8, 0x24, 0xdf, 0x8f, 0xc3, 0xbf, 0xe1, 0x5f,
                   0xd5, 0xbf, 0x45, 0xe6, 0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  uint8_t topic_bytes[] = {0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3, 0xcf,
                           0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8f, 0xc3, 0xbf, 0xe1, 0x5f, 0xd5, 0xbf, 0x45, 0xe6,
                         0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0x8a, 0x7a, 0x66, 0x9e, 0x68, 0xb2, 0x7c, 0xe9, 0x7d, 0x2e, 0xf4, 0xe,  0x10, 0x89, 0xd3,
                           0xce, 0x86, 0x3b, 0x79, 0xdf, 0x67, 0xd3, 0xfa, 0x5c, 0xd3, 0xb5, 0x1e, 0x72, 0xdf, 0x5a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22488}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 223}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\235\160n\156\199\DC14\f\233\197\243\207\145\204|J/\129\156\&5$&Z", _pubPktID = 0, _pubBody =
// "\143\195\191\225_\213\191E\230c\156\216\152\CAN\208\204-", _pubProps = [PropResponseTopic
// "\138zf\158h\178|\233}.\244\SO\DLE\137\211\206\134;y\223g\211\250\\\211\181\RSr\223Z",PropRequestResponseInformation
// 253,PropMaximumQoS 194,PropReceiveMaximum 22488,PropMaximumQoS 223]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {0x39, 0x55, 0x0,  0x17, 0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3,
                   0xcf, 0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a, 0x2a, 0x8,  0x0,
                   0x1e, 0x8a, 0x7a, 0x66, 0x9e, 0x68, 0xb2, 0x7c, 0xe9, 0x7d, 0x2e, 0xf4, 0xe,  0x10, 0x89,
                   0xd3, 0xce, 0x86, 0x3b, 0x79, 0xdf, 0x67, 0xd3, 0xfa, 0x5c, 0xd3, 0xb5, 0x1e, 0x72, 0xdf,
                   0x5a, 0x19, 0xfd, 0x24, 0xc2, 0x21, 0x57, 0xd8, 0x24, 0xdf, 0x8f, 0xc3, 0xbf, 0xe1, 0x5f,
                   0xd5, 0xbf, 0x45, 0xe6, 0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xeb, 0xa0, 0x6e, 0x9c, 0xc7, 0x11, 0x34, 0xc,  0xe9, 0xc5, 0xf3, 0xcf,
                               0x91, 0xcc, 0x7c, 0x4a, 0x2f, 0x81, 0x9c, 0x35, 0x24, 0x26, 0x5a};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8f, 0xc3, 0xbf, 0xe1, 0x5f, 0xd5, 0xbf, 0x45, 0xe6,
                              0x63, 0x9c, 0xd8, 0x98, 0x18, 0xd0, 0xcc, 0x2d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\182~R\STX\198L\RS%^\137\162\228\&70", _pubPktID = 1453, _pubBody = "\188=\n\155\249", _pubProps =
// [PropMessageExpiryInterval 873,PropContentType "\223c\216uv$\144\223\ETXy",PropServerKeepAlive
// 8157,PropMaximumPacketSize 15512,PropRequestProblemInformation 78,PropServerReference
// "\169\&6\179\ACK\162;\179L?\164'\168\132\160\&9",PropMessageExpiryInterval 7902,PropAuthenticationData
// "}\206\145\216\182\173\&0B\ETXTC\207f3\136m",PropMessageExpiryInterval 27667,PropAuthenticationMethod
// "\239i$\175_\149;",PropRequestResponseInformation 21,PropSubscriptionIdentifierAvailable 5,PropUserProperty
// "\SI\vuX#66\184\165\147f\230I" "\132\164\151\233\200A A>Y\150\&4\145G\NAK\GS'2\136",PropWildcardSubscriptionAvailable
// 90,PropContentType "\189\227\153\SO\199\185\173V\ETB*.\224\168\142\n\191\166s\ACK\b"]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {0x3d, 0xb0, 0x1,  0x0,  0xe,  0xb6, 0x7e, 0x52, 0x2,  0xc6, 0x4c, 0x1e, 0x25, 0x5e, 0x89, 0xa2, 0xe4,
                   0x37, 0x30, 0x5,  0xad, 0x97, 0x1,  0x2,  0x0,  0x0,  0x3,  0x69, 0x3,  0x0,  0xa,  0xdf, 0x63, 0xd8,
                   0x75, 0x76, 0x24, 0x90, 0xdf, 0x3,  0x79, 0x13, 0x1f, 0xdd, 0x27, 0x0,  0x0,  0x3c, 0x98, 0x17, 0x4e,
                   0x1c, 0x0,  0xf,  0xa9, 0x36, 0xb3, 0x6,  0xa2, 0x3b, 0xb3, 0x4c, 0x3f, 0xa4, 0x27, 0xa8, 0x84, 0xa0,
                   0x39, 0x2,  0x0,  0x0,  0x1e, 0xde, 0x16, 0x0,  0x10, 0x7d, 0xce, 0x91, 0xd8, 0xb6, 0xad, 0x30, 0x42,
                   0x3,  0x54, 0x43, 0xcf, 0x66, 0x33, 0x88, 0x6d, 0x2,  0x0,  0x0,  0x6c, 0x13, 0x15, 0x0,  0x7,  0xef,
                   0x69, 0x24, 0xaf, 0x5f, 0x95, 0x3b, 0x19, 0x15, 0x29, 0x5,  0x26, 0x0,  0xd,  0xf,  0xb,  0x75, 0x58,
                   0x23, 0x36, 0x36, 0xb8, 0xa5, 0x93, 0x66, 0xe6, 0x49, 0x0,  0x13, 0x84, 0xa4, 0x97, 0xe9, 0xc8, 0x41,
                   0x20, 0x41, 0x3e, 0x59, 0x96, 0x34, 0x91, 0x47, 0x15, 0x1d, 0x27, 0x32, 0x88, 0x28, 0x5a, 0x3,  0x0,
                   0x14, 0xbd, 0xe3, 0x99, 0xe,  0xc7, 0xb9, 0xad, 0x56, 0x17, 0x2a, 0x2e, 0xe0, 0xa8, 0x8e, 0xa,  0xbf,
                   0xa6, 0x73, 0x6,  0x8,  0xbc, 0x3d, 0xa,  0x9b, 0xf9};
  uint8_t topic_bytes[] = {0xb6, 0x7e, 0x52, 0x2, 0xc6, 0x4c, 0x1e, 0x25, 0x5e, 0x89, 0xa2, 0xe4, 0x37, 0x30};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbc, 0x3d, 0xa, 0x9b, 0xf9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0xdf, 0x63, 0xd8, 0x75, 0x76, 0x24, 0x90, 0xdf, 0x3, 0x79};
  uint8_t bytesprops1[] = {0xa9, 0x36, 0xb3, 0x6, 0xa2, 0x3b, 0xb3, 0x4c, 0x3f, 0xa4, 0x27, 0xa8, 0x84, 0xa0, 0x39};
  uint8_t bytesprops2[] = {0x7d, 0xce, 0x91, 0xd8, 0xb6, 0xad, 0x30, 0x42,
                           0x3,  0x54, 0x43, 0xcf, 0x66, 0x33, 0x88, 0x6d};
  uint8_t bytesprops3[] = {0xef, 0x69, 0x24, 0xaf, 0x5f, 0x95, 0x3b};
  uint8_t bytesprops5[] = {0x84, 0xa4, 0x97, 0xe9, 0xc8, 0x41, 0x20, 0x41, 0x3e, 0x59,
                           0x96, 0x34, 0x91, 0x47, 0x15, 0x1d, 0x27, 0x32, 0x88};
  uint8_t bytesprops4[] = {0xf, 0xb, 0x75, 0x58, 0x23, 0x36, 0x36, 0xb8, 0xa5, 0x93, 0x66, 0xe6, 0x49};
  uint8_t bytesprops6[] = {0xbd, 0xe3, 0x99, 0xe,  0xc7, 0xb9, 0xad, 0x56, 0x17, 0x2a,
                           0x2e, 0xe0, 0xa8, 0x8e, 0xa,  0xbf, 0xa6, 0x73, 0x6,  0x8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 873}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8157}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15512}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7902}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27667}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops4}, .v = {19, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 1453, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\182~R\STX\198L\RS%^\137\162\228\&70", _pubPktID = 1453, _pubBody = "\188=\n\155\249", _pubProps =
// [PropMessageExpiryInterval 873,PropContentType "\223c\216uv$\144\223\ETXy",PropServerKeepAlive
// 8157,PropMaximumPacketSize 15512,PropRequestProblemInformation 78,PropServerReference
// "\169\&6\179\ACK\162;\179L?\164'\168\132\160\&9",PropMessageExpiryInterval 7902,PropAuthenticationData
// "}\206\145\216\182\173\&0B\ETXTC\207f3\136m",PropMessageExpiryInterval 27667,PropAuthenticationMethod
// "\239i$\175_\149;",PropRequestResponseInformation 21,PropSubscriptionIdentifierAvailable 5,PropUserProperty
// "\SI\vuX#66\184\165\147f\230I" "\132\164\151\233\200A A>Y\150\&4\145G\NAK\GS'2\136",PropWildcardSubscriptionAvailable
// 90,PropContentType "\189\227\153\SO\199\185\173V\ETB*.\224\168\142\n\191\166s\ACK\b"]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {0x3d, 0xb0, 0x1,  0x0,  0xe,  0xb6, 0x7e, 0x52, 0x2,  0xc6, 0x4c, 0x1e, 0x25, 0x5e, 0x89, 0xa2, 0xe4,
                   0x37, 0x30, 0x5,  0xad, 0x97, 0x1,  0x2,  0x0,  0x0,  0x3,  0x69, 0x3,  0x0,  0xa,  0xdf, 0x63, 0xd8,
                   0x75, 0x76, 0x24, 0x90, 0xdf, 0x3,  0x79, 0x13, 0x1f, 0xdd, 0x27, 0x0,  0x0,  0x3c, 0x98, 0x17, 0x4e,
                   0x1c, 0x0,  0xf,  0xa9, 0x36, 0xb3, 0x6,  0xa2, 0x3b, 0xb3, 0x4c, 0x3f, 0xa4, 0x27, 0xa8, 0x84, 0xa0,
                   0x39, 0x2,  0x0,  0x0,  0x1e, 0xde, 0x16, 0x0,  0x10, 0x7d, 0xce, 0x91, 0xd8, 0xb6, 0xad, 0x30, 0x42,
                   0x3,  0x54, 0x43, 0xcf, 0x66, 0x33, 0x88, 0x6d, 0x2,  0x0,  0x0,  0x6c, 0x13, 0x15, 0x0,  0x7,  0xef,
                   0x69, 0x24, 0xaf, 0x5f, 0x95, 0x3b, 0x19, 0x15, 0x29, 0x5,  0x26, 0x0,  0xd,  0xf,  0xb,  0x75, 0x58,
                   0x23, 0x36, 0x36, 0xb8, 0xa5, 0x93, 0x66, 0xe6, 0x49, 0x0,  0x13, 0x84, 0xa4, 0x97, 0xe9, 0xc8, 0x41,
                   0x20, 0x41, 0x3e, 0x59, 0x96, 0x34, 0x91, 0x47, 0x15, 0x1d, 0x27, 0x32, 0x88, 0x28, 0x5a, 0x3,  0x0,
                   0x14, 0xbd, 0xe3, 0x99, 0xe,  0xc7, 0xb9, 0xad, 0x56, 0x17, 0x2a, 0x2e, 0xe0, 0xa8, 0x8e, 0xa,  0xbf,
                   0xa6, 0x73, 0x6,  0x8,  0xbc, 0x3d, 0xa,  0x9b, 0xf9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb6, 0x7e, 0x52, 0x2, 0xc6, 0x4c, 0x1e, 0x25, 0x5e, 0x89, 0xa2, 0xe4, 0x37, 0x30};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbc, 0x3d, 0xa, 0x9b, 0xf9};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1453);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\191k-$.\245\SUB\192\234\155$",
// _pubPktID = 29170, _pubBody = "[F\181\186O\149", _pubProps = [PropRequestProblemInformation
// 119,PropPayloadFormatIndicator 239,PropWildcardSubscriptionAvailable 115,PropMaximumPacketSize
// 25304,PropAssignedClientIdentifier "n4\239\&8m\163\225T/\181\230\189",PropReasonString
// "\145\USv\152vy\DC1\a\131\&1\207",PropUserProperty
// "^\170=\229Z\DC4\241\181G\SI\146\253\ETX\f\136`\DEL6\239\165;7\130\DEL\224\198I-\184\229"
// "ab\181\192\DLEJ[\255v}\175\SI\131R^u\238:\ETB\144\186gW\STX\EM\152",PropServerKeepAlive 20060,PropReasonString
// "\221\&4'\184\&2\SI\207\234#",PropSharedSubscriptionAvailable 134,PropSubscriptionIdentifier
// 12,PropPayloadFormatIndicator 201,PropPayloadFormatIndicator 253,PropAuthenticationData
// "`N\249qh*\SI}\177\130\198",PropMessageExpiryInterval 20002,PropRequestProblemInformation
// 106,PropAuthenticationMethod "p\178[&s<[\130\212R\198\132\243\168\DC4",PropRequestResponseInformation
// 96,PropUserProperty "\139R\205\238/\177\235}\194\EM\179"
// "M-Zq\\\247H\ETX\210\222\182\&6w\182k&|\207\230f\ETX,\152G@\134",PropMaximumQoS 111,PropWillDelayInterval
// 24311,PropWildcardSubscriptionAvailable 44,PropRequestResponseInformation 218,PropMaximumPacketSize
// 29821,PropContentType "<"]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x33, 0xfa, 0x1,  0x0,  0xb,  0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0, 0xea, 0x9b, 0x24, 0x71,
                   0xf2, 0xe3, 0x1,  0x17, 0x77, 0x1,  0xef, 0x28, 0x73, 0x27, 0x0,  0x0,  0x62, 0xd8, 0x12, 0x0,  0xc,
                   0x6e, 0x34, 0xef, 0x38, 0x6d, 0xa3, 0xe1, 0x54, 0x2f, 0xb5, 0xe6, 0xbd, 0x1f, 0x0,  0xb,  0x91, 0x1f,
                   0x76, 0x98, 0x76, 0x79, 0x11, 0x7,  0x83, 0x31, 0xcf, 0x26, 0x0,  0x1e, 0x5e, 0xaa, 0x3d, 0xe5, 0x5a,
                   0x14, 0xf1, 0xb5, 0x47, 0xf,  0x92, 0xfd, 0x3,  0xc,  0x88, 0x60, 0x7f, 0x36, 0xef, 0xa5, 0x3b, 0x37,
                   0x82, 0x7f, 0xe0, 0xc6, 0x49, 0x2d, 0xb8, 0xe5, 0x0,  0x1a, 0x61, 0x62, 0xb5, 0xc0, 0x10, 0x4a, 0x5b,
                   0xff, 0x76, 0x7d, 0xaf, 0xf,  0x83, 0x52, 0x5e, 0x75, 0xee, 0x3a, 0x17, 0x90, 0xba, 0x67, 0x57, 0x2,
                   0x19, 0x98, 0x13, 0x4e, 0x5c, 0x1f, 0x0,  0x9,  0xdd, 0x34, 0x27, 0xb8, 0x32, 0xf,  0xcf, 0xea, 0x23,
                   0x2a, 0x86, 0xb,  0xc,  0x1,  0xc9, 0x1,  0xfd, 0x16, 0x0,  0xb,  0x60, 0x4e, 0xf9, 0x71, 0x68, 0x2a,
                   0xf,  0x7d, 0xb1, 0x82, 0xc6, 0x2,  0x0,  0x0,  0x4e, 0x22, 0x17, 0x6a, 0x15, 0x0,  0xf,  0x70, 0xb2,
                   0x5b, 0x26, 0x73, 0x3c, 0x5b, 0x82, 0xd4, 0x52, 0xc6, 0x84, 0xf3, 0xa8, 0x14, 0x19, 0x60, 0x26, 0x0,
                   0xb,  0x8b, 0x52, 0xcd, 0xee, 0x2f, 0xb1, 0xeb, 0x7d, 0xc2, 0x19, 0xb3, 0x0,  0x1a, 0x4d, 0x2d, 0x5a,
                   0x71, 0x5c, 0xf7, 0x48, 0x3,  0xd2, 0xde, 0xb6, 0x36, 0x77, 0xb6, 0x6b, 0x26, 0x7c, 0xcf, 0xe6, 0x66,
                   0x3,  0x2c, 0x98, 0x47, 0x40, 0x86, 0x24, 0x6f, 0x18, 0x0,  0x0,  0x5e, 0xf7, 0x28, 0x2c, 0x19, 0xda,
                   0x27, 0x0,  0x0,  0x74, 0x7d, 0x3,  0x0,  0x1,  0x3c, 0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  uint8_t topic_bytes[] = {0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0, 0xea, 0x9b, 0x24};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytesprops0[] = {0x6e, 0x34, 0xef, 0x38, 0x6d, 0xa3, 0xe1, 0x54, 0x2f, 0xb5, 0xe6, 0xbd};
  uint8_t bytesprops1[] = {0x91, 0x1f, 0x76, 0x98, 0x76, 0x79, 0x11, 0x7, 0x83, 0x31, 0xcf};
  uint8_t bytesprops3[] = {0x61, 0x62, 0xb5, 0xc0, 0x10, 0x4a, 0x5b, 0xff, 0x76, 0x7d, 0xaf, 0xf,  0x83,
                           0x52, 0x5e, 0x75, 0xee, 0x3a, 0x17, 0x90, 0xba, 0x67, 0x57, 0x2,  0x19, 0x98};
  uint8_t bytesprops2[] = {0x5e, 0xaa, 0x3d, 0xe5, 0x5a, 0x14, 0xf1, 0xb5, 0x47, 0xf,  0x92, 0xfd, 0x3,  0xc,  0x88,
                           0x60, 0x7f, 0x36, 0xef, 0xa5, 0x3b, 0x37, 0x82, 0x7f, 0xe0, 0xc6, 0x49, 0x2d, 0xb8, 0xe5};
  uint8_t bytesprops4[] = {0xdd, 0x34, 0x27, 0xb8, 0x32, 0xf, 0xcf, 0xea, 0x23};
  uint8_t bytesprops5[] = {0x60, 0x4e, 0xf9, 0x71, 0x68, 0x2a, 0xf, 0x7d, 0xb1, 0x82, 0xc6};
  uint8_t bytesprops6[] = {0x70, 0xb2, 0x5b, 0x26, 0x73, 0x3c, 0x5b, 0x82, 0xd4, 0x52, 0xc6, 0x84, 0xf3, 0xa8, 0x14};
  uint8_t bytesprops8[] = {0x4d, 0x2d, 0x5a, 0x71, 0x5c, 0xf7, 0x48, 0x3, 0xd2, 0xde, 0xb6, 0x36, 0x77,
                           0xb6, 0x6b, 0x26, 0x7c, 0xcf, 0xe6, 0x66, 0x3, 0x2c, 0x98, 0x47, 0x40, 0x86};
  uint8_t bytesprops7[] = {0x8b, 0x52, 0xcd, 0xee, 0x2f, 0xb1, 0xeb, 0x7d, 0xc2, 0x19, 0xb3};
  uint8_t bytesprops9[] = {0x3c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25304}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops2}, .v = {26, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20060}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20002}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops7}, .v = {26, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24311}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29821}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29170, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\191k-$.\245\SUB\192\234\155$",
// _pubPktID = 29170, _pubBody = "[F\181\186O\149", _pubProps = [PropRequestProblemInformation
// 119,PropPayloadFormatIndicator 239,PropWildcardSubscriptionAvailable 115,PropMaximumPacketSize
// 25304,PropAssignedClientIdentifier "n4\239\&8m\163\225T/\181\230\189",PropReasonString
// "\145\USv\152vy\DC1\a\131\&1\207",PropUserProperty
// "^\170=\229Z\DC4\241\181G\SI\146\253\ETX\f\136`\DEL6\239\165;7\130\DEL\224\198I-\184\229"
// "ab\181\192\DLEJ[\255v}\175\SI\131R^u\238:\ETB\144\186gW\STX\EM\152",PropServerKeepAlive 20060,PropReasonString
// "\221\&4'\184\&2\SI\207\234#",PropSharedSubscriptionAvailable 134,PropSubscriptionIdentifier
// 12,PropPayloadFormatIndicator 201,PropPayloadFormatIndicator 253,PropAuthenticationData
// "`N\249qh*\SI}\177\130\198",PropMessageExpiryInterval 20002,PropRequestProblemInformation
// 106,PropAuthenticationMethod "p\178[&s<[\130\212R\198\132\243\168\DC4",PropRequestResponseInformation
// 96,PropUserProperty "\139R\205\238/\177\235}\194\EM\179"
// "M-Zq\\\247H\ETX\210\222\182\&6w\182k&|\207\230f\ETX,\152G@\134",PropMaximumQoS 111,PropWillDelayInterval
// 24311,PropWildcardSubscriptionAvailable 44,PropRequestResponseInformation 218,PropMaximumPacketSize
// 29821,PropContentType "<"]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x33, 0xfa, 0x1,  0x0,  0xb,  0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0, 0xea, 0x9b, 0x24, 0x71,
                   0xf2, 0xe3, 0x1,  0x17, 0x77, 0x1,  0xef, 0x28, 0x73, 0x27, 0x0,  0x0,  0x62, 0xd8, 0x12, 0x0,  0xc,
                   0x6e, 0x34, 0xef, 0x38, 0x6d, 0xa3, 0xe1, 0x54, 0x2f, 0xb5, 0xe6, 0xbd, 0x1f, 0x0,  0xb,  0x91, 0x1f,
                   0x76, 0x98, 0x76, 0x79, 0x11, 0x7,  0x83, 0x31, 0xcf, 0x26, 0x0,  0x1e, 0x5e, 0xaa, 0x3d, 0xe5, 0x5a,
                   0x14, 0xf1, 0xb5, 0x47, 0xf,  0x92, 0xfd, 0x3,  0xc,  0x88, 0x60, 0x7f, 0x36, 0xef, 0xa5, 0x3b, 0x37,
                   0x82, 0x7f, 0xe0, 0xc6, 0x49, 0x2d, 0xb8, 0xe5, 0x0,  0x1a, 0x61, 0x62, 0xb5, 0xc0, 0x10, 0x4a, 0x5b,
                   0xff, 0x76, 0x7d, 0xaf, 0xf,  0x83, 0x52, 0x5e, 0x75, 0xee, 0x3a, 0x17, 0x90, 0xba, 0x67, 0x57, 0x2,
                   0x19, 0x98, 0x13, 0x4e, 0x5c, 0x1f, 0x0,  0x9,  0xdd, 0x34, 0x27, 0xb8, 0x32, 0xf,  0xcf, 0xea, 0x23,
                   0x2a, 0x86, 0xb,  0xc,  0x1,  0xc9, 0x1,  0xfd, 0x16, 0x0,  0xb,  0x60, 0x4e, 0xf9, 0x71, 0x68, 0x2a,
                   0xf,  0x7d, 0xb1, 0x82, 0xc6, 0x2,  0x0,  0x0,  0x4e, 0x22, 0x17, 0x6a, 0x15, 0x0,  0xf,  0x70, 0xb2,
                   0x5b, 0x26, 0x73, 0x3c, 0x5b, 0x82, 0xd4, 0x52, 0xc6, 0x84, 0xf3, 0xa8, 0x14, 0x19, 0x60, 0x26, 0x0,
                   0xb,  0x8b, 0x52, 0xcd, 0xee, 0x2f, 0xb1, 0xeb, 0x7d, 0xc2, 0x19, 0xb3, 0x0,  0x1a, 0x4d, 0x2d, 0x5a,
                   0x71, 0x5c, 0xf7, 0x48, 0x3,  0xd2, 0xde, 0xb6, 0x36, 0x77, 0xb6, 0x6b, 0x26, 0x7c, 0xcf, 0xe6, 0x66,
                   0x3,  0x2c, 0x98, 0x47, 0x40, 0x86, 0x24, 0x6f, 0x18, 0x0,  0x0,  0x5e, 0xf7, 0x28, 0x2c, 0x19, 0xda,
                   0x27, 0x0,  0x0,  0x74, 0x7d, 0x3,  0x0,  0x1,  0x3c, 0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbf, 0x6b, 0x2d, 0x24, 0x2e, 0xf5, 0x1a, 0xc0, 0xea, 0x9b, 0x24};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5b, 0x46, 0xb5, 0xba, 0x4f, 0x95};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29170);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\STXF\139\182d\236&\232\&0\220\246\150\CAN\210\147K\245O\160W*D\145\202", _willMsg =
// "\255\138T\159\195[tN\169\244\200*\226/\ENQ\238\251\DC3", _willProps = []}), _cleanSession = True, _keepAlive =
// 23007, _connID = "\172\233\209\170i\141", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x59, 0xdf, 0x0,  0x6,  0xac, 0xe9, 0xd1,
                   0xaa, 0x69, 0x8d, 0x0,  0x18, 0x2,  0x46, 0x8b, 0xb6, 0x64, 0xec, 0x26, 0xe8, 0x30, 0xdc, 0xf6, 0x96,
                   0x18, 0xd2, 0x93, 0x4b, 0xf5, 0x4f, 0xa0, 0x57, 0x2a, 0x44, 0x91, 0xca, 0x0,  0x12, 0xff, 0x8a, 0x54,
                   0x9f, 0xc3, 0x5b, 0x74, 0x4e, 0xa9, 0xf4, 0xc8, 0x2a, 0xe2, 0x2f, 0x5,  0xee, 0xfb, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2,  0x46, 0x8b, 0xb6, 0x64, 0xec, 0x26, 0xe8, 0x30, 0xdc, 0xf6, 0x96,
                                0x18, 0xd2, 0x93, 0x4b, 0xf5, 0x4f, 0xa0, 0x57, 0x2a, 0x44, 0x91, 0xca};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xff, 0x8a, 0x54, 0x9f, 0xc3, 0x5b, 0x74, 0x4e, 0xa9,
                                  0xf4, 0xc8, 0x2a, 0xe2, 0x2f, 0x5,  0xee, 0xfb, 0x13};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23007;
  uint8_t client_id_bytes[] = {0xac, 0xe9, 0xd1, 0xaa, 0x69, 0x8d};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\162\167;\233}\166*\194\SO5I", _password = Just
// "\206\SYN\252];b\f|\249\239\199!!\ETB\142fz\153\250>bv\DC1\ETX\134", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "\DELF\240\209\&7W\203U~\ETBsd", _willMsg = "\146\191]\f|", _willProps = []}),
// _cleanSession = True, _keepAlive = 7161, _connID = "AG\180\214\&5\245\a\196\164Fq\209\141\250>\246\RS", _properties =
// []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x1b, 0xf9, 0x0,  0x11, 0x41, 0x47,
                   0xb4, 0xd6, 0x35, 0xf5, 0x7,  0xc4, 0xa4, 0x46, 0x71, 0xd1, 0x8d, 0xfa, 0x3e, 0xf6, 0x1e, 0x0,
                   0xc,  0x7f, 0x46, 0xf0, 0xd1, 0x37, 0x57, 0xcb, 0x55, 0x7e, 0x17, 0x73, 0x64, 0x0,  0x5,  0x92,
                   0xbf, 0x5d, 0xc,  0x7c, 0x0,  0xb,  0xa2, 0xa7, 0x3b, 0xe9, 0x7d, 0xa6, 0x2a, 0xc2, 0xe,  0x35,
                   0x49, 0x0,  0x19, 0xce, 0x16, 0xfc, 0x5d, 0x3b, 0x62, 0xc,  0x7c, 0xf9, 0xef, 0xc7, 0x21, 0x21,
                   0x17, 0x8e, 0x66, 0x7a, 0x99, 0xfa, 0x3e, 0x62, 0x76, 0x11, 0x3,  0x86};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7f, 0x46, 0xf0, 0xd1, 0x37, 0x57, 0xcb, 0x55, 0x7e, 0x17, 0x73, 0x64};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x92, 0xbf, 0x5d, 0xc, 0x7c};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7161;
  uint8_t client_id_bytes[] = {0x41, 0x47, 0xb4, 0xd6, 0x35, 0xf5, 0x7,  0xc4, 0xa4,
                               0x46, 0x71, 0xd1, 0x8d, 0xfa, 0x3e, 0xf6, 0x1e};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa2, 0xa7, 0x3b, 0xe9, 0x7d, 0xa6, 0x2a, 0xc2, 0xe, 0x35, 0x49};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xce, 0x16, 0xfc, 0x5d, 0x3b, 0x62, 0xc,  0x7c, 0xf9, 0xef, 0xc7, 0x21, 0x21,
                              0x17, 0x8e, 0x66, 0x7a, 0x99, 0xfa, 0x3e, 0x62, 0x76, 0x11, 0x3,  0x86};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\176gX", _password = Nothing, _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 30736, _connID = "\211\169\254\161\DLE", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x16, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4, 0x80, 0x78, 0x10,
                   0x0,  0x5,  0xd3, 0xa9, 0xfe, 0xa1, 0x10, 0x0,  0x3, 0xb0, 0x67, 0x58};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30736;
  uint8_t client_id_bytes[] = {0xd3, 0xa9, 0xfe, 0xa1, 0x10};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb0, 0x67, 0x58};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\152\194\245\253\174\&7\EMM!8\179\176,\247\240\DC1\231\RS", _password = Just
// "/\242\177\206\FS\170L\220\250@\fO\156+2\DLE\GS\141\&5\180!\168t\129\133\aA\SO\213T", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "r\EOTA\136\195\188\137\213\144A\186\189\243\169\226\204\252",
// _willMsg = "\182\NAK", _willProps = []}), _cleanSession = True, _keepAlive = 8837, _connID =
// "\229-\130\155\154a\214\248\214l\CAN\138\244\210%\168\154\156\DC1\241\133\227\&1", _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x6e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x22, 0x85, 0x0,  0x17, 0xe5, 0x2d,
                   0x82, 0x9b, 0x9a, 0x61, 0xd6, 0xf8, 0xd6, 0x6c, 0x18, 0x8a, 0xf4, 0xd2, 0x25, 0xa8, 0x9a, 0x9c,
                   0x11, 0xf1, 0x85, 0xe3, 0x31, 0x0,  0x11, 0x72, 0x4,  0x41, 0x88, 0xc3, 0xbc, 0x89, 0xd5, 0x90,
                   0x41, 0xba, 0xbd, 0xf3, 0xa9, 0xe2, 0xcc, 0xfc, 0x0,  0x2,  0xb6, 0x15, 0x0,  0x12, 0x98, 0xc2,
                   0xf5, 0xfd, 0xae, 0x37, 0x19, 0x4d, 0x21, 0x38, 0xb3, 0xb0, 0x2c, 0xf7, 0xf0, 0x11, 0xe7, 0x1e,
                   0x0,  0x1e, 0x2f, 0xf2, 0xb1, 0xce, 0x1c, 0xaa, 0x4c, 0xdc, 0xfa, 0x40, 0xc,  0x4f, 0x9c, 0x2b,
                   0x32, 0x10, 0x1d, 0x8d, 0x35, 0xb4, 0x21, 0xa8, 0x74, 0x81, 0x85, 0x7,  0x41, 0xe,  0xd5, 0x54};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x72, 0x4,  0x41, 0x88, 0xc3, 0xbc, 0x89, 0xd5, 0x90,
                                0x41, 0xba, 0xbd, 0xf3, 0xa9, 0xe2, 0xcc, 0xfc};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb6, 0x15};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8837;
  uint8_t client_id_bytes[] = {0xe5, 0x2d, 0x82, 0x9b, 0x9a, 0x61, 0xd6, 0xf8, 0xd6, 0x6c, 0x18, 0x8a,
                               0xf4, 0xd2, 0x25, 0xa8, 0x9a, 0x9c, 0x11, 0xf1, 0x85, 0xe3, 0x31};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x98, 0xc2, 0xf5, 0xfd, 0xae, 0x37, 0x19, 0x4d, 0x21,
                              0x38, 0xb3, 0xb0, 0x2c, 0xf7, 0xf0, 0x11, 0xe7, 0x1e};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2f, 0xf2, 0xb1, 0xce, 0x1c, 0xaa, 0x4c, 0xdc, 0xfa, 0x40, 0xc, 0x4f, 0x9c, 0x2b, 0x32,
                              0x10, 0x1d, 0x8d, 0x35, 0xb4, 0x21, 0xa8, 0x74, 0x81, 0x85, 0x7, 0x41, 0xe,  0xd5, 0x54};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Fl\165\191E\132:\161", _password = Nothing, _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS2, _willTopic = "\213\133\231\FS\130\ACKE\191\250\EM\neI\a\139\243\227\216J\222\222", _willMsg
// = "\247\199pz\189\158\163r[\131P\201w\133", _willProps = []}), _cleanSession = True, _keepAlive = 10218, _connID =
// "\242\150&X\DC2\211\232+\139", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb6, 0x27, 0xea, 0x0,  0x9,  0xf2,
                   0x96, 0x26, 0x58, 0x12, 0xd3, 0xe8, 0x2b, 0x8b, 0x0,  0x15, 0xd5, 0x85, 0xe7, 0x1c, 0x82,
                   0x6,  0x45, 0xbf, 0xfa, 0x19, 0xa,  0x65, 0x49, 0x7,  0x8b, 0xf3, 0xe3, 0xd8, 0x4a, 0xde,
                   0xde, 0x0,  0xe,  0xf7, 0xc7, 0x70, 0x7a, 0xbd, 0x9e, 0xa3, 0x72, 0x5b, 0x83, 0x50, 0xc9,
                   0x77, 0x85, 0x0,  0x8,  0x46, 0x6c, 0xa5, 0xbf, 0x45, 0x84, 0x3a, 0xa1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd5, 0x85, 0xe7, 0x1c, 0x82, 0x6,  0x45, 0xbf, 0xfa, 0x19, 0xa,
                                0x65, 0x49, 0x7,  0x8b, 0xf3, 0xe3, 0xd8, 0x4a, 0xde, 0xde};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf7, 0xc7, 0x70, 0x7a, 0xbd, 0x9e, 0xa3, 0x72, 0x5b, 0x83, 0x50, 0xc9, 0x77, 0x85};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10218;
  uint8_t client_id_bytes[] = {0xf2, 0x96, 0x26, 0x58, 0x12, 0xd3, 0xe8, 0x2b, 0x8b};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x46, 0x6c, 0xa5, 0xbf, 0x45, 0x84, 0x3a, 0xa1};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Sz8i\155\185\247\FSM\223\r`\"\187\ACK\244\ETB7(\218^\ETX~\231o+\166\\", _password =
// Just "\254", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\178\171\DC2\211\200\EM\184\SOH\SI1\182\142\236\165\201\180\217\179\236y\215\n", _willMsg =
// "\176\DC3\142\CAN5\229j\140\194\241\152", _willProps = []}), _cleanSession = True, _keepAlive = 13826, _connID =
// "eYUoE\DELM\180&\227\132\v\STX\ESC\198\183?\245\247n\197\DC1", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x68, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf6, 0x36, 0x2,  0x0,  0x16, 0x65, 0x59,
                   0x55, 0x6f, 0x45, 0x7f, 0x4d, 0xb4, 0x26, 0xe3, 0x84, 0xb,  0x2,  0x1b, 0xc6, 0xb7, 0x3f, 0xf5,
                   0xf7, 0x6e, 0xc5, 0x11, 0x0,  0x16, 0xb2, 0xab, 0x12, 0xd3, 0xc8, 0x19, 0xb8, 0x1,  0xf,  0x31,
                   0xb6, 0x8e, 0xec, 0xa5, 0xc9, 0xb4, 0xd9, 0xb3, 0xec, 0x79, 0xd7, 0xa,  0x0,  0xb,  0xb0, 0x13,
                   0x8e, 0x18, 0x35, 0xe5, 0x6a, 0x8c, 0xc2, 0xf1, 0x98, 0x0,  0x1c, 0x53, 0x7a, 0x38, 0x69, 0x9b,
                   0xb9, 0xf7, 0x1c, 0x4d, 0xdf, 0xd,  0x60, 0x22, 0xbb, 0x6,  0xf4, 0x17, 0x37, 0x28, 0xda, 0x5e,
                   0x3,  0x7e, 0xe7, 0x6f, 0x2b, 0xa6, 0x5c, 0x0,  0x1,  0xfe};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb2, 0xab, 0x12, 0xd3, 0xc8, 0x19, 0xb8, 0x1,  0xf,  0x31, 0xb6,
                                0x8e, 0xec, 0xa5, 0xc9, 0xb4, 0xd9, 0xb3, 0xec, 0x79, 0xd7, 0xa};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb0, 0x13, 0x8e, 0x18, 0x35, 0xe5, 0x6a, 0x8c, 0xc2, 0xf1, 0x98};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13826;
  uint8_t client_id_bytes[] = {0x65, 0x59, 0x55, 0x6f, 0x45, 0x7f, 0x4d, 0xb4, 0x26, 0xe3, 0x84,
                               0xb,  0x2,  0x1b, 0xc6, 0xb7, 0x3f, 0xf5, 0xf7, 0x6e, 0xc5, 0x11};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x53, 0x7a, 0x38, 0x69, 0x9b, 0xb9, 0xf7, 0x1c, 0x4d, 0xdf, 0xd,  0x60, 0x22, 0xbb,
                              0x6,  0xf4, 0x17, 0x37, 0x28, 0xda, 0x5e, 0x3,  0x7e, 0xe7, 0x6f, 0x2b, 0xa6, 0x5c};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xfe};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 28209, _connID = "\246\165\SI\142z\163\217\224;\170\DC1\145\161v\211e", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x1c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x6e, 0x31, 0x0,  0x10, 0xf6,
                   0xa5, 0xf,  0x8e, 0x7a, 0xa3, 0xd9, 0xe0, 0x3b, 0xaa, 0x11, 0x91, 0xa1, 0x76, 0xd3, 0x65};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28209;
  uint8_t client_id_bytes[] = {0xf6, 0xa5, 0xf,  0x8e, 0x7a, 0xa3, 0xd9, 0xe0,
                               0x3b, 0xaa, 0x11, 0x91, 0xa1, 0x76, 0xd3, 0x65};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\EOTj\208\234\&8&{\198\226R\a\248\140\138", _password = Just
// "]TT\227$0q<\DLE\201/\223\204\&4.\225\146v\209\240\154\SI\189O,\183\237", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\145\172\175\249\r\146", _willMsg = "\227:\v\SYNN\201\f", _willProps = []}),
// _cleanSession = False, _keepAlive = 12527, _connID = "7\EOT\224", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x4d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x30, 0xef, 0x0,  0x3,  0x37, 0x4,
                   0xe0, 0x0,  0x6,  0x91, 0xac, 0xaf, 0xf9, 0xd,  0x92, 0x0,  0x7,  0xe3, 0x3a, 0xb,  0x16, 0x4e,
                   0xc9, 0xc,  0x0,  0xe,  0x4,  0x6a, 0xd0, 0xea, 0x38, 0x26, 0x7b, 0xc6, 0xe2, 0x52, 0x7,  0xf8,
                   0x8c, 0x8a, 0x0,  0x1b, 0x5d, 0x54, 0x54, 0xe3, 0x24, 0x30, 0x71, 0x3c, 0x10, 0xc9, 0x2f, 0xdf,
                   0xcc, 0x34, 0x2e, 0xe1, 0x92, 0x76, 0xd1, 0xf0, 0x9a, 0xf,  0xbd, 0x4f, 0x2c, 0xb7, 0xed};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x91, 0xac, 0xaf, 0xf9, 0xd, 0x92};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe3, 0x3a, 0xb, 0x16, 0x4e, 0xc9, 0xc};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12527;
  uint8_t client_id_bytes[] = {0x37, 0x4, 0xe0};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4, 0x6a, 0xd0, 0xea, 0x38, 0x26, 0x7b, 0xc6, 0xe2, 0x52, 0x7, 0xf8, 0x8c, 0x8a};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5d, 0x54, 0x54, 0xe3, 0x24, 0x30, 0x71, 0x3c, 0x10, 0xc9, 0x2f, 0xdf, 0xcc, 0x34,
                              0x2e, 0xe1, 0x92, 0x76, 0xd1, 0xf0, 0x9a, 0xf,  0xbd, 0x4f, 0x2c, 0xb7, 0xed};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\205!\164q;\149|\140\239|\234\FS\EOT", _password = Just
// "BE\v*U\EM'\159\157\SYNm\DLEn\192\136\vS\"\244\NUL9\228'\195\139\EOT\197\200\194", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "H", _willMsg =
// "\225\198\150\163\208W\238\146\FS\223_\201\251%\143\NUL\243\162\225ll\147\157Z\237\208\211W)", _willProps = []}),
// _cleanSession = True, _keepAlive = 13897, _connID = "\233\129 ", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x5f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x36, 0x49, 0x0,  0x3,  0xe9, 0x81, 0x20,
                   0x0,  0x1,  0x48, 0x0,  0x1d, 0xe1, 0xc6, 0x96, 0xa3, 0xd0, 0x57, 0xee, 0x92, 0x1c, 0xdf, 0x5f, 0xc9,
                   0xfb, 0x25, 0x8f, 0x0,  0xf3, 0xa2, 0xe1, 0x6c, 0x6c, 0x93, 0x9d, 0x5a, 0xed, 0xd0, 0xd3, 0x57, 0x29,
                   0x0,  0xd,  0xcd, 0x21, 0xa4, 0x71, 0x3b, 0x95, 0x7c, 0x8c, 0xef, 0x7c, 0xea, 0x1c, 0x4,  0x0,  0x1d,
                   0x42, 0x45, 0xb,  0x2a, 0x55, 0x19, 0x27, 0x9f, 0x9d, 0x16, 0x6d, 0x10, 0x6e, 0xc0, 0x88, 0xb,  0x53,
                   0x22, 0xf4, 0x0,  0x39, 0xe4, 0x27, 0xc3, 0x8b, 0x4,  0xc5, 0xc8, 0xc2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x48};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe1, 0xc6, 0x96, 0xa3, 0xd0, 0x57, 0xee, 0x92, 0x1c, 0xdf,
                                  0x5f, 0xc9, 0xfb, 0x25, 0x8f, 0x0,  0xf3, 0xa2, 0xe1, 0x6c,
                                  0x6c, 0x93, 0x9d, 0x5a, 0xed, 0xd0, 0xd3, 0x57, 0x29};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13897;
  uint8_t client_id_bytes[] = {0xe9, 0x81, 0x20};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcd, 0x21, 0xa4, 0x71, 0x3b, 0x95, 0x7c, 0x8c, 0xef, 0x7c, 0xea, 0x1c, 0x4};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x42, 0x45, 0xb,  0x2a, 0x55, 0x19, 0x27, 0x9f, 0x9d, 0x16, 0x6d, 0x10, 0x6e, 0xc0, 0x88,
                              0xb,  0x53, 0x22, 0xf4, 0x0,  0x39, 0xe4, 0x27, 0xc3, 0x8b, 0x4,  0xc5, 0xc8, 0xc2};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "B\186\246\255t\DC3^!\193Sq\185HB\196\232\246Y>p\ACK\187k\ETBu\142", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "I;]\195\205\\\220z\EOT0:<'\ENQ\194D@1\238|", _willMsg = "`!\186\212fPy", _willProps =
// []}), _cleanSession = True, _keepAlive = 20788, _connID =
// "\155\US\157x\133\ESC,7_b\139\135\244\157<J\147+\149\DC1\233\244", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2e, 0x51, 0x34, 0x0,  0x16, 0x9b, 0x1f, 0x9d,
                   0x78, 0x85, 0x1b, 0x2c, 0x37, 0x5f, 0x62, 0x8b, 0x87, 0xf4, 0x9d, 0x3c, 0x4a, 0x93, 0x2b, 0x95, 0x11,
                   0xe9, 0xf4, 0x0,  0x14, 0x49, 0x3b, 0x5d, 0xc3, 0xcd, 0x5c, 0xdc, 0x7a, 0x4,  0x30, 0x3a, 0x3c, 0x27,
                   0x5,  0xc2, 0x44, 0x40, 0x31, 0xee, 0x7c, 0x0,  0x7,  0x60, 0x21, 0xba, 0xd4, 0x66, 0x50, 0x79};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x49, 0x3b, 0x5d, 0xc3, 0xcd, 0x5c, 0xdc, 0x7a, 0x4,  0x30,
                                0x3a, 0x3c, 0x27, 0x5,  0xc2, 0x44, 0x40, 0x31, 0xee, 0x7c};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x60, 0x21, 0xba, 0xd4, 0x66, 0x50, 0x79};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20788;
  uint8_t client_id_bytes[] = {0x9b, 0x1f, 0x9d, 0x78, 0x85, 0x1b, 0x2c, 0x37, 0x5f, 0x62, 0x8b,
                               0x87, 0xf4, 0x9d, 0x3c, 0x4a, 0x93, 0x2b, 0x95, 0x11, 0xe9, 0xf4};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x42, 0xba, 0xf6, 0xff, 0x74, 0x13, 0x5e, 0x21, 0xc1, 0x53, 0x71, 0xb9, 0x48,
                              0x42, 0xc4, 0xe8, 0xf6, 0x59, 0x3e, 0x70, 0x6,  0xbb, 0x6b, 0x17, 0x75, 0x8e};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "dXU-\240\154\245]\DC3\246\178\132\200\255\147MJ\234\151\213\255\168\248\&0\142P\f\180\200", _password = Just
// "\128\DC1\b~e\198U\177\STX'\151\167\&5", _lastWill = Nothing, _cleanSession = True, _keepAlive = 18569, _connID =
// "\128S\EM\228\"K\171g\158}\227SV6\144\224\DC2\159\239\r0\n\156\140\DC3", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x48, 0x89, 0x0,  0x19, 0x80,
                   0x53, 0x19, 0xe4, 0x22, 0x4b, 0xab, 0x67, 0x9e, 0x7d, 0xe3, 0x53, 0x56, 0x36, 0x90, 0xe0,
                   0x12, 0x9f, 0xef, 0xd,  0x30, 0xa,  0x9c, 0x8c, 0x13, 0x0,  0x1d, 0x64, 0x58, 0x55, 0x2d,
                   0xf0, 0x9a, 0xf5, 0x5d, 0x13, 0xf6, 0xb2, 0x84, 0xc8, 0xff, 0x93, 0x4d, 0x4a, 0xea, 0x97,
                   0xd5, 0xff, 0xa8, 0xf8, 0x30, 0x8e, 0x50, 0xc,  0xb4, 0xc8, 0x0,  0xd,  0x80, 0x11, 0x8,
                   0x7e, 0x65, 0xc6, 0x55, 0xb1, 0x2,  0x27, 0x97, 0xa7, 0x35};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18569;
  uint8_t client_id_bytes[] = {0x80, 0x53, 0x19, 0xe4, 0x22, 0x4b, 0xab, 0x67, 0x9e, 0x7d, 0xe3, 0x53, 0x56,
                               0x36, 0x90, 0xe0, 0x12, 0x9f, 0xef, 0xd,  0x30, 0xa,  0x9c, 0x8c, 0x13};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x64, 0x58, 0x55, 0x2d, 0xf0, 0x9a, 0xf5, 0x5d, 0x13, 0xf6, 0xb2, 0x84, 0xc8, 0xff, 0x93,
                              0x4d, 0x4a, 0xea, 0x97, 0xd5, 0xff, 0xa8, 0xf8, 0x30, 0x8e, 0x50, 0xc,  0xb4, 0xc8};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x80, 0x11, 0x8, 0x7e, 0x65, 0xc6, 0x55, 0xb1, 0x2, 0x27, 0x97, 0xa7, 0x35};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "|\226c4\183<x\DEL\148\ETX\183\SO!\FS\250\ACK\FSZ\226", _password = Just
// "w\187\220\250\181lx\172\&7\SOH\194\142\ENQ7\FS\207X\148\ETB\204\r\210\b\RS", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS2, _willTopic = "\206\aB^Ph\189\200\158\220\SO\151\248\142\ESC\202$x\187\241+[;\165\n",
// _willMsg = "\183F\152\172\148\140\156", _willProps = []}), _cleanSession = False, _keepAlive = 17650, _connID = "\227
// s`,1\240\236z\182\167\209\132kvpp\167\174}6Z\207\&9\207%\227U ", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x7c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x44, 0xf2, 0x0,  0x1d, 0xe3, 0x20,
                   0x73, 0x60, 0x2c, 0x31, 0xf0, 0xec, 0x7a, 0xb6, 0xa7, 0xd1, 0x84, 0x6b, 0x76, 0x70, 0x70, 0xa7,
                   0xae, 0x7d, 0x36, 0x5a, 0xcf, 0x39, 0xcf, 0x25, 0xe3, 0x55, 0x20, 0x0,  0x19, 0xce, 0x7,  0x42,
                   0x5e, 0x50, 0x68, 0xbd, 0xc8, 0x9e, 0xdc, 0xe,  0x97, 0xf8, 0x8e, 0x1b, 0xca, 0x24, 0x78, 0xbb,
                   0xf1, 0x2b, 0x5b, 0x3b, 0xa5, 0xa,  0x0,  0x7,  0xb7, 0x46, 0x98, 0xac, 0x94, 0x8c, 0x9c, 0x0,
                   0x13, 0x7c, 0xe2, 0x63, 0x34, 0xb7, 0x3c, 0x78, 0x7f, 0x94, 0x3,  0xb7, 0xe,  0x21, 0x1c, 0xfa,
                   0x6,  0x1c, 0x5a, 0xe2, 0x0,  0x18, 0x77, 0xbb, 0xdc, 0xfa, 0xb5, 0x6c, 0x78, 0xac, 0x37, 0x1,
                   0xc2, 0x8e, 0x5,  0x37, 0x1c, 0xcf, 0x58, 0x94, 0x17, 0xcc, 0xd,  0xd2, 0x8,  0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xce, 0x7,  0x42, 0x5e, 0x50, 0x68, 0xbd, 0xc8, 0x9e, 0xdc, 0xe,  0x97, 0xf8,
                                0x8e, 0x1b, 0xca, 0x24, 0x78, 0xbb, 0xf1, 0x2b, 0x5b, 0x3b, 0xa5, 0xa};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb7, 0x46, 0x98, 0xac, 0x94, 0x8c, 0x9c};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17650;
  uint8_t client_id_bytes[] = {0xe3, 0x20, 0x73, 0x60, 0x2c, 0x31, 0xf0, 0xec, 0x7a, 0xb6, 0xa7, 0xd1, 0x84, 0x6b, 0x76,
                               0x70, 0x70, 0xa7, 0xae, 0x7d, 0x36, 0x5a, 0xcf, 0x39, 0xcf, 0x25, 0xe3, 0x55, 0x20};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7c, 0xe2, 0x63, 0x34, 0xb7, 0x3c, 0x78, 0x7f, 0x94, 0x3,
                              0xb7, 0xe,  0x21, 0x1c, 0xfa, 0x6,  0x1c, 0x5a, 0xe2};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x77, 0xbb, 0xdc, 0xfa, 0xb5, 0x6c, 0x78, 0xac, 0x37, 0x1,  0xc2, 0x8e,
                              0x5,  0x37, 0x1c, 0xcf, 0x58, 0x94, 0x17, 0xcc, 0xd,  0xd2, 0x8,  0x1e};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\148q\203\&9\184:)\217]G\254\f`\208\248\&4\183\139
// \RS\CAN\219\RS\133d\252H\220L\v", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS2, _willTopic = "u\187\\\\+\205\SOHy&{\228\219.\ETB\ENQ\219", _willMsg = "\147
// !K\155\f\253\214\246hNm\ACK)\156\193\241$\198>\RSz", _willProps = []}), _cleanSession = False, _keepAlive = 20026,
// _connID = "_\DEL\aB\218\207H\EMs\SO\153b@\162", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x64, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb4, 0x4e, 0x3a, 0x0,  0xe,  0x5f, 0x7f, 0x7,
                   0x42, 0xda, 0xcf, 0x48, 0x19, 0x73, 0xe,  0x99, 0x62, 0x40, 0xa2, 0x0,  0x10, 0x75, 0xbb, 0x5c, 0x5c,
                   0x2b, 0xcd, 0x1,  0x79, 0x26, 0x7b, 0xe4, 0xdb, 0x2e, 0x17, 0x5,  0xdb, 0x0,  0x16, 0x93, 0x20, 0x21,
                   0x4b, 0x9b, 0xc,  0xfd, 0xd6, 0xf6, 0x68, 0x4e, 0x6d, 0x6,  0x29, 0x9c, 0xc1, 0xf1, 0x24, 0xc6, 0x3e,
                   0x1e, 0x7a, 0x0,  0x1e, 0x94, 0x71, 0xcb, 0x39, 0xb8, 0x3a, 0x29, 0xd9, 0x5d, 0x47, 0xfe, 0xc,  0x60,
                   0xd0, 0xf8, 0x34, 0xb7, 0x8b, 0x20, 0x1e, 0x18, 0xdb, 0x1e, 0x85, 0x64, 0xfc, 0x48, 0xdc, 0x4c, 0xb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x75, 0xbb, 0x5c, 0x5c, 0x2b, 0xcd, 0x1, 0x79,
                                0x26, 0x7b, 0xe4, 0xdb, 0x2e, 0x17, 0x5, 0xdb};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x93, 0x20, 0x21, 0x4b, 0x9b, 0xc,  0xfd, 0xd6, 0xf6, 0x68, 0x4e,
                                  0x6d, 0x6,  0x29, 0x9c, 0xc1, 0xf1, 0x24, 0xc6, 0x3e, 0x1e, 0x7a};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20026;
  uint8_t client_id_bytes[] = {0x5f, 0x7f, 0x7, 0x42, 0xda, 0xcf, 0x48, 0x19, 0x73, 0xe, 0x99, 0x62, 0x40, 0xa2};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x94, 0x71, 0xcb, 0x39, 0xb8, 0x3a, 0x29, 0xd9, 0x5d, 0x47, 0xfe, 0xc,  0x60, 0xd0, 0xf8,
                              0x34, 0xb7, 0x8b, 0x20, 0x1e, 0x18, 0xdb, 0x1e, 0x85, 0x64, 0xfc, 0x48, 0xdc, 0x4c, 0xb};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "F|\\\193@", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 13766, _connID = "((\SOH\237M\220\167\ESC\241\249\138f\149\134\225\RS U!\133]\SO\204\&8D.g\154",
// _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x28, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x0,  0x35, 0xc6, 0x0,  0x1c,
                   0x28, 0x28, 0x1,  0xed, 0x4d, 0xdc, 0xa7, 0x1b, 0xf1, 0xf9, 0x8a, 0x66, 0x95, 0x86,
                   0xe1, 0x1e, 0x20, 0x55, 0x21, 0x85, 0x5d, 0xe,  0xcc, 0x38, 0x44, 0x2e, 0x67, 0x9a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13766;
  uint8_t client_id_bytes[] = {0x28, 0x28, 0x1,  0xed, 0x4d, 0xdc, 0xa7, 0x1b, 0xf1, 0xf9, 0x8a, 0x66, 0x95, 0x86,
                               0xe1, 0x1e, 0x20, 0x55, 0x21, 0x85, 0x5d, 0xe,  0xcc, 0x38, 0x44, 0x2e, 0x67, 0x9a};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x46, 0x7c, 0x5c, 0xc1, 0x40};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "C\205.\143\174\198\137\162\176\DC1 \254/'\209\141o\153",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "H\153y\169d\249\209\v\245\233\238\223\202L\133\136\143\191\142\179FE )2\242\148k", _willMsg =
// "D\217<g\166\143\242\142\161*\241\141", _willProps = []}), _cleanSession = False, _keepAlive = 19318, _connID =
// "a\208\181\&4\129", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x3d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x4b, 0x76, 0x0,  0x5,  0x61, 0xd0,
                   0xb5, 0x34, 0x81, 0x0,  0x1c, 0x48, 0x99, 0x79, 0xa9, 0x64, 0xf9, 0xd1, 0xb,  0xf5, 0xe9, 0xee,
                   0xdf, 0xca, 0x4c, 0x85, 0x88, 0x8f, 0xbf, 0x8e, 0xb3, 0x46, 0x45, 0x20, 0x29, 0x32, 0xf2, 0x94,
                   0x6b, 0x0,  0xc,  0x44, 0xd9, 0x3c, 0x67, 0xa6, 0x8f, 0xf2, 0x8e, 0xa1, 0x2a, 0xf1, 0x8d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x48, 0x99, 0x79, 0xa9, 0x64, 0xf9, 0xd1, 0xb,  0xf5, 0xe9, 0xee, 0xdf, 0xca, 0x4c,
                                0x85, 0x88, 0x8f, 0xbf, 0x8e, 0xb3, 0x46, 0x45, 0x20, 0x29, 0x32, 0xf2, 0x94, 0x6b};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x44, 0xd9, 0x3c, 0x67, 0xa6, 0x8f, 0xf2, 0x8e, 0xa1, 0x2a, 0xf1, 0x8d};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19318;
  uint8_t client_id_bytes[] = {0x61, 0xd0, 0xb5, 0x34, 0x81};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x43, 0xcd, 0x2e, 0x8f, 0xae, 0xc6, 0x89, 0xa2, 0xb0,
                              0x11, 0x20, 0xfe, 0x2f, 0x27, 0xd1, 0x8d, 0x6f, 0x99};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "M\136e\"\219\149\DEL]\217q\189\203\ACK\246\159E\156\169\140\SOHWs\US\165\190", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\217+\\\",s\137\EM\165\183{v
// \153\DC2\209\234\183\130`\v\NAK\147\186\243f\182\189\234", _willMsg = "\232\242\218\252K\201\180\128\&2\247\190",
// _willProps = []}), _cleanSession = False, _keepAlive = 12023, _connID = "\228H\166\138\212\250c\180j~T", _properties
// = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x43, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x2e, 0xf7, 0x0,  0xb,
                   0xe4, 0x48, 0xa6, 0x8a, 0xd4, 0xfa, 0x63, 0xb4, 0x6a, 0x7e, 0x54, 0x0,  0x1d, 0xd9,
                   0x2b, 0x5c, 0x22, 0x2c, 0x73, 0x89, 0x19, 0xa5, 0xb7, 0x7b, 0x76, 0x20, 0x99, 0x12,
                   0xd1, 0xea, 0xb7, 0x82, 0x60, 0xb,  0x15, 0x93, 0xba, 0xf3, 0x66, 0xb6, 0xbd, 0xea,
                   0x0,  0xb,  0xe8, 0xf2, 0xda, 0xfc, 0x4b, 0xc9, 0xb4, 0x80, 0x32, 0xf7, 0xbe};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9, 0x2b, 0x5c, 0x22, 0x2c, 0x73, 0x89, 0x19, 0xa5, 0xb7,
                                0x7b, 0x76, 0x20, 0x99, 0x12, 0xd1, 0xea, 0xb7, 0x82, 0x60,
                                0xb,  0x15, 0x93, 0xba, 0xf3, 0x66, 0xb6, 0xbd, 0xea};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe8, 0xf2, 0xda, 0xfc, 0x4b, 0xc9, 0xb4, 0x80, 0x32, 0xf7, 0xbe};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12023;
  uint8_t client_id_bytes[] = {0xe4, 0x48, 0xa6, 0x8a, 0xd4, 0xfa, 0x63, 0xb4, 0x6a, 0x7e, 0x54};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4d, 0x88, 0x65, 0x22, 0xdb, 0x95, 0x7f, 0x5d, 0xd9, 0x71, 0xbd, 0xcb, 0x6,
                              0xf6, 0x9f, 0x45, 0x9c, 0xa9, 0x8c, 0x1,  0x57, 0x73, 0x1f, 0xa5, 0xbe};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "|\155\165C", _willMsg = "\178\238\129\175W", _willProps = []}), _cleanSession = True, _keepAlive
// = 30344, _connID = "Pz[\222\193I\206|RX4\RS\n\227\r\227Gt\DC2", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x2c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x76, 0x88, 0x0,  0x13, 0x50, 0x7a,
                   0x5b, 0xde, 0xc1, 0x49, 0xce, 0x7c, 0x52, 0x58, 0x34, 0x1e, 0xa,  0xe3, 0xd,  0xe3, 0x47, 0x74,
                   0x12, 0x0,  0x4,  0x7c, 0x9b, 0xa5, 0x43, 0x0,  0x5,  0xb2, 0xee, 0x81, 0xaf, 0x57};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7c, 0x9b, 0xa5, 0x43};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb2, 0xee, 0x81, 0xaf, 0x57};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30344;
  uint8_t client_id_bytes[] = {0x50, 0x7a, 0x5b, 0xde, 0xc1, 0x49, 0xce, 0x7c, 0x52, 0x58,
                               0x34, 0x1e, 0xa,  0xe3, 0xd,  0xe3, 0x47, 0x74, 0x12};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\198\196\247\188\142\&7g\186", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 25768, _connID = "\177", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0xd, 0x0, 0x4, 0x4d, 0x51, 0x54, 0x54, 0x4, 0x2, 0x64, 0xa8, 0x0, 0x1, 0xb1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25768;
  uint8_t client_id_bytes[] = {0xb1};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc6, 0xc4, 0xf7, 0xbc, 0x8e, 0x37, 0x67, 0xba};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\253\b\230\224\160\154\138\174", _password = Just "b;8{
// \144\183\161\198a\ETX<G\142\SOH\217\CANb\SO\218\234", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\141\213\218=?\NAK\195?&,\246", _willMsg = "f\188r\ETX\160~_h)`i\DELj\230'y\198\DC2\248e",
// _willProps = []}), _cleanSession = True, _keepAlive = 31425, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x50, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x7a, 0xc1, 0x0,  0x0,  0x0,  0xb,  0x8d,
                   0xd5, 0xda, 0x3d, 0x3f, 0x15, 0xc3, 0x3f, 0x26, 0x2c, 0xf6, 0x0,  0x14, 0x66, 0xbc, 0x72, 0x3,  0xa0,
                   0x7e, 0x5f, 0x68, 0x29, 0x60, 0x69, 0x7f, 0x6a, 0xe6, 0x27, 0x79, 0xc6, 0x12, 0xf8, 0x65, 0x0,  0x8,
                   0xfd, 0x8,  0xe6, 0xe0, 0xa0, 0x9a, 0x8a, 0xae, 0x0,  0x15, 0x62, 0x3b, 0x38, 0x7b, 0x20, 0x90, 0xb7,
                   0xa1, 0xc6, 0x61, 0x3,  0x3c, 0x47, 0x8e, 0x1,  0xd9, 0x18, 0x62, 0xe,  0xda, 0xea};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8d, 0xd5, 0xda, 0x3d, 0x3f, 0x15, 0xc3, 0x3f, 0x26, 0x2c, 0xf6};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x66, 0xbc, 0x72, 0x3,  0xa0, 0x7e, 0x5f, 0x68, 0x29, 0x60,
                                  0x69, 0x7f, 0x6a, 0xe6, 0x27, 0x79, 0xc6, 0x12, 0xf8, 0x65};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31425;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfd, 0x8, 0xe6, 0xe0, 0xa0, 0x9a, 0x8a, 0xae};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x62, 0x3b, 0x38, 0x7b, 0x20, 0x90, 0xb7, 0xa1, 0xc6, 0x61, 0x3,
                              0x3c, 0x47, 0x8e, 0x1,  0xd9, 0x18, 0x62, 0xe,  0xda, 0xea};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "IW[\248-[*\NAK\135jJJ\144\&4\148\131H\242IId\184\196a|CB\242\NAK\238", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "c\228\141Pj\227\200\RS", _willMsg =
// "O\181\146\172\&8\200\165pw\156:\227\160\204\"\219-y\US\214\168{", _willProps = []}), _cleanSession = False,
// _keepAlive = 18040, _connID = "\244\188\144", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x31, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x14, 0x46, 0x78, 0x0,
                   0x3,  0xf4, 0xbc, 0x90, 0x0,  0x8,  0x63, 0xe4, 0x8d, 0x50, 0x6a, 0xe3, 0xc8,
                   0x1e, 0x0,  0x16, 0x4f, 0xb5, 0x92, 0xac, 0x38, 0xc8, 0xa5, 0x70, 0x77, 0x9c,
                   0x3a, 0xe3, 0xa0, 0xcc, 0x22, 0xdb, 0x2d, 0x79, 0x1f, 0xd6, 0xa8, 0x7b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x63, 0xe4, 0x8d, 0x50, 0x6a, 0xe3, 0xc8, 0x1e};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4f, 0xb5, 0x92, 0xac, 0x38, 0xc8, 0xa5, 0x70, 0x77, 0x9c, 0x3a,
                                  0xe3, 0xa0, 0xcc, 0x22, 0xdb, 0x2d, 0x79, 0x1f, 0xd6, 0xa8, 0x7b};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18040;
  uint8_t client_id_bytes[] = {0xf4, 0xbc, 0x90};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x49, 0x57, 0x5b, 0xf8, 0x2d, 0x5b, 0x2a, 0x15, 0x87, 0x6a, 0x4a, 0x4a, 0x90, 0x34, 0x94,
                              0x83, 0x48, 0xf2, 0x49, 0x49, 0x64, 0xb8, 0xc4, 0x61, 0x7c, 0x43, 0x42, 0xf2, 0x15, 0xee};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "$\184\198/)\161\242\&4\202q.\235\175\183`h", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\ETX-gs\242\r\246#:\255\212\251\221\STX#P", _willMsg =
// "\241\&7\183W", _willProps = []}), _cleanSession = False, _keepAlive = 6911, _connID = "Nr\151\198", _properties =
// []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x84, 0x1a, 0xff, 0x0,  0x4,  0x4e,
                   0x72, 0x97, 0xc6, 0x0,  0x10, 0x3,  0x2d, 0x67, 0x73, 0xf2, 0xd,  0xf6, 0x23, 0x3a, 0xff,
                   0xd4, 0xfb, 0xdd, 0x2,  0x23, 0x50, 0x0,  0x4,  0xf1, 0x37, 0xb7, 0x57, 0x0,  0x10, 0x24,
                   0xb8, 0xc6, 0x2f, 0x29, 0xa1, 0xf2, 0x34, 0xca, 0x71, 0x2e, 0xeb, 0xaf, 0xb7, 0x60, 0x68};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3,  0x2d, 0x67, 0x73, 0xf2, 0xd, 0xf6, 0x23,
                                0x3a, 0xff, 0xd4, 0xfb, 0xdd, 0x2, 0x23, 0x50};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf1, 0x37, 0xb7, 0x57};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6911;
  uint8_t client_id_bytes[] = {0x4e, 0x72, 0x97, 0xc6};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x24, 0xb8, 0xc6, 0x2f, 0x29, 0xa1, 0xf2, 0x34,
                              0xca, 0x71, 0x2e, 0xeb, 0xaf, 0xb7, 0x60, 0x68};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\178", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\196\v\202\168\"s\DC1+\222\128\&1\138Y\208Bp\178", _willMsg = "", _willProps = []}),
// _cleanSession = True, _keepAlive = 11823, _connID = "\r\173C5$+~D\ACK\169D\220\160\218\131!Bo\SO\159HN", _properties
// = []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xa6, 0x2e, 0x2f, 0x0,  0x16, 0xd,
                   0xad, 0x43, 0x35, 0x24, 0x2b, 0x7e, 0x44, 0x6,  0xa9, 0x44, 0xdc, 0xa0, 0xda, 0x83, 0x21,
                   0x42, 0x6f, 0xe,  0x9f, 0x48, 0x4e, 0x0,  0x11, 0xc4, 0xb,  0xca, 0xa8, 0x22, 0x73, 0x11,
                   0x2b, 0xde, 0x80, 0x31, 0x8a, 0x59, 0xd0, 0x42, 0x70, 0xb2, 0x0,  0x0,  0x0,  0x1,  0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc4, 0xb,  0xca, 0xa8, 0x22, 0x73, 0x11, 0x2b, 0xde,
                                0x80, 0x31, 0x8a, 0x59, 0xd0, 0x42, 0x70, 0xb2};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11823;
  uint8_t client_id_bytes[] = {0xd,  0xad, 0x43, 0x35, 0x24, 0x2b, 0x7e, 0x44, 0x6,  0xa9, 0x44,
                               0xdc, 0xa0, 0xda, 0x83, 0x21, 0x42, 0x6f, 0xe,  0x9f, 0x48, 0x4e};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb2};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "M\162\184\&2\161L\154u\186\163\SYN\212\180\192S\137\a\169\&5\208Z\"\a\143{\DC1\246", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic =
// "p\188\191\217S;m\n\EM\155\NAK\247\182\145\183\SYN\184\152\SUB\153\214-D\b\CAN\128", _willMsg = "\197p\131",
// _willProps = []}), _cleanSession = True, _keepAlive = 15472, _connID =
// "A\231\208\198C*2\172\&2\183\133\223\152\224(\129o\n\180MO\235Z\186\166\f", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x47, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x3c, 0x70, 0x0,  0x1a, 0x41,
                   0xe7, 0xd0, 0xc6, 0x43, 0x2a, 0x32, 0xac, 0x32, 0xb7, 0x85, 0xdf, 0x98, 0xe0, 0x28, 0x81,
                   0x6f, 0xa,  0xb4, 0x4d, 0x4f, 0xeb, 0x5a, 0xba, 0xa6, 0xc,  0x0,  0x1a, 0x70, 0xbc, 0xbf,
                   0xd9, 0x53, 0x3b, 0x6d, 0xa,  0x19, 0x9b, 0x15, 0xf7, 0xb6, 0x91, 0xb7, 0x16, 0xb8, 0x98,
                   0x1a, 0x99, 0xd6, 0x2d, 0x44, 0x8,  0x18, 0x80, 0x0,  0x3,  0xc5, 0x70, 0x83};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x70, 0xbc, 0xbf, 0xd9, 0x53, 0x3b, 0x6d, 0xa,  0x19, 0x9b, 0x15, 0xf7, 0xb6,
                                0x91, 0xb7, 0x16, 0xb8, 0x98, 0x1a, 0x99, 0xd6, 0x2d, 0x44, 0x8,  0x18, 0x80};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc5, 0x70, 0x83};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 15472;
  uint8_t client_id_bytes[] = {0x41, 0xe7, 0xd0, 0xc6, 0x43, 0x2a, 0x32, 0xac, 0x32, 0xb7, 0x85, 0xdf, 0x98,
                               0xe0, 0x28, 0x81, 0x6f, 0xa,  0xb4, 0x4d, 0x4f, 0xeb, 0x5a, 0xba, 0xa6, 0xc};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4d, 0xa2, 0xb8, 0x32, 0xa1, 0x4c, 0x9a, 0x75, 0xba, 0xa3, 0x16, 0xd4, 0xb4, 0xc0,
                              0x53, 0x89, 0x7,  0xa9, 0x35, 0xd0, 0x5a, 0x22, 0x7,  0x8f, 0x7b, 0x11, 0xf6};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ni\175J\146\197o\130\201\&8@\212x\172\ENQ\SOH!\164dU\\M\248\216\189", _password =
// Just "\EOT\128\CAN\203[\240\SYN\b", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\135\ESC\DLE|c.\180\189\232p\195\155\171=\246", _willMsg =
// "\137\150\171\227\191\DC2[m\203I\160\176\SO\193A\238\210F\180@$4\176\&8N\172\&5\234KO", _willProps = []}),
// _cleanSession = True, _keepAlive = 17924, _connID =
// "a\NUL\161\b\145\247$\148\&9^N\209\CAN\SOHT\150\176%'\199\214\&5\131\202\185\208\145E1N", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x80, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x46, 0x4,  0x0,  0x1e, 0x61, 0x0,
                   0xa1, 0x8,  0x91, 0xf7, 0x24, 0x94, 0x39, 0x5e, 0x4e, 0xd1, 0x18, 0x1,  0x54, 0x96, 0xb0, 0x25, 0x27,
                   0xc7, 0xd6, 0x35, 0x83, 0xca, 0xb9, 0xd0, 0x91, 0x45, 0x31, 0x4e, 0x0,  0xf,  0x87, 0x1b, 0x10, 0x7c,
                   0x63, 0x2e, 0xb4, 0xbd, 0xe8, 0x70, 0xc3, 0x9b, 0xab, 0x3d, 0xf6, 0x0,  0x1e, 0x89, 0x96, 0xab, 0xe3,
                   0xbf, 0x12, 0x5b, 0x6d, 0xcb, 0x49, 0xa0, 0xb0, 0xe,  0xc1, 0x41, 0xee, 0xd2, 0x46, 0xb4, 0x40, 0x24,
                   0x34, 0xb0, 0x38, 0x4e, 0xac, 0x35, 0xea, 0x4b, 0x4f, 0x0,  0x19, 0xa,  0x69, 0xaf, 0x4a, 0x92, 0xc5,
                   0x6f, 0x82, 0xc9, 0x38, 0x40, 0xd4, 0x78, 0xac, 0x5,  0x1,  0x21, 0xa4, 0x64, 0x55, 0x5c, 0x4d, 0xf8,
                   0xd8, 0xbd, 0x0,  0x8,  0x4,  0x80, 0x18, 0xcb, 0x5b, 0xf0, 0x16, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x1b, 0x10, 0x7c, 0x63, 0x2e, 0xb4, 0xbd,
                                0xe8, 0x70, 0xc3, 0x9b, 0xab, 0x3d, 0xf6};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x89, 0x96, 0xab, 0xe3, 0xbf, 0x12, 0x5b, 0x6d, 0xcb, 0x49,
                                  0xa0, 0xb0, 0xe,  0xc1, 0x41, 0xee, 0xd2, 0x46, 0xb4, 0x40,
                                  0x24, 0x34, 0xb0, 0x38, 0x4e, 0xac, 0x35, 0xea, 0x4b, 0x4f};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17924;
  uint8_t client_id_bytes[] = {0x61, 0x0,  0xa1, 0x8,  0x91, 0xf7, 0x24, 0x94, 0x39, 0x5e,
                               0x4e, 0xd1, 0x18, 0x1,  0x54, 0x96, 0xb0, 0x25, 0x27, 0xc7,
                               0xd6, 0x35, 0x83, 0xca, 0xb9, 0xd0, 0x91, 0x45, 0x31, 0x4e};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa,  0x69, 0xaf, 0x4a, 0x92, 0xc5, 0x6f, 0x82, 0xc9, 0x38, 0x40, 0xd4, 0x78,
                              0xac, 0x5,  0x1,  0x21, 0xa4, 0x64, 0x55, 0x5c, 0x4d, 0xf8, 0xd8, 0xbd};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4, 0x80, 0x18, 0xcb, 0x5b, 0xf0, 0x16, 0x8};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "x\197,\208\aUF\242|z\244", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "9*J\v\172B:vV\252\US>YCPMxm", _willMsg = ">N", _willProps = []}),
// _cleanSession = False, _keepAlive = 8679, _connID = "\155\132j\168 \215\255w\SO\227", _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x2e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x21, 0xe7, 0x0,  0xa, 0x9b, 0x84,
                   0x6a, 0xa8, 0x20, 0xd7, 0xff, 0x77, 0xe,  0xe3, 0x0,  0x12, 0x39, 0x2a, 0x4a, 0xb, 0xac, 0x42,
                   0x3a, 0x76, 0x56, 0xfc, 0x1f, 0x3e, 0x59, 0x43, 0x50, 0x4d, 0x78, 0x6d, 0x0,  0x2, 0x3e, 0x4e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x39, 0x2a, 0x4a, 0xb,  0xac, 0x42, 0x3a, 0x76, 0x56,
                                0xfc, 0x1f, 0x3e, 0x59, 0x43, 0x50, 0x4d, 0x78, 0x6d};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3e, 0x4e};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 8679;
  uint8_t client_id_bytes[] = {0x9b, 0x84, 0x6a, 0xa8, 0x20, 0xd7, 0xff, 0x77, 0xe, 0xe3};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x78, 0xc5, 0x2c, 0xd0, 0x7, 0x55, 0x46, 0xf2, 0x7c, 0x7a, 0xf4};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "#*\SUB\197/r\203", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "G@v wb\253\GSb\212", _willMsg =
// "\SYN\"mo\233lbY\DC3\160\156\230\206`\226J|\232", _willProps = []}), _cleanSession = True, _keepAlive = 17750,
// _connID = "\178Y\174\187MI\NAK\186F\SYN\139\138\235u\SOH\197Q", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x86, 0x45, 0x56, 0x0,  0x11, 0xb2,
                   0x59, 0xae, 0xbb, 0x4d, 0x49, 0x15, 0xba, 0x46, 0x16, 0x8b, 0x8a, 0xeb, 0x75, 0x1,  0xc5,
                   0x51, 0x0,  0xa,  0x47, 0x40, 0x76, 0x20, 0x77, 0x62, 0xfd, 0x1d, 0x62, 0xd4, 0x0,  0x12,
                   0x16, 0x22, 0x6d, 0x6f, 0xe9, 0x6c, 0x62, 0x59, 0x13, 0xa0, 0x9c, 0xe6, 0xce, 0x60, 0xe2,
                   0x4a, 0x7c, 0xe8, 0x0,  0x7,  0x23, 0x2a, 0x1a, 0xc5, 0x2f, 0x72, 0xcb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x47, 0x40, 0x76, 0x20, 0x77, 0x62, 0xfd, 0x1d, 0x62, 0xd4};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x16, 0x22, 0x6d, 0x6f, 0xe9, 0x6c, 0x62, 0x59, 0x13,
                                  0xa0, 0x9c, 0xe6, 0xce, 0x60, 0xe2, 0x4a, 0x7c, 0xe8};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17750;
  uint8_t client_id_bytes[] = {0xb2, 0x59, 0xae, 0xbb, 0x4d, 0x49, 0x15, 0xba, 0x46,
                               0x16, 0x8b, 0x8a, 0xeb, 0x75, 0x1,  0xc5, 0x51};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x23, 0x2a, 0x1a, 0xc5, 0x2f, 0x72, 0xcb};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ";<\132\244\&6\148W/\234\225\r\SIO\DC1", _password = Just
// "\243\ACK\180?\176\136\191]UDv\US\f\151|\209\150\NUL", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\176\CAN\r\146\ESC\214\243U\141F\EM\253\149\231\131\182\203+\164\212'=\232\161\154L\219$",
// _willMsg = "\185\143G\243\136\166\&2xe\156z:|WI\175\185s([H\182\224\143", _willProps = []}), _cleanSession = True,
// _keepAlive = 29887, _connID = "\136\132f\178\182\247\158\133\171t\131\148\168\fR\250d\235\253/\255Y\194\DLE\178",
// _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x81, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x74, 0xbf, 0x0,  0x19, 0x88, 0x84,
                   0x66, 0xb2, 0xb6, 0xf7, 0x9e, 0x85, 0xab, 0x74, 0x83, 0x94, 0xa8, 0xc,  0x52, 0xfa, 0x64, 0xeb, 0xfd,
                   0x2f, 0xff, 0x59, 0xc2, 0x10, 0xb2, 0x0,  0x1c, 0xb0, 0x18, 0xd,  0x92, 0x1b, 0xd6, 0xf3, 0x55, 0x8d,
                   0x46, 0x19, 0xfd, 0x95, 0xe7, 0x83, 0xb6, 0xcb, 0x2b, 0xa4, 0xd4, 0x27, 0x3d, 0xe8, 0xa1, 0x9a, 0x4c,
                   0xdb, 0x24, 0x0,  0x18, 0xb9, 0x8f, 0x47, 0xf3, 0x88, 0xa6, 0x32, 0x78, 0x65, 0x9c, 0x7a, 0x3a, 0x7c,
                   0x57, 0x49, 0xaf, 0xb9, 0x73, 0x28, 0x5b, 0x48, 0xb6, 0xe0, 0x8f, 0x0,  0xe,  0x3b, 0x3c, 0x84, 0xf4,
                   0x36, 0x94, 0x57, 0x2f, 0xea, 0xe1, 0xd,  0xf,  0x4f, 0x11, 0x0,  0x12, 0xf3, 0x6,  0xb4, 0x3f, 0xb0,
                   0x88, 0xbf, 0x5d, 0x55, 0x44, 0x76, 0x1f, 0xc,  0x97, 0x7c, 0xd1, 0x96, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb0, 0x18, 0xd,  0x92, 0x1b, 0xd6, 0xf3, 0x55, 0x8d, 0x46, 0x19, 0xfd, 0x95, 0xe7,
                                0x83, 0xb6, 0xcb, 0x2b, 0xa4, 0xd4, 0x27, 0x3d, 0xe8, 0xa1, 0x9a, 0x4c, 0xdb, 0x24};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb9, 0x8f, 0x47, 0xf3, 0x88, 0xa6, 0x32, 0x78, 0x65, 0x9c, 0x7a, 0x3a,
                                  0x7c, 0x57, 0x49, 0xaf, 0xb9, 0x73, 0x28, 0x5b, 0x48, 0xb6, 0xe0, 0x8f};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29887;
  uint8_t client_id_bytes[] = {0x88, 0x84, 0x66, 0xb2, 0xb6, 0xf7, 0x9e, 0x85, 0xab, 0x74, 0x83, 0x94, 0xa8,
                               0xc,  0x52, 0xfa, 0x64, 0xeb, 0xfd, 0x2f, 0xff, 0x59, 0xc2, 0x10, 0xb2};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3b, 0x3c, 0x84, 0xf4, 0x36, 0x94, 0x57, 0x2f, 0xea, 0xe1, 0xd, 0xf, 0x4f, 0x11};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf3, 0x6,  0xb4, 0x3f, 0xb0, 0x88, 0xbf, 0x5d, 0x55,
                              0x44, 0x76, 0x1f, 0xc,  0x97, 0x7c, 0xd1, 0x96, 0x0};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ENQAAE\ACK\174&\128\161wm#W>VC<]\149\152\201\134x:\148\220\243T\\.", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// ";\161U\195\&6\138\177I\129\195\USA\DC3", _willMsg = "I\DC1\210\DC3\FS\DC3\242\138\171\211\203\b\190", _willProps =
// []}), _cleanSession = True, _keepAlive = 22371, _connID = "\165\EM\181\CAN)62", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x51, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x86, 0x57, 0x63, 0x0,  0x7,  0xa5, 0x19, 0xb5,
                   0x18, 0x29, 0x36, 0x32, 0x0,  0xd,  0x3b, 0xa1, 0x55, 0xc3, 0x36, 0x8a, 0xb1, 0x49, 0x81, 0xc3, 0x1f,
                   0x41, 0x13, 0x0,  0xd,  0x49, 0x11, 0xd2, 0x13, 0x1c, 0x13, 0xf2, 0x8a, 0xab, 0xd3, 0xcb, 0x8,  0xbe,
                   0x0,  0x1e, 0x5,  0x41, 0x41, 0x45, 0x6,  0xae, 0x26, 0x80, 0xa1, 0x77, 0x6d, 0x23, 0x57, 0x3e, 0x56,
                   0x43, 0x3c, 0x5d, 0x95, 0x98, 0xc9, 0x86, 0x78, 0x3a, 0x94, 0xdc, 0xf3, 0x54, 0x5c, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3b, 0xa1, 0x55, 0xc3, 0x36, 0x8a, 0xb1, 0x49, 0x81, 0xc3, 0x1f, 0x41, 0x13};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x49, 0x11, 0xd2, 0x13, 0x1c, 0x13, 0xf2, 0x8a, 0xab, 0xd3, 0xcb, 0x8, 0xbe};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 22371;
  uint8_t client_id_bytes[] = {0xa5, 0x19, 0xb5, 0x18, 0x29, 0x36, 0x32};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5,  0x41, 0x41, 0x45, 0x6,  0xae, 0x26, 0x80, 0xa1, 0x77, 0x6d, 0x23, 0x57, 0x3e, 0x56,
                              0x43, 0x3c, 0x5d, 0x95, 0x98, 0xc9, 0x86, 0x78, 0x3a, 0x94, 0xdc, 0xf3, 0x54, 0x5c, 0x2e};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "OX\145\244\252\182\254\FS\130\252\134@\172\223\164\157{X}\165\146\152~f\219", _willMsg =
// "@\129Q\244!\183oR", _willProps = []}), _cleanSession = False, _keepAlive = 30518, _connID =
// "W\161E\137\235\171\156\EM\227`e^\234\242\248\227rj\195\139\NAK", _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x24, 0x77, 0x36, 0x0,  0x15, 0x57,
                   0xa1, 0x45, 0x89, 0xeb, 0xab, 0x9c, 0x19, 0xe3, 0x60, 0x65, 0x5e, 0xea, 0xf2, 0xf8, 0xe3,
                   0x72, 0x6a, 0xc3, 0x8b, 0x15, 0x0,  0x19, 0x4f, 0x58, 0x91, 0xf4, 0xfc, 0xb6, 0xfe, 0x1c,
                   0x82, 0xfc, 0x86, 0x40, 0xac, 0xdf, 0xa4, 0x9d, 0x7b, 0x58, 0x7d, 0xa5, 0x92, 0x98, 0x7e,
                   0x66, 0xdb, 0x0,  0x8,  0x40, 0x81, 0x51, 0xf4, 0x21, 0xb7, 0x6f, 0x52};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4f, 0x58, 0x91, 0xf4, 0xfc, 0xb6, 0xfe, 0x1c, 0x82, 0xfc, 0x86, 0x40, 0xac,
                                0xdf, 0xa4, 0x9d, 0x7b, 0x58, 0x7d, 0xa5, 0x92, 0x98, 0x7e, 0x66, 0xdb};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0x81, 0x51, 0xf4, 0x21, 0xb7, 0x6f, 0x52};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30518;
  uint8_t client_id_bytes[] = {0x57, 0xa1, 0x45, 0x89, 0xeb, 0xab, 0x9c, 0x19, 0xe3, 0x60, 0x65,
                               0x5e, 0xea, 0xf2, 0xf8, 0xe3, 0x72, 0x6a, 0xc3, 0x8b, 0x15};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\233\DLEuz,\235\221\183\245C\171\219\241^\213\168\160\167\181<\210\175\201\225\241\132\251\229e\164", _password =
// Just "\240\180X}9\198\t\SUBK\211\ACK\179t\255\237\148 no\DC3\203\&3;\198", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic =
// "\157\167S\173)\208\193\243\142\STX?\244\199<\DC3\202VL\215\218\215\162\174~\167G1\t\196)", _willMsg = "", _willProps
// = []}), _cleanSession = False, _keepAlive = 26007, _connID = "N\237\211", _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x6b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x65, 0x97, 0x0,  0x3,  0x4e, 0xed,
                   0xd3, 0x0,  0x1e, 0x9d, 0xa7, 0x53, 0xad, 0x29, 0xd0, 0xc1, 0xf3, 0x8e, 0x2,  0x3f, 0xf4, 0xc7,
                   0x3c, 0x13, 0xca, 0x56, 0x4c, 0xd7, 0xda, 0xd7, 0xa2, 0xae, 0x7e, 0xa7, 0x47, 0x31, 0x9,  0xc4,
                   0x29, 0x0,  0x0,  0x0,  0x1e, 0xe9, 0x10, 0x75, 0x7a, 0x2c, 0xeb, 0xdd, 0xb7, 0xf5, 0x43, 0xab,
                   0xdb, 0xf1, 0x5e, 0xd5, 0xa8, 0xa0, 0xa7, 0xb5, 0x3c, 0xd2, 0xaf, 0xc9, 0xe1, 0xf1, 0x84, 0xfb,
                   0xe5, 0x65, 0xa4, 0x0,  0x18, 0xf0, 0xb4, 0x58, 0x7d, 0x39, 0xc6, 0x9,  0x1a, 0x4b, 0xd3, 0x6,
                   0xb3, 0x74, 0xff, 0xed, 0x94, 0x20, 0x6e, 0x6f, 0x13, 0xcb, 0x33, 0x3b, 0xc6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9d, 0xa7, 0x53, 0xad, 0x29, 0xd0, 0xc1, 0xf3, 0x8e, 0x2,
                                0x3f, 0xf4, 0xc7, 0x3c, 0x13, 0xca, 0x56, 0x4c, 0xd7, 0xda,
                                0xd7, 0xa2, 0xae, 0x7e, 0xa7, 0x47, 0x31, 0x9,  0xc4, 0x29};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26007;
  uint8_t client_id_bytes[] = {0x4e, 0xed, 0xd3};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe9, 0x10, 0x75, 0x7a, 0x2c, 0xeb, 0xdd, 0xb7, 0xf5, 0x43, 0xab, 0xdb, 0xf1, 0x5e, 0xd5,
                              0xa8, 0xa0, 0xa7, 0xb5, 0x3c, 0xd2, 0xaf, 0xc9, 0xe1, 0xf1, 0x84, 0xfb, 0xe5, 0x65, 0xa4};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf0, 0xb4, 0x58, 0x7d, 0x39, 0xc6, 0x9,  0x1a, 0x4b, 0xd3, 0x6,  0xb3,
                              0x74, 0xff, 0xed, 0x94, 0x20, 0x6e, 0x6f, 0x13, 0xcb, 0x33, 0x3b, 0xc6};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\STXF\139\182d\236&\232\&0\220\246\150\CAN\210\147K\245O\160W*D\145\202", _willMsg =
// "\255\138T\159\195[tN\169\244\200*\226/\ENQ\238\251\DC3", _willProps = [PropSessionExpiryInterval
// 12196,PropMessageExpiryInterval 25354,PropRequestResponseInformation 86,PropRetainAvailable
// 155,PropWildcardSubscriptionAvailable 202,PropMessageExpiryInterval 18349,PropResponseTopic
// "_\190#\130\SOH\138\181?\247H\172m~+(L\232",PropServerKeepAlive 22997,PropContentType
// "\189\233\205{d\138\230\239\207",PropAuthenticationData "",PropCorrelationData
// "\ETX\189f\190x\DLE\235\253u\175f\239.z\215\178P\150\183?\194#\192.-S\175Z",PropResponseTopic "\ESC"]}),
// _cleanSession = True, _keepAlive = 23007, _connID = "\172\233\209\170i\141", _properties =
// [PropPayloadFormatIndicator 1]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0xa2, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x26, 0x59, 0xdf, 0x2,  0x1,  0x1,  0x0,
                   0x6,  0xac, 0xe9, 0xd1, 0xaa, 0x69, 0x8d, 0x5e, 0x11, 0x0,  0x0,  0x2f, 0xa4, 0x2,  0x0,  0x0,  0x63,
                   0xa,  0x19, 0x56, 0x25, 0x9b, 0x28, 0xca, 0x2,  0x0,  0x0,  0x47, 0xad, 0x8,  0x0,  0x11, 0x5f, 0xbe,
                   0x23, 0x82, 0x1,  0x8a, 0xb5, 0x3f, 0xf7, 0x48, 0xac, 0x6d, 0x7e, 0x2b, 0x28, 0x4c, 0xe8, 0x13, 0x59,
                   0xd5, 0x3,  0x0,  0x9,  0xbd, 0xe9, 0xcd, 0x7b, 0x64, 0x8a, 0xe6, 0xef, 0xcf, 0x16, 0x0,  0x0,  0x9,
                   0x0,  0x1c, 0x3,  0xbd, 0x66, 0xbe, 0x78, 0x10, 0xeb, 0xfd, 0x75, 0xaf, 0x66, 0xef, 0x2e, 0x7a, 0xd7,
                   0xb2, 0x50, 0x96, 0xb7, 0x3f, 0xc2, 0x23, 0xc0, 0x2e, 0x2d, 0x53, 0xaf, 0x5a, 0x8,  0x0,  0x1,  0x1b,
                   0x0,  0x18, 0x2,  0x46, 0x8b, 0xb6, 0x64, 0xec, 0x26, 0xe8, 0x30, 0xdc, 0xf6, 0x96, 0x18, 0xd2, 0x93,
                   0x4b, 0xf5, 0x4f, 0xa0, 0x57, 0x2a, 0x44, 0x91, 0xca, 0x0,  0x12, 0xff, 0x8a, 0x54, 0x9f, 0xc3, 0x5b,
                   0x74, 0x4e, 0xa9, 0xf4, 0xc8, 0x2a, 0xe2, 0x2f, 0x5,  0xee, 0xfb, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 1}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x5f, 0xbe, 0x23, 0x82, 0x1,  0x8a, 0xb5, 0x3f, 0xf7,
                               0x48, 0xac, 0x6d, 0x7e, 0x2b, 0x28, 0x4c, 0xe8};
  uint8_t byteswillprops1[] = {0xbd, 0xe9, 0xcd, 0x7b, 0x64, 0x8a, 0xe6, 0xef, 0xcf};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops3[] = {0x3,  0xbd, 0x66, 0xbe, 0x78, 0x10, 0xeb, 0xfd, 0x75, 0xaf, 0x66, 0xef, 0x2e, 0x7a,
                               0xd7, 0xb2, 0x50, 0x96, 0xb7, 0x3f, 0xc2, 0x23, 0xc0, 0x2e, 0x2d, 0x53, 0xaf, 0x5a};
  uint8_t byteswillprops4[] = {0x1b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12196}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25354}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18349}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22997}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {12, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2,  0x46, 0x8b, 0xb6, 0x64, 0xec, 0x26, 0xe8, 0x30, 0xdc, 0xf6, 0x96,
                                0x18, 0xd2, 0x93, 0x4b, 0xf5, 0x4f, 0xa0, 0x57, 0x2a, 0x44, 0x91, 0xca};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xff, 0x8a, 0x54, 0x9f, 0xc3, 0x5b, 0x74, 0x4e, 0xa9,
                                  0xf4, 0xc8, 0x2a, 0xe2, 0x2f, 0x5,  0xee, 0xfb, 0x13};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23007;
  uint8_t client_id_bytes[] = {0xac, 0xe9, 0xd1, 0xaa, 0x69, 0x8d};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\162\167;\233}\166*\194\SO5I", _password = Just
// "\206\SYN\252];b\f|\249\239\199!!\ETB\142fz\153\250>bv\DC1\ETX\134", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "\DELF\240\209\&7W\203U~\ETBsd", _willMsg = "\146\191]\f|", _willProps =
// [PropResponseInformation "\r\f}~KATl\198M\RS.\204{\159",PropSessionExpiryInterval 25708,PropWillDelayInterval
// 17400,PropWillDelayInterval 9074,PropRequestProblemInformation 12,PropCorrelationData
// "ol\232jq`\145\138\242\162\147!\RSv\186",PropAuthenticationData "",PropMessageExpiryInterval 20784,PropUserProperty
// "\206?\SO\apG\213\229\214\155\a(\193\DEL\201\247\250\193\GSuVi\238\143x\178p"
// "\230\&1Q]\EOT5\219:\187Pk\247Maq\135\135\DLE\SYN\204",PropSubscriptionIdentifier 20,PropRequestResponseInformation
// 185,PropCorrelationData "T\147Q\177\191LL @\ESC1\SUB-K\154EI\218\SOH\171\227\160 \161\226",PropReasonString
// "\196\187G\239\175\202\139"]}), _cleanSession = True, _keepAlive = 7161, _connID =
// "AG\180\214\&5\245\a\196\164Fq\209\141\250>\246\RS", _properties = [PropMessageExpiryInterval
// 22623,PropWildcardSubscriptionAvailable 116,PropPayloadFormatIndicator 197,PropRetainAvailable
// 197,PropTopicAliasMaximum 15093,PropResponseTopic
// "\EOT$~\SO\186\t\152\162\237\149\&5\RS\178\131\135Va\211#+\185@\176?\186",PropReceiveMaximum 8870,PropRetainAvailable
// 250,PropWildcardSubscriptionAvailable 67,PropAuthenticationMethod "\169\239\RS\220",PropWillDelayInterval
// 6620,PropResponseInformation
// "\178\220E\ACK\196\DC4^\199=\251)]z\254M\254X\v\155d",PropSubscriptionIdentifierAvailable 152,PropTopicAliasMaximum
// 8982,PropAuthenticationMethod
// "L\226eG\159\233\153!\192p\234\&5\182\145\219h\171\"8\234fE$\225",PropPayloadFormatIndicator
// 10,PropSharedSubscriptionAvailable 82,PropUserProperty "\188\145\164" "\168\227\143z1\173",PropSubscriptionIdentifier
// 26,PropResponseTopic "\213x",PropResponseTopic "\230\145~\158\144\EM\175\129@\249",PropServerReference
// "\v\165+\ETX\DC3\161=\t5&]\181\148",PropRequestProblemInformation 160,PropResponseInformation
// "\213s\220\ENQ{DSet\243=w\218*\SOH\DC3\245\164\SYN\193q\DC4\133",PropAuthenticationData
// "\SUB\200\165\247\231\188\193\251\226\187\231\137\SO{\142x&u\183Z\235\177xkB\159",PropTopicAliasMaximum
// 27750,PropMaximumPacketSize 15510]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0xe4, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x1b, 0xf9, 0xeb, 0x1,  0x2,  0x0,  0x0,  0x58,
      0x5f, 0x28, 0x74, 0x1,  0xc5, 0x25, 0xc5, 0x22, 0x3a, 0xf5, 0x8,  0x0,  0x19, 0x4,  0x24, 0x7e, 0xe,  0xba, 0x9,
      0x98, 0xa2, 0xed, 0x95, 0x35, 0x1e, 0xb2, 0x83, 0x87, 0x56, 0x61, 0xd3, 0x23, 0x2b, 0xb9, 0x40, 0xb0, 0x3f, 0xba,
      0x21, 0x22, 0xa6, 0x25, 0xfa, 0x28, 0x43, 0x15, 0x0,  0x4,  0xa9, 0xef, 0x1e, 0xdc, 0x18, 0x0,  0x0,  0x19, 0xdc,
      0x1a, 0x0,  0x14, 0xb2, 0xdc, 0x45, 0x6,  0xc4, 0x14, 0x5e, 0xc7, 0x3d, 0xfb, 0x29, 0x5d, 0x7a, 0xfe, 0x4d, 0xfe,
      0x58, 0xb,  0x9b, 0x64, 0x29, 0x98, 0x22, 0x23, 0x16, 0x15, 0x0,  0x18, 0x4c, 0xe2, 0x65, 0x47, 0x9f, 0xe9, 0x99,
      0x21, 0xc0, 0x70, 0xea, 0x35, 0xb6, 0x91, 0xdb, 0x68, 0xab, 0x22, 0x38, 0xea, 0x66, 0x45, 0x24, 0xe1, 0x1,  0xa,
      0x2a, 0x52, 0x26, 0x0,  0x3,  0xbc, 0x91, 0xa4, 0x0,  0x6,  0xa8, 0xe3, 0x8f, 0x7a, 0x31, 0xad, 0xb,  0x1a, 0x8,
      0x0,  0x2,  0xd5, 0x78, 0x8,  0x0,  0xa,  0xe6, 0x91, 0x7e, 0x9e, 0x90, 0x19, 0xaf, 0x81, 0x40, 0xf9, 0x1c, 0x0,
      0xd,  0xb,  0xa5, 0x2b, 0x3,  0x13, 0xa1, 0x3d, 0x9,  0x35, 0x26, 0x5d, 0xb5, 0x94, 0x17, 0xa0, 0x1a, 0x0,  0x17,
      0xd5, 0x73, 0xdc, 0x5,  0x7b, 0x44, 0x53, 0x65, 0x74, 0xf3, 0x3d, 0x77, 0xda, 0x2a, 0x1,  0x13, 0xf5, 0xa4, 0x16,
      0xc1, 0x71, 0x14, 0x85, 0x16, 0x0,  0x1a, 0x1a, 0xc8, 0xa5, 0xf7, 0xe7, 0xbc, 0xc1, 0xfb, 0xe2, 0xbb, 0xe7, 0x89,
      0xe,  0x7b, 0x8e, 0x78, 0x26, 0x75, 0xb7, 0x5a, 0xeb, 0xb1, 0x78, 0x6b, 0x42, 0x9f, 0x22, 0x6c, 0x66, 0x27, 0x0,
      0x0,  0x3c, 0x96, 0x0,  0x11, 0x41, 0x47, 0xb4, 0xd6, 0x35, 0xf5, 0x7,  0xc4, 0xa4, 0x46, 0x71, 0xd1, 0x8d, 0xfa,
      0x3e, 0xf6, 0x1e, 0x9b, 0x1,  0x1a, 0x0,  0xf,  0xd,  0xc,  0x7d, 0x7e, 0x4b, 0x41, 0x54, 0x6c, 0xc6, 0x4d, 0x1e,
      0x2e, 0xcc, 0x7b, 0x9f, 0x11, 0x0,  0x0,  0x64, 0x6c, 0x18, 0x0,  0x0,  0x43, 0xf8, 0x18, 0x0,  0x0,  0x23, 0x72,
      0x17, 0xc,  0x9,  0x0,  0xf,  0x6f, 0x6c, 0xe8, 0x6a, 0x71, 0x60, 0x91, 0x8a, 0xf2, 0xa2, 0x93, 0x21, 0x1e, 0x76,
      0xba, 0x16, 0x0,  0x0,  0x2,  0x0,  0x0,  0x51, 0x30, 0x26, 0x0,  0x1b, 0xce, 0x3f, 0xe,  0x7,  0x70, 0x47, 0xd5,
      0xe5, 0xd6, 0x9b, 0x7,  0x28, 0xc1, 0x7f, 0xc9, 0xf7, 0xfa, 0xc1, 0x1d, 0x75, 0x56, 0x69, 0xee, 0x8f, 0x78, 0xb2,
      0x70, 0x0,  0x14, 0xe6, 0x31, 0x51, 0x5d, 0x4,  0x35, 0xdb, 0x3a, 0xbb, 0x50, 0x6b, 0xf7, 0x4d, 0x61, 0x71, 0x87,
      0x87, 0x10, 0x16, 0xcc, 0xb,  0x14, 0x19, 0xb9, 0x9,  0x0,  0x19, 0x54, 0x93, 0x51, 0xb1, 0xbf, 0x4c, 0x4c, 0x20,
      0x40, 0x1b, 0x31, 0x1a, 0x2d, 0x4b, 0x9a, 0x45, 0x49, 0xda, 0x1,  0xab, 0xe3, 0xa0, 0x20, 0xa1, 0xe2, 0x1f, 0x0,
      0x7,  0xc4, 0xbb, 0x47, 0xef, 0xaf, 0xca, 0x8b, 0x0,  0xc,  0x7f, 0x46, 0xf0, 0xd1, 0x37, 0x57, 0xcb, 0x55, 0x7e,
      0x17, 0x73, 0x64, 0x0,  0x5,  0x92, 0xbf, 0x5d, 0xc,  0x7c, 0x0,  0xb,  0xa2, 0xa7, 0x3b, 0xe9, 0x7d, 0xa6, 0x2a,
      0xc2, 0xe,  0x35, 0x49, 0x0,  0x19, 0xce, 0x16, 0xfc, 0x5d, 0x3b, 0x62, 0xc,  0x7c, 0xf9, 0xef, 0xc7, 0x21, 0x21,
      0x17, 0x8e, 0x66, 0x7a, 0x99, 0xfa, 0x3e, 0x62, 0x76, 0x11, 0x3,  0x86};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4,  0x24, 0x7e, 0xe,  0xba, 0x9,  0x98, 0xa2, 0xed, 0x95, 0x35, 0x1e, 0xb2,
                           0x83, 0x87, 0x56, 0x61, 0xd3, 0x23, 0x2b, 0xb9, 0x40, 0xb0, 0x3f, 0xba};
  uint8_t bytesprops1[] = {0xa9, 0xef, 0x1e, 0xdc};
  uint8_t bytesprops2[] = {0xb2, 0xdc, 0x45, 0x6,  0xc4, 0x14, 0x5e, 0xc7, 0x3d, 0xfb,
                           0x29, 0x5d, 0x7a, 0xfe, 0x4d, 0xfe, 0x58, 0xb,  0x9b, 0x64};
  uint8_t bytesprops3[] = {0x4c, 0xe2, 0x65, 0x47, 0x9f, 0xe9, 0x99, 0x21, 0xc0, 0x70, 0xea, 0x35,
                           0xb6, 0x91, 0xdb, 0x68, 0xab, 0x22, 0x38, 0xea, 0x66, 0x45, 0x24, 0xe1};
  uint8_t bytesprops5[] = {0xa8, 0xe3, 0x8f, 0x7a, 0x31, 0xad};
  uint8_t bytesprops4[] = {0xbc, 0x91, 0xa4};
  uint8_t bytesprops6[] = {0xd5, 0x78};
  uint8_t bytesprops7[] = {0xe6, 0x91, 0x7e, 0x9e, 0x90, 0x19, 0xaf, 0x81, 0x40, 0xf9};
  uint8_t bytesprops8[] = {0xb, 0xa5, 0x2b, 0x3, 0x13, 0xa1, 0x3d, 0x9, 0x35, 0x26, 0x5d, 0xb5, 0x94};
  uint8_t bytesprops9[] = {0xd5, 0x73, 0xdc, 0x5,  0x7b, 0x44, 0x53, 0x65, 0x74, 0xf3, 0x3d, 0x77,
                           0xda, 0x2a, 0x1,  0x13, 0xf5, 0xa4, 0x16, 0xc1, 0x71, 0x14, 0x85};
  uint8_t bytesprops10[] = {0x1a, 0xc8, 0xa5, 0xf7, 0xe7, 0xbc, 0xc1, 0xfb, 0xe2, 0xbb, 0xe7, 0x89, 0xe,
                            0x7b, 0x8e, 0x78, 0x26, 0x75, 0xb7, 0x5a, 0xeb, 0xb1, 0x78, 0x6b, 0x42, 0x9f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22623}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15093}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8870}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6620}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8982}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops4}, .v = {6, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27750}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15510}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd, 0xc, 0x7d, 0x7e, 0x4b, 0x41, 0x54, 0x6c, 0xc6, 0x4d, 0x1e, 0x2e, 0xcc, 0x7b, 0x9f};
  uint8_t byteswillprops1[] = {0x6f, 0x6c, 0xe8, 0x6a, 0x71, 0x60, 0x91, 0x8a,
                               0xf2, 0xa2, 0x93, 0x21, 0x1e, 0x76, 0xba};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops4[] = {0xe6, 0x31, 0x51, 0x5d, 0x4,  0x35, 0xdb, 0x3a, 0xbb, 0x50,
                               0x6b, 0xf7, 0x4d, 0x61, 0x71, 0x87, 0x87, 0x10, 0x16, 0xcc};
  uint8_t byteswillprops3[] = {0xce, 0x3f, 0xe,  0x7,  0x70, 0x47, 0xd5, 0xe5, 0xd6, 0x9b, 0x7,  0x28, 0xc1, 0x7f,
                               0xc9, 0xf7, 0xfa, 0xc1, 0x1d, 0x75, 0x56, 0x69, 0xee, 0x8f, 0x78, 0xb2, 0x70};
  uint8_t byteswillprops5[] = {0x54, 0x93, 0x51, 0xb1, 0xbf, 0x4c, 0x4c, 0x20, 0x40, 0x1b, 0x31, 0x1a, 0x2d,
                               0x4b, 0x9a, 0x45, 0x49, 0xda, 0x1,  0xab, 0xe3, 0xa0, 0x20, 0xa1, 0xe2};
  uint8_t byteswillprops6[] = {0xc4, 0xbb, 0x47, 0xef, 0xaf, 0xca, 0x8b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25708}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17400}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9074}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20784}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {27, (char*)&byteswillprops3}, .v = {20, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&byteswillprops6}}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7f, 0x46, 0xf0, 0xd1, 0x37, 0x57, 0xcb, 0x55, 0x7e, 0x17, 0x73, 0x64};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x92, 0xbf, 0x5d, 0xc, 0x7c};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7161;
  uint8_t client_id_bytes[] = {0x41, 0x47, 0xb4, 0xd6, 0x35, 0xf5, 0x7,  0xc4, 0xa4,
                               0x46, 0x71, 0xd1, 0x8d, 0xfa, 0x3e, 0xf6, 0x1e};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa2, 0xa7, 0x3b, 0xe9, 0x7d, 0xa6, 0x2a, 0xc2, 0xe, 0x35, 0x49};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xce, 0x16, 0xfc, 0x5d, 0x3b, 0x62, 0xc,  0x7c, 0xf9, 0xef, 0xc7, 0x21, 0x21,
                              0x17, 0x8e, 0x66, 0x7a, 0x99, 0xfa, 0x3e, 0x62, 0x76, 0x11, 0x3,  0x86};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\176gX", _password = Nothing, _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 30736, _connID = "\211\169\254\161\DLE", _properties = [PropSubscriptionIdentifier 28,PropContentType
// "av~m\140\233\EM\143\233\209\192\167\211",PropResponseTopic
// "\238\189\189T\191\133\200\153\142\214\241yDC",PropTopicAliasMaximum 10527]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x3d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x78, 0x10, 0x26, 0xb,  0x1c, 0x3,
                   0x0,  0xd,  0x61, 0x76, 0x7e, 0x6d, 0x8c, 0xe9, 0x19, 0x8f, 0xe9, 0xd1, 0xc0, 0xa7, 0xd3, 0x8,
                   0x0,  0xe,  0xee, 0xbd, 0xbd, 0x54, 0xbf, 0x85, 0xc8, 0x99, 0x8e, 0xd6, 0xf1, 0x79, 0x44, 0x43,
                   0x22, 0x29, 0x1f, 0x0,  0x5,  0xd3, 0xa9, 0xfe, 0xa1, 0x10, 0x0,  0x3,  0xb0, 0x67, 0x58};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x61, 0x76, 0x7e, 0x6d, 0x8c, 0xe9, 0x19, 0x8f, 0xe9, 0xd1, 0xc0, 0xa7, 0xd3};
  uint8_t bytesprops1[] = {0xee, 0xbd, 0xbd, 0x54, 0xbf, 0x85, 0xc8, 0x99, 0x8e, 0xd6, 0xf1, 0x79, 0x44, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10527}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30736;
  uint8_t client_id_bytes[] = {0xd3, 0xa9, 0xfe, 0xa1, 0x10};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb0, 0x67, 0x58};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\152\194\245\253\174\&7\EMM!8\179\176,\247\240\DC1\231\RS", _password = Just
// "/\242\177\206\FS\170L\220\250@\fO\156+2\DLE\GS\141\&5\180!\168t\129\133\aA\SO\213T", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "r\EOTA\136\195\188\137\213\144A\186\189\243\169\226\204\252",
// _willMsg = "\182\NAK", _willProps = [PropWildcardSubscriptionAvailable 103,PropAssignedClientIdentifier
// "D\255\207a\239K\166\248\143r\181&\232\167\n9j\140\167<po<J\229\f\174",PropTopicAliasMaximum 11917,PropReasonString
// "\142\136g\242\175\ETB\ETX\SOH+\234w",PropAssignedClientIdentifier
// "\206\200\220\227f\163k\252L\177\252\144.P\212\139x",PropSessionExpiryInterval 26203,PropRequestResponseInformation
// 158,PropRequestProblemInformation 39,PropMaximumQoS 179]}), _cleanSession = True, _keepAlive = 8837, _connID =
// "\229-\130\155\154a\214\248\214l\CAN\138\244\210%\168\154\156\DC1\241\133\227\&1", _properties = [PropMaximumQoS
// 252,PropSubscriptionIdentifierAvailable 27,PropRequestResponseInformation 150,PropSubscriptionIdentifier
// 15,PropSessionExpiryInterval 3446,PropMaximumPacketSize 1884,PropAuthenticationData "2\b\207",PropUserProperty
// "\204\SUB\227yB\DC4\vCF\161\184`\RS\238bb\198\175\178O" "",PropRequestResponseInformation
// 181,PropAuthenticationMethod "\GS\193\165\232j",PropContentType
// "\138\207\166\255W\FS\157\DC2]|\162+w\173\161\138\153\&5\202\150\nq\182",PropServerKeepAlive 9362,PropCorrelationData
// "(\154;9\DC4\ESCj\134Y\SYNA\175\145q\138Uv^\131Y'\199\201F\185\216\184S\252h",PropSubscriptionIdentifier 24]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xbb, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x22, 0x85, 0x7b, 0x24, 0xfc, 0x29, 0x1b, 0x19,
      0x96, 0xb,  0xf,  0x11, 0x0,  0x0,  0xd,  0x76, 0x27, 0x0,  0x0,  0x7,  0x5c, 0x16, 0x0,  0x3,  0x32, 0x8,  0xcf,
      0x26, 0x0,  0x14, 0xcc, 0x1a, 0xe3, 0x79, 0x42, 0x14, 0xb,  0x43, 0x46, 0xa1, 0xb8, 0x60, 0x1e, 0xee, 0x62, 0x62,
      0xc6, 0xaf, 0xb2, 0x4f, 0x0,  0x0,  0x19, 0xb5, 0x15, 0x0,  0x5,  0x1d, 0xc1, 0xa5, 0xe8, 0x6a, 0x3,  0x0,  0x17,
      0x8a, 0xcf, 0xa6, 0xff, 0x57, 0x1c, 0x9d, 0x12, 0x5d, 0x7c, 0xa2, 0x2b, 0x77, 0xad, 0xa1, 0x8a, 0x99, 0x35, 0xca,
      0x96, 0xa,  0x71, 0xb6, 0x13, 0x24, 0x92, 0x9,  0x0,  0x1e, 0x28, 0x9a, 0x3b, 0x39, 0x14, 0x1b, 0x6a, 0x86, 0x59,
      0x16, 0x41, 0xaf, 0x91, 0x71, 0x8a, 0x55, 0x76, 0x5e, 0x83, 0x59, 0x27, 0xc7, 0xc9, 0x46, 0xb9, 0xd8, 0xb8, 0x53,
      0xfc, 0x68, 0xb,  0x18, 0x0,  0x17, 0xe5, 0x2d, 0x82, 0x9b, 0x9a, 0x61, 0xd6, 0xf8, 0xd6, 0x6c, 0x18, 0x8a, 0xf4,
      0xd2, 0x25, 0xa8, 0x9a, 0x9c, 0x11, 0xf1, 0x85, 0xe3, 0x31, 0x50, 0x28, 0x67, 0x12, 0x0,  0x1b, 0x44, 0xff, 0xcf,
      0x61, 0xef, 0x4b, 0xa6, 0xf8, 0x8f, 0x72, 0xb5, 0x26, 0xe8, 0xa7, 0xa,  0x39, 0x6a, 0x8c, 0xa7, 0x3c, 0x70, 0x6f,
      0x3c, 0x4a, 0xe5, 0xc,  0xae, 0x22, 0x2e, 0x8d, 0x1f, 0x0,  0xb,  0x8e, 0x88, 0x67, 0xf2, 0xaf, 0x17, 0x3,  0x1,
      0x2b, 0xea, 0x77, 0x12, 0x0,  0x11, 0xce, 0xc8, 0xdc, 0xe3, 0x66, 0xa3, 0x6b, 0xfc, 0x4c, 0xb1, 0xfc, 0x90, 0x2e,
      0x50, 0xd4, 0x8b, 0x78, 0x11, 0x0,  0x0,  0x66, 0x5b, 0x19, 0x9e, 0x17, 0x27, 0x24, 0xb3, 0x0,  0x11, 0x72, 0x4,
      0x41, 0x88, 0xc3, 0xbc, 0x89, 0xd5, 0x90, 0x41, 0xba, 0xbd, 0xf3, 0xa9, 0xe2, 0xcc, 0xfc, 0x0,  0x2,  0xb6, 0x15,
      0x0,  0x12, 0x98, 0xc2, 0xf5, 0xfd, 0xae, 0x37, 0x19, 0x4d, 0x21, 0x38, 0xb3, 0xb0, 0x2c, 0xf7, 0xf0, 0x11, 0xe7,
      0x1e, 0x0,  0x1e, 0x2f, 0xf2, 0xb1, 0xce, 0x1c, 0xaa, 0x4c, 0xdc, 0xfa, 0x40, 0xc,  0x4f, 0x9c, 0x2b, 0x32, 0x10,
      0x1d, 0x8d, 0x35, 0xb4, 0x21, 0xa8, 0x74, 0x81, 0x85, 0x7,  0x41, 0xe,  0xd5, 0x54};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x32, 0x8, 0xcf};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops1[] = {0xcc, 0x1a, 0xe3, 0x79, 0x42, 0x14, 0xb,  0x43, 0x46, 0xa1,
                           0xb8, 0x60, 0x1e, 0xee, 0x62, 0x62, 0xc6, 0xaf, 0xb2, 0x4f};
  uint8_t bytesprops3[] = {0x1d, 0xc1, 0xa5, 0xe8, 0x6a};
  uint8_t bytesprops4[] = {0x8a, 0xcf, 0xa6, 0xff, 0x57, 0x1c, 0x9d, 0x12, 0x5d, 0x7c, 0xa2, 0x2b,
                           0x77, 0xad, 0xa1, 0x8a, 0x99, 0x35, 0xca, 0x96, 0xa,  0x71, 0xb6};
  uint8_t bytesprops5[] = {0x28, 0x9a, 0x3b, 0x39, 0x14, 0x1b, 0x6a, 0x86, 0x59, 0x16, 0x41, 0xaf, 0x91, 0x71, 0x8a,
                           0x55, 0x76, 0x5e, 0x83, 0x59, 0x27, 0xc7, 0xc9, 0x46, 0xb9, 0xd8, 0xb8, 0x53, 0xfc, 0x68};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3446}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1884}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {0, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9362}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x44, 0xff, 0xcf, 0x61, 0xef, 0x4b, 0xa6, 0xf8, 0x8f, 0x72, 0xb5, 0x26, 0xe8, 0xa7,
                               0xa,  0x39, 0x6a, 0x8c, 0xa7, 0x3c, 0x70, 0x6f, 0x3c, 0x4a, 0xe5, 0xc,  0xae};
  uint8_t byteswillprops1[] = {0x8e, 0x88, 0x67, 0xf2, 0xaf, 0x17, 0x3, 0x1, 0x2b, 0xea, 0x77};
  uint8_t byteswillprops2[] = {0xce, 0xc8, 0xdc, 0xe3, 0x66, 0xa3, 0x6b, 0xfc, 0x4c,
                               0xb1, 0xfc, 0x90, 0x2e, 0x50, 0xd4, 0x8b, 0x78};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11917}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26203}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 179}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x72, 0x4,  0x41, 0x88, 0xc3, 0xbc, 0x89, 0xd5, 0x90,
                                0x41, 0xba, 0xbd, 0xf3, 0xa9, 0xe2, 0xcc, 0xfc};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb6, 0x15};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8837;
  uint8_t client_id_bytes[] = {0xe5, 0x2d, 0x82, 0x9b, 0x9a, 0x61, 0xd6, 0xf8, 0xd6, 0x6c, 0x18, 0x8a,
                               0xf4, 0xd2, 0x25, 0xa8, 0x9a, 0x9c, 0x11, 0xf1, 0x85, 0xe3, 0x31};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x98, 0xc2, 0xf5, 0xfd, 0xae, 0x37, 0x19, 0x4d, 0x21,
                              0x38, 0xb3, 0xb0, 0x2c, 0xf7, 0xf0, 0x11, 0xe7, 0x1e};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2f, 0xf2, 0xb1, 0xce, 0x1c, 0xaa, 0x4c, 0xdc, 0xfa, 0x40, 0xc, 0x4f, 0x9c, 0x2b, 0x32,
                              0x10, 0x1d, 0x8d, 0x35, 0xb4, 0x21, 0xa8, 0x74, 0x81, 0x85, 0x7, 0x41, 0xe,  0xd5, 0x54};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Fl\165\191E\132:\161", _password = Nothing, _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS2, _willTopic = "\213\133\231\FS\130\ACKE\191\250\EM\neI\a\139\243\227\216J\222\222", _willMsg
// = "\247\199pz\189\158\163r[\131P\201w\133", _willProps = [PropServerReference "\252\218\134%
// p.\135\213\205\223o\223\230\248",PropPayloadFormatIndicator 226,PropContentType
// "\254\226\225\163\179\178\157\243\166G?\134^\243\195w\213\b\230t\174\185",PropMessageExpiryInterval
// 3225,PropMessageExpiryInterval 17734,PropReceiveMaximum 29099,PropSharedSubscriptionAvailable 174,PropReasonString
// "m\231@%,y\206\175",PropSubscriptionIdentifier 18,PropSessionExpiryInterval 20232,PropSharedSubscriptionAvailable
// 160,PropRetainAvailable 228,PropWillDelayInterval 18654,PropSessionExpiryInterval 10509,PropMessageExpiryInterval
// 24719,PropTopicAlias 13466,PropReasonString
// "\159\182\139\&3\128j\142}\b\153\175\154\190",PropRequestResponseInformation 93,PropSessionExpiryInterval
// 2330,PropTopicAliasMaximum 5301,PropServerKeepAlive 10209,PropAuthenticationMethod
// "^\218\144\219\t\210<\142\v\240\192\205\DC4>7\180\215wX\245",PropReasonString "",PropMaximumPacketSize
// 10882,PropSubscriptionIdentifierAvailable 84,PropAuthenticationMethod
// "d'v\161\242\222\155\141\236\225\180H\247B",PropAssignedClientIdentifier "\ACK\147}^]IXY%\RS\DC2|d\140"]}),
// _cleanSession = True, _keepAlive = 10218, _connID = "\242\150&X\DC2\211\232+\139", _properties = [PropMaximumQoS
// 211,PropSessionExpiryInterval 6199,PropMaximumPacketSize 19431,PropMessageExpiryInterval
// 20624,PropRequestResponseInformation 50,PropTopicAlias 28881,PropContentType
// "\187dw\204\ACK\253\134",PropAuthenticationData "\ETB\204%\fG\182\186^U\238\232\&6\146",PropPayloadFormatIndicator
// 69,PropRetainAvailable 103,PropContentType "p\247\181Gq\222t\t",PropUserProperty "N\154\ak\147\184\186K\DEL\SOHX\GS2"
// "p'\FSsI\ENQCUvg5#\253\252\NUL\207\175J\171\SINc\b\179\198n\USa\186\"",PropServerReference
// "\171-(\161\245\EM?\233\140\228\133Xg?\151\DC4-}\225\&9\246",PropSessionExpiryInterval 21133,PropAuthenticationData
// "?\ETB\ESC\159\213\STX\US\255[\b\RS0'JB\248",PropServerReference
// "\143z\192\143\133\235:L\146x\228\221\182\180\ETX\190\r\188H\244",PropMessageExpiryInterval
// 2372,PropSubscriptionIdentifier 23]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb6, 0x27, 0xea, 0xbd, 0x1,  0x24, 0xd3, 0x11, 0x0,
      0x0,  0x18, 0x37, 0x27, 0x0,  0x0,  0x4b, 0xe7, 0x2,  0x0,  0x0,  0x50, 0x90, 0x19, 0x32, 0x23, 0x70, 0xd1, 0x3,
      0x0,  0x7,  0xbb, 0x64, 0x77, 0xcc, 0x6,  0xfd, 0x86, 0x16, 0x0,  0xd,  0x17, 0xcc, 0x25, 0xc,  0x47, 0xb6, 0xba,
      0x5e, 0x55, 0xee, 0xe8, 0x36, 0x92, 0x1,  0x45, 0x25, 0x67, 0x3,  0x0,  0x8,  0x70, 0xf7, 0xb5, 0x47, 0x71, 0xde,
      0x74, 0x9,  0x26, 0x0,  0xd,  0x4e, 0x9a, 0x7,  0x6b, 0x93, 0xb8, 0xba, 0x4b, 0x7f, 0x1,  0x58, 0x1d, 0x32, 0x0,
      0x1e, 0x70, 0x27, 0x1c, 0x73, 0x49, 0x5,  0x43, 0x55, 0x76, 0x67, 0x35, 0x23, 0xfd, 0xfc, 0x0,  0xcf, 0xaf, 0x4a,
      0xab, 0xf,  0x4e, 0x63, 0x8,  0xb3, 0xc6, 0x6e, 0x1f, 0x61, 0xba, 0x22, 0x1c, 0x0,  0x15, 0xab, 0x2d, 0x28, 0xa1,
      0xf5, 0x19, 0x3f, 0xe9, 0x8c, 0xe4, 0x85, 0x58, 0x67, 0x3f, 0x97, 0x14, 0x2d, 0x7d, 0xe1, 0x39, 0xf6, 0x11, 0x0,
      0x0,  0x52, 0x8d, 0x16, 0x0,  0x10, 0x3f, 0x17, 0x1b, 0x9f, 0xd5, 0x2,  0x1f, 0xff, 0x5b, 0x8,  0x1e, 0x30, 0x27,
      0x4a, 0x42, 0xf8, 0x1c, 0x0,  0x14, 0x8f, 0x7a, 0xc0, 0x8f, 0x85, 0xeb, 0x3a, 0x4c, 0x92, 0x78, 0xe4, 0xdd, 0xb6,
      0xb4, 0x3,  0xbe, 0xd,  0xbc, 0x48, 0xf4, 0x2,  0x0,  0x0,  0x9,  0x44, 0xb,  0x17, 0x0,  0x9,  0xf2, 0x96, 0x26,
      0x58, 0x12, 0xd3, 0xe8, 0x2b, 0x8b, 0xc4, 0x1,  0x1c, 0x0,  0xf,  0xfc, 0xda, 0x86, 0x25, 0x20, 0x70, 0x2e, 0x87,
      0xd5, 0xcd, 0xdf, 0x6f, 0xdf, 0xe6, 0xf8, 0x1,  0xe2, 0x3,  0x0,  0x16, 0xfe, 0xe2, 0xe1, 0xa3, 0xb3, 0xb2, 0x9d,
      0xf3, 0xa6, 0x47, 0x3f, 0x86, 0x5e, 0xf3, 0xc3, 0x77, 0xd5, 0x8,  0xe6, 0x74, 0xae, 0xb9, 0x2,  0x0,  0x0,  0xc,
      0x99, 0x2,  0x0,  0x0,  0x45, 0x46, 0x21, 0x71, 0xab, 0x2a, 0xae, 0x1f, 0x0,  0x8,  0x6d, 0xe7, 0x40, 0x25, 0x2c,
      0x79, 0xce, 0xaf, 0xb,  0x12, 0x11, 0x0,  0x0,  0x4f, 0x8,  0x2a, 0xa0, 0x25, 0xe4, 0x18, 0x0,  0x0,  0x48, 0xde,
      0x11, 0x0,  0x0,  0x29, 0xd,  0x2,  0x0,  0x0,  0x60, 0x8f, 0x23, 0x34, 0x9a, 0x1f, 0x0,  0xd,  0x9f, 0xb6, 0x8b,
      0x33, 0x80, 0x6a, 0x8e, 0x7d, 0x8,  0x99, 0xaf, 0x9a, 0xbe, 0x19, 0x5d, 0x11, 0x0,  0x0,  0x9,  0x1a, 0x22, 0x14,
      0xb5, 0x13, 0x27, 0xe1, 0x15, 0x0,  0x14, 0x5e, 0xda, 0x90, 0xdb, 0x9,  0xd2, 0x3c, 0x8e, 0xb,  0xf0, 0xc0, 0xcd,
      0x14, 0x3e, 0x37, 0xb4, 0xd7, 0x77, 0x58, 0xf5, 0x1f, 0x0,  0x0,  0x27, 0x0,  0x0,  0x2a, 0x82, 0x29, 0x54, 0x15,
      0x0,  0xe,  0x64, 0x27, 0x76, 0xa1, 0xf2, 0xde, 0x9b, 0x8d, 0xec, 0xe1, 0xb4, 0x48, 0xf7, 0x42, 0x12, 0x0,  0xe,
      0x6,  0x93, 0x7d, 0x5e, 0x5d, 0x49, 0x58, 0x59, 0x25, 0x1e, 0x12, 0x7c, 0x64, 0x8c, 0x0,  0x15, 0xd5, 0x85, 0xe7,
      0x1c, 0x82, 0x6,  0x45, 0xbf, 0xfa, 0x19, 0xa,  0x65, 0x49, 0x7,  0x8b, 0xf3, 0xe3, 0xd8, 0x4a, 0xde, 0xde, 0x0,
      0xe,  0xf7, 0xc7, 0x70, 0x7a, 0xbd, 0x9e, 0xa3, 0x72, 0x5b, 0x83, 0x50, 0xc9, 0x77, 0x85, 0x0,  0x8,  0x46, 0x6c,
      0xa5, 0xbf, 0x45, 0x84, 0x3a, 0xa1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbb, 0x64, 0x77, 0xcc, 0x6, 0xfd, 0x86};
  uint8_t bytesprops1[] = {0x17, 0xcc, 0x25, 0xc, 0x47, 0xb6, 0xba, 0x5e, 0x55, 0xee, 0xe8, 0x36, 0x92};
  uint8_t bytesprops2[] = {0x70, 0xf7, 0xb5, 0x47, 0x71, 0xde, 0x74, 0x9};
  uint8_t bytesprops4[] = {0x70, 0x27, 0x1c, 0x73, 0x49, 0x5,  0x43, 0x55, 0x76, 0x67, 0x35, 0x23, 0xfd, 0xfc, 0x0,
                           0xcf, 0xaf, 0x4a, 0xab, 0xf,  0x4e, 0x63, 0x8,  0xb3, 0xc6, 0x6e, 0x1f, 0x61, 0xba, 0x22};
  uint8_t bytesprops3[] = {0x4e, 0x9a, 0x7, 0x6b, 0x93, 0xb8, 0xba, 0x4b, 0x7f, 0x1, 0x58, 0x1d, 0x32};
  uint8_t bytesprops5[] = {0xab, 0x2d, 0x28, 0xa1, 0xf5, 0x19, 0x3f, 0xe9, 0x8c, 0xe4, 0x85,
                           0x58, 0x67, 0x3f, 0x97, 0x14, 0x2d, 0x7d, 0xe1, 0x39, 0xf6};
  uint8_t bytesprops6[] = {0x3f, 0x17, 0x1b, 0x9f, 0xd5, 0x2,  0x1f, 0xff,
                           0x5b, 0x8,  0x1e, 0x30, 0x27, 0x4a, 0x42, 0xf8};
  uint8_t bytesprops7[] = {0x8f, 0x7a, 0xc0, 0x8f, 0x85, 0xeb, 0x3a, 0x4c, 0x92, 0x78,
                           0xe4, 0xdd, 0xb6, 0xb4, 0x3,  0xbe, 0xd,  0xbc, 0x48, 0xf4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6199}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19431}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20624}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28881}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops3}, .v = {30, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21133}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2372}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xfc, 0xda, 0x86, 0x25, 0x20, 0x70, 0x2e, 0x87,
                               0xd5, 0xcd, 0xdf, 0x6f, 0xdf, 0xe6, 0xf8};
  uint8_t byteswillprops1[] = {0xfe, 0xe2, 0xe1, 0xa3, 0xb3, 0xb2, 0x9d, 0xf3, 0xa6, 0x47, 0x3f,
                               0x86, 0x5e, 0xf3, 0xc3, 0x77, 0xd5, 0x8,  0xe6, 0x74, 0xae, 0xb9};
  uint8_t byteswillprops2[] = {0x6d, 0xe7, 0x40, 0x25, 0x2c, 0x79, 0xce, 0xaf};
  uint8_t byteswillprops3[] = {0x9f, 0xb6, 0x8b, 0x33, 0x80, 0x6a, 0x8e, 0x7d, 0x8, 0x99, 0xaf, 0x9a, 0xbe};
  uint8_t byteswillprops4[] = {0x5e, 0xda, 0x90, 0xdb, 0x9,  0xd2, 0x3c, 0x8e, 0xb,  0xf0,
                               0xc0, 0xcd, 0x14, 0x3e, 0x37, 0xb4, 0xd7, 0x77, 0x58, 0xf5};
  uint8_t byteswillprops5[] = {0};
  uint8_t byteswillprops6[] = {0x64, 0x27, 0x76, 0xa1, 0xf2, 0xde, 0x9b, 0x8d, 0xec, 0xe1, 0xb4, 0x48, 0xf7, 0x42};
  uint8_t byteswillprops7[] = {0x6, 0x93, 0x7d, 0x5e, 0x5d, 0x49, 0x58, 0x59, 0x25, 0x1e, 0x12, 0x7c, 0x64, 0x8c};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3225}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17734}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29099}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20232}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18654}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10509}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24719}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13466}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2330}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5301}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10209}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10882}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd5, 0x85, 0xe7, 0x1c, 0x82, 0x6,  0x45, 0xbf, 0xfa, 0x19, 0xa,
                                0x65, 0x49, 0x7,  0x8b, 0xf3, 0xe3, 0xd8, 0x4a, 0xde, 0xde};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf7, 0xc7, 0x70, 0x7a, 0xbd, 0x9e, 0xa3, 0x72, 0x5b, 0x83, 0x50, 0xc9, 0x77, 0x85};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10218;
  uint8_t client_id_bytes[] = {0xf2, 0x96, 0x26, 0x58, 0x12, 0xd3, 0xe8, 0x2b, 0x8b};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x46, 0x6c, 0xa5, 0xbf, 0x45, 0x84, 0x3a, 0xa1};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Sz8i\155\185\247\FSM\223\r`\"\187\ACK\244\ETB7(\218^\ETX~\231o+\166\\", _password =
// Just "\254", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\178\171\DC2\211\200\EM\184\SOH\SI1\182\142\236\165\201\180\217\179\236y\215\n", _willMsg =
// "\176\DC3\142\CAN5\229j\140\194\241\152", _willProps = [PropRequestProblemInformation 131,PropMaximumQoS
// 5,PropSessionExpiryInterval 25356,PropRequestProblemInformation 220,PropAssignedClientIdentifier
// "\247N:\229H>\180",PropAuthenticationData
// "\222\&4P\205\194<\166\217*\151\250\154\160J\212\220l\ETBc\142",PropServerReference
// "\SOH.%\177\191E$I\222\247m\147\230\186G\218\&4T\219C\221\242\&0\bX\217\ESC{",PropContentType
// "\197,\NAK\140\CAN\192\181\233\243\&3\EOTFs\190\185\255\152\232\ETB\DC1Mq\169\DEL",PropReasonString
// "\f\239}\153Tp`+\CANn\187\197s\245\CAN\246\151",PropUserProperty "\167-4\244"
// "\NULY\201\143\168x\214\198\142?\203$\159\137\210\&5)",PropRequestResponseInformation 39,PropUserProperty "s"
// "v\198\128\215\&1-9_\167\&8\129\\\250\220\STX\212;\215\228d",PropPayloadFormatIndicator 12,PropResponseInformation
// "Be\171\151\238\232\167#YV\133HcN\199\190\234J\166\176\167B+Y\v:",PropCorrelationData
// "5\157\228cG\224\152",PropServerKeepAlive 31492,PropTopicAlias 13537,PropRequestResponseInformation
// 163,PropAuthenticationData "S9L\176\223\EOTR\249.'C\188}",PropMaximumPacketSize 29119,PropAuthenticationData
// "\171{\DC3\240\194L\167\199\180\CANW\SYN\187\&2\173D\STX7\190\240!Cr\205\188\181\200_.\SO",PropUserProperty
// "x$QG\NAK\234\246\242\&2]\179a\235\216" "\225\144p\163cy\134\187>4\191
// \143\ESC\215[#\246\166\154\ETXx|29l",PropRequestResponseInformation 126]}), _cleanSession = True, _keepAlive = 13826,
// _connID = "eYUoE\DELM\180&\227\132\v\STX\ESC\198\183?\245\247n\197\DC1", _properties = [PropMessageExpiryInterval
// 32766,PropSharedSubscriptionAvailable 26,PropTopicAlias 12471,PropSubscriptionIdentifierAvailable 210,PropContentType
// "\171wd\141\154h\DEL\215a\191i\b\235\SOt\169)\191",PropUserProperty "\176\SO\245"
// "\139\ACK\136\148\&9\138\&5\237\132\ETB1!!\193\SUBN`\145]",PropAuthenticationMethod
// "\181\166\205}\200\176?\210-\207\220v?X\212gX\187\&8\162",PropSharedSubscriptionAvailable
// 75,PropRequestProblemInformation 208,PropRequestProblemInformation 25,PropWillDelayInterval
// 27174,PropWildcardSubscriptionAvailable 127,PropPayloadFormatIndicator 5,PropAssignedClientIdentifier
// "/\SOHl\254\189\222\198x\219\180\188",PropRequestProblemInformation 198,PropReasonString
// "\240\nb\151\142\130\224ZbwA\SYN\189<E",PropRequestResponseInformation 150,PropUserProperty
// "\230\250\167\202\172\DC4aw6\234\v{s\143N" "\165\128\EM\134\242\136\231}",PropWildcardSubscriptionAvailable
// 74,PropTopicAliasMaximum 14655]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0xd9, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf6, 0x36, 0x2,  0xa7, 0x1,  0x2,  0x0,  0x0,  0x7f,
      0xfe, 0x2a, 0x1a, 0x23, 0x30, 0xb7, 0x29, 0xd2, 0x3,  0x0,  0x12, 0xab, 0x77, 0x64, 0x8d, 0x9a, 0x68, 0x7f, 0xd7,
      0x61, 0xbf, 0x69, 0x8,  0xeb, 0xe,  0x74, 0xa9, 0x29, 0xbf, 0x26, 0x0,  0x3,  0xb0, 0xe,  0xf5, 0x0,  0x13, 0x8b,
      0x6,  0x88, 0x94, 0x39, 0x8a, 0x35, 0xed, 0x84, 0x17, 0x31, 0x21, 0x21, 0xc1, 0x1a, 0x4e, 0x60, 0x91, 0x5d, 0x15,
      0x0,  0x14, 0xb5, 0xa6, 0xcd, 0x7d, 0xc8, 0xb0, 0x3f, 0xd2, 0x2d, 0xcf, 0xdc, 0x76, 0x3f, 0x58, 0xd4, 0x67, 0x58,
      0xbb, 0x38, 0xa2, 0x2a, 0x4b, 0x17, 0xd0, 0x17, 0x19, 0x18, 0x0,  0x0,  0x6a, 0x26, 0x28, 0x7f, 0x1,  0x5,  0x12,
      0x0,  0xb,  0x2f, 0x1,  0x6c, 0xfe, 0xbd, 0xde, 0xc6, 0x78, 0xdb, 0xb4, 0xbc, 0x17, 0xc6, 0x1f, 0x0,  0xf,  0xf0,
      0xa,  0x62, 0x97, 0x8e, 0x82, 0xe0, 0x5a, 0x62, 0x77, 0x41, 0x16, 0xbd, 0x3c, 0x45, 0x19, 0x96, 0x26, 0x0,  0xf,
      0xe6, 0xfa, 0xa7, 0xca, 0xac, 0x14, 0x61, 0x77, 0x36, 0xea, 0xb,  0x7b, 0x73, 0x8f, 0x4e, 0x0,  0x8,  0xa5, 0x80,
      0x19, 0x86, 0xf2, 0x88, 0xe7, 0x7d, 0x28, 0x4a, 0x22, 0x39, 0x3f, 0x0,  0x16, 0x65, 0x59, 0x55, 0x6f, 0x45, 0x7f,
      0x4d, 0xb4, 0x26, 0xe3, 0x84, 0xb,  0x2,  0x1b, 0xc6, 0xb7, 0x3f, 0xf5, 0xf7, 0x6e, 0xc5, 0x11, 0xc6, 0x2,  0x17,
      0x83, 0x24, 0x5,  0x11, 0x0,  0x0,  0x63, 0xc,  0x17, 0xdc, 0x12, 0x0,  0x7,  0xf7, 0x4e, 0x3a, 0xe5, 0x48, 0x3e,
      0xb4, 0x16, 0x0,  0x14, 0xde, 0x34, 0x50, 0xcd, 0xc2, 0x3c, 0xa6, 0xd9, 0x2a, 0x97, 0xfa, 0x9a, 0xa0, 0x4a, 0xd4,
      0xdc, 0x6c, 0x17, 0x63, 0x8e, 0x1c, 0x0,  0x1c, 0x1,  0x2e, 0x25, 0xb1, 0xbf, 0x45, 0x24, 0x49, 0xde, 0xf7, 0x6d,
      0x93, 0xe6, 0xba, 0x47, 0xda, 0x34, 0x54, 0xdb, 0x43, 0xdd, 0xf2, 0x30, 0x8,  0x58, 0xd9, 0x1b, 0x7b, 0x3,  0x0,
      0x18, 0xc5, 0x2c, 0x15, 0x8c, 0x18, 0xc0, 0xb5, 0xe9, 0xf3, 0x33, 0x4,  0x46, 0x73, 0xbe, 0xb9, 0xff, 0x98, 0xe8,
      0x17, 0x11, 0x4d, 0x71, 0xa9, 0x7f, 0x1f, 0x0,  0x11, 0xc,  0xef, 0x7d, 0x99, 0x54, 0x70, 0x60, 0x2b, 0x18, 0x6e,
      0xbb, 0xc5, 0x73, 0xf5, 0x18, 0xf6, 0x97, 0x26, 0x0,  0x4,  0xa7, 0x2d, 0x34, 0xf4, 0x0,  0x11, 0x0,  0x59, 0xc9,
      0x8f, 0xa8, 0x78, 0xd6, 0xc6, 0x8e, 0x3f, 0xcb, 0x24, 0x9f, 0x89, 0xd2, 0x35, 0x29, 0x19, 0x27, 0x26, 0x0,  0x1,
      0x73, 0x0,  0x14, 0x76, 0xc6, 0x80, 0xd7, 0x31, 0x2d, 0x39, 0x5f, 0xa7, 0x38, 0x81, 0x5c, 0xfa, 0xdc, 0x2,  0xd4,
      0x3b, 0xd7, 0xe4, 0x64, 0x1,  0xc,  0x1a, 0x0,  0x1a, 0x42, 0x65, 0xab, 0x97, 0xee, 0xe8, 0xa7, 0x23, 0x59, 0x56,
      0x85, 0x48, 0x63, 0x4e, 0xc7, 0xbe, 0xea, 0x4a, 0xa6, 0xb0, 0xa7, 0x42, 0x2b, 0x59, 0xb,  0x3a, 0x9,  0x0,  0x7,
      0x35, 0x9d, 0xe4, 0x63, 0x47, 0xe0, 0x98, 0x13, 0x7b, 0x4,  0x23, 0x34, 0xe1, 0x19, 0xa3, 0x16, 0x0,  0xd,  0x53,
      0x39, 0x4c, 0xb0, 0xdf, 0x4,  0x52, 0xf9, 0x2e, 0x27, 0x43, 0xbc, 0x7d, 0x27, 0x0,  0x0,  0x71, 0xbf, 0x16, 0x0,
      0x1e, 0xab, 0x7b, 0x13, 0xf0, 0xc2, 0x4c, 0xa7, 0xc7, 0xb4, 0x18, 0x57, 0x16, 0xbb, 0x32, 0xad, 0x44, 0x2,  0x37,
      0xbe, 0xf0, 0x21, 0x43, 0x72, 0xcd, 0xbc, 0xb5, 0xc8, 0x5f, 0x2e, 0xe,  0x26, 0x0,  0xe,  0x78, 0x24, 0x51, 0x47,
      0x15, 0xea, 0xf6, 0xf2, 0x32, 0x5d, 0xb3, 0x61, 0xeb, 0xd8, 0x0,  0x1a, 0xe1, 0x90, 0x70, 0xa3, 0x63, 0x79, 0x86,
      0xbb, 0x3e, 0x34, 0xbf, 0x20, 0x8f, 0x1b, 0xd7, 0x5b, 0x23, 0xf6, 0xa6, 0x9a, 0x3,  0x78, 0x7c, 0x32, 0x39, 0x6c,
      0x19, 0x7e, 0x0,  0x16, 0xb2, 0xab, 0x12, 0xd3, 0xc8, 0x19, 0xb8, 0x1,  0xf,  0x31, 0xb6, 0x8e, 0xec, 0xa5, 0xc9,
      0xb4, 0xd9, 0xb3, 0xec, 0x79, 0xd7, 0xa,  0x0,  0xb,  0xb0, 0x13, 0x8e, 0x18, 0x35, 0xe5, 0x6a, 0x8c, 0xc2, 0xf1,
      0x98, 0x0,  0x1c, 0x53, 0x7a, 0x38, 0x69, 0x9b, 0xb9, 0xf7, 0x1c, 0x4d, 0xdf, 0xd,  0x60, 0x22, 0xbb, 0x6,  0xf4,
      0x17, 0x37, 0x28, 0xda, 0x5e, 0x3,  0x7e, 0xe7, 0x6f, 0x2b, 0xa6, 0x5c, 0x0,  0x1,  0xfe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xab, 0x77, 0x64, 0x8d, 0x9a, 0x68, 0x7f, 0xd7, 0x61,
                           0xbf, 0x69, 0x8,  0xeb, 0xe,  0x74, 0xa9, 0x29, 0xbf};
  uint8_t bytesprops2[] = {0x8b, 0x6,  0x88, 0x94, 0x39, 0x8a, 0x35, 0xed, 0x84, 0x17,
                           0x31, 0x21, 0x21, 0xc1, 0x1a, 0x4e, 0x60, 0x91, 0x5d};
  uint8_t bytesprops1[] = {0xb0, 0xe, 0xf5};
  uint8_t bytesprops3[] = {0xb5, 0xa6, 0xcd, 0x7d, 0xc8, 0xb0, 0x3f, 0xd2, 0x2d, 0xcf,
                           0xdc, 0x76, 0x3f, 0x58, 0xd4, 0x67, 0x58, 0xbb, 0x38, 0xa2};
  uint8_t bytesprops4[] = {0x2f, 0x1, 0x6c, 0xfe, 0xbd, 0xde, 0xc6, 0x78, 0xdb, 0xb4, 0xbc};
  uint8_t bytesprops5[] = {0xf0, 0xa, 0x62, 0x97, 0x8e, 0x82, 0xe0, 0x5a, 0x62, 0x77, 0x41, 0x16, 0xbd, 0x3c, 0x45};
  uint8_t bytesprops7[] = {0xa5, 0x80, 0x19, 0x86, 0xf2, 0x88, 0xe7, 0x7d};
  uint8_t bytesprops6[] = {0xe6, 0xfa, 0xa7, 0xca, 0xac, 0x14, 0x61, 0x77, 0x36, 0xea, 0xb, 0x7b, 0x73, 0x8f, 0x4e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32766}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12471}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops1}, .v = {19, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27174}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops6}, .v = {8, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14655}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf7, 0x4e, 0x3a, 0xe5, 0x48, 0x3e, 0xb4};
  uint8_t byteswillprops1[] = {0xde, 0x34, 0x50, 0xcd, 0xc2, 0x3c, 0xa6, 0xd9, 0x2a, 0x97,
                               0xfa, 0x9a, 0xa0, 0x4a, 0xd4, 0xdc, 0x6c, 0x17, 0x63, 0x8e};
  uint8_t byteswillprops2[] = {0x1,  0x2e, 0x25, 0xb1, 0xbf, 0x45, 0x24, 0x49, 0xde, 0xf7, 0x6d, 0x93, 0xe6, 0xba,
                               0x47, 0xda, 0x34, 0x54, 0xdb, 0x43, 0xdd, 0xf2, 0x30, 0x8,  0x58, 0xd9, 0x1b, 0x7b};
  uint8_t byteswillprops3[] = {0xc5, 0x2c, 0x15, 0x8c, 0x18, 0xc0, 0xb5, 0xe9, 0xf3, 0x33, 0x4,  0x46,
                               0x73, 0xbe, 0xb9, 0xff, 0x98, 0xe8, 0x17, 0x11, 0x4d, 0x71, 0xa9, 0x7f};
  uint8_t byteswillprops4[] = {0xc,  0xef, 0x7d, 0x99, 0x54, 0x70, 0x60, 0x2b, 0x18,
                               0x6e, 0xbb, 0xc5, 0x73, 0xf5, 0x18, 0xf6, 0x97};
  uint8_t byteswillprops6[] = {0x0,  0x59, 0xc9, 0x8f, 0xa8, 0x78, 0xd6, 0xc6, 0x8e,
                               0x3f, 0xcb, 0x24, 0x9f, 0x89, 0xd2, 0x35, 0x29};
  uint8_t byteswillprops5[] = {0xa7, 0x2d, 0x34, 0xf4};
  uint8_t byteswillprops8[] = {0x76, 0xc6, 0x80, 0xd7, 0x31, 0x2d, 0x39, 0x5f, 0xa7, 0x38,
                               0x81, 0x5c, 0xfa, 0xdc, 0x2,  0xd4, 0x3b, 0xd7, 0xe4, 0x64};
  uint8_t byteswillprops7[] = {0x73};
  uint8_t byteswillprops9[] = {0x42, 0x65, 0xab, 0x97, 0xee, 0xe8, 0xa7, 0x23, 0x59, 0x56, 0x85, 0x48, 0x63,
                               0x4e, 0xc7, 0xbe, 0xea, 0x4a, 0xa6, 0xb0, 0xa7, 0x42, 0x2b, 0x59, 0xb,  0x3a};
  uint8_t byteswillprops10[] = {0x35, 0x9d, 0xe4, 0x63, 0x47, 0xe0, 0x98};
  uint8_t byteswillprops11[] = {0x53, 0x39, 0x4c, 0xb0, 0xdf, 0x4, 0x52, 0xf9, 0x2e, 0x27, 0x43, 0xbc, 0x7d};
  uint8_t byteswillprops12[] = {0xab, 0x7b, 0x13, 0xf0, 0xc2, 0x4c, 0xa7, 0xc7, 0xb4, 0x18,
                                0x57, 0x16, 0xbb, 0x32, 0xad, 0x44, 0x2,  0x37, 0xbe, 0xf0,
                                0x21, 0x43, 0x72, 0xcd, 0xbc, 0xb5, 0xc8, 0x5f, 0x2e, 0xe};
  uint8_t byteswillprops14[] = {0xe1, 0x90, 0x70, 0xa3, 0x63, 0x79, 0x86, 0xbb, 0x3e, 0x34, 0xbf, 0x20, 0x8f,
                                0x1b, 0xd7, 0x5b, 0x23, 0xf6, 0xa6, 0x9a, 0x3,  0x78, 0x7c, 0x32, 0x39, 0x6c};
  uint8_t byteswillprops13[] = {0x78, 0x24, 0x51, 0x47, 0x15, 0xea, 0xf6, 0xf2, 0x32, 0x5d, 0xb3, 0x61, 0xeb, 0xd8};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25356}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops5}, .v = {17, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {1, (char*)&byteswillprops7}, .v = {20, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31492}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13537}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29119}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {14, (char*)&byteswillprops13}, .v = {26, (char*)&byteswillprops14}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 126}},
  };

  lwmqtt_properties_t willprops = {23, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb2, 0xab, 0x12, 0xd3, 0xc8, 0x19, 0xb8, 0x1,  0xf,  0x31, 0xb6,
                                0x8e, 0xec, 0xa5, 0xc9, 0xb4, 0xd9, 0xb3, 0xec, 0x79, 0xd7, 0xa};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb0, 0x13, 0x8e, 0x18, 0x35, 0xe5, 0x6a, 0x8c, 0xc2, 0xf1, 0x98};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13826;
  uint8_t client_id_bytes[] = {0x65, 0x59, 0x55, 0x6f, 0x45, 0x7f, 0x4d, 0xb4, 0x26, 0xe3, 0x84,
                               0xb,  0x2,  0x1b, 0xc6, 0xb7, 0x3f, 0xf5, 0xf7, 0x6e, 0xc5, 0x11};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x53, 0x7a, 0x38, 0x69, 0x9b, 0xb9, 0xf7, 0x1c, 0x4d, 0xdf, 0xd,  0x60, 0x22, 0xbb,
                              0x6,  0xf4, 0x17, 0x37, 0x28, 0xda, 0x5e, 0x3,  0x7e, 0xe7, 0x6f, 0x2b, 0xa6, 0x5c};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xfe};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 28209, _connID = "\246\165\SI\142z\163\217\224;\170\DC1\145\161v\211e", _properties = [PropMaximumQoS
// 15,PropReasonString "|u*m\178\202|\twhl\196\202\241V\232\&9\157",PropReasonString
// "\152\163\&1#{\177{Bd<",PropAuthenticationMethod ">5\189\225\SO\175^\234s\EOT\183t\142\174\141*\161",PropMaximumQoS
// 133,PropMessageExpiryInterval 23894,PropRequestResponseInformation 67,PropReceiveMaximum 24058,PropContentType
// "\NAKYr\SYN",PropMaximumPacketSize 27205]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x6d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x0,  0x6e, 0x31, 0x50, 0x24, 0xf,  0x1f,
                   0x0,  0x12, 0x7c, 0x75, 0x2a, 0x6d, 0xb2, 0xca, 0x7c, 0x9,  0x77, 0x68, 0x6c, 0xc4, 0xca, 0xf1,
                   0x56, 0xe8, 0x39, 0x9d, 0x1f, 0x0,  0xa,  0x98, 0xa3, 0x31, 0x23, 0x7b, 0xb1, 0x7b, 0x42, 0x64,
                   0x3c, 0x15, 0x0,  0x11, 0x3e, 0x35, 0xbd, 0xe1, 0xe,  0xaf, 0x5e, 0xea, 0x73, 0x4,  0xb7, 0x74,
                   0x8e, 0xae, 0x8d, 0x2a, 0xa1, 0x24, 0x85, 0x2,  0x0,  0x0,  0x5d, 0x56, 0x19, 0x43, 0x21, 0x5d,
                   0xfa, 0x3,  0x0,  0x4,  0x15, 0x59, 0x72, 0x16, 0x27, 0x0,  0x0,  0x6a, 0x45, 0x0,  0x10, 0xf6,
                   0xa5, 0xf,  0x8e, 0x7a, 0xa3, 0xd9, 0xe0, 0x3b, 0xaa, 0x11, 0x91, 0xa1, 0x76, 0xd3, 0x65};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7c, 0x75, 0x2a, 0x6d, 0xb2, 0xca, 0x7c, 0x9,  0x77,
                           0x68, 0x6c, 0xc4, 0xca, 0xf1, 0x56, 0xe8, 0x39, 0x9d};
  uint8_t bytesprops1[] = {0x98, 0xa3, 0x31, 0x23, 0x7b, 0xb1, 0x7b, 0x42, 0x64, 0x3c};
  uint8_t bytesprops2[] = {0x3e, 0x35, 0xbd, 0xe1, 0xe,  0xaf, 0x5e, 0xea, 0x73,
                           0x4,  0xb7, 0x74, 0x8e, 0xae, 0x8d, 0x2a, 0xa1};
  uint8_t bytesprops3[] = {0x15, 0x59, 0x72, 0x16};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23894}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24058}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27205}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 28209;
  uint8_t client_id_bytes[] = {0xf6, 0xa5, 0xf,  0x8e, 0x7a, 0xa3, 0xd9, 0xe0,
                               0x3b, 0xaa, 0x11, 0x91, 0xa1, 0x76, 0xd3, 0x65};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\EOTj\208\234\&8&{\198\226R\a\248\140\138", _password = Just
// "]TT\227$0q<\DLE\201/\223\204\&4.\225\146v\209\240\154\SI\189O,\183\237", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\145\172\175\249\r\146", _willMsg = "\227:\v\SYNN\201\f", _willProps =
// [PropResponseTopic "X\152 <\n\135^\171\171;\nE",PropSessionExpiryInterval 22075,PropMessageExpiryInterval
// 4010,PropReceiveMaximum 25879,PropResponseTopic
// "n\239<\215q\137\138F\DC3\226z\194\CAN\230s]\198D\214",PropMessageExpiryInterval 10253,PropMaximumPacketSize
// 10461,PropAuthenticationMethod "\250|)\251Ae~\130/N\151\147\173",PropMessageExpiryInterval 20087,PropServerReference
// "\163\GSc\212\254\149\180Q\235I/\135`\143'\185\&7\233reH\252D\139\&5\203_\SYN",PropResponseInformation
// "v\DC4\STX\232\190\222\186O2",PropPayloadFormatIndicator 208,PropWildcardSubscriptionAvailable
// 125,PropSharedSubscriptionAvailable 127,PropUserProperty "N<\EM\170\156\227:\192\176"
// "u\157\229\222\SUB\255\DLE\174+|\182\228\226\143\248\250\156\240"]}), _cleanSession = False, _keepAlive = 12527,
// _connID = "7\EOT\224", _properties = [PropUserProperty "4\235z\197V\183\140{\249\DLE" "a\132\191R\144",PropTopicAlias
// 12939,PropRequestProblemInformation 86,PropWillDelayInterval 20660,PropSubscriptionIdentifierAvailable
// 84,PropRequestProblemInformation 66,PropReasonString
// "\210\225\186\225\241\GS\134\249\141F\239\DC3\246\&1",PropSubscriptionIdentifier 18,PropContentType
// "`\136\253\244\253\208\150\212\162vz}\177\&0#\132",PropPayloadFormatIndicator 80,PropRequestProblemInformation
// 43,PropCorrelationData "\193\177\210\217",PropWildcardSubscriptionAvailable 172,PropCorrelationData
// "5\f",PropWildcardSubscriptionAvailable 127,PropRequestProblemInformation 224,PropPayloadFormatIndicator
// 232,PropReasonString "\189x:\ETX>\176\239\SOa\167V\STX\147\SOH)\139",PropSharedSubscriptionAvailable 157]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0xe7, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x30, 0xef, 0x75, 0x26, 0x0,  0xa,  0x34, 0xeb,
      0x7a, 0xc5, 0x56, 0xb7, 0x8c, 0x7b, 0xf9, 0x10, 0x0,  0x5,  0x61, 0x84, 0xbf, 0x52, 0x90, 0x23, 0x32, 0x8b, 0x17,
      0x56, 0x18, 0x0,  0x0,  0x50, 0xb4, 0x29, 0x54, 0x17, 0x42, 0x1f, 0x0,  0xe,  0xd2, 0xe1, 0xba, 0xe1, 0xf1, 0x1d,
      0x86, 0xf9, 0x8d, 0x46, 0xef, 0x13, 0xf6, 0x31, 0xb,  0x12, 0x3,  0x0,  0x10, 0x60, 0x88, 0xfd, 0xf4, 0xfd, 0xd0,
      0x96, 0xd4, 0xa2, 0x76, 0x7a, 0x7d, 0xb1, 0x30, 0x23, 0x84, 0x1,  0x50, 0x17, 0x2b, 0x9,  0x0,  0x4,  0xc1, 0xb1,
      0xd2, 0xd9, 0x28, 0xac, 0x9,  0x0,  0x2,  0x35, 0xc,  0x28, 0x7f, 0x17, 0xe0, 0x1,  0xe8, 0x1f, 0x0,  0x10, 0xbd,
      0x78, 0x3a, 0x3,  0x3e, 0xb0, 0xef, 0xe,  0x61, 0xa7, 0x56, 0x2,  0x93, 0x1,  0x29, 0x8b, 0x2a, 0x9d, 0x0,  0x3,
      0x37, 0x4,  0xe0, 0xa2, 0x1,  0x8,  0x0,  0xc,  0x58, 0x98, 0x20, 0x3c, 0xa,  0x87, 0x5e, 0xab, 0xab, 0x3b, 0xa,
      0x45, 0x11, 0x0,  0x0,  0x56, 0x3b, 0x2,  0x0,  0x0,  0xf,  0xaa, 0x21, 0x65, 0x17, 0x8,  0x0,  0x13, 0x6e, 0xef,
      0x3c, 0xd7, 0x71, 0x89, 0x8a, 0x46, 0x13, 0xe2, 0x7a, 0xc2, 0x18, 0xe6, 0x73, 0x5d, 0xc6, 0x44, 0xd6, 0x2,  0x0,
      0x0,  0x28, 0xd,  0x27, 0x0,  0x0,  0x28, 0xdd, 0x15, 0x0,  0xd,  0xfa, 0x7c, 0x29, 0xfb, 0x41, 0x65, 0x7e, 0x82,
      0x2f, 0x4e, 0x97, 0x93, 0xad, 0x2,  0x0,  0x0,  0x4e, 0x77, 0x1c, 0x0,  0x1c, 0xa3, 0x1d, 0x63, 0xd4, 0xfe, 0x95,
      0xb4, 0x51, 0xeb, 0x49, 0x2f, 0x87, 0x60, 0x8f, 0x27, 0xb9, 0x37, 0xe9, 0x72, 0x65, 0x48, 0xfc, 0x44, 0x8b, 0x35,
      0xcb, 0x5f, 0x16, 0x1a, 0x0,  0x9,  0x76, 0x14, 0x2,  0xe8, 0xbe, 0xde, 0xba, 0x4f, 0x32, 0x1,  0xd0, 0x28, 0x7d,
      0x2a, 0x7f, 0x26, 0x0,  0x9,  0x4e, 0x3c, 0x19, 0xaa, 0x9c, 0xe3, 0x3a, 0xc0, 0xb0, 0x0,  0x12, 0x75, 0x9d, 0xe5,
      0xde, 0x1a, 0xff, 0x10, 0xae, 0x2b, 0x7c, 0xb6, 0xe4, 0xe2, 0x8f, 0xf8, 0xfa, 0x9c, 0xf0, 0x0,  0x6,  0x91, 0xac,
      0xaf, 0xf9, 0xd,  0x92, 0x0,  0x7,  0xe3, 0x3a, 0xb,  0x16, 0x4e, 0xc9, 0xc,  0x0,  0xe,  0x4,  0x6a, 0xd0, 0xea,
      0x38, 0x26, 0x7b, 0xc6, 0xe2, 0x52, 0x7,  0xf8, 0x8c, 0x8a, 0x0,  0x1b, 0x5d, 0x54, 0x54, 0xe3, 0x24, 0x30, 0x71,
      0x3c, 0x10, 0xc9, 0x2f, 0xdf, 0xcc, 0x34, 0x2e, 0xe1, 0x92, 0x76, 0xd1, 0xf0, 0x9a, 0xf,  0xbd, 0x4f, 0x2c, 0xb7,
      0xed};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x61, 0x84, 0xbf, 0x52, 0x90};
  uint8_t bytesprops0[] = {0x34, 0xeb, 0x7a, 0xc5, 0x56, 0xb7, 0x8c, 0x7b, 0xf9, 0x10};
  uint8_t bytesprops2[] = {0xd2, 0xe1, 0xba, 0xe1, 0xf1, 0x1d, 0x86, 0xf9, 0x8d, 0x46, 0xef, 0x13, 0xf6, 0x31};
  uint8_t bytesprops3[] = {0x60, 0x88, 0xfd, 0xf4, 0xfd, 0xd0, 0x96, 0xd4,
                           0xa2, 0x76, 0x7a, 0x7d, 0xb1, 0x30, 0x23, 0x84};
  uint8_t bytesprops4[] = {0xc1, 0xb1, 0xd2, 0xd9};
  uint8_t bytesprops5[] = {0x35, 0xc};
  uint8_t bytesprops6[] = {0xbd, 0x78, 0x3a, 0x3, 0x3e, 0xb0, 0xef, 0xe, 0x61, 0xa7, 0x56, 0x2, 0x93, 0x1, 0x29, 0x8b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops0}, .v = {5, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12939}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20660}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 157}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x58, 0x98, 0x20, 0x3c, 0xa, 0x87, 0x5e, 0xab, 0xab, 0x3b, 0xa, 0x45};
  uint8_t byteswillprops1[] = {0x6e, 0xef, 0x3c, 0xd7, 0x71, 0x89, 0x8a, 0x46, 0x13, 0xe2,
                               0x7a, 0xc2, 0x18, 0xe6, 0x73, 0x5d, 0xc6, 0x44, 0xd6};
  uint8_t byteswillprops2[] = {0xfa, 0x7c, 0x29, 0xfb, 0x41, 0x65, 0x7e, 0x82, 0x2f, 0x4e, 0x97, 0x93, 0xad};
  uint8_t byteswillprops3[] = {0xa3, 0x1d, 0x63, 0xd4, 0xfe, 0x95, 0xb4, 0x51, 0xeb, 0x49, 0x2f, 0x87, 0x60, 0x8f,
                               0x27, 0xb9, 0x37, 0xe9, 0x72, 0x65, 0x48, 0xfc, 0x44, 0x8b, 0x35, 0xcb, 0x5f, 0x16};
  uint8_t byteswillprops4[] = {0x76, 0x14, 0x2, 0xe8, 0xbe, 0xde, 0xba, 0x4f, 0x32};
  uint8_t byteswillprops6[] = {0x75, 0x9d, 0xe5, 0xde, 0x1a, 0xff, 0x10, 0xae, 0x2b,
                               0x7c, 0xb6, 0xe4, 0xe2, 0x8f, 0xf8, 0xfa, 0x9c, 0xf0};
  uint8_t byteswillprops5[] = {0x4e, 0x3c, 0x19, 0xaa, 0x9c, 0xe3, 0x3a, 0xc0, 0xb0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22075}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4010}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25879}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10253}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10461}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20087}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops5}, .v = {18, (char*)&byteswillprops6}}}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x91, 0xac, 0xaf, 0xf9, 0xd, 0x92};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe3, 0x3a, 0xb, 0x16, 0x4e, 0xc9, 0xc};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12527;
  uint8_t client_id_bytes[] = {0x37, 0x4, 0xe0};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4, 0x6a, 0xd0, 0xea, 0x38, 0x26, 0x7b, 0xc6, 0xe2, 0x52, 0x7, 0xf8, 0x8c, 0x8a};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5d, 0x54, 0x54, 0xe3, 0x24, 0x30, 0x71, 0x3c, 0x10, 0xc9, 0x2f, 0xdf, 0xcc, 0x34,
                              0x2e, 0xe1, 0x92, 0x76, 0xd1, 0xf0, 0x9a, 0xf,  0xbd, 0x4f, 0x2c, 0xb7, 0xed};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\205!\164q;\149|\140\239|\234\FS\EOT", _password = Just
// "BE\v*U\EM'\159\157\SYNm\DLEn\192\136\vS\"\244\NUL9\228'\195\139\EOT\197\200\194", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "H", _willMsg =
// "\225\198\150\163\208W\238\146\FS\223_\201\251%\143\NUL\243\162\225ll\147\157Z\237\208\211W)", _willProps =
// [PropPayloadFormatIndicator 75,PropMessageExpiryInterval 10264,PropSessionExpiryInterval 20012,PropAuthenticationData
// "\198yy\237\252\180;\255%\236Q@\162\220\137",PropUserProperty "M%\161\219\DLES-\187\159\253Ek{\171d"
// "\178^R\250s\208M\207p\181",PropCorrelationData
// "2\143@\230Bz\186Bq\ACK\217\DC3\204\209\170p\f<\231]\212\249P\132\203\221\209Y",PropReceiveMaximum
// 24923,PropPayloadFormatIndicator 212,PropSubscriptionIdentifier 2,PropRequestProblemInformation 125,PropContentType
// "\DC4B\191\182\244\"",PropResponseInformation "O\166A\166@F\148\188@\136\228\160",PropSessionExpiryInterval
// 26416,PropMaximumQoS 146,PropCorrelationData "KJ\254\&6",PropMaximumQoS 108]}), _cleanSession = True, _keepAlive =
// 13897, _connID = "\233\129 ", _properties = [PropTopicAlias 21218,PropSessionExpiryInterval
// 25892,PropMessageExpiryInterval 14193,PropReceiveMaximum 4778,PropReceiveMaximum 20584,PropMaximumQoS
// 170,PropAuthenticationMethod "\165\183i\DLE\189\185\ETB\226\194\194W\191\ESC\184",PropContentType
// "\221Z]bNW\SO\179\US\189\&6\237%\240,%\169(\165\GSo\185\158\DELF\162\245\128",PropSessionExpiryInterval
// 12083,PropCorrelationData "\144Q\129C\194\SOH\146_\203v\ACK",PropMessageExpiryInterval 8095,PropServerReference
// ">\GS\206-\200\149\133\153\FS7|\213'W\229\v\150\242\&5\213L\231\179^\210\197\174",PropSharedSubscriptionAvailable
// 250,PropServerKeepAlive 22603,PropReasonString "\137\239\148D\243\130A\216",PropTopicAliasMaximum
// 17570,PropServerReference "A\243\199\228\241V",PropRetainAvailable 27,PropSubscriptionIdentifier
// 7,PropSubscriptionIdentifierAvailable 144,PropReceiveMaximum 22199,PropWillDelayInterval 25924,PropServerKeepAlive
// 20466,PropServerKeepAlive 19738,PropMessageExpiryInterval 23378,PropWildcardSubscriptionAvailable 159]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xa1, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x36, 0x49, 0xb2, 0x1,  0x23, 0x52, 0xe2, 0x11,
      0x0,  0x0,  0x65, 0x24, 0x2,  0x0,  0x0,  0x37, 0x71, 0x21, 0x12, 0xaa, 0x21, 0x50, 0x68, 0x24, 0xaa, 0x15, 0x0,
      0xe,  0xa5, 0xb7, 0x69, 0x10, 0xbd, 0xb9, 0x17, 0xe2, 0xc2, 0xc2, 0x57, 0xbf, 0x1b, 0xb8, 0x3,  0x0,  0x1c, 0xdd,
      0x5a, 0x5d, 0x62, 0x4e, 0x57, 0xe,  0xb3, 0x1f, 0xbd, 0x36, 0xed, 0x25, 0xf0, 0x2c, 0x25, 0xa9, 0x28, 0xa5, 0x1d,
      0x6f, 0xb9, 0x9e, 0x7f, 0x46, 0xa2, 0xf5, 0x80, 0x11, 0x0,  0x0,  0x2f, 0x33, 0x9,  0x0,  0xb,  0x90, 0x51, 0x81,
      0x43, 0xc2, 0x1,  0x92, 0x5f, 0xcb, 0x76, 0x6,  0x2,  0x0,  0x0,  0x1f, 0x9f, 0x1c, 0x0,  0x1b, 0x3e, 0x1d, 0xce,
      0x2d, 0xc8, 0x95, 0x85, 0x99, 0x1c, 0x37, 0x7c, 0xd5, 0x27, 0x57, 0xe5, 0xb,  0x96, 0xf2, 0x35, 0xd5, 0x4c, 0xe7,
      0xb3, 0x5e, 0xd2, 0xc5, 0xae, 0x2a, 0xfa, 0x13, 0x58, 0x4b, 0x1f, 0x0,  0x8,  0x89, 0xef, 0x94, 0x44, 0xf3, 0x82,
      0x41, 0xd8, 0x22, 0x44, 0xa2, 0x1c, 0x0,  0x6,  0x41, 0xf3, 0xc7, 0xe4, 0xf1, 0x56, 0x25, 0x1b, 0xb,  0x7,  0x29,
      0x90, 0x21, 0x56, 0xb7, 0x18, 0x0,  0x0,  0x65, 0x44, 0x13, 0x4f, 0xf2, 0x13, 0x4d, 0x1a, 0x2,  0x0,  0x0,  0x5b,
      0x52, 0x28, 0x9f, 0x0,  0x3,  0xe9, 0x81, 0x20, 0x8c, 0x1,  0x1,  0x4b, 0x2,  0x0,  0x0,  0x28, 0x18, 0x11, 0x0,
      0x0,  0x4e, 0x2c, 0x16, 0x0,  0xf,  0xc6, 0x79, 0x79, 0xed, 0xfc, 0xb4, 0x3b, 0xff, 0x25, 0xec, 0x51, 0x40, 0xa2,
      0xdc, 0x89, 0x26, 0x0,  0xf,  0x4d, 0x25, 0xa1, 0xdb, 0x10, 0x53, 0x2d, 0xbb, 0x9f, 0xfd, 0x45, 0x6b, 0x7b, 0xab,
      0x64, 0x0,  0xa,  0xb2, 0x5e, 0x52, 0xfa, 0x73, 0xd0, 0x4d, 0xcf, 0x70, 0xb5, 0x9,  0x0,  0x1c, 0x32, 0x8f, 0x40,
      0xe6, 0x42, 0x7a, 0xba, 0x42, 0x71, 0x6,  0xd9, 0x13, 0xcc, 0xd1, 0xaa, 0x70, 0xc,  0x3c, 0xe7, 0x5d, 0xd4, 0xf9,
      0x50, 0x84, 0xcb, 0xdd, 0xd1, 0x59, 0x21, 0x61, 0x5b, 0x1,  0xd4, 0xb,  0x2,  0x17, 0x7d, 0x3,  0x0,  0x6,  0x14,
      0x42, 0xbf, 0xb6, 0xf4, 0x22, 0x1a, 0x0,  0xc,  0x4f, 0xa6, 0x41, 0xa6, 0x40, 0x46, 0x94, 0xbc, 0x40, 0x88, 0xe4,
      0xa0, 0x11, 0x0,  0x0,  0x67, 0x30, 0x24, 0x92, 0x9,  0x0,  0x4,  0x4b, 0x4a, 0xfe, 0x36, 0x24, 0x6c, 0x0,  0x1,
      0x48, 0x0,  0x1d, 0xe1, 0xc6, 0x96, 0xa3, 0xd0, 0x57, 0xee, 0x92, 0x1c, 0xdf, 0x5f, 0xc9, 0xfb, 0x25, 0x8f, 0x0,
      0xf3, 0xa2, 0xe1, 0x6c, 0x6c, 0x93, 0x9d, 0x5a, 0xed, 0xd0, 0xd3, 0x57, 0x29, 0x0,  0xd,  0xcd, 0x21, 0xa4, 0x71,
      0x3b, 0x95, 0x7c, 0x8c, 0xef, 0x7c, 0xea, 0x1c, 0x4,  0x0,  0x1d, 0x42, 0x45, 0xb,  0x2a, 0x55, 0x19, 0x27, 0x9f,
      0x9d, 0x16, 0x6d, 0x10, 0x6e, 0xc0, 0x88, 0xb,  0x53, 0x22, 0xf4, 0x0,  0x39, 0xe4, 0x27, 0xc3, 0x8b, 0x4,  0xc5,
      0xc8, 0xc2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa5, 0xb7, 0x69, 0x10, 0xbd, 0xb9, 0x17, 0xe2, 0xc2, 0xc2, 0x57, 0xbf, 0x1b, 0xb8};
  uint8_t bytesprops1[] = {0xdd, 0x5a, 0x5d, 0x62, 0x4e, 0x57, 0xe,  0xb3, 0x1f, 0xbd, 0x36, 0xed, 0x25, 0xf0,
                           0x2c, 0x25, 0xa9, 0x28, 0xa5, 0x1d, 0x6f, 0xb9, 0x9e, 0x7f, 0x46, 0xa2, 0xf5, 0x80};
  uint8_t bytesprops2[] = {0x90, 0x51, 0x81, 0x43, 0xc2, 0x1, 0x92, 0x5f, 0xcb, 0x76, 0x6};
  uint8_t bytesprops3[] = {0x3e, 0x1d, 0xce, 0x2d, 0xc8, 0x95, 0x85, 0x99, 0x1c, 0x37, 0x7c, 0xd5, 0x27, 0x57,
                           0xe5, 0xb,  0x96, 0xf2, 0x35, 0xd5, 0x4c, 0xe7, 0xb3, 0x5e, 0xd2, 0xc5, 0xae};
  uint8_t bytesprops4[] = {0x89, 0xef, 0x94, 0x44, 0xf3, 0x82, 0x41, 0xd8};
  uint8_t bytesprops5[] = {0x41, 0xf3, 0xc7, 0xe4, 0xf1, 0x56};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21218}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25892}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14193}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4778}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20584}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12083}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8095}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22603}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17570}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 7}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22199}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25924}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20466}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19738}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23378}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 159}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc6, 0x79, 0x79, 0xed, 0xfc, 0xb4, 0x3b, 0xff,
                               0x25, 0xec, 0x51, 0x40, 0xa2, 0xdc, 0x89};
  uint8_t byteswillprops2[] = {0xb2, 0x5e, 0x52, 0xfa, 0x73, 0xd0, 0x4d, 0xcf, 0x70, 0xb5};
  uint8_t byteswillprops1[] = {0x4d, 0x25, 0xa1, 0xdb, 0x10, 0x53, 0x2d, 0xbb,
                               0x9f, 0xfd, 0x45, 0x6b, 0x7b, 0xab, 0x64};
  uint8_t byteswillprops3[] = {0x32, 0x8f, 0x40, 0xe6, 0x42, 0x7a, 0xba, 0x42, 0x71, 0x6,  0xd9, 0x13, 0xcc, 0xd1,
                               0xaa, 0x70, 0xc,  0x3c, 0xe7, 0x5d, 0xd4, 0xf9, 0x50, 0x84, 0xcb, 0xdd, 0xd1, 0x59};
  uint8_t byteswillprops4[] = {0x14, 0x42, 0xbf, 0xb6, 0xf4, 0x22};
  uint8_t byteswillprops5[] = {0x4f, 0xa6, 0x41, 0xa6, 0x40, 0x46, 0x94, 0xbc, 0x40, 0x88, 0xe4, 0xa0};
  uint8_t byteswillprops6[] = {0x4b, 0x4a, 0xfe, 0x36};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10264}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20012}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {15, (char*)&byteswillprops1}, .v = {10, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24923}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26416}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 108}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x48};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe1, 0xc6, 0x96, 0xa3, 0xd0, 0x57, 0xee, 0x92, 0x1c, 0xdf,
                                  0x5f, 0xc9, 0xfb, 0x25, 0x8f, 0x0,  0xf3, 0xa2, 0xe1, 0x6c,
                                  0x6c, 0x93, 0x9d, 0x5a, 0xed, 0xd0, 0xd3, 0x57, 0x29};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13897;
  uint8_t client_id_bytes[] = {0xe9, 0x81, 0x20};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcd, 0x21, 0xa4, 0x71, 0x3b, 0x95, 0x7c, 0x8c, 0xef, 0x7c, 0xea, 0x1c, 0x4};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x42, 0x45, 0xb,  0x2a, 0x55, 0x19, 0x27, 0x9f, 0x9d, 0x16, 0x6d, 0x10, 0x6e, 0xc0, 0x88,
                              0xb,  0x53, 0x22, 0xf4, 0x0,  0x39, 0xe4, 0x27, 0xc3, 0x8b, 0x4,  0xc5, 0xc8, 0xc2};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "B\186\246\255t\DC3^!\193Sq\185HB\196\232\246Y>p\ACK\187k\ETBu\142", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "I;]\195\205\\\220z\EOT0:<'\ENQ\194D@1\238|", _willMsg = "`!\186\212fPy", _willProps =
// [PropMessageExpiryInterval 28355,PropMaximumPacketSize 28742,PropSubscriptionIdentifierAvailable
// 107,PropMessageExpiryInterval 23830,PropSubscriptionIdentifier 31,PropCorrelationData
// "<D\v4K\180\ACKK\194\216\148\&6\156\212\176\&7\255_",PropSessionExpiryInterval 9875,PropTopicAliasMaximum
// 13464,PropRetainAvailable 203,PropMaximumPacketSize 6897,PropRetainAvailable 235,PropMaximumPacketSize
// 25463,PropTopicAliasMaximum 32265,PropRetainAvailable 141,PropServerReference
// "\159\198\248\249E\171\221",PropServerKeepAlive 22814]}), _cleanSession = True, _keepAlive = 20788, _connID =
// "\155\US\157x\133\ESC,7_b\139\135\244\157<J\147+\149\DC1\233\244", _properties = [PropResponseInformation
// ">\179\166D\243"]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0xb7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6e, 0x51, 0x34, 0x8,  0x1a, 0x0,  0x5,
                   0x3e, 0xb3, 0xa6, 0x44, 0xf3, 0x0,  0x16, 0x9b, 0x1f, 0x9d, 0x78, 0x85, 0x1b, 0x2c, 0x37, 0x5f, 0x62,
                   0x8b, 0x87, 0xf4, 0x9d, 0x3c, 0x4a, 0x93, 0x2b, 0x95, 0x11, 0xe9, 0xf4, 0x50, 0x2,  0x0,  0x0,  0x6e,
                   0xc3, 0x27, 0x0,  0x0,  0x70, 0x46, 0x29, 0x6b, 0x2,  0x0,  0x0,  0x5d, 0x16, 0xb,  0x1f, 0x9,  0x0,
                   0x12, 0x3c, 0x44, 0xb,  0x34, 0x4b, 0xb4, 0x6,  0x4b, 0xc2, 0xd8, 0x94, 0x36, 0x9c, 0xd4, 0xb0, 0x37,
                   0xff, 0x5f, 0x11, 0x0,  0x0,  0x26, 0x93, 0x22, 0x34, 0x98, 0x25, 0xcb, 0x27, 0x0,  0x0,  0x1a, 0xf1,
                   0x25, 0xeb, 0x27, 0x0,  0x0,  0x63, 0x77, 0x22, 0x7e, 0x9,  0x25, 0x8d, 0x1c, 0x0,  0x7,  0x9f, 0xc6,
                   0xf8, 0xf9, 0x45, 0xab, 0xdd, 0x13, 0x59, 0x1e, 0x0,  0x14, 0x49, 0x3b, 0x5d, 0xc3, 0xcd, 0x5c, 0xdc,
                   0x7a, 0x4,  0x30, 0x3a, 0x3c, 0x27, 0x5,  0xc2, 0x44, 0x40, 0x31, 0xee, 0x7c, 0x0,  0x7,  0x60, 0x21,
                   0xba, 0xd4, 0x66, 0x50, 0x79, 0x0,  0x1a, 0x42, 0xba, 0xf6, 0xff, 0x74, 0x13, 0x5e, 0x21, 0xc1, 0x53,
                   0x71, 0xb9, 0x48, 0x42, 0xc4, 0xe8, 0xf6, 0x59, 0x3e, 0x70, 0x6,  0xbb, 0x6b, 0x17, 0x75, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3e, 0xb3, 0xa6, 0x44, 0xf3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x3c, 0x44, 0xb,  0x34, 0x4b, 0xb4, 0x6,  0x4b, 0xc2,
                               0xd8, 0x94, 0x36, 0x9c, 0xd4, 0xb0, 0x37, 0xff, 0x5f};
  uint8_t byteswillprops1[] = {0x9f, 0xc6, 0xf8, 0xf9, 0x45, 0xab, 0xdd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28355}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28742}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23830}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 31}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9875}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13464}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6897}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25463}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32265}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22814}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x49, 0x3b, 0x5d, 0xc3, 0xcd, 0x5c, 0xdc, 0x7a, 0x4,  0x30,
                                0x3a, 0x3c, 0x27, 0x5,  0xc2, 0x44, 0x40, 0x31, 0xee, 0x7c};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x60, 0x21, 0xba, 0xd4, 0x66, 0x50, 0x79};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20788;
  uint8_t client_id_bytes[] = {0x9b, 0x1f, 0x9d, 0x78, 0x85, 0x1b, 0x2c, 0x37, 0x5f, 0x62, 0x8b,
                               0x87, 0xf4, 0x9d, 0x3c, 0x4a, 0x93, 0x2b, 0x95, 0x11, 0xe9, 0xf4};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x42, 0xba, 0xf6, 0xff, 0x74, 0x13, 0x5e, 0x21, 0xc1, 0x53, 0x71, 0xb9, 0x48,
                              0x42, 0xc4, 0xe8, 0xf6, 0x59, 0x3e, 0x70, 0x6,  0xbb, 0x6b, 0x17, 0x75, 0x8e};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "dXU-\240\154\245]\DC3\246\178\132\200\255\147MJ\234\151\213\255\168\248\&0\142P\f\180\200", _password = Just
// "\128\DC1\b~e\198U\177\STX'\151\167\&5", _lastWill = Nothing, _cleanSession = True, _keepAlive = 18569, _connID =
// "\128S\EM\228\"K\171g\158}\227SV6\144\224\DC2\159\239\r0\n\156\140\DC3", _properties = [PropUserProperty ""
// "\205\237\173\DC39^\222\EM\168\252\&1-\199A\CAN\241\RS",PropReasonString
// "\RS\203~\182\155y\194\149t\182f\227\224]\187\253\183\225^\159\131i.p\192\174\144[\222\232",PropUserProperty
// "\200\130\155\243\240\DLE\242%\186\GS\168&\212\223\166\221b\SI \149\208\215>\207\156\173a\232<\220"
// ";\236\223\164\221\n;\v\216\RS'\251}n\239\ACK*\149\n9a\255\253\131gm",PropMessageExpiryInterval
// 23389,PropMaximumPacketSize 28026,PropSessionExpiryInterval 977,PropRequestResponseInformation 197,PropUserProperty
// "\233\224U\181Z\148b\EOT" "\168",PropReasonString "\DEL\SOl\RS",PropResponseInformation "",PropMaximumPacketSize
// 14063,PropRequestProblemInformation 214,PropWillDelayInterval 10568,PropTopicAlias
// 1756,PropRequestResponseInformation 234,PropMessageExpiryInterval 13813,PropRequestResponseInformation
// 255,PropServerReference "\149v\231F\US\ACK\178\175,m\132\216"]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0x99, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x48, 0x89, 0xc4, 0x1,  0x26, 0x0,  0x0,  0x0,
      0x11, 0xcd, 0xed, 0xad, 0x13, 0x39, 0x5e, 0xde, 0x19, 0xa8, 0xfc, 0x31, 0x2d, 0xc7, 0x41, 0x18, 0xf1, 0x1e, 0x1f,
      0x0,  0x1e, 0x1e, 0xcb, 0x7e, 0xb6, 0x9b, 0x79, 0xc2, 0x95, 0x74, 0xb6, 0x66, 0xe3, 0xe0, 0x5d, 0xbb, 0xfd, 0xb7,
      0xe1, 0x5e, 0x9f, 0x83, 0x69, 0x2e, 0x70, 0xc0, 0xae, 0x90, 0x5b, 0xde, 0xe8, 0x26, 0x0,  0x1e, 0xc8, 0x82, 0x9b,
      0xf3, 0xf0, 0x10, 0xf2, 0x25, 0xba, 0x1d, 0xa8, 0x26, 0xd4, 0xdf, 0xa6, 0xdd, 0x62, 0xf,  0x20, 0x95, 0xd0, 0xd7,
      0x3e, 0xcf, 0x9c, 0xad, 0x61, 0xe8, 0x3c, 0xdc, 0x0,  0x1a, 0x3b, 0xec, 0xdf, 0xa4, 0xdd, 0xa,  0x3b, 0xb,  0xd8,
      0x1e, 0x27, 0xfb, 0x7d, 0x6e, 0xef, 0x6,  0x2a, 0x95, 0xa,  0x39, 0x61, 0xff, 0xfd, 0x83, 0x67, 0x6d, 0x2,  0x0,
      0x0,  0x5b, 0x5d, 0x27, 0x0,  0x0,  0x6d, 0x7a, 0x11, 0x0,  0x0,  0x3,  0xd1, 0x19, 0xc5, 0x26, 0x0,  0x8,  0xe9,
      0xe0, 0x55, 0xb5, 0x5a, 0x94, 0x62, 0x4,  0x0,  0x1,  0xa8, 0x1f, 0x0,  0x4,  0x7f, 0xe,  0x6c, 0x1e, 0x1a, 0x0,
      0x0,  0x27, 0x0,  0x0,  0x36, 0xef, 0x17, 0xd6, 0x18, 0x0,  0x0,  0x29, 0x48, 0x23, 0x6,  0xdc, 0x19, 0xea, 0x2,
      0x0,  0x0,  0x35, 0xf5, 0x19, 0xff, 0x1c, 0x0,  0xc,  0x95, 0x76, 0xe7, 0x46, 0x1f, 0x6,  0xb2, 0xaf, 0x2c, 0x6d,
      0x84, 0xd8, 0x0,  0x19, 0x80, 0x53, 0x19, 0xe4, 0x22, 0x4b, 0xab, 0x67, 0x9e, 0x7d, 0xe3, 0x53, 0x56, 0x36, 0x90,
      0xe0, 0x12, 0x9f, 0xef, 0xd,  0x30, 0xa,  0x9c, 0x8c, 0x13, 0x0,  0x1d, 0x64, 0x58, 0x55, 0x2d, 0xf0, 0x9a, 0xf5,
      0x5d, 0x13, 0xf6, 0xb2, 0x84, 0xc8, 0xff, 0x93, 0x4d, 0x4a, 0xea, 0x97, 0xd5, 0xff, 0xa8, 0xf8, 0x30, 0x8e, 0x50,
      0xc,  0xb4, 0xc8, 0x0,  0xd,  0x80, 0x11, 0x8,  0x7e, 0x65, 0xc6, 0x55, 0xb1, 0x2,  0x27, 0x97, 0xa7, 0x35};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0xcd, 0xed, 0xad, 0x13, 0x39, 0x5e, 0xde, 0x19, 0xa8,
                           0xfc, 0x31, 0x2d, 0xc7, 0x41, 0x18, 0xf1, 0x1e};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops2[] = {0x1e, 0xcb, 0x7e, 0xb6, 0x9b, 0x79, 0xc2, 0x95, 0x74, 0xb6, 0x66, 0xe3, 0xe0, 0x5d, 0xbb,
                           0xfd, 0xb7, 0xe1, 0x5e, 0x9f, 0x83, 0x69, 0x2e, 0x70, 0xc0, 0xae, 0x90, 0x5b, 0xde, 0xe8};
  uint8_t bytesprops4[] = {0x3b, 0xec, 0xdf, 0xa4, 0xdd, 0xa, 0x3b, 0xb,  0xd8, 0x1e, 0x27, 0xfb, 0x7d,
                           0x6e, 0xef, 0x6,  0x2a, 0x95, 0xa, 0x39, 0x61, 0xff, 0xfd, 0x83, 0x67, 0x6d};
  uint8_t bytesprops3[] = {0xc8, 0x82, 0x9b, 0xf3, 0xf0, 0x10, 0xf2, 0x25, 0xba, 0x1d, 0xa8, 0x26, 0xd4, 0xdf, 0xa6,
                           0xdd, 0x62, 0xf,  0x20, 0x95, 0xd0, 0xd7, 0x3e, 0xcf, 0x9c, 0xad, 0x61, 0xe8, 0x3c, 0xdc};
  uint8_t bytesprops6[] = {0xa8};
  uint8_t bytesprops5[] = {0xe9, 0xe0, 0x55, 0xb5, 0x5a, 0x94, 0x62, 0x4};
  uint8_t bytesprops7[] = {0x7f, 0xe, 0x6c, 0x1e};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0x95, 0x76, 0xe7, 0x46, 0x1f, 0x6, 0xb2, 0xaf, 0x2c, 0x6d, 0x84, 0xd8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops0}, .v = {17, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops3}, .v = {26, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23389}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28026}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 977}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops5}, .v = {1, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14063}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10568}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1756}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13813}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 18569;
  uint8_t client_id_bytes[] = {0x80, 0x53, 0x19, 0xe4, 0x22, 0x4b, 0xab, 0x67, 0x9e, 0x7d, 0xe3, 0x53, 0x56,
                               0x36, 0x90, 0xe0, 0x12, 0x9f, 0xef, 0xd,  0x30, 0xa,  0x9c, 0x8c, 0x13};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x64, 0x58, 0x55, 0x2d, 0xf0, 0x9a, 0xf5, 0x5d, 0x13, 0xf6, 0xb2, 0x84, 0xc8, 0xff, 0x93,
                              0x4d, 0x4a, 0xea, 0x97, 0xd5, 0xff, 0xa8, 0xf8, 0x30, 0x8e, 0x50, 0xc,  0xb4, 0xc8};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x80, 0x11, 0x8, 0x7e, 0x65, 0xc6, 0x55, 0xb1, 0x2, 0x27, 0x97, 0xa7, 0x35};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "|\226c4\183<x\DEL\148\ETX\183\SO!\FS\250\ACK\FSZ\226", _password = Just
// "w\187\220\250\181lx\172\&7\SOH\194\142\ENQ7\FS\207X\148\ETB\204\r\210\b\RS", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS2, _willTopic = "\206\aB^Ph\189\200\158\220\SO\151\248\142\ESC\202$x\187\241+[;\165\n",
// _willMsg = "\183F\152\172\148\140\156", _willProps = [PropMessageExpiryInterval 10139,PropReasonString
// "\EM\188\134A\234]\182R>\220\157\131j{\194\250\147\168\202\ENQ\ENQ`\238>SqVU",PropReasonString
// "\201_\157B+",PropServerKeepAlive 1610,PropTopicAlias 27154,PropSubscriptionIdentifier 26]}), _cleanSession = False,
// _keepAlive = 17650, _connID = "\227 s`,1\240\236z\182\167\209\132kvpp\167\174}6Z\207\&9\207%\227U ", _properties =
// [PropPayloadFormatIndicator 172,PropContentType
// "\GS\211|\185\GS\ACK\218\240\255\250\188\196+W_\250\238+(\187\203\162\226\215J",PropAuthenticationMethod
// "",PropMaximumQoS 89,PropTopicAlias 16426,PropResponseTopic " x\193\133\253\234",PropAuthenticationMethod
// "\EOT\164{\208\233\SO|\139\198\&6V\175\145\199W\SO7\ETXgf\182",PropContentType
// "\b\ESC\151\208\148^\US_g\166h8\202{\FS",PropReasonString
// "\164\173\150\207\US\190\&0ZD\FS\198\219\147\128\166\vH\168j\173",PropReasonString
// "\STX",PropSubscriptionIdentifierAvailable 19,PropTopicAliasMaximum 27264,PropSessionExpiryInterval
// 21980,PropReasonString "\SI\141\156\183\221\EOTi\137\131\SOH\179f",PropTopicAlias 25523,PropTopicAliasMaximum
// 31622,PropContentType "\ETB\215aY1\160\GS\129\CAN\202'\177\166\249\231s\138\172\181\252",PropCorrelationData
// "_\230\236\ETB\172\203\r\SOg\230M\134\242\189b\245]\DC1\207\184\212K\b\148",PropUserProperty
// "\155+\130\144\214Su\171\DC4\225(\EMG\128<\202\140\203C\GS\RS\255\253\198\&0"
// "\133d\DEL\149\184",PropAuthenticationData "?\186\229x\186\226\245g\ENQ\SOH\164q\SYN\153:",PropUserProperty
// ";\163\145:x\175j\172\242\160p\SO\212" "\ACK",PropSubscriptionIdentifier 20,PropMaximumPacketSize 14292]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x10, 0xc7, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x44, 0xf2, 0x94, 0x2,  0x1,  0xac, 0x3,  0x0,
      0x19, 0x1d, 0xd3, 0x7c, 0xb9, 0x1d, 0x6,  0xda, 0xf0, 0xff, 0xfa, 0xbc, 0xc4, 0x2b, 0x57, 0x5f, 0xfa, 0xee, 0x2b,
      0x28, 0xbb, 0xcb, 0xa2, 0xe2, 0xd7, 0x4a, 0x15, 0x0,  0x0,  0x24, 0x59, 0x23, 0x40, 0x2a, 0x8,  0x0,  0x6,  0x20,
      0x78, 0xc1, 0x85, 0xfd, 0xea, 0x15, 0x0,  0x15, 0x4,  0xa4, 0x7b, 0xd0, 0xe9, 0xe,  0x7c, 0x8b, 0xc6, 0x36, 0x56,
      0xaf, 0x91, 0xc7, 0x57, 0xe,  0x37, 0x3,  0x67, 0x66, 0xb6, 0x3,  0x0,  0xf,  0x8,  0x1b, 0x97, 0xd0, 0x94, 0x5e,
      0x1f, 0x5f, 0x67, 0xa6, 0x68, 0x38, 0xca, 0x7b, 0x1c, 0x1f, 0x0,  0x14, 0xa4, 0xad, 0x96, 0xcf, 0x1f, 0xbe, 0x30,
      0x5a, 0x44, 0x1c, 0xc6, 0xdb, 0x93, 0x80, 0xa6, 0xb,  0x48, 0xa8, 0x6a, 0xad, 0x1f, 0x0,  0x1,  0x2,  0x29, 0x13,
      0x22, 0x6a, 0x80, 0x11, 0x0,  0x0,  0x55, 0xdc, 0x1f, 0x0,  0xc,  0xf,  0x8d, 0x9c, 0xb7, 0xdd, 0x4,  0x69, 0x89,
      0x83, 0x1,  0xb3, 0x66, 0x23, 0x63, 0xb3, 0x22, 0x7b, 0x86, 0x3,  0x0,  0x14, 0x17, 0xd7, 0x61, 0x59, 0x31, 0xa0,
      0x1d, 0x81, 0x18, 0xca, 0x27, 0xb1, 0xa6, 0xf9, 0xe7, 0x73, 0x8a, 0xac, 0xb5, 0xfc, 0x9,  0x0,  0x18, 0x5f, 0xe6,
      0xec, 0x17, 0xac, 0xcb, 0xd,  0xe,  0x67, 0xe6, 0x4d, 0x86, 0xf2, 0xbd, 0x62, 0xf5, 0x5d, 0x11, 0xcf, 0xb8, 0xd4,
      0x4b, 0x8,  0x94, 0x26, 0x0,  0x19, 0x9b, 0x2b, 0x82, 0x90, 0xd6, 0x53, 0x75, 0xab, 0x14, 0xe1, 0x28, 0x19, 0x47,
      0x80, 0x3c, 0xca, 0x8c, 0xcb, 0x43, 0x1d, 0x1e, 0xff, 0xfd, 0xc6, 0x30, 0x0,  0x5,  0x85, 0x64, 0x7f, 0x95, 0xb8,
      0x16, 0x0,  0xf,  0x3f, 0xba, 0xe5, 0x78, 0xba, 0xe2, 0xf5, 0x67, 0x5,  0x1,  0xa4, 0x71, 0x16, 0x99, 0x3a, 0x26,
      0x0,  0xd,  0x3b, 0xa3, 0x91, 0x3a, 0x78, 0xaf, 0x6a, 0xac, 0xf2, 0xa0, 0x70, 0xe,  0xd4, 0x0,  0x1,  0x6,  0xb,
      0x14, 0x27, 0x0,  0x0,  0x37, 0xd4, 0x0,  0x1d, 0xe3, 0x20, 0x73, 0x60, 0x2c, 0x31, 0xf0, 0xec, 0x7a, 0xb6, 0xa7,
      0xd1, 0x84, 0x6b, 0x76, 0x70, 0x70, 0xa7, 0xae, 0x7d, 0x36, 0x5a, 0xcf, 0x39, 0xcf, 0x25, 0xe3, 0x55, 0x20, 0x34,
      0x2,  0x0,  0x0,  0x27, 0x9b, 0x1f, 0x0,  0x1c, 0x19, 0xbc, 0x86, 0x41, 0xea, 0x5d, 0xb6, 0x52, 0x3e, 0xdc, 0x9d,
      0x83, 0x6a, 0x7b, 0xc2, 0xfa, 0x93, 0xa8, 0xca, 0x5,  0x5,  0x60, 0xee, 0x3e, 0x53, 0x71, 0x56, 0x55, 0x1f, 0x0,
      0x5,  0xc9, 0x5f, 0x9d, 0x42, 0x2b, 0x13, 0x6,  0x4a, 0x23, 0x6a, 0x12, 0xb,  0x1a, 0x0,  0x19, 0xce, 0x7,  0x42,
      0x5e, 0x50, 0x68, 0xbd, 0xc8, 0x9e, 0xdc, 0xe,  0x97, 0xf8, 0x8e, 0x1b, 0xca, 0x24, 0x78, 0xbb, 0xf1, 0x2b, 0x5b,
      0x3b, 0xa5, 0xa,  0x0,  0x7,  0xb7, 0x46, 0x98, 0xac, 0x94, 0x8c, 0x9c, 0x0,  0x13, 0x7c, 0xe2, 0x63, 0x34, 0xb7,
      0x3c, 0x78, 0x7f, 0x94, 0x3,  0xb7, 0xe,  0x21, 0x1c, 0xfa, 0x6,  0x1c, 0x5a, 0xe2, 0x0,  0x18, 0x77, 0xbb, 0xdc,
      0xfa, 0xb5, 0x6c, 0x78, 0xac, 0x37, 0x1,  0xc2, 0x8e, 0x5,  0x37, 0x1c, 0xcf, 0x58, 0x94, 0x17, 0xcc, 0xd,  0xd2,
      0x8,  0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1d, 0xd3, 0x7c, 0xb9, 0x1d, 0x6,  0xda, 0xf0, 0xff, 0xfa, 0xbc, 0xc4, 0x2b,
                           0x57, 0x5f, 0xfa, 0xee, 0x2b, 0x28, 0xbb, 0xcb, 0xa2, 0xe2, 0xd7, 0x4a};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x20, 0x78, 0xc1, 0x85, 0xfd, 0xea};
  uint8_t bytesprops3[] = {0x4,  0xa4, 0x7b, 0xd0, 0xe9, 0xe,  0x7c, 0x8b, 0xc6, 0x36, 0x56,
                           0xaf, 0x91, 0xc7, 0x57, 0xe,  0x37, 0x3,  0x67, 0x66, 0xb6};
  uint8_t bytesprops4[] = {0x8, 0x1b, 0x97, 0xd0, 0x94, 0x5e, 0x1f, 0x5f, 0x67, 0xa6, 0x68, 0x38, 0xca, 0x7b, 0x1c};
  uint8_t bytesprops5[] = {0xa4, 0xad, 0x96, 0xcf, 0x1f, 0xbe, 0x30, 0x5a, 0x44, 0x1c,
                           0xc6, 0xdb, 0x93, 0x80, 0xa6, 0xb,  0x48, 0xa8, 0x6a, 0xad};
  uint8_t bytesprops6[] = {0x2};
  uint8_t bytesprops7[] = {0xf, 0x8d, 0x9c, 0xb7, 0xdd, 0x4, 0x69, 0x89, 0x83, 0x1, 0xb3, 0x66};
  uint8_t bytesprops8[] = {0x17, 0xd7, 0x61, 0x59, 0x31, 0xa0, 0x1d, 0x81, 0x18, 0xca,
                           0x27, 0xb1, 0xa6, 0xf9, 0xe7, 0x73, 0x8a, 0xac, 0xb5, 0xfc};
  uint8_t bytesprops9[] = {0x5f, 0xe6, 0xec, 0x17, 0xac, 0xcb, 0xd,  0xe,  0x67, 0xe6, 0x4d, 0x86,
                           0xf2, 0xbd, 0x62, 0xf5, 0x5d, 0x11, 0xcf, 0xb8, 0xd4, 0x4b, 0x8,  0x94};
  uint8_t bytesprops11[] = {0x85, 0x64, 0x7f, 0x95, 0xb8};
  uint8_t bytesprops10[] = {0x9b, 0x2b, 0x82, 0x90, 0xd6, 0x53, 0x75, 0xab, 0x14, 0xe1, 0x28, 0x19, 0x47,
                            0x80, 0x3c, 0xca, 0x8c, 0xcb, 0x43, 0x1d, 0x1e, 0xff, 0xfd, 0xc6, 0x30};
  uint8_t bytesprops12[] = {0x3f, 0xba, 0xe5, 0x78, 0xba, 0xe2, 0xf5, 0x67, 0x5, 0x1, 0xa4, 0x71, 0x16, 0x99, 0x3a};
  uint8_t bytesprops14[] = {0x6};
  uint8_t bytesprops13[] = {0x3b, 0xa3, 0x91, 0x3a, 0x78, 0xaf, 0x6a, 0xac, 0xf2, 0xa0, 0x70, 0xe, 0xd4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16426}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27264}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21980}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25523}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31622}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops10}, .v = {5, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops13}, .v = {1, (char*)&bytesprops14}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14292}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x19, 0xbc, 0x86, 0x41, 0xea, 0x5d, 0xb6, 0x52, 0x3e, 0xdc, 0x9d, 0x83, 0x6a, 0x7b,
                               0xc2, 0xfa, 0x93, 0xa8, 0xca, 0x5,  0x5,  0x60, 0xee, 0x3e, 0x53, 0x71, 0x56, 0x55};
  uint8_t byteswillprops1[] = {0xc9, 0x5f, 0x9d, 0x42, 0x2b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10139}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1610}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27154}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xce, 0x7,  0x42, 0x5e, 0x50, 0x68, 0xbd, 0xc8, 0x9e, 0xdc, 0xe,  0x97, 0xf8,
                                0x8e, 0x1b, 0xca, 0x24, 0x78, 0xbb, 0xf1, 0x2b, 0x5b, 0x3b, 0xa5, 0xa};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb7, 0x46, 0x98, 0xac, 0x94, 0x8c, 0x9c};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17650;
  uint8_t client_id_bytes[] = {0xe3, 0x20, 0x73, 0x60, 0x2c, 0x31, 0xf0, 0xec, 0x7a, 0xb6, 0xa7, 0xd1, 0x84, 0x6b, 0x76,
                               0x70, 0x70, 0xa7, 0xae, 0x7d, 0x36, 0x5a, 0xcf, 0x39, 0xcf, 0x25, 0xe3, 0x55, 0x20};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7c, 0xe2, 0x63, 0x34, 0xb7, 0x3c, 0x78, 0x7f, 0x94, 0x3,
                              0xb7, 0xe,  0x21, 0x1c, 0xfa, 0x6,  0x1c, 0x5a, 0xe2};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x77, 0xbb, 0xdc, 0xfa, 0xb5, 0x6c, 0x78, 0xac, 0x37, 0x1,  0xc2, 0x8e,
                              0x5,  0x37, 0x1c, 0xcf, 0x58, 0x94, 0x17, 0xcc, 0xd,  0xd2, 0x8,  0x1e};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\148q\203\&9\184:)\217]G\254\f`\208\248\&4\183\139
// \RS\CAN\219\RS\133d\252H\220L\v", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS2, _willTopic = "u\187\\\\+\205\SOHy&{\228\219.\ETB\ENQ\219", _willMsg = "\147
// !K\155\f\253\214\246hNm\ACK)\156\193\241$\198>\RSz", _willProps = [PropUserProperty "n\179)X"
// "\b1\221\191\STX\223etX_\186\246\146",PropContentType
// "\232\216.\186\132p\211\187\\\n\201\166\240T\131\238\224e",PropAssignedClientIdentifier
// "s\FS\181Te\a\231",PropTopicAlias 32238,PropServerKeepAlive 20424,PropContentType
// "\173\ETBO^\SOH\224\STX\171\STX\215\232",PropMaximumPacketSize 4132,PropRequestResponseInformation
// 174,PropAuthenticationMethod
// "\129+\a\238\194\199\RS\175\r\\\FS\226i\159\191\183)\141S_\SOH%\140\203a\SO\244\ETB",PropResponseInformation
// "\144\254\186D\222\220",PropSharedSubscriptionAvailable 25,PropServerReference
// "\151\191l\188\RS0q\131\NAK\149\&6}\240D\247\191\218\187_rW\246\191\138\250cD",PropSubscriptionIdentifier
// 8,PropResponseTopic ",B\DLE\157\215\&0\153\&2\255\f",PropAuthenticationMethod
// "^-o\195v\166\ao\207\203\139\249\SO\244\206le",PropUserProperty
// "$]\254\EOT\232^\153\201\238\&4\178j\195\233q~\RS\194\163"
// "I\DLEUZ\132Y\219\155\&5j\228&xf\225>\223\203\SUBX\153\246\190\NULB\133\202\198\242\245",PropUserProperty
// ":Y\213\240b" "0$W\185\144\240"]}), _cleanSession = False, _keepAlive = 20026, _connID =
// "_\DEL\aB\218\207H\EMs\SO\153b@\162", _properties = [PropRequestResponseInformation 246,PropTopicAliasMaximum 18904]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x10, 0xed, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb4, 0x4e, 0x3a, 0x5,  0x19, 0xf6, 0x22, 0x49, 0xd8,
      0x0,  0xe,  0x5f, 0x7f, 0x7,  0x42, 0xda, 0xcf, 0x48, 0x19, 0x73, 0xe,  0x99, 0x62, 0x40, 0xa2, 0x81, 0x2,  0x26,
      0x0,  0x4,  0x6e, 0xb3, 0x29, 0x58, 0x0,  0xd,  0x8,  0x31, 0xdd, 0xbf, 0x2,  0xdf, 0x65, 0x74, 0x58, 0x5f, 0xba,
      0xf6, 0x92, 0x3,  0x0,  0x12, 0xe8, 0xd8, 0x2e, 0xba, 0x84, 0x70, 0xd3, 0xbb, 0x5c, 0xa,  0xc9, 0xa6, 0xf0, 0x54,
      0x83, 0xee, 0xe0, 0x65, 0x12, 0x0,  0x7,  0x73, 0x1c, 0xb5, 0x54, 0x65, 0x7,  0xe7, 0x23, 0x7d, 0xee, 0x13, 0x4f,
      0xc8, 0x3,  0x0,  0xb,  0xad, 0x17, 0x4f, 0x5e, 0x1,  0xe0, 0x2,  0xab, 0x2,  0xd7, 0xe8, 0x27, 0x0,  0x0,  0x10,
      0x24, 0x19, 0xae, 0x15, 0x0,  0x1c, 0x81, 0x2b, 0x7,  0xee, 0xc2, 0xc7, 0x1e, 0xaf, 0xd,  0x5c, 0x1c, 0xe2, 0x69,
      0x9f, 0xbf, 0xb7, 0x29, 0x8d, 0x53, 0x5f, 0x1,  0x25, 0x8c, 0xcb, 0x61, 0xe,  0xf4, 0x17, 0x1a, 0x0,  0x6,  0x90,
      0xfe, 0xba, 0x44, 0xde, 0xdc, 0x2a, 0x19, 0x1c, 0x0,  0x1b, 0x97, 0xbf, 0x6c, 0xbc, 0x1e, 0x30, 0x71, 0x83, 0x15,
      0x95, 0x36, 0x7d, 0xf0, 0x44, 0xf7, 0xbf, 0xda, 0xbb, 0x5f, 0x72, 0x57, 0xf6, 0xbf, 0x8a, 0xfa, 0x63, 0x44, 0xb,
      0x8,  0x8,  0x0,  0xa,  0x2c, 0x42, 0x10, 0x9d, 0xd7, 0x30, 0x99, 0x32, 0xff, 0xc,  0x15, 0x0,  0x11, 0x5e, 0x2d,
      0x6f, 0xc3, 0x76, 0xa6, 0x7,  0x6f, 0xcf, 0xcb, 0x8b, 0xf9, 0xe,  0xf4, 0xce, 0x6c, 0x65, 0x26, 0x0,  0x13, 0x24,
      0x5d, 0xfe, 0x4,  0xe8, 0x5e, 0x99, 0xc9, 0xee, 0x34, 0xb2, 0x6a, 0xc3, 0xe9, 0x71, 0x7e, 0x1e, 0xc2, 0xa3, 0x0,
      0x1e, 0x49, 0x10, 0x55, 0x5a, 0x84, 0x59, 0xdb, 0x9b, 0x35, 0x6a, 0xe4, 0x26, 0x78, 0x66, 0xe1, 0x3e, 0xdf, 0xcb,
      0x1a, 0x58, 0x99, 0xf6, 0xbe, 0x0,  0x42, 0x85, 0xca, 0xc6, 0xf2, 0xf5, 0x26, 0x0,  0x5,  0x3a, 0x59, 0xd5, 0xf0,
      0x62, 0x0,  0x6,  0x30, 0x24, 0x57, 0xb9, 0x90, 0xf0, 0x0,  0x10, 0x75, 0xbb, 0x5c, 0x5c, 0x2b, 0xcd, 0x1,  0x79,
      0x26, 0x7b, 0xe4, 0xdb, 0x2e, 0x17, 0x5,  0xdb, 0x0,  0x16, 0x93, 0x20, 0x21, 0x4b, 0x9b, 0xc,  0xfd, 0xd6, 0xf6,
      0x68, 0x4e, 0x6d, 0x6,  0x29, 0x9c, 0xc1, 0xf1, 0x24, 0xc6, 0x3e, 0x1e, 0x7a, 0x0,  0x1e, 0x94, 0x71, 0xcb, 0x39,
      0xb8, 0x3a, 0x29, 0xd9, 0x5d, 0x47, 0xfe, 0xc,  0x60, 0xd0, 0xf8, 0x34, 0xb7, 0x8b, 0x20, 0x1e, 0x18, 0xdb, 0x1e,
      0x85, 0x64, 0xfc, 0x48, 0xdc, 0x4c, 0xb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18904}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x8, 0x31, 0xdd, 0xbf, 0x2, 0xdf, 0x65, 0x74, 0x58, 0x5f, 0xba, 0xf6, 0x92};
  uint8_t byteswillprops0[] = {0x6e, 0xb3, 0x29, 0x58};
  uint8_t byteswillprops2[] = {0xe8, 0xd8, 0x2e, 0xba, 0x84, 0x70, 0xd3, 0xbb, 0x5c,
                               0xa,  0xc9, 0xa6, 0xf0, 0x54, 0x83, 0xee, 0xe0, 0x65};
  uint8_t byteswillprops3[] = {0x73, 0x1c, 0xb5, 0x54, 0x65, 0x7, 0xe7};
  uint8_t byteswillprops4[] = {0xad, 0x17, 0x4f, 0x5e, 0x1, 0xe0, 0x2, 0xab, 0x2, 0xd7, 0xe8};
  uint8_t byteswillprops5[] = {0x81, 0x2b, 0x7,  0xee, 0xc2, 0xc7, 0x1e, 0xaf, 0xd,  0x5c, 0x1c, 0xe2, 0x69, 0x9f,
                               0xbf, 0xb7, 0x29, 0x8d, 0x53, 0x5f, 0x1,  0x25, 0x8c, 0xcb, 0x61, 0xe,  0xf4, 0x17};
  uint8_t byteswillprops6[] = {0x90, 0xfe, 0xba, 0x44, 0xde, 0xdc};
  uint8_t byteswillprops7[] = {0x97, 0xbf, 0x6c, 0xbc, 0x1e, 0x30, 0x71, 0x83, 0x15, 0x95, 0x36, 0x7d, 0xf0, 0x44,
                               0xf7, 0xbf, 0xda, 0xbb, 0x5f, 0x72, 0x57, 0xf6, 0xbf, 0x8a, 0xfa, 0x63, 0x44};
  uint8_t byteswillprops8[] = {0x2c, 0x42, 0x10, 0x9d, 0xd7, 0x30, 0x99, 0x32, 0xff, 0xc};
  uint8_t byteswillprops9[] = {0x5e, 0x2d, 0x6f, 0xc3, 0x76, 0xa6, 0x7,  0x6f, 0xcf,
                               0xcb, 0x8b, 0xf9, 0xe,  0xf4, 0xce, 0x6c, 0x65};
  uint8_t byteswillprops11[] = {0x49, 0x10, 0x55, 0x5a, 0x84, 0x59, 0xdb, 0x9b, 0x35, 0x6a,
                                0xe4, 0x26, 0x78, 0x66, 0xe1, 0x3e, 0xdf, 0xcb, 0x1a, 0x58,
                                0x99, 0xf6, 0xbe, 0x0,  0x42, 0x85, 0xca, 0xc6, 0xf2, 0xf5};
  uint8_t byteswillprops10[] = {0x24, 0x5d, 0xfe, 0x4,  0xe8, 0x5e, 0x99, 0xc9, 0xee, 0x34,
                                0xb2, 0x6a, 0xc3, 0xe9, 0x71, 0x7e, 0x1e, 0xc2, 0xa3};
  uint8_t byteswillprops13[] = {0x30, 0x24, 0x57, 0xb9, 0x90, 0xf0};
  uint8_t byteswillprops12[] = {0x3a, 0x59, 0xd5, 0xf0, 0x62};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops0}, .v = {13, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32238}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20424}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4132}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {19, (char*)&byteswillprops10}, .v = {30, (char*)&byteswillprops11}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {5, (char*)&byteswillprops12}, .v = {6, (char*)&byteswillprops13}}}},
  };

  lwmqtt_properties_t willprops = {17, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x75, 0xbb, 0x5c, 0x5c, 0x2b, 0xcd, 0x1, 0x79,
                                0x26, 0x7b, 0xe4, 0xdb, 0x2e, 0x17, 0x5, 0xdb};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x93, 0x20, 0x21, 0x4b, 0x9b, 0xc,  0xfd, 0xd6, 0xf6, 0x68, 0x4e,
                                  0x6d, 0x6,  0x29, 0x9c, 0xc1, 0xf1, 0x24, 0xc6, 0x3e, 0x1e, 0x7a};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20026;
  uint8_t client_id_bytes[] = {0x5f, 0x7f, 0x7, 0x42, 0xda, 0xcf, 0x48, 0x19, 0x73, 0xe, 0x99, 0x62, 0x40, 0xa2};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x94, 0x71, 0xcb, 0x39, 0xb8, 0x3a, 0x29, 0xd9, 0x5d, 0x47, 0xfe, 0xc,  0x60, 0xd0, 0xf8,
                              0x34, 0xb7, 0x8b, 0x20, 0x1e, 0x18, 0xdb, 0x1e, 0x85, 0x64, 0xfc, 0x48, 0xdc, 0x4c, 0xb};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "F|\\\193@", _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 13766, _connID = "((\SOH\237M\220\167\ESC\241\249\138f\149\134\225\RS U!\133]\SO\204\&8D.g\154",
// _properties = [PropServerReference "\237\186\SIg\196\172\241",PropMessageExpiryInterval
// 12799,PropRequestResponseInformation 71,PropRequestResponseInformation 250,PropMessageExpiryInterval
// 30631,PropUserProperty "\213\"\193\183V2XH\144\169\EM"
// "\b&[\137B\243\207\224\US\165Q\128Q\164>\174W\150\174V\US\190\169\222\250\r\206\150",PropSessionExpiryInterval
// 24456,PropRequestResponseInformation 8,PropRetainAvailable 102,PropServerKeepAlive 18186,PropMessageExpiryInterval
// 23633]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x85, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x40, 0x35, 0xc6, 0x55, 0x1c, 0x0,
                   0x7,  0xed, 0xba, 0xf,  0x67, 0xc4, 0xac, 0xf1, 0x2,  0x0,  0x0,  0x31, 0xff, 0x19, 0x47, 0x19,
                   0xfa, 0x2,  0x0,  0x0,  0x77, 0xa7, 0x26, 0x0,  0xb,  0xd5, 0x22, 0xc1, 0xb7, 0x56, 0x32, 0x58,
                   0x48, 0x90, 0xa9, 0x19, 0x0,  0x1c, 0x8,  0x26, 0x5b, 0x89, 0x42, 0xf3, 0xcf, 0xe0, 0x1f, 0xa5,
                   0x51, 0x80, 0x51, 0xa4, 0x3e, 0xae, 0x57, 0x96, 0xae, 0x56, 0x1f, 0xbe, 0xa9, 0xde, 0xfa, 0xd,
                   0xce, 0x96, 0x11, 0x0,  0x0,  0x5f, 0x88, 0x19, 0x8,  0x25, 0x66, 0x13, 0x47, 0xa,  0x2,  0x0,
                   0x0,  0x5c, 0x51, 0x0,  0x1c, 0x28, 0x28, 0x1,  0xed, 0x4d, 0xdc, 0xa7, 0x1b, 0xf1, 0xf9, 0x8a,
                   0x66, 0x95, 0x86, 0xe1, 0x1e, 0x20, 0x55, 0x21, 0x85, 0x5d, 0xe,  0xcc, 0x38, 0x44, 0x2e, 0x67,
                   0x9a, 0x0,  0x5,  0x46, 0x7c, 0x5c, 0xc1, 0x40};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xed, 0xba, 0xf, 0x67, 0xc4, 0xac, 0xf1};
  uint8_t bytesprops2[] = {0x8,  0x26, 0x5b, 0x89, 0x42, 0xf3, 0xcf, 0xe0, 0x1f, 0xa5, 0x51, 0x80, 0x51, 0xa4,
                           0x3e, 0xae, 0x57, 0x96, 0xae, 0x56, 0x1f, 0xbe, 0xa9, 0xde, 0xfa, 0xd,  0xce, 0x96};
  uint8_t bytesprops1[] = {0xd5, 0x22, 0xc1, 0xb7, 0x56, 0x32, 0x58, 0x48, 0x90, 0xa9, 0x19};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12799}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30631}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {28, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24456}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18186}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23633}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13766;
  uint8_t client_id_bytes[] = {0x28, 0x28, 0x1,  0xed, 0x4d, 0xdc, 0xa7, 0x1b, 0xf1, 0xf9, 0x8a, 0x66, 0x95, 0x86,
                               0xe1, 0x1e, 0x20, 0x55, 0x21, 0x85, 0x5d, 0xe,  0xcc, 0x38, 0x44, 0x2e, 0x67, 0x9a};
  lwmqtt_string_t client_id = {28, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x46, 0x7c, 0x5c, 0xc1, 0x40};
  lwmqtt_string_t password = {5, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "C\205.\143\174\198\137\162\176\DC1 \254/'\209\141o\153",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "H\153y\169d\249\209\v\245\233\238\223\202L\133\136\143\191\142\179FE )2\242\148k", _willMsg =
// "D\217<g\166\143\242\142\161*\241\141", _willProps = [PropSessionExpiryInterval 6728]}), _cleanSession = False,
// _keepAlive = 19318, _connID = "a\208\181\&4\129", _properties = [PropSubscriptionIdentifierAvailable
// 228,PropSubscriptionIdentifierAvailable 95,PropResponseTopic
// "SM\\`(\242\ESC\132\184\229\212<5\157\207\&1&\NAK<J",PropUserProperty
// "\206\150\193\145\197\145\EOTy]\247\253\181\243\170\177\RS\197o\202\&8\168{Zr \137\155\&5"
// "\r4\SOL\173\&8\244\DC4\197\167\130\ACK<\135\206\242\173\179jo\218\220\135sH\182\r",PropReasonString
// "q\200MF\228\205<,\195dF\220r\145\186c\226\252\226\188\213\227\186\151",PropReasonString
// "\241\128\r(\DLE~Y\169\197\242\CANa\DEL=k\f\178",PropReasonString
// "#\148t\t\170\186x\158\132\ACK\188D?",PropSubscriptionIdentifierAvailable 28,PropAuthenticationData
// "#]\135\177\181\176\230/",PropWillDelayInterval 7451,PropMaximumQoS 196,PropSubscriptionIdentifier
// 8,PropWillDelayInterval 2730,PropReasonString
// "\186\136\SYN\231\FS\SO\180\247\149\238\195\b\169\204\228\131ZF\224E3\198\154J\221\t\DC32D",PropContentType
// "\249\v\147\&7\237\207\163\193\ACK\ENQ\136(\RS6=\160\236\252\US\129g\164\ETB\202\&1\137\235\200",PropTopicAlias
// 1362,PropSharedSubscriptionAvailable 35]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x10, 0xce, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x74, 0x4b, 0x76, 0xf5, 0x1,  0x29, 0xe4, 0x29, 0x5f,
      0x8,  0x0,  0x14, 0x53, 0x4d, 0x5c, 0x60, 0x28, 0xf2, 0x1b, 0x84, 0xb8, 0xe5, 0xd4, 0x3c, 0x35, 0x9d, 0xcf, 0x31,
      0x26, 0x15, 0x3c, 0x4a, 0x26, 0x0,  0x1c, 0xce, 0x96, 0xc1, 0x91, 0xc5, 0x91, 0x4,  0x79, 0x5d, 0xf7, 0xfd, 0xb5,
      0xf3, 0xaa, 0xb1, 0x1e, 0xc5, 0x6f, 0xca, 0x38, 0xa8, 0x7b, 0x5a, 0x72, 0x20, 0x89, 0x9b, 0x35, 0x0,  0x1b, 0xd,
      0x34, 0xe,  0x4c, 0xad, 0x38, 0xf4, 0x14, 0xc5, 0xa7, 0x82, 0x6,  0x3c, 0x87, 0xce, 0xf2, 0xad, 0xb3, 0x6a, 0x6f,
      0xda, 0xdc, 0x87, 0x73, 0x48, 0xb6, 0xd,  0x1f, 0x0,  0x18, 0x71, 0xc8, 0x4d, 0x46, 0xe4, 0xcd, 0x3c, 0x2c, 0xc3,
      0x64, 0x46, 0xdc, 0x72, 0x91, 0xba, 0x63, 0xe2, 0xfc, 0xe2, 0xbc, 0xd5, 0xe3, 0xba, 0x97, 0x1f, 0x0,  0x11, 0xf1,
      0x80, 0xd,  0x28, 0x10, 0x7e, 0x59, 0xa9, 0xc5, 0xf2, 0x18, 0x61, 0x7f, 0x3d, 0x6b, 0xc,  0xb2, 0x1f, 0x0,  0xd,
      0x23, 0x94, 0x74, 0x9,  0xaa, 0xba, 0x78, 0x9e, 0x84, 0x6,  0xbc, 0x44, 0x3f, 0x29, 0x1c, 0x16, 0x0,  0x8,  0x23,
      0x5d, 0x87, 0xb1, 0xb5, 0xb0, 0xe6, 0x2f, 0x18, 0x0,  0x0,  0x1d, 0x1b, 0x24, 0xc4, 0xb,  0x8,  0x18, 0x0,  0x0,
      0xa,  0xaa, 0x1f, 0x0,  0x1d, 0xba, 0x88, 0x16, 0xe7, 0x1c, 0xe,  0xb4, 0xf7, 0x95, 0xee, 0xc3, 0x8,  0xa9, 0xcc,
      0xe4, 0x83, 0x5a, 0x46, 0xe0, 0x45, 0x33, 0xc6, 0x9a, 0x4a, 0xdd, 0x9,  0x13, 0x32, 0x44, 0x3,  0x0,  0x1c, 0xf9,
      0xb,  0x93, 0x37, 0xed, 0xcf, 0xa3, 0xc1, 0x6,  0x5,  0x88, 0x28, 0x1e, 0x36, 0x3d, 0xa0, 0xec, 0xfc, 0x1f, 0x81,
      0x67, 0xa4, 0x17, 0xca, 0x31, 0x89, 0xeb, 0xc8, 0x23, 0x5,  0x52, 0x2a, 0x23, 0x0,  0x5,  0x61, 0xd0, 0xb5, 0x34,
      0x81, 0x5,  0x11, 0x0,  0x0,  0x1a, 0x48, 0x0,  0x1c, 0x48, 0x99, 0x79, 0xa9, 0x64, 0xf9, 0xd1, 0xb,  0xf5, 0xe9,
      0xee, 0xdf, 0xca, 0x4c, 0x85, 0x88, 0x8f, 0xbf, 0x8e, 0xb3, 0x46, 0x45, 0x20, 0x29, 0x32, 0xf2, 0x94, 0x6b, 0x0,
      0xc,  0x44, 0xd9, 0x3c, 0x67, 0xa6, 0x8f, 0xf2, 0x8e, 0xa1, 0x2a, 0xf1, 0x8d, 0x0,  0x12, 0x43, 0xcd, 0x2e, 0x8f,
      0xae, 0xc6, 0x89, 0xa2, 0xb0, 0x11, 0x20, 0xfe, 0x2f, 0x27, 0xd1, 0x8d, 0x6f, 0x99};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x53, 0x4d, 0x5c, 0x60, 0x28, 0xf2, 0x1b, 0x84, 0xb8, 0xe5,
                           0xd4, 0x3c, 0x35, 0x9d, 0xcf, 0x31, 0x26, 0x15, 0x3c, 0x4a};
  uint8_t bytesprops2[] = {0xd,  0x34, 0xe,  0x4c, 0xad, 0x38, 0xf4, 0x14, 0xc5, 0xa7, 0x82, 0x6,  0x3c, 0x87,
                           0xce, 0xf2, 0xad, 0xb3, 0x6a, 0x6f, 0xda, 0xdc, 0x87, 0x73, 0x48, 0xb6, 0xd};
  uint8_t bytesprops1[] = {0xce, 0x96, 0xc1, 0x91, 0xc5, 0x91, 0x4,  0x79, 0x5d, 0xf7, 0xfd, 0xb5, 0xf3, 0xaa,
                           0xb1, 0x1e, 0xc5, 0x6f, 0xca, 0x38, 0xa8, 0x7b, 0x5a, 0x72, 0x20, 0x89, 0x9b, 0x35};
  uint8_t bytesprops3[] = {0x71, 0xc8, 0x4d, 0x46, 0xe4, 0xcd, 0x3c, 0x2c, 0xc3, 0x64, 0x46, 0xdc,
                           0x72, 0x91, 0xba, 0x63, 0xe2, 0xfc, 0xe2, 0xbc, 0xd5, 0xe3, 0xba, 0x97};
  uint8_t bytesprops4[] = {0xf1, 0x80, 0xd,  0x28, 0x10, 0x7e, 0x59, 0xa9, 0xc5,
                           0xf2, 0x18, 0x61, 0x7f, 0x3d, 0x6b, 0xc,  0xb2};
  uint8_t bytesprops5[] = {0x23, 0x94, 0x74, 0x9, 0xaa, 0xba, 0x78, 0x9e, 0x84, 0x6, 0xbc, 0x44, 0x3f};
  uint8_t bytesprops6[] = {0x23, 0x5d, 0x87, 0xb1, 0xb5, 0xb0, 0xe6, 0x2f};
  uint8_t bytesprops7[] = {0xba, 0x88, 0x16, 0xe7, 0x1c, 0xe,  0xb4, 0xf7, 0x95, 0xee, 0xc3, 0x8,  0xa9, 0xcc, 0xe4,
                           0x83, 0x5a, 0x46, 0xe0, 0x45, 0x33, 0xc6, 0x9a, 0x4a, 0xdd, 0x9,  0x13, 0x32, 0x44};
  uint8_t bytesprops8[] = {0xf9, 0xb,  0x93, 0x37, 0xed, 0xcf, 0xa3, 0xc1, 0x6,  0x5,  0x88, 0x28, 0x1e, 0x36,
                           0x3d, 0xa0, 0xec, 0xfc, 0x1f, 0x81, 0x67, 0xa4, 0x17, 0xca, 0x31, 0x89, 0xeb, 0xc8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops1}, .v = {27, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7451}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 8}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2730}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1362}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 35}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6728}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x48, 0x99, 0x79, 0xa9, 0x64, 0xf9, 0xd1, 0xb,  0xf5, 0xe9, 0xee, 0xdf, 0xca, 0x4c,
                                0x85, 0x88, 0x8f, 0xbf, 0x8e, 0xb3, 0x46, 0x45, 0x20, 0x29, 0x32, 0xf2, 0x94, 0x6b};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x44, 0xd9, 0x3c, 0x67, 0xa6, 0x8f, 0xf2, 0x8e, 0xa1, 0x2a, 0xf1, 0x8d};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19318;
  uint8_t client_id_bytes[] = {0x61, 0xd0, 0xb5, 0x34, 0x81};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x43, 0xcd, 0x2e, 0x8f, 0xae, 0xc6, 0x89, 0xa2, 0xb0,
                              0x11, 0x20, 0xfe, 0x2f, 0x27, 0xd1, 0x8d, 0x6f, 0x99};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "M\136e\"\219\149\DEL]\217q\189\203\ACK\246\159E\156\169\140\SOHWs\US\165\190", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "\217+\\\",s\137\EM\165\183{v
// \153\DC2\209\234\183\130`\v\NAK\147\186\243f\182\189\234", _willMsg = "\232\242\218\252K\201\180\128\&2\247\190",
// _willProps = [PropSubscriptionIdentifier 14,PropMaximumQoS 230,PropRequestResponseInformation
// 216,PropSubscriptionIdentifier 22,PropRequestProblemInformation 189,PropWildcardSubscriptionAvailable
// 76,PropContentType "\192p\DC4Y\n\153r\SYN\162\227S\n",PropSharedSubscriptionAvailable 22,PropMessageExpiryInterval
// 8921,PropUserProperty "\EOT\129<lsa\242Q\234m\241\179^T\132\US\249\aD\156"
// "v\171=\140\231\vX\\C\243p\255<T\nSX",PropAssignedClientIdentifier
// "\229\183\175\230:ef\CAN:B'&\163\183\215o/tndgz\146\165\239\162\205",PropMaximumQoS 119,PropResponseInformation
// ""]}), _cleanSession = False, _keepAlive = 12023, _connID = "\228H\166\138\212\250c\180j~T", _properties =
// [PropRetainAvailable 156,PropAssignedClientIdentifier
// "\138\200[\a\151\162\168\132\178;\225\244",PropSubscriptionIdentifierAvailable 81,PropResponseTopic
// "\217\255\181maz\SUB",PropPayloadFormatIndicator 17,PropContentType
// "\236\204s\138\197X\255\251\175\233w\181*\163{\153w\157\186",PropReceiveMaximum 28382,PropReceiveMaximum
// 28558,PropServerReference "\199\128-[\RSeC\NULuv",PropMaximumQoS 178,PropSubscriptionIdentifier
// 28,PropSessionExpiryInterval 21413,PropSubscriptionIdentifierAvailable 146,PropSubscriptionIdentifierAvailable
// 127,PropResponseInformation "\\\NULZ\166\159c\165+D\208\174",PropSessionExpiryInterval 6189,PropRetainAvailable
// 76,PropWildcardSubscriptionAvailable 58,PropSubscriptionIdentifier 9]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x10, 0xbd, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x74, 0x2e, 0xf7, 0x6e, 0x25, 0x9c, 0x12, 0x0,  0xc,
      0x8a, 0xc8, 0x5b, 0x7,  0x97, 0xa2, 0xa8, 0x84, 0xb2, 0x3b, 0xe1, 0xf4, 0x29, 0x51, 0x8,  0x0,  0x7,  0xd9, 0xff,
      0xb5, 0x6d, 0x61, 0x7a, 0x1a, 0x1,  0x11, 0x3,  0x0,  0x13, 0xec, 0xcc, 0x73, 0x8a, 0xc5, 0x58, 0xff, 0xfb, 0xaf,
      0xe9, 0x77, 0xb5, 0x2a, 0xa3, 0x7b, 0x99, 0x77, 0x9d, 0xba, 0x21, 0x6e, 0xde, 0x21, 0x6f, 0x8e, 0x1c, 0x0,  0xa,
      0xc7, 0x80, 0x2d, 0x5b, 0x1e, 0x65, 0x43, 0x0,  0x75, 0x76, 0x24, 0xb2, 0xb,  0x1c, 0x11, 0x0,  0x0,  0x53, 0xa5,
      0x29, 0x92, 0x29, 0x7f, 0x1a, 0x0,  0xb,  0x5c, 0x0,  0x5a, 0xa6, 0x9f, 0x63, 0xa5, 0x2b, 0x44, 0xd0, 0xae, 0x11,
      0x0,  0x0,  0x18, 0x2d, 0x25, 0x4c, 0x28, 0x3a, 0xb,  0x9,  0x0,  0xb,  0xe4, 0x48, 0xa6, 0x8a, 0xd4, 0xfa, 0x63,
      0xb4, 0x6a, 0x7e, 0x54, 0x6f, 0xb,  0xe,  0x24, 0xe6, 0x19, 0xd8, 0xb,  0x16, 0x17, 0xbd, 0x28, 0x4c, 0x3,  0x0,
      0xc,  0xc0, 0x70, 0x14, 0x59, 0xa,  0x99, 0x72, 0x16, 0xa2, 0xe3, 0x53, 0xa,  0x2a, 0x16, 0x2,  0x0,  0x0,  0x22,
      0xd9, 0x26, 0x0,  0x14, 0x4,  0x81, 0x3c, 0x6c, 0x73, 0x61, 0xf2, 0x51, 0xea, 0x6d, 0xf1, 0xb3, 0x5e, 0x54, 0x84,
      0x1f, 0xf9, 0x7,  0x44, 0x9c, 0x0,  0x11, 0x76, 0xab, 0x3d, 0x8c, 0xe7, 0xb,  0x58, 0x5c, 0x43, 0xf3, 0x70, 0xff,
      0x3c, 0x54, 0xa,  0x53, 0x58, 0x12, 0x0,  0x1b, 0xe5, 0xb7, 0xaf, 0xe6, 0x3a, 0x65, 0x66, 0x18, 0x3a, 0x42, 0x27,
      0x26, 0xa3, 0xb7, 0xd7, 0x6f, 0x2f, 0x74, 0x6e, 0x64, 0x67, 0x7a, 0x92, 0xa5, 0xef, 0xa2, 0xcd, 0x24, 0x77, 0x1a,
      0x0,  0x0,  0x0,  0x1d, 0xd9, 0x2b, 0x5c, 0x22, 0x2c, 0x73, 0x89, 0x19, 0xa5, 0xb7, 0x7b, 0x76, 0x20, 0x99, 0x12,
      0xd1, 0xea, 0xb7, 0x82, 0x60, 0xb,  0x15, 0x93, 0xba, 0xf3, 0x66, 0xb6, 0xbd, 0xea, 0x0,  0xb,  0xe8, 0xf2, 0xda,
      0xfc, 0x4b, 0xc9, 0xb4, 0x80, 0x32, 0xf7, 0xbe, 0x0,  0x19, 0x4d, 0x88, 0x65, 0x22, 0xdb, 0x95, 0x7f, 0x5d, 0xd9,
      0x71, 0xbd, 0xcb, 0x6,  0xf6, 0x9f, 0x45, 0x9c, 0xa9, 0x8c, 0x1,  0x57, 0x73, 0x1f, 0xa5, 0xbe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8a, 0xc8, 0x5b, 0x7, 0x97, 0xa2, 0xa8, 0x84, 0xb2, 0x3b, 0xe1, 0xf4};
  uint8_t bytesprops1[] = {0xd9, 0xff, 0xb5, 0x6d, 0x61, 0x7a, 0x1a};
  uint8_t bytesprops2[] = {0xec, 0xcc, 0x73, 0x8a, 0xc5, 0x58, 0xff, 0xfb, 0xaf, 0xe9,
                           0x77, 0xb5, 0x2a, 0xa3, 0x7b, 0x99, 0x77, 0x9d, 0xba};
  uint8_t bytesprops3[] = {0xc7, 0x80, 0x2d, 0x5b, 0x1e, 0x65, 0x43, 0x0, 0x75, 0x76};
  uint8_t bytesprops4[] = {0x5c, 0x0, 0x5a, 0xa6, 0x9f, 0x63, 0xa5, 0x2b, 0x44, 0xd0, 0xae};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28382}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28558}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21413}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6189}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc0, 0x70, 0x14, 0x59, 0xa, 0x99, 0x72, 0x16, 0xa2, 0xe3, 0x53, 0xa};
  uint8_t byteswillprops2[] = {0x76, 0xab, 0x3d, 0x8c, 0xe7, 0xb, 0x58, 0x5c, 0x43,
                               0xf3, 0x70, 0xff, 0x3c, 0x54, 0xa, 0x53, 0x58};
  uint8_t byteswillprops1[] = {0x4,  0x81, 0x3c, 0x6c, 0x73, 0x61, 0xf2, 0x51, 0xea, 0x6d,
                               0xf1, 0xb3, 0x5e, 0x54, 0x84, 0x1f, 0xf9, 0x7,  0x44, 0x9c};
  uint8_t byteswillprops3[] = {0xe5, 0xb7, 0xaf, 0xe6, 0x3a, 0x65, 0x66, 0x18, 0x3a, 0x42, 0x27, 0x26, 0xa3, 0xb7,
                               0xd7, 0x6f, 0x2f, 0x74, 0x6e, 0x64, 0x67, 0x7a, 0x92, 0xa5, 0xef, 0xa2, 0xcd};
  uint8_t byteswillprops4[] = {0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8921}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {20, (char*)&byteswillprops1}, .v = {17, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd9, 0x2b, 0x5c, 0x22, 0x2c, 0x73, 0x89, 0x19, 0xa5, 0xb7,
                                0x7b, 0x76, 0x20, 0x99, 0x12, 0xd1, 0xea, 0xb7, 0x82, 0x60,
                                0xb,  0x15, 0x93, 0xba, 0xf3, 0x66, 0xb6, 0xbd, 0xea};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe8, 0xf2, 0xda, 0xfc, 0x4b, 0xc9, 0xb4, 0x80, 0x32, 0xf7, 0xbe};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12023;
  uint8_t client_id_bytes[] = {0xe4, 0x48, 0xa6, 0x8a, 0xd4, 0xfa, 0x63, 0xb4, 0x6a, 0x7e, 0x54};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4d, 0x88, 0x65, 0x22, 0xdb, 0x95, 0x7f, 0x5d, 0xd9, 0x71, 0xbd, 0xcb, 0x6,
                              0xf6, 0x9f, 0x45, 0x9c, 0xa9, 0x8c, 0x1,  0x57, 0x73, 0x1f, 0xa5, 0xbe};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "|\155\165C", _willMsg = "\178\238\129\175W", _willProps = [PropWillDelayInterval
// 22403,PropMessageExpiryInterval 24373,PropServerReference "@\226\247\b\234\SUB",PropResponseTopic
// "5\"\218=Q&\194\GSBS,(\230\204\198<d\220\ETX\RSw\157\192",PropSubscriptionIdentifierAvailable 169,PropServerKeepAlive
// 13675,PropSharedSubscriptionAvailable 122,PropResponseTopic
// "\243\177\172\ENQ\237K\149\a\144\202\215\154\234N\DC2\231\NUL@\185\196\198\236\215\195z\EOT\203+\EOT",PropContentType
// "\US\250^",PropMessageExpiryInterval 24793,PropPayloadFormatIndicator 141,PropMessageExpiryInterval
// 22571,PropServerKeepAlive 9175,PropRequestProblemInformation 89,PropSubscriptionIdentifier 4,PropCorrelationData
// "\ENQ\145k",PropTopicAliasMaximum 10170,PropRequestProblemInformation 165,PropResponseInformation
// "Y\236\162",PropSessionExpiryInterval 3542]}), _cleanSession = True, _keepAlive = 30344, _connID =
// "Pz[\222\193I\206|RX4\RS\n\227\r\227Gt\DC2", _properties = [PropUserProperty
// "M\DLE\230\180\168&\186\ACKz\159\240\209#\244\214\209X\134\172\142"
// "\f\233K\224PX\FS\192z(\233\NUL\172\254",PropMaximumQoS 227,PropServerKeepAlive 17370,PropMessageExpiryInterval
// 24558,PropServerReference "w\RS\203Ww",PropRequestResponseInformation 118,PropResponseInformation
// "\247\135\247b\tm1\n\210[\190E0s\164?|\SYNQD\v\229\131\SUB\FS}\170\\",PropAuthenticationData
// "O\167\SUB\234\243a",PropRequestResponseInformation 23,PropTopicAlias 25811,PropRetainAvailable
// 42,PropSessionExpiryInterval 15731,PropTopicAlias 24866,PropMaximumPacketSize
// 17203,PropSubscriptionIdentifierAvailable 214,PropResponseTopic "",PropReceiveMaximum 23001,PropUserProperty
// "+M\205\228\234\166^\159\236\183Bq4\147h\ACK" "@B\FS\vu\177\a\199\176\166j",PropRetainAvailable
// 151,PropPayloadFormatIndicator 63,PropMaximumPacketSize 7435,PropReceiveMaximum 1154,PropSharedSubscriptionAvailable
// 245,PropSharedSubscriptionAvailable 225]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x10, 0xe2, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0x76, 0x88, 0xaf, 0x1,  0x26, 0x0,  0x14, 0x4d,
      0x10, 0xe6, 0xb4, 0xa8, 0x26, 0xba, 0x6,  0x7a, 0x9f, 0xf0, 0xd1, 0x23, 0xf4, 0xd6, 0xd1, 0x58, 0x86, 0xac, 0x8e,
      0x0,  0xe,  0xc,  0xe9, 0x4b, 0xe0, 0x50, 0x58, 0x1c, 0xc0, 0x7a, 0x28, 0xe9, 0x0,  0xac, 0xfe, 0x24, 0xe3, 0x13,
      0x43, 0xda, 0x2,  0x0,  0x0,  0x5f, 0xee, 0x1c, 0x0,  0x5,  0x77, 0x1e, 0xcb, 0x57, 0x77, 0x19, 0x76, 0x1a, 0x0,
      0x1c, 0xf7, 0x87, 0xf7, 0x62, 0x9,  0x6d, 0x31, 0xa,  0xd2, 0x5b, 0xbe, 0x45, 0x30, 0x73, 0xa4, 0x3f, 0x7c, 0x16,
      0x51, 0x44, 0xb,  0xe5, 0x83, 0x1a, 0x1c, 0x7d, 0xaa, 0x5c, 0x16, 0x0,  0x6,  0x4f, 0xa7, 0x1a, 0xea, 0xf3, 0x61,
      0x19, 0x17, 0x23, 0x64, 0xd3, 0x25, 0x2a, 0x11, 0x0,  0x0,  0x3d, 0x73, 0x23, 0x61, 0x22, 0x27, 0x0,  0x0,  0x43,
      0x33, 0x29, 0xd6, 0x8,  0x0,  0x0,  0x21, 0x59, 0xd9, 0x26, 0x0,  0x10, 0x2b, 0x4d, 0xcd, 0xe4, 0xea, 0xa6, 0x5e,
      0x9f, 0xec, 0xb7, 0x42, 0x71, 0x34, 0x93, 0x68, 0x6,  0x0,  0xb,  0x40, 0x42, 0x1c, 0xb,  0x75, 0xb1, 0x7,  0xc7,
      0xb0, 0xa6, 0x6a, 0x25, 0x97, 0x1,  0x3f, 0x27, 0x0,  0x0,  0x1d, 0xb,  0x21, 0x4,  0x82, 0x2a, 0xf5, 0x2a, 0xe1,
      0x0,  0x13, 0x50, 0x7a, 0x5b, 0xde, 0xc1, 0x49, 0xce, 0x7c, 0x52, 0x58, 0x34, 0x1e, 0xa,  0xe3, 0xd,  0xe3, 0x47,
      0x74, 0x12, 0x83, 0x1,  0x18, 0x0,  0x0,  0x57, 0x83, 0x2,  0x0,  0x0,  0x5f, 0x35, 0x1c, 0x0,  0x6,  0x40, 0xe2,
      0xf7, 0x8,  0xea, 0x1a, 0x8,  0x0,  0x17, 0x35, 0x22, 0xda, 0x3d, 0x51, 0x26, 0xc2, 0x1d, 0x42, 0x53, 0x2c, 0x28,
      0xe6, 0xcc, 0xc6, 0x3c, 0x64, 0xdc, 0x3,  0x1e, 0x77, 0x9d, 0xc0, 0x29, 0xa9, 0x13, 0x35, 0x6b, 0x2a, 0x7a, 0x8,
      0x0,  0x1d, 0xf3, 0xb1, 0xac, 0x5,  0xed, 0x4b, 0x95, 0x7,  0x90, 0xca, 0xd7, 0x9a, 0xea, 0x4e, 0x12, 0xe7, 0x0,
      0x40, 0xb9, 0xc4, 0xc6, 0xec, 0xd7, 0xc3, 0x7a, 0x4,  0xcb, 0x2b, 0x4,  0x3,  0x0,  0x3,  0x1f, 0xfa, 0x5e, 0x2,
      0x0,  0x0,  0x60, 0xd9, 0x1,  0x8d, 0x2,  0x0,  0x0,  0x58, 0x2b, 0x13, 0x23, 0xd7, 0x17, 0x59, 0xb,  0x4,  0x9,
      0x0,  0x3,  0x5,  0x91, 0x6b, 0x22, 0x27, 0xba, 0x17, 0xa5, 0x1a, 0x0,  0x3,  0x59, 0xec, 0xa2, 0x11, 0x0,  0x0,
      0xd,  0xd6, 0x0,  0x4,  0x7c, 0x9b, 0xa5, 0x43, 0x0,  0x5,  0xb2, 0xee, 0x81, 0xaf, 0x57};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0xc, 0xe9, 0x4b, 0xe0, 0x50, 0x58, 0x1c, 0xc0, 0x7a, 0x28, 0xe9, 0x0, 0xac, 0xfe};
  uint8_t bytesprops0[] = {0x4d, 0x10, 0xe6, 0xb4, 0xa8, 0x26, 0xba, 0x6,  0x7a, 0x9f,
                           0xf0, 0xd1, 0x23, 0xf4, 0xd6, 0xd1, 0x58, 0x86, 0xac, 0x8e};
  uint8_t bytesprops2[] = {0x77, 0x1e, 0xcb, 0x57, 0x77};
  uint8_t bytesprops3[] = {0xf7, 0x87, 0xf7, 0x62, 0x9,  0x6d, 0x31, 0xa,  0xd2, 0x5b, 0xbe, 0x45, 0x30, 0x73,
                           0xa4, 0x3f, 0x7c, 0x16, 0x51, 0x44, 0xb,  0xe5, 0x83, 0x1a, 0x1c, 0x7d, 0xaa, 0x5c};
  uint8_t bytesprops4[] = {0x4f, 0xa7, 0x1a, 0xea, 0xf3, 0x61};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops7[] = {0x40, 0x42, 0x1c, 0xb, 0x75, 0xb1, 0x7, 0xc7, 0xb0, 0xa6, 0x6a};
  uint8_t bytesprops6[] = {0x2b, 0x4d, 0xcd, 0xe4, 0xea, 0xa6, 0x5e, 0x9f,
                           0xec, 0xb7, 0x42, 0x71, 0x34, 0x93, 0x68, 0x6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops0}, .v = {14, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17370}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24558}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25811}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15731}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24866}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17203}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23001}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops6}, .v = {11, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7435}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1154}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 225}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x40, 0xe2, 0xf7, 0x8, 0xea, 0x1a};
  uint8_t byteswillprops1[] = {0x35, 0x22, 0xda, 0x3d, 0x51, 0x26, 0xc2, 0x1d, 0x42, 0x53, 0x2c, 0x28,
                               0xe6, 0xcc, 0xc6, 0x3c, 0x64, 0xdc, 0x3,  0x1e, 0x77, 0x9d, 0xc0};
  uint8_t byteswillprops2[] = {0xf3, 0xb1, 0xac, 0x5,  0xed, 0x4b, 0x95, 0x7,  0x90, 0xca, 0xd7, 0x9a, 0xea, 0x4e, 0x12,
                               0xe7, 0x0,  0x40, 0xb9, 0xc4, 0xc6, 0xec, 0xd7, 0xc3, 0x7a, 0x4,  0xcb, 0x2b, 0x4};
  uint8_t byteswillprops3[] = {0x1f, 0xfa, 0x5e};
  uint8_t byteswillprops4[] = {0x5, 0x91, 0x6b};
  uint8_t byteswillprops5[] = {0x59, 0xec, 0xa2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22403}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24373}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13675}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24793}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22571}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9175}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10170}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3542}},
  };

  lwmqtt_properties_t willprops = {20, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x7c, 0x9b, 0xa5, 0x43};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb2, 0xee, 0x81, 0xaf, 0x57};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30344;
  uint8_t client_id_bytes[] = {0x50, 0x7a, 0x5b, 0xde, 0xc1, 0x49, 0xce, 0x7c, 0x52, 0x58,
                               0x34, 0x1e, 0xa,  0xe3, 0xd,  0xe3, 0x47, 0x74, 0x12};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\198\196\247\188\142\&7g\186", _lastWill = Nothing,
// _cleanSession = True, _keepAlive = 25768, _connID = "\177", _properties = [PropSessionExpiryInterval
// 16768,PropSharedSubscriptionAvailable 100,PropAssignedClientIdentifier
// "\151$e\211\DEL\v4{\209\DC3\224\ETX\ETX\207P\154\US\DC1\251M\209\206#\238\167\138\180Z\"<",PropRequestResponseInformation
// 220,PropSessionExpiryInterval 6893,PropServerKeepAlive 30431,PropMessageExpiryInterval
// 17079,PropSubscriptionIdentifier 13,PropSharedSubscriptionAvailable 184,PropReasonString "\150
// S\142S\136\226\212=T",PropResponseTopic "+{\254\232\147\229D\155(\138\218\181\151\228\&0\174",PropContentType
// "i\166\173@E\182",PropMessageExpiryInterval 16187]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x81, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x42, 0x64, 0xa8, 0x69, 0x11, 0x0,  0x0,
                   0x41, 0x80, 0x2a, 0x64, 0x12, 0x0,  0x1e, 0x97, 0x24, 0x65, 0xd3, 0x7f, 0xb,  0x34, 0x7b, 0xd1, 0x13,
                   0xe0, 0x3,  0x3,  0xcf, 0x50, 0x9a, 0x1f, 0x11, 0xfb, 0x4d, 0xd1, 0xce, 0x23, 0xee, 0xa7, 0x8a, 0xb4,
                   0x5a, 0x22, 0x3c, 0x19, 0xdc, 0x11, 0x0,  0x0,  0x1a, 0xed, 0x13, 0x76, 0xdf, 0x2,  0x0,  0x0,  0x42,
                   0xb7, 0xb,  0xd,  0x2a, 0xb8, 0x1f, 0x0,  0xa,  0x96, 0x20, 0x53, 0x8e, 0x53, 0x88, 0xe2, 0xd4, 0x3d,
                   0x54, 0x8,  0x0,  0x10, 0x2b, 0x7b, 0xfe, 0xe8, 0x93, 0xe5, 0x44, 0x9b, 0x28, 0x8a, 0xda, 0xb5, 0x97,
                   0xe4, 0x30, 0xae, 0x3,  0x0,  0x6,  0x69, 0xa6, 0xad, 0x40, 0x45, 0xb6, 0x2,  0x0,  0x0,  0x3f, 0x3b,
                   0x0,  0x1,  0xb1, 0x0,  0x8,  0xc6, 0xc4, 0xf7, 0xbc, 0x8e, 0x37, 0x67, 0xba};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x97, 0x24, 0x65, 0xd3, 0x7f, 0xb,  0x34, 0x7b, 0xd1, 0x13, 0xe0, 0x3,  0x3,  0xcf, 0x50,
                           0x9a, 0x1f, 0x11, 0xfb, 0x4d, 0xd1, 0xce, 0x23, 0xee, 0xa7, 0x8a, 0xb4, 0x5a, 0x22, 0x3c};
  uint8_t bytesprops1[] = {0x96, 0x20, 0x53, 0x8e, 0x53, 0x88, 0xe2, 0xd4, 0x3d, 0x54};
  uint8_t bytesprops2[] = {0x2b, 0x7b, 0xfe, 0xe8, 0x93, 0xe5, 0x44, 0x9b,
                           0x28, 0x8a, 0xda, 0xb5, 0x97, 0xe4, 0x30, 0xae};
  uint8_t bytesprops3[] = {0x69, 0xa6, 0xad, 0x40, 0x45, 0xb6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16768}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6893}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30431}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17079}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 13}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16187}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25768;
  uint8_t client_id_bytes[] = {0xb1};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc6, 0xc4, 0xf7, 0xbc, 0x8e, 0x37, 0x67, 0xba};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\253\b\230\224\160\154\138\174", _password = Just "b;8{
// \144\183\161\198a\ETX<G\142\SOH\217\CANb\SO\218\234", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\141\213\218=?\NAK\195?&,\246", _willMsg = "f\188r\ETX\160~_h)`i\DELj\230'y\198\DC2\248e",
// _willProps = [PropWillDelayInterval 8524,PropUserProperty
// "\DC1,\171KC\149\168k\184\191\161&4\RS\146\EM\216\159\170\147\181"
// "\ETX,/\183uX\145\212\DC1x\166b_\250\188\210%F\186\246fUb\188\196\140\255\CAN\204",PropMessageExpiryInterval
// 400,PropMaximumQoS 202,PropAuthenticationMethod "\167\212f]\129z\203\226\CAN\129",PropMaximumPacketSize
// 8793,PropReceiveMaximum 20707,PropReasonString "\237(\191\NAK\190\250{\182n\146",PropWildcardSubscriptionAvailable
// 21,PropResponseTopic
// "\195+\ESC\141l\210\152\244\164\\\ETX\174\149\f\147\ETB,)\220\CANB5\NAKl\192\159\187\140",PropRetainAvailable
// 143,PropMessageExpiryInterval 7219,PropCorrelationData "\ENQg/\SUB\220[O\DC1",PropSessionExpiryInterval
// 7627,PropReceiveMaximum 16916,PropAssignedClientIdentifier "-M&\187\217\&1\205\STX"]}), _cleanSession = True,
// _keepAlive = 31425, _connID = "", _properties = [PropAssignedClientIdentifier
// "\148V:G\210\178\254U\151\CAN)1",PropMaximumQoS 122,PropRequestResponseInformation 61,PropResponseInformation
// "@i!.~\SI\SOH\162G",PropRetainAvailable 232,PropAssignedClientIdentifier
// "\v\"\v\160\142\191\140\GS",PropWildcardSubscriptionAvailable 17,PropContentType
// "c\190\220\230\f5\STX6\ACK\132\220l",PropWildcardSubscriptionAvailable 220,PropWildcardSubscriptionAvailable
// 209,PropTopicAlias 4140,PropWildcardSubscriptionAvailable 46,PropSubscriptionIdentifier 28,PropAuthenticationMethod
// "\b\235\153G8",PropMessageExpiryInterval 12451,PropAssignedClientIdentifier "\185?\204\195 \143"]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x10, 0xdc, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x7a, 0xc1, 0x5e, 0x12, 0x0,  0xc,  0x94, 0x56,
      0x3a, 0x47, 0xd2, 0xb2, 0xfe, 0x55, 0x97, 0x18, 0x29, 0x31, 0x24, 0x7a, 0x19, 0x3d, 0x1a, 0x0,  0x9,  0x40, 0x69,
      0x21, 0x2e, 0x7e, 0xf,  0x1,  0xa2, 0x47, 0x25, 0xe8, 0x12, 0x0,  0x8,  0xb,  0x22, 0xb,  0xa0, 0x8e, 0xbf, 0x8c,
      0x1d, 0x28, 0x11, 0x3,  0x0,  0xc,  0x63, 0xbe, 0xdc, 0xe6, 0xc,  0x35, 0x2,  0x36, 0x6,  0x84, 0xdc, 0x6c, 0x28,
      0xdc, 0x28, 0xd1, 0x23, 0x10, 0x2c, 0x28, 0x2e, 0xb,  0x1c, 0x15, 0x0,  0x5,  0x8,  0xeb, 0x99, 0x47, 0x38, 0x2,
      0x0,  0x0,  0x30, 0xa3, 0x12, 0x0,  0x6,  0xb9, 0x3f, 0xcc, 0xc3, 0x20, 0x8f, 0x0,  0x0,  0xab, 0x1,  0x18, 0x0,
      0x0,  0x21, 0x4c, 0x26, 0x0,  0x15, 0x11, 0x2c, 0xab, 0x4b, 0x43, 0x95, 0xa8, 0x6b, 0xb8, 0xbf, 0xa1, 0x26, 0x34,
      0x1e, 0x92, 0x19, 0xd8, 0x9f, 0xaa, 0x93, 0xb5, 0x0,  0x1d, 0x3,  0x2c, 0x2f, 0xb7, 0x75, 0x58, 0x91, 0xd4, 0x11,
      0x78, 0xa6, 0x62, 0x5f, 0xfa, 0xbc, 0xd2, 0x25, 0x46, 0xba, 0xf6, 0x66, 0x55, 0x62, 0xbc, 0xc4, 0x8c, 0xff, 0x18,
      0xcc, 0x2,  0x0,  0x0,  0x1,  0x90, 0x24, 0xca, 0x15, 0x0,  0xa,  0xa7, 0xd4, 0x66, 0x5d, 0x81, 0x7a, 0xcb, 0xe2,
      0x18, 0x81, 0x27, 0x0,  0x0,  0x22, 0x59, 0x21, 0x50, 0xe3, 0x1f, 0x0,  0xa,  0xed, 0x28, 0xbf, 0x15, 0xbe, 0xfa,
      0x7b, 0xb6, 0x6e, 0x92, 0x28, 0x15, 0x8,  0x0,  0x1c, 0xc3, 0x2b, 0x1b, 0x8d, 0x6c, 0xd2, 0x98, 0xf4, 0xa4, 0x5c,
      0x3,  0xae, 0x95, 0xc,  0x93, 0x17, 0x2c, 0x29, 0xdc, 0x18, 0x42, 0x35, 0x15, 0x6c, 0xc0, 0x9f, 0xbb, 0x8c, 0x25,
      0x8f, 0x2,  0x0,  0x0,  0x1c, 0x33, 0x9,  0x0,  0x8,  0x5,  0x67, 0x2f, 0x1a, 0xdc, 0x5b, 0x4f, 0x11, 0x11, 0x0,
      0x0,  0x1d, 0xcb, 0x21, 0x42, 0x14, 0x12, 0x0,  0x8,  0x2d, 0x4d, 0x26, 0xbb, 0xd9, 0x31, 0xcd, 0x2,  0x0,  0xb,
      0x8d, 0xd5, 0xda, 0x3d, 0x3f, 0x15, 0xc3, 0x3f, 0x26, 0x2c, 0xf6, 0x0,  0x14, 0x66, 0xbc, 0x72, 0x3,  0xa0, 0x7e,
      0x5f, 0x68, 0x29, 0x60, 0x69, 0x7f, 0x6a, 0xe6, 0x27, 0x79, 0xc6, 0x12, 0xf8, 0x65, 0x0,  0x8,  0xfd, 0x8,  0xe6,
      0xe0, 0xa0, 0x9a, 0x8a, 0xae, 0x0,  0x15, 0x62, 0x3b, 0x38, 0x7b, 0x20, 0x90, 0xb7, 0xa1, 0xc6, 0x61, 0x3,  0x3c,
      0x47, 0x8e, 0x1,  0xd9, 0x18, 0x62, 0xe,  0xda, 0xea};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x94, 0x56, 0x3a, 0x47, 0xd2, 0xb2, 0xfe, 0x55, 0x97, 0x18, 0x29, 0x31};
  uint8_t bytesprops1[] = {0x40, 0x69, 0x21, 0x2e, 0x7e, 0xf, 0x1, 0xa2, 0x47};
  uint8_t bytesprops2[] = {0xb, 0x22, 0xb, 0xa0, 0x8e, 0xbf, 0x8c, 0x1d};
  uint8_t bytesprops3[] = {0x63, 0xbe, 0xdc, 0xe6, 0xc, 0x35, 0x2, 0x36, 0x6, 0x84, 0xdc, 0x6c};
  uint8_t bytesprops4[] = {0x8, 0xeb, 0x99, 0x47, 0x38};
  uint8_t bytesprops5[] = {0xb9, 0x3f, 0xcc, 0xc3, 0x20, 0x8f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4140}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12451}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x3,  0x2c, 0x2f, 0xb7, 0x75, 0x58, 0x91, 0xd4, 0x11, 0x78, 0xa6, 0x62, 0x5f, 0xfa, 0xbc,
                               0xd2, 0x25, 0x46, 0xba, 0xf6, 0x66, 0x55, 0x62, 0xbc, 0xc4, 0x8c, 0xff, 0x18, 0xcc};
  uint8_t byteswillprops0[] = {0x11, 0x2c, 0xab, 0x4b, 0x43, 0x95, 0xa8, 0x6b, 0xb8, 0xbf, 0xa1,
                               0x26, 0x34, 0x1e, 0x92, 0x19, 0xd8, 0x9f, 0xaa, 0x93, 0xb5};
  uint8_t byteswillprops2[] = {0xa7, 0xd4, 0x66, 0x5d, 0x81, 0x7a, 0xcb, 0xe2, 0x18, 0x81};
  uint8_t byteswillprops3[] = {0xed, 0x28, 0xbf, 0x15, 0xbe, 0xfa, 0x7b, 0xb6, 0x6e, 0x92};
  uint8_t byteswillprops4[] = {0xc3, 0x2b, 0x1b, 0x8d, 0x6c, 0xd2, 0x98, 0xf4, 0xa4, 0x5c, 0x3,  0xae, 0x95, 0xc,
                               0x93, 0x17, 0x2c, 0x29, 0xdc, 0x18, 0x42, 0x35, 0x15, 0x6c, 0xc0, 0x9f, 0xbb, 0x8c};
  uint8_t byteswillprops5[] = {0x5, 0x67, 0x2f, 0x1a, 0xdc, 0x5b, 0x4f, 0x11};
  uint8_t byteswillprops6[] = {0x2d, 0x4d, 0x26, 0xbb, 0xd9, 0x31, 0xcd, 0x2};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8524}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {21, (char*)&byteswillprops0}, .v = {29, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 400}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8793}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20707}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7219}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7627}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16916}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&byteswillprops6}}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8d, 0xd5, 0xda, 0x3d, 0x3f, 0x15, 0xc3, 0x3f, 0x26, 0x2c, 0xf6};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x66, 0xbc, 0x72, 0x3,  0xa0, 0x7e, 0x5f, 0x68, 0x29, 0x60,
                                  0x69, 0x7f, 0x6a, 0xe6, 0x27, 0x79, 0xc6, 0x12, 0xf8, 0x65};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31425;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfd, 0x8, 0xe6, 0xe0, 0xa0, 0x9a, 0x8a, 0xae};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x62, 0x3b, 0x38, 0x7b, 0x20, 0x90, 0xb7, 0xa1, 0xc6, 0x61, 0x3,
                              0x3c, 0x47, 0x8e, 0x1,  0xd9, 0x18, 0x62, 0xe,  0xda, 0xea};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "IW[\248-[*\NAK\135jJJ\144\&4\148\131H\242IId\184\196a|CB\242\NAK\238", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "c\228\141Pj\227\200\RS", _willMsg =
// "O\181\146\172\&8\200\165pw\156:\227\160\204\"\219-y\US\214\168{", _willProps = [PropReceiveMaximum
// 19134,PropRetainAvailable 127,PropResponseInformation " \219\233\SUB\240\237\195\US\184\201\231)
// I\209\185\163\245)\178",PropReceiveMaximum 2109,PropTopicAliasMaximum 26380,PropWillDelayInterval
// 25234,PropSharedSubscriptionAvailable 105,PropPayloadFormatIndicator 203,PropMessageExpiryInterval
// 6363,PropTopicAliasMaximum 29194,PropMaximumPacketSize 16405,PropSharedSubscriptionAvailable 200,PropTopicAlias
// 291,PropMessageExpiryInterval 21432,PropContentType
// "\228}\248\151\SYN\251\151\172r\186\156D\NUL\240,\157\207\234J\219\&5\136w\NAK\192\STX\222",PropMaximumQoS
// 117,PropMaximumQoS 164,PropMessageExpiryInterval 12769,PropResponseTopic
// "\FS\217L\218V1j7W\191\149\209\204\rQ\142\FS\217\195\254Z\237F\255\192>",PropWildcardSubscriptionAvailable
// 188,PropTopicAlias 20412,PropMessageExpiryInterval 20838]}), _cleanSession = False, _keepAlive = 18040, _connID =
// "\244\188\144", _properties = [PropSessionExpiryInterval 482,PropTopicAlias 11370,PropSubscriptionIdentifier
// 4,PropTopicAlias 22548,PropServerKeepAlive 20135,PropMessageExpiryInterval 12819,PropResponseTopic
// "\a\172).\155_&\186\bT\213\171h\128\&3b",PropMessageExpiryInterval 10474,PropAuthenticationData
// "\179\ETX%<#\253\182",PropRequestProblemInformation 150]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x9d, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x54, 0x46, 0x78, 0x39, 0x11, 0x0,  0x0,
                   0x1,  0xe2, 0x23, 0x2c, 0x6a, 0xb,  0x4,  0x23, 0x58, 0x14, 0x13, 0x4e, 0xa7, 0x2,  0x0,  0x0,  0x32,
                   0x13, 0x8,  0x0,  0x10, 0x7,  0xac, 0x29, 0x2e, 0x9b, 0x5f, 0x26, 0xba, 0x8,  0x54, 0xd5, 0xab, 0x68,
                   0x80, 0x33, 0x62, 0x2,  0x0,  0x0,  0x28, 0xea, 0x16, 0x0,  0x7,  0xb3, 0x3,  0x25, 0x3c, 0x23, 0xfd,
                   0xb6, 0x17, 0x96, 0x0,  0x3,  0xf4, 0xbc, 0x90, 0x90, 0x1,  0x21, 0x4a, 0xbe, 0x25, 0x7f, 0x1a, 0x0,
                   0x14, 0x20, 0xdb, 0xe9, 0x1a, 0xf0, 0xed, 0xc3, 0x1f, 0xb8, 0xc9, 0xe7, 0x29, 0x20, 0x49, 0xd1, 0xb9,
                   0xa3, 0xf5, 0x29, 0xb2, 0x21, 0x8,  0x3d, 0x22, 0x67, 0xc,  0x18, 0x0,  0x0,  0x62, 0x92, 0x2a, 0x69,
                   0x1,  0xcb, 0x2,  0x0,  0x0,  0x18, 0xdb, 0x22, 0x72, 0xa,  0x27, 0x0,  0x0,  0x40, 0x15, 0x2a, 0xc8,
                   0x23, 0x1,  0x23, 0x2,  0x0,  0x0,  0x53, 0xb8, 0x3,  0x0,  0x1b, 0xe4, 0x7d, 0xf8, 0x97, 0x16, 0xfb,
                   0x97, 0xac, 0x72, 0xba, 0x9c, 0x44, 0x0,  0xf0, 0x2c, 0x9d, 0xcf, 0xea, 0x4a, 0xdb, 0x35, 0x88, 0x77,
                   0x15, 0xc0, 0x2,  0xde, 0x24, 0x75, 0x24, 0xa4, 0x2,  0x0,  0x0,  0x31, 0xe1, 0x8,  0x0,  0x1a, 0x1c,
                   0xd9, 0x4c, 0xda, 0x56, 0x31, 0x6a, 0x37, 0x57, 0xbf, 0x95, 0xd1, 0xcc, 0xd,  0x51, 0x8e, 0x1c, 0xd9,
                   0xc3, 0xfe, 0x5a, 0xed, 0x46, 0xff, 0xc0, 0x3e, 0x28, 0xbc, 0x23, 0x4f, 0xbc, 0x2,  0x0,  0x0,  0x51,
                   0x66, 0x0,  0x8,  0x63, 0xe4, 0x8d, 0x50, 0x6a, 0xe3, 0xc8, 0x1e, 0x0,  0x16, 0x4f, 0xb5, 0x92, 0xac,
                   0x38, 0xc8, 0xa5, 0x70, 0x77, 0x9c, 0x3a, 0xe3, 0xa0, 0xcc, 0x22, 0xdb, 0x2d, 0x79, 0x1f, 0xd6, 0xa8,
                   0x7b, 0x0,  0x1e, 0x49, 0x57, 0x5b, 0xf8, 0x2d, 0x5b, 0x2a, 0x15, 0x87, 0x6a, 0x4a, 0x4a, 0x90, 0x34,
                   0x94, 0x83, 0x48, 0xf2, 0x49, 0x49, 0x64, 0xb8, 0xc4, 0x61, 0x7c, 0x43, 0x42, 0xf2, 0x15, 0xee};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7, 0xac, 0x29, 0x2e, 0x9b, 0x5f, 0x26, 0xba,
                           0x8, 0x54, 0xd5, 0xab, 0x68, 0x80, 0x33, 0x62};
  uint8_t bytesprops1[] = {0xb3, 0x3, 0x25, 0x3c, 0x23, 0xfd, 0xb6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 482}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11370}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 4}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22548}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20135}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12819}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10474}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 150}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x20, 0xdb, 0xe9, 0x1a, 0xf0, 0xed, 0xc3, 0x1f, 0xb8, 0xc9,
                               0xe7, 0x29, 0x20, 0x49, 0xd1, 0xb9, 0xa3, 0xf5, 0x29, 0xb2};
  uint8_t byteswillprops1[] = {0xe4, 0x7d, 0xf8, 0x97, 0x16, 0xfb, 0x97, 0xac, 0x72, 0xba, 0x9c, 0x44, 0x0, 0xf0,
                               0x2c, 0x9d, 0xcf, 0xea, 0x4a, 0xdb, 0x35, 0x88, 0x77, 0x15, 0xc0, 0x2,  0xde};
  uint8_t byteswillprops2[] = {0x1c, 0xd9, 0x4c, 0xda, 0x56, 0x31, 0x6a, 0x37, 0x57, 0xbf, 0x95, 0xd1, 0xcc,
                               0xd,  0x51, 0x8e, 0x1c, 0xd9, 0xc3, 0xfe, 0x5a, 0xed, 0x46, 0xff, 0xc0, 0x3e};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19134}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2109}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26380}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25234}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6363}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29194}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16405}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 291}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21432}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12769}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20412}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20838}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x63, 0xe4, 0x8d, 0x50, 0x6a, 0xe3, 0xc8, 0x1e};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4f, 0xb5, 0x92, 0xac, 0x38, 0xc8, 0xa5, 0x70, 0x77, 0x9c, 0x3a,
                                  0xe3, 0xa0, 0xcc, 0x22, 0xdb, 0x2d, 0x79, 0x1f, 0xd6, 0xa8, 0x7b};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18040;
  uint8_t client_id_bytes[] = {0xf4, 0xbc, 0x90};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x49, 0x57, 0x5b, 0xf8, 0x2d, 0x5b, 0x2a, 0x15, 0x87, 0x6a, 0x4a, 0x4a, 0x90, 0x34, 0x94,
                              0x83, 0x48, 0xf2, 0x49, 0x49, 0x64, 0xb8, 0xc4, 0x61, 0x7c, 0x43, 0x42, 0xf2, 0x15, 0xee};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "$\184\198/)\161\242\&4\202q.\235\175\183`h", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\ETX-gs\242\r\246#:\255\212\251\221\STX#P", _willMsg =
// "\241\&7\183W", _willProps = [PropSubscriptionIdentifier 6,PropTopicAliasMaximum 26473,PropMaximumQoS
// 150,PropAssignedClientIdentifier "\244rQ",PropMaximumPacketSize 23974,PropSubscriptionIdentifierAvailable
// 160,PropAssignedClientIdentifier
// "*\160\213ln,\237\178\229\FS\213\146\212\253p\238\187m\STXK\212h\224\228\249\217\SI\239\ACK\224",PropWillDelayInterval
// 16452,PropResponseInformation
// "<\149\EOT\ETBRKz/V\224\147\196\r\161\137\241\141\198\216U\202w:1\164_\160\&0\191\169",PropPayloadFormatIndicator
// 66,PropRequestResponseInformation 230,PropResponseTopic
// "\208&\191:\194\ETB\254\252\246B\158\163\rD\169kV\EM\130T\227\201|g\164\US",PropReceiveMaximum
// 8181,PropSubscriptionIdentifier 22,PropSessionExpiryInterval 18537,PropWillDelayInterval 19433,PropUserProperty
// "\EOT\186\188\174\158C@\STXk" "\183\137~\242\139\&5\128\202\FSr\183\DLE\149|i\RSl\164",PropTopicAlias
// 17737,PropAuthenticationMethod "\145\240S!F\217\SYNH\173W\SOH",PropReasonString
// "\157m\SOH!",PropRequestProblemInformation 110,PropServerReference "\218m\SUB\253\206\137Vd\241",PropReasonString
// "\CANj\188\NAK\203\255k\243\211\237~\253\197\219x_0\207~\176\255\160\213\137S\168\146\DEL",PropContentType
// "\142<\128\\Y\158",PropWildcardSubscriptionAvailable 72,PropAuthenticationMethod
// ":o\163\244\234\212\131\157\DLE\252\160@\214\149\SOH\192\FSf\n\250:\220\206\219"]}), _cleanSession = False,
// _keepAlive = 6911, _connID = "Nr\151\198", _properties = [PropWildcardSubscriptionAvailable
// 158,PropSubscriptionIdentifier 17,PropContentType "\FS\226\218j\196",PropUserProperty ""
// "\174\242\166\220\171\RS\202\180T\ACK",PropMessageExpiryInterval 11680,PropContentType
// "\FS\NAK\FS!\226\242\237\179V\211i\198\206\138`\169zS\128\&3\130",PropRequestProblemInformation 175]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x10, 0x8d, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x84, 0x1a, 0xff, 0x3a, 0x28, 0x9e, 0xb,  0x11, 0x3,
      0x0,  0x5,  0x1c, 0xe2, 0xda, 0x6a, 0xc4, 0x26, 0x0,  0x0,  0x0,  0xa,  0xae, 0xf2, 0xa6, 0xdc, 0xab, 0x1e, 0xca,
      0xb4, 0x54, 0x6,  0x2,  0x0,  0x0,  0x2d, 0xa0, 0x3,  0x0,  0x15, 0x1c, 0x15, 0x1c, 0x21, 0xe2, 0xf2, 0xed, 0xb3,
      0x56, 0xd3, 0x69, 0xc6, 0xce, 0x8a, 0x60, 0xa9, 0x7a, 0x53, 0x80, 0x33, 0x82, 0x17, 0xaf, 0x0,  0x4,  0x4e, 0x72,
      0x97, 0xc6, 0x96, 0x2,  0xb,  0x6,  0x22, 0x67, 0x69, 0x24, 0x96, 0x12, 0x0,  0x3,  0xf4, 0x72, 0x51, 0x27, 0x0,
      0x0,  0x5d, 0xa6, 0x29, 0xa0, 0x12, 0x0,  0x1e, 0x2a, 0xa0, 0xd5, 0x6c, 0x6e, 0x2c, 0xed, 0xb2, 0xe5, 0x1c, 0xd5,
      0x92, 0xd4, 0xfd, 0x70, 0xee, 0xbb, 0x6d, 0x2,  0x4b, 0xd4, 0x68, 0xe0, 0xe4, 0xf9, 0xd9, 0xf,  0xef, 0x6,  0xe0,
      0x18, 0x0,  0x0,  0x40, 0x44, 0x1a, 0x0,  0x1e, 0x3c, 0x95, 0x4,  0x17, 0x52, 0x4b, 0x7a, 0x2f, 0x56, 0xe0, 0x93,
      0xc4, 0xd,  0xa1, 0x89, 0xf1, 0x8d, 0xc6, 0xd8, 0x55, 0xca, 0x77, 0x3a, 0x31, 0xa4, 0x5f, 0xa0, 0x30, 0xbf, 0xa9,
      0x1,  0x42, 0x19, 0xe6, 0x8,  0x0,  0x1a, 0xd0, 0x26, 0xbf, 0x3a, 0xc2, 0x17, 0xfe, 0xfc, 0xf6, 0x42, 0x9e, 0xa3,
      0xd,  0x44, 0xa9, 0x6b, 0x56, 0x19, 0x82, 0x54, 0xe3, 0xc9, 0x7c, 0x67, 0xa4, 0x1f, 0x21, 0x1f, 0xf5, 0xb,  0x16,
      0x11, 0x0,  0x0,  0x48, 0x69, 0x18, 0x0,  0x0,  0x4b, 0xe9, 0x26, 0x0,  0x9,  0x4,  0xba, 0xbc, 0xae, 0x9e, 0x43,
      0x40, 0x2,  0x6b, 0x0,  0x12, 0xb7, 0x89, 0x7e, 0xf2, 0x8b, 0x35, 0x80, 0xca, 0x1c, 0x72, 0xb7, 0x10, 0x95, 0x7c,
      0x69, 0x1e, 0x6c, 0xa4, 0x23, 0x45, 0x49, 0x15, 0x0,  0xb,  0x91, 0xf0, 0x53, 0x21, 0x46, 0xd9, 0x16, 0x48, 0xad,
      0x57, 0x1,  0x1f, 0x0,  0x4,  0x9d, 0x6d, 0x1,  0x21, 0x17, 0x6e, 0x1c, 0x0,  0x9,  0xda, 0x6d, 0x1a, 0xfd, 0xce,
      0x89, 0x56, 0x64, 0xf1, 0x1f, 0x0,  0x1c, 0x18, 0x6a, 0xbc, 0x15, 0xcb, 0xff, 0x6b, 0xf3, 0xd3, 0xed, 0x7e, 0xfd,
      0xc5, 0xdb, 0x78, 0x5f, 0x30, 0xcf, 0x7e, 0xb0, 0xff, 0xa0, 0xd5, 0x89, 0x53, 0xa8, 0x92, 0x7f, 0x3,  0x0,  0x6,
      0x8e, 0x3c, 0x80, 0x5c, 0x59, 0x9e, 0x28, 0x48, 0x15, 0x0,  0x18, 0x3a, 0x6f, 0xa3, 0xf4, 0xea, 0xd4, 0x83, 0x9d,
      0x10, 0xfc, 0xa0, 0x40, 0xd6, 0x95, 0x1,  0xc0, 0x1c, 0x66, 0xa,  0xfa, 0x3a, 0xdc, 0xce, 0xdb, 0x0,  0x10, 0x3,
      0x2d, 0x67, 0x73, 0xf2, 0xd,  0xf6, 0x23, 0x3a, 0xff, 0xd4, 0xfb, 0xdd, 0x2,  0x23, 0x50, 0x0,  0x4,  0xf1, 0x37,
      0xb7, 0x57, 0x0,  0x10, 0x24, 0xb8, 0xc6, 0x2f, 0x29, 0xa1, 0xf2, 0x34, 0xca, 0x71, 0x2e, 0xeb, 0xaf, 0xb7, 0x60,
      0x68};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1c, 0xe2, 0xda, 0x6a, 0xc4};
  uint8_t bytesprops2[] = {0xae, 0xf2, 0xa6, 0xdc, 0xab, 0x1e, 0xca, 0xb4, 0x54, 0x6};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops3[] = {0x1c, 0x15, 0x1c, 0x21, 0xe2, 0xf2, 0xed, 0xb3, 0x56, 0xd3, 0x69,
                           0xc6, 0xce, 0x8a, 0x60, 0xa9, 0x7a, 0x53, 0x80, 0x33, 0x82};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 17}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops1}, .v = {10, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11680}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 175}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf4, 0x72, 0x51};
  uint8_t byteswillprops1[] = {0x2a, 0xa0, 0xd5, 0x6c, 0x6e, 0x2c, 0xed, 0xb2, 0xe5, 0x1c,
                               0xd5, 0x92, 0xd4, 0xfd, 0x70, 0xee, 0xbb, 0x6d, 0x2,  0x4b,
                               0xd4, 0x68, 0xe0, 0xe4, 0xf9, 0xd9, 0xf,  0xef, 0x6,  0xe0};
  uint8_t byteswillprops2[] = {0x3c, 0x95, 0x4,  0x17, 0x52, 0x4b, 0x7a, 0x2f, 0x56, 0xe0,
                               0x93, 0xc4, 0xd,  0xa1, 0x89, 0xf1, 0x8d, 0xc6, 0xd8, 0x55,
                               0xca, 0x77, 0x3a, 0x31, 0xa4, 0x5f, 0xa0, 0x30, 0xbf, 0xa9};
  uint8_t byteswillprops3[] = {0xd0, 0x26, 0xbf, 0x3a, 0xc2, 0x17, 0xfe, 0xfc, 0xf6, 0x42, 0x9e, 0xa3, 0xd,
                               0x44, 0xa9, 0x6b, 0x56, 0x19, 0x82, 0x54, 0xe3, 0xc9, 0x7c, 0x67, 0xa4, 0x1f};
  uint8_t byteswillprops5[] = {0xb7, 0x89, 0x7e, 0xf2, 0x8b, 0x35, 0x80, 0xca, 0x1c,
                               0x72, 0xb7, 0x10, 0x95, 0x7c, 0x69, 0x1e, 0x6c, 0xa4};
  uint8_t byteswillprops4[] = {0x4, 0xba, 0xbc, 0xae, 0x9e, 0x43, 0x40, 0x2, 0x6b};
  uint8_t byteswillprops6[] = {0x91, 0xf0, 0x53, 0x21, 0x46, 0xd9, 0x16, 0x48, 0xad, 0x57, 0x1};
  uint8_t byteswillprops7[] = {0x9d, 0x6d, 0x1, 0x21};
  uint8_t byteswillprops8[] = {0xda, 0x6d, 0x1a, 0xfd, 0xce, 0x89, 0x56, 0x64, 0xf1};
  uint8_t byteswillprops9[] = {0x18, 0x6a, 0xbc, 0x15, 0xcb, 0xff, 0x6b, 0xf3, 0xd3, 0xed, 0x7e, 0xfd, 0xc5, 0xdb,
                               0x78, 0x5f, 0x30, 0xcf, 0x7e, 0xb0, 0xff, 0xa0, 0xd5, 0x89, 0x53, 0xa8, 0x92, 0x7f};
  uint8_t byteswillprops10[] = {0x8e, 0x3c, 0x80, 0x5c, 0x59, 0x9e};
  uint8_t byteswillprops11[] = {0x3a, 0x6f, 0xa3, 0xf4, 0xea, 0xd4, 0x83, 0x9d, 0x10, 0xfc, 0xa0, 0x40,
                                0xd6, 0x95, 0x1,  0xc0, 0x1c, 0x66, 0xa,  0xfa, 0x3a, 0xdc, 0xce, 0xdb};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 6}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26473}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23974}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16452}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8181}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18537}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19433}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops4}, .v = {18, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17737}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&byteswillprops11}}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3,  0x2d, 0x67, 0x73, 0xf2, 0xd, 0xf6, 0x23,
                                0x3a, 0xff, 0xd4, 0xfb, 0xdd, 0x2, 0x23, 0x50};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf1, 0x37, 0xb7, 0x57};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6911;
  uint8_t client_id_bytes[] = {0x4e, 0x72, 0x97, 0xc6};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x24, 0xb8, 0xc6, 0x2f, 0x29, 0xa1, 0xf2, 0x34,
                              0xca, 0x71, 0x2e, 0xeb, 0xaf, 0xb7, 0x60, 0x68};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\178", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\196\v\202\168\"s\DC1+\222\128\&1\138Y\208Bp\178", _willMsg = "", _willProps =
// [PropRequestProblemInformation 63,PropMaximumPacketSize 20521,PropRequestResponseInformation
// 174,PropAuthenticationMethod "\211\191\181\RS\183z\227\179?1\STXq\206]\142\211vX",PropCorrelationData
// "\177\167\250\SOH\186\bE\SO@",PropSubscriptionIdentifier 3,PropAuthenticationData
// "\176\173@&C\EOT\253V\185\228\195\204\v\138a\176\r\162\227x\146\183\204\140!\184cd\CAN\191",PropMessageExpiryInterval
// 26988,PropResponseInformation "\222}\130\134\234l}\197,",PropRequestResponseInformation 46,PropResponseInformation
// "\v\207\GS\GS\232\164\227",PropTopicAliasMaximum 3468,PropMessageExpiryInterval 24720]}), _cleanSession = True,
// _keepAlive = 11823, _connID = "\r\173C5$+~D\ACK\169D\220\160\218\131!Bo\SO\159HN", _properties =
// [PropAssignedClientIdentifier "O\EM\140\ESCL\218\198\196\207Hn@\142\\\171\137\130\186\145@",PropMessageExpiryInterval
// 29289,PropReasonString "9\ENQ<\196\241\212D\182\152\136\&4\SI"]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0xd9, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xa6, 0x2e, 0x2f, 0x2b, 0x12, 0x0,  0x14,
                   0x4f, 0x19, 0x8c, 0x1b, 0x4c, 0xda, 0xc6, 0xc4, 0xcf, 0x48, 0x6e, 0x40, 0x8e, 0x5c, 0xab, 0x89, 0x82,
                   0xba, 0x91, 0x40, 0x2,  0x0,  0x0,  0x72, 0x69, 0x1f, 0x0,  0xc,  0x39, 0x5,  0x3c, 0xc4, 0xf1, 0xd4,
                   0x44, 0xb6, 0x98, 0x88, 0x34, 0xf,  0x0,  0x16, 0xd,  0xad, 0x43, 0x35, 0x24, 0x2b, 0x7e, 0x44, 0x6,
                   0xa9, 0x44, 0xdc, 0xa0, 0xda, 0x83, 0x21, 0x42, 0x6f, 0xe,  0x9f, 0x48, 0x4e, 0x72, 0x17, 0x3f, 0x27,
                   0x0,  0x0,  0x50, 0x29, 0x19, 0xae, 0x15, 0x0,  0x12, 0xd3, 0xbf, 0xb5, 0x1e, 0xb7, 0x7a, 0xe3, 0xb3,
                   0x3f, 0x31, 0x2,  0x71, 0xce, 0x5d, 0x8e, 0xd3, 0x76, 0x58, 0x9,  0x0,  0x9,  0xb1, 0xa7, 0xfa, 0x1,
                   0xba, 0x8,  0x45, 0xe,  0x40, 0xb,  0x3,  0x16, 0x0,  0x1e, 0xb0, 0xad, 0x40, 0x26, 0x43, 0x4,  0xfd,
                   0x56, 0xb9, 0xe4, 0xc3, 0xcc, 0xb,  0x8a, 0x61, 0xb0, 0xd,  0xa2, 0xe3, 0x78, 0x92, 0xb7, 0xcc, 0x8c,
                   0x21, 0xb8, 0x63, 0x64, 0x18, 0xbf, 0x2,  0x0,  0x0,  0x69, 0x6c, 0x1a, 0x0,  0x9,  0xde, 0x7d, 0x82,
                   0x86, 0xea, 0x6c, 0x7d, 0xc5, 0x2c, 0x19, 0x2e, 0x1a, 0x0,  0x7,  0xb,  0xcf, 0x1d, 0x1d, 0xe8, 0xa4,
                   0xe3, 0x22, 0xd,  0x8c, 0x2,  0x0,  0x0,  0x60, 0x90, 0x0,  0x11, 0xc4, 0xb,  0xca, 0xa8, 0x22, 0x73,
                   0x11, 0x2b, 0xde, 0x80, 0x31, 0x8a, 0x59, 0xd0, 0x42, 0x70, 0xb2, 0x0,  0x0,  0x0,  0x1,  0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4f, 0x19, 0x8c, 0x1b, 0x4c, 0xda, 0xc6, 0xc4, 0xcf, 0x48,
                           0x6e, 0x40, 0x8e, 0x5c, 0xab, 0x89, 0x82, 0xba, 0x91, 0x40};
  uint8_t bytesprops1[] = {0x39, 0x5, 0x3c, 0xc4, 0xf1, 0xd4, 0x44, 0xb6, 0x98, 0x88, 0x34, 0xf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29289}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd3, 0xbf, 0xb5, 0x1e, 0xb7, 0x7a, 0xe3, 0xb3, 0x3f,
                               0x31, 0x2,  0x71, 0xce, 0x5d, 0x8e, 0xd3, 0x76, 0x58};
  uint8_t byteswillprops1[] = {0xb1, 0xa7, 0xfa, 0x1, 0xba, 0x8, 0x45, 0xe, 0x40};
  uint8_t byteswillprops2[] = {0xb0, 0xad, 0x40, 0x26, 0x43, 0x4,  0xfd, 0x56, 0xb9, 0xe4,
                               0xc3, 0xcc, 0xb,  0x8a, 0x61, 0xb0, 0xd,  0xa2, 0xe3, 0x78,
                               0x92, 0xb7, 0xcc, 0x8c, 0x21, 0xb8, 0x63, 0x64, 0x18, 0xbf};
  uint8_t byteswillprops3[] = {0xde, 0x7d, 0x82, 0x86, 0xea, 0x6c, 0x7d, 0xc5, 0x2c};
  uint8_t byteswillprops4[] = {0xb, 0xcf, 0x1d, 0x1d, 0xe8, 0xa4, 0xe3};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20521}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26988}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3468}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24720}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc4, 0xb,  0xca, 0xa8, 0x22, 0x73, 0x11, 0x2b, 0xde,
                                0x80, 0x31, 0x8a, 0x59, 0xd0, 0x42, 0x70, 0xb2};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11823;
  uint8_t client_id_bytes[] = {0xd,  0xad, 0x43, 0x35, 0x24, 0x2b, 0x7e, 0x44, 0x6,  0xa9, 0x44,
                               0xdc, 0xa0, 0xda, 0x83, 0x21, 0x42, 0x6f, 0xe,  0x9f, 0x48, 0x4e};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb2};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "M\162\184\&2\161L\154u\186\163\SYN\212\180\192S\137\a\169\&5\208Z\"\a\143{\DC1\246", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS0, _willTopic =
// "p\188\191\217S;m\n\EM\155\NAK\247\182\145\183\SYN\184\152\SUB\153\214-D\b\CAN\128", _willMsg = "\197p\131",
// _willProps = [PropAuthenticationData "BQ\128\208:t}\221E_\254m\210\231\202|qv",PropRequestResponseInformation
// 138,PropAuthenticationMethod
// "\208\240i\131\201msq\"A\NAK\157\EOT\250K\128\&9G\SUB\138i\"\247=\225*t;\191r",PropMessageExpiryInterval
// 26874,PropSubscriptionIdentifierAvailable 65,PropRetainAvailable 163,PropRetainAvailable 42,PropResponseInformation
// "\158\245'",PropWillDelayInterval 25424,PropResponseInformation
// "O\194\210\214\146_\"\198\186\160\ACK\254&\241\150\153\202\212\177`\183P\177\205\&2lW\148;\206",PropSubscriptionIdentifierAvailable
// 209,PropSubscriptionIdentifierAvailable 230,PropAuthenticationMethod
// "(\EOT\161RAV\133\DEL\188\197xc\177j\172R\146\130\220\238",PropTopicAliasMaximum 3668,PropResponseInformation
// "\230\247\249\170\237\ETB\145Y",PropReasonString
// "\173\166\137*,(\240)\226j6\245\146\211\149H\240\136{M\224\185\234",PropUserProperty
// "f\US\212\US\DC23\128a(\n\239\135\173\&2G\197P8" "\FS\212$U?\185V\n",PropMaximumQoS 190,PropServerReference
// "G\DC1\242\144~\188'f\STX&\175\SYN\187\&9J\131|P`\187j\239\163-;\GS\DLE\ETX",PropContentType "",PropRetainAvailable
// 40,PropMaximumQoS 215,PropSessionExpiryInterval 16670,PropAuthenticationMethod
// ">\DLE\193\229c}f;5\140\178\224\DEL`",PropSessionExpiryInterval 15432,PropServerKeepAlive 4678]}), _cleanSession =
// True, _keepAlive = 15472, _connID = "A\231\208\198C*2\172\&2\183\133\223\152\224(\129o\n\180MO\235Z\186\166\f",
// _properties = [PropReasonString
// "d\152+\222\212\199J\202o\181d\255\186\170qx\146y\\(\157\225G",PropMessageExpiryInterval 15061,PropRetainAvailable
// 245,PropMaximumPacketSize 383,PropSharedSubscriptionAvailable 221,PropSubscriptionIdentifierAvailable
// 102,PropTopicAlias 26828,PropRequestProblemInformation 207,PropSharedSubscriptionAvailable
// 151,PropSubscriptionIdentifier 1,PropTopicAliasMaximum 17,PropAuthenticationMethod
// "\ETXU#\142\201",PropAuthenticationData "\170\RSi\150\231\235O\a\SOr9",PropTopicAliasMaximum 3435,PropResponseTopic
// "B\152\165\&8\158\138\US\234\251'\214m\191\239\215\148)\195\245\b\240",PropTopicAlias 8929,PropTopicAliasMaximum
// 23322,PropResponseInformation "\187\178",PropWildcardSubscriptionAvailable 190,PropResponseInformation
// "\FSZb\238",PropReasonString "\160'\137\243\183|\137P\240\253\156\167|\168\158",PropUserProperty
// "\235\193G\GS\148\225vN\215~\233wk\130\131v&\251\243R5_\ncwOlK\212"
// "u\CAN\228\143\135\159\v\214\241\US\220\&1\248]\136",PropAuthenticationData "\DC2k%\nM\SOHc\RS\218\167\227"]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x66, 0x3c, 0x70, 0xcc, 0x1,  0x1f, 0x0,  0x17, 0x64,
      0x98, 0x2b, 0xde, 0xd4, 0xc7, 0x4a, 0xca, 0x6f, 0xb5, 0x64, 0xff, 0xba, 0xaa, 0x71, 0x78, 0x92, 0x79, 0x5c, 0x28,
      0x9d, 0xe1, 0x47, 0x2,  0x0,  0x0,  0x3a, 0xd5, 0x25, 0xf5, 0x27, 0x0,  0x0,  0x1,  0x7f, 0x2a, 0xdd, 0x29, 0x66,
      0x23, 0x68, 0xcc, 0x17, 0xcf, 0x2a, 0x97, 0xb,  0x1,  0x22, 0x0,  0x11, 0x15, 0x0,  0x5,  0x3,  0x55, 0x23, 0x8e,
      0xc9, 0x16, 0x0,  0xb,  0xaa, 0x1e, 0x69, 0x96, 0xe7, 0xeb, 0x4f, 0x7,  0xe,  0x72, 0x39, 0x22, 0xd,  0x6b, 0x8,
      0x0,  0x15, 0x42, 0x98, 0xa5, 0x38, 0x9e, 0x8a, 0x1f, 0xea, 0xfb, 0x27, 0xd6, 0x6d, 0xbf, 0xef, 0xd7, 0x94, 0x29,
      0xc3, 0xf5, 0x8,  0xf0, 0x23, 0x22, 0xe1, 0x22, 0x5b, 0x1a, 0x1a, 0x0,  0x2,  0xbb, 0xb2, 0x28, 0xbe, 0x1a, 0x0,
      0x4,  0x1c, 0x5a, 0x62, 0xee, 0x1f, 0x0,  0xf,  0xa0, 0x27, 0x89, 0xf3, 0xb7, 0x7c, 0x89, 0x50, 0xf0, 0xfd, 0x9c,
      0xa7, 0x7c, 0xa8, 0x9e, 0x26, 0x0,  0x1d, 0xeb, 0xc1, 0x47, 0x1d, 0x94, 0xe1, 0x76, 0x4e, 0xd7, 0x7e, 0xe9, 0x77,
      0x6b, 0x82, 0x83, 0x76, 0x26, 0xfb, 0xf3, 0x52, 0x35, 0x5f, 0xa,  0x63, 0x77, 0x4f, 0x6c, 0x4b, 0xd4, 0x0,  0xf,
      0x75, 0x18, 0xe4, 0x8f, 0x87, 0x9f, 0xb,  0xd6, 0xf1, 0x1f, 0xdc, 0x31, 0xf8, 0x5d, 0x88, 0x16, 0x0,  0xb,  0x12,
      0x6b, 0x25, 0xa,  0x4d, 0x1,  0x63, 0x1e, 0xda, 0xa7, 0xe3, 0x0,  0x1a, 0x41, 0xe7, 0xd0, 0xc6, 0x43, 0x2a, 0x32,
      0xac, 0x32, 0xb7, 0x85, 0xdf, 0x98, 0xe0, 0x28, 0x81, 0x6f, 0xa,  0xb4, 0x4d, 0x4f, 0xeb, 0x5a, 0xba, 0xa6, 0xc,
      0x97, 0x2,  0x16, 0x0,  0x12, 0x42, 0x51, 0x80, 0xd0, 0x3a, 0x74, 0x7d, 0xdd, 0x45, 0x5f, 0xfe, 0x6d, 0xd2, 0xe7,
      0xca, 0x7c, 0x71, 0x76, 0x19, 0x8a, 0x15, 0x0,  0x1e, 0xd0, 0xf0, 0x69, 0x83, 0xc9, 0x6d, 0x73, 0x71, 0x22, 0x41,
      0x15, 0x9d, 0x4,  0xfa, 0x4b, 0x80, 0x39, 0x47, 0x1a, 0x8a, 0x69, 0x22, 0xf7, 0x3d, 0xe1, 0x2a, 0x74, 0x3b, 0xbf,
      0x72, 0x2,  0x0,  0x0,  0x68, 0xfa, 0x29, 0x41, 0x25, 0xa3, 0x25, 0x2a, 0x1a, 0x0,  0x3,  0x9e, 0xf5, 0x27, 0x18,
      0x0,  0x0,  0x63, 0x50, 0x1a, 0x0,  0x1e, 0x4f, 0xc2, 0xd2, 0xd6, 0x92, 0x5f, 0x22, 0xc6, 0xba, 0xa0, 0x6,  0xfe,
      0x26, 0xf1, 0x96, 0x99, 0xca, 0xd4, 0xb1, 0x60, 0xb7, 0x50, 0xb1, 0xcd, 0x32, 0x6c, 0x57, 0x94, 0x3b, 0xce, 0x29,
      0xd1, 0x29, 0xe6, 0x15, 0x0,  0x14, 0x28, 0x4,  0xa1, 0x52, 0x41, 0x56, 0x85, 0x7f, 0xbc, 0xc5, 0x78, 0x63, 0xb1,
      0x6a, 0xac, 0x52, 0x92, 0x82, 0xdc, 0xee, 0x22, 0xe,  0x54, 0x1a, 0x0,  0x8,  0xe6, 0xf7, 0xf9, 0xaa, 0xed, 0x17,
      0x91, 0x59, 0x1f, 0x0,  0x17, 0xad, 0xa6, 0x89, 0x2a, 0x2c, 0x28, 0xf0, 0x29, 0xe2, 0x6a, 0x36, 0xf5, 0x92, 0xd3,
      0x95, 0x48, 0xf0, 0x88, 0x7b, 0x4d, 0xe0, 0xb9, 0xea, 0x26, 0x0,  0x12, 0x66, 0x1f, 0xd4, 0x1f, 0x12, 0x33, 0x80,
      0x61, 0x28, 0xa,  0xef, 0x87, 0xad, 0x32, 0x47, 0xc5, 0x50, 0x38, 0x0,  0x8,  0x1c, 0xd4, 0x24, 0x55, 0x3f, 0xb9,
      0x56, 0xa,  0x24, 0xbe, 0x1c, 0x0,  0x1c, 0x47, 0x11, 0xf2, 0x90, 0x7e, 0xbc, 0x27, 0x66, 0x2,  0x26, 0xaf, 0x16,
      0xbb, 0x39, 0x4a, 0x83, 0x7c, 0x50, 0x60, 0xbb, 0x6a, 0xef, 0xa3, 0x2d, 0x3b, 0x1d, 0x10, 0x3,  0x3,  0x0,  0x0,
      0x25, 0x28, 0x24, 0xd7, 0x11, 0x0,  0x0,  0x41, 0x1e, 0x15, 0x0,  0xe,  0x3e, 0x10, 0xc1, 0xe5, 0x63, 0x7d, 0x66,
      0x3b, 0x35, 0x8c, 0xb2, 0xe0, 0x7f, 0x60, 0x11, 0x0,  0x0,  0x3c, 0x48, 0x13, 0x12, 0x46, 0x0,  0x1a, 0x70, 0xbc,
      0xbf, 0xd9, 0x53, 0x3b, 0x6d, 0xa,  0x19, 0x9b, 0x15, 0xf7, 0xb6, 0x91, 0xb7, 0x16, 0xb8, 0x98, 0x1a, 0x99, 0xd6,
      0x2d, 0x44, 0x8,  0x18, 0x80, 0x0,  0x3,  0xc5, 0x70, 0x83, 0x0,  0x1b, 0x4d, 0xa2, 0xb8, 0x32, 0xa1, 0x4c, 0x9a,
      0x75, 0xba, 0xa3, 0x16, 0xd4, 0xb4, 0xc0, 0x53, 0x89, 0x7,  0xa9, 0x35, 0xd0, 0x5a, 0x22, 0x7,  0x8f, 0x7b, 0x11,
      0xf6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x64, 0x98, 0x2b, 0xde, 0xd4, 0xc7, 0x4a, 0xca, 0x6f, 0xb5, 0x64, 0xff,
                           0xba, 0xaa, 0x71, 0x78, 0x92, 0x79, 0x5c, 0x28, 0x9d, 0xe1, 0x47};
  uint8_t bytesprops1[] = {0x3, 0x55, 0x23, 0x8e, 0xc9};
  uint8_t bytesprops2[] = {0xaa, 0x1e, 0x69, 0x96, 0xe7, 0xeb, 0x4f, 0x7, 0xe, 0x72, 0x39};
  uint8_t bytesprops3[] = {0x42, 0x98, 0xa5, 0x38, 0x9e, 0x8a, 0x1f, 0xea, 0xfb, 0x27, 0xd6,
                           0x6d, 0xbf, 0xef, 0xd7, 0x94, 0x29, 0xc3, 0xf5, 0x8,  0xf0};
  uint8_t bytesprops4[] = {0xbb, 0xb2};
  uint8_t bytesprops5[] = {0x1c, 0x5a, 0x62, 0xee};
  uint8_t bytesprops6[] = {0xa0, 0x27, 0x89, 0xf3, 0xb7, 0x7c, 0x89, 0x50, 0xf0, 0xfd, 0x9c, 0xa7, 0x7c, 0xa8, 0x9e};
  uint8_t bytesprops8[] = {0x75, 0x18, 0xe4, 0x8f, 0x87, 0x9f, 0xb, 0xd6, 0xf1, 0x1f, 0xdc, 0x31, 0xf8, 0x5d, 0x88};
  uint8_t bytesprops7[] = {0xeb, 0xc1, 0x47, 0x1d, 0x94, 0xe1, 0x76, 0x4e, 0xd7, 0x7e, 0xe9, 0x77, 0x6b, 0x82, 0x83,
                           0x76, 0x26, 0xfb, 0xf3, 0x52, 0x35, 0x5f, 0xa,  0x63, 0x77, 0x4f, 0x6c, 0x4b, 0xd4};
  uint8_t bytesprops9[] = {0x12, 0x6b, 0x25, 0xa, 0x4d, 0x1, 0x63, 0x1e, 0xda, 0xa7, 0xe3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15061}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 383}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26828}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3435}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8929}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23322}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops7}, .v = {15, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x42, 0x51, 0x80, 0xd0, 0x3a, 0x74, 0x7d, 0xdd, 0x45,
                               0x5f, 0xfe, 0x6d, 0xd2, 0xe7, 0xca, 0x7c, 0x71, 0x76};
  uint8_t byteswillprops1[] = {0xd0, 0xf0, 0x69, 0x83, 0xc9, 0x6d, 0x73, 0x71, 0x22, 0x41,
                               0x15, 0x9d, 0x4,  0xfa, 0x4b, 0x80, 0x39, 0x47, 0x1a, 0x8a,
                               0x69, 0x22, 0xf7, 0x3d, 0xe1, 0x2a, 0x74, 0x3b, 0xbf, 0x72};
  uint8_t byteswillprops2[] = {0x9e, 0xf5, 0x27};
  uint8_t byteswillprops3[] = {0x4f, 0xc2, 0xd2, 0xd6, 0x92, 0x5f, 0x22, 0xc6, 0xba, 0xa0,
                               0x6,  0xfe, 0x26, 0xf1, 0x96, 0x99, 0xca, 0xd4, 0xb1, 0x60,
                               0xb7, 0x50, 0xb1, 0xcd, 0x32, 0x6c, 0x57, 0x94, 0x3b, 0xce};
  uint8_t byteswillprops4[] = {0x28, 0x4,  0xa1, 0x52, 0x41, 0x56, 0x85, 0x7f, 0xbc, 0xc5,
                               0x78, 0x63, 0xb1, 0x6a, 0xac, 0x52, 0x92, 0x82, 0xdc, 0xee};
  uint8_t byteswillprops5[] = {0xe6, 0xf7, 0xf9, 0xaa, 0xed, 0x17, 0x91, 0x59};
  uint8_t byteswillprops6[] = {0xad, 0xa6, 0x89, 0x2a, 0x2c, 0x28, 0xf0, 0x29, 0xe2, 0x6a, 0x36, 0xf5,
                               0x92, 0xd3, 0x95, 0x48, 0xf0, 0x88, 0x7b, 0x4d, 0xe0, 0xb9, 0xea};
  uint8_t byteswillprops8[] = {0x1c, 0xd4, 0x24, 0x55, 0x3f, 0xb9, 0x56, 0xa};
  uint8_t byteswillprops7[] = {0x66, 0x1f, 0xd4, 0x1f, 0x12, 0x33, 0x80, 0x61, 0x28,
                               0xa,  0xef, 0x87, 0xad, 0x32, 0x47, 0xc5, 0x50, 0x38};
  uint8_t byteswillprops9[] = {0x47, 0x11, 0xf2, 0x90, 0x7e, 0xbc, 0x27, 0x66, 0x2,  0x26, 0xaf, 0x16, 0xbb, 0x39,
                               0x4a, 0x83, 0x7c, 0x50, 0x60, 0xbb, 0x6a, 0xef, 0xa3, 0x2d, 0x3b, 0x1d, 0x10, 0x3};
  uint8_t byteswillprops10[] = {0};
  uint8_t byteswillprops11[] = {0x3e, 0x10, 0xc1, 0xe5, 0x63, 0x7d, 0x66, 0x3b, 0x35, 0x8c, 0xb2, 0xe0, 0x7f, 0x60};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26874}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25424}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3668}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&byteswillprops7}, .v = {8, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16670}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15432}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4678}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x70, 0xbc, 0xbf, 0xd9, 0x53, 0x3b, 0x6d, 0xa,  0x19, 0x9b, 0x15, 0xf7, 0xb6,
                                0x91, 0xb7, 0x16, 0xb8, 0x98, 0x1a, 0x99, 0xd6, 0x2d, 0x44, 0x8,  0x18, 0x80};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc5, 0x70, 0x83};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 15472;
  uint8_t client_id_bytes[] = {0x41, 0xe7, 0xd0, 0xc6, 0x43, 0x2a, 0x32, 0xac, 0x32, 0xb7, 0x85, 0xdf, 0x98,
                               0xe0, 0x28, 0x81, 0x6f, 0xa,  0xb4, 0x4d, 0x4f, 0xeb, 0x5a, 0xba, 0xa6, 0xc};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4d, 0xa2, 0xb8, 0x32, 0xa1, 0x4c, 0x9a, 0x75, 0xba, 0xa3, 0x16, 0xd4, 0xb4, 0xc0,
                              0x53, 0x89, 0x7,  0xa9, 0x35, 0xd0, 0x5a, 0x22, 0x7,  0x8f, 0x7b, 0x11, 0xf6};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ni\175J\146\197o\130\201\&8@\212x\172\ENQ\SOH!\164dU\\M\248\216\189", _password =
// Just "\EOT\128\CAN\203[\240\SYN\b", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "\135\ESC\DLE|c.\180\189\232p\195\155\171=\246", _willMsg =
// "\137\150\171\227\191\DC2[m\203I\160\176\SO\193A\238\210F\180@$4\176\&8N\172\&5\234KO", _willProps =
// [PropSessionExpiryInterval 7133,PropUserProperty "\133Y?Y\179\206j\f\146\216L"
// "\243I\230",PropSubscriptionIdentifierAvailable 154,PropWildcardSubscriptionAvailable 226,PropAuthenticationMethod
// "\175\DC1\135\187\187\SOH\GS\FS\FSu'nj\129\240\&2&\233B\n\189\157",PropUserProperty
// "\EM\190{\130\213\171\144Ioy8\228\SIC\237\190;~\156{a\234" "\205*\174g\DC3",PropSubscriptionIdentifierAvailable
// 67,PropCorrelationData "E\243\234)n\145F\214\248F\214\182\190\ESC\GS\140{A",PropSubscriptionIdentifierAvailable
// 137,PropResponseInformation "f\DC1\227OJ\232k@r\178\STX\136\146M:)",PropMessageExpiryInterval
// 6568,PropPayloadFormatIndicator 105,PropResponseTopic "f",PropWillDelayInterval 30594,PropContentType
// "\245",PropRequestProblemInformation 216,PropAssignedClientIdentifier
// "\190\&9\vW~\162<\201\185\245j",PropResponseTopic
// "\189\186\246\132\145\NAKB\199\135r\148.\ACKs@[C(",PropMessageExpiryInterval 14746,PropMessageExpiryInterval
// 353,PropRetainAvailable 177,PropMaximumQoS 254,PropSessionExpiryInterval 5276,PropUserProperty
// "a\CAN^\200*\186\ETBb\211\239]%:\231\242" "",PropReasonString ";\191",PropContentType
// "72[9\149\CANs\178\&1\183\162\&0\238\151\ENQ\205cO\FS\235",PropAuthenticationMethod
// "C\223a\251\215\219UQ\138\&8\189",PropRequestResponseInformation 200]}), _cleanSession = True, _keepAlive = 17924,
// _connID = "a\NUL\161\b\145\247$\148\&9^N\209\CAN\SOHT\150\176%'\199\214\&5\131\202\185\208\145E1N", _properties =
// [PropRequestResponseInformation 82,PropAssignedClientIdentifier "i\141\231",PropAssignedClientIdentifier
// "@,L<\DC3\175\211q\162\&6?\tE",PropRetainAvailable 41,PropMaximumQoS 198,PropSubscriptionIdentifier
// 23,PropAssignedClientIdentifier
// "G\150\136\239$;\t\DC2\142\242k\NUL\FS[\239\STX\ESC\255KT\203\236\186&B",PropUserProperty "\241\244M\136.\242\167"
// "\188\143\"`\225K\207E\231\180\SUB9$M\147\193\142\174\230\231\t\SYNRS*\FS\235g,",PropServerReference
// "\t\192&\235\169\218\237\146\239u\201"]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {
      0x10, 0x81, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x46, 0x4,  0x71, 0x19, 0x52, 0x12, 0x0,  0x3,
      0x69, 0x8d, 0xe7, 0x12, 0x0,  0xd,  0x40, 0x2c, 0x4c, 0x3c, 0x13, 0xaf, 0xd3, 0x71, 0xa2, 0x36, 0x3f, 0x9,  0x45,
      0x25, 0x29, 0x24, 0xc6, 0xb,  0x17, 0x12, 0x0,  0x19, 0x47, 0x96, 0x88, 0xef, 0x24, 0x3b, 0x9,  0x12, 0x8e, 0xf2,
      0x6b, 0x0,  0x1c, 0x5b, 0xef, 0x2,  0x1b, 0xff, 0x4b, 0x54, 0xcb, 0xec, 0xba, 0x26, 0x42, 0x26, 0x0,  0x7,  0xf1,
      0xf4, 0x4d, 0x88, 0x2e, 0xf2, 0xa7, 0x0,  0x1d, 0xbc, 0x8f, 0x22, 0x60, 0xe1, 0x4b, 0xcf, 0x45, 0xe7, 0xb4, 0x1a,
      0x39, 0x24, 0x4d, 0x93, 0xc1, 0x8e, 0xae, 0xe6, 0xe7, 0x9,  0x16, 0x52, 0x53, 0x2a, 0x1c, 0xeb, 0x67, 0x2c, 0x1c,
      0x0,  0xb,  0x9,  0xc0, 0x26, 0xeb, 0xa9, 0xda, 0xed, 0x92, 0xef, 0x75, 0xc9, 0x0,  0x1e, 0x61, 0x0,  0xa1, 0x8,
      0x91, 0xf7, 0x24, 0x94, 0x39, 0x5e, 0x4e, 0xd1, 0x18, 0x1,  0x54, 0x96, 0xb0, 0x25, 0x27, 0xc7, 0xd6, 0x35, 0x83,
      0xca, 0xb9, 0xd0, 0x91, 0x45, 0x31, 0x4e, 0x8d, 0x2,  0x11, 0x0,  0x0,  0x1b, 0xdd, 0x26, 0x0,  0xb,  0x85, 0x59,
      0x3f, 0x59, 0xb3, 0xce, 0x6a, 0xc,  0x92, 0xd8, 0x4c, 0x0,  0x3,  0xf3, 0x49, 0xe6, 0x29, 0x9a, 0x28, 0xe2, 0x15,
      0x0,  0x16, 0xaf, 0x11, 0x87, 0xbb, 0xbb, 0x1,  0x1d, 0x1c, 0x1c, 0x75, 0x27, 0x6e, 0x6a, 0x81, 0xf0, 0x32, 0x26,
      0xe9, 0x42, 0xa,  0xbd, 0x9d, 0x26, 0x0,  0x16, 0x19, 0xbe, 0x7b, 0x82, 0xd5, 0xab, 0x90, 0x49, 0x6f, 0x79, 0x38,
      0xe4, 0xf,  0x43, 0xed, 0xbe, 0x3b, 0x7e, 0x9c, 0x7b, 0x61, 0xea, 0x0,  0x5,  0xcd, 0x2a, 0xae, 0x67, 0x13, 0x29,
      0x43, 0x9,  0x0,  0x12, 0x45, 0xf3, 0xea, 0x29, 0x6e, 0x91, 0x46, 0xd6, 0xf8, 0x46, 0xd6, 0xb6, 0xbe, 0x1b, 0x1d,
      0x8c, 0x7b, 0x41, 0x29, 0x89, 0x1a, 0x0,  0x10, 0x66, 0x11, 0xe3, 0x4f, 0x4a, 0xe8, 0x6b, 0x40, 0x72, 0xb2, 0x2,
      0x88, 0x92, 0x4d, 0x3a, 0x29, 0x2,  0x0,  0x0,  0x19, 0xa8, 0x1,  0x69, 0x8,  0x0,  0x1,  0x66, 0x18, 0x0,  0x0,
      0x77, 0x82, 0x3,  0x0,  0x1,  0xf5, 0x17, 0xd8, 0x12, 0x0,  0xb,  0xbe, 0x39, 0xb,  0x57, 0x7e, 0xa2, 0x3c, 0xc9,
      0xb9, 0xf5, 0x6a, 0x8,  0x0,  0x12, 0xbd, 0xba, 0xf6, 0x84, 0x91, 0x15, 0x42, 0xc7, 0x87, 0x72, 0x94, 0x2e, 0x6,
      0x73, 0x40, 0x5b, 0x43, 0x28, 0x2,  0x0,  0x0,  0x39, 0x9a, 0x2,  0x0,  0x0,  0x1,  0x61, 0x25, 0xb1, 0x24, 0xfe,
      0x11, 0x0,  0x0,  0x14, 0x9c, 0x26, 0x0,  0xf,  0x61, 0x18, 0x5e, 0xc8, 0x2a, 0xba, 0x17, 0x62, 0xd3, 0xef, 0x5d,
      0x25, 0x3a, 0xe7, 0xf2, 0x0,  0x0,  0x1f, 0x0,  0x2,  0x3b, 0xbf, 0x3,  0x0,  0x14, 0x37, 0x32, 0x5b, 0x39, 0x95,
      0x18, 0x73, 0xb2, 0x31, 0xb7, 0xa2, 0x30, 0xee, 0x97, 0x5,  0xcd, 0x63, 0x4f, 0x1c, 0xeb, 0x15, 0x0,  0xb,  0x43,
      0xdf, 0x61, 0xfb, 0xd7, 0xdb, 0x55, 0x51, 0x8a, 0x38, 0xbd, 0x19, 0xc8, 0x0,  0xf,  0x87, 0x1b, 0x10, 0x7c, 0x63,
      0x2e, 0xb4, 0xbd, 0xe8, 0x70, 0xc3, 0x9b, 0xab, 0x3d, 0xf6, 0x0,  0x1e, 0x89, 0x96, 0xab, 0xe3, 0xbf, 0x12, 0x5b,
      0x6d, 0xcb, 0x49, 0xa0, 0xb0, 0xe,  0xc1, 0x41, 0xee, 0xd2, 0x46, 0xb4, 0x40, 0x24, 0x34, 0xb0, 0x38, 0x4e, 0xac,
      0x35, 0xea, 0x4b, 0x4f, 0x0,  0x19, 0xa,  0x69, 0xaf, 0x4a, 0x92, 0xc5, 0x6f, 0x82, 0xc9, 0x38, 0x40, 0xd4, 0x78,
      0xac, 0x5,  0x1,  0x21, 0xa4, 0x64, 0x55, 0x5c, 0x4d, 0xf8, 0xd8, 0xbd, 0x0,  0x8,  0x4,  0x80, 0x18, 0xcb, 0x5b,
      0xf0, 0x16, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x69, 0x8d, 0xe7};
  uint8_t bytesprops1[] = {0x40, 0x2c, 0x4c, 0x3c, 0x13, 0xaf, 0xd3, 0x71, 0xa2, 0x36, 0x3f, 0x9, 0x45};
  uint8_t bytesprops2[] = {0x47, 0x96, 0x88, 0xef, 0x24, 0x3b, 0x9,  0x12, 0x8e, 0xf2, 0x6b, 0x0, 0x1c,
                           0x5b, 0xef, 0x2,  0x1b, 0xff, 0x4b, 0x54, 0xcb, 0xec, 0xba, 0x26, 0x42};
  uint8_t bytesprops4[] = {0xbc, 0x8f, 0x22, 0x60, 0xe1, 0x4b, 0xcf, 0x45, 0xe7, 0xb4, 0x1a, 0x39, 0x24, 0x4d, 0x93,
                           0xc1, 0x8e, 0xae, 0xe6, 0xe7, 0x9,  0x16, 0x52, 0x53, 0x2a, 0x1c, 0xeb, 0x67, 0x2c};
  uint8_t bytesprops3[] = {0xf1, 0xf4, 0x4d, 0x88, 0x2e, 0xf2, 0xa7};
  uint8_t bytesprops5[] = {0x9, 0xc0, 0x26, 0xeb, 0xa9, 0xda, 0xed, 0x92, 0xef, 0x75, 0xc9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops3}, .v = {29, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xf3, 0x49, 0xe6};
  uint8_t byteswillprops0[] = {0x85, 0x59, 0x3f, 0x59, 0xb3, 0xce, 0x6a, 0xc, 0x92, 0xd8, 0x4c};
  uint8_t byteswillprops2[] = {0xaf, 0x11, 0x87, 0xbb, 0xbb, 0x1,  0x1d, 0x1c, 0x1c, 0x75, 0x27,
                               0x6e, 0x6a, 0x81, 0xf0, 0x32, 0x26, 0xe9, 0x42, 0xa,  0xbd, 0x9d};
  uint8_t byteswillprops4[] = {0xcd, 0x2a, 0xae, 0x67, 0x13};
  uint8_t byteswillprops3[] = {0x19, 0xbe, 0x7b, 0x82, 0xd5, 0xab, 0x90, 0x49, 0x6f, 0x79, 0x38,
                               0xe4, 0xf,  0x43, 0xed, 0xbe, 0x3b, 0x7e, 0x9c, 0x7b, 0x61, 0xea};
  uint8_t byteswillprops5[] = {0x45, 0xf3, 0xea, 0x29, 0x6e, 0x91, 0x46, 0xd6, 0xf8,
                               0x46, 0xd6, 0xb6, 0xbe, 0x1b, 0x1d, 0x8c, 0x7b, 0x41};
  uint8_t byteswillprops6[] = {0x66, 0x11, 0xe3, 0x4f, 0x4a, 0xe8, 0x6b, 0x40,
                               0x72, 0xb2, 0x2,  0x88, 0x92, 0x4d, 0x3a, 0x29};
  uint8_t byteswillprops7[] = {0x66};
  uint8_t byteswillprops8[] = {0xf5};
  uint8_t byteswillprops9[] = {0xbe, 0x39, 0xb, 0x57, 0x7e, 0xa2, 0x3c, 0xc9, 0xb9, 0xf5, 0x6a};
  uint8_t byteswillprops10[] = {0xbd, 0xba, 0xf6, 0x84, 0x91, 0x15, 0x42, 0xc7, 0x87,
                                0x72, 0x94, 0x2e, 0x6,  0x73, 0x40, 0x5b, 0x43, 0x28};
  uint8_t byteswillprops12[] = {0};
  uint8_t byteswillprops11[] = {0x61, 0x18, 0x5e, 0xc8, 0x2a, 0xba, 0x17, 0x62,
                                0xd3, 0xef, 0x5d, 0x25, 0x3a, 0xe7, 0xf2};
  uint8_t byteswillprops13[] = {0x3b, 0xbf};
  uint8_t byteswillprops14[] = {0x37, 0x32, 0x5b, 0x39, 0x95, 0x18, 0x73, 0xb2, 0x31, 0xb7,
                                0xa2, 0x30, 0xee, 0x97, 0x5,  0xcd, 0x63, 0x4f, 0x1c, 0xeb};
  uint8_t byteswillprops15[] = {0x43, 0xdf, 0x61, 0xfb, 0xd7, 0xdb, 0x55, 0x51, 0x8a, 0x38, 0xbd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7133}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {11, (char*)&byteswillprops0}, .v = {3, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {22, (char*)&byteswillprops3}, .v = {5, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6568}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30594}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14746}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 353}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5276}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {15, (char*)&byteswillprops11}, .v = {0, (char*)&byteswillprops12}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops14}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&byteswillprops15}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 200}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x1b, 0x10, 0x7c, 0x63, 0x2e, 0xb4, 0xbd,
                                0xe8, 0x70, 0xc3, 0x9b, 0xab, 0x3d, 0xf6};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x89, 0x96, 0xab, 0xe3, 0xbf, 0x12, 0x5b, 0x6d, 0xcb, 0x49,
                                  0xa0, 0xb0, 0xe,  0xc1, 0x41, 0xee, 0xd2, 0x46, 0xb4, 0x40,
                                  0x24, 0x34, 0xb0, 0x38, 0x4e, 0xac, 0x35, 0xea, 0x4b, 0x4f};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17924;
  uint8_t client_id_bytes[] = {0x61, 0x0,  0xa1, 0x8,  0x91, 0xf7, 0x24, 0x94, 0x39, 0x5e,
                               0x4e, 0xd1, 0x18, 0x1,  0x54, 0x96, 0xb0, 0x25, 0x27, 0xc7,
                               0xd6, 0x35, 0x83, 0xca, 0xb9, 0xd0, 0x91, 0x45, 0x31, 0x4e};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa,  0x69, 0xaf, 0x4a, 0x92, 0xc5, 0x6f, 0x82, 0xc9, 0x38, 0x40, 0xd4, 0x78,
                              0xac, 0x5,  0x1,  0x21, 0xa4, 0x64, 0x55, 0x5c, 0x4d, 0xf8, 0xd8, 0xbd};
  lwmqtt_string_t username = {25, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x4, 0x80, 0x18, 0xcb, 0x5b, 0xf0, 0x16, 0x8};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "x\197,\208\aUF\242|z\244", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS2, _willTopic = "9*J\v\172B:vV\252\US>YCPMxm", _willMsg = ">N", _willProps =
// [PropResponseTopic "Y\229",PropSharedSubscriptionAvailable 70,PropContentType
// "<}\160\148l\ETB\238\154\EOT\232\EM$}\231\218x\137\DC4\169\175\221\204\133\167\SOHS\145\147\240",PropRetainAvailable
// 142,PropServerKeepAlive 14211,PropMaximumPacketSize 12577,PropRequestProblemInformation 214,PropTopicAlias
// 18149,PropSessionExpiryInterval 6991,PropAuthenticationMethod "i\178",PropResponseTopic
// "\195\189\&2\183##\DLEC\198\145v\158\239\138\240\149\221\142_ep\229\192\252\252>\180",PropMaximumQoS
// 69,PropCorrelationData "y\STX\248",PropWillDelayInterval 2012,PropResponseTopic
// "\rB\197X\146\DLE\200\DC1#e\t\ACKz\v\141\229Kj\130\184\DC3",PropSubscriptionIdentifierAvailable 50,PropResponseTopic
// "\210\251wL \"\253\217\215\&5\191",PropWildcardSubscriptionAvailable 80]}), _cleanSession = False, _keepAlive = 8679,
// _connID = "\155\132j\168 \215\255w\SO\227", _properties = []}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0xd3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x74, 0x21, 0xe7, 0x0,  0x0,  0xa,  0x9b,
                   0x84, 0x6a, 0xa8, 0x20, 0xd7, 0xff, 0x77, 0xe,  0xe3, 0x95, 0x1,  0x8,  0x0,  0x2,  0x59, 0xe5, 0x2a,
                   0x46, 0x3,  0x0,  0x1d, 0x3c, 0x7d, 0xa0, 0x94, 0x6c, 0x17, 0xee, 0x9a, 0x4,  0xe8, 0x19, 0x24, 0x7d,
                   0xe7, 0xda, 0x78, 0x89, 0x14, 0xa9, 0xaf, 0xdd, 0xcc, 0x85, 0xa7, 0x1,  0x53, 0x91, 0x93, 0xf0, 0x25,
                   0x8e, 0x13, 0x37, 0x83, 0x27, 0x0,  0x0,  0x31, 0x21, 0x17, 0xd6, 0x23, 0x46, 0xe5, 0x11, 0x0,  0x0,
                   0x1b, 0x4f, 0x15, 0x0,  0x2,  0x69, 0xb2, 0x8,  0x0,  0x1b, 0xc3, 0xbd, 0x32, 0xb7, 0x23, 0x23, 0x10,
                   0x43, 0xc6, 0x91, 0x76, 0x9e, 0xef, 0x8a, 0xf0, 0x95, 0xdd, 0x8e, 0x5f, 0x65, 0x70, 0xe5, 0xc0, 0xfc,
                   0xfc, 0x3e, 0xb4, 0x24, 0x45, 0x9,  0x0,  0x3,  0x79, 0x2,  0xf8, 0x18, 0x0,  0x0,  0x7,  0xdc, 0x8,
                   0x0,  0x15, 0xd,  0x42, 0xc5, 0x58, 0x92, 0x10, 0xc8, 0x11, 0x23, 0x65, 0x9,  0x6,  0x7a, 0xb,  0x8d,
                   0xe5, 0x4b, 0x6a, 0x82, 0xb8, 0x13, 0x29, 0x32, 0x8,  0x0,  0xb,  0xd2, 0xfb, 0x77, 0x4c, 0x20, 0x22,
                   0xfd, 0xd9, 0xd7, 0x35, 0xbf, 0x28, 0x50, 0x0,  0x12, 0x39, 0x2a, 0x4a, 0xb,  0xac, 0x42, 0x3a, 0x76,
                   0x56, 0xfc, 0x1f, 0x3e, 0x59, 0x43, 0x50, 0x4d, 0x78, 0x6d, 0x0,  0x2,  0x3e, 0x4e, 0x0,  0xb,  0x78,
                   0xc5, 0x2c, 0xd0, 0x7,  0x55, 0x46, 0xf2, 0x7c, 0x7a, 0xf4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x59, 0xe5};
  uint8_t byteswillprops1[] = {0x3c, 0x7d, 0xa0, 0x94, 0x6c, 0x17, 0xee, 0x9a, 0x4,  0xe8, 0x19, 0x24, 0x7d, 0xe7, 0xda,
                               0x78, 0x89, 0x14, 0xa9, 0xaf, 0xdd, 0xcc, 0x85, 0xa7, 0x1,  0x53, 0x91, 0x93, 0xf0};
  uint8_t byteswillprops2[] = {0x69, 0xb2};
  uint8_t byteswillprops3[] = {0xc3, 0xbd, 0x32, 0xb7, 0x23, 0x23, 0x10, 0x43, 0xc6, 0x91, 0x76, 0x9e, 0xef, 0x8a,
                               0xf0, 0x95, 0xdd, 0x8e, 0x5f, 0x65, 0x70, 0xe5, 0xc0, 0xfc, 0xfc, 0x3e, 0xb4};
  uint8_t byteswillprops4[] = {0x79, 0x2, 0xf8};
  uint8_t byteswillprops5[] = {0xd, 0x42, 0xc5, 0x58, 0x92, 0x10, 0xc8, 0x11, 0x23, 0x65, 0x9,
                               0x6, 0x7a, 0xb,  0x8d, 0xe5, 0x4b, 0x6a, 0x82, 0xb8, 0x13};
  uint8_t byteswillprops6[] = {0xd2, 0xfb, 0x77, 0x4c, 0x20, 0x22, 0xfd, 0xd9, 0xd7, 0x35, 0xbf};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14211}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12577}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18149}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6991}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2012}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 80}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x39, 0x2a, 0x4a, 0xb,  0xac, 0x42, 0x3a, 0x76, 0x56,
                                0xfc, 0x1f, 0x3e, 0x59, 0x43, 0x50, 0x4d, 0x78, 0x6d};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3e, 0x4e};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 8679;
  uint8_t client_id_bytes[] = {0x9b, 0x84, 0x6a, 0xa8, 0x20, 0xd7, 0xff, 0x77, 0xe, 0xe3};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x78, 0xc5, 0x2c, 0xd0, 0x7, 0x55, 0x46, 0xf2, 0x7c, 0x7a, 0xf4};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "#*\SUB\197/r\203", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "G@v wb\253\GSb\212", _willMsg =
// "\SYN\"mo\233lbY\DC3\160\156\230\206`\226J|\232", _willProps = [PropRetainAvailable 151,PropContentType
// "D\"\200\154\225\209\RS6t\244<H\215\199\220x\237TQ\230\224\SO\174\203m",PropTopicAlias
// 22847,PropPayloadFormatIndicator 194,PropTopicAlias 27627,PropRequestResponseInformation 67,PropCorrelationData
// "%~\142&L\DC1\ETX\159i\245\145\144\131\210\219>\230\STX\137\242\173Cr\DC2\187\244\140",PropAuthenticationData
// ".\171\DC3\196\128\139\146\170b\253\161",PropSharedSubscriptionAvailable 227,PropMessageExpiryInterval
// 4451,PropWildcardSubscriptionAvailable 107,PropSessionExpiryInterval 27000,PropRetainAvailable
// 98,PropPayloadFormatIndicator 23,PropUserProperty "\208y\151M\DC4\138\&6J$\170\DC1\152\208\243\ENQ\194\196\tm\SO789c"
// "\DC34\141\STX\SYNW\247\152r'\149\252Z\140$\t\ENQ[\143",PropResponseInformation
// "\STXq[\174\156\&0",PropResponseInformation "yl!\212\254 fp\180\ETBf\168j",PropResponseTopic
// "\254",PropRequestResponseInformation 67,PropRequestProblemInformation 67,PropPayloadFormatIndicator
// 234,PropCorrelationData "\128\189t\223\b\189\226\198p\131\173\224\225\249x\206\207DJ",PropContentType
// ">\185v\229I",PropReasonString "d\150\"\186\234\ESCxL9\167\144\217\SYN",PropReasonString
// "\254\205\DEL\181T\130$\200\SOH]\132\207",PropMaximumPacketSize 9973,PropAuthenticationMethod
// "\151s\235p\224\&1\t\222`\244JG\fu$\NUL\181\148\247\210\139\&3\157\255\b\239Z"]}), _cleanSession = True, _keepAlive =
// 17750, _connID = "\178Y\174\187MI\NAK\186F\SYN\139\138\235u\SOH\197Q", _properties = [PropPayloadFormatIndicator
// 184,PropRequestResponseInformation 159,PropReasonString "\234\166\&9\DLE\203",PropWildcardSubscriptionAvailable
// 49,PropMessageExpiryInterval 16879,PropWildcardSubscriptionAvailable 116,PropSubscriptionIdentifier
// 15,PropSharedSubscriptionAvailable 140,PropReasonString
// "!R<sab\227>oq\\\148%\240\243\ESC)\205\163\159\182\226\251\246\159",PropResponseTopic
// "\209Q",PropSubscriptionIdentifierAvailable 215,PropContentType "\203\&0\135\186J1i\167",PropResponseInformation
// "\138\aF\170\198\175\209 b\157\212k\223.\186zq\184\137\168\&6\189\EM?",PropSharedSubscriptionAvailable
// 47,PropContentType "\175}\128\GS\DLE}\163\188r]\239\SYN",PropWillDelayInterval 23909,PropMessageExpiryInterval
// 9674,PropServerReference "\203\197\148p\220\199)",PropServerReference "'8",PropMaximumPacketSize
// 16109,PropRequestResponseInformation 38,PropSubscriptionIdentifierAvailable 106,PropAuthenticationData
// "\193g1\210\244\177\149\194z\130\n\173\246\162\ETXv|0\212g6\173\180\202\128[m&",PropAuthenticationMethod
// "x\177\179T\138\255\213\255ge[\STX\179\211\145\201\195^",PropTopicAliasMaximum
// 30987,PropWildcardSubscriptionAvailable 116,PropTopicAliasMaximum 21660,PropSharedSubscriptionAvailable
// 115,PropCorrelationData "\152\159W\164&K\133q\208(\228",PropMessageExpiryInterval 21351]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x10, 0xc9, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x86, 0x45, 0x56, 0xe6, 0x1,  0x1,  0xb8, 0x19, 0x9f,
      0x1f, 0x0,  0x5,  0xea, 0xa6, 0x39, 0x10, 0xcb, 0x28, 0x31, 0x2,  0x0,  0x0,  0x41, 0xef, 0x28, 0x74, 0xb,  0xf,
      0x2a, 0x8c, 0x1f, 0x0,  0x19, 0x21, 0x52, 0x3c, 0x73, 0x61, 0x62, 0xe3, 0x3e, 0x6f, 0x71, 0x5c, 0x94, 0x25, 0xf0,
      0xf3, 0x1b, 0x29, 0xcd, 0xa3, 0x9f, 0xb6, 0xe2, 0xfb, 0xf6, 0x9f, 0x8,  0x0,  0x2,  0xd1, 0x51, 0x29, 0xd7, 0x3,
      0x0,  0x8,  0xcb, 0x30, 0x87, 0xba, 0x4a, 0x31, 0x69, 0xa7, 0x1a, 0x0,  0x18, 0x8a, 0x7,  0x46, 0xaa, 0xc6, 0xaf,
      0xd1, 0x20, 0x62, 0x9d, 0xd4, 0x6b, 0xdf, 0x2e, 0xba, 0x7a, 0x71, 0xb8, 0x89, 0xa8, 0x36, 0xbd, 0x19, 0x3f, 0x2a,
      0x2f, 0x3,  0x0,  0xc,  0xaf, 0x7d, 0x80, 0x1d, 0x10, 0x7d, 0xa3, 0xbc, 0x72, 0x5d, 0xef, 0x16, 0x18, 0x0,  0x0,
      0x5d, 0x65, 0x2,  0x0,  0x0,  0x25, 0xca, 0x1c, 0x0,  0x7,  0xcb, 0xc5, 0x94, 0x70, 0xdc, 0xc7, 0x29, 0x1c, 0x0,
      0x2,  0x27, 0x38, 0x27, 0x0,  0x0,  0x3e, 0xed, 0x19, 0x26, 0x29, 0x6a, 0x16, 0x0,  0x1c, 0xc1, 0x67, 0x31, 0xd2,
      0xf4, 0xb1, 0x95, 0xc2, 0x7a, 0x82, 0xa,  0xad, 0xf6, 0xa2, 0x3,  0x76, 0x7c, 0x30, 0xd4, 0x67, 0x36, 0xad, 0xb4,
      0xca, 0x80, 0x5b, 0x6d, 0x26, 0x15, 0x0,  0x12, 0x78, 0xb1, 0xb3, 0x54, 0x8a, 0xff, 0xd5, 0xff, 0x67, 0x65, 0x5b,
      0x2,  0xb3, 0xd3, 0x91, 0xc9, 0xc3, 0x5e, 0x22, 0x79, 0xb,  0x28, 0x74, 0x22, 0x54, 0x9c, 0x2a, 0x73, 0x9,  0x0,
      0xb,  0x98, 0x9f, 0x57, 0xa4, 0x26, 0x4b, 0x85, 0x71, 0xd0, 0x28, 0xe4, 0x2,  0x0,  0x0,  0x53, 0x67, 0x0,  0x11,
      0xb2, 0x59, 0xae, 0xbb, 0x4d, 0x49, 0x15, 0xba, 0x46, 0x16, 0x8b, 0x8a, 0xeb, 0x75, 0x1,  0xc5, 0x51, 0x99, 0x2,
      0x25, 0x97, 0x3,  0x0,  0x19, 0x44, 0x22, 0xc8, 0x9a, 0xe1, 0xd1, 0x1e, 0x36, 0x74, 0xf4, 0x3c, 0x48, 0xd7, 0xc7,
      0xdc, 0x78, 0xed, 0x54, 0x51, 0xe6, 0xe0, 0xe,  0xae, 0xcb, 0x6d, 0x23, 0x59, 0x3f, 0x1,  0xc2, 0x23, 0x6b, 0xeb,
      0x19, 0x43, 0x9,  0x0,  0x1b, 0x25, 0x7e, 0x8e, 0x26, 0x4c, 0x11, 0x3,  0x9f, 0x69, 0xf5, 0x91, 0x90, 0x83, 0xd2,
      0xdb, 0x3e, 0xe6, 0x2,  0x89, 0xf2, 0xad, 0x43, 0x72, 0x12, 0xbb, 0xf4, 0x8c, 0x16, 0x0,  0xb,  0x2e, 0xab, 0x13,
      0xc4, 0x80, 0x8b, 0x92, 0xaa, 0x62, 0xfd, 0xa1, 0x2a, 0xe3, 0x2,  0x0,  0x0,  0x11, 0x63, 0x28, 0x6b, 0x11, 0x0,
      0x0,  0x69, 0x78, 0x25, 0x62, 0x1,  0x17, 0x26, 0x0,  0x18, 0xd0, 0x79, 0x97, 0x4d, 0x14, 0x8a, 0x36, 0x4a, 0x24,
      0xaa, 0x11, 0x98, 0xd0, 0xf3, 0x5,  0xc2, 0xc4, 0x9,  0x6d, 0xe,  0x37, 0x38, 0x39, 0x63, 0x0,  0x13, 0x13, 0x34,
      0x8d, 0x2,  0x16, 0x57, 0xf7, 0x98, 0x72, 0x27, 0x95, 0xfc, 0x5a, 0x8c, 0x24, 0x9,  0x5,  0x5b, 0x8f, 0x1a, 0x0,
      0x6,  0x2,  0x71, 0x5b, 0xae, 0x9c, 0x30, 0x1a, 0x0,  0xd,  0x79, 0x6c, 0x21, 0xd4, 0xfe, 0x20, 0x66, 0x70, 0xb4,
      0x17, 0x66, 0xa8, 0x6a, 0x8,  0x0,  0x1,  0xfe, 0x19, 0x43, 0x17, 0x43, 0x1,  0xea, 0x9,  0x0,  0x13, 0x80, 0xbd,
      0x74, 0xdf, 0x8,  0xbd, 0xe2, 0xc6, 0x70, 0x83, 0xad, 0xe0, 0xe1, 0xf9, 0x78, 0xce, 0xcf, 0x44, 0x4a, 0x3,  0x0,
      0x5,  0x3e, 0xb9, 0x76, 0xe5, 0x49, 0x1f, 0x0,  0xd,  0x64, 0x96, 0x22, 0xba, 0xea, 0x1b, 0x78, 0x4c, 0x39, 0xa7,
      0x90, 0xd9, 0x16, 0x1f, 0x0,  0xc,  0xfe, 0xcd, 0x7f, 0xb5, 0x54, 0x82, 0x24, 0xc8, 0x1,  0x5d, 0x84, 0xcf, 0x27,
      0x0,  0x0,  0x26, 0xf5, 0x15, 0x0,  0x1b, 0x97, 0x73, 0xeb, 0x70, 0xe0, 0x31, 0x9,  0xde, 0x60, 0xf4, 0x4a, 0x47,
      0xc,  0x75, 0x24, 0x0,  0xb5, 0x94, 0xf7, 0xd2, 0x8b, 0x33, 0x9d, 0xff, 0x8,  0xef, 0x5a, 0x0,  0xa,  0x47, 0x40,
      0x76, 0x20, 0x77, 0x62, 0xfd, 0x1d, 0x62, 0xd4, 0x0,  0x12, 0x16, 0x22, 0x6d, 0x6f, 0xe9, 0x6c, 0x62, 0x59, 0x13,
      0xa0, 0x9c, 0xe6, 0xce, 0x60, 0xe2, 0x4a, 0x7c, 0xe8, 0x0,  0x7,  0x23, 0x2a, 0x1a, 0xc5, 0x2f, 0x72, 0xcb};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xea, 0xa6, 0x39, 0x10, 0xcb};
  uint8_t bytesprops1[] = {0x21, 0x52, 0x3c, 0x73, 0x61, 0x62, 0xe3, 0x3e, 0x6f, 0x71, 0x5c, 0x94, 0x25,
                           0xf0, 0xf3, 0x1b, 0x29, 0xcd, 0xa3, 0x9f, 0xb6, 0xe2, 0xfb, 0xf6, 0x9f};
  uint8_t bytesprops2[] = {0xd1, 0x51};
  uint8_t bytesprops3[] = {0xcb, 0x30, 0x87, 0xba, 0x4a, 0x31, 0x69, 0xa7};
  uint8_t bytesprops4[] = {0x8a, 0x7,  0x46, 0xaa, 0xc6, 0xaf, 0xd1, 0x20, 0x62, 0x9d, 0xd4, 0x6b,
                           0xdf, 0x2e, 0xba, 0x7a, 0x71, 0xb8, 0x89, 0xa8, 0x36, 0xbd, 0x19, 0x3f};
  uint8_t bytesprops5[] = {0xaf, 0x7d, 0x80, 0x1d, 0x10, 0x7d, 0xa3, 0xbc, 0x72, 0x5d, 0xef, 0x16};
  uint8_t bytesprops6[] = {0xcb, 0xc5, 0x94, 0x70, 0xdc, 0xc7, 0x29};
  uint8_t bytesprops7[] = {0x27, 0x38};
  uint8_t bytesprops8[] = {0xc1, 0x67, 0x31, 0xd2, 0xf4, 0xb1, 0x95, 0xc2, 0x7a, 0x82, 0xa,  0xad, 0xf6, 0xa2,
                           0x3,  0x76, 0x7c, 0x30, 0xd4, 0x67, 0x36, 0xad, 0xb4, 0xca, 0x80, 0x5b, 0x6d, 0x26};
  uint8_t bytesprops9[] = {0x78, 0xb1, 0xb3, 0x54, 0x8a, 0xff, 0xd5, 0xff, 0x67,
                           0x65, 0x5b, 0x2,  0xb3, 0xd3, 0x91, 0xc9, 0xc3, 0x5e};
  uint8_t bytesprops10[] = {0x98, 0x9f, 0x57, 0xa4, 0x26, 0x4b, 0x85, 0x71, 0xd0, 0x28, 0xe4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16879}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23909}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9674}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16109}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30987}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21660}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21351}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x44, 0x22, 0xc8, 0x9a, 0xe1, 0xd1, 0x1e, 0x36, 0x74, 0xf4, 0x3c, 0x48, 0xd7,
                               0xc7, 0xdc, 0x78, 0xed, 0x54, 0x51, 0xe6, 0xe0, 0xe,  0xae, 0xcb, 0x6d};
  uint8_t byteswillprops1[] = {0x25, 0x7e, 0x8e, 0x26, 0x4c, 0x11, 0x3,  0x9f, 0x69, 0xf5, 0x91, 0x90, 0x83, 0xd2,
                               0xdb, 0x3e, 0xe6, 0x2,  0x89, 0xf2, 0xad, 0x43, 0x72, 0x12, 0xbb, 0xf4, 0x8c};
  uint8_t byteswillprops2[] = {0x2e, 0xab, 0x13, 0xc4, 0x80, 0x8b, 0x92, 0xaa, 0x62, 0xfd, 0xa1};
  uint8_t byteswillprops4[] = {0x13, 0x34, 0x8d, 0x2,  0x16, 0x57, 0xf7, 0x98, 0x72, 0x27,
                               0x95, 0xfc, 0x5a, 0x8c, 0x24, 0x9,  0x5,  0x5b, 0x8f};
  uint8_t byteswillprops3[] = {0xd0, 0x79, 0x97, 0x4d, 0x14, 0x8a, 0x36, 0x4a, 0x24, 0xaa, 0x11, 0x98,
                               0xd0, 0xf3, 0x5,  0xc2, 0xc4, 0x9,  0x6d, 0xe,  0x37, 0x38, 0x39, 0x63};
  uint8_t byteswillprops5[] = {0x2, 0x71, 0x5b, 0xae, 0x9c, 0x30};
  uint8_t byteswillprops6[] = {0x79, 0x6c, 0x21, 0xd4, 0xfe, 0x20, 0x66, 0x70, 0xb4, 0x17, 0x66, 0xa8, 0x6a};
  uint8_t byteswillprops7[] = {0xfe};
  uint8_t byteswillprops8[] = {0x80, 0xbd, 0x74, 0xdf, 0x8,  0xbd, 0xe2, 0xc6, 0x70, 0x83,
                               0xad, 0xe0, 0xe1, 0xf9, 0x78, 0xce, 0xcf, 0x44, 0x4a};
  uint8_t byteswillprops9[] = {0x3e, 0xb9, 0x76, 0xe5, 0x49};
  uint8_t byteswillprops10[] = {0x64, 0x96, 0x22, 0xba, 0xea, 0x1b, 0x78, 0x4c, 0x39, 0xa7, 0x90, 0xd9, 0x16};
  uint8_t byteswillprops11[] = {0xfe, 0xcd, 0x7f, 0xb5, 0x54, 0x82, 0x24, 0xc8, 0x1, 0x5d, 0x84, 0xcf};
  uint8_t byteswillprops12[] = {0x97, 0x73, 0xeb, 0x70, 0xe0, 0x31, 0x9,  0xde, 0x60, 0xf4, 0x4a, 0x47, 0xc, 0x75,
                                0x24, 0x0,  0xb5, 0x94, 0xf7, 0xd2, 0x8b, 0x33, 0x9d, 0xff, 0x8,  0xef, 0x5a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22847}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27627}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4451}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27000}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {24, (char*)&byteswillprops3}, .v = {19, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9973}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&byteswillprops12}}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x47, 0x40, 0x76, 0x20, 0x77, 0x62, 0xfd, 0x1d, 0x62, 0xd4};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x16, 0x22, 0x6d, 0x6f, 0xe9, 0x6c, 0x62, 0x59, 0x13,
                                  0xa0, 0x9c, 0xe6, 0xce, 0x60, 0xe2, 0x4a, 0x7c, 0xe8};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17750;
  uint8_t client_id_bytes[] = {0xb2, 0x59, 0xae, 0xbb, 0x4d, 0x49, 0x15, 0xba, 0x46,
                               0x16, 0x8b, 0x8a, 0xeb, 0x75, 0x1,  0xc5, 0x51};
  lwmqtt_string_t client_id = {17, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x23, 0x2a, 0x1a, 0xc5, 0x2f, 0x72, 0xcb};
  lwmqtt_string_t username = {7, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ";<\132\244\&6\148W/\234\225\r\SIO\DC1", _password = Just
// "\243\ACK\180?\176\136\191]UDv\US\f\151|\209\150\NUL", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\176\CAN\r\146\ESC\214\243U\141F\EM\253\149\231\131\182\203+\164\212'=\232\161\154L\219$",
// _willMsg = "\185\143G\243\136\166\&2xe\156z:|WI\175\185s([H\182\224\143", _willProps = [PropRequestProblemInformation
// 197,PropRetainAvailable 31,PropSessionExpiryInterval 14762,PropSharedSubscriptionAvailable 26,PropUserProperty
// "Ne\191\ACK\246\241\157\200\212" "\255\CANVG\237!\252\STX\238\DC3]'\SYN/\185\186\220?\222;",PropResponseInformation
// "|w\165|\151\164\225\151\181\194\207h\170k\240\SUB\SOH",PropPayloadFormatIndicator 205,PropUserProperty
// "\226\216\173\128\&9\238\156\168,\173G\236\190" "b(\237\195
// \203\160>\238\174\ESC\167\DC3\217\169N\ESC\136\152L\SYN",PropMessageExpiryInterval 29064,PropMaximumPacketSize
// 25322,PropAssignedClientIdentifier "\207p\243\SOH\163>\148*0\208\224\191gD\174\136d\144\216",PropContentType
// "\ACK,v\177E\145q",PropRequestResponseInformation 19,PropWildcardSubscriptionAvailable 230,PropMaximumPacketSize
// 22647,PropSubscriptionIdentifier 1,PropMessageExpiryInterval 20367,PropRequestProblemInformation
// 27,PropServerKeepAlive 12457,PropRetainAvailable 129,PropTopicAliasMaximum 31953]}), _cleanSession = True, _keepAlive
// = 29887, _connID = "\136\132f\178\182\247\158\133\171t\131\148\168\fR\250d\235\253/\255Y\194\DLE\178", _properties =
// [PropSubscriptionIdentifierAvailable 51,PropServerReference
// "\192%\173\168jy\131\211s\174\228\223[\181\177\208\204+r/\135\245m\228Wew\171\DC1\ENQ",PropWillDelayInterval
// 5471,PropTopicAliasMaximum 27567,PropMessageExpiryInterval 15427,PropAuthenticationMethod "\ACK(\137)\146\128#~\212
// \142\248\180\200u\195\141\DLE{:e9\209p\v\217\147\248\233",PropPayloadFormatIndicator 255,PropReasonString
// "~T\157I\v\198X\206N\184\NUL \EM\RS\230{\RS]a7\193\255\201",PropSharedSubscriptionAvailable 41,PropMaximumPacketSize
// 24039,PropReasonString "B\231^\138\250\225*>D\144`\185\192\128\173\167",PropMessageExpiryInterval
// 27240,PropPayloadFormatIndicator 135,PropUserProperty "(rRr\253 \148\132^\247V\183k\RS\180\240\163\200b\f\202"
// "N\ESC\RSk\201\164\&7\142\129\153\237\205F\223\242]\153~\235\SYNF\205\RS",PropRequestResponseInformation
// 244,PropSessionExpiryInterval 29932,PropSessionExpiryInterval 17734,PropReasonString
// "\197UBu\148oD\173\SIp\136$W\162\181\244e\153\192\131\189\232\129H\NAKU",PropSessionExpiryInterval
// 25285,PropMessageExpiryInterval 26956,PropAuthenticationData "\206\228\201\221\b\174\231$\140 \v\192\163="]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0xb5, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x74, 0xbf, 0x82, 0x2,  0x29, 0x33, 0x1c, 0x0,
      0x1e, 0xc0, 0x25, 0xad, 0xa8, 0x6a, 0x79, 0x83, 0xd3, 0x73, 0xae, 0xe4, 0xdf, 0x5b, 0xb5, 0xb1, 0xd0, 0xcc, 0x2b,
      0x72, 0x2f, 0x87, 0xf5, 0x6d, 0xe4, 0x57, 0x65, 0x77, 0xab, 0x11, 0x5,  0x18, 0x0,  0x0,  0x15, 0x5f, 0x22, 0x6b,
      0xaf, 0x2,  0x0,  0x0,  0x3c, 0x43, 0x15, 0x0,  0x1d, 0x6,  0x28, 0x89, 0x29, 0x92, 0x80, 0x23, 0x7e, 0xd4, 0x20,
      0x8e, 0xf8, 0xb4, 0xc8, 0x75, 0xc3, 0x8d, 0x10, 0x7b, 0x3a, 0x65, 0x39, 0xd1, 0x70, 0xb,  0xd9, 0x93, 0xf8, 0xe9,
      0x1,  0xff, 0x1f, 0x0,  0x17, 0x7e, 0x54, 0x9d, 0x49, 0xb,  0xc6, 0x58, 0xce, 0x4e, 0xb8, 0x0,  0x20, 0x19, 0x1e,
      0xe6, 0x7b, 0x1e, 0x5d, 0x61, 0x37, 0xc1, 0xff, 0xc9, 0x2a, 0x29, 0x27, 0x0,  0x0,  0x5d, 0xe7, 0x1f, 0x0,  0x10,
      0x42, 0xe7, 0x5e, 0x8a, 0xfa, 0xe1, 0x2a, 0x3e, 0x44, 0x90, 0x60, 0xb9, 0xc0, 0x80, 0xad, 0xa7, 0x2,  0x0,  0x0,
      0x6a, 0x68, 0x1,  0x87, 0x26, 0x0,  0x15, 0x28, 0x72, 0x52, 0x72, 0xfd, 0x20, 0x94, 0x84, 0x5e, 0xf7, 0x56, 0xb7,
      0x6b, 0x1e, 0xb4, 0xf0, 0xa3, 0xc8, 0x62, 0xc,  0xca, 0x0,  0x17, 0x4e, 0x1b, 0x1e, 0x6b, 0xc9, 0xa4, 0x37, 0x8e,
      0x81, 0x99, 0xed, 0xcd, 0x46, 0xdf, 0xf2, 0x5d, 0x99, 0x7e, 0xeb, 0x16, 0x46, 0xcd, 0x1e, 0x19, 0xf4, 0x11, 0x0,
      0x0,  0x74, 0xec, 0x11, 0x0,  0x0,  0x45, 0x46, 0x1f, 0x0,  0x1a, 0xc5, 0x55, 0x42, 0x75, 0x94, 0x6f, 0x44, 0xad,
      0xf,  0x70, 0x88, 0x24, 0x57, 0xa2, 0xb5, 0xf4, 0x65, 0x99, 0xc0, 0x83, 0xbd, 0xe8, 0x81, 0x48, 0x15, 0x55, 0x11,
      0x0,  0x0,  0x62, 0xc5, 0x2,  0x0,  0x0,  0x69, 0x4c, 0x16, 0x0,  0xe,  0xce, 0xe4, 0xc9, 0xdd, 0x8,  0xae, 0xe7,
      0x24, 0x8c, 0x20, 0xb,  0xc0, 0xa3, 0x3d, 0x0,  0x19, 0x88, 0x84, 0x66, 0xb2, 0xb6, 0xf7, 0x9e, 0x85, 0xab, 0x74,
      0x83, 0x94, 0xa8, 0xc,  0x52, 0xfa, 0x64, 0xeb, 0xfd, 0x2f, 0xff, 0x59, 0xc2, 0x10, 0xb2, 0xae, 0x1,  0x17, 0xc5,
      0x25, 0x1f, 0x11, 0x0,  0x0,  0x39, 0xaa, 0x2a, 0x1a, 0x26, 0x0,  0x9,  0x4e, 0x65, 0xbf, 0x6,  0xf6, 0xf1, 0x9d,
      0xc8, 0xd4, 0x0,  0x14, 0xff, 0x18, 0x56, 0x47, 0xed, 0x21, 0xfc, 0x2,  0xee, 0x13, 0x5d, 0x27, 0x16, 0x2f, 0xb9,
      0xba, 0xdc, 0x3f, 0xde, 0x3b, 0x1a, 0x0,  0x11, 0x7c, 0x77, 0xa5, 0x7c, 0x97, 0xa4, 0xe1, 0x97, 0xb5, 0xc2, 0xcf,
      0x68, 0xaa, 0x6b, 0xf0, 0x1a, 0x1,  0x1,  0xcd, 0x26, 0x0,  0xd,  0xe2, 0xd8, 0xad, 0x80, 0x39, 0xee, 0x9c, 0xa8,
      0x2c, 0xad, 0x47, 0xec, 0xbe, 0x0,  0x15, 0x62, 0x28, 0xed, 0xc3, 0x20, 0xcb, 0xa0, 0x3e, 0xee, 0xae, 0x1b, 0xa7,
      0x13, 0xd9, 0xa9, 0x4e, 0x1b, 0x88, 0x98, 0x4c, 0x16, 0x2,  0x0,  0x0,  0x71, 0x88, 0x27, 0x0,  0x0,  0x62, 0xea,
      0x12, 0x0,  0x13, 0xcf, 0x70, 0xf3, 0x1,  0xa3, 0x3e, 0x94, 0x2a, 0x30, 0xd0, 0xe0, 0xbf, 0x67, 0x44, 0xae, 0x88,
      0x64, 0x90, 0xd8, 0x3,  0x0,  0x7,  0x6,  0x2c, 0x76, 0xb1, 0x45, 0x91, 0x71, 0x19, 0x13, 0x28, 0xe6, 0x27, 0x0,
      0x0,  0x58, 0x77, 0xb,  0x1,  0x2,  0x0,  0x0,  0x4f, 0x8f, 0x17, 0x1b, 0x13, 0x30, 0xa9, 0x25, 0x81, 0x22, 0x7c,
      0xd1, 0x0,  0x1c, 0xb0, 0x18, 0xd,  0x92, 0x1b, 0xd6, 0xf3, 0x55, 0x8d, 0x46, 0x19, 0xfd, 0x95, 0xe7, 0x83, 0xb6,
      0xcb, 0x2b, 0xa4, 0xd4, 0x27, 0x3d, 0xe8, 0xa1, 0x9a, 0x4c, 0xdb, 0x24, 0x0,  0x18, 0xb9, 0x8f, 0x47, 0xf3, 0x88,
      0xa6, 0x32, 0x78, 0x65, 0x9c, 0x7a, 0x3a, 0x7c, 0x57, 0x49, 0xaf, 0xb9, 0x73, 0x28, 0x5b, 0x48, 0xb6, 0xe0, 0x8f,
      0x0,  0xe,  0x3b, 0x3c, 0x84, 0xf4, 0x36, 0x94, 0x57, 0x2f, 0xea, 0xe1, 0xd,  0xf,  0x4f, 0x11, 0x0,  0x12, 0xf3,
      0x6,  0xb4, 0x3f, 0xb0, 0x88, 0xbf, 0x5d, 0x55, 0x44, 0x76, 0x1f, 0xc,  0x97, 0x7c, 0xd1, 0x96, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc0, 0x25, 0xad, 0xa8, 0x6a, 0x79, 0x83, 0xd3, 0x73, 0xae, 0xe4, 0xdf, 0x5b, 0xb5, 0xb1,
                           0xd0, 0xcc, 0x2b, 0x72, 0x2f, 0x87, 0xf5, 0x6d, 0xe4, 0x57, 0x65, 0x77, 0xab, 0x11, 0x5};
  uint8_t bytesprops1[] = {0x6,  0x28, 0x89, 0x29, 0x92, 0x80, 0x23, 0x7e, 0xd4, 0x20, 0x8e, 0xf8, 0xb4, 0xc8, 0x75,
                           0xc3, 0x8d, 0x10, 0x7b, 0x3a, 0x65, 0x39, 0xd1, 0x70, 0xb,  0xd9, 0x93, 0xf8, 0xe9};
  uint8_t bytesprops2[] = {0x7e, 0x54, 0x9d, 0x49, 0xb,  0xc6, 0x58, 0xce, 0x4e, 0xb8, 0x0, 0x20,
                           0x19, 0x1e, 0xe6, 0x7b, 0x1e, 0x5d, 0x61, 0x37, 0xc1, 0xff, 0xc9};
  uint8_t bytesprops3[] = {0x42, 0xe7, 0x5e, 0x8a, 0xfa, 0xe1, 0x2a, 0x3e,
                           0x44, 0x90, 0x60, 0xb9, 0xc0, 0x80, 0xad, 0xa7};
  uint8_t bytesprops5[] = {0x4e, 0x1b, 0x1e, 0x6b, 0xc9, 0xa4, 0x37, 0x8e, 0x81, 0x99, 0xed, 0xcd,
                           0x46, 0xdf, 0xf2, 0x5d, 0x99, 0x7e, 0xeb, 0x16, 0x46, 0xcd, 0x1e};
  uint8_t bytesprops4[] = {0x28, 0x72, 0x52, 0x72, 0xfd, 0x20, 0x94, 0x84, 0x5e, 0xf7, 0x56,
                           0xb7, 0x6b, 0x1e, 0xb4, 0xf0, 0xa3, 0xc8, 0x62, 0xc,  0xca};
  uint8_t bytesprops6[] = {0xc5, 0x55, 0x42, 0x75, 0x94, 0x6f, 0x44, 0xad, 0xf,  0x70, 0x88, 0x24, 0x57,
                           0xa2, 0xb5, 0xf4, 0x65, 0x99, 0xc0, 0x83, 0xbd, 0xe8, 0x81, 0x48, 0x15, 0x55};
  uint8_t bytesprops7[] = {0xce, 0xe4, 0xc9, 0xdd, 0x8, 0xae, 0xe7, 0x24, 0x8c, 0x20, 0xb, 0xc0, 0xa3, 0x3d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5471}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27567}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15427}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24039}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27240}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops4}, .v = {23, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29932}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17734}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25285}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26956}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xff, 0x18, 0x56, 0x47, 0xed, 0x21, 0xfc, 0x2,  0xee, 0x13,
                               0x5d, 0x27, 0x16, 0x2f, 0xb9, 0xba, 0xdc, 0x3f, 0xde, 0x3b};
  uint8_t byteswillprops0[] = {0x4e, 0x65, 0xbf, 0x6, 0xf6, 0xf1, 0x9d, 0xc8, 0xd4};
  uint8_t byteswillprops2[] = {0x7c, 0x77, 0xa5, 0x7c, 0x97, 0xa4, 0xe1, 0x97, 0xb5,
                               0xc2, 0xcf, 0x68, 0xaa, 0x6b, 0xf0, 0x1a, 0x1};
  uint8_t byteswillprops4[] = {0x62, 0x28, 0xed, 0xc3, 0x20, 0xcb, 0xa0, 0x3e, 0xee, 0xae, 0x1b,
                               0xa7, 0x13, 0xd9, 0xa9, 0x4e, 0x1b, 0x88, 0x98, 0x4c, 0x16};
  uint8_t byteswillprops3[] = {0xe2, 0xd8, 0xad, 0x80, 0x39, 0xee, 0x9c, 0xa8, 0x2c, 0xad, 0x47, 0xec, 0xbe};
  uint8_t byteswillprops5[] = {0xcf, 0x70, 0xf3, 0x1,  0xa3, 0x3e, 0x94, 0x2a, 0x30, 0xd0,
                               0xe0, 0xbf, 0x67, 0x44, 0xae, 0x88, 0x64, 0x90, 0xd8};
  uint8_t byteswillprops6[] = {0x6, 0x2c, 0x76, 0xb1, 0x45, 0x91, 0x71};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14762}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {9, (char*)&byteswillprops0}, .v = {20, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops3}, .v = {21, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29064}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25322}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22647}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20367}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12457}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31953}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb0, 0x18, 0xd,  0x92, 0x1b, 0xd6, 0xf3, 0x55, 0x8d, 0x46, 0x19, 0xfd, 0x95, 0xe7,
                                0x83, 0xb6, 0xcb, 0x2b, 0xa4, 0xd4, 0x27, 0x3d, 0xe8, 0xa1, 0x9a, 0x4c, 0xdb, 0x24};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb9, 0x8f, 0x47, 0xf3, 0x88, 0xa6, 0x32, 0x78, 0x65, 0x9c, 0x7a, 0x3a,
                                  0x7c, 0x57, 0x49, 0xaf, 0xb9, 0x73, 0x28, 0x5b, 0x48, 0xb6, 0xe0, 0x8f};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 29887;
  uint8_t client_id_bytes[] = {0x88, 0x84, 0x66, 0xb2, 0xb6, 0xf7, 0x9e, 0x85, 0xab, 0x74, 0x83, 0x94, 0xa8,
                               0xc,  0x52, 0xfa, 0x64, 0xeb, 0xfd, 0x2f, 0xff, 0x59, 0xc2, 0x10, 0xb2};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3b, 0x3c, 0x84, 0xf4, 0x36, 0x94, 0x57, 0x2f, 0xea, 0xe1, 0xd, 0xf, 0x4f, 0x11};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf3, 0x6,  0xb4, 0x3f, 0xb0, 0x88, 0xbf, 0x5d, 0x55,
                              0x44, 0x76, 0x1f, 0xc,  0x97, 0x7c, 0xd1, 0x96, 0x0};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ENQAAE\ACK\174&\128\161wm#W>VC<]\149\152\201\134x:\148\220\243T\\.", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// ";\161U\195\&6\138\177I\129\195\USA\DC3", _willMsg = "I\DC1\210\DC3\FS\DC3\242\138\171\211\203\b\190", _willProps =
// [PropRequestProblemInformation 76,PropAuthenticationData "=o(\183X\GS*5\239<\f63\ENQ",PropContentType
// "\159Q\190\186\211\ESC\236U\SO:\224\220GY\ENQ\FS\DC1\DC2\235\211[\SOHN.\233",PropAuthenticationMethod
// "ju\181\SO\DLE\b=\149\128\&1\US\228\128\156\249j",PropMessageExpiryInterval 15727,PropUserProperty ""
// "\ETX}\242\158\EOT^s\237{B\157\159\DC2\161\203\&16\145\DELry\239;\NAK",PropMessageExpiryInterval
// 17769,PropRetainAvailable 163,PropServerReference "A\231\200\&4|",PropAssignedClientIdentifier
// "",PropMaximumPacketSize 3021,PropSubscriptionIdentifierAvailable 79,PropMaximumPacketSize
// 6246,PropRequestProblemInformation 110,PropSubscriptionIdentifier 15,PropReasonString
// "\188@\234\245\138",PropRequestProblemInformation 149,PropWillDelayInterval 16414,PropReceiveMaximum
// 29477,PropRequestResponseInformation 172,PropMaximumQoS 199,PropMessageExpiryInterval 7605,PropTopicAlias
// 1346,PropMaximumPacketSize 9041,PropTopicAliasMaximum 20216,PropSessionExpiryInterval
// 23968,PropRequestProblemInformation 43]}), _cleanSession = True, _keepAlive = 22371, _connID = "\165\EM\181\CAN)62",
// _properties = [PropAuthenticationData "\189
// \DC4>\197\212ol!\NAK\t%V\145%6S\137\134\230\194\158\SYN[\231\&1\159\DC1X",PropReasonString
// "\171\&6\148a\DC4\158A\SI>=*\255)",PropAuthenticationMethod
// ">\149\144:\222o=L\DC11\246\148\190_\140}V\223\166\195\173\180\240h\154\"\222\206",PropTopicAliasMaximum 5258]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x10, 0xd9, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x86, 0x57, 0x63, 0x52, 0x16, 0x0,  0x1d, 0xbd, 0x20,
      0x14, 0x3e, 0xc5, 0xd4, 0x6f, 0x6c, 0x21, 0x15, 0x9,  0x25, 0x56, 0x91, 0x25, 0x36, 0x53, 0x89, 0x86, 0xe6, 0xc2,
      0x9e, 0x16, 0x5b, 0xe7, 0x31, 0x9f, 0x11, 0x58, 0x1f, 0x0,  0xd,  0xab, 0x36, 0x94, 0x61, 0x14, 0x9e, 0x41, 0xf,
      0x3e, 0x3d, 0x2a, 0xff, 0x29, 0x15, 0x0,  0x1c, 0x3e, 0x95, 0x90, 0x3a, 0xde, 0x6f, 0x3d, 0x4c, 0x11, 0x31, 0xf6,
      0x94, 0xbe, 0x5f, 0x8c, 0x7d, 0x56, 0xdf, 0xa6, 0xc3, 0xad, 0xb4, 0xf0, 0x68, 0x9a, 0x22, 0xde, 0xce, 0x22, 0x14,
      0x8a, 0x0,  0x7,  0xa5, 0x19, 0xb5, 0x18, 0x29, 0x36, 0x32, 0xb3, 0x1,  0x17, 0x4c, 0x16, 0x0,  0xe,  0x3d, 0x6f,
      0x28, 0xb7, 0x58, 0x1d, 0x2a, 0x35, 0xef, 0x3c, 0xc,  0x36, 0x33, 0x5,  0x3,  0x0,  0x19, 0x9f, 0x51, 0xbe, 0xba,
      0xd3, 0x1b, 0xec, 0x55, 0xe,  0x3a, 0xe0, 0xdc, 0x47, 0x59, 0x5,  0x1c, 0x11, 0x12, 0xeb, 0xd3, 0x5b, 0x1,  0x4e,
      0x2e, 0xe9, 0x15, 0x0,  0x10, 0x6a, 0x75, 0xb5, 0xe,  0x10, 0x8,  0x3d, 0x95, 0x80, 0x31, 0x1f, 0xe4, 0x80, 0x9c,
      0xf9, 0x6a, 0x2,  0x0,  0x0,  0x3d, 0x6f, 0x26, 0x0,  0x0,  0x0,  0x18, 0x3,  0x7d, 0xf2, 0x9e, 0x4,  0x5e, 0x73,
      0xed, 0x7b, 0x42, 0x9d, 0x9f, 0x12, 0xa1, 0xcb, 0x31, 0x36, 0x91, 0x7f, 0x72, 0x79, 0xef, 0x3b, 0x15, 0x2,  0x0,
      0x0,  0x45, 0x69, 0x25, 0xa3, 0x1c, 0x0,  0x5,  0x41, 0xe7, 0xc8, 0x34, 0x7c, 0x12, 0x0,  0x0,  0x27, 0x0,  0x0,
      0xb,  0xcd, 0x29, 0x4f, 0x27, 0x0,  0x0,  0x18, 0x66, 0x17, 0x6e, 0xb,  0xf,  0x1f, 0x0,  0x5,  0xbc, 0x40, 0xea,
      0xf5, 0x8a, 0x17, 0x95, 0x18, 0x0,  0x0,  0x40, 0x1e, 0x21, 0x73, 0x25, 0x19, 0xac, 0x24, 0xc7, 0x2,  0x0,  0x0,
      0x1d, 0xb5, 0x23, 0x5,  0x42, 0x27, 0x0,  0x0,  0x23, 0x51, 0x22, 0x4e, 0xf8, 0x11, 0x0,  0x0,  0x5d, 0xa0, 0x17,
      0x2b, 0x0,  0xd,  0x3b, 0xa1, 0x55, 0xc3, 0x36, 0x8a, 0xb1, 0x49, 0x81, 0xc3, 0x1f, 0x41, 0x13, 0x0,  0xd,  0x49,
      0x11, 0xd2, 0x13, 0x1c, 0x13, 0xf2, 0x8a, 0xab, 0xd3, 0xcb, 0x8,  0xbe, 0x0,  0x1e, 0x5,  0x41, 0x41, 0x45, 0x6,
      0xae, 0x26, 0x80, 0xa1, 0x77, 0x6d, 0x23, 0x57, 0x3e, 0x56, 0x43, 0x3c, 0x5d, 0x95, 0x98, 0xc9, 0x86, 0x78, 0x3a,
      0x94, 0xdc, 0xf3, 0x54, 0x5c, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbd, 0x20, 0x14, 0x3e, 0xc5, 0xd4, 0x6f, 0x6c, 0x21, 0x15, 0x9,  0x25, 0x56, 0x91, 0x25,
                           0x36, 0x53, 0x89, 0x86, 0xe6, 0xc2, 0x9e, 0x16, 0x5b, 0xe7, 0x31, 0x9f, 0x11, 0x58};
  uint8_t bytesprops1[] = {0xab, 0x36, 0x94, 0x61, 0x14, 0x9e, 0x41, 0xf, 0x3e, 0x3d, 0x2a, 0xff, 0x29};
  uint8_t bytesprops2[] = {0x3e, 0x95, 0x90, 0x3a, 0xde, 0x6f, 0x3d, 0x4c, 0x11, 0x31, 0xf6, 0x94, 0xbe, 0x5f,
                           0x8c, 0x7d, 0x56, 0xdf, 0xa6, 0xc3, 0xad, 0xb4, 0xf0, 0x68, 0x9a, 0x22, 0xde, 0xce};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5258}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x3d, 0x6f, 0x28, 0xb7, 0x58, 0x1d, 0x2a, 0x35, 0xef, 0x3c, 0xc, 0x36, 0x33, 0x5};
  uint8_t byteswillprops1[] = {0x9f, 0x51, 0xbe, 0xba, 0xd3, 0x1b, 0xec, 0x55, 0xe, 0x3a, 0xe0, 0xdc, 0x47,
                               0x59, 0x5,  0x1c, 0x11, 0x12, 0xeb, 0xd3, 0x5b, 0x1, 0x4e, 0x2e, 0xe9};
  uint8_t byteswillprops2[] = {0x6a, 0x75, 0xb5, 0xe,  0x10, 0x8,  0x3d, 0x95,
                               0x80, 0x31, 0x1f, 0xe4, 0x80, 0x9c, 0xf9, 0x6a};
  uint8_t byteswillprops4[] = {0x3,  0x7d, 0xf2, 0x9e, 0x4,  0x5e, 0x73, 0xed, 0x7b, 0x42, 0x9d, 0x9f,
                               0x12, 0xa1, 0xcb, 0x31, 0x36, 0x91, 0x7f, 0x72, 0x79, 0xef, 0x3b, 0x15};
  uint8_t byteswillprops3[] = {0};
  uint8_t byteswillprops5[] = {0x41, 0xe7, 0xc8, 0x34, 0x7c};
  uint8_t byteswillprops6[] = {0};
  uint8_t byteswillprops7[] = {0xbc, 0x40, 0xea, 0xf5, 0x8a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15727}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops3}, .v = {24, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17769}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3021}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6246}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16414}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29477}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7605}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1346}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9041}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20216}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23968}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3b, 0xa1, 0x55, 0xc3, 0x36, 0x8a, 0xb1, 0x49, 0x81, 0xc3, 0x1f, 0x41, 0x13};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x49, 0x11, 0xd2, 0x13, 0x1c, 0x13, 0xf2, 0x8a, 0xab, 0xd3, 0xcb, 0x8, 0xbe};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 22371;
  uint8_t client_id_bytes[] = {0xa5, 0x19, 0xb5, 0x18, 0x29, 0x36, 0x32};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5,  0x41, 0x41, 0x45, 0x6,  0xae, 0x26, 0x80, 0xa1, 0x77, 0x6d, 0x23, 0x57, 0x3e, 0x56,
                              0x43, 0x3c, 0x5d, 0x95, 0x98, 0xc9, 0x86, 0x78, 0x3a, 0x94, 0xdc, 0xf3, 0x54, 0x5c, 0x2e};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "OX\145\244\252\182\254\FS\130\252\134@\172\223\164\157{X}\165\146\152~f\219", _willMsg =
// "@\129Q\244!\183oR", _willProps = [PropResponseTopic "\156@",PropCorrelationData
// "Dp\NAK\235T\197oT\186\NUL\nF=\233\\~[V\211\179`\SYN9i\217\184dvO",PropPayloadFormatIndicator 161,PropContentType
// "AfZ\168\242p\198\175\NAK]\185\FS\229D\ESC\251\168\164fe\SUB\246N\218w\ESCdot",PropSubscriptionIdentifier
// 29,PropServerReference "q\222h\158L\230\162\DC1\237\133",PropAuthenticationData
// "\SUB\155Wv\128y",PropWildcardSubscriptionAvailable 8,PropUserProperty
// "\165m\248\222>\"\SYNJ\213S\148\ENQ<\179T\157B\166\185\142\169\181\162\NULw\250\145\SYN\170f"
// ",\DC1vBU\246\159=\SUB%\\rFKB(aoC\DC3\166\132\RS\DC1^",PropCorrelationData
// "l\b\134\228\218\227\176s\138\151'hl\n",PropResponseTopic
// "\171|<3\155!E\169i\225\DELn\185\ETB\186zne\145\SO\181\236\150_\140\SUB\254\230",PropWildcardSubscriptionAvailable
// 1,PropServerKeepAlive 29600,PropAuthenticationData "\203B\r\RS\199\184\243\164`",PropWillDelayInterval
// 13457,PropWillDelayInterval 12828,PropMaximumPacketSize 9940,PropResponseTopic
// "\131|\174-\n\221\169\DEL\237\193\205\169\DLE`t\167",PropTopicAlias 3659,PropPayloadFormatIndicator
// 160,PropRetainAvailable 158,PropRequestProblemInformation 243,PropRetainAvailable 34,PropResponseTopic
// "\155\252\199\245\193\208U"]}), _cleanSession = False, _keepAlive = 30518, _connID =
// "W\161E\137\235\171\156\EM\227`e^\234\242\248\227rj\195\139\NAK", _properties = [PropReceiveMaximum
// 17590,PropMaximumPacketSize 26394,PropSessionExpiryInterval 21423,PropReceiveMaximum 6468,PropMessageExpiryInterval
// 23431,PropRequestResponseInformation 180,PropCorrelationData
// "\197\SYN~\191|\213\DC1b9t\243'\246\154",PropSubscriptionIdentifier 15,PropSubscriptionIdentifier
// 29,PropServerReference "z\152\203\191c\203\GS\251\243\170\247\159t\255u",PropContentType
// "\224\GS\196\245\232i",PropResponseInformation "\184\184\152'\199\187\&4\US\191\DLE\218\245\197]\233T\EM\153\245y\218
// \230\210(\190\CAN\175\SO",PropTopicAlias 4418,PropServerKeepAlive 11532,PropServerReference
// "\245\148\RSX\234\243",PropAuthenticationData
// "\225\&6B>\DEL&\189\220\237\132v\"\177\226<1\136\173\154]\SOH\205\252\178\131",PropServerKeepAlive
// 31846,PropServerKeepAlive 25329,PropTopicAliasMaximum 26607,PropMessageExpiryInterval 29456,PropMaximumPacketSize
// 26694,PropSessionExpiryInterval 12931,PropContentType
// "Y\136\218Z\133T\174x\212r\f\"\137n}\162\137\254\206Z\249\129$oc",PropWildcardSubscriptionAvailable
// 193,PropSharedSubscriptionAvailable 186,PropAuthenticationData
// "\224\200\a\140\134\FS\172\171~&\DLE\154\246l5A3",PropMessageExpiryInterval 17774,PropSubscriptionIdentifierAvailable
// 142,PropReasonString "R&\173\137v\248]\157\164\r\143\163z\DLEL\250\136\136N\166\252\vG\140\&1\157\DLE,\156"]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x10, 0xe4, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x24, 0x77, 0x36, 0x85, 0x2,  0x21, 0x44, 0xb6, 0x27,
      0x0,  0x0,  0x67, 0x1a, 0x11, 0x0,  0x0,  0x53, 0xaf, 0x21, 0x19, 0x44, 0x2,  0x0,  0x0,  0x5b, 0x87, 0x19, 0xb4,
      0x9,  0x0,  0xe,  0xc5, 0x16, 0x7e, 0xbf, 0x7c, 0xd5, 0x11, 0x62, 0x39, 0x74, 0xf3, 0x27, 0xf6, 0x9a, 0xb,  0xf,
      0xb,  0x1d, 0x1c, 0x0,  0xf,  0x7a, 0x98, 0xcb, 0xbf, 0x63, 0xcb, 0x1d, 0xfb, 0xf3, 0xaa, 0xf7, 0x9f, 0x74, 0xff,
      0x75, 0x3,  0x0,  0x6,  0xe0, 0x1d, 0xc4, 0xf5, 0xe8, 0x69, 0x1a, 0x0,  0x1d, 0xb8, 0xb8, 0x98, 0x27, 0xc7, 0xbb,
      0x34, 0x1f, 0xbf, 0x10, 0xda, 0xf5, 0xc5, 0x5d, 0xe9, 0x54, 0x19, 0x99, 0xf5, 0x79, 0xda, 0x20, 0xe6, 0xd2, 0x28,
      0xbe, 0x18, 0xaf, 0xe,  0x23, 0x11, 0x42, 0x13, 0x2d, 0xc,  0x1c, 0x0,  0x6,  0xf5, 0x94, 0x1e, 0x58, 0xea, 0xf3,
      0x16, 0x0,  0x19, 0xe1, 0x36, 0x42, 0x3e, 0x7f, 0x26, 0xbd, 0xdc, 0xed, 0x84, 0x76, 0x22, 0xb1, 0xe2, 0x3c, 0x31,
      0x88, 0xad, 0x9a, 0x5d, 0x1,  0xcd, 0xfc, 0xb2, 0x83, 0x13, 0x7c, 0x66, 0x13, 0x62, 0xf1, 0x22, 0x67, 0xef, 0x2,
      0x0,  0x0,  0x73, 0x10, 0x27, 0x0,  0x0,  0x68, 0x46, 0x11, 0x0,  0x0,  0x32, 0x83, 0x3,  0x0,  0x19, 0x59, 0x88,
      0xda, 0x5a, 0x85, 0x54, 0xae, 0x78, 0xd4, 0x72, 0xc,  0x22, 0x89, 0x6e, 0x7d, 0xa2, 0x89, 0xfe, 0xce, 0x5a, 0xf9,
      0x81, 0x24, 0x6f, 0x63, 0x28, 0xc1, 0x2a, 0xba, 0x16, 0x0,  0x11, 0xe0, 0xc8, 0x7,  0x8c, 0x86, 0x1c, 0xac, 0xab,
      0x7e, 0x26, 0x10, 0x9a, 0xf6, 0x6c, 0x35, 0x41, 0x33, 0x2,  0x0,  0x0,  0x45, 0x6e, 0x29, 0x8e, 0x1f, 0x0,  0x1d,
      0x52, 0x26, 0xad, 0x89, 0x76, 0xf8, 0x5d, 0x9d, 0xa4, 0xd,  0x8f, 0xa3, 0x7a, 0x10, 0x4c, 0xfa, 0x88, 0x88, 0x4e,
      0xa6, 0xfc, 0xb,  0x47, 0x8c, 0x31, 0x9d, 0x10, 0x2c, 0x9c, 0x0,  0x15, 0x57, 0xa1, 0x45, 0x89, 0xeb, 0xab, 0x9c,
      0x19, 0xe3, 0x60, 0x65, 0x5e, 0xea, 0xf2, 0xf8, 0xe3, 0x72, 0x6a, 0xc3, 0x8b, 0x15, 0x95, 0x2,  0x8,  0x0,  0x2,
      0x9c, 0x40, 0x9,  0x0,  0x1d, 0x44, 0x70, 0x15, 0xeb, 0x54, 0xc5, 0x6f, 0x54, 0xba, 0x0,  0xa,  0x46, 0x3d, 0xe9,
      0x5c, 0x7e, 0x5b, 0x56, 0xd3, 0xb3, 0x60, 0x16, 0x39, 0x69, 0xd9, 0xb8, 0x64, 0x76, 0x4f, 0x1,  0xa1, 0x3,  0x0,
      0x1d, 0x41, 0x66, 0x5a, 0xa8, 0xf2, 0x70, 0xc6, 0xaf, 0x15, 0x5d, 0xb9, 0x1c, 0xe5, 0x44, 0x1b, 0xfb, 0xa8, 0xa4,
      0x66, 0x65, 0x1a, 0xf6, 0x4e, 0xda, 0x77, 0x1b, 0x64, 0x6f, 0x74, 0xb,  0x1d, 0x1c, 0x0,  0xa,  0x71, 0xde, 0x68,
      0x9e, 0x4c, 0xe6, 0xa2, 0x11, 0xed, 0x85, 0x16, 0x0,  0x6,  0x1a, 0x9b, 0x57, 0x76, 0x80, 0x79, 0x28, 0x8,  0x26,
      0x0,  0x1e, 0xa5, 0x6d, 0xf8, 0xde, 0x3e, 0x22, 0x16, 0x4a, 0xd5, 0x53, 0x94, 0x5,  0x3c, 0xb3, 0x54, 0x9d, 0x42,
      0xa6, 0xb9, 0x8e, 0xa9, 0xb5, 0xa2, 0x0,  0x77, 0xfa, 0x91, 0x16, 0xaa, 0x66, 0x0,  0x19, 0x2c, 0x11, 0x76, 0x42,
      0x55, 0xf6, 0x9f, 0x3d, 0x1a, 0x25, 0x5c, 0x72, 0x46, 0x4b, 0x42, 0x28, 0x61, 0x6f, 0x43, 0x13, 0xa6, 0x84, 0x1e,
      0x11, 0x5e, 0x9,  0x0,  0xe,  0x6c, 0x8,  0x86, 0xe4, 0xda, 0xe3, 0xb0, 0x73, 0x8a, 0x97, 0x27, 0x68, 0x6c, 0xa,
      0x8,  0x0,  0x1c, 0xab, 0x7c, 0x3c, 0x33, 0x9b, 0x21, 0x45, 0xa9, 0x69, 0xe1, 0x7f, 0x6e, 0xb9, 0x17, 0xba, 0x7a,
      0x6e, 0x65, 0x91, 0xe,  0xb5, 0xec, 0x96, 0x5f, 0x8c, 0x1a, 0xfe, 0xe6, 0x28, 0x1,  0x13, 0x73, 0xa0, 0x16, 0x0,
      0x9,  0xcb, 0x42, 0xd,  0x1e, 0xc7, 0xb8, 0xf3, 0xa4, 0x60, 0x18, 0x0,  0x0,  0x34, 0x91, 0x18, 0x0,  0x0,  0x32,
      0x1c, 0x27, 0x0,  0x0,  0x26, 0xd4, 0x8,  0x0,  0x10, 0x83, 0x7c, 0xae, 0x2d, 0xa,  0xdd, 0xa9, 0x7f, 0xed, 0xc1,
      0xcd, 0xa9, 0x10, 0x60, 0x74, 0xa7, 0x23, 0xe,  0x4b, 0x1,  0xa0, 0x25, 0x9e, 0x17, 0xf3, 0x25, 0x22, 0x8,  0x0,
      0x7,  0x9b, 0xfc, 0xc7, 0xf5, 0xc1, 0xd0, 0x55, 0x0,  0x19, 0x4f, 0x58, 0x91, 0xf4, 0xfc, 0xb6, 0xfe, 0x1c, 0x82,
      0xfc, 0x86, 0x40, 0xac, 0xdf, 0xa4, 0x9d, 0x7b, 0x58, 0x7d, 0xa5, 0x92, 0x98, 0x7e, 0x66, 0xdb, 0x0,  0x8,  0x40,
      0x81, 0x51, 0xf4, 0x21, 0xb7, 0x6f, 0x52};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc5, 0x16, 0x7e, 0xbf, 0x7c, 0xd5, 0x11, 0x62, 0x39, 0x74, 0xf3, 0x27, 0xf6, 0x9a};
  uint8_t bytesprops1[] = {0x7a, 0x98, 0xcb, 0xbf, 0x63, 0xcb, 0x1d, 0xfb, 0xf3, 0xaa, 0xf7, 0x9f, 0x74, 0xff, 0x75};
  uint8_t bytesprops2[] = {0xe0, 0x1d, 0xc4, 0xf5, 0xe8, 0x69};
  uint8_t bytesprops3[] = {0xb8, 0xb8, 0x98, 0x27, 0xc7, 0xbb, 0x34, 0x1f, 0xbf, 0x10, 0xda, 0xf5, 0xc5, 0x5d, 0xe9,
                           0x54, 0x19, 0x99, 0xf5, 0x79, 0xda, 0x20, 0xe6, 0xd2, 0x28, 0xbe, 0x18, 0xaf, 0xe};
  uint8_t bytesprops4[] = {0xf5, 0x94, 0x1e, 0x58, 0xea, 0xf3};
  uint8_t bytesprops5[] = {0xe1, 0x36, 0x42, 0x3e, 0x7f, 0x26, 0xbd, 0xdc, 0xed, 0x84, 0x76, 0x22, 0xb1,
                           0xe2, 0x3c, 0x31, 0x88, 0xad, 0x9a, 0x5d, 0x1,  0xcd, 0xfc, 0xb2, 0x83};
  uint8_t bytesprops6[] = {0x59, 0x88, 0xda, 0x5a, 0x85, 0x54, 0xae, 0x78, 0xd4, 0x72, 0xc,  0x22, 0x89,
                           0x6e, 0x7d, 0xa2, 0x89, 0xfe, 0xce, 0x5a, 0xf9, 0x81, 0x24, 0x6f, 0x63};
  uint8_t bytesprops7[] = {0xe0, 0xc8, 0x7,  0x8c, 0x86, 0x1c, 0xac, 0xab, 0x7e,
                           0x26, 0x10, 0x9a, 0xf6, 0x6c, 0x35, 0x41, 0x33};
  uint8_t bytesprops8[] = {0x52, 0x26, 0xad, 0x89, 0x76, 0xf8, 0x5d, 0x9d, 0xa4, 0xd,  0x8f, 0xa3, 0x7a, 0x10, 0x4c,
                           0xfa, 0x88, 0x88, 0x4e, 0xa6, 0xfc, 0xb,  0x47, 0x8c, 0x31, 0x9d, 0x10, 0x2c, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17590}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26394}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21423}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6468}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23431}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4418}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11532}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31846}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25329}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26607}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29456}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26694}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12931}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17774}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9c, 0x40};
  uint8_t byteswillprops1[] = {0x44, 0x70, 0x15, 0xeb, 0x54, 0xc5, 0x6f, 0x54, 0xba, 0x0,  0xa,  0x46, 0x3d, 0xe9, 0x5c,
                               0x7e, 0x5b, 0x56, 0xd3, 0xb3, 0x60, 0x16, 0x39, 0x69, 0xd9, 0xb8, 0x64, 0x76, 0x4f};
  uint8_t byteswillprops2[] = {0x41, 0x66, 0x5a, 0xa8, 0xf2, 0x70, 0xc6, 0xaf, 0x15, 0x5d, 0xb9, 0x1c, 0xe5, 0x44, 0x1b,
                               0xfb, 0xa8, 0xa4, 0x66, 0x65, 0x1a, 0xf6, 0x4e, 0xda, 0x77, 0x1b, 0x64, 0x6f, 0x74};
  uint8_t byteswillprops3[] = {0x71, 0xde, 0x68, 0x9e, 0x4c, 0xe6, 0xa2, 0x11, 0xed, 0x85};
  uint8_t byteswillprops4[] = {0x1a, 0x9b, 0x57, 0x76, 0x80, 0x79};
  uint8_t byteswillprops6[] = {0x2c, 0x11, 0x76, 0x42, 0x55, 0xf6, 0x9f, 0x3d, 0x1a, 0x25, 0x5c, 0x72, 0x46,
                               0x4b, 0x42, 0x28, 0x61, 0x6f, 0x43, 0x13, 0xa6, 0x84, 0x1e, 0x11, 0x5e};
  uint8_t byteswillprops5[] = {0xa5, 0x6d, 0xf8, 0xde, 0x3e, 0x22, 0x16, 0x4a, 0xd5, 0x53,
                               0x94, 0x5,  0x3c, 0xb3, 0x54, 0x9d, 0x42, 0xa6, 0xb9, 0x8e,
                               0xa9, 0xb5, 0xa2, 0x0,  0x77, 0xfa, 0x91, 0x16, 0xaa, 0x66};
  uint8_t byteswillprops7[] = {0x6c, 0x8, 0x86, 0xe4, 0xda, 0xe3, 0xb0, 0x73, 0x8a, 0x97, 0x27, 0x68, 0x6c, 0xa};
  uint8_t byteswillprops8[] = {0xab, 0x7c, 0x3c, 0x33, 0x9b, 0x21, 0x45, 0xa9, 0x69, 0xe1, 0x7f, 0x6e, 0xb9, 0x17,
                               0xba, 0x7a, 0x6e, 0x65, 0x91, 0xe,  0xb5, 0xec, 0x96, 0x5f, 0x8c, 0x1a, 0xfe, 0xe6};
  uint8_t byteswillprops9[] = {0xcb, 0x42, 0xd, 0x1e, 0xc7, 0xb8, 0xf3, 0xa4, 0x60};
  uint8_t byteswillprops10[] = {0x83, 0x7c, 0xae, 0x2d, 0xa,  0xdd, 0xa9, 0x7f,
                                0xed, 0xc1, 0xcd, 0xa9, 0x10, 0x60, 0x74, 0xa7};
  uint8_t byteswillprops11[] = {0x9b, 0xfc, 0xc7, 0xf5, 0xc1, 0xd0, 0x55};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops5}, .v = {25, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29600}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13457}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12828}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9940}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3659}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&byteswillprops11}}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4f, 0x58, 0x91, 0xf4, 0xfc, 0xb6, 0xfe, 0x1c, 0x82, 0xfc, 0x86, 0x40, 0xac,
                                0xdf, 0xa4, 0x9d, 0x7b, 0x58, 0x7d, 0xa5, 0x92, 0x98, 0x7e, 0x66, 0xdb};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x40, 0x81, 0x51, 0xf4, 0x21, 0xb7, 0x6f, 0x52};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30518;
  uint8_t client_id_bytes[] = {0x57, 0xa1, 0x45, 0x89, 0xeb, 0xab, 0x9c, 0x19, 0xe3, 0x60, 0x65,
                               0x5e, 0xea, 0xf2, 0xf8, 0xe3, 0x72, 0x6a, 0xc3, 0x8b, 0x15};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\233\DLEuz,\235\221\183\245C\171\219\241^\213\168\160\167\181<\210\175\201\225\241\132\251\229e\164", _password =
// Just "\240\180X}9\198\t\SUBK\211\ACK\179t\255\237\148 no\DC3\203\&3;\198", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic =
// "\157\167S\173)\208\193\243\142\STX?\244\199<\DC3\202VL\215\218\215\162\174~\167G1\t\196)", _willMsg = "", _willProps
// = [PropResponseInformation "\SI\170\241\213p6LF\SYN\129\135:",PropMaximumQoS 183,PropWildcardSubscriptionAvailable
// 207,PropSubscriptionIdentifier 18,PropResponseInformation
// "\213\165llx\EM\158\206\220\&3z~\140",PropAuthenticationMethod
// "\251\132\158\r\154\170<\243\247\140\178\151\DC3\230w\SUB\129SwA",PropMessageExpiryInterval
// 14841,PropAuthenticationData "\251a\SYN\181^\224\SO\163Q\n5\n\198\150Xe&\DLE",PropRequestResponseInformation
// 214,PropRequestProblemInformation 220,PropSharedSubscriptionAvailable 246,PropContentType
// "\169\194\DC2\SUB\199Qs]j\159P\239\223K\193V",PropRetainAvailable 115,PropMaximumQoS 207]}), _cleanSession = False,
// _keepAlive = 26007, _connID = "N\237\211", _properties = [PropTopicAlias 31274,PropUserProperty
// "S\ESCE\154\&9$\251\254\GS\193_\174\ETB-_\181GJ.A\221\\\187\230\SOH\201\255\200"
// "\144\211$\f\225\133\208s\159\162\171\254!\209\210\141\v\197\237\ENQ\253\169\247\224)\223",PropRetainAvailable
// 115,PropAuthenticationData "j",PropAuthenticationData
// "\154\r\138%\146`\147\197\145)9\185\176Z\ENQ9`\217\174\208|\193y",PropMessageExpiryInterval 206,PropContentType
// "#\219\&7\EMi\208\148\253H[c\209s\SOH\161\235w?\DEL\137\&7&9",PropWildcardSubscriptionAvailable 226,PropResponseTopic
// "\182{\212\195\n\209H\222zP){R\142\150\218$Oa\147K\173",PropRequestProblemInformation
// 145,PropSubscriptionIdentifierAvailable 20,PropRequestResponseInformation 22,PropTopicAlias
// 5924,PropPayloadFormatIndicator 84,PropMaximumPacketSize 26952,PropMaximumQoS 207,PropRetainAvailable
// 246,PropServerReference "&S\nC\169\RS\181dI\243/\252x",PropSharedSubscriptionAvailable 163,PropTopicAlias
// 19727,PropContentType "J\236jFj\207"]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x10, 0xab, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x65, 0x97, 0xca, 0x1,  0x23, 0x7a, 0x2a, 0x26,
      0x0,  0x1c, 0x53, 0x1b, 0x45, 0x9a, 0x39, 0x24, 0xfb, 0xfe, 0x1d, 0xc1, 0x5f, 0xae, 0x17, 0x2d, 0x5f, 0xb5, 0x47,
      0x4a, 0x2e, 0x41, 0xdd, 0x5c, 0xbb, 0xe6, 0x1,  0xc9, 0xff, 0xc8, 0x0,  0x1a, 0x90, 0xd3, 0x24, 0xc,  0xe1, 0x85,
      0xd0, 0x73, 0x9f, 0xa2, 0xab, 0xfe, 0x21, 0xd1, 0xd2, 0x8d, 0xb,  0xc5, 0xed, 0x5,  0xfd, 0xa9, 0xf7, 0xe0, 0x29,
      0xdf, 0x25, 0x73, 0x16, 0x0,  0x1,  0x6a, 0x16, 0x0,  0x17, 0x9a, 0xd,  0x8a, 0x25, 0x92, 0x60, 0x93, 0xc5, 0x91,
      0x29, 0x39, 0xb9, 0xb0, 0x5a, 0x5,  0x39, 0x60, 0xd9, 0xae, 0xd0, 0x7c, 0xc1, 0x79, 0x2,  0x0,  0x0,  0x0,  0xce,
      0x3,  0x0,  0x17, 0x23, 0xdb, 0x37, 0x19, 0x69, 0xd0, 0x94, 0xfd, 0x48, 0x5b, 0x63, 0xd1, 0x73, 0x1,  0xa1, 0xeb,
      0x77, 0x3f, 0x7f, 0x89, 0x37, 0x26, 0x39, 0x28, 0xe2, 0x8,  0x0,  0x16, 0xb6, 0x7b, 0xd4, 0xc3, 0xa,  0xd1, 0x48,
      0xde, 0x7a, 0x50, 0x29, 0x7b, 0x52, 0x8e, 0x96, 0xda, 0x24, 0x4f, 0x61, 0x93, 0x4b, 0xad, 0x17, 0x91, 0x29, 0x14,
      0x19, 0x16, 0x23, 0x17, 0x24, 0x1,  0x54, 0x27, 0x0,  0x0,  0x69, 0x48, 0x24, 0xcf, 0x25, 0xf6, 0x1c, 0x0,  0xd,
      0x26, 0x53, 0xa,  0x43, 0xa9, 0x1e, 0xb5, 0x64, 0x49, 0xf3, 0x2f, 0xfc, 0x78, 0x2a, 0xa3, 0x23, 0x4d, 0xf,  0x3,
      0x0,  0x6,  0x4a, 0xec, 0x6a, 0x46, 0x6a, 0xcf, 0x0,  0x3,  0x4e, 0xed, 0xd3, 0x73, 0x1a, 0x0,  0xc,  0xf,  0xaa,
      0xf1, 0xd5, 0x70, 0x36, 0x4c, 0x46, 0x16, 0x81, 0x87, 0x3a, 0x24, 0xb7, 0x28, 0xcf, 0xb,  0x12, 0x1a, 0x0,  0xd,
      0xd5, 0xa5, 0x6c, 0x6c, 0x78, 0x19, 0x9e, 0xce, 0xdc, 0x33, 0x7a, 0x7e, 0x8c, 0x15, 0x0,  0x14, 0xfb, 0x84, 0x9e,
      0xd,  0x9a, 0xaa, 0x3c, 0xf3, 0xf7, 0x8c, 0xb2, 0x97, 0x13, 0xe6, 0x77, 0x1a, 0x81, 0x53, 0x77, 0x41, 0x2,  0x0,
      0x0,  0x39, 0xf9, 0x16, 0x0,  0x12, 0xfb, 0x61, 0x16, 0xb5, 0x5e, 0xe0, 0xe,  0xa3, 0x51, 0xa,  0x35, 0xa,  0xc6,
      0x96, 0x58, 0x65, 0x26, 0x10, 0x19, 0xd6, 0x17, 0xdc, 0x2a, 0xf6, 0x3,  0x0,  0x10, 0xa9, 0xc2, 0x12, 0x1a, 0xc7,
      0x51, 0x73, 0x5d, 0x6a, 0x9f, 0x50, 0xef, 0xdf, 0x4b, 0xc1, 0x56, 0x25, 0x73, 0x24, 0xcf, 0x0,  0x1e, 0x9d, 0xa7,
      0x53, 0xad, 0x29, 0xd0, 0xc1, 0xf3, 0x8e, 0x2,  0x3f, 0xf4, 0xc7, 0x3c, 0x13, 0xca, 0x56, 0x4c, 0xd7, 0xda, 0xd7,
      0xa2, 0xae, 0x7e, 0xa7, 0x47, 0x31, 0x9,  0xc4, 0x29, 0x0,  0x0,  0x0,  0x1e, 0xe9, 0x10, 0x75, 0x7a, 0x2c, 0xeb,
      0xdd, 0xb7, 0xf5, 0x43, 0xab, 0xdb, 0xf1, 0x5e, 0xd5, 0xa8, 0xa0, 0xa7, 0xb5, 0x3c, 0xd2, 0xaf, 0xc9, 0xe1, 0xf1,
      0x84, 0xfb, 0xe5, 0x65, 0xa4, 0x0,  0x18, 0xf0, 0xb4, 0x58, 0x7d, 0x39, 0xc6, 0x9,  0x1a, 0x4b, 0xd3, 0x6,  0xb3,
      0x74, 0xff, 0xed, 0x94, 0x20, 0x6e, 0x6f, 0x13, 0xcb, 0x33, 0x3b, 0xc6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x90, 0xd3, 0x24, 0xc, 0xe1, 0x85, 0xd0, 0x73, 0x9f, 0xa2, 0xab, 0xfe, 0x21,
                           0xd1, 0xd2, 0x8d, 0xb, 0xc5, 0xed, 0x5,  0xfd, 0xa9, 0xf7, 0xe0, 0x29, 0xdf};
  uint8_t bytesprops0[] = {0x53, 0x1b, 0x45, 0x9a, 0x39, 0x24, 0xfb, 0xfe, 0x1d, 0xc1, 0x5f, 0xae, 0x17, 0x2d,
                           0x5f, 0xb5, 0x47, 0x4a, 0x2e, 0x41, 0xdd, 0x5c, 0xbb, 0xe6, 0x1,  0xc9, 0xff, 0xc8};
  uint8_t bytesprops2[] = {0x6a};
  uint8_t bytesprops3[] = {0x9a, 0xd,  0x8a, 0x25, 0x92, 0x60, 0x93, 0xc5, 0x91, 0x29, 0x39, 0xb9,
                           0xb0, 0x5a, 0x5,  0x39, 0x60, 0xd9, 0xae, 0xd0, 0x7c, 0xc1, 0x79};
  uint8_t bytesprops4[] = {0x23, 0xdb, 0x37, 0x19, 0x69, 0xd0, 0x94, 0xfd, 0x48, 0x5b, 0x63, 0xd1,
                           0x73, 0x1,  0xa1, 0xeb, 0x77, 0x3f, 0x7f, 0x89, 0x37, 0x26, 0x39};
  uint8_t bytesprops5[] = {0xb6, 0x7b, 0xd4, 0xc3, 0xa,  0xd1, 0x48, 0xde, 0x7a, 0x50, 0x29,
                           0x7b, 0x52, 0x8e, 0x96, 0xda, 0x24, 0x4f, 0x61, 0x93, 0x4b, 0xad};
  uint8_t bytesprops6[] = {0x26, 0x53, 0xa, 0x43, 0xa9, 0x1e, 0xb5, 0x64, 0x49, 0xf3, 0x2f, 0xfc, 0x78};
  uint8_t bytesprops7[] = {0x4a, 0xec, 0x6a, 0x46, 0x6a, 0xcf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31274}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops0}, .v = {26, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 206}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5924}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26952}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19727}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf, 0xaa, 0xf1, 0xd5, 0x70, 0x36, 0x4c, 0x46, 0x16, 0x81, 0x87, 0x3a};
  uint8_t byteswillprops1[] = {0xd5, 0xa5, 0x6c, 0x6c, 0x78, 0x19, 0x9e, 0xce, 0xdc, 0x33, 0x7a, 0x7e, 0x8c};
  uint8_t byteswillprops2[] = {0xfb, 0x84, 0x9e, 0xd,  0x9a, 0xaa, 0x3c, 0xf3, 0xf7, 0x8c,
                               0xb2, 0x97, 0x13, 0xe6, 0x77, 0x1a, 0x81, 0x53, 0x77, 0x41};
  uint8_t byteswillprops3[] = {0xfb, 0x61, 0x16, 0xb5, 0x5e, 0xe0, 0xe,  0xa3, 0x51,
                               0xa,  0x35, 0xa,  0xc6, 0x96, 0x58, 0x65, 0x26, 0x10};
  uint8_t byteswillprops4[] = {0xa9, 0xc2, 0x12, 0x1a, 0xc7, 0x51, 0x73, 0x5d,
                               0x6a, 0x9f, 0x50, 0xef, 0xdf, 0x4b, 0xc1, 0x56};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 18}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14841}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 207}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9d, 0xa7, 0x53, 0xad, 0x29, 0xd0, 0xc1, 0xf3, 0x8e, 0x2,
                                0x3f, 0xf4, 0xc7, 0x3c, 0x13, 0xca, 0x56, 0x4c, 0xd7, 0xda,
                                0xd7, 0xa2, 0xae, 0x7e, 0xa7, 0x47, 0x31, 0x9,  0xc4, 0x29};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26007;
  uint8_t client_id_bytes[] = {0x4e, 0xed, 0xd3};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe9, 0x10, 0x75, 0x7a, 0x2c, 0xeb, 0xdd, 0xb7, 0xf5, 0x43, 0xab, 0xdb, 0xf1, 0x5e, 0xd5,
                              0xa8, 0xa0, 0xa7, 0xb5, 0x3c, 0xd2, 0xaf, 0xc9, 0xe1, 0xf1, 0x84, 0xfb, 0xe5, 0x65, 0xa4};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf0, 0xb4, 0x58, 0x7d, 0x39, 0xc6, 0x9,  0x1a, 0x4b, 0xd3, 0x6,  0xb3,
                              0x74, 0xff, 0xed, 0x94, 0x20, 0x6e, 0x6f, 0x13, 0xcb, 0x33, 0x3b, 0xc6};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19824 [("\NUL\181VC\229\166\255j \b\FSg\134\253%\212u\175\246K)\203\142>\132\154`n",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("-e\131\&2\165",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("\229\164\170}\NUL6\248\\?V\138\161\245\251\178\192u$\205\204\GS\191",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\255\220\179G\GS\163\207k\"\197u@\218\v\133\aW\US\136\172j\231v",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("S\189\207H\v\DC4\186]k\202\252\ESC2\228w\158C|",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x71, 0x4d, 0x70, 0x0,  0x1c, 0x0,  0xb5, 0x56, 0x43, 0xe5, 0xa6, 0xff, 0x6a, 0x20, 0x8,  0x1c,
                   0x67, 0x86, 0xfd, 0x25, 0xd4, 0x75, 0xaf, 0xf6, 0x4b, 0x29, 0xcb, 0x8e, 0x3e, 0x84, 0x9a, 0x60, 0x6e,
                   0x2,  0x0,  0x5,  0x2d, 0x65, 0x83, 0x32, 0xa5, 0x0,  0x0,  0x16, 0xe5, 0xa4, 0xaa, 0x7d, 0x0,  0x36,
                   0xf8, 0x5c, 0x3f, 0x56, 0x8a, 0xa1, 0xf5, 0xfb, 0xb2, 0xc0, 0x75, 0x24, 0xcd, 0xcc, 0x1d, 0xbf, 0x1,
                   0x0,  0x17, 0xff, 0xdc, 0xb3, 0x47, 0x1d, 0xa3, 0xcf, 0x6b, 0x22, 0xc5, 0x75, 0x40, 0xda, 0xb,  0x85,
                   0x7,  0x57, 0x1f, 0x88, 0xac, 0x6a, 0xe7, 0x76, 0x1,  0x0,  0x12, 0x53, 0xbd, 0xcf, 0x48, 0xb,  0x14,
                   0xba, 0x5d, 0x6b, 0xca, 0xfc, 0x1b, 0x32, 0xe4, 0x77, 0x9e, 0x43, 0x7c, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x0,  0xb5, 0x56, 0x43, 0xe5, 0xa6, 0xff, 0x6a, 0x20, 0x8,
                                     0x1c, 0x67, 0x86, 0xfd, 0x25, 0xd4, 0x75, 0xaf, 0xf6, 0x4b,
                                     0x29, 0xcb, 0x8e, 0x3e, 0x84, 0x9a, 0x60, 0x6e};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d, 0x65, 0x83, 0x32, 0xa5};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0xa4, 0xaa, 0x7d, 0x0,  0x36, 0xf8, 0x5c, 0x3f, 0x56, 0x8a,
                                     0xa1, 0xf5, 0xfb, 0xb2, 0xc0, 0x75, 0x24, 0xcd, 0xcc, 0x1d, 0xbf};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xff, 0xdc, 0xb3, 0x47, 0x1d, 0xa3, 0xcf, 0x6b, 0x22, 0xc5, 0x75, 0x40,
                                     0xda, 0xb,  0x85, 0x7,  0x57, 0x1f, 0x88, 0xac, 0x6a, 0xe7, 0x76};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x53, 0xbd, 0xcf, 0x48, 0xb,  0x14, 0xba, 0x5d, 0x6b,
                                     0xca, 0xfc, 0x1b, 0x32, 0xe4, 0x77, 0x9e, 0x43, 0x7c};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19824, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12399 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\250L\239\233\150\180y\246\174\156:\150\247RB",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\130/\NAKA~\213\CAN\RS\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("XMwO\188j\180\242\145D7\132\192e\183\EM\166$\183\158|5",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\167\200\ESC\147B\160\157\186\DC14\244.w#\196\246\200\226\230\EM\179\181\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\f\211U\184\143\231\221\ETXl\181&\ENQ\214*.O\GS\206b\SOFx\v\132\&7\159\151r\238,",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\220\EOT\131\&0{\147\167b\132#\244\188\SUB\r\145\DLE\DELzD\133",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\211\177\223!\136x\241+?\150\246\199V+!",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("U0\204\242VJa\154\135yp\US\150\210\212xUN\172=\"\161\134\239\238&\153M",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\226\ETX\215\DC2\164\133_g\140\144\NULo",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {
      0x82, 0xce, 0x1,  0x30, 0x6f, 0x0,  0x0,  0x0,  0x0,  0xf,  0xfa, 0x4c, 0xef, 0xe9, 0x96, 0xb4, 0x79, 0xf6, 0xae,
      0x9c, 0x3a, 0x96, 0xf7, 0x52, 0x42, 0x1,  0x0,  0x9,  0x82, 0x2f, 0x15, 0x41, 0x7e, 0xd5, 0x18, 0x1e, 0xc5, 0x0,
      0x0,  0x16, 0x58, 0x4d, 0x77, 0x4f, 0xbc, 0x6a, 0xb4, 0xf2, 0x91, 0x44, 0x37, 0x84, 0xc0, 0x65, 0xb7, 0x19, 0xa6,
      0x24, 0xb7, 0x9e, 0x7c, 0x35, 0x0,  0x0,  0x17, 0xa7, 0xc8, 0x1b, 0x93, 0x42, 0xa0, 0x9d, 0xba, 0x11, 0x34, 0xf4,
      0x2e, 0x77, 0x23, 0xc4, 0xf6, 0xc8, 0xe2, 0xe6, 0x19, 0xb3, 0xb5, 0xf,  0x2,  0x0,  0x1e, 0xc,  0xd3, 0x55, 0xb8,
      0x8f, 0xe7, 0xdd, 0x3,  0x6c, 0xb5, 0x26, 0x5,  0xd6, 0x2a, 0x2e, 0x4f, 0x1d, 0xce, 0x62, 0xe,  0x46, 0x78, 0xb,
      0x84, 0x37, 0x9f, 0x97, 0x72, 0xee, 0x2c, 0x0,  0x0,  0x14, 0xdc, 0x4,  0x83, 0x30, 0x7b, 0x93, 0xa7, 0x62, 0x84,
      0x23, 0xf4, 0xbc, 0x1a, 0xd,  0x91, 0x10, 0x7f, 0x7a, 0x44, 0x85, 0x2,  0x0,  0xf,  0xd3, 0xb1, 0xdf, 0x21, 0x88,
      0x78, 0xf1, 0x2b, 0x3f, 0x96, 0xf6, 0xc7, 0x56, 0x2b, 0x21, 0x2,  0x0,  0x1c, 0x55, 0x30, 0xcc, 0xf2, 0x56, 0x4a,
      0x61, 0x9a, 0x87, 0x79, 0x70, 0x1f, 0x96, 0xd2, 0xd4, 0x78, 0x55, 0x4e, 0xac, 0x3d, 0x22, 0xa1, 0x86, 0xef, 0xee,
      0x26, 0x99, 0x4d, 0x1,  0x0,  0xc,  0xe2, 0x3,  0xd7, 0x12, 0xa4, 0x85, 0x5f, 0x67, 0x8c, 0x90, 0x0,  0x6f, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfa, 0x4c, 0xef, 0xe9, 0x96, 0xb4, 0x79, 0xf6,
                                     0xae, 0x9c, 0x3a, 0x96, 0xf7, 0x52, 0x42};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x82, 0x2f, 0x15, 0x41, 0x7e, 0xd5, 0x18, 0x1e, 0xc5};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58, 0x4d, 0x77, 0x4f, 0xbc, 0x6a, 0xb4, 0xf2, 0x91, 0x44, 0x37,
                                     0x84, 0xc0, 0x65, 0xb7, 0x19, 0xa6, 0x24, 0xb7, 0x9e, 0x7c, 0x35};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7, 0xc8, 0x1b, 0x93, 0x42, 0xa0, 0x9d, 0xba, 0x11, 0x34, 0xf4, 0x2e,
                                     0x77, 0x23, 0xc4, 0xf6, 0xc8, 0xe2, 0xe6, 0x19, 0xb3, 0xb5, 0xf};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc,  0xd3, 0x55, 0xb8, 0x8f, 0xe7, 0xdd, 0x3,  0x6c, 0xb5,
                                     0x26, 0x5,  0xd6, 0x2a, 0x2e, 0x4f, 0x1d, 0xce, 0x62, 0xe,
                                     0x46, 0x78, 0xb,  0x84, 0x37, 0x9f, 0x97, 0x72, 0xee, 0x2c};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xdc, 0x4,  0x83, 0x30, 0x7b, 0x93, 0xa7, 0x62, 0x84, 0x23,
                                     0xf4, 0xbc, 0x1a, 0xd,  0x91, 0x10, 0x7f, 0x7a, 0x44, 0x85};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd3, 0xb1, 0xdf, 0x21, 0x88, 0x78, 0xf1, 0x2b,
                                     0x3f, 0x96, 0xf6, 0xc7, 0x56, 0x2b, 0x21};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x55, 0x30, 0xcc, 0xf2, 0x56, 0x4a, 0x61, 0x9a, 0x87, 0x79,
                                     0x70, 0x1f, 0x96, 0xd2, 0xd4, 0x78, 0x55, 0x4e, 0xac, 0x3d,
                                     0x22, 0xa1, 0x86, 0xef, 0xee, 0x26, 0x99, 0x4d};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe2, 0x3, 0xd7, 0x12, 0xa4, 0x85, 0x5f, 0x67, 0x8c, 0x90, 0x0, 0x6f};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12399, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23812 [("l\217\181\248\247R\218\132\148\US\247\151\130\255:P",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("B1X\194\172\224\"\188%\220\224\EM\208\234yj\214\&1I\202\199[\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("5)l@\241",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\169\t|)\195\169\b",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("<\146&\226\RS\169\182\&62\t;\r\171K\170\204 x\140\&9V\245K(\SUB\SOe>\144\252",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\167\157\EOT\218\v\192%\143\217\155\202\224\246\137",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("n\153\194\225\207\165\197\160\213\NAK\182",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x84, 0x1,  0x5d, 0x4,  0x0,  0x10, 0x6c, 0xd9, 0xb5, 0xf8, 0xf7, 0x52, 0xda, 0x84, 0x94, 0x1f,
                   0xf7, 0x97, 0x82, 0xff, 0x3a, 0x50, 0x0,  0x0,  0x17, 0x42, 0x31, 0x58, 0xc2, 0xac, 0xe0, 0x22, 0xbc,
                   0x25, 0xdc, 0xe0, 0x19, 0xd0, 0xea, 0x79, 0x6a, 0xd6, 0x31, 0x49, 0xca, 0xc7, 0x5b, 0x9b, 0x0,  0x0,
                   0x5,  0x35, 0x29, 0x6c, 0x40, 0xf1, 0x2,  0x0,  0x7,  0xa9, 0x9,  0x7c, 0x29, 0xc3, 0xa9, 0x8,  0x0,
                   0x0,  0x0,  0x0,  0x0,  0x1e, 0x3c, 0x92, 0x26, 0xe2, 0x1e, 0xa9, 0xb6, 0x36, 0x32, 0x9,  0x3b, 0xd,
                   0xab, 0x4b, 0xaa, 0xcc, 0x20, 0x78, 0x8c, 0x39, 0x56, 0xf5, 0x4b, 0x28, 0x1a, 0xe,  0x65, 0x3e, 0x90,
                   0xfc, 0x0,  0x0,  0xe,  0xa7, 0x9d, 0x4,  0xda, 0xb,  0xc0, 0x25, 0x8f, 0xd9, 0x9b, 0xca, 0xe0, 0xf6,
                   0x89, 0x1,  0x0,  0xb,  0x6e, 0x99, 0xc2, 0xe1, 0xcf, 0xa5, 0xc5, 0xa0, 0xd5, 0x15, 0xb6, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x6c, 0xd9, 0xb5, 0xf8, 0xf7, 0x52, 0xda, 0x84,
                                     0x94, 0x1f, 0xf7, 0x97, 0x82, 0xff, 0x3a, 0x50};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x42, 0x31, 0x58, 0xc2, 0xac, 0xe0, 0x22, 0xbc, 0x25, 0xdc, 0xe0, 0x19,
                                     0xd0, 0xea, 0x79, 0x6a, 0xd6, 0x31, 0x49, 0xca, 0xc7, 0x5b, 0x9b};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0x29, 0x6c, 0x40, 0xf1};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa9, 0x9, 0x7c, 0x29, 0xc3, 0xa9, 0x8};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3c, 0x92, 0x26, 0xe2, 0x1e, 0xa9, 0xb6, 0x36, 0x32, 0x9,
                                     0x3b, 0xd,  0xab, 0x4b, 0xaa, 0xcc, 0x20, 0x78, 0x8c, 0x39,
                                     0x56, 0xf5, 0x4b, 0x28, 0x1a, 0xe,  0x65, 0x3e, 0x90, 0xfc};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa7, 0x9d, 0x4, 0xda, 0xb, 0xc0, 0x25, 0x8f, 0xd9, 0x9b, 0xca, 0xe0, 0xf6, 0x89};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6e, 0x99, 0xc2, 0xe1, 0xcf, 0xa5, 0xc5, 0xa0, 0xd5, 0x15, 0xb6};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23812, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27610 [("\237%=A\255\167\&8",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0xf, 0x6b, 0xda, 0x0, 0x7, 0xed, 0x25, 0x3d, 0x41, 0xff, 0xa7, 0x38, 0x0, 0x0, 0x0, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x25, 0x3d, 0x41, 0xff, 0xa7, 0x38};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27610, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4069 [("k\212\217\191\167Z\148\215\216\238$0\DLE\138\137",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("f\DC3\GSt\DC4]e\t\EOTEx\208",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\148G\181",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("+\153\166\221\250\195|",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\DC2L\210Q\212\131\223\205\220\163\&3\141\245\165T\235c5\168\229",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DEL\129c\NAKgK\238]W\EM\132uT\138\249i",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\158\182*d\178\184#\243a\207]\196\141\233\DEL\165)\DC4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\183\ETB\154u\225\161A@_\SYN\251\185%\179y\180A\ESC\b\143\SO",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x8a, 0x1,  0xf,  0xe5, 0x0,  0xf,  0x6b, 0xd4, 0xd9, 0xbf, 0xa7, 0x5a, 0x94, 0xd7, 0xd8,
                   0xee, 0x24, 0x30, 0x10, 0x8a, 0x89, 0x2,  0x0,  0xc,  0x66, 0x13, 0x1d, 0x74, 0x14, 0x5d, 0x65,
                   0x9,  0x4,  0x45, 0x78, 0xd0, 0x0,  0x0,  0x3,  0x94, 0x47, 0xb5, 0x1,  0x0,  0x7,  0x2b, 0x99,
                   0xa6, 0xdd, 0xfa, 0xc3, 0x7c, 0x2,  0x0,  0x14, 0x12, 0x4c, 0xd2, 0x51, 0xd4, 0x83, 0xdf, 0xcd,
                   0xdc, 0xa3, 0x33, 0x8d, 0xf5, 0xa5, 0x54, 0xeb, 0x63, 0x35, 0xa8, 0xe5, 0x0,  0x0,  0x10, 0x7f,
                   0x81, 0x63, 0x15, 0x67, 0x4b, 0xee, 0x5d, 0x57, 0x19, 0x84, 0x75, 0x54, 0x8a, 0xf9, 0x69, 0x2,
                   0x0,  0x12, 0x9e, 0xb6, 0x2a, 0x64, 0xb2, 0xb8, 0x23, 0xf3, 0x61, 0xcf, 0x5d, 0xc4, 0x8d, 0xe9,
                   0x7f, 0xa5, 0x29, 0x14, 0x2,  0x0,  0x15, 0xb7, 0x17, 0x9a, 0x75, 0xe1, 0xa1, 0x41, 0x40, 0x5f,
                   0x16, 0xfb, 0xb9, 0x25, 0xb3, 0x79, 0xb4, 0x41, 0x1b, 0x8,  0x8f, 0xe,  0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0xd4, 0xd9, 0xbf, 0xa7, 0x5a, 0x94, 0xd7,
                                     0xd8, 0xee, 0x24, 0x30, 0x10, 0x8a, 0x89};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x66, 0x13, 0x1d, 0x74, 0x14, 0x5d, 0x65, 0x9, 0x4, 0x45, 0x78, 0xd0};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x94, 0x47, 0xb5};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0x99, 0xa6, 0xdd, 0xfa, 0xc3, 0x7c};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0x4c, 0xd2, 0x51, 0xd4, 0x83, 0xdf, 0xcd, 0xdc, 0xa3,
                                     0x33, 0x8d, 0xf5, 0xa5, 0x54, 0xeb, 0x63, 0x35, 0xa8, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7f, 0x81, 0x63, 0x15, 0x67, 0x4b, 0xee, 0x5d,
                                     0x57, 0x19, 0x84, 0x75, 0x54, 0x8a, 0xf9, 0x69};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x9e, 0xb6, 0x2a, 0x64, 0xb2, 0xb8, 0x23, 0xf3, 0x61,
                                     0xcf, 0x5d, 0xc4, 0x8d, 0xe9, 0x7f, 0xa5, 0x29, 0x14};
  lwmqtt_string_t topic_filter_s6 = {18, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb7, 0x17, 0x9a, 0x75, 0xe1, 0xa1, 0x41, 0x40, 0x5f, 0x16, 0xfb,
                                     0xb9, 0x25, 0xb3, 0x79, 0xb4, 0x41, 0x1b, 0x8,  0x8f, 0xe};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4069, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4140 [("q\r\152^#\158\&0\215\239\148E\179M",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\178\RS\139\147\GS\136\&8\163^",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("8Y\221d\ETX\244\192\148\163\158\187\243$.X\166\202\211\153\209\237\218\248",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("yb\183l\128\223\ENQ",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Q\140AB*\199\195j\143@\USo\199\190aA\198\245\248\172E",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\205,\SI\FS\230\197\161j<\221\143",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("b",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("x\229\&2",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x72, 0x10, 0x2c, 0x0,  0xd,  0x71, 0xd,  0x98, 0x5e, 0x23, 0x9e, 0x30, 0xd7, 0xef, 0x94, 0x45,
                   0xb3, 0x4d, 0x2,  0x0,  0x9,  0xb2, 0x1e, 0x8b, 0x93, 0x1d, 0x88, 0x38, 0xa3, 0x5e, 0x1,  0x0,  0x17,
                   0x38, 0x59, 0xdd, 0x64, 0x3,  0xf4, 0xc0, 0x94, 0xa3, 0x9e, 0xbb, 0xf3, 0x24, 0x2e, 0x58, 0xa6, 0xca,
                   0xd3, 0x99, 0xd1, 0xed, 0xda, 0xf8, 0x0,  0x0,  0x7,  0x79, 0x62, 0xb7, 0x6c, 0x80, 0xdf, 0x5,  0x1,
                   0x0,  0x15, 0x51, 0x8c, 0x41, 0x42, 0x2a, 0xc7, 0xc3, 0x6a, 0x8f, 0x40, 0x1f, 0x6f, 0xc7, 0xbe, 0x61,
                   0x41, 0xc6, 0xf5, 0xf8, 0xac, 0x45, 0x2,  0x0,  0xb,  0xcd, 0x2c, 0xf,  0x1c, 0xe6, 0xc5, 0xa1, 0x6a,
                   0x3c, 0xdd, 0x8f, 0x1,  0x0,  0x1,  0x62, 0x0,  0x0,  0x3,  0x78, 0xe5, 0x32, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0xd, 0x98, 0x5e, 0x23, 0x9e, 0x30, 0xd7, 0xef, 0x94, 0x45, 0xb3, 0x4d};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb2, 0x1e, 0x8b, 0x93, 0x1d, 0x88, 0x38, 0xa3, 0x5e};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x38, 0x59, 0xdd, 0x64, 0x3,  0xf4, 0xc0, 0x94, 0xa3, 0x9e, 0xbb, 0xf3,
                                     0x24, 0x2e, 0x58, 0xa6, 0xca, 0xd3, 0x99, 0xd1, 0xed, 0xda, 0xf8};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x79, 0x62, 0xb7, 0x6c, 0x80, 0xdf, 0x5};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x51, 0x8c, 0x41, 0x42, 0x2a, 0xc7, 0xc3, 0x6a, 0x8f, 0x40, 0x1f,
                                     0x6f, 0xc7, 0xbe, 0x61, 0x41, 0xc6, 0xf5, 0xf8, 0xac, 0x45};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xcd, 0x2c, 0xf, 0x1c, 0xe6, 0xc5, 0xa1, 0x6a, 0x3c, 0xdd, 0x8f};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x62};
  lwmqtt_string_t topic_filter_s6 = {1, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x78, 0xe5, 0x32};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1,
                               LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4140, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32171 [("\235\179\143\169o\140~\246\145>\228z*M/\153\204\US@%",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("/ti-C\SUB\US\190\&4\138",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS\205\155",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\161\159\232{t\166\134\176\251\137\135\166\212",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("hO\199\173\182",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("E\SI\143~\248\185\255\166X\245\253\209\171\231\220\133\210\226\SO",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0x5d, 0x7d, 0xab, 0x0,  0x14, 0xeb, 0xb3, 0x8f, 0xa9, 0x6f, 0x8c, 0x7e, 0xf6, 0x91, 0x3e,
                   0xe4, 0x7a, 0x2a, 0x4d, 0x2f, 0x99, 0xcc, 0x1f, 0x40, 0x25, 0x0,  0x0,  0xa,  0x2f, 0x74, 0x69,
                   0x2d, 0x43, 0x1a, 0x1f, 0xbe, 0x34, 0x8a, 0x0,  0x0,  0x3,  0x1d, 0xcd, 0x9b, 0x1,  0x0,  0x0,
                   0x1,  0x0,  0xd,  0xa1, 0x9f, 0xe8, 0x7b, 0x74, 0xa6, 0x86, 0xb0, 0xfb, 0x89, 0x87, 0xa6, 0xd4,
                   0x0,  0x0,  0x5,  0x68, 0x4f, 0xc7, 0xad, 0xb6, 0x0,  0x0,  0x13, 0x45, 0xf,  0x8f, 0x7e, 0xf8,
                   0xb9, 0xff, 0xa6, 0x58, 0xf5, 0xfd, 0xd1, 0xab, 0xe7, 0xdc, 0x85, 0xd2, 0xe2, 0xe,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xeb, 0xb3, 0x8f, 0xa9, 0x6f, 0x8c, 0x7e, 0xf6, 0x91, 0x3e,
                                     0xe4, 0x7a, 0x2a, 0x4d, 0x2f, 0x99, 0xcc, 0x1f, 0x40, 0x25};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2f, 0x74, 0x69, 0x2d, 0x43, 0x1a, 0x1f, 0xbe, 0x34, 0x8a};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1d, 0xcd, 0x9b};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa1, 0x9f, 0xe8, 0x7b, 0x74, 0xa6, 0x86, 0xb0, 0xfb, 0x89, 0x87, 0xa6, 0xd4};
  lwmqtt_string_t topic_filter_s4 = {13, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x68, 0x4f, 0xc7, 0xad, 0xb6};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x45, 0xf,  0x8f, 0x7e, 0xf8, 0xb9, 0xff, 0xa6, 0x58, 0xf5,
                                     0xfd, 0xd1, 0xab, 0xe7, 0xdc, 0x85, 0xd2, 0xe2, 0xe};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32171, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29078 [("\201\248\\\248\245\254b\200k\161O\234i|\156\CAN\154+$\r\DLEu\179\"_|S}",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("#\234t\173\SOH%\NUL\251\216}\164\226\144\198\195\234\174\FSJ\136\GS\239\130\227\136\NAK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("A\129\149O\210j]Y\247\205{\133\US\158\220U\204Gq\195\159\200kM\141\DLE\155\245\175",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\RST\234",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("h\USN\NUL\199Ix\174\RS\FS#\174",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x73, 0x71, 0x96, 0x0,  0x1c, 0xc9, 0xf8, 0x5c, 0xf8, 0xf5, 0xfe, 0x62, 0xc8, 0x6b, 0xa1, 0x4f,
                   0xea, 0x69, 0x7c, 0x9c, 0x18, 0x9a, 0x2b, 0x24, 0xd,  0x10, 0x75, 0xb3, 0x22, 0x5f, 0x7c, 0x53, 0x7d,
                   0x0,  0x0,  0x1a, 0x23, 0xea, 0x74, 0xad, 0x1,  0x25, 0x0,  0xfb, 0xd8, 0x7d, 0xa4, 0xe2, 0x90, 0xc6,
                   0xc3, 0xea, 0xae, 0x1c, 0x4a, 0x88, 0x1d, 0xef, 0x82, 0xe3, 0x88, 0x15, 0x1,  0x0,  0x1d, 0x41, 0x81,
                   0x95, 0x4f, 0xd2, 0x6a, 0x5d, 0x59, 0xf7, 0xcd, 0x7b, 0x85, 0x1f, 0x9e, 0xdc, 0x55, 0xcc, 0x47, 0x71,
                   0xc3, 0x9f, 0xc8, 0x6b, 0x4d, 0x8d, 0x10, 0x9b, 0xf5, 0xaf, 0x0,  0x0,  0x3,  0x1e, 0x54, 0xea, 0x2,
                   0x0,  0xc,  0x68, 0x1f, 0x4e, 0x0,  0xc7, 0x49, 0x78, 0xae, 0x1e, 0x1c, 0x23, 0xae, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xc9, 0xf8, 0x5c, 0xf8, 0xf5, 0xfe, 0x62, 0xc8, 0x6b, 0xa1,
                                     0x4f, 0xea, 0x69, 0x7c, 0x9c, 0x18, 0x9a, 0x2b, 0x24, 0xd,
                                     0x10, 0x75, 0xb3, 0x22, 0x5f, 0x7c, 0x53, 0x7d};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x23, 0xea, 0x74, 0xad, 0x1,  0x25, 0x0,  0xfb, 0xd8, 0x7d, 0xa4, 0xe2, 0x90,
                                     0xc6, 0xc3, 0xea, 0xae, 0x1c, 0x4a, 0x88, 0x1d, 0xef, 0x82, 0xe3, 0x88, 0x15};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x41, 0x81, 0x95, 0x4f, 0xd2, 0x6a, 0x5d, 0x59, 0xf7, 0xcd,
                                     0x7b, 0x85, 0x1f, 0x9e, 0xdc, 0x55, 0xcc, 0x47, 0x71, 0xc3,
                                     0x9f, 0xc8, 0x6b, 0x4d, 0x8d, 0x10, 0x9b, 0xf5, 0xaf};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1e, 0x54, 0xea};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x68, 0x1f, 0x4e, 0x0, 0xc7, 0x49, 0x78, 0xae, 0x1e, 0x1c, 0x23, 0xae};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29078, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 756 [("F\229~\a\235\170;\164\DC1\152",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\208fV\240",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("X\FS\146$\204\DLE\249b\249R\142P\254No\129",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\212\SUB\138(T\SYN-\252",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ETX\"\SUB\EM\ETB\133\248d\162\156\244\246",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("R\179\184\&9\148\238\184\166\149\"\208s&A\130\132s(\240\133\165\CAN\EMN",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\252\128\176
// \139\212\226\208",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\154\137px\248W\245mK\174\255)oi\SOH\235\145\SO\t\EOT\190\144`%N\219\225\189\179",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("}\193\237\&6\129\180b\DEL\136\247\147W\ETX\229!\156\ACK\226fs\144+\DEL#'\202",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\203\203\184\175b\208n\245r\221R;
// \147\ACK%e9\161\NAKG:-fE\172\128",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0xc7, 0x1,  0x2,  0xf4, 0x0,  0xa,  0x46, 0xe5, 0x7e, 0x7,  0xeb, 0xaa, 0x3b, 0xa4, 0x11, 0x98,
                   0x2,  0x0,  0x4,  0xd0, 0x66, 0x56, 0xf0, 0x0,  0x0,  0x10, 0x58, 0x1c, 0x92, 0x24, 0xcc, 0x10, 0xf9,
                   0x62, 0xf9, 0x52, 0x8e, 0x50, 0xfe, 0x4e, 0x6f, 0x81, 0x1,  0x0,  0x8,  0xd4, 0x1a, 0x8a, 0x28, 0x54,
                   0x16, 0x2d, 0xfc, 0x2,  0x0,  0xc,  0x3,  0x22, 0x1a, 0x19, 0x17, 0x85, 0xf8, 0x64, 0xa2, 0x9c, 0xf4,
                   0xf6, 0x2,  0x0,  0x18, 0x52, 0xb3, 0xb8, 0x39, 0x94, 0xee, 0xb8, 0xa6, 0x95, 0x22, 0xd0, 0x73, 0x26,
                   0x41, 0x82, 0x84, 0x73, 0x28, 0xf0, 0x85, 0xa5, 0x18, 0x19, 0x4e, 0x2,  0x0,  0x8,  0xfc, 0x80, 0xb0,
                   0x20, 0x8b, 0xd4, 0xe2, 0xd0, 0x1,  0x0,  0x0,  0x1,  0x0,  0x1d, 0x9a, 0x89, 0x70, 0x78, 0xf8, 0x57,
                   0xf5, 0x6d, 0x4b, 0xae, 0xff, 0x29, 0x6f, 0x69, 0x1,  0xeb, 0x91, 0xe,  0x9,  0x4,  0xbe, 0x90, 0x60,
                   0x25, 0x4e, 0xdb, 0xe1, 0xbd, 0xb3, 0x0,  0x0,  0x1a, 0x7d, 0xc1, 0xed, 0x36, 0x81, 0xb4, 0x62, 0x7f,
                   0x88, 0xf7, 0x93, 0x57, 0x3,  0xe5, 0x21, 0x9c, 0x6,  0xe2, 0x66, 0x73, 0x90, 0x2b, 0x7f, 0x23, 0x27,
                   0xca, 0x2,  0x0,  0x1b, 0xcb, 0xcb, 0xb8, 0xaf, 0x62, 0xd0, 0x6e, 0xf5, 0x72, 0xdd, 0x52, 0x3b, 0x20,
                   0x93, 0x6,  0x25, 0x65, 0x39, 0xa1, 0x15, 0x47, 0x3a, 0x2d, 0x66, 0x45, 0xac, 0x80, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x46, 0xe5, 0x7e, 0x7, 0xeb, 0xaa, 0x3b, 0xa4, 0x11, 0x98};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x66, 0x56, 0xf0};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x58, 0x1c, 0x92, 0x24, 0xcc, 0x10, 0xf9, 0x62,
                                     0xf9, 0x52, 0x8e, 0x50, 0xfe, 0x4e, 0x6f, 0x81};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd4, 0x1a, 0x8a, 0x28, 0x54, 0x16, 0x2d, 0xfc};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x3, 0x22, 0x1a, 0x19, 0x17, 0x85, 0xf8, 0x64, 0xa2, 0x9c, 0xf4, 0xf6};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x52, 0xb3, 0xb8, 0x39, 0x94, 0xee, 0xb8, 0xa6, 0x95, 0x22, 0xd0, 0x73,
                                     0x26, 0x41, 0x82, 0x84, 0x73, 0x28, 0xf0, 0x85, 0xa5, 0x18, 0x19, 0x4e};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfc, 0x80, 0xb0, 0x20, 0x8b, 0xd4, 0xe2, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {8, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0};
  lwmqtt_string_t topic_filter_s7 = {0, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x9a, 0x89, 0x70, 0x78, 0xf8, 0x57, 0xf5, 0x6d, 0x4b, 0xae,
                                     0xff, 0x29, 0x6f, 0x69, 0x1,  0xeb, 0x91, 0xe,  0x9,  0x4,
                                     0xbe, 0x90, 0x60, 0x25, 0x4e, 0xdb, 0xe1, 0xbd, 0xb3};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x7d, 0xc1, 0xed, 0x36, 0x81, 0xb4, 0x62, 0x7f, 0x88, 0xf7, 0x93, 0x57, 0x3,
                                     0xe5, 0x21, 0x9c, 0x6,  0xe2, 0x66, 0x73, 0x90, 0x2b, 0x7f, 0x23, 0x27, 0xca};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xcb, 0xcb, 0xb8, 0xaf, 0x62, 0xd0, 0x6e, 0xf5, 0x72,
                                      0xdd, 0x52, 0x3b, 0x20, 0x93, 0x6,  0x25, 0x65, 0x39,
                                      0xa1, 0x15, 0x47, 0x3a, 0x2d, 0x66, 0x45, 0xac, 0x80};
  lwmqtt_string_t topic_filter_s10 = {27, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 756, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16233 [("EBW",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("T\254+V h\152\170",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("3!",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\DC3n;\202\230\SUB\132\139\138\185;\174&\231+wf\251U\f\EMGS\207\&0v\246",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\v\207\&8\151z2J\146\DC2;\214\252\DC3\139\b\232\242\&5\190\231\229~^\172\238\SI:e\SUB",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("4\212\138\243\171\200\217@\238\210[E\146\241\SO\183\128",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x6e, 0x3f, 0x69, 0x0,  0x3,  0x45, 0x42, 0x57, 0x1,  0x0,  0x1,  0x6e, 0x0,  0x0,  0x8,
                   0x54, 0xfe, 0x2b, 0x56, 0x20, 0x68, 0x98, 0xaa, 0x1,  0x0,  0x2,  0x33, 0x21, 0x0,  0x0,  0x1b,
                   0x13, 0x6e, 0x3b, 0xca, 0xe6, 0x1a, 0x84, 0x8b, 0x8a, 0xb9, 0x3b, 0xae, 0x26, 0xe7, 0x2b, 0x77,
                   0x66, 0xfb, 0x55, 0xc,  0x19, 0x47, 0x53, 0xcf, 0x30, 0x76, 0xf6, 0x0,  0x0,  0x1d, 0xb,  0xcf,
                   0x38, 0x97, 0x7a, 0x32, 0x4a, 0x92, 0x12, 0x3b, 0xd6, 0xfc, 0x13, 0x8b, 0x8,  0xe8, 0xf2, 0x35,
                   0xbe, 0xe7, 0xe5, 0x7e, 0x5e, 0xac, 0xee, 0xf,  0x3a, 0x65, 0x1a, 0x2,  0x0,  0x11, 0x34, 0xd4,
                   0x8a, 0xf3, 0xab, 0xc8, 0xd9, 0x40, 0xee, 0xd2, 0x5b, 0x45, 0x92, 0xf1, 0xe,  0xb7, 0x80, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x45, 0x42, 0x57};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x54, 0xfe, 0x2b, 0x56, 0x20, 0x68, 0x98, 0xaa};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x33, 0x21};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x13, 0x6e, 0x3b, 0xca, 0xe6, 0x1a, 0x84, 0x8b, 0x8a, 0xb9, 0x3b, 0xae, 0x26, 0xe7,
                                     0x2b, 0x77, 0x66, 0xfb, 0x55, 0xc,  0x19, 0x47, 0x53, 0xcf, 0x30, 0x76, 0xf6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb,  0xcf, 0x38, 0x97, 0x7a, 0x32, 0x4a, 0x92, 0x12, 0x3b,
                                     0xd6, 0xfc, 0x13, 0x8b, 0x8,  0xe8, 0xf2, 0x35, 0xbe, 0xe7,
                                     0xe5, 0x7e, 0x5e, 0xac, 0xee, 0xf,  0x3a, 0x65, 0x1a};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x34, 0xd4, 0x8a, 0xf3, 0xab, 0xc8, 0xd9, 0x40, 0xee,
                                     0xd2, 0x5b, 0x45, 0x92, 0xf1, 0xe,  0xb7, 0x80};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 16233, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27988 [("\215:8'\163*\137K\190_\182*\204\144\ETX\186\242\234\173\138,f\158\190",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("P7\f\231T5\214\vP\216h\NUL\DC3\b\224\SI",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\132~\184",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\235\ESC\184\223^M\136\133\196\&6\247\CAN/M\231\201c\165j\230",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("1\153n\DC1\168\129\189\149\&7+F>\DC4d\249\172\130\DC4\ACK_\177*\237C\228\f\DC4\a<]",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\238E\134\179f\SOH\209\229\239w\165\242\181\DC4\182\139\180\ETX\178!1",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("k\222\133\254$\SYN\235\a\154\140U",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\254",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0x98, 0x1,  0x6d, 0x54, 0x0,  0x18, 0xd7, 0x3a, 0x38, 0x27, 0xa3, 0x2a, 0x89, 0x4b, 0xbe,
                   0x5f, 0xb6, 0x2a, 0xcc, 0x90, 0x3,  0xba, 0xf2, 0xea, 0xad, 0x8a, 0x2c, 0x66, 0x9e, 0xbe, 0x0,
                   0x0,  0x10, 0x50, 0x37, 0xc,  0xe7, 0x54, 0x35, 0xd6, 0xb,  0x50, 0xd8, 0x68, 0x0,  0x13, 0x8,
                   0xe0, 0xf,  0x0,  0x0,  0x3,  0x84, 0x7e, 0xb8, 0x0,  0x0,  0x14, 0xeb, 0x1b, 0xb8, 0xdf, 0x5e,
                   0x4d, 0x88, 0x85, 0xc4, 0x36, 0xf7, 0x18, 0x2f, 0x4d, 0xe7, 0xc9, 0x63, 0xa5, 0x6a, 0xe6, 0x1,
                   0x0,  0x1e, 0x31, 0x99, 0x6e, 0x11, 0xa8, 0x81, 0xbd, 0x95, 0x37, 0x2b, 0x46, 0x3e, 0x14, 0x64,
                   0xf9, 0xac, 0x82, 0x14, 0x6,  0x5f, 0xb1, 0x2a, 0xed, 0x43, 0xe4, 0xc,  0x14, 0x7,  0x3c, 0x5d,
                   0x1,  0x0,  0x15, 0xee, 0x45, 0x86, 0xb3, 0x66, 0x1,  0xd1, 0xe5, 0xef, 0x77, 0xa5, 0xf2, 0xb5,
                   0x14, 0xb6, 0x8b, 0xb4, 0x3,  0xb2, 0x21, 0x31, 0x1,  0x0,  0xb,  0x6b, 0xde, 0x85, 0xfe, 0x24,
                   0x16, 0xeb, 0x7,  0x9a, 0x8c, 0x55, 0x1,  0x0,  0x1,  0xfe, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xd7, 0x3a, 0x38, 0x27, 0xa3, 0x2a, 0x89, 0x4b, 0xbe, 0x5f, 0xb6, 0x2a,
                                     0xcc, 0x90, 0x3,  0xba, 0xf2, 0xea, 0xad, 0x8a, 0x2c, 0x66, 0x9e, 0xbe};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x50, 0x37, 0xc,  0xe7, 0x54, 0x35, 0xd6, 0xb,
                                     0x50, 0xd8, 0x68, 0x0,  0x13, 0x8,  0xe0, 0xf};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0x7e, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xeb, 0x1b, 0xb8, 0xdf, 0x5e, 0x4d, 0x88, 0x85, 0xc4, 0x36,
                                     0xf7, 0x18, 0x2f, 0x4d, 0xe7, 0xc9, 0x63, 0xa5, 0x6a, 0xe6};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x99, 0x6e, 0x11, 0xa8, 0x81, 0xbd, 0x95, 0x37, 0x2b,
                                     0x46, 0x3e, 0x14, 0x64, 0xf9, 0xac, 0x82, 0x14, 0x6,  0x5f,
                                     0xb1, 0x2a, 0xed, 0x43, 0xe4, 0xc,  0x14, 0x7,  0x3c, 0x5d};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xee, 0x45, 0x86, 0xb3, 0x66, 0x1,  0xd1, 0xe5, 0xef, 0x77, 0xa5,
                                     0xf2, 0xb5, 0x14, 0xb6, 0x8b, 0xb4, 0x3,  0xb2, 0x21, 0x31};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6b, 0xde, 0x85, 0xfe, 0x24, 0x16, 0xeb, 0x7, 0x9a, 0x8c, 0x55};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfe};
  lwmqtt_string_t topic_filter_s7 = {1, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27988, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19880 [("\163\224\DC4H\243\234r\170\191\212<\172Q\159\207\205\131=\189\132W",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DLE\190\ETXgAE\133z \251",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("4 ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\229\210&\235\147\255",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\GS{\223`IldKX@9",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\198W8*B\175+,@\234j\200\209\167\187",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\203#\222\STX\217\221[6\138\196[\189\236\190\187Q\225\143+]\183U\141lq\242\SI\253",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0x74, 0x4d, 0xa8, 0x0,  0x15, 0xa3, 0xe0, 0x14, 0x48, 0xf3, 0xea, 0x72, 0xaa, 0xbf, 0xd4, 0x3c,
                   0xac, 0x51, 0x9f, 0xcf, 0xcd, 0x83, 0x3d, 0xbd, 0x84, 0x57, 0x0,  0x0,  0xa,  0x10, 0xbe, 0x3,  0x67,
                   0x41, 0x45, 0x85, 0x7a, 0x20, 0xfb, 0x0,  0x0,  0x2,  0x34, 0x20, 0x2,  0x0,  0x6,  0xe5, 0xd2, 0x26,
                   0xeb, 0x93, 0xff, 0x0,  0x0,  0xb,  0x1d, 0x7b, 0xdf, 0x60, 0x49, 0x6c, 0x64, 0x4b, 0x58, 0x40, 0x39,
                   0x0,  0x0,  0xf,  0xc6, 0x57, 0x38, 0x2a, 0x42, 0xaf, 0x2b, 0x2c, 0x40, 0xea, 0x6a, 0xc8, 0xd1, 0xa7,
                   0xbb, 0x2,  0x0,  0x1c, 0xcb, 0x23, 0xde, 0x2,  0xd9, 0xdd, 0x5b, 0x36, 0x8a, 0xc4, 0x5b, 0xbd, 0xec,
                   0xbe, 0xbb, 0x51, 0xe1, 0x8f, 0x2b, 0x5d, 0xb7, 0x55, 0x8d, 0x6c, 0x71, 0xf2, 0xf,  0xfd, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xa3, 0xe0, 0x14, 0x48, 0xf3, 0xea, 0x72, 0xaa, 0xbf, 0xd4, 0x3c,
                                     0xac, 0x51, 0x9f, 0xcf, 0xcd, 0x83, 0x3d, 0xbd, 0x84, 0x57};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x10, 0xbe, 0x3, 0x67, 0x41, 0x45, 0x85, 0x7a, 0x20, 0xfb};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x34, 0x20};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe5, 0xd2, 0x26, 0xeb, 0x93, 0xff};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1d, 0x7b, 0xdf, 0x60, 0x49, 0x6c, 0x64, 0x4b, 0x58, 0x40, 0x39};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc6, 0x57, 0x38, 0x2a, 0x42, 0xaf, 0x2b, 0x2c,
                                     0x40, 0xea, 0x6a, 0xc8, 0xd1, 0xa7, 0xbb};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xcb, 0x23, 0xde, 0x2,  0xd9, 0xdd, 0x5b, 0x36, 0x8a, 0xc4,
                                     0x5b, 0xbd, 0xec, 0xbe, 0xbb, 0x51, 0xe1, 0x8f, 0x2b, 0x5d,
                                     0xb7, 0x55, 0x8d, 0x6c, 0x71, 0xf2, 0xf,  0xfd};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19880, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22493 [("\227\138\DC4\248mr\146&d\209\219",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0x10, 0x57, 0xdd, 0x0,  0xb,  0xe3, 0x8a, 0x14,
                   0xf8, 0x6d, 0x72, 0x92, 0x26, 0x64, 0xd1, 0xdb, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xe3, 0x8a, 0x14, 0xf8, 0x6d, 0x72, 0x92, 0x26, 0x64, 0xd1, 0xdb};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22493, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32664 [("\244\185\249\145\SUB\GS\167&\200\201\187E=\184\234\232",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("i\217U\176\198\245\226",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("[gE\131-\185\148\217\a\169\&5(\185\236?\187\171\208\130\242\SIdq\SO\USND",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("
// Y\246\139\\xj\202)\182v\166\bFEb\245H\130",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\160\&3\132\234x\252\200\NUL]\134",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\211\139\255*\EOT\232\243\147D\252\SI\215\&5F\SIF[\209\SUBw\195I\130",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0x7a, 0x7f, 0x98, 0x0,  0x10, 0xf4, 0xb9, 0xf9, 0x91, 0x1a, 0x1d, 0xa7, 0x26, 0xc8, 0xc9,
                   0xbb, 0x45, 0x3d, 0xb8, 0xea, 0xe8, 0x0,  0x0,  0x7,  0x69, 0xd9, 0x55, 0xb0, 0xc6, 0xf5, 0xe2,
                   0x0,  0x0,  0x1b, 0x5b, 0x67, 0x45, 0x83, 0x2d, 0xb9, 0x94, 0xd9, 0x7,  0xa9, 0x35, 0x28, 0xb9,
                   0xec, 0x3f, 0xbb, 0xab, 0xd0, 0x82, 0xf2, 0xf,  0x64, 0x71, 0xe,  0x1f, 0x4e, 0x44, 0x1,  0x0,
                   0x13, 0x20, 0x59, 0xf6, 0x8b, 0x5c, 0x78, 0x6a, 0xca, 0x29, 0xb6, 0x76, 0xa6, 0x8,  0x46, 0x45,
                   0x62, 0xf5, 0x48, 0x82, 0x2,  0x0,  0xa,  0xa0, 0x33, 0x84, 0xea, 0x78, 0xfc, 0xc8, 0x0,  0x5d,
                   0x86, 0x0,  0x0,  0x17, 0xd3, 0x8b, 0xff, 0x2a, 0x4,  0xe8, 0xf3, 0x93, 0x44, 0xfc, 0xf,  0xd7,
                   0x35, 0x46, 0xf,  0x46, 0x5b, 0xd1, 0x1a, 0x77, 0xc3, 0x49, 0x82, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0xb9, 0xf9, 0x91, 0x1a, 0x1d, 0xa7, 0x26,
                                     0xc8, 0xc9, 0xbb, 0x45, 0x3d, 0xb8, 0xea, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x69, 0xd9, 0x55, 0xb0, 0xc6, 0xf5, 0xe2};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5b, 0x67, 0x45, 0x83, 0x2d, 0xb9, 0x94, 0xd9, 0x7,  0xa9, 0x35, 0x28, 0xb9, 0xec,
                                     0x3f, 0xbb, 0xab, 0xd0, 0x82, 0xf2, 0xf,  0x64, 0x71, 0xe,  0x1f, 0x4e, 0x44};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x20, 0x59, 0xf6, 0x8b, 0x5c, 0x78, 0x6a, 0xca, 0x29, 0xb6,
                                     0x76, 0xa6, 0x8,  0x46, 0x45, 0x62, 0xf5, 0x48, 0x82};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0x33, 0x84, 0xea, 0x78, 0xfc, 0xc8, 0x0, 0x5d, 0x86};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd3, 0x8b, 0xff, 0x2a, 0x4,  0xe8, 0xf3, 0x93, 0x44, 0xfc, 0xf, 0xd7,
                                     0x35, 0x46, 0xf,  0x46, 0x5b, 0xd1, 0x1a, 0x77, 0xc3, 0x49, 0x82};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32664, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21953 [("\STX\245\160\232\SUB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),(",\r\215\243\217\137",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ENQ\196M\SYN\244\173\DC2\170\SO\STXb\USw+z\173U\f\130\&4V\199\173\142\160\165\153\201\166\&4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0x34, 0x55, 0xc1, 0x0,  0x5,  0x2,  0xf5, 0xa0, 0xe8, 0x1a, 0x2,  0x0,  0x6,
                   0x2c, 0xd,  0xd7, 0xf3, 0xd9, 0x89, 0x2,  0x0,  0x1e, 0x5,  0xc4, 0x4d, 0x16, 0xf4,
                   0xad, 0x12, 0xaa, 0xe,  0x2,  0x62, 0x1f, 0x77, 0x2b, 0x7a, 0xad, 0x55, 0xc,  0x82,
                   0x34, 0x56, 0xc7, 0xad, 0x8e, 0xa0, 0xa5, 0x99, 0xc9, 0xa6, 0x34, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x2, 0xf5, 0xa0, 0xe8, 0x1a};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2c, 0xd, 0xd7, 0xf3, 0xd9, 0x89};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5,  0xc4, 0x4d, 0x16, 0xf4, 0xad, 0x12, 0xaa, 0xe,  0x2,
                                     0x62, 0x1f, 0x77, 0x2b, 0x7a, 0xad, 0x55, 0xc,  0x82, 0x34,
                                     0x56, 0xc7, 0xad, 0x8e, 0xa0, 0xa5, 0x99, 0xc9, 0xa6, 0x34};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21953, 3, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20725 [("\128b\134\ACK",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("e\184\fN\150\215\RSt\rh\167\248\DC1\152\SOH\247\EOT\209\136i\165",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0x21, 0x50, 0xf5, 0x0,  0x4,  0x80, 0x62, 0x86, 0x6,  0x2,  0x0,
                   0x15, 0x65, 0xb8, 0xc,  0x4e, 0x96, 0xd7, 0x1e, 0x74, 0xd,  0x68, 0xa7,
                   0xf8, 0x11, 0x98, 0x1,  0xf7, 0x4,  0xd1, 0x88, 0x69, 0xa5, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x80, 0x62, 0x86, 0x6};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x65, 0xb8, 0xc,  0x4e, 0x96, 0xd7, 0x1e, 0x74, 0xd,  0x68, 0xa7,
                                     0xf8, 0x11, 0x98, 0x1,  0xf7, 0x4,  0xd1, 0x88, 0x69, 0xa5};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20725, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24375 [("Xx.\181I\175\249\174u\214\foC'\226e\196\233\RS\136\225[0\172-y\128",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\203Dra\249\DC2s\SOe\167\r}\158\ETX\128\141\242?5\203\239\147",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("Y\242H\243&V\212K2\185\&2sq\178\178c\194\230\214)\\\237\ETX\SO",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\rm3\DEL,+L\150\CAN|9j\159\255g\206\t\FS=\160\201\&1",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x6d, 0x5f, 0x37, 0x0,  0x1b, 0x58, 0x78, 0x2e, 0xb5, 0x49, 0xaf, 0xf9, 0xae, 0x75, 0xd6,
                   0xc,  0x6f, 0x43, 0x27, 0xe2, 0x65, 0xc4, 0xe9, 0x1e, 0x88, 0xe1, 0x5b, 0x30, 0xac, 0x2d, 0x79,
                   0x80, 0x2,  0x0,  0x16, 0xcb, 0x44, 0x72, 0x61, 0xf9, 0x12, 0x73, 0xe,  0x65, 0xa7, 0xd,  0x7d,
                   0x9e, 0x3,  0x80, 0x8d, 0xf2, 0x3f, 0x35, 0xcb, 0xef, 0x93, 0x0,  0x0,  0x18, 0x59, 0xf2, 0x48,
                   0xf3, 0x26, 0x56, 0xd4, 0x4b, 0x32, 0xb9, 0x32, 0x73, 0x71, 0xb2, 0xb2, 0x63, 0xc2, 0xe6, 0xd6,
                   0x29, 0x5c, 0xed, 0x3,  0xe,  0x2,  0x0,  0x16, 0xd,  0x6d, 0x33, 0x7f, 0x2c, 0x2b, 0x4c, 0x96,
                   0x18, 0x7c, 0x39, 0x6a, 0x9f, 0xff, 0x67, 0xce, 0x9,  0x1c, 0x3d, 0xa0, 0xc9, 0x31, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x58, 0x78, 0x2e, 0xb5, 0x49, 0xaf, 0xf9, 0xae, 0x75, 0xd6, 0xc,  0x6f, 0x43, 0x27,
                                     0xe2, 0x65, 0xc4, 0xe9, 0x1e, 0x88, 0xe1, 0x5b, 0x30, 0xac, 0x2d, 0x79, 0x80};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcb, 0x44, 0x72, 0x61, 0xf9, 0x12, 0x73, 0xe,  0x65, 0xa7, 0xd,
                                     0x7d, 0x9e, 0x3,  0x80, 0x8d, 0xf2, 0x3f, 0x35, 0xcb, 0xef, 0x93};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x59, 0xf2, 0x48, 0xf3, 0x26, 0x56, 0xd4, 0x4b, 0x32, 0xb9, 0x32, 0x73,
                                     0x71, 0xb2, 0xb2, 0x63, 0xc2, 0xe6, 0xd6, 0x29, 0x5c, 0xed, 0x3,  0xe};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd,  0x6d, 0x33, 0x7f, 0x2c, 0x2b, 0x4c, 0x96, 0x18, 0x7c, 0x39,
                                     0x6a, 0x9f, 0xff, 0x67, 0xce, 0x9,  0x1c, 0x3d, 0xa0, 0xc9, 0x31};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24375, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15182 [("jX\253\212\226>%\234\136\158",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("wv\141n\252k\ESC\242,\211jBIr\ESC\nN\254\RSG\227C\180/A\174\244\STX\228\222",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("WE\f\171+\DC1\ETB\v\EOT\DLE\176\tw_\SYN/\ETX",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\161AM\198\RS6\146w\219\173\244\245J>\201",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2}),("e\171N\STX\186ov\240\229\136D\\\234J\152e\217",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0x6a, 0x3b, 0x4e, 0x0,  0xa,  0x6a, 0x58, 0xfd, 0xd4, 0xe2, 0x3e, 0x25, 0xea, 0x88, 0x9e,
                   0x1,  0x0,  0x1e, 0x77, 0x76, 0x8d, 0x6e, 0xfc, 0x6b, 0x1b, 0xf2, 0x2c, 0xd3, 0x6a, 0x42, 0x49,
                   0x72, 0x1b, 0xa,  0x4e, 0xfe, 0x1e, 0x47, 0xe3, 0x43, 0xb4, 0x2f, 0x41, 0xae, 0xf4, 0x2,  0xe4,
                   0xde, 0x1,  0x0,  0x11, 0x57, 0x45, 0xc,  0xab, 0x2b, 0x11, 0x17, 0xb,  0x4,  0x10, 0xb0, 0x9,
                   0x77, 0x5f, 0x16, 0x2f, 0x3,  0x1,  0x0,  0xf,  0xa1, 0x41, 0x4d, 0xc6, 0x1e, 0x36, 0x92, 0x77,
                   0xdb, 0xad, 0xf4, 0xf5, 0x4a, 0x3e, 0xc9, 0x2,  0x0,  0x11, 0x65, 0xab, 0x4e, 0x2,  0xba, 0x6f,
                   0x76, 0xf0, 0xe5, 0x88, 0x44, 0x5c, 0xea, 0x4a, 0x98, 0x65, 0xd9, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x6a, 0x58, 0xfd, 0xd4, 0xe2, 0x3e, 0x25, 0xea, 0x88, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x77, 0x76, 0x8d, 0x6e, 0xfc, 0x6b, 0x1b, 0xf2, 0x2c, 0xd3,
                                     0x6a, 0x42, 0x49, 0x72, 0x1b, 0xa,  0x4e, 0xfe, 0x1e, 0x47,
                                     0xe3, 0x43, 0xb4, 0x2f, 0x41, 0xae, 0xf4, 0x2,  0xe4, 0xde};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x57, 0x45, 0xc, 0xab, 0x2b, 0x11, 0x17, 0xb, 0x4,
                                     0x10, 0xb0, 0x9, 0x77, 0x5f, 0x16, 0x2f, 0x3};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa1, 0x41, 0x4d, 0xc6, 0x1e, 0x36, 0x92, 0x77,
                                     0xdb, 0xad, 0xf4, 0xf5, 0x4a, 0x3e, 0xc9};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x65, 0xab, 0x4e, 0x2,  0xba, 0x6f, 0x76, 0xf0, 0xe5,
                                     0x88, 0x44, 0x5c, 0xea, 0x4a, 0x98, 0x65, 0xd9};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15182, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29268 [("\142",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS =
// QoS0}),("5\254\147\212\152\233@<\242\195\191\180#\\Sl\SI\249(\174P\136\239\"B\182\139\218",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\229\173x
// \159d\157\161F\133y\253\&4\185\191h\167\231\noU\SI/\158\193\239",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(";Q=\182\248\245\152C&\221k\173\153\ESC\151\156",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("Q\168tf\193i\245\US\ENQ\177nl\202/\177",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\177\139\193I\228b\DLEvi\211\r{\aRg",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\195E\216",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("l\151\230\r\129\b\184\193\176\178\162\197\&5\188/\SO\187",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),(" k\147",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0x99, 0x1,  0x72, 0x54, 0x0,  0x1,  0x8e, 0x0,  0x0,  0x1c, 0x35, 0xfe, 0x93, 0xd4, 0x98,
                   0xe9, 0x40, 0x3c, 0xf2, 0xc3, 0xbf, 0xb4, 0x23, 0x5c, 0x53, 0x6c, 0xf,  0xf9, 0x28, 0xae, 0x50,
                   0x88, 0xef, 0x22, 0x42, 0xb6, 0x8b, 0xda, 0x1,  0x0,  0x1a, 0xe5, 0xad, 0x78, 0x20, 0x9f, 0x64,
                   0x9d, 0xa1, 0x46, 0x85, 0x79, 0xfd, 0x34, 0xb9, 0xbf, 0x68, 0xa7, 0xe7, 0xa,  0x6f, 0x55, 0xf,
                   0x2f, 0x9e, 0xc1, 0xef, 0x0,  0x0,  0x10, 0x3b, 0x51, 0x3d, 0xb6, 0xf8, 0xf5, 0x98, 0x43, 0x26,
                   0xdd, 0x6b, 0xad, 0x99, 0x1b, 0x97, 0x9c, 0x2,  0x0,  0xf,  0x51, 0xa8, 0x74, 0x66, 0xc1, 0x69,
                   0xf5, 0x1f, 0x5,  0xb1, 0x6e, 0x6c, 0xca, 0x2f, 0xb1, 0x1,  0x0,  0xf,  0xb1, 0x8b, 0xc1, 0x49,
                   0xe4, 0x62, 0x10, 0x76, 0x69, 0xd3, 0xd,  0x7b, 0x7,  0x52, 0x67, 0x1,  0x0,  0x3,  0xc3, 0x45,
                   0xd8, 0x2,  0x0,  0x11, 0x6c, 0x97, 0xe6, 0xd,  0x81, 0x8,  0xb8, 0xc1, 0xb0, 0xb2, 0xa2, 0xc5,
                   0x35, 0xbc, 0x2f, 0xe,  0xbb, 0x0,  0x0,  0x3,  0x20, 0x6b, 0x93, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x8e};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x35, 0xfe, 0x93, 0xd4, 0x98, 0xe9, 0x40, 0x3c, 0xf2, 0xc3,
                                     0xbf, 0xb4, 0x23, 0x5c, 0x53, 0x6c, 0xf,  0xf9, 0x28, 0xae,
                                     0x50, 0x88, 0xef, 0x22, 0x42, 0xb6, 0x8b, 0xda};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0xad, 0x78, 0x20, 0x9f, 0x64, 0x9d, 0xa1, 0x46, 0x85, 0x79, 0xfd, 0x34,
                                     0xb9, 0xbf, 0x68, 0xa7, 0xe7, 0xa,  0x6f, 0x55, 0xf,  0x2f, 0x9e, 0xc1, 0xef};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3b, 0x51, 0x3d, 0xb6, 0xf8, 0xf5, 0x98, 0x43,
                                     0x26, 0xdd, 0x6b, 0xad, 0x99, 0x1b, 0x97, 0x9c};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x51, 0xa8, 0x74, 0x66, 0xc1, 0x69, 0xf5, 0x1f,
                                     0x5,  0xb1, 0x6e, 0x6c, 0xca, 0x2f, 0xb1};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb1, 0x8b, 0xc1, 0x49, 0xe4, 0x62, 0x10, 0x76,
                                     0x69, 0xd3, 0xd,  0x7b, 0x7,  0x52, 0x67};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc3, 0x45, 0xd8};
  lwmqtt_string_t topic_filter_s6 = {3, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6c, 0x97, 0xe6, 0xd,  0x81, 0x8,  0xb8, 0xc1, 0xb0,
                                     0xb2, 0xa2, 0xc5, 0x35, 0xbc, 0x2f, 0xe,  0xbb};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x20, 0x6b, 0x93};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1,
                               LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29268, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30528 [("Z7\246b'",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\248\161\240\135Q\130\198oV\RS\187~7'\DC2@\ACK~i\213csX\200kE\240",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\248\215\167X\a\184",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("W\139~\240\234\n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\226\223\ETXA\170{\FS\197RN\147X\161\ESC\SI\a\197\vB3\232\220\160{\136\242\&5\150\150",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\134\236\184\180A/4\206\134\176p\163\&6\NUL\RS$\US\200\CAN\DELU\156\224",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\ENQ\177",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\207\&1\134\149\169\137_\145\\\185,\187\242\226\135J>\203\203B\245\196\147\239\168\212\167\145\219",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",\176\197p\224M\\\200",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\155w\224D\180\218\161\221r@3\"\131\FS\184\204\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0xb8, 0x1,  0x77, 0x40, 0x0,  0x5,  0x5a, 0x37, 0xf6, 0x62, 0x27, 0x1,  0x0,  0x1b, 0xf8, 0xa1,
                   0xf0, 0x87, 0x51, 0x82, 0xc6, 0x6f, 0x56, 0x1e, 0xbb, 0x7e, 0x37, 0x27, 0x12, 0x40, 0x6,  0x7e, 0x69,
                   0xd5, 0x63, 0x73, 0x58, 0xc8, 0x6b, 0x45, 0xf0, 0x2,  0x0,  0x6,  0xf8, 0xd7, 0xa7, 0x58, 0x7,  0xb8,
                   0x1,  0x0,  0x6,  0x57, 0x8b, 0x7e, 0xf0, 0xea, 0xa,  0x2,  0x0,  0x1d, 0xe2, 0xdf, 0x3,  0x41, 0xaa,
                   0x7b, 0x1c, 0xc5, 0x52, 0x4e, 0x93, 0x58, 0xa1, 0x1b, 0xf,  0x7,  0xc5, 0xb,  0x42, 0x33, 0xe8, 0xdc,
                   0xa0, 0x7b, 0x88, 0xf2, 0x35, 0x96, 0x96, 0x2,  0x0,  0x17, 0x86, 0xec, 0xb8, 0xb4, 0x41, 0x2f, 0x34,
                   0xce, 0x86, 0xb0, 0x70, 0xa3, 0x36, 0x0,  0x1e, 0x24, 0x1f, 0xc8, 0x18, 0x7f, 0x55, 0x9c, 0xe0, 0x0,
                   0x0,  0x2,  0x5,  0xb1, 0x2,  0x0,  0x1d, 0xcf, 0x31, 0x86, 0x95, 0xa9, 0x89, 0x5f, 0x91, 0x5c, 0xb9,
                   0x2c, 0xbb, 0xf2, 0xe2, 0x87, 0x4a, 0x3e, 0xcb, 0xcb, 0x42, 0xf5, 0xc4, 0x93, 0xef, 0xa8, 0xd4, 0xa7,
                   0x91, 0xdb, 0x0,  0x0,  0x8,  0x2c, 0xb0, 0xc5, 0x70, 0xe0, 0x4d, 0x5c, 0xc8, 0x0,  0x0,  0x11, 0x9b,
                   0x77, 0xe0, 0x44, 0xb4, 0xda, 0xa1, 0xdd, 0x72, 0x40, 0x33, 0x22, 0x83, 0x1c, 0xb8, 0xcc, 0xa0, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x5a, 0x37, 0xf6, 0x62, 0x27};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf8, 0xa1, 0xf0, 0x87, 0x51, 0x82, 0xc6, 0x6f, 0x56, 0x1e, 0xbb, 0x7e, 0x37, 0x27,
                                     0x12, 0x40, 0x6,  0x7e, 0x69, 0xd5, 0x63, 0x73, 0x58, 0xc8, 0x6b, 0x45, 0xf0};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf8, 0xd7, 0xa7, 0x58, 0x7, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x57, 0x8b, 0x7e, 0xf0, 0xea, 0xa};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe2, 0xdf, 0x3,  0x41, 0xaa, 0x7b, 0x1c, 0xc5, 0x52, 0x4e,
                                     0x93, 0x58, 0xa1, 0x1b, 0xf,  0x7,  0xc5, 0xb,  0x42, 0x33,
                                     0xe8, 0xdc, 0xa0, 0x7b, 0x88, 0xf2, 0x35, 0x96, 0x96};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x86, 0xec, 0xb8, 0xb4, 0x41, 0x2f, 0x34, 0xce, 0x86, 0xb0, 0x70, 0xa3,
                                     0x36, 0x0,  0x1e, 0x24, 0x1f, 0xc8, 0x18, 0x7f, 0x55, 0x9c, 0xe0};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5, 0xb1};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xcf, 0x31, 0x86, 0x95, 0xa9, 0x89, 0x5f, 0x91, 0x5c, 0xb9,
                                     0x2c, 0xbb, 0xf2, 0xe2, 0x87, 0x4a, 0x3e, 0xcb, 0xcb, 0x42,
                                     0xf5, 0xc4, 0x93, 0xef, 0xa8, 0xd4, 0xa7, 0x91, 0xdb};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2c, 0xb0, 0xc5, 0x70, 0xe0, 0x4d, 0x5c, 0xc8};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x9b, 0x77, 0xe0, 0x44, 0xb4, 0xda, 0xa1, 0xdd, 0x72,
                                     0x40, 0x33, 0x22, 0x83, 0x1c, 0xb8, 0xcc, 0xa0};
  lwmqtt_string_t topic_filter_s9 = {17, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30528, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32298 [("\183B\236P\DC4\RS0\245>\186\t\170R\GS\ESC\SI\234\151\246\224",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x19, 0x7e, 0x2a, 0x0,  0x14, 0xb7, 0x42, 0xec, 0x50, 0x14, 0x1e, 0x30, 0xf5,
                   0x3e, 0xba, 0x9,  0xaa, 0x52, 0x1d, 0x1b, 0xf,  0xea, 0x97, 0xf6, 0xe0, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xb7, 0x42, 0xec, 0x50, 0x14, 0x1e, 0x30, 0xf5, 0x3e, 0xba,
                                     0x9,  0xaa, 0x52, 0x1d, 0x1b, 0xf,  0xea, 0x97, 0xf6, 0xe0};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32298, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22169 [("\185n'\131\192M\162\EOTR\199\DC3\248G\138\NULjj\129\249\191\177\183D\200WU",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\247j\216\229\244\&4\DLEvoHjH\NUL\236\161\&64",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\130O\195\&2/BI\149/\183\137\146\218\179\CAN\198\212\174\&3a\191\158\214K\209\173p@\130",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\182g\162\186\175\184\210\ACKc>I\183\153\SO\176\v\255\221\&0L_\231Z",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\149\178\207\218V\235\209\189K6\143\DC3",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x7c, 0x56, 0x99, 0x0,  0x1a, 0xb9, 0x6e, 0x27, 0x83, 0xc0, 0x4d, 0xa2, 0x4,  0x52, 0xc7,
                   0x13, 0xf8, 0x47, 0x8a, 0x0,  0x6a, 0x6a, 0x81, 0xf9, 0xbf, 0xb1, 0xb7, 0x44, 0xc8, 0x57, 0x55,
                   0x1,  0x0,  0x11, 0xf7, 0x6a, 0xd8, 0xe5, 0xf4, 0x34, 0x10, 0x76, 0x6f, 0x48, 0x6a, 0x48, 0x0,
                   0xec, 0xa1, 0x36, 0x34, 0x2,  0x0,  0x1d, 0x82, 0x4f, 0xc3, 0x32, 0x2f, 0x42, 0x49, 0x95, 0x2f,
                   0xb7, 0x89, 0x92, 0xda, 0xb3, 0x18, 0xc6, 0xd4, 0xae, 0x33, 0x61, 0xbf, 0x9e, 0xd6, 0x4b, 0xd1,
                   0xad, 0x70, 0x40, 0x82, 0x1,  0x0,  0x17, 0xb6, 0x67, 0xa2, 0xba, 0xaf, 0xb8, 0xd2, 0x6,  0x63,
                   0x3e, 0x49, 0xb7, 0x99, 0xe,  0xb0, 0xb,  0xff, 0xdd, 0x30, 0x4c, 0x5f, 0xe7, 0x5a, 0x2,  0x0,
                   0xc,  0x95, 0xb2, 0xcf, 0xda, 0x56, 0xeb, 0xd1, 0xbd, 0x4b, 0x36, 0x8f, 0x13, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xb9, 0x6e, 0x27, 0x83, 0xc0, 0x4d, 0xa2, 0x4,  0x52, 0xc7, 0x13, 0xf8, 0x47,
                                     0x8a, 0x0,  0x6a, 0x6a, 0x81, 0xf9, 0xbf, 0xb1, 0xb7, 0x44, 0xc8, 0x57, 0x55};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf7, 0x6a, 0xd8, 0xe5, 0xf4, 0x34, 0x10, 0x76, 0x6f,
                                     0x48, 0x6a, 0x48, 0x0,  0xec, 0xa1, 0x36, 0x34};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x82, 0x4f, 0xc3, 0x32, 0x2f, 0x42, 0x49, 0x95, 0x2f, 0xb7,
                                     0x89, 0x92, 0xda, 0xb3, 0x18, 0xc6, 0xd4, 0xae, 0x33, 0x61,
                                     0xbf, 0x9e, 0xd6, 0x4b, 0xd1, 0xad, 0x70, 0x40, 0x82};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0x67, 0xa2, 0xba, 0xaf, 0xb8, 0xd2, 0x6,  0x63, 0x3e, 0x49, 0xb7,
                                     0x99, 0xe,  0xb0, 0xb,  0xff, 0xdd, 0x30, 0x4c, 0x5f, 0xe7, 0x5a};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x95, 0xb2, 0xcf, 0xda, 0x56, 0xeb, 0xd1, 0xbd, 0x4b, 0x36, 0x8f, 0x13};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22169, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26097 [("v\164\210X\179\135t\206\&0\177\165^\196\160\166\NUL78m}\195Z\147.rbC\177s9",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\255q\244\v\147\250\213/\143\151\&8\168\&9",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("l\168W:Wa\253\147\225\RS\164\242-;r')",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DC15\NUL\236\249\231\210\141\246\n\ENQ\v\248\RS\USX\132\CAN\214\143w\202\139;]4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\231A\154h\ETX\223a\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0x6f, 0x65, 0xf1, 0x0,  0x1e, 0x76, 0xa4, 0xd2, 0x58, 0xb3, 0x87, 0x74, 0xce, 0x30, 0xb1, 0xa5,
                   0x5e, 0xc4, 0xa0, 0xa6, 0x0,  0x37, 0x38, 0x6d, 0x7d, 0xc3, 0x5a, 0x93, 0x2e, 0x72, 0x62, 0x43, 0xb1,
                   0x73, 0x39, 0x2,  0x0,  0xd,  0xff, 0x71, 0xf4, 0xb,  0x93, 0xfa, 0xd5, 0x2f, 0x8f, 0x97, 0x38, 0xa8,
                   0x39, 0x0,  0x0,  0x11, 0x6c, 0xa8, 0x57, 0x3a, 0x57, 0x61, 0xfd, 0x93, 0xe1, 0x1e, 0xa4, 0xf2, 0x2d,
                   0x3b, 0x72, 0x27, 0x29, 0x0,  0x0,  0x1a, 0x11, 0x35, 0x0,  0xec, 0xf9, 0xe7, 0xd2, 0x8d, 0xf6, 0xa,
                   0x5,  0xb,  0xf8, 0x1e, 0x1f, 0x58, 0x84, 0x18, 0xd6, 0x8f, 0x77, 0xca, 0x8b, 0x3b, 0x5d, 0x34, 0x0,
                   0x0,  0x8,  0xe7, 0x41, 0x9a, 0x68, 0x3,  0xdf, 0x61, 0xc5, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x76, 0xa4, 0xd2, 0x58, 0xb3, 0x87, 0x74, 0xce, 0x30, 0xb1,
                                     0xa5, 0x5e, 0xc4, 0xa0, 0xa6, 0x0,  0x37, 0x38, 0x6d, 0x7d,
                                     0xc3, 0x5a, 0x93, 0x2e, 0x72, 0x62, 0x43, 0xb1, 0x73, 0x39};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xff, 0x71, 0xf4, 0xb, 0x93, 0xfa, 0xd5, 0x2f, 0x8f, 0x97, 0x38, 0xa8, 0x39};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6c, 0xa8, 0x57, 0x3a, 0x57, 0x61, 0xfd, 0x93, 0xe1,
                                     0x1e, 0xa4, 0xf2, 0x2d, 0x3b, 0x72, 0x27, 0x29};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x11, 0x35, 0x0,  0xec, 0xf9, 0xe7, 0xd2, 0x8d, 0xf6, 0xa,  0x5,  0xb,  0xf8,
                                     0x1e, 0x1f, 0x58, 0x84, 0x18, 0xd6, 0x8f, 0x77, 0xca, 0x8b, 0x3b, 0x5d, 0x34};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe7, 0x41, 0x9a, 0x68, 0x3, 0xdf, 0x61, 0xc5};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26097, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25578 [("\151\169\n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("\129L\179D\b\\\136\147\&3\187\140\205\216\221\151\ENQ\149\128\155\211\210E\ENQ\240\&8q\203\180",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("F\219rm{\255\FS\161\228\207\147\157(\236.\DC1\150\EM$|\138p\253$u\SYN8\237\ENQ",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\196\SO\SI\252\189a\168*\239<\226M(\228'\183H\223\&9\165\220\ACK\229R\158\151\209n\151\248",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x68, 0x63, 0xea, 0x0,  0x3,  0x97, 0xa9, 0xa,  0x0,  0x0,  0x1c, 0x81, 0x4c, 0xb3, 0x44,
                   0x8,  0x5c, 0x88, 0x93, 0x33, 0xbb, 0x8c, 0xcd, 0xd8, 0xdd, 0x97, 0x5,  0x95, 0x80, 0x9b, 0xd3,
                   0xd2, 0x45, 0x5,  0xf0, 0x38, 0x71, 0xcb, 0xb4, 0x2,  0x0,  0x1d, 0x46, 0xdb, 0x72, 0x6d, 0x7b,
                   0xff, 0x1c, 0xa1, 0xe4, 0xcf, 0x93, 0x9d, 0x28, 0xec, 0x2e, 0x11, 0x96, 0x19, 0x24, 0x7c, 0x8a,
                   0x70, 0xfd, 0x24, 0x75, 0x16, 0x38, 0xed, 0x5,  0x0,  0x0,  0x1e, 0xc4, 0xe,  0xf,  0xfc, 0xbd,
                   0x61, 0xa8, 0x2a, 0xef, 0x3c, 0xe2, 0x4d, 0x28, 0xe4, 0x27, 0xb7, 0x48, 0xdf, 0x39, 0xa5, 0xdc,
                   0x6,  0xe5, 0x52, 0x9e, 0x97, 0xd1, 0x6e, 0x97, 0xf8, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x97, 0xa9, 0xa};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x81, 0x4c, 0xb3, 0x44, 0x8,  0x5c, 0x88, 0x93, 0x33, 0xbb,
                                     0x8c, 0xcd, 0xd8, 0xdd, 0x97, 0x5,  0x95, 0x80, 0x9b, 0xd3,
                                     0xd2, 0x45, 0x5,  0xf0, 0x38, 0x71, 0xcb, 0xb4};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x46, 0xdb, 0x72, 0x6d, 0x7b, 0xff, 0x1c, 0xa1, 0xe4, 0xcf,
                                     0x93, 0x9d, 0x28, 0xec, 0x2e, 0x11, 0x96, 0x19, 0x24, 0x7c,
                                     0x8a, 0x70, 0xfd, 0x24, 0x75, 0x16, 0x38, 0xed, 0x5};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc4, 0xe,  0xf,  0xfc, 0xbd, 0x61, 0xa8, 0x2a, 0xef, 0x3c,
                                     0xe2, 0x4d, 0x28, 0xe4, 0x27, 0xb7, 0x48, 0xdf, 0x39, 0xa5,
                                     0xdc, 0x6,  0xe5, 0x52, 0x9e, 0x97, 0xd1, 0x6e, 0x97, 0xf8};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25578, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14161 [("\242\138%q\US\GSY\176\129}=\247",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\STX\132g\171\169\132\132\181\237\223\182gx,",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("g\EMP\174+`\222\SUBP",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("b\255\135\184;\253\174\185R",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\236:H\144\155\245+7\DLE\145K>\160Hi\229",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x4d, 0x37, 0x51, 0x0,  0xc,  0xf2, 0x8a, 0x25, 0x71, 0x1f, 0x1d, 0x59, 0xb0, 0x81, 0x7d,
                   0x3d, 0xf7, 0x1,  0x0,  0xe,  0x2,  0x84, 0x67, 0xab, 0xa9, 0x84, 0x84, 0xb5, 0xed, 0xdf, 0xb6,
                   0x67, 0x78, 0x2c, 0x0,  0x0,  0x9,  0x67, 0x19, 0x50, 0xae, 0x2b, 0x60, 0xde, 0x1a, 0x50, 0x0,
                   0x0,  0x9,  0x62, 0xff, 0x87, 0xb8, 0x3b, 0xfd, 0xae, 0xb9, 0x52, 0x2,  0x0,  0x10, 0xec, 0x3a,
                   0x48, 0x90, 0x9b, 0xf5, 0x2b, 0x37, 0x10, 0x91, 0x4b, 0x3e, 0xa0, 0x48, 0x69, 0xe5, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xf2, 0x8a, 0x25, 0x71, 0x1f, 0x1d, 0x59, 0xb0, 0x81, 0x7d, 0x3d, 0xf7};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2, 0x84, 0x67, 0xab, 0xa9, 0x84, 0x84, 0xb5, 0xed, 0xdf, 0xb6, 0x67, 0x78, 0x2c};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x67, 0x19, 0x50, 0xae, 0x2b, 0x60, 0xde, 0x1a, 0x50};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x62, 0xff, 0x87, 0xb8, 0x3b, 0xfd, 0xae, 0xb9, 0x52};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xec, 0x3a, 0x48, 0x90, 0x9b, 0xf5, 0x2b, 0x37,
                                     0x10, 0x91, 0x4b, 0x3e, 0xa0, 0x48, 0x69, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14161, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3024 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\151\241\217",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("O\234$\nG\215\255\&2\ETB\153\&8\213\230\161zr\149C\SOH",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(".\ETB\199\SYN\173\&1M\183\r\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\RSe\157a\193\189\&8%\189\238lr\136\251\194l\\\219ii",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\n\222\134\168\193\203",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x4e, 0xb,  0xd0, 0x0,  0x0,  0x1,  0x0,  0x3,  0x97, 0xf1, 0xd9, 0x1,  0x0,  0x13, 0x4f,
                   0xea, 0x24, 0xa,  0x47, 0xd7, 0xff, 0x32, 0x17, 0x99, 0x38, 0xd5, 0xe6, 0xa1, 0x7a, 0x72, 0x95,
                   0x43, 0x1,  0x0,  0x0,  0xa,  0x2e, 0x17, 0xc7, 0x16, 0xad, 0x31, 0x4d, 0xb7, 0xd,  0xe8, 0x1,
                   0x0,  0x14, 0x1e, 0x65, 0x9d, 0x61, 0xc1, 0xbd, 0x38, 0x25, 0xbd, 0xee, 0x6c, 0x72, 0x88, 0xfb,
                   0xc2, 0x6c, 0x5c, 0xdb, 0x69, 0x69, 0x0,  0x0,  0x6,  0xa,  0xde, 0x86, 0xa8, 0xc1, 0xcb, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x97, 0xf1, 0xd9};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4f, 0xea, 0x24, 0xa,  0x47, 0xd7, 0xff, 0x32, 0x17, 0x99,
                                     0x38, 0xd5, 0xe6, 0xa1, 0x7a, 0x72, 0x95, 0x43, 0x1};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2e, 0x17, 0xc7, 0x16, 0xad, 0x31, 0x4d, 0xb7, 0xd, 0xe8};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1e, 0x65, 0x9d, 0x61, 0xc1, 0xbd, 0x38, 0x25, 0xbd, 0xee,
                                     0x6c, 0x72, 0x88, 0xfb, 0xc2, 0x6c, 0x5c, 0xdb, 0x69, 0x69};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa, 0xde, 0x86, 0xa8, 0xc1, 0xcb};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 3024, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9912 [("\204\190\NUL\161\131\ETB\243~\129\US,\199",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\DC1\203\202\209\&0T*Orh\223",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0x1f, 0x26, 0xb8, 0x0,  0xc,  0xcc, 0xbe, 0x0,  0xa1, 0x83, 0x17, 0xf3, 0x7e, 0x81, 0x1f, 0x2c,
                   0xc7, 0x2,  0x0,  0xb,  0x11, 0xcb, 0xca, 0xd1, 0x30, 0x54, 0x2a, 0x4f, 0x72, 0x68, 0xdf, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xcc, 0xbe, 0x0, 0xa1, 0x83, 0x17, 0xf3, 0x7e, 0x81, 0x1f, 0x2c, 0xc7};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x11, 0xcb, 0xca, 0xd1, 0x30, 0x54, 0x2a, 0x4f, 0x72, 0x68, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9912, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1301 [("\169n\168\166N\214\SUB\136\156\134\ETX\228",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\135#\130r\206\254\133s<\ACK\143\200\154\229\227\169\217\244'",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\fBj\fR\208\210\189\190\148\STX\164}\163\214\183[\143",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("k\172\154\253f\170\&7\CANjg\185\r\ESC\192\ENQQi}\209\SI",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\239\236Y\220\224\191\&6",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\SIw*X&\ty\181\188:}\219,}\247\219>\NAK\167\177j0\188\197L\232@EJ",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\ACK2c\237\191\199*",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\206Cz\139\148\189dN%",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\141=\196\133f1r\DELf#h\161,8\131",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0xa5, 0x1,  0x5,  0x15, 0x0,  0xc,  0xa9, 0x6e, 0xa8, 0xa6, 0x4e, 0xd6, 0x1a, 0x88, 0x9c, 0x86,
                   0x3,  0xe4, 0x2,  0x0,  0x13, 0x87, 0x23, 0x82, 0x72, 0xce, 0xfe, 0x85, 0x73, 0x3c, 0x6,  0x8f, 0xc8,
                   0x9a, 0xe5, 0xe3, 0xa9, 0xd9, 0xf4, 0x27, 0x2,  0x0,  0x12, 0xc,  0x42, 0x6a, 0xc,  0x52, 0xd0, 0xd2,
                   0xbd, 0xbe, 0x94, 0x2,  0xa4, 0x7d, 0xa3, 0xd6, 0xb7, 0x5b, 0x8f, 0x2,  0x0,  0x14, 0x6b, 0xac, 0x9a,
                   0xfd, 0x66, 0xaa, 0x37, 0x18, 0x6a, 0x67, 0xb9, 0xd,  0x1b, 0xc0, 0x5,  0x51, 0x69, 0x7d, 0xd1, 0xf,
                   0x0,  0x0,  0x7,  0xef, 0xec, 0x59, 0xdc, 0xe0, 0xbf, 0x36, 0x1,  0x0,  0x1d, 0xf,  0x77, 0x2a, 0x58,
                   0x26, 0x9,  0x79, 0xb5, 0xbc, 0x3a, 0x7d, 0xdb, 0x2c, 0x7d, 0xf7, 0xdb, 0x3e, 0x15, 0xa7, 0xb1, 0x6a,
                   0x30, 0xbc, 0xc5, 0x4c, 0xe8, 0x40, 0x45, 0x4a, 0x2,  0x0,  0x7,  0x6,  0x32, 0x63, 0xed, 0xbf, 0xc7,
                   0x2a, 0x1,  0x0,  0x9,  0xce, 0x43, 0x7a, 0x8b, 0x94, 0xbd, 0x64, 0x4e, 0x25, 0x2,  0x0,  0xf,  0x8d,
                   0x3d, 0xc4, 0x85, 0x66, 0x31, 0x72, 0x7f, 0x66, 0x23, 0x68, 0xa1, 0x2c, 0x38, 0x83, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xa9, 0x6e, 0xa8, 0xa6, 0x4e, 0xd6, 0x1a, 0x88, 0x9c, 0x86, 0x3, 0xe4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x87, 0x23, 0x82, 0x72, 0xce, 0xfe, 0x85, 0x73, 0x3c, 0x6,
                                     0x8f, 0xc8, 0x9a, 0xe5, 0xe3, 0xa9, 0xd9, 0xf4, 0x27};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc,  0x42, 0x6a, 0xc,  0x52, 0xd0, 0xd2, 0xbd, 0xbe,
                                     0x94, 0x2,  0xa4, 0x7d, 0xa3, 0xd6, 0xb7, 0x5b, 0x8f};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6b, 0xac, 0x9a, 0xfd, 0x66, 0xaa, 0x37, 0x18, 0x6a, 0x67,
                                     0xb9, 0xd,  0x1b, 0xc0, 0x5,  0x51, 0x69, 0x7d, 0xd1, 0xf};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xef, 0xec, 0x59, 0xdc, 0xe0, 0xbf, 0x36};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf,  0x77, 0x2a, 0x58, 0x26, 0x9,  0x79, 0xb5, 0xbc, 0x3a,
                                     0x7d, 0xdb, 0x2c, 0x7d, 0xf7, 0xdb, 0x3e, 0x15, 0xa7, 0xb1,
                                     0x6a, 0x30, 0xbc, 0xc5, 0x4c, 0xe8, 0x40, 0x45, 0x4a};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6, 0x32, 0x63, 0xed, 0xbf, 0xc7, 0x2a};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xce, 0x43, 0x7a, 0x8b, 0x94, 0xbd, 0x64, 0x4e, 0x25};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x8d, 0x3d, 0xc4, 0x85, 0x66, 0x31, 0x72, 0x7f,
                                     0x66, 0x23, 0x68, 0xa1, 0x2c, 0x38, 0x83};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1,
                               LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 1301, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8636 [("\145uzU$\EOTvLk\130\217\133\&5f:\185\180q\t\227B\204\209^",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\185\215\&3\186z",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("5\240\228\136\145<\174p",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1}),("\"\254g\248Z\ENQ\150\248I.\136:B\b\221BoA",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\155\131g\SOH\199\215Z\164\242\159",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("M\225pW\t\184D\fV\167\186\130\231o\189t\217\233\152\213I@\r\150\142c",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x6f, 0x21, 0xbc, 0x0,  0x18, 0x91, 0x75, 0x7a, 0x55, 0x24, 0x4,  0x76, 0x4c, 0x6b, 0x82, 0xd9,
                   0x85, 0x35, 0x66, 0x3a, 0xb9, 0xb4, 0x71, 0x9,  0xe3, 0x42, 0xcc, 0xd1, 0x5e, 0x1,  0x0,  0x5,  0xb9,
                   0xd7, 0x33, 0xba, 0x7a, 0x0,  0x0,  0x8,  0x35, 0xf0, 0xe4, 0x88, 0x91, 0x3c, 0xae, 0x70, 0x1,  0x0,
                   0x12, 0x22, 0xfe, 0x67, 0xf8, 0x5a, 0x5,  0x96, 0xf8, 0x49, 0x2e, 0x88, 0x3a, 0x42, 0x8,  0xdd, 0x42,
                   0x6f, 0x41, 0x2,  0x0,  0xa,  0x9b, 0x83, 0x67, 0x1,  0xc7, 0xd7, 0x5a, 0xa4, 0xf2, 0x9f, 0x2,  0x0,
                   0x1a, 0x4d, 0xe1, 0x70, 0x57, 0x9,  0xb8, 0x44, 0xc,  0x56, 0xa7, 0xba, 0x82, 0xe7, 0x6f, 0xbd, 0x74,
                   0xd9, 0xe9, 0x98, 0xd5, 0x49, 0x40, 0xd,  0x96, 0x8e, 0x63, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x91, 0x75, 0x7a, 0x55, 0x24, 0x4,  0x76, 0x4c, 0x6b, 0x82, 0xd9, 0x85,
                                     0x35, 0x66, 0x3a, 0xb9, 0xb4, 0x71, 0x9,  0xe3, 0x42, 0xcc, 0xd1, 0x5e};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb9, 0xd7, 0x33, 0xba, 0x7a};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0xf0, 0xe4, 0x88, 0x91, 0x3c, 0xae, 0x70};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x22, 0xfe, 0x67, 0xf8, 0x5a, 0x5,  0x96, 0xf8, 0x49,
                                     0x2e, 0x88, 0x3a, 0x42, 0x8,  0xdd, 0x42, 0x6f, 0x41};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9b, 0x83, 0x67, 0x1, 0xc7, 0xd7, 0x5a, 0xa4, 0xf2, 0x9f};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4d, 0xe1, 0x70, 0x57, 0x9,  0xb8, 0x44, 0xc,  0x56, 0xa7, 0xba, 0x82, 0xe7,
                                     0x6f, 0xbd, 0x74, 0xd9, 0xe9, 0x98, 0xd5, 0x49, 0x40, 0xd,  0x96, 0x8e, 0x63};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8636, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23343 [("\b\226\228",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),(",6p\US\ESC\233\166\168\SOb@\"\155\182\DEL\213\251\214/\233\209nSD\174Y\147\191",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("[1\251\168#\EOT\140\140\&0)\DC2\159\134\188aM\201\255y\207\149\DLE",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\189D\246\ETB\165\134\238\174\175E\220\240%\190\163\232>\190\rDH\156\&3\182\RS\240\&5w\200",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x60, 0x5b, 0x2f, 0x0,  0x3,  0x8,  0xe2, 0xe4, 0x0,  0x0,  0x1c, 0x2c, 0x36, 0x70, 0x1f, 0x1b,
                   0xe9, 0xa6, 0xa8, 0xe,  0x62, 0x40, 0x22, 0x9b, 0xb6, 0x7f, 0xd5, 0xfb, 0xd6, 0x2f, 0xe9, 0xd1, 0x6e,
                   0x53, 0x44, 0xae, 0x59, 0x93, 0xbf, 0x1,  0x0,  0x16, 0x5b, 0x31, 0xfb, 0xa8, 0x23, 0x4,  0x8c, 0x8c,
                   0x30, 0x29, 0x12, 0x9f, 0x86, 0xbc, 0x61, 0x4d, 0xc9, 0xff, 0x79, 0xcf, 0x95, 0x10, 0x0,  0x0,  0x1d,
                   0xbd, 0x44, 0xf6, 0x17, 0xa5, 0x86, 0xee, 0xae, 0xaf, 0x45, 0xdc, 0xf0, 0x25, 0xbe, 0xa3, 0xe8, 0x3e,
                   0xbe, 0xd,  0x44, 0x48, 0x9c, 0x33, 0xb6, 0x1e, 0xf0, 0x35, 0x77, 0xc8, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x8, 0xe2, 0xe4};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2c, 0x36, 0x70, 0x1f, 0x1b, 0xe9, 0xa6, 0xa8, 0xe,  0x62,
                                     0x40, 0x22, 0x9b, 0xb6, 0x7f, 0xd5, 0xfb, 0xd6, 0x2f, 0xe9,
                                     0xd1, 0x6e, 0x53, 0x44, 0xae, 0x59, 0x93, 0xbf};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5b, 0x31, 0xfb, 0xa8, 0x23, 0x4,  0x8c, 0x8c, 0x30, 0x29, 0x12,
                                     0x9f, 0x86, 0xbc, 0x61, 0x4d, 0xc9, 0xff, 0x79, 0xcf, 0x95, 0x10};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xbd, 0x44, 0xf6, 0x17, 0xa5, 0x86, 0xee, 0xae, 0xaf, 0x45,
                                     0xdc, 0xf0, 0x25, 0xbe, 0xa3, 0xe8, 0x3e, 0xbe, 0xd,  0x44,
                                     0x48, 0x9c, 0x33, 0xb6, 0x1e, 0xf0, 0x35, 0x77, 0xc8};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23343, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19824 [("\NUL\181VC\229\166\255j \b\FSg\134\253%\212u\175\246K)\203\142>\132\154`n",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("-e\131\&2\165",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("\229\164\170}\NUL6\248\\?V\138\161\245\251\178\192u$\205\204\GS\191",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\255\220\179G\GS\163\207k\"\197u@\218\v\133\aW\US\136\172j\231v",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("S\189\207H\v\DC4\186]k\202\252\ESC2\228w\158C|",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropTopicAliasMaximum
// 5452,PropSharedSubscriptionAvailable 38,PropRequestResponseInformation 189,PropReasonString
// "\DC4q@\188r\ACKd\244\FSv\150\151\245CV!W\SYN",PropUserProperty
// "\242\151S\226\243\214\235\219\158\ACK\ESC|\184$\157\200\240\131\234\235V\RS~\r" "~O",PropReceiveMaximum
// 19316,PropTopicAlias 17157,PropSubscriptionIdentifier 14,PropAuthenticationData
// "\178\137\153\217c\148^\EM\205\&4)4^'\rf\197\SO\248\&3hg",PropTopicAlias 1176,PropRetainAvailable
// 247,PropSessionExpiryInterval 23735,PropSubscriptionIdentifier 27,PropSharedSubscriptionAvailable
// 222,PropResponseInformation
// "\157\ACK+\159\156\197\ETBF9\232A\DC1\204\220\192\ENQ\141\146\131x",PropSharedSubscriptionAvailable
// 76,PropWildcardSubscriptionAvailable 43,PropResponseInformation "F",PropSessionExpiryInterval
// 15558,PropServerReference "0\DLE\162S\233\166\166\249\239",PropServerKeepAlive 17064,PropUserProperty "\232\STX8E
// Fo\249" "\195(\130?\220\196\249\229\GSSB\209\GS-\DC3X\210\202\&2w5-RG\224\248\a\146\181\&6",PropRetainAvailable
// 104,PropAuthenticationMethod "\183\165d\217\185\182\246\ETB"]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x82, 0xc8, 0x2,  0x4d, 0x70, 0xd5, 0x1,  0x22, 0x15, 0x4c, 0x2a, 0x26, 0x19, 0xbd, 0x1f, 0x0,  0x12, 0x14, 0x71,
      0x40, 0xbc, 0x72, 0x6,  0x64, 0xf4, 0x1c, 0x76, 0x96, 0x97, 0xf5, 0x43, 0x56, 0x21, 0x57, 0x16, 0x26, 0x0,  0x18,
      0xf2, 0x97, 0x53, 0xe2, 0xf3, 0xd6, 0xeb, 0xdb, 0x9e, 0x6,  0x1b, 0x7c, 0xb8, 0x24, 0x9d, 0xc8, 0xf0, 0x83, 0xea,
      0xeb, 0x56, 0x1e, 0x7e, 0xd,  0x0,  0x2,  0x7e, 0x4f, 0x21, 0x4b, 0x74, 0x23, 0x43, 0x5,  0xb,  0xe,  0x16, 0x0,
      0x16, 0xb2, 0x89, 0x99, 0xd9, 0x63, 0x94, 0x5e, 0x19, 0xcd, 0x34, 0x29, 0x34, 0x5e, 0x27, 0xd,  0x66, 0xc5, 0xe,
      0xf8, 0x33, 0x68, 0x67, 0x23, 0x4,  0x98, 0x25, 0xf7, 0x11, 0x0,  0x0,  0x5c, 0xb7, 0xb,  0x1b, 0x2a, 0xde, 0x1a,
      0x0,  0x14, 0x9d, 0x6,  0x2b, 0x9f, 0x9c, 0xc5, 0x17, 0x46, 0x39, 0xe8, 0x41, 0x11, 0xcc, 0xdc, 0xc0, 0x5,  0x8d,
      0x92, 0x83, 0x78, 0x2a, 0x4c, 0x28, 0x2b, 0x1a, 0x0,  0x1,  0x46, 0x11, 0x0,  0x0,  0x3c, 0xc6, 0x1c, 0x0,  0x9,
      0x30, 0x10, 0xa2, 0x53, 0xe9, 0xa6, 0xa6, 0xf9, 0xef, 0x13, 0x42, 0xa8, 0x26, 0x0,  0x8,  0xe8, 0x2,  0x38, 0x45,
      0x20, 0x46, 0x6f, 0xf9, 0x0,  0x1e, 0xc3, 0x28, 0x82, 0x3f, 0xdc, 0xc4, 0xf9, 0xe5, 0x1d, 0x53, 0x42, 0xd1, 0x1d,
      0x2d, 0x13, 0x58, 0xd2, 0xca, 0x32, 0x77, 0x35, 0x2d, 0x52, 0x47, 0xe0, 0xf8, 0x7,  0x92, 0xb5, 0x36, 0x25, 0x68,
      0x15, 0x0,  0x8,  0xb7, 0xa5, 0x64, 0xd9, 0xb9, 0xb6, 0xf6, 0x17, 0x0,  0x1c, 0x0,  0xb5, 0x56, 0x43, 0xe5, 0xa6,
      0xff, 0x6a, 0x20, 0x8,  0x1c, 0x67, 0x86, 0xfd, 0x25, 0xd4, 0x75, 0xaf, 0xf6, 0x4b, 0x29, 0xcb, 0x8e, 0x3e, 0x84,
      0x9a, 0x60, 0x6e, 0x2,  0x0,  0x5,  0x2d, 0x65, 0x83, 0x32, 0xa5, 0x0,  0x0,  0x16, 0xe5, 0xa4, 0xaa, 0x7d, 0x0,
      0x36, 0xf8, 0x5c, 0x3f, 0x56, 0x8a, 0xa1, 0xf5, 0xfb, 0xb2, 0xc0, 0x75, 0x24, 0xcd, 0xcc, 0x1d, 0xbf, 0x1,  0x0,
      0x17, 0xff, 0xdc, 0xb3, 0x47, 0x1d, 0xa3, 0xcf, 0x6b, 0x22, 0xc5, 0x75, 0x40, 0xda, 0xb,  0x85, 0x7,  0x57, 0x1f,
      0x88, 0xac, 0x6a, 0xe7, 0x76, 0x1,  0x0,  0x12, 0x53, 0xbd, 0xcf, 0x48, 0xb,  0x14, 0xba, 0x5d, 0x6b, 0xca, 0xfc,
      0x1b, 0x32, 0xe4, 0x77, 0x9e, 0x43, 0x7c, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x0,  0xb5, 0x56, 0x43, 0xe5, 0xa6, 0xff, 0x6a, 0x20, 0x8,
                                     0x1c, 0x67, 0x86, 0xfd, 0x25, 0xd4, 0x75, 0xaf, 0xf6, 0x4b,
                                     0x29, 0xcb, 0x8e, 0x3e, 0x84, 0x9a, 0x60, 0x6e};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d, 0x65, 0x83, 0x32, 0xa5};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0xa4, 0xaa, 0x7d, 0x0,  0x36, 0xf8, 0x5c, 0x3f, 0x56, 0x8a,
                                     0xa1, 0xf5, 0xfb, 0xb2, 0xc0, 0x75, 0x24, 0xcd, 0xcc, 0x1d, 0xbf};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xff, 0xdc, 0xb3, 0x47, 0x1d, 0xa3, 0xcf, 0x6b, 0x22, 0xc5, 0x75, 0x40,
                                     0xda, 0xb,  0x85, 0x7,  0x57, 0x1f, 0x88, 0xac, 0x6a, 0xe7, 0x76};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x53, 0xbd, 0xcf, 0x48, 0xb,  0x14, 0xba, 0x5d, 0x6b,
                                     0xca, 0xfc, 0x1b, 0x32, 0xe4, 0x77, 0x9e, 0x43, 0x7c};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x14, 0x71, 0x40, 0xbc, 0x72, 0x6,  0x64, 0xf4, 0x1c,
                           0x76, 0x96, 0x97, 0xf5, 0x43, 0x56, 0x21, 0x57, 0x16};
  uint8_t bytesprops2[] = {0x7e, 0x4f};
  uint8_t bytesprops1[] = {0xf2, 0x97, 0x53, 0xe2, 0xf3, 0xd6, 0xeb, 0xdb, 0x9e, 0x6,  0x1b, 0x7c,
                           0xb8, 0x24, 0x9d, 0xc8, 0xf0, 0x83, 0xea, 0xeb, 0x56, 0x1e, 0x7e, 0xd};
  uint8_t bytesprops3[] = {0xb2, 0x89, 0x99, 0xd9, 0x63, 0x94, 0x5e, 0x19, 0xcd, 0x34, 0x29,
                           0x34, 0x5e, 0x27, 0xd,  0x66, 0xc5, 0xe,  0xf8, 0x33, 0x68, 0x67};
  uint8_t bytesprops4[] = {0x9d, 0x6,  0x2b, 0x9f, 0x9c, 0xc5, 0x17, 0x46, 0x39, 0xe8,
                           0x41, 0x11, 0xcc, 0xdc, 0xc0, 0x5,  0x8d, 0x92, 0x83, 0x78};
  uint8_t bytesprops5[] = {0x46};
  uint8_t bytesprops6[] = {0x30, 0x10, 0xa2, 0x53, 0xe9, 0xa6, 0xa6, 0xf9, 0xef};
  uint8_t bytesprops8[] = {0xc3, 0x28, 0x82, 0x3f, 0xdc, 0xc4, 0xf9, 0xe5, 0x1d, 0x53, 0x42, 0xd1, 0x1d, 0x2d, 0x13,
                           0x58, 0xd2, 0xca, 0x32, 0x77, 0x35, 0x2d, 0x52, 0x47, 0xe0, 0xf8, 0x7,  0x92, 0xb5, 0x36};
  uint8_t bytesprops7[] = {0xe8, 0x2, 0x38, 0x45, 0x20, 0x46, 0x6f, 0xf9};
  uint8_t bytesprops9[] = {0xb7, 0xa5, 0x64, 0xd9, 0xb9, 0xb6, 0xf6, 0x17};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5452}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops1}, .v = {2, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19316}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17157}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1176}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23735}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 27}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15558}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17064}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops7}, .v = {30, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19824, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12399 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\250L\239\233\150\180y\246\174\156:\150\247RB",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\130/\NAKA~\213\CAN\RS\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("XMwO\188j\180\242\145D7\132\192e\183\EM\166$\183\158|5",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\167\200\ESC\147B\160\157\186\DC14\244.w#\196\246\200\226\230\EM\179\181\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\f\211U\184\143\231\221\ETXl\181&\ENQ\214*.O\GS\206b\SOFx\v\132\&7\159\151r\238,",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\220\EOT\131\&0{\147\167b\132#\244\188\SUB\r\145\DLE\DELzD\133",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\211\177\223!\136x\241+?\150\246\199V+!",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("U0\204\242VJa\154\135yp\US\150\210\212xUN\172=\"\161\134\239\238&\153M",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\226\ETX\215\DC2\164\133_g\140\144\NULo",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] [PropSubscriptionIdentifierAvailable 24,PropReasonString
// "\230(\209\254(K\bL\255\t",PropServerKeepAlive 13153,PropAuthenticationMethod
// "\188|\226\242\&7\139",PropWildcardSubscriptionAvailable 151,PropAssignedClientIdentifier
// "@c\151\tz!}\168\NAK\206\217U\213Y\162\ESC\134\DC4\226\178c*\133",PropResponseInformation
// "\188\209\172",PropRetainAvailable 82,PropMessageExpiryInterval 7345,PropRequestResponseInformation
// 217,PropMaximumQoS 33,PropResponseInformation "[\223A\248\238\249\139\SYN\245\134\192\219",PropReasonString
// "y\187\SYN\134\236\NULo\246\130us\134Y\151j\243]4h\188\207",PropWillDelayInterval 20738]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x82, 0xc3, 0x2,  0x30, 0x6f, 0x74, 0x29, 0x18, 0x1f, 0x0,  0xa,  0xe6, 0x28, 0xd1, 0xfe, 0x28, 0x4b, 0x8,  0x4c,
      0xff, 0x9,  0x13, 0x33, 0x61, 0x15, 0x0,  0x6,  0xbc, 0x7c, 0xe2, 0xf2, 0x37, 0x8b, 0x28, 0x97, 0x12, 0x0,  0x17,
      0x40, 0x63, 0x97, 0x9,  0x7a, 0x21, 0x7d, 0xa8, 0x15, 0xce, 0xd9, 0x55, 0xd5, 0x59, 0xa2, 0x1b, 0x86, 0x14, 0xe2,
      0xb2, 0x63, 0x2a, 0x85, 0x1a, 0x0,  0x3,  0xbc, 0xd1, 0xac, 0x25, 0x52, 0x2,  0x0,  0x0,  0x1c, 0xb1, 0x19, 0xd9,
      0x24, 0x21, 0x1a, 0x0,  0xc,  0x5b, 0xdf, 0x41, 0xf8, 0xee, 0xf9, 0x8b, 0x16, 0xf5, 0x86, 0xc0, 0xdb, 0x1f, 0x0,
      0x15, 0x79, 0xbb, 0x16, 0x86, 0xec, 0x0,  0x6f, 0xf6, 0x82, 0x75, 0x73, 0x86, 0x59, 0x97, 0x6a, 0xf3, 0x5d, 0x34,
      0x68, 0xbc, 0xcf, 0x18, 0x0,  0x0,  0x51, 0x2,  0x0,  0x0,  0x0,  0x0,  0xf,  0xfa, 0x4c, 0xef, 0xe9, 0x96, 0xb4,
      0x79, 0xf6, 0xae, 0x9c, 0x3a, 0x96, 0xf7, 0x52, 0x42, 0x1,  0x0,  0x9,  0x82, 0x2f, 0x15, 0x41, 0x7e, 0xd5, 0x18,
      0x1e, 0xc5, 0x0,  0x0,  0x16, 0x58, 0x4d, 0x77, 0x4f, 0xbc, 0x6a, 0xb4, 0xf2, 0x91, 0x44, 0x37, 0x84, 0xc0, 0x65,
      0xb7, 0x19, 0xa6, 0x24, 0xb7, 0x9e, 0x7c, 0x35, 0x0,  0x0,  0x17, 0xa7, 0xc8, 0x1b, 0x93, 0x42, 0xa0, 0x9d, 0xba,
      0x11, 0x34, 0xf4, 0x2e, 0x77, 0x23, 0xc4, 0xf6, 0xc8, 0xe2, 0xe6, 0x19, 0xb3, 0xb5, 0xf,  0x2,  0x0,  0x1e, 0xc,
      0xd3, 0x55, 0xb8, 0x8f, 0xe7, 0xdd, 0x3,  0x6c, 0xb5, 0x26, 0x5,  0xd6, 0x2a, 0x2e, 0x4f, 0x1d, 0xce, 0x62, 0xe,
      0x46, 0x78, 0xb,  0x84, 0x37, 0x9f, 0x97, 0x72, 0xee, 0x2c, 0x0,  0x0,  0x14, 0xdc, 0x4,  0x83, 0x30, 0x7b, 0x93,
      0xa7, 0x62, 0x84, 0x23, 0xf4, 0xbc, 0x1a, 0xd,  0x91, 0x10, 0x7f, 0x7a, 0x44, 0x85, 0x2,  0x0,  0xf,  0xd3, 0xb1,
      0xdf, 0x21, 0x88, 0x78, 0xf1, 0x2b, 0x3f, 0x96, 0xf6, 0xc7, 0x56, 0x2b, 0x21, 0x2,  0x0,  0x1c, 0x55, 0x30, 0xcc,
      0xf2, 0x56, 0x4a, 0x61, 0x9a, 0x87, 0x79, 0x70, 0x1f, 0x96, 0xd2, 0xd4, 0x78, 0x55, 0x4e, 0xac, 0x3d, 0x22, 0xa1,
      0x86, 0xef, 0xee, 0x26, 0x99, 0x4d, 0x1,  0x0,  0xc,  0xe2, 0x3,  0xd7, 0x12, 0xa4, 0x85, 0x5f, 0x67, 0x8c, 0x90,
      0x0,  0x6f, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfa, 0x4c, 0xef, 0xe9, 0x96, 0xb4, 0x79, 0xf6,
                                     0xae, 0x9c, 0x3a, 0x96, 0xf7, 0x52, 0x42};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x82, 0x2f, 0x15, 0x41, 0x7e, 0xd5, 0x18, 0x1e, 0xc5};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58, 0x4d, 0x77, 0x4f, 0xbc, 0x6a, 0xb4, 0xf2, 0x91, 0x44, 0x37,
                                     0x84, 0xc0, 0x65, 0xb7, 0x19, 0xa6, 0x24, 0xb7, 0x9e, 0x7c, 0x35};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7, 0xc8, 0x1b, 0x93, 0x42, 0xa0, 0x9d, 0xba, 0x11, 0x34, 0xf4, 0x2e,
                                     0x77, 0x23, 0xc4, 0xf6, 0xc8, 0xe2, 0xe6, 0x19, 0xb3, 0xb5, 0xf};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc,  0xd3, 0x55, 0xb8, 0x8f, 0xe7, 0xdd, 0x3,  0x6c, 0xb5,
                                     0x26, 0x5,  0xd6, 0x2a, 0x2e, 0x4f, 0x1d, 0xce, 0x62, 0xe,
                                     0x46, 0x78, 0xb,  0x84, 0x37, 0x9f, 0x97, 0x72, 0xee, 0x2c};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xdc, 0x4,  0x83, 0x30, 0x7b, 0x93, 0xa7, 0x62, 0x84, 0x23,
                                     0xf4, 0xbc, 0x1a, 0xd,  0x91, 0x10, 0x7f, 0x7a, 0x44, 0x85};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd3, 0xb1, 0xdf, 0x21, 0x88, 0x78, 0xf1, 0x2b,
                                     0x3f, 0x96, 0xf6, 0xc7, 0x56, 0x2b, 0x21};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x55, 0x30, 0xcc, 0xf2, 0x56, 0x4a, 0x61, 0x9a, 0x87, 0x79,
                                     0x70, 0x1f, 0x96, 0xd2, 0xd4, 0x78, 0x55, 0x4e, 0xac, 0x3d,
                                     0x22, 0xa1, 0x86, 0xef, 0xee, 0x26, 0x99, 0x4d};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe2, 0x3, 0xd7, 0x12, 0xa4, 0x85, 0x5f, 0x67, 0x8c, 0x90, 0x0, 0x6f};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xe6, 0x28, 0xd1, 0xfe, 0x28, 0x4b, 0x8, 0x4c, 0xff, 0x9};
  uint8_t bytesprops1[] = {0xbc, 0x7c, 0xe2, 0xf2, 0x37, 0x8b};
  uint8_t bytesprops2[] = {0x40, 0x63, 0x97, 0x9,  0x7a, 0x21, 0x7d, 0xa8, 0x15, 0xce, 0xd9, 0x55,
                           0xd5, 0x59, 0xa2, 0x1b, 0x86, 0x14, 0xe2, 0xb2, 0x63, 0x2a, 0x85};
  uint8_t bytesprops3[] = {0xbc, 0xd1, 0xac};
  uint8_t bytesprops4[] = {0x5b, 0xdf, 0x41, 0xf8, 0xee, 0xf9, 0x8b, 0x16, 0xf5, 0x86, 0xc0, 0xdb};
  uint8_t bytesprops5[] = {0x79, 0xbb, 0x16, 0x86, 0xec, 0x0,  0x6f, 0xf6, 0x82, 0x75, 0x73,
                           0x86, 0x59, 0x97, 0x6a, 0xf3, 0x5d, 0x34, 0x68, 0xbc, 0xcf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13153}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7345}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20738}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12399, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23812 [("l\217\181\248\247R\218\132\148\US\247\151\130\255:P",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("B1X\194\172\224\"\188%\220\224\EM\208\234yj\214\&1I\202\199[\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("5)l@\241",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\169\t|)\195\169\b",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("<\146&\226\RS\169\182\&62\t;\r\171K\170\204 x\140\&9V\245K(\SUB\SOe>\144\252",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\167\157\EOT\218\v\192%\143\217\155\202\224\246\137",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("n\153\194\225\207\165\197\160\213\NAK\182",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1})] [PropResponseTopic
// "\NULU\197U\159\205\ETB@\162u^Q\249\141\203\129h\180\226}",PropAuthenticationData
// "2\231\134)D\GSUy\134=u\a;w\193e\164\152*\173",PropCorrelationData
// ".\214m\158\230:\201\138\179\ACK\211UZ\173\r",PropAuthenticationData "h\163<\v\140\ETB`\195k",PropReceiveMaximum
// 162,PropRequestProblemInformation 210]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0xd6, 0x1,  0x5d, 0x4,  0x51, 0x8,  0x0,  0x14, 0x0,  0x55, 0xc5, 0x55, 0x9f, 0xcd, 0x17, 0x40,
                   0xa2, 0x75, 0x5e, 0x51, 0xf9, 0x8d, 0xcb, 0x81, 0x68, 0xb4, 0xe2, 0x7d, 0x16, 0x0,  0x14, 0x32, 0xe7,
                   0x86, 0x29, 0x44, 0x1d, 0x55, 0x79, 0x86, 0x3d, 0x75, 0x7,  0x3b, 0x77, 0xc1, 0x65, 0xa4, 0x98, 0x2a,
                   0xad, 0x9,  0x0,  0xf,  0x2e, 0xd6, 0x6d, 0x9e, 0xe6, 0x3a, 0xc9, 0x8a, 0xb3, 0x6,  0xd3, 0x55, 0x5a,
                   0xad, 0xd,  0x16, 0x0,  0x9,  0x68, 0xa3, 0x3c, 0xb,  0x8c, 0x17, 0x60, 0xc3, 0x6b, 0x21, 0x0,  0xa2,
                   0x17, 0xd2, 0x0,  0x10, 0x6c, 0xd9, 0xb5, 0xf8, 0xf7, 0x52, 0xda, 0x84, 0x94, 0x1f, 0xf7, 0x97, 0x82,
                   0xff, 0x3a, 0x50, 0x0,  0x0,  0x17, 0x42, 0x31, 0x58, 0xc2, 0xac, 0xe0, 0x22, 0xbc, 0x25, 0xdc, 0xe0,
                   0x19, 0xd0, 0xea, 0x79, 0x6a, 0xd6, 0x31, 0x49, 0xca, 0xc7, 0x5b, 0x9b, 0x0,  0x0,  0x5,  0x35, 0x29,
                   0x6c, 0x40, 0xf1, 0x2,  0x0,  0x7,  0xa9, 0x9,  0x7c, 0x29, 0xc3, 0xa9, 0x8,  0x0,  0x0,  0x0,  0x0,
                   0x0,  0x1e, 0x3c, 0x92, 0x26, 0xe2, 0x1e, 0xa9, 0xb6, 0x36, 0x32, 0x9,  0x3b, 0xd,  0xab, 0x4b, 0xaa,
                   0xcc, 0x20, 0x78, 0x8c, 0x39, 0x56, 0xf5, 0x4b, 0x28, 0x1a, 0xe,  0x65, 0x3e, 0x90, 0xfc, 0x0,  0x0,
                   0xe,  0xa7, 0x9d, 0x4,  0xda, 0xb,  0xc0, 0x25, 0x8f, 0xd9, 0x9b, 0xca, 0xe0, 0xf6, 0x89, 0x1,  0x0,
                   0xb,  0x6e, 0x99, 0xc2, 0xe1, 0xcf, 0xa5, 0xc5, 0xa0, 0xd5, 0x15, 0xb6, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x6c, 0xd9, 0xb5, 0xf8, 0xf7, 0x52, 0xda, 0x84,
                                     0x94, 0x1f, 0xf7, 0x97, 0x82, 0xff, 0x3a, 0x50};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x42, 0x31, 0x58, 0xc2, 0xac, 0xe0, 0x22, 0xbc, 0x25, 0xdc, 0xe0, 0x19,
                                     0xd0, 0xea, 0x79, 0x6a, 0xd6, 0x31, 0x49, 0xca, 0xc7, 0x5b, 0x9b};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0x29, 0x6c, 0x40, 0xf1};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa9, 0x9, 0x7c, 0x29, 0xc3, 0xa9, 0x8};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3c, 0x92, 0x26, 0xe2, 0x1e, 0xa9, 0xb6, 0x36, 0x32, 0x9,
                                     0x3b, 0xd,  0xab, 0x4b, 0xaa, 0xcc, 0x20, 0x78, 0x8c, 0x39,
                                     0x56, 0xf5, 0x4b, 0x28, 0x1a, 0xe,  0x65, 0x3e, 0x90, 0xfc};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa7, 0x9d, 0x4, 0xda, 0xb, 0xc0, 0x25, 0x8f, 0xd9, 0x9b, 0xca, 0xe0, 0xf6, 0x89};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6e, 0x99, 0xc2, 0xe1, 0xcf, 0xa5, 0xc5, 0xa0, 0xd5, 0x15, 0xb6};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x0,  0x55, 0xc5, 0x55, 0x9f, 0xcd, 0x17, 0x40, 0xa2, 0x75,
                           0x5e, 0x51, 0xf9, 0x8d, 0xcb, 0x81, 0x68, 0xb4, 0xe2, 0x7d};
  uint8_t bytesprops1[] = {0x32, 0xe7, 0x86, 0x29, 0x44, 0x1d, 0x55, 0x79, 0x86, 0x3d,
                           0x75, 0x7,  0x3b, 0x77, 0xc1, 0x65, 0xa4, 0x98, 0x2a, 0xad};
  uint8_t bytesprops2[] = {0x2e, 0xd6, 0x6d, 0x9e, 0xe6, 0x3a, 0xc9, 0x8a, 0xb3, 0x6, 0xd3, 0x55, 0x5a, 0xad, 0xd};
  uint8_t bytesprops3[] = {0x68, 0xa3, 0x3c, 0xb, 0x8c, 0x17, 0x60, 0xc3, 0x6b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 162}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 210}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23812, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27610 [("\237%=A\255\167\&8",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] [PropWillDelayInterval 15551,PropCorrelationData "",PropAuthenticationData
// "\134\SI)%\209\199\157u\176\vB\DLElV\164GC=\210",PropSharedSubscriptionAvailable 240,PropResponseTopic
// "\152C\212I\164)\165\208\&5\GSD\DLE\170\&6\192\139",PropAuthenticationMethod "p\139",PropContentType
// "^\195H\250\238\&1c\138",PropSharedSubscriptionAvailable 151,PropRetainAvailable 104,PropAuthenticationMethod
// "h\191\175/\174\245=\140\DC4",PropReceiveMaximum 20504,PropMaximumQoS 50,PropResponseTopic
// "<p\141=N\251\216\228\233\244\136\\\215\149r\240\147ai\213\189\222\248\172",PropMaximumPacketSize
// 27930,PropMaximumPacketSize 25219,PropMaximumQoS 51,PropMaximumPacketSize 15882]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x95, 0x1,  0x6b, 0xda, 0x84, 0x1,  0x18, 0x0,  0x0,  0x3c, 0xbf, 0x9,  0x0,  0x0,  0x16, 0x0,
                   0x13, 0x86, 0xf,  0x29, 0x25, 0xd1, 0xc7, 0x9d, 0x75, 0xb0, 0xb,  0x42, 0x10, 0x6c, 0x56, 0xa4, 0x47,
                   0x43, 0x3d, 0xd2, 0x2a, 0xf0, 0x8,  0x0,  0x10, 0x98, 0x43, 0xd4, 0x49, 0xa4, 0x29, 0xa5, 0xd0, 0x35,
                   0x1d, 0x44, 0x10, 0xaa, 0x36, 0xc0, 0x8b, 0x15, 0x0,  0x2,  0x70, 0x8b, 0x3,  0x0,  0x8,  0x5e, 0xc3,
                   0x48, 0xfa, 0xee, 0x31, 0x63, 0x8a, 0x2a, 0x97, 0x25, 0x68, 0x15, 0x0,  0x9,  0x68, 0xbf, 0xaf, 0x2f,
                   0xae, 0xf5, 0x3d, 0x8c, 0x14, 0x21, 0x50, 0x18, 0x24, 0x32, 0x8,  0x0,  0x18, 0x3c, 0x70, 0x8d, 0x3d,
                   0x4e, 0xfb, 0xd8, 0xe4, 0xe9, 0xf4, 0x88, 0x5c, 0xd7, 0x95, 0x72, 0xf0, 0x93, 0x61, 0x69, 0xd5, 0xbd,
                   0xde, 0xf8, 0xac, 0x27, 0x0,  0x0,  0x6d, 0x1a, 0x27, 0x0,  0x0,  0x62, 0x83, 0x24, 0x33, 0x27, 0x0,
                   0x0,  0x3e, 0xa,  0x0,  0x7,  0xed, 0x25, 0x3d, 0x41, 0xff, 0xa7, 0x38, 0x0,  0x0,  0x0,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x25, 0x3d, 0x41, 0xff, 0xa7, 0x38};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x86, 0xf,  0x29, 0x25, 0xd1, 0xc7, 0x9d, 0x75, 0xb0, 0xb,
                           0x42, 0x10, 0x6c, 0x56, 0xa4, 0x47, 0x43, 0x3d, 0xd2};
  uint8_t bytesprops2[] = {0x98, 0x43, 0xd4, 0x49, 0xa4, 0x29, 0xa5, 0xd0,
                           0x35, 0x1d, 0x44, 0x10, 0xaa, 0x36, 0xc0, 0x8b};
  uint8_t bytesprops3[] = {0x70, 0x8b};
  uint8_t bytesprops4[] = {0x5e, 0xc3, 0x48, 0xfa, 0xee, 0x31, 0x63, 0x8a};
  uint8_t bytesprops5[] = {0x68, 0xbf, 0xaf, 0x2f, 0xae, 0xf5, 0x3d, 0x8c, 0x14};
  uint8_t bytesprops6[] = {0x3c, 0x70, 0x8d, 0x3d, 0x4e, 0xfb, 0xd8, 0xe4, 0xe9, 0xf4, 0x88, 0x5c,
                           0xd7, 0x95, 0x72, 0xf0, 0x93, 0x61, 0x69, 0xd5, 0xbd, 0xde, 0xf8, 0xac};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15551}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20504}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27930}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25219}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15882}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27610, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4069 [("k\212\217\191\167Z\148\215\216\238$0\DLE\138\137",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("f\DC3\GSt\DC4]e\t\EOTEx\208",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\148G\181",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("+\153\166\221\250\195|",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\DC2L\210Q\212\131\223\205\220\163\&3\141\245\165T\235c5\168\229",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DEL\129c\NAKgK\238]W\EM\132uT\138\249i",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\158\182*d\178\184#\243a\207]\196\141\233\DEL\165)\DC4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\183\ETB\154u\225\161A@_\SYN\251\185%\179y\180A\ESC\b\143\SO",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropRequestResponseInformation 20,PropReasonString
// "\147\176\141\212\255\&2\160\148\162\144\&5\134H\180{$f\153\228\207",PropMessageExpiryInterval
// 3689,PropServerKeepAlive 28576,PropAuthenticationData
// "O]zr/k7\163\DC181\186\139\142\171;=\182\236\t\250\174\&7\255h\204",PropPayloadFormatIndicator
// 14,PropSharedSubscriptionAvailable 171,PropUserProperty
// "\176\252\NUL\139x\164|\129\195\STX\207\250\&6[\SYN\GS\151\250\200\248\130\250" "\128",PropResponseTopic
// "\224\253\187;}$|\207",PropSharedSubscriptionAvailable 66,PropSessionExpiryInterval 21633,PropResponseTopic
// "'\240*-E\DC1\199\180\206\165hN%",PropRetainAvailable 93,PropMaximumPacketSize 22481]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x82, 0x93, 0x2,  0xf,  0xe5, 0x87, 0x1,  0x19, 0x14, 0x1f, 0x0,  0x14, 0x93, 0xb0, 0x8d, 0xd4, 0xff, 0x32, 0xa0,
      0x94, 0xa2, 0x90, 0x35, 0x86, 0x48, 0xb4, 0x7b, 0x24, 0x66, 0x99, 0xe4, 0xcf, 0x2,  0x0,  0x0,  0xe,  0x69, 0x13,
      0x6f, 0xa0, 0x16, 0x0,  0x1a, 0x4f, 0x5d, 0x7a, 0x72, 0x2f, 0x6b, 0x37, 0xa3, 0x11, 0x38, 0x31, 0xba, 0x8b, 0x8e,
      0xab, 0x3b, 0x3d, 0xb6, 0xec, 0x9,  0xfa, 0xae, 0x37, 0xff, 0x68, 0xcc, 0x1,  0xe,  0x2a, 0xab, 0x26, 0x0,  0x16,
      0xb0, 0xfc, 0x0,  0x8b, 0x78, 0xa4, 0x7c, 0x81, 0xc3, 0x2,  0xcf, 0xfa, 0x36, 0x5b, 0x16, 0x1d, 0x97, 0xfa, 0xc8,
      0xf8, 0x82, 0xfa, 0x0,  0x1,  0x80, 0x8,  0x0,  0x8,  0xe0, 0xfd, 0xbb, 0x3b, 0x7d, 0x24, 0x7c, 0xcf, 0x2a, 0x42,
      0x11, 0x0,  0x0,  0x54, 0x81, 0x8,  0x0,  0xd,  0x27, 0xf0, 0x2a, 0x2d, 0x45, 0x11, 0xc7, 0xb4, 0xce, 0xa5, 0x68,
      0x4e, 0x25, 0x25, 0x5d, 0x27, 0x0,  0x0,  0x57, 0xd1, 0x0,  0xf,  0x6b, 0xd4, 0xd9, 0xbf, 0xa7, 0x5a, 0x94, 0xd7,
      0xd8, 0xee, 0x24, 0x30, 0x10, 0x8a, 0x89, 0x2,  0x0,  0xc,  0x66, 0x13, 0x1d, 0x74, 0x14, 0x5d, 0x65, 0x9,  0x4,
      0x45, 0x78, 0xd0, 0x0,  0x0,  0x3,  0x94, 0x47, 0xb5, 0x1,  0x0,  0x7,  0x2b, 0x99, 0xa6, 0xdd, 0xfa, 0xc3, 0x7c,
      0x2,  0x0,  0x14, 0x12, 0x4c, 0xd2, 0x51, 0xd4, 0x83, 0xdf, 0xcd, 0xdc, 0xa3, 0x33, 0x8d, 0xf5, 0xa5, 0x54, 0xeb,
      0x63, 0x35, 0xa8, 0xe5, 0x0,  0x0,  0x10, 0x7f, 0x81, 0x63, 0x15, 0x67, 0x4b, 0xee, 0x5d, 0x57, 0x19, 0x84, 0x75,
      0x54, 0x8a, 0xf9, 0x69, 0x2,  0x0,  0x12, 0x9e, 0xb6, 0x2a, 0x64, 0xb2, 0xb8, 0x23, 0xf3, 0x61, 0xcf, 0x5d, 0xc4,
      0x8d, 0xe9, 0x7f, 0xa5, 0x29, 0x14, 0x2,  0x0,  0x15, 0xb7, 0x17, 0x9a, 0x75, 0xe1, 0xa1, 0x41, 0x40, 0x5f, 0x16,
      0xfb, 0xb9, 0x25, 0xb3, 0x79, 0xb4, 0x41, 0x1b, 0x8,  0x8f, 0xe,  0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0xd4, 0xd9, 0xbf, 0xa7, 0x5a, 0x94, 0xd7,
                                     0xd8, 0xee, 0x24, 0x30, 0x10, 0x8a, 0x89};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x66, 0x13, 0x1d, 0x74, 0x14, 0x5d, 0x65, 0x9, 0x4, 0x45, 0x78, 0xd0};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x94, 0x47, 0xb5};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0x99, 0xa6, 0xdd, 0xfa, 0xc3, 0x7c};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0x4c, 0xd2, 0x51, 0xd4, 0x83, 0xdf, 0xcd, 0xdc, 0xa3,
                                     0x33, 0x8d, 0xf5, 0xa5, 0x54, 0xeb, 0x63, 0x35, 0xa8, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7f, 0x81, 0x63, 0x15, 0x67, 0x4b, 0xee, 0x5d,
                                     0x57, 0x19, 0x84, 0x75, 0x54, 0x8a, 0xf9, 0x69};
  lwmqtt_string_t topic_filter_s5 = {16, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x9e, 0xb6, 0x2a, 0x64, 0xb2, 0xb8, 0x23, 0xf3, 0x61,
                                     0xcf, 0x5d, 0xc4, 0x8d, 0xe9, 0x7f, 0xa5, 0x29, 0x14};
  lwmqtt_string_t topic_filter_s6 = {18, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb7, 0x17, 0x9a, 0x75, 0xe1, 0xa1, 0x41, 0x40, 0x5f, 0x16, 0xfb,
                                     0xb9, 0x25, 0xb3, 0x79, 0xb4, 0x41, 0x1b, 0x8,  0x8f, 0xe};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x93, 0xb0, 0x8d, 0xd4, 0xff, 0x32, 0xa0, 0x94, 0xa2, 0x90,
                           0x35, 0x86, 0x48, 0xb4, 0x7b, 0x24, 0x66, 0x99, 0xe4, 0xcf};
  uint8_t bytesprops1[] = {0x4f, 0x5d, 0x7a, 0x72, 0x2f, 0x6b, 0x37, 0xa3, 0x11, 0x38, 0x31, 0xba, 0x8b,
                           0x8e, 0xab, 0x3b, 0x3d, 0xb6, 0xec, 0x9,  0xfa, 0xae, 0x37, 0xff, 0x68, 0xcc};
  uint8_t bytesprops3[] = {0x80};
  uint8_t bytesprops2[] = {0xb0, 0xfc, 0x0,  0x8b, 0x78, 0xa4, 0x7c, 0x81, 0xc3, 0x2,  0xcf,
                           0xfa, 0x36, 0x5b, 0x16, 0x1d, 0x97, 0xfa, 0xc8, 0xf8, 0x82, 0xfa};
  uint8_t bytesprops4[] = {0xe0, 0xfd, 0xbb, 0x3b, 0x7d, 0x24, 0x7c, 0xcf};
  uint8_t bytesprops5[] = {0x27, 0xf0, 0x2a, 0x2d, 0x45, 0x11, 0xc7, 0xb4, 0xce, 0xa5, 0x68, 0x4e, 0x25};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3689}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28576}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops2}, .v = {1, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21633}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22481}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4069, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4140 [("q\r\152^#\158\&0\215\239\148E\179M",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\178\RS\139\147\GS\136\&8\163^",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("8Y\221d\ETX\244\192\148\163\158\187\243$.X\166\202\211\153\209\237\218\248",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("yb\183l\128\223\ENQ",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Q\140AB*\199\195j\143@\USo\199\190aA\198\245\248\172E",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\205,\SI\FS\230\197\161j<\221\143",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("b",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("x\229\&2",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1})] [PropSubscriptionIdentifierAvailable 232,PropSubscriptionIdentifier
// 24,PropWildcardSubscriptionAvailable 16,PropAuthenticationMethod "g\RS\216",PropServerReference
// "=\174\&2p\191\188\v\253\243\177@\181;\134\190\DC4\FS\206\200\ESC$\162\197\174",PropTopicAliasMaximum
// 24986,PropReasonString "\225\&4\133\139Z\140\FS\248[/\133\150\ESC\NUL\193M\178\FSr\207\190\ESCP,
// \232:",PropAuthenticationData
// ".\"\142I>\SIa\219s<?VH\209\158\EM\239\149\164\ETXU\249\246\213sw",PropAssignedClientIdentifier
// "\222\254P\186f#J\152\174}=\202\228\t\224{\168\160t",PropPayloadFormatIndicator 142,PropResponseInformation
// ".\bR\235\190\189~|\245E\129\152\173SHwak\189\NULq\r\CAN\140",PropSharedSubscriptionAvailable
// 46,PropMaximumPacketSize 29781,PropWillDelayInterval 4559,PropRequestProblemInformation 97,PropResponseTopic
// "K|H\205\165\ETX\a\199`\161\227\255",PropWildcardSubscriptionAvailable 29,PropSharedSubscriptionAvailable
// 192,PropTopicAliasMaximum 27338,PropRequestResponseInformation 25,PropSessionExpiryInterval 870,PropTopicAlias
// 16841,PropWildcardSubscriptionAvailable 229,PropReceiveMaximum 3658,PropAssignedClientIdentifier
// "0lN",PropAuthenticationData "\159\136\206\140\219\221\137\219\206\162\133\EMf_",PropRequestResponseInformation
// 40,PropCorrelationData "\212\145\241\166C\213\180",PropAuthenticationMethod
// "\240\237\SI\231\149\ACKgM\131\156\250e]\161,\159\DC2\146\247Oem\145\250\176",PropResponseInformation
// "\145n\DLE\208[\142\221<\205\249l\140\ACK\235\157\134MS\216\196Z6\130\178\171\146\191\187\v"]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x82, 0x9e, 0x3,  0x10, 0x2c, 0xaa, 0x2,  0x29, 0xe8, 0xb,  0x18, 0x28, 0x10, 0x15, 0x0,  0x3,  0x67, 0x1e, 0xd8,
      0x1c, 0x0,  0x18, 0x3d, 0xae, 0x32, 0x70, 0xbf, 0xbc, 0xb,  0xfd, 0xf3, 0xb1, 0x40, 0xb5, 0x3b, 0x86, 0xbe, 0x14,
      0x1c, 0xce, 0xc8, 0x1b, 0x24, 0xa2, 0xc5, 0xae, 0x22, 0x61, 0x9a, 0x1f, 0x0,  0x1b, 0xe1, 0x34, 0x85, 0x8b, 0x5a,
      0x8c, 0x1c, 0xf8, 0x5b, 0x2f, 0x85, 0x96, 0x1b, 0x0,  0xc1, 0x4d, 0xb2, 0x1c, 0x72, 0xcf, 0xbe, 0x1b, 0x50, 0x2c,
      0x20, 0xe8, 0x3a, 0x16, 0x0,  0x1a, 0x2e, 0x22, 0x8e, 0x49, 0x3e, 0xf,  0x61, 0xdb, 0x73, 0x3c, 0x3f, 0x56, 0x48,
      0xd1, 0x9e, 0x19, 0xef, 0x95, 0xa4, 0x3,  0x55, 0xf9, 0xf6, 0xd5, 0x73, 0x77, 0x12, 0x0,  0x13, 0xde, 0xfe, 0x50,
      0xba, 0x66, 0x23, 0x4a, 0x98, 0xae, 0x7d, 0x3d, 0xca, 0xe4, 0x9,  0xe0, 0x7b, 0xa8, 0xa0, 0x74, 0x1,  0x8e, 0x1a,
      0x0,  0x18, 0x2e, 0x8,  0x52, 0xeb, 0xbe, 0xbd, 0x7e, 0x7c, 0xf5, 0x45, 0x81, 0x98, 0xad, 0x53, 0x48, 0x77, 0x61,
      0x6b, 0xbd, 0x0,  0x71, 0xd,  0x18, 0x8c, 0x2a, 0x2e, 0x27, 0x0,  0x0,  0x74, 0x55, 0x18, 0x0,  0x0,  0x11, 0xcf,
      0x17, 0x61, 0x8,  0x0,  0xc,  0x4b, 0x7c, 0x48, 0xcd, 0xa5, 0x3,  0x7,  0xc7, 0x60, 0xa1, 0xe3, 0xff, 0x28, 0x1d,
      0x2a, 0xc0, 0x22, 0x6a, 0xca, 0x19, 0x19, 0x11, 0x0,  0x0,  0x3,  0x66, 0x23, 0x41, 0xc9, 0x28, 0xe5, 0x21, 0xe,
      0x4a, 0x12, 0x0,  0x3,  0x30, 0x6c, 0x4e, 0x16, 0x0,  0xe,  0x9f, 0x88, 0xce, 0x8c, 0xdb, 0xdd, 0x89, 0xdb, 0xce,
      0xa2, 0x85, 0x19, 0x66, 0x5f, 0x19, 0x28, 0x9,  0x0,  0x7,  0xd4, 0x91, 0xf1, 0xa6, 0x43, 0xd5, 0xb4, 0x15, 0x0,
      0x19, 0xf0, 0xed, 0xf,  0xe7, 0x95, 0x6,  0x67, 0x4d, 0x83, 0x9c, 0xfa, 0x65, 0x5d, 0xa1, 0x2c, 0x9f, 0x12, 0x92,
      0xf7, 0x4f, 0x65, 0x6d, 0x91, 0xfa, 0xb0, 0x1a, 0x0,  0x1d, 0x91, 0x6e, 0x10, 0xd0, 0x5b, 0x8e, 0xdd, 0x3c, 0xcd,
      0xf9, 0x6c, 0x8c, 0x6,  0xeb, 0x9d, 0x86, 0x4d, 0x53, 0xd8, 0xc4, 0x5a, 0x36, 0x82, 0xb2, 0xab, 0x92, 0xbf, 0xbb,
      0xb,  0x0,  0xd,  0x71, 0xd,  0x98, 0x5e, 0x23, 0x9e, 0x30, 0xd7, 0xef, 0x94, 0x45, 0xb3, 0x4d, 0x2,  0x0,  0x9,
      0xb2, 0x1e, 0x8b, 0x93, 0x1d, 0x88, 0x38, 0xa3, 0x5e, 0x1,  0x0,  0x17, 0x38, 0x59, 0xdd, 0x64, 0x3,  0xf4, 0xc0,
      0x94, 0xa3, 0x9e, 0xbb, 0xf3, 0x24, 0x2e, 0x58, 0xa6, 0xca, 0xd3, 0x99, 0xd1, 0xed, 0xda, 0xf8, 0x0,  0x0,  0x7,
      0x79, 0x62, 0xb7, 0x6c, 0x80, 0xdf, 0x5,  0x1,  0x0,  0x15, 0x51, 0x8c, 0x41, 0x42, 0x2a, 0xc7, 0xc3, 0x6a, 0x8f,
      0x40, 0x1f, 0x6f, 0xc7, 0xbe, 0x61, 0x41, 0xc6, 0xf5, 0xf8, 0xac, 0x45, 0x2,  0x0,  0xb,  0xcd, 0x2c, 0xf,  0x1c,
      0xe6, 0xc5, 0xa1, 0x6a, 0x3c, 0xdd, 0x8f, 0x1,  0x0,  0x1,  0x62, 0x0,  0x0,  0x3,  0x78, 0xe5, 0x32, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0xd, 0x98, 0x5e, 0x23, 0x9e, 0x30, 0xd7, 0xef, 0x94, 0x45, 0xb3, 0x4d};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb2, 0x1e, 0x8b, 0x93, 0x1d, 0x88, 0x38, 0xa3, 0x5e};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x38, 0x59, 0xdd, 0x64, 0x3,  0xf4, 0xc0, 0x94, 0xa3, 0x9e, 0xbb, 0xf3,
                                     0x24, 0x2e, 0x58, 0xa6, 0xca, 0xd3, 0x99, 0xd1, 0xed, 0xda, 0xf8};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x79, 0x62, 0xb7, 0x6c, 0x80, 0xdf, 0x5};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x51, 0x8c, 0x41, 0x42, 0x2a, 0xc7, 0xc3, 0x6a, 0x8f, 0x40, 0x1f,
                                     0x6f, 0xc7, 0xbe, 0x61, 0x41, 0xc6, 0xf5, 0xf8, 0xac, 0x45};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xcd, 0x2c, 0xf, 0x1c, 0xe6, 0xc5, 0xa1, 0x6a, 0x3c, 0xdd, 0x8f};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x62};
  lwmqtt_string_t topic_filter_s6 = {1, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x78, 0xe5, 0x32};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1,
                               LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x67, 0x1e, 0xd8};
  uint8_t bytesprops1[] = {0x3d, 0xae, 0x32, 0x70, 0xbf, 0xbc, 0xb,  0xfd, 0xf3, 0xb1, 0x40, 0xb5,
                           0x3b, 0x86, 0xbe, 0x14, 0x1c, 0xce, 0xc8, 0x1b, 0x24, 0xa2, 0xc5, 0xae};
  uint8_t bytesprops2[] = {0xe1, 0x34, 0x85, 0x8b, 0x5a, 0x8c, 0x1c, 0xf8, 0x5b, 0x2f, 0x85, 0x96, 0x1b, 0x0,
                           0xc1, 0x4d, 0xb2, 0x1c, 0x72, 0xcf, 0xbe, 0x1b, 0x50, 0x2c, 0x20, 0xe8, 0x3a};
  uint8_t bytesprops3[] = {0x2e, 0x22, 0x8e, 0x49, 0x3e, 0xf,  0x61, 0xdb, 0x73, 0x3c, 0x3f, 0x56, 0x48,
                           0xd1, 0x9e, 0x19, 0xef, 0x95, 0xa4, 0x3,  0x55, 0xf9, 0xf6, 0xd5, 0x73, 0x77};
  uint8_t bytesprops4[] = {0xde, 0xfe, 0x50, 0xba, 0x66, 0x23, 0x4a, 0x98, 0xae, 0x7d,
                           0x3d, 0xca, 0xe4, 0x9,  0xe0, 0x7b, 0xa8, 0xa0, 0x74};
  uint8_t bytesprops5[] = {0x2e, 0x8,  0x52, 0xeb, 0xbe, 0xbd, 0x7e, 0x7c, 0xf5, 0x45, 0x81, 0x98,
                           0xad, 0x53, 0x48, 0x77, 0x61, 0x6b, 0xbd, 0x0,  0x71, 0xd,  0x18, 0x8c};
  uint8_t bytesprops6[] = {0x4b, 0x7c, 0x48, 0xcd, 0xa5, 0x3, 0x7, 0xc7, 0x60, 0xa1, 0xe3, 0xff};
  uint8_t bytesprops7[] = {0x30, 0x6c, 0x4e};
  uint8_t bytesprops8[] = {0x9f, 0x88, 0xce, 0x8c, 0xdb, 0xdd, 0x89, 0xdb, 0xce, 0xa2, 0x85, 0x19, 0x66, 0x5f};
  uint8_t bytesprops9[] = {0xd4, 0x91, 0xf1, 0xa6, 0x43, 0xd5, 0xb4};
  uint8_t bytesprops10[] = {0xf0, 0xed, 0xf,  0xe7, 0x95, 0x6,  0x67, 0x4d, 0x83, 0x9c, 0xfa, 0x65, 0x5d,
                            0xa1, 0x2c, 0x9f, 0x12, 0x92, 0xf7, 0x4f, 0x65, 0x6d, 0x91, 0xfa, 0xb0};
  uint8_t bytesprops11[] = {0x91, 0x6e, 0x10, 0xd0, 0x5b, 0x8e, 0xdd, 0x3c, 0xcd, 0xf9, 0x6c, 0x8c, 0x6,  0xeb, 0x9d,
                            0x86, 0x4d, 0x53, 0xd8, 0xc4, 0x5a, 0x36, 0x82, 0xb2, 0xab, 0x92, 0xbf, 0xbb, 0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24986}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29781}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4559}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27338}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 870}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16841}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3658}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4140, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32171 [("\235\179\143\169o\140~\246\145>\228z*M/\153\204\US@%",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("/ti-C\SUB\US\190\&4\138",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS\205\155",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\161\159\232{t\166\134\176\251\137\135\166\212",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("hO\199\173\182",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("E\SI\143~\248\185\255\166X\245\253\209\171\231\220\133\210\226\SO",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropSubscriptionIdentifier
// 24,PropCorrelationData "\196u\174\162\192\EOTP\194\232\221\ESCwC",PropTopicAlias 6660,PropSharedSubscriptionAvailable
// 18,PropReceiveMaximum 21591,PropMessageExpiryInterval 27385,PropAssignedClientIdentifier
// "*\172\236\193\DC1D\216p\205\ESCq\135\132\184\194\237",PropServerKeepAlive 24724,PropMaximumQoS 145,PropUserProperty
// "\223\&1>3\135\205" "<`R%\DC3\161\DC2\129R\141f\193d\202`\ACK",PropCorrelationData
// "\250^\241m\149\"\241V\168*f\CANC\183\212\165",PropRequestResponseInformation 39,PropReasonString
// "\156\130Z\174\131\252gT\241\SYNf\t\159o\128\144\US-r\193\184\223\152\ENQ"]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xe1, 0x1,  0x7d, 0xab, 0x82, 0x1,  0xb,  0x18, 0x9,  0x0,  0xd,  0xc4, 0x75, 0xae, 0xa2, 0xc0, 0x4,  0x50,
      0xc2, 0xe8, 0xdd, 0x1b, 0x77, 0x43, 0x23, 0x1a, 0x4,  0x2a, 0x12, 0x21, 0x54, 0x57, 0x2,  0x0,  0x0,  0x6a, 0xf9,
      0x12, 0x0,  0x10, 0x2a, 0xac, 0xec, 0xc1, 0x11, 0x44, 0xd8, 0x70, 0xcd, 0x1b, 0x71, 0x87, 0x84, 0xb8, 0xc2, 0xed,
      0x13, 0x60, 0x94, 0x24, 0x91, 0x26, 0x0,  0x6,  0xdf, 0x31, 0x3e, 0x33, 0x87, 0xcd, 0x0,  0x10, 0x3c, 0x60, 0x52,
      0x25, 0x13, 0xa1, 0x12, 0x81, 0x52, 0x8d, 0x66, 0xc1, 0x64, 0xca, 0x60, 0x6,  0x9,  0x0,  0x10, 0xfa, 0x5e, 0xf1,
      0x6d, 0x95, 0x22, 0xf1, 0x56, 0xa8, 0x2a, 0x66, 0x18, 0x43, 0xb7, 0xd4, 0xa5, 0x19, 0x27, 0x1f, 0x0,  0x18, 0x9c,
      0x82, 0x5a, 0xae, 0x83, 0xfc, 0x67, 0x54, 0xf1, 0x16, 0x66, 0x9,  0x9f, 0x6f, 0x80, 0x90, 0x1f, 0x2d, 0x72, 0xc1,
      0xb8, 0xdf, 0x98, 0x5,  0x0,  0x14, 0xeb, 0xb3, 0x8f, 0xa9, 0x6f, 0x8c, 0x7e, 0xf6, 0x91, 0x3e, 0xe4, 0x7a, 0x2a,
      0x4d, 0x2f, 0x99, 0xcc, 0x1f, 0x40, 0x25, 0x0,  0x0,  0xa,  0x2f, 0x74, 0x69, 0x2d, 0x43, 0x1a, 0x1f, 0xbe, 0x34,
      0x8a, 0x0,  0x0,  0x3,  0x1d, 0xcd, 0x9b, 0x1,  0x0,  0x0,  0x1,  0x0,  0xd,  0xa1, 0x9f, 0xe8, 0x7b, 0x74, 0xa6,
      0x86, 0xb0, 0xfb, 0x89, 0x87, 0xa6, 0xd4, 0x0,  0x0,  0x5,  0x68, 0x4f, 0xc7, 0xad, 0xb6, 0x0,  0x0,  0x13, 0x45,
      0xf,  0x8f, 0x7e, 0xf8, 0xb9, 0xff, 0xa6, 0x58, 0xf5, 0xfd, 0xd1, 0xab, 0xe7, 0xdc, 0x85, 0xd2, 0xe2, 0xe,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xeb, 0xb3, 0x8f, 0xa9, 0x6f, 0x8c, 0x7e, 0xf6, 0x91, 0x3e,
                                     0xe4, 0x7a, 0x2a, 0x4d, 0x2f, 0x99, 0xcc, 0x1f, 0x40, 0x25};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2f, 0x74, 0x69, 0x2d, 0x43, 0x1a, 0x1f, 0xbe, 0x34, 0x8a};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1d, 0xcd, 0x9b};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa1, 0x9f, 0xe8, 0x7b, 0x74, 0xa6, 0x86, 0xb0, 0xfb, 0x89, 0x87, 0xa6, 0xd4};
  lwmqtt_string_t topic_filter_s4 = {13, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x68, 0x4f, 0xc7, 0xad, 0xb6};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x45, 0xf,  0x8f, 0x7e, 0xf8, 0xb9, 0xff, 0xa6, 0x58, 0xf5,
                                     0xfd, 0xd1, 0xab, 0xe7, 0xdc, 0x85, 0xd2, 0xe2, 0xe};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0xc4, 0x75, 0xae, 0xa2, 0xc0, 0x4, 0x50, 0xc2, 0xe8, 0xdd, 0x1b, 0x77, 0x43};
  uint8_t bytesprops1[] = {0x2a, 0xac, 0xec, 0xc1, 0x11, 0x44, 0xd8, 0x70,
                           0xcd, 0x1b, 0x71, 0x87, 0x84, 0xb8, 0xc2, 0xed};
  uint8_t bytesprops3[] = {0x3c, 0x60, 0x52, 0x25, 0x13, 0xa1, 0x12, 0x81,
                           0x52, 0x8d, 0x66, 0xc1, 0x64, 0xca, 0x60, 0x6};
  uint8_t bytesprops2[] = {0xdf, 0x31, 0x3e, 0x33, 0x87, 0xcd};
  uint8_t bytesprops4[] = {0xfa, 0x5e, 0xf1, 0x6d, 0x95, 0x22, 0xf1, 0x56,
                           0xa8, 0x2a, 0x66, 0x18, 0x43, 0xb7, 0xd4, 0xa5};
  uint8_t bytesprops5[] = {0x9c, 0x82, 0x5a, 0xae, 0x83, 0xfc, 0x67, 0x54, 0xf1, 0x16, 0x66, 0x9,
                           0x9f, 0x6f, 0x80, 0x90, 0x1f, 0x2d, 0x72, 0xc1, 0xb8, 0xdf, 0x98, 0x5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 24}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6660}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21591}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27385}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24724}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops2}, .v = {16, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32171, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29078 [("\201\248\\\248\245\254b\200k\161O\234i|\156\CAN\154+$\r\DLEu\179\"_|S}",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("#\234t\173\SOH%\NUL\251\216}\164\226\144\198\195\234\174\FSJ\136\GS\239\130\227\136\NAK",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("A\129\149O\210j]Y\247\205{\133\US\158\220U\204Gq\195\159\200kM\141\DLE\155\245\175",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\RST\234",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("h\USN\NUL\199Ix\174\RS\FS#\174",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0})] [PropTopicAlias 28371,PropAssignedClientIdentifier
// "qa\234\216V\206\v\254\SO*\191\249\&9",PropMaximumPacketSize 29054,PropReceiveMaximum 18298,PropMessageExpiryInterval
// 12385,PropSharedSubscriptionAvailable 182]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x96, 0x1,  0x71, 0x96, 0x22, 0x23, 0x6e, 0xd3, 0x12, 0x0,  0xd,  0x71, 0x61, 0xea, 0xd8, 0x56,
                   0xce, 0xb,  0xfe, 0xe,  0x2a, 0xbf, 0xf9, 0x39, 0x27, 0x0,  0x0,  0x71, 0x7e, 0x21, 0x47, 0x7a, 0x2,
                   0x0,  0x0,  0x30, 0x61, 0x2a, 0xb6, 0x0,  0x1c, 0xc9, 0xf8, 0x5c, 0xf8, 0xf5, 0xfe, 0x62, 0xc8, 0x6b,
                   0xa1, 0x4f, 0xea, 0x69, 0x7c, 0x9c, 0x18, 0x9a, 0x2b, 0x24, 0xd,  0x10, 0x75, 0xb3, 0x22, 0x5f, 0x7c,
                   0x53, 0x7d, 0x0,  0x0,  0x1a, 0x23, 0xea, 0x74, 0xad, 0x1,  0x25, 0x0,  0xfb, 0xd8, 0x7d, 0xa4, 0xe2,
                   0x90, 0xc6, 0xc3, 0xea, 0xae, 0x1c, 0x4a, 0x88, 0x1d, 0xef, 0x82, 0xe3, 0x88, 0x15, 0x1,  0x0,  0x1d,
                   0x41, 0x81, 0x95, 0x4f, 0xd2, 0x6a, 0x5d, 0x59, 0xf7, 0xcd, 0x7b, 0x85, 0x1f, 0x9e, 0xdc, 0x55, 0xcc,
                   0x47, 0x71, 0xc3, 0x9f, 0xc8, 0x6b, 0x4d, 0x8d, 0x10, 0x9b, 0xf5, 0xaf, 0x0,  0x0,  0x3,  0x1e, 0x54,
                   0xea, 0x2,  0x0,  0xc,  0x68, 0x1f, 0x4e, 0x0,  0xc7, 0x49, 0x78, 0xae, 0x1e, 0x1c, 0x23, 0xae, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xc9, 0xf8, 0x5c, 0xf8, 0xf5, 0xfe, 0x62, 0xc8, 0x6b, 0xa1,
                                     0x4f, 0xea, 0x69, 0x7c, 0x9c, 0x18, 0x9a, 0x2b, 0x24, 0xd,
                                     0x10, 0x75, 0xb3, 0x22, 0x5f, 0x7c, 0x53, 0x7d};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x23, 0xea, 0x74, 0xad, 0x1,  0x25, 0x0,  0xfb, 0xd8, 0x7d, 0xa4, 0xe2, 0x90,
                                     0xc6, 0xc3, 0xea, 0xae, 0x1c, 0x4a, 0x88, 0x1d, 0xef, 0x82, 0xe3, 0x88, 0x15};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x41, 0x81, 0x95, 0x4f, 0xd2, 0x6a, 0x5d, 0x59, 0xf7, 0xcd,
                                     0x7b, 0x85, 0x1f, 0x9e, 0xdc, 0x55, 0xcc, 0x47, 0x71, 0xc3,
                                     0x9f, 0xc8, 0x6b, 0x4d, 0x8d, 0x10, 0x9b, 0xf5, 0xaf};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1e, 0x54, 0xea};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x68, 0x1f, 0x4e, 0x0, 0xc7, 0x49, 0x78, 0xae, 0x1e, 0x1c, 0x23, 0xae};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0x71, 0x61, 0xea, 0xd8, 0x56, 0xce, 0xb, 0xfe, 0xe, 0x2a, 0xbf, 0xf9, 0x39};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28371}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29054}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18298}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12385}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 182}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29078, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 756 [("F\229~\a\235\170;\164\DC1\152",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\208fV\240",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("X\FS\146$\204\DLE\249b\249R\142P\254No\129",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\212\SUB\138(T\SYN-\252",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ETX\"\SUB\EM\ETB\133\248d\162\156\244\246",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("R\179\184\&9\148\238\184\166\149\"\208s&A\130\132s(\240\133\165\CAN\EMN",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\252\128\176
// \139\212\226\208",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\154\137px\248W\245mK\174\255)oi\SOH\235\145\SO\t\EOT\190\144`%N\219\225\189\179",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("}\193\237\&6\129\180b\DEL\136\247\147W\ETX\229!\156\ACK\226fs\144+\DEL#'\202",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\203\203\184\175b\208n\245r\221R;
// \147\ACK%e9\161\NAKG:-fE\172\128",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2})] [PropRequestResponseInformation 126,PropRequestResponseInformation
// 251,PropMaximumPacketSize 31944,PropRequestProblemInformation 20,PropRetainAvailable 197,PropMessageExpiryInterval
// 3295,PropRequestResponseInformation 141,PropServerReference "eJ\129\167\DC3\184\174*N\228",PropSessionExpiryInterval
// 1167,PropSharedSubscriptionAvailable 150,PropPayloadFormatIndicator 142,PropMessageExpiryInterval
// 12479,PropSubscriptionIdentifierAvailable 88,PropMessageExpiryInterval 4531]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x82, 0xfe, 0x1,  0x2,  0xf4, 0x36, 0x19, 0x7e, 0x19, 0xfb, 0x27, 0x0,  0x0,  0x7c, 0xc8, 0x17, 0x14, 0x25, 0xc5,
      0x2,  0x0,  0x0,  0xc,  0xdf, 0x19, 0x8d, 0x1c, 0x0,  0xa,  0x65, 0x4a, 0x81, 0xa7, 0x13, 0xb8, 0xae, 0x2a, 0x4e,
      0xe4, 0x11, 0x0,  0x0,  0x4,  0x8f, 0x2a, 0x96, 0x1,  0x8e, 0x2,  0x0,  0x0,  0x30, 0xbf, 0x29, 0x58, 0x2,  0x0,
      0x0,  0x11, 0xb3, 0x0,  0xa,  0x46, 0xe5, 0x7e, 0x7,  0xeb, 0xaa, 0x3b, 0xa4, 0x11, 0x98, 0x2,  0x0,  0x4,  0xd0,
      0x66, 0x56, 0xf0, 0x0,  0x0,  0x10, 0x58, 0x1c, 0x92, 0x24, 0xcc, 0x10, 0xf9, 0x62, 0xf9, 0x52, 0x8e, 0x50, 0xfe,
      0x4e, 0x6f, 0x81, 0x1,  0x0,  0x8,  0xd4, 0x1a, 0x8a, 0x28, 0x54, 0x16, 0x2d, 0xfc, 0x2,  0x0,  0xc,  0x3,  0x22,
      0x1a, 0x19, 0x17, 0x85, 0xf8, 0x64, 0xa2, 0x9c, 0xf4, 0xf6, 0x2,  0x0,  0x18, 0x52, 0xb3, 0xb8, 0x39, 0x94, 0xee,
      0xb8, 0xa6, 0x95, 0x22, 0xd0, 0x73, 0x26, 0x41, 0x82, 0x84, 0x73, 0x28, 0xf0, 0x85, 0xa5, 0x18, 0x19, 0x4e, 0x2,
      0x0,  0x8,  0xfc, 0x80, 0xb0, 0x20, 0x8b, 0xd4, 0xe2, 0xd0, 0x1,  0x0,  0x0,  0x1,  0x0,  0x1d, 0x9a, 0x89, 0x70,
      0x78, 0xf8, 0x57, 0xf5, 0x6d, 0x4b, 0xae, 0xff, 0x29, 0x6f, 0x69, 0x1,  0xeb, 0x91, 0xe,  0x9,  0x4,  0xbe, 0x90,
      0x60, 0x25, 0x4e, 0xdb, 0xe1, 0xbd, 0xb3, 0x0,  0x0,  0x1a, 0x7d, 0xc1, 0xed, 0x36, 0x81, 0xb4, 0x62, 0x7f, 0x88,
      0xf7, 0x93, 0x57, 0x3,  0xe5, 0x21, 0x9c, 0x6,  0xe2, 0x66, 0x73, 0x90, 0x2b, 0x7f, 0x23, 0x27, 0xca, 0x2,  0x0,
      0x1b, 0xcb, 0xcb, 0xb8, 0xaf, 0x62, 0xd0, 0x6e, 0xf5, 0x72, 0xdd, 0x52, 0x3b, 0x20, 0x93, 0x6,  0x25, 0x65, 0x39,
      0xa1, 0x15, 0x47, 0x3a, 0x2d, 0x66, 0x45, 0xac, 0x80, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x46, 0xe5, 0x7e, 0x7, 0xeb, 0xaa, 0x3b, 0xa4, 0x11, 0x98};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x66, 0x56, 0xf0};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x58, 0x1c, 0x92, 0x24, 0xcc, 0x10, 0xf9, 0x62,
                                     0xf9, 0x52, 0x8e, 0x50, 0xfe, 0x4e, 0x6f, 0x81};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd4, 0x1a, 0x8a, 0x28, 0x54, 0x16, 0x2d, 0xfc};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x3, 0x22, 0x1a, 0x19, 0x17, 0x85, 0xf8, 0x64, 0xa2, 0x9c, 0xf4, 0xf6};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x52, 0xb3, 0xb8, 0x39, 0x94, 0xee, 0xb8, 0xa6, 0x95, 0x22, 0xd0, 0x73,
                                     0x26, 0x41, 0x82, 0x84, 0x73, 0x28, 0xf0, 0x85, 0xa5, 0x18, 0x19, 0x4e};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfc, 0x80, 0xb0, 0x20, 0x8b, 0xd4, 0xe2, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {8, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0};
  lwmqtt_string_t topic_filter_s7 = {0, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x9a, 0x89, 0x70, 0x78, 0xf8, 0x57, 0xf5, 0x6d, 0x4b, 0xae,
                                     0xff, 0x29, 0x6f, 0x69, 0x1,  0xeb, 0x91, 0xe,  0x9,  0x4,
                                     0xbe, 0x90, 0x60, 0x25, 0x4e, 0xdb, 0xe1, 0xbd, 0xb3};
  lwmqtt_string_t topic_filter_s8 = {29, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x7d, 0xc1, 0xed, 0x36, 0x81, 0xb4, 0x62, 0x7f, 0x88, 0xf7, 0x93, 0x57, 0x3,
                                     0xe5, 0x21, 0x9c, 0x6,  0xe2, 0x66, 0x73, 0x90, 0x2b, 0x7f, 0x23, 0x27, 0xca};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xcb, 0xcb, 0xb8, 0xaf, 0x62, 0xd0, 0x6e, 0xf5, 0x72,
                                      0xdd, 0x52, 0x3b, 0x20, 0x93, 0x6,  0x25, 0x65, 0x39,
                                      0xa1, 0x15, 0x47, 0x3a, 0x2d, 0x66, 0x45, 0xac, 0x80};
  lwmqtt_string_t topic_filter_s10 = {27, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x65, 0x4a, 0x81, 0xa7, 0x13, 0xb8, 0xae, 0x2a, 0x4e, 0xe4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31944}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3295}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1167}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12479}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4531}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 756, 11, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16233 [("EBW",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("T\254+V h\152\170",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("3!",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\DC3n;\202\230\SUB\132\139\138\185;\174&\231+wf\251U\f\EMGS\207\&0v\246",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\v\207\&8\151z2J\146\DC2;\214\252\DC3\139\b\232\242\&5\190\231\229~^\172\238\SI:e\SUB",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("4\212\138\243\171\200\217@\238\210[E\146\241\SO\183\128",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropMaximumPacketSize 4150,PropUserProperty ""
// "\225\134\191cV\156M\176\SUB6b\217\143\240\240\&7",PropUserProperty "\204\149"
// "\ETX\148^\149s\237\ENQ\169j\211\ETBu\248\174\143\USDT\EM\203\131\DC1r\189\&4L{\SO",PropSubscriptionIdentifier
// 30,PropTopicAliasMaximum 20950,PropMaximumQoS 106]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0xb3, 0x1,  0x3f, 0x69, 0x44, 0x27, 0x0,  0x0,  0x10, 0x36, 0x26, 0x0,  0x0,  0x0,  0x10, 0xe1,
                   0x86, 0xbf, 0x63, 0x56, 0x9c, 0x4d, 0xb0, 0x1a, 0x36, 0x62, 0xd9, 0x8f, 0xf0, 0xf0, 0x37, 0x26, 0x0,
                   0x2,  0xcc, 0x95, 0x0,  0x1c, 0x3,  0x94, 0x5e, 0x95, 0x73, 0xed, 0x5,  0xa9, 0x6a, 0xd3, 0x17, 0x75,
                   0xf8, 0xae, 0x8f, 0x1f, 0x44, 0x54, 0x19, 0xcb, 0x83, 0x11, 0x72, 0xbd, 0x34, 0x4c, 0x7b, 0xe,  0xb,
                   0x1e, 0x22, 0x51, 0xd6, 0x24, 0x6a, 0x0,  0x3,  0x45, 0x42, 0x57, 0x1,  0x0,  0x1,  0x6e, 0x0,  0x0,
                   0x8,  0x54, 0xfe, 0x2b, 0x56, 0x20, 0x68, 0x98, 0xaa, 0x1,  0x0,  0x2,  0x33, 0x21, 0x0,  0x0,  0x1b,
                   0x13, 0x6e, 0x3b, 0xca, 0xe6, 0x1a, 0x84, 0x8b, 0x8a, 0xb9, 0x3b, 0xae, 0x26, 0xe7, 0x2b, 0x77, 0x66,
                   0xfb, 0x55, 0xc,  0x19, 0x47, 0x53, 0xcf, 0x30, 0x76, 0xf6, 0x0,  0x0,  0x1d, 0xb,  0xcf, 0x38, 0x97,
                   0x7a, 0x32, 0x4a, 0x92, 0x12, 0x3b, 0xd6, 0xfc, 0x13, 0x8b, 0x8,  0xe8, 0xf2, 0x35, 0xbe, 0xe7, 0xe5,
                   0x7e, 0x5e, 0xac, 0xee, 0xf,  0x3a, 0x65, 0x1a, 0x2,  0x0,  0x11, 0x34, 0xd4, 0x8a, 0xf3, 0xab, 0xc8,
                   0xd9, 0x40, 0xee, 0xd2, 0x5b, 0x45, 0x92, 0xf1, 0xe,  0xb7, 0x80, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x45, 0x42, 0x57};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x54, 0xfe, 0x2b, 0x56, 0x20, 0x68, 0x98, 0xaa};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x33, 0x21};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x13, 0x6e, 0x3b, 0xca, 0xe6, 0x1a, 0x84, 0x8b, 0x8a, 0xb9, 0x3b, 0xae, 0x26, 0xe7,
                                     0x2b, 0x77, 0x66, 0xfb, 0x55, 0xc,  0x19, 0x47, 0x53, 0xcf, 0x30, 0x76, 0xf6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb,  0xcf, 0x38, 0x97, 0x7a, 0x32, 0x4a, 0x92, 0x12, 0x3b,
                                     0xd6, 0xfc, 0x13, 0x8b, 0x8,  0xe8, 0xf2, 0x35, 0xbe, 0xe7,
                                     0xe5, 0x7e, 0x5e, 0xac, 0xee, 0xf,  0x3a, 0x65, 0x1a};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x34, 0xd4, 0x8a, 0xf3, 0xab, 0xc8, 0xd9, 0x40, 0xee,
                                     0xd2, 0x5b, 0x45, 0x92, 0xf1, 0xe,  0xb7, 0x80};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2};
  uint8_t bytesprops1[] = {0xe1, 0x86, 0xbf, 0x63, 0x56, 0x9c, 0x4d, 0xb0,
                           0x1a, 0x36, 0x62, 0xd9, 0x8f, 0xf0, 0xf0, 0x37};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops3[] = {0x3,  0x94, 0x5e, 0x95, 0x73, 0xed, 0x5,  0xa9, 0x6a, 0xd3, 0x17, 0x75, 0xf8, 0xae,
                           0x8f, 0x1f, 0x44, 0x54, 0x19, 0xcb, 0x83, 0x11, 0x72, 0xbd, 0x34, 0x4c, 0x7b, 0xe};
  uint8_t bytesprops2[] = {0xcc, 0x95};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4150}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops0}, .v = {16, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops2}, .v = {28, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20950}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 106}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 16233, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27988 [("\215:8'\163*\137K\190_\182*\204\144\ETX\186\242\234\173\138,f\158\190",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("P7\f\231T5\214\vP\216h\NUL\DC3\b\224\SI",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\132~\184",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\235\ESC\184\223^M\136\133\196\&6\247\CAN/M\231\201c\165j\230",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("1\153n\DC1\168\129\189\149\&7+F>\DC4d\249\172\130\DC4\ACK_\177*\237C\228\f\DC4\a<]",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\238E\134\179f\SOH\209\229\239w\165\242\181\DC4\182\139\180\ETX\178!1",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("k\222\133\254$\SYN\235\a\154\140U",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\254",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0})] [PropResponseTopic
// "d_\229#\234X\131\143.\233Vt\204\224\203\133",PropResponseTopic
// "\156L`\147\168\DEL\SYN\215\EOT?\193E\244\150U\255",PropReceiveMaximum 6381,PropWillDelayInterval
// 26365,PropWillDelayInterval 17069,PropServerKeepAlive 21809,PropAssignedClientIdentifier
// "J\156\247\254\ENQJ^\DC4=\f\147\232\177\128\232K\170y",PropContentType "E\144'\141\v\241~n\254\232\DLE
// \224A\170\176^\173P\133\215\220\131\244@",PropRequestProblemInformation 253,PropTopicAlias 6832,PropServerReference
// "\251m\246\246\\\215\DLE\187\238\DC3\145\232\167B|\194\207;\148\CAN\181\231\213(a:W\167\135s",PropTopicAliasMaximum
// 12908,PropResponseTopic "{\STX\231\171v\140{\b\143",PropResponseInformation
// "\\\219T\152bgR\150\139\149\255\255",PropWillDelayInterval 10586,PropMaximumQoS 183,PropServerReference
// "\217\&2\246\&5\253V\189\252\181\143\138^\DLE\150tgA\\8A",PropMaximumQoS 46,PropSubscriptionIdentifier
// 9,PropAuthenticationMethod "\204[E^\242\226\SYN!M+\216~\139O\166' y",PropReceiveMaximum
// 3271,PropMessageExpiryInterval 24796,PropSharedSubscriptionAvailable 167,PropRetainAvailable 237,PropReceiveMaximum
// 32101,PropRetainAvailable 130,PropRequestProblemInformation 100,PropReceiveMaximum 20262]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x82, 0x92, 0x3,  0x6d, 0x54, 0xf8, 0x1,  0x8,  0x0,  0x10, 0x64, 0x5f, 0xe5, 0x23, 0xea, 0x58, 0x83, 0x8f, 0x2e,
      0xe9, 0x56, 0x74, 0xcc, 0xe0, 0xcb, 0x85, 0x8,  0x0,  0x10, 0x9c, 0x4c, 0x60, 0x93, 0xa8, 0x7f, 0x16, 0xd7, 0x4,
      0x3f, 0xc1, 0x45, 0xf4, 0x96, 0x55, 0xff, 0x21, 0x18, 0xed, 0x18, 0x0,  0x0,  0x66, 0xfd, 0x18, 0x0,  0x0,  0x42,
      0xad, 0x13, 0x55, 0x31, 0x12, 0x0,  0x12, 0x4a, 0x9c, 0xf7, 0xfe, 0x5,  0x4a, 0x5e, 0x14, 0x3d, 0xc,  0x93, 0xe8,
      0xb1, 0x80, 0xe8, 0x4b, 0xaa, 0x79, 0x3,  0x0,  0x19, 0x45, 0x90, 0x27, 0x8d, 0xb,  0xf1, 0x7e, 0x6e, 0xfe, 0xe8,
      0x10, 0x20, 0xe0, 0x41, 0xaa, 0xb0, 0x5e, 0xad, 0x50, 0x85, 0xd7, 0xdc, 0x83, 0xf4, 0x40, 0x17, 0xfd, 0x23, 0x1a,
      0xb0, 0x1c, 0x0,  0x1e, 0xfb, 0x6d, 0xf6, 0xf6, 0x5c, 0xd7, 0x10, 0xbb, 0xee, 0x13, 0x91, 0xe8, 0xa7, 0x42, 0x7c,
      0xc2, 0xcf, 0x3b, 0x94, 0x18, 0xb5, 0xe7, 0xd5, 0x28, 0x61, 0x3a, 0x57, 0xa7, 0x87, 0x73, 0x22, 0x32, 0x6c, 0x8,
      0x0,  0x9,  0x7b, 0x2,  0xe7, 0xab, 0x76, 0x8c, 0x7b, 0x8,  0x8f, 0x1a, 0x0,  0xc,  0x5c, 0xdb, 0x54, 0x98, 0x62,
      0x67, 0x52, 0x96, 0x8b, 0x95, 0xff, 0xff, 0x18, 0x0,  0x0,  0x29, 0x5a, 0x24, 0xb7, 0x1c, 0x0,  0x14, 0xd9, 0x32,
      0xf6, 0x35, 0xfd, 0x56, 0xbd, 0xfc, 0xb5, 0x8f, 0x8a, 0x5e, 0x10, 0x96, 0x74, 0x67, 0x41, 0x5c, 0x38, 0x41, 0x24,
      0x2e, 0xb,  0x9,  0x15, 0x0,  0x12, 0xcc, 0x5b, 0x45, 0x5e, 0xf2, 0xe2, 0x16, 0x21, 0x4d, 0x2b, 0xd8, 0x7e, 0x8b,
      0x4f, 0xa6, 0x27, 0x20, 0x79, 0x21, 0xc,  0xc7, 0x2,  0x0,  0x0,  0x60, 0xdc, 0x2a, 0xa7, 0x25, 0xed, 0x21, 0x7d,
      0x65, 0x25, 0x82, 0x17, 0x64, 0x21, 0x4f, 0x26, 0x0,  0x18, 0xd7, 0x3a, 0x38, 0x27, 0xa3, 0x2a, 0x89, 0x4b, 0xbe,
      0x5f, 0xb6, 0x2a, 0xcc, 0x90, 0x3,  0xba, 0xf2, 0xea, 0xad, 0x8a, 0x2c, 0x66, 0x9e, 0xbe, 0x0,  0x0,  0x10, 0x50,
      0x37, 0xc,  0xe7, 0x54, 0x35, 0xd6, 0xb,  0x50, 0xd8, 0x68, 0x0,  0x13, 0x8,  0xe0, 0xf,  0x0,  0x0,  0x3,  0x84,
      0x7e, 0xb8, 0x0,  0x0,  0x14, 0xeb, 0x1b, 0xb8, 0xdf, 0x5e, 0x4d, 0x88, 0x85, 0xc4, 0x36, 0xf7, 0x18, 0x2f, 0x4d,
      0xe7, 0xc9, 0x63, 0xa5, 0x6a, 0xe6, 0x1,  0x0,  0x1e, 0x31, 0x99, 0x6e, 0x11, 0xa8, 0x81, 0xbd, 0x95, 0x37, 0x2b,
      0x46, 0x3e, 0x14, 0x64, 0xf9, 0xac, 0x82, 0x14, 0x6,  0x5f, 0xb1, 0x2a, 0xed, 0x43, 0xe4, 0xc,  0x14, 0x7,  0x3c,
      0x5d, 0x1,  0x0,  0x15, 0xee, 0x45, 0x86, 0xb3, 0x66, 0x1,  0xd1, 0xe5, 0xef, 0x77, 0xa5, 0xf2, 0xb5, 0x14, 0xb6,
      0x8b, 0xb4, 0x3,  0xb2, 0x21, 0x31, 0x1,  0x0,  0xb,  0x6b, 0xde, 0x85, 0xfe, 0x24, 0x16, 0xeb, 0x7,  0x9a, 0x8c,
      0x55, 0x1,  0x0,  0x1,  0xfe, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xd7, 0x3a, 0x38, 0x27, 0xa3, 0x2a, 0x89, 0x4b, 0xbe, 0x5f, 0xb6, 0x2a,
                                     0xcc, 0x90, 0x3,  0xba, 0xf2, 0xea, 0xad, 0x8a, 0x2c, 0x66, 0x9e, 0xbe};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x50, 0x37, 0xc,  0xe7, 0x54, 0x35, 0xd6, 0xb,
                                     0x50, 0xd8, 0x68, 0x0,  0x13, 0x8,  0xe0, 0xf};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0x7e, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xeb, 0x1b, 0xb8, 0xdf, 0x5e, 0x4d, 0x88, 0x85, 0xc4, 0x36,
                                     0xf7, 0x18, 0x2f, 0x4d, 0xe7, 0xc9, 0x63, 0xa5, 0x6a, 0xe6};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x99, 0x6e, 0x11, 0xa8, 0x81, 0xbd, 0x95, 0x37, 0x2b,
                                     0x46, 0x3e, 0x14, 0x64, 0xf9, 0xac, 0x82, 0x14, 0x6,  0x5f,
                                     0xb1, 0x2a, 0xed, 0x43, 0xe4, 0xc,  0x14, 0x7,  0x3c, 0x5d};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xee, 0x45, 0x86, 0xb3, 0x66, 0x1,  0xd1, 0xe5, 0xef, 0x77, 0xa5,
                                     0xf2, 0xb5, 0x14, 0xb6, 0x8b, 0xb4, 0x3,  0xb2, 0x21, 0x31};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6b, 0xde, 0x85, 0xfe, 0x24, 0x16, 0xeb, 0x7, 0x9a, 0x8c, 0x55};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfe};
  lwmqtt_string_t topic_filter_s7 = {1, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1,
                               LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0x64, 0x5f, 0xe5, 0x23, 0xea, 0x58, 0x83, 0x8f,
                           0x2e, 0xe9, 0x56, 0x74, 0xcc, 0xe0, 0xcb, 0x85};
  uint8_t bytesprops1[] = {0x9c, 0x4c, 0x60, 0x93, 0xa8, 0x7f, 0x16, 0xd7,
                           0x4,  0x3f, 0xc1, 0x45, 0xf4, 0x96, 0x55, 0xff};
  uint8_t bytesprops2[] = {0x4a, 0x9c, 0xf7, 0xfe, 0x5,  0x4a, 0x5e, 0x14, 0x3d,
                           0xc,  0x93, 0xe8, 0xb1, 0x80, 0xe8, 0x4b, 0xaa, 0x79};
  uint8_t bytesprops3[] = {0x45, 0x90, 0x27, 0x8d, 0xb,  0xf1, 0x7e, 0x6e, 0xfe, 0xe8, 0x10, 0x20, 0xe0,
                           0x41, 0xaa, 0xb0, 0x5e, 0xad, 0x50, 0x85, 0xd7, 0xdc, 0x83, 0xf4, 0x40};
  uint8_t bytesprops4[] = {0xfb, 0x6d, 0xf6, 0xf6, 0x5c, 0xd7, 0x10, 0xbb, 0xee, 0x13, 0x91, 0xe8, 0xa7, 0x42, 0x7c,
                           0xc2, 0xcf, 0x3b, 0x94, 0x18, 0xb5, 0xe7, 0xd5, 0x28, 0x61, 0x3a, 0x57, 0xa7, 0x87, 0x73};
  uint8_t bytesprops5[] = {0x7b, 0x2, 0xe7, 0xab, 0x76, 0x8c, 0x7b, 0x8, 0x8f};
  uint8_t bytesprops6[] = {0x5c, 0xdb, 0x54, 0x98, 0x62, 0x67, 0x52, 0x96, 0x8b, 0x95, 0xff, 0xff};
  uint8_t bytesprops7[] = {0xd9, 0x32, 0xf6, 0x35, 0xfd, 0x56, 0xbd, 0xfc, 0xb5, 0x8f,
                           0x8a, 0x5e, 0x10, 0x96, 0x74, 0x67, 0x41, 0x5c, 0x38, 0x41};
  uint8_t bytesprops8[] = {0xcc, 0x5b, 0x45, 0x5e, 0xf2, 0xe2, 0x16, 0x21, 0x4d,
                           0x2b, 0xd8, 0x7e, 0x8b, 0x4f, 0xa6, 0x27, 0x20, 0x79};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6381}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26365}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17069}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21809}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6832}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12908}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10586}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 9}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3271}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24796}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32101}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20262}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27988, 8, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19880 [("\163\224\DC4H\243\234r\170\191\212<\172Q\159\207\205\131=\189\132W",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DLE\190\ETXgAE\133z \251",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("4 ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\229\210&\235\147\255",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\GS{\223`IldKX@9",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\198W8*B\175+,@\234j\200\209\167\187",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\203#\222\STX\217\221[6\138\196[\189\236\190\187Q\225\143+]\183U\141lq\242\SI\253",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropTopicAlias
// 30972,PropReceiveMaximum 9117,PropServerKeepAlive 29875,PropMessageExpiryInterval
// 17362,PropWildcardSubscriptionAvailable 2,PropSubscriptionIdentifierAvailable 204,PropSharedSubscriptionAvailable
// 168,PropMaximumQoS 53,PropTopicAlias 30987,PropSharedSubscriptionAvailable 55,PropServerReference
// "\204q\192\US\138d\224\139j\162\NUL\240\b\EOT\227\\KP\157\148\198\135x\166\193]\ETB\198",PropWildcardSubscriptionAvailable
// 254,PropPayloadFormatIndicator 244,PropSessionExpiryInterval 21471]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0xb8, 0x1,  0x4d, 0xa8, 0x43, 0x23, 0x78, 0xfc, 0x21, 0x23, 0x9d, 0x13, 0x74, 0xb3, 0x2,  0x0,
                   0x0,  0x43, 0xd2, 0x28, 0x2,  0x29, 0xcc, 0x2a, 0xa8, 0x24, 0x35, 0x23, 0x79, 0xb,  0x2a, 0x37, 0x1c,
                   0x0,  0x1c, 0xcc, 0x71, 0xc0, 0x1f, 0x8a, 0x64, 0xe0, 0x8b, 0x6a, 0xa2, 0x0,  0xf0, 0x8,  0x4,  0xe3,
                   0x5c, 0x4b, 0x50, 0x9d, 0x94, 0xc6, 0x87, 0x78, 0xa6, 0xc1, 0x5d, 0x17, 0xc6, 0x28, 0xfe, 0x1,  0xf4,
                   0x11, 0x0,  0x0,  0x53, 0xdf, 0x0,  0x15, 0xa3, 0xe0, 0x14, 0x48, 0xf3, 0xea, 0x72, 0xaa, 0xbf, 0xd4,
                   0x3c, 0xac, 0x51, 0x9f, 0xcf, 0xcd, 0x83, 0x3d, 0xbd, 0x84, 0x57, 0x0,  0x0,  0xa,  0x10, 0xbe, 0x3,
                   0x67, 0x41, 0x45, 0x85, 0x7a, 0x20, 0xfb, 0x0,  0x0,  0x2,  0x34, 0x20, 0x2,  0x0,  0x6,  0xe5, 0xd2,
                   0x26, 0xeb, 0x93, 0xff, 0x0,  0x0,  0xb,  0x1d, 0x7b, 0xdf, 0x60, 0x49, 0x6c, 0x64, 0x4b, 0x58, 0x40,
                   0x39, 0x0,  0x0,  0xf,  0xc6, 0x57, 0x38, 0x2a, 0x42, 0xaf, 0x2b, 0x2c, 0x40, 0xea, 0x6a, 0xc8, 0xd1,
                   0xa7, 0xbb, 0x2,  0x0,  0x1c, 0xcb, 0x23, 0xde, 0x2,  0xd9, 0xdd, 0x5b, 0x36, 0x8a, 0xc4, 0x5b, 0xbd,
                   0xec, 0xbe, 0xbb, 0x51, 0xe1, 0x8f, 0x2b, 0x5d, 0xb7, 0x55, 0x8d, 0x6c, 0x71, 0xf2, 0xf,  0xfd, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xa3, 0xe0, 0x14, 0x48, 0xf3, 0xea, 0x72, 0xaa, 0xbf, 0xd4, 0x3c,
                                     0xac, 0x51, 0x9f, 0xcf, 0xcd, 0x83, 0x3d, 0xbd, 0x84, 0x57};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x10, 0xbe, 0x3, 0x67, 0x41, 0x45, 0x85, 0x7a, 0x20, 0xfb};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x34, 0x20};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe5, 0xd2, 0x26, 0xeb, 0x93, 0xff};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1d, 0x7b, 0xdf, 0x60, 0x49, 0x6c, 0x64, 0x4b, 0x58, 0x40, 0x39};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc6, 0x57, 0x38, 0x2a, 0x42, 0xaf, 0x2b, 0x2c,
                                     0x40, 0xea, 0x6a, 0xc8, 0xd1, 0xa7, 0xbb};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xcb, 0x23, 0xde, 0x2,  0xd9, 0xdd, 0x5b, 0x36, 0x8a, 0xc4,
                                     0x5b, 0xbd, 0xec, 0xbe, 0xbb, 0x51, 0xe1, 0x8f, 0x2b, 0x5d,
                                     0xb7, 0x55, 0x8d, 0x6c, 0x71, 0xf2, 0xf,  0xfd};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xcc, 0x71, 0xc0, 0x1f, 0x8a, 0x64, 0xe0, 0x8b, 0x6a, 0xa2, 0x0,  0xf0, 0x8,  0x4,
                           0xe3, 0x5c, 0x4b, 0x50, 0x9d, 0x94, 0xc6, 0x87, 0x78, 0xa6, 0xc1, 0x5d, 0x17, 0xc6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30972}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9117}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29875}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17362}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30987}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21471}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19880, 7, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22493 [("\227\138\DC4\248mr\146&d\209\219",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropSharedSubscriptionAvailable
// 208,PropResponseInformation "~(V\245\SOH\236\143",PropWildcardSubscriptionAvailable 201,PropUserProperty
// "\156\177I\194E\195\169\232V\196\166\&5\130\247#]\136\169u\ESC\DEL\184\166z\128[N\186"
// "\EM\144:p\228\231\FS\251\253~h\200",PropRequestProblemInformation 81,PropWildcardSubscriptionAvailable
// 59,PropRequestResponseInformation 245,PropServerReference
// "\170_\134\181idH\138\173\DC1\172\EMd\DC1i\130\189",PropRequestProblemInformation 89,PropRequestProblemInformation
// 41,PropServerKeepAlive 7095,PropResponseTopic
// "\165\137\t\r\225(G\179\185\EOT\248\DC1\243\169N\179\138\229",PropTopicAlias
// 13371,PropSubscriptionIdentifierAvailable 164,PropSharedSubscriptionAvailable 22,PropMessageExpiryInterval
// 4425,PropRequestResponseInformation 171,PropAuthenticationMethod
// "X\bf\198\173\241Q-\169h\140\220\n\131p\143\156\DLEx\215C",PropWillDelayInterval 31817,PropSessionExpiryInterval
// 18161,PropMessageExpiryInterval 28296]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0xb8, 0x1,  0x57, 0xdd, 0xa6, 0x1,  0x2a, 0xd0, 0x1a, 0x0,  0x7,  0x7e, 0x28, 0x56, 0xf5, 0x1,
                   0xec, 0x8f, 0x28, 0xc9, 0x26, 0x0,  0x1c, 0x9c, 0xb1, 0x49, 0xc2, 0x45, 0xc3, 0xa9, 0xe8, 0x56, 0xc4,
                   0xa6, 0x35, 0x82, 0xf7, 0x23, 0x5d, 0x88, 0xa9, 0x75, 0x1b, 0x7f, 0xb8, 0xa6, 0x7a, 0x80, 0x5b, 0x4e,
                   0xba, 0x0,  0xc,  0x19, 0x90, 0x3a, 0x70, 0xe4, 0xe7, 0x1c, 0xfb, 0xfd, 0x7e, 0x68, 0xc8, 0x17, 0x51,
                   0x28, 0x3b, 0x19, 0xf5, 0x1c, 0x0,  0x11, 0xaa, 0x5f, 0x86, 0xb5, 0x69, 0x64, 0x48, 0x8a, 0xad, 0x11,
                   0xac, 0x19, 0x64, 0x11, 0x69, 0x82, 0xbd, 0x17, 0x59, 0x17, 0x29, 0x13, 0x1b, 0xb7, 0x8,  0x0,  0x12,
                   0xa5, 0x89, 0x9,  0xd,  0xe1, 0x28, 0x47, 0xb3, 0xb9, 0x4,  0xf8, 0x11, 0xf3, 0xa9, 0x4e, 0xb3, 0x8a,
                   0xe5, 0x23, 0x34, 0x3b, 0x29, 0xa4, 0x2a, 0x16, 0x2,  0x0,  0x0,  0x11, 0x49, 0x19, 0xab, 0x15, 0x0,
                   0x15, 0x58, 0x8,  0x66, 0xc6, 0xad, 0xf1, 0x51, 0x2d, 0xa9, 0x68, 0x8c, 0xdc, 0xa,  0x83, 0x70, 0x8f,
                   0x9c, 0x10, 0x78, 0xd7, 0x43, 0x18, 0x0,  0x0,  0x7c, 0x49, 0x11, 0x0,  0x0,  0x46, 0xf1, 0x2,  0x0,
                   0x0,  0x6e, 0x88, 0x0,  0xb,  0xe3, 0x8a, 0x14, 0xf8, 0x6d, 0x72, 0x92, 0x26, 0x64, 0xd1, 0xdb, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xe3, 0x8a, 0x14, 0xf8, 0x6d, 0x72, 0x92, 0x26, 0x64, 0xd1, 0xdb};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x7e, 0x28, 0x56, 0xf5, 0x1, 0xec, 0x8f};
  uint8_t bytesprops2[] = {0x19, 0x90, 0x3a, 0x70, 0xe4, 0xe7, 0x1c, 0xfb, 0xfd, 0x7e, 0x68, 0xc8};
  uint8_t bytesprops1[] = {0x9c, 0xb1, 0x49, 0xc2, 0x45, 0xc3, 0xa9, 0xe8, 0x56, 0xc4, 0xa6, 0x35, 0x82, 0xf7,
                           0x23, 0x5d, 0x88, 0xa9, 0x75, 0x1b, 0x7f, 0xb8, 0xa6, 0x7a, 0x80, 0x5b, 0x4e, 0xba};
  uint8_t bytesprops3[] = {0xaa, 0x5f, 0x86, 0xb5, 0x69, 0x64, 0x48, 0x8a, 0xad,
                           0x11, 0xac, 0x19, 0x64, 0x11, 0x69, 0x82, 0xbd};
  uint8_t bytesprops4[] = {0xa5, 0x89, 0x9,  0xd,  0xe1, 0x28, 0x47, 0xb3, 0xb9,
                           0x4,  0xf8, 0x11, 0xf3, 0xa9, 0x4e, 0xb3, 0x8a, 0xe5};
  uint8_t bytesprops5[] = {0x58, 0x8, 0x66, 0xc6, 0xad, 0xf1, 0x51, 0x2d, 0xa9, 0x68, 0x8c,
                           0xdc, 0xa, 0x83, 0x70, 0x8f, 0x9c, 0x10, 0x78, 0xd7, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops1}, .v = {12, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7095}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13371}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4425}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31817}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18161}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28296}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22493, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32664 [("\244\185\249\145\SUB\GS\167&\200\201\187E=\184\234\232",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("i\217U\176\198\245\226",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("[gE\131-\185\148\217\a\169\&5(\185\236?\187\171\208\130\242\SIdq\SO\USND",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("
// Y\246\139\\xj\202)\182v\166\bFEb\245H\130",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\160\&3\132\234x\252\200\NUL]\134",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\211\139\255*\EOT\232\243\147D\252\SI\215\&5F\SIF[\209\SUBw\195I\130",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropAuthenticationData
// "G\DC3\137\129k\175\DC3\204",PropAuthenticationMethod ""]
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0x89, 0x1,  0x7f, 0x98, 0xe,  0x16, 0x0,  0x8,  0x47, 0x13, 0x89, 0x81, 0x6b, 0xaf, 0x13,
                   0xcc, 0x15, 0x0,  0x0,  0x0,  0x10, 0xf4, 0xb9, 0xf9, 0x91, 0x1a, 0x1d, 0xa7, 0x26, 0xc8, 0xc9,
                   0xbb, 0x45, 0x3d, 0xb8, 0xea, 0xe8, 0x0,  0x0,  0x7,  0x69, 0xd9, 0x55, 0xb0, 0xc6, 0xf5, 0xe2,
                   0x0,  0x0,  0x1b, 0x5b, 0x67, 0x45, 0x83, 0x2d, 0xb9, 0x94, 0xd9, 0x7,  0xa9, 0x35, 0x28, 0xb9,
                   0xec, 0x3f, 0xbb, 0xab, 0xd0, 0x82, 0xf2, 0xf,  0x64, 0x71, 0xe,  0x1f, 0x4e, 0x44, 0x1,  0x0,
                   0x13, 0x20, 0x59, 0xf6, 0x8b, 0x5c, 0x78, 0x6a, 0xca, 0x29, 0xb6, 0x76, 0xa6, 0x8,  0x46, 0x45,
                   0x62, 0xf5, 0x48, 0x82, 0x2,  0x0,  0xa,  0xa0, 0x33, 0x84, 0xea, 0x78, 0xfc, 0xc8, 0x0,  0x5d,
                   0x86, 0x0,  0x0,  0x17, 0xd3, 0x8b, 0xff, 0x2a, 0x4,  0xe8, 0xf3, 0x93, 0x44, 0xfc, 0xf,  0xd7,
                   0x35, 0x46, 0xf,  0x46, 0x5b, 0xd1, 0x1a, 0x77, 0xc3, 0x49, 0x82, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0xb9, 0xf9, 0x91, 0x1a, 0x1d, 0xa7, 0x26,
                                     0xc8, 0xc9, 0xbb, 0x45, 0x3d, 0xb8, 0xea, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x69, 0xd9, 0x55, 0xb0, 0xc6, 0xf5, 0xe2};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5b, 0x67, 0x45, 0x83, 0x2d, 0xb9, 0x94, 0xd9, 0x7,  0xa9, 0x35, 0x28, 0xb9, 0xec,
                                     0x3f, 0xbb, 0xab, 0xd0, 0x82, 0xf2, 0xf,  0x64, 0x71, 0xe,  0x1f, 0x4e, 0x44};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x20, 0x59, 0xf6, 0x8b, 0x5c, 0x78, 0x6a, 0xca, 0x29, 0xb6,
                                     0x76, 0xa6, 0x8,  0x46, 0x45, 0x62, 0xf5, 0x48, 0x82};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0x33, 0x84, 0xea, 0x78, 0xfc, 0xc8, 0x0, 0x5d, 0x86};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd3, 0x8b, 0xff, 0x2a, 0x4,  0xe8, 0xf3, 0x93, 0x44, 0xfc, 0xf, 0xd7,
                                     0x35, 0x46, 0xf,  0x46, 0x5b, 0xd1, 0x1a, 0x77, 0xc3, 0x49, 0x82};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x47, 0x13, 0x89, 0x81, 0x6b, 0xaf, 0x13, 0xcc};
  uint8_t bytesprops1[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32664, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21953 [("\STX\245\160\232\SUB",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),(",\r\215\243\217\137",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ENQ\196M\SYN\244\173\DC2\170\SO\STXb\USw+z\173U\f\130\&4V\199\173\142\160\165\153\201\166\&4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropReceiveMaximum 30193,PropSharedSubscriptionAvailable 155,PropReasonString
// "\186Q\212\162\132=\234r\225\249\&1\219f\163X\214\229<\147\152s\224\EOTy\SOqp\254",PropMessageExpiryInterval
// 6080,PropCorrelationData "\NUL\167<Kig3\n\EOT\168k\DEL\145\235f\232t\237\176\209|\241#W\248\218",PropCorrelationData
// "\143\188",PropSubscriptionIdentifierAvailable 140,PropRetainAvailable 41,PropUserProperty
// "\190\191\CAN\SI\186\213\240\251b\NAK\131\219\\h\226#Y\235\218\135%\181\DELo\202"
// "\245l\174\171\182x\150\EM\223M\148\207\ETX\185\147\172\139\130#\a",PropSharedSubscriptionAvailable
// 210,PropMaximumPacketSize 12201,PropTopicAliasMaximum 21133,PropResponseInformation
// "\163\180\201\197\DEL\190\&1',\244n\234F\192n\236v5\237\193\139\197",PropSubscriptionIdentifierAvailable
// 183,PropTopicAlias 20595,PropRequestProblemInformation 147,PropTopicAlias 754,PropMessageExpiryInterval
// 26754,PropMaximumPacketSize 18986]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x82, 0xee, 0x1,  0x55, 0xc1, 0xb8, 0x1,  0x21, 0x75, 0xf1, 0x2a, 0x9b, 0x1f, 0x0,  0x1c, 0xba, 0x51, 0xd4, 0xa2,
      0x84, 0x3d, 0xea, 0x72, 0xe1, 0xf9, 0x31, 0xdb, 0x66, 0xa3, 0x58, 0xd6, 0xe5, 0x3c, 0x93, 0x98, 0x73, 0xe0, 0x4,
      0x79, 0xe,  0x71, 0x70, 0xfe, 0x2,  0x0,  0x0,  0x17, 0xc0, 0x9,  0x0,  0x1a, 0x0,  0xa7, 0x3c, 0x4b, 0x69, 0x67,
      0x33, 0xa,  0x4,  0xa8, 0x6b, 0x7f, 0x91, 0xeb, 0x66, 0xe8, 0x74, 0xed, 0xb0, 0xd1, 0x7c, 0xf1, 0x23, 0x57, 0xf8,
      0xda, 0x9,  0x0,  0x2,  0x8f, 0xbc, 0x29, 0x8c, 0x25, 0x29, 0x26, 0x0,  0x19, 0xbe, 0xbf, 0x18, 0xf,  0xba, 0xd5,
      0xf0, 0xfb, 0x62, 0x15, 0x83, 0xdb, 0x5c, 0x68, 0xe2, 0x23, 0x59, 0xeb, 0xda, 0x87, 0x25, 0xb5, 0x7f, 0x6f, 0xca,
      0x0,  0x14, 0xf5, 0x6c, 0xae, 0xab, 0xb6, 0x78, 0x96, 0x19, 0xdf, 0x4d, 0x94, 0xcf, 0x3,  0xb9, 0x93, 0xac, 0x8b,
      0x82, 0x23, 0x7,  0x2a, 0xd2, 0x27, 0x0,  0x0,  0x2f, 0xa9, 0x22, 0x52, 0x8d, 0x1a, 0x0,  0x16, 0xa3, 0xb4, 0xc9,
      0xc5, 0x7f, 0xbe, 0x31, 0x27, 0x2c, 0xf4, 0x6e, 0xea, 0x46, 0xc0, 0x6e, 0xec, 0x76, 0x35, 0xed, 0xc1, 0x8b, 0xc5,
      0x29, 0xb7, 0x23, 0x50, 0x73, 0x17, 0x93, 0x23, 0x2,  0xf2, 0x2,  0x0,  0x0,  0x68, 0x82, 0x27, 0x0,  0x0,  0x4a,
      0x2a, 0x0,  0x5,  0x2,  0xf5, 0xa0, 0xe8, 0x1a, 0x2,  0x0,  0x6,  0x2c, 0xd,  0xd7, 0xf3, 0xd9, 0x89, 0x2,  0x0,
      0x1e, 0x5,  0xc4, 0x4d, 0x16, 0xf4, 0xad, 0x12, 0xaa, 0xe,  0x2,  0x62, 0x1f, 0x77, 0x2b, 0x7a, 0xad, 0x55, 0xc,
      0x82, 0x34, 0x56, 0xc7, 0xad, 0x8e, 0xa0, 0xa5, 0x99, 0xc9, 0xa6, 0x34, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x2, 0xf5, 0xa0, 0xe8, 0x1a};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2c, 0xd, 0xd7, 0xf3, 0xd9, 0x89};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5,  0xc4, 0x4d, 0x16, 0xf4, 0xad, 0x12, 0xaa, 0xe,  0x2,
                                     0x62, 0x1f, 0x77, 0x2b, 0x7a, 0xad, 0x55, 0xc,  0x82, 0x34,
                                     0x56, 0xc7, 0xad, 0x8e, 0xa0, 0xa5, 0x99, 0xc9, 0xa6, 0x34};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0xba, 0x51, 0xd4, 0xa2, 0x84, 0x3d, 0xea, 0x72, 0xe1, 0xf9, 0x31, 0xdb, 0x66, 0xa3,
                           0x58, 0xd6, 0xe5, 0x3c, 0x93, 0x98, 0x73, 0xe0, 0x4,  0x79, 0xe,  0x71, 0x70, 0xfe};
  uint8_t bytesprops1[] = {0x0,  0xa7, 0x3c, 0x4b, 0x69, 0x67, 0x33, 0xa,  0x4,  0xa8, 0x6b, 0x7f, 0x91,
                           0xeb, 0x66, 0xe8, 0x74, 0xed, 0xb0, 0xd1, 0x7c, 0xf1, 0x23, 0x57, 0xf8, 0xda};
  uint8_t bytesprops2[] = {0x8f, 0xbc};
  uint8_t bytesprops4[] = {0xf5, 0x6c, 0xae, 0xab, 0xb6, 0x78, 0x96, 0x19, 0xdf, 0x4d,
                           0x94, 0xcf, 0x3,  0xb9, 0x93, 0xac, 0x8b, 0x82, 0x23, 0x7};
  uint8_t bytesprops3[] = {0xbe, 0xbf, 0x18, 0xf,  0xba, 0xd5, 0xf0, 0xfb, 0x62, 0x15, 0x83, 0xdb, 0x5c,
                           0x68, 0xe2, 0x23, 0x59, 0xeb, 0xda, 0x87, 0x25, 0xb5, 0x7f, 0x6f, 0xca};
  uint8_t bytesprops5[] = {0xa3, 0xb4, 0xc9, 0xc5, 0x7f, 0xbe, 0x31, 0x27, 0x2c, 0xf4, 0x6e,
                           0xea, 0x46, 0xc0, 0x6e, 0xec, 0x76, 0x35, 0xed, 0xc1, 0x8b, 0xc5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30193}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6080}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops3}, .v = {20, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12201}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21133}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20595}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 754}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26754}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18986}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21953, 3, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20725 [("\128b\134\ACK",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("e\184\fN\150\215\RSt\rh\167\248\DC1\152\SOH\247\EOT\209\136i\165",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropTopicAlias
// 14680,PropPayloadFormatIndicator 0,PropUserProperty "IS\SOH\230\233C\252\184\FS\220\US\\\235\&3a"
// "lD\236_\EOT\167",PropResponseInformation "R\212\205\237\\_\214\ACK\235Y\238\GS",PropRequestResponseInformation
// 191,PropResponseTopic
// "LQF\172b)2\131\SYN\164P}Lj\ESC\156\SOA\172\168U:\198\166\172x\151",PropSharedSubscriptionAvailable
// 208,PropServerKeepAlive 22506,PropTopicAlias 9830,PropAuthenticationMethod
// "\229\136\136R\144\210",PropSharedSubscriptionAvailable 204,PropSubscriptionIdentifier 29,PropMaximumQoS
// 236,PropMaximumQoS 243,PropSessionExpiryInterval 26039,PropSessionExpiryInterval 24855,PropMessageExpiryInterval
// 24941,PropRequestResponseInformation 207,PropResponseInformation
// "\160+8aU\141\140\231\CAN\185\219'\168o\191Me{p",PropMessageExpiryInterval 7768,PropReasonString
// "\253P\217\133\245\SUBy\160I?\211o\135!A\166:\237\205A\175n\243\176",PropMessageExpiryInterval 30412,PropContentType
// "\242\184z\NAK\ETB2\174\243\DC4D\216\181\242{\154\204\RS\187\ESC\fF\251\135\195*\180B\ETB",PropWildcardSubscriptionAvailable
// 92,PropSessionExpiryInterval 12455,PropSessionExpiryInterval 19717,PropSessionExpiryInterval
// 2146,PropSubscriptionIdentifier 30]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0x88, 0x2,  0x50, 0xf5, 0xe5, 0x1,  0x23, 0x39, 0x58, 0x1,  0x0,  0x26, 0x0,  0xf,  0x49, 0x53,
                   0x1,  0xe6, 0xe9, 0x43, 0xfc, 0xb8, 0x1c, 0xdc, 0x1f, 0x5c, 0xeb, 0x33, 0x61, 0x0,  0x6,  0x6c, 0x44,
                   0xec, 0x5f, 0x4,  0xa7, 0x1a, 0x0,  0xc,  0x52, 0xd4, 0xcd, 0xed, 0x5c, 0x5f, 0xd6, 0x6,  0xeb, 0x59,
                   0xee, 0x1d, 0x19, 0xbf, 0x8,  0x0,  0x1b, 0x4c, 0x51, 0x46, 0xac, 0x62, 0x29, 0x32, 0x83, 0x16, 0xa4,
                   0x50, 0x7d, 0x4c, 0x6a, 0x1b, 0x9c, 0xe,  0x41, 0xac, 0xa8, 0x55, 0x3a, 0xc6, 0xa6, 0xac, 0x78, 0x97,
                   0x2a, 0xd0, 0x13, 0x57, 0xea, 0x23, 0x26, 0x66, 0x15, 0x0,  0x6,  0xe5, 0x88, 0x88, 0x52, 0x90, 0xd2,
                   0x2a, 0xcc, 0xb,  0x1d, 0x24, 0xec, 0x24, 0xf3, 0x11, 0x0,  0x0,  0x65, 0xb7, 0x11, 0x0,  0x0,  0x61,
                   0x17, 0x2,  0x0,  0x0,  0x61, 0x6d, 0x19, 0xcf, 0x1a, 0x0,  0x13, 0xa0, 0x2b, 0x38, 0x61, 0x55, 0x8d,
                   0x8c, 0xe7, 0x18, 0xb9, 0xdb, 0x27, 0xa8, 0x6f, 0xbf, 0x4d, 0x65, 0x7b, 0x70, 0x2,  0x0,  0x0,  0x1e,
                   0x58, 0x1f, 0x0,  0x18, 0xfd, 0x50, 0xd9, 0x85, 0xf5, 0x1a, 0x79, 0xa0, 0x49, 0x3f, 0xd3, 0x6f, 0x87,
                   0x21, 0x41, 0xa6, 0x3a, 0xed, 0xcd, 0x41, 0xaf, 0x6e, 0xf3, 0xb0, 0x2,  0x0,  0x0,  0x76, 0xcc, 0x3,
                   0x0,  0x1c, 0xf2, 0xb8, 0x7a, 0x15, 0x17, 0x32, 0xae, 0xf3, 0x14, 0x44, 0xd8, 0xb5, 0xf2, 0x7b, 0x9a,
                   0xcc, 0x1e, 0xbb, 0x1b, 0xc,  0x46, 0xfb, 0x87, 0xc3, 0x2a, 0xb4, 0x42, 0x17, 0x28, 0x5c, 0x11, 0x0,
                   0x0,  0x30, 0xa7, 0x11, 0x0,  0x0,  0x4d, 0x5,  0x11, 0x0,  0x0,  0x8,  0x62, 0xb,  0x1e, 0x0,  0x4,
                   0x80, 0x62, 0x86, 0x6,  0x2,  0x0,  0x15, 0x65, 0xb8, 0xc,  0x4e, 0x96, 0xd7, 0x1e, 0x74, 0xd,  0x68,
                   0xa7, 0xf8, 0x11, 0x98, 0x1,  0xf7, 0x4,  0xd1, 0x88, 0x69, 0xa5, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x80, 0x62, 0x86, 0x6};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x65, 0xb8, 0xc,  0x4e, 0x96, 0xd7, 0x1e, 0x74, 0xd,  0x68, 0xa7,
                                     0xf8, 0x11, 0x98, 0x1,  0xf7, 0x4,  0xd1, 0x88, 0x69, 0xa5};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0};
  uint8_t bytesprops1[] = {0x6c, 0x44, 0xec, 0x5f, 0x4, 0xa7};
  uint8_t bytesprops0[] = {0x49, 0x53, 0x1, 0xe6, 0xe9, 0x43, 0xfc, 0xb8, 0x1c, 0xdc, 0x1f, 0x5c, 0xeb, 0x33, 0x61};
  uint8_t bytesprops2[] = {0x52, 0xd4, 0xcd, 0xed, 0x5c, 0x5f, 0xd6, 0x6, 0xeb, 0x59, 0xee, 0x1d};
  uint8_t bytesprops3[] = {0x4c, 0x51, 0x46, 0xac, 0x62, 0x29, 0x32, 0x83, 0x16, 0xa4, 0x50, 0x7d, 0x4c, 0x6a,
                           0x1b, 0x9c, 0xe,  0x41, 0xac, 0xa8, 0x55, 0x3a, 0xc6, 0xa6, 0xac, 0x78, 0x97};
  uint8_t bytesprops4[] = {0xe5, 0x88, 0x88, 0x52, 0x90, 0xd2};
  uint8_t bytesprops5[] = {0xa0, 0x2b, 0x38, 0x61, 0x55, 0x8d, 0x8c, 0xe7, 0x18, 0xb9,
                           0xdb, 0x27, 0xa8, 0x6f, 0xbf, 0x4d, 0x65, 0x7b, 0x70};
  uint8_t bytesprops6[] = {0xfd, 0x50, 0xd9, 0x85, 0xf5, 0x1a, 0x79, 0xa0, 0x49, 0x3f, 0xd3, 0x6f,
                           0x87, 0x21, 0x41, 0xa6, 0x3a, 0xed, 0xcd, 0x41, 0xaf, 0x6e, 0xf3, 0xb0};
  uint8_t bytesprops7[] = {0xf2, 0xb8, 0x7a, 0x15, 0x17, 0x32, 0xae, 0xf3, 0x14, 0x44, 0xd8, 0xb5, 0xf2, 0x7b,
                           0x9a, 0xcc, 0x1e, 0xbb, 0x1b, 0xc,  0x46, 0xfb, 0x87, 0xc3, 0x2a, 0xb4, 0x42, 0x17};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14680}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops0}, .v = {6, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22506}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9830}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26039}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24855}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24941}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7768}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30412}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12455}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19717}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2146}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 30}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20725, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24375 [("Xx.\181I\175\249\174u\214\foC'\226e\196\233\RS\136\225[0\172-y\128",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\203Dra\249\DC2s\SOe\167\r}\158\ETX\128\141\242?5\203\239\147",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("Y\242H\243&V\212K2\185\&2sq\178\178c\194\230\214)\\\237\ETX\SO",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\rm3\DEL,+L\150\CAN|9j\159\255g\206\t\FS=\160\201\&1",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropReceiveMaximum 17360,PropAuthenticationData
// "\177\138\226\210m\NAK~\NUL\207\ESC\SUB\236O\b\153\&1q",PropAuthenticationMethod
// "\178\233\240\SOHJZ\f\178\176eMt",PropPayloadFormatIndicator 232]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x96, 0x1,  0x5f, 0x37, 0x28, 0x21, 0x43, 0xd0, 0x16, 0x0,  0x11, 0xb1, 0x8a, 0xe2, 0xd2, 0x6d,
                   0x15, 0x7e, 0x0,  0xcf, 0x1b, 0x1a, 0xec, 0x4f, 0x8,  0x99, 0x31, 0x71, 0x15, 0x0,  0xc,  0xb2, 0xe9,
                   0xf0, 0x1,  0x4a, 0x5a, 0xc,  0xb2, 0xb0, 0x65, 0x4d, 0x74, 0x1,  0xe8, 0x0,  0x1b, 0x58, 0x78, 0x2e,
                   0xb5, 0x49, 0xaf, 0xf9, 0xae, 0x75, 0xd6, 0xc,  0x6f, 0x43, 0x27, 0xe2, 0x65, 0xc4, 0xe9, 0x1e, 0x88,
                   0xe1, 0x5b, 0x30, 0xac, 0x2d, 0x79, 0x80, 0x2,  0x0,  0x16, 0xcb, 0x44, 0x72, 0x61, 0xf9, 0x12, 0x73,
                   0xe,  0x65, 0xa7, 0xd,  0x7d, 0x9e, 0x3,  0x80, 0x8d, 0xf2, 0x3f, 0x35, 0xcb, 0xef, 0x93, 0x0,  0x0,
                   0x18, 0x59, 0xf2, 0x48, 0xf3, 0x26, 0x56, 0xd4, 0x4b, 0x32, 0xb9, 0x32, 0x73, 0x71, 0xb2, 0xb2, 0x63,
                   0xc2, 0xe6, 0xd6, 0x29, 0x5c, 0xed, 0x3,  0xe,  0x2,  0x0,  0x16, 0xd,  0x6d, 0x33, 0x7f, 0x2c, 0x2b,
                   0x4c, 0x96, 0x18, 0x7c, 0x39, 0x6a, 0x9f, 0xff, 0x67, 0xce, 0x9,  0x1c, 0x3d, 0xa0, 0xc9, 0x31, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x58, 0x78, 0x2e, 0xb5, 0x49, 0xaf, 0xf9, 0xae, 0x75, 0xd6, 0xc,  0x6f, 0x43, 0x27,
                                     0xe2, 0x65, 0xc4, 0xe9, 0x1e, 0x88, 0xe1, 0x5b, 0x30, 0xac, 0x2d, 0x79, 0x80};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xcb, 0x44, 0x72, 0x61, 0xf9, 0x12, 0x73, 0xe,  0x65, 0xa7, 0xd,
                                     0x7d, 0x9e, 0x3,  0x80, 0x8d, 0xf2, 0x3f, 0x35, 0xcb, 0xef, 0x93};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x59, 0xf2, 0x48, 0xf3, 0x26, 0x56, 0xd4, 0x4b, 0x32, 0xb9, 0x32, 0x73,
                                     0x71, 0xb2, 0xb2, 0x63, 0xc2, 0xe6, 0xd6, 0x29, 0x5c, 0xed, 0x3,  0xe};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd,  0x6d, 0x33, 0x7f, 0x2c, 0x2b, 0x4c, 0x96, 0x18, 0x7c, 0x39,
                                     0x6a, 0x9f, 0xff, 0x67, 0xce, 0x9,  0x1c, 0x3d, 0xa0, 0xc9, 0x31};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xb1, 0x8a, 0xe2, 0xd2, 0x6d, 0x15, 0x7e, 0x0, 0xcf,
                           0x1b, 0x1a, 0xec, 0x4f, 0x8,  0x99, 0x31, 0x71};
  uint8_t bytesprops1[] = {0xb2, 0xe9, 0xf0, 0x1, 0x4a, 0x5a, 0xc, 0xb2, 0xb0, 0x65, 0x4d, 0x74};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17360}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 232}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24375, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15182 [("jX\253\212\226>%\234\136\158",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("wv\141n\252k\ESC\242,\211jBIr\ESC\nN\254\RSG\227C\180/A\174\244\STX\228\222",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("WE\f\171+\DC1\ETB\v\EOT\DLE\176\tw_\SYN/\ETX",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\161AM\198\RS6\146w\219\173\244\245J>\201",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2}),("e\171N\STX\186ov\240\229\136D\\\234J\152e\217",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})]
// [PropPayloadFormatIndicator 22,PropReceiveMaximum 2396,PropSubscriptionIdentifierAvailable
// 176,PropAuthenticationMethod "e\214,\242:_\GS\141\NUL\208\RSf|?\EM\138j\234\138\220",PropMaximumPacketSize 12790]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0x8e, 0x1,  0x3b, 0x4e, 0x23, 0x1,  0x16, 0x21, 0x9,  0x5c, 0x29, 0xb0, 0x15, 0x0,  0x14, 0x65,
                   0xd6, 0x2c, 0xf2, 0x3a, 0x5f, 0x1d, 0x8d, 0x0,  0xd0, 0x1e, 0x66, 0x7c, 0x3f, 0x19, 0x8a, 0x6a, 0xea,
                   0x8a, 0xdc, 0x27, 0x0,  0x0,  0x31, 0xf6, 0x0,  0xa,  0x6a, 0x58, 0xfd, 0xd4, 0xe2, 0x3e, 0x25, 0xea,
                   0x88, 0x9e, 0x1,  0x0,  0x1e, 0x77, 0x76, 0x8d, 0x6e, 0xfc, 0x6b, 0x1b, 0xf2, 0x2c, 0xd3, 0x6a, 0x42,
                   0x49, 0x72, 0x1b, 0xa,  0x4e, 0xfe, 0x1e, 0x47, 0xe3, 0x43, 0xb4, 0x2f, 0x41, 0xae, 0xf4, 0x2,  0xe4,
                   0xde, 0x1,  0x0,  0x11, 0x57, 0x45, 0xc,  0xab, 0x2b, 0x11, 0x17, 0xb,  0x4,  0x10, 0xb0, 0x9,  0x77,
                   0x5f, 0x16, 0x2f, 0x3,  0x1,  0x0,  0xf,  0xa1, 0x41, 0x4d, 0xc6, 0x1e, 0x36, 0x92, 0x77, 0xdb, 0xad,
                   0xf4, 0xf5, 0x4a, 0x3e, 0xc9, 0x2,  0x0,  0x11, 0x65, 0xab, 0x4e, 0x2,  0xba, 0x6f, 0x76, 0xf0, 0xe5,
                   0x88, 0x44, 0x5c, 0xea, 0x4a, 0x98, 0x65, 0xd9, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x6a, 0x58, 0xfd, 0xd4, 0xe2, 0x3e, 0x25, 0xea, 0x88, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x77, 0x76, 0x8d, 0x6e, 0xfc, 0x6b, 0x1b, 0xf2, 0x2c, 0xd3,
                                     0x6a, 0x42, 0x49, 0x72, 0x1b, 0xa,  0x4e, 0xfe, 0x1e, 0x47,
                                     0xe3, 0x43, 0xb4, 0x2f, 0x41, 0xae, 0xf4, 0x2,  0xe4, 0xde};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x57, 0x45, 0xc, 0xab, 0x2b, 0x11, 0x17, 0xb, 0x4,
                                     0x10, 0xb0, 0x9, 0x77, 0x5f, 0x16, 0x2f, 0x3};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa1, 0x41, 0x4d, 0xc6, 0x1e, 0x36, 0x92, 0x77,
                                     0xdb, 0xad, 0xf4, 0xf5, 0x4a, 0x3e, 0xc9};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x65, 0xab, 0x4e, 0x2,  0xba, 0x6f, 0x76, 0xf0, 0xe5,
                                     0x88, 0x44, 0x5c, 0xea, 0x4a, 0x98, 0x65, 0xd9};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x65, 0xd6, 0x2c, 0xf2, 0x3a, 0x5f, 0x1d, 0x8d, 0x0,  0xd0,
                           0x1e, 0x66, 0x7c, 0x3f, 0x19, 0x8a, 0x6a, 0xea, 0x8a, 0xdc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2396}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12790}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15182, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29268 [("\142",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS =
// QoS0}),("5\254\147\212\152\233@<\242\195\191\180#\\Sl\SI\249(\174P\136\239\"B\182\139\218",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\229\173x
// \159d\157\161F\133y\253\&4\185\191h\167\231\noU\SI/\158\193\239",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(";Q=\182\248\245\152C&\221k\173\153\ESC\151\156",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("Q\168tf\193i\245\US\ENQ\177nl\202/\177",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\177\139\193I\228b\DLEvi\211\r{\aRg",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\195E\216",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("l\151\230\r\129\b\184\193\176\178\162\197\&5\188/\SO\187",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),(" k\147",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropRetainAvailable
// 230,PropReceiveMaximum 11250,PropReceiveMaximum 12353,PropContentType
// "\NAK4\163\226\165\169z\SO\139\182w^\204",PropPayloadFormatIndicator 139,PropRequestProblemInformation
// 197,PropMaximumQoS 7,PropTopicAliasMaximum 7500,PropTopicAlias 27990,PropReceiveMaximum 17963,PropResponseTopic
// "\128\218\250Y\217\199\219\235 .\158\246\137\219\205",PropWildcardSubscriptionAvailable 69,PropTopicAliasMaximum
// 22545,PropTopicAliasMaximum 6468,PropSharedSubscriptionAvailable 80,PropSharedSubscriptionAvailable 228]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0xdf, 0x1,  0x72, 0x54, 0x45, 0x25, 0xe6, 0x21, 0x2b, 0xf2, 0x21, 0x30, 0x41, 0x3,  0x0,  0xd,  0x15, 0x34,
      0xa3, 0xe2, 0xa5, 0xa9, 0x7a, 0xe,  0x8b, 0xb6, 0x77, 0x5e, 0xcc, 0x1,  0x8b, 0x17, 0xc5, 0x24, 0x7,  0x22, 0x1d,
      0x4c, 0x23, 0x6d, 0x56, 0x21, 0x46, 0x2b, 0x8,  0x0,  0xf,  0x80, 0xda, 0xfa, 0x59, 0xd9, 0xc7, 0xdb, 0xeb, 0x20,
      0x2e, 0x9e, 0xf6, 0x89, 0xdb, 0xcd, 0x28, 0x45, 0x22, 0x58, 0x11, 0x22, 0x19, 0x44, 0x2a, 0x50, 0x2a, 0xe4, 0x0,
      0x1,  0x8e, 0x0,  0x0,  0x1c, 0x35, 0xfe, 0x93, 0xd4, 0x98, 0xe9, 0x40, 0x3c, 0xf2, 0xc3, 0xbf, 0xb4, 0x23, 0x5c,
      0x53, 0x6c, 0xf,  0xf9, 0x28, 0xae, 0x50, 0x88, 0xef, 0x22, 0x42, 0xb6, 0x8b, 0xda, 0x1,  0x0,  0x1a, 0xe5, 0xad,
      0x78, 0x20, 0x9f, 0x64, 0x9d, 0xa1, 0x46, 0x85, 0x79, 0xfd, 0x34, 0xb9, 0xbf, 0x68, 0xa7, 0xe7, 0xa,  0x6f, 0x55,
      0xf,  0x2f, 0x9e, 0xc1, 0xef, 0x0,  0x0,  0x10, 0x3b, 0x51, 0x3d, 0xb6, 0xf8, 0xf5, 0x98, 0x43, 0x26, 0xdd, 0x6b,
      0xad, 0x99, 0x1b, 0x97, 0x9c, 0x2,  0x0,  0xf,  0x51, 0xa8, 0x74, 0x66, 0xc1, 0x69, 0xf5, 0x1f, 0x5,  0xb1, 0x6e,
      0x6c, 0xca, 0x2f, 0xb1, 0x1,  0x0,  0xf,  0xb1, 0x8b, 0xc1, 0x49, 0xe4, 0x62, 0x10, 0x76, 0x69, 0xd3, 0xd,  0x7b,
      0x7,  0x52, 0x67, 0x1,  0x0,  0x3,  0xc3, 0x45, 0xd8, 0x2,  0x0,  0x11, 0x6c, 0x97, 0xe6, 0xd,  0x81, 0x8,  0xb8,
      0xc1, 0xb0, 0xb2, 0xa2, 0xc5, 0x35, 0xbc, 0x2f, 0xe,  0xbb, 0x0,  0x0,  0x3,  0x20, 0x6b, 0x93, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x8e};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x35, 0xfe, 0x93, 0xd4, 0x98, 0xe9, 0x40, 0x3c, 0xf2, 0xc3,
                                     0xbf, 0xb4, 0x23, 0x5c, 0x53, 0x6c, 0xf,  0xf9, 0x28, 0xae,
                                     0x50, 0x88, 0xef, 0x22, 0x42, 0xb6, 0x8b, 0xda};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0xad, 0x78, 0x20, 0x9f, 0x64, 0x9d, 0xa1, 0x46, 0x85, 0x79, 0xfd, 0x34,
                                     0xb9, 0xbf, 0x68, 0xa7, 0xe7, 0xa,  0x6f, 0x55, 0xf,  0x2f, 0x9e, 0xc1, 0xef};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3b, 0x51, 0x3d, 0xb6, 0xf8, 0xf5, 0x98, 0x43,
                                     0x26, 0xdd, 0x6b, 0xad, 0x99, 0x1b, 0x97, 0x9c};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x51, 0xa8, 0x74, 0x66, 0xc1, 0x69, 0xf5, 0x1f,
                                     0x5,  0xb1, 0x6e, 0x6c, 0xca, 0x2f, 0xb1};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb1, 0x8b, 0xc1, 0x49, 0xe4, 0x62, 0x10, 0x76,
                                     0x69, 0xd3, 0xd,  0x7b, 0x7,  0x52, 0x67};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc3, 0x45, 0xd8};
  lwmqtt_string_t topic_filter_s6 = {3, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6c, 0x97, 0xe6, 0xd,  0x81, 0x8,  0xb8, 0xc1, 0xb0,
                                     0xb2, 0xa2, 0xc5, 0x35, 0xbc, 0x2f, 0xe,  0xbb};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x20, 0x6b, 0x93};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1,
                               LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x15, 0x34, 0xa3, 0xe2, 0xa5, 0xa9, 0x7a, 0xe, 0x8b, 0xb6, 0x77, 0x5e, 0xcc};
  uint8_t bytesprops1[] = {0x80, 0xda, 0xfa, 0x59, 0xd9, 0xc7, 0xdb, 0xeb, 0x20, 0x2e, 0x9e, 0xf6, 0x89, 0xdb, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11250}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12353}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7500}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27990}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17963}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22545}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6468}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 228}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29268, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30528 [("Z7\246b'",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\248\161\240\135Q\130\198oV\RS\187~7'\DC2@\ACK~i\213csX\200kE\240",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\248\215\167X\a\184",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("W\139~\240\234\n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\226\223\ETXA\170{\FS\197RN\147X\161\ESC\SI\a\197\vB3\232\220\160{\136\242\&5\150\150",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\134\236\184\180A/4\206\134\176p\163\&6\NUL\RS$\US\200\CAN\DELU\156\224",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\ENQ\177",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\207\&1\134\149\169\137_\145\\\185,\187\242\226\135J>\203\203B\245\196\147\239\168\212\167\145\219",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",\176\197p\224M\\\200",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\155w\224D\180\218\161\221r@3\"\131\FS\184\204\160",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropServerReference
// "\236.\US\173\184\196J\207\233*d\SO\SOAD\155\ba\r",PropPayloadFormatIndicator 174,PropAuthenticationData
// "\141\234\239\130"]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0xd8, 0x1,  0x77, 0x40, 0x1f, 0x1c, 0x0,  0x13, 0xec, 0x2e, 0x1f, 0xad, 0xb8, 0xc4, 0x4a, 0xcf,
                   0xe9, 0x2a, 0x64, 0xe,  0xe,  0x41, 0x44, 0x9b, 0x8,  0x61, 0xd,  0x1,  0xae, 0x16, 0x0,  0x4,  0x8d,
                   0xea, 0xef, 0x82, 0x0,  0x5,  0x5a, 0x37, 0xf6, 0x62, 0x27, 0x1,  0x0,  0x1b, 0xf8, 0xa1, 0xf0, 0x87,
                   0x51, 0x82, 0xc6, 0x6f, 0x56, 0x1e, 0xbb, 0x7e, 0x37, 0x27, 0x12, 0x40, 0x6,  0x7e, 0x69, 0xd5, 0x63,
                   0x73, 0x58, 0xc8, 0x6b, 0x45, 0xf0, 0x2,  0x0,  0x6,  0xf8, 0xd7, 0xa7, 0x58, 0x7,  0xb8, 0x1,  0x0,
                   0x6,  0x57, 0x8b, 0x7e, 0xf0, 0xea, 0xa,  0x2,  0x0,  0x1d, 0xe2, 0xdf, 0x3,  0x41, 0xaa, 0x7b, 0x1c,
                   0xc5, 0x52, 0x4e, 0x93, 0x58, 0xa1, 0x1b, 0xf,  0x7,  0xc5, 0xb,  0x42, 0x33, 0xe8, 0xdc, 0xa0, 0x7b,
                   0x88, 0xf2, 0x35, 0x96, 0x96, 0x2,  0x0,  0x17, 0x86, 0xec, 0xb8, 0xb4, 0x41, 0x2f, 0x34, 0xce, 0x86,
                   0xb0, 0x70, 0xa3, 0x36, 0x0,  0x1e, 0x24, 0x1f, 0xc8, 0x18, 0x7f, 0x55, 0x9c, 0xe0, 0x0,  0x0,  0x2,
                   0x5,  0xb1, 0x2,  0x0,  0x1d, 0xcf, 0x31, 0x86, 0x95, 0xa9, 0x89, 0x5f, 0x91, 0x5c, 0xb9, 0x2c, 0xbb,
                   0xf2, 0xe2, 0x87, 0x4a, 0x3e, 0xcb, 0xcb, 0x42, 0xf5, 0xc4, 0x93, 0xef, 0xa8, 0xd4, 0xa7, 0x91, 0xdb,
                   0x0,  0x0,  0x8,  0x2c, 0xb0, 0xc5, 0x70, 0xe0, 0x4d, 0x5c, 0xc8, 0x0,  0x0,  0x11, 0x9b, 0x77, 0xe0,
                   0x44, 0xb4, 0xda, 0xa1, 0xdd, 0x72, 0x40, 0x33, 0x22, 0x83, 0x1c, 0xb8, 0xcc, 0xa0, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x5a, 0x37, 0xf6, 0x62, 0x27};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf8, 0xa1, 0xf0, 0x87, 0x51, 0x82, 0xc6, 0x6f, 0x56, 0x1e, 0xbb, 0x7e, 0x37, 0x27,
                                     0x12, 0x40, 0x6,  0x7e, 0x69, 0xd5, 0x63, 0x73, 0x58, 0xc8, 0x6b, 0x45, 0xf0};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf8, 0xd7, 0xa7, 0x58, 0x7, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x57, 0x8b, 0x7e, 0xf0, 0xea, 0xa};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe2, 0xdf, 0x3,  0x41, 0xaa, 0x7b, 0x1c, 0xc5, 0x52, 0x4e,
                                     0x93, 0x58, 0xa1, 0x1b, 0xf,  0x7,  0xc5, 0xb,  0x42, 0x33,
                                     0xe8, 0xdc, 0xa0, 0x7b, 0x88, 0xf2, 0x35, 0x96, 0x96};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x86, 0xec, 0xb8, 0xb4, 0x41, 0x2f, 0x34, 0xce, 0x86, 0xb0, 0x70, 0xa3,
                                     0x36, 0x0,  0x1e, 0x24, 0x1f, 0xc8, 0x18, 0x7f, 0x55, 0x9c, 0xe0};
  lwmqtt_string_t topic_filter_s5 = {23, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5, 0xb1};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xcf, 0x31, 0x86, 0x95, 0xa9, 0x89, 0x5f, 0x91, 0x5c, 0xb9,
                                     0x2c, 0xbb, 0xf2, 0xe2, 0x87, 0x4a, 0x3e, 0xcb, 0xcb, 0x42,
                                     0xf5, 0xc4, 0x93, 0xef, 0xa8, 0xd4, 0xa7, 0x91, 0xdb};
  lwmqtt_string_t topic_filter_s7 = {29, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2c, 0xb0, 0xc5, 0x70, 0xe0, 0x4d, 0x5c, 0xc8};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x9b, 0x77, 0xe0, 0x44, 0xb4, 0xda, 0xa1, 0xdd, 0x72,
                                     0x40, 0x33, 0x22, 0x83, 0x1c, 0xb8, 0xcc, 0xa0};
  lwmqtt_string_t topic_filter_s9 = {17, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xec, 0x2e, 0x1f, 0xad, 0xb8, 0xc4, 0x4a, 0xcf, 0xe9, 0x2a,
                           0x64, 0xe,  0xe,  0x41, 0x44, 0x9b, 0x8,  0x61, 0xd};
  uint8_t bytesprops1[] = {0x8d, 0xea, 0xef, 0x82};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30528, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32298 [("\183B\236P\DC4\RS0\245>\186\t\170R\GS\ESC\SI\234\151\246\224",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropRequestResponseInformation
// 237,PropServerReference ".]r\136\&1\229.",PropUserProperty "'\192\242\220\159\a\198\"\151\155\251\132yZ\223\135{"
// "\154\v\199\217\EM\FS/\179wz\184",PropMaximumPacketSize 16608,PropAssignedClientIdentifier
// "\207",PropSubscriptionIdentifierAvailable 150,PropServerKeepAlive 31252,PropSessionExpiryInterval
// 27950,PropResponseTopic "Pc<\170",PropMessageExpiryInterval 8676,PropServerKeepAlive 14073,PropReasonString
// "\CAN\DC2\DC4K\SI\212D\188\171\161+\133\SYNn&kS\218\223u]\161\198/",PropRequestProblemInformation
// 70,PropRetainAvailable 136]
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x88, 0x1,  0x7e, 0x2a, 0x6e, 0x19, 0xed, 0x1c, 0x0,  0x7,  0x2e, 0x5d, 0x72, 0x88, 0x31,
                   0xe5, 0x2e, 0x26, 0x0,  0x11, 0x27, 0xc0, 0xf2, 0xdc, 0x9f, 0x7,  0xc6, 0x22, 0x97, 0x9b, 0xfb,
                   0x84, 0x79, 0x5a, 0xdf, 0x87, 0x7b, 0x0,  0xb,  0x9a, 0xb,  0xc7, 0xd9, 0x19, 0x1c, 0x2f, 0xb3,
                   0x77, 0x7a, 0xb8, 0x27, 0x0,  0x0,  0x40, 0xe0, 0x12, 0x0,  0x1,  0xcf, 0x29, 0x96, 0x13, 0x7a,
                   0x14, 0x11, 0x0,  0x0,  0x6d, 0x2e, 0x8,  0x0,  0x4,  0x50, 0x63, 0x3c, 0xaa, 0x2,  0x0,  0x0,
                   0x21, 0xe4, 0x13, 0x36, 0xf9, 0x1f, 0x0,  0x18, 0x18, 0x12, 0x14, 0x4b, 0xf,  0xd4, 0x44, 0xbc,
                   0xab, 0xa1, 0x2b, 0x85, 0x16, 0x6e, 0x26, 0x6b, 0x53, 0xda, 0xdf, 0x75, 0x5d, 0xa1, 0xc6, 0x2f,
                   0x17, 0x46, 0x25, 0x88, 0x0,  0x14, 0xb7, 0x42, 0xec, 0x50, 0x14, 0x1e, 0x30, 0xf5, 0x3e, 0xba,
                   0x9,  0xaa, 0x52, 0x1d, 0x1b, 0xf,  0xea, 0x97, 0xf6, 0xe0, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xb7, 0x42, 0xec, 0x50, 0x14, 0x1e, 0x30, 0xf5, 0x3e, 0xba,
                                     0x9,  0xaa, 0x52, 0x1d, 0x1b, 0xf,  0xea, 0x97, 0xf6, 0xe0};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x2e, 0x5d, 0x72, 0x88, 0x31, 0xe5, 0x2e};
  uint8_t bytesprops2[] = {0x9a, 0xb, 0xc7, 0xd9, 0x19, 0x1c, 0x2f, 0xb3, 0x77, 0x7a, 0xb8};
  uint8_t bytesprops1[] = {0x27, 0xc0, 0xf2, 0xdc, 0x9f, 0x7,  0xc6, 0x22, 0x97,
                           0x9b, 0xfb, 0x84, 0x79, 0x5a, 0xdf, 0x87, 0x7b};
  uint8_t bytesprops3[] = {0xcf};
  uint8_t bytesprops4[] = {0x50, 0x63, 0x3c, 0xaa};
  uint8_t bytesprops5[] = {0x18, 0x12, 0x14, 0x4b, 0xf,  0xd4, 0x44, 0xbc, 0xab, 0xa1, 0x2b, 0x85,
                           0x16, 0x6e, 0x26, 0x6b, 0x53, 0xda, 0xdf, 0x75, 0x5d, 0xa1, 0xc6, 0x2f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16608}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31252}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27950}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8676}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14073}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 136}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32298, 1, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22169 [("\185n'\131\192M\162\EOTR\199\DC3\248G\138\NULjj\129\249\191\177\183D\200WU",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\247j\216\229\244\&4\DLEvoHjH\NUL\236\161\&64",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\130O\195\&2/BI\149/\183\137\146\218\179\CAN\198\212\174\&3a\191\158\214K\209\173p@\130",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\182g\162\186\175\184\210\ACKc>I\183\153\SO\176\v\255\221\&0L_\231Z",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\149\178\207\218V\235\209\189K6\143\DC3",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] [PropResponseTopic "\202B\213%\169\204'",PropMessageExpiryInterval
// 8353,PropMaximumQoS 188,PropMaximumPacketSize 4183,PropWildcardSubscriptionAvailable 203,PropReceiveMaximum
// 12629,PropReceiveMaximum 28020,PropTopicAlias 3381,PropWildcardSubscriptionAvailable
// 6,PropSubscriptionIdentifierAvailable 228,PropAuthenticationMethod "\153\ETBl;",PropAuthenticationData
// "\235@RK\\]\199\t\184$\251\172\&1\248j\217\233\b\251_\DC3=p\150\178\220\200",PropPayloadFormatIndicator
// 232,PropMaximumPacketSize 26137,PropAuthenticationData
// "\DC3>\176\CANO\159\a\DC43\135-\173\136\249\158\&2\191\184X\192\180\213\DC4\141\\\207\234*u",PropResponseInformation
// "]PYw\173\ETXJ\131\128\184\&0\152\254\247\215",PropCorrelationData "\202*d\183F\147)",PropSessionExpiryInterval
// 18520,PropRetainAvailable 28,PropSharedSubscriptionAvailable 172,PropSharedSubscriptionAvailable
// 47,PropCorrelationData "\149C\STX\254\158\173\205k\166\141\159\200\DC2\145g\ETB\SO",PropPayloadFormatIndicator
// 7,PropMessageExpiryInterval 11013,PropWildcardSubscriptionAvailable 170,PropMaximumQoS 9]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x82, 0xb5, 0x2,  0x56, 0x99, 0xb7, 0x1,  0x8,  0x0,  0x7,  0xca, 0x42, 0xd5, 0x25, 0xa9, 0xcc, 0x27, 0x2,  0x0,
      0x0,  0x20, 0xa1, 0x24, 0xbc, 0x27, 0x0,  0x0,  0x10, 0x57, 0x28, 0xcb, 0x21, 0x31, 0x55, 0x21, 0x6d, 0x74, 0x23,
      0xd,  0x35, 0x28, 0x6,  0x29, 0xe4, 0x15, 0x0,  0x4,  0x99, 0x17, 0x6c, 0x3b, 0x16, 0x0,  0x1b, 0xeb, 0x40, 0x52,
      0x4b, 0x5c, 0x5d, 0xc7, 0x9,  0xb8, 0x24, 0xfb, 0xac, 0x31, 0xf8, 0x6a, 0xd9, 0xe9, 0x8,  0xfb, 0x5f, 0x13, 0x3d,
      0x70, 0x96, 0xb2, 0xdc, 0xc8, 0x1,  0xe8, 0x27, 0x0,  0x0,  0x66, 0x19, 0x16, 0x0,  0x1d, 0x13, 0x3e, 0xb0, 0x18,
      0x4f, 0x9f, 0x7,  0x14, 0x33, 0x87, 0x2d, 0xad, 0x88, 0xf9, 0x9e, 0x32, 0xbf, 0xb8, 0x58, 0xc0, 0xb4, 0xd5, 0x14,
      0x8d, 0x5c, 0xcf, 0xea, 0x2a, 0x75, 0x1a, 0x0,  0xf,  0x5d, 0x50, 0x59, 0x77, 0xad, 0x3,  0x4a, 0x83, 0x80, 0xb8,
      0x30, 0x98, 0xfe, 0xf7, 0xd7, 0x9,  0x0,  0x7,  0xca, 0x2a, 0x64, 0xb7, 0x46, 0x93, 0x29, 0x11, 0x0,  0x0,  0x48,
      0x58, 0x25, 0x1c, 0x2a, 0xac, 0x2a, 0x2f, 0x9,  0x0,  0x11, 0x95, 0x43, 0x2,  0xfe, 0x9e, 0xad, 0xcd, 0x6b, 0xa6,
      0x8d, 0x9f, 0xc8, 0x12, 0x91, 0x67, 0x17, 0xe,  0x1,  0x7,  0x2,  0x0,  0x0,  0x2b, 0x5,  0x28, 0xaa, 0x24, 0x9,
      0x0,  0x1a, 0xb9, 0x6e, 0x27, 0x83, 0xc0, 0x4d, 0xa2, 0x4,  0x52, 0xc7, 0x13, 0xf8, 0x47, 0x8a, 0x0,  0x6a, 0x6a,
      0x81, 0xf9, 0xbf, 0xb1, 0xb7, 0x44, 0xc8, 0x57, 0x55, 0x1,  0x0,  0x11, 0xf7, 0x6a, 0xd8, 0xe5, 0xf4, 0x34, 0x10,
      0x76, 0x6f, 0x48, 0x6a, 0x48, 0x0,  0xec, 0xa1, 0x36, 0x34, 0x2,  0x0,  0x1d, 0x82, 0x4f, 0xc3, 0x32, 0x2f, 0x42,
      0x49, 0x95, 0x2f, 0xb7, 0x89, 0x92, 0xda, 0xb3, 0x18, 0xc6, 0xd4, 0xae, 0x33, 0x61, 0xbf, 0x9e, 0xd6, 0x4b, 0xd1,
      0xad, 0x70, 0x40, 0x82, 0x1,  0x0,  0x17, 0xb6, 0x67, 0xa2, 0xba, 0xaf, 0xb8, 0xd2, 0x6,  0x63, 0x3e, 0x49, 0xb7,
      0x99, 0xe,  0xb0, 0xb,  0xff, 0xdd, 0x30, 0x4c, 0x5f, 0xe7, 0x5a, 0x2,  0x0,  0xc,  0x95, 0xb2, 0xcf, 0xda, 0x56,
      0xeb, 0xd1, 0xbd, 0x4b, 0x36, 0x8f, 0x13, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xb9, 0x6e, 0x27, 0x83, 0xc0, 0x4d, 0xa2, 0x4,  0x52, 0xc7, 0x13, 0xf8, 0x47,
                                     0x8a, 0x0,  0x6a, 0x6a, 0x81, 0xf9, 0xbf, 0xb1, 0xb7, 0x44, 0xc8, 0x57, 0x55};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf7, 0x6a, 0xd8, 0xe5, 0xf4, 0x34, 0x10, 0x76, 0x6f,
                                     0x48, 0x6a, 0x48, 0x0,  0xec, 0xa1, 0x36, 0x34};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x82, 0x4f, 0xc3, 0x32, 0x2f, 0x42, 0x49, 0x95, 0x2f, 0xb7,
                                     0x89, 0x92, 0xda, 0xb3, 0x18, 0xc6, 0xd4, 0xae, 0x33, 0x61,
                                     0xbf, 0x9e, 0xd6, 0x4b, 0xd1, 0xad, 0x70, 0x40, 0x82};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0x67, 0xa2, 0xba, 0xaf, 0xb8, 0xd2, 0x6,  0x63, 0x3e, 0x49, 0xb7,
                                     0x99, 0xe,  0xb0, 0xb,  0xff, 0xdd, 0x30, 0x4c, 0x5f, 0xe7, 0x5a};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x95, 0xb2, 0xcf, 0xda, 0x56, 0xeb, 0xd1, 0xbd, 0x4b, 0x36, 0x8f, 0x13};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xca, 0x42, 0xd5, 0x25, 0xa9, 0xcc, 0x27};
  uint8_t bytesprops1[] = {0x99, 0x17, 0x6c, 0x3b};
  uint8_t bytesprops2[] = {0xeb, 0x40, 0x52, 0x4b, 0x5c, 0x5d, 0xc7, 0x9,  0xb8, 0x24, 0xfb, 0xac, 0x31, 0xf8,
                           0x6a, 0xd9, 0xe9, 0x8,  0xfb, 0x5f, 0x13, 0x3d, 0x70, 0x96, 0xb2, 0xdc, 0xc8};
  uint8_t bytesprops3[] = {0x13, 0x3e, 0xb0, 0x18, 0x4f, 0x9f, 0x7,  0x14, 0x33, 0x87, 0x2d, 0xad, 0x88, 0xf9, 0x9e,
                           0x32, 0xbf, 0xb8, 0x58, 0xc0, 0xb4, 0xd5, 0x14, 0x8d, 0x5c, 0xcf, 0xea, 0x2a, 0x75};
  uint8_t bytesprops4[] = {0x5d, 0x50, 0x59, 0x77, 0xad, 0x3, 0x4a, 0x83, 0x80, 0xb8, 0x30, 0x98, 0xfe, 0xf7, 0xd7};
  uint8_t bytesprops5[] = {0xca, 0x2a, 0x64, 0xb7, 0x46, 0x93, 0x29};
  uint8_t bytesprops6[] = {0x95, 0x43, 0x2,  0xfe, 0x9e, 0xad, 0xcd, 0x6b, 0xa6,
                           0x8d, 0x9f, 0xc8, 0x12, 0x91, 0x67, 0x17, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8353}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4183}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12629}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28020}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3381}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26137}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18520}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11013}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 9}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22169, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26097 [("v\164\210X\179\135t\206\&0\177\165^\196\160\166\NUL78m}\195Z\147.rbC\177s9",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\255q\244\v\147\250\213/\143\151\&8\168\&9",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("l\168W:Wa\253\147\225\RS\164\242-;r')",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\DC15\NUL\236\249\231\210\141\246\n\ENQ\v\248\RS\USX\132\CAN\214\143w\202\139;]4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\231A\154h\ETX\223a\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2})] [PropSubscriptionIdentifierAvailable 148,PropServerKeepAlive
// 6026,PropRequestProblemInformation 208,PropReceiveMaximum 1568,PropSessionExpiryInterval
// 6779,PropWildcardSubscriptionAvailable 41,PropCorrelationData
// "\161q\177U\178\194&M\208\&9\141\186\248\ACK\240\176\188q\226!\159\206\235\144\f",PropReasonString
// "",PropMessageExpiryInterval 26488,PropWillDelayInterval 12556]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0xaa, 0x1,  0x65, 0xf1, 0x3a, 0x29, 0x94, 0x13, 0x17, 0x8a, 0x17, 0xd0, 0x21, 0x6,  0x20,
                   0x11, 0x0,  0x0,  0x1a, 0x7b, 0x28, 0x29, 0x9,  0x0,  0x19, 0xa1, 0x71, 0xb1, 0x55, 0xb2, 0xc2,
                   0x26, 0x4d, 0xd0, 0x39, 0x8d, 0xba, 0xf8, 0x6,  0xf0, 0xb0, 0xbc, 0x71, 0xe2, 0x21, 0x9f, 0xce,
                   0xeb, 0x90, 0xc,  0x1f, 0x0,  0x0,  0x2,  0x0,  0x0,  0x67, 0x78, 0x18, 0x0,  0x0,  0x31, 0xc,
                   0x0,  0x1e, 0x76, 0xa4, 0xd2, 0x58, 0xb3, 0x87, 0x74, 0xce, 0x30, 0xb1, 0xa5, 0x5e, 0xc4, 0xa0,
                   0xa6, 0x0,  0x37, 0x38, 0x6d, 0x7d, 0xc3, 0x5a, 0x93, 0x2e, 0x72, 0x62, 0x43, 0xb1, 0x73, 0x39,
                   0x2,  0x0,  0xd,  0xff, 0x71, 0xf4, 0xb,  0x93, 0xfa, 0xd5, 0x2f, 0x8f, 0x97, 0x38, 0xa8, 0x39,
                   0x0,  0x0,  0x11, 0x6c, 0xa8, 0x57, 0x3a, 0x57, 0x61, 0xfd, 0x93, 0xe1, 0x1e, 0xa4, 0xf2, 0x2d,
                   0x3b, 0x72, 0x27, 0x29, 0x0,  0x0,  0x1a, 0x11, 0x35, 0x0,  0xec, 0xf9, 0xe7, 0xd2, 0x8d, 0xf6,
                   0xa,  0x5,  0xb,  0xf8, 0x1e, 0x1f, 0x58, 0x84, 0x18, 0xd6, 0x8f, 0x77, 0xca, 0x8b, 0x3b, 0x5d,
                   0x34, 0x0,  0x0,  0x8,  0xe7, 0x41, 0x9a, 0x68, 0x3,  0xdf, 0x61, 0xc5, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x76, 0xa4, 0xd2, 0x58, 0xb3, 0x87, 0x74, 0xce, 0x30, 0xb1,
                                     0xa5, 0x5e, 0xc4, 0xa0, 0xa6, 0x0,  0x37, 0x38, 0x6d, 0x7d,
                                     0xc3, 0x5a, 0x93, 0x2e, 0x72, 0x62, 0x43, 0xb1, 0x73, 0x39};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xff, 0x71, 0xf4, 0xb, 0x93, 0xfa, 0xd5, 0x2f, 0x8f, 0x97, 0x38, 0xa8, 0x39};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6c, 0xa8, 0x57, 0x3a, 0x57, 0x61, 0xfd, 0x93, 0xe1,
                                     0x1e, 0xa4, 0xf2, 0x2d, 0x3b, 0x72, 0x27, 0x29};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x11, 0x35, 0x0,  0xec, 0xf9, 0xe7, 0xd2, 0x8d, 0xf6, 0xa,  0x5,  0xb,  0xf8,
                                     0x1e, 0x1f, 0x58, 0x84, 0x18, 0xd6, 0x8f, 0x77, 0xca, 0x8b, 0x3b, 0x5d, 0x34};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe7, 0x41, 0x9a, 0x68, 0x3, 0xdf, 0x61, 0xc5};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0xa1, 0x71, 0xb1, 0x55, 0xb2, 0xc2, 0x26, 0x4d, 0xd0, 0x39, 0x8d, 0xba, 0xf8,
                           0x6,  0xf0, 0xb0, 0xbc, 0x71, 0xe2, 0x21, 0x9f, 0xce, 0xeb, 0x90, 0xc};
  uint8_t bytesprops1[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6026}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1568}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6779}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26488}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12556}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26097, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25578 [("\151\169\n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("\129L\179D\b\\\136\147\&3\187\140\205\216\221\151\ENQ\149\128\155\211\210E\ENQ\240\&8q\203\180",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("F\219rm{\255\FS\161\228\207\147\157(\236.\DC1\150\EM$|\138p\253$u\SYN8\237\ENQ",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\196\SO\SI\252\189a\168*\239<\226M(\228'\183H\223\&9\165\220\ACK\229R\158\151\209n\151\248",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropReasonString
// "\211\230\aA;\158,;\159\208\233\171\239\224\206",PropRequestResponseInformation 10]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x7d, 0x63, 0xea, 0x14, 0x1f, 0x0,  0xf,  0xd3, 0xe6, 0x7,  0x41, 0x3b, 0x9e, 0x2c, 0x3b,
                   0x9f, 0xd0, 0xe9, 0xab, 0xef, 0xe0, 0xce, 0x19, 0xa,  0x0,  0x3,  0x97, 0xa9, 0xa,  0x0,  0x0,
                   0x1c, 0x81, 0x4c, 0xb3, 0x44, 0x8,  0x5c, 0x88, 0x93, 0x33, 0xbb, 0x8c, 0xcd, 0xd8, 0xdd, 0x97,
                   0x5,  0x95, 0x80, 0x9b, 0xd3, 0xd2, 0x45, 0x5,  0xf0, 0x38, 0x71, 0xcb, 0xb4, 0x2,  0x0,  0x1d,
                   0x46, 0xdb, 0x72, 0x6d, 0x7b, 0xff, 0x1c, 0xa1, 0xe4, 0xcf, 0x93, 0x9d, 0x28, 0xec, 0x2e, 0x11,
                   0x96, 0x19, 0x24, 0x7c, 0x8a, 0x70, 0xfd, 0x24, 0x75, 0x16, 0x38, 0xed, 0x5,  0x0,  0x0,  0x1e,
                   0xc4, 0xe,  0xf,  0xfc, 0xbd, 0x61, 0xa8, 0x2a, 0xef, 0x3c, 0xe2, 0x4d, 0x28, 0xe4, 0x27, 0xb7,
                   0x48, 0xdf, 0x39, 0xa5, 0xdc, 0x6,  0xe5, 0x52, 0x9e, 0x97, 0xd1, 0x6e, 0x97, 0xf8, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x97, 0xa9, 0xa};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x81, 0x4c, 0xb3, 0x44, 0x8,  0x5c, 0x88, 0x93, 0x33, 0xbb,
                                     0x8c, 0xcd, 0xd8, 0xdd, 0x97, 0x5,  0x95, 0x80, 0x9b, 0xd3,
                                     0xd2, 0x45, 0x5,  0xf0, 0x38, 0x71, 0xcb, 0xb4};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x46, 0xdb, 0x72, 0x6d, 0x7b, 0xff, 0x1c, 0xa1, 0xe4, 0xcf,
                                     0x93, 0x9d, 0x28, 0xec, 0x2e, 0x11, 0x96, 0x19, 0x24, 0x7c,
                                     0x8a, 0x70, 0xfd, 0x24, 0x75, 0x16, 0x38, 0xed, 0x5};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc4, 0xe,  0xf,  0xfc, 0xbd, 0x61, 0xa8, 0x2a, 0xef, 0x3c,
                                     0xe2, 0x4d, 0x28, 0xe4, 0x27, 0xb7, 0x48, 0xdf, 0x39, 0xa5,
                                     0xdc, 0x6,  0xe5, 0x52, 0x9e, 0x97, 0xd1, 0x6e, 0x97, 0xf8};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xd3, 0xe6, 0x7, 0x41, 0x3b, 0x9e, 0x2c, 0x3b, 0x9f, 0xd0, 0xe9, 0xab, 0xef, 0xe0, 0xce};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 10}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25578, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14161 [("\242\138%q\US\GSY\176\129}=\247",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\STX\132g\171\169\132\132\181\237\223\182gx,",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("g\EMP\174+`\222\SUBP",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("b\255\135\184;\253\174\185R",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\236:H\144\155\245+7\DLE\145K>\160Hi\229",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropRetainAvailable
// 229,PropSharedSubscriptionAvailable 181,PropCorrelationData "\168@\222\135S\201,v\DC3\EMCs\188",PropServerReference
// "#\254\ETXo%\246\FS\140UU\199R",PropMaximumPacketSize 4981,PropRequestResponseInformation 181,PropResponseInformation
// "K\132N\150\155f, \ENQ",PropMaximumQoS 117,PropTopicAliasMaximum 19076,PropSharedSubscriptionAvailable
// 135,PropReceiveMaximum 2513,PropTopicAliasMaximum 21119,PropAuthenticationData
// "<\167\NUL6\EMj\162\178\172\131D\181\176\177",PropMaximumQoS 149,PropWillDelayInterval
// 14956,PropSubscriptionIdentifier 2,PropMessageExpiryInterval 1459,PropSubscriptionIdentifierAvailable
// 38,PropContentType "D\237w\230`^\229o\237\&2\185k",PropRetainAvailable 253,PropResponseInformation ""]
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0xc6, 0x1,  0x37, 0x51, 0x78, 0x25, 0xe5, 0x2a, 0xb5, 0x9,  0x0,  0xd,  0xa8, 0x40, 0xde, 0x87,
                   0x53, 0xc9, 0x2c, 0x76, 0x13, 0x19, 0x43, 0x73, 0xbc, 0x1c, 0x0,  0xc,  0x23, 0xfe, 0x3,  0x6f, 0x25,
                   0xf6, 0x1c, 0x8c, 0x55, 0x55, 0xc7, 0x52, 0x27, 0x0,  0x0,  0x13, 0x75, 0x19, 0xb5, 0x1a, 0x0,  0x9,
                   0x4b, 0x84, 0x4e, 0x96, 0x9b, 0x66, 0x2c, 0x20, 0x5,  0x24, 0x75, 0x22, 0x4a, 0x84, 0x2a, 0x87, 0x21,
                   0x9,  0xd1, 0x22, 0x52, 0x7f, 0x16, 0x0,  0xe,  0x3c, 0xa7, 0x0,  0x36, 0x19, 0x6a, 0xa2, 0xb2, 0xac,
                   0x83, 0x44, 0xb5, 0xb0, 0xb1, 0x24, 0x95, 0x18, 0x0,  0x0,  0x3a, 0x6c, 0xb,  0x2,  0x2,  0x0,  0x0,
                   0x5,  0xb3, 0x29, 0x26, 0x3,  0x0,  0xc,  0x44, 0xed, 0x77, 0xe6, 0x60, 0x5e, 0xe5, 0x6f, 0xed, 0x32,
                   0xb9, 0x6b, 0x25, 0xfd, 0x1a, 0x0,  0x0,  0x0,  0xc,  0xf2, 0x8a, 0x25, 0x71, 0x1f, 0x1d, 0x59, 0xb0,
                   0x81, 0x7d, 0x3d, 0xf7, 0x1,  0x0,  0xe,  0x2,  0x84, 0x67, 0xab, 0xa9, 0x84, 0x84, 0xb5, 0xed, 0xdf,
                   0xb6, 0x67, 0x78, 0x2c, 0x0,  0x0,  0x9,  0x67, 0x19, 0x50, 0xae, 0x2b, 0x60, 0xde, 0x1a, 0x50, 0x0,
                   0x0,  0x9,  0x62, 0xff, 0x87, 0xb8, 0x3b, 0xfd, 0xae, 0xb9, 0x52, 0x2,  0x0,  0x10, 0xec, 0x3a, 0x48,
                   0x90, 0x9b, 0xf5, 0x2b, 0x37, 0x10, 0x91, 0x4b, 0x3e, 0xa0, 0x48, 0x69, 0xe5, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xf2, 0x8a, 0x25, 0x71, 0x1f, 0x1d, 0x59, 0xb0, 0x81, 0x7d, 0x3d, 0xf7};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2, 0x84, 0x67, 0xab, 0xa9, 0x84, 0x84, 0xb5, 0xed, 0xdf, 0xb6, 0x67, 0x78, 0x2c};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x67, 0x19, 0x50, 0xae, 0x2b, 0x60, 0xde, 0x1a, 0x50};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x62, 0xff, 0x87, 0xb8, 0x3b, 0xfd, 0xae, 0xb9, 0x52};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xec, 0x3a, 0x48, 0x90, 0x9b, 0xf5, 0x2b, 0x37,
                                     0x10, 0x91, 0x4b, 0x3e, 0xa0, 0x48, 0x69, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xa8, 0x40, 0xde, 0x87, 0x53, 0xc9, 0x2c, 0x76, 0x13, 0x19, 0x43, 0x73, 0xbc};
  uint8_t bytesprops1[] = {0x23, 0xfe, 0x3, 0x6f, 0x25, 0xf6, 0x1c, 0x8c, 0x55, 0x55, 0xc7, 0x52};
  uint8_t bytesprops2[] = {0x4b, 0x84, 0x4e, 0x96, 0x9b, 0x66, 0x2c, 0x20, 0x5};
  uint8_t bytesprops3[] = {0x3c, 0xa7, 0x0, 0x36, 0x19, 0x6a, 0xa2, 0xb2, 0xac, 0x83, 0x44, 0xb5, 0xb0, 0xb1};
  uint8_t bytesprops4[] = {0x44, 0xed, 0x77, 0xe6, 0x60, 0x5e, 0xe5, 0x6f, 0xed, 0x32, 0xb9, 0x6b};
  uint8_t bytesprops5[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4981}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19076}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2513}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21119}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14956}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1459}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14161, 5, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 3024 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\151\241\217",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("O\234$\nG\215\255\&2\ETB\153\&8\213\230\161zr\149C\SOH",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(".\ETB\199\SYN\173\&1M\183\r\232",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\RSe\157a\193\189\&8%\189\238lr\136\251\194l\\\219ii",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\n\222\134\168\193\203",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1})] [PropSubscriptionIdentifier 22,PropSubscriptionIdentifierAvailable
// 190,PropSessionExpiryInterval 31925,PropRetainAvailable 98,PropRequestResponseInformation 158,PropMaximumPacketSize
// 29435,PropAssignedClientIdentifier
// "n\134\201Y\ACK\225;%\USv\239v$r\229H\247\255\155<\SYN\235K\233",PropServerKeepAlive
// 12673,PropRequestProblemInformation 198,PropReasonString
// "\203\253!A\ETX\198\166\145\160\215\147\f\170\EOT\216\168\230\245\SI",PropServerReference "\174'",PropTopicAlias
// 17867]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x9f, 0x1,  0xb,  0xd0, 0x50, 0xb,  0x16, 0x29, 0xbe, 0x11, 0x0,  0x0,  0x7c, 0xb5, 0x25, 0x62,
                   0x19, 0x9e, 0x27, 0x0,  0x0,  0x72, 0xfb, 0x12, 0x0,  0x18, 0x6e, 0x86, 0xc9, 0x59, 0x6,  0xe1, 0x3b,
                   0x25, 0x1f, 0x76, 0xef, 0x76, 0x24, 0x72, 0xe5, 0x48, 0xf7, 0xff, 0x9b, 0x3c, 0x16, 0xeb, 0x4b, 0xe9,
                   0x13, 0x31, 0x81, 0x17, 0xc6, 0x1f, 0x0,  0x13, 0xcb, 0xfd, 0x21, 0x41, 0x3,  0xc6, 0xa6, 0x91, 0xa0,
                   0xd7, 0x93, 0xc,  0xaa, 0x4,  0xd8, 0xa8, 0xe6, 0xf5, 0xf,  0x1c, 0x0,  0x2,  0xae, 0x27, 0x23, 0x45,
                   0xcb, 0x0,  0x0,  0x1,  0x0,  0x3,  0x97, 0xf1, 0xd9, 0x1,  0x0,  0x13, 0x4f, 0xea, 0x24, 0xa,  0x47,
                   0xd7, 0xff, 0x32, 0x17, 0x99, 0x38, 0xd5, 0xe6, 0xa1, 0x7a, 0x72, 0x95, 0x43, 0x1,  0x0,  0x0,  0xa,
                   0x2e, 0x17, 0xc7, 0x16, 0xad, 0x31, 0x4d, 0xb7, 0xd,  0xe8, 0x1,  0x0,  0x14, 0x1e, 0x65, 0x9d, 0x61,
                   0xc1, 0xbd, 0x38, 0x25, 0xbd, 0xee, 0x6c, 0x72, 0x88, 0xfb, 0xc2, 0x6c, 0x5c, 0xdb, 0x69, 0x69, 0x0,
                   0x0,  0x6,  0xa,  0xde, 0x86, 0xa8, 0xc1, 0xcb, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x97, 0xf1, 0xd9};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4f, 0xea, 0x24, 0xa,  0x47, 0xd7, 0xff, 0x32, 0x17, 0x99,
                                     0x38, 0xd5, 0xe6, 0xa1, 0x7a, 0x72, 0x95, 0x43, 0x1};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2e, 0x17, 0xc7, 0x16, 0xad, 0x31, 0x4d, 0xb7, 0xd, 0xe8};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1e, 0x65, 0x9d, 0x61, 0xc1, 0xbd, 0x38, 0x25, 0xbd, 0xee,
                                     0x6c, 0x72, 0x88, 0xfb, 0xc2, 0x6c, 0x5c, 0xdb, 0x69, 0x69};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa, 0xde, 0x86, 0xa8, 0xc1, 0xcb};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x6e, 0x86, 0xc9, 0x59, 0x6,  0xe1, 0x3b, 0x25, 0x1f, 0x76, 0xef, 0x76,
                           0x24, 0x72, 0xe5, 0x48, 0xf7, 0xff, 0x9b, 0x3c, 0x16, 0xeb, 0x4b, 0xe9};
  uint8_t bytesprops1[] = {0xcb, 0xfd, 0x21, 0x41, 0x3,  0xc6, 0xa6, 0x91, 0xa0, 0xd7,
                           0x93, 0xc,  0xaa, 0x4,  0xd8, 0xa8, 0xe6, 0xf5, 0xf};
  uint8_t bytesprops2[] = {0xae, 0x27};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31925}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29435}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12673}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17867}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 3024, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9912 [("\204\190\NUL\161\131\ETB\243~\129\US,\199",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\DC1\203\202\209\&0T*Orh\223",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})]
// [PropSessionExpiryInterval 23397,PropMessageExpiryInterval 16143,PropPayloadFormatIndicator
// 2,PropSubscriptionIdentifier 28,PropWildcardSubscriptionAvailable 213,PropAuthenticationData
// "\203\203\200",PropServerReference
// "\152$\189\SYN\199Nol\157q(\249\200\136\DC2;\183\188\182H\176\246\DC3\155\135\234\196\192f2",PropUserProperty
// "\177\250R\155\221\159" "\134\190V\142z\v\RS\fS\STX4\220\226(.\166@Y\DC4\161C\231f\188\245\NUL",PropMaximumPacketSize
// 31086,PropMessageExpiryInterval 23028,PropResponseInformation
// "}\137\226\219\STX\232\167}\186{7\207#\235\SO\141B\177\203\146m\199\DC2\SYN\164\207$@",PropCorrelationData
// "\200\141\155\249\214g\178\NAK\195HO\244J;\137\136\SYN\174y\216J\139\&5\198\232\247\171$\209",PropAssignedClientIdentifier
// "\254",PropCorrelationData ";W\145\174\193\229\224",PropAuthenticationMethod
// "\163\175\160\202\SYNo\SYN\226\220\235\208\r\183&&",PropServerKeepAlive 16294,PropTopicAliasMaximum
// 7201,PropRetainAvailable 72,PropAuthenticationData "_",PropServerKeepAlive 9880]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0xf5, 0x1,  0x26, 0xb8, 0xd4, 0x1,  0x11, 0x0,  0x0,  0x5b, 0x65, 0x2,  0x0,  0x0,  0x3f, 0xf,
                   0x1,  0x2,  0xb,  0x1c, 0x28, 0xd5, 0x16, 0x0,  0x3,  0xcb, 0xcb, 0xc8, 0x1c, 0x0,  0x1e, 0x98, 0x24,
                   0xbd, 0x16, 0xc7, 0x4e, 0x6f, 0x6c, 0x9d, 0x71, 0x28, 0xf9, 0xc8, 0x88, 0x12, 0x3b, 0xb7, 0xbc, 0xb6,
                   0x48, 0xb0, 0xf6, 0x13, 0x9b, 0x87, 0xea, 0xc4, 0xc0, 0x66, 0x32, 0x26, 0x0,  0x6,  0xb1, 0xfa, 0x52,
                   0x9b, 0xdd, 0x9f, 0x0,  0x1a, 0x86, 0xbe, 0x56, 0x8e, 0x7a, 0xb,  0x1e, 0xc,  0x53, 0x2,  0x34, 0xdc,
                   0xe2, 0x28, 0x2e, 0xa6, 0x40, 0x59, 0x14, 0xa1, 0x43, 0xe7, 0x66, 0xbc, 0xf5, 0x0,  0x27, 0x0,  0x0,
                   0x79, 0x6e, 0x2,  0x0,  0x0,  0x59, 0xf4, 0x1a, 0x0,  0x1c, 0x7d, 0x89, 0xe2, 0xdb, 0x2,  0xe8, 0xa7,
                   0x7d, 0xba, 0x7b, 0x37, 0xcf, 0x23, 0xeb, 0xe,  0x8d, 0x42, 0xb1, 0xcb, 0x92, 0x6d, 0xc7, 0x12, 0x16,
                   0xa4, 0xcf, 0x24, 0x40, 0x9,  0x0,  0x1d, 0xc8, 0x8d, 0x9b, 0xf9, 0xd6, 0x67, 0xb2, 0x15, 0xc3, 0x48,
                   0x4f, 0xf4, 0x4a, 0x3b, 0x89, 0x88, 0x16, 0xae, 0x79, 0xd8, 0x4a, 0x8b, 0x35, 0xc6, 0xe8, 0xf7, 0xab,
                   0x24, 0xd1, 0x12, 0x0,  0x1,  0xfe, 0x9,  0x0,  0x7,  0x3b, 0x57, 0x91, 0xae, 0xc1, 0xe5, 0xe0, 0x15,
                   0x0,  0xf,  0xa3, 0xaf, 0xa0, 0xca, 0x16, 0x6f, 0x16, 0xe2, 0xdc, 0xeb, 0xd0, 0xd,  0xb7, 0x26, 0x26,
                   0x13, 0x3f, 0xa6, 0x22, 0x1c, 0x21, 0x25, 0x48, 0x16, 0x0,  0x1,  0x5f, 0x13, 0x26, 0x98, 0x0,  0xc,
                   0xcc, 0xbe, 0x0,  0xa1, 0x83, 0x17, 0xf3, 0x7e, 0x81, 0x1f, 0x2c, 0xc7, 0x2,  0x0,  0xb,  0x11, 0xcb,
                   0xca, 0xd1, 0x30, 0x54, 0x2a, 0x4f, 0x72, 0x68, 0xdf, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xcc, 0xbe, 0x0, 0xa1, 0x83, 0x17, 0xf3, 0x7e, 0x81, 0x1f, 0x2c, 0xc7};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x11, 0xcb, 0xca, 0xd1, 0x30, 0x54, 0x2a, 0x4f, 0x72, 0x68, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xcb, 0xcb, 0xc8};
  uint8_t bytesprops1[] = {0x98, 0x24, 0xbd, 0x16, 0xc7, 0x4e, 0x6f, 0x6c, 0x9d, 0x71, 0x28, 0xf9, 0xc8, 0x88, 0x12,
                           0x3b, 0xb7, 0xbc, 0xb6, 0x48, 0xb0, 0xf6, 0x13, 0x9b, 0x87, 0xea, 0xc4, 0xc0, 0x66, 0x32};
  uint8_t bytesprops3[] = {0x86, 0xbe, 0x56, 0x8e, 0x7a, 0xb,  0x1e, 0xc,  0x53, 0x2,  0x34, 0xdc, 0xe2,
                           0x28, 0x2e, 0xa6, 0x40, 0x59, 0x14, 0xa1, 0x43, 0xe7, 0x66, 0xbc, 0xf5, 0x0};
  uint8_t bytesprops2[] = {0xb1, 0xfa, 0x52, 0x9b, 0xdd, 0x9f};
  uint8_t bytesprops4[] = {0x7d, 0x89, 0xe2, 0xdb, 0x2,  0xe8, 0xa7, 0x7d, 0xba, 0x7b, 0x37, 0xcf, 0x23, 0xeb,
                           0xe,  0x8d, 0x42, 0xb1, 0xcb, 0x92, 0x6d, 0xc7, 0x12, 0x16, 0xa4, 0xcf, 0x24, 0x40};
  uint8_t bytesprops5[] = {0xc8, 0x8d, 0x9b, 0xf9, 0xd6, 0x67, 0xb2, 0x15, 0xc3, 0x48, 0x4f, 0xf4, 0x4a, 0x3b, 0x89,
                           0x88, 0x16, 0xae, 0x79, 0xd8, 0x4a, 0x8b, 0x35, 0xc6, 0xe8, 0xf7, 0xab, 0x24, 0xd1};
  uint8_t bytesprops6[] = {0xfe};
  uint8_t bytesprops7[] = {0x3b, 0x57, 0x91, 0xae, 0xc1, 0xe5, 0xe0};
  uint8_t bytesprops8[] = {0xa3, 0xaf, 0xa0, 0xca, 0x16, 0x6f, 0x16, 0xe2, 0xdc, 0xeb, 0xd0, 0xd, 0xb7, 0x26, 0x26};
  uint8_t bytesprops9[] = {0x5f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23397}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16143}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 28}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops2}, .v = {26, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31086}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23028}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16294}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7201}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9880}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9912, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1301 [("\169n\168\166N\214\SUB\136\156\134\ETX\228",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\135#\130r\206\254\133s<\ACK\143\200\154\229\227\169\217\244'",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\fBj\fR\208\210\189\190\148\STX\164}\163\214\183[\143",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("k\172\154\253f\170\&7\CANjg\185\r\ESC\192\ENQQi}\209\SI",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\239\236Y\220\224\191\&6",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\SIw*X&\ty\181\188:}\219,}\247\219>\NAK\167\177j0\188\197L\232@EJ",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\ACK2c\237\191\199*",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\206Cz\139\148\189dN%",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\141=\196\133f1r\DELf#h\161,8\131",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropReceiveMaximum 25435,PropResponseInformation
// "\SO\202\a\208j",PropAssignedClientIdentifier
// "\140\131\133\CAN\r\193\218\195\205\167\RS\SOS5\153\226\197r\FS1^\186\DC4\148\162\194",PropMessageExpiryInterval
// 7651,PropMessageExpiryInterval 22861,PropRequestProblemInformation 27,PropServerKeepAlive
// 2068,PropMessageExpiryInterval 6609,PropWillDelayInterval 16160,PropWillDelayInterval 17380,PropResponseInformation
// "M",PropResponseInformation
// "\136\128\193\SYN\DEL(\245#\166\220\177\176\ESCT\211\249%\207dt\170\152\244\175\215K\t)\133",PropTopicAlias 14154]
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x82, 0x93, 0x2,  0x5,  0x15, 0x6d, 0x21, 0x63, 0x5b, 0x1a, 0x0,  0x5,  0xe,  0xca, 0x7,  0xd0, 0x6a, 0x12, 0x0,
      0x1a, 0x8c, 0x83, 0x85, 0x18, 0xd,  0xc1, 0xda, 0xc3, 0xcd, 0xa7, 0x1e, 0xe,  0x53, 0x35, 0x99, 0xe2, 0xc5, 0x72,
      0x1c, 0x31, 0x5e, 0xba, 0x14, 0x94, 0xa2, 0xc2, 0x2,  0x0,  0x0,  0x1d, 0xe3, 0x2,  0x0,  0x0,  0x59, 0x4d, 0x17,
      0x1b, 0x13, 0x8,  0x14, 0x2,  0x0,  0x0,  0x19, 0xd1, 0x18, 0x0,  0x0,  0x3f, 0x20, 0x18, 0x0,  0x0,  0x43, 0xe4,
      0x1a, 0x0,  0x1,  0x4d, 0x1a, 0x0,  0x1d, 0x88, 0x80, 0xc1, 0x16, 0x7f, 0x28, 0xf5, 0x23, 0xa6, 0xdc, 0xb1, 0xb0,
      0x1b, 0x54, 0xd3, 0xf9, 0x25, 0xcf, 0x64, 0x74, 0xaa, 0x98, 0xf4, 0xaf, 0xd7, 0x4b, 0x9,  0x29, 0x85, 0x23, 0x37,
      0x4a, 0x0,  0xc,  0xa9, 0x6e, 0xa8, 0xa6, 0x4e, 0xd6, 0x1a, 0x88, 0x9c, 0x86, 0x3,  0xe4, 0x2,  0x0,  0x13, 0x87,
      0x23, 0x82, 0x72, 0xce, 0xfe, 0x85, 0x73, 0x3c, 0x6,  0x8f, 0xc8, 0x9a, 0xe5, 0xe3, 0xa9, 0xd9, 0xf4, 0x27, 0x2,
      0x0,  0x12, 0xc,  0x42, 0x6a, 0xc,  0x52, 0xd0, 0xd2, 0xbd, 0xbe, 0x94, 0x2,  0xa4, 0x7d, 0xa3, 0xd6, 0xb7, 0x5b,
      0x8f, 0x2,  0x0,  0x14, 0x6b, 0xac, 0x9a, 0xfd, 0x66, 0xaa, 0x37, 0x18, 0x6a, 0x67, 0xb9, 0xd,  0x1b, 0xc0, 0x5,
      0x51, 0x69, 0x7d, 0xd1, 0xf,  0x0,  0x0,  0x7,  0xef, 0xec, 0x59, 0xdc, 0xe0, 0xbf, 0x36, 0x1,  0x0,  0x1d, 0xf,
      0x77, 0x2a, 0x58, 0x26, 0x9,  0x79, 0xb5, 0xbc, 0x3a, 0x7d, 0xdb, 0x2c, 0x7d, 0xf7, 0xdb, 0x3e, 0x15, 0xa7, 0xb1,
      0x6a, 0x30, 0xbc, 0xc5, 0x4c, 0xe8, 0x40, 0x45, 0x4a, 0x2,  0x0,  0x7,  0x6,  0x32, 0x63, 0xed, 0xbf, 0xc7, 0x2a,
      0x1,  0x0,  0x9,  0xce, 0x43, 0x7a, 0x8b, 0x94, 0xbd, 0x64, 0x4e, 0x25, 0x2,  0x0,  0xf,  0x8d, 0x3d, 0xc4, 0x85,
      0x66, 0x31, 0x72, 0x7f, 0x66, 0x23, 0x68, 0xa1, 0x2c, 0x38, 0x83, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xa9, 0x6e, 0xa8, 0xa6, 0x4e, 0xd6, 0x1a, 0x88, 0x9c, 0x86, 0x3, 0xe4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x87, 0x23, 0x82, 0x72, 0xce, 0xfe, 0x85, 0x73, 0x3c, 0x6,
                                     0x8f, 0xc8, 0x9a, 0xe5, 0xe3, 0xa9, 0xd9, 0xf4, 0x27};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc,  0x42, 0x6a, 0xc,  0x52, 0xd0, 0xd2, 0xbd, 0xbe,
                                     0x94, 0x2,  0xa4, 0x7d, 0xa3, 0xd6, 0xb7, 0x5b, 0x8f};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6b, 0xac, 0x9a, 0xfd, 0x66, 0xaa, 0x37, 0x18, 0x6a, 0x67,
                                     0xb9, 0xd,  0x1b, 0xc0, 0x5,  0x51, 0x69, 0x7d, 0xd1, 0xf};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xef, 0xec, 0x59, 0xdc, 0xe0, 0xbf, 0x36};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf,  0x77, 0x2a, 0x58, 0x26, 0x9,  0x79, 0xb5, 0xbc, 0x3a,
                                     0x7d, 0xdb, 0x2c, 0x7d, 0xf7, 0xdb, 0x3e, 0x15, 0xa7, 0xb1,
                                     0x6a, 0x30, 0xbc, 0xc5, 0x4c, 0xe8, 0x40, 0x45, 0x4a};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6, 0x32, 0x63, 0xed, 0xbf, 0xc7, 0x2a};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xce, 0x43, 0x7a, 0x8b, 0x94, 0xbd, 0x64, 0x4e, 0x25};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x8d, 0x3d, 0xc4, 0x85, 0x66, 0x31, 0x72, 0x7f,
                                     0x66, 0x23, 0x68, 0xa1, 0x2c, 0x38, 0x83};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1,
                               LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xe, 0xca, 0x7, 0xd0, 0x6a};
  uint8_t bytesprops1[] = {0x8c, 0x83, 0x85, 0x18, 0xd,  0xc1, 0xda, 0xc3, 0xcd, 0xa7, 0x1e, 0xe,  0x53,
                           0x35, 0x99, 0xe2, 0xc5, 0x72, 0x1c, 0x31, 0x5e, 0xba, 0x14, 0x94, 0xa2, 0xc2};
  uint8_t bytesprops2[] = {0x4d};
  uint8_t bytesprops3[] = {0x88, 0x80, 0xc1, 0x16, 0x7f, 0x28, 0xf5, 0x23, 0xa6, 0xdc, 0xb1, 0xb0, 0x1b, 0x54, 0xd3,
                           0xf9, 0x25, 0xcf, 0x64, 0x74, 0xaa, 0x98, 0xf4, 0xaf, 0xd7, 0x4b, 0x9,  0x29, 0x85};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25435}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7651}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22861}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2068}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6609}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16160}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17380}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14154}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 1301, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8636 [("\145uzU$\EOTvLk\130\217\133\&5f:\185\180q\t\227B\204\209^",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\185\215\&3\186z",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("5\240\228\136\145<\174p",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1}),("\"\254g\248Z\ENQ\150\248I.\136:B\b\221BoA",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\155\131g\SOH\199\215Z\164\242\159",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("M\225pW\t\184D\fV\167\186\130\231o\189t\217\233\152\213I@\r\150\142c",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropSubscriptionIdentifierAvailable
// 62,PropTopicAlias 25483,PropMaximumQoS 171,PropResponseTopic "]Q[}\219\128\134\170\173\"",PropContentType
// "XXlf1\154\"\130@\204LDr\EMR\233\139\176\DEL=",PropSubscriptionIdentifier 15,PropMaximumPacketSize
// 21894,PropWillDelayInterval 8279,PropCorrelationData "\193\EOT;\210^\219y\bm \250\249\214V_-\248 \STX\244\STX:)"]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0xc1, 0x1,  0x21, 0xbc, 0x51, 0x29, 0x3e, 0x23, 0x63, 0x8b, 0x24, 0xab, 0x8,  0x0,  0xa,  0x5d,
                   0x51, 0x5b, 0x7d, 0xdb, 0x80, 0x86, 0xaa, 0xad, 0x22, 0x3,  0x0,  0x14, 0x58, 0x58, 0x6c, 0x66, 0x31,
                   0x9a, 0x22, 0x82, 0x40, 0xcc, 0x4c, 0x44, 0x72, 0x19, 0x52, 0xe9, 0x8b, 0xb0, 0x7f, 0x3d, 0xb,  0xf,
                   0x27, 0x0,  0x0,  0x55, 0x86, 0x18, 0x0,  0x0,  0x20, 0x57, 0x9,  0x0,  0x17, 0xc1, 0x4,  0x3b, 0xd2,
                   0x5e, 0xdb, 0x79, 0x8,  0x6d, 0x20, 0xfa, 0xf9, 0xd6, 0x56, 0x5f, 0x2d, 0xf8, 0x20, 0x2,  0xf4, 0x2,
                   0x3a, 0x29, 0x0,  0x18, 0x91, 0x75, 0x7a, 0x55, 0x24, 0x4,  0x76, 0x4c, 0x6b, 0x82, 0xd9, 0x85, 0x35,
                   0x66, 0x3a, 0xb9, 0xb4, 0x71, 0x9,  0xe3, 0x42, 0xcc, 0xd1, 0x5e, 0x1,  0x0,  0x5,  0xb9, 0xd7, 0x33,
                   0xba, 0x7a, 0x0,  0x0,  0x8,  0x35, 0xf0, 0xe4, 0x88, 0x91, 0x3c, 0xae, 0x70, 0x1,  0x0,  0x12, 0x22,
                   0xfe, 0x67, 0xf8, 0x5a, 0x5,  0x96, 0xf8, 0x49, 0x2e, 0x88, 0x3a, 0x42, 0x8,  0xdd, 0x42, 0x6f, 0x41,
                   0x2,  0x0,  0xa,  0x9b, 0x83, 0x67, 0x1,  0xc7, 0xd7, 0x5a, 0xa4, 0xf2, 0x9f, 0x2,  0x0,  0x1a, 0x4d,
                   0xe1, 0x70, 0x57, 0x9,  0xb8, 0x44, 0xc,  0x56, 0xa7, 0xba, 0x82, 0xe7, 0x6f, 0xbd, 0x74, 0xd9, 0xe9,
                   0x98, 0xd5, 0x49, 0x40, 0xd,  0x96, 0x8e, 0x63, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x91, 0x75, 0x7a, 0x55, 0x24, 0x4,  0x76, 0x4c, 0x6b, 0x82, 0xd9, 0x85,
                                     0x35, 0x66, 0x3a, 0xb9, 0xb4, 0x71, 0x9,  0xe3, 0x42, 0xcc, 0xd1, 0x5e};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb9, 0xd7, 0x33, 0xba, 0x7a};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0xf0, 0xe4, 0x88, 0x91, 0x3c, 0xae, 0x70};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x22, 0xfe, 0x67, 0xf8, 0x5a, 0x5,  0x96, 0xf8, 0x49,
                                     0x2e, 0x88, 0x3a, 0x42, 0x8,  0xdd, 0x42, 0x6f, 0x41};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9b, 0x83, 0x67, 0x1, 0xc7, 0xd7, 0x5a, 0xa4, 0xf2, 0x9f};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4d, 0xe1, 0x70, 0x57, 0x9,  0xb8, 0x44, 0xc,  0x56, 0xa7, 0xba, 0x82, 0xe7,
                                     0x6f, 0xbd, 0x74, 0xd9, 0xe9, 0x98, 0xd5, 0x49, 0x40, 0xd,  0x96, 0x8e, 0x63};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x5d, 0x51, 0x5b, 0x7d, 0xdb, 0x80, 0x86, 0xaa, 0xad, 0x22};
  uint8_t bytesprops1[] = {0x58, 0x58, 0x6c, 0x66, 0x31, 0x9a, 0x22, 0x82, 0x40, 0xcc,
                           0x4c, 0x44, 0x72, 0x19, 0x52, 0xe9, 0x8b, 0xb0, 0x7f, 0x3d};
  uint8_t bytesprops2[] = {0xc1, 0x4,  0x3b, 0xd2, 0x5e, 0xdb, 0x79, 0x8,  0x6d, 0x20, 0xfa, 0xf9,
                           0xd6, 0x56, 0x5f, 0x2d, 0xf8, 0x20, 0x2,  0xf4, 0x2,  0x3a, 0x29};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25483}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21894}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8279}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8636, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23343 [("\b\226\228",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),(",6p\US\ESC\233\166\168\SOb@\"\155\182\DEL\213\251\214/\233\209nSD\174Y\147\191",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("[1\251\168#\EOT\140\140\&0)\DC2\159\134\188aM\201\255y\207\149\DLE",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\189D\246\ETB\165\134\238\174\175E\220\240%\190\163\232>\190\rDH\156\&3\182\RS\240\&5w\200",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropRequestResponseInformation 165,PropResponseInformation "E\252\213\213",PropTopicAliasMaximum
// 24647,PropMaximumQoS 165,PropWildcardSubscriptionAvailable 139,PropSessionExpiryInterval
// 19464,PropAssignedClientIdentifier "\128QP\\`;\n8@NNs`\154\SUB\150\136t\231\250",PropRequestResponseInformation
// 67,PropRequestResponseInformation 96,PropResponseInformation "\191s\176\235\244\194",PropMaximumPacketSize
// 1055,PropWildcardSubscriptionAvailable 216,PropResponseTopic "\a)G\219\237j\200T",PropMaximumPacketSize
// 5417,PropRetainAvailable 166,PropMessageExpiryInterval 16062,PropSubscriptionIdentifier 1,PropServerKeepAlive
// 971,PropWildcardSubscriptionAvailable 107,PropMaximumQoS 46,PropSharedSubscriptionAvailable 72,PropReceiveMaximum
// 21423,PropAuthenticationMethod "Q\154V}\ACK@\152E\nK$\156}\188",PropMessageExpiryInterval 1756,PropReasonString
// "\187\DLE\SYN\a\175\159\199\&1_\190\172c\SI&\242\250H\167H\209\t",PropRequestResponseInformation
// 153,PropRetainAvailable 3,PropRequestProblemInformation 43,PropCorrelationData
// "\"T\133<\153\182\147\191\252:",PropUserProperty "!Fc" "\DC3W\163\165\224"]
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x82, 0x95, 0x2,  0x5b, 0x2f, 0xb3, 0x1,  0x19, 0xa5, 0x1a, 0x0,  0x4,  0x45, 0xfc, 0xd5, 0xd5, 0x22, 0x60, 0x47,
      0x24, 0xa5, 0x28, 0x8b, 0x11, 0x0,  0x0,  0x4c, 0x8,  0x12, 0x0,  0x14, 0x80, 0x51, 0x50, 0x5c, 0x60, 0x3b, 0xa,
      0x38, 0x40, 0x4e, 0x4e, 0x73, 0x60, 0x9a, 0x1a, 0x96, 0x88, 0x74, 0xe7, 0xfa, 0x19, 0x43, 0x19, 0x60, 0x1a, 0x0,
      0x6,  0xbf, 0x73, 0xb0, 0xeb, 0xf4, 0xc2, 0x27, 0x0,  0x0,  0x4,  0x1f, 0x28, 0xd8, 0x8,  0x0,  0x8,  0x7,  0x29,
      0x47, 0xdb, 0xed, 0x6a, 0xc8, 0x54, 0x27, 0x0,  0x0,  0x15, 0x29, 0x25, 0xa6, 0x2,  0x0,  0x0,  0x3e, 0xbe, 0xb,
      0x1,  0x13, 0x3,  0xcb, 0x28, 0x6b, 0x24, 0x2e, 0x2a, 0x48, 0x21, 0x53, 0xaf, 0x15, 0x0,  0xe,  0x51, 0x9a, 0x56,
      0x7d, 0x6,  0x40, 0x98, 0x45, 0xa,  0x4b, 0x24, 0x9c, 0x7d, 0xbc, 0x2,  0x0,  0x0,  0x6,  0xdc, 0x1f, 0x0,  0x15,
      0xbb, 0x10, 0x16, 0x7,  0xaf, 0x9f, 0xc7, 0x31, 0x5f, 0xbe, 0xac, 0x63, 0xf,  0x26, 0xf2, 0xfa, 0x48, 0xa7, 0x48,
      0xd1, 0x9,  0x19, 0x99, 0x25, 0x3,  0x17, 0x2b, 0x9,  0x0,  0xa,  0x22, 0x54, 0x85, 0x3c, 0x99, 0xb6, 0x93, 0xbf,
      0xfc, 0x3a, 0x26, 0x0,  0x3,  0x21, 0x46, 0x63, 0x0,  0x5,  0x13, 0x57, 0xa3, 0xa5, 0xe0, 0x0,  0x3,  0x8,  0xe2,
      0xe4, 0x0,  0x0,  0x1c, 0x2c, 0x36, 0x70, 0x1f, 0x1b, 0xe9, 0xa6, 0xa8, 0xe,  0x62, 0x40, 0x22, 0x9b, 0xb6, 0x7f,
      0xd5, 0xfb, 0xd6, 0x2f, 0xe9, 0xd1, 0x6e, 0x53, 0x44, 0xae, 0x59, 0x93, 0xbf, 0x1,  0x0,  0x16, 0x5b, 0x31, 0xfb,
      0xa8, 0x23, 0x4,  0x8c, 0x8c, 0x30, 0x29, 0x12, 0x9f, 0x86, 0xbc, 0x61, 0x4d, 0xc9, 0xff, 0x79, 0xcf, 0x95, 0x10,
      0x0,  0x0,  0x1d, 0xbd, 0x44, 0xf6, 0x17, 0xa5, 0x86, 0xee, 0xae, 0xaf, 0x45, 0xdc, 0xf0, 0x25, 0xbe, 0xa3, 0xe8,
      0x3e, 0xbe, 0xd,  0x44, 0x48, 0x9c, 0x33, 0xb6, 0x1e, 0xf0, 0x35, 0x77, 0xc8, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x8, 0xe2, 0xe4};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2c, 0x36, 0x70, 0x1f, 0x1b, 0xe9, 0xa6, 0xa8, 0xe,  0x62,
                                     0x40, 0x22, 0x9b, 0xb6, 0x7f, 0xd5, 0xfb, 0xd6, 0x2f, 0xe9,
                                     0xd1, 0x6e, 0x53, 0x44, 0xae, 0x59, 0x93, 0xbf};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5b, 0x31, 0xfb, 0xa8, 0x23, 0x4,  0x8c, 0x8c, 0x30, 0x29, 0x12,
                                     0x9f, 0x86, 0xbc, 0x61, 0x4d, 0xc9, 0xff, 0x79, 0xcf, 0x95, 0x10};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xbd, 0x44, 0xf6, 0x17, 0xa5, 0x86, 0xee, 0xae, 0xaf, 0x45,
                                     0xdc, 0xf0, 0x25, 0xbe, 0xa3, 0xe8, 0x3e, 0xbe, 0xd,  0x44,
                                     0x48, 0x9c, 0x33, 0xb6, 0x1e, 0xf0, 0x35, 0x77, 0xc8};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x45, 0xfc, 0xd5, 0xd5};
  uint8_t bytesprops1[] = {0x80, 0x51, 0x50, 0x5c, 0x60, 0x3b, 0xa,  0x38, 0x40, 0x4e,
                           0x4e, 0x73, 0x60, 0x9a, 0x1a, 0x96, 0x88, 0x74, 0xe7, 0xfa};
  uint8_t bytesprops2[] = {0xbf, 0x73, 0xb0, 0xeb, 0xf4, 0xc2};
  uint8_t bytesprops3[] = {0x7, 0x29, 0x47, 0xdb, 0xed, 0x6a, 0xc8, 0x54};
  uint8_t bytesprops4[] = {0x51, 0x9a, 0x56, 0x7d, 0x6, 0x40, 0x98, 0x45, 0xa, 0x4b, 0x24, 0x9c, 0x7d, 0xbc};
  uint8_t bytesprops5[] = {0xbb, 0x10, 0x16, 0x7,  0xaf, 0x9f, 0xc7, 0x31, 0x5f, 0xbe, 0xac,
                           0x63, 0xf,  0x26, 0xf2, 0xfa, 0x48, 0xa7, 0x48, 0xd1, 0x9};
  uint8_t bytesprops6[] = {0x22, 0x54, 0x85, 0x3c, 0x99, 0xb6, 0x93, 0xbf, 0xfc, 0x3a};
  uint8_t bytesprops8[] = {0x13, 0x57, 0xa3, 0xa5, 0xe0};
  uint8_t bytesprops7[] = {0x21, 0x46, 0x63};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24647}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19464}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1055}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5417}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16062}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 1}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 971}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21423}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1756}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops7}, .v = {5, (char*)&bytesprops8}}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23343, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
