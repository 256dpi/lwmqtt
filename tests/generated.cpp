#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "#\234\SI\231\179\228\175!\174\132/\ETXg\US\r\STX\178\203\151\187\DC3C", _pubPktID = 3425, _pubBody = ":\171^C\n",
// _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x32, 0x1f, 0x0, 0x16, 0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f, 0x3, 0x67,
                   0x1f, 0xd,  0x2, 0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43, 0xd,  0x61, 0x3a, 0xab, 0x5e, 0x43, 0xa};
  uint8_t topic_bytes[] = {0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f,
                           0x3,  0x67, 0x1f, 0xd,  0x2,  0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3a, 0xab, 0x5e, 0x43, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 3425, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "#\234\SI\231\179\228\175!\174\132/\ETXg\US\r\STX\178\203\151\187\DC3C", _pubPktID = 3425, _pubBody = ":\171^C\n",
// _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x32, 0x1f, 0x0, 0x16, 0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f, 0x3, 0x67,
                   0x1f, 0xd,  0x2, 0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43, 0xd,  0x61, 0x3a, 0xab, 0x5e, 0x43, 0xa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f,
                               0x3,  0x67, 0x1f, 0xd,  0x2,  0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3a, 0xab, 0x5e, 0x43, 0xa};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3425);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\158\245\154\154\236\CAN_4\221\253\192\177\172<\236c\171]F_", _pubPktID = 29370, _pubBody =
// "z\217-\243HF\176HG\200\166\159", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x3c, 0x24, 0x0,  0x14, 0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd,
                   0xfd, 0xc0, 0xb1, 0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f, 0x72, 0xba,
                   0x7a, 0xd9, 0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  uint8_t topic_bytes[] = {0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd, 0xfd,
                           0xc0, 0xb1, 0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7a, 0xd9, 0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29370, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\158\245\154\154\236\CAN_4\221\253\192\177\172<\236c\171]F_", _pubPktID = 29370, _pubBody =
// "z\217-\243HF\176HG\200\166\159", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x3c, 0x24, 0x0,  0x14, 0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd,
                   0xfd, 0xc0, 0xb1, 0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f, 0x72, 0xba,
                   0x7a, 0xd9, 0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd, 0xfd,
                               0xc0, 0xb1, 0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7a, 0xd9, 0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 29370);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "uh{\218\a\247\172\148\ESC\ETB\187\138\184\255\vX\180\DC1\131\&0\219\216\SI\147\203\ETX)\218", _pubPktID = 0,
// _pubBody = "\207\DC1\209\235\144\141K\255\225\177/B\DC1\DC3\175\144", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x38, 0x2e, 0x0,  0x1c, 0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a,
                   0xb8, 0xff, 0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda,
                   0xcf, 0x11, 0xd1, 0xeb, 0x90, 0x8d, 0x4b, 0xff, 0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  uint8_t topic_bytes[] = {0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a, 0xb8, 0xff,
                           0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xcf, 0x11, 0xd1, 0xeb, 0x90, 0x8d, 0x4b, 0xff,
                         0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "uh{\218\a\247\172\148\ESC\ETB\187\138\184\255\vX\180\DC1\131\&0\219\216\SI\147\203\ETX)\218", _pubPktID = 0,
// _pubBody = "\207\DC1\209\235\144\141K\255\225\177/B\DC1\DC3\175\144", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x38, 0x2e, 0x0,  0x1c, 0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a,
                   0xb8, 0xff, 0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda,
                   0xcf, 0x11, 0xd1, 0xeb, 0x90, 0x8d, 0x4b, 0xff, 0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a, 0xb8, 0xff,
                               0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcf, 0x11, 0xd1, 0xeb, 0x90, 0x8d, 0x4b, 0xff,
                              0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\193)\128\208yd\SOi\134\237\DC2Ir\136\217", _pubPktID = 8430, _pubBody =
// "\138\214\&5p\ESCn,\183\152u\192\244\165\&1\147\140\172", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x3d, 0x24, 0x0,  0xf,  0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe,  0x69, 0x86,
                   0xed, 0x12, 0x49, 0x72, 0x88, 0xd9, 0x20, 0xee, 0x8a, 0xd6, 0x35, 0x70, 0x1b,
                   0x6e, 0x2c, 0xb7, 0x98, 0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  uint8_t topic_bytes[] = {0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe, 0x69, 0x86, 0xed, 0x12, 0x49, 0x72, 0x88, 0xd9};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8a, 0xd6, 0x35, 0x70, 0x1b, 0x6e, 0x2c, 0xb7, 0x98,
                         0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 8430, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\193)\128\208yd\SOi\134\237\DC2Ir\136\217", _pubPktID = 8430, _pubBody =
// "\138\214\&5p\ESCn,\183\152u\192\244\165\&1\147\140\172", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x3d, 0x24, 0x0,  0xf,  0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe,  0x69, 0x86,
                   0xed, 0x12, 0x49, 0x72, 0x88, 0xd9, 0x20, 0xee, 0x8a, 0xd6, 0x35, 0x70, 0x1b,
                   0x6e, 0x2c, 0xb7, 0x98, 0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe, 0x69, 0x86, 0xed, 0x12, 0x49, 0x72, 0x88, 0xd9};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8a, 0xd6, 0x35, 0x70, 0x1b, 0x6e, 0x2c, 0xb7, 0x98,
                              0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8430);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\DC2\184\144\&5\136\156E\174\237\230\175\SUB\153 \NAKk\EM\f", _pubPktID = 0, _pubBody =
// "i\232{\DC3k\GS\158\DLE|\218\236v\244>\145\172,\bR\165\255\174", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x31, 0x2a, 0x0,  0x12, 0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed, 0xe6, 0xaf,
                   0x1a, 0x99, 0x20, 0x15, 0x6b, 0x19, 0xc,  0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10,
                   0x7c, 0xda, 0xec, 0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  uint8_t topic_bytes[] = {0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed,
                           0xe6, 0xaf, 0x1a, 0x99, 0x20, 0x15, 0x6b, 0x19, 0xc};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10, 0x7c, 0xda, 0xec,
                         0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\DC2\184\144\&5\136\156E\174\237\230\175\SUB\153 \NAKk\EM\f", _pubPktID = 0, _pubBody =
// "i\232{\DC3k\GS\158\DLE|\218\236v\244>\145\172,\bR\165\255\174", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x31, 0x2a, 0x0,  0x12, 0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed, 0xe6, 0xaf,
                   0x1a, 0x99, 0x20, 0x15, 0x6b, 0x19, 0xc,  0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10,
                   0x7c, 0xda, 0xec, 0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed,
                               0xe6, 0xaf, 0x1a, 0x99, 0x20, 0x15, 0x6b, 0x19, 0xc};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10, 0x7c, 0xda, 0xec,
                              0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\251M\156e\192", _pubPktID = 0,
// _pubBody = "O\254\197\133\153\151~\137\172", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x31, 0x10, 0x0,  0x5,  0xfb, 0x4d, 0x9c, 0x65, 0xc0,
                   0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  uint8_t topic_bytes[] = {0xfb, 0x4d, 0x9c, 0x65, 0xc0};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\251M\156e\192", _pubPktID = 0,
// _pubBody = "O\254\197\133\153\151~\137\172", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x31, 0x10, 0x0,  0x5,  0xfb, 0x4d, 0x9c, 0x65, 0xc0,
                   0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfb, 0x4d, 0x9c, 0x65, 0xc0};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\224@\143", _pubPktID = 6480,
// _pubBody = "p\191(\150l\241Y\SO\208g\192\EMT+\DLE\246\189f\179C\EOTFwX1\DC3I*A\n", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x3b, 0x25, 0x0,  0x3, 0xe0, 0x40, 0x8f, 0x19, 0x50, 0x70, 0xbf, 0x28, 0x96,
                   0x6c, 0xf1, 0x59, 0xe, 0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10, 0xf6, 0xbd,
                   0x66, 0xb3, 0x43, 0x4, 0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  uint8_t topic_bytes[] = {0xe0, 0x40, 0x8f};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x70, 0xbf, 0x28, 0x96, 0x6c, 0xf1, 0x59, 0xe,  0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10,
                         0xf6, 0xbd, 0x66, 0xb3, 0x43, 0x4,  0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6480, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\224@\143", _pubPktID = 6480,
// _pubBody = "p\191(\150l\241Y\SO\208g\192\EMT+\DLE\246\189f\179C\EOTFwX1\DC3I*A\n", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x3b, 0x25, 0x0,  0x3, 0xe0, 0x40, 0x8f, 0x19, 0x50, 0x70, 0xbf, 0x28, 0x96,
                   0x6c, 0xf1, 0x59, 0xe, 0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10, 0xf6, 0xbd,
                   0x66, 0xb3, 0x43, 0x4, 0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe0, 0x40, 0x8f};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x70, 0xbf, 0x28, 0x96, 0x6c, 0xf1, 0x59, 0xe,  0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10,
                              0xf6, 0xbd, 0x66, 0xb3, 0x43, 0x4,  0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 6480);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\141\RSw\147`\NAK\ENQ\149f_Y\196\&3b\209U\150s\240\238\a\156\v\151~%\224P\244", _pubPktID = 0, _pubBody =
// "\220\213O", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x38, 0x22, 0x0,  0x1d, 0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95,
                   0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62, 0xd1, 0x55, 0x96, 0x73, 0xf0, 0xee,
                   0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4, 0xdc, 0xd5, 0x4f};
  uint8_t topic_bytes[] = {0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95, 0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62, 0xd1,
                           0x55, 0x96, 0x73, 0xf0, 0xee, 0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xdc, 0xd5, 0x4f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\141\RSw\147`\NAK\ENQ\149f_Y\196\&3b\209U\150s\240\238\a\156\v\151~%\224P\244", _pubPktID = 0, _pubBody =
// "\220\213O", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x38, 0x22, 0x0,  0x1d, 0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95,
                   0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62, 0xd1, 0x55, 0x96, 0x73, 0xf0, 0xee,
                   0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4, 0xdc, 0xd5, 0x4f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95, 0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62, 0xd1,
                               0x55, 0x96, 0x73, 0xf0, 0xee, 0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xdc, 0xd5, 0x4f};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\130\180J\210\214\ENQ\185\DC3T.\233,_\253N\188M\218\t\203\210\&9z\193w\227", _pubPktID = 5801, _pubBody =
// "e/2Y\147]W%\233\NUL\170j25\192", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x3a, 0x2d, 0x0,  0x1a, 0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5,  0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c,
                   0x5f, 0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9,  0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3, 0x16, 0xa9,
                   0x65, 0x2f, 0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0,  0xaa, 0x6a, 0x32, 0x35, 0xc0};
  uint8_t topic_bytes[] = {0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5, 0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c, 0x5f,
                           0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9, 0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x65, 0x2f, 0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0, 0xaa, 0x6a, 0x32, 0x35, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5801, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\130\180J\210\214\ENQ\185\DC3T.\233,_\253N\188M\218\t\203\210\&9z\193w\227", _pubPktID = 5801, _pubBody =
// "e/2Y\147]W%\233\NUL\170j25\192", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x3a, 0x2d, 0x0,  0x1a, 0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5,  0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c,
                   0x5f, 0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9,  0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3, 0x16, 0xa9,
                   0x65, 0x2f, 0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0,  0xaa, 0x6a, 0x32, 0x35, 0xc0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5, 0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c, 0x5f,
                               0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9, 0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x65, 0x2f, 0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0, 0xaa, 0x6a, 0x32, 0x35, 0xc0};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5801);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "$hC\136_\134&\134\182\244\211M\211a\221[", _pubPktID = 25662, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x3c, 0x14, 0x0,  0x10, 0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26,
                   0x86, 0xb6, 0xf4, 0xd3, 0x4d, 0xd3, 0x61, 0xdd, 0x5b, 0x64, 0x3e};
  uint8_t topic_bytes[] = {0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26, 0x86,
                           0xb6, 0xf4, 0xd3, 0x4d, 0xd3, 0x61, 0xdd, 0x5b};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 25662, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "$hC\136_\134&\134\182\244\211M\211a\221[", _pubPktID = 25662, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x3c, 0x14, 0x0,  0x10, 0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26,
                   0x86, 0xb6, 0xf4, 0xd3, 0x4d, 0xd3, 0x61, 0xdd, 0x5b, 0x64, 0x3e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26, 0x86,
                               0xb6, 0xf4, 0xd3, 0x4d, 0xd3, 0x61, 0xdd, 0x5b};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 25662);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\181\165\155@\151\196\153>\212\208\158e;\229\178\rW&", _pubPktID = 28678, _pubBody =
// "\197b\187\ACKO^\130\182\SI\241\185\141\n\187P", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x32, 0x25, 0x0,  0x12, 0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4,
                   0xd0, 0x9e, 0x65, 0x3b, 0xe5, 0xb2, 0xd,  0x57, 0x26, 0x70, 0x6,  0xc5, 0x62,
                   0xbb, 0x6,  0x4f, 0x5e, 0x82, 0xb6, 0xf,  0xf1, 0xb9, 0x8d, 0xa,  0xbb, 0x50};
  uint8_t topic_bytes[] = {0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4,
                           0xd0, 0x9e, 0x65, 0x3b, 0xe5, 0xb2, 0xd,  0x57, 0x26};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc5, 0x62, 0xbb, 0x6, 0x4f, 0x5e, 0x82, 0xb6, 0xf, 0xf1, 0xb9, 0x8d, 0xa, 0xbb, 0x50};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 28678, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\181\165\155@\151\196\153>\212\208\158e;\229\178\rW&", _pubPktID = 28678, _pubBody =
// "\197b\187\ACKO^\130\182\SI\241\185\141\n\187P", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x32, 0x25, 0x0,  0x12, 0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4,
                   0xd0, 0x9e, 0x65, 0x3b, 0xe5, 0xb2, 0xd,  0x57, 0x26, 0x70, 0x6,  0xc5, 0x62,
                   0xbb, 0x6,  0x4f, 0x5e, 0x82, 0xb6, 0xf,  0xf1, 0xb9, 0x8d, 0xa,  0xbb, 0x50};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4,
                               0xd0, 0x9e, 0x65, 0x3b, 0xe5, 0xb2, 0xd,  0x57, 0x26};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc5, 0x62, 0xbb, 0x6, 0x4f, 0x5e, 0x82, 0xb6, 0xf, 0xf1, 0xb9, 0x8d, 0xa, 0xbb, 0x50};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 28678);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\196x\255\172\&4\CAN?V{\217\182\160\&3\169g\176\192\r\NAK\186s", _pubPktID = 0, _pubBody = "s", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x39, 0x18, 0x0,  0x15, 0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b,
                   0xd9, 0xb6, 0xa0, 0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73, 0x73};
  uint8_t topic_bytes[] = {0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b, 0xd9, 0xb6,
                           0xa0, 0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x73};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\196x\255\172\&4\CAN?V{\217\182\160\&3\169g\176\192\r\NAK\186s", _pubPktID = 0, _pubBody = "s", _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x39, 0x18, 0x0,  0x15, 0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b,
                   0xd9, 0xb6, 0xa0, 0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73, 0x73};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b, 0xd9, 0xb6,
                               0xa0, 0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x73};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\136@e", _pubPktID = 1120, _pubBody
// = "U\146=\184\GS9[\230\210\180\157\ENQ\204\240\DC36\FSl0\136\172^\RSr4t7\193\178", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x35, 0x24, 0x0,  0x3,  0x88, 0x40, 0x65, 0x4,  0x60, 0x55, 0x92, 0x3d, 0xb8,
                   0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13, 0x36, 0x1c,
                   0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  uint8_t topic_bytes[] = {0x88, 0x40, 0x65};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x55, 0x92, 0x3d, 0xb8, 0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13,
                         0x36, 0x1c, 0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 1120, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\136@e", _pubPktID = 1120, _pubBody
// = "U\146=\184\GS9[\230\210\180\157\ENQ\204\240\DC36\FSl0\136\172^\RSr4t7\193\178", _pubProps = []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x35, 0x24, 0x0,  0x3,  0x88, 0x40, 0x65, 0x4,  0x60, 0x55, 0x92, 0x3d, 0xb8,
                   0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13, 0x36, 0x1c,
                   0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x88, 0x40, 0x65};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x55, 0x92, 0x3d, 0xb8, 0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13,
                              0x36, 0x1c, 0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1120);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\129\b\202\ETB\"y\195\204\150S\DLE\231\CANg\207\&0\n\246~U\196\194\&5", _pubPktID = 17194, _pubBody =
// "\158\237", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x33, 0x1e, 0x0,  0x18, 0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                   0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35, 0x43, 0x2a, 0x9e, 0xed};
  uint8_t topic_bytes[] = {0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                           0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9e, 0xed};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 17194, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\129\b\202\ETB\"y\195\204\150S\DLE\231\CANg\207\&0\n\246~U\196\194\&5", _pubPktID = 17194, _pubBody =
// "\158\237", _pubProps = []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x33, 0x1e, 0x0,  0x18, 0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                   0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35, 0x43, 0x2a, 0x9e, 0xed};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                               0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9e, 0xed};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17194);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ")\223\215<\151R\ENQ\DC3I\131&\207\&4\179\156\CAN\SO", _pubPktID = 18606, _pubBody = "\208Zo\214\246#v", _pubProps =
// []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x35, 0x1c, 0x0,  0x11, 0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49, 0x83, 0x26,
                   0xcf, 0x34, 0xb3, 0x9c, 0x18, 0xe,  0x48, 0xae, 0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  uint8_t topic_bytes[] = {0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49,
                           0x83, 0x26, 0xcf, 0x34, 0xb3, 0x9c, 0x18, 0xe};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 18606, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ")\223\215<\151R\ENQ\DC3I\131&\207\&4\179\156\CAN\SO", _pubPktID = 18606, _pubBody = "\208Zo\214\246#v", _pubProps =
// []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x35, 0x1c, 0x0,  0x11, 0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49, 0x83, 0x26,
                   0xcf, 0x34, 0xb3, 0x9c, 0x18, 0xe,  0x48, 0xae, 0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49,
                               0x83, 0x26, 0xcf, 0x34, 0xb3, 0x9c, 0x18, 0xe};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 18606);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\168E\247k\237\175\&5\SO\SYNU\224\160", _pubPktID = 28189, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x35, 0x10, 0x0, 0xc,  0xa8, 0x45, 0xf7, 0x6b, 0xed,
                   0xaf, 0x35, 0xe, 0x16, 0x55, 0xe0, 0xa0, 0x6e, 0x1d};
  uint8_t topic_bytes[] = {0xa8, 0x45, 0xf7, 0x6b, 0xed, 0xaf, 0x35, 0xe, 0x16, 0x55, 0xe0, 0xa0};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 28189, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\168E\247k\237\175\&5\SO\SYNU\224\160", _pubPktID = 28189, _pubBody = "", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x35, 0x10, 0x0, 0xc,  0xa8, 0x45, 0xf7, 0x6b, 0xed,
                   0xaf, 0x35, 0xe, 0x16, 0x55, 0xe0, 0xa0, 0x6e, 0x1d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa8, 0x45, 0xf7, 0x6b, 0xed, 0xaf, 0x35, 0xe, 0x16, 0x55, 0xe0, 0xa0};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 28189);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\191\CAN?\r\149\&0\185\198\tZ\213\STX5\192\195", _pubPktID = 0, _pubBody = "\190\206\169pC<\142\135\&8\243",
// _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x39, 0x1b, 0x0,  0xf,  0xbf, 0x18, 0x3f, 0xd,  0x95, 0x30, 0xb9, 0xc6, 0x9,  0x5a, 0xd5,
                   0x2,  0x35, 0xc0, 0xc3, 0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  uint8_t topic_bytes[] = {0xbf, 0x18, 0x3f, 0xd, 0x95, 0x30, 0xb9, 0xc6, 0x9, 0x5a, 0xd5, 0x2, 0x35, 0xc0, 0xc3};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\191\CAN?\r\149\&0\185\198\tZ\213\STX5\192\195", _pubPktID = 0, _pubBody = "\190\206\169pC<\142\135\&8\243",
// _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x39, 0x1b, 0x0,  0xf,  0xbf, 0x18, 0x3f, 0xd,  0x95, 0x30, 0xb9, 0xc6, 0x9,  0x5a, 0xd5,
                   0x2,  0x35, 0xc0, 0xc3, 0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbf, 0x18, 0x3f, 0xd, 0x95, 0x30, 0xb9, 0xc6, 0x9, 0x5a, 0xd5, 0x2, 0x35, 0xc0, 0xc3};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\209\227N0}\DEL\200\186\135Q\178Ab\227[N~\173\197\252P", _pubPktID = 17259, _pubBody =
// "\211\&9\214\163\194\138\\\205\223\162\148\156\131\232\SYN\215\213\DC4\174", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x3d, 0x2c, 0x0,  0x15, 0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2, 0x41,
                   0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50, 0x43, 0x6b, 0xd3, 0x39, 0xd6, 0xa3, 0xc2,
                   0x8a, 0x5c, 0xcd, 0xdf, 0xa2, 0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  uint8_t topic_bytes[] = {0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2,
                           0x41, 0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd3, 0x39, 0xd6, 0xa3, 0xc2, 0x8a, 0x5c, 0xcd, 0xdf, 0xa2,
                         0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 17259, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\209\227N0}\DEL\200\186\135Q\178Ab\227[N~\173\197\252P", _pubPktID = 17259, _pubBody =
// "\211\&9\214\163\194\138\\\205\223\162\148\156\131\232\SYN\215\213\DC4\174", _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x3d, 0x2c, 0x0,  0x15, 0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2, 0x41,
                   0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50, 0x43, 0x6b, 0xd3, 0x39, 0xd6, 0xa3, 0xc2,
                   0x8a, 0x5c, 0xcd, 0xdf, 0xa2, 0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2,
                               0x41, 0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd3, 0x39, 0xd6, 0xa3, 0xc2, 0x8a, 0x5c, 0xcd, 0xdf, 0xa2,
                              0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17259);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\157\255\149\212\150\224\139\154J\197\&0C\166\189\203/\179f$J\197-\r\240\SUB\188;\r\173", _pubPktID = 22738,
// _pubBody = "\210\DC1\143z\164\179\bD\DELn", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x3c, 0x2b, 0x0,  0x1d, 0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30,
                   0x43, 0xa6, 0xbd, 0xcb, 0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc,
                   0x3b, 0xd,  0xad, 0x58, 0xd2, 0xd2, 0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8,  0x44, 0x7f, 0x6e};
  uint8_t topic_bytes[] = {0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30, 0x43, 0xa6, 0xbd, 0xcb,
                           0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc, 0x3b, 0xd,  0xad};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd2, 0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8, 0x44, 0x7f, 0x6e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 22738, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\157\255\149\212\150\224\139\154J\197\&0C\166\189\203/\179f$J\197-\r\240\SUB\188;\r\173", _pubPktID = 22738,
// _pubBody = "\210\DC1\143z\164\179\bD\DELn", _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x3c, 0x2b, 0x0,  0x1d, 0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30,
                   0x43, 0xa6, 0xbd, 0xcb, 0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc,
                   0x3b, 0xd,  0xad, 0x58, 0xd2, 0xd2, 0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8,  0x44, 0x7f, 0x6e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30, 0x43, 0xa6, 0xbd, 0xcb,
                               0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc, 0x3b, 0xd,  0xad};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd2, 0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8, 0x44, 0x7f, 0x6e};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 22738);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 6071, _pubBody =
// "#\140\138\233\171\140\SOH9\165\168kP\138\237?\192\174", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x3b, 0x15, 0x0,  0x0,  0x17, 0xb7, 0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c,
                   0x1,  0x39, 0xa5, 0xa8, 0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c, 0x1,  0x39, 0xa5,
                         0xa8, 0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 6071, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 6071, _pubBody =
// "#\140\138\233\171\140\SOH9\165\168kP\138\237?\192\174", _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x3b, 0x15, 0x0,  0x0,  0x17, 0xb7, 0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c,
                   0x1,  0x39, 0xa5, 0xa8, 0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c, 0x1,  0x39, 0xa5,
                              0xa8, 0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 6071);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<m9", _pubPktID = 5951, _pubBody =
// "\176\133\203J\147A\240K\185k\145:\"\234\252\226\248W|\218\v\248*\n\SYN", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x3c, 0x20, 0x0,  0x3,  0x3c, 0x6d, 0x39, 0x17, 0x3f, 0xb0, 0x85, 0xcb,
                   0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91, 0x3a, 0x22, 0xea, 0xfc,
                   0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  uint8_t topic_bytes[] = {0x3c, 0x6d, 0x39};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb0, 0x85, 0xcb, 0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91, 0x3a, 0x22,
                         0xea, 0xfc, 0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5951, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<m9", _pubPktID = 5951, _pubBody =
// "\176\133\203J\147A\240K\185k\145:\"\234\252\226\248W|\218\v\248*\n\SYN", _pubProps = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x3c, 0x20, 0x0,  0x3,  0x3c, 0x6d, 0x39, 0x17, 0x3f, 0xb0, 0x85, 0xcb,
                   0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91, 0x3a, 0x22, 0xea, 0xfc,
                   0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3c, 0x6d, 0x39};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb0, 0x85, 0xcb, 0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91, 0x3a, 0x22,
                              0xea, 0xfc, 0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5951);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 29931, _pubBody =
// "\254t\DLE\GS|r\CAN\243)\RS\151\DC4/_\229b\\", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x3c, 0x15, 0x0,  0x0,  0x74, 0xeb, 0xfe, 0x74, 0x10, 0x1d, 0x7c, 0x72,
                   0x18, 0xf3, 0x29, 0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfe, 0x74, 0x10, 0x1d, 0x7c, 0x72, 0x18, 0xf3, 0x29,
                         0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 29931, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 29931, _pubBody =
// "\254t\DLE\GS|r\CAN\243)\RS\151\DC4/_\229b\\", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x3c, 0x15, 0x0,  0x0,  0x74, 0xeb, 0xfe, 0x74, 0x10, 0x1d, 0x7c, 0x72,
                   0x18, 0xf3, 0x29, 0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfe, 0x74, 0x10, 0x1d, 0x7c, 0x72, 0x18, 0xf3, 0x29,
                              0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 29931);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\128\158-GrC\129\166\140\231\NULj!M4\SUB", _pubPktID = 0, _pubBody =
// "\228\ESC\231\DC3\136\217\177W_\ESCp\130\DC2\212,\158\236\215\204\207m\205", _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x31, 0x28, 0x0,  0x10, 0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6, 0x8c, 0xe7,
                   0x0,  0x6a, 0x21, 0x4d, 0x34, 0x1a, 0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57,
                   0x5f, 0x1b, 0x70, 0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  uint8_t topic_bytes[] = {0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6,
                           0x8c, 0xe7, 0x0,  0x6a, 0x21, 0x4d, 0x34, 0x1a};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57, 0x5f, 0x1b, 0x70,
                         0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\128\158-GrC\129\166\140\231\NULj!M4\SUB", _pubPktID = 0, _pubBody =
// "\228\ESC\231\DC3\136\217\177W_\ESCp\130\DC2\212,\158\236\215\204\207m\205", _pubProps = []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x31, 0x28, 0x0,  0x10, 0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6, 0x8c, 0xe7,
                   0x0,  0x6a, 0x21, 0x4d, 0x34, 0x1a, 0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57,
                   0x5f, 0x1b, 0x70, 0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6,
                               0x8c, 0xe7, 0x0,  0x6a, 0x21, 0x4d, 0x34, 0x1a};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57, 0x5f, 0x1b, 0x70,
                              0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "s\233\140\183\209=t\220\206\194\143\249\ETX\234\&5\b\144\f\246\250\US\193\193\178\226\201\156", _pubPktID = 8248,
// _pubBody = "v\196\240]\193r\165~\158\205\155'\206\&8\215s\248\196\250\&1\247", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x34, 0x34, 0x0,  0x1b, 0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2,
                   0x8f, 0xf9, 0x3,  0xea, 0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2,
                   0xe2, 0xc9, 0x9c, 0x20, 0x38, 0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e,
                   0xcd, 0x9b, 0x27, 0xce, 0x38, 0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  uint8_t topic_bytes[] = {0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2, 0x8f, 0xf9, 0x3, 0xea,
                           0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2, 0xe2, 0xc9, 0x9c};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e, 0xcd, 0x9b,
                         0x27, 0xce, 0x38, 0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 8248, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "s\233\140\183\209=t\220\206\194\143\249\ETX\234\&5\b\144\f\246\250\US\193\193\178\226\201\156", _pubPktID = 8248,
// _pubBody = "v\196\240]\193r\165~\158\205\155'\206\&8\215s\248\196\250\&1\247", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x34, 0x34, 0x0,  0x1b, 0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2,
                   0x8f, 0xf9, 0x3,  0xea, 0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2,
                   0xe2, 0xc9, 0x9c, 0x20, 0x38, 0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e,
                   0xcd, 0x9b, 0x27, 0xce, 0x38, 0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2, 0x8f, 0xf9, 0x3, 0xea,
                               0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2, 0xe2, 0xc9, 0x9c};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e, 0xcd, 0x9b,
                              0x27, 0xce, 0x38, 0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8248);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\146;?\158\252\\a5\133\233\144\&9O\159\231\133\240}\DC1\200\&9\154a%\176Y", _pubPktID = 0, _pubBody =
// "\173\221\&2\157\129qMv\218\&6\216\165J\tp\242\205\&2\194t\243\161\STX?", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x39, 0x34, 0x0,  0x1a, 0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9,
                   0x90, 0x39, 0x4f, 0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25,
                   0xb0, 0x59, 0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda, 0x36, 0xd8, 0xa5,
                   0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  uint8_t topic_bytes[] = {0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9, 0x90, 0x39, 0x4f,
                           0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25, 0xb0, 0x59};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda, 0x36, 0xd8, 0xa5,
                         0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\146;?\158\252\\a5\133\233\144\&9O\159\231\133\240}\DC1\200\&9\154a%\176Y", _pubPktID = 0, _pubBody =
// "\173\221\&2\157\129qMv\218\&6\216\165J\tp\242\205\&2\194t\243\161\STX?", _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x39, 0x34, 0x0,  0x1a, 0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9,
                   0x90, 0x39, 0x4f, 0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25,
                   0xb0, 0x59, 0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda, 0x36, 0xd8, 0xa5,
                   0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9, 0x90, 0x39, 0x4f,
                               0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25, 0xb0, 0x59};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda, 0x36, 0xd8, 0xa5,
                              0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "?X\254\SIJ/\199\240\153I\171-\227\213\191\205\b\202\247\252\a\196\136\150\215K\\R", _pubPktID = 0, _pubBody =
// "\167\192W\238\177\207\SO\148\212\134\&6\145\223N\168", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x31, 0x2d, 0x0,  0x1c, 0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab, 0x2d,
                   0xe3, 0xd5, 0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c, 0x52,
                   0xa7, 0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe,  0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  uint8_t topic_bytes[] = {0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab, 0x2d, 0xe3, 0xd5,
                           0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c, 0x52};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa7, 0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe, 0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "?X\254\SIJ/\199\240\153I\171-\227\213\191\205\b\202\247\252\a\196\136\150\215K\\R", _pubPktID = 0, _pubBody =
// "\167\192W\238\177\207\SO\148\212\134\&6\145\223N\168", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x31, 0x2d, 0x0,  0x1c, 0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab, 0x2d,
                   0xe3, 0xd5, 0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c, 0x52,
                   0xa7, 0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe,  0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab, 0x2d, 0xe3, 0xd5,
                               0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c, 0x52};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa7, 0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe, 0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\144\167\130\179A", _pubPktID = 0,
// _pubBody = "\148\134\185\213\184\233\187\157\198\233\181\148_\215\n$@\169\251\210\184\f", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x38, 0x1d, 0x0,  0x5,  0x90, 0xa7, 0x82, 0xb3, 0x41, 0x94, 0x86, 0xb9, 0xd5, 0xb8, 0xe9, 0xbb,
                   0x9d, 0xc6, 0xe9, 0xb5, 0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  uint8_t topic_bytes[] = {0x90, 0xa7, 0x82, 0xb3, 0x41};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x94, 0x86, 0xb9, 0xd5, 0xb8, 0xe9, 0xbb, 0x9d, 0xc6, 0xe9, 0xb5,
                         0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\144\167\130\179A", _pubPktID = 0,
// _pubBody = "\148\134\185\213\184\233\187\157\198\233\181\148_\215\n$@\169\251\210\184\f", _pubProps = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x38, 0x1d, 0x0,  0x5,  0x90, 0xa7, 0x82, 0xb3, 0x41, 0x94, 0x86, 0xb9, 0xd5, 0xb8, 0xe9, 0xbb,
                   0x9d, 0xc6, 0xe9, 0xb5, 0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x90, 0xa7, 0x82, 0xb3, 0x41};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x94, 0x86, 0xb9, 0xd5, 0xb8, 0xe9, 0xbb, 0x9d, 0xc6, 0xe9, 0xb5,
                              0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\187\249\143~(e\135", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x39, 0x9, 0x0, 0x0, 0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\187\249\143~(e\135", _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x39, 0x9, 0x0, 0x0, 0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "h\137\169\166b`\193\RS\133\235I\188\167\&9\DC1\161uN\176\SOf\ACK-O\194\vo", _pubPktID = 7918, _pubBody =
// "G\142\SYN\154\171\162\185\ENQg\129\240\186 \199\202{\CAN\233\v^\170", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x3a, 0x34, 0x0,  0x1b, 0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb,
                   0x49, 0xbc, 0xa7, 0x39, 0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f,
                   0xc2, 0xb,  0x6f, 0x1e, 0xee, 0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5,  0x67,
                   0x81, 0xf0, 0xba, 0x20, 0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb,  0x5e, 0xaa};
  uint8_t topic_bytes[] = {0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb, 0x49, 0xbc, 0xa7, 0x39,
                           0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f, 0xc2, 0xb,  0x6f};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5, 0x67, 0x81, 0xf0,
                         0xba, 0x20, 0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb, 0x5e, 0xaa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 7918, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "h\137\169\166b`\193\RS\133\235I\188\167\&9\DC1\161uN\176\SOf\ACK-O\194\vo", _pubPktID = 7918, _pubBody =
// "G\142\SYN\154\171\162\185\ENQg\129\240\186 \199\202{\CAN\233\v^\170", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x3a, 0x34, 0x0,  0x1b, 0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb,
                   0x49, 0xbc, 0xa7, 0x39, 0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f,
                   0xc2, 0xb,  0x6f, 0x1e, 0xee, 0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5,  0x67,
                   0x81, 0xf0, 0xba, 0x20, 0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb,  0x5e, 0xaa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb, 0x49, 0xbc, 0xa7, 0x39,
                               0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f, 0xc2, 0xb,  0x6f};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5, 0x67, 0x81, 0xf0,
                              0xba, 0x20, 0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb, 0x5e, 0xaa};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7918);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "k\r\250c\140\225\149\144@\133",
// _pubPktID = 0, _pubBody = "',/I\RSD\195\229\202", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x30, 0x15, 0x0,  0xa,  0x6b, 0xd,  0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90,
                   0x40, 0x85, 0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  uint8_t topic_bytes[] = {0x6b, 0xd, 0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90, 0x40, 0x85};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "k\r\250c\140\225\149\144@\133",
// _pubPktID = 0, _pubBody = "',/I\RSD\195\229\202", _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x30, 0x15, 0x0,  0xa,  0x6b, 0xd,  0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90,
                   0x40, 0x85, 0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6b, 0xd, 0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90, 0x40, 0x85};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "#\234\SI\231\179\228\175!\174\132/\ETXg\US\r\STX\178\203\151\187\DC3C", _pubPktID = 3425, _pubBody = ":\171^C\n",
// _pubProps = [PropResponseTopic "^\255\219\212\234E\196\NAK\v\231\230\148(\SO\196'",PropResponseInformation
// "r{\180za]\185U\204\128\131@\226\&4b<",PropTopicAliasMaximum 25499]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {0x32, 0x49, 0x0,  0x16, 0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f,
                   0x3,  0x67, 0x1f, 0xd,  0x2,  0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43, 0xd,  0x61, 0x29, 0x8,
                   0x0,  0x10, 0x5e, 0xff, 0xdb, 0xd4, 0xea, 0x45, 0xc4, 0x15, 0xb,  0xe7, 0xe6, 0x94, 0x28,
                   0xe,  0xc4, 0x27, 0x1a, 0x0,  0x10, 0x72, 0x7b, 0xb4, 0x7a, 0x61, 0x5d, 0xb9, 0x55, 0xcc,
                   0x80, 0x83, 0x40, 0xe2, 0x34, 0x62, 0x3c, 0x22, 0x63, 0x9b, 0x3a, 0xab, 0x5e, 0x43, 0xa};
  uint8_t topic_bytes[] = {0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f,
                           0x3,  0x67, 0x1f, 0xd,  0x2,  0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3a, 0xab, 0x5e, 0x43, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 5;

  uint8_t bytesprops0[] = {0x5e, 0xff, 0xdb, 0xd4, 0xea, 0x45, 0xc4, 0x15,
                           0xb,  0xe7, 0xe6, 0x94, 0x28, 0xe,  0xc4, 0x27};
  uint8_t bytesprops1[] = {0x72, 0x7b, 0xb4, 0x7a, 0x61, 0x5d, 0xb9, 0x55,
                           0xcc, 0x80, 0x83, 0x40, 0xe2, 0x34, 0x62, 0x3c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25499}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 3425, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "#\234\SI\231\179\228\175!\174\132/\ETXg\US\r\STX\178\203\151\187\DC3C", _pubPktID = 3425, _pubBody = ":\171^C\n",
// _pubProps = [PropResponseTopic "^\255\219\212\234E\196\NAK\v\231\230\148(\SO\196'",PropResponseInformation
// "r{\180za]\185U\204\128\131@\226\&4b<",PropTopicAliasMaximum 25499]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {0x32, 0x49, 0x0,  0x16, 0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f,
                   0x3,  0x67, 0x1f, 0xd,  0x2,  0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43, 0xd,  0x61, 0x29, 0x8,
                   0x0,  0x10, 0x5e, 0xff, 0xdb, 0xd4, 0xea, 0x45, 0xc4, 0x15, 0xb,  0xe7, 0xe6, 0x94, 0x28,
                   0xe,  0xc4, 0x27, 0x1a, 0x0,  0x10, 0x72, 0x7b, 0xb4, 0x7a, 0x61, 0x5d, 0xb9, 0x55, 0xcc,
                   0x80, 0x83, 0x40, 0xe2, 0x34, 0x62, 0x3c, 0x22, 0x63, 0x9b, 0x3a, 0xab, 0x5e, 0x43, 0xa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x23, 0xea, 0xf,  0xe7, 0xb3, 0xe4, 0xaf, 0x21, 0xae, 0x84, 0x2f,
                               0x3,  0x67, 0x1f, 0xd,  0x2,  0xb2, 0xcb, 0x97, 0xbb, 0x13, 0x43};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3a, 0xab, 0x5e, 0x43, 0xa};
  lwmqtt_string_t exp_body = {5, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3425);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 5);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 5);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\158\245\154\154\236\CAN_4\221\253\192\177\172<\236c\171]F_", _pubPktID = 29370, _pubBody =
// "z\217-\243HF\176HG\200\166\159", _pubProps = [PropMessageExpiryInterval 25413,PropSessionExpiryInterval
// 10036,PropUserProperty "\160\240\177G:gT_+\234\197\143\176\230]\\\159\205v"
// "T\255\ACK\SO\247\163\US\248\163\142H\ACK\148\210\162\189S\137\251\152\223Gb\248",PropSessionExpiryInterval
// 19732,PropTopicAlias 30295,PropUserProperty "\173,q\227\&4\EOT\209\173\193WT\208l\SIH\152\&3"
// "J\184@",PropRequestProblemInformation 107,PropAssignedClientIdentifier "\162
// \157\181\172\ETB\245\220\225:\200\235O\241T",PropPayloadFormatIndicator 248,PropMessageExpiryInterval
// 24928,PropRequestResponseInformation 194,PropServerKeepAlive 208]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {0x3c, 0xa0, 0x1,  0x0,  0x14, 0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd, 0xfd, 0xc0, 0xb1,
                   0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f, 0x72, 0xba, 0x7b, 0x2,  0x0,  0x0,  0x63, 0x45, 0x11,
                   0x0,  0x0,  0x27, 0x34, 0x26, 0x0,  0x13, 0xa0, 0xf0, 0xb1, 0x47, 0x3a, 0x67, 0x54, 0x5f, 0x2b, 0xea,
                   0xc5, 0x8f, 0xb0, 0xe6, 0x5d, 0x5c, 0x9f, 0xcd, 0x76, 0x0,  0x18, 0x54, 0xff, 0x6,  0xe,  0xf7, 0xa3,
                   0x1f, 0xf8, 0xa3, 0x8e, 0x48, 0x6,  0x94, 0xd2, 0xa2, 0xbd, 0x53, 0x89, 0xfb, 0x98, 0xdf, 0x47, 0x62,
                   0xf8, 0x11, 0x0,  0x0,  0x4d, 0x14, 0x23, 0x76, 0x57, 0x26, 0x0,  0x11, 0xad, 0x2c, 0x71, 0xe3, 0x34,
                   0x4,  0xd1, 0xad, 0xc1, 0x57, 0x54, 0xd0, 0x6c, 0xf,  0x48, 0x98, 0x33, 0x0,  0x3,  0x4a, 0xb8, 0x40,
                   0x17, 0x6b, 0x12, 0x0,  0xf,  0xa2, 0x20, 0x9d, 0xb5, 0xac, 0x17, 0xf5, 0xdc, 0xe1, 0x3a, 0xc8, 0xeb,
                   0x4f, 0xf1, 0x54, 0x1,  0xf8, 0x2,  0x0,  0x0,  0x61, 0x60, 0x19, 0xc2, 0x13, 0x0,  0xd0, 0x7a, 0xd9,
                   0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  uint8_t topic_bytes[] = {0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd, 0xfd,
                           0xc0, 0xb1, 0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7a, 0xd9, 0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops1[] = {0x54, 0xff, 0x6,  0xe,  0xf7, 0xa3, 0x1f, 0xf8, 0xa3, 0x8e, 0x48, 0x6,
                           0x94, 0xd2, 0xa2, 0xbd, 0x53, 0x89, 0xfb, 0x98, 0xdf, 0x47, 0x62, 0xf8};
  uint8_t bytesprops0[] = {0xa0, 0xf0, 0xb1, 0x47, 0x3a, 0x67, 0x54, 0x5f, 0x2b, 0xea,
                           0xc5, 0x8f, 0xb0, 0xe6, 0x5d, 0x5c, 0x9f, 0xcd, 0x76};
  uint8_t bytesprops3[] = {0x4a, 0xb8, 0x40};
  uint8_t bytesprops2[] = {0xad, 0x2c, 0x71, 0xe3, 0x34, 0x4,  0xd1, 0xad, 0xc1,
                           0x57, 0x54, 0xd0, 0x6c, 0xf,  0x48, 0x98, 0x33};
  uint8_t bytesprops4[] = {0xa2, 0x20, 0x9d, 0xb5, 0xac, 0x17, 0xf5, 0xdc, 0xe1, 0x3a, 0xc8, 0xeb, 0x4f, 0xf1, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25413}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10036}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops0}, .v = {24, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19732}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30295}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops2}, .v = {3, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24928}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 208}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29370, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\158\245\154\154\236\CAN_4\221\253\192\177\172<\236c\171]F_", _pubPktID = 29370, _pubBody =
// "z\217-\243HF\176HG\200\166\159", _pubProps = [PropMessageExpiryInterval 25413,PropSessionExpiryInterval
// 10036,PropUserProperty "\160\240\177G:gT_+\234\197\143\176\230]\\\159\205v"
// "T\255\ACK\SO\247\163\US\248\163\142H\ACK\148\210\162\189S\137\251\152\223Gb\248",PropSessionExpiryInterval
// 19732,PropTopicAlias 30295,PropUserProperty "\173,q\227\&4\EOT\209\173\193WT\208l\SIH\152\&3"
// "J\184@",PropRequestProblemInformation 107,PropAssignedClientIdentifier "\162
// \157\181\172\ETB\245\220\225:\200\235O\241T",PropPayloadFormatIndicator 248,PropMessageExpiryInterval
// 24928,PropRequestResponseInformation 194,PropServerKeepAlive 208]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {0x3c, 0xa0, 0x1,  0x0,  0x14, 0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd, 0xfd, 0xc0, 0xb1,
                   0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f, 0x72, 0xba, 0x7b, 0x2,  0x0,  0x0,  0x63, 0x45, 0x11,
                   0x0,  0x0,  0x27, 0x34, 0x26, 0x0,  0x13, 0xa0, 0xf0, 0xb1, 0x47, 0x3a, 0x67, 0x54, 0x5f, 0x2b, 0xea,
                   0xc5, 0x8f, 0xb0, 0xe6, 0x5d, 0x5c, 0x9f, 0xcd, 0x76, 0x0,  0x18, 0x54, 0xff, 0x6,  0xe,  0xf7, 0xa3,
                   0x1f, 0xf8, 0xa3, 0x8e, 0x48, 0x6,  0x94, 0xd2, 0xa2, 0xbd, 0x53, 0x89, 0xfb, 0x98, 0xdf, 0x47, 0x62,
                   0xf8, 0x11, 0x0,  0x0,  0x4d, 0x14, 0x23, 0x76, 0x57, 0x26, 0x0,  0x11, 0xad, 0x2c, 0x71, 0xe3, 0x34,
                   0x4,  0xd1, 0xad, 0xc1, 0x57, 0x54, 0xd0, 0x6c, 0xf,  0x48, 0x98, 0x33, 0x0,  0x3,  0x4a, 0xb8, 0x40,
                   0x17, 0x6b, 0x12, 0x0,  0xf,  0xa2, 0x20, 0x9d, 0xb5, 0xac, 0x17, 0xf5, 0xdc, 0xe1, 0x3a, 0xc8, 0xeb,
                   0x4f, 0xf1, 0x54, 0x1,  0xf8, 0x2,  0x0,  0x0,  0x61, 0x60, 0x19, 0xc2, 0x13, 0x0,  0xd0, 0x7a, 0xd9,
                   0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9e, 0xf5, 0x9a, 0x9a, 0xec, 0x18, 0x5f, 0x34, 0xdd, 0xfd,
                               0xc0, 0xb1, 0xac, 0x3c, 0xec, 0x63, 0xab, 0x5d, 0x46, 0x5f};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7a, 0xd9, 0x2d, 0xf3, 0x48, 0x46, 0xb0, 0x48, 0x47, 0xc8, 0xa6, 0x9f};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 29370);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "uh{\218\a\247\172\148\ESC\ETB\187\138\184\255\vX\180\DC1\131\&0\219\216\SI\147\203\ETX)\218", _pubPktID = 0,
// _pubBody = "\207\DC1\209\235\144\141K\255\225\177/B\DC1\DC3\175\144", _pubProps = [PropReasonString
// "\213>\211\224^0\247\164\133Z\154(\198F?\240\167\&59\t\ETBj",PropResponseInformation
// "\211\147f\217\197\253\163U\135\&2",PropSharedSubscriptionAvailable 175,PropCorrelationData
// "r\242\151\207\149\ACKg\241\&3\159\138\171X\SYNA;\nM\223+",PropMessageExpiryInterval 22620,PropServerReference
// "@",PropCorrelationData
// "\153\193\147\164\207}\FSQo\227\224XA\n\206\231\170:\211O\189Z\180",PropRequestResponseInformation
// 223,PropUserProperty "\ENQ\246\&6@\143\RSgP\247\134\SIDH\243\f\DC2[\194\191\240gB\ACK\194\239y\173\230!\166"
// "\134\DELM\195\204\157\SUBy\SO)\241Lp3\GS\199m\129",PropSharedSubscriptionAvailable 20,PropReceiveMaximum
// 15739,PropTopicAliasMaximum 30129,PropMessageExpiryInterval 29406,PropCorrelationData
// "n\DC4\NAK\SOH",PropRetainAvailable 248,PropServerKeepAlive 22227,PropSessionExpiryInterval 18366,PropResponseTopic
// "jY\228\148\244\212\218h\157/'M\215\152\n\188\200\208z1",PropTopicAlias 22179,PropPayloadFormatIndicator
// 236,PropTopicAlias 16075,PropServerKeepAlive 12101]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x38, 0x89, 0x2,  0x0,  0x1c, 0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a,
                   0xb8, 0xff, 0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda, 0xd9,
                   0x1,  0x1f, 0x0,  0x16, 0xd5, 0x3e, 0xd3, 0xe0, 0x5e, 0x30, 0xf7, 0xa4, 0x85, 0x5a, 0x9a, 0x28, 0xc6,
                   0x46, 0x3f, 0xf0, 0xa7, 0x35, 0x39, 0x9,  0x17, 0x6a, 0x1a, 0x0,  0xa,  0xd3, 0x93, 0x66, 0xd9, 0xc5,
                   0xfd, 0xa3, 0x55, 0x87, 0x32, 0x2a, 0xaf, 0x9,  0x0,  0x14, 0x72, 0xf2, 0x97, 0xcf, 0x95, 0x6,  0x67,
                   0xf1, 0x33, 0x9f, 0x8a, 0xab, 0x58, 0x16, 0x41, 0x3b, 0xa,  0x4d, 0xdf, 0x2b, 0x2,  0x0,  0x0,  0x58,
                   0x5c, 0x1c, 0x0,  0x1,  0x40, 0x9,  0x0,  0x17, 0x99, 0xc1, 0x93, 0xa4, 0xcf, 0x7d, 0x1c, 0x51, 0x6f,
                   0xe3, 0xe0, 0x58, 0x41, 0xa,  0xce, 0xe7, 0xaa, 0x3a, 0xd3, 0x4f, 0xbd, 0x5a, 0xb4, 0x19, 0xdf, 0x26,
                   0x0,  0x1e, 0x5,  0xf6, 0x36, 0x40, 0x8f, 0x1e, 0x67, 0x50, 0xf7, 0x86, 0xf,  0x44, 0x48, 0xf3, 0xc,
                   0x12, 0x5b, 0xc2, 0xbf, 0xf0, 0x67, 0x42, 0x6,  0xc2, 0xef, 0x79, 0xad, 0xe6, 0x21, 0xa6, 0x0,  0x12,
                   0x86, 0x7f, 0x4d, 0xc3, 0xcc, 0x9d, 0x1a, 0x79, 0xe,  0x29, 0xf1, 0x4c, 0x70, 0x33, 0x1d, 0xc7, 0x6d,
                   0x81, 0x2a, 0x14, 0x21, 0x3d, 0x7b, 0x22, 0x75, 0xb1, 0x2,  0x0,  0x0,  0x72, 0xde, 0x9,  0x0,  0x4,
                   0x6e, 0x14, 0x15, 0x1,  0x25, 0xf8, 0x13, 0x56, 0xd3, 0x11, 0x0,  0x0,  0x47, 0xbe, 0x8,  0x0,  0x14,
                   0x6a, 0x59, 0xe4, 0x94, 0xf4, 0xd4, 0xda, 0x68, 0x9d, 0x2f, 0x27, 0x4d, 0xd7, 0x98, 0xa,  0xbc, 0xc8,
                   0xd0, 0x7a, 0x31, 0x23, 0x56, 0xa3, 0x1,  0xec, 0x23, 0x3e, 0xcb, 0x13, 0x2f, 0x45, 0xcf, 0x11, 0xd1,
                   0xeb, 0x90, 0x8d, 0x4b, 0xff, 0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  uint8_t topic_bytes[] = {0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a, 0xb8, 0xff,
                           0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xcf, 0x11, 0xd1, 0xeb, 0x90, 0x8d, 0x4b, 0xff,
                         0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops0[] = {0xd5, 0x3e, 0xd3, 0xe0, 0x5e, 0x30, 0xf7, 0xa4, 0x85, 0x5a, 0x9a,
                           0x28, 0xc6, 0x46, 0x3f, 0xf0, 0xa7, 0x35, 0x39, 0x9,  0x17, 0x6a};
  uint8_t bytesprops1[] = {0xd3, 0x93, 0x66, 0xd9, 0xc5, 0xfd, 0xa3, 0x55, 0x87, 0x32};
  uint8_t bytesprops2[] = {0x72, 0xf2, 0x97, 0xcf, 0x95, 0x6,  0x67, 0xf1, 0x33, 0x9f,
                           0x8a, 0xab, 0x58, 0x16, 0x41, 0x3b, 0xa,  0x4d, 0xdf, 0x2b};
  uint8_t bytesprops3[] = {0x40};
  uint8_t bytesprops4[] = {0x99, 0xc1, 0x93, 0xa4, 0xcf, 0x7d, 0x1c, 0x51, 0x6f, 0xe3, 0xe0, 0x58,
                           0x41, 0xa,  0xce, 0xe7, 0xaa, 0x3a, 0xd3, 0x4f, 0xbd, 0x5a, 0xb4};
  uint8_t bytesprops6[] = {0x86, 0x7f, 0x4d, 0xc3, 0xcc, 0x9d, 0x1a, 0x79, 0xe,
                           0x29, 0xf1, 0x4c, 0x70, 0x33, 0x1d, 0xc7, 0x6d, 0x81};
  uint8_t bytesprops5[] = {0x5,  0xf6, 0x36, 0x40, 0x8f, 0x1e, 0x67, 0x50, 0xf7, 0x86, 0xf,  0x44, 0x48, 0xf3, 0xc,
                           0x12, 0x5b, 0xc2, 0xbf, 0xf0, 0x67, 0x42, 0x6,  0xc2, 0xef, 0x79, 0xad, 0xe6, 0x21, 0xa6};
  uint8_t bytesprops7[] = {0x6e, 0x14, 0x15, 0x1};
  uint8_t bytesprops8[] = {0x6a, 0x59, 0xe4, 0x94, 0xf4, 0xd4, 0xda, 0x68, 0x9d, 0x2f,
                           0x27, 0x4d, 0xd7, 0x98, 0xa,  0xbc, 0xc8, 0xd0, 0x7a, 0x31};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22620}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops5}, .v = {18, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15739}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30129}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29406}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22227}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18366}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22179}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16075}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12101}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "uh{\218\a\247\172\148\ESC\ETB\187\138\184\255\vX\180\DC1\131\&0\219\216\SI\147\203\ETX)\218", _pubPktID = 0,
// _pubBody = "\207\DC1\209\235\144\141K\255\225\177/B\DC1\DC3\175\144", _pubProps = [PropReasonString
// "\213>\211\224^0\247\164\133Z\154(\198F?\240\167\&59\t\ETBj",PropResponseInformation
// "\211\147f\217\197\253\163U\135\&2",PropSharedSubscriptionAvailable 175,PropCorrelationData
// "r\242\151\207\149\ACKg\241\&3\159\138\171X\SYNA;\nM\223+",PropMessageExpiryInterval 22620,PropServerReference
// "@",PropCorrelationData
// "\153\193\147\164\207}\FSQo\227\224XA\n\206\231\170:\211O\189Z\180",PropRequestResponseInformation
// 223,PropUserProperty "\ENQ\246\&6@\143\RSgP\247\134\SIDH\243\f\DC2[\194\191\240gB\ACK\194\239y\173\230!\166"
// "\134\DELM\195\204\157\SUBy\SO)\241Lp3\GS\199m\129",PropSharedSubscriptionAvailable 20,PropReceiveMaximum
// 15739,PropTopicAliasMaximum 30129,PropMessageExpiryInterval 29406,PropCorrelationData
// "n\DC4\NAK\SOH",PropRetainAvailable 248,PropServerKeepAlive 22227,PropSessionExpiryInterval 18366,PropResponseTopic
// "jY\228\148\244\212\218h\157/'M\215\152\n\188\200\208z1",PropTopicAlias 22179,PropPayloadFormatIndicator
// 236,PropTopicAlias 16075,PropServerKeepAlive 12101]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x38, 0x89, 0x2,  0x0,  0x1c, 0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a,
                   0xb8, 0xff, 0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda, 0xd9,
                   0x1,  0x1f, 0x0,  0x16, 0xd5, 0x3e, 0xd3, 0xe0, 0x5e, 0x30, 0xf7, 0xa4, 0x85, 0x5a, 0x9a, 0x28, 0xc6,
                   0x46, 0x3f, 0xf0, 0xa7, 0x35, 0x39, 0x9,  0x17, 0x6a, 0x1a, 0x0,  0xa,  0xd3, 0x93, 0x66, 0xd9, 0xc5,
                   0xfd, 0xa3, 0x55, 0x87, 0x32, 0x2a, 0xaf, 0x9,  0x0,  0x14, 0x72, 0xf2, 0x97, 0xcf, 0x95, 0x6,  0x67,
                   0xf1, 0x33, 0x9f, 0x8a, 0xab, 0x58, 0x16, 0x41, 0x3b, 0xa,  0x4d, 0xdf, 0x2b, 0x2,  0x0,  0x0,  0x58,
                   0x5c, 0x1c, 0x0,  0x1,  0x40, 0x9,  0x0,  0x17, 0x99, 0xc1, 0x93, 0xa4, 0xcf, 0x7d, 0x1c, 0x51, 0x6f,
                   0xe3, 0xe0, 0x58, 0x41, 0xa,  0xce, 0xe7, 0xaa, 0x3a, 0xd3, 0x4f, 0xbd, 0x5a, 0xb4, 0x19, 0xdf, 0x26,
                   0x0,  0x1e, 0x5,  0xf6, 0x36, 0x40, 0x8f, 0x1e, 0x67, 0x50, 0xf7, 0x86, 0xf,  0x44, 0x48, 0xf3, 0xc,
                   0x12, 0x5b, 0xc2, 0xbf, 0xf0, 0x67, 0x42, 0x6,  0xc2, 0xef, 0x79, 0xad, 0xe6, 0x21, 0xa6, 0x0,  0x12,
                   0x86, 0x7f, 0x4d, 0xc3, 0xcc, 0x9d, 0x1a, 0x79, 0xe,  0x29, 0xf1, 0x4c, 0x70, 0x33, 0x1d, 0xc7, 0x6d,
                   0x81, 0x2a, 0x14, 0x21, 0x3d, 0x7b, 0x22, 0x75, 0xb1, 0x2,  0x0,  0x0,  0x72, 0xde, 0x9,  0x0,  0x4,
                   0x6e, 0x14, 0x15, 0x1,  0x25, 0xf8, 0x13, 0x56, 0xd3, 0x11, 0x0,  0x0,  0x47, 0xbe, 0x8,  0x0,  0x14,
                   0x6a, 0x59, 0xe4, 0x94, 0xf4, 0xd4, 0xda, 0x68, 0x9d, 0x2f, 0x27, 0x4d, 0xd7, 0x98, 0xa,  0xbc, 0xc8,
                   0xd0, 0x7a, 0x31, 0x23, 0x56, 0xa3, 0x1,  0xec, 0x23, 0x3e, 0xcb, 0x13, 0x2f, 0x45, 0xcf, 0x11, 0xd1,
                   0xeb, 0x90, 0x8d, 0x4b, 0xff, 0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x75, 0x68, 0x7b, 0xda, 0x7,  0xf7, 0xac, 0x94, 0x1b, 0x17, 0xbb, 0x8a, 0xb8, 0xff,
                               0xb,  0x58, 0xb4, 0x11, 0x83, 0x30, 0xdb, 0xd8, 0xf,  0x93, 0xcb, 0x3,  0x29, 0xda};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcf, 0x11, 0xd1, 0xeb, 0x90, 0x8d, 0x4b, 0xff,
                              0xe1, 0xb1, 0x2f, 0x42, 0x11, 0x13, 0xaf, 0x90};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\193)\128\208yd\SOi\134\237\DC2Ir\136\217", _pubPktID = 8430, _pubBody =
// "\138\214\&5p\ESCn,\183\152u\192\244\165\&1\147\140\172", _pubProps = [PropReceiveMaximum
// 19627,PropSubscriptionIdentifier 11,PropPayloadFormatIndicator 254,PropAuthenticationMethod
// "\ETBO\172\EOT\165\CAN\201Y\189xl\153v\a\214\202\176\199",PropContentType "\245*.\194\146",PropMaximumPacketSize
// 15159,PropSubscriptionIdentifierAvailable 168,PropSharedSubscriptionAvailable 41,PropReasonString
// "_}\201lLo>9\n\217}\177",PropReasonString
// "\220[\167\&4h\244\217\222\142H\ETX\175F#\153\161y(O\EMZ\244*s!\174\247",PropPayloadFormatIndicator 155]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x3d, 0x81, 0x1,  0x0,  0xf,  0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe,  0x69, 0x86, 0xed, 0x12, 0x49,
                   0x72, 0x88, 0xd9, 0x20, 0xee, 0x5c, 0x21, 0x4c, 0xab, 0xb,  0xb,  0x1,  0xfe, 0x15, 0x0,  0x12, 0x17,
                   0x4f, 0xac, 0x4,  0xa5, 0x18, 0xc9, 0x59, 0xbd, 0x78, 0x6c, 0x99, 0x76, 0x7,  0xd6, 0xca, 0xb0, 0xc7,
                   0x3,  0x0,  0x5,  0xf5, 0x2a, 0x2e, 0xc2, 0x92, 0x27, 0x0,  0x0,  0x3b, 0x37, 0x29, 0xa8, 0x2a, 0x29,
                   0x1f, 0x0,  0xc,  0x5f, 0x7d, 0xc9, 0x6c, 0x4c, 0x6f, 0x3e, 0x39, 0xa,  0xd9, 0x7d, 0xb1, 0x1f, 0x0,
                   0x1b, 0xdc, 0x5b, 0xa7, 0x34, 0x68, 0xf4, 0xd9, 0xde, 0x8e, 0x48, 0x3,  0xaf, 0x46, 0x23, 0x99, 0xa1,
                   0x79, 0x28, 0x4f, 0x19, 0x5a, 0xf4, 0x2a, 0x73, 0x21, 0xae, 0xf7, 0x1,  0x9b, 0x8a, 0xd6, 0x35, 0x70,
                   0x1b, 0x6e, 0x2c, 0xb7, 0x98, 0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  uint8_t topic_bytes[] = {0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe, 0x69, 0x86, 0xed, 0x12, 0x49, 0x72, 0x88, 0xd9};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x8a, 0xd6, 0x35, 0x70, 0x1b, 0x6e, 0x2c, 0xb7, 0x98,
                         0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0x17, 0x4f, 0xac, 0x4,  0xa5, 0x18, 0xc9, 0x59, 0xbd,
                           0x78, 0x6c, 0x99, 0x76, 0x7,  0xd6, 0xca, 0xb0, 0xc7};
  uint8_t bytesprops1[] = {0xf5, 0x2a, 0x2e, 0xc2, 0x92};
  uint8_t bytesprops2[] = {0x5f, 0x7d, 0xc9, 0x6c, 0x4c, 0x6f, 0x3e, 0x39, 0xa, 0xd9, 0x7d, 0xb1};
  uint8_t bytesprops3[] = {0xdc, 0x5b, 0xa7, 0x34, 0x68, 0xf4, 0xd9, 0xde, 0x8e, 0x48, 0x3,  0xaf, 0x46, 0x23,
                           0x99, 0xa1, 0x79, 0x28, 0x4f, 0x19, 0x5a, 0xf4, 0x2a, 0x73, 0x21, 0xae, 0xf7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19627}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15159}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 155}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 8430, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\193)\128\208yd\SOi\134\237\DC2Ir\136\217", _pubPktID = 8430, _pubBody =
// "\138\214\&5p\ESCn,\183\152u\192\244\165\&1\147\140\172", _pubProps = [PropReceiveMaximum
// 19627,PropSubscriptionIdentifier 11,PropPayloadFormatIndicator 254,PropAuthenticationMethod
// "\ETBO\172\EOT\165\CAN\201Y\189xl\153v\a\214\202\176\199",PropContentType "\245*.\194\146",PropMaximumPacketSize
// 15159,PropSubscriptionIdentifierAvailable 168,PropSharedSubscriptionAvailable 41,PropReasonString
// "_}\201lLo>9\n\217}\177",PropReasonString
// "\220[\167\&4h\244\217\222\142H\ETX\175F#\153\161y(O\EMZ\244*s!\174\247",PropPayloadFormatIndicator 155]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x3d, 0x81, 0x1,  0x0,  0xf,  0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe,  0x69, 0x86, 0xed, 0x12, 0x49,
                   0x72, 0x88, 0xd9, 0x20, 0xee, 0x5c, 0x21, 0x4c, 0xab, 0xb,  0xb,  0x1,  0xfe, 0x15, 0x0,  0x12, 0x17,
                   0x4f, 0xac, 0x4,  0xa5, 0x18, 0xc9, 0x59, 0xbd, 0x78, 0x6c, 0x99, 0x76, 0x7,  0xd6, 0xca, 0xb0, 0xc7,
                   0x3,  0x0,  0x5,  0xf5, 0x2a, 0x2e, 0xc2, 0x92, 0x27, 0x0,  0x0,  0x3b, 0x37, 0x29, 0xa8, 0x2a, 0x29,
                   0x1f, 0x0,  0xc,  0x5f, 0x7d, 0xc9, 0x6c, 0x4c, 0x6f, 0x3e, 0x39, 0xa,  0xd9, 0x7d, 0xb1, 0x1f, 0x0,
                   0x1b, 0xdc, 0x5b, 0xa7, 0x34, 0x68, 0xf4, 0xd9, 0xde, 0x8e, 0x48, 0x3,  0xaf, 0x46, 0x23, 0x99, 0xa1,
                   0x79, 0x28, 0x4f, 0x19, 0x5a, 0xf4, 0x2a, 0x73, 0x21, 0xae, 0xf7, 0x1,  0x9b, 0x8a, 0xd6, 0x35, 0x70,
                   0x1b, 0x6e, 0x2c, 0xb7, 0x98, 0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc1, 0x29, 0x80, 0xd0, 0x79, 0x64, 0xe, 0x69, 0x86, 0xed, 0x12, 0x49, 0x72, 0x88, 0xd9};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8a, 0xd6, 0x35, 0x70, 0x1b, 0x6e, 0x2c, 0xb7, 0x98,
                              0x75, 0xc0, 0xf4, 0xa5, 0x31, 0x93, 0x8c, 0xac};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8430);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\DC2\184\144\&5\136\156E\174\237\230\175\SUB\153 \NAKk\EM\f", _pubPktID = 0, _pubBody =
// "i\232{\DC3k\GS\158\DLE|\218\236v\244>\145\172,\bR\165\255\174", _pubProps = [PropCorrelationData
// "\227\244",PropServerKeepAlive 1521,PropResponseTopic "\130%)hs"]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x31, 0x3b, 0x0,  0x12, 0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed, 0xe6, 0xaf, 0x1a,
                   0x99, 0x20, 0x15, 0x6b, 0x19, 0xc,  0x10, 0x9,  0x0,  0x2,  0xe3, 0xf4, 0x13, 0x5,  0xf1, 0x8,
                   0x0,  0x5,  0x82, 0x25, 0x29, 0x68, 0x73, 0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10, 0x7c,
                   0xda, 0xec, 0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  uint8_t topic_bytes[] = {0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed,
                           0xe6, 0xaf, 0x1a, 0x99, 0x20, 0x15, 0x6b, 0x19, 0xc};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10, 0x7c, 0xda, 0xec,
                         0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0xe3, 0xf4};
  uint8_t bytesprops1[] = {0x82, 0x25, 0x29, 0x68, 0x73};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1521}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\DC2\184\144\&5\136\156E\174\237\230\175\SUB\153 \NAKk\EM\f", _pubPktID = 0, _pubBody =
// "i\232{\DC3k\GS\158\DLE|\218\236v\244>\145\172,\bR\165\255\174", _pubProps = [PropCorrelationData
// "\227\244",PropServerKeepAlive 1521,PropResponseTopic "\130%)hs"]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x31, 0x3b, 0x0,  0x12, 0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed, 0xe6, 0xaf, 0x1a,
                   0x99, 0x20, 0x15, 0x6b, 0x19, 0xc,  0x10, 0x9,  0x0,  0x2,  0xe3, 0xf4, 0x13, 0x5,  0xf1, 0x8,
                   0x0,  0x5,  0x82, 0x25, 0x29, 0x68, 0x73, 0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10, 0x7c,
                   0xda, 0xec, 0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x12, 0xb8, 0x90, 0x35, 0x88, 0x9c, 0x45, 0xae, 0xed,
                               0xe6, 0xaf, 0x1a, 0x99, 0x20, 0x15, 0x6b, 0x19, 0xc};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x69, 0xe8, 0x7b, 0x13, 0x6b, 0x1d, 0x9e, 0x10, 0x7c, 0xda, 0xec,
                              0x76, 0xf4, 0x3e, 0x91, 0xac, 0x2c, 0x8,  0x52, 0xa5, 0xff, 0xae};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\251M\156e\192", _pubPktID = 0,
// _pubBody = "O\254\197\133\153\151~\137\172", _pubProps = [PropCorrelationData "\164\SYNM",PropResponseInformation
// "\198\172\187",PropMessageExpiryInterval 15651,PropRetainAvailable 113,PropSharedSubscriptionAvailable
// 216,PropPayloadFormatIndicator 60,PropSessionExpiryInterval 32556,PropRetainAvailable 157,PropResponseTopic
// "bs\182\201\208\166\184\235s",PropSharedSubscriptionAvailable 161,PropCorrelationData
// "\251\167\&6W,g\154\DC2{\163\173\n\177\145\221\151\162\251\159;!o\232\SI\205]{\239\148\216",PropSubscriptionIdentifierAvailable
// 131,PropTopicAliasMaximum 30761,PropMaximumQoS 12,PropContentType
// "\214\132_\244\175\236=^\131\r1d!\223\173w\221",PropWillDelayInterval 27380,PropRequestProblemInformation
// 122,PropTopicAlias 19545,PropReasonString "\166\EOT\231\US\185",PropSubscriptionIdentifierAvailable 97]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x31, 0x8d, 0x1,  0x0,  0x5,  0xfb, 0x4d, 0x9c, 0x65, 0xc0, 0x7c, 0x9,  0x0,  0x3,  0xa4, 0x16,
                   0x4d, 0x1a, 0x0,  0x3,  0xc6, 0xac, 0xbb, 0x2,  0x0,  0x0,  0x3d, 0x23, 0x25, 0x71, 0x2a, 0xd8,
                   0x1,  0x3c, 0x11, 0x0,  0x0,  0x7f, 0x2c, 0x25, 0x9d, 0x8,  0x0,  0x9,  0x62, 0x73, 0xb6, 0xc9,
                   0xd0, 0xa6, 0xb8, 0xeb, 0x73, 0x2a, 0xa1, 0x9,  0x0,  0x1e, 0xfb, 0xa7, 0x36, 0x57, 0x2c, 0x67,
                   0x9a, 0x12, 0x7b, 0xa3, 0xad, 0xa,  0xb1, 0x91, 0xdd, 0x97, 0xa2, 0xfb, 0x9f, 0x3b, 0x21, 0x6f,
                   0xe8, 0xf,  0xcd, 0x5d, 0x7b, 0xef, 0x94, 0xd8, 0x29, 0x83, 0x22, 0x78, 0x29, 0x24, 0xc,  0x3,
                   0x0,  0x11, 0xd6, 0x84, 0x5f, 0xf4, 0xaf, 0xec, 0x3d, 0x5e, 0x83, 0xd,  0x31, 0x64, 0x21, 0xdf,
                   0xad, 0x77, 0xdd, 0x18, 0x0,  0x0,  0x6a, 0xf4, 0x17, 0x7a, 0x23, 0x4c, 0x59, 0x1f, 0x0,  0x5,
                   0xa6, 0x4,  0xe7, 0x1f, 0xb9, 0x29, 0x61, 0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  uint8_t topic_bytes[] = {0xfb, 0x4d, 0x9c, 0x65, 0xc0};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0xa4, 0x16, 0x4d};
  uint8_t bytesprops1[] = {0xc6, 0xac, 0xbb};
  uint8_t bytesprops2[] = {0x62, 0x73, 0xb6, 0xc9, 0xd0, 0xa6, 0xb8, 0xeb, 0x73};
  uint8_t bytesprops3[] = {0xfb, 0xa7, 0x36, 0x57, 0x2c, 0x67, 0x9a, 0x12, 0x7b, 0xa3, 0xad, 0xa,  0xb1, 0x91, 0xdd,
                           0x97, 0xa2, 0xfb, 0x9f, 0x3b, 0x21, 0x6f, 0xe8, 0xf,  0xcd, 0x5d, 0x7b, 0xef, 0x94, 0xd8};
  uint8_t bytesprops4[] = {0xd6, 0x84, 0x5f, 0xf4, 0xaf, 0xec, 0x3d, 0x5e, 0x83,
                           0xd,  0x31, 0x64, 0x21, 0xdf, 0xad, 0x77, 0xdd};
  uint8_t bytesprops5[] = {0xa6, 0x4, 0xe7, 0x1f, 0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15651}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32556}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30761}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27380}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19545}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 97}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\251M\156e\192", _pubPktID = 0,
// _pubBody = "O\254\197\133\153\151~\137\172", _pubProps = [PropCorrelationData "\164\SYNM",PropResponseInformation
// "\198\172\187",PropMessageExpiryInterval 15651,PropRetainAvailable 113,PropSharedSubscriptionAvailable
// 216,PropPayloadFormatIndicator 60,PropSessionExpiryInterval 32556,PropRetainAvailable 157,PropResponseTopic
// "bs\182\201\208\166\184\235s",PropSharedSubscriptionAvailable 161,PropCorrelationData
// "\251\167\&6W,g\154\DC2{\163\173\n\177\145\221\151\162\251\159;!o\232\SI\205]{\239\148\216",PropSubscriptionIdentifierAvailable
// 131,PropTopicAliasMaximum 30761,PropMaximumQoS 12,PropContentType
// "\214\132_\244\175\236=^\131\r1d!\223\173w\221",PropWillDelayInterval 27380,PropRequestProblemInformation
// 122,PropTopicAlias 19545,PropReasonString "\166\EOT\231\US\185",PropSubscriptionIdentifierAvailable 97]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x31, 0x8d, 0x1,  0x0,  0x5,  0xfb, 0x4d, 0x9c, 0x65, 0xc0, 0x7c, 0x9,  0x0,  0x3,  0xa4, 0x16,
                   0x4d, 0x1a, 0x0,  0x3,  0xc6, 0xac, 0xbb, 0x2,  0x0,  0x0,  0x3d, 0x23, 0x25, 0x71, 0x2a, 0xd8,
                   0x1,  0x3c, 0x11, 0x0,  0x0,  0x7f, 0x2c, 0x25, 0x9d, 0x8,  0x0,  0x9,  0x62, 0x73, 0xb6, 0xc9,
                   0xd0, 0xa6, 0xb8, 0xeb, 0x73, 0x2a, 0xa1, 0x9,  0x0,  0x1e, 0xfb, 0xa7, 0x36, 0x57, 0x2c, 0x67,
                   0x9a, 0x12, 0x7b, 0xa3, 0xad, 0xa,  0xb1, 0x91, 0xdd, 0x97, 0xa2, 0xfb, 0x9f, 0x3b, 0x21, 0x6f,
                   0xe8, 0xf,  0xcd, 0x5d, 0x7b, 0xef, 0x94, 0xd8, 0x29, 0x83, 0x22, 0x78, 0x29, 0x24, 0xc,  0x3,
                   0x0,  0x11, 0xd6, 0x84, 0x5f, 0xf4, 0xaf, 0xec, 0x3d, 0x5e, 0x83, 0xd,  0x31, 0x64, 0x21, 0xdf,
                   0xad, 0x77, 0xdd, 0x18, 0x0,  0x0,  0x6a, 0xf4, 0x17, 0x7a, 0x23, 0x4c, 0x59, 0x1f, 0x0,  0x5,
                   0xa6, 0x4,  0xe7, 0x1f, 0xb9, 0x29, 0x61, 0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xfb, 0x4d, 0x9c, 0x65, 0xc0};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4f, 0xfe, 0xc5, 0x85, 0x99, 0x97, 0x7e, 0x89, 0xac};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\224@\143", _pubPktID = 6480,
// _pubBody = "p\191(\150l\241Y\SO\208g\192\EMT+\DLE\246\189f\179C\EOTFwX1\DC3I*A\n", _pubProps =
// [PropSubscriptionIdentifierAvailable 229,PropSubscriptionIdentifierAvailable 203,PropAssignedClientIdentifier
// "F\195\210\155",PropServerReference "\213\201\ESC\EOT\129|\187\139x",PropReceiveMaximum 23639,PropUserProperty
// "\SO\222O\NAK\188\216\b1\STX\138\158\205m\236D\fy\GS*\223\162\v\231\188\154B\ESC(i" "\178u\ETB\251\241\206\204:j\178
// ",PropAuthenticationMethod "\167\SUB\235\224\179nC",PropCorrelationData "AH\143]M\202X\141\STX>",PropTopicAlias
// 7879,PropAssignedClientIdentifier "?8\196vb\209i\185\175\&5N\174{\250d\151w%",PropSubscriptionIdentifierAvailable
// 108,PropSharedSubscriptionAvailable 218,PropTopicAlias 27267,PropMaximumPacketSize 20290,PropResponseTopic
// "\EOT\135/c\153\173\178\192\184\207\DC4\ENQ\247\174\CANr\184\197\185\203\\\190\182H"]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x3b, 0xc4, 0x1,  0x0,  0x3,  0xe0, 0x40, 0x8f, 0x19, 0x50, 0x9d, 0x1,  0x29, 0xe5, 0x29, 0xcb, 0x12,
                   0x0,  0x4,  0x46, 0xc3, 0xd2, 0x9b, 0x1c, 0x0,  0x9,  0xd5, 0xc9, 0x1b, 0x4,  0x81, 0x7c, 0xbb, 0x8b,
                   0x78, 0x21, 0x5c, 0x57, 0x26, 0x0,  0x1d, 0xe,  0xde, 0x4f, 0x15, 0xbc, 0xd8, 0x8,  0x31, 0x2,  0x8a,
                   0x9e, 0xcd, 0x6d, 0xec, 0x44, 0xc,  0x79, 0x1d, 0x2a, 0xdf, 0xa2, 0xb,  0xe7, 0xbc, 0x9a, 0x42, 0x1b,
                   0x28, 0x69, 0x0,  0xb,  0xb2, 0x75, 0x17, 0xfb, 0xf1, 0xce, 0xcc, 0x3a, 0x6a, 0xb2, 0x20, 0x15, 0x0,
                   0x7,  0xa7, 0x1a, 0xeb, 0xe0, 0xb3, 0x6e, 0x43, 0x9,  0x0,  0xa,  0x41, 0x48, 0x8f, 0x5d, 0x4d, 0xca,
                   0x58, 0x8d, 0x2,  0x3e, 0x23, 0x1e, 0xc7, 0x12, 0x0,  0x12, 0x3f, 0x38, 0xc4, 0x76, 0x62, 0xd1, 0x69,
                   0xb9, 0xaf, 0x35, 0x4e, 0xae, 0x7b, 0xfa, 0x64, 0x97, 0x77, 0x25, 0x29, 0x6c, 0x2a, 0xda, 0x23, 0x6a,
                   0x83, 0x27, 0x0,  0x0,  0x4f, 0x42, 0x8,  0x0,  0x18, 0x4,  0x87, 0x2f, 0x63, 0x99, 0xad, 0xb2, 0xc0,
                   0xb8, 0xcf, 0x14, 0x5,  0xf7, 0xae, 0x18, 0x72, 0xb8, 0xc5, 0xb9, 0xcb, 0x5c, 0xbe, 0xb6, 0x48, 0x70,
                   0xbf, 0x28, 0x96, 0x6c, 0xf1, 0x59, 0xe,  0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10, 0xf6, 0xbd, 0x66,
                   0xb3, 0x43, 0x4,  0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  uint8_t topic_bytes[] = {0xe0, 0x40, 0x8f};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x70, 0xbf, 0x28, 0x96, 0x6c, 0xf1, 0x59, 0xe,  0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10,
                         0xf6, 0xbd, 0x66, 0xb3, 0x43, 0x4,  0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 30;

  uint8_t bytesprops0[] = {0x46, 0xc3, 0xd2, 0x9b};
  uint8_t bytesprops1[] = {0xd5, 0xc9, 0x1b, 0x4, 0x81, 0x7c, 0xbb, 0x8b, 0x78};
  uint8_t bytesprops3[] = {0xb2, 0x75, 0x17, 0xfb, 0xf1, 0xce, 0xcc, 0x3a, 0x6a, 0xb2, 0x20};
  uint8_t bytesprops2[] = {0xe, 0xde, 0x4f, 0x15, 0xbc, 0xd8, 0x8, 0x31, 0x2,  0x8a, 0x9e, 0xcd, 0x6d, 0xec, 0x44,
                           0xc, 0x79, 0x1d, 0x2a, 0xdf, 0xa2, 0xb, 0xe7, 0xbc, 0x9a, 0x42, 0x1b, 0x28, 0x69};
  uint8_t bytesprops4[] = {0xa7, 0x1a, 0xeb, 0xe0, 0xb3, 0x6e, 0x43};
  uint8_t bytesprops5[] = {0x41, 0x48, 0x8f, 0x5d, 0x4d, 0xca, 0x58, 0x8d, 0x2, 0x3e};
  uint8_t bytesprops6[] = {0x3f, 0x38, 0xc4, 0x76, 0x62, 0xd1, 0x69, 0xb9, 0xaf,
                           0x35, 0x4e, 0xae, 0x7b, 0xfa, 0x64, 0x97, 0x77, 0x25};
  uint8_t bytesprops7[] = {0x4,  0x87, 0x2f, 0x63, 0x99, 0xad, 0xb2, 0xc0, 0xb8, 0xcf, 0x14, 0x5,
                           0xf7, 0xae, 0x18, 0x72, 0xb8, 0xc5, 0xb9, 0xcb, 0x5c, 0xbe, 0xb6, 0x48};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23639}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops2}, .v = {11, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7879}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27267}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20290}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6480, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\224@\143", _pubPktID = 6480,
// _pubBody = "p\191(\150l\241Y\SO\208g\192\EMT+\DLE\246\189f\179C\EOTFwX1\DC3I*A\n", _pubProps =
// [PropSubscriptionIdentifierAvailable 229,PropSubscriptionIdentifierAvailable 203,PropAssignedClientIdentifier
// "F\195\210\155",PropServerReference "\213\201\ESC\EOT\129|\187\139x",PropReceiveMaximum 23639,PropUserProperty
// "\SO\222O\NAK\188\216\b1\STX\138\158\205m\236D\fy\GS*\223\162\v\231\188\154B\ESC(i" "\178u\ETB\251\241\206\204:j\178
// ",PropAuthenticationMethod "\167\SUB\235\224\179nC",PropCorrelationData "AH\143]M\202X\141\STX>",PropTopicAlias
// 7879,PropAssignedClientIdentifier "?8\196vb\209i\185\175\&5N\174{\250d\151w%",PropSubscriptionIdentifierAvailable
// 108,PropSharedSubscriptionAvailable 218,PropTopicAlias 27267,PropMaximumPacketSize 20290,PropResponseTopic
// "\EOT\135/c\153\173\178\192\184\207\DC4\ENQ\247\174\CANr\184\197\185\203\\\190\182H"]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {0x3b, 0xc4, 0x1,  0x0,  0x3,  0xe0, 0x40, 0x8f, 0x19, 0x50, 0x9d, 0x1,  0x29, 0xe5, 0x29, 0xcb, 0x12,
                   0x0,  0x4,  0x46, 0xc3, 0xd2, 0x9b, 0x1c, 0x0,  0x9,  0xd5, 0xc9, 0x1b, 0x4,  0x81, 0x7c, 0xbb, 0x8b,
                   0x78, 0x21, 0x5c, 0x57, 0x26, 0x0,  0x1d, 0xe,  0xde, 0x4f, 0x15, 0xbc, 0xd8, 0x8,  0x31, 0x2,  0x8a,
                   0x9e, 0xcd, 0x6d, 0xec, 0x44, 0xc,  0x79, 0x1d, 0x2a, 0xdf, 0xa2, 0xb,  0xe7, 0xbc, 0x9a, 0x42, 0x1b,
                   0x28, 0x69, 0x0,  0xb,  0xb2, 0x75, 0x17, 0xfb, 0xf1, 0xce, 0xcc, 0x3a, 0x6a, 0xb2, 0x20, 0x15, 0x0,
                   0x7,  0xa7, 0x1a, 0xeb, 0xe0, 0xb3, 0x6e, 0x43, 0x9,  0x0,  0xa,  0x41, 0x48, 0x8f, 0x5d, 0x4d, 0xca,
                   0x58, 0x8d, 0x2,  0x3e, 0x23, 0x1e, 0xc7, 0x12, 0x0,  0x12, 0x3f, 0x38, 0xc4, 0x76, 0x62, 0xd1, 0x69,
                   0xb9, 0xaf, 0x35, 0x4e, 0xae, 0x7b, 0xfa, 0x64, 0x97, 0x77, 0x25, 0x29, 0x6c, 0x2a, 0xda, 0x23, 0x6a,
                   0x83, 0x27, 0x0,  0x0,  0x4f, 0x42, 0x8,  0x0,  0x18, 0x4,  0x87, 0x2f, 0x63, 0x99, 0xad, 0xb2, 0xc0,
                   0xb8, 0xcf, 0x14, 0x5,  0xf7, 0xae, 0x18, 0x72, 0xb8, 0xc5, 0xb9, 0xcb, 0x5c, 0xbe, 0xb6, 0x48, 0x70,
                   0xbf, 0x28, 0x96, 0x6c, 0xf1, 0x59, 0xe,  0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10, 0xf6, 0xbd, 0x66,
                   0xb3, 0x43, 0x4,  0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe0, 0x40, 0x8f};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x70, 0xbf, 0x28, 0x96, 0x6c, 0xf1, 0x59, 0xe,  0xd0, 0x67, 0xc0, 0x19, 0x54, 0x2b, 0x10,
                              0xf6, 0xbd, 0x66, 0xb3, 0x43, 0x4,  0x46, 0x77, 0x58, 0x31, 0x13, 0x49, 0x2a, 0x41, 0xa};
  lwmqtt_string_t exp_body = {30, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 6480);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 30);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 30);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\141\RSw\147`\NAK\ENQ\149f_Y\196\&3b\209U\150s\240\238\a\156\v\151~%\224P\244", _pubPktID = 0, _pubBody =
// "\220\213O", _pubProps = [PropReceiveMaximum 18322,PropRetainAvailable 119,PropReasonString
// "\175\180[\213\230/\203\DC3\173b\160^\DC2\201Y\185\129w\fXw",PropPayloadFormatIndicator 175,PropMaximumQoS
// 179,PropMaximumQoS 174,PropAssignedClientIdentifier "(\217\225\156\ACK",PropResponseTopic
// "\217L\191\252oU\FSl\212\FS\222\213\242\224I\ETB\SO",PropMaximumPacketSize 19484,PropReceiveMaximum
// 32000,PropAssignedClientIdentifier "*u\157f\233aI\237",PropTopicAlias 6311,PropMessageExpiryInterval
// 1640,PropReceiveMaximum 7468,PropMessageExpiryInterval 16489,PropSessionExpiryInterval 3774,PropServerKeepAlive
// 13402,PropTopicAliasMaximum 2331,PropWildcardSubscriptionAvailable 197,PropAuthenticationMethod
// "\206H\160T\197P\CAN\v",PropCorrelationData "\247x\201\224\234b\195\145/\203\192",PropSubscriptionIdentifier
// 19,PropMessageExpiryInterval 16517,PropMaximumPacketSize 20293,PropRequestProblemInformation 92]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x38, 0xba, 0x1,  0x0,  0x1d, 0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95, 0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62,
      0xd1, 0x55, 0x96, 0x73, 0xf0, 0xee, 0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4, 0x96, 0x1,  0x21, 0x47,
      0x92, 0x25, 0x77, 0x1f, 0x0,  0x15, 0xaf, 0xb4, 0x5b, 0xd5, 0xe6, 0x2f, 0xcb, 0x13, 0xad, 0x62, 0xa0, 0x5e, 0x12,
      0xc9, 0x59, 0xb9, 0x81, 0x77, 0xc,  0x58, 0x77, 0x1,  0xaf, 0x24, 0xb3, 0x24, 0xae, 0x12, 0x0,  0x5,  0x28, 0xd9,
      0xe1, 0x9c, 0x6,  0x8,  0x0,  0x11, 0xd9, 0x4c, 0xbf, 0xfc, 0x6f, 0x55, 0x1c, 0x6c, 0xd4, 0x1c, 0xde, 0xd5, 0xf2,
      0xe0, 0x49, 0x17, 0xe,  0x27, 0x0,  0x0,  0x4c, 0x1c, 0x21, 0x7d, 0x0,  0x12, 0x0,  0x8,  0x2a, 0x75, 0x9d, 0x66,
      0xe9, 0x61, 0x49, 0xed, 0x23, 0x18, 0xa7, 0x2,  0x0,  0x0,  0x6,  0x68, 0x21, 0x1d, 0x2c, 0x2,  0x0,  0x0,  0x40,
      0x69, 0x11, 0x0,  0x0,  0xe,  0xbe, 0x13, 0x34, 0x5a, 0x22, 0x9,  0x1b, 0x28, 0xc5, 0x15, 0x0,  0x8,  0xce, 0x48,
      0xa0, 0x54, 0xc5, 0x50, 0x18, 0xb,  0x9,  0x0,  0xb,  0xf7, 0x78, 0xc9, 0xe0, 0xea, 0x62, 0xc3, 0x91, 0x2f, 0xcb,
      0xc0, 0xb,  0x13, 0x2,  0x0,  0x0,  0x40, 0x85, 0x27, 0x0,  0x0,  0x4f, 0x45, 0x17, 0x5c, 0xdc, 0xd5, 0x4f};
  uint8_t topic_bytes[] = {0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95, 0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62, 0xd1,
                           0x55, 0x96, 0x73, 0xf0, 0xee, 0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xdc, 0xd5, 0x4f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xaf, 0xb4, 0x5b, 0xd5, 0xe6, 0x2f, 0xcb, 0x13, 0xad, 0x62, 0xa0,
                           0x5e, 0x12, 0xc9, 0x59, 0xb9, 0x81, 0x77, 0xc,  0x58, 0x77};
  uint8_t bytesprops1[] = {0x28, 0xd9, 0xe1, 0x9c, 0x6};
  uint8_t bytesprops2[] = {0xd9, 0x4c, 0xbf, 0xfc, 0x6f, 0x55, 0x1c, 0x6c, 0xd4,
                           0x1c, 0xde, 0xd5, 0xf2, 0xe0, 0x49, 0x17, 0xe};
  uint8_t bytesprops3[] = {0x2a, 0x75, 0x9d, 0x66, 0xe9, 0x61, 0x49, 0xed};
  uint8_t bytesprops4[] = {0xce, 0x48, 0xa0, 0x54, 0xc5, 0x50, 0x18, 0xb};
  uint8_t bytesprops5[] = {0xf7, 0x78, 0xc9, 0xe0, 0xea, 0x62, 0xc3, 0x91, 0x2f, 0xcb, 0xc0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18322}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19484}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32000}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6311}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1640}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7468}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16489}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3774}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13402}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2331}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16517}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20293}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 92}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\141\RSw\147`\NAK\ENQ\149f_Y\196\&3b\209U\150s\240\238\a\156\v\151~%\224P\244", _pubPktID = 0, _pubBody =
// "\220\213O", _pubProps = [PropReceiveMaximum 18322,PropRetainAvailable 119,PropReasonString
// "\175\180[\213\230/\203\DC3\173b\160^\DC2\201Y\185\129w\fXw",PropPayloadFormatIndicator 175,PropMaximumQoS
// 179,PropMaximumQoS 174,PropAssignedClientIdentifier "(\217\225\156\ACK",PropResponseTopic
// "\217L\191\252oU\FSl\212\FS\222\213\242\224I\ETB\SO",PropMaximumPacketSize 19484,PropReceiveMaximum
// 32000,PropAssignedClientIdentifier "*u\157f\233aI\237",PropTopicAlias 6311,PropMessageExpiryInterval
// 1640,PropReceiveMaximum 7468,PropMessageExpiryInterval 16489,PropSessionExpiryInterval 3774,PropServerKeepAlive
// 13402,PropTopicAliasMaximum 2331,PropWildcardSubscriptionAvailable 197,PropAuthenticationMethod
// "\206H\160T\197P\CAN\v",PropCorrelationData "\247x\201\224\234b\195\145/\203\192",PropSubscriptionIdentifier
// 19,PropMessageExpiryInterval 16517,PropMaximumPacketSize 20293,PropRequestProblemInformation 92]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {
      0x38, 0xba, 0x1,  0x0,  0x1d, 0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95, 0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62,
      0xd1, 0x55, 0x96, 0x73, 0xf0, 0xee, 0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4, 0x96, 0x1,  0x21, 0x47,
      0x92, 0x25, 0x77, 0x1f, 0x0,  0x15, 0xaf, 0xb4, 0x5b, 0xd5, 0xe6, 0x2f, 0xcb, 0x13, 0xad, 0x62, 0xa0, 0x5e, 0x12,
      0xc9, 0x59, 0xb9, 0x81, 0x77, 0xc,  0x58, 0x77, 0x1,  0xaf, 0x24, 0xb3, 0x24, 0xae, 0x12, 0x0,  0x5,  0x28, 0xd9,
      0xe1, 0x9c, 0x6,  0x8,  0x0,  0x11, 0xd9, 0x4c, 0xbf, 0xfc, 0x6f, 0x55, 0x1c, 0x6c, 0xd4, 0x1c, 0xde, 0xd5, 0xf2,
      0xe0, 0x49, 0x17, 0xe,  0x27, 0x0,  0x0,  0x4c, 0x1c, 0x21, 0x7d, 0x0,  0x12, 0x0,  0x8,  0x2a, 0x75, 0x9d, 0x66,
      0xe9, 0x61, 0x49, 0xed, 0x23, 0x18, 0xa7, 0x2,  0x0,  0x0,  0x6,  0x68, 0x21, 0x1d, 0x2c, 0x2,  0x0,  0x0,  0x40,
      0x69, 0x11, 0x0,  0x0,  0xe,  0xbe, 0x13, 0x34, 0x5a, 0x22, 0x9,  0x1b, 0x28, 0xc5, 0x15, 0x0,  0x8,  0xce, 0x48,
      0xa0, 0x54, 0xc5, 0x50, 0x18, 0xb,  0x9,  0x0,  0xb,  0xf7, 0x78, 0xc9, 0xe0, 0xea, 0x62, 0xc3, 0x91, 0x2f, 0xcb,
      0xc0, 0xb,  0x13, 0x2,  0x0,  0x0,  0x40, 0x85, 0x27, 0x0,  0x0,  0x4f, 0x45, 0x17, 0x5c, 0xdc, 0xd5, 0x4f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x8d, 0x1e, 0x77, 0x93, 0x60, 0x15, 0x5,  0x95, 0x66, 0x5f, 0x59, 0xc4, 0x33, 0x62, 0xd1,
                               0x55, 0x96, 0x73, 0xf0, 0xee, 0x7,  0x9c, 0xb,  0x97, 0x7e, 0x25, 0xe0, 0x50, 0xf4};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xdc, 0xd5, 0x4f};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\130\180J\210\214\ENQ\185\DC3T.\233,_\253N\188M\218\t\203\210\&9z\193w\227", _pubPktID = 5801, _pubBody =
// "e/2Y\147]W%\233\NUL\170j25\192", _pubProps = [PropUserProperty "+\173\131\ETX\156\246\222i\129\FS"
// "]\154C\131\170|\248P",PropContentType "\128\CAN\181Y",PropSubscriptionIdentifierAvailable
// 184,PropSharedSubscriptionAvailable 154,PropResponseInformation "!\174\152@#\171\248l\r\161\231\b4",PropTopicAlias
// 24162,PropResponseTopic
// "h\253\215\&3\165\155\178D\181\SO\SYNP\225\RS\175\226/\154\203\229\&9\205\132\225\203",PropMaximumQoS 62]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x3a, 0x81, 0x1,  0x0,  0x1a, 0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5,  0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c,
                   0x5f, 0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9,  0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3, 0x16, 0xa9, 0x53,
                   0x26, 0x0,  0xa,  0x2b, 0xad, 0x83, 0x3,  0x9c, 0xf6, 0xde, 0x69, 0x81, 0x1c, 0x0,  0x8,  0x5d, 0x9a,
                   0x43, 0x83, 0xaa, 0x7c, 0xf8, 0x50, 0x3,  0x0,  0x4,  0x80, 0x18, 0xb5, 0x59, 0x29, 0xb8, 0x2a, 0x9a,
                   0x1a, 0x0,  0xd,  0x21, 0xae, 0x98, 0x40, 0x23, 0xab, 0xf8, 0x6c, 0xd,  0xa1, 0xe7, 0x8,  0x34, 0x23,
                   0x5e, 0x62, 0x8,  0x0,  0x19, 0x68, 0xfd, 0xd7, 0x33, 0xa5, 0x9b, 0xb2, 0x44, 0xb5, 0xe,  0x16, 0x50,
                   0xe1, 0x1e, 0xaf, 0xe2, 0x2f, 0x9a, 0xcb, 0xe5, 0x39, 0xcd, 0x84, 0xe1, 0xcb, 0x24, 0x3e, 0x65, 0x2f,
                   0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0,  0xaa, 0x6a, 0x32, 0x35, 0xc0};
  uint8_t topic_bytes[] = {0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5, 0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c, 0x5f,
                           0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9, 0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x65, 0x2f, 0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0, 0xaa, 0x6a, 0x32, 0x35, 0xc0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops1[] = {0x5d, 0x9a, 0x43, 0x83, 0xaa, 0x7c, 0xf8, 0x50};
  uint8_t bytesprops0[] = {0x2b, 0xad, 0x83, 0x3, 0x9c, 0xf6, 0xde, 0x69, 0x81, 0x1c};
  uint8_t bytesprops2[] = {0x80, 0x18, 0xb5, 0x59};
  uint8_t bytesprops3[] = {0x21, 0xae, 0x98, 0x40, 0x23, 0xab, 0xf8, 0x6c, 0xd, 0xa1, 0xe7, 0x8, 0x34};
  uint8_t bytesprops4[] = {0x68, 0xfd, 0xd7, 0x33, 0xa5, 0x9b, 0xb2, 0x44, 0xb5, 0xe,  0x16, 0x50, 0xe1,
                           0x1e, 0xaf, 0xe2, 0x2f, 0x9a, 0xcb, 0xe5, 0x39, 0xcd, 0x84, 0xe1, 0xcb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops0}, .v = {8, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24162}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 62}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5801, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\130\180J\210\214\ENQ\185\DC3T.\233,_\253N\188M\218\t\203\210\&9z\193w\227", _pubPktID = 5801, _pubBody =
// "e/2Y\147]W%\233\NUL\170j25\192", _pubProps = [PropUserProperty "+\173\131\ETX\156\246\222i\129\FS"
// "]\154C\131\170|\248P",PropContentType "\128\CAN\181Y",PropSubscriptionIdentifierAvailable
// 184,PropSharedSubscriptionAvailable 154,PropResponseInformation "!\174\152@#\171\248l\r\161\231\b4",PropTopicAlias
// 24162,PropResponseTopic
// "h\253\215\&3\165\155\178D\181\SO\SYNP\225\RS\175\226/\154\203\229\&9\205\132\225\203",PropMaximumQoS 62]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x3a, 0x81, 0x1,  0x0,  0x1a, 0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5,  0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c,
                   0x5f, 0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9,  0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3, 0x16, 0xa9, 0x53,
                   0x26, 0x0,  0xa,  0x2b, 0xad, 0x83, 0x3,  0x9c, 0xf6, 0xde, 0x69, 0x81, 0x1c, 0x0,  0x8,  0x5d, 0x9a,
                   0x43, 0x83, 0xaa, 0x7c, 0xf8, 0x50, 0x3,  0x0,  0x4,  0x80, 0x18, 0xb5, 0x59, 0x29, 0xb8, 0x2a, 0x9a,
                   0x1a, 0x0,  0xd,  0x21, 0xae, 0x98, 0x40, 0x23, 0xab, 0xf8, 0x6c, 0xd,  0xa1, 0xe7, 0x8,  0x34, 0x23,
                   0x5e, 0x62, 0x8,  0x0,  0x19, 0x68, 0xfd, 0xd7, 0x33, 0xa5, 0x9b, 0xb2, 0x44, 0xb5, 0xe,  0x16, 0x50,
                   0xe1, 0x1e, 0xaf, 0xe2, 0x2f, 0x9a, 0xcb, 0xe5, 0x39, 0xcd, 0x84, 0xe1, 0xcb, 0x24, 0x3e, 0x65, 0x2f,
                   0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0,  0xaa, 0x6a, 0x32, 0x35, 0xc0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x82, 0xb4, 0x4a, 0xd2, 0xd6, 0x5, 0xb9, 0x13, 0x54, 0x2e, 0xe9, 0x2c, 0x5f,
                               0xfd, 0x4e, 0xbc, 0x4d, 0xda, 0x9, 0xcb, 0xd2, 0x39, 0x7a, 0xc1, 0x77, 0xe3};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x65, 0x2f, 0x32, 0x59, 0x93, 0x5d, 0x57, 0x25, 0xe9, 0x0, 0xaa, 0x6a, 0x32, 0x35, 0xc0};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5801);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "$hC\136_\134&\134\182\244\211M\211a\221[", _pubPktID = 25662, _pubBody = "", _pubProps = [PropAuthenticationData
// "\255b\ENQ\STX\nb\133\169\184\SI\143\EM^\SYN\165\207I\209\221\170\174\217",PropSharedSubscriptionAvailable
// 63,PropSessionExpiryInterval 27183,PropWillDelayInterval 524,PropSharedSubscriptionAvailable
// 96,PropRequestProblemInformation 230,PropTopicAliasMaximum 5870,PropReasonString
// "\156T\166",PropMessageExpiryInterval 5899,PropMessageExpiryInterval 9209,PropWillDelayInterval
// 6888,PropReceiveMaximum 2826,PropRequestResponseInformation 52]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x3c, 0x5b, 0x0,  0x10, 0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26, 0x86, 0xb6, 0xf4, 0xd3, 0x4d,
                   0xd3, 0x61, 0xdd, 0x5b, 0x64, 0x3e, 0x46, 0x16, 0x0,  0x16, 0xff, 0x62, 0x5,  0x2,  0xa,  0x62,
                   0x85, 0xa9, 0xb8, 0xf,  0x8f, 0x19, 0x5e, 0x16, 0xa5, 0xcf, 0x49, 0xd1, 0xdd, 0xaa, 0xae, 0xd9,
                   0x2a, 0x3f, 0x11, 0x0,  0x0,  0x6a, 0x2f, 0x18, 0x0,  0x0,  0x2,  0xc,  0x2a, 0x60, 0x17, 0xe6,
                   0x22, 0x16, 0xee, 0x1f, 0x0,  0x3,  0x9c, 0x54, 0xa6, 0x2,  0x0,  0x0,  0x17, 0xb,  0x2,  0x0,
                   0x0,  0x23, 0xf9, 0x18, 0x0,  0x0,  0x1a, 0xe8, 0x21, 0xb,  0xa,  0x19, 0x34};
  uint8_t topic_bytes[] = {0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26, 0x86,
                           0xb6, 0xf4, 0xd3, 0x4d, 0xd3, 0x61, 0xdd, 0x5b};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0xff, 0x62, 0x5,  0x2,  0xa,  0x62, 0x85, 0xa9, 0xb8, 0xf,  0x8f,
                           0x19, 0x5e, 0x16, 0xa5, 0xcf, 0x49, 0xd1, 0xdd, 0xaa, 0xae, 0xd9};
  uint8_t bytesprops1[] = {0x9c, 0x54, 0xa6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27183}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 524}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5870}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5899}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9209}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6888}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2826}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 52}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 25662, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "$hC\136_\134&\134\182\244\211M\211a\221[", _pubPktID = 25662, _pubBody = "", _pubProps = [PropAuthenticationData
// "\255b\ENQ\STX\nb\133\169\184\SI\143\EM^\SYN\165\207I\209\221\170\174\217",PropSharedSubscriptionAvailable
// 63,PropSessionExpiryInterval 27183,PropWillDelayInterval 524,PropSharedSubscriptionAvailable
// 96,PropRequestProblemInformation 230,PropTopicAliasMaximum 5870,PropReasonString
// "\156T\166",PropMessageExpiryInterval 5899,PropMessageExpiryInterval 9209,PropWillDelayInterval
// 6888,PropReceiveMaximum 2826,PropRequestResponseInformation 52]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x3c, 0x5b, 0x0,  0x10, 0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26, 0x86, 0xb6, 0xf4, 0xd3, 0x4d,
                   0xd3, 0x61, 0xdd, 0x5b, 0x64, 0x3e, 0x46, 0x16, 0x0,  0x16, 0xff, 0x62, 0x5,  0x2,  0xa,  0x62,
                   0x85, 0xa9, 0xb8, 0xf,  0x8f, 0x19, 0x5e, 0x16, 0xa5, 0xcf, 0x49, 0xd1, 0xdd, 0xaa, 0xae, 0xd9,
                   0x2a, 0x3f, 0x11, 0x0,  0x0,  0x6a, 0x2f, 0x18, 0x0,  0x0,  0x2,  0xc,  0x2a, 0x60, 0x17, 0xe6,
                   0x22, 0x16, 0xee, 0x1f, 0x0,  0x3,  0x9c, 0x54, 0xa6, 0x2,  0x0,  0x0,  0x17, 0xb,  0x2,  0x0,
                   0x0,  0x23, 0xf9, 0x18, 0x0,  0x0,  0x1a, 0xe8, 0x21, 0xb,  0xa,  0x19, 0x34};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x24, 0x68, 0x43, 0x88, 0x5f, 0x86, 0x26, 0x86,
                               0xb6, 0xf4, 0xd3, 0x4d, 0xd3, 0x61, 0xdd, 0x5b};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 25662);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\181\165\155@\151\196\153>\212\208\158e;\229\178\rW&", _pubPktID = 28678, _pubBody =
// "\197b\187\ACKO^\130\182\SI\241\185\141\n\187P", _pubProps = [PropReceiveMaximum 12673,PropMaximumPacketSize
// 3493,PropMaximumQoS 123,PropMessageExpiryInterval 17483,PropServerReference
// "\DEL\ESCn6\193\n(\153L6MThmB\NAK{\212\186\244\223\"\135\f\130",PropResponseTopic
// ".\ESCC\CANS\210\173i\158i\248|'!",PropMessageExpiryInterval 2389,PropSubscriptionIdentifier 33,PropServerKeepAlive
// 31451,PropServerReference "\177\ETB\255p\144u\190}\SIx\ETX&c]\198\b\214(\220b\134\172`",PropMaximumQoS
// 23,PropResponseInformation "\194\194\GS",PropMessageExpiryInterval 32044,PropAuthenticationData
// "\184f\226",PropResponseTopic "\142\185\246\137\"\204",PropMaximumPacketSize 32478,PropReasonString
// "d\212\208\206?",PropResponseInformation "\SOH\ACK\234z\206G+s\241\\+x\158\214\199\"",PropCorrelationData
// "\150\247\181\210K\208`\229\174\&1!\167,`",PropUserProperty "\223WA" "\232\148",PropTopicAliasMaximum
// 10581,PropAuthenticationMethod "b\164",PropCorrelationData "\154\223!_\216\254S\209\218\"\210",PropCorrelationData
// "?J\163\161\173q\187\225Z\159"]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x32, 0x81, 0x2,  0x0,  0x12, 0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4, 0xd0, 0x9e, 0x65, 0x3b, 0xe5,
      0xb2, 0xd,  0x57, 0x26, 0x70, 0x6,  0xda, 0x1,  0x21, 0x31, 0x81, 0x27, 0x0,  0x0,  0xd,  0xa5, 0x24, 0x7b, 0x2,
      0x0,  0x0,  0x44, 0x4b, 0x1c, 0x0,  0x19, 0x7f, 0x1b, 0x6e, 0x36, 0xc1, 0xa,  0x28, 0x99, 0x4c, 0x36, 0x4d, 0x54,
      0x68, 0x6d, 0x42, 0x15, 0x7b, 0xd4, 0xba, 0xf4, 0xdf, 0x22, 0x87, 0xc,  0x82, 0x8,  0x0,  0xe,  0x2e, 0x1b, 0x43,
      0x18, 0x53, 0xd2, 0xad, 0x69, 0x9e, 0x69, 0xf8, 0x7c, 0x27, 0x21, 0x2,  0x0,  0x0,  0x9,  0x55, 0xb,  0x21, 0x13,
      0x7a, 0xdb, 0x1c, 0x0,  0x17, 0xb1, 0x17, 0xff, 0x70, 0x90, 0x75, 0xbe, 0x7d, 0xf,  0x78, 0x3,  0x26, 0x63, 0x5d,
      0xc6, 0x8,  0xd6, 0x28, 0xdc, 0x62, 0x86, 0xac, 0x60, 0x24, 0x17, 0x1a, 0x0,  0x3,  0xc2, 0xc2, 0x1d, 0x2,  0x0,
      0x0,  0x7d, 0x2c, 0x16, 0x0,  0x3,  0xb8, 0x66, 0xe2, 0x8,  0x0,  0x6,  0x8e, 0xb9, 0xf6, 0x89, 0x22, 0xcc, 0x27,
      0x0,  0x0,  0x7e, 0xde, 0x1f, 0x0,  0x5,  0x64, 0xd4, 0xd0, 0xce, 0x3f, 0x1a, 0x0,  0x10, 0x1,  0x6,  0xea, 0x7a,
      0xce, 0x47, 0x2b, 0x73, 0xf1, 0x5c, 0x2b, 0x78, 0x9e, 0xd6, 0xc7, 0x22, 0x9,  0x0,  0xe,  0x96, 0xf7, 0xb5, 0xd2,
      0x4b, 0xd0, 0x60, 0xe5, 0xae, 0x31, 0x21, 0xa7, 0x2c, 0x60, 0x26, 0x0,  0x3,  0xdf, 0x57, 0x41, 0x0,  0x2,  0xe8,
      0x94, 0x22, 0x29, 0x55, 0x15, 0x0,  0x2,  0x62, 0xa4, 0x9,  0x0,  0xb,  0x9a, 0xdf, 0x21, 0x5f, 0xd8, 0xfe, 0x53,
      0xd1, 0xda, 0x22, 0xd2, 0x9,  0x0,  0xa,  0x3f, 0x4a, 0xa3, 0xa1, 0xad, 0x71, 0xbb, 0xe1, 0x5a, 0x9f, 0xc5, 0x62,
      0xbb, 0x6,  0x4f, 0x5e, 0x82, 0xb6, 0xf,  0xf1, 0xb9, 0x8d, 0xa,  0xbb, 0x50};
  uint8_t topic_bytes[] = {0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4,
                           0xd0, 0x9e, 0x65, 0x3b, 0xe5, 0xb2, 0xd,  0x57, 0x26};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc5, 0x62, 0xbb, 0x6, 0x4f, 0x5e, 0x82, 0xb6, 0xf, 0xf1, 0xb9, 0x8d, 0xa, 0xbb, 0x50};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x7f, 0x1b, 0x6e, 0x36, 0xc1, 0xa,  0x28, 0x99, 0x4c, 0x36, 0x4d, 0x54, 0x68,
                           0x6d, 0x42, 0x15, 0x7b, 0xd4, 0xba, 0xf4, 0xdf, 0x22, 0x87, 0xc,  0x82};
  uint8_t bytesprops1[] = {0x2e, 0x1b, 0x43, 0x18, 0x53, 0xd2, 0xad, 0x69, 0x9e, 0x69, 0xf8, 0x7c, 0x27, 0x21};
  uint8_t bytesprops2[] = {0xb1, 0x17, 0xff, 0x70, 0x90, 0x75, 0xbe, 0x7d, 0xf,  0x78, 0x3, 0x26,
                           0x63, 0x5d, 0xc6, 0x8,  0xd6, 0x28, 0xdc, 0x62, 0x86, 0xac, 0x60};
  uint8_t bytesprops3[] = {0xc2, 0xc2, 0x1d};
  uint8_t bytesprops4[] = {0xb8, 0x66, 0xe2};
  uint8_t bytesprops5[] = {0x8e, 0xb9, 0xf6, 0x89, 0x22, 0xcc};
  uint8_t bytesprops6[] = {0x64, 0xd4, 0xd0, 0xce, 0x3f};
  uint8_t bytesprops7[] = {0x1,  0x6,  0xea, 0x7a, 0xce, 0x47, 0x2b, 0x73,
                           0xf1, 0x5c, 0x2b, 0x78, 0x9e, 0xd6, 0xc7, 0x22};
  uint8_t bytesprops8[] = {0x96, 0xf7, 0xb5, 0xd2, 0x4b, 0xd0, 0x60, 0xe5, 0xae, 0x31, 0x21, 0xa7, 0x2c, 0x60};
  uint8_t bytesprops10[] = {0xe8, 0x94};
  uint8_t bytesprops9[] = {0xdf, 0x57, 0x41};
  uint8_t bytesprops11[] = {0x62, 0xa4};
  uint8_t bytesprops12[] = {0x9a, 0xdf, 0x21, 0x5f, 0xd8, 0xfe, 0x53, 0xd1, 0xda, 0x22, 0xd2};
  uint8_t bytesprops13[] = {0x3f, 0x4a, 0xa3, 0xa1, 0xad, 0x71, 0xbb, 0xe1, 0x5a, 0x9f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12673}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3493}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17483}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2389}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 33}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31451}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32044}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32478}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops9}, .v = {2, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10581}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 28678, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\181\165\155@\151\196\153>\212\208\158e;\229\178\rW&", _pubPktID = 28678, _pubBody =
// "\197b\187\ACKO^\130\182\SI\241\185\141\n\187P", _pubProps = [PropReceiveMaximum 12673,PropMaximumPacketSize
// 3493,PropMaximumQoS 123,PropMessageExpiryInterval 17483,PropServerReference
// "\DEL\ESCn6\193\n(\153L6MThmB\NAK{\212\186\244\223\"\135\f\130",PropResponseTopic
// ".\ESCC\CANS\210\173i\158i\248|'!",PropMessageExpiryInterval 2389,PropSubscriptionIdentifier 33,PropServerKeepAlive
// 31451,PropServerReference "\177\ETB\255p\144u\190}\SIx\ETX&c]\198\b\214(\220b\134\172`",PropMaximumQoS
// 23,PropResponseInformation "\194\194\GS",PropMessageExpiryInterval 32044,PropAuthenticationData
// "\184f\226",PropResponseTopic "\142\185\246\137\"\204",PropMaximumPacketSize 32478,PropReasonString
// "d\212\208\206?",PropResponseInformation "\SOH\ACK\234z\206G+s\241\\+x\158\214\199\"",PropCorrelationData
// "\150\247\181\210K\208`\229\174\&1!\167,`",PropUserProperty "\223WA" "\232\148",PropTopicAliasMaximum
// 10581,PropAuthenticationMethod "b\164",PropCorrelationData "\154\223!_\216\254S\209\218\"\210",PropCorrelationData
// "?J\163\161\173q\187\225Z\159"]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {
      0x32, 0x81, 0x2,  0x0,  0x12, 0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4, 0xd0, 0x9e, 0x65, 0x3b, 0xe5,
      0xb2, 0xd,  0x57, 0x26, 0x70, 0x6,  0xda, 0x1,  0x21, 0x31, 0x81, 0x27, 0x0,  0x0,  0xd,  0xa5, 0x24, 0x7b, 0x2,
      0x0,  0x0,  0x44, 0x4b, 0x1c, 0x0,  0x19, 0x7f, 0x1b, 0x6e, 0x36, 0xc1, 0xa,  0x28, 0x99, 0x4c, 0x36, 0x4d, 0x54,
      0x68, 0x6d, 0x42, 0x15, 0x7b, 0xd4, 0xba, 0xf4, 0xdf, 0x22, 0x87, 0xc,  0x82, 0x8,  0x0,  0xe,  0x2e, 0x1b, 0x43,
      0x18, 0x53, 0xd2, 0xad, 0x69, 0x9e, 0x69, 0xf8, 0x7c, 0x27, 0x21, 0x2,  0x0,  0x0,  0x9,  0x55, 0xb,  0x21, 0x13,
      0x7a, 0xdb, 0x1c, 0x0,  0x17, 0xb1, 0x17, 0xff, 0x70, 0x90, 0x75, 0xbe, 0x7d, 0xf,  0x78, 0x3,  0x26, 0x63, 0x5d,
      0xc6, 0x8,  0xd6, 0x28, 0xdc, 0x62, 0x86, 0xac, 0x60, 0x24, 0x17, 0x1a, 0x0,  0x3,  0xc2, 0xc2, 0x1d, 0x2,  0x0,
      0x0,  0x7d, 0x2c, 0x16, 0x0,  0x3,  0xb8, 0x66, 0xe2, 0x8,  0x0,  0x6,  0x8e, 0xb9, 0xf6, 0x89, 0x22, 0xcc, 0x27,
      0x0,  0x0,  0x7e, 0xde, 0x1f, 0x0,  0x5,  0x64, 0xd4, 0xd0, 0xce, 0x3f, 0x1a, 0x0,  0x10, 0x1,  0x6,  0xea, 0x7a,
      0xce, 0x47, 0x2b, 0x73, 0xf1, 0x5c, 0x2b, 0x78, 0x9e, 0xd6, 0xc7, 0x22, 0x9,  0x0,  0xe,  0x96, 0xf7, 0xb5, 0xd2,
      0x4b, 0xd0, 0x60, 0xe5, 0xae, 0x31, 0x21, 0xa7, 0x2c, 0x60, 0x26, 0x0,  0x3,  0xdf, 0x57, 0x41, 0x0,  0x2,  0xe8,
      0x94, 0x22, 0x29, 0x55, 0x15, 0x0,  0x2,  0x62, 0xa4, 0x9,  0x0,  0xb,  0x9a, 0xdf, 0x21, 0x5f, 0xd8, 0xfe, 0x53,
      0xd1, 0xda, 0x22, 0xd2, 0x9,  0x0,  0xa,  0x3f, 0x4a, 0xa3, 0xa1, 0xad, 0x71, 0xbb, 0xe1, 0x5a, 0x9f, 0xc5, 0x62,
      0xbb, 0x6,  0x4f, 0x5e, 0x82, 0xb6, 0xf,  0xf1, 0xb9, 0x8d, 0xa,  0xbb, 0x50};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb5, 0xa5, 0x9b, 0x40, 0x97, 0xc4, 0x99, 0x3e, 0xd4,
                               0xd0, 0x9e, 0x65, 0x3b, 0xe5, 0xb2, 0xd,  0x57, 0x26};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc5, 0x62, 0xbb, 0x6, 0x4f, 0x5e, 0x82, 0xb6, 0xf, 0xf1, 0xb9, 0x8d, 0xa, 0xbb, 0x50};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 28678);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\196x\255\172\&4\CAN?V{\217\182\160\&3\169g\176\192\r\NAK\186s", _pubPktID = 0, _pubBody = "s", _pubProps =
// [PropMessageExpiryInterval 10907,PropAuthenticationMethod
// "\237\198\DC2\v\139Z98\248\172\ESC\176\STX\234\"\180]e\166\159\167Z",PropContentType
// ")\140\227\169\231!v",PropTopicAlias 19767,PropSubscriptionIdentifierAvailable 57,PropServerReference
// "\223\221\190\SUB\156\214\246\t_\190G\216\166\246FM_&\DC2Tf\SYNR\155M\DC3\222Wr",PropMessageExpiryInterval
// 27077,PropSessionExpiryInterval 6103,PropResponseInformation
// "\253\216\170*k\ACK\145\GS\232\187\ESC\136\&2\236\DEL",PropResponseTopic "[",PropResponseTopic
// "\140\176\137\SUBv!lk(\US\178\129\&2\188\149H[\209\219\DC1)"]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {0x39, 0x9f, 0x1,  0x0,  0x15, 0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b, 0xd9, 0xb6, 0xa0,
                   0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73, 0x85, 0x1,  0x2,  0x0,  0x0,  0x2a, 0x9b, 0x15,
                   0x0,  0x16, 0xed, 0xc6, 0x12, 0xb,  0x8b, 0x5a, 0x39, 0x38, 0xf8, 0xac, 0x1b, 0xb0, 0x2,  0xea, 0x22,
                   0xb4, 0x5d, 0x65, 0xa6, 0x9f, 0xa7, 0x5a, 0x3,  0x0,  0x7,  0x29, 0x8c, 0xe3, 0xa9, 0xe7, 0x21, 0x76,
                   0x23, 0x4d, 0x37, 0x29, 0x39, 0x1c, 0x0,  0x1d, 0xdf, 0xdd, 0xbe, 0x1a, 0x9c, 0xd6, 0xf6, 0x9,  0x5f,
                   0xbe, 0x47, 0xd8, 0xa6, 0xf6, 0x46, 0x4d, 0x5f, 0x26, 0x12, 0x54, 0x66, 0x16, 0x52, 0x9b, 0x4d, 0x13,
                   0xde, 0x57, 0x72, 0x2,  0x0,  0x0,  0x69, 0xc5, 0x11, 0x0,  0x0,  0x17, 0xd7, 0x1a, 0x0,  0xf,  0xfd,
                   0xd8, 0xaa, 0x2a, 0x6b, 0x6,  0x91, 0x1d, 0xe8, 0xbb, 0x1b, 0x88, 0x32, 0xec, 0x7f, 0x8,  0x0,  0x1,
                   0x5b, 0x8,  0x0,  0x15, 0x8c, 0xb0, 0x89, 0x1a, 0x76, 0x21, 0x6c, 0x6b, 0x28, 0x1f, 0xb2, 0x81, 0x32,
                   0xbc, 0x95, 0x48, 0x5b, 0xd1, 0xdb, 0x11, 0x29, 0x73};
  uint8_t topic_bytes[] = {0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b, 0xd9, 0xb6,
                           0xa0, 0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x73};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0xed, 0xc6, 0x12, 0xb,  0x8b, 0x5a, 0x39, 0x38, 0xf8, 0xac, 0x1b,
                           0xb0, 0x2,  0xea, 0x22, 0xb4, 0x5d, 0x65, 0xa6, 0x9f, 0xa7, 0x5a};
  uint8_t bytesprops1[] = {0x29, 0x8c, 0xe3, 0xa9, 0xe7, 0x21, 0x76};
  uint8_t bytesprops2[] = {0xdf, 0xdd, 0xbe, 0x1a, 0x9c, 0xd6, 0xf6, 0x9,  0x5f, 0xbe, 0x47, 0xd8, 0xa6, 0xf6, 0x46,
                           0x4d, 0x5f, 0x26, 0x12, 0x54, 0x66, 0x16, 0x52, 0x9b, 0x4d, 0x13, 0xde, 0x57, 0x72};
  uint8_t bytesprops3[] = {0xfd, 0xd8, 0xaa, 0x2a, 0x6b, 0x6, 0x91, 0x1d, 0xe8, 0xbb, 0x1b, 0x88, 0x32, 0xec, 0x7f};
  uint8_t bytesprops4[] = {0x5b};
  uint8_t bytesprops5[] = {0x8c, 0xb0, 0x89, 0x1a, 0x76, 0x21, 0x6c, 0x6b, 0x28, 0x1f, 0xb2,
                           0x81, 0x32, 0xbc, 0x95, 0x48, 0x5b, 0xd1, 0xdb, 0x11, 0x29};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10907}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19767}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27077}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6103}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\196x\255\172\&4\CAN?V{\217\182\160\&3\169g\176\192\r\NAK\186s", _pubPktID = 0, _pubBody = "s", _pubProps =
// [PropMessageExpiryInterval 10907,PropAuthenticationMethod
// "\237\198\DC2\v\139Z98\248\172\ESC\176\STX\234\"\180]e\166\159\167Z",PropContentType
// ")\140\227\169\231!v",PropTopicAlias 19767,PropSubscriptionIdentifierAvailable 57,PropServerReference
// "\223\221\190\SUB\156\214\246\t_\190G\216\166\246FM_&\DC2Tf\SYNR\155M\DC3\222Wr",PropMessageExpiryInterval
// 27077,PropSessionExpiryInterval 6103,PropResponseInformation
// "\253\216\170*k\ACK\145\GS\232\187\ESC\136\&2\236\DEL",PropResponseTopic "[",PropResponseTopic
// "\140\176\137\SUBv!lk(\US\178\129\&2\188\149H[\209\219\DC1)"]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {0x39, 0x9f, 0x1,  0x0,  0x15, 0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b, 0xd9, 0xb6, 0xa0,
                   0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73, 0x85, 0x1,  0x2,  0x0,  0x0,  0x2a, 0x9b, 0x15,
                   0x0,  0x16, 0xed, 0xc6, 0x12, 0xb,  0x8b, 0x5a, 0x39, 0x38, 0xf8, 0xac, 0x1b, 0xb0, 0x2,  0xea, 0x22,
                   0xb4, 0x5d, 0x65, 0xa6, 0x9f, 0xa7, 0x5a, 0x3,  0x0,  0x7,  0x29, 0x8c, 0xe3, 0xa9, 0xe7, 0x21, 0x76,
                   0x23, 0x4d, 0x37, 0x29, 0x39, 0x1c, 0x0,  0x1d, 0xdf, 0xdd, 0xbe, 0x1a, 0x9c, 0xd6, 0xf6, 0x9,  0x5f,
                   0xbe, 0x47, 0xd8, 0xa6, 0xf6, 0x46, 0x4d, 0x5f, 0x26, 0x12, 0x54, 0x66, 0x16, 0x52, 0x9b, 0x4d, 0x13,
                   0xde, 0x57, 0x72, 0x2,  0x0,  0x0,  0x69, 0xc5, 0x11, 0x0,  0x0,  0x17, 0xd7, 0x1a, 0x0,  0xf,  0xfd,
                   0xd8, 0xaa, 0x2a, 0x6b, 0x6,  0x91, 0x1d, 0xe8, 0xbb, 0x1b, 0x88, 0x32, 0xec, 0x7f, 0x8,  0x0,  0x1,
                   0x5b, 0x8,  0x0,  0x15, 0x8c, 0xb0, 0x89, 0x1a, 0x76, 0x21, 0x6c, 0x6b, 0x28, 0x1f, 0xb2, 0x81, 0x32,
                   0xbc, 0x95, 0x48, 0x5b, 0xd1, 0xdb, 0x11, 0x29, 0x73};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc4, 0x78, 0xff, 0xac, 0x34, 0x18, 0x3f, 0x56, 0x7b, 0xd9, 0xb6,
                               0xa0, 0x33, 0xa9, 0x67, 0xb0, 0xc0, 0xd,  0x15, 0xba, 0x73};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x73};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\136@e", _pubPktID = 1120, _pubBody
// = "U\146=\184\GS9[\230\210\180\157\ENQ\204\240\DC36\FSl0\136\172^\RSr4t7\193\178", _pubProps = [PropContentType
// "'\184m\204oOr",PropReceiveMaximum 29088,PropRequestProblemInformation 86,PropWildcardSubscriptionAvailable
// 125,PropCorrelationData "oW\220W\SUB%F\225\DC3\233\161\&6K\216`\216\FS\252\ENQ\253\216",PropCorrelationData
// ",?\185\148\172",PropReceiveMaximum 32523,PropResponseInformation
// "\233\152M\171Xg\DEL\141",PropPayloadFormatIndicator 86,PropResponseInformation
// "\183\156\197V\223w\US\228\190r@\FS$\189G\167.0^w\213\t\GSoX%",PropRetainAvailable 77,PropPayloadFormatIndicator
// 118,PropSubscriptionIdentifierAvailable 247,PropSubscriptionIdentifier 16]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {0x35, 0x8b, 0x1,  0x0,  0x3,  0x88, 0x40, 0x65, 0x4,  0x60, 0x66, 0x3,  0x0,  0x7,  0x27, 0xb8,
                   0x6d, 0xcc, 0x6f, 0x4f, 0x72, 0x21, 0x71, 0xa0, 0x17, 0x56, 0x28, 0x7d, 0x9,  0x0,  0x15, 0x6f,
                   0x57, 0xdc, 0x57, 0x1a, 0x25, 0x46, 0xe1, 0x13, 0xe9, 0xa1, 0x36, 0x4b, 0xd8, 0x60, 0xd8, 0x1c,
                   0xfc, 0x5,  0xfd, 0xd8, 0x9,  0x0,  0x5,  0x2c, 0x3f, 0xb9, 0x94, 0xac, 0x21, 0x7f, 0xb,  0x1a,
                   0x0,  0x8,  0xe9, 0x98, 0x4d, 0xab, 0x58, 0x67, 0x7f, 0x8d, 0x1,  0x56, 0x1a, 0x0,  0x1a, 0xb7,
                   0x9c, 0xc5, 0x56, 0xdf, 0x77, 0x1f, 0xe4, 0xbe, 0x72, 0x40, 0x1c, 0x24, 0xbd, 0x47, 0xa7, 0x2e,
                   0x30, 0x5e, 0x77, 0xd5, 0x9,  0x1d, 0x6f, 0x58, 0x25, 0x25, 0x4d, 0x1,  0x76, 0x29, 0xf7, 0xb,
                   0x10, 0x55, 0x92, 0x3d, 0xb8, 0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13,
                   0x36, 0x1c, 0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  uint8_t topic_bytes[] = {0x88, 0x40, 0x65};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x55, 0x92, 0x3d, 0xb8, 0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13,
                         0x36, 0x1c, 0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0x27, 0xb8, 0x6d, 0xcc, 0x6f, 0x4f, 0x72};
  uint8_t bytesprops1[] = {0x6f, 0x57, 0xdc, 0x57, 0x1a, 0x25, 0x46, 0xe1, 0x13, 0xe9, 0xa1,
                           0x36, 0x4b, 0xd8, 0x60, 0xd8, 0x1c, 0xfc, 0x5,  0xfd, 0xd8};
  uint8_t bytesprops2[] = {0x2c, 0x3f, 0xb9, 0x94, 0xac};
  uint8_t bytesprops3[] = {0xe9, 0x98, 0x4d, 0xab, 0x58, 0x67, 0x7f, 0x8d};
  uint8_t bytesprops4[] = {0xb7, 0x9c, 0xc5, 0x56, 0xdf, 0x77, 0x1f, 0xe4, 0xbe, 0x72, 0x40, 0x1c, 0x24,
                           0xbd, 0x47, 0xa7, 0x2e, 0x30, 0x5e, 0x77, 0xd5, 0x9,  0x1d, 0x6f, 0x58, 0x25};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29088}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32523}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 1120, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\136@e", _pubPktID = 1120, _pubBody
// = "U\146=\184\GS9[\230\210\180\157\ENQ\204\240\DC36\FSl0\136\172^\RSr4t7\193\178", _pubProps = [PropContentType
// "'\184m\204oOr",PropReceiveMaximum 29088,PropRequestProblemInformation 86,PropWildcardSubscriptionAvailable
// 125,PropCorrelationData "oW\220W\SUB%F\225\DC3\233\161\&6K\216`\216\FS\252\ENQ\253\216",PropCorrelationData
// ",?\185\148\172",PropReceiveMaximum 32523,PropResponseInformation
// "\233\152M\171Xg\DEL\141",PropPayloadFormatIndicator 86,PropResponseInformation
// "\183\156\197V\223w\US\228\190r@\FS$\189G\167.0^w\213\t\GSoX%",PropRetainAvailable 77,PropPayloadFormatIndicator
// 118,PropSubscriptionIdentifierAvailable 247,PropSubscriptionIdentifier 16]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {0x35, 0x8b, 0x1,  0x0,  0x3,  0x88, 0x40, 0x65, 0x4,  0x60, 0x66, 0x3,  0x0,  0x7,  0x27, 0xb8,
                   0x6d, 0xcc, 0x6f, 0x4f, 0x72, 0x21, 0x71, 0xa0, 0x17, 0x56, 0x28, 0x7d, 0x9,  0x0,  0x15, 0x6f,
                   0x57, 0xdc, 0x57, 0x1a, 0x25, 0x46, 0xe1, 0x13, 0xe9, 0xa1, 0x36, 0x4b, 0xd8, 0x60, 0xd8, 0x1c,
                   0xfc, 0x5,  0xfd, 0xd8, 0x9,  0x0,  0x5,  0x2c, 0x3f, 0xb9, 0x94, 0xac, 0x21, 0x7f, 0xb,  0x1a,
                   0x0,  0x8,  0xe9, 0x98, 0x4d, 0xab, 0x58, 0x67, 0x7f, 0x8d, 0x1,  0x56, 0x1a, 0x0,  0x1a, 0xb7,
                   0x9c, 0xc5, 0x56, 0xdf, 0x77, 0x1f, 0xe4, 0xbe, 0x72, 0x40, 0x1c, 0x24, 0xbd, 0x47, 0xa7, 0x2e,
                   0x30, 0x5e, 0x77, 0xd5, 0x9,  0x1d, 0x6f, 0x58, 0x25, 0x25, 0x4d, 0x1,  0x76, 0x29, 0xf7, 0xb,
                   0x10, 0x55, 0x92, 0x3d, 0xb8, 0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13,
                   0x36, 0x1c, 0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x88, 0x40, 0x65};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x55, 0x92, 0x3d, 0xb8, 0x1d, 0x39, 0x5b, 0xe6, 0xd2, 0xb4, 0x9d, 0x5,  0xcc, 0xf0, 0x13,
                              0x36, 0x1c, 0x6c, 0x30, 0x88, 0xac, 0x5e, 0x1e, 0x72, 0x34, 0x74, 0x37, 0xc1, 0xb2};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1120);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\129\b\202\ETB\"y\195\204\150S\DLE\231\CANg\207\&0\n\246~U\196\194\&5", _pubPktID = 17194, _pubBody =
// "\158\237", _pubProps = [PropPayloadFormatIndicator 191,PropRequestProblemInformation
// 232,PropSubscriptionIdentifierAvailable 54,PropTopicAliasMaximum 1708,PropWildcardSubscriptionAvailable
// 116,PropAuthenticationData "o'\133\177\235t@\149A+\233\140\SOH",PropMessageExpiryInterval 5729,PropTopicAliasMaximum
// 16831,PropAuthenticationData
// "\200\SO\250\&6\144\192yG\211\STX\139\253\175\DC2\157\139\SUB\RS6\178\249\n'\186\206O\STX\b",PropRetainAvailable
// 38,PropTopicAlias 27395,PropMaximumQoS 187,PropPayloadFormatIndicator 196,PropMessageExpiryInterval
// 6396,PropServerKeepAlive 21502,PropRequestProblemInformation 199,PropWildcardSubscriptionAvailable
// 159,PropReceiveMaximum 21944,PropWillDelayInterval 24951,PropMaximumQoS 95,PropMessageExpiryInterval
// 9751,PropMaximumPacketSize 10710,PropRetainAvailable 207,PropSubscriptionIdentifierAvailable
// 106,PropSharedSubscriptionAvailable 187,PropServerReference "\139\211\238\132",PropCorrelationData
// "\SYN;\218\247|\212\231\156\bV\199z#5\223;\170H\189\220\174\224\GS8\250\206z\240",PropRetainAvailable
// 191,PropAuthenticationData
// "Z\SI\b&\163\ACKr0\208\150\188\EMV\FS\138\185r\227\229j",PropSubscriptionIdentifierAvailable 136]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {0x33, 0xd2, 0x1,  0x0,  0x18, 0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                   0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35, 0x43, 0x2a, 0xb2, 0x1,  0x1,
                   0xbf, 0x17, 0xe8, 0x29, 0x36, 0x22, 0x6,  0xac, 0x28, 0x74, 0x16, 0x0,  0xd,  0x6f, 0x27, 0x85, 0xb1,
                   0xeb, 0x74, 0x40, 0x95, 0x41, 0x2b, 0xe9, 0x8c, 0x1,  0x2,  0x0,  0x0,  0x16, 0x61, 0x22, 0x41, 0xbf,
                   0x16, 0x0,  0x1c, 0xc8, 0xe,  0xfa, 0x36, 0x90, 0xc0, 0x79, 0x47, 0xd3, 0x2,  0x8b, 0xfd, 0xaf, 0x12,
                   0x9d, 0x8b, 0x1a, 0x1e, 0x36, 0xb2, 0xf9, 0xa,  0x27, 0xba, 0xce, 0x4f, 0x2,  0x8,  0x25, 0x26, 0x23,
                   0x6b, 0x3,  0x24, 0xbb, 0x1,  0xc4, 0x2,  0x0,  0x0,  0x18, 0xfc, 0x13, 0x53, 0xfe, 0x17, 0xc7, 0x28,
                   0x9f, 0x21, 0x55, 0xb8, 0x18, 0x0,  0x0,  0x61, 0x77, 0x24, 0x5f, 0x2,  0x0,  0x0,  0x26, 0x17, 0x27,
                   0x0,  0x0,  0x29, 0xd6, 0x25, 0xcf, 0x29, 0x6a, 0x2a, 0xbb, 0x1c, 0x0,  0x4,  0x8b, 0xd3, 0xee, 0x84,
                   0x9,  0x0,  0x1c, 0x16, 0x3b, 0xda, 0xf7, 0x7c, 0xd4, 0xe7, 0x9c, 0x8,  0x56, 0xc7, 0x7a, 0x23, 0x35,
                   0xdf, 0x3b, 0xaa, 0x48, 0xbd, 0xdc, 0xae, 0xe0, 0x1d, 0x38, 0xfa, 0xce, 0x7a, 0xf0, 0x25, 0xbf, 0x16,
                   0x0,  0x14, 0x5a, 0xf,  0x8,  0x26, 0xa3, 0x6,  0x72, 0x30, 0xd0, 0x96, 0xbc, 0x19, 0x56, 0x1c, 0x8a,
                   0xb9, 0x72, 0xe3, 0xe5, 0x6a, 0x29, 0x88, 0x9e, 0xed};
  uint8_t topic_bytes[] = {0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                           0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9e, 0xed};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0x6f, 0x27, 0x85, 0xb1, 0xeb, 0x74, 0x40, 0x95, 0x41, 0x2b, 0xe9, 0x8c, 0x1};
  uint8_t bytesprops1[] = {0xc8, 0xe,  0xfa, 0x36, 0x90, 0xc0, 0x79, 0x47, 0xd3, 0x2,  0x8b, 0xfd, 0xaf, 0x12,
                           0x9d, 0x8b, 0x1a, 0x1e, 0x36, 0xb2, 0xf9, 0xa,  0x27, 0xba, 0xce, 0x4f, 0x2,  0x8};
  uint8_t bytesprops2[] = {0x8b, 0xd3, 0xee, 0x84};
  uint8_t bytesprops3[] = {0x16, 0x3b, 0xda, 0xf7, 0x7c, 0xd4, 0xe7, 0x9c, 0x8,  0x56, 0xc7, 0x7a, 0x23, 0x35,
                           0xdf, 0x3b, 0xaa, 0x48, 0xbd, 0xdc, 0xae, 0xe0, 0x1d, 0x38, 0xfa, 0xce, 0x7a, 0xf0};
  uint8_t bytesprops4[] = {0x5a, 0xf,  0x8,  0x26, 0xa3, 0x6,  0x72, 0x30, 0xd0, 0x96,
                           0xbc, 0x19, 0x56, 0x1c, 0x8a, 0xb9, 0x72, 0xe3, 0xe5, 0x6a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1708}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5729}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16831}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27395}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6396}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21502}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21944}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24951}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9751}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10710}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 17194, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\129\b\202\ETB\"y\195\204\150S\DLE\231\CANg\207\&0\n\246~U\196\194\&5", _pubPktID = 17194, _pubBody =
// "\158\237", _pubProps = [PropPayloadFormatIndicator 191,PropRequestProblemInformation
// 232,PropSubscriptionIdentifierAvailable 54,PropTopicAliasMaximum 1708,PropWildcardSubscriptionAvailable
// 116,PropAuthenticationData "o'\133\177\235t@\149A+\233\140\SOH",PropMessageExpiryInterval 5729,PropTopicAliasMaximum
// 16831,PropAuthenticationData
// "\200\SO\250\&6\144\192yG\211\STX\139\253\175\DC2\157\139\SUB\RS6\178\249\n'\186\206O\STX\b",PropRetainAvailable
// 38,PropTopicAlias 27395,PropMaximumQoS 187,PropPayloadFormatIndicator 196,PropMessageExpiryInterval
// 6396,PropServerKeepAlive 21502,PropRequestProblemInformation 199,PropWildcardSubscriptionAvailable
// 159,PropReceiveMaximum 21944,PropWillDelayInterval 24951,PropMaximumQoS 95,PropMessageExpiryInterval
// 9751,PropMaximumPacketSize 10710,PropRetainAvailable 207,PropSubscriptionIdentifierAvailable
// 106,PropSharedSubscriptionAvailable 187,PropServerReference "\139\211\238\132",PropCorrelationData
// "\SYN;\218\247|\212\231\156\bV\199z#5\223;\170H\189\220\174\224\GS8\250\206z\240",PropRetainAvailable
// 191,PropAuthenticationData
// "Z\SI\b&\163\ACKr0\208\150\188\EMV\FS\138\185r\227\229j",PropSubscriptionIdentifierAvailable 136]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {0x33, 0xd2, 0x1,  0x0,  0x18, 0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                   0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35, 0x43, 0x2a, 0xb2, 0x1,  0x1,
                   0xbf, 0x17, 0xe8, 0x29, 0x36, 0x22, 0x6,  0xac, 0x28, 0x74, 0x16, 0x0,  0xd,  0x6f, 0x27, 0x85, 0xb1,
                   0xeb, 0x74, 0x40, 0x95, 0x41, 0x2b, 0xe9, 0x8c, 0x1,  0x2,  0x0,  0x0,  0x16, 0x61, 0x22, 0x41, 0xbf,
                   0x16, 0x0,  0x1c, 0xc8, 0xe,  0xfa, 0x36, 0x90, 0xc0, 0x79, 0x47, 0xd3, 0x2,  0x8b, 0xfd, 0xaf, 0x12,
                   0x9d, 0x8b, 0x1a, 0x1e, 0x36, 0xb2, 0xf9, 0xa,  0x27, 0xba, 0xce, 0x4f, 0x2,  0x8,  0x25, 0x26, 0x23,
                   0x6b, 0x3,  0x24, 0xbb, 0x1,  0xc4, 0x2,  0x0,  0x0,  0x18, 0xfc, 0x13, 0x53, 0xfe, 0x17, 0xc7, 0x28,
                   0x9f, 0x21, 0x55, 0xb8, 0x18, 0x0,  0x0,  0x61, 0x77, 0x24, 0x5f, 0x2,  0x0,  0x0,  0x26, 0x17, 0x27,
                   0x0,  0x0,  0x29, 0xd6, 0x25, 0xcf, 0x29, 0x6a, 0x2a, 0xbb, 0x1c, 0x0,  0x4,  0x8b, 0xd3, 0xee, 0x84,
                   0x9,  0x0,  0x1c, 0x16, 0x3b, 0xda, 0xf7, 0x7c, 0xd4, 0xe7, 0x9c, 0x8,  0x56, 0xc7, 0x7a, 0x23, 0x35,
                   0xdf, 0x3b, 0xaa, 0x48, 0xbd, 0xdc, 0xae, 0xe0, 0x1d, 0x38, 0xfa, 0xce, 0x7a, 0xf0, 0x25, 0xbf, 0x16,
                   0x0,  0x14, 0x5a, 0xf,  0x8,  0x26, 0xa3, 0x6,  0x72, 0x30, 0xd0, 0x96, 0xbc, 0x19, 0x56, 0x1c, 0x8a,
                   0xb9, 0x72, 0xe3, 0xe5, 0x6a, 0x29, 0x88, 0x9e, 0xed};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0x81, 0x8,  0xca, 0x17, 0x22, 0x79, 0xc3, 0xcc, 0x96, 0x53, 0x10,
                               0xe7, 0x18, 0x67, 0xcf, 0x30, 0xa,  0xf6, 0x7e, 0x55, 0xc4, 0xc2, 0x35};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9e, 0xed};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17194);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ")\223\215<\151R\ENQ\DC3I\131&\207\&4\179\156\CAN\SO", _pubPktID = 18606, _pubBody = "\208Zo\214\246#v", _pubProps =
// [PropSubscriptionIdentifier 9,PropAuthenticationData
// "\242\231\FSo\223\180\b\241)\214pM\NAK\nH\138+h;&t8\STX\216\178q\251\137+",PropWildcardSubscriptionAvailable
// 246,PropSubscriptionIdentifier 4,PropTopicAliasMaximum 11929,PropSessionExpiryInterval 12227,PropTopicAliasMaximum
// 21923,PropWildcardSubscriptionAvailable 49,PropAssignedClientIdentifier "_\136\166
// \GS\EM\ETX\220\ACK]\ENQ\196\&63\ACK\SI\197k\228a4,",PropMessageExpiryInterval 31165,PropAuthenticationMethod
// "\SYN\f\173\244Y\247z\160i9i\128C\178\201\143oM\ENQ\138\176@\192",PropCorrelationData
// "\197\"\194\214\241a\209\199U\138D\200\CAN\"7W\EOT$_#",PropResponseTopic "\237\202^\244",PropAssignedClientIdentifier
// "\239\147~\US3\222UK\186y\SOHG\226\163\DLE\152\242",PropReceiveMaximum 9627,PropReceiveMaximum
// 7912,PropAssignedClientIdentifier
// "\237\191\228d\245fu\215\255\222\171\170\229\DC2\184q>#\239\ab\252\188\211\r\247\147\ENQ",PropMaximumQoS
// 55,PropWillDelayInterval 17769,PropTopicAliasMaximum 28809,PropPayloadFormatIndicator 162]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x35, 0xec, 0x1,  0x0,  0x11, 0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49, 0x83, 0x26, 0xcf, 0x34, 0xb3,
      0x9c, 0x18, 0xe,  0x48, 0xae, 0xce, 0x1,  0xb,  0x9,  0x16, 0x0,  0x1d, 0xf2, 0xe7, 0x1c, 0x6f, 0xdf, 0xb4, 0x8,
      0xf1, 0x29, 0xd6, 0x70, 0x4d, 0x15, 0xa,  0x48, 0x8a, 0x2b, 0x68, 0x3b, 0x26, 0x74, 0x38, 0x2,  0xd8, 0xb2, 0x71,
      0xfb, 0x89, 0x2b, 0x28, 0xf6, 0xb,  0x4,  0x22, 0x2e, 0x99, 0x11, 0x0,  0x0,  0x2f, 0xc3, 0x22, 0x55, 0xa3, 0x28,
      0x31, 0x12, 0x0,  0x16, 0x5f, 0x88, 0xa6, 0x20, 0x1d, 0x19, 0x3,  0xdc, 0x6,  0x5d, 0x5,  0xc4, 0x36, 0x33, 0x6,
      0xf,  0xc5, 0x6b, 0xe4, 0x61, 0x34, 0x2c, 0x2,  0x0,  0x0,  0x79, 0xbd, 0x15, 0x0,  0x17, 0x16, 0xc,  0xad, 0xf4,
      0x59, 0xf7, 0x7a, 0xa0, 0x69, 0x39, 0x69, 0x80, 0x43, 0xb2, 0xc9, 0x8f, 0x6f, 0x4d, 0x5,  0x8a, 0xb0, 0x40, 0xc0,
      0x9,  0x0,  0x14, 0xc5, 0x22, 0xc2, 0xd6, 0xf1, 0x61, 0xd1, 0xc7, 0x55, 0x8a, 0x44, 0xc8, 0x18, 0x22, 0x37, 0x57,
      0x4,  0x24, 0x5f, 0x23, 0x8,  0x0,  0x4,  0xed, 0xca, 0x5e, 0xf4, 0x12, 0x0,  0x11, 0xef, 0x93, 0x7e, 0x1f, 0x33,
      0xde, 0x55, 0x4b, 0xba, 0x79, 0x1,  0x47, 0xe2, 0xa3, 0x10, 0x98, 0xf2, 0x21, 0x25, 0x9b, 0x21, 0x1e, 0xe8, 0x12,
      0x0,  0x1c, 0xed, 0xbf, 0xe4, 0x64, 0xf5, 0x66, 0x75, 0xd7, 0xff, 0xde, 0xab, 0xaa, 0xe5, 0x12, 0xb8, 0x71, 0x3e,
      0x23, 0xef, 0x7,  0x62, 0xfc, 0xbc, 0xd3, 0xd,  0xf7, 0x93, 0x5,  0x24, 0x37, 0x18, 0x0,  0x0,  0x45, 0x69, 0x22,
      0x70, 0x89, 0x1,  0xa2, 0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  uint8_t topic_bytes[] = {0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49,
                           0x83, 0x26, 0xcf, 0x34, 0xb3, 0x9c, 0x18, 0xe};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0xf2, 0xe7, 0x1c, 0x6f, 0xdf, 0xb4, 0x8,  0xf1, 0x29, 0xd6, 0x70, 0x4d, 0x15, 0xa, 0x48,
                           0x8a, 0x2b, 0x68, 0x3b, 0x26, 0x74, 0x38, 0x2,  0xd8, 0xb2, 0x71, 0xfb, 0x89, 0x2b};
  uint8_t bytesprops1[] = {0x5f, 0x88, 0xa6, 0x20, 0x1d, 0x19, 0x3,  0xdc, 0x6,  0x5d, 0x5,
                           0xc4, 0x36, 0x33, 0x6,  0xf,  0xc5, 0x6b, 0xe4, 0x61, 0x34, 0x2c};
  uint8_t bytesprops2[] = {0x16, 0xc,  0xad, 0xf4, 0x59, 0xf7, 0x7a, 0xa0, 0x69, 0x39, 0x69, 0x80,
                           0x43, 0xb2, 0xc9, 0x8f, 0x6f, 0x4d, 0x5,  0x8a, 0xb0, 0x40, 0xc0};
  uint8_t bytesprops3[] = {0xc5, 0x22, 0xc2, 0xd6, 0xf1, 0x61, 0xd1, 0xc7, 0x55, 0x8a,
                           0x44, 0xc8, 0x18, 0x22, 0x37, 0x57, 0x4,  0x24, 0x5f, 0x23};
  uint8_t bytesprops4[] = {0xed, 0xca, 0x5e, 0xf4};
  uint8_t bytesprops5[] = {0xef, 0x93, 0x7e, 0x1f, 0x33, 0xde, 0x55, 0x4b, 0xba,
                           0x79, 0x1,  0x47, 0xe2, 0xa3, 0x10, 0x98, 0xf2};
  uint8_t bytesprops6[] = {0xed, 0xbf, 0xe4, 0x64, 0xf5, 0x66, 0x75, 0xd7, 0xff, 0xde, 0xab, 0xaa, 0xe5, 0x12,
                           0xb8, 0x71, 0x3e, 0x23, 0xef, 0x7,  0x62, 0xfc, 0xbc, 0xd3, 0xd,  0xf7, 0x93, 0x5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11929}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12227}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21923}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31165}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9627}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7912}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17769}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28809}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 162}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 18606, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ")\223\215<\151R\ENQ\DC3I\131&\207\&4\179\156\CAN\SO", _pubPktID = 18606, _pubBody = "\208Zo\214\246#v", _pubProps =
// [PropSubscriptionIdentifier 9,PropAuthenticationData
// "\242\231\FSo\223\180\b\241)\214pM\NAK\nH\138+h;&t8\STX\216\178q\251\137+",PropWildcardSubscriptionAvailable
// 246,PropSubscriptionIdentifier 4,PropTopicAliasMaximum 11929,PropSessionExpiryInterval 12227,PropTopicAliasMaximum
// 21923,PropWildcardSubscriptionAvailable 49,PropAssignedClientIdentifier "_\136\166
// \GS\EM\ETX\220\ACK]\ENQ\196\&63\ACK\SI\197k\228a4,",PropMessageExpiryInterval 31165,PropAuthenticationMethod
// "\SYN\f\173\244Y\247z\160i9i\128C\178\201\143oM\ENQ\138\176@\192",PropCorrelationData
// "\197\"\194\214\241a\209\199U\138D\200\CAN\"7W\EOT$_#",PropResponseTopic "\237\202^\244",PropAssignedClientIdentifier
// "\239\147~\US3\222UK\186y\SOHG\226\163\DLE\152\242",PropReceiveMaximum 9627,PropReceiveMaximum
// 7912,PropAssignedClientIdentifier
// "\237\191\228d\245fu\215\255\222\171\170\229\DC2\184q>#\239\ab\252\188\211\r\247\147\ENQ",PropMaximumQoS
// 55,PropWillDelayInterval 17769,PropTopicAliasMaximum 28809,PropPayloadFormatIndicator 162]}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {
      0x35, 0xec, 0x1,  0x0,  0x11, 0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49, 0x83, 0x26, 0xcf, 0x34, 0xb3,
      0x9c, 0x18, 0xe,  0x48, 0xae, 0xce, 0x1,  0xb,  0x9,  0x16, 0x0,  0x1d, 0xf2, 0xe7, 0x1c, 0x6f, 0xdf, 0xb4, 0x8,
      0xf1, 0x29, 0xd6, 0x70, 0x4d, 0x15, 0xa,  0x48, 0x8a, 0x2b, 0x68, 0x3b, 0x26, 0x74, 0x38, 0x2,  0xd8, 0xb2, 0x71,
      0xfb, 0x89, 0x2b, 0x28, 0xf6, 0xb,  0x4,  0x22, 0x2e, 0x99, 0x11, 0x0,  0x0,  0x2f, 0xc3, 0x22, 0x55, 0xa3, 0x28,
      0x31, 0x12, 0x0,  0x16, 0x5f, 0x88, 0xa6, 0x20, 0x1d, 0x19, 0x3,  0xdc, 0x6,  0x5d, 0x5,  0xc4, 0x36, 0x33, 0x6,
      0xf,  0xc5, 0x6b, 0xe4, 0x61, 0x34, 0x2c, 0x2,  0x0,  0x0,  0x79, 0xbd, 0x15, 0x0,  0x17, 0x16, 0xc,  0xad, 0xf4,
      0x59, 0xf7, 0x7a, 0xa0, 0x69, 0x39, 0x69, 0x80, 0x43, 0xb2, 0xc9, 0x8f, 0x6f, 0x4d, 0x5,  0x8a, 0xb0, 0x40, 0xc0,
      0x9,  0x0,  0x14, 0xc5, 0x22, 0xc2, 0xd6, 0xf1, 0x61, 0xd1, 0xc7, 0x55, 0x8a, 0x44, 0xc8, 0x18, 0x22, 0x37, 0x57,
      0x4,  0x24, 0x5f, 0x23, 0x8,  0x0,  0x4,  0xed, 0xca, 0x5e, 0xf4, 0x12, 0x0,  0x11, 0xef, 0x93, 0x7e, 0x1f, 0x33,
      0xde, 0x55, 0x4b, 0xba, 0x79, 0x1,  0x47, 0xe2, 0xa3, 0x10, 0x98, 0xf2, 0x21, 0x25, 0x9b, 0x21, 0x1e, 0xe8, 0x12,
      0x0,  0x1c, 0xed, 0xbf, 0xe4, 0x64, 0xf5, 0x66, 0x75, 0xd7, 0xff, 0xde, 0xab, 0xaa, 0xe5, 0x12, 0xb8, 0x71, 0x3e,
      0x23, 0xef, 0x7,  0x62, 0xfc, 0xbc, 0xd3, 0xd,  0xf7, 0x93, 0x5,  0x24, 0x37, 0x18, 0x0,  0x0,  0x45, 0x69, 0x22,
      0x70, 0x89, 0x1,  0xa2, 0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x29, 0xdf, 0xd7, 0x3c, 0x97, 0x52, 0x5,  0x13, 0x49,
                               0x83, 0x26, 0xcf, 0x34, 0xb3, 0x9c, 0x18, 0xe};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd0, 0x5a, 0x6f, 0xd6, 0xf6, 0x23, 0x76};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 18606);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\168E\247k\237\175\&5\SO\SYNU\224\160", _pubPktID = 28189, _pubBody = "", _pubProps = [PropResponseInformation
// "Y\236\&2K\172\176\155\149\164\203\&1Q\173",PropWildcardSubscriptionAvailable 109]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x35, 0x23, 0x0,  0xc,  0xa8, 0x45, 0xf7, 0x6b, 0xed, 0xaf, 0x35, 0xe,  0x16,
                   0x55, 0xe0, 0xa0, 0x6e, 0x1d, 0x12, 0x1a, 0x0,  0xd,  0x59, 0xec, 0x32, 0x4b,
                   0xac, 0xb0, 0x9b, 0x95, 0xa4, 0xcb, 0x31, 0x51, 0xad, 0x28, 0x6d};
  uint8_t topic_bytes[] = {0xa8, 0x45, 0xf7, 0x6b, 0xed, 0xaf, 0x35, 0xe, 0x16, 0x55, 0xe0, 0xa0};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0x59, 0xec, 0x32, 0x4b, 0xac, 0xb0, 0x9b, 0x95, 0xa4, 0xcb, 0x31, 0x51, 0xad};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 109}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 28189, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\168E\247k\237\175\&5\SO\SYNU\224\160", _pubPktID = 28189, _pubBody = "", _pubProps = [PropResponseInformation
// "Y\236\&2K\172\176\155\149\164\203\&1Q\173",PropWildcardSubscriptionAvailable 109]}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x35, 0x23, 0x0,  0xc,  0xa8, 0x45, 0xf7, 0x6b, 0xed, 0xaf, 0x35, 0xe,  0x16,
                   0x55, 0xe0, 0xa0, 0x6e, 0x1d, 0x12, 0x1a, 0x0,  0xd,  0x59, 0xec, 0x32, 0x4b,
                   0xac, 0xb0, 0x9b, 0x95, 0xa4, 0xcb, 0x31, 0x51, 0xad, 0x28, 0x6d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa8, 0x45, 0xf7, 0x6b, 0xed, 0xaf, 0x35, 0xe, 0x16, 0x55, 0xe0, 0xa0};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 28189);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\191\CAN?\r\149\&0\185\198\tZ\213\STX5\192\195", _pubPktID = 0, _pubBody = "\190\206\169pC<\142\135\&8\243",
// _pubProps = [PropRequestResponseInformation 30,PropReceiveMaximum 13794,PropSubscriptionIdentifierAvailable
// 193,PropResponseInformation "\204\198\191\192ND\FS\218\DC4",PropSubscriptionIdentifierAvailable 226,PropMaximumQoS
// 112,PropMaximumQoS 106,PropWillDelayInterval 19852,PropTopicAlias 29604,PropMessageExpiryInterval
// 2602,PropContentType ";O\147\155!<~\199\ETX\215\SOHcc\DC4i\247I\231"]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {0x39, 0x57, 0x0,  0xf,  0xbf, 0x18, 0x3f, 0xd,  0x95, 0x30, 0xb9, 0xc6, 0x9,  0x5a, 0xd5,
                   0x2,  0x35, 0xc0, 0xc3, 0x3b, 0x19, 0x1e, 0x21, 0x35, 0xe2, 0x29, 0xc1, 0x1a, 0x0,  0x9,
                   0xcc, 0xc6, 0xbf, 0xc0, 0x4e, 0x44, 0x1c, 0xda, 0x14, 0x29, 0xe2, 0x24, 0x70, 0x24, 0x6a,
                   0x18, 0x0,  0x0,  0x4d, 0x8c, 0x23, 0x73, 0xa4, 0x2,  0x0,  0x0,  0xa,  0x2a, 0x3,  0x0,
                   0x12, 0x3b, 0x4f, 0x93, 0x9b, 0x21, 0x3c, 0x7e, 0xc7, 0x3,  0xd7, 0x1,  0x63, 0x63, 0x14,
                   0x69, 0xf7, 0x49, 0xe7, 0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  uint8_t topic_bytes[] = {0xbf, 0x18, 0x3f, 0xd, 0x95, 0x30, 0xb9, 0xc6, 0x9, 0x5a, 0xd5, 0x2, 0x35, 0xc0, 0xc3};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0xcc, 0xc6, 0xbf, 0xc0, 0x4e, 0x44, 0x1c, 0xda, 0x14};
  uint8_t bytesprops1[] = {0x3b, 0x4f, 0x93, 0x9b, 0x21, 0x3c, 0x7e, 0xc7, 0x3,
                           0xd7, 0x1,  0x63, 0x63, 0x14, 0x69, 0xf7, 0x49, 0xe7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13794}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19852}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29604}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2602}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\191\CAN?\r\149\&0\185\198\tZ\213\STX5\192\195", _pubPktID = 0, _pubBody = "\190\206\169pC<\142\135\&8\243",
// _pubProps = [PropRequestResponseInformation 30,PropReceiveMaximum 13794,PropSubscriptionIdentifierAvailable
// 193,PropResponseInformation "\204\198\191\192ND\FS\218\DC4",PropSubscriptionIdentifierAvailable 226,PropMaximumQoS
// 112,PropMaximumQoS 106,PropWillDelayInterval 19852,PropTopicAlias 29604,PropMessageExpiryInterval
// 2602,PropContentType ";O\147\155!<~\199\ETX\215\SOHcc\DC4i\247I\231"]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {0x39, 0x57, 0x0,  0xf,  0xbf, 0x18, 0x3f, 0xd,  0x95, 0x30, 0xb9, 0xc6, 0x9,  0x5a, 0xd5,
                   0x2,  0x35, 0xc0, 0xc3, 0x3b, 0x19, 0x1e, 0x21, 0x35, 0xe2, 0x29, 0xc1, 0x1a, 0x0,  0x9,
                   0xcc, 0xc6, 0xbf, 0xc0, 0x4e, 0x44, 0x1c, 0xda, 0x14, 0x29, 0xe2, 0x24, 0x70, 0x24, 0x6a,
                   0x18, 0x0,  0x0,  0x4d, 0x8c, 0x23, 0x73, 0xa4, 0x2,  0x0,  0x0,  0xa,  0x2a, 0x3,  0x0,
                   0x12, 0x3b, 0x4f, 0x93, 0x9b, 0x21, 0x3c, 0x7e, 0xc7, 0x3,  0xd7, 0x1,  0x63, 0x63, 0x14,
                   0x69, 0xf7, 0x49, 0xe7, 0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbf, 0x18, 0x3f, 0xd, 0x95, 0x30, 0xb9, 0xc6, 0x9, 0x5a, 0xd5, 0x2, 0x35, 0xc0, 0xc3};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbe, 0xce, 0xa9, 0x70, 0x43, 0x3c, 0x8e, 0x87, 0x38, 0xf3};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\209\227N0}\DEL\200\186\135Q\178Ab\227[N~\173\197\252P", _pubPktID = 17259, _pubBody =
// "\211\&9\214\163\194\138\\\205\223\162\148\156\131\232\SYN\215\213\DC4\174", _pubProps = [PropReceiveMaximum
// 22801,PropAuthenticationData "\207\205\ESC\151",PropMaximumPacketSize 18459,PropTopicAlias 3707,PropRetainAvailable
// 96,PropServerReference "\230\129#r\158\231m+\FS\163,z\200\254\152",PropTopicAliasMaximum
// 23376,PropSubscriptionIdentifier 1,PropRetainAvailable 81,PropMessageExpiryInterval 31204,PropReasonString
// "\137\ENQ\150\185\218",PropPayloadFormatIndicator 122,PropMaximumPacketSize 6063,PropMessageExpiryInterval
// 14185,PropSharedSubscriptionAvailable 118,PropPayloadFormatIndicator 113,PropSubscriptionIdentifier
// 20,PropSubscriptionIdentifierAvailable 192,PropMessageExpiryInterval 21107,PropWildcardSubscriptionAvailable
// 3,PropServerKeepAlive 14528,PropCorrelationData "x",PropAuthenticationMethod "1z&[",PropMaximumQoS
// 46,PropSharedSubscriptionAvailable 61,PropMaximumQoS 55]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x3d, 0x96, 0x1,  0x0,  0x15, 0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2,
                   0x41, 0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50, 0x43, 0x6b, 0x69, 0x21, 0x59, 0x11,
                   0x16, 0x0,  0x4,  0xcf, 0xcd, 0x1b, 0x97, 0x27, 0x0,  0x0,  0x48, 0x1b, 0x23, 0xe,  0x7b, 0x25,
                   0x60, 0x1c, 0x0,  0xf,  0xe6, 0x81, 0x23, 0x72, 0x9e, 0xe7, 0x6d, 0x2b, 0x1c, 0xa3, 0x2c, 0x7a,
                   0xc8, 0xfe, 0x98, 0x22, 0x5b, 0x50, 0xb,  0x1,  0x25, 0x51, 0x2,  0x0,  0x0,  0x79, 0xe4, 0x1f,
                   0x0,  0x5,  0x89, 0x5,  0x96, 0xb9, 0xda, 0x1,  0x7a, 0x27, 0x0,  0x0,  0x17, 0xaf, 0x2,  0x0,
                   0x0,  0x37, 0x69, 0x2a, 0x76, 0x1,  0x71, 0xb,  0x14, 0x29, 0xc0, 0x2,  0x0,  0x0,  0x52, 0x73,
                   0x28, 0x3,  0x13, 0x38, 0xc0, 0x9,  0x0,  0x1,  0x78, 0x15, 0x0,  0x4,  0x31, 0x7a, 0x26, 0x5b,
                   0x24, 0x2e, 0x2a, 0x3d, 0x24, 0x37, 0xd3, 0x39, 0xd6, 0xa3, 0xc2, 0x8a, 0x5c, 0xcd, 0xdf, 0xa2,
                   0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  uint8_t topic_bytes[] = {0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2,
                           0x41, 0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd3, 0x39, 0xd6, 0xa3, 0xc2, 0x8a, 0x5c, 0xcd, 0xdf, 0xa2,
                         0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xcf, 0xcd, 0x1b, 0x97};
  uint8_t bytesprops1[] = {0xe6, 0x81, 0x23, 0x72, 0x9e, 0xe7, 0x6d, 0x2b, 0x1c, 0xa3, 0x2c, 0x7a, 0xc8, 0xfe, 0x98};
  uint8_t bytesprops2[] = {0x89, 0x5, 0x96, 0xb9, 0xda};
  uint8_t bytesprops3[] = {0x78};
  uint8_t bytesprops4[] = {0x31, 0x7a, 0x26, 0x5b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22801}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18459}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3707}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23376}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 1}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31204}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6063}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14185}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21107}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14528}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 55}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 17259, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\209\227N0}\DEL\200\186\135Q\178Ab\227[N~\173\197\252P", _pubPktID = 17259, _pubBody =
// "\211\&9\214\163\194\138\\\205\223\162\148\156\131\232\SYN\215\213\DC4\174", _pubProps = [PropReceiveMaximum
// 22801,PropAuthenticationData "\207\205\ESC\151",PropMaximumPacketSize 18459,PropTopicAlias 3707,PropRetainAvailable
// 96,PropServerReference "\230\129#r\158\231m+\FS\163,z\200\254\152",PropTopicAliasMaximum
// 23376,PropSubscriptionIdentifier 1,PropRetainAvailable 81,PropMessageExpiryInterval 31204,PropReasonString
// "\137\ENQ\150\185\218",PropPayloadFormatIndicator 122,PropMaximumPacketSize 6063,PropMessageExpiryInterval
// 14185,PropSharedSubscriptionAvailable 118,PropPayloadFormatIndicator 113,PropSubscriptionIdentifier
// 20,PropSubscriptionIdentifierAvailable 192,PropMessageExpiryInterval 21107,PropWildcardSubscriptionAvailable
// 3,PropServerKeepAlive 14528,PropCorrelationData "x",PropAuthenticationMethod "1z&[",PropMaximumQoS
// 46,PropSharedSubscriptionAvailable 61,PropMaximumQoS 55]}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x3d, 0x96, 0x1,  0x0,  0x15, 0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2,
                   0x41, 0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50, 0x43, 0x6b, 0x69, 0x21, 0x59, 0x11,
                   0x16, 0x0,  0x4,  0xcf, 0xcd, 0x1b, 0x97, 0x27, 0x0,  0x0,  0x48, 0x1b, 0x23, 0xe,  0x7b, 0x25,
                   0x60, 0x1c, 0x0,  0xf,  0xe6, 0x81, 0x23, 0x72, 0x9e, 0xe7, 0x6d, 0x2b, 0x1c, 0xa3, 0x2c, 0x7a,
                   0xc8, 0xfe, 0x98, 0x22, 0x5b, 0x50, 0xb,  0x1,  0x25, 0x51, 0x2,  0x0,  0x0,  0x79, 0xe4, 0x1f,
                   0x0,  0x5,  0x89, 0x5,  0x96, 0xb9, 0xda, 0x1,  0x7a, 0x27, 0x0,  0x0,  0x17, 0xaf, 0x2,  0x0,
                   0x0,  0x37, 0x69, 0x2a, 0x76, 0x1,  0x71, 0xb,  0x14, 0x29, 0xc0, 0x2,  0x0,  0x0,  0x52, 0x73,
                   0x28, 0x3,  0x13, 0x38, 0xc0, 0x9,  0x0,  0x1,  0x78, 0x15, 0x0,  0x4,  0x31, 0x7a, 0x26, 0x5b,
                   0x24, 0x2e, 0x2a, 0x3d, 0x24, 0x37, 0xd3, 0x39, 0xd6, 0xa3, 0xc2, 0x8a, 0x5c, 0xcd, 0xdf, 0xa2,
                   0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd1, 0xe3, 0x4e, 0x30, 0x7d, 0x7f, 0xc8, 0xba, 0x87, 0x51, 0xb2,
                               0x41, 0x62, 0xe3, 0x5b, 0x4e, 0x7e, 0xad, 0xc5, 0xfc, 0x50};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd3, 0x39, 0xd6, 0xa3, 0xc2, 0x8a, 0x5c, 0xcd, 0xdf, 0xa2,
                              0x94, 0x9c, 0x83, 0xe8, 0x16, 0xd7, 0xd5, 0x14, 0xae};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 17259);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\157\255\149\212\150\224\139\154J\197\&0C\166\189\203/\179f$J\197-\r\240\SUB\188;\r\173", _pubPktID = 22738,
// _pubBody = "\210\DC1\143z\164\179\bD\DELn", _pubProps = [PropMessageExpiryInterval 27990,PropMaximumPacketSize
// 22586,PropAssignedClientIdentifier "o@Z\207\212\141\233\136\149Yk\178b=\134OgP\ENQ\171_",PropAuthenticationData
// "@6\200\241\163\154\211\181L",PropAuthenticationData "8r\237\205\195\141\167\190\173L",PropAuthenticationData
// "*\149\SYNC\208\FS\145T7oDG\206\213\&1\153\231\&2s\192i\ENQ\FS\170\158|\SYN\ENQ",PropReceiveMaximum
// 24325,PropCorrelationData
// "\128\r\194\188\187\vVbUN_\181\&8\142:\195\236_XF\165\168\CAN\f\150DV\192\147",PropResponseInformation
// "k\DC1\198M\EM\132\196\219\197\ETB+\254\ESC\138\209\182p-\158\251"]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {0x3c, 0xc1, 0x1,  0x0,  0x1d, 0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30, 0x43,
                   0xa6, 0xbd, 0xcb, 0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc, 0x3b, 0xd,  0xad,
                   0x58, 0xd2, 0x94, 0x1,  0x2,  0x0,  0x0,  0x6d, 0x56, 0x27, 0x0,  0x0,  0x58, 0x3a, 0x12, 0x0,  0x15,
                   0x6f, 0x40, 0x5a, 0xcf, 0xd4, 0x8d, 0xe9, 0x88, 0x95, 0x59, 0x6b, 0xb2, 0x62, 0x3d, 0x86, 0x4f, 0x67,
                   0x50, 0x5,  0xab, 0x5f, 0x16, 0x0,  0x9,  0x40, 0x36, 0xc8, 0xf1, 0xa3, 0x9a, 0xd3, 0xb5, 0x4c, 0x16,
                   0x0,  0xa,  0x38, 0x72, 0xed, 0xcd, 0xc3, 0x8d, 0xa7, 0xbe, 0xad, 0x4c, 0x16, 0x0,  0x1c, 0x2a, 0x95,
                   0x16, 0x43, 0xd0, 0x1c, 0x91, 0x54, 0x37, 0x6f, 0x44, 0x47, 0xce, 0xd5, 0x31, 0x99, 0xe7, 0x32, 0x73,
                   0xc0, 0x69, 0x5,  0x1c, 0xaa, 0x9e, 0x7c, 0x16, 0x5,  0x21, 0x5f, 0x5,  0x9,  0x0,  0x1d, 0x80, 0xd,
                   0xc2, 0xbc, 0xbb, 0xb,  0x56, 0x62, 0x55, 0x4e, 0x5f, 0xb5, 0x38, 0x8e, 0x3a, 0xc3, 0xec, 0x5f, 0x58,
                   0x46, 0xa5, 0xa8, 0x18, 0xc,  0x96, 0x44, 0x56, 0xc0, 0x93, 0x1a, 0x0,  0x14, 0x6b, 0x11, 0xc6, 0x4d,
                   0x19, 0x84, 0xc4, 0xdb, 0xc5, 0x17, 0x2b, 0xfe, 0x1b, 0x8a, 0xd1, 0xb6, 0x70, 0x2d, 0x9e, 0xfb, 0xd2,
                   0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8,  0x44, 0x7f, 0x6e};
  uint8_t topic_bytes[] = {0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30, 0x43, 0xa6, 0xbd, 0xcb,
                           0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc, 0x3b, 0xd,  0xad};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd2, 0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8, 0x44, 0x7f, 0x6e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x6f, 0x40, 0x5a, 0xcf, 0xd4, 0x8d, 0xe9, 0x88, 0x95, 0x59, 0x6b,
                           0xb2, 0x62, 0x3d, 0x86, 0x4f, 0x67, 0x50, 0x5,  0xab, 0x5f};
  uint8_t bytesprops1[] = {0x40, 0x36, 0xc8, 0xf1, 0xa3, 0x9a, 0xd3, 0xb5, 0x4c};
  uint8_t bytesprops2[] = {0x38, 0x72, 0xed, 0xcd, 0xc3, 0x8d, 0xa7, 0xbe, 0xad, 0x4c};
  uint8_t bytesprops3[] = {0x2a, 0x95, 0x16, 0x43, 0xd0, 0x1c, 0x91, 0x54, 0x37, 0x6f, 0x44, 0x47, 0xce, 0xd5,
                           0x31, 0x99, 0xe7, 0x32, 0x73, 0xc0, 0x69, 0x5,  0x1c, 0xaa, 0x9e, 0x7c, 0x16, 0x5};
  uint8_t bytesprops4[] = {0x80, 0xd,  0xc2, 0xbc, 0xbb, 0xb,  0x56, 0x62, 0x55, 0x4e, 0x5f, 0xb5, 0x38, 0x8e, 0x3a,
                           0xc3, 0xec, 0x5f, 0x58, 0x46, 0xa5, 0xa8, 0x18, 0xc,  0x96, 0x44, 0x56, 0xc0, 0x93};
  uint8_t bytesprops5[] = {0x6b, 0x11, 0xc6, 0x4d, 0x19, 0x84, 0xc4, 0xdb, 0xc5, 0x17,
                           0x2b, 0xfe, 0x1b, 0x8a, 0xd1, 0xb6, 0x70, 0x2d, 0x9e, 0xfb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27990}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22586}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24325}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 22738, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\157\255\149\212\150\224\139\154J\197\&0C\166\189\203/\179f$J\197-\r\240\SUB\188;\r\173", _pubPktID = 22738,
// _pubBody = "\210\DC1\143z\164\179\bD\DELn", _pubProps = [PropMessageExpiryInterval 27990,PropMaximumPacketSize
// 22586,PropAssignedClientIdentifier "o@Z\207\212\141\233\136\149Yk\178b=\134OgP\ENQ\171_",PropAuthenticationData
// "@6\200\241\163\154\211\181L",PropAuthenticationData "8r\237\205\195\141\167\190\173L",PropAuthenticationData
// "*\149\SYNC\208\FS\145T7oDG\206\213\&1\153\231\&2s\192i\ENQ\FS\170\158|\SYN\ENQ",PropReceiveMaximum
// 24325,PropCorrelationData
// "\128\r\194\188\187\vVbUN_\181\&8\142:\195\236_XF\165\168\CAN\f\150DV\192\147",PropResponseInformation
// "k\DC1\198M\EM\132\196\219\197\ETB+\254\ESC\138\209\182p-\158\251"]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {0x3c, 0xc1, 0x1,  0x0,  0x1d, 0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30, 0x43,
                   0xa6, 0xbd, 0xcb, 0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc, 0x3b, 0xd,  0xad,
                   0x58, 0xd2, 0x94, 0x1,  0x2,  0x0,  0x0,  0x6d, 0x56, 0x27, 0x0,  0x0,  0x58, 0x3a, 0x12, 0x0,  0x15,
                   0x6f, 0x40, 0x5a, 0xcf, 0xd4, 0x8d, 0xe9, 0x88, 0x95, 0x59, 0x6b, 0xb2, 0x62, 0x3d, 0x86, 0x4f, 0x67,
                   0x50, 0x5,  0xab, 0x5f, 0x16, 0x0,  0x9,  0x40, 0x36, 0xc8, 0xf1, 0xa3, 0x9a, 0xd3, 0xb5, 0x4c, 0x16,
                   0x0,  0xa,  0x38, 0x72, 0xed, 0xcd, 0xc3, 0x8d, 0xa7, 0xbe, 0xad, 0x4c, 0x16, 0x0,  0x1c, 0x2a, 0x95,
                   0x16, 0x43, 0xd0, 0x1c, 0x91, 0x54, 0x37, 0x6f, 0x44, 0x47, 0xce, 0xd5, 0x31, 0x99, 0xe7, 0x32, 0x73,
                   0xc0, 0x69, 0x5,  0x1c, 0xaa, 0x9e, 0x7c, 0x16, 0x5,  0x21, 0x5f, 0x5,  0x9,  0x0,  0x1d, 0x80, 0xd,
                   0xc2, 0xbc, 0xbb, 0xb,  0x56, 0x62, 0x55, 0x4e, 0x5f, 0xb5, 0x38, 0x8e, 0x3a, 0xc3, 0xec, 0x5f, 0x58,
                   0x46, 0xa5, 0xa8, 0x18, 0xc,  0x96, 0x44, 0x56, 0xc0, 0x93, 0x1a, 0x0,  0x14, 0x6b, 0x11, 0xc6, 0x4d,
                   0x19, 0x84, 0xc4, 0xdb, 0xc5, 0x17, 0x2b, 0xfe, 0x1b, 0x8a, 0xd1, 0xb6, 0x70, 0x2d, 0x9e, 0xfb, 0xd2,
                   0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8,  0x44, 0x7f, 0x6e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9d, 0xff, 0x95, 0xd4, 0x96, 0xe0, 0x8b, 0x9a, 0x4a, 0xc5, 0x30, 0x43, 0xa6, 0xbd, 0xcb,
                               0x2f, 0xb3, 0x66, 0x24, 0x4a, 0xc5, 0x2d, 0xd,  0xf0, 0x1a, 0xbc, 0x3b, 0xd,  0xad};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd2, 0x11, 0x8f, 0x7a, 0xa4, 0xb3, 0x8, 0x44, 0x7f, 0x6e};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 22738);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 6071, _pubBody =
// "#\140\138\233\171\140\SOH9\165\168kP\138\237?\192\174", _pubProps = [PropSubscriptionIdentifier
// 19,PropCorrelationData
// "\163\146\223\STX\v\158\142\216vy\t\195\168r\DLEQ\201Z\185Lhw@\134\168G\193\190",PropAuthenticationMethod
// "\142{x",PropSharedSubscriptionAvailable 136,PropServerReference
// "\218\183r\155\128\141\192<\182\250\221B\189\ENQ@\195,\RS<\170\161\SI\168",PropUserProperty
// "y@J]\NULg\184\NUL\196Nz\151\STX\153[7\150\EM"
// "\172\CANzCe\244:\165\200P\180\146#\182\202`xq\129L\207\157a=\251[\191V\156",PropRetainAvailable
// 105,PropAssignedClientIdentifier "\167\STX\DELeb\254~\SI",PropSubscriptionIdentifierAvailable 150,PropResponseTopic
// "@\145\EOT$!(\200\DC3%\169",PropReasonString
// "\194\197\175\206\177\131\206?\176\209\128\STXW7\250/\250",PropWildcardSubscriptionAvailable
// 192,PropSubscriptionIdentifier 24,PropSharedSubscriptionAvailable 229,PropTopicAlias 19504,PropTopicAlias
// 5785,PropMessageExpiryInterval 5671,PropTopicAliasMaximum 8296,PropWildcardSubscriptionAvailable
// 156,PropAuthenticationMethod "\136.\180O\203\vUn\185\181\221oS\249lO\208\194>\249\135",PropServerReference
// "\169\&4:\213",PropSharedSubscriptionAvailable 158,PropAssignedClientIdentifier
// "T;\244I\214\197%\170\138\204\211\163R\ACKR]H[$\235Ik\ESC-r",PropTopicAliasMaximum
// 6908,PropSharedSubscriptionAvailable 103,PropAuthenticationMethod
// "\221x\RS\147qG\128\171\239\250\243&\159\226\198\DC1QA\vl\250o\194\195d\145\193"]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x3b, 0xb4, 0x2,  0x0,  0x0,  0x17, 0xb7, 0x9d, 0x2,  0xb,  0x13, 0x9,  0x0,  0x1c, 0xa3, 0x92, 0xdf, 0x2,  0xb,
      0x9e, 0x8e, 0xd8, 0x76, 0x79, 0x9,  0xc3, 0xa8, 0x72, 0x10, 0x51, 0xc9, 0x5a, 0xb9, 0x4c, 0x68, 0x77, 0x40, 0x86,
      0xa8, 0x47, 0xc1, 0xbe, 0x15, 0x0,  0x3,  0x8e, 0x7b, 0x78, 0x2a, 0x88, 0x1c, 0x0,  0x17, 0xda, 0xb7, 0x72, 0x9b,
      0x80, 0x8d, 0xc0, 0x3c, 0xb6, 0xfa, 0xdd, 0x42, 0xbd, 0x5,  0x40, 0xc3, 0x2c, 0x1e, 0x3c, 0xaa, 0xa1, 0xf,  0xa8,
      0x26, 0x0,  0x12, 0x79, 0x40, 0x4a, 0x5d, 0x0,  0x67, 0xb8, 0x0,  0xc4, 0x4e, 0x7a, 0x97, 0x2,  0x99, 0x5b, 0x37,
      0x96, 0x19, 0x0,  0x1d, 0xac, 0x18, 0x7a, 0x43, 0x65, 0xf4, 0x3a, 0xa5, 0xc8, 0x50, 0xb4, 0x92, 0x23, 0xb6, 0xca,
      0x60, 0x78, 0x71, 0x81, 0x4c, 0xcf, 0x9d, 0x61, 0x3d, 0xfb, 0x5b, 0xbf, 0x56, 0x9c, 0x25, 0x69, 0x12, 0x0,  0x8,
      0xa7, 0x2,  0x7f, 0x65, 0x62, 0xfe, 0x7e, 0xf,  0x29, 0x96, 0x8,  0x0,  0xa,  0x40, 0x91, 0x4,  0x24, 0x21, 0x28,
      0xc8, 0x13, 0x25, 0xa9, 0x1f, 0x0,  0x11, 0xc2, 0xc5, 0xaf, 0xce, 0xb1, 0x83, 0xce, 0x3f, 0xb0, 0xd1, 0x80, 0x2,
      0x57, 0x37, 0xfa, 0x2f, 0xfa, 0x28, 0xc0, 0xb,  0x18, 0x2a, 0xe5, 0x23, 0x4c, 0x30, 0x23, 0x16, 0x99, 0x2,  0x0,
      0x0,  0x16, 0x27, 0x22, 0x20, 0x68, 0x28, 0x9c, 0x15, 0x0,  0x15, 0x88, 0x2e, 0xb4, 0x4f, 0xcb, 0xb,  0x55, 0x6e,
      0xb9, 0xb5, 0xdd, 0x6f, 0x53, 0xf9, 0x6c, 0x4f, 0xd0, 0xc2, 0x3e, 0xf9, 0x87, 0x1c, 0x0,  0x4,  0xa9, 0x34, 0x3a,
      0xd5, 0x2a, 0x9e, 0x12, 0x0,  0x19, 0x54, 0x3b, 0xf4, 0x49, 0xd6, 0xc5, 0x25, 0xaa, 0x8a, 0xcc, 0xd3, 0xa3, 0x52,
      0x6,  0x52, 0x5d, 0x48, 0x5b, 0x24, 0xeb, 0x49, 0x6b, 0x1b, 0x2d, 0x72, 0x22, 0x1a, 0xfc, 0x2a, 0x67, 0x15, 0x0,
      0x1b, 0xdd, 0x78, 0x1e, 0x93, 0x71, 0x47, 0x80, 0xab, 0xef, 0xfa, 0xf3, 0x26, 0x9f, 0xe2, 0xc6, 0x11, 0x51, 0x41,
      0xb,  0x6c, 0xfa, 0x6f, 0xc2, 0xc3, 0x64, 0x91, 0xc1, 0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c, 0x1,  0x39, 0xa5, 0xa8,
      0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c, 0x1,  0x39, 0xa5,
                         0xa8, 0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0xa3, 0x92, 0xdf, 0x2,  0xb,  0x9e, 0x8e, 0xd8, 0x76, 0x79, 0x9,  0xc3, 0xa8, 0x72,
                           0x10, 0x51, 0xc9, 0x5a, 0xb9, 0x4c, 0x68, 0x77, 0x40, 0x86, 0xa8, 0x47, 0xc1, 0xbe};
  uint8_t bytesprops1[] = {0x8e, 0x7b, 0x78};
  uint8_t bytesprops2[] = {0xda, 0xb7, 0x72, 0x9b, 0x80, 0x8d, 0xc0, 0x3c, 0xb6, 0xfa, 0xdd, 0x42,
                           0xbd, 0x5,  0x40, 0xc3, 0x2c, 0x1e, 0x3c, 0xaa, 0xa1, 0xf,  0xa8};
  uint8_t bytesprops4[] = {0xac, 0x18, 0x7a, 0x43, 0x65, 0xf4, 0x3a, 0xa5, 0xc8, 0x50, 0xb4, 0x92, 0x23, 0xb6, 0xca,
                           0x60, 0x78, 0x71, 0x81, 0x4c, 0xcf, 0x9d, 0x61, 0x3d, 0xfb, 0x5b, 0xbf, 0x56, 0x9c};
  uint8_t bytesprops3[] = {0x79, 0x40, 0x4a, 0x5d, 0x0,  0x67, 0xb8, 0x0,  0xc4,
                           0x4e, 0x7a, 0x97, 0x2,  0x99, 0x5b, 0x37, 0x96, 0x19};
  uint8_t bytesprops5[] = {0xa7, 0x2, 0x7f, 0x65, 0x62, 0xfe, 0x7e, 0xf};
  uint8_t bytesprops6[] = {0x40, 0x91, 0x4, 0x24, 0x21, 0x28, 0xc8, 0x13, 0x25, 0xa9};
  uint8_t bytesprops7[] = {0xc2, 0xc5, 0xaf, 0xce, 0xb1, 0x83, 0xce, 0x3f, 0xb0,
                           0xd1, 0x80, 0x2,  0x57, 0x37, 0xfa, 0x2f, 0xfa};
  uint8_t bytesprops8[] = {0x88, 0x2e, 0xb4, 0x4f, 0xcb, 0xb,  0x55, 0x6e, 0xb9, 0xb5, 0xdd,
                           0x6f, 0x53, 0xf9, 0x6c, 0x4f, 0xd0, 0xc2, 0x3e, 0xf9, 0x87};
  uint8_t bytesprops9[] = {0xa9, 0x34, 0x3a, 0xd5};
  uint8_t bytesprops10[] = {0x54, 0x3b, 0xf4, 0x49, 0xd6, 0xc5, 0x25, 0xaa, 0x8a, 0xcc, 0xd3, 0xa3, 0x52,
                            0x6,  0x52, 0x5d, 0x48, 0x5b, 0x24, 0xeb, 0x49, 0x6b, 0x1b, 0x2d, 0x72};
  uint8_t bytesprops11[] = {0xdd, 0x78, 0x1e, 0x93, 0x71, 0x47, 0x80, 0xab, 0xef, 0xfa, 0xf3, 0x26, 0x9f, 0xe2,
                            0xc6, 0x11, 0x51, 0x41, 0xb,  0x6c, 0xfa, 0x6f, 0xc2, 0xc3, 0x64, 0x91, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops3}, .v = {29, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19504}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5785}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5671}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8296}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6908}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 6071, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "", _pubPktID = 6071, _pubBody =
// "#\140\138\233\171\140\SOH9\165\168kP\138\237?\192\174", _pubProps = [PropSubscriptionIdentifier
// 19,PropCorrelationData
// "\163\146\223\STX\v\158\142\216vy\t\195\168r\DLEQ\201Z\185Lhw@\134\168G\193\190",PropAuthenticationMethod
// "\142{x",PropSharedSubscriptionAvailable 136,PropServerReference
// "\218\183r\155\128\141\192<\182\250\221B\189\ENQ@\195,\RS<\170\161\SI\168",PropUserProperty
// "y@J]\NULg\184\NUL\196Nz\151\STX\153[7\150\EM"
// "\172\CANzCe\244:\165\200P\180\146#\182\202`xq\129L\207\157a=\251[\191V\156",PropRetainAvailable
// 105,PropAssignedClientIdentifier "\167\STX\DELeb\254~\SI",PropSubscriptionIdentifierAvailable 150,PropResponseTopic
// "@\145\EOT$!(\200\DC3%\169",PropReasonString
// "\194\197\175\206\177\131\206?\176\209\128\STXW7\250/\250",PropWildcardSubscriptionAvailable
// 192,PropSubscriptionIdentifier 24,PropSharedSubscriptionAvailable 229,PropTopicAlias 19504,PropTopicAlias
// 5785,PropMessageExpiryInterval 5671,PropTopicAliasMaximum 8296,PropWildcardSubscriptionAvailable
// 156,PropAuthenticationMethod "\136.\180O\203\vUn\185\181\221oS\249lO\208\194>\249\135",PropServerReference
// "\169\&4:\213",PropSharedSubscriptionAvailable 158,PropAssignedClientIdentifier
// "T;\244I\214\197%\170\138\204\211\163R\ACKR]H[$\235Ik\ESC-r",PropTopicAliasMaximum
// 6908,PropSharedSubscriptionAvailable 103,PropAuthenticationMethod
// "\221x\RS\147qG\128\171\239\250\243&\159\226\198\DC1QA\vl\250o\194\195d\145\193"]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x3b, 0xb4, 0x2,  0x0,  0x0,  0x17, 0xb7, 0x9d, 0x2,  0xb,  0x13, 0x9,  0x0,  0x1c, 0xa3, 0x92, 0xdf, 0x2,  0xb,
      0x9e, 0x8e, 0xd8, 0x76, 0x79, 0x9,  0xc3, 0xa8, 0x72, 0x10, 0x51, 0xc9, 0x5a, 0xb9, 0x4c, 0x68, 0x77, 0x40, 0x86,
      0xa8, 0x47, 0xc1, 0xbe, 0x15, 0x0,  0x3,  0x8e, 0x7b, 0x78, 0x2a, 0x88, 0x1c, 0x0,  0x17, 0xda, 0xb7, 0x72, 0x9b,
      0x80, 0x8d, 0xc0, 0x3c, 0xb6, 0xfa, 0xdd, 0x42, 0xbd, 0x5,  0x40, 0xc3, 0x2c, 0x1e, 0x3c, 0xaa, 0xa1, 0xf,  0xa8,
      0x26, 0x0,  0x12, 0x79, 0x40, 0x4a, 0x5d, 0x0,  0x67, 0xb8, 0x0,  0xc4, 0x4e, 0x7a, 0x97, 0x2,  0x99, 0x5b, 0x37,
      0x96, 0x19, 0x0,  0x1d, 0xac, 0x18, 0x7a, 0x43, 0x65, 0xf4, 0x3a, 0xa5, 0xc8, 0x50, 0xb4, 0x92, 0x23, 0xb6, 0xca,
      0x60, 0x78, 0x71, 0x81, 0x4c, 0xcf, 0x9d, 0x61, 0x3d, 0xfb, 0x5b, 0xbf, 0x56, 0x9c, 0x25, 0x69, 0x12, 0x0,  0x8,
      0xa7, 0x2,  0x7f, 0x65, 0x62, 0xfe, 0x7e, 0xf,  0x29, 0x96, 0x8,  0x0,  0xa,  0x40, 0x91, 0x4,  0x24, 0x21, 0x28,
      0xc8, 0x13, 0x25, 0xa9, 0x1f, 0x0,  0x11, 0xc2, 0xc5, 0xaf, 0xce, 0xb1, 0x83, 0xce, 0x3f, 0xb0, 0xd1, 0x80, 0x2,
      0x57, 0x37, 0xfa, 0x2f, 0xfa, 0x28, 0xc0, 0xb,  0x18, 0x2a, 0xe5, 0x23, 0x4c, 0x30, 0x23, 0x16, 0x99, 0x2,  0x0,
      0x0,  0x16, 0x27, 0x22, 0x20, 0x68, 0x28, 0x9c, 0x15, 0x0,  0x15, 0x88, 0x2e, 0xb4, 0x4f, 0xcb, 0xb,  0x55, 0x6e,
      0xb9, 0xb5, 0xdd, 0x6f, 0x53, 0xf9, 0x6c, 0x4f, 0xd0, 0xc2, 0x3e, 0xf9, 0x87, 0x1c, 0x0,  0x4,  0xa9, 0x34, 0x3a,
      0xd5, 0x2a, 0x9e, 0x12, 0x0,  0x19, 0x54, 0x3b, 0xf4, 0x49, 0xd6, 0xc5, 0x25, 0xaa, 0x8a, 0xcc, 0xd3, 0xa3, 0x52,
      0x6,  0x52, 0x5d, 0x48, 0x5b, 0x24, 0xeb, 0x49, 0x6b, 0x1b, 0x2d, 0x72, 0x22, 0x1a, 0xfc, 0x2a, 0x67, 0x15, 0x0,
      0x1b, 0xdd, 0x78, 0x1e, 0x93, 0x71, 0x47, 0x80, 0xab, 0xef, 0xfa, 0xf3, 0x26, 0x9f, 0xe2, 0xc6, 0x11, 0x51, 0x41,
      0xb,  0x6c, 0xfa, 0x6f, 0xc2, 0xc3, 0x64, 0x91, 0xc1, 0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c, 0x1,  0x39, 0xa5, 0xa8,
      0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x23, 0x8c, 0x8a, 0xe9, 0xab, 0x8c, 0x1,  0x39, 0xa5,
                              0xa8, 0x6b, 0x50, 0x8a, 0xed, 0x3f, 0xc0, 0xae};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 6071);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<m9", _pubPktID = 5951, _pubBody =
// "\176\133\203J\147A\240K\185k\145:\"\234\252\226\248W|\218\v\248*\n\SYN", _pubProps = [PropRequestProblemInformation
// 95,PropWildcardSubscriptionAvailable 50,PropAuthenticationData
// "\167\a\198f5}\242\247\137\194\249\217\245{\NUL\223",PropPayloadFormatIndicator 56,PropSessionExpiryInterval
// 9709,PropResponseInformation "\209\169*\209L\170\203\213-\198Xcd\199%;F.A<(f\RS{",PropRetainAvailable
// 87,PropResponseTopic "M\f\180\223\DLE^\210",PropSubscriptionIdentifier 13,PropAuthenticationData
// "\156\SYN\212!L\219P\167c",PropWillDelayInterval 19557,PropAuthenticationMethod
// "j6\168)\184^\DC4\211\211v\GS\159\241o\192$y{\224B\184\158\149\SI\194\175\241",PropRetainAvailable
// 1,PropSubscriptionIdentifierAvailable 64,PropSubscriptionIdentifier 31,PropMaximumPacketSize 3186,PropServerReference
// "",PropReasonString "2\187o,\200q\r\ETB\132\164\196n"]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {0x3c, 0xb5, 0x1,  0x0,  0x3,  0x3c, 0x6d, 0x39, 0x17, 0x3f, 0x93, 0x1,  0x17, 0x5f, 0x28, 0x32, 0x16,
                   0x0,  0x10, 0xa7, 0x7,  0xc6, 0x66, 0x35, 0x7d, 0xf2, 0xf7, 0x89, 0xc2, 0xf9, 0xd9, 0xf5, 0x7b, 0x0,
                   0xdf, 0x1,  0x38, 0x11, 0x0,  0x0,  0x25, 0xed, 0x1a, 0x0,  0x18, 0xd1, 0xa9, 0x2a, 0xd1, 0x4c, 0xaa,
                   0xcb, 0xd5, 0x2d, 0xc6, 0x58, 0x63, 0x64, 0xc7, 0x25, 0x3b, 0x46, 0x2e, 0x41, 0x3c, 0x28, 0x66, 0x1e,
                   0x7b, 0x25, 0x57, 0x8,  0x0,  0x7,  0x4d, 0xc,  0xb4, 0xdf, 0x10, 0x5e, 0xd2, 0xb,  0xd,  0x16, 0x0,
                   0x9,  0x9c, 0x16, 0xd4, 0x21, 0x4c, 0xdb, 0x50, 0xa7, 0x63, 0x18, 0x0,  0x0,  0x4c, 0x65, 0x15, 0x0,
                   0x1b, 0x6a, 0x36, 0xa8, 0x29, 0xb8, 0x5e, 0x14, 0xd3, 0xd3, 0x76, 0x1d, 0x9f, 0xf1, 0x6f, 0xc0, 0x24,
                   0x79, 0x7b, 0xe0, 0x42, 0xb8, 0x9e, 0x95, 0xf,  0xc2, 0xaf, 0xf1, 0x25, 0x1,  0x29, 0x40, 0xb,  0x1f,
                   0x27, 0x0,  0x0,  0xc,  0x72, 0x1c, 0x0,  0x0,  0x1f, 0x0,  0xc,  0x32, 0xbb, 0x6f, 0x2c, 0xc8, 0x71,
                   0xd,  0x17, 0x84, 0xa4, 0xc4, 0x6e, 0xb0, 0x85, 0xcb, 0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91,
                   0x3a, 0x22, 0xea, 0xfc, 0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  uint8_t topic_bytes[] = {0x3c, 0x6d, 0x39};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb0, 0x85, 0xcb, 0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91, 0x3a, 0x22,
                         0xea, 0xfc, 0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytesprops0[] = {0xa7, 0x7,  0xc6, 0x66, 0x35, 0x7d, 0xf2, 0xf7,
                           0x89, 0xc2, 0xf9, 0xd9, 0xf5, 0x7b, 0x0,  0xdf};
  uint8_t bytesprops1[] = {0xd1, 0xa9, 0x2a, 0xd1, 0x4c, 0xaa, 0xcb, 0xd5, 0x2d, 0xc6, 0x58, 0x63,
                           0x64, 0xc7, 0x25, 0x3b, 0x46, 0x2e, 0x41, 0x3c, 0x28, 0x66, 0x1e, 0x7b};
  uint8_t bytesprops2[] = {0x4d, 0xc, 0xb4, 0xdf, 0x10, 0x5e, 0xd2};
  uint8_t bytesprops3[] = {0x9c, 0x16, 0xd4, 0x21, 0x4c, 0xdb, 0x50, 0xa7, 0x63};
  uint8_t bytesprops4[] = {0x6a, 0x36, 0xa8, 0x29, 0xb8, 0x5e, 0x14, 0xd3, 0xd3, 0x76, 0x1d, 0x9f, 0xf1, 0x6f,
                           0xc0, 0x24, 0x79, 0x7b, 0xe0, 0x42, 0xb8, 0x9e, 0x95, 0xf,  0xc2, 0xaf, 0xf1};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x32, 0xbb, 0x6f, 0x2c, 0xc8, 0x71, 0xd, 0x17, 0x84, 0xa4, 0xc4, 0x6e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9709}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19557}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 31}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3186}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5951, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "<m9", _pubPktID = 5951, _pubBody =
// "\176\133\203J\147A\240K\185k\145:\"\234\252\226\248W|\218\v\248*\n\SYN", _pubProps = [PropRequestProblemInformation
// 95,PropWildcardSubscriptionAvailable 50,PropAuthenticationData
// "\167\a\198f5}\242\247\137\194\249\217\245{\NUL\223",PropPayloadFormatIndicator 56,PropSessionExpiryInterval
// 9709,PropResponseInformation "\209\169*\209L\170\203\213-\198Xcd\199%;F.A<(f\RS{",PropRetainAvailable
// 87,PropResponseTopic "M\f\180\223\DLE^\210",PropSubscriptionIdentifier 13,PropAuthenticationData
// "\156\SYN\212!L\219P\167c",PropWillDelayInterval 19557,PropAuthenticationMethod
// "j6\168)\184^\DC4\211\211v\GS\159\241o\192$y{\224B\184\158\149\SI\194\175\241",PropRetainAvailable
// 1,PropSubscriptionIdentifierAvailable 64,PropSubscriptionIdentifier 31,PropMaximumPacketSize 3186,PropServerReference
// "",PropReasonString "2\187o,\200q\r\ETB\132\164\196n"]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {0x3c, 0xb5, 0x1,  0x0,  0x3,  0x3c, 0x6d, 0x39, 0x17, 0x3f, 0x93, 0x1,  0x17, 0x5f, 0x28, 0x32, 0x16,
                   0x0,  0x10, 0xa7, 0x7,  0xc6, 0x66, 0x35, 0x7d, 0xf2, 0xf7, 0x89, 0xc2, 0xf9, 0xd9, 0xf5, 0x7b, 0x0,
                   0xdf, 0x1,  0x38, 0x11, 0x0,  0x0,  0x25, 0xed, 0x1a, 0x0,  0x18, 0xd1, 0xa9, 0x2a, 0xd1, 0x4c, 0xaa,
                   0xcb, 0xd5, 0x2d, 0xc6, 0x58, 0x63, 0x64, 0xc7, 0x25, 0x3b, 0x46, 0x2e, 0x41, 0x3c, 0x28, 0x66, 0x1e,
                   0x7b, 0x25, 0x57, 0x8,  0x0,  0x7,  0x4d, 0xc,  0xb4, 0xdf, 0x10, 0x5e, 0xd2, 0xb,  0xd,  0x16, 0x0,
                   0x9,  0x9c, 0x16, 0xd4, 0x21, 0x4c, 0xdb, 0x50, 0xa7, 0x63, 0x18, 0x0,  0x0,  0x4c, 0x65, 0x15, 0x0,
                   0x1b, 0x6a, 0x36, 0xa8, 0x29, 0xb8, 0x5e, 0x14, 0xd3, 0xd3, 0x76, 0x1d, 0x9f, 0xf1, 0x6f, 0xc0, 0x24,
                   0x79, 0x7b, 0xe0, 0x42, 0xb8, 0x9e, 0x95, 0xf,  0xc2, 0xaf, 0xf1, 0x25, 0x1,  0x29, 0x40, 0xb,  0x1f,
                   0x27, 0x0,  0x0,  0xc,  0x72, 0x1c, 0x0,  0x0,  0x1f, 0x0,  0xc,  0x32, 0xbb, 0x6f, 0x2c, 0xc8, 0x71,
                   0xd,  0x17, 0x84, 0xa4, 0xc4, 0x6e, 0xb0, 0x85, 0xcb, 0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91,
                   0x3a, 0x22, 0xea, 0xfc, 0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3c, 0x6d, 0x39};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb0, 0x85, 0xcb, 0x4a, 0x93, 0x41, 0xf0, 0x4b, 0xb9, 0x6b, 0x91, 0x3a, 0x22,
                              0xea, 0xfc, 0xe2, 0xf8, 0x57, 0x7c, 0xda, 0xb,  0xf8, 0x2a, 0xa,  0x16};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5951);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 29931, _pubBody =
// "\254t\DLE\GS|r\CAN\243)\RS\151\DC4/_\229b\\", _pubProps = [PropRequestProblemInformation
// 181,PropRequestResponseInformation 73,PropReceiveMaximum 30707,PropMessageExpiryInterval
// 19377,PropSessionExpiryInterval 22687,PropServerKeepAlive 23724,PropSharedSubscriptionAvailable
// 139,PropAuthenticationData "\217O<",PropWillDelayInterval 11547,PropContentType "<\fe\147(m]7",PropMaximumQoS
// 198,PropRequestResponseInformation 184,PropRequestResponseInformation 172,PropAssignedClientIdentifier
// "\247\250\229\235_\DLE\190\NAK\165\240\164\222aT\165~](\247",PropAssignedClientIdentifier
// "\185U\164\245\ACKeK\227N\157\166",PropMaximumQoS 191,PropRequestProblemInformation 2,PropContentType
// "\149\149\DC2\244\197\150\252M@\215\180\220_Z\140\&4\236\143CV\188\SYN\166",PropWildcardSubscriptionAvailable
// 154,PropUserProperty "\183\215\247~R0\158\GS\154\&8"
// "\202\181\GS\218\169!sB\248\r\SOF\197\178\246\188ai\252\175\SOJ\248",PropRequestProblemInformation
// 50,PropSubscriptionIdentifier 0,PropMaximumPacketSize 14544,PropAuthenticationData
// "y\135\&3`0\210\216h",PropUserProperty "\246o\197\SUB\228\224\224"
// "n\144)\182\215\251:\SO\189;\144\194\r\190b*\201u\DC4\183\225\160\GS\128",PropWillDelayInterval 15728]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x3c, 0xf0, 0x1,  0x0,  0x0,  0x74, 0xeb, 0xd9, 0x1,  0x17, 0xb5, 0x19, 0x49, 0x21, 0x77, 0xf3, 0x2,  0x0,  0x0,
      0x4b, 0xb1, 0x11, 0x0,  0x0,  0x58, 0x9f, 0x13, 0x5c, 0xac, 0x2a, 0x8b, 0x16, 0x0,  0x3,  0xd9, 0x4f, 0x3c, 0x18,
      0x0,  0x0,  0x2d, 0x1b, 0x3,  0x0,  0x8,  0x3c, 0xc,  0x65, 0x93, 0x28, 0x6d, 0x5d, 0x37, 0x24, 0xc6, 0x19, 0xb8,
      0x19, 0xac, 0x12, 0x0,  0x13, 0xf7, 0xfa, 0xe5, 0xeb, 0x5f, 0x10, 0xbe, 0x15, 0xa5, 0xf0, 0xa4, 0xde, 0x61, 0x54,
      0xa5, 0x7e, 0x5d, 0x28, 0xf7, 0x12, 0x0,  0xb,  0xb9, 0x55, 0xa4, 0xf5, 0x6,  0x65, 0x4b, 0xe3, 0x4e, 0x9d, 0xa6,
      0x24, 0xbf, 0x17, 0x2,  0x3,  0x0,  0x17, 0x95, 0x95, 0x12, 0xf4, 0xc5, 0x96, 0xfc, 0x4d, 0x40, 0xd7, 0xb4, 0xdc,
      0x5f, 0x5a, 0x8c, 0x34, 0xec, 0x8f, 0x43, 0x56, 0xbc, 0x16, 0xa6, 0x28, 0x9a, 0x26, 0x0,  0xa,  0xb7, 0xd7, 0xf7,
      0x7e, 0x52, 0x30, 0x9e, 0x1d, 0x9a, 0x38, 0x0,  0x17, 0xca, 0xb5, 0x1d, 0xda, 0xa9, 0x21, 0x73, 0x42, 0xf8, 0xd,
      0xe,  0x46, 0xc5, 0xb2, 0xf6, 0xbc, 0x61, 0x69, 0xfc, 0xaf, 0xe,  0x4a, 0xf8, 0x17, 0x32, 0xb,  0x0,  0x27, 0x0,
      0x0,  0x38, 0xd0, 0x16, 0x0,  0x8,  0x79, 0x87, 0x33, 0x60, 0x30, 0xd2, 0xd8, 0x68, 0x26, 0x0,  0x7,  0xf6, 0x6f,
      0xc5, 0x1a, 0xe4, 0xe0, 0xe0, 0x0,  0x18, 0x6e, 0x90, 0x29, 0xb6, 0xd7, 0xfb, 0x3a, 0xe,  0xbd, 0x3b, 0x90, 0xc2,
      0xd,  0xbe, 0x62, 0x2a, 0xc9, 0x75, 0x14, 0xb7, 0xe1, 0xa0, 0x1d, 0x80, 0x18, 0x0,  0x0,  0x3d, 0x70, 0xfe, 0x74,
      0x10, 0x1d, 0x7c, 0x72, 0x18, 0xf3, 0x29, 0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfe, 0x74, 0x10, 0x1d, 0x7c, 0x72, 0x18, 0xf3, 0x29,
                         0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0xd9, 0x4f, 0x3c};
  uint8_t bytesprops1[] = {0x3c, 0xc, 0x65, 0x93, 0x28, 0x6d, 0x5d, 0x37};
  uint8_t bytesprops2[] = {0xf7, 0xfa, 0xe5, 0xeb, 0x5f, 0x10, 0xbe, 0x15, 0xa5, 0xf0,
                           0xa4, 0xde, 0x61, 0x54, 0xa5, 0x7e, 0x5d, 0x28, 0xf7};
  uint8_t bytesprops3[] = {0xb9, 0x55, 0xa4, 0xf5, 0x6, 0x65, 0x4b, 0xe3, 0x4e, 0x9d, 0xa6};
  uint8_t bytesprops4[] = {0x95, 0x95, 0x12, 0xf4, 0xc5, 0x96, 0xfc, 0x4d, 0x40, 0xd7, 0xb4, 0xdc,
                           0x5f, 0x5a, 0x8c, 0x34, 0xec, 0x8f, 0x43, 0x56, 0xbc, 0x16, 0xa6};
  uint8_t bytesprops6[] = {0xca, 0xb5, 0x1d, 0xda, 0xa9, 0x21, 0x73, 0x42, 0xf8, 0xd,  0xe, 0x46,
                           0xc5, 0xb2, 0xf6, 0xbc, 0x61, 0x69, 0xfc, 0xaf, 0xe,  0x4a, 0xf8};
  uint8_t bytesprops5[] = {0xb7, 0xd7, 0xf7, 0x7e, 0x52, 0x30, 0x9e, 0x1d, 0x9a, 0x38};
  uint8_t bytesprops7[] = {0x79, 0x87, 0x33, 0x60, 0x30, 0xd2, 0xd8, 0x68};
  uint8_t bytesprops9[] = {0x6e, 0x90, 0x29, 0xb6, 0xd7, 0xfb, 0x3a, 0xe,  0xbd, 0x3b, 0x90, 0xc2,
                           0xd,  0xbe, 0x62, 0x2a, 0xc9, 0x75, 0x14, 0xb7, 0xe1, 0xa0, 0x1d, 0x80};
  uint8_t bytesprops8[] = {0xf6, 0x6f, 0xc5, 0x1a, 0xe4, 0xe0, 0xe0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30707}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19377}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22687}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23724}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11547}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops5}, .v = {23, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14544}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops8}, .v = {24, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15728}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 29931, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 29931, _pubBody =
// "\254t\DLE\GS|r\CAN\243)\RS\151\DC4/_\229b\\", _pubProps = [PropRequestProblemInformation
// 181,PropRequestResponseInformation 73,PropReceiveMaximum 30707,PropMessageExpiryInterval
// 19377,PropSessionExpiryInterval 22687,PropServerKeepAlive 23724,PropSharedSubscriptionAvailable
// 139,PropAuthenticationData "\217O<",PropWillDelayInterval 11547,PropContentType "<\fe\147(m]7",PropMaximumQoS
// 198,PropRequestResponseInformation 184,PropRequestResponseInformation 172,PropAssignedClientIdentifier
// "\247\250\229\235_\DLE\190\NAK\165\240\164\222aT\165~](\247",PropAssignedClientIdentifier
// "\185U\164\245\ACKeK\227N\157\166",PropMaximumQoS 191,PropRequestProblemInformation 2,PropContentType
// "\149\149\DC2\244\197\150\252M@\215\180\220_Z\140\&4\236\143CV\188\SYN\166",PropWildcardSubscriptionAvailable
// 154,PropUserProperty "\183\215\247~R0\158\GS\154\&8"
// "\202\181\GS\218\169!sB\248\r\SOF\197\178\246\188ai\252\175\SOJ\248",PropRequestProblemInformation
// 50,PropSubscriptionIdentifier 0,PropMaximumPacketSize 14544,PropAuthenticationData
// "y\135\&3`0\210\216h",PropUserProperty "\246o\197\SUB\228\224\224"
// "n\144)\182\215\251:\SO\189;\144\194\r\190b*\201u\DC4\183\225\160\GS\128",PropWillDelayInterval 15728]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {
      0x3c, 0xf0, 0x1,  0x0,  0x0,  0x74, 0xeb, 0xd9, 0x1,  0x17, 0xb5, 0x19, 0x49, 0x21, 0x77, 0xf3, 0x2,  0x0,  0x0,
      0x4b, 0xb1, 0x11, 0x0,  0x0,  0x58, 0x9f, 0x13, 0x5c, 0xac, 0x2a, 0x8b, 0x16, 0x0,  0x3,  0xd9, 0x4f, 0x3c, 0x18,
      0x0,  0x0,  0x2d, 0x1b, 0x3,  0x0,  0x8,  0x3c, 0xc,  0x65, 0x93, 0x28, 0x6d, 0x5d, 0x37, 0x24, 0xc6, 0x19, 0xb8,
      0x19, 0xac, 0x12, 0x0,  0x13, 0xf7, 0xfa, 0xe5, 0xeb, 0x5f, 0x10, 0xbe, 0x15, 0xa5, 0xf0, 0xa4, 0xde, 0x61, 0x54,
      0xa5, 0x7e, 0x5d, 0x28, 0xf7, 0x12, 0x0,  0xb,  0xb9, 0x55, 0xa4, 0xf5, 0x6,  0x65, 0x4b, 0xe3, 0x4e, 0x9d, 0xa6,
      0x24, 0xbf, 0x17, 0x2,  0x3,  0x0,  0x17, 0x95, 0x95, 0x12, 0xf4, 0xc5, 0x96, 0xfc, 0x4d, 0x40, 0xd7, 0xb4, 0xdc,
      0x5f, 0x5a, 0x8c, 0x34, 0xec, 0x8f, 0x43, 0x56, 0xbc, 0x16, 0xa6, 0x28, 0x9a, 0x26, 0x0,  0xa,  0xb7, 0xd7, 0xf7,
      0x7e, 0x52, 0x30, 0x9e, 0x1d, 0x9a, 0x38, 0x0,  0x17, 0xca, 0xb5, 0x1d, 0xda, 0xa9, 0x21, 0x73, 0x42, 0xf8, 0xd,
      0xe,  0x46, 0xc5, 0xb2, 0xf6, 0xbc, 0x61, 0x69, 0xfc, 0xaf, 0xe,  0x4a, 0xf8, 0x17, 0x32, 0xb,  0x0,  0x27, 0x0,
      0x0,  0x38, 0xd0, 0x16, 0x0,  0x8,  0x79, 0x87, 0x33, 0x60, 0x30, 0xd2, 0xd8, 0x68, 0x26, 0x0,  0x7,  0xf6, 0x6f,
      0xc5, 0x1a, 0xe4, 0xe0, 0xe0, 0x0,  0x18, 0x6e, 0x90, 0x29, 0xb6, 0xd7, 0xfb, 0x3a, 0xe,  0xbd, 0x3b, 0x90, 0xc2,
      0xd,  0xbe, 0x62, 0x2a, 0xc9, 0x75, 0x14, 0xb7, 0xe1, 0xa0, 0x1d, 0x80, 0x18, 0x0,  0x0,  0x3d, 0x70, 0xfe, 0x74,
      0x10, 0x1d, 0x7c, 0x72, 0x18, 0xf3, 0x29, 0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfe, 0x74, 0x10, 0x1d, 0x7c, 0x72, 0x18, 0xf3, 0x29,
                              0x1e, 0x97, 0x14, 0x2f, 0x5f, 0xe5, 0x62, 0x5c};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 29931);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\128\158-GrC\129\166\140\231\NULj!M4\SUB", _pubPktID = 0, _pubBody =
// "\228\ESC\231\DC3\136\217\177W_\ESCp\130\DC2\212,\158\236\215\204\207m\205", _pubProps =
// [PropRequestProblemInformation 64,PropAuthenticationData
// "\133\236\132T\RS\149\164\140f\220\200\200",PropServerReference "\138s\200\181\144r\224\190C+;",PropContentType
// "\t\153\142ji\206\236\156$*\136\DC4\n\202(\172xCXc\204",PropMaximumQoS 114,PropRetainAvailable
// 94,PropSessionExpiryInterval 24598,PropAssignedClientIdentifier
// "`\202\237]t\131\179M\226\218\250\160)\227\167\&0\154\n\DC2]\DLE\US\150?\234B\239\139\242",PropWillDelayInterval
// 28070,PropSessionExpiryInterval 12851,PropMaximumQoS 89,PropRequestResponseInformation 13,PropTopicAlias
// 13547,PropSessionExpiryInterval 10014,PropSessionExpiryInterval 19691,PropAuthenticationMethod
// "\198<\129\214\246",PropSessionExpiryInterval 12398,PropMessageExpiryInterval 29590,PropRequestProblemInformation
// 102,PropServerKeepAlive 12804,PropSubscriptionIdentifierAvailable 177,PropServerReference "\175",PropServerKeepAlive
// 16845]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x31, 0xc5, 0x1,  0x0,  0x10, 0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6, 0x8c, 0xe7, 0x0,  0x6a,
                   0x21, 0x4d, 0x34, 0x1a, 0x9b, 0x1,  0x17, 0x40, 0x16, 0x0,  0xc,  0x85, 0xec, 0x84, 0x54, 0x1e, 0x95,
                   0xa4, 0x8c, 0x66, 0xdc, 0xc8, 0xc8, 0x1c, 0x0,  0xb,  0x8a, 0x73, 0xc8, 0xb5, 0x90, 0x72, 0xe0, 0xbe,
                   0x43, 0x2b, 0x3b, 0x3,  0x0,  0x15, 0x9,  0x99, 0x8e, 0x6a, 0x69, 0xce, 0xec, 0x9c, 0x24, 0x2a, 0x88,
                   0x14, 0xa,  0xca, 0x28, 0xac, 0x78, 0x43, 0x58, 0x63, 0xcc, 0x24, 0x72, 0x25, 0x5e, 0x11, 0x0,  0x0,
                   0x60, 0x16, 0x12, 0x0,  0x1d, 0x60, 0xca, 0xed, 0x5d, 0x74, 0x83, 0xb3, 0x4d, 0xe2, 0xda, 0xfa, 0xa0,
                   0x29, 0xe3, 0xa7, 0x30, 0x9a, 0xa,  0x12, 0x5d, 0x10, 0x1f, 0x96, 0x3f, 0xea, 0x42, 0xef, 0x8b, 0xf2,
                   0x18, 0x0,  0x0,  0x6d, 0xa6, 0x11, 0x0,  0x0,  0x32, 0x33, 0x24, 0x59, 0x19, 0xd,  0x23, 0x34, 0xeb,
                   0x11, 0x0,  0x0,  0x27, 0x1e, 0x11, 0x0,  0x0,  0x4c, 0xeb, 0x15, 0x0,  0x5,  0xc6, 0x3c, 0x81, 0xd6,
                   0xf6, 0x11, 0x0,  0x0,  0x30, 0x6e, 0x2,  0x0,  0x0,  0x73, 0x96, 0x17, 0x66, 0x13, 0x32, 0x4,  0x29,
                   0xb1, 0x1c, 0x0,  0x1,  0xaf, 0x13, 0x41, 0xcd, 0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57, 0x5f,
                   0x1b, 0x70, 0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  uint8_t topic_bytes[] = {0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6,
                           0x8c, 0xe7, 0x0,  0x6a, 0x21, 0x4d, 0x34, 0x1a};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57, 0x5f, 0x1b, 0x70,
                         0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0x85, 0xec, 0x84, 0x54, 0x1e, 0x95, 0xa4, 0x8c, 0x66, 0xdc, 0xc8, 0xc8};
  uint8_t bytesprops1[] = {0x8a, 0x73, 0xc8, 0xb5, 0x90, 0x72, 0xe0, 0xbe, 0x43, 0x2b, 0x3b};
  uint8_t bytesprops2[] = {0x9,  0x99, 0x8e, 0x6a, 0x69, 0xce, 0xec, 0x9c, 0x24, 0x2a, 0x88,
                           0x14, 0xa,  0xca, 0x28, 0xac, 0x78, 0x43, 0x58, 0x63, 0xcc};
  uint8_t bytesprops3[] = {0x60, 0xca, 0xed, 0x5d, 0x74, 0x83, 0xb3, 0x4d, 0xe2, 0xda, 0xfa, 0xa0, 0x29, 0xe3, 0xa7,
                           0x30, 0x9a, 0xa,  0x12, 0x5d, 0x10, 0x1f, 0x96, 0x3f, 0xea, 0x42, 0xef, 0x8b, 0xf2};
  uint8_t bytesprops4[] = {0xc6, 0x3c, 0x81, 0xd6, 0xf6};
  uint8_t bytesprops5[] = {0xaf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24598}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28070}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12851}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13547}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10014}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19691}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12398}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29590}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12804}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16845}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\128\158-GrC\129\166\140\231\NULj!M4\SUB", _pubPktID = 0, _pubBody =
// "\228\ESC\231\DC3\136\217\177W_\ESCp\130\DC2\212,\158\236\215\204\207m\205", _pubProps =
// [PropRequestProblemInformation 64,PropAuthenticationData
// "\133\236\132T\RS\149\164\140f\220\200\200",PropServerReference "\138s\200\181\144r\224\190C+;",PropContentType
// "\t\153\142ji\206\236\156$*\136\DC4\n\202(\172xCXc\204",PropMaximumQoS 114,PropRetainAvailable
// 94,PropSessionExpiryInterval 24598,PropAssignedClientIdentifier
// "`\202\237]t\131\179M\226\218\250\160)\227\167\&0\154\n\DC2]\DLE\US\150?\234B\239\139\242",PropWillDelayInterval
// 28070,PropSessionExpiryInterval 12851,PropMaximumQoS 89,PropRequestResponseInformation 13,PropTopicAlias
// 13547,PropSessionExpiryInterval 10014,PropSessionExpiryInterval 19691,PropAuthenticationMethod
// "\198<\129\214\246",PropSessionExpiryInterval 12398,PropMessageExpiryInterval 29590,PropRequestProblemInformation
// 102,PropServerKeepAlive 12804,PropSubscriptionIdentifierAvailable 177,PropServerReference "\175",PropServerKeepAlive
// 16845]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {0x31, 0xc5, 0x1,  0x0,  0x10, 0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6, 0x8c, 0xe7, 0x0,  0x6a,
                   0x21, 0x4d, 0x34, 0x1a, 0x9b, 0x1,  0x17, 0x40, 0x16, 0x0,  0xc,  0x85, 0xec, 0x84, 0x54, 0x1e, 0x95,
                   0xa4, 0x8c, 0x66, 0xdc, 0xc8, 0xc8, 0x1c, 0x0,  0xb,  0x8a, 0x73, 0xc8, 0xb5, 0x90, 0x72, 0xe0, 0xbe,
                   0x43, 0x2b, 0x3b, 0x3,  0x0,  0x15, 0x9,  0x99, 0x8e, 0x6a, 0x69, 0xce, 0xec, 0x9c, 0x24, 0x2a, 0x88,
                   0x14, 0xa,  0xca, 0x28, 0xac, 0x78, 0x43, 0x58, 0x63, 0xcc, 0x24, 0x72, 0x25, 0x5e, 0x11, 0x0,  0x0,
                   0x60, 0x16, 0x12, 0x0,  0x1d, 0x60, 0xca, 0xed, 0x5d, 0x74, 0x83, 0xb3, 0x4d, 0xe2, 0xda, 0xfa, 0xa0,
                   0x29, 0xe3, 0xa7, 0x30, 0x9a, 0xa,  0x12, 0x5d, 0x10, 0x1f, 0x96, 0x3f, 0xea, 0x42, 0xef, 0x8b, 0xf2,
                   0x18, 0x0,  0x0,  0x6d, 0xa6, 0x11, 0x0,  0x0,  0x32, 0x33, 0x24, 0x59, 0x19, 0xd,  0x23, 0x34, 0xeb,
                   0x11, 0x0,  0x0,  0x27, 0x1e, 0x11, 0x0,  0x0,  0x4c, 0xeb, 0x15, 0x0,  0x5,  0xc6, 0x3c, 0x81, 0xd6,
                   0xf6, 0x11, 0x0,  0x0,  0x30, 0x6e, 0x2,  0x0,  0x0,  0x73, 0x96, 0x17, 0x66, 0x13, 0x32, 0x4,  0x29,
                   0xb1, 0x1c, 0x0,  0x1,  0xaf, 0x13, 0x41, 0xcd, 0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57, 0x5f,
                   0x1b, 0x70, 0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x80, 0x9e, 0x2d, 0x47, 0x72, 0x43, 0x81, 0xa6,
                               0x8c, 0xe7, 0x0,  0x6a, 0x21, 0x4d, 0x34, 0x1a};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe4, 0x1b, 0xe7, 0x13, 0x88, 0xd9, 0xb1, 0x57, 0x5f, 0x1b, 0x70,
                              0x82, 0x12, 0xd4, 0x2c, 0x9e, 0xec, 0xd7, 0xcc, 0xcf, 0x6d, 0xcd};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "s\233\140\183\209=t\220\206\194\143\249\ETX\234\&5\b\144\f\246\250\US\193\193\178\226\201\156", _pubPktID = 8248,
// _pubBody = "v\196\240]\193r\165~\158\205\155'\206\&8\215s\248\196\250\&1\247", _pubProps =
// [PropWildcardSubscriptionAvailable 105,PropUserProperty "w\143\189\202"
// ")|\ENQ`\155\193\250\159\177\170\174K\SI\147\200g\246\177",PropResponseInformation
// "\163\145C\159Hw6\169\\\132G`_;d\v\206\135xsk",PropSessionExpiryInterval 9513,PropMessageExpiryInterval
// 2757,PropAuthenticationData
// "\128q1v\189\\=\215\166Ym\186\205\223\204m\237\255\146\215\198ef\218d\187\170\207\198",PropTopicAlias
// 16031,PropServerKeepAlive 8395,PropSessionExpiryInterval 13943,PropReceiveMaximum
// 28503,PropRequestResponseInformation 118,PropResponseTopic "$\187",PropServerReference
// "r\178\201\CAN\197\227U\132\210\178\b\223",PropSharedSubscriptionAvailable 190,PropRequestProblemInformation
// 186,PropMaximumQoS 207]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x34, 0xbf, 0x1,  0x0,  0x1b, 0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2, 0x8f, 0xf9,
                   0x3,  0xea, 0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2, 0xe2, 0xc9, 0x9c, 0x20, 0x38,
                   0x89, 0x1,  0x28, 0x69, 0x26, 0x0,  0x4,  0x77, 0x8f, 0xbd, 0xca, 0x0,  0x12, 0x29, 0x7c, 0x5,  0x60,
                   0x9b, 0xc1, 0xfa, 0x9f, 0xb1, 0xaa, 0xae, 0x4b, 0xf,  0x93, 0xc8, 0x67, 0xf6, 0xb1, 0x1a, 0x0,  0x15,
                   0xa3, 0x91, 0x43, 0x9f, 0x48, 0x77, 0x36, 0xa9, 0x5c, 0x84, 0x47, 0x60, 0x5f, 0x3b, 0x64, 0xb,  0xce,
                   0x87, 0x78, 0x73, 0x6b, 0x11, 0x0,  0x0,  0x25, 0x29, 0x2,  0x0,  0x0,  0xa,  0xc5, 0x16, 0x0,  0x1d,
                   0x80, 0x71, 0x31, 0x76, 0xbd, 0x5c, 0x3d, 0xd7, 0xa6, 0x59, 0x6d, 0xba, 0xcd, 0xdf, 0xcc, 0x6d, 0xed,
                   0xff, 0x92, 0xd7, 0xc6, 0x65, 0x66, 0xda, 0x64, 0xbb, 0xaa, 0xcf, 0xc6, 0x23, 0x3e, 0x9f, 0x13, 0x20,
                   0xcb, 0x11, 0x0,  0x0,  0x36, 0x77, 0x21, 0x6f, 0x57, 0x19, 0x76, 0x8,  0x0,  0x2,  0x24, 0xbb, 0x1c,
                   0x0,  0xc,  0x72, 0xb2, 0xc9, 0x18, 0xc5, 0xe3, 0x55, 0x84, 0xd2, 0xb2, 0x8,  0xdf, 0x2a, 0xbe, 0x17,
                   0xba, 0x24, 0xcf, 0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e, 0xcd, 0x9b, 0x27, 0xce, 0x38,
                   0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  uint8_t topic_bytes[] = {0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2, 0x8f, 0xf9, 0x3, 0xea,
                           0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2, 0xe2, 0xc9, 0x9c};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e, 0xcd, 0x9b,
                         0x27, 0xce, 0x38, 0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops1[] = {0x29, 0x7c, 0x5,  0x60, 0x9b, 0xc1, 0xfa, 0x9f, 0xb1,
                           0xaa, 0xae, 0x4b, 0xf,  0x93, 0xc8, 0x67, 0xf6, 0xb1};
  uint8_t bytesprops0[] = {0x77, 0x8f, 0xbd, 0xca};
  uint8_t bytesprops2[] = {0xa3, 0x91, 0x43, 0x9f, 0x48, 0x77, 0x36, 0xa9, 0x5c, 0x84, 0x47,
                           0x60, 0x5f, 0x3b, 0x64, 0xb,  0xce, 0x87, 0x78, 0x73, 0x6b};
  uint8_t bytesprops3[] = {0x80, 0x71, 0x31, 0x76, 0xbd, 0x5c, 0x3d, 0xd7, 0xa6, 0x59, 0x6d, 0xba, 0xcd, 0xdf, 0xcc,
                           0x6d, 0xed, 0xff, 0x92, 0xd7, 0xc6, 0x65, 0x66, 0xda, 0x64, 0xbb, 0xaa, 0xcf, 0xc6};
  uint8_t bytesprops4[] = {0x24, 0xbb};
  uint8_t bytesprops5[] = {0x72, 0xb2, 0xc9, 0x18, 0xc5, 0xe3, 0x55, 0x84, 0xd2, 0xb2, 0x8, 0xdf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops0}, .v = {18, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9513}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2757}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16031}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8395}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13943}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28503}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 207}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 8248, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "s\233\140\183\209=t\220\206\194\143\249\ETX\234\&5\b\144\f\246\250\US\193\193\178\226\201\156", _pubPktID = 8248,
// _pubBody = "v\196\240]\193r\165~\158\205\155'\206\&8\215s\248\196\250\&1\247", _pubProps =
// [PropWildcardSubscriptionAvailable 105,PropUserProperty "w\143\189\202"
// ")|\ENQ`\155\193\250\159\177\170\174K\SI\147\200g\246\177",PropResponseInformation
// "\163\145C\159Hw6\169\\\132G`_;d\v\206\135xsk",PropSessionExpiryInterval 9513,PropMessageExpiryInterval
// 2757,PropAuthenticationData
// "\128q1v\189\\=\215\166Ym\186\205\223\204m\237\255\146\215\198ef\218d\187\170\207\198",PropTopicAlias
// 16031,PropServerKeepAlive 8395,PropSessionExpiryInterval 13943,PropReceiveMaximum
// 28503,PropRequestResponseInformation 118,PropResponseTopic "$\187",PropServerReference
// "r\178\201\CAN\197\227U\132\210\178\b\223",PropSharedSubscriptionAvailable 190,PropRequestProblemInformation
// 186,PropMaximumQoS 207]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {0x34, 0xbf, 0x1,  0x0,  0x1b, 0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2, 0x8f, 0xf9,
                   0x3,  0xea, 0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2, 0xe2, 0xc9, 0x9c, 0x20, 0x38,
                   0x89, 0x1,  0x28, 0x69, 0x26, 0x0,  0x4,  0x77, 0x8f, 0xbd, 0xca, 0x0,  0x12, 0x29, 0x7c, 0x5,  0x60,
                   0x9b, 0xc1, 0xfa, 0x9f, 0xb1, 0xaa, 0xae, 0x4b, 0xf,  0x93, 0xc8, 0x67, 0xf6, 0xb1, 0x1a, 0x0,  0x15,
                   0xa3, 0x91, 0x43, 0x9f, 0x48, 0x77, 0x36, 0xa9, 0x5c, 0x84, 0x47, 0x60, 0x5f, 0x3b, 0x64, 0xb,  0xce,
                   0x87, 0x78, 0x73, 0x6b, 0x11, 0x0,  0x0,  0x25, 0x29, 0x2,  0x0,  0x0,  0xa,  0xc5, 0x16, 0x0,  0x1d,
                   0x80, 0x71, 0x31, 0x76, 0xbd, 0x5c, 0x3d, 0xd7, 0xa6, 0x59, 0x6d, 0xba, 0xcd, 0xdf, 0xcc, 0x6d, 0xed,
                   0xff, 0x92, 0xd7, 0xc6, 0x65, 0x66, 0xda, 0x64, 0xbb, 0xaa, 0xcf, 0xc6, 0x23, 0x3e, 0x9f, 0x13, 0x20,
                   0xcb, 0x11, 0x0,  0x0,  0x36, 0x77, 0x21, 0x6f, 0x57, 0x19, 0x76, 0x8,  0x0,  0x2,  0x24, 0xbb, 0x1c,
                   0x0,  0xc,  0x72, 0xb2, 0xc9, 0x18, 0xc5, 0xe3, 0x55, 0x84, 0xd2, 0xb2, 0x8,  0xdf, 0x2a, 0xbe, 0x17,
                   0xba, 0x24, 0xcf, 0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e, 0xcd, 0x9b, 0x27, 0xce, 0x38,
                   0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x73, 0xe9, 0x8c, 0xb7, 0xd1, 0x3d, 0x74, 0xdc, 0xce, 0xc2, 0x8f, 0xf9, 0x3, 0xea,
                               0x35, 0x8,  0x90, 0xc,  0xf6, 0xfa, 0x1f, 0xc1, 0xc1, 0xb2, 0xe2, 0xc9, 0x9c};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x76, 0xc4, 0xf0, 0x5d, 0xc1, 0x72, 0xa5, 0x7e, 0x9e, 0xcd, 0x9b,
                              0x27, 0xce, 0x38, 0xd7, 0x73, 0xf8, 0xc4, 0xfa, 0x31, 0xf7};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8248);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\146;?\158\252\\a5\133\233\144\&9O\159\231\133\240}\DC1\200\&9\154a%\176Y", _pubPktID = 0, _pubBody =
// "\173\221\&2\157\129qMv\218\&6\216\165J\tp\242\205\&2\194t\243\161\STX?", _pubProps =
// [PropWildcardSubscriptionAvailable 100,PropSharedSubscriptionAvailable 223,PropTopicAlias 20373,PropMaximumPacketSize
// 5572,PropSessionExpiryInterval 738,PropReceiveMaximum 29296,PropWildcardSubscriptionAvailable
// 214,PropSharedSubscriptionAvailable 228,PropSubscriptionIdentifier 0,PropAuthenticationData
// "\236\161\148?\223\SI\130#I",PropSubscriptionIdentifier 17,PropMaximumQoS 12,PropServerKeepAlive 1836,PropContentType
// "Y\170\163\218\n\143\197\168\143\229\156Ja\129\214\"$v\216",PropWillDelayInterval 30892]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x39, 0x7d, 0x0,  0x1a, 0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9, 0x90, 0x39,
                   0x4f, 0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25, 0xb0, 0x59, 0x48, 0x28,
                   0x64, 0x2a, 0xdf, 0x23, 0x4f, 0x95, 0x27, 0x0,  0x0,  0x15, 0xc4, 0x11, 0x0,  0x0,  0x2,  0xe2,
                   0x21, 0x72, 0x70, 0x28, 0xd6, 0x2a, 0xe4, 0xb,  0x0,  0x16, 0x0,  0x9,  0xec, 0xa1, 0x94, 0x3f,
                   0xdf, 0xf,  0x82, 0x23, 0x49, 0xb,  0x11, 0x24, 0xc,  0x13, 0x7,  0x2c, 0x3,  0x0,  0x13, 0x59,
                   0xaa, 0xa3, 0xda, 0xa,  0x8f, 0xc5, 0xa8, 0x8f, 0xe5, 0x9c, 0x4a, 0x61, 0x81, 0xd6, 0x22, 0x24,
                   0x76, 0xd8, 0x18, 0x0,  0x0,  0x78, 0xac, 0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda,
                   0x36, 0xd8, 0xa5, 0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  uint8_t topic_bytes[] = {0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9, 0x90, 0x39, 0x4f,
                           0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25, 0xb0, 0x59};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda, 0x36, 0xd8, 0xa5,
                         0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0xec, 0xa1, 0x94, 0x3f, 0xdf, 0xf, 0x82, 0x23, 0x49};
  uint8_t bytesprops1[] = {0x59, 0xaa, 0xa3, 0xda, 0xa,  0x8f, 0xc5, 0xa8, 0x8f, 0xe5,
                           0x9c, 0x4a, 0x61, 0x81, 0xd6, 0x22, 0x24, 0x76, 0xd8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20373}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5572}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 738}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29296}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1836}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30892}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\146;?\158\252\\a5\133\233\144\&9O\159\231\133\240}\DC1\200\&9\154a%\176Y", _pubPktID = 0, _pubBody =
// "\173\221\&2\157\129qMv\218\&6\216\165J\tp\242\205\&2\194t\243\161\STX?", _pubProps =
// [PropWildcardSubscriptionAvailable 100,PropSharedSubscriptionAvailable 223,PropTopicAlias 20373,PropMaximumPacketSize
// 5572,PropSessionExpiryInterval 738,PropReceiveMaximum 29296,PropWildcardSubscriptionAvailable
// 214,PropSharedSubscriptionAvailable 228,PropSubscriptionIdentifier 0,PropAuthenticationData
// "\236\161\148?\223\SI\130#I",PropSubscriptionIdentifier 17,PropMaximumQoS 12,PropServerKeepAlive 1836,PropContentType
// "Y\170\163\218\n\143\197\168\143\229\156Ja\129\214\"$v\216",PropWillDelayInterval 30892]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {0x39, 0x7d, 0x0,  0x1a, 0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9, 0x90, 0x39,
                   0x4f, 0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25, 0xb0, 0x59, 0x48, 0x28,
                   0x64, 0x2a, 0xdf, 0x23, 0x4f, 0x95, 0x27, 0x0,  0x0,  0x15, 0xc4, 0x11, 0x0,  0x0,  0x2,  0xe2,
                   0x21, 0x72, 0x70, 0x28, 0xd6, 0x2a, 0xe4, 0xb,  0x0,  0x16, 0x0,  0x9,  0xec, 0xa1, 0x94, 0x3f,
                   0xdf, 0xf,  0x82, 0x23, 0x49, 0xb,  0x11, 0x24, 0xc,  0x13, 0x7,  0x2c, 0x3,  0x0,  0x13, 0x59,
                   0xaa, 0xa3, 0xda, 0xa,  0x8f, 0xc5, 0xa8, 0x8f, 0xe5, 0x9c, 0x4a, 0x61, 0x81, 0xd6, 0x22, 0x24,
                   0x76, 0xd8, 0x18, 0x0,  0x0,  0x78, 0xac, 0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda,
                   0x36, 0xd8, 0xa5, 0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x92, 0x3b, 0x3f, 0x9e, 0xfc, 0x5c, 0x61, 0x35, 0x85, 0xe9, 0x90, 0x39, 0x4f,
                               0x9f, 0xe7, 0x85, 0xf0, 0x7d, 0x11, 0xc8, 0x39, 0x9a, 0x61, 0x25, 0xb0, 0x59};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xad, 0xdd, 0x32, 0x9d, 0x81, 0x71, 0x4d, 0x76, 0xda, 0x36, 0xd8, 0xa5,
                              0x4a, 0x9,  0x70, 0xf2, 0xcd, 0x32, 0xc2, 0x74, 0xf3, 0xa1, 0x2,  0x3f};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "?X\254\SIJ/\199\240\153I\171-\227\213\191\205\b\202\247\252\a\196\136\150\215K\\R", _pubPktID = 0, _pubBody =
// "\167\192W\238\177\207\SO\148\212\134\&6\145\223N\168", _pubProps = [PropMaximumPacketSize
// 23071,PropSessionExpiryInterval 11860,PropRequestResponseInformation 15,PropCorrelationData
// "\SYN",PropTopicAliasMaximum 12529,PropAssignedClientIdentifier "C",PropWillDelayInterval
// 30896,PropSubscriptionIdentifier 30,PropReceiveMaximum 4366,PropCorrelationData "\221",PropMaximumQoS
// 167,PropRequestProblemInformation 224,PropContentType
// "\148\196\176\241\190\170\&7W\182\250\168\GS\226\169\206\233\SIkrvq",PropAssignedClientIdentifier
// "\178\162|J\232\216\158\186\133\ENQ\234w",PropServerKeepAlive 7326,PropResponseInformation
// "\176\251\199\&7F&\234\137\129\248\n\209&\194\161d\221{\158\156\164",PropCorrelationData
// "\244\255\209\153\183\DC1N\168",PropMaximumQoS 49,PropRetainAvailable 71,PropTopicAliasMaximum 7503]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {0x31, 0xab, 0x1,  0x0,  0x1c, 0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab,
                   0x2d, 0xe3, 0xd5, 0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c,
                   0x52, 0x7d, 0x27, 0x0,  0x0,  0x5a, 0x1f, 0x11, 0x0,  0x0,  0x2e, 0x54, 0x19, 0xf,  0x9,  0x0,
                   0x1,  0x16, 0x22, 0x30, 0xf1, 0x12, 0x0,  0x1,  0x43, 0x18, 0x0,  0x0,  0x78, 0xb0, 0xb,  0x1e,
                   0x21, 0x11, 0xe,  0x9,  0x0,  0x1,  0xdd, 0x24, 0xa7, 0x17, 0xe0, 0x3,  0x0,  0x15, 0x94, 0xc4,
                   0xb0, 0xf1, 0xbe, 0xaa, 0x37, 0x57, 0xb6, 0xfa, 0xa8, 0x1d, 0xe2, 0xa9, 0xce, 0xe9, 0xf,  0x6b,
                   0x72, 0x76, 0x71, 0x12, 0x0,  0xc,  0xb2, 0xa2, 0x7c, 0x4a, 0xe8, 0xd8, 0x9e, 0xba, 0x85, 0x5,
                   0xea, 0x77, 0x13, 0x1c, 0x9e, 0x1a, 0x0,  0x15, 0xb0, 0xfb, 0xc7, 0x37, 0x46, 0x26, 0xea, 0x89,
                   0x81, 0xf8, 0xa,  0xd1, 0x26, 0xc2, 0xa1, 0x64, 0xdd, 0x7b, 0x9e, 0x9c, 0xa4, 0x9,  0x0,  0x8,
                   0xf4, 0xff, 0xd1, 0x99, 0xb7, 0x11, 0x4e, 0xa8, 0x24, 0x31, 0x25, 0x47, 0x22, 0x1d, 0x4f, 0xa7,
                   0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe,  0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  uint8_t topic_bytes[] = {0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab, 0x2d, 0xe3, 0xd5,
                           0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c, 0x52};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa7, 0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe, 0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x16};
  uint8_t bytesprops1[] = {0x43};
  uint8_t bytesprops2[] = {0xdd};
  uint8_t bytesprops3[] = {0x94, 0xc4, 0xb0, 0xf1, 0xbe, 0xaa, 0x37, 0x57, 0xb6, 0xfa, 0xa8,
                           0x1d, 0xe2, 0xa9, 0xce, 0xe9, 0xf,  0x6b, 0x72, 0x76, 0x71};
  uint8_t bytesprops4[] = {0xb2, 0xa2, 0x7c, 0x4a, 0xe8, 0xd8, 0x9e, 0xba, 0x85, 0x5, 0xea, 0x77};
  uint8_t bytesprops5[] = {0xb0, 0xfb, 0xc7, 0x37, 0x46, 0x26, 0xea, 0x89, 0x81, 0xf8, 0xa,
                           0xd1, 0x26, 0xc2, 0xa1, 0x64, 0xdd, 0x7b, 0x9e, 0x9c, 0xa4};
  uint8_t bytesprops6[] = {0xf4, 0xff, 0xd1, 0x99, 0xb7, 0x11, 0x4e, 0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23071}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11860}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12529}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30896}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4366}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7326}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7503}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "?X\254\SIJ/\199\240\153I\171-\227\213\191\205\b\202\247\252\a\196\136\150\215K\\R", _pubPktID = 0, _pubBody =
// "\167\192W\238\177\207\SO\148\212\134\&6\145\223N\168", _pubProps = [PropMaximumPacketSize
// 23071,PropSessionExpiryInterval 11860,PropRequestResponseInformation 15,PropCorrelationData
// "\SYN",PropTopicAliasMaximum 12529,PropAssignedClientIdentifier "C",PropWillDelayInterval
// 30896,PropSubscriptionIdentifier 30,PropReceiveMaximum 4366,PropCorrelationData "\221",PropMaximumQoS
// 167,PropRequestProblemInformation 224,PropContentType
// "\148\196\176\241\190\170\&7W\182\250\168\GS\226\169\206\233\SIkrvq",PropAssignedClientIdentifier
// "\178\162|J\232\216\158\186\133\ENQ\234w",PropServerKeepAlive 7326,PropResponseInformation
// "\176\251\199\&7F&\234\137\129\248\n\209&\194\161d\221{\158\156\164",PropCorrelationData
// "\244\255\209\153\183\DC1N\168",PropMaximumQoS 49,PropRetainAvailable 71,PropTopicAliasMaximum 7503]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {0x31, 0xab, 0x1,  0x0,  0x1c, 0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab,
                   0x2d, 0xe3, 0xd5, 0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c,
                   0x52, 0x7d, 0x27, 0x0,  0x0,  0x5a, 0x1f, 0x11, 0x0,  0x0,  0x2e, 0x54, 0x19, 0xf,  0x9,  0x0,
                   0x1,  0x16, 0x22, 0x30, 0xf1, 0x12, 0x0,  0x1,  0x43, 0x18, 0x0,  0x0,  0x78, 0xb0, 0xb,  0x1e,
                   0x21, 0x11, 0xe,  0x9,  0x0,  0x1,  0xdd, 0x24, 0xa7, 0x17, 0xe0, 0x3,  0x0,  0x15, 0x94, 0xc4,
                   0xb0, 0xf1, 0xbe, 0xaa, 0x37, 0x57, 0xb6, 0xfa, 0xa8, 0x1d, 0xe2, 0xa9, 0xce, 0xe9, 0xf,  0x6b,
                   0x72, 0x76, 0x71, 0x12, 0x0,  0xc,  0xb2, 0xa2, 0x7c, 0x4a, 0xe8, 0xd8, 0x9e, 0xba, 0x85, 0x5,
                   0xea, 0x77, 0x13, 0x1c, 0x9e, 0x1a, 0x0,  0x15, 0xb0, 0xfb, 0xc7, 0x37, 0x46, 0x26, 0xea, 0x89,
                   0x81, 0xf8, 0xa,  0xd1, 0x26, 0xc2, 0xa1, 0x64, 0xdd, 0x7b, 0x9e, 0x9c, 0xa4, 0x9,  0x0,  0x8,
                   0xf4, 0xff, 0xd1, 0x99, 0xb7, 0x11, 0x4e, 0xa8, 0x24, 0x31, 0x25, 0x47, 0x22, 0x1d, 0x4f, 0xa7,
                   0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe,  0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3f, 0x58, 0xfe, 0xf,  0x4a, 0x2f, 0xc7, 0xf0, 0x99, 0x49, 0xab, 0x2d, 0xe3, 0xd5,
                               0xbf, 0xcd, 0x8,  0xca, 0xf7, 0xfc, 0x7,  0xc4, 0x88, 0x96, 0xd7, 0x4b, 0x5c, 0x52};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa7, 0xc0, 0x57, 0xee, 0xb1, 0xcf, 0xe, 0x94, 0xd4, 0x86, 0x36, 0x91, 0xdf, 0x4e, 0xa8};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\144\167\130\179A", _pubPktID = 0,
// _pubBody = "\148\134\185\213\184\233\187\157\198\233\181\148_\215\n$@\169\251\210\184\f", _pubProps =
// [PropAuthenticationMethod
// "|\143q\195\251M\191\232h\177P\223+GO\216\205\SOHt\NUL\195\166\215\149\248\DC1\172\175",PropWildcardSubscriptionAvailable
// 110,PropServerKeepAlive 4553,PropUserProperty "\171nt\205N@\181\158\130"
// "\132&\133\171(\158\191\141\134\NUL9~]\166\v\US\175Ke5{z\155\DEL\220Q#\144\210L",PropRequestProblemInformation
// 209,PropMessageExpiryInterval 18135,PropRetainAvailable 50,PropSharedSubscriptionAvailable
// 25,PropRequestResponseInformation 116,PropAssignedClientIdentifier "\222~\174\197]x}\tt",PropAssignedClientIdentifier
// "\254m\222~\246c\236\EMxgc\n\133\DC3\161\215\138\189\196\160\239v\195\214",PropServerReference
// "v\228\245!.}\DC4\234\167y\248\193\145\163\128\133\234\222\154\155'\216\ETX\182\149\196\FS\198$",PropContentType
// "\194\157\134\206L\155\159T\181\225\202\251\165\135\218V/M\SO\\\182\&7\tb\186y",PropServerKeepAlive
// 28713,PropAssignedClientIdentifier
// "\184\NUL\195X\133\147\177JY\136\198\SUB$\231<\SUB\154\166\214\180\193/\FS",PropResponseInformation
// "\157+6\169",PropRequestResponseInformation 231,PropWillDelayInterval 27240,PropMaximumPacketSize
// 2824,PropRequestResponseInformation 113,PropPayloadFormatIndicator 71,PropServerReference
// "!4\CAN\241\142\181j",PropWillDelayInterval 28393,PropResponseInformation "(\174\188e",PropMaximumPacketSize 15079]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {0x38, 0xaf, 0x2,  0x0,  0x5,  0x90, 0xa7, 0x82, 0xb3, 0x41, 0x90, 0x2,  0x15, 0x0,  0x1c, 0x7c, 0x8f,
                   0x71, 0xc3, 0xfb, 0x4d, 0xbf, 0xe8, 0x68, 0xb1, 0x50, 0xdf, 0x2b, 0x47, 0x4f, 0xd8, 0xcd, 0x1,  0x74,
                   0x0,  0xc3, 0xa6, 0xd7, 0x95, 0xf8, 0x11, 0xac, 0xaf, 0x28, 0x6e, 0x13, 0x11, 0xc9, 0x26, 0x0,  0x9,
                   0xab, 0x6e, 0x74, 0xcd, 0x4e, 0x40, 0xb5, 0x9e, 0x82, 0x0,  0x1e, 0x84, 0x26, 0x85, 0xab, 0x28, 0x9e,
                   0xbf, 0x8d, 0x86, 0x0,  0x39, 0x7e, 0x5d, 0xa6, 0xb,  0x1f, 0xaf, 0x4b, 0x65, 0x35, 0x7b, 0x7a, 0x9b,
                   0x7f, 0xdc, 0x51, 0x23, 0x90, 0xd2, 0x4c, 0x17, 0xd1, 0x2,  0x0,  0x0,  0x46, 0xd7, 0x25, 0x32, 0x2a,
                   0x19, 0x19, 0x74, 0x12, 0x0,  0x9,  0xde, 0x7e, 0xae, 0xc5, 0x5d, 0x78, 0x7d, 0x9,  0x74, 0x12, 0x0,
                   0x18, 0xfe, 0x6d, 0xde, 0x7e, 0xf6, 0x63, 0xec, 0x19, 0x78, 0x67, 0x63, 0xa,  0x85, 0x13, 0xa1, 0xd7,
                   0x8a, 0xbd, 0xc4, 0xa0, 0xef, 0x76, 0xc3, 0xd6, 0x1c, 0x0,  0x1d, 0x76, 0xe4, 0xf5, 0x21, 0x2e, 0x7d,
                   0x14, 0xea, 0xa7, 0x79, 0xf8, 0xc1, 0x91, 0xa3, 0x80, 0x85, 0xea, 0xde, 0x9a, 0x9b, 0x27, 0xd8, 0x3,
                   0xb6, 0x95, 0xc4, 0x1c, 0xc6, 0x24, 0x3,  0x0,  0x1a, 0xc2, 0x9d, 0x86, 0xce, 0x4c, 0x9b, 0x9f, 0x54,
                   0xb5, 0xe1, 0xca, 0xfb, 0xa5, 0x87, 0xda, 0x56, 0x2f, 0x4d, 0xe,  0x5c, 0xb6, 0x37, 0x9,  0x62, 0xba,
                   0x79, 0x13, 0x70, 0x29, 0x12, 0x0,  0x17, 0xb8, 0x0,  0xc3, 0x58, 0x85, 0x93, 0xb1, 0x4a, 0x59, 0x88,
                   0xc6, 0x1a, 0x24, 0xe7, 0x3c, 0x1a, 0x9a, 0xa6, 0xd6, 0xb4, 0xc1, 0x2f, 0x1c, 0x1a, 0x0,  0x4,  0x9d,
                   0x2b, 0x36, 0xa9, 0x19, 0xe7, 0x18, 0x0,  0x0,  0x6a, 0x68, 0x27, 0x0,  0x0,  0xb,  0x8,  0x19, 0x71,
                   0x1,  0x47, 0x1c, 0x0,  0x7,  0x21, 0x34, 0x18, 0xf1, 0x8e, 0xb5, 0x6a, 0x18, 0x0,  0x0,  0x6e, 0xe9,
                   0x1a, 0x0,  0x4,  0x28, 0xae, 0xbc, 0x65, 0x27, 0x0,  0x0,  0x3a, 0xe7, 0x94, 0x86, 0xb9, 0xd5, 0xb8,
                   0xe9, 0xbb, 0x9d, 0xc6, 0xe9, 0xb5, 0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  uint8_t topic_bytes[] = {0x90, 0xa7, 0x82, 0xb3, 0x41};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x94, 0x86, 0xb9, 0xd5, 0xb8, 0xe9, 0xbb, 0x9d, 0xc6, 0xe9, 0xb5,
                         0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0x7c, 0x8f, 0x71, 0xc3, 0xfb, 0x4d, 0xbf, 0xe8, 0x68, 0xb1, 0x50, 0xdf, 0x2b, 0x47,
                           0x4f, 0xd8, 0xcd, 0x1,  0x74, 0x0,  0xc3, 0xa6, 0xd7, 0x95, 0xf8, 0x11, 0xac, 0xaf};
  uint8_t bytesprops2[] = {0x84, 0x26, 0x85, 0xab, 0x28, 0x9e, 0xbf, 0x8d, 0x86, 0x0,  0x39, 0x7e, 0x5d, 0xa6, 0xb,
                           0x1f, 0xaf, 0x4b, 0x65, 0x35, 0x7b, 0x7a, 0x9b, 0x7f, 0xdc, 0x51, 0x23, 0x90, 0xd2, 0x4c};
  uint8_t bytesprops1[] = {0xab, 0x6e, 0x74, 0xcd, 0x4e, 0x40, 0xb5, 0x9e, 0x82};
  uint8_t bytesprops3[] = {0xde, 0x7e, 0xae, 0xc5, 0x5d, 0x78, 0x7d, 0x9, 0x74};
  uint8_t bytesprops4[] = {0xfe, 0x6d, 0xde, 0x7e, 0xf6, 0x63, 0xec, 0x19, 0x78, 0x67, 0x63, 0xa,
                           0x85, 0x13, 0xa1, 0xd7, 0x8a, 0xbd, 0xc4, 0xa0, 0xef, 0x76, 0xc3, 0xd6};
  uint8_t bytesprops5[] = {0x76, 0xe4, 0xf5, 0x21, 0x2e, 0x7d, 0x14, 0xea, 0xa7, 0x79, 0xf8, 0xc1, 0x91, 0xa3, 0x80,
                           0x85, 0xea, 0xde, 0x9a, 0x9b, 0x27, 0xd8, 0x3,  0xb6, 0x95, 0xc4, 0x1c, 0xc6, 0x24};
  uint8_t bytesprops6[] = {0xc2, 0x9d, 0x86, 0xce, 0x4c, 0x9b, 0x9f, 0x54, 0xb5, 0xe1, 0xca, 0xfb, 0xa5,
                           0x87, 0xda, 0x56, 0x2f, 0x4d, 0xe,  0x5c, 0xb6, 0x37, 0x9,  0x62, 0xba, 0x79};
  uint8_t bytesprops7[] = {0xb8, 0x0,  0xc3, 0x58, 0x85, 0x93, 0xb1, 0x4a, 0x59, 0x88, 0xc6, 0x1a,
                           0x24, 0xe7, 0x3c, 0x1a, 0x9a, 0xa6, 0xd6, 0xb4, 0xc1, 0x2f, 0x1c};
  uint8_t bytesprops8[] = {0x9d, 0x2b, 0x36, 0xa9};
  uint8_t bytesprops9[] = {0x21, 0x34, 0x18, 0xf1, 0x8e, 0xb5, 0x6a};
  uint8_t bytesprops10[] = {0x28, 0xae, 0xbc, 0x65};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4553}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops1}, .v = {30, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18135}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28713}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27240}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2824}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28393}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15079}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\144\167\130\179A", _pubPktID = 0,
// _pubBody = "\148\134\185\213\184\233\187\157\198\233\181\148_\215\n$@\169\251\210\184\f", _pubProps =
// [PropAuthenticationMethod
// "|\143q\195\251M\191\232h\177P\223+GO\216\205\SOHt\NUL\195\166\215\149\248\DC1\172\175",PropWildcardSubscriptionAvailable
// 110,PropServerKeepAlive 4553,PropUserProperty "\171nt\205N@\181\158\130"
// "\132&\133\171(\158\191\141\134\NUL9~]\166\v\US\175Ke5{z\155\DEL\220Q#\144\210L",PropRequestProblemInformation
// 209,PropMessageExpiryInterval 18135,PropRetainAvailable 50,PropSharedSubscriptionAvailable
// 25,PropRequestResponseInformation 116,PropAssignedClientIdentifier "\222~\174\197]x}\tt",PropAssignedClientIdentifier
// "\254m\222~\246c\236\EMxgc\n\133\DC3\161\215\138\189\196\160\239v\195\214",PropServerReference
// "v\228\245!.}\DC4\234\167y\248\193\145\163\128\133\234\222\154\155'\216\ETX\182\149\196\FS\198$",PropContentType
// "\194\157\134\206L\155\159T\181\225\202\251\165\135\218V/M\SO\\\182\&7\tb\186y",PropServerKeepAlive
// 28713,PropAssignedClientIdentifier
// "\184\NUL\195X\133\147\177JY\136\198\SUB$\231<\SUB\154\166\214\180\193/\FS",PropResponseInformation
// "\157+6\169",PropRequestResponseInformation 231,PropWillDelayInterval 27240,PropMaximumPacketSize
// 2824,PropRequestResponseInformation 113,PropPayloadFormatIndicator 71,PropServerReference
// "!4\CAN\241\142\181j",PropWillDelayInterval 28393,PropResponseInformation "(\174\188e",PropMaximumPacketSize 15079]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {0x38, 0xaf, 0x2,  0x0,  0x5,  0x90, 0xa7, 0x82, 0xb3, 0x41, 0x90, 0x2,  0x15, 0x0,  0x1c, 0x7c, 0x8f,
                   0x71, 0xc3, 0xfb, 0x4d, 0xbf, 0xe8, 0x68, 0xb1, 0x50, 0xdf, 0x2b, 0x47, 0x4f, 0xd8, 0xcd, 0x1,  0x74,
                   0x0,  0xc3, 0xa6, 0xd7, 0x95, 0xf8, 0x11, 0xac, 0xaf, 0x28, 0x6e, 0x13, 0x11, 0xc9, 0x26, 0x0,  0x9,
                   0xab, 0x6e, 0x74, 0xcd, 0x4e, 0x40, 0xb5, 0x9e, 0x82, 0x0,  0x1e, 0x84, 0x26, 0x85, 0xab, 0x28, 0x9e,
                   0xbf, 0x8d, 0x86, 0x0,  0x39, 0x7e, 0x5d, 0xa6, 0xb,  0x1f, 0xaf, 0x4b, 0x65, 0x35, 0x7b, 0x7a, 0x9b,
                   0x7f, 0xdc, 0x51, 0x23, 0x90, 0xd2, 0x4c, 0x17, 0xd1, 0x2,  0x0,  0x0,  0x46, 0xd7, 0x25, 0x32, 0x2a,
                   0x19, 0x19, 0x74, 0x12, 0x0,  0x9,  0xde, 0x7e, 0xae, 0xc5, 0x5d, 0x78, 0x7d, 0x9,  0x74, 0x12, 0x0,
                   0x18, 0xfe, 0x6d, 0xde, 0x7e, 0xf6, 0x63, 0xec, 0x19, 0x78, 0x67, 0x63, 0xa,  0x85, 0x13, 0xa1, 0xd7,
                   0x8a, 0xbd, 0xc4, 0xa0, 0xef, 0x76, 0xc3, 0xd6, 0x1c, 0x0,  0x1d, 0x76, 0xe4, 0xf5, 0x21, 0x2e, 0x7d,
                   0x14, 0xea, 0xa7, 0x79, 0xf8, 0xc1, 0x91, 0xa3, 0x80, 0x85, 0xea, 0xde, 0x9a, 0x9b, 0x27, 0xd8, 0x3,
                   0xb6, 0x95, 0xc4, 0x1c, 0xc6, 0x24, 0x3,  0x0,  0x1a, 0xc2, 0x9d, 0x86, 0xce, 0x4c, 0x9b, 0x9f, 0x54,
                   0xb5, 0xe1, 0xca, 0xfb, 0xa5, 0x87, 0xda, 0x56, 0x2f, 0x4d, 0xe,  0x5c, 0xb6, 0x37, 0x9,  0x62, 0xba,
                   0x79, 0x13, 0x70, 0x29, 0x12, 0x0,  0x17, 0xb8, 0x0,  0xc3, 0x58, 0x85, 0x93, 0xb1, 0x4a, 0x59, 0x88,
                   0xc6, 0x1a, 0x24, 0xe7, 0x3c, 0x1a, 0x9a, 0xa6, 0xd6, 0xb4, 0xc1, 0x2f, 0x1c, 0x1a, 0x0,  0x4,  0x9d,
                   0x2b, 0x36, 0xa9, 0x19, 0xe7, 0x18, 0x0,  0x0,  0x6a, 0x68, 0x27, 0x0,  0x0,  0xb,  0x8,  0x19, 0x71,
                   0x1,  0x47, 0x1c, 0x0,  0x7,  0x21, 0x34, 0x18, 0xf1, 0x8e, 0xb5, 0x6a, 0x18, 0x0,  0x0,  0x6e, 0xe9,
                   0x1a, 0x0,  0x4,  0x28, 0xae, 0xbc, 0x65, 0x27, 0x0,  0x0,  0x3a, 0xe7, 0x94, 0x86, 0xb9, 0xd5, 0xb8,
                   0xe9, 0xbb, 0x9d, 0xc6, 0xe9, 0xb5, 0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x90, 0xa7, 0x82, 0xb3, 0x41};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x94, 0x86, 0xb9, 0xd5, 0xb8, 0xe9, 0xbb, 0x9d, 0xc6, 0xe9, 0xb5,
                              0x94, 0x5f, 0xd7, 0xa,  0x24, 0x40, 0xa9, 0xfb, 0xd2, 0xb8, 0xc};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\187\249\143~(e\135", _pubProps = [PropSubscriptionIdentifier 20,PropUserProperty
// "\147\196\GS\178\rB9Y\145\CAN\135\233\179\rW\206" "\153\161\SUB\158\183;\192\CAN\US",PropAuthenticationData
// "",PropPayloadFormatIndicator 50,PropCorrelationData
// "P\SUB\136\&8\132\234f\SUB\196\232\&0\134\192\160\ETXB@\205\&4b\232\129\218~",PropReceiveMaximum 18515,PropMaximumQoS
// 108,PropTopicAliasMaximum 19988,PropRetainAvailable 87,PropMessageExpiryInterval 13619,PropSessionExpiryInterval
// 14566,PropAuthenticationMethod
// "\SO\222\190\199\&2\241*\185[\130\253%\255B1\131FP\163S\179\SUB\182\180\138\CAN\169",PropResponseTopic
// "\251\240\vp>\CAN,97\189!o\f\148\231",PropSubscriptionIdentifier 18,PropMessageExpiryInterval 21618,PropContentType
// "\172\211&\ESC\156\DEL\218\242\254\150Z\133\165\165\NAK,\182\STX\151H",PropServerReference
// "\220\DC2_\200\153`\227\190\NUL\188\216\143\DC1\214\135\CAN",PropReasonString
// "\130\DC3\149\&9\215\245\254",PropMaximumPacketSize 4301,PropAuthenticationData "\FS?",PropMaximumPacketSize
// 16401,PropRetainAvailable 43,PropServerReference "\"Uz\195\199B\176\226\187\CAN4\186\189\163"]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x39, 0xec, 0x1,  0x0,  0x0,  0xe1, 0x1,  0xb,  0x14, 0x26, 0x0,  0x10, 0x93, 0xc4, 0x1d, 0xb2, 0xd,  0x42, 0x39,
      0x59, 0x91, 0x18, 0x87, 0xe9, 0xb3, 0xd,  0x57, 0xce, 0x0,  0x9,  0x99, 0xa1, 0x1a, 0x9e, 0xb7, 0x3b, 0xc0, 0x18,
      0x1f, 0x16, 0x0,  0x0,  0x1,  0x32, 0x9,  0x0,  0x18, 0x50, 0x1a, 0x88, 0x38, 0x84, 0xea, 0x66, 0x1a, 0xc4, 0xe8,
      0x30, 0x86, 0xc0, 0xa0, 0x3,  0x42, 0x40, 0xcd, 0x34, 0x62, 0xe8, 0x81, 0xda, 0x7e, 0x21, 0x48, 0x53, 0x24, 0x6c,
      0x22, 0x4e, 0x14, 0x25, 0x57, 0x2,  0x0,  0x0,  0x35, 0x33, 0x11, 0x0,  0x0,  0x38, 0xe6, 0x15, 0x0,  0x1b, 0xe,
      0xde, 0xbe, 0xc7, 0x32, 0xf1, 0x2a, 0xb9, 0x5b, 0x82, 0xfd, 0x25, 0xff, 0x42, 0x31, 0x83, 0x46, 0x50, 0xa3, 0x53,
      0xb3, 0x1a, 0xb6, 0xb4, 0x8a, 0x18, 0xa9, 0x8,  0x0,  0xf,  0xfb, 0xf0, 0xb,  0x70, 0x3e, 0x18, 0x2c, 0x39, 0x37,
      0xbd, 0x21, 0x6f, 0xc,  0x94, 0xe7, 0xb,  0x12, 0x2,  0x0,  0x0,  0x54, 0x72, 0x3,  0x0,  0x14, 0xac, 0xd3, 0x26,
      0x1b, 0x9c, 0x7f, 0xda, 0xf2, 0xfe, 0x96, 0x5a, 0x85, 0xa5, 0xa5, 0x15, 0x2c, 0xb6, 0x2,  0x97, 0x48, 0x1c, 0x0,
      0x10, 0xdc, 0x12, 0x5f, 0xc8, 0x99, 0x60, 0xe3, 0xbe, 0x0,  0xbc, 0xd8, 0x8f, 0x11, 0xd6, 0x87, 0x18, 0x1f, 0x0,
      0x7,  0x82, 0x13, 0x95, 0x39, 0xd7, 0xf5, 0xfe, 0x27, 0x0,  0x0,  0x10, 0xcd, 0x16, 0x0,  0x2,  0x1c, 0x3f, 0x27,
      0x0,  0x0,  0x40, 0x11, 0x25, 0x2b, 0x1c, 0x0,  0xe,  0x22, 0x55, 0x7a, 0xc3, 0xc7, 0x42, 0xb0, 0xe2, 0xbb, 0x18,
      0x34, 0xba, 0xbd, 0xa3, 0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops1[] = {0x99, 0xa1, 0x1a, 0x9e, 0xb7, 0x3b, 0xc0, 0x18, 0x1f};
  uint8_t bytesprops0[] = {0x93, 0xc4, 0x1d, 0xb2, 0xd,  0x42, 0x39, 0x59,
                           0x91, 0x18, 0x87, 0xe9, 0xb3, 0xd,  0x57, 0xce};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x50, 0x1a, 0x88, 0x38, 0x84, 0xea, 0x66, 0x1a, 0xc4, 0xe8, 0x30, 0x86,
                           0xc0, 0xa0, 0x3,  0x42, 0x40, 0xcd, 0x34, 0x62, 0xe8, 0x81, 0xda, 0x7e};
  uint8_t bytesprops4[] = {0xe,  0xde, 0xbe, 0xc7, 0x32, 0xf1, 0x2a, 0xb9, 0x5b, 0x82, 0xfd, 0x25, 0xff, 0x42,
                           0x31, 0x83, 0x46, 0x50, 0xa3, 0x53, 0xb3, 0x1a, 0xb6, 0xb4, 0x8a, 0x18, 0xa9};
  uint8_t bytesprops5[] = {0xfb, 0xf0, 0xb, 0x70, 0x3e, 0x18, 0x2c, 0x39, 0x37, 0xbd, 0x21, 0x6f, 0xc, 0x94, 0xe7};
  uint8_t bytesprops6[] = {0xac, 0xd3, 0x26, 0x1b, 0x9c, 0x7f, 0xda, 0xf2, 0xfe, 0x96,
                           0x5a, 0x85, 0xa5, 0xa5, 0x15, 0x2c, 0xb6, 0x2,  0x97, 0x48};
  uint8_t bytesprops7[] = {0xdc, 0x12, 0x5f, 0xc8, 0x99, 0x60, 0xe3, 0xbe,
                           0x0,  0xbc, 0xd8, 0x8f, 0x11, 0xd6, 0x87, 0x18};
  uint8_t bytesprops8[] = {0x82, 0x13, 0x95, 0x39, 0xd7, 0xf5, 0xfe};
  uint8_t bytesprops9[] = {0x1c, 0x3f};
  uint8_t bytesprops10[] = {0x22, 0x55, 0x7a, 0xc3, 0xc7, 0x42, 0xb0, 0xe2, 0xbb, 0x18, 0x34, 0xba, 0xbd, 0xa3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops0}, .v = {9, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18515}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19988}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13619}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14566}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21618}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4301}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16401}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\187\249\143~(e\135", _pubProps = [PropSubscriptionIdentifier 20,PropUserProperty
// "\147\196\GS\178\rB9Y\145\CAN\135\233\179\rW\206" "\153\161\SUB\158\183;\192\CAN\US",PropAuthenticationData
// "",PropPayloadFormatIndicator 50,PropCorrelationData
// "P\SUB\136\&8\132\234f\SUB\196\232\&0\134\192\160\ETXB@\205\&4b\232\129\218~",PropReceiveMaximum 18515,PropMaximumQoS
// 108,PropTopicAliasMaximum 19988,PropRetainAvailable 87,PropMessageExpiryInterval 13619,PropSessionExpiryInterval
// 14566,PropAuthenticationMethod
// "\SO\222\190\199\&2\241*\185[\130\253%\255B1\131FP\163S\179\SUB\182\180\138\CAN\169",PropResponseTopic
// "\251\240\vp>\CAN,97\189!o\f\148\231",PropSubscriptionIdentifier 18,PropMessageExpiryInterval 21618,PropContentType
// "\172\211&\ESC\156\DEL\218\242\254\150Z\133\165\165\NAK,\182\STX\151H",PropServerReference
// "\220\DC2_\200\153`\227\190\NUL\188\216\143\DC1\214\135\CAN",PropReasonString
// "\130\DC3\149\&9\215\245\254",PropMaximumPacketSize 4301,PropAuthenticationData "\FS?",PropMaximumPacketSize
// 16401,PropRetainAvailable 43,PropServerReference "\"Uz\195\199B\176\226\187\CAN4\186\189\163"]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {
      0x39, 0xec, 0x1,  0x0,  0x0,  0xe1, 0x1,  0xb,  0x14, 0x26, 0x0,  0x10, 0x93, 0xc4, 0x1d, 0xb2, 0xd,  0x42, 0x39,
      0x59, 0x91, 0x18, 0x87, 0xe9, 0xb3, 0xd,  0x57, 0xce, 0x0,  0x9,  0x99, 0xa1, 0x1a, 0x9e, 0xb7, 0x3b, 0xc0, 0x18,
      0x1f, 0x16, 0x0,  0x0,  0x1,  0x32, 0x9,  0x0,  0x18, 0x50, 0x1a, 0x88, 0x38, 0x84, 0xea, 0x66, 0x1a, 0xc4, 0xe8,
      0x30, 0x86, 0xc0, 0xa0, 0x3,  0x42, 0x40, 0xcd, 0x34, 0x62, 0xe8, 0x81, 0xda, 0x7e, 0x21, 0x48, 0x53, 0x24, 0x6c,
      0x22, 0x4e, 0x14, 0x25, 0x57, 0x2,  0x0,  0x0,  0x35, 0x33, 0x11, 0x0,  0x0,  0x38, 0xe6, 0x15, 0x0,  0x1b, 0xe,
      0xde, 0xbe, 0xc7, 0x32, 0xf1, 0x2a, 0xb9, 0x5b, 0x82, 0xfd, 0x25, 0xff, 0x42, 0x31, 0x83, 0x46, 0x50, 0xa3, 0x53,
      0xb3, 0x1a, 0xb6, 0xb4, 0x8a, 0x18, 0xa9, 0x8,  0x0,  0xf,  0xfb, 0xf0, 0xb,  0x70, 0x3e, 0x18, 0x2c, 0x39, 0x37,
      0xbd, 0x21, 0x6f, 0xc,  0x94, 0xe7, 0xb,  0x12, 0x2,  0x0,  0x0,  0x54, 0x72, 0x3,  0x0,  0x14, 0xac, 0xd3, 0x26,
      0x1b, 0x9c, 0x7f, 0xda, 0xf2, 0xfe, 0x96, 0x5a, 0x85, 0xa5, 0xa5, 0x15, 0x2c, 0xb6, 0x2,  0x97, 0x48, 0x1c, 0x0,
      0x10, 0xdc, 0x12, 0x5f, 0xc8, 0x99, 0x60, 0xe3, 0xbe, 0x0,  0xbc, 0xd8, 0x8f, 0x11, 0xd6, 0x87, 0x18, 0x1f, 0x0,
      0x7,  0x82, 0x13, 0x95, 0x39, 0xd7, 0xf5, 0xfe, 0x27, 0x0,  0x0,  0x10, 0xcd, 0x16, 0x0,  0x2,  0x1c, 0x3f, 0x27,
      0x0,  0x0,  0x40, 0x11, 0x25, 0x2b, 0x1c, 0x0,  0xe,  0x22, 0x55, 0x7a, 0xc3, 0xc7, 0x42, 0xb0, 0xe2, 0xbb, 0x18,
      0x34, 0xba, 0xbd, 0xa3, 0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbb, 0xf9, 0x8f, 0x7e, 0x28, 0x65, 0x87};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "h\137\169\166b`\193\RS\133\235I\188\167\&9\DC1\161uN\176\SOf\ACK-O\194\vo", _pubPktID = 7918, _pubBody =
// "G\142\SYN\154\171\162\185\ENQg\129\240\186 \199\202{\CAN\233\v^\170", _pubProps = [PropSubscriptionIdentifier
// 18,PropMessageExpiryInterval 2493,PropSessionExpiryInterval 20854,PropResponseTopic
// "\t\132-\200\130\192\134\236\159\SOH~\253\143\138\GS\185!)j\144\239{\n\134\188",PropSharedSubscriptionAvailable
// 152,PropCorrelationData "\EM%8\187\233Y\200\164\219.GZ#\153\183\&6\143\239\243\147\224",PropAssignedClientIdentifier
// "k",PropSubscriptionIdentifierAvailable 36,PropWildcardSubscriptionAvailable 46,PropTopicAliasMaximum
// 7511,PropAuthenticationData "\184\174\234\255\250\US6\STX\131\180\DC1\237&\152*:\247",PropResponseTopic
// "\183\SUB\180\189\164\RS/q\223\236\207b\162\251D\SYN",PropResponseInformation "",PropRequestProblemInformation
// 120,PropAuthenticationMethod "^\206'R\156",PropUserProperty "\222u\CAN\221!\202\131\129S/v\146U"
// "=UHL\166\246C\150\167\157\CAN\155\141M+T\203\238\170|",PropUserProperty ""
// "D/z\167\SO\145\170\157?sY\207I\132(4d\206!&?o;\130",PropSubscriptionIdentifier 26]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x3a, 0xfc, 0x1,  0x0,  0x1b, 0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb, 0x49, 0xbc, 0xa7, 0x39,
      0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f, 0xc2, 0xb,  0x6f, 0x1e, 0xee, 0xc6, 0x1,  0xb,  0x12,
      0x2,  0x0,  0x0,  0x9,  0xbd, 0x11, 0x0,  0x0,  0x51, 0x76, 0x8,  0x0,  0x19, 0x9,  0x84, 0x2d, 0xc8, 0x82, 0xc0,
      0x86, 0xec, 0x9f, 0x1,  0x7e, 0xfd, 0x8f, 0x8a, 0x1d, 0xb9, 0x21, 0x29, 0x6a, 0x90, 0xef, 0x7b, 0xa,  0x86, 0xbc,
      0x2a, 0x98, 0x9,  0x0,  0x15, 0x19, 0x25, 0x38, 0xbb, 0xe9, 0x59, 0xc8, 0xa4, 0xdb, 0x2e, 0x47, 0x5a, 0x23, 0x99,
      0xb7, 0x36, 0x8f, 0xef, 0xf3, 0x93, 0xe0, 0x12, 0x0,  0x1,  0x6b, 0x29, 0x24, 0x28, 0x2e, 0x22, 0x1d, 0x57, 0x16,
      0x0,  0x11, 0xb8, 0xae, 0xea, 0xff, 0xfa, 0x1f, 0x36, 0x2,  0x83, 0xb4, 0x11, 0xed, 0x26, 0x98, 0x2a, 0x3a, 0xf7,
      0x8,  0x0,  0x10, 0xb7, 0x1a, 0xb4, 0xbd, 0xa4, 0x1e, 0x2f, 0x71, 0xdf, 0xec, 0xcf, 0x62, 0xa2, 0xfb, 0x44, 0x16,
      0x1a, 0x0,  0x0,  0x17, 0x78, 0x15, 0x0,  0x5,  0x5e, 0xce, 0x27, 0x52, 0x9c, 0x26, 0x0,  0xd,  0xde, 0x75, 0x18,
      0xdd, 0x21, 0xca, 0x83, 0x81, 0x53, 0x2f, 0x76, 0x92, 0x55, 0x0,  0x14, 0x3d, 0x55, 0x48, 0x4c, 0xa6, 0xf6, 0x43,
      0x96, 0xa7, 0x9d, 0x18, 0x9b, 0x8d, 0x4d, 0x2b, 0x54, 0xcb, 0xee, 0xaa, 0x7c, 0x26, 0x0,  0x0,  0x0,  0x18, 0x44,
      0x2f, 0x7a, 0xa7, 0xe,  0x91, 0xaa, 0x9d, 0x3f, 0x73, 0x59, 0xcf, 0x49, 0x84, 0x28, 0x34, 0x64, 0xce, 0x21, 0x26,
      0x3f, 0x6f, 0x3b, 0x82, 0xb,  0x1a, 0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5,  0x67, 0x81, 0xf0, 0xba, 0x20,
      0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb,  0x5e, 0xaa};
  uint8_t topic_bytes[] = {0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb, 0x49, 0xbc, 0xa7, 0x39,
                           0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f, 0xc2, 0xb,  0x6f};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5, 0x67, 0x81, 0xf0,
                         0xba, 0x20, 0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb, 0x5e, 0xaa};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0x9,  0x84, 0x2d, 0xc8, 0x82, 0xc0, 0x86, 0xec, 0x9f, 0x1, 0x7e, 0xfd, 0x8f,
                           0x8a, 0x1d, 0xb9, 0x21, 0x29, 0x6a, 0x90, 0xef, 0x7b, 0xa, 0x86, 0xbc};
  uint8_t bytesprops1[] = {0x19, 0x25, 0x38, 0xbb, 0xe9, 0x59, 0xc8, 0xa4, 0xdb, 0x2e, 0x47,
                           0x5a, 0x23, 0x99, 0xb7, 0x36, 0x8f, 0xef, 0xf3, 0x93, 0xe0};
  uint8_t bytesprops2[] = {0x6b};
  uint8_t bytesprops3[] = {0xb8, 0xae, 0xea, 0xff, 0xfa, 0x1f, 0x36, 0x2, 0x83,
                           0xb4, 0x11, 0xed, 0x26, 0x98, 0x2a, 0x3a, 0xf7};
  uint8_t bytesprops4[] = {0xb7, 0x1a, 0xb4, 0xbd, 0xa4, 0x1e, 0x2f, 0x71,
                           0xdf, 0xec, 0xcf, 0x62, 0xa2, 0xfb, 0x44, 0x16};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0x5e, 0xce, 0x27, 0x52, 0x9c};
  uint8_t bytesprops8[] = {0x3d, 0x55, 0x48, 0x4c, 0xa6, 0xf6, 0x43, 0x96, 0xa7, 0x9d,
                           0x18, 0x9b, 0x8d, 0x4d, 0x2b, 0x54, 0xcb, 0xee, 0xaa, 0x7c};
  uint8_t bytesprops7[] = {0xde, 0x75, 0x18, 0xdd, 0x21, 0xca, 0x83, 0x81, 0x53, 0x2f, 0x76, 0x92, 0x55};
  uint8_t bytesprops10[] = {0x44, 0x2f, 0x7a, 0xa7, 0xe,  0x91, 0xaa, 0x9d, 0x3f, 0x73, 0x59, 0xcf,
                            0x49, 0x84, 0x28, 0x34, 0x64, 0xce, 0x21, 0x26, 0x3f, 0x6f, 0x3b, 0x82};
  uint8_t bytesprops9[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2493}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20854}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7511}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops7}, .v = {20, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops9}, .v = {24, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 7918, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "h\137\169\166b`\193\RS\133\235I\188\167\&9\DC1\161uN\176\SOf\ACK-O\194\vo", _pubPktID = 7918, _pubBody =
// "G\142\SYN\154\171\162\185\ENQg\129\240\186 \199\202{\CAN\233\v^\170", _pubProps = [PropSubscriptionIdentifier
// 18,PropMessageExpiryInterval 2493,PropSessionExpiryInterval 20854,PropResponseTopic
// "\t\132-\200\130\192\134\236\159\SOH~\253\143\138\GS\185!)j\144\239{\n\134\188",PropSharedSubscriptionAvailable
// 152,PropCorrelationData "\EM%8\187\233Y\200\164\219.GZ#\153\183\&6\143\239\243\147\224",PropAssignedClientIdentifier
// "k",PropSubscriptionIdentifierAvailable 36,PropWildcardSubscriptionAvailable 46,PropTopicAliasMaximum
// 7511,PropAuthenticationData "\184\174\234\255\250\US6\STX\131\180\DC1\237&\152*:\247",PropResponseTopic
// "\183\SUB\180\189\164\RS/q\223\236\207b\162\251D\SYN",PropResponseInformation "",PropRequestProblemInformation
// 120,PropAuthenticationMethod "^\206'R\156",PropUserProperty "\222u\CAN\221!\202\131\129S/v\146U"
// "=UHL\166\246C\150\167\157\CAN\155\141M+T\203\238\170|",PropUserProperty ""
// "D/z\167\SO\145\170\157?sY\207I\132(4d\206!&?o;\130",PropSubscriptionIdentifier 26]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {
      0x3a, 0xfc, 0x1,  0x0,  0x1b, 0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb, 0x49, 0xbc, 0xa7, 0x39,
      0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f, 0xc2, 0xb,  0x6f, 0x1e, 0xee, 0xc6, 0x1,  0xb,  0x12,
      0x2,  0x0,  0x0,  0x9,  0xbd, 0x11, 0x0,  0x0,  0x51, 0x76, 0x8,  0x0,  0x19, 0x9,  0x84, 0x2d, 0xc8, 0x82, 0xc0,
      0x86, 0xec, 0x9f, 0x1,  0x7e, 0xfd, 0x8f, 0x8a, 0x1d, 0xb9, 0x21, 0x29, 0x6a, 0x90, 0xef, 0x7b, 0xa,  0x86, 0xbc,
      0x2a, 0x98, 0x9,  0x0,  0x15, 0x19, 0x25, 0x38, 0xbb, 0xe9, 0x59, 0xc8, 0xa4, 0xdb, 0x2e, 0x47, 0x5a, 0x23, 0x99,
      0xb7, 0x36, 0x8f, 0xef, 0xf3, 0x93, 0xe0, 0x12, 0x0,  0x1,  0x6b, 0x29, 0x24, 0x28, 0x2e, 0x22, 0x1d, 0x57, 0x16,
      0x0,  0x11, 0xb8, 0xae, 0xea, 0xff, 0xfa, 0x1f, 0x36, 0x2,  0x83, 0xb4, 0x11, 0xed, 0x26, 0x98, 0x2a, 0x3a, 0xf7,
      0x8,  0x0,  0x10, 0xb7, 0x1a, 0xb4, 0xbd, 0xa4, 0x1e, 0x2f, 0x71, 0xdf, 0xec, 0xcf, 0x62, 0xa2, 0xfb, 0x44, 0x16,
      0x1a, 0x0,  0x0,  0x17, 0x78, 0x15, 0x0,  0x5,  0x5e, 0xce, 0x27, 0x52, 0x9c, 0x26, 0x0,  0xd,  0xde, 0x75, 0x18,
      0xdd, 0x21, 0xca, 0x83, 0x81, 0x53, 0x2f, 0x76, 0x92, 0x55, 0x0,  0x14, 0x3d, 0x55, 0x48, 0x4c, 0xa6, 0xf6, 0x43,
      0x96, 0xa7, 0x9d, 0x18, 0x9b, 0x8d, 0x4d, 0x2b, 0x54, 0xcb, 0xee, 0xaa, 0x7c, 0x26, 0x0,  0x0,  0x0,  0x18, 0x44,
      0x2f, 0x7a, 0xa7, 0xe,  0x91, 0xaa, 0x9d, 0x3f, 0x73, 0x59, 0xcf, 0x49, 0x84, 0x28, 0x34, 0x64, 0xce, 0x21, 0x26,
      0x3f, 0x6f, 0x3b, 0x82, 0xb,  0x1a, 0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5,  0x67, 0x81, 0xf0, 0xba, 0x20,
      0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb,  0x5e, 0xaa};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x68, 0x89, 0xa9, 0xa6, 0x62, 0x60, 0xc1, 0x1e, 0x85, 0xeb, 0x49, 0xbc, 0xa7, 0x39,
                               0x11, 0xa1, 0x75, 0x4e, 0xb0, 0xe,  0x66, 0x6,  0x2d, 0x4f, 0xc2, 0xb,  0x6f};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x47, 0x8e, 0x16, 0x9a, 0xab, 0xa2, 0xb9, 0x5, 0x67, 0x81, 0xf0,
                              0xba, 0x20, 0xc7, 0xca, 0x7b, 0x18, 0xe9, 0xb, 0x5e, 0xaa};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 7918);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "k\r\250c\140\225\149\144@\133",
// _pubPktID = 0, _pubBody = "',/I\RSD\195\229\202", _pubProps = [PropResponseInformation
// "gd\181",PropMessageExpiryInterval 12250]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x30, 0x21, 0x0,  0xa,  0x6b, 0xd,  0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90,
                   0x40, 0x85, 0xb,  0x1a, 0x0,  0x3,  0x67, 0x64, 0xb5, 0x2,  0x0,  0x0,
                   0x2f, 0xda, 0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  uint8_t topic_bytes[] = {0x6b, 0xd, 0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90, 0x40, 0x85};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 9;

  uint8_t bytesprops0[] = {0x67, 0x64, 0xb5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12250}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "k\r\250c\140\225\149\144@\133",
// _pubPktID = 0, _pubBody = "',/I\RSD\195\229\202", _pubProps = [PropResponseInformation
// "gd\181",PropMessageExpiryInterval 12250]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x30, 0x21, 0x0,  0xa,  0x6b, 0xd,  0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90,
                   0x40, 0x85, 0xb,  0x1a, 0x0,  0x3,  0x67, 0x64, 0xb5, 0x2,  0x0,  0x0,
                   0x2f, 0xda, 0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6b, 0xd, 0xfa, 0x63, 0x8c, 0xe1, 0x95, 0x90, 0x40, 0x85};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x27, 0x2c, 0x2f, 0x49, 0x1e, 0x44, 0xc3, 0xe5, 0xca};
  lwmqtt_string_t exp_body = {9, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 9);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 9);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\STX'd2\162\&8\201\179\247\166Y\212\\E\134\229", _willMsg =
// "\STX\227Q\213\190e/R\238\220$q\218Y~\146:~\ESCo\213\150\243\EM\156+r", _willProps = []}), _cleanSession = True,
// _keepAlive = 14707, _connID = "\r\239\133\224\t\138Z\SOHVQ\194n\b\"", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x39, 0x73, 0x0,  0xe,  0xd,
                   0xef, 0x85, 0xe0, 0x9,  0x8a, 0x5a, 0x1,  0x56, 0x51, 0xc2, 0x6e, 0x8,  0x22, 0x0,  0x10,
                   0x2,  0x27, 0x64, 0x32, 0xa2, 0x38, 0xc9, 0xb3, 0xf7, 0xa6, 0x59, 0xd4, 0x5c, 0x45, 0x86,
                   0xe5, 0x0,  0x1b, 0x2,  0xe3, 0x51, 0xd5, 0xbe, 0x65, 0x2f, 0x52, 0xee, 0xdc, 0x24, 0x71,
                   0xda, 0x59, 0x7e, 0x92, 0x3a, 0x7e, 0x1b, 0x6f, 0xd5, 0x96, 0xf3, 0x19, 0x9c, 0x2b, 0x72};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2,  0x27, 0x64, 0x32, 0xa2, 0x38, 0xc9, 0xb3,
                                0xf7, 0xa6, 0x59, 0xd4, 0x5c, 0x45, 0x86, 0xe5};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2,  0xe3, 0x51, 0xd5, 0xbe, 0x65, 0x2f, 0x52, 0xee, 0xdc, 0x24, 0x71, 0xda, 0x59,
                                  0x7e, 0x92, 0x3a, 0x7e, 0x1b, 0x6f, 0xd5, 0x96, 0xf3, 0x19, 0x9c, 0x2b, 0x72};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14707;
  uint8_t client_id_bytes[] = {0xd, 0xef, 0x85, 0xe0, 0x9, 0x8a, 0x5a, 0x1, 0x56, 0x51, 0xc2, 0x6e, 0x8, 0x22};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\175\223\237\151\165\143\181\186", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\224\241\206\223", _willMsg = "<\185B\DC1", _willProps = []}),
// _cleanSession = True, _keepAlive = 12709, _connID = "qR&\218b\224.r|a\206\139\226\174(\216\EM\193", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x2a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x31, 0xa5, 0x0,  0x12, 0x71,
                   0x52, 0x26, 0xda, 0x62, 0xe0, 0x2e, 0x72, 0x7c, 0x61, 0xce, 0x8b, 0xe2, 0xae, 0x28, 0xd8,
                   0x19, 0xc1, 0x0,  0x4,  0xe0, 0xf1, 0xce, 0xdf, 0x0,  0x4,  0x3c, 0xb9, 0x42, 0x11};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe0, 0xf1, 0xce, 0xdf};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3c, 0xb9, 0x42, 0x11};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12709;
  uint8_t client_id_bytes[] = {0x71, 0x52, 0x26, 0xda, 0x62, 0xe0, 0x2e, 0x72, 0x7c,
                               0x61, 0xce, 0x8b, 0xe2, 0xae, 0x28, 0xd8, 0x19, 0xc1};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xaf, 0xdf, 0xed, 0x97, 0xa5, 0x8f, 0xb5, 0xba};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\223\255G", _password = Just "#\227\223\166s\STX2\230O\200nx\147\&0y\STX",
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 17542, _connID = "S_\ACKjq\165\200(O\181\US\v\216",
// _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x30, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x44, 0x86, 0x0,  0xd,  0x53, 0x5f, 0x6,
                   0x6a, 0x71, 0xa5, 0xc8, 0x28, 0x4f, 0xb5, 0x1f, 0xb,  0xd8, 0x0,  0x3,  0xdf, 0xff, 0x47, 0x0,  0x10,
                   0x23, 0xe3, 0xdf, 0xa6, 0x73, 0x2,  0x32, 0xe6, 0x4f, 0xc8, 0x6e, 0x78, 0x93, 0x30, 0x79, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17542;
  uint8_t client_id_bytes[] = {0x53, 0x5f, 0x6, 0x6a, 0x71, 0xa5, 0xc8, 0x28, 0x4f, 0xb5, 0x1f, 0xb, 0xd8};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xdf, 0xff, 0x47};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x23, 0xe3, 0xdf, 0xa6, 0x73, 0x2,  0x32, 0xe6,
                              0x4f, 0xc8, 0x6e, 0x78, 0x93, 0x30, 0x79, 0x2};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\228O\159\147\140e", _password = Just
// "I7\205O\249\210\201\ACK\248\fH\247\&4\ENQ\139\231o\196", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 1450, _connID = "m\207\182 \176\137\206\172\198Q\255\173\143\SYN\154\153\143\208\181\155ao_\227\206", _properties =
// []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x5,  0xaa, 0x0,  0x19, 0x6d, 0xcf, 0xb6,
                   0x20, 0xb0, 0x89, 0xce, 0xac, 0xc6, 0x51, 0xff, 0xad, 0x8f, 0x16, 0x9a, 0x99, 0x8f, 0xd0, 0xb5, 0x9b,
                   0x61, 0x6f, 0x5f, 0xe3, 0xce, 0x0,  0x6,  0xe4, 0x4f, 0x9f, 0x93, 0x8c, 0x65, 0x0,  0x12, 0x49, 0x37,
                   0xcd, 0x4f, 0xf9, 0xd2, 0xc9, 0x6,  0xf8, 0xc,  0x48, 0xf7, 0x34, 0x5,  0x8b, 0xe7, 0x6f, 0xc4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1450;
  uint8_t client_id_bytes[] = {0x6d, 0xcf, 0xb6, 0x20, 0xb0, 0x89, 0xce, 0xac, 0xc6, 0x51, 0xff, 0xad, 0x8f,
                               0x16, 0x9a, 0x99, 0x8f, 0xd0, 0xb5, 0x9b, 0x61, 0x6f, 0x5f, 0xe3, 0xce};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe4, 0x4f, 0x9f, 0x93, 0x8c, 0x65};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x49, 0x37, 0xcd, 0x4f, 0xf9, 0xd2, 0xc9, 0x6,  0xf8,
                              0xc,  0x48, 0xf7, 0x34, 0x5,  0x8b, 0xe7, 0x6f, 0xc4};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "ZY*\212\&2v\CAN\238\SYN\243Z-\210z\SO\229X\164`\136 \ETB\246\182zw}0\148\v",
// _password = Just "\150\&2b)", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "KY\242", _willMsg = "]\169\158\183\223\181L\153xld\SI\SI\155\&6\211\239", _willProps = []}), _cleanSession = False,
// _keepAlive = 18195, _connID = "v\132\v6\r\164\241\&1VUf\239\GS\210\201!\158\240\&7\194", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x5e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x47, 0x13, 0x0,  0x14, 0x76, 0x84,
                   0xb,  0x36, 0xd,  0xa4, 0xf1, 0x31, 0x56, 0x55, 0x66, 0xef, 0x1d, 0xd2, 0xc9, 0x21, 0x9e, 0xf0,
                   0x37, 0xc2, 0x0,  0x3,  0x4b, 0x59, 0xf2, 0x0,  0x11, 0x5d, 0xa9, 0x9e, 0xb7, 0xdf, 0xb5, 0x4c,
                   0x99, 0x78, 0x6c, 0x64, 0xf,  0xf,  0x9b, 0x36, 0xd3, 0xef, 0x0,  0x1e, 0x5a, 0x59, 0x2a, 0xd4,
                   0x32, 0x76, 0x18, 0xee, 0x16, 0xf3, 0x5a, 0x2d, 0xd2, 0x7a, 0xe,  0xe5, 0x58, 0xa4, 0x60, 0x88,
                   0x20, 0x17, 0xf6, 0xb6, 0x7a, 0x77, 0x7d, 0x30, 0x94, 0xb,  0x0,  0x4,  0x96, 0x32, 0x62, 0x29};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4b, 0x59, 0xf2};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5d, 0xa9, 0x9e, 0xb7, 0xdf, 0xb5, 0x4c, 0x99, 0x78,
                                  0x6c, 0x64, 0xf,  0xf,  0x9b, 0x36, 0xd3, 0xef};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18195;
  uint8_t client_id_bytes[] = {0x76, 0x84, 0xb,  0x36, 0xd,  0xa4, 0xf1, 0x31, 0x56, 0x55,
                               0x66, 0xef, 0x1d, 0xd2, 0xc9, 0x21, 0x9e, 0xf0, 0x37, 0xc2};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5a, 0x59, 0x2a, 0xd4, 0x32, 0x76, 0x18, 0xee, 0x16, 0xf3, 0x5a, 0x2d, 0xd2, 0x7a, 0xe,
                              0xe5, 0x58, 0xa4, 0x60, 0x88, 0x20, 0x17, 0xf6, 0xb6, 0x7a, 0x77, 0x7d, 0x30, 0x94, 0xb};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0x32, 0x62, 0x29};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\STXjT\248\ACK\158\156\227\216x\233}\DC4q\198\140ca\207\230", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "_\192D\194~\218adY0\244u\190og1\210Y\200", _willMsg = "\188\&4\154k=\225N", _willProps = []}), _cleanSession = True,
// _keepAlive = 16867, _connID = "h\ETX\237n0\202\ETX/\213\ESC\174\136'\218lQ\144\n\175\151\132", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x55, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x96, 0x41, 0xe3, 0x0,  0x15, 0x68,
                   0x3,  0xed, 0x6e, 0x30, 0xca, 0x3,  0x2f, 0xd5, 0x1b, 0xae, 0x88, 0x27, 0xda, 0x6c, 0x51,
                   0x90, 0xa,  0xaf, 0x97, 0x84, 0x0,  0x13, 0x5f, 0xc0, 0x44, 0xc2, 0x7e, 0xda, 0x61, 0x64,
                   0x59, 0x30, 0xf4, 0x75, 0xbe, 0x6f, 0x67, 0x31, 0xd2, 0x59, 0xc8, 0x0,  0x7,  0xbc, 0x34,
                   0x9a, 0x6b, 0x3d, 0xe1, 0x4e, 0x0,  0x14, 0x2,  0x6a, 0x54, 0xf8, 0x6,  0x9e, 0x9c, 0xe3,
                   0xd8, 0x78, 0xe9, 0x7d, 0x14, 0x71, 0xc6, 0x8c, 0x63, 0x61, 0xcf, 0xe6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5f, 0xc0, 0x44, 0xc2, 0x7e, 0xda, 0x61, 0x64, 0x59, 0x30,
                                0xf4, 0x75, 0xbe, 0x6f, 0x67, 0x31, 0xd2, 0x59, 0xc8};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbc, 0x34, 0x9a, 0x6b, 0x3d, 0xe1, 0x4e};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16867;
  uint8_t client_id_bytes[] = {0x68, 0x3,  0xed, 0x6e, 0x30, 0xca, 0x3, 0x2f, 0xd5, 0x1b, 0xae,
                               0x88, 0x27, 0xda, 0x6c, 0x51, 0x90, 0xa, 0xaf, 0x97, 0x84};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2,  0x6a, 0x54, 0xf8, 0x6,  0x9e, 0x9c, 0xe3, 0xd8, 0x78,
                              0xe9, 0x7d, 0x14, 0x71, 0xc6, 0x8c, 0x63, 0x61, 0xcf, 0xe6};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\EM\159\EM\NUL\DC4\\,\140mmGl\162\187\222", _password = Just
// "\CAN\249\146fH\SYN\161\US\154\173\243\177\240\212k\203\219>\193\167\185\189\222`\151Q", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\219\242^+:\f\EOT\173\175\&1\CAN\171\&8", _willMsg =
// "\172\220\161\161W~?%", _willProps = []}), _cleanSession = False, _keepAlive = 9252, _connID =
// "\175\167p\FS\238\ni\164\&3*\183\243\186\129\SO\153{\225\138\236\216\213${|P^\248\148\128", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x70, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x24, 0x24, 0x0,  0x1e, 0xaf, 0xa7, 0x70,
                   0x1c, 0xee, 0xa,  0x69, 0xa4, 0x33, 0x2a, 0xb7, 0xf3, 0xba, 0x81, 0xe,  0x99, 0x7b, 0xe1, 0x8a, 0xec,
                   0xd8, 0xd5, 0x24, 0x7b, 0x7c, 0x50, 0x5e, 0xf8, 0x94, 0x80, 0x0,  0xd,  0xdb, 0xf2, 0x5e, 0x2b, 0x3a,
                   0xc,  0x4,  0xad, 0xaf, 0x31, 0x18, 0xab, 0x38, 0x0,  0x8,  0xac, 0xdc, 0xa1, 0xa1, 0x57, 0x7e, 0x3f,
                   0x25, 0x0,  0xf,  0x19, 0x9f, 0x19, 0x0,  0x14, 0x5c, 0x2c, 0x8c, 0x6d, 0x6d, 0x47, 0x6c, 0xa2, 0xbb,
                   0xde, 0x0,  0x1a, 0x18, 0xf9, 0x92, 0x66, 0x48, 0x16, 0xa1, 0x1f, 0x9a, 0xad, 0xf3, 0xb1, 0xf0, 0xd4,
                   0x6b, 0xcb, 0xdb, 0x3e, 0xc1, 0xa7, 0xb9, 0xbd, 0xde, 0x60, 0x97, 0x51};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdb, 0xf2, 0x5e, 0x2b, 0x3a, 0xc, 0x4, 0xad, 0xaf, 0x31, 0x18, 0xab, 0x38};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xac, 0xdc, 0xa1, 0xa1, 0x57, 0x7e, 0x3f, 0x25};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9252;
  uint8_t client_id_bytes[] = {0xaf, 0xa7, 0x70, 0x1c, 0xee, 0xa,  0x69, 0xa4, 0x33, 0x2a,
                               0xb7, 0xf3, 0xba, 0x81, 0xe,  0x99, 0x7b, 0xe1, 0x8a, 0xec,
                               0xd8, 0xd5, 0x24, 0x7b, 0x7c, 0x50, 0x5e, 0xf8, 0x94, 0x80};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x19, 0x9f, 0x19, 0x0, 0x14, 0x5c, 0x2c, 0x8c, 0x6d, 0x6d, 0x47, 0x6c, 0xa2, 0xbb, 0xde};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0xf9, 0x92, 0x66, 0x48, 0x16, 0xa1, 0x1f, 0x9a, 0xad, 0xf3, 0xb1, 0xf0,
                              0xd4, 0x6b, 0xcb, 0xdb, 0x3e, 0xc1, 0xa7, 0xb9, 0xbd, 0xde, 0x60, 0x97, 0x51};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\132Jc\237#\175s\149\208\140\v\175\198\197@bE\255\177&4\223%%\194\229\ETB",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "_B\130\238\164\ACK\246/\243\243\182\&9h\219Dp\161E\201n(\130u", _willMsg =
// "L\ETX\226\236\158\CAN3\190\221\140\156\129Mj\211\ACKv+\USU\197e\219\EM\135\221\145", _willProps = []}),
// _cleanSession = False, _keepAlive = 23111, _connID =
// "\128'\168\a\165\214u\"VvPa\154y\236\ETB\165ng\208\175\233\198\234\235\a", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x79, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xb4, 0x5a, 0x47, 0x0,  0x1a, 0x80, 0x27,
                   0xa8, 0x7,  0xa5, 0xd6, 0x75, 0x22, 0x56, 0x76, 0x50, 0x61, 0x9a, 0x79, 0xec, 0x17, 0xa5, 0x6e,
                   0x67, 0xd0, 0xaf, 0xe9, 0xc6, 0xea, 0xeb, 0x7,  0x0,  0x17, 0x5f, 0x42, 0x82, 0xee, 0xa4, 0x6,
                   0xf6, 0x2f, 0xf3, 0xf3, 0xb6, 0x39, 0x68, 0xdb, 0x44, 0x70, 0xa1, 0x45, 0xc9, 0x6e, 0x28, 0x82,
                   0x75, 0x0,  0x1b, 0x4c, 0x3,  0xe2, 0xec, 0x9e, 0x18, 0x33, 0xbe, 0xdd, 0x8c, 0x9c, 0x81, 0x4d,
                   0x6a, 0xd3, 0x6,  0x76, 0x2b, 0x1f, 0x55, 0xc5, 0x65, 0xdb, 0x19, 0x87, 0xdd, 0x91, 0x0,  0x1b,
                   0x84, 0x4a, 0x63, 0xed, 0x23, 0xaf, 0x73, 0x95, 0xd0, 0x8c, 0xb,  0xaf, 0xc6, 0xc5, 0x40, 0x62,
                   0x45, 0xff, 0xb1, 0x26, 0x34, 0xdf, 0x25, 0x25, 0xc2, 0xe5, 0x17};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5f, 0x42, 0x82, 0xee, 0xa4, 0x6,  0xf6, 0x2f, 0xf3, 0xf3, 0xb6, 0x39,
                                0x68, 0xdb, 0x44, 0x70, 0xa1, 0x45, 0xc9, 0x6e, 0x28, 0x82, 0x75};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4c, 0x3, 0xe2, 0xec, 0x9e, 0x18, 0x33, 0xbe, 0xdd, 0x8c, 0x9c, 0x81, 0x4d, 0x6a,
                                  0xd3, 0x6, 0x76, 0x2b, 0x1f, 0x55, 0xc5, 0x65, 0xdb, 0x19, 0x87, 0xdd, 0x91};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23111;
  uint8_t client_id_bytes[] = {0x80, 0x27, 0xa8, 0x7,  0xa5, 0xd6, 0x75, 0x22, 0x56, 0x76, 0x50, 0x61, 0x9a,
                               0x79, 0xec, 0x17, 0xa5, 0x6e, 0x67, 0xd0, 0xaf, 0xe9, 0xc6, 0xea, 0xeb, 0x7};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x84, 0x4a, 0x63, 0xed, 0x23, 0xaf, 0x73, 0x95, 0xd0, 0x8c, 0xb,  0xaf, 0xc6, 0xc5,
                              0x40, 0x62, 0x45, 0xff, 0xb1, 0x26, 0x34, 0xdf, 0x25, 0x25, 0xc2, 0xe5, 0x17};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\131)o", _password = Just "Y^ \171\220\234\182Th\NAK", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\SOHw\DC4\149\&5\197\t\RS\188\166\DLE\179", _willMsg =
// "L\173#e?~\241<", _willProps = []}), _cleanSession = False, _keepAlive = 15628, _connID = "\238", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x36, 0x0, 0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x3d, 0xc,  0x0,  0x1,
                   0xee, 0x0,  0xc, 0x1,  0x77, 0x14, 0x95, 0x35, 0xc5, 0x9,  0x1e, 0xbc, 0xa6, 0x10,
                   0xb3, 0x0,  0x8, 0x4c, 0xad, 0x23, 0x65, 0x3f, 0x7e, 0xf1, 0x3c, 0x0,  0x3,  0x83,
                   0x29, 0x6f, 0x0, 0xa,  0x59, 0x5e, 0x20, 0xab, 0xdc, 0xea, 0xb6, 0x54, 0x68, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1, 0x77, 0x14, 0x95, 0x35, 0xc5, 0x9, 0x1e, 0xbc, 0xa6, 0x10, 0xb3};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4c, 0xad, 0x23, 0x65, 0x3f, 0x7e, 0xf1, 0x3c};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15628;
  uint8_t client_id_bytes[] = {0xee};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x83, 0x29, 0x6f};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x59, 0x5e, 0x20, 0xab, 0xdc, 0xea, 0xb6, 0x54, 0x68, 0x15};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\176mX\224\177{+\ENQ\221\228\184\181\192 \NUL\201\128\209", _password = Just
// "\215Dco.`\RSl\219\136A\134Z}X\247\&5HG\ETX", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1,
// _willTopic = "\242 xK\204\160x\221\169\240", _willMsg = "\220\ACKG", _willProps = []}), _cleanSession = True,
// _keepAlive = 19143, _connID = "\176/i\144P\218\&5\t\229;\221\246\DC2\"", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x55, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x4a, 0xc7, 0x0,  0xe,  0xb0,
                   0x2f, 0x69, 0x90, 0x50, 0xda, 0x35, 0x9,  0xe5, 0x3b, 0xdd, 0xf6, 0x12, 0x22, 0x0,  0xa,
                   0xf2, 0x20, 0x78, 0x4b, 0xcc, 0xa0, 0x78, 0xdd, 0xa9, 0xf0, 0x0,  0x3,  0xdc, 0x6,  0x47,
                   0x0,  0x12, 0xb0, 0x6d, 0x58, 0xe0, 0xb1, 0x7b, 0x2b, 0x5,  0xdd, 0xe4, 0xb8, 0xb5, 0xc0,
                   0x20, 0x0,  0xc9, 0x80, 0xd1, 0x0,  0x14, 0xd7, 0x44, 0x63, 0x6f, 0x2e, 0x60, 0x1e, 0x6c,
                   0xdb, 0x88, 0x41, 0x86, 0x5a, 0x7d, 0x58, 0xf7, 0x35, 0x48, 0x47, 0x3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf2, 0x20, 0x78, 0x4b, 0xcc, 0xa0, 0x78, 0xdd, 0xa9, 0xf0};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdc, 0x6, 0x47};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19143;
  uint8_t client_id_bytes[] = {0xb0, 0x2f, 0x69, 0x90, 0x50, 0xda, 0x35, 0x9, 0xe5, 0x3b, 0xdd, 0xf6, 0x12, 0x22};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb0, 0x6d, 0x58, 0xe0, 0xb1, 0x7b, 0x2b, 0x5,  0xdd,
                              0xe4, 0xb8, 0xb5, 0xc0, 0x20, 0x0,  0xc9, 0x80, 0xd1};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd7, 0x44, 0x63, 0x6f, 0x2e, 0x60, 0x1e, 0x6c, 0xdb, 0x88,
                              0x41, 0x86, 0x5a, 0x7d, 0x58, 0xf7, 0x35, 0x48, 0x47, 0x3};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "9\246\141M+", _password = Just
// "BzT\194\145\200\DC1~\DC2\170\&9\EOT\DLE\215\STX\232\174n", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 30004, _connID = "\ENQ\221\153\230\216\164\143FVb\206\243AV\250\128nq\CAN\233\230\147\239@u\239*", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x42, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x75, 0x34, 0x0,  0x1b,
                   0x5,  0xdd, 0x99, 0xe6, 0xd8, 0xa4, 0x8f, 0x46, 0x56, 0x62, 0xce, 0xf3, 0x41, 0x56,
                   0xfa, 0x80, 0x6e, 0x71, 0x18, 0xe9, 0xe6, 0x93, 0xef, 0x40, 0x75, 0xef, 0x2a, 0x0,
                   0x5,  0x39, 0xf6, 0x8d, 0x4d, 0x2b, 0x0,  0x12, 0x42, 0x7a, 0x54, 0xc2, 0x91, 0xc8,
                   0x11, 0x7e, 0x12, 0xaa, 0x39, 0x4,  0x10, 0xd7, 0x2,  0xe8, 0xae, 0x6e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30004;
  uint8_t client_id_bytes[] = {0x5,  0xdd, 0x99, 0xe6, 0xd8, 0xa4, 0x8f, 0x46, 0x56, 0x62, 0xce, 0xf3, 0x41, 0x56,
                               0xfa, 0x80, 0x6e, 0x71, 0x18, 0xe9, 0xe6, 0x93, 0xef, 0x40, 0x75, 0xef, 0x2a};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x39, 0xf6, 0x8d, 0x4d, 0x2b};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x42, 0x7a, 0x54, 0xc2, 0x91, 0xc8, 0x11, 0x7e, 0x12,
                              0xaa, 0x39, 0x4,  0x10, 0xd7, 0x2,  0xe8, 0xae, 0x6e};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "Q\GS\242\209", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 6889, _connID = "hO\233g\n{qNO\160 ", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x17, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2,  0x1a, 0xe9, 0x0,
                   0xb,  0x68, 0x4f, 0xe9, 0x67, 0xa,  0x7b, 0x71, 0x4e, 0x4f, 0xa0, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6889;
  uint8_t client_id_bytes[] = {0x68, 0x4f, 0xe9, 0x67, 0xa, 0x7b, 0x71, 0x4e, 0x4f, 0xa0, 0x20};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x51, 0x1d, 0xf2, 0xd1};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "", _willMsg = "\235\177\182N)\GS\253\200\252E\173b\141gO\165\169\ETX\va\209*", _willProps = []}),
// _cleanSession = True, _keepAlive = 8360, _connID =
// "\178Ip\r*\206Y\141(\255\184\&4\224\197=\217\172\EM\EOT\\'\RS\229u\172S\202", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe,  0x20, 0xa8, 0x0,  0x1b, 0xb2, 0x49, 0x70,
                   0xd,  0x2a, 0xce, 0x59, 0x8d, 0x28, 0xff, 0xb8, 0x34, 0xe0, 0xc5, 0x3d, 0xd9, 0xac, 0x19, 0x4,  0x5c,
                   0x27, 0x1e, 0xe5, 0x75, 0xac, 0x53, 0xca, 0x0,  0x0,  0x0,  0x16, 0xeb, 0xb1, 0xb6, 0x4e, 0x29, 0x1d,
                   0xfd, 0xc8, 0xfc, 0x45, 0xad, 0x62, 0x8d, 0x67, 0x4f, 0xa5, 0xa9, 0x3,  0xb,  0x61, 0xd1, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xeb, 0xb1, 0xb6, 0x4e, 0x29, 0x1d, 0xfd, 0xc8, 0xfc, 0x45, 0xad,
                                  0x62, 0x8d, 0x67, 0x4f, 0xa5, 0xa9, 0x3,  0xb,  0x61, 0xd1, 0x2a};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8360;
  uint8_t client_id_bytes[] = {0xb2, 0x49, 0x70, 0xd,  0x2a, 0xce, 0x59, 0x8d, 0x28, 0xff, 0xb8, 0x34, 0xe0, 0xc5,
                               0x3d, 0xd9, 0xac, 0x19, 0x4,  0x5c, 0x27, 0x1e, 0xe5, 0x75, 0xac, 0x53, 0xca};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "H\176\DC3\130\176@\132\210", _password = Just
// "\198\248\US\ETB\143\174JCT\DEL\221a\211\221;\179\128\182\154\207\189o", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\147.\146\246\203'\150]B\EMY\ETB\GS\tM\166q\196ug\DLE\t\191B", _willMsg =
// "\228\164\240r\184\245\201\DC2#9H\152\ETB\188\241\217\202\186\203\197D\220\162\&4\213", _willProps = []}),
// _cleanSession = True, _keepAlive = 28532, _connID = "y\245\130FF#\\[\227\&0", _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x6d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf6, 0x6f, 0x74, 0x0,  0xa,  0x79, 0xf5,
                   0x82, 0x46, 0x46, 0x23, 0x5c, 0x5b, 0xe3, 0x30, 0x0,  0x18, 0x93, 0x2e, 0x92, 0xf6, 0xcb, 0x27,
                   0x96, 0x5d, 0x42, 0x19, 0x59, 0x17, 0x1d, 0x9,  0x4d, 0xa6, 0x71, 0xc4, 0x75, 0x67, 0x10, 0x9,
                   0xbf, 0x42, 0x0,  0x19, 0xe4, 0xa4, 0xf0, 0x72, 0xb8, 0xf5, 0xc9, 0x12, 0x23, 0x39, 0x48, 0x98,
                   0x17, 0xbc, 0xf1, 0xd9, 0xca, 0xba, 0xcb, 0xc5, 0x44, 0xdc, 0xa2, 0x34, 0xd5, 0x0,  0x8,  0x48,
                   0xb0, 0x13, 0x82, 0xb0, 0x40, 0x84, 0xd2, 0x0,  0x16, 0xc6, 0xf8, 0x1f, 0x17, 0x8f, 0xae, 0x4a,
                   0x43, 0x54, 0x7f, 0xdd, 0x61, 0xd3, 0xdd, 0x3b, 0xb3, 0x80, 0xb6, 0x9a, 0xcf, 0xbd, 0x6f};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x93, 0x2e, 0x92, 0xf6, 0xcb, 0x27, 0x96, 0x5d, 0x42, 0x19, 0x59, 0x17,
                                0x1d, 0x9,  0x4d, 0xa6, 0x71, 0xc4, 0x75, 0x67, 0x10, 0x9,  0xbf, 0x42};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe4, 0xa4, 0xf0, 0x72, 0xb8, 0xf5, 0xc9, 0x12, 0x23, 0x39, 0x48, 0x98, 0x17,
                                  0xbc, 0xf1, 0xd9, 0xca, 0xba, 0xcb, 0xc5, 0x44, 0xdc, 0xa2, 0x34, 0xd5};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28532;
  uint8_t client_id_bytes[] = {0x79, 0xf5, 0x82, 0x46, 0x46, 0x23, 0x5c, 0x5b, 0xe3, 0x30};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x48, 0xb0, 0x13, 0x82, 0xb0, 0x40, 0x84, 0xd2};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc6, 0xf8, 0x1f, 0x17, 0x8f, 0xae, 0x4a, 0x43, 0x54, 0x7f, 0xdd,
                              0x61, 0xd3, 0xdd, 0x3b, 0xb3, 0x80, 0xb6, 0x9a, 0xcf, 0xbd, 0x6f};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\232\220\210", _password = Just
// "Q\222\CAN\156\222j\201*\143\147\STX\155\152P\n\166#\139", _lastWill = Just (LastWill {_willRetain = False, _willQoS
// = QoS2, _willTopic = "\NAK\166\247\190f\227\STX", _willMsg =
// "Pu4\232\181\200\&73\211\251l\247WIl\248g\236i\218\139\136\182\208\241!\195\244\162", _willProps = []}),
// _cleanSession = False, _keepAlive = 16792, _connID = "\144\154@\235\163ha\251\SO\244\151\244\235", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x41, 0x98, 0x0,  0xd,  0x90, 0x9a,
                   0x40, 0xeb, 0xa3, 0x68, 0x61, 0xfb, 0xe,  0xf4, 0x97, 0xf4, 0xeb, 0x0,  0x7,  0x15, 0xa6, 0xf7,
                   0xbe, 0x66, 0xe3, 0x2,  0x0,  0x1d, 0x50, 0x75, 0x34, 0xe8, 0xb5, 0xc8, 0x37, 0x33, 0xd3, 0xfb,
                   0x6c, 0xf7, 0x57, 0x49, 0x6c, 0xf8, 0x67, 0xec, 0x69, 0xda, 0x8b, 0x88, 0xb6, 0xd0, 0xf1, 0x21,
                   0xc3, 0xf4, 0xa2, 0x0,  0x3,  0xe8, 0xdc, 0xd2, 0x0,  0x12, 0x51, 0xde, 0x18, 0x9c, 0xde, 0x6a,
                   0xc9, 0x2a, 0x8f, 0x93, 0x2,  0x9b, 0x98, 0x50, 0xa,  0xa6, 0x23, 0x8b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x15, 0xa6, 0xf7, 0xbe, 0x66, 0xe3, 0x2};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x50, 0x75, 0x34, 0xe8, 0xb5, 0xc8, 0x37, 0x33, 0xd3, 0xfb,
                                  0x6c, 0xf7, 0x57, 0x49, 0x6c, 0xf8, 0x67, 0xec, 0x69, 0xda,
                                  0x8b, 0x88, 0xb6, 0xd0, 0xf1, 0x21, 0xc3, 0xf4, 0xa2};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 16792;
  uint8_t client_id_bytes[] = {0x90, 0x9a, 0x40, 0xeb, 0xa3, 0x68, 0x61, 0xfb, 0xe, 0xf4, 0x97, 0xf4, 0xeb};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe8, 0xdc, 0xd2};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x51, 0xde, 0x18, 0x9c, 0xde, 0x6a, 0xc9, 0x2a, 0x8f,
                              0x93, 0x2,  0x9b, 0x98, 0x50, 0xa,  0xa6, 0x23, 0x8b};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\208\&08\153\253\129\180\139MgC\ACKe\252k\131\238w\f\234\212", _password = Just
// "\174\131\134S\237\RS", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "oa\v,+\129{\223N\216\&2}\SI\161-\165a\146\&7\248\166\224\189\SOH\ESC\182", _willMsg = "m]", _willProps = []}),
// _cleanSession = False, _keepAlive = 3974, _connID =
// "\203\150\211\212\222);\208\149\129\DC4~\242y\186\143\254U\154\SYNx\245\248\f\166m!", _properties = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x66, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0xf,  0x86, 0x0,  0x1b, 0xcb,
                   0x96, 0xd3, 0xd4, 0xde, 0x29, 0x3b, 0xd0, 0x95, 0x81, 0x14, 0x7e, 0xf2, 0x79, 0xba, 0x8f,
                   0xfe, 0x55, 0x9a, 0x16, 0x78, 0xf5, 0xf8, 0xc,  0xa6, 0x6d, 0x21, 0x0,  0x1a, 0x6f, 0x61,
                   0xb,  0x2c, 0x2b, 0x81, 0x7b, 0xdf, 0x4e, 0xd8, 0x32, 0x7d, 0xf,  0xa1, 0x2d, 0xa5, 0x61,
                   0x92, 0x37, 0xf8, 0xa6, 0xe0, 0xbd, 0x1,  0x1b, 0xb6, 0x0,  0x2,  0x6d, 0x5d, 0x0,  0x15,
                   0xd0, 0x30, 0x38, 0x99, 0xfd, 0x81, 0xb4, 0x8b, 0x4d, 0x67, 0x43, 0x6,  0x65, 0xfc, 0x6b,
                   0x83, 0xee, 0x77, 0xc,  0xea, 0xd4, 0x0,  0x6,  0xae, 0x83, 0x86, 0x53, 0xed, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6f, 0x61, 0xb,  0x2c, 0x2b, 0x81, 0x7b, 0xdf, 0x4e, 0xd8, 0x32, 0x7d, 0xf,
                                0xa1, 0x2d, 0xa5, 0x61, 0x92, 0x37, 0xf8, 0xa6, 0xe0, 0xbd, 0x1,  0x1b, 0xb6};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6d, 0x5d};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3974;
  uint8_t client_id_bytes[] = {0xcb, 0x96, 0xd3, 0xd4, 0xde, 0x29, 0x3b, 0xd0, 0x95, 0x81, 0x14, 0x7e, 0xf2, 0x79,
                               0xba, 0x8f, 0xfe, 0x55, 0x9a, 0x16, 0x78, 0xf5, 0xf8, 0xc,  0xa6, 0x6d, 0x21};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd0, 0x30, 0x38, 0x99, 0xfd, 0x81, 0xb4, 0x8b, 0x4d, 0x67, 0x43,
                              0x6,  0x65, 0xfc, 0x6b, 0x83, 0xee, 0x77, 0xc,  0xea, 0xd4};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xae, 0x83, 0x86, 0x53, 0xed, 0x1e};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\188\129", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "\129\&3\164\SI_\141bs\171\247\163v\159\181\150T\180\136Az", _willMsg = "
// /\189\141D\179\139\140\223\211:A\219\205Fu\DC1", _willProps = []}), _cleanSession = False, _keepAlive = 6602, _connID
// = "%\197u\242|QM/\NUL\239\144\a\176\173\138\248\143\&0>8", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x4,  0x19, 0xca, 0x0,  0x14, 0x25,
                   0xc5, 0x75, 0xf2, 0x7c, 0x51, 0x4d, 0x2f, 0x0,  0xef, 0x90, 0x7,  0xb0, 0xad, 0x8a, 0xf8,
                   0x8f, 0x30, 0x3e, 0x38, 0x0,  0x14, 0x81, 0x33, 0xa4, 0xf,  0x5f, 0x8d, 0x62, 0x73, 0xab,
                   0xf7, 0xa3, 0x76, 0x9f, 0xb5, 0x96, 0x54, 0xb4, 0x88, 0x41, 0x7a, 0x0,  0x11, 0x20, 0x2f,
                   0xbd, 0x8d, 0x44, 0xb3, 0x8b, 0x8c, 0xdf, 0xd3, 0x3a, 0x41, 0xdb, 0xcd, 0x46, 0x75, 0x11};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x81, 0x33, 0xa4, 0xf,  0x5f, 0x8d, 0x62, 0x73, 0xab, 0xf7,
                                0xa3, 0x76, 0x9f, 0xb5, 0x96, 0x54, 0xb4, 0x88, 0x41, 0x7a};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x20, 0x2f, 0xbd, 0x8d, 0x44, 0xb3, 0x8b, 0x8c, 0xdf,
                                  0xd3, 0x3a, 0x41, 0xdb, 0xcd, 0x46, 0x75, 0x11};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6602;
  uint8_t client_id_bytes[] = {0x25, 0xc5, 0x75, 0xf2, 0x7c, 0x51, 0x4d, 0x2f, 0x0,  0xef,
                               0x90, 0x7,  0xb0, 0xad, 0x8a, 0xf8, 0x8f, 0x30, 0x3e, 0x38};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xbc, 0x81};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\134\162'b\147r\DC3", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS0, _willTopic = "\196.\fm\178\&9\240", _willMsg =
// "\229Y\246\171\"\a\231Vp\200\169\156\&5%\n\165\146\ETB\221\209\128\228\231", _willProps = []}), _cleanSession = True,
// _keepAlive = 10739, _connID = "/", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x2f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x29, 0xf3, 0x0,  0x1,  0x2f, 0x0,  0x7,
                   0xc4, 0x2e, 0xc,  0x6d, 0xb2, 0x39, 0xf0, 0x0,  0x17, 0xe5, 0x59, 0xf6, 0xab, 0x22, 0x7,  0xe7, 0x56,
                   0x70, 0xc8, 0xa9, 0x9c, 0x35, 0x25, 0xa,  0xa5, 0x92, 0x17, 0xdd, 0xd1, 0x80, 0xe4, 0xe7};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc4, 0x2e, 0xc, 0x6d, 0xb2, 0x39, 0xf0};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe5, 0x59, 0xf6, 0xab, 0x22, 0x7,  0xe7, 0x56, 0x70, 0xc8, 0xa9, 0x9c,
                                  0x35, 0x25, 0xa,  0xa5, 0x92, 0x17, 0xdd, 0xd1, 0x80, 0xe4, 0xe7};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10739;
  uint8_t client_id_bytes[] = {0x2f};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x86, 0xa2, 0x27, 0x62, 0x93, 0x72, 0x13};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\162\239\230\n3", _password = Just
// "\CAN\200\200D\180\211J@\181\217Sj\DEL\208\141\&8\135^$\175", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "Z\197\216\246\ETX\145\228\DC3\217", _willMsg = "5\204\&3\t\SI\254!\226\237\154",
// _willProps = []}), _cleanSession = False, _keepAlive = 24980, _connID =
// "f\246\\A\130\163\246\NUL\ESC\222\168?\SI\NULe\155\&9\215", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x52, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x61, 0x94, 0x0,  0x12, 0x66, 0xf6, 0x5c,
                   0x41, 0x82, 0xa3, 0xf6, 0x0,  0x1b, 0xde, 0xa8, 0x3f, 0xf,  0x0,  0x65, 0x9b, 0x39, 0xd7, 0x0,  0x9,
                   0x5a, 0xc5, 0xd8, 0xf6, 0x3,  0x91, 0xe4, 0x13, 0xd9, 0x0,  0xa,  0x35, 0xcc, 0x33, 0x9,  0xf,  0xfe,
                   0x21, 0xe2, 0xed, 0x9a, 0x0,  0x5,  0xa2, 0xef, 0xe6, 0xa,  0x33, 0x0,  0x14, 0x18, 0xc8, 0xc8, 0x44,
                   0xb4, 0xd3, 0x4a, 0x40, 0xb5, 0xd9, 0x53, 0x6a, 0x7f, 0xd0, 0x8d, 0x38, 0x87, 0x5e, 0x24, 0xaf};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5a, 0xc5, 0xd8, 0xf6, 0x3, 0x91, 0xe4, 0x13, 0xd9};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x35, 0xcc, 0x33, 0x9, 0xf, 0xfe, 0x21, 0xe2, 0xed, 0x9a};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24980;
  uint8_t client_id_bytes[] = {0x66, 0xf6, 0x5c, 0x41, 0x82, 0xa3, 0xf6, 0x0,  0x1b,
                               0xde, 0xa8, 0x3f, 0xf,  0x0,  0x65, 0x9b, 0x39, 0xd7};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa2, 0xef, 0xe6, 0xa, 0x33};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0xc8, 0xc8, 0x44, 0xb4, 0xd3, 0x4a, 0x40, 0xb5, 0xd9,
                              0x53, 0x6a, 0x7f, 0xd0, 0x8d, 0x38, 0x87, 0x5e, 0x24, 0xaf};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\223\202e-\159\bZ\GS", _password = Just
// "\210\145\"C\US\ESC(\195\234\165\212\157t\235\178", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2,
// _willTopic = "1PwW$\"}\"/9\SOH\DC4a\252\212\170=b\209y\215\SO\216.F\160\139", _willMsg =
// "\254\255\178\RS\STXL\176\236\FS\129c\209", _willProps = []}), _cleanSession = True, _keepAlive = 21539, _connID =
// "t\221\220", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x55, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x54, 0x23, 0x0,  0x3,  0x74,
                   0xdd, 0xdc, 0x0,  0x1b, 0x31, 0x50, 0x77, 0x57, 0x24, 0x22, 0x7d, 0x22, 0x2f, 0x39, 0x1,
                   0x14, 0x61, 0xfc, 0xd4, 0xaa, 0x3d, 0x62, 0xd1, 0x79, 0xd7, 0xe,  0xd8, 0x2e, 0x46, 0xa0,
                   0x8b, 0x0,  0xc,  0xfe, 0xff, 0xb2, 0x1e, 0x2,  0x4c, 0xb0, 0xec, 0x1c, 0x81, 0x63, 0xd1,
                   0x0,  0x8,  0xdf, 0xca, 0x65, 0x2d, 0x9f, 0x8,  0x5a, 0x1d, 0x0,  0xf,  0xd2, 0x91, 0x22,
                   0x43, 0x1f, 0x1b, 0x28, 0xc3, 0xea, 0xa5, 0xd4, 0x9d, 0x74, 0xeb, 0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x31, 0x50, 0x77, 0x57, 0x24, 0x22, 0x7d, 0x22, 0x2f, 0x39, 0x1,  0x14, 0x61, 0xfc,
                                0xd4, 0xaa, 0x3d, 0x62, 0xd1, 0x79, 0xd7, 0xe,  0xd8, 0x2e, 0x46, 0xa0, 0x8b};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfe, 0xff, 0xb2, 0x1e, 0x2, 0x4c, 0xb0, 0xec, 0x1c, 0x81, 0x63, 0xd1};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 21539;
  uint8_t client_id_bytes[] = {0x74, 0xdd, 0xdc};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xdf, 0xca, 0x65, 0x2d, 0x9f, 0x8, 0x5a, 0x1d};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd2, 0x91, 0x22, 0x43, 0x1f, 0x1b, 0x28, 0xc3, 0xea, 0xa5, 0xd4, 0x9d, 0x74, 0xeb, 0xb2};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\205lB\203\231\189}\136\179\155\DC1s\151L1\191\USz\163V\150\139n", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\DC1\SO\218k9\194\251",
// _willMsg = "\220\247\191\205\141\195\128\255w", _willProps = []}), _cleanSession = False, _keepAlive = 11497, _connID
// = "zV\172\DC4\177\SI\214(\170\v\144\232}", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x94, 0x2c, 0xe9, 0x0,  0xd,  0x7a,
                   0x56, 0xac, 0x14, 0xb1, 0xf,  0xd6, 0x28, 0xaa, 0xb,  0x90, 0xe8, 0x7d, 0x0,  0x7,  0x11,
                   0xe,  0xda, 0x6b, 0x39, 0xc2, 0xfb, 0x0,  0x9,  0xdc, 0xf7, 0xbf, 0xcd, 0x8d, 0xc3, 0x80,
                   0xff, 0x77, 0x0,  0x17, 0xcd, 0x6c, 0x42, 0xcb, 0xe7, 0xbd, 0x7d, 0x88, 0xb3, 0x9b, 0x11,
                   0x73, 0x97, 0x4c, 0x31, 0xbf, 0x1f, 0x7a, 0xa3, 0x56, 0x96, 0x8b, 0x6e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x11, 0xe, 0xda, 0x6b, 0x39, 0xc2, 0xfb};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdc, 0xf7, 0xbf, 0xcd, 0x8d, 0xc3, 0x80, 0xff, 0x77};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11497;
  uint8_t client_id_bytes[] = {0x7a, 0x56, 0xac, 0x14, 0xb1, 0xf, 0xd6, 0x28, 0xaa, 0xb, 0x90, 0xe8, 0x7d};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcd, 0x6c, 0x42, 0xcb, 0xe7, 0xbd, 0x7d, 0x88, 0xb3, 0x9b, 0x11, 0x73,
                              0x97, 0x4c, 0x31, 0xbf, 0x1f, 0x7a, 0xa3, 0x56, 0x96, 0x8b, 0x6e};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\251Z\240\194K\232\239\141AZ", _password = Just
// "\215]\EM\137\201\167\148\151\224z^h\231\180\213Uk+\147", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 19360, _connID = "\156\242D9\182\133e\DC1\231\177\DC4", _properties = []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x38, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x4b, 0xa0, 0x0,  0xb,  0x9c,
                   0xf2, 0x44, 0x39, 0xb6, 0x85, 0x65, 0x11, 0xe7, 0xb1, 0x14, 0x0,  0xa,  0xfb, 0x5a, 0xf0,
                   0xc2, 0x4b, 0xe8, 0xef, 0x8d, 0x41, 0x5a, 0x0,  0x13, 0xd7, 0x5d, 0x19, 0x89, 0xc9, 0xa7,
                   0x94, 0x97, 0xe0, 0x7a, 0x5e, 0x68, 0xe7, 0xb4, 0xd5, 0x55, 0x6b, 0x2b, 0x93};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19360;
  uint8_t client_id_bytes[] = {0x9c, 0xf2, 0x44, 0x39, 0xb6, 0x85, 0x65, 0x11, 0xe7, 0xb1, 0x14};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfb, 0x5a, 0xf0, 0xc2, 0x4b, 0xe8, 0xef, 0x8d, 0x41, 0x5a};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd7, 0x5d, 0x19, 0x89, 0xc9, 0xa7, 0x94, 0x97, 0xe0, 0x7a,
                              0x5e, 0x68, 0xe7, 0xb4, 0xd5, 0x55, 0x6b, 0x2b, 0x93};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "X&4$#\150ffc\147", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "\136x", _willMsg = "\170\173F9\211(\209\223@%\STX\NUL\175\144\213\136\224b",
// _willProps = []}), _cleanSession = False, _keepAlive = 19263, _connID = "\148\139\192+\177o\182\205", _properties =
// []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x38, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x84, 0x4b, 0x3f, 0x0,  0x8,  0x94,
                   0x8b, 0xc0, 0x2b, 0xb1, 0x6f, 0xb6, 0xcd, 0x0,  0x2,  0x88, 0x78, 0x0,  0x12, 0xaa, 0xad,
                   0x46, 0x39, 0xd3, 0x28, 0xd1, 0xdf, 0x40, 0x25, 0x2,  0x0,  0xaf, 0x90, 0xd5, 0x88, 0xe0,
                   0x62, 0x0,  0xa,  0x58, 0x26, 0x34, 0x24, 0x23, 0x96, 0x66, 0x66, 0x63, 0x93};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x88, 0x78};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xaa, 0xad, 0x46, 0x39, 0xd3, 0x28, 0xd1, 0xdf, 0x40,
                                  0x25, 0x2,  0x0,  0xaf, 0x90, 0xd5, 0x88, 0xe0, 0x62};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19263;
  uint8_t client_id_bytes[] = {0x94, 0x8b, 0xc0, 0x2b, 0xb1, 0x6f, 0xb6, 0xcd};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x58, 0x26, 0x34, 0x24, 0x23, 0x96, 0x66, 0x66, 0x63, 0x93};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\169\134\229\177\141\167:\"\240_\168S\ETB~\228\190\175\174\ACK\168\191@\171\199\GSM\208h", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\173en(3\180\NAK\238\226z\SO\231\221<8u\183\188\229\221\231\131\185\v\203;", _willMsg =
// "z#W\234\STX\229\164\203\229\130\201\SOHy\205\&3\169>\205\160\203dE\ACK\255\213\164\225\ESC\163", _willProps = []}),
// _cleanSession = True, _keepAlive = 14436, _connID =
// "\"\179\&5mH+{\187\208\t`<\149\EOT\249\182\214\184\&8\198\201\139\186\&5", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x5f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x16, 0x38, 0x64, 0x0,  0x18, 0x22, 0xb3, 0x35,
                   0x6d, 0x48, 0x2b, 0x7b, 0xbb, 0xd0, 0x9,  0x60, 0x3c, 0x95, 0x4,  0xf9, 0xb6, 0xd6, 0xb8, 0x38, 0xc6,
                   0xc9, 0x8b, 0xba, 0x35, 0x0,  0x1a, 0xad, 0x65, 0x6e, 0x28, 0x33, 0xb4, 0x15, 0xee, 0xe2, 0x7a, 0xe,
                   0xe7, 0xdd, 0x3c, 0x38, 0x75, 0xb7, 0xbc, 0xe5, 0xdd, 0xe7, 0x83, 0xb9, 0xb,  0xcb, 0x3b, 0x0,  0x1d,
                   0x7a, 0x23, 0x57, 0xea, 0x2,  0xe5, 0xa4, 0xcb, 0xe5, 0x82, 0xc9, 0x1,  0x79, 0xcd, 0x33, 0xa9, 0x3e,
                   0xcd, 0xa0, 0xcb, 0x64, 0x45, 0x6,  0xff, 0xd5, 0xa4, 0xe1, 0x1b, 0xa3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xad, 0x65, 0x6e, 0x28, 0x33, 0xb4, 0x15, 0xee, 0xe2, 0x7a, 0xe, 0xe7, 0xdd,
                                0x3c, 0x38, 0x75, 0xb7, 0xbc, 0xe5, 0xdd, 0xe7, 0x83, 0xb9, 0xb, 0xcb, 0x3b};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7a, 0x23, 0x57, 0xea, 0x2,  0xe5, 0xa4, 0xcb, 0xe5, 0x82,
                                  0xc9, 0x1,  0x79, 0xcd, 0x33, 0xa9, 0x3e, 0xcd, 0xa0, 0xcb,
                                  0x64, 0x45, 0x6,  0xff, 0xd5, 0xa4, 0xe1, 0x1b, 0xa3};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14436;
  uint8_t client_id_bytes[] = {0x22, 0xb3, 0x35, 0x6d, 0x48, 0x2b, 0x7b, 0xbb, 0xd0, 0x9,  0x60, 0x3c,
                               0x95, 0x4,  0xf9, 0xb6, 0xd6, 0xb8, 0x38, 0xc6, 0xc9, 0x8b, 0xba, 0x35};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa9, 0x86, 0xe5, 0xb1, 0x8d, 0xa7, 0x3a, 0x22, 0xf0, 0x5f, 0xa8, 0x53, 0x17, 0x7e,
                              0xe4, 0xbe, 0xaf, 0xae, 0x6,  0xa8, 0xbf, 0x40, 0xab, 0xc7, 0x1d, 0x4d, 0xd0, 0x68};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "O\165\188\192\128\155\192a\198\EM?\198\230)}\161", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "s\137\218\237\244]\194(\128\202w\240\147M6\232\218\245\251\&7hf\206t", _willMsg =
// "\238+y\253\141\&0--\219\143\226YM\140U\"dA\DLE\235\128", _willProps = []}), _cleanSession = False, _keepAlive =
// 3208, _connID = "\DC3P\129h", _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2c, 0xc,  0x88, 0x0,  0x4,  0x13, 0x50, 0x81,
                   0x68, 0x0,  0x18, 0x73, 0x89, 0xda, 0xed, 0xf4, 0x5d, 0xc2, 0x28, 0x80, 0xca, 0x77, 0xf0, 0x93, 0x4d,
                   0x36, 0xe8, 0xda, 0xf5, 0xfb, 0x37, 0x68, 0x66, 0xce, 0x74, 0x0,  0x15, 0xee, 0x2b, 0x79, 0xfd, 0x8d,
                   0x30, 0x2d, 0x2d, 0xdb, 0x8f, 0xe2, 0x59, 0x4d, 0x8c, 0x55, 0x22, 0x64, 0x41, 0x10, 0xeb, 0x80};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x73, 0x89, 0xda, 0xed, 0xf4, 0x5d, 0xc2, 0x28, 0x80, 0xca, 0x77, 0xf0,
                                0x93, 0x4d, 0x36, 0xe8, 0xda, 0xf5, 0xfb, 0x37, 0x68, 0x66, 0xce, 0x74};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xee, 0x2b, 0x79, 0xfd, 0x8d, 0x30, 0x2d, 0x2d, 0xdb, 0x8f, 0xe2,
                                  0x59, 0x4d, 0x8c, 0x55, 0x22, 0x64, 0x41, 0x10, 0xeb, 0x80};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3208;
  uint8_t client_id_bytes[] = {0x13, 0x50, 0x81, 0x68};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4f, 0xa5, 0xbc, 0xc0, 0x80, 0x9b, 0xc0, 0x61,
                              0xc6, 0x19, 0x3f, 0xc6, 0xe6, 0x29, 0x7d, 0xa1};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\149\151\139\195\172z\255\139u#\163\fg,\230|\158{", _password = Just
// "Z\165\208\RS\195i\201D9m(Z ,\165\217Aa\137\ENQ\SO\180", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\141-\179\ENQl~\217\164\234\131\134\134\207X", _willMsg =
// ";\NUL\DEL\NUL\RSHW\212\230\191L\211s)\181j\203\158\229\137", _willProps = []}), _cleanSession = True, _keepAlive =
// 32044, _connID = "\248\r\241\217\233\199#\171\195\&6}Wu\226i\209\194\149\251\&6X$\144\230", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x76, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe6, 0x7d, 0x2c, 0x0,  0x18, 0xf8,
                   0xd,  0xf1, 0xd9, 0xe9, 0xc7, 0x23, 0xab, 0xc3, 0x36, 0x7d, 0x57, 0x75, 0xe2, 0x69, 0xd1,
                   0xc2, 0x95, 0xfb, 0x36, 0x58, 0x24, 0x90, 0xe6, 0x0,  0xe,  0x8d, 0x2d, 0xb3, 0x5,  0x6c,
                   0x7e, 0xd9, 0xa4, 0xea, 0x83, 0x86, 0x86, 0xcf, 0x58, 0x0,  0x14, 0x3b, 0x0,  0x7f, 0x0,
                   0x1e, 0x48, 0x57, 0xd4, 0xe6, 0xbf, 0x4c, 0xd3, 0x73, 0x29, 0xb5, 0x6a, 0xcb, 0x9e, 0xe5,
                   0x89, 0x0,  0x12, 0x95, 0x97, 0x8b, 0xc3, 0xac, 0x7a, 0xff, 0x8b, 0x75, 0x23, 0xa3, 0xc,
                   0x67, 0x2c, 0xe6, 0x7c, 0x9e, 0x7b, 0x0,  0x16, 0x5a, 0xa5, 0xd0, 0x1e, 0xc3, 0x69, 0xc9,
                   0x44, 0x39, 0x6d, 0x28, 0x5a, 0x20, 0x2c, 0xa5, 0xd9, 0x41, 0x61, 0x89, 0x5,  0xe,  0xb4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8d, 0x2d, 0xb3, 0x5, 0x6c, 0x7e, 0xd9, 0xa4, 0xea, 0x83, 0x86, 0x86, 0xcf, 0x58};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3b, 0x0,  0x7f, 0x0,  0x1e, 0x48, 0x57, 0xd4, 0xe6, 0xbf,
                                  0x4c, 0xd3, 0x73, 0x29, 0xb5, 0x6a, 0xcb, 0x9e, 0xe5, 0x89};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 32044;
  uint8_t client_id_bytes[] = {0xf8, 0xd,  0xf1, 0xd9, 0xe9, 0xc7, 0x23, 0xab, 0xc3, 0x36, 0x7d, 0x57,
                               0x75, 0xe2, 0x69, 0xd1, 0xc2, 0x95, 0xfb, 0x36, 0x58, 0x24, 0x90, 0xe6};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x95, 0x97, 0x8b, 0xc3, 0xac, 0x7a, 0xff, 0x8b, 0x75,
                              0x23, 0xa3, 0xc,  0x67, 0x2c, 0xe6, 0x7c, 0x9e, 0x7b};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5a, 0xa5, 0xd0, 0x1e, 0xc3, 0x69, 0xc9, 0x44, 0x39, 0x6d, 0x28,
                              0x5a, 0x20, 0x2c, 0xa5, 0xd9, 0x41, 0x61, 0x89, 0x5,  0xe,  0xb4};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "|\236r\252\&0Ku{\146\ETX\ACKm\178\134\193P\SUB", _password = Just
// "mYo\132\144\131\150'\206lC{\157\159\174\ETX", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2,
// _willTopic = "\129\242\250\251\220\214\242\EOTx\180\v4H\156w\139\247zR\199u\172r\136\155\198\SUB", _willMsg =
// "\166V\216\GS\135B\DC4\223\177\149\223\195\178\NUL\DLER\206/Q'O\128-\EOT\134", _willProps = []}), _cleanSession =
// False, _keepAlive = 12650, _connID = "\180N\165", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x6c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x31, 0x6a, 0x0,  0x3,  0xb4, 0x4e,
                   0xa5, 0x0,  0x1b, 0x81, 0xf2, 0xfa, 0xfb, 0xdc, 0xd6, 0xf2, 0x4,  0x78, 0xb4, 0xb,  0x34, 0x48,
                   0x9c, 0x77, 0x8b, 0xf7, 0x7a, 0x52, 0xc7, 0x75, 0xac, 0x72, 0x88, 0x9b, 0xc6, 0x1a, 0x0,  0x19,
                   0xa6, 0x56, 0xd8, 0x1d, 0x87, 0x42, 0x14, 0xdf, 0xb1, 0x95, 0xdf, 0xc3, 0xb2, 0x0,  0x10, 0x52,
                   0xce, 0x2f, 0x51, 0x27, 0x4f, 0x80, 0x2d, 0x4,  0x86, 0x0,  0x11, 0x7c, 0xec, 0x72, 0xfc, 0x30,
                   0x4b, 0x75, 0x7b, 0x92, 0x3,  0x6,  0x6d, 0xb2, 0x86, 0xc1, 0x50, 0x1a, 0x0,  0x10, 0x6d, 0x59,
                   0x6f, 0x84, 0x90, 0x83, 0x96, 0x27, 0xce, 0x6c, 0x43, 0x7b, 0x9d, 0x9f, 0xae, 0x3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x81, 0xf2, 0xfa, 0xfb, 0xdc, 0xd6, 0xf2, 0x4,  0x78, 0xb4, 0xb,  0x34, 0x48, 0x9c,
                                0x77, 0x8b, 0xf7, 0x7a, 0x52, 0xc7, 0x75, 0xac, 0x72, 0x88, 0x9b, 0xc6, 0x1a};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa6, 0x56, 0xd8, 0x1d, 0x87, 0x42, 0x14, 0xdf, 0xb1, 0x95, 0xdf, 0xc3, 0xb2,
                                  0x0,  0x10, 0x52, 0xce, 0x2f, 0x51, 0x27, 0x4f, 0x80, 0x2d, 0x4,  0x86};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12650;
  uint8_t client_id_bytes[] = {0xb4, 0x4e, 0xa5};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7c, 0xec, 0x72, 0xfc, 0x30, 0x4b, 0x75, 0x7b, 0x92,
                              0x3,  0x6,  0x6d, 0xb2, 0x86, 0xc1, 0x50, 0x1a};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6d, 0x59, 0x6f, 0x84, 0x90, 0x83, 0x96, 0x27,
                              0xce, 0x6c, 0x43, 0x7b, 0x9d, 0x9f, 0xae, 0x3};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\176\SUB(", _password = Nothing, _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 9985, _connID = "\144\&3\142\215M", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x16, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4, 0x80, 0x27, 0x1,
                   0x0,  0x5,  0x90, 0x33, 0x8e, 0xd7, 0x4d, 0x0,  0x3, 0xb0, 0x1a, 0x28};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9985;
  uint8_t client_id_bytes[] = {0x90, 0x33, 0x8e, 0xd7, 0x4d};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb0, 0x1a, 0x28};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS2, _willTopic = "3\ENQ\159tA", _willMsg = "\253\&0\175\230\149U\228\219\161nq\159m\NAK", _willProps = []}),
// _cleanSession = True, _keepAlive = 2853, _connID = "\223k\158\244\196\196\240\228\&8\134\t*", _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x2f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0xb,  0x25, 0x0,  0xc,  0xdf, 0x6b, 0x9e,
                   0xf4, 0xc4, 0xc4, 0xf0, 0xe4, 0x38, 0x86, 0x9,  0x2a, 0x0,  0x5,  0x33, 0x5,  0x9f, 0x74, 0x41, 0x0,
                   0xe,  0xfd, 0x30, 0xaf, 0xe6, 0x95, 0x55, 0xe4, 0xdb, 0xa1, 0x6e, 0x71, 0x9f, 0x6d, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x33, 0x5, 0x9f, 0x74, 0x41};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfd, 0x30, 0xaf, 0xe6, 0x95, 0x55, 0xe4, 0xdb, 0xa1, 0x6e, 0x71, 0x9f, 0x6d, 0x15};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2853;
  uint8_t client_id_bytes[] = {0xdf, 0x6b, 0x9e, 0xf4, 0xc4, 0xc4, 0xf0, 0xe4, 0x38, 0x86, 0x9, 0x2a};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\"", _password = Just "\223>\255\222\&1+\192nU\183\230", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\b)e\236\251\251F\231*\144\171\179\130", _willMsg =
// "\224$\244h\238M\173a\166,{\149\167\153\201{\142.\175\&3A=\249\214\DC1\254oO\186", _willProps = []}), _cleanSession =
// False, _keepAlive = 26056, _connID = "c\EM'\202qq<\213", _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x52, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x65, 0xc8, 0x0,  0x8,  0x63, 0x19, 0x27,
                   0xca, 0x71, 0x71, 0x3c, 0xd5, 0x0,  0xd,  0x8,  0x29, 0x65, 0xec, 0xfb, 0xfb, 0x46, 0xe7, 0x2a, 0x90,
                   0xab, 0xb3, 0x82, 0x0,  0x1d, 0xe0, 0x24, 0xf4, 0x68, 0xee, 0x4d, 0xad, 0x61, 0xa6, 0x2c, 0x7b, 0x95,
                   0xa7, 0x99, 0xc9, 0x7b, 0x8e, 0x2e, 0xaf, 0x33, 0x41, 0x3d, 0xf9, 0xd6, 0x11, 0xfe, 0x6f, 0x4f, 0xba,
                   0x0,  0x1,  0x22, 0x0,  0xb,  0xdf, 0x3e, 0xff, 0xde, 0x31, 0x2b, 0xc0, 0x6e, 0x55, 0xb7, 0xe6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8, 0x29, 0x65, 0xec, 0xfb, 0xfb, 0x46, 0xe7, 0x2a, 0x90, 0xab, 0xb3, 0x82};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe0, 0x24, 0xf4, 0x68, 0xee, 0x4d, 0xad, 0x61, 0xa6, 0x2c,
                                  0x7b, 0x95, 0xa7, 0x99, 0xc9, 0x7b, 0x8e, 0x2e, 0xaf, 0x33,
                                  0x41, 0x3d, 0xf9, 0xd6, 0x11, 0xfe, 0x6f, 0x4f, 0xba};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26056;
  uint8_t client_id_bytes[] = {0x63, 0x19, 0x27, 0xca, 0x71, 0x71, 0x3c, 0xd5};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x22};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdf, 0x3e, 0xff, 0xde, 0x31, 0x2b, 0xc0, 0x6e, 0x55, 0xb7, 0xe6};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "\STX'd2\162\&8\201\179\247\166Y\212\\E\134\229", _willMsg =
// "\STX\227Q\213\190e/R\238\220$q\218Y~\146:~\ESCo\213\150\243\EM\156+r", _willProps = [PropAuthenticationData
// "\ETXF\215R\tc\193\146\155)L)t\228\209\160\&3",PropResponseInformation "\164=\207\DC1F#'",PropWillDelayInterval
// 28458,PropServerReference "rLeCgc9\145\228\139\222\\T\191\152ae\210\200$\253^\SI\212\207\183",PropReceiveMaximum
// 3407,PropContentType "\241\244\NAK\172u\202",PropMessageExpiryInterval 10130,PropTopicAlias
// 24003,PropWildcardSubscriptionAvailable 102,PropSharedSubscriptionAvailable 227,PropPayloadFormatIndicator
// 101,PropResponseTopic "e\233\141\253c{u\233F\157",PropSubscriptionIdentifier 29,PropSessionExpiryInterval
// 23489,PropTopicAlias 9645,PropTopicAliasMaximum 18361,PropResponseInformation "5Q\195[\231\v\220\175",PropMaximumQoS
// 161,PropWillDelayInterval 20412,PropSubscriptionIdentifier 22,PropSharedSubscriptionAvailable 163]}), _cleanSession =
// True, _keepAlive = 14707, _connID = "\r\239\133\224\t\138Z\SOHVQ\194n\b\"", _properties = [PropMessageExpiryInterval
// 17304,PropSharedSubscriptionAvailable 164,PropSubscriptionIdentifier 9,PropPayloadFormatIndicator
// 139,PropRequestResponseInformation 235,PropSessionExpiryInterval 29568,PropSharedSubscriptionAvailable
// 152,PropSubscriptionIdentifierAvailable 169,PropWildcardSubscriptionAvailable 44,PropMessageExpiryInterval
// 3448,PropSubscriptionIdentifierAvailable 209,PropMaximumPacketSize 15659,PropAuthenticationData
// "\SOHi<\231\155\175\202p\SUB\141\139,",PropContentType "\177\224\226",PropRequestResponseInformation
// 17,PropRetainAvailable 45,PropWillDelayInterval 25775,PropAssignedClientIdentifier
// "E\SYN\152\211\ACK\DLEQyB\ETB",PropWildcardSubscriptionAvailable 183,PropMaximumQoS 95,PropPayloadFormatIndicator
// 17,PropUserProperty "\204\EOT=*a\194\FSu\219" "\190\SUB\152*\f\185\210\192G",PropResponseTopic
// "\137B\219\251\200\RS\vO#\170r\162\SYNK\168\193\163Z\203$\249\130\218>\172",PropCorrelationData
// "\140ge\249\150\139]\140?\147",PropMessageExpiryInterval 2846,PropSubscriptionIdentifier 24,PropSessionExpiryInterval
// 13166,PropSubscriptionIdentifierAvailable 126,PropTopicAliasMaximum 21233,PropAuthenticationMethod
// "\203\165\NUL\CAN\237M\153M\198\213"]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x10, 0x8a, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0x39, 0x73, 0xb3, 0x1,  0x2,  0x0,  0x0,  0x43,
      0x98, 0x2a, 0xa4, 0xb,  0x9,  0x1,  0x8b, 0x19, 0xeb, 0x11, 0x0,  0x0,  0x73, 0x80, 0x2a, 0x98, 0x29, 0xa9, 0x28,
      0x2c, 0x2,  0x0,  0x0,  0xd,  0x78, 0x29, 0xd1, 0x27, 0x0,  0x0,  0x3d, 0x2b, 0x16, 0x0,  0xc,  0x1,  0x69, 0x3c,
      0xe7, 0x9b, 0xaf, 0xca, 0x70, 0x1a, 0x8d, 0x8b, 0x2c, 0x3,  0x0,  0x3,  0xb1, 0xe0, 0xe2, 0x19, 0x11, 0x25, 0x2d,
      0x18, 0x0,  0x0,  0x64, 0xaf, 0x12, 0x0,  0xa,  0x45, 0x16, 0x98, 0xd3, 0x6,  0x10, 0x51, 0x79, 0x42, 0x17, 0x28,
      0xb7, 0x24, 0x5f, 0x1,  0x11, 0x26, 0x0,  0x9,  0xcc, 0x4,  0x3d, 0x2a, 0x61, 0xc2, 0x1c, 0x75, 0xdb, 0x0,  0x9,
      0xbe, 0x1a, 0x98, 0x2a, 0xc,  0xb9, 0xd2, 0xc0, 0x47, 0x8,  0x0,  0x19, 0x89, 0x42, 0xdb, 0xfb, 0xc8, 0x1e, 0xb,
      0x4f, 0x23, 0xaa, 0x72, 0xa2, 0x16, 0x4b, 0xa8, 0xc1, 0xa3, 0x5a, 0xcb, 0x24, 0xf9, 0x82, 0xda, 0x3e, 0xac, 0x9,
      0x0,  0xa,  0x8c, 0x67, 0x65, 0xf9, 0x96, 0x8b, 0x5d, 0x8c, 0x3f, 0x93, 0x2,  0x0,  0x0,  0xb,  0x1e, 0xb,  0x18,
      0x11, 0x0,  0x0,  0x33, 0x6e, 0x29, 0x7e, 0x22, 0x52, 0xf1, 0x15, 0x0,  0xa,  0xcb, 0xa5, 0x0,  0x18, 0xed, 0x4d,
      0x99, 0x4d, 0xc6, 0xd5, 0x0,  0xe,  0xd,  0xef, 0x85, 0xe0, 0x9,  0x8a, 0x5a, 0x1,  0x56, 0x51, 0xc2, 0x6e, 0x8,
      0x22, 0x8a, 0x1,  0x16, 0x0,  0x11, 0x3,  0x46, 0xd7, 0x52, 0x9,  0x63, 0xc1, 0x92, 0x9b, 0x29, 0x4c, 0x29, 0x74,
      0xe4, 0xd1, 0xa0, 0x33, 0x1a, 0x0,  0x7,  0xa4, 0x3d, 0xcf, 0x11, 0x46, 0x23, 0x27, 0x18, 0x0,  0x0,  0x6f, 0x2a,
      0x1c, 0x0,  0x1a, 0x72, 0x4c, 0x65, 0x43, 0x67, 0x63, 0x39, 0x91, 0xe4, 0x8b, 0xde, 0x5c, 0x54, 0xbf, 0x98, 0x61,
      0x65, 0xd2, 0xc8, 0x24, 0xfd, 0x5e, 0xf,  0xd4, 0xcf, 0xb7, 0x21, 0xd,  0x4f, 0x3,  0x0,  0x6,  0xf1, 0xf4, 0x15,
      0xac, 0x75, 0xca, 0x2,  0x0,  0x0,  0x27, 0x92, 0x23, 0x5d, 0xc3, 0x28, 0x66, 0x2a, 0xe3, 0x1,  0x65, 0x8,  0x0,
      0xa,  0x65, 0xe9, 0x8d, 0xfd, 0x63, 0x7b, 0x75, 0xe9, 0x46, 0x9d, 0xb,  0x1d, 0x11, 0x0,  0x0,  0x5b, 0xc1, 0x23,
      0x25, 0xad, 0x22, 0x47, 0xb9, 0x1a, 0x0,  0x8,  0x35, 0x51, 0xc3, 0x5b, 0xe7, 0xb,  0xdc, 0xaf, 0x24, 0xa1, 0x18,
      0x0,  0x0,  0x4f, 0xbc, 0xb,  0x16, 0x2a, 0xa3, 0x0,  0x10, 0x2,  0x27, 0x64, 0x32, 0xa2, 0x38, 0xc9, 0xb3, 0xf7,
      0xa6, 0x59, 0xd4, 0x5c, 0x45, 0x86, 0xe5, 0x0,  0x1b, 0x2,  0xe3, 0x51, 0xd5, 0xbe, 0x65, 0x2f, 0x52, 0xee, 0xdc,
      0x24, 0x71, 0xda, 0x59, 0x7e, 0x92, 0x3a, 0x7e, 0x1b, 0x6f, 0xd5, 0x96, 0xf3, 0x19, 0x9c, 0x2b, 0x72};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1, 0x69, 0x3c, 0xe7, 0x9b, 0xaf, 0xca, 0x70, 0x1a, 0x8d, 0x8b, 0x2c};
  uint8_t bytesprops1[] = {0xb1, 0xe0, 0xe2};
  uint8_t bytesprops2[] = {0x45, 0x16, 0x98, 0xd3, 0x6, 0x10, 0x51, 0x79, 0x42, 0x17};
  uint8_t bytesprops4[] = {0xbe, 0x1a, 0x98, 0x2a, 0xc, 0xb9, 0xd2, 0xc0, 0x47};
  uint8_t bytesprops3[] = {0xcc, 0x4, 0x3d, 0x2a, 0x61, 0xc2, 0x1c, 0x75, 0xdb};
  uint8_t bytesprops5[] = {0x89, 0x42, 0xdb, 0xfb, 0xc8, 0x1e, 0xb,  0x4f, 0x23, 0xaa, 0x72, 0xa2, 0x16,
                           0x4b, 0xa8, 0xc1, 0xa3, 0x5a, 0xcb, 0x24, 0xf9, 0x82, 0xda, 0x3e, 0xac};
  uint8_t bytesprops6[] = {0x8c, 0x67, 0x65, 0xf9, 0x96, 0x8b, 0x5d, 0x8c, 0x3f, 0x93};
  uint8_t bytesprops7[] = {0xcb, 0xa5, 0x0, 0x18, 0xed, 0x4d, 0x99, 0x4d, 0xc6, 0xd5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17304}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29568}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3448}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15659}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25775}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops3}, .v = {9, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2846}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13166}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21233}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x3,  0x46, 0xd7, 0x52, 0x9,  0x63, 0xc1, 0x92, 0x9b,
                               0x29, 0x4c, 0x29, 0x74, 0xe4, 0xd1, 0xa0, 0x33};
  uint8_t byteswillprops1[] = {0xa4, 0x3d, 0xcf, 0x11, 0x46, 0x23, 0x27};
  uint8_t byteswillprops2[] = {0x72, 0x4c, 0x65, 0x43, 0x67, 0x63, 0x39, 0x91, 0xe4, 0x8b, 0xde, 0x5c, 0x54,
                               0xbf, 0x98, 0x61, 0x65, 0xd2, 0xc8, 0x24, 0xfd, 0x5e, 0xf,  0xd4, 0xcf, 0xb7};
  uint8_t byteswillprops3[] = {0xf1, 0xf4, 0x15, 0xac, 0x75, 0xca};
  uint8_t byteswillprops4[] = {0x65, 0xe9, 0x8d, 0xfd, 0x63, 0x7b, 0x75, 0xe9, 0x46, 0x9d};
  uint8_t byteswillprops5[] = {0x35, 0x51, 0xc3, 0x5b, 0xe7, 0xb, 0xdc, 0xaf};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28458}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3407}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10130}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24003}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23489}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9645}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18361}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20412}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 163}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2,  0x27, 0x64, 0x32, 0xa2, 0x38, 0xc9, 0xb3,
                                0xf7, 0xa6, 0x59, 0xd4, 0x5c, 0x45, 0x86, 0xe5};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2,  0xe3, 0x51, 0xd5, 0xbe, 0x65, 0x2f, 0x52, 0xee, 0xdc, 0x24, 0x71, 0xda, 0x59,
                                  0x7e, 0x92, 0x3a, 0x7e, 0x1b, 0x6f, 0xd5, 0x96, 0xf3, 0x19, 0x9c, 0x2b, 0x72};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14707;
  uint8_t client_id_bytes[] = {0xd, 0xef, 0x85, 0xe0, 0x9, 0x8a, 0x5a, 0x1, 0x56, 0x51, 0xc2, 0x6e, 0x8, 0x22};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\175\223\237\151\165\143\181\186", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\224\241\206\223", _willMsg = "<\185B\DC1", _willProps =
// [PropMessageExpiryInterval 1034,PropSessionExpiryInterval 31898,PropResponseTopic
// "\210v\SO\SUBo\176\252D\254E\201\249\215",PropReasonString
// "\160\149\135=Y\158\196\164U\181\234\146\SUB\254\165\&5\155\142",PropRequestProblemInformation
// 101,PropRequestProblemInformation 176,PropWildcardSubscriptionAvailable 20,PropWillDelayInterval
// 4616,PropRequestResponseInformation 145,PropWillDelayInterval 18288,PropMaximumQoS 156,PropPayloadFormatIndicator
// 62,PropRequestProblemInformation 18,PropSharedSubscriptionAvailable 115,PropTopicAliasMaximum
// 22616,PropResponseInformation
// "\DC2\175\214I\187\207\223\163\CAN\152\ACK\233\146\212\243\ACKz\EOT\SUB_p\133O4\129",PropTopicAlias
// 20857,PropMaximumQoS 196,PropReasonString "h\US\236\151=n\187\231\191",PropReceiveMaximum
// 19853,PropSubscriptionIdentifier 9,PropMaximumPacketSize 19027,PropContentType "\b\222\232\167?\RS\235\142\166"]}),
// _cleanSession = True, _keepAlive = 12709, _connID = "qR&\218b\224.r|a\206\139\226\174(\216\EM\193", _properties =
// [PropAuthenticationMethod "(\181n\166?J(\193mV\209\EOT\ETBf\STX\237\186",PropWildcardSubscriptionAvailable
// 1,PropMaximumPacketSize 21071,PropTopicAliasMaximum 31849,PropRequestResponseInformation 197,PropTopicAlias
// 8324,PropResponseInformation "\206\134T\208\173z\244\213rTxH\155N\212\221\137J\214\229\r\178",PropAuthenticationData
// "\241n\165:B\CAN\156\194\170\204\&9\a\217G",PropTopicAlias 14445,PropSharedSubscriptionAvailable
// 83,PropReceiveMaximum 5739,PropSessionExpiryInterval 6584]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0xa0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4e, 0x31, 0xa5, 0x5a, 0x15, 0x0,  0x11, 0x28, 0xb5,
      0x6e, 0xa6, 0x3f, 0x4a, 0x28, 0xc1, 0x6d, 0x56, 0xd1, 0x4,  0x17, 0x66, 0x2,  0xed, 0xba, 0x28, 0x1,  0x27, 0x0,
      0x0,  0x52, 0x4f, 0x22, 0x7c, 0x69, 0x19, 0xc5, 0x23, 0x20, 0x84, 0x1a, 0x0,  0x16, 0xce, 0x86, 0x54, 0xd0, 0xad,
      0x7a, 0xf4, 0xd5, 0x72, 0x54, 0x78, 0x48, 0x9b, 0x4e, 0xd4, 0xdd, 0x89, 0x4a, 0xd6, 0xe5, 0xd,  0xb2, 0x16, 0x0,
      0xe,  0xf1, 0x6e, 0xa5, 0x3a, 0x42, 0x18, 0x9c, 0xc2, 0xaa, 0xcc, 0x39, 0x7,  0xd9, 0x47, 0x23, 0x38, 0x6d, 0x2a,
      0x53, 0x21, 0x16, 0x6b, 0x11, 0x0,  0x0,  0x19, 0xb8, 0x0,  0x12, 0x71, 0x52, 0x26, 0xda, 0x62, 0xe0, 0x2e, 0x72,
      0x7c, 0x61, 0xce, 0x8b, 0xe2, 0xae, 0x28, 0xd8, 0x19, 0xc1, 0x8f, 0x1,  0x2,  0x0,  0x0,  0x4,  0xa,  0x11, 0x0,
      0x0,  0x7c, 0x9a, 0x8,  0x0,  0xd,  0xd2, 0x76, 0xe,  0x1a, 0x6f, 0xb0, 0xfc, 0x44, 0xfe, 0x45, 0xc9, 0xf9, 0xd7,
      0x1f, 0x0,  0x12, 0xa0, 0x95, 0x87, 0x3d, 0x59, 0x9e, 0xc4, 0xa4, 0x55, 0xb5, 0xea, 0x92, 0x1a, 0xfe, 0xa5, 0x35,
      0x9b, 0x8e, 0x17, 0x65, 0x17, 0xb0, 0x28, 0x14, 0x18, 0x0,  0x0,  0x12, 0x8,  0x19, 0x91, 0x18, 0x0,  0x0,  0x47,
      0x70, 0x24, 0x9c, 0x1,  0x3e, 0x17, 0x12, 0x2a, 0x73, 0x22, 0x58, 0x58, 0x1a, 0x0,  0x19, 0x12, 0xaf, 0xd6, 0x49,
      0xbb, 0xcf, 0xdf, 0xa3, 0x18, 0x98, 0x6,  0xe9, 0x92, 0xd4, 0xf3, 0x6,  0x7a, 0x4,  0x1a, 0x5f, 0x70, 0x85, 0x4f,
      0x34, 0x81, 0x23, 0x51, 0x79, 0x24, 0xc4, 0x1f, 0x0,  0x9,  0x68, 0x1f, 0xec, 0x97, 0x3d, 0x6e, 0xbb, 0xe7, 0xbf,
      0x21, 0x4d, 0x8d, 0xb,  0x9,  0x27, 0x0,  0x0,  0x4a, 0x53, 0x3,  0x0,  0x9,  0x8,  0xde, 0xe8, 0xa7, 0x3f, 0x1e,
      0xeb, 0x8e, 0xa6, 0x0,  0x4,  0xe0, 0xf1, 0xce, 0xdf, 0x0,  0x4,  0x3c, 0xb9, 0x42, 0x11, 0x0,  0x8,  0xaf, 0xdf,
      0xed, 0x97, 0xa5, 0x8f, 0xb5, 0xba};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x28, 0xb5, 0x6e, 0xa6, 0x3f, 0x4a, 0x28, 0xc1, 0x6d,
                           0x56, 0xd1, 0x4,  0x17, 0x66, 0x2,  0xed, 0xba};
  uint8_t bytesprops1[] = {0xce, 0x86, 0x54, 0xd0, 0xad, 0x7a, 0xf4, 0xd5, 0x72, 0x54, 0x78,
                           0x48, 0x9b, 0x4e, 0xd4, 0xdd, 0x89, 0x4a, 0xd6, 0xe5, 0xd,  0xb2};
  uint8_t bytesprops2[] = {0xf1, 0x6e, 0xa5, 0x3a, 0x42, 0x18, 0x9c, 0xc2, 0xaa, 0xcc, 0x39, 0x7, 0xd9, 0x47};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21071}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31849}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8324}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14445}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5739}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6584}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd2, 0x76, 0xe, 0x1a, 0x6f, 0xb0, 0xfc, 0x44, 0xfe, 0x45, 0xc9, 0xf9, 0xd7};
  uint8_t byteswillprops1[] = {0xa0, 0x95, 0x87, 0x3d, 0x59, 0x9e, 0xc4, 0xa4, 0x55,
                               0xb5, 0xea, 0x92, 0x1a, 0xfe, 0xa5, 0x35, 0x9b, 0x8e};
  uint8_t byteswillprops2[] = {0x12, 0xaf, 0xd6, 0x49, 0xbb, 0xcf, 0xdf, 0xa3, 0x18, 0x98, 0x6,  0xe9, 0x92,
                               0xd4, 0xf3, 0x6,  0x7a, 0x4,  0x1a, 0x5f, 0x70, 0x85, 0x4f, 0x34, 0x81};
  uint8_t byteswillprops3[] = {0x68, 0x1f, 0xec, 0x97, 0x3d, 0x6e, 0xbb, 0xe7, 0xbf};
  uint8_t byteswillprops4[] = {0x8, 0xde, 0xe8, 0xa7, 0x3f, 0x1e, 0xeb, 0x8e, 0xa6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1034}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31898}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4616}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18288}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22616}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20857}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19853}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19027}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops4}}},
  };

  lwmqtt_properties_t willprops = {23, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe0, 0xf1, 0xce, 0xdf};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3c, 0xb9, 0x42, 0x11};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 12709;
  uint8_t client_id_bytes[] = {0x71, 0x52, 0x26, 0xda, 0x62, 0xe0, 0x2e, 0x72, 0x7c,
                               0x61, 0xce, 0x8b, 0xe2, 0xae, 0x28, 0xd8, 0x19, 0xc1};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xaf, 0xdf, 0xed, 0x97, 0xa5, 0x8f, 0xb5, 0xba};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\223\255G", _password = Just "#\227\223\166s\STX2\230O\200nx\147\&0y\STX",
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 17542, _connID = "S_\ACKjq\165\200(O\181\US\v\216",
// _properties = [PropReasonString
// "\GS5\184CN\212\220\251F\248Ns^d\215\bP\215\f(\229L\242\198\226CA\212\f\163",PropAuthenticationData
// "\\%r;\180,\250\&5@\181\240H]\DC3",PropCorrelationData
// "\172\SUB\153\180\166\193\140\&9\237\t\252b\187\142\168R+\153\188Y\167\149\DC3\216",PropCorrelationData
// "\RS\177nf\SOHNjf\136\154WH\200\SOH\191\248\134\t\145d\251C\165\DC4",PropSubscriptionIdentifier
// 4,PropWildcardSubscriptionAvailable 38,PropResponseTopic
// "^Aj$\254\245\247\151yq\149@\222u/\192\246\147\176b~{V\147\209\155\CAN\191",PropServerReference
// "h\231\169g\ENQ\v\US\US\185}\ESC\ESCg\DC3b",PropAuthenticationData "\130\218\159",PropServerKeepAlive
// 12114,PropSharedSubscriptionAvailable 195,PropSharedSubscriptionAvailable 239,PropResponseTopic
// "N\164\216\a\188\227v\DEL\242\SIt\SO\141\&0k\244",PropAuthenticationData
// "\STXj\219\249\b\236\255\212]",PropRetainAvailable 142,PropPayloadFormatIndicator 108,PropMessageExpiryInterval
// 16583]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0x84, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x44, 0x86, 0xd2, 0x1,  0x1f, 0x0,  0x1e, 0x1d,
      0x35, 0xb8, 0x43, 0x4e, 0xd4, 0xdc, 0xfb, 0x46, 0xf8, 0x4e, 0x73, 0x5e, 0x64, 0xd7, 0x8,  0x50, 0xd7, 0xc,  0x28,
      0xe5, 0x4c, 0xf2, 0xc6, 0xe2, 0x43, 0x41, 0xd4, 0xc,  0xa3, 0x16, 0x0,  0xe,  0x5c, 0x25, 0x72, 0x3b, 0xb4, 0x2c,
      0xfa, 0x35, 0x40, 0xb5, 0xf0, 0x48, 0x5d, 0x13, 0x9,  0x0,  0x18, 0xac, 0x1a, 0x99, 0xb4, 0xa6, 0xc1, 0x8c, 0x39,
      0xed, 0x9,  0xfc, 0x62, 0xbb, 0x8e, 0xa8, 0x52, 0x2b, 0x99, 0xbc, 0x59, 0xa7, 0x95, 0x13, 0xd8, 0x9,  0x0,  0x18,
      0x1e, 0xb1, 0x6e, 0x66, 0x1,  0x4e, 0x6a, 0x66, 0x88, 0x9a, 0x57, 0x48, 0xc8, 0x1,  0xbf, 0xf8, 0x86, 0x9,  0x91,
      0x64, 0xfb, 0x43, 0xa5, 0x14, 0xb,  0x4,  0x28, 0x26, 0x8,  0x0,  0x1c, 0x5e, 0x41, 0x6a, 0x24, 0xfe, 0xf5, 0xf7,
      0x97, 0x79, 0x71, 0x95, 0x40, 0xde, 0x75, 0x2f, 0xc0, 0xf6, 0x93, 0xb0, 0x62, 0x7e, 0x7b, 0x56, 0x93, 0xd1, 0x9b,
      0x18, 0xbf, 0x1c, 0x0,  0xf,  0x68, 0xe7, 0xa9, 0x67, 0x5,  0xb,  0x1f, 0x1f, 0xb9, 0x7d, 0x1b, 0x1b, 0x67, 0x13,
      0x62, 0x16, 0x0,  0x3,  0x82, 0xda, 0x9f, 0x13, 0x2f, 0x52, 0x2a, 0xc3, 0x2a, 0xef, 0x8,  0x0,  0x10, 0x4e, 0xa4,
      0xd8, 0x7,  0xbc, 0xe3, 0x76, 0x7f, 0xf2, 0xf,  0x74, 0xe,  0x8d, 0x30, 0x6b, 0xf4, 0x16, 0x0,  0x9,  0x2,  0x6a,
      0xdb, 0xf9, 0x8,  0xec, 0xff, 0xd4, 0x5d, 0x25, 0x8e, 0x1,  0x6c, 0x2,  0x0,  0x0,  0x40, 0xc7, 0x0,  0xd,  0x53,
      0x5f, 0x6,  0x6a, 0x71, 0xa5, 0xc8, 0x28, 0x4f, 0xb5, 0x1f, 0xb,  0xd8, 0x0,  0x3,  0xdf, 0xff, 0x47, 0x0,  0x10,
      0x23, 0xe3, 0xdf, 0xa6, 0x73, 0x2,  0x32, 0xe6, 0x4f, 0xc8, 0x6e, 0x78, 0x93, 0x30, 0x79, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1d, 0x35, 0xb8, 0x43, 0x4e, 0xd4, 0xdc, 0xfb, 0x46, 0xf8, 0x4e, 0x73, 0x5e, 0x64, 0xd7,
                           0x8,  0x50, 0xd7, 0xc,  0x28, 0xe5, 0x4c, 0xf2, 0xc6, 0xe2, 0x43, 0x41, 0xd4, 0xc,  0xa3};
  uint8_t bytesprops1[] = {0x5c, 0x25, 0x72, 0x3b, 0xb4, 0x2c, 0xfa, 0x35, 0x40, 0xb5, 0xf0, 0x48, 0x5d, 0x13};
  uint8_t bytesprops2[] = {0xac, 0x1a, 0x99, 0xb4, 0xa6, 0xc1, 0x8c, 0x39, 0xed, 0x9,  0xfc, 0x62,
                           0xbb, 0x8e, 0xa8, 0x52, 0x2b, 0x99, 0xbc, 0x59, 0xa7, 0x95, 0x13, 0xd8};
  uint8_t bytesprops3[] = {0x1e, 0xb1, 0x6e, 0x66, 0x1,  0x4e, 0x6a, 0x66, 0x88, 0x9a, 0x57, 0x48,
                           0xc8, 0x1,  0xbf, 0xf8, 0x86, 0x9,  0x91, 0x64, 0xfb, 0x43, 0xa5, 0x14};
  uint8_t bytesprops4[] = {0x5e, 0x41, 0x6a, 0x24, 0xfe, 0xf5, 0xf7, 0x97, 0x79, 0x71, 0x95, 0x40, 0xde, 0x75,
                           0x2f, 0xc0, 0xf6, 0x93, 0xb0, 0x62, 0x7e, 0x7b, 0x56, 0x93, 0xd1, 0x9b, 0x18, 0xbf};
  uint8_t bytesprops5[] = {0x68, 0xe7, 0xa9, 0x67, 0x5, 0xb, 0x1f, 0x1f, 0xb9, 0x7d, 0x1b, 0x1b, 0x67, 0x13, 0x62};
  uint8_t bytesprops6[] = {0x82, 0xda, 0x9f};
  uint8_t bytesprops7[] = {0x4e, 0xa4, 0xd8, 0x7, 0xbc, 0xe3, 0x76, 0x7f, 0xf2, 0xf, 0x74, 0xe, 0x8d, 0x30, 0x6b, 0xf4};
  uint8_t bytesprops8[] = {0x2, 0x6a, 0xdb, 0xf9, 0x8, 0xec, 0xff, 0xd4, 0x5d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12114}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16583}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17542;
  uint8_t client_id_bytes[] = {0x53, 0x5f, 0x6, 0x6a, 0x71, 0xa5, 0xc8, 0x28, 0x4f, 0xb5, 0x1f, 0xb, 0xd8};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xdf, 0xff, 0x47};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x23, 0xe3, 0xdf, 0xa6, 0x73, 0x2,  0x32, 0xe6,
                              0x4f, 0xc8, 0x6e, 0x78, 0x93, 0x30, 0x79, 0x2};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\228O\159\147\140e", _password = Just
// "I7\205O\249\210\201\ACK\248\fH\247\&4\ENQ\139\231o\196", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 1450, _connID = "m\207\182 \176\137\206\172\198Q\255\173\143\SYN\154\153\143\208\181\155ao_\227\206", _properties =
// [PropRetainAvailable 254,PropResponseInformation
// "\161\130\218n\239\254X<m8rC\148\159\187(\162B\174Y\168\237",PropMessageExpiryInterval 2257,PropUserProperty ""
// "\174\STX\132\\H\n\251V\172\159-\248\&2~K_Z\166\f\CANi\210I",PropRetainAvailable 99,PropResponseTopic
// "\184\234\195\SYN\130TI\151\180\249\240\b\229\169J\236",PropReasonString "\159\CAN\240L\219\167\128\206\rr\136D"]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0xa2, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x5,  0xaa, 0x60, 0x25, 0xfe, 0x1a,
                   0x0,  0x16, 0xa1, 0x82, 0xda, 0x6e, 0xef, 0xfe, 0x58, 0x3c, 0x6d, 0x38, 0x72, 0x43, 0x94, 0x9f, 0xbb,
                   0x28, 0xa2, 0x42, 0xae, 0x59, 0xa8, 0xed, 0x2,  0x0,  0x0,  0x8,  0xd1, 0x26, 0x0,  0x0,  0x0,  0x17,
                   0xae, 0x2,  0x84, 0x5c, 0x48, 0xa,  0xfb, 0x56, 0xac, 0x9f, 0x2d, 0xf8, 0x32, 0x7e, 0x4b, 0x5f, 0x5a,
                   0xa6, 0xc,  0x18, 0x69, 0xd2, 0x49, 0x25, 0x63, 0x8,  0x0,  0x10, 0xb8, 0xea, 0xc3, 0x16, 0x82, 0x54,
                   0x49, 0x97, 0xb4, 0xf9, 0xf0, 0x8,  0xe5, 0xa9, 0x4a, 0xec, 0x1f, 0x0,  0xc,  0x9f, 0x18, 0xf0, 0x4c,
                   0xdb, 0xa7, 0x80, 0xce, 0xd,  0x72, 0x88, 0x44, 0x0,  0x19, 0x6d, 0xcf, 0xb6, 0x20, 0xb0, 0x89, 0xce,
                   0xac, 0xc6, 0x51, 0xff, 0xad, 0x8f, 0x16, 0x9a, 0x99, 0x8f, 0xd0, 0xb5, 0x9b, 0x61, 0x6f, 0x5f, 0xe3,
                   0xce, 0x0,  0x6,  0xe4, 0x4f, 0x9f, 0x93, 0x8c, 0x65, 0x0,  0x12, 0x49, 0x37, 0xcd, 0x4f, 0xf9, 0xd2,
                   0xc9, 0x6,  0xf8, 0xc,  0x48, 0xf7, 0x34, 0x5,  0x8b, 0xe7, 0x6f, 0xc4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa1, 0x82, 0xda, 0x6e, 0xef, 0xfe, 0x58, 0x3c, 0x6d, 0x38, 0x72,
                           0x43, 0x94, 0x9f, 0xbb, 0x28, 0xa2, 0x42, 0xae, 0x59, 0xa8, 0xed};
  uint8_t bytesprops2[] = {0xae, 0x2,  0x84, 0x5c, 0x48, 0xa,  0xfb, 0x56, 0xac, 0x9f, 0x2d, 0xf8,
                           0x32, 0x7e, 0x4b, 0x5f, 0x5a, 0xa6, 0xc,  0x18, 0x69, 0xd2, 0x49};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops3[] = {0xb8, 0xea, 0xc3, 0x16, 0x82, 0x54, 0x49, 0x97,
                           0xb4, 0xf9, 0xf0, 0x8,  0xe5, 0xa9, 0x4a, 0xec};
  uint8_t bytesprops4[] = {0x9f, 0x18, 0xf0, 0x4c, 0xdb, 0xa7, 0x80, 0xce, 0xd, 0x72, 0x88, 0x44};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2257}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops1}, .v = {23, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1450;
  uint8_t client_id_bytes[] = {0x6d, 0xcf, 0xb6, 0x20, 0xb0, 0x89, 0xce, 0xac, 0xc6, 0x51, 0xff, 0xad, 0x8f,
                               0x16, 0x9a, 0x99, 0x8f, 0xd0, 0xb5, 0x9b, 0x61, 0x6f, 0x5f, 0xe3, 0xce};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe4, 0x4f, 0x9f, 0x93, 0x8c, 0x65};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x49, 0x37, 0xcd, 0x4f, 0xf9, 0xd2, 0xc9, 0x6,  0xf8,
                              0xc,  0x48, 0xf7, 0x34, 0x5,  0x8b, 0xe7, 0x6f, 0xc4};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "ZY*\212\&2v\CAN\238\SYN\243Z-\210z\SO\229X\164`\136 \ETB\246\182zw}0\148\v",
// _password = Just "\150\&2b)", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "KY\242", _willMsg = "]\169\158\183\223\181L\153xld\SI\SI\155\&6\211\239", _willProps = [PropPayloadFormatIndicator
// 220,PropSubscriptionIdentifierAvailable 110]}), _cleanSession = False, _keepAlive = 18195, _connID =
// "v\132\v6\r\164\241\&1VUf\239\GS\210\201!\158\240\&7\194", _properties = [PropUserProperty "a@jf\155l\144\ETB"
// "=\253\157\&1\197x\172n\183\254\167\224\&8\213[>\185\251\144Y",PropResponseInformation
// "'\167\&8.\139\212z\217\190\&8\172\211&",PropServerKeepAlive 21621,PropAuthenticationData
// "\DLEb\151\235K\180,>~\152\237IY",PropReceiveMaximum 10685,PropWillDelayInterval
// 31891,PropSubscriptionIdentifierAvailable 89,PropCorrelationData
// "~x\220\246\&6\168\221b:\183/\221\172\ETX\ENQ",PropMessageExpiryInterval 30900,PropAssignedClientIdentifier
// "<",PropWillDelayInterval 8778,PropMessageExpiryInterval 27,PropReceiveMaximum 16802]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x10, 0xda, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x47, 0x13, 0x76, 0x26, 0x0,  0x8,  0x61, 0x40,
      0x6a, 0x66, 0x9b, 0x6c, 0x90, 0x17, 0x0,  0x14, 0x3d, 0xfd, 0x9d, 0x31, 0xc5, 0x78, 0xac, 0x6e, 0xb7, 0xfe, 0xa7,
      0xe0, 0x38, 0xd5, 0x5b, 0x3e, 0xb9, 0xfb, 0x90, 0x59, 0x1a, 0x0,  0xd,  0x27, 0xa7, 0x38, 0x2e, 0x8b, 0xd4, 0x7a,
      0xd9, 0xbe, 0x38, 0xac, 0xd3, 0x26, 0x13, 0x54, 0x75, 0x16, 0x0,  0xd,  0x10, 0x62, 0x97, 0xeb, 0x4b, 0xb4, 0x2c,
      0x3e, 0x7e, 0x98, 0xed, 0x49, 0x59, 0x21, 0x29, 0xbd, 0x18, 0x0,  0x0,  0x7c, 0x93, 0x29, 0x59, 0x9,  0x0,  0xf,
      0x7e, 0x78, 0xdc, 0xf6, 0x36, 0xa8, 0xdd, 0x62, 0x3a, 0xb7, 0x2f, 0xdd, 0xac, 0x3,  0x5,  0x2,  0x0,  0x0,  0x78,
      0xb4, 0x12, 0x0,  0x1,  0x3c, 0x18, 0x0,  0x0,  0x22, 0x4a, 0x2,  0x0,  0x0,  0x0,  0x1b, 0x21, 0x41, 0xa2, 0x0,
      0x14, 0x76, 0x84, 0xb,  0x36, 0xd,  0xa4, 0xf1, 0x31, 0x56, 0x55, 0x66, 0xef, 0x1d, 0xd2, 0xc9, 0x21, 0x9e, 0xf0,
      0x37, 0xc2, 0x4,  0x1,  0xdc, 0x29, 0x6e, 0x0,  0x3,  0x4b, 0x59, 0xf2, 0x0,  0x11, 0x5d, 0xa9, 0x9e, 0xb7, 0xdf,
      0xb5, 0x4c, 0x99, 0x78, 0x6c, 0x64, 0xf,  0xf,  0x9b, 0x36, 0xd3, 0xef, 0x0,  0x1e, 0x5a, 0x59, 0x2a, 0xd4, 0x32,
      0x76, 0x18, 0xee, 0x16, 0xf3, 0x5a, 0x2d, 0xd2, 0x7a, 0xe,  0xe5, 0x58, 0xa4, 0x60, 0x88, 0x20, 0x17, 0xf6, 0xb6,
      0x7a, 0x77, 0x7d, 0x30, 0x94, 0xb,  0x0,  0x4,  0x96, 0x32, 0x62, 0x29};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x3d, 0xfd, 0x9d, 0x31, 0xc5, 0x78, 0xac, 0x6e, 0xb7, 0xfe,
                           0xa7, 0xe0, 0x38, 0xd5, 0x5b, 0x3e, 0xb9, 0xfb, 0x90, 0x59};
  uint8_t bytesprops0[] = {0x61, 0x40, 0x6a, 0x66, 0x9b, 0x6c, 0x90, 0x17};
  uint8_t bytesprops2[] = {0x27, 0xa7, 0x38, 0x2e, 0x8b, 0xd4, 0x7a, 0xd9, 0xbe, 0x38, 0xac, 0xd3, 0x26};
  uint8_t bytesprops3[] = {0x10, 0x62, 0x97, 0xeb, 0x4b, 0xb4, 0x2c, 0x3e, 0x7e, 0x98, 0xed, 0x49, 0x59};
  uint8_t bytesprops4[] = {0x7e, 0x78, 0xdc, 0xf6, 0x36, 0xa8, 0xdd, 0x62, 0x3a, 0xb7, 0x2f, 0xdd, 0xac, 0x3, 0x5};
  uint8_t bytesprops5[] = {0x3c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21621}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10685}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31891}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30900}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8778}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16802}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 110}},
  };

  lwmqtt_properties_t willprops = {2, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4b, 0x59, 0xf2};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5d, 0xa9, 0x9e, 0xb7, 0xdf, 0xb5, 0x4c, 0x99, 0x78,
                                  0x6c, 0x64, 0xf,  0xf,  0x9b, 0x36, 0xd3, 0xef};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18195;
  uint8_t client_id_bytes[] = {0x76, 0x84, 0xb,  0x36, 0xd,  0xa4, 0xf1, 0x31, 0x56, 0x55,
                               0x66, 0xef, 0x1d, 0xd2, 0xc9, 0x21, 0x9e, 0xf0, 0x37, 0xc2};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5a, 0x59, 0x2a, 0xd4, 0x32, 0x76, 0x18, 0xee, 0x16, 0xf3, 0x5a, 0x2d, 0xd2, 0x7a, 0xe,
                              0xe5, 0x58, 0xa4, 0x60, 0x88, 0x20, 0x17, 0xf6, 0xb6, 0x7a, 0x77, 0x7d, 0x30, 0x94, 0xb};
  lwmqtt_string_t username = {30, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0x32, 0x62, 0x29};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\STXjT\248\ACK\158\156\227\216x\233}\DC4q\198\140ca\207\230", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "_\192D\194~\218adY0\244u\190og1\210Y\200", _willMsg = "\188\&4\154k=\225N", _willProps = [PropMaximumPacketSize
// 19884,PropWildcardSubscriptionAvailable 196,PropWildcardSubscriptionAvailable 154,PropAuthenticationData
// "\130\251\240\DC3\153M@\ACK\155\ESC@o9\224;3c\248X",PropResponseTopic "@\245\178\196U\228\169L*\217\163\ACK\240"]}),
// _cleanSession = True, _keepAlive = 16867, _connID = "h\ETX\237n0\202\ETX/\213\ESC\174\136'\218lQ\144\n\175\151\132",
// _properties = [PropResponseTopic "<E\138\249\202\216\245\SI\142l\184\161\225\216",PropMessageExpiryInterval
// 17077,PropServerKeepAlive 26736,PropWillDelayInterval 647,PropContentType
// "\238B\161\159r\150`\137'X\130\245\199\139\175w\145\STX\132\137",PropCorrelationData
// "\155\245\131&\242\237\230\238\163\175",PropAuthenticationData "\\\DC48\230\222\239\167V",PropTopicAlias
// 19408,PropResponseInformation "+\178\186-\137\132\207\170\188",PropRetainAvailable 126,PropResponseInformation
// "D\215\252\214\168",PropSessionExpiryInterval 19138,PropServerKeepAlive 31520,PropAuthenticationData "2Cq"]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0xfa, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x96, 0x41, 0xe3, 0x74, 0x8,  0x0,  0xe,
                   0x3c, 0x45, 0x8a, 0xf9, 0xca, 0xd8, 0xf5, 0xf,  0x8e, 0x6c, 0xb8, 0xa1, 0xe1, 0xd8, 0x2,  0x0,  0x0,
                   0x42, 0xb5, 0x13, 0x68, 0x70, 0x18, 0x0,  0x0,  0x2,  0x87, 0x3,  0x0,  0x14, 0xee, 0x42, 0xa1, 0x9f,
                   0x72, 0x96, 0x60, 0x89, 0x27, 0x58, 0x82, 0xf5, 0xc7, 0x8b, 0xaf, 0x77, 0x91, 0x2,  0x84, 0x89, 0x9,
                   0x0,  0xa,  0x9b, 0xf5, 0x83, 0x26, 0xf2, 0xed, 0xe6, 0xee, 0xa3, 0xaf, 0x16, 0x0,  0x8,  0x5c, 0x14,
                   0x38, 0xe6, 0xde, 0xef, 0xa7, 0x56, 0x23, 0x4b, 0xd0, 0x1a, 0x0,  0x9,  0x2b, 0xb2, 0xba, 0x2d, 0x89,
                   0x84, 0xcf, 0xaa, 0xbc, 0x25, 0x7e, 0x1a, 0x0,  0x5,  0x44, 0xd7, 0xfc, 0xd6, 0xa8, 0x11, 0x0,  0x0,
                   0x4a, 0xc2, 0x13, 0x7b, 0x20, 0x16, 0x0,  0x3,  0x32, 0x43, 0x71, 0x0,  0x15, 0x68, 0x3,  0xed, 0x6e,
                   0x30, 0xca, 0x3,  0x2f, 0xd5, 0x1b, 0xae, 0x88, 0x27, 0xda, 0x6c, 0x51, 0x90, 0xa,  0xaf, 0x97, 0x84,
                   0x2f, 0x27, 0x0,  0x0,  0x4d, 0xac, 0x28, 0xc4, 0x28, 0x9a, 0x16, 0x0,  0x13, 0x82, 0xfb, 0xf0, 0x13,
                   0x99, 0x4d, 0x40, 0x6,  0x9b, 0x1b, 0x40, 0x6f, 0x39, 0xe0, 0x3b, 0x33, 0x63, 0xf8, 0x58, 0x8,  0x0,
                   0xd,  0x40, 0xf5, 0xb2, 0xc4, 0x55, 0xe4, 0xa9, 0x4c, 0x2a, 0xd9, 0xa3, 0x6,  0xf0, 0x0,  0x13, 0x5f,
                   0xc0, 0x44, 0xc2, 0x7e, 0xda, 0x61, 0x64, 0x59, 0x30, 0xf4, 0x75, 0xbe, 0x6f, 0x67, 0x31, 0xd2, 0x59,
                   0xc8, 0x0,  0x7,  0xbc, 0x34, 0x9a, 0x6b, 0x3d, 0xe1, 0x4e, 0x0,  0x14, 0x2,  0x6a, 0x54, 0xf8, 0x6,
                   0x9e, 0x9c, 0xe3, 0xd8, 0x78, 0xe9, 0x7d, 0x14, 0x71, 0xc6, 0x8c, 0x63, 0x61, 0xcf, 0xe6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3c, 0x45, 0x8a, 0xf9, 0xca, 0xd8, 0xf5, 0xf, 0x8e, 0x6c, 0xb8, 0xa1, 0xe1, 0xd8};
  uint8_t bytesprops1[] = {0xee, 0x42, 0xa1, 0x9f, 0x72, 0x96, 0x60, 0x89, 0x27, 0x58,
                           0x82, 0xf5, 0xc7, 0x8b, 0xaf, 0x77, 0x91, 0x2,  0x84, 0x89};
  uint8_t bytesprops2[] = {0x9b, 0xf5, 0x83, 0x26, 0xf2, 0xed, 0xe6, 0xee, 0xa3, 0xaf};
  uint8_t bytesprops3[] = {0x5c, 0x14, 0x38, 0xe6, 0xde, 0xef, 0xa7, 0x56};
  uint8_t bytesprops4[] = {0x2b, 0xb2, 0xba, 0x2d, 0x89, 0x84, 0xcf, 0xaa, 0xbc};
  uint8_t bytesprops5[] = {0x44, 0xd7, 0xfc, 0xd6, 0xa8};
  uint8_t bytesprops6[] = {0x32, 0x43, 0x71};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17077}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26736}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 647}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19408}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19138}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31520}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x82, 0xfb, 0xf0, 0x13, 0x99, 0x4d, 0x40, 0x6,  0x9b, 0x1b,
                               0x40, 0x6f, 0x39, 0xe0, 0x3b, 0x33, 0x63, 0xf8, 0x58};
  uint8_t byteswillprops1[] = {0x40, 0xf5, 0xb2, 0xc4, 0x55, 0xe4, 0xa9, 0x4c, 0x2a, 0xd9, 0xa3, 0x6, 0xf0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19884}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&byteswillprops1}}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5f, 0xc0, 0x44, 0xc2, 0x7e, 0xda, 0x61, 0x64, 0x59, 0x30,
                                0xf4, 0x75, 0xbe, 0x6f, 0x67, 0x31, 0xd2, 0x59, 0xc8};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xbc, 0x34, 0x9a, 0x6b, 0x3d, 0xe1, 0x4e};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16867;
  uint8_t client_id_bytes[] = {0x68, 0x3,  0xed, 0x6e, 0x30, 0xca, 0x3, 0x2f, 0xd5, 0x1b, 0xae,
                               0x88, 0x27, 0xda, 0x6c, 0x51, 0x90, 0xa, 0xaf, 0x97, 0x84};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2,  0x6a, 0x54, 0xf8, 0x6,  0x9e, 0x9c, 0xe3, 0xd8, 0x78,
                              0xe9, 0x7d, 0x14, 0x71, 0xc6, 0x8c, 0x63, 0x61, 0xcf, 0xe6};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\EM\159\EM\NUL\DC4\\,\140mmGl\162\187\222", _password = Just
// "\CAN\249\146fH\SYN\161\US\154\173\243\177\240\212k\203\219>\193\167\185\189\222`\151Q", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS2, _willTopic = "\219\242^+:\f\EOT\173\175\&1\CAN\171\&8", _willMsg =
// "\172\220\161\161W~?%", _willProps = [PropPayloadFormatIndicator 66,PropTopicAlias 14799,PropReasonString
// "\DLE\198\234\232\141Q\171\186\225p3\US\EOT\182W\251\&3",PropServerKeepAlive 16361,PropAuthenticationMethod
// "\160\237\149\220ft\158\250S1\129\137\208\US\171[\SI\155\DLE\230",PropReasonString "",PropMaximumQoS
// 138,PropTopicAlias 19777,PropResponseInformation "\SUB\150\168xS\235\\\243\STX\n\ENQ\nf\STX\144\205\237H"]}),
// _cleanSession = False, _keepAlive = 9252, _connID =
// "\175\167p\FS\238\ni\164\&3*\183\243\186\129\SO\153{\225\138\236\216\213${|P^\248\148\128", _properties =
// [PropTopicAliasMaximum 7582,PropSessionExpiryInterval 9069,PropReasonString
// "\244\141\154\244\&4J?s\152\128\163\178\219\247\222\DLEk7\174\137s",PropSessionExpiryInterval
// 31866,PropAssignedClientIdentifier
// "\246Tu?9\161Bf\137]U\227x\FS,\"\226\205\&8f\213\FS\177\240<",PropMaximumPacketSize 18917,PropSubscriptionIdentifier
// 22,PropSharedSubscriptionAvailable 227,PropReasonString
// "R\ENQ\r\226\228/C\191\ETB\205\247\188\234+\146\202?",PropSubscriptionIdentifierAvailable
// 5,PropRequestResponseInformation 40,PropMessageExpiryInterval 32403,PropServerReference
// "\129LQ\129\218\230\ESC\165\"\191\226\179S\232\&8mj\EM`]hM\187]\CAN\226\DC4\228\234\249",PropReasonString
// "\217&\205\239n\NAK\EME \140J\148K",PropServerKeepAlive 23,PropRetainAvailable 128,PropSharedSubscriptionAvailable
// 203,PropRetainAvailable 242,PropUserProperty
// "o\"\157\151\199j\170W\145\229\145qK\FS\v\210w<\NAK\169\248z8\143\134\142K" "\166)QvC\215\\L\181\197\236\f\182\223"]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0x92, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x24, 0x24, 0xcf, 0x1,  0x22, 0x1d, 0x9e, 0x11,
      0x0,  0x0,  0x23, 0x6d, 0x1f, 0x0,  0x15, 0xf4, 0x8d, 0x9a, 0xf4, 0x34, 0x4a, 0x3f, 0x73, 0x98, 0x80, 0xa3, 0xb2,
      0xdb, 0xf7, 0xde, 0x10, 0x6b, 0x37, 0xae, 0x89, 0x73, 0x11, 0x0,  0x0,  0x7c, 0x7a, 0x12, 0x0,  0x19, 0xf6, 0x54,
      0x75, 0x3f, 0x39, 0xa1, 0x42, 0x66, 0x89, 0x5d, 0x55, 0xe3, 0x78, 0x1c, 0x2c, 0x22, 0xe2, 0xcd, 0x38, 0x66, 0xd5,
      0x1c, 0xb1, 0xf0, 0x3c, 0x27, 0x0,  0x0,  0x49, 0xe5, 0xb,  0x16, 0x2a, 0xe3, 0x1f, 0x0,  0x11, 0x52, 0x5,  0xd,
      0xe2, 0xe4, 0x2f, 0x43, 0xbf, 0x17, 0xcd, 0xf7, 0xbc, 0xea, 0x2b, 0x92, 0xca, 0x3f, 0x29, 0x5,  0x19, 0x28, 0x2,
      0x0,  0x0,  0x7e, 0x93, 0x1c, 0x0,  0x1e, 0x81, 0x4c, 0x51, 0x81, 0xda, 0xe6, 0x1b, 0xa5, 0x22, 0xbf, 0xe2, 0xb3,
      0x53, 0xe8, 0x38, 0x6d, 0x6a, 0x19, 0x60, 0x5d, 0x68, 0x4d, 0xbb, 0x5d, 0x18, 0xe2, 0x14, 0xe4, 0xea, 0xf9, 0x1f,
      0x0,  0xd,  0xd9, 0x26, 0xcd, 0xef, 0x6e, 0x15, 0x19, 0x45, 0x20, 0x8c, 0x4a, 0x94, 0x4b, 0x13, 0x0,  0x17, 0x25,
      0x80, 0x2a, 0xcb, 0x25, 0xf2, 0x26, 0x0,  0x1b, 0x6f, 0x22, 0x9d, 0x97, 0xc7, 0x6a, 0xaa, 0x57, 0x91, 0xe5, 0x91,
      0x71, 0x4b, 0x1c, 0xb,  0xd2, 0x77, 0x3c, 0x15, 0xa9, 0xf8, 0x7a, 0x38, 0x8f, 0x86, 0x8e, 0x4b, 0x0,  0xe,  0xa6,
      0x29, 0x51, 0x76, 0x43, 0xd7, 0x5c, 0x4c, 0xb5, 0xc5, 0xec, 0xc,  0xb6, 0xdf, 0x0,  0x1e, 0xaf, 0xa7, 0x70, 0x1c,
      0xee, 0xa,  0x69, 0xa4, 0x33, 0x2a, 0xb7, 0xf3, 0xba, 0x81, 0xe,  0x99, 0x7b, 0xe1, 0x8a, 0xec, 0xd8, 0xd5, 0x24,
      0x7b, 0x7c, 0x50, 0x5e, 0xf8, 0x94, 0x80, 0x50, 0x1,  0x42, 0x23, 0x39, 0xcf, 0x1f, 0x0,  0x11, 0x10, 0xc6, 0xea,
      0xe8, 0x8d, 0x51, 0xab, 0xba, 0xe1, 0x70, 0x33, 0x1f, 0x4,  0xb6, 0x57, 0xfb, 0x33, 0x13, 0x3f, 0xe9, 0x15, 0x0,
      0x14, 0xa0, 0xed, 0x95, 0xdc, 0x66, 0x74, 0x9e, 0xfa, 0x53, 0x31, 0x81, 0x89, 0xd0, 0x1f, 0xab, 0x5b, 0xf,  0x9b,
      0x10, 0xe6, 0x1f, 0x0,  0x0,  0x24, 0x8a, 0x23, 0x4d, 0x41, 0x1a, 0x0,  0x12, 0x1a, 0x96, 0xa8, 0x78, 0x53, 0xeb,
      0x5c, 0xf3, 0x2,  0xa,  0x5,  0xa,  0x66, 0x2,  0x90, 0xcd, 0xed, 0x48, 0x0,  0xd,  0xdb, 0xf2, 0x5e, 0x2b, 0x3a,
      0xc,  0x4,  0xad, 0xaf, 0x31, 0x18, 0xab, 0x38, 0x0,  0x8,  0xac, 0xdc, 0xa1, 0xa1, 0x57, 0x7e, 0x3f, 0x25, 0x0,
      0xf,  0x19, 0x9f, 0x19, 0x0,  0x14, 0x5c, 0x2c, 0x8c, 0x6d, 0x6d, 0x47, 0x6c, 0xa2, 0xbb, 0xde, 0x0,  0x1a, 0x18,
      0xf9, 0x92, 0x66, 0x48, 0x16, 0xa1, 0x1f, 0x9a, 0xad, 0xf3, 0xb1, 0xf0, 0xd4, 0x6b, 0xcb, 0xdb, 0x3e, 0xc1, 0xa7,
      0xb9, 0xbd, 0xde, 0x60, 0x97, 0x51};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf4, 0x8d, 0x9a, 0xf4, 0x34, 0x4a, 0x3f, 0x73, 0x98, 0x80, 0xa3,
                           0xb2, 0xdb, 0xf7, 0xde, 0x10, 0x6b, 0x37, 0xae, 0x89, 0x73};
  uint8_t bytesprops1[] = {0xf6, 0x54, 0x75, 0x3f, 0x39, 0xa1, 0x42, 0x66, 0x89, 0x5d, 0x55, 0xe3, 0x78,
                           0x1c, 0x2c, 0x22, 0xe2, 0xcd, 0x38, 0x66, 0xd5, 0x1c, 0xb1, 0xf0, 0x3c};
  uint8_t bytesprops2[] = {0x52, 0x5,  0xd,  0xe2, 0xe4, 0x2f, 0x43, 0xbf, 0x17,
                           0xcd, 0xf7, 0xbc, 0xea, 0x2b, 0x92, 0xca, 0x3f};
  uint8_t bytesprops3[] = {0x81, 0x4c, 0x51, 0x81, 0xda, 0xe6, 0x1b, 0xa5, 0x22, 0xbf, 0xe2, 0xb3, 0x53, 0xe8, 0x38,
                           0x6d, 0x6a, 0x19, 0x60, 0x5d, 0x68, 0x4d, 0xbb, 0x5d, 0x18, 0xe2, 0x14, 0xe4, 0xea, 0xf9};
  uint8_t bytesprops4[] = {0xd9, 0x26, 0xcd, 0xef, 0x6e, 0x15, 0x19, 0x45, 0x20, 0x8c, 0x4a, 0x94, 0x4b};
  uint8_t bytesprops6[] = {0xa6, 0x29, 0x51, 0x76, 0x43, 0xd7, 0x5c, 0x4c, 0xb5, 0xc5, 0xec, 0xc, 0xb6, 0xdf};
  uint8_t bytesprops5[] = {0x6f, 0x22, 0x9d, 0x97, 0xc7, 0x6a, 0xaa, 0x57, 0x91, 0xe5, 0x91, 0x71, 0x4b, 0x1c,
                           0xb,  0xd2, 0x77, 0x3c, 0x15, 0xa9, 0xf8, 0x7a, 0x38, 0x8f, 0x86, 0x8e, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7582}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9069}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31866}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18917}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32403}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops5}, .v = {14, (char*)&bytesprops6}}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x10, 0xc6, 0xea, 0xe8, 0x8d, 0x51, 0xab, 0xba, 0xe1,
                               0x70, 0x33, 0x1f, 0x4,  0xb6, 0x57, 0xfb, 0x33};
  uint8_t byteswillprops1[] = {0xa0, 0xed, 0x95, 0xdc, 0x66, 0x74, 0x9e, 0xfa, 0x53, 0x31,
                               0x81, 0x89, 0xd0, 0x1f, 0xab, 0x5b, 0xf,  0x9b, 0x10, 0xe6};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops3[] = {0x1a, 0x96, 0xa8, 0x78, 0x53, 0xeb, 0x5c, 0xf3, 0x2,
                               0xa,  0x5,  0xa,  0x66, 0x2,  0x90, 0xcd, 0xed, 0x48};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14799}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16361}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19777}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops3}}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdb, 0xf2, 0x5e, 0x2b, 0x3a, 0xc, 0x4, 0xad, 0xaf, 0x31, 0x18, 0xab, 0x38};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xac, 0xdc, 0xa1, 0xa1, 0x57, 0x7e, 0x3f, 0x25};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9252;
  uint8_t client_id_bytes[] = {0xaf, 0xa7, 0x70, 0x1c, 0xee, 0xa,  0x69, 0xa4, 0x33, 0x2a,
                               0xb7, 0xf3, 0xba, 0x81, 0xe,  0x99, 0x7b, 0xe1, 0x8a, 0xec,
                               0xd8, 0xd5, 0x24, 0x7b, 0x7c, 0x50, 0x5e, 0xf8, 0x94, 0x80};
  lwmqtt_string_t client_id = {30, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x19, 0x9f, 0x19, 0x0, 0x14, 0x5c, 0x2c, 0x8c, 0x6d, 0x6d, 0x47, 0x6c, 0xa2, 0xbb, 0xde};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0xf9, 0x92, 0x66, 0x48, 0x16, 0xa1, 0x1f, 0x9a, 0xad, 0xf3, 0xb1, 0xf0,
                              0xd4, 0x6b, 0xcb, 0xdb, 0x3e, 0xc1, 0xa7, 0xb9, 0xbd, 0xde, 0x60, 0x97, 0x51};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\132Jc\237#\175s\149\208\140\v\175\198\197@bE\255\177&4\223%%\194\229\ETB",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "_B\130\238\164\ACK\246/\243\243\182\&9h\219Dp\161E\201n(\130u", _willMsg =
// "L\ETX\226\236\158\CAN3\190\221\140\156\129Mj\211\ACKv+\USU\197e\219\EM\135\221\145", _willProps =
// [PropSubscriptionIdentifier 29]}), _cleanSession = False, _keepAlive = 23111, _connID =
// "\128'\168\a\165\214u\"VvPa\154y\236\ETB\165ng\208\175\233\198\234\235\a", _properties =
// [PropRequestResponseInformation 158,PropMaximumQoS 125,PropSharedSubscriptionAvailable 112,PropWillDelayInterval
// 4423,PropAuthenticationData "\171uy\199H{:\189",PropReasonString
// "%\168\209\RSLiy\NAK\242C\SO\rj\ENQ\237ln\148d\237",PropUserProperty
// "c\ACK\165\226\165}\198\253!\144\ENQ2\184R\180V\\\247P\227\189"
// "\134Gw\161\202\160U'\\Vw\138AJc",PropRequestResponseInformation 60,PropMessageExpiryInterval 8943,PropTopicAlias
// 6044,PropMaximumQoS 9,PropServerKeepAlive 982,PropSharedSubscriptionAvailable 31,PropWillDelayInterval
// 9182,PropReceiveMaximum 29774,PropSessionExpiryInterval 32009,PropServerKeepAlive 32136,PropMessageExpiryInterval
// 26395,PropMaximumQoS 5]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0xfb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xb4, 0x5a, 0x47, 0x7e, 0x19, 0x9e, 0x24,
                   0x7d, 0x2a, 0x70, 0x18, 0x0,  0x0,  0x11, 0x47, 0x16, 0x0,  0x8,  0xab, 0x75, 0x79, 0xc7, 0x48, 0x7b,
                   0x3a, 0xbd, 0x1f, 0x0,  0x14, 0x25, 0xa8, 0xd1, 0x1e, 0x4c, 0x69, 0x79, 0x15, 0xf2, 0x43, 0xe,  0xd,
                   0x6a, 0x5,  0xed, 0x6c, 0x6e, 0x94, 0x64, 0xed, 0x26, 0x0,  0x15, 0x63, 0x6,  0xa5, 0xe2, 0xa5, 0x7d,
                   0xc6, 0xfd, 0x21, 0x90, 0x5,  0x32, 0xb8, 0x52, 0xb4, 0x56, 0x5c, 0xf7, 0x50, 0xe3, 0xbd, 0x0,  0xf,
                   0x86, 0x47, 0x77, 0xa1, 0xca, 0xa0, 0x55, 0x27, 0x5c, 0x56, 0x77, 0x8a, 0x41, 0x4a, 0x63, 0x19, 0x3c,
                   0x2,  0x0,  0x0,  0x22, 0xef, 0x23, 0x17, 0x9c, 0x24, 0x9,  0x13, 0x3,  0xd6, 0x2a, 0x1f, 0x18, 0x0,
                   0x0,  0x23, 0xde, 0x21, 0x74, 0x4e, 0x11, 0x0,  0x0,  0x7d, 0x9,  0x13, 0x7d, 0x88, 0x2,  0x0,  0x0,
                   0x67, 0x1b, 0x24, 0x5,  0x0,  0x1a, 0x80, 0x27, 0xa8, 0x7,  0xa5, 0xd6, 0x75, 0x22, 0x56, 0x76, 0x50,
                   0x61, 0x9a, 0x79, 0xec, 0x17, 0xa5, 0x6e, 0x67, 0xd0, 0xaf, 0xe9, 0xc6, 0xea, 0xeb, 0x7,  0x2,  0xb,
                   0x1d, 0x0,  0x17, 0x5f, 0x42, 0x82, 0xee, 0xa4, 0x6,  0xf6, 0x2f, 0xf3, 0xf3, 0xb6, 0x39, 0x68, 0xdb,
                   0x44, 0x70, 0xa1, 0x45, 0xc9, 0x6e, 0x28, 0x82, 0x75, 0x0,  0x1b, 0x4c, 0x3,  0xe2, 0xec, 0x9e, 0x18,
                   0x33, 0xbe, 0xdd, 0x8c, 0x9c, 0x81, 0x4d, 0x6a, 0xd3, 0x6,  0x76, 0x2b, 0x1f, 0x55, 0xc5, 0x65, 0xdb,
                   0x19, 0x87, 0xdd, 0x91, 0x0,  0x1b, 0x84, 0x4a, 0x63, 0xed, 0x23, 0xaf, 0x73, 0x95, 0xd0, 0x8c, 0xb,
                   0xaf, 0xc6, 0xc5, 0x40, 0x62, 0x45, 0xff, 0xb1, 0x26, 0x34, 0xdf, 0x25, 0x25, 0xc2, 0xe5, 0x17};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xab, 0x75, 0x79, 0xc7, 0x48, 0x7b, 0x3a, 0xbd};
  uint8_t bytesprops1[] = {0x25, 0xa8, 0xd1, 0x1e, 0x4c, 0x69, 0x79, 0x15, 0xf2, 0x43,
                           0xe,  0xd,  0x6a, 0x5,  0xed, 0x6c, 0x6e, 0x94, 0x64, 0xed};
  uint8_t bytesprops3[] = {0x86, 0x47, 0x77, 0xa1, 0xca, 0xa0, 0x55, 0x27, 0x5c, 0x56, 0x77, 0x8a, 0x41, 0x4a, 0x63};
  uint8_t bytesprops2[] = {0x63, 0x6,  0xa5, 0xe2, 0xa5, 0x7d, 0xc6, 0xfd, 0x21, 0x90, 0x5,
                           0x32, 0xb8, 0x52, 0xb4, 0x56, 0x5c, 0xf7, 0x50, 0xe3, 0xbd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4423}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops2}, .v = {15, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8943}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6044}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 982}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9182}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29774}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32009}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32136}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26395}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 5}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5f, 0x42, 0x82, 0xee, 0xa4, 0x6,  0xf6, 0x2f, 0xf3, 0xf3, 0xb6, 0x39,
                                0x68, 0xdb, 0x44, 0x70, 0xa1, 0x45, 0xc9, 0x6e, 0x28, 0x82, 0x75};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4c, 0x3, 0xe2, 0xec, 0x9e, 0x18, 0x33, 0xbe, 0xdd, 0x8c, 0x9c, 0x81, 0x4d, 0x6a,
                                  0xd3, 0x6, 0x76, 0x2b, 0x1f, 0x55, 0xc5, 0x65, 0xdb, 0x19, 0x87, 0xdd, 0x91};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 23111;
  uint8_t client_id_bytes[] = {0x80, 0x27, 0xa8, 0x7,  0xa5, 0xd6, 0x75, 0x22, 0x56, 0x76, 0x50, 0x61, 0x9a,
                               0x79, 0xec, 0x17, 0xa5, 0x6e, 0x67, 0xd0, 0xaf, 0xe9, 0xc6, 0xea, 0xeb, 0x7};
  lwmqtt_string_t client_id = {26, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x84, 0x4a, 0x63, 0xed, 0x23, 0xaf, 0x73, 0x95, 0xd0, 0x8c, 0xb,  0xaf, 0xc6, 0xc5,
                              0x40, 0x62, 0x45, 0xff, 0xb1, 0x26, 0x34, 0xdf, 0x25, 0x25, 0xc2, 0xe5, 0x17};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\131)o", _password = Just "Y^ \171\220\234\182Th\NAK", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\SOHw\DC4\149\&5\197\t\RS\188\166\DLE\179", _willMsg =
// "L\173#e?~\241<", _willProps = [PropSessionExpiryInterval 7110,PropServerKeepAlive 24305,PropRetainAvailable
// 101,PropPayloadFormatIndicator 38,PropTopicAlias 22823,PropSubscriptionIdentifierAvailable 67,PropReasonString
// "\192\149\203\184\132\196\144\243\157J\164",PropSubscriptionIdentifier 21,PropResponseInformation
// "\NAK\186\220\217\220\163'\221",PropCorrelationData "\DLER5\185+",PropRequestResponseInformation
// 195,PropRetainAvailable 227,PropPayloadFormatIndicator 155,PropMessageExpiryInterval 26025,PropAuthenticationMethod
// "\160\153\184\173\252\195\209\ENQ\171u\SYN",PropResponseTopic
// "\192\198\129uw\235\226\227\&06\140&\183\&71F\131\239\SUB\158\DLE\187m",PropReceiveMaximum
// 25372,PropTopicAliasMaximum 16172,PropServerKeepAlive 18593,PropAuthenticationData
// "\ACK\208\166<P\186\CANW\SI\210#3\EM\248\144\158|x\142&\243\213\173\157\190\188\128\132",PropMessageExpiryInterval
// 26543,PropSessionExpiryInterval 18099,PropMessageExpiryInterval 28918]}), _cleanSession = False, _keepAlive = 15628,
// _connID = "\238", _properties = [PropPayloadFormatIndicator 247,PropMessageExpiryInterval
// 28951,PropMessageExpiryInterval 19994,PropServerReference
// "p\221\227<\250\f\254\241\ENQ\a\167\201\248\EOT%\147\210\219\236\178\170\254\201\222\177\243\217\228O",PropTopicAliasMaximum
// 17366,PropServerKeepAlive 4974,PropReasonString
// "0\237n\201\163\a\143z\241]5\189eg\ENQ\145\235\&5q\176",PropServerReference
// "\218\221\167t\a\f\141l\216\154i\SOH\247a\185\225\219\233\248]\251\v",PropServerKeepAlive
// 23518,PropSessionExpiryInterval 2025,PropContentType
// "?\193u\170H$\139\199\250;\252\186",PropSharedSubscriptionAvailable 204,PropTopicAliasMaximum 6285,PropMaximumQoS
// 149,PropServerKeepAlive 2907,PropContentType
// "v]\200x\209\DLEPH\222K\154\141\220q\223k\184\250\DC2\EOT\222\213\233\244\166\194\237"]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xf9, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x3d, 0xc,  0xa1, 0x1,  0x1,  0xf7, 0x2,  0x0,
      0x0,  0x71, 0x17, 0x2,  0x0,  0x0,  0x4e, 0x1a, 0x1c, 0x0,  0x1d, 0x70, 0xdd, 0xe3, 0x3c, 0xfa, 0xc,  0xfe, 0xf1,
      0x5,  0x7,  0xa7, 0xc9, 0xf8, 0x4,  0x25, 0x93, 0xd2, 0xdb, 0xec, 0xb2, 0xaa, 0xfe, 0xc9, 0xde, 0xb1, 0xf3, 0xd9,
      0xe4, 0x4f, 0x22, 0x43, 0xd6, 0x13, 0x13, 0x6e, 0x1f, 0x0,  0x14, 0x30, 0xed, 0x6e, 0xc9, 0xa3, 0x7,  0x8f, 0x7a,
      0xf1, 0x5d, 0x35, 0xbd, 0x65, 0x67, 0x5,  0x91, 0xeb, 0x35, 0x71, 0xb0, 0x1c, 0x0,  0x16, 0xda, 0xdd, 0xa7, 0x74,
      0x7,  0xc,  0x8d, 0x6c, 0xd8, 0x9a, 0x69, 0x1,  0xf7, 0x61, 0xb9, 0xe1, 0xdb, 0xe9, 0xf8, 0x5d, 0xfb, 0xb,  0x13,
      0x5b, 0xde, 0x11, 0x0,  0x0,  0x7,  0xe9, 0x3,  0x0,  0xc,  0x3f, 0xc1, 0x75, 0xaa, 0x48, 0x24, 0x8b, 0xc7, 0xfa,
      0x3b, 0xfc, 0xba, 0x2a, 0xcc, 0x22, 0x18, 0x8d, 0x24, 0x95, 0x13, 0xb,  0x5b, 0x3,  0x0,  0x1b, 0x76, 0x5d, 0xc8,
      0x78, 0xd1, 0x10, 0x50, 0x48, 0xde, 0x4b, 0x9a, 0x8d, 0xdc, 0x71, 0xdf, 0x6b, 0xb8, 0xfa, 0x12, 0x4,  0xde, 0xd5,
      0xe9, 0xf4, 0xa6, 0xc2, 0xed, 0x0,  0x1,  0xee, 0x9e, 0x1,  0x11, 0x0,  0x0,  0x1b, 0xc6, 0x13, 0x5e, 0xf1, 0x25,
      0x65, 0x1,  0x26, 0x23, 0x59, 0x27, 0x29, 0x43, 0x1f, 0x0,  0xb,  0xc0, 0x95, 0xcb, 0xb8, 0x84, 0xc4, 0x90, 0xf3,
      0x9d, 0x4a, 0xa4, 0xb,  0x15, 0x1a, 0x0,  0x8,  0x15, 0xba, 0xdc, 0xd9, 0xdc, 0xa3, 0x27, 0xdd, 0x9,  0x0,  0x5,
      0x10, 0x52, 0x35, 0xb9, 0x2b, 0x19, 0xc3, 0x25, 0xe3, 0x1,  0x9b, 0x2,  0x0,  0x0,  0x65, 0xa9, 0x15, 0x0,  0xb,
      0xa0, 0x99, 0xb8, 0xad, 0xfc, 0xc3, 0xd1, 0x5,  0xab, 0x75, 0x16, 0x8,  0x0,  0x17, 0xc0, 0xc6, 0x81, 0x75, 0x77,
      0xeb, 0xe2, 0xe3, 0x30, 0x36, 0x8c, 0x26, 0xb7, 0x37, 0x31, 0x46, 0x83, 0xef, 0x1a, 0x9e, 0x10, 0xbb, 0x6d, 0x21,
      0x63, 0x1c, 0x22, 0x3f, 0x2c, 0x13, 0x48, 0xa1, 0x16, 0x0,  0x1c, 0x6,  0xd0, 0xa6, 0x3c, 0x50, 0xba, 0x18, 0x57,
      0xf,  0xd2, 0x23, 0x33, 0x19, 0xf8, 0x90, 0x9e, 0x7c, 0x78, 0x8e, 0x26, 0xf3, 0xd5, 0xad, 0x9d, 0xbe, 0xbc, 0x80,
      0x84, 0x2,  0x0,  0x0,  0x67, 0xaf, 0x11, 0x0,  0x0,  0x46, 0xb3, 0x2,  0x0,  0x0,  0x70, 0xf6, 0x0,  0xc,  0x1,
      0x77, 0x14, 0x95, 0x35, 0xc5, 0x9,  0x1e, 0xbc, 0xa6, 0x10, 0xb3, 0x0,  0x8,  0x4c, 0xad, 0x23, 0x65, 0x3f, 0x7e,
      0xf1, 0x3c, 0x0,  0x3,  0x83, 0x29, 0x6f, 0x0,  0xa,  0x59, 0x5e, 0x20, 0xab, 0xdc, 0xea, 0xb6, 0x54, 0x68, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x70, 0xdd, 0xe3, 0x3c, 0xfa, 0xc,  0xfe, 0xf1, 0x5,  0x7,  0xa7, 0xc9, 0xf8, 0x4, 0x25,
                           0x93, 0xd2, 0xdb, 0xec, 0xb2, 0xaa, 0xfe, 0xc9, 0xde, 0xb1, 0xf3, 0xd9, 0xe4, 0x4f};
  uint8_t bytesprops1[] = {0x30, 0xed, 0x6e, 0xc9, 0xa3, 0x7,  0x8f, 0x7a, 0xf1, 0x5d,
                           0x35, 0xbd, 0x65, 0x67, 0x5,  0x91, 0xeb, 0x35, 0x71, 0xb0};
  uint8_t bytesprops2[] = {0xda, 0xdd, 0xa7, 0x74, 0x7,  0xc,  0x8d, 0x6c, 0xd8, 0x9a, 0x69,
                           0x1,  0xf7, 0x61, 0xb9, 0xe1, 0xdb, 0xe9, 0xf8, 0x5d, 0xfb, 0xb};
  uint8_t bytesprops3[] = {0x3f, 0xc1, 0x75, 0xaa, 0x48, 0x24, 0x8b, 0xc7, 0xfa, 0x3b, 0xfc, 0xba};
  uint8_t bytesprops4[] = {0x76, 0x5d, 0xc8, 0x78, 0xd1, 0x10, 0x50, 0x48, 0xde, 0x4b, 0x9a, 0x8d, 0xdc, 0x71,
                           0xdf, 0x6b, 0xb8, 0xfa, 0x12, 0x4,  0xde, 0xd5, 0xe9, 0xf4, 0xa6, 0xc2, 0xed};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28951}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19994}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17366}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4974}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23518}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2025}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6285}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2907}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc0, 0x95, 0xcb, 0xb8, 0x84, 0xc4, 0x90, 0xf3, 0x9d, 0x4a, 0xa4};
  uint8_t byteswillprops1[] = {0x15, 0xba, 0xdc, 0xd9, 0xdc, 0xa3, 0x27, 0xdd};
  uint8_t byteswillprops2[] = {0x10, 0x52, 0x35, 0xb9, 0x2b};
  uint8_t byteswillprops3[] = {0xa0, 0x99, 0xb8, 0xad, 0xfc, 0xc3, 0xd1, 0x5, 0xab, 0x75, 0x16};
  uint8_t byteswillprops4[] = {0xc0, 0xc6, 0x81, 0x75, 0x77, 0xeb, 0xe2, 0xe3, 0x30, 0x36, 0x8c, 0x26,
                               0xb7, 0x37, 0x31, 0x46, 0x83, 0xef, 0x1a, 0x9e, 0x10, 0xbb, 0x6d};
  uint8_t byteswillprops5[] = {0x6,  0xd0, 0xa6, 0x3c, 0x50, 0xba, 0x18, 0x57, 0xf,  0xd2, 0x23, 0x33, 0x19, 0xf8,
                               0x90, 0x9e, 0x7c, 0x78, 0x8e, 0x26, 0xf3, 0xd5, 0xad, 0x9d, 0xbe, 0xbc, 0x80, 0x84};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7110}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24305}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22823}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 21}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26025}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25372}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16172}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18593}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26543}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18099}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28918}},
  };

  lwmqtt_properties_t willprops = {23, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1, 0x77, 0x14, 0x95, 0x35, 0xc5, 0x9, 0x1e, 0xbc, 0xa6, 0x10, 0xb3};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4c, 0xad, 0x23, 0x65, 0x3f, 0x7e, 0xf1, 0x3c};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 15628;
  uint8_t client_id_bytes[] = {0xee};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x83, 0x29, 0x6f};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x59, 0x5e, 0x20, 0xab, 0xdc, 0xea, 0xb6, 0x54, 0x68, 0x15};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\176mX\224\177{+\ENQ\221\228\184\181\192 \NUL\201\128\209", _password = Just
// "\215Dco.`\RSl\219\136A\134Z}X\247\&5HG\ETX", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1,
// _willTopic = "\242 xK\204\160x\221\169\240", _willMsg = "\220\ACKG", _willProps = [PropSessionExpiryInterval
// 16457,PropWildcardSubscriptionAvailable 225,PropMaximumPacketSize 18276,PropPayloadFormatIndicator
// 46,PropMaximumPacketSize 7510,PropResponseInformation "\167\n\bZ!s\223\224~\216nc\SIJ\189\ACK\DLE\DC4
// \169\162\218",PropUserProperty "\215\245\170\f[\207\194(.FT\207\187\172F} "
// "\227\DC4\194-",PropWildcardSubscriptionAvailable 118,PropAuthenticationMethod
// "[\133H\EOT{\SUB",PropRequestResponseInformation 182,PropAuthenticationData
// "c\190$\209+\167D\148\f\189\204G\224\189\220[\222@9\178w\ENQ\166f\200|\250",PropMaximumQoS 180,PropReasonString "
// \203\163\254\208%\197n\132\180\231^9\165\&0^",PropReasonString
// "\193-\EOT\210\&1t\134\195T\143\147\169jj\DC2\SYN\SO\215\143\ETBt",PropPayloadFormatIndicator
// 169,PropSessionExpiryInterval 28492,PropAuthenticationMethod "\134\197(W\CAN\174\\\234\220R",PropTopicAliasMaximum
// 16101,PropMessageExpiryInterval 10137,PropReceiveMaximum 16797,PropSharedSubscriptionAvailable 199,PropReceiveMaximum
// 16828,PropReasonString "s)\n`}%\204c\186\209\220Z\249U\233\171d6c\201\SUBu\r\n",PropResponseTopic
// "\145\176Q\238",PropAuthenticationData "\247u\DC2\148+V\151\246q\172\138"]}), _cleanSession = True, _keepAlive =
// 19143, _connID = "\176/i\144P\218\&5\t\229;\221\246\DC2\"", _properties = [PropReceiveMaximum
// 12877,PropCorrelationData "\191\182\ENQp\189_\SIk\254}\159;?\252\&0\232",PropSubscriptionIdentifier 30,PropMaximumQoS
// 64,PropWildcardSubscriptionAvailable 100,PropPayloadFormatIndicator 163]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xe8, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x4a, 0xc7, 0x1e, 0x21, 0x32, 0x4d, 0x9,  0x0,
      0x10, 0xbf, 0xb6, 0x5,  0x70, 0xbd, 0x5f, 0xf,  0x6b, 0xfe, 0x7d, 0x9f, 0x3b, 0x3f, 0xfc, 0x30, 0xe8, 0xb,  0x1e,
      0x24, 0x40, 0x28, 0x64, 0x1,  0xa3, 0x0,  0xe,  0xb0, 0x2f, 0x69, 0x90, 0x50, 0xda, 0x35, 0x9,  0xe5, 0x3b, 0xdd,
      0xf6, 0x12, 0x22, 0xf2, 0x1,  0x11, 0x0,  0x0,  0x40, 0x49, 0x28, 0xe1, 0x27, 0x0,  0x0,  0x47, 0x64, 0x1,  0x2e,
      0x27, 0x0,  0x0,  0x1d, 0x56, 0x1a, 0x0,  0x16, 0xa7, 0xa,  0x8,  0x5a, 0x21, 0x73, 0xdf, 0xe0, 0x7e, 0xd8, 0x6e,
      0x63, 0xf,  0x4a, 0xbd, 0x6,  0x10, 0x14, 0x20, 0xa9, 0xa2, 0xda, 0x26, 0x0,  0x11, 0xd7, 0xf5, 0xaa, 0xc,  0x5b,
      0xcf, 0xc2, 0x28, 0x2e, 0x46, 0x54, 0xcf, 0xbb, 0xac, 0x46, 0x7d, 0x20, 0x0,  0x4,  0xe3, 0x14, 0xc2, 0x2d, 0x28,
      0x76, 0x15, 0x0,  0x6,  0x5b, 0x85, 0x48, 0x4,  0x7b, 0x1a, 0x19, 0xb6, 0x16, 0x0,  0x1b, 0x63, 0xbe, 0x24, 0xd1,
      0x2b, 0xa7, 0x44, 0x94, 0xc,  0xbd, 0xcc, 0x47, 0xe0, 0xbd, 0xdc, 0x5b, 0xde, 0x40, 0x39, 0xb2, 0x77, 0x5,  0xa6,
      0x66, 0xc8, 0x7c, 0xfa, 0x24, 0xb4, 0x1f, 0x0,  0x10, 0x20, 0xcb, 0xa3, 0xfe, 0xd0, 0x25, 0xc5, 0x6e, 0x84, 0xb4,
      0xe7, 0x5e, 0x39, 0xa5, 0x30, 0x5e, 0x1f, 0x0,  0x15, 0xc1, 0x2d, 0x4,  0xd2, 0x31, 0x74, 0x86, 0xc3, 0x54, 0x8f,
      0x93, 0xa9, 0x6a, 0x6a, 0x12, 0x16, 0xe,  0xd7, 0x8f, 0x17, 0x74, 0x1,  0xa9, 0x11, 0x0,  0x0,  0x6f, 0x4c, 0x15,
      0x0,  0xa,  0x86, 0xc5, 0x28, 0x57, 0x18, 0xae, 0x5c, 0xea, 0xdc, 0x52, 0x22, 0x3e, 0xe5, 0x2,  0x0,  0x0,  0x27,
      0x99, 0x21, 0x41, 0x9d, 0x2a, 0xc7, 0x21, 0x41, 0xbc, 0x1f, 0x0,  0x18, 0x73, 0x29, 0xa,  0x60, 0x7d, 0x25, 0xcc,
      0x63, 0xba, 0xd1, 0xdc, 0x5a, 0xf9, 0x55, 0xe9, 0xab, 0x64, 0x36, 0x63, 0xc9, 0x1a, 0x75, 0xd,  0xa,  0x8,  0x0,
      0x4,  0x91, 0xb0, 0x51, 0xee, 0x16, 0x0,  0xb,  0xf7, 0x75, 0x12, 0x94, 0x2b, 0x56, 0x97, 0xf6, 0x71, 0xac, 0x8a,
      0x0,  0xa,  0xf2, 0x20, 0x78, 0x4b, 0xcc, 0xa0, 0x78, 0xdd, 0xa9, 0xf0, 0x0,  0x3,  0xdc, 0x6,  0x47, 0x0,  0x12,
      0xb0, 0x6d, 0x58, 0xe0, 0xb1, 0x7b, 0x2b, 0x5,  0xdd, 0xe4, 0xb8, 0xb5, 0xc0, 0x20, 0x0,  0xc9, 0x80, 0xd1, 0x0,
      0x14, 0xd7, 0x44, 0x63, 0x6f, 0x2e, 0x60, 0x1e, 0x6c, 0xdb, 0x88, 0x41, 0x86, 0x5a, 0x7d, 0x58, 0xf7, 0x35, 0x48,
      0x47, 0x3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbf, 0xb6, 0x5,  0x70, 0xbd, 0x5f, 0xf,  0x6b,
                           0xfe, 0x7d, 0x9f, 0x3b, 0x3f, 0xfc, 0x30, 0xe8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12877}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 163}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa7, 0xa, 0x8,  0x5a, 0x21, 0x73, 0xdf, 0xe0, 0x7e, 0xd8, 0x6e,
                               0x63, 0xf, 0x4a, 0xbd, 0x6,  0x10, 0x14, 0x20, 0xa9, 0xa2, 0xda};
  uint8_t byteswillprops2[] = {0xe3, 0x14, 0xc2, 0x2d};
  uint8_t byteswillprops1[] = {0xd7, 0xf5, 0xaa, 0xc,  0x5b, 0xcf, 0xc2, 0x28, 0x2e,
                               0x46, 0x54, 0xcf, 0xbb, 0xac, 0x46, 0x7d, 0x20};
  uint8_t byteswillprops3[] = {0x5b, 0x85, 0x48, 0x4, 0x7b, 0x1a};
  uint8_t byteswillprops4[] = {0x63, 0xbe, 0x24, 0xd1, 0x2b, 0xa7, 0x44, 0x94, 0xc,  0xbd, 0xcc, 0x47, 0xe0, 0xbd,
                               0xdc, 0x5b, 0xde, 0x40, 0x39, 0xb2, 0x77, 0x5,  0xa6, 0x66, 0xc8, 0x7c, 0xfa};
  uint8_t byteswillprops5[] = {0x20, 0xcb, 0xa3, 0xfe, 0xd0, 0x25, 0xc5, 0x6e,
                               0x84, 0xb4, 0xe7, 0x5e, 0x39, 0xa5, 0x30, 0x5e};
  uint8_t byteswillprops6[] = {0xc1, 0x2d, 0x4,  0xd2, 0x31, 0x74, 0x86, 0xc3, 0x54, 0x8f, 0x93,
                               0xa9, 0x6a, 0x6a, 0x12, 0x16, 0xe,  0xd7, 0x8f, 0x17, 0x74};
  uint8_t byteswillprops7[] = {0x86, 0xc5, 0x28, 0x57, 0x18, 0xae, 0x5c, 0xea, 0xdc, 0x52};
  uint8_t byteswillprops8[] = {0x73, 0x29, 0xa,  0x60, 0x7d, 0x25, 0xcc, 0x63, 0xba, 0xd1, 0xdc, 0x5a,
                               0xf9, 0x55, 0xe9, 0xab, 0x64, 0x36, 0x63, 0xc9, 0x1a, 0x75, 0xd,  0xa};
  uint8_t byteswillprops9[] = {0x91, 0xb0, 0x51, 0xee};
  uint8_t byteswillprops10[] = {0xf7, 0x75, 0x12, 0x94, 0x2b, 0x56, 0x97, 0xf6, 0x71, 0xac, 0x8a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16457}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18276}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7510}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {17, (char*)&byteswillprops1}, .v = {4, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28492}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16101}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10137}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16797}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16828}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&byteswillprops10}}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf2, 0x20, 0x78, 0x4b, 0xcc, 0xa0, 0x78, 0xdd, 0xa9, 0xf0};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdc, 0x6, 0x47};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19143;
  uint8_t client_id_bytes[] = {0xb0, 0x2f, 0x69, 0x90, 0x50, 0xda, 0x35, 0x9, 0xe5, 0x3b, 0xdd, 0xf6, 0x12, 0x22};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb0, 0x6d, 0x58, 0xe0, 0xb1, 0x7b, 0x2b, 0x5,  0xdd,
                              0xe4, 0xb8, 0xb5, 0xc0, 0x20, 0x0,  0xc9, 0x80, 0xd1};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd7, 0x44, 0x63, 0x6f, 0x2e, 0x60, 0x1e, 0x6c, 0xdb, 0x88,
                              0x41, 0x86, 0x5a, 0x7d, 0x58, 0xf7, 0x35, 0x48, 0x47, 0x3};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "9\246\141M+", _password = Just
// "BzT\194\145\200\DC1~\DC2\170\&9\EOT\DLE\215\STX\232\174n", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 30004, _connID = "\ENQ\221\153\230\216\164\143FVb\206\243AV\250\128nq\CAN\233\230\147\239@u\239*", _properties =
// [PropReasonString "!\ACK\198<\DC2DD\v/\193\228\234\204y&",PropServerKeepAlive 26008,PropAssignedClientIdentifier
// "\203\139\241_\177[\169\210\172\136\138b\214\220\ESC\243",PropRequestProblemInformation 140,PropMaximumQoS 107]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x6f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x75, 0x34, 0x2c, 0x1f, 0x0,  0xf,  0x21,
                   0x6,  0xc6, 0x3c, 0x12, 0x44, 0x44, 0xb,  0x2f, 0xc1, 0xe4, 0xea, 0xcc, 0x79, 0x26, 0x13, 0x65, 0x98,
                   0x12, 0x0,  0x10, 0xcb, 0x8b, 0xf1, 0x5f, 0xb1, 0x5b, 0xa9, 0xd2, 0xac, 0x88, 0x8a, 0x62, 0xd6, 0xdc,
                   0x1b, 0xf3, 0x17, 0x8c, 0x24, 0x6b, 0x0,  0x1b, 0x5,  0xdd, 0x99, 0xe6, 0xd8, 0xa4, 0x8f, 0x46, 0x56,
                   0x62, 0xce, 0xf3, 0x41, 0x56, 0xfa, 0x80, 0x6e, 0x71, 0x18, 0xe9, 0xe6, 0x93, 0xef, 0x40, 0x75, 0xef,
                   0x2a, 0x0,  0x5,  0x39, 0xf6, 0x8d, 0x4d, 0x2b, 0x0,  0x12, 0x42, 0x7a, 0x54, 0xc2, 0x91, 0xc8, 0x11,
                   0x7e, 0x12, 0xaa, 0x39, 0x4,  0x10, 0xd7, 0x2,  0xe8, 0xae, 0x6e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x21, 0x6, 0xc6, 0x3c, 0x12, 0x44, 0x44, 0xb, 0x2f, 0xc1, 0xe4, 0xea, 0xcc, 0x79, 0x26};
  uint8_t bytesprops1[] = {0xcb, 0x8b, 0xf1, 0x5f, 0xb1, 0x5b, 0xa9, 0xd2,
                           0xac, 0x88, 0x8a, 0x62, 0xd6, 0xdc, 0x1b, 0xf3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26008}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 107}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30004;
  uint8_t client_id_bytes[] = {0x5,  0xdd, 0x99, 0xe6, 0xd8, 0xa4, 0x8f, 0x46, 0x56, 0x62, 0xce, 0xf3, 0x41, 0x56,
                               0xfa, 0x80, 0x6e, 0x71, 0x18, 0xe9, 0xe6, 0x93, 0xef, 0x40, 0x75, 0xef, 0x2a};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x39, 0xf6, 0x8d, 0x4d, 0x2b};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x42, 0x7a, 0x54, 0xc2, 0x91, 0xc8, 0x11, 0x7e, 0x12,
                              0xaa, 0x39, 0x4,  0x10, 0xd7, 0x2,  0xe8, 0xae, 0x6e};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "Q\GS\242\209", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 6889, _connID = "hO\233g\n{qNO\160 ", _properties = [PropMaximumPacketSize
// 2412,PropSubscriptionIdentifierAvailable 15,PropMessageExpiryInterval 12333,PropRetainAvailable
// 136,PropReceiveMaximum 18567,PropCorrelationData "\203\ETB5\237J\251\141\244",PropSharedSubscriptionAvailable
// 240,PropReceiveMaximum 17848,PropMessageExpiryInterval 16262,PropPayloadFormatIndicator
// 153,PropSubscriptionIdentifier 9,PropSharedSubscriptionAvailable 114,PropReceiveMaximum
// 7802,PropMessageExpiryInterval 2285,PropTopicAliasMaximum 27265]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x55, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x42, 0x1a, 0xe9, 0x37, 0x27, 0x0,
                   0x0,  0x9,  0x6c, 0x29, 0xf,  0x2,  0x0,  0x0,  0x30, 0x2d, 0x25, 0x88, 0x21, 0x48, 0x87,
                   0x9,  0x0,  0x8,  0xcb, 0x17, 0x35, 0xed, 0x4a, 0xfb, 0x8d, 0xf4, 0x2a, 0xf0, 0x21, 0x45,
                   0xb8, 0x2,  0x0,  0x0,  0x3f, 0x86, 0x1,  0x99, 0xb,  0x9,  0x2a, 0x72, 0x21, 0x1e, 0x7a,
                   0x2,  0x0,  0x0,  0x8,  0xed, 0x22, 0x6a, 0x81, 0x0,  0xb,  0x68, 0x4f, 0xe9, 0x67, 0xa,
                   0x7b, 0x71, 0x4e, 0x4f, 0xa0, 0x20, 0x0,  0x4,  0x51, 0x1d, 0xf2, 0xd1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xcb, 0x17, 0x35, 0xed, 0x4a, 0xfb, 0x8d, 0xf4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2412}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12333}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18567}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17848}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16262}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7802}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2285}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27265}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 6889;
  uint8_t client_id_bytes[] = {0x68, 0x4f, 0xe9, 0x67, 0xa, 0x7b, 0x71, 0x4e, 0x4f, 0xa0, 0x20};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x51, 0x1d, 0xf2, 0xd1};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "", _willMsg = "\235\177\182N)\GS\253\200\252E\173b\141gO\165\169\ETX\va\209*", _willProps =
// [PropSubscriptionIdentifier 30,PropSharedSubscriptionAvailable 90,PropMaximumPacketSize
// 102,PropRequestResponseInformation 81,PropAssignedClientIdentifier "`T\n@\232\SI\as\ESCC;i\r\DC4\251_\220I.7<\216o
// ",PropReasonString "\161A\141\140e5\231YCa;c5A\176\174\237\131\184w<\f;@",PropRetainAvailable
// 202,PropRequestProblemInformation 6,PropSubscriptionIdentifier 8,PropPayloadFormatIndicator
// 24,PropAuthenticationMethod "\213z\RS\233\164t\162\&2\199vBQ\221",PropRetainAvailable
// 241,PropRequestResponseInformation 83,PropReasonString "[i",PropWillDelayInterval 715]}), _cleanSession = True,
// _keepAlive = 8360, _connID = "\178Ip\r*\206Y\141(\255\184\&4\224\197=\217\172\EM\EOT\\'\RS\229u\172S\202",
// _properties = [PropMaximumPacketSize 16932,PropContentType "",PropServerKeepAlive
// 19286,PropRequestResponseInformation 79,PropContentType
// "\187%]\190:\169\235R8\DC1r\ESCM3\162W\194V",PropSessionExpiryInterval 8066,PropUserProperty "\171"
// "\170B\211\DLE\250\SI\243\214mv\SOQR\"\STX\200\&3]y",PropSubscriptionIdentifier 9,PropAuthenticationMethod
// "\254\182\139U\216UC\239\185f9\143\SOH",PropPayloadFormatIndicator 79]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x10, 0xfe, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe,  0x20, 0xa8, 0x54, 0x27, 0x0,  0x0,  0x42, 0x24,
      0x3,  0x0,  0x0,  0x13, 0x4b, 0x56, 0x19, 0x4f, 0x3,  0x0,  0x12, 0xbb, 0x25, 0x5d, 0xbe, 0x3a, 0xa9, 0xeb, 0x52,
      0x38, 0x11, 0x72, 0x1b, 0x4d, 0x33, 0xa2, 0x57, 0xc2, 0x56, 0x11, 0x0,  0x0,  0x1f, 0x82, 0x26, 0x0,  0x1,  0xab,
      0x0,  0x13, 0xaa, 0x42, 0xd3, 0x10, 0xfa, 0xf,  0xf3, 0xd6, 0x6d, 0x76, 0xe,  0x51, 0x52, 0x22, 0x2,  0xc8, 0x33,
      0x5d, 0x79, 0xb,  0x9,  0x15, 0x0,  0xd,  0xfe, 0xb6, 0x8b, 0x55, 0xd8, 0x55, 0x43, 0xef, 0xb9, 0x66, 0x39, 0x8f,
      0x1,  0x1,  0x4f, 0x0,  0x1b, 0xb2, 0x49, 0x70, 0xd,  0x2a, 0xce, 0x59, 0x8d, 0x28, 0xff, 0xb8, 0x34, 0xe0, 0xc5,
      0x3d, 0xd9, 0xac, 0x19, 0x4,  0x5c, 0x27, 0x1e, 0xe5, 0x75, 0xac, 0x53, 0xca, 0x67, 0xb,  0x1e, 0x2a, 0x5a, 0x27,
      0x0,  0x0,  0x0,  0x66, 0x19, 0x51, 0x12, 0x0,  0x18, 0x60, 0x54, 0xa,  0x40, 0xe8, 0xf,  0x7,  0x73, 0x1b, 0x43,
      0x3b, 0x69, 0xd,  0x14, 0xfb, 0x5f, 0xdc, 0x49, 0x2e, 0x37, 0x3c, 0xd8, 0x6f, 0x20, 0x1f, 0x0,  0x18, 0xa1, 0x41,
      0x8d, 0x8c, 0x65, 0x35, 0xe7, 0x59, 0x43, 0x61, 0x3b, 0x63, 0x35, 0x41, 0xb0, 0xae, 0xed, 0x83, 0xb8, 0x77, 0x3c,
      0xc,  0x3b, 0x40, 0x25, 0xca, 0x17, 0x6,  0xb,  0x8,  0x1,  0x18, 0x15, 0x0,  0xd,  0xd5, 0x7a, 0x1e, 0xe9, 0xa4,
      0x74, 0xa2, 0x32, 0xc7, 0x76, 0x42, 0x51, 0xdd, 0x25, 0xf1, 0x19, 0x53, 0x1f, 0x0,  0x2,  0x5b, 0x69, 0x18, 0x0,
      0x0,  0x2,  0xcb, 0x0,  0x0,  0x0,  0x16, 0xeb, 0xb1, 0xb6, 0x4e, 0x29, 0x1d, 0xfd, 0xc8, 0xfc, 0x45, 0xad, 0x62,
      0x8d, 0x67, 0x4f, 0xa5, 0xa9, 0x3,  0xb,  0x61, 0xd1, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xbb, 0x25, 0x5d, 0xbe, 0x3a, 0xa9, 0xeb, 0x52, 0x38,
                           0x11, 0x72, 0x1b, 0x4d, 0x33, 0xa2, 0x57, 0xc2, 0x56};
  uint8_t bytesprops3[] = {0xaa, 0x42, 0xd3, 0x10, 0xfa, 0xf,  0xf3, 0xd6, 0x6d, 0x76,
                           0xe,  0x51, 0x52, 0x22, 0x2,  0xc8, 0x33, 0x5d, 0x79};
  uint8_t bytesprops2[] = {0xab};
  uint8_t bytesprops4[] = {0xfe, 0xb6, 0x8b, 0x55, 0xd8, 0x55, 0x43, 0xef, 0xb9, 0x66, 0x39, 0x8f, 0x1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16932}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19286}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8066}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops2}, .v = {19, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 79}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x60, 0x54, 0xa,  0x40, 0xe8, 0xf,  0x7,  0x73, 0x1b, 0x43, 0x3b, 0x69,
                               0xd,  0x14, 0xfb, 0x5f, 0xdc, 0x49, 0x2e, 0x37, 0x3c, 0xd8, 0x6f, 0x20};
  uint8_t byteswillprops1[] = {0xa1, 0x41, 0x8d, 0x8c, 0x65, 0x35, 0xe7, 0x59, 0x43, 0x61, 0x3b, 0x63,
                               0x35, 0x41, 0xb0, 0xae, 0xed, 0x83, 0xb8, 0x77, 0x3c, 0xc,  0x3b, 0x40};
  uint8_t byteswillprops2[] = {0xd5, 0x7a, 0x1e, 0xe9, 0xa4, 0x74, 0xa2, 0x32, 0xc7, 0x76, 0x42, 0x51, 0xdd};
  uint8_t byteswillprops3[] = {0x5b, 0x69};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 102}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 715}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xeb, 0xb1, 0xb6, 0x4e, 0x29, 0x1d, 0xfd, 0xc8, 0xfc, 0x45, 0xad,
                                  0x62, 0x8d, 0x67, 0x4f, 0xa5, 0xa9, 0x3,  0xb,  0x61, 0xd1, 0x2a};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 8360;
  uint8_t client_id_bytes[] = {0xb2, 0x49, 0x70, 0xd,  0x2a, 0xce, 0x59, 0x8d, 0x28, 0xff, 0xb8, 0x34, 0xe0, 0xc5,
                               0x3d, 0xd9, 0xac, 0x19, 0x4,  0x5c, 0x27, 0x1e, 0xe5, 0x75, 0xac, 0x53, 0xca};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "H\176\DC3\130\176@\132\210", _password = Just
// "\198\248\US\ETB\143\174JCT\DEL\221a\211\221;\179\128\182\154\207\189o", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\147.\146\246\203'\150]B\EMY\ETB\GS\tM\166q\196ug\DLE\t\191B", _willMsg =
// "\228\164\240r\184\245\201\DC2#9H\152\ETB\188\241\217\202\186\203\197D\220\162\&4\213", _willProps =
// [PropAuthenticationData "\162\166",PropWildcardSubscriptionAvailable 231,PropResponseTopic
// "\242\RSV\214\153\ACK\189\142\227\173\222\148\&6\208\137",PropSharedSubscriptionAvailable 253,PropTopicAlias
// 19038,PropSubscriptionIdentifier 12,PropMaximumPacketSize 28927,PropRequestResponseInformation 68,PropRetainAvailable
// 193,PropUserProperty "\226B" "\148\ACK\191!\\e\132\FS\173\227\NULs\250\221TZ\205T\vA\DC3/",PropContentType
// "r\SOB\STX",PropMaximumQoS 189,PropResponseTopic "\219\&6\187\201\169j\253\ENQR",PropResponseInformation
// "\203z\241N\186\139\215\187\196\189",PropSessionExpiryInterval 29995,PropResponseTopic
// "\240\235\n\224\r\199\222e\131\191D9DRk",PropServerKeepAlive 16658,PropMaximumPacketSize 12740,PropTopicAlias
// 1507,PropMessageExpiryInterval 14889,PropSharedSubscriptionAvailable 226,PropReceiveMaximum
// 15043,PropMaximumPacketSize 26334,PropReceiveMaximum 23369,PropRequestResponseInformation 254,PropUserProperty
// "B\189\RS\134\173%}\SIY\220\217\215\184\153\ahbz" "I\226\231\186\181\214\155",PropMessageExpiryInterval
// 1596,PropWildcardSubscriptionAvailable 35]}), _cleanSession = True, _keepAlive = 28532, _connID =
// "y\245\130FF#\\[\227\&0", _properties = [PropWillDelayInterval 8113,PropAuthenticationMethod
// "\132\SOD\229T\134\165",PropWillDelayInterval 7510,PropReasonString "\253\ACK\136\183\&1\211\&3",PropTopicAlias
// 28415]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0xd4, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf6, 0x6f, 0x74, 0x21, 0x18, 0x0,  0x0,  0x1f, 0xb1,
      0x15, 0x0,  0x7,  0x84, 0xe,  0x44, 0xe5, 0x54, 0x86, 0xa5, 0x18, 0x0,  0x0,  0x1d, 0x56, 0x1f, 0x0,  0x7,  0xfd,
      0x6,  0x88, 0xb7, 0x31, 0xd3, 0x33, 0x23, 0x6e, 0xff, 0x0,  0xa,  0x79, 0xf5, 0x82, 0x46, 0x46, 0x23, 0x5c, 0x5b,
      0xe3, 0x30, 0xc3, 0x1,  0x16, 0x0,  0x2,  0xa2, 0xa6, 0x28, 0xe7, 0x8,  0x0,  0xf,  0xf2, 0x1e, 0x56, 0xd6, 0x99,
      0x6,  0xbd, 0x8e, 0xe3, 0xad, 0xde, 0x94, 0x36, 0xd0, 0x89, 0x2a, 0xfd, 0x23, 0x4a, 0x5e, 0xb,  0xc,  0x27, 0x0,
      0x0,  0x70, 0xff, 0x19, 0x44, 0x25, 0xc1, 0x26, 0x0,  0x2,  0xe2, 0x42, 0x0,  0x16, 0x94, 0x6,  0xbf, 0x21, 0x5c,
      0x65, 0x84, 0x1c, 0xad, 0xe3, 0x0,  0x73, 0xfa, 0xdd, 0x54, 0x5a, 0xcd, 0x54, 0xb,  0x41, 0x13, 0x2f, 0x3,  0x0,
      0x4,  0x72, 0xe,  0x42, 0x2,  0x24, 0xbd, 0x8,  0x0,  0x9,  0xdb, 0x36, 0xbb, 0xc9, 0xa9, 0x6a, 0xfd, 0x5,  0x52,
      0x1a, 0x0,  0xa,  0xcb, 0x7a, 0xf1, 0x4e, 0xba, 0x8b, 0xd7, 0xbb, 0xc4, 0xbd, 0x11, 0x0,  0x0,  0x75, 0x2b, 0x8,
      0x0,  0xf,  0xf0, 0xeb, 0xa,  0xe0, 0xd,  0xc7, 0xde, 0x65, 0x83, 0xbf, 0x44, 0x39, 0x44, 0x52, 0x6b, 0x13, 0x41,
      0x12, 0x27, 0x0,  0x0,  0x31, 0xc4, 0x23, 0x5,  0xe3, 0x2,  0x0,  0x0,  0x3a, 0x29, 0x2a, 0xe2, 0x21, 0x3a, 0xc3,
      0x27, 0x0,  0x0,  0x66, 0xde, 0x21, 0x5b, 0x49, 0x19, 0xfe, 0x26, 0x0,  0x12, 0x42, 0xbd, 0x1e, 0x86, 0xad, 0x25,
      0x7d, 0xf,  0x59, 0xdc, 0xd9, 0xd7, 0xb8, 0x99, 0x7,  0x68, 0x62, 0x7a, 0x0,  0x7,  0x49, 0xe2, 0xe7, 0xba, 0xb5,
      0xd6, 0x9b, 0x2,  0x0,  0x0,  0x6,  0x3c, 0x28, 0x23, 0x0,  0x18, 0x93, 0x2e, 0x92, 0xf6, 0xcb, 0x27, 0x96, 0x5d,
      0x42, 0x19, 0x59, 0x17, 0x1d, 0x9,  0x4d, 0xa6, 0x71, 0xc4, 0x75, 0x67, 0x10, 0x9,  0xbf, 0x42, 0x0,  0x19, 0xe4,
      0xa4, 0xf0, 0x72, 0xb8, 0xf5, 0xc9, 0x12, 0x23, 0x39, 0x48, 0x98, 0x17, 0xbc, 0xf1, 0xd9, 0xca, 0xba, 0xcb, 0xc5,
      0x44, 0xdc, 0xa2, 0x34, 0xd5, 0x0,  0x8,  0x48, 0xb0, 0x13, 0x82, 0xb0, 0x40, 0x84, 0xd2, 0x0,  0x16, 0xc6, 0xf8,
      0x1f, 0x17, 0x8f, 0xae, 0x4a, 0x43, 0x54, 0x7f, 0xdd, 0x61, 0xd3, 0xdd, 0x3b, 0xb3, 0x80, 0xb6, 0x9a, 0xcf, 0xbd,
      0x6f};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x84, 0xe, 0x44, 0xe5, 0x54, 0x86, 0xa5};
  uint8_t bytesprops1[] = {0xfd, 0x6, 0x88, 0xb7, 0x31, 0xd3, 0x33};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8113}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7510}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28415}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa2, 0xa6};
  uint8_t byteswillprops1[] = {0xf2, 0x1e, 0x56, 0xd6, 0x99, 0x6, 0xbd, 0x8e, 0xe3, 0xad, 0xde, 0x94, 0x36, 0xd0, 0x89};
  uint8_t byteswillprops3[] = {0x94, 0x6,  0xbf, 0x21, 0x5c, 0x65, 0x84, 0x1c, 0xad, 0xe3, 0x0,
                               0x73, 0xfa, 0xdd, 0x54, 0x5a, 0xcd, 0x54, 0xb,  0x41, 0x13, 0x2f};
  uint8_t byteswillprops2[] = {0xe2, 0x42};
  uint8_t byteswillprops4[] = {0x72, 0xe, 0x42, 0x2};
  uint8_t byteswillprops5[] = {0xdb, 0x36, 0xbb, 0xc9, 0xa9, 0x6a, 0xfd, 0x5, 0x52};
  uint8_t byteswillprops6[] = {0xcb, 0x7a, 0xf1, 0x4e, 0xba, 0x8b, 0xd7, 0xbb, 0xc4, 0xbd};
  uint8_t byteswillprops7[] = {0xf0, 0xeb, 0xa, 0xe0, 0xd, 0xc7, 0xde, 0x65, 0x83, 0xbf, 0x44, 0x39, 0x44, 0x52, 0x6b};
  uint8_t byteswillprops9[] = {0x49, 0xe2, 0xe7, 0xba, 0xb5, 0xd6, 0x9b};
  uint8_t byteswillprops8[] = {0x42, 0xbd, 0x1e, 0x86, 0xad, 0x25, 0x7d, 0xf,  0x59,
                               0xdc, 0xd9, 0xd7, 0xb8, 0x99, 0x7,  0x68, 0x62, 0x7a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19038}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28927}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {2, (char*)&byteswillprops2}, .v = {22, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29995}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16658}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12740}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1507}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14889}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15043}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26334}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23369}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&byteswillprops8}, .v = {7, (char*)&byteswillprops9}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1596}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 35}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x93, 0x2e, 0x92, 0xf6, 0xcb, 0x27, 0x96, 0x5d, 0x42, 0x19, 0x59, 0x17,
                                0x1d, 0x9,  0x4d, 0xa6, 0x71, 0xc4, 0x75, 0x67, 0x10, 0x9,  0xbf, 0x42};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe4, 0xa4, 0xf0, 0x72, 0xb8, 0xf5, 0xc9, 0x12, 0x23, 0x39, 0x48, 0x98, 0x17,
                                  0xbc, 0xf1, 0xd9, 0xca, 0xba, 0xcb, 0xc5, 0x44, 0xdc, 0xa2, 0x34, 0xd5};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28532;
  uint8_t client_id_bytes[] = {0x79, 0xf5, 0x82, 0x46, 0x46, 0x23, 0x5c, 0x5b, 0xe3, 0x30};
  lwmqtt_string_t client_id = {10, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x48, 0xb0, 0x13, 0x82, 0xb0, 0x40, 0x84, 0xd2};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc6, 0xf8, 0x1f, 0x17, 0x8f, 0xae, 0x4a, 0x43, 0x54, 0x7f, 0xdd,
                              0x61, 0xd3, 0xdd, 0x3b, 0xb3, 0x80, 0xb6, 0x9a, 0xcf, 0xbd, 0x6f};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\232\220\210", _password = Just
// "Q\222\CAN\156\222j\201*\143\147\STX\155\152P\n\166#\139", _lastWill = Just (LastWill {_willRetain = False, _willQoS
// = QoS2, _willTopic = "\NAK\166\247\190f\227\STX", _willMsg =
// "Pu4\232\181\200\&73\211\251l\247WIl\248g\236i\218\139\136\182\208\241!\195\244\162", _willProps =
// [PropAssignedClientIdentifier "\179\229\155(5)\221Vb\198I\"\142\239Nn\210\ESC\209-\ESCa",PropServerReference
// "\ESC\176x\EOT\239^r\v\242",PropWildcardSubscriptionAvailable 237,PropSubscriptionIdentifier
// 14,PropAuthenticationData
// "\145\231\151\ACK\174\232\212\178\DC3v\EOT\150\129B\215c\212\193c\DELd\137",PropMessageExpiryInterval 8788]}),
// _cleanSession = False, _keepAlive = 16792, _connID = "\144\154@\235\163ha\251\SO\244\151\244\235", _properties =
// [PropReasonString
// "\153\252\153\234\157\229lb\GS\201\f#d\239\DC2|Y\v\244\174\237\DC4\136\168\233A\148\220\143",PropServerKeepAlive
// 4154,PropTopicAlias 807,PropAssignedClientIdentifier "\SO;{>\RS\183}\239\229tL\200\147\242k5M",PropReasonString
// "+\r6\ETXV\214",PropSubscriptionIdentifier 10,PropResponseTopic
// "=G\163\128\221\STX\160\208\190]\DEL",PropMessageExpiryInterval 15432,PropMaximumPacketSize 7769,PropServerKeepAlive
// 18572,PropUserProperty "\215d\164\215\246LY\134\176\138\220"
// "q\199\EM\134\ETB\143\133\173\242U\224\&5\243\159\SO\144\CANi",PropContentType
// "\213(\"\163\159\144\214\129~\DEL\188nt$\236J\187:\130@\253\n\150\131;Cq",PropServerKeepAlive
// 23472,PropAuthenticationData "!w",PropSessionExpiryInterval 18606,PropSubscriptionIdentifierAvailable
// 170,PropMessageExpiryInterval 32525,PropSessionExpiryInterval 16843,PropMaximumQoS 235,PropMaximumPacketSize
// 1603,PropAuthenticationMethod "\STX\245\226\t",PropSharedSubscriptionAvailable 59,PropUserProperty
// "\240\212\181\250\165\139\166\129\219\192\195x;\249\133\ACK\220@\157O\183\161\227\DC4\140"
// "\241+\165S\140\231",PropSubscriptionIdentifier 8]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x10, 0x93, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x41, 0x98, 0xef, 0x1,  0x1f, 0x0,  0x1d, 0x99,
      0xfc, 0x99, 0xea, 0x9d, 0xe5, 0x6c, 0x62, 0x1d, 0xc9, 0xc,  0x23, 0x64, 0xef, 0x12, 0x7c, 0x59, 0xb,  0xf4, 0xae,
      0xed, 0x14, 0x88, 0xa8, 0xe9, 0x41, 0x94, 0xdc, 0x8f, 0x13, 0x10, 0x3a, 0x23, 0x3,  0x27, 0x12, 0x0,  0x11, 0xe,
      0x3b, 0x7b, 0x3e, 0x1e, 0xb7, 0x7d, 0xef, 0xe5, 0x74, 0x4c, 0xc8, 0x93, 0xf2, 0x6b, 0x35, 0x4d, 0x1f, 0x0,  0x6,
      0x2b, 0xd,  0x36, 0x3,  0x56, 0xd6, 0xb,  0xa,  0x8,  0x0,  0xb,  0x3d, 0x47, 0xa3, 0x80, 0xdd, 0x2,  0xa0, 0xd0,
      0xbe, 0x5d, 0x7f, 0x2,  0x0,  0x0,  0x3c, 0x48, 0x27, 0x0,  0x0,  0x1e, 0x59, 0x13, 0x48, 0x8c, 0x26, 0x0,  0xb,
      0xd7, 0x64, 0xa4, 0xd7, 0xf6, 0x4c, 0x59, 0x86, 0xb0, 0x8a, 0xdc, 0x0,  0x12, 0x71, 0xc7, 0x19, 0x86, 0x17, 0x8f,
      0x85, 0xad, 0xf2, 0x55, 0xe0, 0x35, 0xf3, 0x9f, 0xe,  0x90, 0x18, 0x69, 0x3,  0x0,  0x1b, 0xd5, 0x28, 0x22, 0xa3,
      0x9f, 0x90, 0xd6, 0x81, 0x7e, 0x7f, 0xbc, 0x6e, 0x74, 0x24, 0xec, 0x4a, 0xbb, 0x3a, 0x82, 0x40, 0xfd, 0xa,  0x96,
      0x83, 0x3b, 0x43, 0x71, 0x13, 0x5b, 0xb0, 0x16, 0x0,  0x2,  0x21, 0x77, 0x11, 0x0,  0x0,  0x48, 0xae, 0x29, 0xaa,
      0x2,  0x0,  0x0,  0x7f, 0xd,  0x11, 0x0,  0x0,  0x41, 0xcb, 0x24, 0xeb, 0x27, 0x0,  0x0,  0x6,  0x43, 0x15, 0x0,
      0x4,  0x2,  0xf5, 0xe2, 0x9,  0x2a, 0x3b, 0x26, 0x0,  0x19, 0xf0, 0xd4, 0xb5, 0xfa, 0xa5, 0x8b, 0xa6, 0x81, 0xdb,
      0xc0, 0xc3, 0x78, 0x3b, 0xf9, 0x85, 0x6,  0xdc, 0x40, 0x9d, 0x4f, 0xb7, 0xa1, 0xe3, 0x14, 0x8c, 0x0,  0x6,  0xf1,
      0x2b, 0xa5, 0x53, 0x8c, 0xe7, 0xb,  0x8,  0x0,  0xd,  0x90, 0x9a, 0x40, 0xeb, 0xa3, 0x68, 0x61, 0xfb, 0xe,  0xf4,
      0x97, 0xf4, 0xeb, 0x47, 0x12, 0x0,  0x16, 0xb3, 0xe5, 0x9b, 0x28, 0x35, 0x29, 0xdd, 0x56, 0x62, 0xc6, 0x49, 0x22,
      0x8e, 0xef, 0x4e, 0x6e, 0xd2, 0x1b, 0xd1, 0x2d, 0x1b, 0x61, 0x1c, 0x0,  0x9,  0x1b, 0xb0, 0x78, 0x4,  0xef, 0x5e,
      0x72, 0xb,  0xf2, 0x28, 0xed, 0xb,  0xe,  0x16, 0x0,  0x16, 0x91, 0xe7, 0x97, 0x6,  0xae, 0xe8, 0xd4, 0xb2, 0x13,
      0x76, 0x4,  0x96, 0x81, 0x42, 0xd7, 0x63, 0xd4, 0xc1, 0x63, 0x7f, 0x64, 0x89, 0x2,  0x0,  0x0,  0x22, 0x54, 0x0,
      0x7,  0x15, 0xa6, 0xf7, 0xbe, 0x66, 0xe3, 0x2,  0x0,  0x1d, 0x50, 0x75, 0x34, 0xe8, 0xb5, 0xc8, 0x37, 0x33, 0xd3,
      0xfb, 0x6c, 0xf7, 0x57, 0x49, 0x6c, 0xf8, 0x67, 0xec, 0x69, 0xda, 0x8b, 0x88, 0xb6, 0xd0, 0xf1, 0x21, 0xc3, 0xf4,
      0xa2, 0x0,  0x3,  0xe8, 0xdc, 0xd2, 0x0,  0x12, 0x51, 0xde, 0x18, 0x9c, 0xde, 0x6a, 0xc9, 0x2a, 0x8f, 0x93, 0x2,
      0x9b, 0x98, 0x50, 0xa,  0xa6, 0x23, 0x8b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x99, 0xfc, 0x99, 0xea, 0x9d, 0xe5, 0x6c, 0x62, 0x1d, 0xc9, 0xc,  0x23, 0x64, 0xef, 0x12,
                           0x7c, 0x59, 0xb,  0xf4, 0xae, 0xed, 0x14, 0x88, 0xa8, 0xe9, 0x41, 0x94, 0xdc, 0x8f};
  uint8_t bytesprops1[] = {0xe,  0x3b, 0x7b, 0x3e, 0x1e, 0xb7, 0x7d, 0xef, 0xe5,
                           0x74, 0x4c, 0xc8, 0x93, 0xf2, 0x6b, 0x35, 0x4d};
  uint8_t bytesprops2[] = {0x2b, 0xd, 0x36, 0x3, 0x56, 0xd6};
  uint8_t bytesprops3[] = {0x3d, 0x47, 0xa3, 0x80, 0xdd, 0x2, 0xa0, 0xd0, 0xbe, 0x5d, 0x7f};
  uint8_t bytesprops5[] = {0x71, 0xc7, 0x19, 0x86, 0x17, 0x8f, 0x85, 0xad, 0xf2,
                           0x55, 0xe0, 0x35, 0xf3, 0x9f, 0xe,  0x90, 0x18, 0x69};
  uint8_t bytesprops4[] = {0xd7, 0x64, 0xa4, 0xd7, 0xf6, 0x4c, 0x59, 0x86, 0xb0, 0x8a, 0xdc};
  uint8_t bytesprops6[] = {0xd5, 0x28, 0x22, 0xa3, 0x9f, 0x90, 0xd6, 0x81, 0x7e, 0x7f, 0xbc, 0x6e, 0x74, 0x24,
                           0xec, 0x4a, 0xbb, 0x3a, 0x82, 0x40, 0xfd, 0xa,  0x96, 0x83, 0x3b, 0x43, 0x71};
  uint8_t bytesprops7[] = {0x21, 0x77};
  uint8_t bytesprops8[] = {0x2, 0xf5, 0xe2, 0x9};
  uint8_t bytesprops10[] = {0xf1, 0x2b, 0xa5, 0x53, 0x8c, 0xe7};
  uint8_t bytesprops9[] = {0xf0, 0xd4, 0xb5, 0xfa, 0xa5, 0x8b, 0xa6, 0x81, 0xdb, 0xc0, 0xc3, 0x78, 0x3b,
                           0xf9, 0x85, 0x6,  0xdc, 0x40, 0x9d, 0x4f, 0xb7, 0xa1, 0xe3, 0x14, 0x8c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4154}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 807}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15432}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7769}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18572}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops4}, .v = {18, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23472}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18606}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32525}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16843}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1603}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops9}, .v = {6, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb3, 0xe5, 0x9b, 0x28, 0x35, 0x29, 0xdd, 0x56, 0x62, 0xc6, 0x49,
                               0x22, 0x8e, 0xef, 0x4e, 0x6e, 0xd2, 0x1b, 0xd1, 0x2d, 0x1b, 0x61};
  uint8_t byteswillprops1[] = {0x1b, 0xb0, 0x78, 0x4, 0xef, 0x5e, 0x72, 0xb, 0xf2};
  uint8_t byteswillprops2[] = {0x91, 0xe7, 0x97, 0x6,  0xae, 0xe8, 0xd4, 0xb2, 0x13, 0x76, 0x4,
                               0x96, 0x81, 0x42, 0xd7, 0x63, 0xd4, 0xc1, 0x63, 0x7f, 0x64, 0x89};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8788}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x15, 0xa6, 0xf7, 0xbe, 0x66, 0xe3, 0x2};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x50, 0x75, 0x34, 0xe8, 0xb5, 0xc8, 0x37, 0x33, 0xd3, 0xfb,
                                  0x6c, 0xf7, 0x57, 0x49, 0x6c, 0xf8, 0x67, 0xec, 0x69, 0xda,
                                  0x8b, 0x88, 0xb6, 0xd0, 0xf1, 0x21, 0xc3, 0xf4, 0xa2};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 16792;
  uint8_t client_id_bytes[] = {0x90, 0x9a, 0x40, 0xeb, 0xa3, 0x68, 0x61, 0xfb, 0xe, 0xf4, 0x97, 0xf4, 0xeb};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe8, 0xdc, 0xd2};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x51, 0xde, 0x18, 0x9c, 0xde, 0x6a, 0xc9, 0x2a, 0x8f,
                              0x93, 0x2,  0x9b, 0x98, 0x50, 0xa,  0xa6, 0x23, 0x8b};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\208\&08\153\253\129\180\139MgC\ACKe\252k\131\238w\f\234\212", _password = Just
// "\174\131\134S\237\RS", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "oa\v,+\129{\223N\216\&2}\SI\161-\165a\146\&7\248\166\224\189\SOH\ESC\182", _willMsg = "m]", _willProps =
// [PropMessageExpiryInterval 7966,PropReceiveMaximum 11454,PropTopicAliasMaximum 24638,PropCorrelationData
// "p\175>\180\160\170",PropCorrelationData "r\194\&1",PropResponseTopic "\134\DC4\197Knd
// \164n\NULU\194F!#\247*\151,\EM\184\249\CAN(\174.",PropRequestResponseInformation 39,PropWildcardSubscriptionAvailable
// 177,PropSubscriptionIdentifier 5,PropRequestResponseInformation 9,PropSubscriptionIdentifier
// 19,PropRequestProblemInformation 250,PropMaximumQoS 197,PropRequestProblemInformation 121,PropTopicAliasMaximum
// 28781,PropPayloadFormatIndicator 13,PropRequestResponseInformation 188,PropUserProperty "I~i\190\250"
// "\247\151\212\245=/P\218\160\218\DC2\186\232P<hF\199\&5\DC4",PropReasonString
// "\213%6\159\238/\200\243\187+\235\238",PropCorrelationData "\EM\177
// \184\128\220F\247\156\157\&2\ETX\245\212\243\188\250",PropContentType
// "\206t\174kob\170\\\227\236\206\SUB\245\148HC'O",PropWillDelayInterval 30870,PropContentType
// "\235\235&\170\ESCV\SYN'Y\195\EM\149",PropTopicAliasMaximum 18914,PropRetainAvailable
// 173,PropRequestProblemInformation 79,PropMessageExpiryInterval 28838]}), _cleanSession = False, _keepAlive = 3974,
// _connID = "\203\150\211\212\222);\208\149\129\DC4~\242y\186\143\254U\154\SYNx\245\248\f\166m!", _properties =
// [PropTopicAliasMaximum 20901,PropReceiveMaximum 5178,PropMessageExpiryInterval 32130,PropSharedSubscriptionAvailable
// 31,PropServerReference "\USJ'8\253\219R\234\182\233\197",PropUserProperty "\169\165\227\139v`\253P" ""]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x10, 0xd5, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0xf,  0x86, 0x28, 0x22, 0x51, 0xa5, 0x21, 0x14,
      0x3a, 0x2,  0x0,  0x0,  0x7d, 0x82, 0x2a, 0x1f, 0x1c, 0x0,  0xb,  0x1f, 0x4a, 0x27, 0x38, 0xfd, 0xdb, 0x52, 0xea,
      0xb6, 0xe9, 0xc5, 0x26, 0x0,  0x8,  0xa9, 0xa5, 0xe3, 0x8b, 0x76, 0x60, 0xfd, 0x50, 0x0,  0x0,  0x0,  0x1b, 0xcb,
      0x96, 0xd3, 0xd4, 0xde, 0x29, 0x3b, 0xd0, 0x95, 0x81, 0x14, 0x7e, 0xf2, 0x79, 0xba, 0x8f, 0xfe, 0x55, 0x9a, 0x16,
      0x78, 0xf5, 0xf8, 0xc,  0xa6, 0x6d, 0x21, 0xc4, 0x1,  0x2,  0x0,  0x0,  0x1f, 0x1e, 0x21, 0x2c, 0xbe, 0x22, 0x60,
      0x3e, 0x9,  0x0,  0x6,  0x70, 0xaf, 0x3e, 0xb4, 0xa0, 0xaa, 0x9,  0x0,  0x3,  0x72, 0xc2, 0x31, 0x8,  0x0,  0x1a,
      0x86, 0x14, 0xc5, 0x4b, 0x6e, 0x64, 0x20, 0xa4, 0x6e, 0x0,  0x55, 0xc2, 0x46, 0x21, 0x23, 0xf7, 0x2a, 0x97, 0x2c,
      0x19, 0xb8, 0xf9, 0x18, 0x28, 0xae, 0x2e, 0x19, 0x27, 0x28, 0xb1, 0xb,  0x5,  0x19, 0x9,  0xb,  0x13, 0x17, 0xfa,
      0x24, 0xc5, 0x17, 0x79, 0x22, 0x70, 0x6d, 0x1,  0xd,  0x19, 0xbc, 0x26, 0x0,  0x5,  0x49, 0x7e, 0x69, 0xbe, 0xfa,
      0x0,  0x14, 0xf7, 0x97, 0xd4, 0xf5, 0x3d, 0x2f, 0x50, 0xda, 0xa0, 0xda, 0x12, 0xba, 0xe8, 0x50, 0x3c, 0x68, 0x46,
      0xc7, 0x35, 0x14, 0x1f, 0x0,  0xc,  0xd5, 0x25, 0x36, 0x9f, 0xee, 0x2f, 0xc8, 0xf3, 0xbb, 0x2b, 0xeb, 0xee, 0x9,
      0x0,  0x11, 0x19, 0xb1, 0x20, 0xb8, 0x80, 0xdc, 0x46, 0xf7, 0x9c, 0x9d, 0x32, 0x3,  0xf5, 0xd4, 0xf3, 0xbc, 0xfa,
      0x3,  0x0,  0x12, 0xce, 0x74, 0xae, 0x6b, 0x6f, 0x62, 0xaa, 0x5c, 0xe3, 0xec, 0xce, 0x1a, 0xf5, 0x94, 0x48, 0x43,
      0x27, 0x4f, 0x18, 0x0,  0x0,  0x78, 0x96, 0x3,  0x0,  0xc,  0xeb, 0xeb, 0x26, 0xaa, 0x1b, 0x56, 0x16, 0x27, 0x59,
      0xc3, 0x19, 0x95, 0x22, 0x49, 0xe2, 0x25, 0xad, 0x17, 0x4f, 0x2,  0x0,  0x0,  0x70, 0xa6, 0x0,  0x1a, 0x6f, 0x61,
      0xb,  0x2c, 0x2b, 0x81, 0x7b, 0xdf, 0x4e, 0xd8, 0x32, 0x7d, 0xf,  0xa1, 0x2d, 0xa5, 0x61, 0x92, 0x37, 0xf8, 0xa6,
      0xe0, 0xbd, 0x1,  0x1b, 0xb6, 0x0,  0x2,  0x6d, 0x5d, 0x0,  0x15, 0xd0, 0x30, 0x38, 0x99, 0xfd, 0x81, 0xb4, 0x8b,
      0x4d, 0x67, 0x43, 0x6,  0x65, 0xfc, 0x6b, 0x83, 0xee, 0x77, 0xc,  0xea, 0xd4, 0x0,  0x6,  0xae, 0x83, 0x86, 0x53,
      0xed, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1f, 0x4a, 0x27, 0x38, 0xfd, 0xdb, 0x52, 0xea, 0xb6, 0xe9, 0xc5};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops1[] = {0xa9, 0xa5, 0xe3, 0x8b, 0x76, 0x60, 0xfd, 0x50};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20901}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5178}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32130}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops1}, .v = {0, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x70, 0xaf, 0x3e, 0xb4, 0xa0, 0xaa};
  uint8_t byteswillprops1[] = {0x72, 0xc2, 0x31};
  uint8_t byteswillprops2[] = {0x86, 0x14, 0xc5, 0x4b, 0x6e, 0x64, 0x20, 0xa4, 0x6e, 0x0,  0x55, 0xc2, 0x46,
                               0x21, 0x23, 0xf7, 0x2a, 0x97, 0x2c, 0x19, 0xb8, 0xf9, 0x18, 0x28, 0xae, 0x2e};
  uint8_t byteswillprops4[] = {0xf7, 0x97, 0xd4, 0xf5, 0x3d, 0x2f, 0x50, 0xda, 0xa0, 0xda,
                               0x12, 0xba, 0xe8, 0x50, 0x3c, 0x68, 0x46, 0xc7, 0x35, 0x14};
  uint8_t byteswillprops3[] = {0x49, 0x7e, 0x69, 0xbe, 0xfa};
  uint8_t byteswillprops5[] = {0xd5, 0x25, 0x36, 0x9f, 0xee, 0x2f, 0xc8, 0xf3, 0xbb, 0x2b, 0xeb, 0xee};
  uint8_t byteswillprops6[] = {0x19, 0xb1, 0x20, 0xb8, 0x80, 0xdc, 0x46, 0xf7, 0x9c,
                               0x9d, 0x32, 0x3,  0xf5, 0xd4, 0xf3, 0xbc, 0xfa};
  uint8_t byteswillprops7[] = {0xce, 0x74, 0xae, 0x6b, 0x6f, 0x62, 0xaa, 0x5c, 0xe3,
                               0xec, 0xce, 0x1a, 0xf5, 0x94, 0x48, 0x43, 0x27, 0x4f};
  uint8_t byteswillprops8[] = {0xeb, 0xeb, 0x26, 0xaa, 0x1b, 0x56, 0x16, 0x27, 0x59, 0xc3, 0x19, 0x95};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7966}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11454}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24638}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28781}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {5, (char*)&byteswillprops3}, .v = {20, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30870}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18914}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28838}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x6f, 0x61, 0xb,  0x2c, 0x2b, 0x81, 0x7b, 0xdf, 0x4e, 0xd8, 0x32, 0x7d, 0xf,
                                0xa1, 0x2d, 0xa5, 0x61, 0x92, 0x37, 0xf8, 0xa6, 0xe0, 0xbd, 0x1,  0x1b, 0xb6};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x6d, 0x5d};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3974;
  uint8_t client_id_bytes[] = {0xcb, 0x96, 0xd3, 0xd4, 0xde, 0x29, 0x3b, 0xd0, 0x95, 0x81, 0x14, 0x7e, 0xf2, 0x79,
                               0xba, 0x8f, 0xfe, 0x55, 0x9a, 0x16, 0x78, 0xf5, 0xf8, 0xc,  0xa6, 0x6d, 0x21};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd0, 0x30, 0x38, 0x99, 0xfd, 0x81, 0xb4, 0x8b, 0x4d, 0x67, 0x43,
                              0x6,  0x65, 0xfc, 0x6b, 0x83, 0xee, 0x77, 0xc,  0xea, 0xd4};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xae, 0x83, 0x86, 0x53, 0xed, 0x1e};
  lwmqtt_string_t password = {6, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\188\129", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "\129\&3\164\SI_\141bs\171\247\163v\159\181\150T\180\136Az", _willMsg = "
// /\189\141D\179\139\140\223\211:A\219\205Fu\DC1", _willProps = [PropUserProperty
// "\210>\220\151n\STXW+\140\132l\221P\137\191Hn\173\243\209\180\171\208\128\CAN?Ii\FS#"
// "\GS\194>g\216yKl:\210@\f!\ESC.\201\130F\a\198\137??{\EOT9\200\235\ESC\211",PropMessageExpiryInterval
// 4108,PropRequestResponseInformation 206,PropTopicAliasMaximum 1362,PropMessageExpiryInterval 20063,PropUserProperty
// "\a\245\144%?!\255\206\199\227g" "\195_\203\179-\241\207\137\&27\135",PropSessionExpiryInterval
// 2669,PropRequestResponseInformation 237,PropUserProperty
// "\216\228\164\208\222\234m4\200\156\\\SUB\176\252\167>\227\217\SOH\252f\185\186/\245\220l.=\233"
// "\212\206v\243\&0\235g\200\250\188\207P\ETB\130\167\137@(\191_\139\DC3}\238\227",PropServerKeepAlive
// 13533,PropResponseInformation "\151\195\168\188?\165}",PropContentType
// "\182\152!\SO\214\245\202\210\FS&",PropMessageExpiryInterval 14172]}), _cleanSession = False, _keepAlive = 6602,
// _connID = "%\197u\242|QM/\NUL\239\144\a\176\173\138\248\143\&0>8", _properties = [PropMessageExpiryInterval
// 3109,PropSubscriptionIdentifier 11,PropWildcardSubscriptionAvailable 69,PropWildcardSubscriptionAvailable
// 86,PropContentType "\254B\140\166M\249F\180\b\DC1\168\f\234L\160}R9\235\156Fr\150",PropReceiveMaximum
// 10259,PropTopicAlias 18041,PropMessageExpiryInterval 29565,PropContentType
// "\DC1\ETB\251\238\242\222\186f\209\STX\197\US\239:P[W\222\&9\238-",PropMessageExpiryInterval
// 2224,PropSubscriptionIdentifierAvailable 181,PropWildcardSubscriptionAvailable 82,PropWillDelayInterval
// 17653,PropWillDelayInterval 32460,PropUserProperty
// "k\224`c\182a\166\232\&2\179\209\150\145\220\DLE~\213k\SI\177\138N\157m\211q\247\182\178O"
// "\244\204{\211\152\222\198Y\231M5NT\244\203\b9\129\CAN\254\RSS\t\242\222\140\160O\148\223",PropMaximumQoS
// 148,PropReceiveMaximum 1807,PropServerReference "\173\180\137",PropAuthenticationMethod
// ",\161\144",PropPayloadFormatIndicator 93,PropResponseInformation "\208nX~",PropPayloadFormatIndicator
// 225,PropMessageExpiryInterval 28847]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x10, 0xdb, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x44, 0x19, 0xca, 0xbd, 0x1,  0x2,  0x0,  0x0,  0xc,
      0x25, 0xb,  0xb,  0x28, 0x45, 0x28, 0x56, 0x3,  0x0,  0x17, 0xfe, 0x42, 0x8c, 0xa6, 0x4d, 0xf9, 0x46, 0xb4, 0x8,
      0x11, 0xa8, 0xc,  0xea, 0x4c, 0xa0, 0x7d, 0x52, 0x39, 0xeb, 0x9c, 0x46, 0x72, 0x96, 0x21, 0x28, 0x13, 0x23, 0x46,
      0x79, 0x2,  0x0,  0x0,  0x73, 0x7d, 0x3,  0x0,  0x15, 0x11, 0x17, 0xfb, 0xee, 0xf2, 0xde, 0xba, 0x66, 0xd1, 0x2,
      0xc5, 0x1f, 0xef, 0x3a, 0x50, 0x5b, 0x57, 0xde, 0x39, 0xee, 0x2d, 0x2,  0x0,  0x0,  0x8,  0xb0, 0x29, 0xb5, 0x28,
      0x52, 0x18, 0x0,  0x0,  0x44, 0xf5, 0x18, 0x0,  0x0,  0x7e, 0xcc, 0x26, 0x0,  0x1e, 0x6b, 0xe0, 0x60, 0x63, 0xb6,
      0x61, 0xa6, 0xe8, 0x32, 0xb3, 0xd1, 0x96, 0x91, 0xdc, 0x10, 0x7e, 0xd5, 0x6b, 0xf,  0xb1, 0x8a, 0x4e, 0x9d, 0x6d,
      0xd3, 0x71, 0xf7, 0xb6, 0xb2, 0x4f, 0x0,  0x1e, 0xf4, 0xcc, 0x7b, 0xd3, 0x98, 0xde, 0xc6, 0x59, 0xe7, 0x4d, 0x35,
      0x4e, 0x54, 0xf4, 0xcb, 0x8,  0x39, 0x81, 0x18, 0xfe, 0x1e, 0x53, 0x9,  0xf2, 0xde, 0x8c, 0xa0, 0x4f, 0x94, 0xdf,
      0x24, 0x94, 0x21, 0x7,  0xf,  0x1c, 0x0,  0x3,  0xad, 0xb4, 0x89, 0x15, 0x0,  0x3,  0x2c, 0xa1, 0x90, 0x1,  0x5d,
      0x1a, 0x0,  0x4,  0xd0, 0x6e, 0x58, 0x7e, 0x1,  0xe1, 0x2,  0x0,  0x0,  0x70, 0xaf, 0x0,  0x14, 0x25, 0xc5, 0x75,
      0xf2, 0x7c, 0x51, 0x4d, 0x2f, 0x0,  0xef, 0x90, 0x7,  0xb0, 0xad, 0x8a, 0xf8, 0x8f, 0x30, 0x3e, 0x38, 0xcd, 0x1,
      0x26, 0x0,  0x1e, 0xd2, 0x3e, 0xdc, 0x97, 0x6e, 0x2,  0x57, 0x2b, 0x8c, 0x84, 0x6c, 0xdd, 0x50, 0x89, 0xbf, 0x48,
      0x6e, 0xad, 0xf3, 0xd1, 0xb4, 0xab, 0xd0, 0x80, 0x18, 0x3f, 0x49, 0x69, 0x1c, 0x23, 0x0,  0x1e, 0x1d, 0xc2, 0x3e,
      0x67, 0xd8, 0x79, 0x4b, 0x6c, 0x3a, 0xd2, 0x40, 0xc,  0x21, 0x1b, 0x2e, 0xc9, 0x82, 0x46, 0x7,  0xc6, 0x89, 0x3f,
      0x3f, 0x7b, 0x4,  0x39, 0xc8, 0xeb, 0x1b, 0xd3, 0x2,  0x0,  0x0,  0x10, 0xc,  0x19, 0xce, 0x22, 0x5,  0x52, 0x2,
      0x0,  0x0,  0x4e, 0x5f, 0x26, 0x0,  0xb,  0x7,  0xf5, 0x90, 0x25, 0x3f, 0x21, 0xff, 0xce, 0xc7, 0xe3, 0x67, 0x0,
      0xb,  0xc3, 0x5f, 0xcb, 0xb3, 0x2d, 0xf1, 0xcf, 0x89, 0x32, 0x37, 0x87, 0x11, 0x0,  0x0,  0xa,  0x6d, 0x19, 0xed,
      0x26, 0x0,  0x1e, 0xd8, 0xe4, 0xa4, 0xd0, 0xde, 0xea, 0x6d, 0x34, 0xc8, 0x9c, 0x5c, 0x1a, 0xb0, 0xfc, 0xa7, 0x3e,
      0xe3, 0xd9, 0x1,  0xfc, 0x66, 0xb9, 0xba, 0x2f, 0xf5, 0xdc, 0x6c, 0x2e, 0x3d, 0xe9, 0x0,  0x19, 0xd4, 0xce, 0x76,
      0xf3, 0x30, 0xeb, 0x67, 0xc8, 0xfa, 0xbc, 0xcf, 0x50, 0x17, 0x82, 0xa7, 0x89, 0x40, 0x28, 0xbf, 0x5f, 0x8b, 0x13,
      0x7d, 0xee, 0xe3, 0x13, 0x34, 0xdd, 0x1a, 0x0,  0x7,  0x97, 0xc3, 0xa8, 0xbc, 0x3f, 0xa5, 0x7d, 0x3,  0x0,  0xa,
      0xb6, 0x98, 0x21, 0xe,  0xd6, 0xf5, 0xca, 0xd2, 0x1c, 0x26, 0x2,  0x0,  0x0,  0x37, 0x5c, 0x0,  0x14, 0x81, 0x33,
      0xa4, 0xf,  0x5f, 0x8d, 0x62, 0x73, 0xab, 0xf7, 0xa3, 0x76, 0x9f, 0xb5, 0x96, 0x54, 0xb4, 0x88, 0x41, 0x7a, 0x0,
      0x11, 0x20, 0x2f, 0xbd, 0x8d, 0x44, 0xb3, 0x8b, 0x8c, 0xdf, 0xd3, 0x3a, 0x41, 0xdb, 0xcd, 0x46, 0x75, 0x11, 0x0,
      0x2,  0xbc, 0x81};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xfe, 0x42, 0x8c, 0xa6, 0x4d, 0xf9, 0x46, 0xb4, 0x8,  0x11, 0xa8, 0xc,
                           0xea, 0x4c, 0xa0, 0x7d, 0x52, 0x39, 0xeb, 0x9c, 0x46, 0x72, 0x96};
  uint8_t bytesprops1[] = {0x11, 0x17, 0xfb, 0xee, 0xf2, 0xde, 0xba, 0x66, 0xd1, 0x2, 0xc5,
                           0x1f, 0xef, 0x3a, 0x50, 0x5b, 0x57, 0xde, 0x39, 0xee, 0x2d};
  uint8_t bytesprops3[] = {0xf4, 0xcc, 0x7b, 0xd3, 0x98, 0xde, 0xc6, 0x59, 0xe7, 0x4d, 0x35, 0x4e, 0x54, 0xf4, 0xcb,
                           0x8,  0x39, 0x81, 0x18, 0xfe, 0x1e, 0x53, 0x9,  0xf2, 0xde, 0x8c, 0xa0, 0x4f, 0x94, 0xdf};
  uint8_t bytesprops2[] = {0x6b, 0xe0, 0x60, 0x63, 0xb6, 0x61, 0xa6, 0xe8, 0x32, 0xb3, 0xd1, 0x96, 0x91, 0xdc, 0x10,
                           0x7e, 0xd5, 0x6b, 0xf,  0xb1, 0x8a, 0x4e, 0x9d, 0x6d, 0xd3, 0x71, 0xf7, 0xb6, 0xb2, 0x4f};
  uint8_t bytesprops4[] = {0xad, 0xb4, 0x89};
  uint8_t bytesprops5[] = {0x2c, 0xa1, 0x90};
  uint8_t bytesprops6[] = {0xd0, 0x6e, 0x58, 0x7e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3109}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10259}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18041}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29565}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2224}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17653}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32460}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops2}, .v = {30, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1807}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28847}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x1d, 0xc2, 0x3e, 0x67, 0xd8, 0x79, 0x4b, 0x6c, 0x3a, 0xd2,
                               0x40, 0xc,  0x21, 0x1b, 0x2e, 0xc9, 0x82, 0x46, 0x7,  0xc6,
                               0x89, 0x3f, 0x3f, 0x7b, 0x4,  0x39, 0xc8, 0xeb, 0x1b, 0xd3};
  uint8_t byteswillprops0[] = {0xd2, 0x3e, 0xdc, 0x97, 0x6e, 0x2,  0x57, 0x2b, 0x8c, 0x84,
                               0x6c, 0xdd, 0x50, 0x89, 0xbf, 0x48, 0x6e, 0xad, 0xf3, 0xd1,
                               0xb4, 0xab, 0xd0, 0x80, 0x18, 0x3f, 0x49, 0x69, 0x1c, 0x23};
  uint8_t byteswillprops3[] = {0xc3, 0x5f, 0xcb, 0xb3, 0x2d, 0xf1, 0xcf, 0x89, 0x32, 0x37, 0x87};
  uint8_t byteswillprops2[] = {0x7, 0xf5, 0x90, 0x25, 0x3f, 0x21, 0xff, 0xce, 0xc7, 0xe3, 0x67};
  uint8_t byteswillprops5[] = {0xd4, 0xce, 0x76, 0xf3, 0x30, 0xeb, 0x67, 0xc8, 0xfa, 0xbc, 0xcf, 0x50, 0x17,
                               0x82, 0xa7, 0x89, 0x40, 0x28, 0xbf, 0x5f, 0x8b, 0x13, 0x7d, 0xee, 0xe3};
  uint8_t byteswillprops4[] = {0xd8, 0xe4, 0xa4, 0xd0, 0xde, 0xea, 0x6d, 0x34, 0xc8, 0x9c,
                               0x5c, 0x1a, 0xb0, 0xfc, 0xa7, 0x3e, 0xe3, 0xd9, 0x1,  0xfc,
                               0x66, 0xb9, 0xba, 0x2f, 0xf5, 0xdc, 0x6c, 0x2e, 0x3d, 0xe9};
  uint8_t byteswillprops6[] = {0x97, 0xc3, 0xa8, 0xbc, 0x3f, 0xa5, 0x7d};
  uint8_t byteswillprops7[] = {0xb6, 0x98, 0x21, 0xe, 0xd6, 0xf5, 0xca, 0xd2, 0x1c, 0x26};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops0}, .v = {30, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4108}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1362}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20063}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {11, (char*)&byteswillprops2}, .v = {11, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2669}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops4}, .v = {25, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13533}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14172}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x81, 0x33, 0xa4, 0xf,  0x5f, 0x8d, 0x62, 0x73, 0xab, 0xf7,
                                0xa3, 0x76, 0x9f, 0xb5, 0x96, 0x54, 0xb4, 0x88, 0x41, 0x7a};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x20, 0x2f, 0xbd, 0x8d, 0x44, 0xb3, 0x8b, 0x8c, 0xdf,
                                  0xd3, 0x3a, 0x41, 0xdb, 0xcd, 0x46, 0x75, 0x11};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6602;
  uint8_t client_id_bytes[] = {0x25, 0xc5, 0x75, 0xf2, 0x7c, 0x51, 0x4d, 0x2f, 0x0,  0xef,
                               0x90, 0x7,  0xb0, 0xad, 0x8a, 0xf8, 0x8f, 0x30, 0x3e, 0x38};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xbc, 0x81};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\134\162'b\147r\DC3", _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS0, _willTopic = "\196.\fm\178\&9\240", _willMsg =
// "\229Y\246\171\"\a\231Vp\200\169\156\&5%\n\165\146\ETB\221\209\128\228\231", _willProps = [PropResponseInformation
// "\aN\190\161\RS\197[\\+\148\176\209\250Q\189\ETX5+\225\152\191\173o1\234\240\131",PropSessionExpiryInterval
// 28040,PropCorrelationData "\249w\163\153j\158\143\164\216f\203",PropSharedSubscriptionAvailable 80,PropReceiveMaximum
// 18583,PropTopicAlias 16615,PropTopicAlias 7143,PropWillDelayInterval 22637,PropMaximumQoS 178,PropResponseTopic
// "\181\164\"\EM\212\248{\t\207e\STXa\DLEs\241\251\130\240\135\160M\164I_\186v\SYN0\207",PropSubscriptionIdentifierAvailable
// 168,PropServerReference
// "\145\238\189,\215v\248\191;\250!\135W\ENQ\a\131\134\143x\171\241\t[\194",PropSessionExpiryInterval
// 12339,PropServerKeepAlive 3373,PropRequestProblemInformation 76,PropMaximumQoS 56,PropWildcardSubscriptionAvailable
// 72,PropTopicAlias 23315,PropCorrelationData "\139\243\GSnf\191\f\f<\229\199;\132\253\240",PropContentType
// "?0\255\GS\US\229\135'\161\219_\FSi\225",PropReceiveMaximum 14738,PropReceiveMaximum 9219,PropWillDelayInterval
// 18512,PropRetainAvailable 202,PropMaximumQoS 249]}), _cleanSession = True, _keepAlive = 10739, _connID = "/",
// _properties = [PropMessageExpiryInterval 15549,PropPayloadFormatIndicator 45,PropReasonString "\248\US
// \142,s\204\151\242",PropMaximumQoS 172,PropAuthenticationData
// "sv<\SO\199\224\242H9*\190\238\232s\212X4\213\234\153n",PropResponseInformation
// "\FSo}\192\n\139\139\f,\NULbc4",PropSubscriptionIdentifier 2,PropPayloadFormatIndicator 100,PropWillDelayInterval
// 22944,PropAuthenticationMethod "p\197\v\255y\216\238$\241\246q\147\166e",PropMaximumPacketSize 16444,PropTopicAlias
// 32554,PropAuthenticationMethod "\210\172m'\"\221x\188\158\231\132\199\SOH\155\187%\236\223:\205",PropCorrelationData
// "9",PropTopicAliasMaximum 12747,PropWillDelayInterval 12510,PropContentType
// "e\253ia\245\204\ESC\243mC<\228\204\179Z",PropUserProperty
// "GT\236\CANX\170A`\180u\142\138\&0\SO_*\150\203Rwj\163\DC1\231\138\&9Z"
// "\186\138'\133\ENQ\NAK\SUB^\ESC\194\ACK\222\202\254k\DC1\215A\186,\SI\192q\161\229\144\189\172",PropSubscriptionIdentifier
// 24,PropServerKeepAlive 14714,PropContentType "\211&C",PropServerKeepAlive 6186,PropSharedSubscriptionAvailable 208]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x10, 0xdf, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x66, 0x29, 0xf3, 0xe0, 0x1,  0x2,  0x0,  0x0,  0x3c,
      0xbd, 0x1,  0x2d, 0x1f, 0x0,  0x9,  0xf8, 0x1f, 0x20, 0x8e, 0x2c, 0x73, 0xcc, 0x97, 0xf2, 0x24, 0xac, 0x16, 0x0,
      0x15, 0x73, 0x76, 0x3c, 0xe,  0xc7, 0xe0, 0xf2, 0x48, 0x39, 0x2a, 0xbe, 0xee, 0xe8, 0x73, 0xd4, 0x58, 0x34, 0xd5,
      0xea, 0x99, 0x6e, 0x1a, 0x0,  0xd,  0x1c, 0x6f, 0x7d, 0xc0, 0xa,  0x8b, 0x8b, 0xc,  0x2c, 0x0,  0x62, 0x63, 0x34,
      0xb,  0x2,  0x1,  0x64, 0x18, 0x0,  0x0,  0x59, 0xa0, 0x15, 0x0,  0xe,  0x70, 0xc5, 0xb,  0xff, 0x79, 0xd8, 0xee,
      0x24, 0xf1, 0xf6, 0x71, 0x93, 0xa6, 0x65, 0x27, 0x0,  0x0,  0x40, 0x3c, 0x23, 0x7f, 0x2a, 0x15, 0x0,  0x14, 0xd2,
      0xac, 0x6d, 0x27, 0x22, 0xdd, 0x78, 0xbc, 0x9e, 0xe7, 0x84, 0xc7, 0x1,  0x9b, 0xbb, 0x25, 0xec, 0xdf, 0x3a, 0xcd,
      0x9,  0x0,  0x1,  0x39, 0x22, 0x31, 0xcb, 0x18, 0x0,  0x0,  0x30, 0xde, 0x3,  0x0,  0xf,  0x65, 0xfd, 0x69, 0x61,
      0xf5, 0xcc, 0x1b, 0xf3, 0x6d, 0x43, 0x3c, 0xe4, 0xcc, 0xb3, 0x5a, 0x26, 0x0,  0x1b, 0x47, 0x54, 0xec, 0x18, 0x58,
      0xaa, 0x41, 0x60, 0xb4, 0x75, 0x8e, 0x8a, 0x30, 0xe,  0x5f, 0x2a, 0x96, 0xcb, 0x52, 0x77, 0x6a, 0xa3, 0x11, 0xe7,
      0x8a, 0x39, 0x5a, 0x0,  0x1c, 0xba, 0x8a, 0x27, 0x85, 0x5,  0x15, 0x1a, 0x5e, 0x1b, 0xc2, 0x6,  0xde, 0xca, 0xfe,
      0x6b, 0x11, 0xd7, 0x41, 0xba, 0x2c, 0xf,  0xc0, 0x71, 0xa1, 0xe5, 0x90, 0xbd, 0xac, 0xb,  0x18, 0x13, 0x39, 0x7a,
      0x3,  0x0,  0x3,  0xd3, 0x26, 0x43, 0x13, 0x18, 0x2a, 0x2a, 0xd0, 0x0,  0x1,  0x2f, 0xc3, 0x1,  0x1a, 0x0,  0x1b,
      0x7,  0x4e, 0xbe, 0xa1, 0x1e, 0xc5, 0x5b, 0x5c, 0x2b, 0x94, 0xb0, 0xd1, 0xfa, 0x51, 0xbd, 0x3,  0x35, 0x2b, 0xe1,
      0x98, 0xbf, 0xad, 0x6f, 0x31, 0xea, 0xf0, 0x83, 0x11, 0x0,  0x0,  0x6d, 0x88, 0x9,  0x0,  0xb,  0xf9, 0x77, 0xa3,
      0x99, 0x6a, 0x9e, 0x8f, 0xa4, 0xd8, 0x66, 0xcb, 0x2a, 0x50, 0x21, 0x48, 0x97, 0x23, 0x40, 0xe7, 0x23, 0x1b, 0xe7,
      0x18, 0x0,  0x0,  0x58, 0x6d, 0x24, 0xb2, 0x8,  0x0,  0x1d, 0xb5, 0xa4, 0x22, 0x19, 0xd4, 0xf8, 0x7b, 0x9,  0xcf,
      0x65, 0x2,  0x61, 0x10, 0x73, 0xf1, 0xfb, 0x82, 0xf0, 0x87, 0xa0, 0x4d, 0xa4, 0x49, 0x5f, 0xba, 0x76, 0x16, 0x30,
      0xcf, 0x29, 0xa8, 0x1c, 0x0,  0x18, 0x91, 0xee, 0xbd, 0x2c, 0xd7, 0x76, 0xf8, 0xbf, 0x3b, 0xfa, 0x21, 0x87, 0x57,
      0x5,  0x7,  0x83, 0x86, 0x8f, 0x78, 0xab, 0xf1, 0x9,  0x5b, 0xc2, 0x11, 0x0,  0x0,  0x30, 0x33, 0x13, 0xd,  0x2d,
      0x17, 0x4c, 0x24, 0x38, 0x28, 0x48, 0x23, 0x5b, 0x13, 0x9,  0x0,  0xf,  0x8b, 0xf3, 0x1d, 0x6e, 0x66, 0xbf, 0xc,
      0xc,  0x3c, 0xe5, 0xc7, 0x3b, 0x84, 0xfd, 0xf0, 0x3,  0x0,  0xe,  0x3f, 0x30, 0xff, 0x1d, 0x1f, 0xe5, 0x87, 0x27,
      0xa1, 0xdb, 0x5f, 0x1c, 0x69, 0xe1, 0x21, 0x39, 0x92, 0x21, 0x24, 0x3,  0x18, 0x0,  0x0,  0x48, 0x50, 0x25, 0xca,
      0x24, 0xf9, 0x0,  0x7,  0xc4, 0x2e, 0xc,  0x6d, 0xb2, 0x39, 0xf0, 0x0,  0x17, 0xe5, 0x59, 0xf6, 0xab, 0x22, 0x7,
      0xe7, 0x56, 0x70, 0xc8, 0xa9, 0x9c, 0x35, 0x25, 0xa,  0xa5, 0x92, 0x17, 0xdd, 0xd1, 0x80, 0xe4, 0xe7, 0x0,  0x7,
      0x86, 0xa2, 0x27, 0x62, 0x93, 0x72, 0x13};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf8, 0x1f, 0x20, 0x8e, 0x2c, 0x73, 0xcc, 0x97, 0xf2};
  uint8_t bytesprops1[] = {0x73, 0x76, 0x3c, 0xe,  0xc7, 0xe0, 0xf2, 0x48, 0x39, 0x2a, 0xbe,
                           0xee, 0xe8, 0x73, 0xd4, 0x58, 0x34, 0xd5, 0xea, 0x99, 0x6e};
  uint8_t bytesprops2[] = {0x1c, 0x6f, 0x7d, 0xc0, 0xa, 0x8b, 0x8b, 0xc, 0x2c, 0x0, 0x62, 0x63, 0x34};
  uint8_t bytesprops3[] = {0x70, 0xc5, 0xb, 0xff, 0x79, 0xd8, 0xee, 0x24, 0xf1, 0xf6, 0x71, 0x93, 0xa6, 0x65};
  uint8_t bytesprops4[] = {0xd2, 0xac, 0x6d, 0x27, 0x22, 0xdd, 0x78, 0xbc, 0x9e, 0xe7,
                           0x84, 0xc7, 0x1,  0x9b, 0xbb, 0x25, 0xec, 0xdf, 0x3a, 0xcd};
  uint8_t bytesprops5[] = {0x39};
  uint8_t bytesprops6[] = {0x65, 0xfd, 0x69, 0x61, 0xf5, 0xcc, 0x1b, 0xf3, 0x6d, 0x43, 0x3c, 0xe4, 0xcc, 0xb3, 0x5a};
  uint8_t bytesprops8[] = {0xba, 0x8a, 0x27, 0x85, 0x5,  0x15, 0x1a, 0x5e, 0x1b, 0xc2, 0x6,  0xde, 0xca, 0xfe,
                           0x6b, 0x11, 0xd7, 0x41, 0xba, 0x2c, 0xf,  0xc0, 0x71, 0xa1, 0xe5, 0x90, 0xbd, 0xac};
  uint8_t bytesprops7[] = {0x47, 0x54, 0xec, 0x18, 0x58, 0xaa, 0x41, 0x60, 0xb4, 0x75, 0x8e, 0x8a, 0x30, 0xe,
                           0x5f, 0x2a, 0x96, 0xcb, 0x52, 0x77, 0x6a, 0xa3, 0x11, 0xe7, 0x8a, 0x39, 0x5a};
  uint8_t bytesprops9[] = {0xd3, 0x26, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15549}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 2}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22944}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16444}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32554}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12747}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12510}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops7}, .v = {28, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14714}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6186}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 208}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x7,  0x4e, 0xbe, 0xa1, 0x1e, 0xc5, 0x5b, 0x5c, 0x2b, 0x94, 0xb0, 0xd1, 0xfa, 0x51,
                               0xbd, 0x3,  0x35, 0x2b, 0xe1, 0x98, 0xbf, 0xad, 0x6f, 0x31, 0xea, 0xf0, 0x83};
  uint8_t byteswillprops1[] = {0xf9, 0x77, 0xa3, 0x99, 0x6a, 0x9e, 0x8f, 0xa4, 0xd8, 0x66, 0xcb};
  uint8_t byteswillprops2[] = {0xb5, 0xa4, 0x22, 0x19, 0xd4, 0xf8, 0x7b, 0x9,  0xcf, 0x65, 0x2,  0x61, 0x10, 0x73, 0xf1,
                               0xfb, 0x82, 0xf0, 0x87, 0xa0, 0x4d, 0xa4, 0x49, 0x5f, 0xba, 0x76, 0x16, 0x30, 0xcf};
  uint8_t byteswillprops3[] = {0x91, 0xee, 0xbd, 0x2c, 0xd7, 0x76, 0xf8, 0xbf, 0x3b, 0xfa, 0x21, 0x87,
                               0x57, 0x5,  0x7,  0x83, 0x86, 0x8f, 0x78, 0xab, 0xf1, 0x9,  0x5b, 0xc2};
  uint8_t byteswillprops4[] = {0x8b, 0xf3, 0x1d, 0x6e, 0x66, 0xbf, 0xc, 0xc, 0x3c, 0xe5, 0xc7, 0x3b, 0x84, 0xfd, 0xf0};
  uint8_t byteswillprops5[] = {0x3f, 0x30, 0xff, 0x1d, 0x1f, 0xe5, 0x87, 0x27, 0xa1, 0xdb, 0x5f, 0x1c, 0x69, 0xe1};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28040}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18583}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16615}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7143}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22637}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12339}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3373}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23315}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14738}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9219}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18512}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 249}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc4, 0x2e, 0xc, 0x6d, 0xb2, 0x39, 0xf0};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe5, 0x59, 0xf6, 0xab, 0x22, 0x7,  0xe7, 0x56, 0x70, 0xc8, 0xa9, 0x9c,
                                  0x35, 0x25, 0xa,  0xa5, 0x92, 0x17, 0xdd, 0xd1, 0x80, 0xe4, 0xe7};
  lwmqtt_string_t will_payload = {23, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 10739;
  uint8_t client_id_bytes[] = {0x2f};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x86, 0xa2, 0x27, 0x62, 0x93, 0x72, 0x13};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\162\239\230\n3", _password = Just
// "\CAN\200\200D\180\211J@\181\217Sj\DEL\208\141\&8\135^$\175", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "Z\197\216\246\ETX\145\228\DC3\217", _willMsg = "5\204\&3\t\SI\254!\226\237\154",
// _willProps = [PropAuthenticationData "X\237%\141\238\&7\SI\148\251\228\129",PropReceiveMaximum
// 19888,PropWildcardSubscriptionAvailable 111,PropUserProperty "M[\146"
// "\138\214\230\US\200\ENQ\NULo0+S9O<\244\215n\250K\154\197\133\254\DC3\156"]}), _cleanSession = False, _keepAlive =
// 24980, _connID = "f\246\\A\130\163\246\NUL\ESC\222\168?\SI\NULe\155\&9\215", _properties = [PropAuthenticationMethod
// " O[\249\154\248{j:\133\135\254y'Y\DC1t\154C#\229$x"]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0xa2, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x61, 0x94, 0x1a, 0x15, 0x0,  0x17,
                   0x20, 0x4f, 0x5b, 0xf9, 0x9a, 0xf8, 0x7b, 0x6a, 0x3a, 0x85, 0x87, 0xfe, 0x79, 0x27, 0x59, 0x11, 0x74,
                   0x9a, 0x43, 0x23, 0xe5, 0x24, 0x78, 0x0,  0x12, 0x66, 0xf6, 0x5c, 0x41, 0x82, 0xa3, 0xf6, 0x0,  0x1b,
                   0xde, 0xa8, 0x3f, 0xf,  0x0,  0x65, 0x9b, 0x39, 0xd7, 0x34, 0x16, 0x0,  0xb,  0x58, 0xed, 0x25, 0x8d,
                   0xee, 0x37, 0xf,  0x94, 0xfb, 0xe4, 0x81, 0x21, 0x4d, 0xb0, 0x28, 0x6f, 0x26, 0x0,  0x3,  0x4d, 0x5b,
                   0x92, 0x0,  0x19, 0x8a, 0xd6, 0xe6, 0x1f, 0xc8, 0x5,  0x0,  0x6f, 0x30, 0x2b, 0x53, 0x39, 0x4f, 0x3c,
                   0xf4, 0xd7, 0x6e, 0xfa, 0x4b, 0x9a, 0xc5, 0x85, 0xfe, 0x13, 0x9c, 0x0,  0x9,  0x5a, 0xc5, 0xd8, 0xf6,
                   0x3,  0x91, 0xe4, 0x13, 0xd9, 0x0,  0xa,  0x35, 0xcc, 0x33, 0x9,  0xf,  0xfe, 0x21, 0xe2, 0xed, 0x9a,
                   0x0,  0x5,  0xa2, 0xef, 0xe6, 0xa,  0x33, 0x0,  0x14, 0x18, 0xc8, 0xc8, 0x44, 0xb4, 0xd3, 0x4a, 0x40,
                   0xb5, 0xd9, 0x53, 0x6a, 0x7f, 0xd0, 0x8d, 0x38, 0x87, 0x5e, 0x24, 0xaf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x20, 0x4f, 0x5b, 0xf9, 0x9a, 0xf8, 0x7b, 0x6a, 0x3a, 0x85, 0x87, 0xfe,
                           0x79, 0x27, 0x59, 0x11, 0x74, 0x9a, 0x43, 0x23, 0xe5, 0x24, 0x78};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x58, 0xed, 0x25, 0x8d, 0xee, 0x37, 0xf, 0x94, 0xfb, 0xe4, 0x81};
  uint8_t byteswillprops2[] = {0x8a, 0xd6, 0xe6, 0x1f, 0xc8, 0x5,  0x0,  0x6f, 0x30, 0x2b, 0x53, 0x39, 0x4f,
                               0x3c, 0xf4, 0xd7, 0x6e, 0xfa, 0x4b, 0x9a, 0xc5, 0x85, 0xfe, 0x13, 0x9c};
  uint8_t byteswillprops1[] = {0x4d, 0x5b, 0x92};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19888}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {3, (char*)&byteswillprops1}, .v = {25, (char*)&byteswillprops2}}}},
  };

  lwmqtt_properties_t willprops = {4, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5a, 0xc5, 0xd8, 0xf6, 0x3, 0x91, 0xe4, 0x13, 0xd9};
  lwmqtt_string_t will_topic = {9, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x35, 0xcc, 0x33, 0x9, 0xf, 0xfe, 0x21, 0xe2, 0xed, 0x9a};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24980;
  uint8_t client_id_bytes[] = {0x66, 0xf6, 0x5c, 0x41, 0x82, 0xa3, 0xf6, 0x0,  0x1b,
                               0xde, 0xa8, 0x3f, 0xf,  0x0,  0x65, 0x9b, 0x39, 0xd7};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa2, 0xef, 0xe6, 0xa, 0x33};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0xc8, 0xc8, 0x44, 0xb4, 0xd3, 0x4a, 0x40, 0xb5, 0xd9,
                              0x53, 0x6a, 0x7f, 0xd0, 0x8d, 0x38, 0x87, 0x5e, 0x24, 0xaf};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\223\202e-\159\bZ\GS", _password = Just
// "\210\145\"C\US\ESC(\195\234\165\212\157t\235\178", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2,
// _willTopic = "1PwW$\"}\"/9\SOH\DC4a\252\212\170=b\209y\215\SO\216.F\160\139", _willMsg =
// "\254\255\178\RS\STXL\176\236\FS\129c\209", _willProps = [PropTopicAliasMaximum 1471,PropRequestResponseInformation
// 39,PropWillDelayInterval 3636,PropSubscriptionIdentifier 20,PropMessageExpiryInterval
// 1482,PropSharedSubscriptionAvailable 6,PropSubscriptionIdentifier 23,PropMessageExpiryInterval
// 6790,PropMessageExpiryInterval 18889]}), _cleanSession = True, _keepAlive = 21539, _connID = "t\221\220", _properties
// = [PropAuthenticationData "T\135\150\&7\221#\170\233*",PropSessionExpiryInterval
// 30337,PropWildcardSubscriptionAvailable 123,PropMaximumPacketSize 7248,PropServerReference
// "0u\158W\248\234\&7\227\157\168\165\206\DC4/?B\US*",PropMessageExpiryInterval 27127,PropTopicAlias
// 19939,PropUserProperty " J\200" "\244\137\164\166\130",PropReceiveMaximum 30118,PropTopicAliasMaximum
// 8100,PropResponseTopic "a\223\198\234\207{\228",PropRetainAvailable 116]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x10, 0xca, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x54, 0x23, 0x54, 0x16, 0x0,  0x9,  0x54, 0x87,
      0x96, 0x37, 0xdd, 0x23, 0xaa, 0xe9, 0x2a, 0x11, 0x0,  0x0,  0x76, 0x81, 0x28, 0x7b, 0x27, 0x0,  0x0,  0x1c, 0x50,
      0x1c, 0x0,  0x12, 0x30, 0x75, 0x9e, 0x57, 0xf8, 0xea, 0x37, 0xe3, 0x9d, 0xa8, 0xa5, 0xce, 0x14, 0x2f, 0x3f, 0x42,
      0x1f, 0x2a, 0x2,  0x0,  0x0,  0x69, 0xf7, 0x23, 0x4d, 0xe3, 0x26, 0x0,  0x3,  0x20, 0x4a, 0xc8, 0x0,  0x5,  0xf4,
      0x89, 0xa4, 0xa6, 0x82, 0x21, 0x75, 0xa6, 0x22, 0x1f, 0xa4, 0x8,  0x0,  0x7,  0x61, 0xdf, 0xc6, 0xea, 0xcf, 0x7b,
      0xe4, 0x25, 0x74, 0x0,  0x3,  0x74, 0xdd, 0xdc, 0x1f, 0x22, 0x5,  0xbf, 0x19, 0x27, 0x18, 0x0,  0x0,  0xe,  0x34,
      0xb,  0x14, 0x2,  0x0,  0x0,  0x5,  0xca, 0x2a, 0x6,  0xb,  0x17, 0x2,  0x0,  0x0,  0x1a, 0x86, 0x2,  0x0,  0x0,
      0x49, 0xc9, 0x0,  0x1b, 0x31, 0x50, 0x77, 0x57, 0x24, 0x22, 0x7d, 0x22, 0x2f, 0x39, 0x1,  0x14, 0x61, 0xfc, 0xd4,
      0xaa, 0x3d, 0x62, 0xd1, 0x79, 0xd7, 0xe,  0xd8, 0x2e, 0x46, 0xa0, 0x8b, 0x0,  0xc,  0xfe, 0xff, 0xb2, 0x1e, 0x2,
      0x4c, 0xb0, 0xec, 0x1c, 0x81, 0x63, 0xd1, 0x0,  0x8,  0xdf, 0xca, 0x65, 0x2d, 0x9f, 0x8,  0x5a, 0x1d, 0x0,  0xf,
      0xd2, 0x91, 0x22, 0x43, 0x1f, 0x1b, 0x28, 0xc3, 0xea, 0xa5, 0xd4, 0x9d, 0x74, 0xeb, 0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x54, 0x87, 0x96, 0x37, 0xdd, 0x23, 0xaa, 0xe9, 0x2a};
  uint8_t bytesprops1[] = {0x30, 0x75, 0x9e, 0x57, 0xf8, 0xea, 0x37, 0xe3, 0x9d,
                           0xa8, 0xa5, 0xce, 0x14, 0x2f, 0x3f, 0x42, 0x1f, 0x2a};
  uint8_t bytesprops3[] = {0xf4, 0x89, 0xa4, 0xa6, 0x82};
  uint8_t bytesprops2[] = {0x20, 0x4a, 0xc8};
  uint8_t bytesprops4[] = {0x61, 0xdf, 0xc6, 0xea, 0xcf, 0x7b, 0xe4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30337}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7248}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27127}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19939}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops2}, .v = {5, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30118}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8100}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 116}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1471}}, {.prop = (lwmqtt_prop_t)25, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3636}}, {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1482}},  {.prop = (lwmqtt_prop_t)42, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},   {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6790}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18889}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x31, 0x50, 0x77, 0x57, 0x24, 0x22, 0x7d, 0x22, 0x2f, 0x39, 0x1,  0x14, 0x61, 0xfc,
                                0xd4, 0xaa, 0x3d, 0x62, 0xd1, 0x79, 0xd7, 0xe,  0xd8, 0x2e, 0x46, 0xa0, 0x8b};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfe, 0xff, 0xb2, 0x1e, 0x2, 0x4c, 0xb0, 0xec, 0x1c, 0x81, 0x63, 0xd1};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 21539;
  uint8_t client_id_bytes[] = {0x74, 0xdd, 0xdc};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xdf, 0xca, 0x65, 0x2d, 0x9f, 0x8, 0x5a, 0x1d};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd2, 0x91, 0x22, 0x43, 0x1f, 0x1b, 0x28, 0xc3, 0xea, 0xa5, 0xd4, 0x9d, 0x74, 0xeb, 0xb2};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\205lB\203\231\189}\136\179\155\DC1s\151L1\191\USz\163V\150\139n", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic = "\DC1\SO\218k9\194\251",
// _willMsg = "\220\247\191\205\141\195\128\255w", _willProps = [PropRetainAvailable
// 188,PropWildcardSubscriptionAvailable 107,PropSharedSubscriptionAvailable 51,PropRequestProblemInformation
// 3,PropCorrelationData "\188)\221\214\197\\d%+6j\130V2\250\189\159\144\193\131\227\216",PropMessageExpiryInterval
// 20845,PropServerKeepAlive 10989,PropTopicAlias 11016,PropPayloadFormatIndicator
// 109,PropSubscriptionIdentifierAvailable 136,PropSessionExpiryInterval 6006,PropCorrelationData
// "\172\172\137f\224Q\ENQN\238n",PropCorrelationData
// "83n@\228\176\r\136C\169L\192n\206\190\DEL\SUB\232\SUB\143\178\&1I\221\&4\210\203",PropServerReference
// ";8\203I<L\205\242\235\nii\236\167\CAN\233A}\216\226\SO\143/\137",PropMaximumQoS 57,PropSubscriptionIdentifier
// 24,PropSharedSubscriptionAvailable 224,PropAuthenticationData
// "Of\172\&8\245\181U\227\175",PropRequestResponseInformation 154,PropSubscriptionIdentifier
// 34,PropSubscriptionIdentifierAvailable 61,PropRetainAvailable 133,PropSessionExpiryInterval
// 14004,PropRequestResponseInformation 148,PropServerKeepAlive 14517,PropAssignedClientIdentifier
// "^\194\141P\t\138O\193\&3\221",PropUserProperty
// "x\139\b\174*\174Q\231\RSe\v\217\203\129up\128\154X3\DEL\182-\ACK\187\221\239\145"
// "\242\190\147t\156\CAN",PropPayloadFormatIndicator 99,PropMaximumPacketSize 16709,PropWildcardSubscriptionAvailable
// 210]}), _cleanSession = False, _keepAlive = 11497, _connID = "zV\172\DC4\177\SI\214(\170\v\144\232}", _properties =
// [PropRetainAvailable 58,PropSubscriptionIdentifier 12,PropCorrelationData
// "\\\170\147\166waQ\145}\145\227M\133\&3\208\135\201\180U\241lr\202R\b\245K[\221\152",PropTopicAliasMaximum
// 4176,PropMessageExpiryInterval 686,PropUserProperty "]P\DC1Q_BE\146a\141\160a.3k\DC3\238\DC4K"
// ")\a\239>Z\152\NUL\US\245\138\130\241\EM\178\209:\207-"]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x10, 0xfc, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x94, 0x2c, 0xe9, 0x57, 0x25, 0x3a, 0xb,  0xc,  0x9,
      0x0,  0x1e, 0x5c, 0xaa, 0x93, 0xa6, 0x77, 0x61, 0x51, 0x91, 0x7d, 0x91, 0xe3, 0x4d, 0x85, 0x33, 0xd0, 0x87, 0xc9,
      0xb4, 0x55, 0xf1, 0x6c, 0x72, 0xca, 0x52, 0x8,  0xf5, 0x4b, 0x5b, 0xdd, 0x98, 0x22, 0x10, 0x50, 0x2,  0x0,  0x0,
      0x2,  0xae, 0x26, 0x0,  0x13, 0x5d, 0x50, 0x11, 0x51, 0x5f, 0x42, 0x45, 0x92, 0x61, 0x8d, 0xa0, 0x61, 0x2e, 0x33,
      0x6b, 0x13, 0xee, 0x14, 0x4b, 0x0,  0x12, 0x29, 0x7,  0xef, 0x3e, 0x5a, 0x98, 0x0,  0x1f, 0xf5, 0x8a, 0x82, 0xf1,
      0x19, 0xb2, 0xd1, 0x3a, 0xcf, 0x2d, 0x0,  0xd,  0x7a, 0x56, 0xac, 0x14, 0xb1, 0xf,  0xd6, 0x28, 0xaa, 0xb,  0x90,
      0xe8, 0x7d, 0xdc, 0x1,  0x25, 0xbc, 0x28, 0x6b, 0x2a, 0x33, 0x17, 0x3,  0x9,  0x0,  0x16, 0xbc, 0x29, 0xdd, 0xd6,
      0xc5, 0x5c, 0x64, 0x25, 0x2b, 0x36, 0x6a, 0x82, 0x56, 0x32, 0xfa, 0xbd, 0x9f, 0x90, 0xc1, 0x83, 0xe3, 0xd8, 0x2,
      0x0,  0x0,  0x51, 0x6d, 0x13, 0x2a, 0xed, 0x23, 0x2b, 0x8,  0x1,  0x6d, 0x29, 0x88, 0x11, 0x0,  0x0,  0x17, 0x76,
      0x9,  0x0,  0xa,  0xac, 0xac, 0x89, 0x66, 0xe0, 0x51, 0x5,  0x4e, 0xee, 0x6e, 0x9,  0x0,  0x1b, 0x38, 0x33, 0x6e,
      0x40, 0xe4, 0xb0, 0xd,  0x88, 0x43, 0xa9, 0x4c, 0xc0, 0x6e, 0xce, 0xbe, 0x7f, 0x1a, 0xe8, 0x1a, 0x8f, 0xb2, 0x31,
      0x49, 0xdd, 0x34, 0xd2, 0xcb, 0x1c, 0x0,  0x18, 0x3b, 0x38, 0xcb, 0x49, 0x3c, 0x4c, 0xcd, 0xf2, 0xeb, 0xa,  0x69,
      0x69, 0xec, 0xa7, 0x18, 0xe9, 0x41, 0x7d, 0xd8, 0xe2, 0xe,  0x8f, 0x2f, 0x89, 0x24, 0x39, 0xb,  0x18, 0x2a, 0xe0,
      0x16, 0x0,  0x9,  0x4f, 0x66, 0xac, 0x38, 0xf5, 0xb5, 0x55, 0xe3, 0xaf, 0x19, 0x9a, 0xb,  0x22, 0x29, 0x3d, 0x25,
      0x85, 0x11, 0x0,  0x0,  0x36, 0xb4, 0x19, 0x94, 0x13, 0x38, 0xb5, 0x12, 0x0,  0xa,  0x5e, 0xc2, 0x8d, 0x50, 0x9,
      0x8a, 0x4f, 0xc1, 0x33, 0xdd, 0x26, 0x0,  0x1c, 0x78, 0x8b, 0x8,  0xae, 0x2a, 0xae, 0x51, 0xe7, 0x1e, 0x65, 0xb,
      0xd9, 0xcb, 0x81, 0x75, 0x70, 0x80, 0x9a, 0x58, 0x33, 0x7f, 0xb6, 0x2d, 0x6,  0xbb, 0xdd, 0xef, 0x91, 0x0,  0x6,
      0xf2, 0xbe, 0x93, 0x74, 0x9c, 0x18, 0x1,  0x63, 0x27, 0x0,  0x0,  0x41, 0x45, 0x28, 0xd2, 0x0,  0x7,  0x11, 0xe,
      0xda, 0x6b, 0x39, 0xc2, 0xfb, 0x0,  0x9,  0xdc, 0xf7, 0xbf, 0xcd, 0x8d, 0xc3, 0x80, 0xff, 0x77, 0x0,  0x17, 0xcd,
      0x6c, 0x42, 0xcb, 0xe7, 0xbd, 0x7d, 0x88, 0xb3, 0x9b, 0x11, 0x73, 0x97, 0x4c, 0x31, 0xbf, 0x1f, 0x7a, 0xa3, 0x56,
      0x96, 0x8b, 0x6e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5c, 0xaa, 0x93, 0xa6, 0x77, 0x61, 0x51, 0x91, 0x7d, 0x91, 0xe3, 0x4d, 0x85, 0x33, 0xd0,
                           0x87, 0xc9, 0xb4, 0x55, 0xf1, 0x6c, 0x72, 0xca, 0x52, 0x8,  0xf5, 0x4b, 0x5b, 0xdd, 0x98};
  uint8_t bytesprops2[] = {0x29, 0x7,  0xef, 0x3e, 0x5a, 0x98, 0x0,  0x1f, 0xf5,
                           0x8a, 0x82, 0xf1, 0x19, 0xb2, 0xd1, 0x3a, 0xcf, 0x2d};
  uint8_t bytesprops1[] = {0x5d, 0x50, 0x11, 0x51, 0x5f, 0x42, 0x45, 0x92, 0x61, 0x8d,
                           0xa0, 0x61, 0x2e, 0x33, 0x6b, 0x13, 0xee, 0x14, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4176}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 686}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xbc, 0x29, 0xdd, 0xd6, 0xc5, 0x5c, 0x64, 0x25, 0x2b, 0x36, 0x6a,
                               0x82, 0x56, 0x32, 0xfa, 0xbd, 0x9f, 0x90, 0xc1, 0x83, 0xe3, 0xd8};
  uint8_t byteswillprops1[] = {0xac, 0xac, 0x89, 0x66, 0xe0, 0x51, 0x5, 0x4e, 0xee, 0x6e};
  uint8_t byteswillprops2[] = {0x38, 0x33, 0x6e, 0x40, 0xe4, 0xb0, 0xd,  0x88, 0x43, 0xa9, 0x4c, 0xc0, 0x6e, 0xce,
                               0xbe, 0x7f, 0x1a, 0xe8, 0x1a, 0x8f, 0xb2, 0x31, 0x49, 0xdd, 0x34, 0xd2, 0xcb};
  uint8_t byteswillprops3[] = {0x3b, 0x38, 0xcb, 0x49, 0x3c, 0x4c, 0xcd, 0xf2, 0xeb, 0xa,  0x69, 0x69,
                               0xec, 0xa7, 0x18, 0xe9, 0x41, 0x7d, 0xd8, 0xe2, 0xe,  0x8f, 0x2f, 0x89};
  uint8_t byteswillprops4[] = {0x4f, 0x66, 0xac, 0x38, 0xf5, 0xb5, 0x55, 0xe3, 0xaf};
  uint8_t byteswillprops5[] = {0x5e, 0xc2, 0x8d, 0x50, 0x9, 0x8a, 0x4f, 0xc1, 0x33, 0xdd};
  uint8_t byteswillprops7[] = {0xf2, 0xbe, 0x93, 0x74, 0x9c, 0x18};
  uint8_t byteswillprops6[] = {0x78, 0x8b, 0x8,  0xae, 0x2a, 0xae, 0x51, 0xe7, 0x1e, 0x65, 0xb,  0xd9, 0xcb, 0x81,
                               0x75, 0x70, 0x80, 0x9a, 0x58, 0x33, 0x7f, 0xb6, 0x2d, 0x6,  0xbb, 0xdd, 0xef, 0x91};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20845}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10989}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11016}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6006}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 34}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14004}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14517}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {28, (char*)&byteswillprops6}, .v = {6, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16709}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 210}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x11, 0xe, 0xda, 0x6b, 0x39, 0xc2, 0xfb};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdc, 0xf7, 0xbf, 0xcd, 0x8d, 0xc3, 0x80, 0xff, 0x77};
  lwmqtt_string_t will_payload = {9, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 11497;
  uint8_t client_id_bytes[] = {0x7a, 0x56, 0xac, 0x14, 0xb1, 0xf, 0xd6, 0x28, 0xaa, 0xb, 0x90, 0xe8, 0x7d};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xcd, 0x6c, 0x42, 0xcb, 0xe7, 0xbd, 0x7d, 0x88, 0xb3, 0x9b, 0x11, 0x73,
                              0x97, 0x4c, 0x31, 0xbf, 0x1f, 0x7a, 0xa3, 0x56, 0x96, 0x8b, 0x6e};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\251Z\240\194K\232\239\141AZ", _password = Just
// "\215]\EM\137\201\167\148\151\224z^h\231\180\213Uk+\147", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 19360, _connID = "\156\242D9\182\133e\DC1\231\177\DC4", _properties = [PropRequestProblemInformation
// 118,PropTopicAliasMaximum 17865,PropResponseTopic "o$_\240\178/\a\130\230{&\DC4",PropContentType
// "0\200@\173\ENQY\215\184],\232\174\NAKN\192\EM\DC3\193\161h)\144v",PropSessionExpiryInterval
// 20005,PropSessionExpiryInterval 12331,PropRequestProblemInformation 173,PropWildcardSubscriptionAvailable
// 61,PropMaximumQoS 107,PropCorrelationData ">\206r\220\229a\171@\176W\236 IR\250B\214#\233!i\142x\rj",PropMaximumQoS
// 71,PropRetainAvailable 248,PropUserProperty "\229\213V\146U7\aP\132\135\175\166!-\203B\129\248\172\220\169"
// "a\219@\171\149\250\146Uc\166ZR",PropSessionExpiryInterval 6662,PropTopicAlias 27570,PropSubscriptionIdentifier
// 23,PropReceiveMaximum 7608]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x4b, 0xa0, 0x91, 0x1,  0x17, 0x76, 0x22, 0x45,
      0xc9, 0x8,  0x0,  0xc,  0x6f, 0x24, 0x5f, 0xf0, 0xb2, 0x2f, 0x7,  0x82, 0xe6, 0x7b, 0x26, 0x14, 0x3,  0x0,  0x17,
      0x30, 0xc8, 0x40, 0xad, 0x5,  0x59, 0xd7, 0xb8, 0x5d, 0x2c, 0xe8, 0xae, 0x15, 0x4e, 0xc0, 0x19, 0x13, 0xc1, 0xa1,
      0x68, 0x29, 0x90, 0x76, 0x11, 0x0,  0x0,  0x4e, 0x25, 0x11, 0x0,  0x0,  0x30, 0x2b, 0x17, 0xad, 0x28, 0x3d, 0x24,
      0x6b, 0x9,  0x0,  0x19, 0x3e, 0xce, 0x72, 0xdc, 0xe5, 0x61, 0xab, 0x40, 0xb0, 0x57, 0xec, 0x20, 0x49, 0x52, 0xfa,
      0x42, 0xd6, 0x23, 0xe9, 0x21, 0x69, 0x8e, 0x78, 0xd,  0x6a, 0x24, 0x47, 0x25, 0xf8, 0x26, 0x0,  0x15, 0xe5, 0xd5,
      0x56, 0x92, 0x55, 0x37, 0x7,  0x50, 0x84, 0x87, 0xaf, 0xa6, 0x21, 0x2d, 0xcb, 0x42, 0x81, 0xf8, 0xac, 0xdc, 0xa9,
      0x0,  0xc,  0x61, 0xdb, 0x40, 0xab, 0x95, 0xfa, 0x92, 0x55, 0x63, 0xa6, 0x5a, 0x52, 0x11, 0x0,  0x0,  0x1a, 0x6,
      0x23, 0x6b, 0xb2, 0xb,  0x17, 0x21, 0x1d, 0xb8, 0x0,  0xb,  0x9c, 0xf2, 0x44, 0x39, 0xb6, 0x85, 0x65, 0x11, 0xe7,
      0xb1, 0x14, 0x0,  0xa,  0xfb, 0x5a, 0xf0, 0xc2, 0x4b, 0xe8, 0xef, 0x8d, 0x41, 0x5a, 0x0,  0x13, 0xd7, 0x5d, 0x19,
      0x89, 0xc9, 0xa7, 0x94, 0x97, 0xe0, 0x7a, 0x5e, 0x68, 0xe7, 0xb4, 0xd5, 0x55, 0x6b, 0x2b, 0x93};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6f, 0x24, 0x5f, 0xf0, 0xb2, 0x2f, 0x7, 0x82, 0xe6, 0x7b, 0x26, 0x14};
  uint8_t bytesprops1[] = {0x30, 0xc8, 0x40, 0xad, 0x5,  0x59, 0xd7, 0xb8, 0x5d, 0x2c, 0xe8, 0xae,
                           0x15, 0x4e, 0xc0, 0x19, 0x13, 0xc1, 0xa1, 0x68, 0x29, 0x90, 0x76};
  uint8_t bytesprops2[] = {0x3e, 0xce, 0x72, 0xdc, 0xe5, 0x61, 0xab, 0x40, 0xb0, 0x57, 0xec, 0x20, 0x49,
                           0x52, 0xfa, 0x42, 0xd6, 0x23, 0xe9, 0x21, 0x69, 0x8e, 0x78, 0xd,  0x6a};
  uint8_t bytesprops4[] = {0x61, 0xdb, 0x40, 0xab, 0x95, 0xfa, 0x92, 0x55, 0x63, 0xa6, 0x5a, 0x52};
  uint8_t bytesprops3[] = {0xe5, 0xd5, 0x56, 0x92, 0x55, 0x37, 0x7,  0x50, 0x84, 0x87, 0xaf,
                           0xa6, 0x21, 0x2d, 0xcb, 0x42, 0x81, 0xf8, 0xac, 0xdc, 0xa9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17865}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20005}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12331}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops3}, .v = {12, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6662}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27570}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7608}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19360;
  uint8_t client_id_bytes[] = {0x9c, 0xf2, 0x44, 0x39, 0xb6, 0x85, 0x65, 0x11, 0xe7, 0xb1, 0x14};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfb, 0x5a, 0xf0, 0xc2, 0x4b, 0xe8, 0xef, 0x8d, 0x41, 0x5a};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd7, 0x5d, 0x19, 0x89, 0xc9, 0xa7, 0x94, 0x97, 0xe0, 0x7a,
                              0x5e, 0x68, 0xe7, 0xb4, 0xd5, 0x55, 0x6b, 0x2b, 0x93};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "X&4$#\150ffc\147", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS0, _willTopic = "\136x", _willMsg = "\170\173F9\211(\209\223@%\STX\NUL\175\144\213\136\224b",
// _willProps = [PropMessageExpiryInterval 9625,PropAuthenticationMethod "\187{!O\206-
// \183Q^W~3\245a\193\169\USR\ENQ\254\226\183\DC2\129\253\235\FSi.",PropSubscriptionIdentifierAvailable
// 104,PropResponseInformation " \179\176\139k959)\215\231Q\132p\211",PropServerReference "",PropTopicAliasMaximum
// 31363,PropSharedSubscriptionAvailable 49,PropResponseTopic "\173",PropMessageExpiryInterval
// 24639,PropPayloadFormatIndicator 162,PropContentType "\229\206}\210J\199a~_\190|\197!",PropReasonString
// "\131\137\201\203`\244&d\"\210u\185",PropTopicAlias 22635,PropSharedSubscriptionAvailable 41]}), _cleanSession =
// False, _keepAlive = 19263, _connID = "\148\139\192+\177o\182\205", _properties = [PropCorrelationData
// "\SYN\191\149\219v\247\v\192\228\227\187\&1\196&n\167!4R\SO\154(}2R6\230\138",PropReceiveMaximum
// 1086,PropResponseInformation "\236\162\DC1\rR\173\135\183\191\242/UN`d\207\219\198\157",PropResponseInformation
// "\151",PropMaximumPacketSize 32268,PropReceiveMaximum 2995,PropAssignedClientIdentifier
// "\203H\184\174",PropTopicAlias 23241,PropReasonString
// "\147\GS\DC11N\b\153\247\242bu7\DEL~\SOH\207}\247\a\174\195\183",PropWildcardSubscriptionAvailable
// 110,PropUserProperty "n\200\183\168\238N\r\139\230\182[\v" "e\204\GSfH)\183\180\176\225",PropResponseInformation
// "y<\195",PropPayloadFormatIndicator 144,PropResponseTopic "",PropServerKeepAlive 4691,PropAuthenticationMethod
// "kX\142&\218>\188\254n\226\145\167\213",PropCorrelationData
// "\254{\202\142\199\US\216I%\202W\218\245\DC2Kt\192\189",PropServerKeepAlive 21417,PropAuthenticationMethod
// "a\b\185\183:\193\206",PropResponseTopic "{\207\162\US\234\STXT\147\143S\t",PropContentType
// "\199\\J\v",PropMessageExpiryInterval 14422,PropRetainAvailable 4,PropAuthenticationMethod
// "&*\128\160\236\137\134\190b\167\191/\210m\167\162?h\254\"\234aO\STX.\181x\146\ACK<",PropCorrelationData
// "\DC2\225\253\&5\FSh2\205j+\200W\NUL\228\219\DLE]T\192\149\DC3\142eI",PropServerKeepAlive 6578]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x84, 0x4b, 0x3f, 0x9f, 0x2,  0x9,  0x0,  0x1c, 0x16,
      0xbf, 0x95, 0xdb, 0x76, 0xf7, 0xb,  0xc0, 0xe4, 0xe3, 0xbb, 0x31, 0xc4, 0x26, 0x6e, 0xa7, 0x21, 0x34, 0x52, 0xe,
      0x9a, 0x28, 0x7d, 0x32, 0x52, 0x36, 0xe6, 0x8a, 0x21, 0x4,  0x3e, 0x1a, 0x0,  0x13, 0xec, 0xa2, 0x11, 0xd,  0x52,
      0xad, 0x87, 0xb7, 0xbf, 0xf2, 0x2f, 0x55, 0x4e, 0x60, 0x64, 0xcf, 0xdb, 0xc6, 0x9d, 0x1a, 0x0,  0x1,  0x97, 0x27,
      0x0,  0x0,  0x7e, 0xc,  0x21, 0xb,  0xb3, 0x12, 0x0,  0x4,  0xcb, 0x48, 0xb8, 0xae, 0x23, 0x5a, 0xc9, 0x1f, 0x0,
      0x16, 0x93, 0x1d, 0x11, 0x31, 0x4e, 0x8,  0x99, 0xf7, 0xf2, 0x62, 0x75, 0x37, 0x7f, 0x7e, 0x1,  0xcf, 0x7d, 0xf7,
      0x7,  0xae, 0xc3, 0xb7, 0x28, 0x6e, 0x26, 0x0,  0xc,  0x6e, 0xc8, 0xb7, 0xa8, 0xee, 0x4e, 0xd,  0x8b, 0xe6, 0xb6,
      0x5b, 0xb,  0x0,  0xa,  0x65, 0xcc, 0x1d, 0x66, 0x48, 0x29, 0xb7, 0xb4, 0xb0, 0xe1, 0x1a, 0x0,  0x3,  0x79, 0x3c,
      0xc3, 0x1,  0x90, 0x8,  0x0,  0x0,  0x13, 0x12, 0x53, 0x15, 0x0,  0xd,  0x6b, 0x58, 0x8e, 0x26, 0xda, 0x3e, 0xbc,
      0xfe, 0x6e, 0xe2, 0x91, 0xa7, 0xd5, 0x9,  0x0,  0x12, 0xfe, 0x7b, 0xca, 0x8e, 0xc7, 0x1f, 0xd8, 0x49, 0x25, 0xca,
      0x57, 0xda, 0xf5, 0x12, 0x4b, 0x74, 0xc0, 0xbd, 0x13, 0x53, 0xa9, 0x15, 0x0,  0x7,  0x61, 0x8,  0xb9, 0xb7, 0x3a,
      0xc1, 0xce, 0x8,  0x0,  0xb,  0x7b, 0xcf, 0xa2, 0x1f, 0xea, 0x2,  0x54, 0x93, 0x8f, 0x53, 0x9,  0x3,  0x0,  0x4,
      0xc7, 0x5c, 0x4a, 0xb,  0x2,  0x0,  0x0,  0x38, 0x56, 0x25, 0x4,  0x15, 0x0,  0x1e, 0x26, 0x2a, 0x80, 0xa0, 0xec,
      0x89, 0x86, 0xbe, 0x62, 0xa7, 0xbf, 0x2f, 0xd2, 0x6d, 0xa7, 0xa2, 0x3f, 0x68, 0xfe, 0x22, 0xea, 0x61, 0x4f, 0x2,
      0x2e, 0xb5, 0x78, 0x92, 0x6,  0x3c, 0x9,  0x0,  0x18, 0x12, 0xe1, 0xfd, 0x35, 0x1c, 0x68, 0x32, 0xcd, 0x6a, 0x2b,
      0xc8, 0x57, 0x0,  0xe4, 0xdb, 0x10, 0x5d, 0x54, 0xc0, 0x95, 0x13, 0x8e, 0x65, 0x49, 0x13, 0x19, 0xb2, 0x0,  0x8,
      0x94, 0x8b, 0xc0, 0x2b, 0xb1, 0x6f, 0xb6, 0xcd, 0x71, 0x2,  0x0,  0x0,  0x25, 0x99, 0x15, 0x0,  0x1e, 0xbb, 0x7b,
      0x21, 0x4f, 0xce, 0x2d, 0x20, 0xb7, 0x51, 0x5e, 0x57, 0x7e, 0x33, 0xf5, 0x61, 0xc1, 0xa9, 0x1f, 0x52, 0x5,  0xfe,
      0xe2, 0xb7, 0x12, 0x81, 0xfd, 0xeb, 0x1c, 0x69, 0x2e, 0x29, 0x68, 0x1a, 0x0,  0xf,  0x20, 0xb3, 0xb0, 0x8b, 0x6b,
      0x39, 0x35, 0x39, 0x29, 0xd7, 0xe7, 0x51, 0x84, 0x70, 0xd3, 0x1c, 0x0,  0x0,  0x22, 0x7a, 0x83, 0x2a, 0x31, 0x8,
      0x0,  0x1,  0xad, 0x2,  0x0,  0x0,  0x60, 0x3f, 0x1,  0xa2, 0x3,  0x0,  0xd,  0xe5, 0xce, 0x7d, 0xd2, 0x4a, 0xc7,
      0x61, 0x7e, 0x5f, 0xbe, 0x7c, 0xc5, 0x21, 0x1f, 0x0,  0xc,  0x83, 0x89, 0xc9, 0xcb, 0x60, 0xf4, 0x26, 0x64, 0x22,
      0xd2, 0x75, 0xb9, 0x23, 0x58, 0x6b, 0x2a, 0x29, 0x0,  0x2,  0x88, 0x78, 0x0,  0x12, 0xaa, 0xad, 0x46, 0x39, 0xd3,
      0x28, 0xd1, 0xdf, 0x40, 0x25, 0x2,  0x0,  0xaf, 0x90, 0xd5, 0x88, 0xe0, 0x62, 0x0,  0xa,  0x58, 0x26, 0x34, 0x24,
      0x23, 0x96, 0x66, 0x66, 0x63, 0x93};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x16, 0xbf, 0x95, 0xdb, 0x76, 0xf7, 0xb,  0xc0, 0xe4, 0xe3, 0xbb, 0x31, 0xc4, 0x26,
                           0x6e, 0xa7, 0x21, 0x34, 0x52, 0xe,  0x9a, 0x28, 0x7d, 0x32, 0x52, 0x36, 0xe6, 0x8a};
  uint8_t bytesprops1[] = {0xec, 0xa2, 0x11, 0xd,  0x52, 0xad, 0x87, 0xb7, 0xbf, 0xf2,
                           0x2f, 0x55, 0x4e, 0x60, 0x64, 0xcf, 0xdb, 0xc6, 0x9d};
  uint8_t bytesprops2[] = {0x97};
  uint8_t bytesprops3[] = {0xcb, 0x48, 0xb8, 0xae};
  uint8_t bytesprops4[] = {0x93, 0x1d, 0x11, 0x31, 0x4e, 0x8,  0x99, 0xf7, 0xf2, 0x62, 0x75,
                           0x37, 0x7f, 0x7e, 0x1,  0xcf, 0x7d, 0xf7, 0x7,  0xae, 0xc3, 0xb7};
  uint8_t bytesprops6[] = {0x65, 0xcc, 0x1d, 0x66, 0x48, 0x29, 0xb7, 0xb4, 0xb0, 0xe1};
  uint8_t bytesprops5[] = {0x6e, 0xc8, 0xb7, 0xa8, 0xee, 0x4e, 0xd, 0x8b, 0xe6, 0xb6, 0x5b, 0xb};
  uint8_t bytesprops7[] = {0x79, 0x3c, 0xc3};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0x6b, 0x58, 0x8e, 0x26, 0xda, 0x3e, 0xbc, 0xfe, 0x6e, 0xe2, 0x91, 0xa7, 0xd5};
  uint8_t bytesprops10[] = {0xfe, 0x7b, 0xca, 0x8e, 0xc7, 0x1f, 0xd8, 0x49, 0x25,
                            0xca, 0x57, 0xda, 0xf5, 0x12, 0x4b, 0x74, 0xc0, 0xbd};
  uint8_t bytesprops11[] = {0x61, 0x8, 0xb9, 0xb7, 0x3a, 0xc1, 0xce};
  uint8_t bytesprops12[] = {0x7b, 0xcf, 0xa2, 0x1f, 0xea, 0x2, 0x54, 0x93, 0x8f, 0x53, 0x9};
  uint8_t bytesprops13[] = {0xc7, 0x5c, 0x4a, 0xb};
  uint8_t bytesprops14[] = {0x26, 0x2a, 0x80, 0xa0, 0xec, 0x89, 0x86, 0xbe, 0x62, 0xa7, 0xbf, 0x2f, 0xd2, 0x6d, 0xa7,
                            0xa2, 0x3f, 0x68, 0xfe, 0x22, 0xea, 0x61, 0x4f, 0x2,  0x2e, 0xb5, 0x78, 0x92, 0x6,  0x3c};
  uint8_t bytesprops15[] = {0x12, 0xe1, 0xfd, 0x35, 0x1c, 0x68, 0x32, 0xcd, 0x6a, 0x2b, 0xc8, 0x57,
                            0x0,  0xe4, 0xdb, 0x10, 0x5d, 0x54, 0xc0, 0x95, 0x13, 0x8e, 0x65, 0x49};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1086}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32268}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2995}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23241}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops5}, .v = {10, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4691}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21417}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14422}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6578}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xbb, 0x7b, 0x21, 0x4f, 0xce, 0x2d, 0x20, 0xb7, 0x51, 0x5e,
                               0x57, 0x7e, 0x33, 0xf5, 0x61, 0xc1, 0xa9, 0x1f, 0x52, 0x5,
                               0xfe, 0xe2, 0xb7, 0x12, 0x81, 0xfd, 0xeb, 0x1c, 0x69, 0x2e};
  uint8_t byteswillprops1[] = {0x20, 0xb3, 0xb0, 0x8b, 0x6b, 0x39, 0x35, 0x39,
                               0x29, 0xd7, 0xe7, 0x51, 0x84, 0x70, 0xd3};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops3[] = {0xad};
  uint8_t byteswillprops4[] = {0xe5, 0xce, 0x7d, 0xd2, 0x4a, 0xc7, 0x61, 0x7e, 0x5f, 0xbe, 0x7c, 0xc5, 0x21};
  uint8_t byteswillprops5[] = {0x83, 0x89, 0xc9, 0xcb, 0x60, 0xf4, 0x26, 0x64, 0x22, 0xd2, 0x75, 0xb9};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9625}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31363}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24639}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22635}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 41}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x88, 0x78};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xaa, 0xad, 0x46, 0x39, 0xd3, 0x28, 0xd1, 0xdf, 0x40,
                                  0x25, 0x2,  0x0,  0xaf, 0x90, 0xd5, 0x88, 0xe0, 0x62};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19263;
  uint8_t client_id_bytes[] = {0x94, 0x8b, 0xc0, 0x2b, 0xb1, 0x6f, 0xb6, 0xcd};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x58, 0x26, 0x34, 0x24, 0x23, 0x96, 0x66, 0x66, 0x63, 0x93};
  lwmqtt_string_t username = {10, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\169\134\229\177\141\167:\"\240_\168S\ETB~\228\190\175\174\ACK\168\191@\171\199\GSM\208h", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "\173en(3\180\NAK\238\226z\SO\231\221<8u\183\188\229\221\231\131\185\v\203;", _willMsg =
// "z#W\234\STX\229\164\203\229\130\201\SOHy\205\&3\169>\205\160\203dE\ACK\255\213\164\225\ESC\163", _willProps =
// [PropRequestProblemInformation 242,PropAuthenticationData "",PropAuthenticationData
// "\"yp\192\175\146C?8Q\CAN\229/\SOp\156@\251\143\150\219\144$\DC2'",PropServerKeepAlive 23446,PropReasonString
// "\186\198\152Y\237\184\EOT\147\184\169\189H>",PropSharedSubscriptionAvailable 254,PropSessionExpiryInterval
// 20915,PropResponseTopic "EN\v\ENQ\164\&6\RS\NULY>\157\204\SUB",PropPayloadFormatIndicator
// 53,PropPayloadFormatIndicator 115,PropReasonString
// "\SIX6D\176\186&\222\EOT7\243\252\194\145",PropWildcardSubscriptionAvailable 157,PropContentType
// "B>\225z\253+\221\165",PropSessionExpiryInterval 8027,PropMaximumPacketSize 3910]}), _cleanSession = True, _keepAlive
// = 14436, _connID = "\"\179\&5mH+{\187\208\t`<\149\EOT\249\182\214\184\&8\198\201\139\186\&5", _properties = []}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0xf6, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x56, 0x38, 0x64, 0x0,  0x0,  0x18, 0x22,
                   0xb3, 0x35, 0x6d, 0x48, 0x2b, 0x7b, 0xbb, 0xd0, 0x9,  0x60, 0x3c, 0x95, 0x4,  0xf9, 0xb6, 0xd6, 0xb8,
                   0x38, 0xc6, 0xc9, 0x8b, 0xba, 0x35, 0x77, 0x17, 0xf2, 0x16, 0x0,  0x0,  0x16, 0x0,  0x19, 0x22, 0x79,
                   0x70, 0xc0, 0xaf, 0x92, 0x43, 0x3f, 0x38, 0x51, 0x18, 0xe5, 0x2f, 0xe,  0x70, 0x9c, 0x40, 0xfb, 0x8f,
                   0x96, 0xdb, 0x90, 0x24, 0x12, 0x27, 0x13, 0x5b, 0x96, 0x1f, 0x0,  0xd,  0xba, 0xc6, 0x98, 0x59, 0xed,
                   0xb8, 0x4,  0x93, 0xb8, 0xa9, 0xbd, 0x48, 0x3e, 0x2a, 0xfe, 0x11, 0x0,  0x0,  0x51, 0xb3, 0x8,  0x0,
                   0xd,  0x45, 0x4e, 0xb,  0x5,  0xa4, 0x36, 0x1e, 0x0,  0x59, 0x3e, 0x9d, 0xcc, 0x1a, 0x1,  0x35, 0x1,
                   0x73, 0x1f, 0x0,  0xe,  0xf,  0x58, 0x36, 0x44, 0xb0, 0xba, 0x26, 0xde, 0x4,  0x37, 0xf3, 0xfc, 0xc2,
                   0x91, 0x28, 0x9d, 0x3,  0x0,  0x8,  0x42, 0x3e, 0xe1, 0x7a, 0xfd, 0x2b, 0xdd, 0xa5, 0x11, 0x0,  0x0,
                   0x1f, 0x5b, 0x27, 0x0,  0x0,  0xf,  0x46, 0x0,  0x1a, 0xad, 0x65, 0x6e, 0x28, 0x33, 0xb4, 0x15, 0xee,
                   0xe2, 0x7a, 0xe,  0xe7, 0xdd, 0x3c, 0x38, 0x75, 0xb7, 0xbc, 0xe5, 0xdd, 0xe7, 0x83, 0xb9, 0xb,  0xcb,
                   0x3b, 0x0,  0x1d, 0x7a, 0x23, 0x57, 0xea, 0x2,  0xe5, 0xa4, 0xcb, 0xe5, 0x82, 0xc9, 0x1,  0x79, 0xcd,
                   0x33, 0xa9, 0x3e, 0xcd, 0xa0, 0xcb, 0x64, 0x45, 0x6,  0xff, 0xd5, 0xa4, 0xe1, 0x1b, 0xa3, 0x0,  0x1c,
                   0xa9, 0x86, 0xe5, 0xb1, 0x8d, 0xa7, 0x3a, 0x22, 0xf0, 0x5f, 0xa8, 0x53, 0x17, 0x7e, 0xe4, 0xbe, 0xaf,
                   0xae, 0x6,  0xa8, 0xbf, 0x40, 0xab, 0xc7, 0x1d, 0x4d, 0xd0, 0x68};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops1[] = {0x22, 0x79, 0x70, 0xc0, 0xaf, 0x92, 0x43, 0x3f, 0x38, 0x51, 0x18, 0xe5, 0x2f,
                               0xe,  0x70, 0x9c, 0x40, 0xfb, 0x8f, 0x96, 0xdb, 0x90, 0x24, 0x12, 0x27};
  uint8_t byteswillprops2[] = {0xba, 0xc6, 0x98, 0x59, 0xed, 0xb8, 0x4, 0x93, 0xb8, 0xa9, 0xbd, 0x48, 0x3e};
  uint8_t byteswillprops3[] = {0x45, 0x4e, 0xb, 0x5, 0xa4, 0x36, 0x1e, 0x0, 0x59, 0x3e, 0x9d, 0xcc, 0x1a};
  uint8_t byteswillprops4[] = {0xf, 0x58, 0x36, 0x44, 0xb0, 0xba, 0x26, 0xde, 0x4, 0x37, 0xf3, 0xfc, 0xc2, 0x91};
  uint8_t byteswillprops5[] = {0x42, 0x3e, 0xe1, 0x7a, 0xfd, 0x2b, 0xdd, 0xa5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23446}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20915}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8027}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3910}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xad, 0x65, 0x6e, 0x28, 0x33, 0xb4, 0x15, 0xee, 0xe2, 0x7a, 0xe, 0xe7, 0xdd,
                                0x3c, 0x38, 0x75, 0xb7, 0xbc, 0xe5, 0xdd, 0xe7, 0x83, 0xb9, 0xb, 0xcb, 0x3b};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7a, 0x23, 0x57, 0xea, 0x2,  0xe5, 0xa4, 0xcb, 0xe5, 0x82,
                                  0xc9, 0x1,  0x79, 0xcd, 0x33, 0xa9, 0x3e, 0xcd, 0xa0, 0xcb,
                                  0x64, 0x45, 0x6,  0xff, 0xd5, 0xa4, 0xe1, 0x1b, 0xa3};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14436;
  uint8_t client_id_bytes[] = {0x22, 0xb3, 0x35, 0x6d, 0x48, 0x2b, 0x7b, 0xbb, 0xd0, 0x9,  0x60, 0x3c,
                               0x95, 0x4,  0xf9, 0xb6, 0xd6, 0xb8, 0x38, 0xc6, 0xc9, 0x8b, 0xba, 0x35};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa9, 0x86, 0xe5, 0xb1, 0x8d, 0xa7, 0x3a, 0x22, 0xf0, 0x5f, 0xa8, 0x53, 0x17, 0x7e,
                              0xe4, 0xbe, 0xaf, 0xae, 0x6,  0xa8, 0xbf, 0x40, 0xab, 0xc7, 0x1d, 0x4d, 0xd0, 0x68};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "O\165\188\192\128\155\192a\198\EM?\198\230)}\161", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "s\137\218\237\244]\194(\128\202w\240\147M6\232\218\245\251\&7hf\206t", _willMsg =
// "\238+y\253\141\&0--\219\143\226YM\140U\"dA\DLE\235\128", _willProps = [PropRequestProblemInformation
// 3,PropAuthenticationMethod "\229\183\172\208\ENQ\199\204(w\US\210\ETX6\164f",PropSubscriptionIdentifier
// 12,PropReceiveMaximum 7050,PropResponseTopic
// "\193uF,@T\253\131\198\206\251\135\187~\SOH\175\130\DC3\ENQ",PropServerKeepAlive 4117,PropAuthenticationData
// "\211\t\189\145\187\208\161\141\243y[E\235\213\FS\197H5$A(k",PropMaximumQoS 169,PropPayloadFormatIndicator
// 33,PropSubscriptionIdentifier 29,PropAuthenticationMethod
// "\162\206\f\219$\250\139\159\236}>E\199",PropSubscriptionIdentifierAvailable 188,PropMessageExpiryInterval
// 17531,PropPayloadFormatIndicator 197,PropMaximumQoS 196,PropRequestResponseInformation
// 21,PropRequestProblemInformation 250,PropRetainAvailable 235,PropRequestResponseInformation 123,PropTopicAliasMaximum
// 21710,PropResponseInformation
// "\SYN\194\142n\150\227\131\221\211\GS\vH\187\r@\171\229\178\166s\DC1\148\237X\249\&5*",PropMaximumQoS
// 195,PropAuthenticationMethod "]\r\178\ACK\247",PropServerReference
// "\163\225\&7\US\140\239\131\221\218fxe",PropAssignedClientIdentifier
// "\ESC\GS\SI\DC2l\243>Gr\150\186\145\&7\218\244\234\225c\171Vgq\207oE\187"]}), _cleanSession = False, _keepAlive =
// 3208, _connID = "\DC3P\129h", _properties = [PropTopicAlias 25688]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x10, 0xa4, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6c, 0xc,  0x88, 0x3,  0x23, 0x64, 0x58, 0x0,  0x4,
      0x13, 0x50, 0x81, 0x68, 0xcb, 0x1,  0x17, 0x3,  0x15, 0x0,  0xf,  0xe5, 0xb7, 0xac, 0xd0, 0x5,  0xc7, 0xcc, 0x28,
      0x77, 0x1f, 0xd2, 0x3,  0x36, 0xa4, 0x66, 0xb,  0xc,  0x21, 0x1b, 0x8a, 0x8,  0x0,  0x13, 0xc1, 0x75, 0x46, 0x2c,
      0x40, 0x54, 0xfd, 0x83, 0xc6, 0xce, 0xfb, 0x87, 0xbb, 0x7e, 0x1,  0xaf, 0x82, 0x13, 0x5,  0x13, 0x10, 0x15, 0x16,
      0x0,  0x16, 0xd3, 0x9,  0xbd, 0x91, 0xbb, 0xd0, 0xa1, 0x8d, 0xf3, 0x79, 0x5b, 0x45, 0xeb, 0xd5, 0x1c, 0xc5, 0x48,
      0x35, 0x24, 0x41, 0x28, 0x6b, 0x24, 0xa9, 0x1,  0x21, 0xb,  0x1d, 0x15, 0x0,  0xd,  0xa2, 0xce, 0xc,  0xdb, 0x24,
      0xfa, 0x8b, 0x9f, 0xec, 0x7d, 0x3e, 0x45, 0xc7, 0x29, 0xbc, 0x2,  0x0,  0x0,  0x44, 0x7b, 0x1,  0xc5, 0x24, 0xc4,
      0x19, 0x15, 0x17, 0xfa, 0x25, 0xeb, 0x19, 0x7b, 0x22, 0x54, 0xce, 0x1a, 0x0,  0x1b, 0x16, 0xc2, 0x8e, 0x6e, 0x96,
      0xe3, 0x83, 0xdd, 0xd3, 0x1d, 0xb,  0x48, 0xbb, 0xd,  0x40, 0xab, 0xe5, 0xb2, 0xa6, 0x73, 0x11, 0x94, 0xed, 0x58,
      0xf9, 0x35, 0x2a, 0x24, 0xc3, 0x15, 0x0,  0x5,  0x5d, 0xd,  0xb2, 0x6,  0xf7, 0x1c, 0x0,  0xc,  0xa3, 0xe1, 0x37,
      0x1f, 0x8c, 0xef, 0x83, 0xdd, 0xda, 0x66, 0x78, 0x65, 0x12, 0x0,  0x1a, 0x1b, 0x1d, 0xf,  0x12, 0x6c, 0xf3, 0x3e,
      0x47, 0x72, 0x96, 0xba, 0x91, 0x37, 0xda, 0xf4, 0xea, 0xe1, 0x63, 0xab, 0x56, 0x67, 0x71, 0xcf, 0x6f, 0x45, 0xbb,
      0x0,  0x18, 0x73, 0x89, 0xda, 0xed, 0xf4, 0x5d, 0xc2, 0x28, 0x80, 0xca, 0x77, 0xf0, 0x93, 0x4d, 0x36, 0xe8, 0xda,
      0xf5, 0xfb, 0x37, 0x68, 0x66, 0xce, 0x74, 0x0,  0x15, 0xee, 0x2b, 0x79, 0xfd, 0x8d, 0x30, 0x2d, 0x2d, 0xdb, 0x8f,
      0xe2, 0x59, 0x4d, 0x8c, 0x55, 0x22, 0x64, 0x41, 0x10, 0xeb, 0x80, 0x0,  0x10, 0x4f, 0xa5, 0xbc, 0xc0, 0x80, 0x9b,
      0xc0, 0x61, 0xc6, 0x19, 0x3f, 0xc6, 0xe6, 0x29, 0x7d, 0xa1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25688}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xe5, 0xb7, 0xac, 0xd0, 0x5, 0xc7, 0xcc, 0x28, 0x77, 0x1f, 0xd2, 0x3, 0x36, 0xa4, 0x66};
  uint8_t byteswillprops1[] = {0xc1, 0x75, 0x46, 0x2c, 0x40, 0x54, 0xfd, 0x83, 0xc6, 0xce,
                               0xfb, 0x87, 0xbb, 0x7e, 0x1,  0xaf, 0x82, 0x13, 0x5};
  uint8_t byteswillprops2[] = {0xd3, 0x9,  0xbd, 0x91, 0xbb, 0xd0, 0xa1, 0x8d, 0xf3, 0x79, 0x5b,
                               0x45, 0xeb, 0xd5, 0x1c, 0xc5, 0x48, 0x35, 0x24, 0x41, 0x28, 0x6b};
  uint8_t byteswillprops3[] = {0xa2, 0xce, 0xc, 0xdb, 0x24, 0xfa, 0x8b, 0x9f, 0xec, 0x7d, 0x3e, 0x45, 0xc7};
  uint8_t byteswillprops4[] = {0x16, 0xc2, 0x8e, 0x6e, 0x96, 0xe3, 0x83, 0xdd, 0xd3, 0x1d, 0xb,  0x48, 0xbb, 0xd,
                               0x40, 0xab, 0xe5, 0xb2, 0xa6, 0x73, 0x11, 0x94, 0xed, 0x58, 0xf9, 0x35, 0x2a};
  uint8_t byteswillprops5[] = {0x5d, 0xd, 0xb2, 0x6, 0xf7};
  uint8_t byteswillprops6[] = {0xa3, 0xe1, 0x37, 0x1f, 0x8c, 0xef, 0x83, 0xdd, 0xda, 0x66, 0x78, 0x65};
  uint8_t byteswillprops7[] = {0x1b, 0x1d, 0xf,  0x12, 0x6c, 0xf3, 0x3e, 0x47, 0x72, 0x96, 0xba, 0x91, 0x37,
                               0xda, 0xf4, 0xea, 0xe1, 0x63, 0xab, 0x56, 0x67, 0x71, 0xcf, 0x6f, 0x45, 0xbb};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7050}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4117}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17531}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21710}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x73, 0x89, 0xda, 0xed, 0xf4, 0x5d, 0xc2, 0x28, 0x80, 0xca, 0x77, 0xf0,
                                0x93, 0x4d, 0x36, 0xe8, 0xda, 0xf5, 0xfb, 0x37, 0x68, 0x66, 0xce, 0x74};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xee, 0x2b, 0x79, 0xfd, 0x8d, 0x30, 0x2d, 0x2d, 0xdb, 0x8f, 0xe2,
                                  0x59, 0x4d, 0x8c, 0x55, 0x22, 0x64, 0x41, 0x10, 0xeb, 0x80};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3208;
  uint8_t client_id_bytes[] = {0x13, 0x50, 0x81, 0x68};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x4f, 0xa5, 0xbc, 0xc0, 0x80, 0x9b, 0xc0, 0x61,
                              0xc6, 0x19, 0x3f, 0xc6, 0xe6, 0x29, 0x7d, 0xa1};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\149\151\139\195\172z\255\139u#\163\fg,\230|\158{", _password = Just
// "Z\165\208\RS\195i\201D9m(Z ,\165\217Aa\137\ENQ\SO\180", _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS0, _willTopic = "\141-\179\ENQl~\217\164\234\131\134\134\207X", _willMsg =
// ";\NUL\DEL\NUL\RSHW\212\230\191L\211s)\181j\203\158\229\137", _willProps = [PropAuthenticationMethod
// "\US\154\190)\184\149\NAK",PropTopicAlias 13388,PropWillDelayInterval 5881,PropWillDelayInterval
// 28801,PropSessionExpiryInterval 22600,PropTopicAlias 14648]}), _cleanSession = True, _keepAlive = 32044, _connID =
// "\248\r\241\217\233\199#\171\195\&6}Wu\226i\209\194\149\251\&6X$\144\230", _properties = [PropServerKeepAlive
// 16671,PropContentType "\130\SYNsO\170[*r\142\180q\146\244g\240\140\232",PropServerKeepAlive
// 5048,PropSubscriptionIdentifier 30,PropSharedSubscriptionAvailable 155,PropMessageExpiryInterval
// 25875,PropSharedSubscriptionAvailable 118,PropRequestProblemInformation 2,PropTopicAlias
// 30294,PropSessionExpiryInterval 23927,PropAuthenticationData "\138,H\185\139\&1\156\173"]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0xd1, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe6, 0x7d, 0x2c, 0x3a, 0x13, 0x41, 0x1f,
                   0x3,  0x0,  0x11, 0x82, 0x16, 0x73, 0x4f, 0xaa, 0x5b, 0x2a, 0x72, 0x8e, 0xb4, 0x71, 0x92, 0xf4, 0x67,
                   0xf0, 0x8c, 0xe8, 0x13, 0x13, 0xb8, 0xb,  0x1e, 0x2a, 0x9b, 0x2,  0x0,  0x0,  0x65, 0x13, 0x2a, 0x76,
                   0x17, 0x2,  0x23, 0x76, 0x56, 0x11, 0x0,  0x0,  0x5d, 0x77, 0x16, 0x0,  0x8,  0x8a, 0x2c, 0x48, 0xb9,
                   0x8b, 0x31, 0x9c, 0xad, 0x0,  0x18, 0xf8, 0xd,  0xf1, 0xd9, 0xe9, 0xc7, 0x23, 0xab, 0xc3, 0x36, 0x7d,
                   0x57, 0x75, 0xe2, 0x69, 0xd1, 0xc2, 0x95, 0xfb, 0x36, 0x58, 0x24, 0x90, 0xe6, 0x1f, 0x15, 0x0,  0x7,
                   0x1f, 0x9a, 0xbe, 0x29, 0xb8, 0x95, 0x15, 0x23, 0x34, 0x4c, 0x18, 0x0,  0x0,  0x16, 0xf9, 0x18, 0x0,
                   0x0,  0x70, 0x81, 0x11, 0x0,  0x0,  0x58, 0x48, 0x23, 0x39, 0x38, 0x0,  0xe,  0x8d, 0x2d, 0xb3, 0x5,
                   0x6c, 0x7e, 0xd9, 0xa4, 0xea, 0x83, 0x86, 0x86, 0xcf, 0x58, 0x0,  0x14, 0x3b, 0x0,  0x7f, 0x0,  0x1e,
                   0x48, 0x57, 0xd4, 0xe6, 0xbf, 0x4c, 0xd3, 0x73, 0x29, 0xb5, 0x6a, 0xcb, 0x9e, 0xe5, 0x89, 0x0,  0x12,
                   0x95, 0x97, 0x8b, 0xc3, 0xac, 0x7a, 0xff, 0x8b, 0x75, 0x23, 0xa3, 0xc,  0x67, 0x2c, 0xe6, 0x7c, 0x9e,
                   0x7b, 0x0,  0x16, 0x5a, 0xa5, 0xd0, 0x1e, 0xc3, 0x69, 0xc9, 0x44, 0x39, 0x6d, 0x28, 0x5a, 0x20, 0x2c,
                   0xa5, 0xd9, 0x41, 0x61, 0x89, 0x5,  0xe,  0xb4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x82, 0x16, 0x73, 0x4f, 0xaa, 0x5b, 0x2a, 0x72, 0x8e,
                           0xb4, 0x71, 0x92, 0xf4, 0x67, 0xf0, 0x8c, 0xe8};
  uint8_t bytesprops1[] = {0x8a, 0x2c, 0x48, 0xb9, 0x8b, 0x31, 0x9c, 0xad};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16671}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5048}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25875}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30294}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23927}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x1f, 0x9a, 0xbe, 0x29, 0xb8, 0x95, 0x15};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13388}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5881}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28801}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22600}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14648}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8d, 0x2d, 0xb3, 0x5, 0x6c, 0x7e, 0xd9, 0xa4, 0xea, 0x83, 0x86, 0x86, 0xcf, 0x58};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3b, 0x0,  0x7f, 0x0,  0x1e, 0x48, 0x57, 0xd4, 0xe6, 0xbf,
                                  0x4c, 0xd3, 0x73, 0x29, 0xb5, 0x6a, 0xcb, 0x9e, 0xe5, 0x89};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 32044;
  uint8_t client_id_bytes[] = {0xf8, 0xd,  0xf1, 0xd9, 0xe9, 0xc7, 0x23, 0xab, 0xc3, 0x36, 0x7d, 0x57,
                               0x75, 0xe2, 0x69, 0xd1, 0xc2, 0x95, 0xfb, 0x36, 0x58, 0x24, 0x90, 0xe6};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x95, 0x97, 0x8b, 0xc3, 0xac, 0x7a, 0xff, 0x8b, 0x75,
                              0x23, 0xa3, 0xc,  0x67, 0x2c, 0xe6, 0x7c, 0x9e, 0x7b};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5a, 0xa5, 0xd0, 0x1e, 0xc3, 0x69, 0xc9, 0x44, 0x39, 0x6d, 0x28,
                              0x5a, 0x20, 0x2c, 0xa5, 0xd9, 0x41, 0x61, 0x89, 0x5,  0xe,  0xb4};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "|\236r\252\&0Ku{\146\ETX\ACKm\178\134\193P\SUB", _password = Just
// "mYo\132\144\131\150'\206lC{\157\159\174\ETX", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2,
// _willTopic = "\129\242\250\251\220\214\242\EOTx\180\v4H\156w\139\247zR\199u\172r\136\155\198\SUB", _willMsg =
// "\166V\216\GS\135B\DC4\223\177\149\223\195\178\NUL\DLER\206/Q'O\128-\EOT\134", _willProps = [PropResponseTopic
// "\130\241\197(\190\174\161!>\239\171\160C\134",PropWildcardSubscriptionAvailable 54,PropAuthenticationData
// "\154\197Y\137\254\DC4\149$\GS\234\&5\227a,\DC2\161[W\199{H\207\235MJ\154",PropSharedSubscriptionAvailable
// 18,PropTopicAliasMaximum 31321,PropTopicAlias 3735,PropReasonString "\216A\SOH\US\132e@S",PropSessionExpiryInterval
// 27865]}), _cleanSession = False, _keepAlive = 12650, _connID = "\180N\165", _properties = [PropUserProperty
// "\202\237c\v\218Sd\DC3p\214\137/r\128\188\&0sB\NUL5\"\138\206&s=\140\157A#"
// "\205>k@\231\182z%\159#\SUB\230\NUL",PropServerReference
// "a\129\178\132?\133\186\vro/\254\184b4\148\139",PropRetainAvailable 26,PropRequestProblemInformation
// 130,PropPayloadFormatIndicator 226,PropServerReference "\\\206"]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0x85, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x31, 0x6a, 0x4f, 0x26, 0x0,  0x1e, 0xca, 0xed,
      0x63, 0xb,  0xda, 0x53, 0x64, 0x13, 0x70, 0xd6, 0x89, 0x2f, 0x72, 0x80, 0xbc, 0x30, 0x73, 0x42, 0x0,  0x35, 0x22,
      0x8a, 0xce, 0x26, 0x73, 0x3d, 0x8c, 0x9d, 0x41, 0x23, 0x0,  0xd,  0xcd, 0x3e, 0x6b, 0x40, 0xe7, 0xb6, 0x7a, 0x25,
      0x9f, 0x23, 0x1a, 0xe6, 0x0,  0x1c, 0x0,  0x11, 0x61, 0x81, 0xb2, 0x84, 0x3f, 0x85, 0xba, 0xb,  0x72, 0x6f, 0x2f,
      0xfe, 0xb8, 0x62, 0x34, 0x94, 0x8b, 0x25, 0x1a, 0x17, 0x82, 0x1,  0xe2, 0x1c, 0x0,  0x2,  0x5c, 0xce, 0x0,  0x3,
      0xb4, 0x4e, 0xa5, 0x48, 0x8,  0x0,  0xe,  0x82, 0xf1, 0xc5, 0x28, 0xbe, 0xae, 0xa1, 0x21, 0x3e, 0xef, 0xab, 0xa0,
      0x43, 0x86, 0x28, 0x36, 0x16, 0x0,  0x1a, 0x9a, 0xc5, 0x59, 0x89, 0xfe, 0x14, 0x95, 0x24, 0x1d, 0xea, 0x35, 0xe3,
      0x61, 0x2c, 0x12, 0xa1, 0x5b, 0x57, 0xc7, 0x7b, 0x48, 0xcf, 0xeb, 0x4d, 0x4a, 0x9a, 0x2a, 0x12, 0x22, 0x7a, 0x59,
      0x23, 0xe,  0x97, 0x1f, 0x0,  0x8,  0xd8, 0x41, 0x1,  0x1f, 0x84, 0x65, 0x40, 0x53, 0x11, 0x0,  0x0,  0x6c, 0xd9,
      0x0,  0x1b, 0x81, 0xf2, 0xfa, 0xfb, 0xdc, 0xd6, 0xf2, 0x4,  0x78, 0xb4, 0xb,  0x34, 0x48, 0x9c, 0x77, 0x8b, 0xf7,
      0x7a, 0x52, 0xc7, 0x75, 0xac, 0x72, 0x88, 0x9b, 0xc6, 0x1a, 0x0,  0x19, 0xa6, 0x56, 0xd8, 0x1d, 0x87, 0x42, 0x14,
      0xdf, 0xb1, 0x95, 0xdf, 0xc3, 0xb2, 0x0,  0x10, 0x52, 0xce, 0x2f, 0x51, 0x27, 0x4f, 0x80, 0x2d, 0x4,  0x86, 0x0,
      0x11, 0x7c, 0xec, 0x72, 0xfc, 0x30, 0x4b, 0x75, 0x7b, 0x92, 0x3,  0x6,  0x6d, 0xb2, 0x86, 0xc1, 0x50, 0x1a, 0x0,
      0x10, 0x6d, 0x59, 0x6f, 0x84, 0x90, 0x83, 0x96, 0x27, 0xce, 0x6c, 0x43, 0x7b, 0x9d, 0x9f, 0xae, 0x3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0xcd, 0x3e, 0x6b, 0x40, 0xe7, 0xb6, 0x7a, 0x25, 0x9f, 0x23, 0x1a, 0xe6, 0x0};
  uint8_t bytesprops0[] = {0xca, 0xed, 0x63, 0xb, 0xda, 0x53, 0x64, 0x13, 0x70, 0xd6, 0x89, 0x2f, 0x72, 0x80, 0xbc,
                           0x30, 0x73, 0x42, 0x0, 0x35, 0x22, 0x8a, 0xce, 0x26, 0x73, 0x3d, 0x8c, 0x9d, 0x41, 0x23};
  uint8_t bytesprops2[] = {0x61, 0x81, 0xb2, 0x84, 0x3f, 0x85, 0xba, 0xb, 0x72,
                           0x6f, 0x2f, 0xfe, 0xb8, 0x62, 0x34, 0x94, 0x8b};
  uint8_t bytesprops3[] = {0x5c, 0xce};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops0}, .v = {13, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x82, 0xf1, 0xc5, 0x28, 0xbe, 0xae, 0xa1, 0x21, 0x3e, 0xef, 0xab, 0xa0, 0x43, 0x86};
  uint8_t byteswillprops1[] = {0x9a, 0xc5, 0x59, 0x89, 0xfe, 0x14, 0x95, 0x24, 0x1d, 0xea, 0x35, 0xe3, 0x61,
                               0x2c, 0x12, 0xa1, 0x5b, 0x57, 0xc7, 0x7b, 0x48, 0xcf, 0xeb, 0x4d, 0x4a, 0x9a};
  uint8_t byteswillprops2[] = {0xd8, 0x41, 0x1, 0x1f, 0x84, 0x65, 0x40, 0x53};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31321}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3735}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27865}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x81, 0xf2, 0xfa, 0xfb, 0xdc, 0xd6, 0xf2, 0x4,  0x78, 0xb4, 0xb,  0x34, 0x48, 0x9c,
                                0x77, 0x8b, 0xf7, 0x7a, 0x52, 0xc7, 0x75, 0xac, 0x72, 0x88, 0x9b, 0xc6, 0x1a};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa6, 0x56, 0xd8, 0x1d, 0x87, 0x42, 0x14, 0xdf, 0xb1, 0x95, 0xdf, 0xc3, 0xb2,
                                  0x0,  0x10, 0x52, 0xce, 0x2f, 0x51, 0x27, 0x4f, 0x80, 0x2d, 0x4,  0x86};
  lwmqtt_string_t will_payload = {25, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12650;
  uint8_t client_id_bytes[] = {0xb4, 0x4e, 0xa5};
  lwmqtt_string_t client_id = {3, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7c, 0xec, 0x72, 0xfc, 0x30, 0x4b, 0x75, 0x7b, 0x92,
                              0x3,  0x6,  0x6d, 0xb2, 0x86, 0xc1, 0x50, 0x1a};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6d, 0x59, 0x6f, 0x84, 0x90, 0x83, 0x96, 0x27,
                              0xce, 0x6c, 0x43, 0x7b, 0x9d, 0x9f, 0xae, 0x3};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\176\SUB(", _password = Nothing, _lastWill = Nothing, _cleanSession = False,
// _keepAlive = 9985, _connID = "\144\&3\142\215M", _properties = [PropServerKeepAlive
// 12899,PropSharedSubscriptionAvailable 49,PropWillDelayInterval 12770,PropAuthenticationData
// "\209\&7\252\240\163X\180\180\245\147\153aL\134",PropWillDelayInterval 18290,PropRequestResponseInformation
// 60,PropRetainAvailable 253,PropWildcardSubscriptionAvailable 210,PropServerReference
// "\155\210\197\197?G\144",PropUserProperty "\ETB\188\RS\161\131\184\GS\189\223A/\202\178\153\145\190"
// "\253\195Wp\178\130[\195v\t\136\225-\168s\141P\177\210\n{\ETXF\EMqX\192\139",PropReasonString
// "\ETB\188\170_\NAK\246\216\237h\187\231\v\231.\226vs2\150]\171",PropSharedSubscriptionAvailable
// 198,PropAssignedClientIdentifier
// "\r\146{|\130>@\252'\b\219\184\153\232O\248\196\EMv.\204\166\133",PropSessionExpiryInterval
// 10846,PropRequestResponseInformation 221]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0xb4, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x27, 0x1,  0x9c, 0x1,  0x13, 0x32,
                   0x63, 0x2a, 0x31, 0x18, 0x0,  0x0,  0x31, 0xe2, 0x16, 0x0,  0xe,  0xd1, 0x37, 0xfc, 0xf0, 0xa3, 0x58,
                   0xb4, 0xb4, 0xf5, 0x93, 0x99, 0x61, 0x4c, 0x86, 0x18, 0x0,  0x0,  0x47, 0x72, 0x19, 0x3c, 0x25, 0xfd,
                   0x28, 0xd2, 0x1c, 0x0,  0x7,  0x9b, 0xd2, 0xc5, 0xc5, 0x3f, 0x47, 0x90, 0x26, 0x0,  0x10, 0x17, 0xbc,
                   0x1e, 0xa1, 0x83, 0xb8, 0x1d, 0xbd, 0xdf, 0x41, 0x2f, 0xca, 0xb2, 0x99, 0x91, 0xbe, 0x0,  0x1c, 0xfd,
                   0xc3, 0x57, 0x70, 0xb2, 0x82, 0x5b, 0xc3, 0x76, 0x9,  0x88, 0xe1, 0x2d, 0xa8, 0x73, 0x8d, 0x50, 0xb1,
                   0xd2, 0xa,  0x7b, 0x3,  0x46, 0x19, 0x71, 0x58, 0xc0, 0x8b, 0x1f, 0x0,  0x15, 0x17, 0xbc, 0xaa, 0x5f,
                   0x15, 0xf6, 0xd8, 0xed, 0x68, 0xbb, 0xe7, 0xb,  0xe7, 0x2e, 0xe2, 0x76, 0x73, 0x32, 0x96, 0x5d, 0xab,
                   0x2a, 0xc6, 0x12, 0x0,  0x17, 0xd,  0x92, 0x7b, 0x7c, 0x82, 0x3e, 0x40, 0xfc, 0x27, 0x8,  0xdb, 0xb8,
                   0x99, 0xe8, 0x4f, 0xf8, 0xc4, 0x19, 0x76, 0x2e, 0xcc, 0xa6, 0x85, 0x11, 0x0,  0x0,  0x2a, 0x5e, 0x19,
                   0xdd, 0x0,  0x5,  0x90, 0x33, 0x8e, 0xd7, 0x4d, 0x0,  0x3,  0xb0, 0x1a, 0x28};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd1, 0x37, 0xfc, 0xf0, 0xa3, 0x58, 0xb4, 0xb4, 0xf5, 0x93, 0x99, 0x61, 0x4c, 0x86};
  uint8_t bytesprops1[] = {0x9b, 0xd2, 0xc5, 0xc5, 0x3f, 0x47, 0x90};
  uint8_t bytesprops3[] = {0xfd, 0xc3, 0x57, 0x70, 0xb2, 0x82, 0x5b, 0xc3, 0x76, 0x9,  0x88, 0xe1, 0x2d, 0xa8,
                           0x73, 0x8d, 0x50, 0xb1, 0xd2, 0xa,  0x7b, 0x3,  0x46, 0x19, 0x71, 0x58, 0xc0, 0x8b};
  uint8_t bytesprops2[] = {0x17, 0xbc, 0x1e, 0xa1, 0x83, 0xb8, 0x1d, 0xbd,
                           0xdf, 0x41, 0x2f, 0xca, 0xb2, 0x99, 0x91, 0xbe};
  uint8_t bytesprops4[] = {0x17, 0xbc, 0xaa, 0x5f, 0x15, 0xf6, 0xd8, 0xed, 0x68, 0xbb, 0xe7,
                           0xb,  0xe7, 0x2e, 0xe2, 0x76, 0x73, 0x32, 0x96, 0x5d, 0xab};
  uint8_t bytesprops5[] = {0xd,  0x92, 0x7b, 0x7c, 0x82, 0x3e, 0x40, 0xfc, 0x27, 0x8,  0xdb, 0xb8,
                           0x99, 0xe8, 0x4f, 0xf8, 0xc4, 0x19, 0x76, 0x2e, 0xcc, 0xa6, 0x85};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12899}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12770}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18290}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops2}, .v = {28, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10846}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 221}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 9985;
  uint8_t client_id_bytes[] = {0x90, 0x33, 0x8e, 0xd7, 0x4d};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb0, 0x1a, 0x28};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS =
// QoS2, _willTopic = "3\ENQ\159tA", _willMsg = "\253\&0\175\230\149U\228\219\161nq\159m\NAK", _willProps =
// [PropAuthenticationMethod "\159",PropSharedSubscriptionAvailable 237,PropMessageExpiryInterval
// 8765,PropSessionExpiryInterval 16121,PropAuthenticationData
// "\191\145\"\n\135\238O:l$8mT\255d\160\176\r\154A\SYN\254\131\219\243\172\182\179\169",PropReceiveMaximum
// 18457,PropServerKeepAlive 6360,PropServerReference ",\178\b\130<\221\195\152\220",PropReceiveMaximum 9970]}),
// _cleanSession = True, _keepAlive = 2853, _connID = "\223k\158\244\196\196\240\228\&8\134\t*", _properties =
// [PropTopicAliasMaximum 26453,PropRequestProblemInformation 200,PropWillDelayInterval 17617,PropResponseInformation
// "\DC4\130\208\233\165x;\179\SUB\v\183\146\245\167,}\254\202<\157",PropReceiveMaximum 2414,PropTopicAliasMaximum
// 7212,PropRequestResponseInformation 231,PropSubscriptionIdentifier 11,PropUserProperty "\tn\ESCq\tw"
// "`Q\240$\189\&5\209\214\172\FS\t\r\128\203\167O\DC3\202",PropRequestResponseInformation 6,PropUserProperty
// "\163\139\\Mi\144q"
// "\147\164Tv\195\SOH\208\FS\241Rq\158\&1\f\187\160B\225\141\230\253\189\a\EOT",PropPayloadFormatIndicator 31]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0xe6, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x36, 0xb,  0x25, 0x70, 0x22, 0x67, 0x55,
                   0x17, 0xc8, 0x18, 0x0,  0x0,  0x44, 0xd1, 0x1a, 0x0,  0x14, 0x14, 0x82, 0xd0, 0xe9, 0xa5, 0x78, 0x3b,
                   0xb3, 0x1a, 0xb,  0xb7, 0x92, 0xf5, 0xa7, 0x2c, 0x7d, 0xfe, 0xca, 0x3c, 0x9d, 0x21, 0x9,  0x6e, 0x22,
                   0x1c, 0x2c, 0x19, 0xe7, 0xb,  0xb,  0x26, 0x0,  0x6,  0x9,  0x6e, 0x1b, 0x71, 0x9,  0x77, 0x0,  0x12,
                   0x60, 0x51, 0xf0, 0x24, 0xbd, 0x35, 0xd1, 0xd6, 0xac, 0x1c, 0x9,  0xd,  0x80, 0xcb, 0xa7, 0x4f, 0x13,
                   0xca, 0x19, 0x6,  0x26, 0x0,  0x7,  0xa3, 0x8b, 0x5c, 0x4d, 0x69, 0x90, 0x71, 0x0,  0x18, 0x93, 0xa4,
                   0x54, 0x76, 0xc3, 0x1,  0xd0, 0x1c, 0xf1, 0x52, 0x71, 0x9e, 0x31, 0xc,  0xbb, 0xa0, 0x42, 0xe1, 0x8d,
                   0xe6, 0xfd, 0xbd, 0x7,  0x4,  0x1,  0x1f, 0x0,  0xc,  0xdf, 0x6b, 0x9e, 0xf4, 0xc4, 0xc4, 0xf0, 0xe4,
                   0x38, 0x86, 0x9,  0x2a, 0x45, 0x15, 0x0,  0x1,  0x9f, 0x2a, 0xed, 0x2,  0x0,  0x0,  0x22, 0x3d, 0x11,
                   0x0,  0x0,  0x3e, 0xf9, 0x16, 0x0,  0x1d, 0xbf, 0x91, 0x22, 0xa,  0x87, 0xee, 0x4f, 0x3a, 0x6c, 0x24,
                   0x38, 0x6d, 0x54, 0xff, 0x64, 0xa0, 0xb0, 0xd,  0x9a, 0x41, 0x16, 0xfe, 0x83, 0xdb, 0xf3, 0xac, 0xb6,
                   0xb3, 0xa9, 0x21, 0x48, 0x19, 0x13, 0x18, 0xd8, 0x1c, 0x0,  0x9,  0x2c, 0xb2, 0x8,  0x82, 0x3c, 0xdd,
                   0xc3, 0x98, 0xdc, 0x21, 0x26, 0xf2, 0x0,  0x5,  0x33, 0x5,  0x9f, 0x74, 0x41, 0x0,  0xe,  0xfd, 0x30,
                   0xaf, 0xe6, 0x95, 0x55, 0xe4, 0xdb, 0xa1, 0x6e, 0x71, 0x9f, 0x6d, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x14, 0x82, 0xd0, 0xe9, 0xa5, 0x78, 0x3b, 0xb3, 0x1a, 0xb,
                           0xb7, 0x92, 0xf5, 0xa7, 0x2c, 0x7d, 0xfe, 0xca, 0x3c, 0x9d};
  uint8_t bytesprops2[] = {0x60, 0x51, 0xf0, 0x24, 0xbd, 0x35, 0xd1, 0xd6, 0xac,
                           0x1c, 0x9,  0xd,  0x80, 0xcb, 0xa7, 0x4f, 0x13, 0xca};
  uint8_t bytesprops1[] = {0x9, 0x6e, 0x1b, 0x71, 0x9, 0x77};
  uint8_t bytesprops4[] = {0x93, 0xa4, 0x54, 0x76, 0xc3, 0x1,  0xd0, 0x1c, 0xf1, 0x52, 0x71, 0x9e,
                           0x31, 0xc,  0xbb, 0xa0, 0x42, 0xe1, 0x8d, 0xe6, 0xfd, 0xbd, 0x7,  0x4};
  uint8_t bytesprops3[] = {0xa3, 0x8b, 0x5c, 0x4d, 0x69, 0x90, 0x71};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26453}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17617}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2414}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7212}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops3}, .v = {24, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 31}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9f};
  uint8_t byteswillprops1[] = {0xbf, 0x91, 0x22, 0xa,  0x87, 0xee, 0x4f, 0x3a, 0x6c, 0x24, 0x38, 0x6d, 0x54, 0xff, 0x64,
                               0xa0, 0xb0, 0xd,  0x9a, 0x41, 0x16, 0xfe, 0x83, 0xdb, 0xf3, 0xac, 0xb6, 0xb3, 0xa9};
  uint8_t byteswillprops2[] = {0x2c, 0xb2, 0x8, 0x82, 0x3c, 0xdd, 0xc3, 0x98, 0xdc};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8765}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16121}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18457}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6360}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9970}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x33, 0x5, 0x9f, 0x74, 0x41};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfd, 0x30, 0xaf, 0xe6, 0x95, 0x55, 0xe4, 0xdb, 0xa1, 0x6e, 0x71, 0x9f, 0x6d, 0x15};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2853;
  uint8_t client_id_bytes[] = {0xdf, 0x6b, 0x9e, 0xf4, 0xc4, 0xc4, 0xf0, 0xe4, 0x38, 0x86, 0x9, 0x2a};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\"", _password = Just "\223>\255\222\&1+\192nU\183\230", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\b)e\236\251\251F\231*\144\171\179\130", _willMsg =
// "\224$\244h\238M\173a\166,{\149\167\153\201{\142.\175\&3A=\249\214\DC1\254oO\186", _willProps =
// [PropMessageExpiryInterval 10851,PropMessageExpiryInterval 30029,PropAuthenticationMethod
// "\SYN}\183n\181\198\138\&7@\146&\136\n\160Q\254\130\ACK\139\RS>\170G\166uc3+|\147",PropMaximumQoS
// 49,PropResponseInformation "3\232\160\231\154\143bE`l\193N",PropResponseTopic "\223\v$\227\161\185eK\135\DEL\182
// $3\200~[",PropCorrelationData "\192\230\179\&08\196W\182\179\164w\182\151\DC3)",PropRequestResponseInformation
// 191,PropWillDelayInterval 16685,PropTopicAliasMaximum 10583,PropWildcardSubscriptionAvailable 161,PropReceiveMaximum
// 1963,PropContentType "\162\SI\"M\\-.\233\ETB\EM\133\185\136\230\&4\DC1W}l\187\209",PropAuthenticationData
// "\236\250\138P\198\129PP\ESC",PropReceiveMaximum 6355]}), _cleanSession = False, _keepAlive = 26056, _connID =
// "c\EM'\202qq<\213", _properties = [PropContentType "{\213\150S\SI\146h1\143",PropSessionExpiryInterval
// 9151,PropMaximumQoS 249,PropSubscriptionIdentifier 0,PropMessageExpiryInterval 6763,PropRequestProblemInformation
// 17,PropSubscriptionIdentifier 5,PropWillDelayInterval 10472,PropMessageExpiryInterval 3487,PropCorrelationData
// "\212"]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x10, 0x99, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x65, 0xc8, 0x2c, 0x3,  0x0,  0x9,  0x7b, 0xd5,
      0x96, 0x53, 0xf,  0x92, 0x68, 0x31, 0x8f, 0x11, 0x0,  0x0,  0x23, 0xbf, 0x24, 0xf9, 0xb,  0x0,  0x2,  0x0,  0x0,
      0x1a, 0x6b, 0x17, 0x11, 0xb,  0x5,  0x18, 0x0,  0x0,  0x28, 0xe8, 0x2,  0x0,  0x0,  0xd,  0x9f, 0x9,  0x0,  0x1,
      0xd4, 0x0,  0x8,  0x63, 0x19, 0x27, 0xca, 0x71, 0x71, 0x3c, 0xd5, 0x98, 0x1,  0x2,  0x0,  0x0,  0x2a, 0x63, 0x2,
      0x0,  0x0,  0x75, 0x4d, 0x15, 0x0,  0x1e, 0x16, 0x7d, 0xb7, 0x6e, 0xb5, 0xc6, 0x8a, 0x37, 0x40, 0x92, 0x26, 0x88,
      0xa,  0xa0, 0x51, 0xfe, 0x82, 0x6,  0x8b, 0x1e, 0x3e, 0xaa, 0x47, 0xa6, 0x75, 0x63, 0x33, 0x2b, 0x7c, 0x93, 0x24,
      0x31, 0x1a, 0x0,  0xc,  0x33, 0xe8, 0xa0, 0xe7, 0x9a, 0x8f, 0x62, 0x45, 0x60, 0x6c, 0xc1, 0x4e, 0x8,  0x0,  0x11,
      0xdf, 0xb,  0x24, 0xe3, 0xa1, 0xb9, 0x65, 0x4b, 0x87, 0x7f, 0xb6, 0x20, 0x24, 0x33, 0xc8, 0x7e, 0x5b, 0x9,  0x0,
      0xf,  0xc0, 0xe6, 0xb3, 0x30, 0x38, 0xc4, 0x57, 0xb6, 0xb3, 0xa4, 0x77, 0xb6, 0x97, 0x13, 0x29, 0x19, 0xbf, 0x18,
      0x0,  0x0,  0x41, 0x2d, 0x22, 0x29, 0x57, 0x28, 0xa1, 0x21, 0x7,  0xab, 0x3,  0x0,  0x15, 0xa2, 0xf,  0x22, 0x4d,
      0x5c, 0x2d, 0x2e, 0xe9, 0x17, 0x19, 0x85, 0xb9, 0x88, 0xe6, 0x34, 0x11, 0x57, 0x7d, 0x6c, 0xbb, 0xd1, 0x16, 0x0,
      0x9,  0xec, 0xfa, 0x8a, 0x50, 0xc6, 0x81, 0x50, 0x50, 0x1b, 0x21, 0x18, 0xd3, 0x0,  0xd,  0x8,  0x29, 0x65, 0xec,
      0xfb, 0xfb, 0x46, 0xe7, 0x2a, 0x90, 0xab, 0xb3, 0x82, 0x0,  0x1d, 0xe0, 0x24, 0xf4, 0x68, 0xee, 0x4d, 0xad, 0x61,
      0xa6, 0x2c, 0x7b, 0x95, 0xa7, 0x99, 0xc9, 0x7b, 0x8e, 0x2e, 0xaf, 0x33, 0x41, 0x3d, 0xf9, 0xd6, 0x11, 0xfe, 0x6f,
      0x4f, 0xba, 0x0,  0x1,  0x22, 0x0,  0xb,  0xdf, 0x3e, 0xff, 0xde, 0x31, 0x2b, 0xc0, 0x6e, 0x55, 0xb7, 0xe6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7b, 0xd5, 0x96, 0x53, 0xf, 0x92, 0x68, 0x31, 0x8f};
  uint8_t bytesprops1[] = {0xd4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9151}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6763}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10472}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3487}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x16, 0x7d, 0xb7, 0x6e, 0xb5, 0xc6, 0x8a, 0x37, 0x40, 0x92,
                               0x26, 0x88, 0xa,  0xa0, 0x51, 0xfe, 0x82, 0x6,  0x8b, 0x1e,
                               0x3e, 0xaa, 0x47, 0xa6, 0x75, 0x63, 0x33, 0x2b, 0x7c, 0x93};
  uint8_t byteswillprops1[] = {0x33, 0xe8, 0xa0, 0xe7, 0x9a, 0x8f, 0x62, 0x45, 0x60, 0x6c, 0xc1, 0x4e};
  uint8_t byteswillprops2[] = {0xdf, 0xb,  0x24, 0xe3, 0xa1, 0xb9, 0x65, 0x4b, 0x87,
                               0x7f, 0xb6, 0x20, 0x24, 0x33, 0xc8, 0x7e, 0x5b};
  uint8_t byteswillprops3[] = {0xc0, 0xe6, 0xb3, 0x30, 0x38, 0xc4, 0x57, 0xb6,
                               0xb3, 0xa4, 0x77, 0xb6, 0x97, 0x13, 0x29};
  uint8_t byteswillprops4[] = {0xa2, 0xf,  0x22, 0x4d, 0x5c, 0x2d, 0x2e, 0xe9, 0x17, 0x19, 0x85,
                               0xb9, 0x88, 0xe6, 0x34, 0x11, 0x57, 0x7d, 0x6c, 0xbb, 0xd1};
  uint8_t byteswillprops5[] = {0xec, 0xfa, 0x8a, 0x50, 0xc6, 0x81, 0x50, 0x50, 0x1b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10851}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30029}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16685}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10583}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1963}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6355}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8, 0x29, 0x65, 0xec, 0xfb, 0xfb, 0x46, 0xe7, 0x2a, 0x90, 0xab, 0xb3, 0x82};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe0, 0x24, 0xf4, 0x68, 0xee, 0x4d, 0xad, 0x61, 0xa6, 0x2c,
                                  0x7b, 0x95, 0xa7, 0x99, 0xc9, 0x7b, 0x8e, 0x2e, 0xaf, 0x33,
                                  0x41, 0x3d, 0xf9, 0xd6, 0x11, 0xfe, 0x6f, 0x4f, 0xba};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26056;
  uint8_t client_id_bytes[] = {0x63, 0x19, 0x27, 0xca, 0x71, 0x71, 0x3c, 0xd5};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x22};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdf, 0x3e, 0xff, 0xde, 0x31, 0x2b, 0xc0, 0x6e, 0x55, 0xb7, 0xe6};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14771 [("#\200Q\136b\STX\234p\149",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS2}),("\228_\193\193f_2@\169\173\&8\140\194\221c7\ACK|\ESC\249[\"Cm\187\155\170\176",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("#\f&\179\130I\157\181\213\&6fl\DC2\184\SYN\188\175\227&yeI",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\247St\244Y\\m\197\n\f\DC4A\EOT\nmG\183L\SOH\161J\132\a\150\&3\DC3SP\130\194",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("E\169\130\158J\214",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x70, 0x39, 0xb3, 0x0,  0x9,  0x23, 0xc8, 0x51, 0x88, 0x62, 0x2,  0xea, 0x70, 0x95, 0x2,  0x0,
                   0x1c, 0xe4, 0x5f, 0xc1, 0xc1, 0x66, 0x5f, 0x32, 0x40, 0xa9, 0xad, 0x38, 0x8c, 0xc2, 0xdd, 0x63, 0x37,
                   0x6,  0x7c, 0x1b, 0xf9, 0x5b, 0x22, 0x43, 0x6d, 0xbb, 0x9b, 0xaa, 0xb0, 0x0,  0x0,  0x16, 0x23, 0xc,
                   0x26, 0xb3, 0x82, 0x49, 0x9d, 0xb5, 0xd5, 0x36, 0x66, 0x6c, 0x12, 0xb8, 0x16, 0xbc, 0xaf, 0xe3, 0x26,
                   0x79, 0x65, 0x49, 0x2,  0x0,  0x1e, 0xf7, 0x53, 0x74, 0xf4, 0x59, 0x5c, 0x6d, 0xc5, 0xa,  0xc,  0x14,
                   0x41, 0x4,  0xa,  0x6d, 0x47, 0xb7, 0x4c, 0x1,  0xa1, 0x4a, 0x84, 0x7,  0x96, 0x33, 0x13, 0x53, 0x50,
                   0x82, 0xc2, 0x0,  0x0,  0x6,  0x45, 0xa9, 0x82, 0x9e, 0x4a, 0xd6, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x23, 0xc8, 0x51, 0x88, 0x62, 0x2, 0xea, 0x70, 0x95};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe4, 0x5f, 0xc1, 0xc1, 0x66, 0x5f, 0x32, 0x40, 0xa9, 0xad,
                                     0x38, 0x8c, 0xc2, 0xdd, 0x63, 0x37, 0x6,  0x7c, 0x1b, 0xf9,
                                     0x5b, 0x22, 0x43, 0x6d, 0xbb, 0x9b, 0xaa, 0xb0};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x23, 0xc,  0x26, 0xb3, 0x82, 0x49, 0x9d, 0xb5, 0xd5, 0x36, 0x66,
                                     0x6c, 0x12, 0xb8, 0x16, 0xbc, 0xaf, 0xe3, 0x26, 0x79, 0x65, 0x49};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf7, 0x53, 0x74, 0xf4, 0x59, 0x5c, 0x6d, 0xc5, 0xa,  0xc,
                                     0x14, 0x41, 0x4,  0xa,  0x6d, 0x47, 0xb7, 0x4c, 0x1,  0xa1,
                                     0x4a, 0x84, 0x7,  0x96, 0x33, 0x13, 0x53, 0x50, 0x82, 0xc2};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x45, 0xa9, 0x82, 0x9e, 0x4a, 0xd6};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14771, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15521 [("`\189\"5\223\186\254\236\DC4y(\SYNn",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("r\ESC\204\199kn\141\&6\182\233~\DC4\158p$\220\NAK\GSm#",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("7m\NUL\DC2c\DC1\250\133",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\RS\\/\203\156\163\252S.\174\177kq\225p\148\163b\249\147e.\EOT\DC2k\206\177",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("/\b\177\207\ENQ\229\157k\212\ng\247\DC3\250K`\202tNp\249\223\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\157\187\230\229\224\196T",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\222\n\165\165\169%\204-\NUL\STX\192\143p4\221U",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\234\158xoF\217\SUB\128~\184\v",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\165)n:\242PZ@\244yx\255\DLEf\155\183\r\RSd\207",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0xae, 0x1,  0x3c, 0xa1, 0x0,  0xd,  0x60, 0xbd, 0x22, 0x35, 0xdf, 0xba, 0xfe, 0xec, 0x14, 0x79,
                   0x28, 0x16, 0x6e, 0x2,  0x0,  0x14, 0x72, 0x1b, 0xcc, 0xc7, 0x6b, 0x6e, 0x8d, 0x36, 0xb6, 0xe9, 0x7e,
                   0x14, 0x9e, 0x70, 0x24, 0xdc, 0x15, 0x1d, 0x6d, 0x23, 0x0,  0x0,  0x8,  0x37, 0x6d, 0x0,  0x12, 0x63,
                   0x11, 0xfa, 0x85, 0x2,  0x0,  0x1b, 0x1e, 0x5c, 0x2f, 0xcb, 0x9c, 0xa3, 0xfc, 0x53, 0x2e, 0xae, 0xb1,
                   0x6b, 0x71, 0xe1, 0x70, 0x94, 0xa3, 0x62, 0xf9, 0x93, 0x65, 0x2e, 0x4,  0x12, 0x6b, 0xce, 0xb1, 0x0,
                   0x0,  0x17, 0x2f, 0x8,  0xb1, 0xcf, 0x5,  0xe5, 0x9d, 0x6b, 0xd4, 0xa,  0x67, 0xf7, 0x13, 0xfa, 0x4b,
                   0x60, 0xca, 0x74, 0x4e, 0x70, 0xf9, 0xdf, 0x87, 0x1,  0x0,  0x7,  0x9d, 0xbb, 0xe6, 0xe5, 0xe0, 0xc4,
                   0x54, 0x2,  0x0,  0x10, 0xde, 0xa,  0xa5, 0xa5, 0xa9, 0x25, 0xcc, 0x2d, 0x0,  0x2,  0xc0, 0x8f, 0x70,
                   0x34, 0xdd, 0x55, 0x2,  0x0,  0xb,  0xea, 0x9e, 0x78, 0x6f, 0x46, 0xd9, 0x1a, 0x80, 0x7e, 0xb8, 0xb,
                   0x2,  0x0,  0x14, 0xa5, 0x29, 0x6e, 0x3a, 0xf2, 0x50, 0x5a, 0x40, 0xf4, 0x79, 0x78, 0xff, 0x10, 0x66,
                   0x9b, 0xb7, 0xd,  0x1e, 0x64, 0xcf, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x60, 0xbd, 0x22, 0x35, 0xdf, 0xba, 0xfe, 0xec, 0x14, 0x79, 0x28, 0x16, 0x6e};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x72, 0x1b, 0xcc, 0xc7, 0x6b, 0x6e, 0x8d, 0x36, 0xb6, 0xe9,
                                     0x7e, 0x14, 0x9e, 0x70, 0x24, 0xdc, 0x15, 0x1d, 0x6d, 0x23};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x37, 0x6d, 0x0, 0x12, 0x63, 0x11, 0xfa, 0x85};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1e, 0x5c, 0x2f, 0xcb, 0x9c, 0xa3, 0xfc, 0x53, 0x2e, 0xae, 0xb1, 0x6b, 0x71, 0xe1,
                                     0x70, 0x94, 0xa3, 0x62, 0xf9, 0x93, 0x65, 0x2e, 0x4,  0x12, 0x6b, 0xce, 0xb1};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2f, 0x8,  0xb1, 0xcf, 0x5,  0xe5, 0x9d, 0x6b, 0xd4, 0xa,  0x67, 0xf7,
                                     0x13, 0xfa, 0x4b, 0x60, 0xca, 0x74, 0x4e, 0x70, 0xf9, 0xdf, 0x87};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x9d, 0xbb, 0xe6, 0xe5, 0xe0, 0xc4, 0x54};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xde, 0xa, 0xa5, 0xa5, 0xa9, 0x25, 0xcc, 0x2d,
                                     0x0,  0x2, 0xc0, 0x8f, 0x70, 0x34, 0xdd, 0x55};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xea, 0x9e, 0x78, 0x6f, 0x46, 0xd9, 0x1a, 0x80, 0x7e, 0xb8, 0xb};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa5, 0x29, 0x6e, 0x3a, 0xf2, 0x50, 0x5a, 0x40, 0xf4, 0x79,
                                     0x78, 0xff, 0x10, 0x66, 0x9b, 0xb7, 0xd,  0x1e, 0x64, 0xcf};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15521, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32751 [("\244p\172\184\198D\143w^DY=\SOH*\198Or\168\&2S\EOT\201F\221 ",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("6\131\253\146v\146O(\180\253\DC3\176\254\187\231\176\157\130\246\146rL\164\149i\255!",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("5\250\218p\241}\189\209\ESC6)\141\164(\SOH\213",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x4f, 0x7f, 0xef, 0x0,  0x19, 0xf4, 0x70, 0xac, 0xb8, 0xc6, 0x44, 0x8f, 0x77, 0x5e, 0x44, 0x59,
                   0x3d, 0x1,  0x2a, 0xc6, 0x4f, 0x72, 0xa8, 0x32, 0x53, 0x4,  0xc9, 0x46, 0xdd, 0x20, 0x2,  0x0,  0x1b,
                   0x36, 0x83, 0xfd, 0x92, 0x76, 0x92, 0x4f, 0x28, 0xb4, 0xfd, 0x13, 0xb0, 0xfe, 0xbb, 0xe7, 0xb0, 0x9d,
                   0x82, 0xf6, 0x92, 0x72, 0x4c, 0xa4, 0x95, 0x69, 0xff, 0x21, 0x1,  0x0,  0x10, 0x35, 0xfa, 0xda, 0x70,
                   0xf1, 0x7d, 0xbd, 0xd1, 0x1b, 0x36, 0x29, 0x8d, 0xa4, 0x28, 0x1,  0xd5, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0x70, 0xac, 0xb8, 0xc6, 0x44, 0x8f, 0x77, 0x5e, 0x44, 0x59, 0x3d, 0x1,
                                     0x2a, 0xc6, 0x4f, 0x72, 0xa8, 0x32, 0x53, 0x4,  0xc9, 0x46, 0xdd, 0x20};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x36, 0x83, 0xfd, 0x92, 0x76, 0x92, 0x4f, 0x28, 0xb4, 0xfd, 0x13, 0xb0, 0xfe, 0xbb,
                                     0xe7, 0xb0, 0x9d, 0x82, 0xf6, 0x92, 0x72, 0x4c, 0xa4, 0x95, 0x69, 0xff, 0x21};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0xfa, 0xda, 0x70, 0xf1, 0x7d, 0xbd, 0xd1,
                                     0x1b, 0x36, 0x29, 0x8d, 0xa4, 0x28, 0x1,  0xd5};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32751, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9203 [("\220\237
// \185\218f\186\169G-\SYNR\157\129k\146\142\187\249\223Vy\168X\214\209B\212\ETX\183",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("7t\b,\195X\ETB\163\b\239\189\161%<\186M\148Ge\DC1",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\214\204\149U\228E\GS\"\154\138tn6\214\212\252\GS\221\192",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\193\225~tM*M\ETX\160!",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("!\SI\216\183\f1\167N7\226\168",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\141\196\137sYG3\148\203O\177",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\n8\154\150]\ETX\218\235H",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x85, 0x1,  0x23, 0xf3, 0x0,  0x1e, 0xdc, 0xed, 0x20, 0xb9, 0xda, 0x66, 0xba, 0xa9, 0x47, 0x2d,
                   0x16, 0x52, 0x9d, 0x81, 0x6b, 0x92, 0x8e, 0xbb, 0xf9, 0xdf, 0x56, 0x79, 0xa8, 0x58, 0xd6, 0xd1, 0x42,
                   0xd4, 0x3,  0xb7, 0x2,  0x0,  0x14, 0x37, 0x74, 0x8,  0x2c, 0xc3, 0x58, 0x17, 0xa3, 0x8,  0xef, 0xbd,
                   0xa1, 0x25, 0x3c, 0xba, 0x4d, 0x94, 0x47, 0x65, 0x11, 0x1,  0x0,  0x13, 0xd6, 0xcc, 0x95, 0x55, 0xe4,
                   0x45, 0x1d, 0x22, 0x9a, 0x8a, 0x74, 0x6e, 0x36, 0xd6, 0xd4, 0xfc, 0x1d, 0xdd, 0xc0, 0x2,  0x0,  0xa,
                   0xc1, 0xe1, 0x7e, 0x74, 0x4d, 0x2a, 0x4d, 0x3,  0xa0, 0x21, 0x1,  0x0,  0xb,  0x21, 0xf,  0xd8, 0xb7,
                   0xc,  0x31, 0xa7, 0x4e, 0x37, 0xe2, 0xa8, 0x1,  0x0,  0xb,  0x8d, 0xc4, 0x89, 0x73, 0x59, 0x47, 0x33,
                   0x94, 0xcb, 0x4f, 0xb1, 0x1,  0x0,  0x9,  0xa,  0x38, 0x9a, 0x96, 0x5d, 0x3,  0xda, 0xeb, 0x48, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xdc, 0xed, 0x20, 0xb9, 0xda, 0x66, 0xba, 0xa9, 0x47, 0x2d,
                                     0x16, 0x52, 0x9d, 0x81, 0x6b, 0x92, 0x8e, 0xbb, 0xf9, 0xdf,
                                     0x56, 0x79, 0xa8, 0x58, 0xd6, 0xd1, 0x42, 0xd4, 0x3,  0xb7};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x37, 0x74, 0x8,  0x2c, 0xc3, 0x58, 0x17, 0xa3, 0x8,  0xef,
                                     0xbd, 0xa1, 0x25, 0x3c, 0xba, 0x4d, 0x94, 0x47, 0x65, 0x11};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd6, 0xcc, 0x95, 0x55, 0xe4, 0x45, 0x1d, 0x22, 0x9a, 0x8a,
                                     0x74, 0x6e, 0x36, 0xd6, 0xd4, 0xfc, 0x1d, 0xdd, 0xc0};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc1, 0xe1, 0x7e, 0x74, 0x4d, 0x2a, 0x4d, 0x3, 0xa0, 0x21};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x21, 0xf, 0xd8, 0xb7, 0xc, 0x31, 0xa7, 0x4e, 0x37, 0xe2, 0xa8};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8d, 0xc4, 0x89, 0x73, 0x59, 0x47, 0x33, 0x94, 0xcb, 0x4f, 0xb1};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa, 0x38, 0x9a, 0x96, 0x5d, 0x3, 0xda, 0xeb, 0x48};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9203, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7433 [("#\207",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\150",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\236",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\193\250\200\202",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\237c\182\248?\181\241\171\158",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\189A\203\SYNq\144\&2\237\196d\226s\192\SUB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("h\187\a\196\RS\\\235\216\SOH\fv3",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("/\185l>/\134\246\153\EOT\237\&5\v\213\STX\138\EOT\211a",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\DC4\STX\211\a-\145",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x60, 0x1d, 0x9,  0x0,  0x2,  0x23, 0xcf, 0x2,  0x0,  0x1,  0x96, 0x0,  0x0,  0x1,  0xec, 0x1,
                   0x0,  0x4,  0xc1, 0xfa, 0xc8, 0xca, 0x2,  0x0,  0x9,  0xed, 0x63, 0xb6, 0xf8, 0x3f, 0xb5, 0xf1, 0xab,
                   0x9e, 0x2,  0x0,  0xe,  0xbd, 0x41, 0xcb, 0x16, 0x71, 0x90, 0x32, 0xed, 0xc4, 0x64, 0xe2, 0x73, 0xc0,
                   0x1a, 0x2,  0x0,  0xc,  0x68, 0xbb, 0x7,  0xc4, 0x1e, 0x5c, 0xeb, 0xd8, 0x1,  0xc,  0x76, 0x33, 0x1,
                   0x0,  0x12, 0x2f, 0xb9, 0x6c, 0x3e, 0x2f, 0x86, 0xf6, 0x99, 0x4,  0xed, 0x35, 0xb,  0xd5, 0x2,  0x8a,
                   0x4,  0xd3, 0x61, 0x1,  0x0,  0x6,  0x14, 0x2,  0xd3, 0x7,  0x2d, 0x91, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x23, 0xcf};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x96};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc1, 0xfa, 0xc8, 0xca};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xed, 0x63, 0xb6, 0xf8, 0x3f, 0xb5, 0xf1, 0xab, 0x9e};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xbd, 0x41, 0xcb, 0x16, 0x71, 0x90, 0x32,
                                     0xed, 0xc4, 0x64, 0xe2, 0x73, 0xc0, 0x1a};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x68, 0xbb, 0x7, 0xc4, 0x1e, 0x5c, 0xeb, 0xd8, 0x1, 0xc, 0x76, 0x33};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2f, 0xb9, 0x6c, 0x3e, 0x2f, 0x86, 0xf6, 0x99, 0x4,
                                     0xed, 0x35, 0xb,  0xd5, 0x2,  0x8a, 0x4,  0xd3, 0x61};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x14, 0x2, 0xd3, 0x7, 0x2d, 0x91};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7433, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22949 [("\139\231\DC1\195J*\243\226Ip\ENQ\158\195U\254<t\142M\ESCR\174\147",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\220\US\SO\186.Z",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\168]5\214i\137\ETB`\249V\215\226k\244\245\213g&],",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("g\226\192\218XM\180T@\164{\ACK\ENQ\172\139\151\253\145\NUL}\138K@\EOT\147\169\160o",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("B\235#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS
// = QoS1}),("/`v\162\NUL\130$r\204\254\151\228\171\nhV\180)b\159D\183,g\ETB\202d\247",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x80, 0x1,  0x59, 0xa5, 0x0,  0x17, 0x8b, 0xe7, 0x11, 0xc3, 0x4a, 0x2a, 0xf3, 0xe2, 0x49, 0x70,
                   0x5,  0x9e, 0xc3, 0x55, 0xfe, 0x3c, 0x74, 0x8e, 0x4d, 0x1b, 0x52, 0xae, 0x93, 0x1,  0x0,  0x6,  0xdc,
                   0x1f, 0xe,  0xba, 0x2e, 0x5a, 0x0,  0x0,  0x14, 0xa8, 0x5d, 0x35, 0xd6, 0x69, 0x89, 0x17, 0x60, 0xf9,
                   0x56, 0xd7, 0xe2, 0x6b, 0xf4, 0xf5, 0xd5, 0x67, 0x26, 0x5d, 0x2c, 0x1,  0x0,  0x1c, 0x67, 0xe2, 0xc0,
                   0xda, 0x58, 0x4d, 0xb4, 0x54, 0x40, 0xa4, 0x7b, 0x6,  0x5,  0xac, 0x8b, 0x97, 0xfd, 0x91, 0x0,  0x7d,
                   0x8a, 0x4b, 0x40, 0x4,  0x93, 0xa9, 0xa0, 0x6f, 0x1,  0x0,  0x3,  0x42, 0xeb, 0x23, 0x1,  0x0,  0x1c,
                   0x2f, 0x60, 0x76, 0xa2, 0x0,  0x82, 0x24, 0x72, 0xcc, 0xfe, 0x97, 0xe4, 0xab, 0xa,  0x68, 0x56, 0xb4,
                   0x29, 0x62, 0x9f, 0x44, 0xb7, 0x2c, 0x67, 0x17, 0xca, 0x64, 0xf7, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x8b, 0xe7, 0x11, 0xc3, 0x4a, 0x2a, 0xf3, 0xe2, 0x49, 0x70, 0x5, 0x9e,
                                     0xc3, 0x55, 0xfe, 0x3c, 0x74, 0x8e, 0x4d, 0x1b, 0x52, 0xae, 0x93};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdc, 0x1f, 0xe, 0xba, 0x2e, 0x5a};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa8, 0x5d, 0x35, 0xd6, 0x69, 0x89, 0x17, 0x60, 0xf9, 0x56,
                                     0xd7, 0xe2, 0x6b, 0xf4, 0xf5, 0xd5, 0x67, 0x26, 0x5d, 0x2c};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x67, 0xe2, 0xc0, 0xda, 0x58, 0x4d, 0xb4, 0x54, 0x40, 0xa4,
                                     0x7b, 0x6,  0x5,  0xac, 0x8b, 0x97, 0xfd, 0x91, 0x0,  0x7d,
                                     0x8a, 0x4b, 0x40, 0x4,  0x93, 0xa9, 0xa0, 0x6f};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x42, 0xeb, 0x23};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2f, 0x60, 0x76, 0xa2, 0x0,  0x82, 0x24, 0x72, 0xcc, 0xfe,
                                     0x97, 0xe4, 0xab, 0xa,  0x68, 0x56, 0xb4, 0x29, 0x62, 0x9f,
                                     0x44, 0xb7, 0x2c, 0x67, 0x17, 0xca, 0x64, 0xf7};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22949, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26075 [("\230\RS\208\233^^\156",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("%\224",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("\243i\159\218$JV\134vJ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("Oq7\221\r\185\DC1\201\235\133\157\152",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("t\142\NAK)D\139\ENQ\188x\155mV\141\245\134\174\195\GS\187s\231\185\149\t\RSj\FS\NUL\165\217",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\229\234\&5\155\171\154\249^*-;",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS0}),("\241\207\171\132k\CAN+\160\ETB\231\144C\128\166\166ud\201\218Y?\218\161\&9",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0x77, 0x65, 0xdb, 0x0,  0x7,  0xe6, 0x1e, 0xd0, 0xe9, 0x5e, 0x5e, 0x9c, 0x2,  0x0,  0x2,
                   0x25, 0xe0, 0x1,  0x0,  0xa,  0xf3, 0x69, 0x9f, 0xda, 0x24, 0x4a, 0x56, 0x86, 0x76, 0x4a, 0x2,
                   0x0,  0xc,  0x4f, 0x71, 0x37, 0xdd, 0xd,  0xb9, 0x11, 0xc9, 0xeb, 0x85, 0x9d, 0x98, 0x1,  0x0,
                   0x1e, 0x74, 0x8e, 0x15, 0x29, 0x44, 0x8b, 0x5,  0xbc, 0x78, 0x9b, 0x6d, 0x56, 0x8d, 0xf5, 0x86,
                   0xae, 0xc3, 0x1d, 0xbb, 0x73, 0xe7, 0xb9, 0x95, 0x9,  0x1e, 0x6a, 0x1c, 0x0,  0xa5, 0xd9, 0x0,
                   0x0,  0xb,  0xe5, 0xea, 0x35, 0x9b, 0xab, 0x9a, 0xf9, 0x5e, 0x2a, 0x2d, 0x3b, 0x0,  0x0,  0x18,
                   0xf1, 0xcf, 0xab, 0x84, 0x6b, 0x18, 0x2b, 0xa0, 0x17, 0xe7, 0x90, 0x43, 0x80, 0xa6, 0xa6, 0x75,
                   0x64, 0xc9, 0xda, 0x59, 0x3f, 0xda, 0xa1, 0x39, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xe6, 0x1e, 0xd0, 0xe9, 0x5e, 0x5e, 0x9c};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x25, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf3, 0x69, 0x9f, 0xda, 0x24, 0x4a, 0x56, 0x86, 0x76, 0x4a};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4f, 0x71, 0x37, 0xdd, 0xd, 0xb9, 0x11, 0xc9, 0xeb, 0x85, 0x9d, 0x98};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x74, 0x8e, 0x15, 0x29, 0x44, 0x8b, 0x5,  0xbc, 0x78, 0x9b,
                                     0x6d, 0x56, 0x8d, 0xf5, 0x86, 0xae, 0xc3, 0x1d, 0xbb, 0x73,
                                     0xe7, 0xb9, 0x95, 0x9,  0x1e, 0x6a, 0x1c, 0x0,  0xa5, 0xd9};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe5, 0xea, 0x35, 0x9b, 0xab, 0x9a, 0xf9, 0x5e, 0x2a, 0x2d, 0x3b};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf1, 0xcf, 0xab, 0x84, 0x6b, 0x18, 0x2b, 0xa0, 0x17, 0xe7, 0x90, 0x43,
                                     0x80, 0xa6, 0xa6, 0x75, 0x64, 0xc9, 0xda, 0x59, 0x3f, 0xda, 0xa1, 0x39};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26075, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11400 [("\225\&5\173\150\r\146,\248\162\163Y\DEL2|\172\&5%\202\ACK4\172\NUL\167\172p/",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("v[\184U\225<\149\162t\132\235c\194O8\NUL\164\208\ACK_\146\239\233\159",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\197M\bsT\208[\175\238zW@\152\DC4\194)\219",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\t\SI\188\&6\206\242m\207[-]#\NAK\"\232\161\161\ACKh\181;\208",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\163q\148\190U\238\215\136r",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("\DLEsn\GS\187_\137\192\128\ETXz\ENQ\143\137\176U\183\158\ESC\174\213v\143\&9",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",\206\248\177)K$\154\&6,n\168?\245\208",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x2c, 0x88, 0x0,  0x1a, 0xe1, 0x35, 0xad, 0x96, 0xd,  0x92, 0x2c, 0xf8, 0xa2, 0xa3,
                   0x59, 0x7f, 0x32, 0x7c, 0xac, 0x35, 0x25, 0xca, 0x6,  0x34, 0xac, 0x0,  0xa7, 0xac, 0x70, 0x2f, 0x1,
                   0x0,  0x18, 0x76, 0x5b, 0xb8, 0x55, 0xe1, 0x3c, 0x95, 0xa2, 0x74, 0x84, 0xeb, 0x63, 0xc2, 0x4f, 0x38,
                   0x0,  0xa4, 0xd0, 0x6,  0x5f, 0x92, 0xef, 0xe9, 0x9f, 0x1,  0x0,  0x11, 0xc5, 0x4d, 0x8,  0x73, 0x54,
                   0xd0, 0x5b, 0xaf, 0xee, 0x7a, 0x57, 0x40, 0x98, 0x14, 0xc2, 0x29, 0xdb, 0x1,  0x0,  0x16, 0x9,  0xf,
                   0xbc, 0x36, 0xce, 0xf2, 0x6d, 0xcf, 0x5b, 0x2d, 0x5d, 0x23, 0x15, 0x22, 0xe8, 0xa1, 0xa1, 0x6,  0x68,
                   0xb5, 0x3b, 0xd0, 0x0,  0x0,  0x9,  0xa3, 0x71, 0x94, 0xbe, 0x55, 0xee, 0xd7, 0x88, 0x72, 0x1,  0x0,
                   0x18, 0x10, 0x73, 0x6e, 0x1d, 0xbb, 0x5f, 0x89, 0xc0, 0x80, 0x3,  0x7a, 0x5,  0x8f, 0x89, 0xb0, 0x55,
                   0xb7, 0x9e, 0x1b, 0xae, 0xd5, 0x76, 0x8f, 0x39, 0x0,  0x0,  0xf,  0x2c, 0xce, 0xf8, 0xb1, 0x29, 0x4b,
                   0x24, 0x9a, 0x36, 0x2c, 0x6e, 0xa8, 0x3f, 0xf5, 0xd0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xe1, 0x35, 0xad, 0x96, 0xd,  0x92, 0x2c, 0xf8, 0xa2, 0xa3, 0x59, 0x7f, 0x32,
                                     0x7c, 0xac, 0x35, 0x25, 0xca, 0x6,  0x34, 0xac, 0x0,  0xa7, 0xac, 0x70, 0x2f};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x76, 0x5b, 0xb8, 0x55, 0xe1, 0x3c, 0x95, 0xa2, 0x74, 0x84, 0xeb, 0x63,
                                     0xc2, 0x4f, 0x38, 0x0,  0xa4, 0xd0, 0x6,  0x5f, 0x92, 0xef, 0xe9, 0x9f};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc5, 0x4d, 0x8,  0x73, 0x54, 0xd0, 0x5b, 0xaf, 0xee,
                                     0x7a, 0x57, 0x40, 0x98, 0x14, 0xc2, 0x29, 0xdb};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9,  0xf,  0xbc, 0x36, 0xce, 0xf2, 0x6d, 0xcf, 0x5b, 0x2d, 0x5d,
                                     0x23, 0x15, 0x22, 0xe8, 0xa1, 0xa1, 0x6,  0x68, 0xb5, 0x3b, 0xd0};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa3, 0x71, 0x94, 0xbe, 0x55, 0xee, 0xd7, 0x88, 0x72};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x10, 0x73, 0x6e, 0x1d, 0xbb, 0x5f, 0x89, 0xc0, 0x80, 0x3,  0x7a, 0x5,
                                     0x8f, 0x89, 0xb0, 0x55, 0xb7, 0x9e, 0x1b, 0xae, 0xd5, 0x76, 0x8f, 0x39};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2c, 0xce, 0xf8, 0xb1, 0x29, 0x4b, 0x24, 0x9a,
                                     0x36, 0x2c, 0x6e, 0xa8, 0x3f, 0xf5, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11400, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30378 [("\197\180 ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("\222\170\NULu[\144\188\r\243\DC3\ETB\245:<^Y\247EW\176W\154\&9f\232\b\a\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),(".\147{<\247\180Q\202T.\f\185\134>\DC3n'T\FS\230\201\178}A",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),(">9d\234/%\170N&\242h\234\206\134\134",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("%\217\254\154\133h\199\ACKo%\128\253;_D\137\226\\\175\&9\138\&5\241B\a2\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\241\189ww\ETX\164\226",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("E\180D\152\180\232\246\212\187U\138\209\197\193\160\DC4\164j{\130\253\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\201mH\219\192\STX\SUB{H\142Q#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\213\210",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\ENQ]",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0xb1, 0x1,  0x76, 0xaa, 0x0,  0x3,  0xc5, 0xb4, 0x20, 0x2,  0x0,  0x1c, 0xde, 0xaa, 0x0,  0x75,
                   0x5b, 0x90, 0xbc, 0xd,  0xf3, 0x13, 0x17, 0xf5, 0x3a, 0x3c, 0x5e, 0x59, 0xf7, 0x45, 0x57, 0xb0, 0x57,
                   0x9a, 0x39, 0x66, 0xe8, 0x8,  0x7,  0x9b, 0x1,  0x0,  0x18, 0x2e, 0x93, 0x7b, 0x3c, 0xf7, 0xb4, 0x51,
                   0xca, 0x54, 0x2e, 0xc,  0xb9, 0x86, 0x3e, 0x13, 0x6e, 0x27, 0x54, 0x1c, 0xe6, 0xc9, 0xb2, 0x7d, 0x41,
                   0x2,  0x0,  0xf,  0x3e, 0x39, 0x64, 0xea, 0x2f, 0x25, 0xaa, 0x4e, 0x26, 0xf2, 0x68, 0xea, 0xce, 0x86,
                   0x86, 0x2,  0x0,  0x1b, 0x25, 0xd9, 0xfe, 0x9a, 0x85, 0x68, 0xc7, 0x6,  0x6f, 0x25, 0x80, 0xfd, 0x3b,
                   0x5f, 0x44, 0x89, 0xe2, 0x5c, 0xaf, 0x39, 0x8a, 0x35, 0xf1, 0x42, 0x7,  0x32, 0xd4, 0x2,  0x0,  0x0,
                   0x1,  0x0,  0x7,  0xf1, 0xbd, 0x77, 0x77, 0x3,  0xa4, 0xe2, 0x1,  0x0,  0x16, 0x45, 0xb4, 0x44, 0x98,
                   0xb4, 0xe8, 0xf6, 0xd4, 0xbb, 0x55, 0x8a, 0xd1, 0xc5, 0xc1, 0xa0, 0x14, 0xa4, 0x6a, 0x7b, 0x82, 0xfd,
                   0xaa, 0x1,  0x0,  0xc,  0xc9, 0x6d, 0x48, 0xdb, 0xc0, 0x2,  0x1a, 0x7b, 0x48, 0x8e, 0x51, 0x23, 0x0,
                   0x0,  0x2,  0xd5, 0xd2, 0x0,  0x0,  0x2,  0x5,  0x5d, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xc5, 0xb4, 0x20};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xde, 0xaa, 0x0,  0x75, 0x5b, 0x90, 0xbc, 0xd,  0xf3, 0x13,
                                     0x17, 0xf5, 0x3a, 0x3c, 0x5e, 0x59, 0xf7, 0x45, 0x57, 0xb0,
                                     0x57, 0x9a, 0x39, 0x66, 0xe8, 0x8,  0x7,  0x9b};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2e, 0x93, 0x7b, 0x3c, 0xf7, 0xb4, 0x51, 0xca, 0x54, 0x2e, 0xc,  0xb9,
                                     0x86, 0x3e, 0x13, 0x6e, 0x27, 0x54, 0x1c, 0xe6, 0xc9, 0xb2, 0x7d, 0x41};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3e, 0x39, 0x64, 0xea, 0x2f, 0x25, 0xaa, 0x4e,
                                     0x26, 0xf2, 0x68, 0xea, 0xce, 0x86, 0x86};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x25, 0xd9, 0xfe, 0x9a, 0x85, 0x68, 0xc7, 0x6,  0x6f, 0x25, 0x80, 0xfd, 0x3b, 0x5f,
                                     0x44, 0x89, 0xe2, 0x5c, 0xaf, 0x39, 0x8a, 0x35, 0xf1, 0x42, 0x7,  0x32, 0xd4};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf1, 0xbd, 0x77, 0x77, 0x3, 0xa4, 0xe2};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x45, 0xb4, 0x44, 0x98, 0xb4, 0xe8, 0xf6, 0xd4, 0xbb, 0x55, 0x8a,
                                     0xd1, 0xc5, 0xc1, 0xa0, 0x14, 0xa4, 0x6a, 0x7b, 0x82, 0xfd, 0xaa};
  lwmqtt_string_t topic_filter_s7 = {22, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc9, 0x6d, 0x48, 0xdb, 0xc0, 0x2, 0x1a, 0x7b, 0x48, 0x8e, 0x51, 0x23};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xd5, 0xd2};
  lwmqtt_string_t topic_filter_s9 = {2, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x5, 0x5d};
  lwmqtt_string_t topic_filter_s10 = {2, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30378, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19363 [("\171\&6)kL\250\200\246\241\214\221\252\198\159`\172N\210\247r\234Q1",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("5\204P\216\&3\131s\130<U\209a\136\183\131",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2}),("QU\168\SYN\199",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\247\236;\229\&9\133\173\208\213T\232\234%\SO\&H\157\193\247\173\DC3\162\CAN\215",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Lw\SOH\174\223\253}h",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\188\156\DLE\147\186;J\202<\236\229\171",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x6a, 0x4b, 0xa3, 0x0,  0x17, 0xab, 0x36, 0x29, 0x6b, 0x4c, 0xfa, 0xc8, 0xf6, 0xf1, 0xd6,
                   0xdd, 0xfc, 0xc6, 0x9f, 0x60, 0xac, 0x4e, 0xd2, 0xf7, 0x72, 0xea, 0x51, 0x31, 0x1,  0x0,  0xf,
                   0x35, 0xcc, 0x50, 0xd8, 0x33, 0x83, 0x73, 0x82, 0x3c, 0x55, 0xd1, 0x61, 0x88, 0xb7, 0x83, 0x2,
                   0x0,  0x5,  0x51, 0x55, 0xa8, 0x16, 0xc7, 0x1,  0x0,  0x17, 0xf7, 0xec, 0x3b, 0xe5, 0x39, 0x85,
                   0xad, 0xd0, 0xd5, 0x54, 0xe8, 0xea, 0x25, 0xe,  0x48, 0x9d, 0xc1, 0xf7, 0xad, 0x13, 0xa2, 0x18,
                   0xd7, 0x1,  0x0,  0x8,  0x4c, 0x77, 0x1,  0xae, 0xdf, 0xfd, 0x7d, 0x68, 0x1,  0x0,  0xc,  0xbc,
                   0x9c, 0x10, 0x93, 0xba, 0x3b, 0x4a, 0xca, 0x3c, 0xec, 0xe5, 0xab, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x36, 0x29, 0x6b, 0x4c, 0xfa, 0xc8, 0xf6, 0xf1, 0xd6, 0xdd, 0xfc,
                                     0xc6, 0x9f, 0x60, 0xac, 0x4e, 0xd2, 0xf7, 0x72, 0xea, 0x51, 0x31};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x35, 0xcc, 0x50, 0xd8, 0x33, 0x83, 0x73, 0x82,
                                     0x3c, 0x55, 0xd1, 0x61, 0x88, 0xb7, 0x83};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x51, 0x55, 0xa8, 0x16, 0xc7};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf7, 0xec, 0x3b, 0xe5, 0x39, 0x85, 0xad, 0xd0, 0xd5, 0x54, 0xe8, 0xea,
                                     0x25, 0xe,  0x48, 0x9d, 0xc1, 0xf7, 0xad, 0x13, 0xa2, 0x18, 0xd7};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4c, 0x77, 0x1, 0xae, 0xdf, 0xfd, 0x7d, 0x68};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xbc, 0x9c, 0x10, 0x93, 0xba, 0x3b, 0x4a, 0xca, 0x3c, 0xec, 0xe5, 0xab};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19363, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9790 [("\228F\148\174g\141\DC4\140\249o\196",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\177\151IY\145b\217z\r\205(B\253yT[~Z\183f\246^_IZ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\n\173\216\DC2G\235Y\189fi\DC1\185g\229\bEH\252F\242\216\ACK\231\243\237\242",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),(">A",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\163\133MU\FSV\131
// V\b\ESC\210U\147\&0ma\248",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\250.\ETBh\239;\217\248\159\219\202\SOH\FS\135\218 \219\&3\ENQ\153s\199",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\207\SI/?@\201.\216\171h\187\128\242o|\144\158z,W\207\136",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0x95, 0x1,  0x26, 0x3e, 0x0,  0xb,  0xe4, 0x46, 0x94, 0xae, 0x67, 0x8d, 0x14, 0x8c, 0xf9, 0x6f,
                   0xc4, 0x0,  0x0,  0x19, 0xb1, 0x97, 0x49, 0x59, 0x91, 0x62, 0xd9, 0x7a, 0xd,  0xcd, 0x28, 0x42, 0xfd,
                   0x79, 0x54, 0x5b, 0x7e, 0x5a, 0xb7, 0x66, 0xf6, 0x5e, 0x5f, 0x49, 0x5a, 0x0,  0x0,  0x1a, 0xa,  0xad,
                   0xd8, 0x12, 0x47, 0xeb, 0x59, 0xbd, 0x66, 0x69, 0x11, 0xb9, 0x67, 0xe5, 0x8,  0x45, 0x48, 0xfc, 0x46,
                   0xf2, 0xd8, 0x6,  0xe7, 0xf3, 0xed, 0xf2, 0x2,  0x0,  0x2,  0x3e, 0x41, 0x1,  0x0,  0x12, 0xa3, 0x85,
                   0x4d, 0x55, 0x1c, 0x56, 0x83, 0x20, 0x56, 0x8,  0x1b, 0xd2, 0x55, 0x93, 0x30, 0x6d, 0x61, 0xf8, 0x0,
                   0x0,  0x16, 0xfa, 0x2e, 0x17, 0x68, 0xef, 0x3b, 0xd9, 0xf8, 0x9f, 0xdb, 0xca, 0x1,  0x1c, 0x87, 0xda,
                   0x20, 0xdb, 0x33, 0x5,  0x99, 0x73, 0xc7, 0x2,  0x0,  0x16, 0xcf, 0xf,  0x2f, 0x3f, 0x40, 0xc9, 0x2e,
                   0xd8, 0xab, 0x68, 0xbb, 0x80, 0xf2, 0x6f, 0x7c, 0x90, 0x9e, 0x7a, 0x2c, 0x57, 0xcf, 0x88, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xe4, 0x46, 0x94, 0xae, 0x67, 0x8d, 0x14, 0x8c, 0xf9, 0x6f, 0xc4};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb1, 0x97, 0x49, 0x59, 0x91, 0x62, 0xd9, 0x7a, 0xd,  0xcd, 0x28, 0x42, 0xfd,
                                     0x79, 0x54, 0x5b, 0x7e, 0x5a, 0xb7, 0x66, 0xf6, 0x5e, 0x5f, 0x49, 0x5a};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa,  0xad, 0xd8, 0x12, 0x47, 0xeb, 0x59, 0xbd, 0x66, 0x69, 0x11, 0xb9, 0x67,
                                     0xe5, 0x8,  0x45, 0x48, 0xfc, 0x46, 0xf2, 0xd8, 0x6,  0xe7, 0xf3, 0xed, 0xf2};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3e, 0x41};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa3, 0x85, 0x4d, 0x55, 0x1c, 0x56, 0x83, 0x20, 0x56,
                                     0x8,  0x1b, 0xd2, 0x55, 0x93, 0x30, 0x6d, 0x61, 0xf8};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfa, 0x2e, 0x17, 0x68, 0xef, 0x3b, 0xd9, 0xf8, 0x9f, 0xdb, 0xca,
                                     0x1,  0x1c, 0x87, 0xda, 0x20, 0xdb, 0x33, 0x5,  0x99, 0x73, 0xc7};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xcf, 0xf,  0x2f, 0x3f, 0x40, 0xc9, 0x2e, 0xd8, 0xab, 0x68, 0xbb,
                                     0x80, 0xf2, 0x6f, 0x7c, 0x90, 0x9e, 0x7a, 0x2c, 0x57, 0xcf, 0x88};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9790, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29850 [("\ESC\148a",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("e\"\230B\SYNNm^{\160\218\FS\152\238\232\143\135\180\197\251D\202\205n\STX\161\f\175\165}",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("]\RS\172\169\198\239\243#\136\243\DC37n\177\215k\167\243",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Q\129=ls\SI\233\136\246\208\170\188\SUBg\134\155B",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("[=",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\174\230\194'q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\\%\201\190\183\&1\138\217=~\181c\233?\138\160X",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\SI\159f\134\CAN%\254\185\194T\216\145[\248\229\214>\170\216\164",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\164r\209\EOTC\218[-BMGq\236>M\194\139H\216\165:R\132t\179\224\157C\147%",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0xab, 0x1,  0x74, 0x9a, 0x0,  0x3,  0x1b, 0x94, 0x61, 0x2,  0x0,  0x1e, 0x65, 0x22, 0xe6,
                   0x42, 0x16, 0x4e, 0x6d, 0x5e, 0x7b, 0xa0, 0xda, 0x1c, 0x98, 0xee, 0xe8, 0x8f, 0x87, 0xb4, 0xc5,
                   0xfb, 0x44, 0xca, 0xcd, 0x6e, 0x2,  0xa1, 0xc,  0xaf, 0xa5, 0x7d, 0x0,  0x0,  0x12, 0x5d, 0x1e,
                   0xac, 0xa9, 0xc6, 0xef, 0xf3, 0x23, 0x88, 0xf3, 0x13, 0x37, 0x6e, 0xb1, 0xd7, 0x6b, 0xa7, 0xf3,
                   0x1,  0x0,  0x11, 0x51, 0x81, 0x3d, 0x6c, 0x73, 0xf,  0xe9, 0x88, 0xf6, 0xd0, 0xaa, 0xbc, 0x1a,
                   0x67, 0x86, 0x9b, 0x42, 0x0,  0x0,  0x2,  0x5b, 0x3d, 0x0,  0x0,  0x5,  0xae, 0xe6, 0xc2, 0x27,
                   0x71, 0x2,  0x0,  0x11, 0x5c, 0x25, 0xc9, 0xbe, 0xb7, 0x31, 0x8a, 0xd9, 0x3d, 0x7e, 0xb5, 0x63,
                   0xe9, 0x3f, 0x8a, 0xa0, 0x58, 0x1,  0x0,  0x14, 0xf,  0x9f, 0x66, 0x86, 0x18, 0x25, 0xfe, 0xb9,
                   0xc2, 0x54, 0xd8, 0x91, 0x5b, 0xf8, 0xe5, 0xd6, 0x3e, 0xaa, 0xd8, 0xa4, 0x1,  0x0,  0x1e, 0xa4,
                   0x72, 0xd1, 0x4,  0x43, 0xda, 0x5b, 0x2d, 0x42, 0x4d, 0x47, 0x71, 0xec, 0x3e, 0x4d, 0xc2, 0x8b,
                   0x48, 0xd8, 0xa5, 0x3a, 0x52, 0x84, 0x74, 0xb3, 0xe0, 0x9d, 0x43, 0x93, 0x25, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x1b, 0x94, 0x61};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x65, 0x22, 0xe6, 0x42, 0x16, 0x4e, 0x6d, 0x5e, 0x7b, 0xa0,
                                     0xda, 0x1c, 0x98, 0xee, 0xe8, 0x8f, 0x87, 0xb4, 0xc5, 0xfb,
                                     0x44, 0xca, 0xcd, 0x6e, 0x2,  0xa1, 0xc,  0xaf, 0xa5, 0x7d};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5d, 0x1e, 0xac, 0xa9, 0xc6, 0xef, 0xf3, 0x23, 0x88,
                                     0xf3, 0x13, 0x37, 0x6e, 0xb1, 0xd7, 0x6b, 0xa7, 0xf3};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x51, 0x81, 0x3d, 0x6c, 0x73, 0xf,  0xe9, 0x88, 0xf6,
                                     0xd0, 0xaa, 0xbc, 0x1a, 0x67, 0x86, 0x9b, 0x42};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5b, 0x3d};
  lwmqtt_string_t topic_filter_s4 = {2, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xae, 0xe6, 0xc2, 0x27, 0x71};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5c, 0x25, 0xc9, 0xbe, 0xb7, 0x31, 0x8a, 0xd9, 0x3d,
                                     0x7e, 0xb5, 0x63, 0xe9, 0x3f, 0x8a, 0xa0, 0x58};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf,  0x9f, 0x66, 0x86, 0x18, 0x25, 0xfe, 0xb9, 0xc2, 0x54,
                                     0xd8, 0x91, 0x5b, 0xf8, 0xe5, 0xd6, 0x3e, 0xaa, 0xd8, 0xa4};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa4, 0x72, 0xd1, 0x4,  0x43, 0xda, 0x5b, 0x2d, 0x42, 0x4d,
                                     0x47, 0x71, 0xec, 0x3e, 0x4d, 0xc2, 0x8b, 0x48, 0xd8, 0xa5,
                                     0x3a, 0x52, 0x84, 0x74, 0xb3, 0xe0, 0x9d, 0x43, 0x93, 0x25};
  lwmqtt_string_t topic_filter_s8 = {30, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29850, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18338 [("\162\249\GS\153yq\215F\221 \242",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\158\168o!e\ACK\247\202\128\152f\197m\\\176\247(\167\US\214\188ti\225\192",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0x2c, 0x47, 0xa2, 0x0,  0xb,  0xa2, 0xf9, 0x1d, 0x99, 0x79, 0x71, 0xd7, 0x46, 0xdd, 0x20,
                   0xf2, 0x0,  0x0,  0x19, 0x9e, 0xa8, 0x6f, 0x21, 0x65, 0x6,  0xf7, 0xca, 0x80, 0x98, 0x66, 0xc5,
                   0x6d, 0x5c, 0xb0, 0xf7, 0x28, 0xa7, 0x1f, 0xd6, 0xbc, 0x74, 0x69, 0xe1, 0xc0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xa2, 0xf9, 0x1d, 0x99, 0x79, 0x71, 0xd7, 0x46, 0xdd, 0x20, 0xf2};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9e, 0xa8, 0x6f, 0x21, 0x65, 0x6,  0xf7, 0xca, 0x80, 0x98, 0x66, 0xc5, 0x6d,
                                     0x5c, 0xb0, 0xf7, 0x28, 0xa7, 0x1f, 0xd6, 0xbc, 0x74, 0x69, 0xe1, 0xc0};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18338, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4108 [("\199\233\131\SYNf\210",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("j\199\156\237c\EMH\246\212\232\&7\217aJ\193/\r\253\246>\215\t\221",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("c\FSd\247?\136\249Y\DELc\167\ETX\185",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS1}),("\165\213\140\159\225\192\145\NAK$mr\141CDwEw\US\152\180\NAK\GSO\142\188r",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\162\247i\170\139\236sr-\177\215M3e\144\ETX3#\STX`s&\254i\233\179\128\142\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("[k\181}\136\187j<\FS\142\DC4\186\157\214\162",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\202\191;\254\&7%\136\210:\NAKeE\203\&0\DC1\nlG*@\183",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("X\134i\144\&7x\198",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\SO9;\183,",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SOJ\248\&8\219-jq\145\166\228\144\139\DC4M\SYN\245\220\150.\193K\178\&3\149\132D",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0xcf, 0x1,  0x10, 0xc,  0x0,  0x6,  0xc7, 0xe9, 0x83, 0x16, 0x66, 0xd2, 0x0,  0x0,  0x17, 0x6a,
                   0xc7, 0x9c, 0xed, 0x63, 0x19, 0x48, 0xf6, 0xd4, 0xe8, 0x37, 0xd9, 0x61, 0x4a, 0xc1, 0x2f, 0xd,  0xfd,
                   0xf6, 0x3e, 0xd7, 0x9,  0xdd, 0x0,  0x0,  0xd,  0x63, 0x1c, 0x64, 0xf7, 0x3f, 0x88, 0xf9, 0x59, 0x7f,
                   0x63, 0xa7, 0x3,  0xb9, 0x1,  0x0,  0x1a, 0xa5, 0xd5, 0x8c, 0x9f, 0xe1, 0xc0, 0x91, 0x15, 0x24, 0x6d,
                   0x72, 0x8d, 0x43, 0x44, 0x77, 0x45, 0x77, 0x1f, 0x98, 0xb4, 0x15, 0x1d, 0x4f, 0x8e, 0xbc, 0x72, 0x2,
                   0x0,  0x1d, 0xa2, 0xf7, 0x69, 0xaa, 0x8b, 0xec, 0x73, 0x72, 0x2d, 0xb1, 0xd7, 0x4d, 0x33, 0x65, 0x90,
                   0x3,  0x33, 0x23, 0x2,  0x60, 0x73, 0x26, 0xfe, 0x69, 0xe9, 0xb3, 0x80, 0x8e, 0xf,  0x1,  0x0,  0xf,
                   0x5b, 0x6b, 0xb5, 0x7d, 0x88, 0xbb, 0x6a, 0x3c, 0x1c, 0x8e, 0x14, 0xba, 0x9d, 0xd6, 0xa2, 0x2,  0x0,
                   0x15, 0xca, 0xbf, 0x3b, 0xfe, 0x37, 0x25, 0x88, 0xd2, 0x3a, 0x15, 0x65, 0x45, 0xcb, 0x30, 0x11, 0xa,
                   0x6c, 0x47, 0x2a, 0x40, 0xb7, 0x1,  0x0,  0x7,  0x58, 0x86, 0x69, 0x90, 0x37, 0x78, 0xc6, 0x2,  0x0,
                   0x5,  0xe,  0x39, 0x3b, 0xb7, 0x2c, 0x2,  0x0,  0x1b, 0xe,  0x4a, 0xf8, 0x38, 0xdb, 0x2d, 0x6a, 0x71,
                   0x91, 0xa6, 0xe4, 0x90, 0x8b, 0x14, 0x4d, 0x16, 0xf5, 0xdc, 0x96, 0x2e, 0xc1, 0x4b, 0xb2, 0x33, 0x95,
                   0x84, 0x44, 0x0,  0x0,  0x0,  0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xc7, 0xe9, 0x83, 0x16, 0x66, 0xd2};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0xc7, 0x9c, 0xed, 0x63, 0x19, 0x48, 0xf6, 0xd4, 0xe8, 0x37, 0xd9,
                                     0x61, 0x4a, 0xc1, 0x2f, 0xd,  0xfd, 0xf6, 0x3e, 0xd7, 0x9,  0xdd};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x63, 0x1c, 0x64, 0xf7, 0x3f, 0x88, 0xf9, 0x59, 0x7f, 0x63, 0xa7, 0x3, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa5, 0xd5, 0x8c, 0x9f, 0xe1, 0xc0, 0x91, 0x15, 0x24, 0x6d, 0x72, 0x8d, 0x43,
                                     0x44, 0x77, 0x45, 0x77, 0x1f, 0x98, 0xb4, 0x15, 0x1d, 0x4f, 0x8e, 0xbc, 0x72};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa2, 0xf7, 0x69, 0xaa, 0x8b, 0xec, 0x73, 0x72, 0x2d, 0xb1,
                                     0xd7, 0x4d, 0x33, 0x65, 0x90, 0x3,  0x33, 0x23, 0x2,  0x60,
                                     0x73, 0x26, 0xfe, 0x69, 0xe9, 0xb3, 0x80, 0x8e, 0xf};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5b, 0x6b, 0xb5, 0x7d, 0x88, 0xbb, 0x6a, 0x3c,
                                     0x1c, 0x8e, 0x14, 0xba, 0x9d, 0xd6, 0xa2};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xca, 0xbf, 0x3b, 0xfe, 0x37, 0x25, 0x88, 0xd2, 0x3a, 0x15, 0x65,
                                     0x45, 0xcb, 0x30, 0x11, 0xa,  0x6c, 0x47, 0x2a, 0x40, 0xb7};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x58, 0x86, 0x69, 0x90, 0x37, 0x78, 0xc6};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe, 0x39, 0x3b, 0xb7, 0x2c};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe,  0x4a, 0xf8, 0x38, 0xdb, 0x2d, 0x6a, 0x71, 0x91, 0xa6, 0xe4, 0x90, 0x8b, 0x14,
                                     0x4d, 0x16, 0xf5, 0xdc, 0x96, 0x2e, 0xc1, 0x4b, 0xb2, 0x33, 0x95, 0x84, 0x44};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4108, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28646 [("\224\NAK[\140\150Pw\230\154\136,A\236+U\195sv\137 \161\251K",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\177\&6\255\208\&6s5\196\213\&7\242\172\v?\226_} r2\ENQB\225\136",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),(",\181T\ETX\169&\SOH",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\231\185\DC3\162h\140[&\152A\151\t\128\157\a\143S",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("f\169\228\149VWZ\202B'\230\219\143j\160GJ\187+\175\248;K\185",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("`\ENQ\147P\ESC\152\157\138\168Qq\215\230\199\235I2[",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("X\148:\ENQ\215R\184\152\ACK\221\250\194\185W\248\155\FSI\t\132\251\148\146",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("v\189",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\145\160\130/\197z\202\198Uyv",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\176Xe",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\DC4\\d\168\230N\241",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0xc2, 0x1,  0x6f, 0xe6, 0x0,  0x17, 0xe0, 0x15, 0x5b, 0x8c, 0x96, 0x50, 0x77, 0xe6, 0x9a, 0x88,
                   0x2c, 0x41, 0xec, 0x2b, 0x55, 0xc3, 0x73, 0x76, 0x89, 0x20, 0xa1, 0xfb, 0x4b, 0x2,  0x0,  0x18, 0xb1,
                   0x36, 0xff, 0xd0, 0x36, 0x73, 0x35, 0xc4, 0xd5, 0x37, 0xf2, 0xac, 0xb,  0x3f, 0xe2, 0x5f, 0x7d, 0x20,
                   0x72, 0x32, 0x5,  0x42, 0xe1, 0x88, 0x2,  0x0,  0x7,  0x2c, 0xb5, 0x54, 0x3,  0xa9, 0x26, 0x1,  0x0,
                   0x0,  0x11, 0xe7, 0xb9, 0x13, 0xa2, 0x68, 0x8c, 0x5b, 0x26, 0x98, 0x41, 0x97, 0x9,  0x80, 0x9d, 0x7,
                   0x8f, 0x53, 0x0,  0x0,  0x18, 0x66, 0xa9, 0xe4, 0x95, 0x56, 0x57, 0x5a, 0xca, 0x42, 0x27, 0xe6, 0xdb,
                   0x8f, 0x6a, 0xa0, 0x47, 0x4a, 0xbb, 0x2b, 0xaf, 0xf8, 0x3b, 0x4b, 0xb9, 0x0,  0x0,  0x12, 0x60, 0x5,
                   0x93, 0x50, 0x1b, 0x98, 0x9d, 0x8a, 0xa8, 0x51, 0x71, 0xd7, 0xe6, 0xc7, 0xeb, 0x49, 0x32, 0x5b, 0x2,
                   0x0,  0x17, 0x58, 0x94, 0x3a, 0x5,  0xd7, 0x52, 0xb8, 0x98, 0x6,  0xdd, 0xfa, 0xc2, 0xb9, 0x57, 0xf8,
                   0x9b, 0x1c, 0x49, 0x9,  0x84, 0xfb, 0x94, 0x92, 0x0,  0x0,  0x2,  0x76, 0xbd, 0x2,  0x0,  0xb,  0x91,
                   0xa0, 0x82, 0x2f, 0xc5, 0x7a, 0xca, 0xc6, 0x55, 0x79, 0x76, 0x2,  0x0,  0x3,  0xb0, 0x58, 0x65, 0x2,
                   0x0,  0x7,  0x14, 0x5c, 0x64, 0xa8, 0xe6, 0x4e, 0xf1, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xe0, 0x15, 0x5b, 0x8c, 0x96, 0x50, 0x77, 0xe6, 0x9a, 0x88, 0x2c, 0x41,
                                     0xec, 0x2b, 0x55, 0xc3, 0x73, 0x76, 0x89, 0x20, 0xa1, 0xfb, 0x4b};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb1, 0x36, 0xff, 0xd0, 0x36, 0x73, 0x35, 0xc4, 0xd5, 0x37, 0xf2, 0xac,
                                     0xb,  0x3f, 0xe2, 0x5f, 0x7d, 0x20, 0x72, 0x32, 0x5,  0x42, 0xe1, 0x88};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2c, 0xb5, 0x54, 0x3, 0xa9, 0x26, 0x1};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe7, 0xb9, 0x13, 0xa2, 0x68, 0x8c, 0x5b, 0x26, 0x98,
                                     0x41, 0x97, 0x9,  0x80, 0x9d, 0x7,  0x8f, 0x53};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x66, 0xa9, 0xe4, 0x95, 0x56, 0x57, 0x5a, 0xca, 0x42, 0x27, 0xe6, 0xdb,
                                     0x8f, 0x6a, 0xa0, 0x47, 0x4a, 0xbb, 0x2b, 0xaf, 0xf8, 0x3b, 0x4b, 0xb9};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x60, 0x5,  0x93, 0x50, 0x1b, 0x98, 0x9d, 0x8a, 0xa8,
                                     0x51, 0x71, 0xd7, 0xe6, 0xc7, 0xeb, 0x49, 0x32, 0x5b};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x58, 0x94, 0x3a, 0x5,  0xd7, 0x52, 0xb8, 0x98, 0x6,  0xdd, 0xfa, 0xc2,
                                     0xb9, 0x57, 0xf8, 0x9b, 0x1c, 0x49, 0x9,  0x84, 0xfb, 0x94, 0x92};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x76, 0xbd};
  lwmqtt_string_t topic_filter_s7 = {2, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x91, 0xa0, 0x82, 0x2f, 0xc5, 0x7a, 0xca, 0xc6, 0x55, 0x79, 0x76};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xb0, 0x58, 0x65};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x14, 0x5c, 0x64, 0xa8, 0xe6, 0x4e, 0xf1};
  lwmqtt_string_t topic_filter_s10 = {7, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28646, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31174 [(":\243\230#\164\248!\232\150\150+\138m\198\212\"\193f\129\SOH}K\195\171\150",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("4`MS\232\255\169oP\EOT\RS\198P\250r2\135\v\183FW\STX)\173",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("K\167{\179J\RS\NAK3=*T4\208*\145\228\198h\252\246\248\a",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\ETB\245\174A\225F\225\216j\197\147B\t\254\132\216\164\205\150K$\164lT\ETX\212mRv",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\180Sg\a&R\165\162\174g\178\253\GS*\197i\USu_&\229\201\131d\169\231@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\184l\ETX\225\&2\130\189\132\DC22N9\214\175@\197M\241/X#\ACKQ0\250q\DC4\r",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\253C7\NAK\203#\170",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\133\213\133\SUB\235\254\194\&5\223\143\241-\SUB\177n\233\211{\FSE",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0xd3, 0x1,  0x79, 0xc6, 0x0,  0x19, 0x3a, 0xf3, 0xe6, 0x23, 0xa4, 0xf8, 0x21, 0xe8, 0x96, 0x96,
                   0x2b, 0x8a, 0x6d, 0xc6, 0xd4, 0x22, 0xc1, 0x66, 0x81, 0x1,  0x7d, 0x4b, 0xc3, 0xab, 0x96, 0x2,  0x0,
                   0x18, 0x34, 0x60, 0x4d, 0x53, 0xe8, 0xff, 0xa9, 0x6f, 0x50, 0x4,  0x1e, 0xc6, 0x50, 0xfa, 0x72, 0x32,
                   0x87, 0xb,  0xb7, 0x46, 0x57, 0x2,  0x29, 0xad, 0x2,  0x0,  0x16, 0x4b, 0xa7, 0x7b, 0xb3, 0x4a, 0x1e,
                   0x15, 0x33, 0x3d, 0x2a, 0x54, 0x34, 0xd0, 0x2a, 0x91, 0xe4, 0xc6, 0x68, 0xfc, 0xf6, 0xf8, 0x7,  0x0,
                   0x0,  0x1d, 0x17, 0xf5, 0xae, 0x41, 0xe1, 0x46, 0xe1, 0xd8, 0x6a, 0xc5, 0x93, 0x42, 0x9,  0xfe, 0x84,
                   0xd8, 0xa4, 0xcd, 0x96, 0x4b, 0x24, 0xa4, 0x6c, 0x54, 0x3,  0xd4, 0x6d, 0x52, 0x76, 0x2,  0x0,  0x1b,
                   0xb4, 0x53, 0x67, 0x7,  0x26, 0x52, 0xa5, 0xa2, 0xae, 0x67, 0xb2, 0xfd, 0x1d, 0x2a, 0xc5, 0x69, 0x1f,
                   0x75, 0x5f, 0x26, 0xe5, 0xc9, 0x83, 0x64, 0xa9, 0xe7, 0x40, 0x0,  0x0,  0x0,  0x1,  0x0,  0x1c, 0xb8,
                   0x6c, 0x3,  0xe1, 0x32, 0x82, 0xbd, 0x84, 0x12, 0x32, 0x4e, 0x39, 0xd6, 0xaf, 0x40, 0xc5, 0x4d, 0xf1,
                   0x2f, 0x58, 0x23, 0x6,  0x51, 0x30, 0xfa, 0x71, 0x14, 0xd,  0x0,  0x0,  0x7,  0xfd, 0x43, 0x37, 0x15,
                   0xcb, 0x23, 0xaa, 0x0,  0x0,  0x14, 0x85, 0xd5, 0x85, 0x1a, 0xeb, 0xfe, 0xc2, 0x35, 0xdf, 0x8f, 0xf1,
                   0x2d, 0x1a, 0xb1, 0x6e, 0xe9, 0xd3, 0x7b, 0x1c, 0x45, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x3a, 0xf3, 0xe6, 0x23, 0xa4, 0xf8, 0x21, 0xe8, 0x96, 0x96, 0x2b, 0x8a, 0x6d,
                                     0xc6, 0xd4, 0x22, 0xc1, 0x66, 0x81, 0x1,  0x7d, 0x4b, 0xc3, 0xab, 0x96};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x34, 0x60, 0x4d, 0x53, 0xe8, 0xff, 0xa9, 0x6f, 0x50, 0x4, 0x1e, 0xc6,
                                     0x50, 0xfa, 0x72, 0x32, 0x87, 0xb,  0xb7, 0x46, 0x57, 0x2, 0x29, 0xad};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4b, 0xa7, 0x7b, 0xb3, 0x4a, 0x1e, 0x15, 0x33, 0x3d, 0x2a, 0x54,
                                     0x34, 0xd0, 0x2a, 0x91, 0xe4, 0xc6, 0x68, 0xfc, 0xf6, 0xf8, 0x7};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x17, 0xf5, 0xae, 0x41, 0xe1, 0x46, 0xe1, 0xd8, 0x6a, 0xc5,
                                     0x93, 0x42, 0x9,  0xfe, 0x84, 0xd8, 0xa4, 0xcd, 0x96, 0x4b,
                                     0x24, 0xa4, 0x6c, 0x54, 0x3,  0xd4, 0x6d, 0x52, 0x76};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb4, 0x53, 0x67, 0x7,  0x26, 0x52, 0xa5, 0xa2, 0xae, 0x67, 0xb2, 0xfd, 0x1d, 0x2a,
                                     0xc5, 0x69, 0x1f, 0x75, 0x5f, 0x26, 0xe5, 0xc9, 0x83, 0x64, 0xa9, 0xe7, 0x40};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb8, 0x6c, 0x3,  0xe1, 0x32, 0x82, 0xbd, 0x84, 0x12, 0x32, 0x4e, 0x39, 0xd6, 0xaf,
                                     0x40, 0xc5, 0x4d, 0xf1, 0x2f, 0x58, 0x23, 0x6,  0x51, 0x30, 0xfa, 0x71, 0x14, 0xd};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfd, 0x43, 0x37, 0x15, 0xcb, 0x23, 0xaa};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x85, 0xd5, 0x85, 0x1a, 0xeb, 0xfe, 0xc2, 0x35, 0xdf, 0x8f,
                                     0xf1, 0x2d, 0x1a, 0xb1, 0x6e, 0xe9, 0xd3, 0x7b, 0x1c, 0x45};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 31174, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2900 [("\249J\154\194\178Mb\255\165\234\213K\141%\167\ESC\151\152\176\236\214",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("7\144\f>\ACKS$|\SI",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("!",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS =
// QoS2}),("v\150\SO\163x\160B\220\209E<o\207\211\252\SOH\128\152\226O\212\208\v\SUB\DEL}\172%]",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x4a, 0xb,  0x54, 0x0,  0x15, 0xf9, 0x4a, 0x9a, 0xc2, 0xb2, 0x4d, 0x62, 0xff, 0xa5, 0xea,
                   0xd5, 0x4b, 0x8d, 0x25, 0xa7, 0x1b, 0x97, 0x98, 0xb0, 0xec, 0xd6, 0x2,  0x0,  0x9,  0x37, 0x90,
                   0xc,  0x3e, 0x6,  0x53, 0x24, 0x7c, 0xf,  0x1,  0x0,  0x1,  0x21, 0x2,  0x0,  0x1d, 0x76, 0x96,
                   0xe,  0xa3, 0x78, 0xa0, 0x42, 0xdc, 0xd1, 0x45, 0x3c, 0x6f, 0xcf, 0xd3, 0xfc, 0x1,  0x80, 0x98,
                   0xe2, 0x4f, 0xd4, 0xd0, 0xb,  0x1a, 0x7f, 0x7d, 0xac, 0x25, 0x5d, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xf9, 0x4a, 0x9a, 0xc2, 0xb2, 0x4d, 0x62, 0xff, 0xa5, 0xea, 0xd5,
                                     0x4b, 0x8d, 0x25, 0xa7, 0x1b, 0x97, 0x98, 0xb0, 0xec, 0xd6};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x37, 0x90, 0xc, 0x3e, 0x6, 0x53, 0x24, 0x7c, 0xf};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x21};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x76, 0x96, 0xe,  0xa3, 0x78, 0xa0, 0x42, 0xdc, 0xd1, 0x45,
                                     0x3c, 0x6f, 0xcf, 0xd3, 0xfc, 0x1,  0x80, 0x98, 0xe2, 0x4f,
                                     0xd4, 0xd0, 0xb,  0x1a, 0x7f, 0x7d, 0xac, 0x25, 0x5d};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2900, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5776 [("\160\209\185JP\212 \215s\195C\191\159\167\NUL\v%\162\200\178l\239\244\142zm\213",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\f\211)\132\193l",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\183}i",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("I\255\240\EOT\FS\132\DLE\191",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\151\170{\nFo\152H.M]s3\DC4\223",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("z\STX\204\&4\191",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\v\163\155\DC2\221\212\SYN\180W\148:+m",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\157\DC2a\"\225`\227%\238\227\162\&7\170\215\&5[",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("0\157\235\244iL@\234\177H<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\ESCs\v|\SOH.\171\GS\STXj\GSA@\186\134\165\204\CAN\154@\DC3\152",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0x9e, 0x1,  0x16, 0x90, 0x0,  0x1b, 0xa0, 0xd1, 0xb9, 0x4a, 0x50, 0xd4, 0x20, 0xd7, 0x73, 0xc3,
                   0x43, 0xbf, 0x9f, 0xa7, 0x0,  0xb,  0x25, 0xa2, 0xc8, 0xb2, 0x6c, 0xef, 0xf4, 0x8e, 0x7a, 0x6d, 0xd5,
                   0x1,  0x0,  0x6,  0xc,  0xd3, 0x29, 0x84, 0xc1, 0x6c, 0x0,  0x0,  0x3,  0xb7, 0x7d, 0x69, 0x0,  0x0,
                   0x8,  0x49, 0xff, 0xf0, 0x4,  0x1c, 0x84, 0x10, 0xbf, 0x0,  0x0,  0xf,  0x97, 0xaa, 0x7b, 0xa,  0x46,
                   0x6f, 0x98, 0x48, 0x2e, 0x4d, 0x5d, 0x73, 0x33, 0x14, 0xdf, 0x2,  0x0,  0x5,  0x7a, 0x2,  0xcc, 0x34,
                   0xbf, 0x2,  0x0,  0xd,  0xb,  0xa3, 0x9b, 0x12, 0xdd, 0xd4, 0x16, 0xb4, 0x57, 0x94, 0x3a, 0x2b, 0x6d,
                   0x2,  0x0,  0x10, 0x9d, 0x12, 0x61, 0x22, 0xe1, 0x60, 0xe3, 0x25, 0xee, 0xe3, 0xa2, 0x37, 0xaa, 0xd7,
                   0x35, 0x5b, 0x2,  0x0,  0xb,  0x30, 0x9d, 0xeb, 0xf4, 0x69, 0x4c, 0x40, 0xea, 0xb1, 0x48, 0x3c, 0x1,
                   0x0,  0x16, 0x1b, 0x73, 0xb,  0x7c, 0x1,  0x2e, 0xab, 0x1d, 0x2,  0x6a, 0x1d, 0x41, 0x40, 0xba, 0x86,
                   0xa5, 0xcc, 0x18, 0x9a, 0x40, 0x13, 0x98, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xa0, 0xd1, 0xb9, 0x4a, 0x50, 0xd4, 0x20, 0xd7, 0x73, 0xc3, 0x43, 0xbf, 0x9f, 0xa7,
                                     0x0,  0xb,  0x25, 0xa2, 0xc8, 0xb2, 0x6c, 0xef, 0xf4, 0x8e, 0x7a, 0x6d, 0xd5};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc, 0xd3, 0x29, 0x84, 0xc1, 0x6c};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb7, 0x7d, 0x69};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x49, 0xff, 0xf0, 0x4, 0x1c, 0x84, 0x10, 0xbf};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x97, 0xaa, 0x7b, 0xa,  0x46, 0x6f, 0x98, 0x48,
                                     0x2e, 0x4d, 0x5d, 0x73, 0x33, 0x14, 0xdf};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7a, 0x2, 0xcc, 0x34, 0xbf};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb, 0xa3, 0x9b, 0x12, 0xdd, 0xd4, 0x16, 0xb4, 0x57, 0x94, 0x3a, 0x2b, 0x6d};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x9d, 0x12, 0x61, 0x22, 0xe1, 0x60, 0xe3, 0x25,
                                     0xee, 0xe3, 0xa2, 0x37, 0xaa, 0xd7, 0x35, 0x5b};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x30, 0x9d, 0xeb, 0xf4, 0x69, 0x4c, 0x40, 0xea, 0xb1, 0x48, 0x3c};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x1b, 0x73, 0xb,  0x7c, 0x1,  0x2e, 0xab, 0x1d, 0x2,  0x6a, 0x1d,
                                     0x41, 0x40, 0xba, 0x86, 0xa5, 0xcc, 0x18, 0x9a, 0x40, 0x13, 0x98};
  lwmqtt_string_t topic_filter_s9 = {22, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5776, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24276 [("\179\243\204\239\187M$\198\241*\231z\ENQ`Xu",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("kw\176}\238\r\199B\189\178D\179)\vd\"\n\SO\&HUl",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0x2d, 0x5e, 0xd4, 0x0,  0x10, 0xb3, 0xf3, 0xcc, 0xef, 0xbb, 0x4d, 0x24, 0xc6, 0xf1, 0x2a,
                   0xe7, 0x7a, 0x5,  0x60, 0x58, 0x75, 0x2,  0x0,  0x15, 0x6b, 0x77, 0xb0, 0x7d, 0xee, 0xd,  0xc7,
                   0x42, 0xbd, 0xb2, 0x44, 0xb3, 0x29, 0xb,  0x64, 0x22, 0xa,  0xe,  0x48, 0x55, 0x6c, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xb3, 0xf3, 0xcc, 0xef, 0xbb, 0x4d, 0x24, 0xc6,
                                     0xf1, 0x2a, 0xe7, 0x7a, 0x5,  0x60, 0x58, 0x75};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6b, 0x77, 0xb0, 0x7d, 0xee, 0xd, 0xc7, 0x42, 0xbd, 0xb2, 0x44,
                                     0xb3, 0x29, 0xb,  0x64, 0x22, 0xa, 0xe,  0x48, 0x55, 0x6c};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24276, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17953 [("\230\CAN\157,Q",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("W",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("1/\218k\SOH\193\234\176zfB\215\166+\DC1Rzc",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("?N\223\&4<\167\174\222\&4",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("\237\v\239\243\170\&0\135\144\178*\146\194if\US\203\&9'\172\166|\128\129m\188|l\141i\164",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\238\232\v\ENQ
// \239\SOH\149\159P",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\191\217\139T!It\188\RS\EM\246\171\172\134u\234\170\168R\185\139\229\ESC",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("{\186\SIi\DLE\171\225\241\&6",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\166",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("~J\231\169\143\142y\137\254m\135\249\196X\DC4J",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0x9d, 0x1,  0x46, 0x21, 0x0,  0x5,  0xe6, 0x18, 0x9d, 0x2c, 0x51, 0x2,  0x0,  0x1,  0x57,
                   0x1,  0x0,  0x12, 0x31, 0x2f, 0xda, 0x6b, 0x1,  0xc1, 0xea, 0xb0, 0x7a, 0x66, 0x42, 0xd7, 0xa6,
                   0x2b, 0x11, 0x52, 0x7a, 0x63, 0x2,  0x0,  0x9,  0x3f, 0x4e, 0xdf, 0x34, 0x3c, 0xa7, 0xae, 0xde,
                   0x34, 0x1,  0x0,  0x1e, 0xed, 0xb,  0xef, 0xf3, 0xaa, 0x30, 0x87, 0x90, 0xb2, 0x2a, 0x92, 0xc2,
                   0x69, 0x66, 0x1f, 0xcb, 0x39, 0x27, 0xac, 0xa6, 0x7c, 0x80, 0x81, 0x6d, 0xbc, 0x7c, 0x6c, 0x8d,
                   0x69, 0xa4, 0x0,  0x0,  0xa,  0xee, 0xe8, 0xb,  0x5,  0x20, 0xef, 0x1,  0x95, 0x9f, 0x50, 0x1,
                   0x0,  0x17, 0xbf, 0xd9, 0x8b, 0x54, 0x21, 0x49, 0x74, 0xbc, 0x1e, 0x19, 0xf6, 0xab, 0xac, 0x86,
                   0x75, 0xea, 0xaa, 0xa8, 0x52, 0xb9, 0x8b, 0xe5, 0x1b, 0x1,  0x0,  0x9,  0x7b, 0xba, 0xf,  0x69,
                   0x10, 0xab, 0xe1, 0xf1, 0x36, 0x2,  0x0,  0x1,  0xa6, 0x0,  0x0,  0x0,  0x2,  0x0,  0x10, 0x7e,
                   0x4a, 0xe7, 0xa9, 0x8f, 0x8e, 0x79, 0x89, 0xfe, 0x6d, 0x87, 0xf9, 0xc4, 0x58, 0x14, 0x4a, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xe6, 0x18, 0x9d, 0x2c, 0x51};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x57};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x31, 0x2f, 0xda, 0x6b, 0x1,  0xc1, 0xea, 0xb0, 0x7a,
                                     0x66, 0x42, 0xd7, 0xa6, 0x2b, 0x11, 0x52, 0x7a, 0x63};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3f, 0x4e, 0xdf, 0x34, 0x3c, 0xa7, 0xae, 0xde, 0x34};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xed, 0xb,  0xef, 0xf3, 0xaa, 0x30, 0x87, 0x90, 0xb2, 0x2a,
                                     0x92, 0xc2, 0x69, 0x66, 0x1f, 0xcb, 0x39, 0x27, 0xac, 0xa6,
                                     0x7c, 0x80, 0x81, 0x6d, 0xbc, 0x7c, 0x6c, 0x8d, 0x69, 0xa4};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xee, 0xe8, 0xb, 0x5, 0x20, 0xef, 0x1, 0x95, 0x9f, 0x50};
  lwmqtt_string_t topic_filter_s5 = {10, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbf, 0xd9, 0x8b, 0x54, 0x21, 0x49, 0x74, 0xbc, 0x1e, 0x19, 0xf6, 0xab,
                                     0xac, 0x86, 0x75, 0xea, 0xaa, 0xa8, 0x52, 0xb9, 0x8b, 0xe5, 0x1b};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7b, 0xba, 0xf, 0x69, 0x10, 0xab, 0xe1, 0xf1, 0x36};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa6};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0};
  lwmqtt_string_t topic_filter_s9 = {0, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x7e, 0x4a, 0xe7, 0xa9, 0x8f, 0x8e, 0x79, 0x89,
                                      0xfe, 0x6d, 0x87, 0xf9, 0xc4, 0x58, 0x14, 0x4a};
  lwmqtt_string_t topic_filter_s10 = {16, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17953, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26518 [("\NULJ\205v\253\154",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("j\182X\235\201r\170\214\STX\134\241\201\150\253\226\SYN",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("ap\232$>@\178\148\vR\208\227\232\190\&0*N>\US\202\188",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("+b\142\ETB/\213xA\202y\175i)\183\171\142Yw_\228\&2\170\156 \129",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("A\187\CAN\243\184\211b\170\231tK\171\170R\216Gw\149<Q\151\fZ\134\213",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\239",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\204\&7}q)9\NUL\STX@\169Q\193\208\166e\195",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\188\EOT\144%2\198g\206\SYN,\209\175l\213$\150q\DC1",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\245\238,",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x67, 0x96, 0x0,  0x6,  0x0,  0x4a, 0xcd, 0x76, 0xfd, 0x9a, 0x2,  0x0,  0x10, 0x6a,
                   0xb6, 0x58, 0xeb, 0xc9, 0x72, 0xaa, 0xd6, 0x2,  0x86, 0xf1, 0xc9, 0x96, 0xfd, 0xe2, 0x16, 0x2,  0x0,
                   0x15, 0x61, 0x70, 0xe8, 0x24, 0x3e, 0x40, 0xb2, 0x94, 0xb,  0x52, 0xd0, 0xe3, 0xe8, 0xbe, 0x30, 0x2a,
                   0x4e, 0x3e, 0x1f, 0xca, 0xbc, 0x2,  0x0,  0x19, 0x2b, 0x62, 0x8e, 0x17, 0x2f, 0xd5, 0x78, 0x41, 0xca,
                   0x79, 0xaf, 0x69, 0x29, 0xb7, 0xab, 0x8e, 0x59, 0x77, 0x5f, 0xe4, 0x32, 0xaa, 0x9c, 0x20, 0x81, 0x0,
                   0x0,  0x19, 0x41, 0xbb, 0x18, 0xf3, 0xb8, 0xd3, 0x62, 0xaa, 0xe7, 0x74, 0x4b, 0xab, 0xaa, 0x52, 0xd8,
                   0x47, 0x77, 0x95, 0x3c, 0x51, 0x97, 0xc,  0x5a, 0x86, 0xd5, 0x0,  0x0,  0x1,  0xef, 0x2,  0x0,  0x10,
                   0xcc, 0x37, 0x7d, 0x71, 0x29, 0x39, 0x0,  0x2,  0x40, 0xa9, 0x51, 0xc1, 0xd0, 0xa6, 0x65, 0xc3, 0x0,
                   0x0,  0x12, 0xbc, 0x4,  0x90, 0x25, 0x32, 0xc6, 0x67, 0xce, 0x16, 0x2c, 0xd1, 0xaf, 0x6c, 0xd5, 0x24,
                   0x96, 0x71, 0x11, 0x2,  0x0,  0x3,  0xf5, 0xee, 0x2c, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x0, 0x4a, 0xcd, 0x76, 0xfd, 0x9a};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0xb6, 0x58, 0xeb, 0xc9, 0x72, 0xaa, 0xd6,
                                     0x2,  0x86, 0xf1, 0xc9, 0x96, 0xfd, 0xe2, 0x16};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x61, 0x70, 0xe8, 0x24, 0x3e, 0x40, 0xb2, 0x94, 0xb,  0x52, 0xd0,
                                     0xe3, 0xe8, 0xbe, 0x30, 0x2a, 0x4e, 0x3e, 0x1f, 0xca, 0xbc};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0x62, 0x8e, 0x17, 0x2f, 0xd5, 0x78, 0x41, 0xca, 0x79, 0xaf, 0x69, 0x29,
                                     0xb7, 0xab, 0x8e, 0x59, 0x77, 0x5f, 0xe4, 0x32, 0xaa, 0x9c, 0x20, 0x81};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x41, 0xbb, 0x18, 0xf3, 0xb8, 0xd3, 0x62, 0xaa, 0xe7, 0x74, 0x4b, 0xab, 0xaa,
                                     0x52, 0xd8, 0x47, 0x77, 0x95, 0x3c, 0x51, 0x97, 0xc,  0x5a, 0x86, 0xd5};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xef};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xcc, 0x37, 0x7d, 0x71, 0x29, 0x39, 0x0,  0x2,
                                     0x40, 0xa9, 0x51, 0xc1, 0xd0, 0xa6, 0x65, 0xc3};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbc, 0x4,  0x90, 0x25, 0x32, 0xc6, 0x67, 0xce, 0x16,
                                     0x2c, 0xd1, 0xaf, 0x6c, 0xd5, 0x24, 0x96, 0x71, 0x11};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xf5, 0xee, 0x2c};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26518, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23523 [(":Z\253\179\246i\tC\DC4\225\244o",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\144\242\242\&8\223\137pLrC\169\233\142\205;P\227",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\\\t",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\153$\209s\206v>i\252\163\&4U\209\180\245\226\249-\209\158\&5\245\NUL\234\DC10\214",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\218\246\226&[\153t\186\250\SI\199\252\144\201\139\191U?\SI\207?Q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\242x\138*\224\132\237\229\218\231\&4\189|",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\DLE\EOT\229e\SO\165\202\190",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x7f, 0x5b, 0xe3, 0x0,  0xc,  0x3a, 0x5a, 0xfd, 0xb3, 0xf6, 0x69, 0x9,  0x43, 0x14, 0xe1, 0xf4,
                   0x6f, 0x0,  0x0,  0x11, 0x90, 0xf2, 0xf2, 0x38, 0xdf, 0x89, 0x70, 0x4c, 0x72, 0x43, 0xa9, 0xe9, 0x8e,
                   0xcd, 0x3b, 0x50, 0xe3, 0x1,  0x0,  0x2,  0x5c, 0x9,  0x0,  0x0,  0x1b, 0x99, 0x24, 0xd1, 0x73, 0xce,
                   0x76, 0x3e, 0x69, 0xfc, 0xa3, 0x34, 0x55, 0xd1, 0xb4, 0xf5, 0xe2, 0xf9, 0x2d, 0xd1, 0x9e, 0x35, 0xf5,
                   0x0,  0xea, 0x11, 0x30, 0xd6, 0x1,  0x0,  0x0,  0x1,  0x0,  0x16, 0xda, 0xf6, 0xe2, 0x26, 0x5b, 0x99,
                   0x74, 0xba, 0xfa, 0xf,  0xc7, 0xfc, 0x90, 0xc9, 0x8b, 0xbf, 0x55, 0x3f, 0xf,  0xcf, 0x3f, 0x51, 0x1,
                   0x0,  0xd,  0xf2, 0x78, 0x8a, 0x2a, 0xe0, 0x84, 0xed, 0xe5, 0xda, 0xe7, 0x34, 0xbd, 0x7c, 0x2,  0x0,
                   0x8,  0x10, 0x4,  0xe5, 0x65, 0xe,  0xa5, 0xca, 0xbe, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x3a, 0x5a, 0xfd, 0xb3, 0xf6, 0x69, 0x9, 0x43, 0x14, 0xe1, 0xf4, 0x6f};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x90, 0xf2, 0xf2, 0x38, 0xdf, 0x89, 0x70, 0x4c, 0x72,
                                     0x43, 0xa9, 0xe9, 0x8e, 0xcd, 0x3b, 0x50, 0xe3};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5c, 0x9};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x99, 0x24, 0xd1, 0x73, 0xce, 0x76, 0x3e, 0x69, 0xfc, 0xa3, 0x34, 0x55, 0xd1, 0xb4,
                                     0xf5, 0xe2, 0xf9, 0x2d, 0xd1, 0x9e, 0x35, 0xf5, 0x0,  0xea, 0x11, 0x30, 0xd6};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xda, 0xf6, 0xe2, 0x26, 0x5b, 0x99, 0x74, 0xba, 0xfa, 0xf,  0xc7,
                                     0xfc, 0x90, 0xc9, 0x8b, 0xbf, 0x55, 0x3f, 0xf,  0xcf, 0x3f, 0x51};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf2, 0x78, 0x8a, 0x2a, 0xe0, 0x84, 0xed, 0xe5, 0xda, 0xe7, 0x34, 0xbd, 0x7c};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x10, 0x4, 0xe5, 0x65, 0xe, 0xa5, 0xca, 0xbe};
  lwmqtt_string_t topic_filter_s7 = {8, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23523, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10563 [("\168\239",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("b\DC2\247\191\181;_\144\ETX9R\f\212\n*;",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("M\245\139sC\176\233\&4\SI\136\188%\219\r\ENQ\SOS\142%*R8\171\v\149\180\155",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("F\143\188\229\139~\201\n\GSVs\v",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("M\203\202\148\227\243\227S\239h\b\165\&3\230\DC4B\DEL",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\200\DC1P\EOT&",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\200k\212;\251\194\248\153",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("s\233\DEL\210\244\r\226\142\130\195R",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\228\164;\SUB'C\EM\168\199Z\168Yb\SO\EM",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\210|7\DC3\f}\178\DC4\141\DC2\204\NUL\231\224\SOH|}",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0xa5, 0x1,  0x29, 0x43, 0x0,  0x2,  0xa8, 0xef, 0x0,  0x0,  0x10, 0x62, 0x12, 0xf7, 0xbf, 0xb5,
                   0x3b, 0x5f, 0x90, 0x3,  0x39, 0x52, 0xc,  0xd4, 0xa,  0x2a, 0x3b, 0x1,  0x0,  0x1b, 0x4d, 0xf5, 0x8b,
                   0x73, 0x43, 0xb0, 0xe9, 0x34, 0xf,  0x88, 0xbc, 0x25, 0xdb, 0xd,  0x5,  0xe,  0x53, 0x8e, 0x25, 0x2a,
                   0x52, 0x38, 0xab, 0xb,  0x95, 0xb4, 0x9b, 0x1,  0x0,  0xc,  0x46, 0x8f, 0xbc, 0xe5, 0x8b, 0x7e, 0xc9,
                   0xa,  0x1d, 0x56, 0x73, 0xb,  0x0,  0x0,  0x11, 0x4d, 0xcb, 0xca, 0x94, 0xe3, 0xf3, 0xe3, 0x53, 0xef,
                   0x68, 0x8,  0xa5, 0x33, 0xe6, 0x14, 0x42, 0x7f, 0x2,  0x0,  0x5,  0xc8, 0x11, 0x50, 0x4,  0x26, 0x1,
                   0x0,  0x8,  0xc8, 0x6b, 0xd4, 0x3b, 0xfb, 0xc2, 0xf8, 0x99, 0x2,  0x0,  0xb,  0x73, 0xe9, 0x7f, 0xd2,
                   0xf4, 0xd,  0xe2, 0x8e, 0x82, 0xc3, 0x52, 0x2,  0x0,  0xf,  0xe4, 0xa4, 0x3b, 0x1a, 0x27, 0x43, 0x19,
                   0xa8, 0xc7, 0x5a, 0xa8, 0x59, 0x62, 0xe,  0x19, 0x0,  0x0,  0x11, 0xd2, 0x7c, 0x37, 0x13, 0xc,  0x7d,
                   0xb2, 0x14, 0x8d, 0x12, 0xcc, 0x0,  0xe7, 0xe0, 0x1,  0x7c, 0x7d, 0x0,  0x0,  0x0,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xa8, 0xef};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x62, 0x12, 0xf7, 0xbf, 0xb5, 0x3b, 0x5f, 0x90,
                                     0x3,  0x39, 0x52, 0xc,  0xd4, 0xa,  0x2a, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4d, 0xf5, 0x8b, 0x73, 0x43, 0xb0, 0xe9, 0x34, 0xf,  0x88, 0xbc, 0x25, 0xdb, 0xd,
                                     0x5,  0xe,  0x53, 0x8e, 0x25, 0x2a, 0x52, 0x38, 0xab, 0xb,  0x95, 0xb4, 0x9b};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x46, 0x8f, 0xbc, 0xe5, 0x8b, 0x7e, 0xc9, 0xa, 0x1d, 0x56, 0x73, 0xb};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4d, 0xcb, 0xca, 0x94, 0xe3, 0xf3, 0xe3, 0x53, 0xef,
                                     0x68, 0x8,  0xa5, 0x33, 0xe6, 0x14, 0x42, 0x7f};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc8, 0x11, 0x50, 0x4, 0x26};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc8, 0x6b, 0xd4, 0x3b, 0xfb, 0xc2, 0xf8, 0x99};
  lwmqtt_string_t topic_filter_s6 = {8, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x73, 0xe9, 0x7f, 0xd2, 0xf4, 0xd, 0xe2, 0x8e, 0x82, 0xc3, 0x52};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe4, 0xa4, 0x3b, 0x1a, 0x27, 0x43, 0x19, 0xa8,
                                     0xc7, 0x5a, 0xa8, 0x59, 0x62, 0xe,  0x19};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xd2, 0x7c, 0x37, 0x13, 0xc,  0x7d, 0xb2, 0x14, 0x8d,
                                     0x12, 0xcc, 0x0,  0xe7, 0xe0, 0x1,  0x7c, 0x7d};
  lwmqtt_string_t topic_filter_s9 = {17, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10563, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30451 [("%\173",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("u\167Z\ENQ\NUL\246F\186",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("$Gw\252Le",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\195\180\153\189\221_ip\198\147\v\EM\182\215\RS\225D\173=oL",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\216y\n\207uS5\157\EM\SYN\182\169\188\154",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0}),("\235g\164\247p\SUB~D\219!:\SOH_\192",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\226(\200\&7F\131\255\223q\178;",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("\228\218\198\182\168j&\DC2y\249>\132\\>\f\225\180\212\vV\188\EOTTx\215",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\ETX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x8a, 0x1,  0x76, 0xf3, 0x0,  0x2,  0x25, 0xad, 0x0,  0x0,  0x0,  0x1,  0x0,  0x1,  0xc5,
                   0x1,  0x0,  0x8,  0x75, 0xa7, 0x5a, 0x5,  0x0,  0xf6, 0x46, 0xba, 0x1,  0x0,  0x6,  0x24, 0x47,
                   0x77, 0xfc, 0x4c, 0x65, 0x2,  0x0,  0x15, 0xc3, 0xb4, 0x99, 0xbd, 0xdd, 0x5f, 0x69, 0x70, 0xc6,
                   0x93, 0xb,  0x19, 0xb6, 0xd7, 0x1e, 0xe1, 0x44, 0xad, 0x3d, 0x6f, 0x4c, 0x0,  0x0,  0xe,  0xd8,
                   0x79, 0xa,  0xcf, 0x75, 0x53, 0x35, 0x9d, 0x19, 0x16, 0xb6, 0xa9, 0xbc, 0x9a, 0x0,  0x0,  0xe,
                   0xeb, 0x67, 0xa4, 0xf7, 0x70, 0x1a, 0x7e, 0x44, 0xdb, 0x21, 0x3a, 0x1,  0x5f, 0xc0, 0x2,  0x0,
                   0xb,  0xe2, 0x28, 0xc8, 0x37, 0x46, 0x83, 0xff, 0xdf, 0x71, 0xb2, 0x3b, 0x1,  0x0,  0x19, 0xe4,
                   0xda, 0xc6, 0xb6, 0xa8, 0x6a, 0x26, 0x12, 0x79, 0xf9, 0x3e, 0x84, 0x5c, 0x3e, 0xc,  0xe1, 0xb4,
                   0xd4, 0xb,  0x56, 0xbc, 0x4,  0x54, 0x78, 0xd7, 0x0,  0x0,  0x1,  0x3,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x25, 0xad};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc5};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x75, 0xa7, 0x5a, 0x5, 0x0, 0xf6, 0x46, 0xba};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x24, 0x47, 0x77, 0xfc, 0x4c, 0x65};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc3, 0xb4, 0x99, 0xbd, 0xdd, 0x5f, 0x69, 0x70, 0xc6, 0x93, 0xb,
                                     0x19, 0xb6, 0xd7, 0x1e, 0xe1, 0x44, 0xad, 0x3d, 0x6f, 0x4c};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xd8, 0x79, 0xa, 0xcf, 0x75, 0x53, 0x35, 0x9d, 0x19, 0x16, 0xb6, 0xa9, 0xbc, 0x9a};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xeb, 0x67, 0xa4, 0xf7, 0x70, 0x1a, 0x7e, 0x44, 0xdb, 0x21, 0x3a, 0x1, 0x5f, 0xc0};
  lwmqtt_string_t topic_filter_s7 = {14, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe2, 0x28, 0xc8, 0x37, 0x46, 0x83, 0xff, 0xdf, 0x71, 0xb2, 0x3b};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe4, 0xda, 0xc6, 0xb6, 0xa8, 0x6a, 0x26, 0x12, 0x79, 0xf9, 0x3e, 0x84, 0x5c,
                                     0x3e, 0xc,  0xe1, 0xb4, 0xd4, 0xb,  0x56, 0xbc, 0x4,  0x54, 0x78, 0xd7};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x3};
  lwmqtt_string_t topic_filter_s10 = {1, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30451, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5141 [("\173\ff",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1}),("Jm\241\231Tp\203~\220z\153^\194\DC4\227'q\242\ESC1\177\192Q\185\NAK\ETX\139",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\227\229\242\245\173@\183\167\170\152\186\254\253<\SYN\223>|\242\237\137P8",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),(";\204",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\153H\234.\165\EM\135u#\SO\b\141\141\185I\210.\241\136\224",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\186\197\SYN\130",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\251y\216\143Q\220\DC1\248\132\241\NUL\SI\DC3\b\230z\EM\166|",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\148xP\RSO\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x82, 0x1,  0x14, 0x15, 0x0,  0x3,  0xad, 0xc,  0x66, 0x1,  0x0,  0x1b, 0x4a, 0x6d, 0xf1, 0xe7,
                   0x54, 0x70, 0xcb, 0x7e, 0xdc, 0x7a, 0x99, 0x5e, 0xc2, 0x14, 0xe3, 0x27, 0x71, 0xf2, 0x1b, 0x31, 0xb1,
                   0xc0, 0x51, 0xb9, 0x15, 0x3,  0x8b, 0x1,  0x0,  0x17, 0xe3, 0xe5, 0xf2, 0xf5, 0xad, 0x40, 0xb7, 0xa7,
                   0xaa, 0x98, 0xba, 0xfe, 0xfd, 0x3c, 0x16, 0xdf, 0x3e, 0x7c, 0xf2, 0xed, 0x89, 0x50, 0x38, 0x0,  0x0,
                   0x2,  0x3b, 0xcc, 0x2,  0x0,  0x14, 0x99, 0x48, 0xea, 0x2e, 0xa5, 0x19, 0x87, 0x75, 0x23, 0xe,  0x8,
                   0x8d, 0x8d, 0xb9, 0x49, 0xd2, 0x2e, 0xf1, 0x88, 0xe0, 0x2,  0x0,  0x4,  0xba, 0xc5, 0x16, 0x82, 0x1,
                   0x0,  0x13, 0xfb, 0x79, 0xd8, 0x8f, 0x51, 0xdc, 0x11, 0xf8, 0x84, 0xf1, 0x0,  0xf,  0x13, 0x8,  0xe6,
                   0x7a, 0x19, 0xa6, 0x7c, 0x2,  0x0,  0x6,  0x94, 0x78, 0x50, 0x1e, 0x4f, 0xf,  0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xad, 0xc, 0x66};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4a, 0x6d, 0xf1, 0xe7, 0x54, 0x70, 0xcb, 0x7e, 0xdc, 0x7a, 0x99, 0x5e, 0xc2, 0x14,
                                     0xe3, 0x27, 0x71, 0xf2, 0x1b, 0x31, 0xb1, 0xc0, 0x51, 0xb9, 0x15, 0x3,  0x8b};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe3, 0xe5, 0xf2, 0xf5, 0xad, 0x40, 0xb7, 0xa7, 0xaa, 0x98, 0xba, 0xfe,
                                     0xfd, 0x3c, 0x16, 0xdf, 0x3e, 0x7c, 0xf2, 0xed, 0x89, 0x50, 0x38};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3b, 0xcc};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x99, 0x48, 0xea, 0x2e, 0xa5, 0x19, 0x87, 0x75, 0x23, 0xe,
                                     0x8,  0x8d, 0x8d, 0xb9, 0x49, 0xd2, 0x2e, 0xf1, 0x88, 0xe0};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xba, 0xc5, 0x16, 0x82};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfb, 0x79, 0xd8, 0x8f, 0x51, 0xdc, 0x11, 0xf8, 0x84, 0xf1,
                                     0x0,  0xf,  0x13, 0x8,  0xe6, 0x7a, 0x19, 0xa6, 0x7c};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x94, 0x78, 0x50, 0x1e, 0x4f, 0xf};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5141, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8922 [("8[\204Te\235\185\154\136\vI\148\223",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("/\242O\211\r\131\245\210\240\128\SI/@",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\149\136\194\189\ESC\130\154\195\138b\146\NUL\181d\RS\a\216\241\FS\252\144\&3\185$K",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x3e, 0x22, 0xda, 0x0,  0xd,  0x38, 0x5b, 0xcc, 0x54, 0x65, 0xeb, 0xb9, 0x9a, 0x88, 0xb,
                   0x49, 0x94, 0xdf, 0x0,  0x0,  0xd,  0x2f, 0xf2, 0x4f, 0xd3, 0xd,  0x83, 0xf5, 0xd2, 0xf0, 0x80,
                   0xf,  0x2f, 0x40, 0x1,  0x0,  0x19, 0x95, 0x88, 0xc2, 0xbd, 0x1b, 0x82, 0x9a, 0xc3, 0x8a, 0x62,
                   0x92, 0x0,  0xb5, 0x64, 0x1e, 0x7,  0xd8, 0xf1, 0x1c, 0xfc, 0x90, 0x33, 0xb9, 0x24, 0x4b, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x38, 0x5b, 0xcc, 0x54, 0x65, 0xeb, 0xb9, 0x9a, 0x88, 0xb, 0x49, 0x94, 0xdf};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2f, 0xf2, 0x4f, 0xd3, 0xd, 0x83, 0xf5, 0xd2, 0xf0, 0x80, 0xf, 0x2f, 0x40};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x95, 0x88, 0xc2, 0xbd, 0x1b, 0x82, 0x9a, 0xc3, 0x8a, 0x62, 0x92, 0x0, 0xb5,
                                     0x64, 0x1e, 0x7,  0xd8, 0xf1, 0x1c, 0xfc, 0x90, 0x33, 0xb9, 0x24, 0x4b};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8922, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10052
// [("\197\182\247\NAK\225g\156\RSB\176\131>\210\163+gM\b]f\247\229C\139\206\250\&7\200N(",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\244\237N\DC2\r\SIT\223\DC2\235\166\252\&3\164\242J2\185\ETB$\209#O\222",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\SUBP\205",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SO=\180\165\216\210V\143\215h\230\182\212\148\199\230\SUBO\128\ENQX\163\200\244<\DC2g9P\180",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("3z\NUL6\210\254\222.\146\237\247\DEL*_\251",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("j\196\220\190\210\153\196\134\169\GS\DC2\208m6\155{i\204i=Ln9\201O_\NAK#-\177",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("v\NUL\235\199\138\128\&3\DEL\202Q",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\239\216H\UStK\244\237\FSl#\234]\220Ll",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0xb8, 0x1,  0x27, 0x44, 0x0,  0x1e, 0xc5, 0xb6, 0xf7, 0x15, 0xe1, 0x67, 0x9c, 0x1e, 0x42, 0xb0,
                   0x83, 0x3e, 0xd2, 0xa3, 0x2b, 0x67, 0x4d, 0x8,  0x5d, 0x66, 0xf7, 0xe5, 0x43, 0x8b, 0xce, 0xfa, 0x37,
                   0xc8, 0x4e, 0x28, 0x0,  0x0,  0x18, 0xf4, 0xed, 0x4e, 0x12, 0xd,  0xf,  0x54, 0xdf, 0x12, 0xeb, 0xa6,
                   0xfc, 0x33, 0xa4, 0xf2, 0x4a, 0x32, 0xb9, 0x17, 0x24, 0xd1, 0x23, 0x4f, 0xde, 0x1,  0x0,  0x3,  0x1a,
                   0x50, 0xcd, 0x2,  0x0,  0x1e, 0xe,  0x3d, 0xb4, 0xa5, 0xd8, 0xd2, 0x56, 0x8f, 0xd7, 0x68, 0xe6, 0xb6,
                   0xd4, 0x94, 0xc7, 0xe6, 0x1a, 0x4f, 0x80, 0x5,  0x58, 0xa3, 0xc8, 0xf4, 0x3c, 0x12, 0x67, 0x39, 0x50,
                   0xb4, 0x0,  0x0,  0xf,  0x33, 0x7a, 0x0,  0x36, 0xd2, 0xfe, 0xde, 0x2e, 0x92, 0xed, 0xf7, 0x7f, 0x2a,
                   0x5f, 0xfb, 0x0,  0x0,  0x1e, 0x6a, 0xc4, 0xdc, 0xbe, 0xd2, 0x99, 0xc4, 0x86, 0xa9, 0x1d, 0x12, 0xd0,
                   0x6d, 0x36, 0x9b, 0x7b, 0x69, 0xcc, 0x69, 0x3d, 0x4c, 0x6e, 0x39, 0xc9, 0x4f, 0x5f, 0x15, 0x23, 0x2d,
                   0xb1, 0x0,  0x0,  0xa,  0x76, 0x0,  0xeb, 0xc7, 0x8a, 0x80, 0x33, 0x7f, 0xca, 0x51, 0x1,  0x0,  0x10,
                   0xef, 0xd8, 0x48, 0x1f, 0x74, 0x4b, 0xf4, 0xed, 0x1c, 0x6c, 0x23, 0xea, 0x5d, 0xdc, 0x4c, 0x6c, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xc5, 0xb6, 0xf7, 0x15, 0xe1, 0x67, 0x9c, 0x1e, 0x42, 0xb0,
                                     0x83, 0x3e, 0xd2, 0xa3, 0x2b, 0x67, 0x4d, 0x8,  0x5d, 0x66,
                                     0xf7, 0xe5, 0x43, 0x8b, 0xce, 0xfa, 0x37, 0xc8, 0x4e, 0x28};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf4, 0xed, 0x4e, 0x12, 0xd,  0xf,  0x54, 0xdf, 0x12, 0xeb, 0xa6, 0xfc,
                                     0x33, 0xa4, 0xf2, 0x4a, 0x32, 0xb9, 0x17, 0x24, 0xd1, 0x23, 0x4f, 0xde};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0x50, 0xcd};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe,  0x3d, 0xb4, 0xa5, 0xd8, 0xd2, 0x56, 0x8f, 0xd7, 0x68,
                                     0xe6, 0xb6, 0xd4, 0x94, 0xc7, 0xe6, 0x1a, 0x4f, 0x80, 0x5,
                                     0x58, 0xa3, 0xc8, 0xf4, 0x3c, 0x12, 0x67, 0x39, 0x50, 0xb4};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x33, 0x7a, 0x0,  0x36, 0xd2, 0xfe, 0xde, 0x2e,
                                     0x92, 0xed, 0xf7, 0x7f, 0x2a, 0x5f, 0xfb};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6a, 0xc4, 0xdc, 0xbe, 0xd2, 0x99, 0xc4, 0x86, 0xa9, 0x1d,
                                     0x12, 0xd0, 0x6d, 0x36, 0x9b, 0x7b, 0x69, 0xcc, 0x69, 0x3d,
                                     0x4c, 0x6e, 0x39, 0xc9, 0x4f, 0x5f, 0x15, 0x23, 0x2d, 0xb1};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x76, 0x0, 0xeb, 0xc7, 0x8a, 0x80, 0x33, 0x7f, 0xca, 0x51};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xef, 0xd8, 0x48, 0x1f, 0x74, 0x4b, 0xf4, 0xed,
                                     0x1c, 0x6c, 0x23, 0xea, 0x5d, 0xdc, 0x4c, 0x6c};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10052, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12644 [("\185\166\&5\ACK\169\SOk",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0xf, 0x31, 0x64, 0x0, 0x7, 0xb9, 0xa6, 0x35, 0x6, 0xa9, 0xe, 0x6b, 0x1, 0x0, 0x0, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xb9, 0xa6, 0x35, 0x6, 0xa9, 0xe, 0x6b};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12644, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4944 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("_k\r\DC2\f\SI\228\155\183\&2\NAK\NULR\a]\202\235\149",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("*>\177\186\&0]\214*\191\206q\"\231\248\230\193\194E\183\238!\241+\233\222,\198t\234\150",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("mP\215\162\&0:<\157\150\b\240m\ETX\235\218\SOH\255I\168\&5I\145\134^\EM",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x57, 0x13, 0x50, 0x0,  0x0,  0x2,  0x0,  0x12, 0x5f, 0x6b, 0xd,  0x12, 0xc,  0xf,
                   0xe4, 0x9b, 0xb7, 0x32, 0x15, 0x0,  0x52, 0x7,  0x5d, 0xca, 0xeb, 0x95, 0x2,  0x0,  0x1e,
                   0x2a, 0x3e, 0xb1, 0xba, 0x30, 0x5d, 0xd6, 0x2a, 0xbf, 0xce, 0x71, 0x22, 0xe7, 0xf8, 0xe6,
                   0xc1, 0xc2, 0x45, 0xb7, 0xee, 0x21, 0xf1, 0x2b, 0xe9, 0xde, 0x2c, 0xc6, 0x74, 0xea, 0x96,
                   0x1,  0x0,  0x19, 0x6d, 0x50, 0xd7, 0xa2, 0x30, 0x3a, 0x3c, 0x9d, 0x96, 0x8,  0xf0, 0x6d,
                   0x3,  0xeb, 0xda, 0x1,  0xff, 0x49, 0xa8, 0x35, 0x49, 0x91, 0x86, 0x5e, 0x19, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0x6b, 0xd, 0x12, 0xc, 0xf,  0xe4, 0x9b, 0xb7,
                                     0x32, 0x15, 0x0, 0x52, 0x7, 0x5d, 0xca, 0xeb, 0x95};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2a, 0x3e, 0xb1, 0xba, 0x30, 0x5d, 0xd6, 0x2a, 0xbf, 0xce,
                                     0x71, 0x22, 0xe7, 0xf8, 0xe6, 0xc1, 0xc2, 0x45, 0xb7, 0xee,
                                     0x21, 0xf1, 0x2b, 0xe9, 0xde, 0x2c, 0xc6, 0x74, 0xea, 0x96};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6d, 0x50, 0xd7, 0xa2, 0x30, 0x3a, 0x3c, 0x9d, 0x96, 0x8,  0xf0, 0x6d, 0x3,
                                     0xeb, 0xda, 0x1,  0xff, 0x49, 0xa8, 0x35, 0x49, 0x91, 0x86, 0x5e, 0x19};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4944, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10380 [("x#\177~\235\205^\211e\221\198\US_r6\166_\SUB\220\237ILW\169\182V\129",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("fv\DC4W\179\ETB\232\n\203",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\183Q\224\149\199H$\NAK\183\GS\164\130\219 $B\130J\247\250\205V\218",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("w\NAK{\230=\DC2\213",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),(".\240\210\165\146h\199\217\159k\147\SO.\155\246\245\233\STX\229P\168\196",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\226I\SYN\248",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("\150\230\233s",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2}),("\133\135\180\EM",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("_D5",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("gN\213\255\202\196Gnm\180\&4\184Y\219kI\b\140\223\178\DC1u\248\215\132",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\209\EOT\FS\r\251\165\SO{I\218G\179\214\176\184\150\153\160\235\&0\226\aN",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {
      0x82, 0xba, 0x1,  0x28, 0x8c, 0x0,  0x1b, 0x78, 0x23, 0xb1, 0x7e, 0xeb, 0xcd, 0x5e, 0xd3, 0x65, 0xdd, 0xc6, 0x1f,
      0x5f, 0x72, 0x36, 0xa6, 0x5f, 0x1a, 0xdc, 0xed, 0x49, 0x4c, 0x57, 0xa9, 0xb6, 0x56, 0x81, 0x2,  0x0,  0x9,  0x66,
      0x76, 0x14, 0x57, 0xb3, 0x17, 0xe8, 0xa,  0xcb, 0x2,  0x0,  0x17, 0xb7, 0x51, 0xe0, 0x95, 0xc7, 0x48, 0x24, 0x15,
      0xb7, 0x1d, 0xa4, 0x82, 0xdb, 0x20, 0x24, 0x42, 0x82, 0x4a, 0xf7, 0xfa, 0xcd, 0x56, 0xda, 0x1,  0x0,  0x7,  0x77,
      0x15, 0x7b, 0xe6, 0x3d, 0x12, 0xd5, 0x2,  0x0,  0x16, 0x2e, 0xf0, 0xd2, 0xa5, 0x92, 0x68, 0xc7, 0xd9, 0x9f, 0x6b,
      0x93, 0xe,  0x2e, 0x9b, 0xf6, 0xf5, 0xe9, 0x2,  0xe5, 0x50, 0xa8, 0xc4, 0x1,  0x0,  0x4,  0xe2, 0x49, 0x16, 0xf8,
      0x0,  0x0,  0x4,  0x96, 0xe6, 0xe9, 0x73, 0x2,  0x0,  0x4,  0x85, 0x87, 0xb4, 0x19, 0x2,  0x0,  0x3,  0x5f, 0x44,
      0x35, 0x2,  0x0,  0x19, 0x67, 0x4e, 0xd5, 0xff, 0xca, 0xc4, 0x47, 0x6e, 0x6d, 0xb4, 0x34, 0xb8, 0x59, 0xdb, 0x6b,
      0x49, 0x8,  0x8c, 0xdf, 0xb2, 0x11, 0x75, 0xf8, 0xd7, 0x84, 0x0,  0x0,  0x17, 0xd1, 0x4,  0x1c, 0xd,  0xfb, 0xa5,
      0xe,  0x7b, 0x49, 0xda, 0x47, 0xb3, 0xd6, 0xb0, 0xb8, 0x96, 0x99, 0xa0, 0xeb, 0x30, 0xe2, 0x7,  0x4e, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x78, 0x23, 0xb1, 0x7e, 0xeb, 0xcd, 0x5e, 0xd3, 0x65, 0xdd, 0xc6, 0x1f, 0x5f, 0x72,
                                     0x36, 0xa6, 0x5f, 0x1a, 0xdc, 0xed, 0x49, 0x4c, 0x57, 0xa9, 0xb6, 0x56, 0x81};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x66, 0x76, 0x14, 0x57, 0xb3, 0x17, 0xe8, 0xa, 0xcb};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb7, 0x51, 0xe0, 0x95, 0xc7, 0x48, 0x24, 0x15, 0xb7, 0x1d, 0xa4, 0x82,
                                     0xdb, 0x20, 0x24, 0x42, 0x82, 0x4a, 0xf7, 0xfa, 0xcd, 0x56, 0xda};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x77, 0x15, 0x7b, 0xe6, 0x3d, 0x12, 0xd5};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2e, 0xf0, 0xd2, 0xa5, 0x92, 0x68, 0xc7, 0xd9, 0x9f, 0x6b, 0x93,
                                     0xe,  0x2e, 0x9b, 0xf6, 0xf5, 0xe9, 0x2,  0xe5, 0x50, 0xa8, 0xc4};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe2, 0x49, 0x16, 0xf8};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x96, 0xe6, 0xe9, 0x73};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x85, 0x87, 0xb4, 0x19};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x5f, 0x44, 0x35};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x67, 0x4e, 0xd5, 0xff, 0xca, 0xc4, 0x47, 0x6e, 0x6d, 0xb4, 0x34, 0xb8, 0x59,
                                     0xdb, 0x6b, 0x49, 0x8,  0x8c, 0xdf, 0xb2, 0x11, 0x75, 0xf8, 0xd7, 0x84};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xd1, 0x4,  0x1c, 0xd,  0xfb, 0xa5, 0xe,  0x7b, 0x49, 0xda, 0x47, 0xb3,
                                      0xd6, 0xb0, 0xb8, 0x96, 0x99, 0xa0, 0xeb, 0x30, 0xe2, 0x7,  0x4e};
  lwmqtt_string_t topic_filter_s10 = {23, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10380, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14771 [("#\200Q\136b\STX\234p\149",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = True, _noLocal = False, _subQoS =
// QoS2}),("\228_\193\193f_2@\169\173\&8\140\194\221c7\ACK|\ESC\249[\"Cm\187\155\170\176",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("#\f&\179\130I\157\181\213\&6fl\DC2\184\SYN\188\175\227&yeI",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\247St\244Y\\m\197\n\f\DC4A\EOT\nmG\183L\SOH\161J\132\a\150\&3\DC3SP\130\194",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("E\169\130\158J\214",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})]
// [PropUserProperty "\229\243\249(\129\186\nO\140\255\202\&5\v\DC2\218\203B1\131\169\177\149\177\EOT\165\214~"
// "\211\247:YI\DC1\143.\236Y\155\SYN'\235\145\169\FS]1\EOT\228\192",PropServerKeepAlive 1455,PropResponseInformation
// "\t\167\190z\213\168\147\SOH\202\148\SUB3\206\130.\231\165\161\210",PropUserProperty
// "\233\233J\221\187\196\165\142\211\228@=\183!\222\198\173\EOT\248\191\130\219\191\142\STX\185d\171kr"
// "g\246\164\194\225t\n\133\143\198\&8\b'\140\154\r'\NULU\159\DC1t\151(\149R\153]",PropReasonString
// "\207\198l\151\&9\171\208\156\231\149!\216R\233<\a\229p)\182\182.\246\156",PropRetainAvailable 26,PropUserProperty
// "\199\r\177\DC2\178\208\180!p" "0\NAK",PropWillDelayInterval 15578,PropMessageExpiryInterval
// 27005,PropSessionExpiryInterval 18827,PropRetainAvailable 55,PropMaximumPacketSize 15963,PropUserProperty
// "\249nY\175\185>" "J\SYNc\247\198\158\162Ik\222a\251\129\223\170\198\128 \154-\235 \240",PropAuthenticationMethod
// "\172\226\168\209\157\ETB\225q\167H\168\&7\185=x\244\249I\137\FS\ENQ#L\180r\EM\135d\159`",PropServerReference
// "\224\148;\f\"f\SO\178\v\175\227>\DLE\166\238'\t\128-\\\190<4",PropReceiveMaximum 1113,PropRequestProblemInformation
// 44,PropTopicAlias 28498,PropRequestResponseInformation 242,PropSessionExpiryInterval 28088,PropCorrelationData
// "OP\SOHf\199AD\217\DLE\173i3^\154\SI",PropWildcardSubscriptionAvailable 214,PropWildcardSubscriptionAvailable
// 89,PropAuthenticationMethod
// "Q\246\191M,\186%\152@H\231\248\187j\EOT\169v\"\132\205C\169\189!f6\199}",PropAuthenticationData
// "\253",PropSubscriptionIdentifier 15,PropPayloadFormatIndicator 63]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x82, 0xec, 0x3,  0x39, 0xb3, 0xfa, 0x2,  0x26, 0x0,  0x1b, 0xe5, 0xf3, 0xf9, 0x28, 0x81, 0xba, 0xa,  0x4f, 0x8c,
      0xff, 0xca, 0x35, 0xb,  0x12, 0xda, 0xcb, 0x42, 0x31, 0x83, 0xa9, 0xb1, 0x95, 0xb1, 0x4,  0xa5, 0xd6, 0x7e, 0x0,
      0x16, 0xd3, 0xf7, 0x3a, 0x59, 0x49, 0x11, 0x8f, 0x2e, 0xec, 0x59, 0x9b, 0x16, 0x27, 0xeb, 0x91, 0xa9, 0x1c, 0x5d,
      0x31, 0x4,  0xe4, 0xc0, 0x13, 0x5,  0xaf, 0x1a, 0x0,  0x13, 0x9,  0xa7, 0xbe, 0x7a, 0xd5, 0xa8, 0x93, 0x1,  0xca,
      0x94, 0x1a, 0x33, 0xce, 0x82, 0x2e, 0xe7, 0xa5, 0xa1, 0xd2, 0x26, 0x0,  0x1e, 0xe9, 0xe9, 0x4a, 0xdd, 0xbb, 0xc4,
      0xa5, 0x8e, 0xd3, 0xe4, 0x40, 0x3d, 0xb7, 0x21, 0xde, 0xc6, 0xad, 0x4,  0xf8, 0xbf, 0x82, 0xdb, 0xbf, 0x8e, 0x2,
      0xb9, 0x64, 0xab, 0x6b, 0x72, 0x0,  0x1c, 0x67, 0xf6, 0xa4, 0xc2, 0xe1, 0x74, 0xa,  0x85, 0x8f, 0xc6, 0x38, 0x8,
      0x27, 0x8c, 0x9a, 0xd,  0x27, 0x0,  0x55, 0x9f, 0x11, 0x74, 0x97, 0x28, 0x95, 0x52, 0x99, 0x5d, 0x1f, 0x0,  0x18,
      0xcf, 0xc6, 0x6c, 0x97, 0x39, 0xab, 0xd0, 0x9c, 0xe7, 0x95, 0x21, 0xd8, 0x52, 0xe9, 0x3c, 0x7,  0xe5, 0x70, 0x29,
      0xb6, 0xb6, 0x2e, 0xf6, 0x9c, 0x25, 0x1a, 0x26, 0x0,  0x9,  0xc7, 0xd,  0xb1, 0x12, 0xb2, 0xd0, 0xb4, 0x21, 0x70,
      0x0,  0x2,  0x30, 0x15, 0x18, 0x0,  0x0,  0x3c, 0xda, 0x2,  0x0,  0x0,  0x69, 0x7d, 0x11, 0x0,  0x0,  0x49, 0x8b,
      0x25, 0x37, 0x27, 0x0,  0x0,  0x3e, 0x5b, 0x26, 0x0,  0x6,  0xf9, 0x6e, 0x59, 0xaf, 0xb9, 0x3e, 0x0,  0x17, 0x4a,
      0x16, 0x63, 0xf7, 0xc6, 0x9e, 0xa2, 0x49, 0x6b, 0xde, 0x61, 0xfb, 0x81, 0xdf, 0xaa, 0xc6, 0x80, 0x20, 0x9a, 0x2d,
      0xeb, 0x20, 0xf0, 0x15, 0x0,  0x1e, 0xac, 0xe2, 0xa8, 0xd1, 0x9d, 0x17, 0xe1, 0x71, 0xa7, 0x48, 0xa8, 0x37, 0xb9,
      0x3d, 0x78, 0xf4, 0xf9, 0x49, 0x89, 0x1c, 0x5,  0x23, 0x4c, 0xb4, 0x72, 0x19, 0x87, 0x64, 0x9f, 0x60, 0x1c, 0x0,
      0x17, 0xe0, 0x94, 0x3b, 0xc,  0x22, 0x66, 0xe,  0xb2, 0xb,  0xaf, 0xe3, 0x3e, 0x10, 0xa6, 0xee, 0x27, 0x9,  0x80,
      0x2d, 0x5c, 0xbe, 0x3c, 0x34, 0x21, 0x4,  0x59, 0x17, 0x2c, 0x23, 0x6f, 0x52, 0x19, 0xf2, 0x11, 0x0,  0x0,  0x6d,
      0xb8, 0x9,  0x0,  0xf,  0x4f, 0x50, 0x1,  0x66, 0xc7, 0x41, 0x44, 0xd9, 0x10, 0xad, 0x69, 0x33, 0x5e, 0x9a, 0xf,
      0x28, 0xd6, 0x28, 0x59, 0x15, 0x0,  0x1c, 0x51, 0xf6, 0xbf, 0x4d, 0x2c, 0xba, 0x25, 0x98, 0x40, 0x48, 0xe7, 0xf8,
      0xbb, 0x6a, 0x4,  0xa9, 0x76, 0x22, 0x84, 0xcd, 0x43, 0xa9, 0xbd, 0x21, 0x66, 0x36, 0xc7, 0x7d, 0x16, 0x0,  0x1,
      0xfd, 0xb,  0xf,  0x1,  0x3f, 0x0,  0x9,  0x23, 0xc8, 0x51, 0x88, 0x62, 0x2,  0xea, 0x70, 0x95, 0xa,  0x0,  0x1c,
      0xe4, 0x5f, 0xc1, 0xc1, 0x66, 0x5f, 0x32, 0x40, 0xa9, 0xad, 0x38, 0x8c, 0xc2, 0xdd, 0x63, 0x37, 0x6,  0x7c, 0x1b,
      0xf9, 0x5b, 0x22, 0x43, 0x6d, 0xbb, 0x9b, 0xaa, 0xb0, 0x1c, 0x0,  0x16, 0x23, 0xc,  0x26, 0xb3, 0x82, 0x49, 0x9d,
      0xb5, 0xd5, 0x36, 0x66, 0x6c, 0x12, 0xb8, 0x16, 0xbc, 0xaf, 0xe3, 0x26, 0x79, 0x65, 0x49, 0x12, 0x0,  0x1e, 0xf7,
      0x53, 0x74, 0xf4, 0x59, 0x5c, 0x6d, 0xc5, 0xa,  0xc,  0x14, 0x41, 0x4,  0xa,  0x6d, 0x47, 0xb7, 0x4c, 0x1,  0xa1,
      0x4a, 0x84, 0x7,  0x96, 0x33, 0x13, 0x53, 0x50, 0x82, 0xc2, 0x1c, 0x0,  0x6,  0x45, 0xa9, 0x82, 0x9e, 0x4a, 0xd6,
      0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x23, 0xc8, 0x51, 0x88, 0x62, 0x2, 0xea, 0x70, 0x95};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe4, 0x5f, 0xc1, 0xc1, 0x66, 0x5f, 0x32, 0x40, 0xa9, 0xad,
                                     0x38, 0x8c, 0xc2, 0xdd, 0x63, 0x37, 0x6,  0x7c, 0x1b, 0xf9,
                                     0x5b, 0x22, 0x43, 0x6d, 0xbb, 0x9b, 0xaa, 0xb0};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x23, 0xc,  0x26, 0xb3, 0x82, 0x49, 0x9d, 0xb5, 0xd5, 0x36, 0x66,
                                     0x6c, 0x12, 0xb8, 0x16, 0xbc, 0xaf, 0xe3, 0x26, 0x79, 0x65, 0x49};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf7, 0x53, 0x74, 0xf4, 0x59, 0x5c, 0x6d, 0xc5, 0xa,  0xc,
                                     0x14, 0x41, 0x4,  0xa,  0x6d, 0x47, 0xb7, 0x4c, 0x1,  0xa1,
                                     0x4a, 0x84, 0x7,  0x96, 0x33, 0x13, 0x53, 0x50, 0x82, 0xc2};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x45, 0xa9, 0x82, 0x9e, 0x4a, 0xd6};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  uint8_t bytesprops1[] = {0xd3, 0xf7, 0x3a, 0x59, 0x49, 0x11, 0x8f, 0x2e, 0xec, 0x59, 0x9b,
                           0x16, 0x27, 0xeb, 0x91, 0xa9, 0x1c, 0x5d, 0x31, 0x4,  0xe4, 0xc0};
  uint8_t bytesprops0[] = {0xe5, 0xf3, 0xf9, 0x28, 0x81, 0xba, 0xa,  0x4f, 0x8c, 0xff, 0xca, 0x35, 0xb, 0x12,
                           0xda, 0xcb, 0x42, 0x31, 0x83, 0xa9, 0xb1, 0x95, 0xb1, 0x4,  0xa5, 0xd6, 0x7e};
  uint8_t bytesprops2[] = {0x9,  0xa7, 0xbe, 0x7a, 0xd5, 0xa8, 0x93, 0x1,  0xca, 0x94,
                           0x1a, 0x33, 0xce, 0x82, 0x2e, 0xe7, 0xa5, 0xa1, 0xd2};
  uint8_t bytesprops4[] = {0x67, 0xf6, 0xa4, 0xc2, 0xe1, 0x74, 0xa,  0x85, 0x8f, 0xc6, 0x38, 0x8,  0x27, 0x8c,
                           0x9a, 0xd,  0x27, 0x0,  0x55, 0x9f, 0x11, 0x74, 0x97, 0x28, 0x95, 0x52, 0x99, 0x5d};
  uint8_t bytesprops3[] = {0xe9, 0xe9, 0x4a, 0xdd, 0xbb, 0xc4, 0xa5, 0x8e, 0xd3, 0xe4, 0x40, 0x3d, 0xb7, 0x21, 0xde,
                           0xc6, 0xad, 0x4,  0xf8, 0xbf, 0x82, 0xdb, 0xbf, 0x8e, 0x2,  0xb9, 0x64, 0xab, 0x6b, 0x72};
  uint8_t bytesprops5[] = {0xcf, 0xc6, 0x6c, 0x97, 0x39, 0xab, 0xd0, 0x9c, 0xe7, 0x95, 0x21, 0xd8,
                           0x52, 0xe9, 0x3c, 0x7,  0xe5, 0x70, 0x29, 0xb6, 0xb6, 0x2e, 0xf6, 0x9c};
  uint8_t bytesprops7[] = {0x30, 0x15};
  uint8_t bytesprops6[] = {0xc7, 0xd, 0xb1, 0x12, 0xb2, 0xd0, 0xb4, 0x21, 0x70};
  uint8_t bytesprops9[] = {0x4a, 0x16, 0x63, 0xf7, 0xc6, 0x9e, 0xa2, 0x49, 0x6b, 0xde, 0x61, 0xfb,
                           0x81, 0xdf, 0xaa, 0xc6, 0x80, 0x20, 0x9a, 0x2d, 0xeb, 0x20, 0xf0};
  uint8_t bytesprops8[] = {0xf9, 0x6e, 0x59, 0xaf, 0xb9, 0x3e};
  uint8_t bytesprops10[] = {0xac, 0xe2, 0xa8, 0xd1, 0x9d, 0x17, 0xe1, 0x71, 0xa7, 0x48, 0xa8, 0x37, 0xb9, 0x3d, 0x78,
                            0xf4, 0xf9, 0x49, 0x89, 0x1c, 0x5,  0x23, 0x4c, 0xb4, 0x72, 0x19, 0x87, 0x64, 0x9f, 0x60};
  uint8_t bytesprops11[] = {0xe0, 0x94, 0x3b, 0xc,  0x22, 0x66, 0xe,  0xb2, 0xb,  0xaf, 0xe3, 0x3e,
                            0x10, 0xa6, 0xee, 0x27, 0x9,  0x80, 0x2d, 0x5c, 0xbe, 0x3c, 0x34};
  uint8_t bytesprops12[] = {0x4f, 0x50, 0x1, 0x66, 0xc7, 0x41, 0x44, 0xd9, 0x10, 0xad, 0x69, 0x33, 0x5e, 0x9a, 0xf};
  uint8_t bytesprops13[] = {0x51, 0xf6, 0xbf, 0x4d, 0x2c, 0xba, 0x25, 0x98, 0x40, 0x48, 0xe7, 0xf8, 0xbb, 0x6a,
                            0x4,  0xa9, 0x76, 0x22, 0x84, 0xcd, 0x43, 0xa9, 0xbd, 0x21, 0x66, 0x36, 0xc7, 0x7d};
  uint8_t bytesprops14[] = {0xfd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops0}, .v = {22, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1455}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops3}, .v = {28, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops6}, .v = {2, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15578}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27005}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18827}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15963}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops8}, .v = {23, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1113}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28498}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28088}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 63}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14771, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15521 [("`\189\"5\223\186\254\236\DC4y(\SYNn",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("r\ESC\204\199kn\141\&6\182\233~\DC4\158p$\220\NAK\GSm#",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("7m\NUL\DC2c\DC1\250\133",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\RS\\/\203\156\163\252S.\174\177kq\225p\148\163b\249\147e.\EOT\DC2k\206\177",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("/\b\177\207\ENQ\229\157k\212\ng\247\DC3\250K`\202tNp\249\223\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\157\187\230\229\224\196T",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("\222\n\165\165\169%\204-\NUL\STX\192\143p4\221U",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\234\158xoF\217\SUB\128~\184\v",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2}),("\165)n:\242PZ@\244yx\255\DLEf\155\183\r\RSd\207",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropAssignedClientIdentifier "\247",PropResponseInformation "\230M\DC4\241ta\STXf\US.T\215",PropTopicAliasMaximum
// 18295,PropRequestProblemInformation 191,PropAssignedClientIdentifier "\221\230\138+",PropWillDelayInterval
// 31886,PropTopicAliasMaximum 28209,PropTopicAliasMaximum 11036,PropCorrelationData "RVxA\197\192N\248",PropContentType
// "\165\NAKax&7h\217\DC3,+\159w\130\224&\198\"\195<r\EOT\228\206\DC1)\153\NUL",PropSubscriptionIdentifierAvailable 131]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x82, 0x85, 0x2,  0x3c, 0xa1, 0x56, 0x12, 0x0,  0x1,  0xf7, 0x1a, 0x0,  0xc,  0xe6, 0x4d, 0x14, 0xf1, 0x74, 0x61,
      0x2,  0x66, 0x1f, 0x2e, 0x54, 0xd7, 0x22, 0x47, 0x77, 0x17, 0xbf, 0x12, 0x0,  0x4,  0xdd, 0xe6, 0x8a, 0x2b, 0x18,
      0x0,  0x0,  0x7c, 0x8e, 0x22, 0x6e, 0x31, 0x22, 0x2b, 0x1c, 0x9,  0x0,  0x8,  0x52, 0x56, 0x78, 0x41, 0xc5, 0xc0,
      0x4e, 0xf8, 0x3,  0x0,  0x1c, 0xa5, 0x15, 0x61, 0x78, 0x26, 0x37, 0x68, 0xd9, 0x13, 0x2c, 0x2b, 0x9f, 0x77, 0x82,
      0xe0, 0x26, 0xc6, 0x22, 0xc3, 0x3c, 0x72, 0x4,  0xe4, 0xce, 0x11, 0x29, 0x99, 0x0,  0x29, 0x83, 0x0,  0xd,  0x60,
      0xbd, 0x22, 0x35, 0xdf, 0xba, 0xfe, 0xec, 0x14, 0x79, 0x28, 0x16, 0x6e, 0x16, 0x0,  0x14, 0x72, 0x1b, 0xcc, 0xc7,
      0x6b, 0x6e, 0x8d, 0x36, 0xb6, 0xe9, 0x7e, 0x14, 0x9e, 0x70, 0x24, 0xdc, 0x15, 0x1d, 0x6d, 0x23, 0x2c, 0x0,  0x8,
      0x37, 0x6d, 0x0,  0x12, 0x63, 0x11, 0xfa, 0x85, 0x16, 0x0,  0x1b, 0x1e, 0x5c, 0x2f, 0xcb, 0x9c, 0xa3, 0xfc, 0x53,
      0x2e, 0xae, 0xb1, 0x6b, 0x71, 0xe1, 0x70, 0x94, 0xa3, 0x62, 0xf9, 0x93, 0x65, 0x2e, 0x4,  0x12, 0x6b, 0xce, 0xb1,
      0x18, 0x0,  0x17, 0x2f, 0x8,  0xb1, 0xcf, 0x5,  0xe5, 0x9d, 0x6b, 0xd4, 0xa,  0x67, 0xf7, 0x13, 0xfa, 0x4b, 0x60,
      0xca, 0x74, 0x4e, 0x70, 0xf9, 0xdf, 0x87, 0x9,  0x0,  0x7,  0x9d, 0xbb, 0xe6, 0xe5, 0xe0, 0xc4, 0x54, 0x2a, 0x0,
      0x10, 0xde, 0xa,  0xa5, 0xa5, 0xa9, 0x25, 0xcc, 0x2d, 0x0,  0x2,  0xc0, 0x8f, 0x70, 0x34, 0xdd, 0x55, 0xa,  0x0,
      0xb,  0xea, 0x9e, 0x78, 0x6f, 0x46, 0xd9, 0x1a, 0x80, 0x7e, 0xb8, 0xb,  0x16, 0x0,  0x14, 0xa5, 0x29, 0x6e, 0x3a,
      0xf2, 0x50, 0x5a, 0x40, 0xf4, 0x79, 0x78, 0xff, 0x10, 0x66, 0x9b, 0xb7, 0xd,  0x1e, 0x64, 0xcf, 0x1c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x60, 0xbd, 0x22, 0x35, 0xdf, 0xba, 0xfe, 0xec, 0x14, 0x79, 0x28, 0x16, 0x6e};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x72, 0x1b, 0xcc, 0xc7, 0x6b, 0x6e, 0x8d, 0x36, 0xb6, 0xe9,
                                     0x7e, 0x14, 0x9e, 0x70, 0x24, 0xdc, 0x15, 0x1d, 0x6d, 0x23};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x37, 0x6d, 0x0, 0x12, 0x63, 0x11, 0xfa, 0x85};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1e, 0x5c, 0x2f, 0xcb, 0x9c, 0xa3, 0xfc, 0x53, 0x2e, 0xae, 0xb1, 0x6b, 0x71, 0xe1,
                                     0x70, 0x94, 0xa3, 0x62, 0xf9, 0x93, 0x65, 0x2e, 0x4,  0x12, 0x6b, 0xce, 0xb1};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2f, 0x8,  0xb1, 0xcf, 0x5,  0xe5, 0x9d, 0x6b, 0xd4, 0xa,  0x67, 0xf7,
                                     0x13, 0xfa, 0x4b, 0x60, 0xca, 0x74, 0x4e, 0x70, 0xf9, 0xdf, 0x87};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x9d, 0xbb, 0xe6, 0xe5, 0xe0, 0xc4, 0x54};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xde, 0xa, 0xa5, 0xa5, 0xa9, 0x25, 0xcc, 0x2d,
                                     0x0,  0x2, 0xc0, 0x8f, 0x70, 0x34, 0xdd, 0x55};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xea, 0x9e, 0x78, 0x6f, 0x46, 0xd9, 0x1a, 0x80, 0x7e, 0xb8, 0xb};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa5, 0x29, 0x6e, 0x3a, 0xf2, 0x50, 0x5a, 0x40, 0xf4, 0x79,
                                     0x78, 0xff, 0x10, 0x66, 0x9b, 0xb7, 0xd,  0x1e, 0x64, 0xcf};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0xf7};
  uint8_t bytesprops1[] = {0xe6, 0x4d, 0x14, 0xf1, 0x74, 0x61, 0x2, 0x66, 0x1f, 0x2e, 0x54, 0xd7};
  uint8_t bytesprops2[] = {0xdd, 0xe6, 0x8a, 0x2b};
  uint8_t bytesprops3[] = {0x52, 0x56, 0x78, 0x41, 0xc5, 0xc0, 0x4e, 0xf8};
  uint8_t bytesprops4[] = {0xa5, 0x15, 0x61, 0x78, 0x26, 0x37, 0x68, 0xd9, 0x13, 0x2c, 0x2b, 0x9f, 0x77, 0x82,
                           0xe0, 0x26, 0xc6, 0x22, 0xc3, 0x3c, 0x72, 0x4,  0xe4, 0xce, 0x11, 0x29, 0x99, 0x0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18295}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31886}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28209}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11036}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 131}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15521, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32751 [("\244p\172\184\198D\143w^DY=\SOH*\198Or\168\&2S\EOT\201F\221 ",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("6\131\253\146v\146O(\180\253\DC3\176\254\187\231\176\157\130\246\146rL\164\149i\255!",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("5\250\218p\241}\189\209\ESC6)\141\164(\SOH\213",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropTopicAliasMaximum
// 24247,PropWildcardSubscriptionAvailable 208,PropSharedSubscriptionAvailable 87,PropTopicAlias 16175]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x5a, 0x7f, 0xef, 0xa,  0x22, 0x5e, 0xb7, 0x28, 0xd0, 0x2a, 0x57, 0x23, 0x3f, 0x2f, 0x0,
                   0x19, 0xf4, 0x70, 0xac, 0xb8, 0xc6, 0x44, 0x8f, 0x77, 0x5e, 0x44, 0x59, 0x3d, 0x1,  0x2a, 0xc6,
                   0x4f, 0x72, 0xa8, 0x32, 0x53, 0x4,  0xc9, 0x46, 0xdd, 0x20, 0x26, 0x0,  0x1b, 0x36, 0x83, 0xfd,
                   0x92, 0x76, 0x92, 0x4f, 0x28, 0xb4, 0xfd, 0x13, 0xb0, 0xfe, 0xbb, 0xe7, 0xb0, 0x9d, 0x82, 0xf6,
                   0x92, 0x72, 0x4c, 0xa4, 0x95, 0x69, 0xff, 0x21, 0xd,  0x0,  0x10, 0x35, 0xfa, 0xda, 0x70, 0xf1,
                   0x7d, 0xbd, 0xd1, 0x1b, 0x36, 0x29, 0x8d, 0xa4, 0x28, 0x1,  0xd5, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xf4, 0x70, 0xac, 0xb8, 0xc6, 0x44, 0x8f, 0x77, 0x5e, 0x44, 0x59, 0x3d, 0x1,
                                     0x2a, 0xc6, 0x4f, 0x72, 0xa8, 0x32, 0x53, 0x4,  0xc9, 0x46, 0xdd, 0x20};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x36, 0x83, 0xfd, 0x92, 0x76, 0x92, 0x4f, 0x28, 0xb4, 0xfd, 0x13, 0xb0, 0xfe, 0xbb,
                                     0xe7, 0xb0, 0x9d, 0x82, 0xf6, 0x92, 0x72, 0x4c, 0xa4, 0x95, 0x69, 0xff, 0x21};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x35, 0xfa, 0xda, 0x70, 0xf1, 0x7d, 0xbd, 0xd1,
                                     0x1b, 0x36, 0x29, 0x8d, 0xa4, 0x28, 0x1,  0xd5};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24247}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16175}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32751, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9203 [("\220\237
// \185\218f\186\169G-\SYNR\157\129k\146\142\187\249\223Vy\168X\214\209B\212\ETX\183",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("7t\b,\195X\ETB\163\b\239\189\161%<\186M\148Ge\DC1",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\214\204\149U\228E\GS\"\154\138tn6\214\212\252\GS\221\192",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\193\225~tM*M\ETX\160!",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("!\SI\216\183\f1\167N7\226\168",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS1}),("\141\196\137sYG3\148\203O\177",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\n8\154\150]\ETX\218\235H",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS1})] [PropReasonString "\n\179\153\206j\235Q\NAKI,\184",PropMaximumPacketSize
// 13450,PropResponseTopic "\NUL\222,2\155\&3\a\SOH7\149\ETB\STX\199\&3\210\195\ETX\140\156\240\129",PropRetainAvailable
// 148,PropServerReference "*=3y\219\157\&5\SYN\ETB\135\132M?r\130\226\254\143\250",PropAssignedClientIdentifier
// "\t\bw\175[\SOr`\222\173lWK\143",PropSessionExpiryInterval 28089,PropResponseInformation
// "wi\210\173\141\239\DC2\b\135U=!\217\185\243\187(\EM\154<",PropCorrelationData
// "\166\218\156\237bLsm\"\EM",PropCorrelationData
// "\162\GS\192\157\162\SIFI\159|\148\220\&5\130\GS1\190\209.\DC2T2\216\r",PropMessageExpiryInterval
// 30374,PropWildcardSubscriptionAvailable 50,PropTopicAlias 21419,PropTopicAliasMaximum 32476]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xac, 0x2,  0x23, 0xf3, 0xa5, 0x1,  0x1f, 0x0,  0xb,  0xa,  0xb3, 0x99, 0xce, 0x6a, 0xeb, 0x51, 0x15, 0x49,
      0x2c, 0xb8, 0x27, 0x0,  0x0,  0x34, 0x8a, 0x8,  0x0,  0x15, 0x0,  0xde, 0x2c, 0x32, 0x9b, 0x33, 0x7,  0x1,  0x37,
      0x95, 0x17, 0x2,  0xc7, 0x33, 0xd2, 0xc3, 0x3,  0x8c, 0x9c, 0xf0, 0x81, 0x25, 0x94, 0x1c, 0x0,  0x13, 0x2a, 0x3d,
      0x33, 0x79, 0xdb, 0x9d, 0x35, 0x16, 0x17, 0x87, 0x84, 0x4d, 0x3f, 0x72, 0x82, 0xe2, 0xfe, 0x8f, 0xfa, 0x12, 0x0,
      0xe,  0x9,  0x8,  0x77, 0xaf, 0x5b, 0xe,  0x72, 0x60, 0xde, 0xad, 0x6c, 0x57, 0x4b, 0x8f, 0x11, 0x0,  0x0,  0x6d,
      0xb9, 0x1a, 0x0,  0x14, 0x77, 0x69, 0xd2, 0xad, 0x8d, 0xef, 0x12, 0x8,  0x87, 0x55, 0x3d, 0x21, 0xd9, 0xb9, 0xf3,
      0xbb, 0x28, 0x19, 0x9a, 0x3c, 0x9,  0x0,  0xa,  0xa6, 0xda, 0x9c, 0xed, 0x62, 0x4c, 0x73, 0x6d, 0x22, 0x19, 0x9,
      0x0,  0x18, 0xa2, 0x1d, 0xc0, 0x9d, 0xa2, 0xf,  0x46, 0x49, 0x9f, 0x7c, 0x94, 0xdc, 0x35, 0x82, 0x1d, 0x31, 0xbe,
      0xd1, 0x2e, 0x12, 0x54, 0x32, 0xd8, 0xd,  0x2,  0x0,  0x0,  0x76, 0xa6, 0x28, 0x32, 0x23, 0x53, 0xab, 0x22, 0x7e,
      0xdc, 0x0,  0x1e, 0xdc, 0xed, 0x20, 0xb9, 0xda, 0x66, 0xba, 0xa9, 0x47, 0x2d, 0x16, 0x52, 0x9d, 0x81, 0x6b, 0x92,
      0x8e, 0xbb, 0xf9, 0xdf, 0x56, 0x79, 0xa8, 0x58, 0xd6, 0xd1, 0x42, 0xd4, 0x3,  0xb7, 0x1a, 0x0,  0x14, 0x37, 0x74,
      0x8,  0x2c, 0xc3, 0x58, 0x17, 0xa3, 0x8,  0xef, 0xbd, 0xa1, 0x25, 0x3c, 0xba, 0x4d, 0x94, 0x47, 0x65, 0x11, 0x21,
      0x0,  0x13, 0xd6, 0xcc, 0x95, 0x55, 0xe4, 0x45, 0x1d, 0x22, 0x9a, 0x8a, 0x74, 0x6e, 0x36, 0xd6, 0xd4, 0xfc, 0x1d,
      0xdd, 0xc0, 0x16, 0x0,  0xa,  0xc1, 0xe1, 0x7e, 0x74, 0x4d, 0x2a, 0x4d, 0x3,  0xa0, 0x21, 0x29, 0x0,  0xb,  0x21,
      0xf,  0xd8, 0xb7, 0xc,  0x31, 0xa7, 0x4e, 0x37, 0xe2, 0xa8, 0x25, 0x0,  0xb,  0x8d, 0xc4, 0x89, 0x73, 0x59, 0x47,
      0x33, 0x94, 0xcb, 0x4f, 0xb1, 0x1d, 0x0,  0x9,  0xa,  0x38, 0x9a, 0x96, 0x5d, 0x3,  0xda, 0xeb, 0x48, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xdc, 0xed, 0x20, 0xb9, 0xda, 0x66, 0xba, 0xa9, 0x47, 0x2d,
                                     0x16, 0x52, 0x9d, 0x81, 0x6b, 0x92, 0x8e, 0xbb, 0xf9, 0xdf,
                                     0x56, 0x79, 0xa8, 0x58, 0xd6, 0xd1, 0x42, 0xd4, 0x3,  0xb7};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x37, 0x74, 0x8,  0x2c, 0xc3, 0x58, 0x17, 0xa3, 0x8,  0xef,
                                     0xbd, 0xa1, 0x25, 0x3c, 0xba, 0x4d, 0x94, 0x47, 0x65, 0x11};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd6, 0xcc, 0x95, 0x55, 0xe4, 0x45, 0x1d, 0x22, 0x9a, 0x8a,
                                     0x74, 0x6e, 0x36, 0xd6, 0xd4, 0xfc, 0x1d, 0xdd, 0xc0};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc1, 0xe1, 0x7e, 0x74, 0x4d, 0x2a, 0x4d, 0x3, 0xa0, 0x21};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x21, 0xf, 0xd8, 0xb7, 0xc, 0x31, 0xa7, 0x4e, 0x37, 0xe2, 0xa8};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8d, 0xc4, 0x89, 0x73, 0x59, 0x47, 0x33, 0x94, 0xcb, 0x4f, 0xb1};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa, 0x38, 0x9a, 0x96, 0x5d, 0x3, 0xda, 0xeb, 0x48};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0xa, 0xb3, 0x99, 0xce, 0x6a, 0xeb, 0x51, 0x15, 0x49, 0x2c, 0xb8};
  uint8_t bytesprops1[] = {0x0, 0xde, 0x2c, 0x32, 0x9b, 0x33, 0x7,  0x1,  0x37, 0x95, 0x17,
                           0x2, 0xc7, 0x33, 0xd2, 0xc3, 0x3,  0x8c, 0x9c, 0xf0, 0x81};
  uint8_t bytesprops2[] = {0x2a, 0x3d, 0x33, 0x79, 0xdb, 0x9d, 0x35, 0x16, 0x17, 0x87,
                           0x84, 0x4d, 0x3f, 0x72, 0x82, 0xe2, 0xfe, 0x8f, 0xfa};
  uint8_t bytesprops3[] = {0x9, 0x8, 0x77, 0xaf, 0x5b, 0xe, 0x72, 0x60, 0xde, 0xad, 0x6c, 0x57, 0x4b, 0x8f};
  uint8_t bytesprops4[] = {0x77, 0x69, 0xd2, 0xad, 0x8d, 0xef, 0x12, 0x8,  0x87, 0x55,
                           0x3d, 0x21, 0xd9, 0xb9, 0xf3, 0xbb, 0x28, 0x19, 0x9a, 0x3c};
  uint8_t bytesprops5[] = {0xa6, 0xda, 0x9c, 0xed, 0x62, 0x4c, 0x73, 0x6d, 0x22, 0x19};
  uint8_t bytesprops6[] = {0xa2, 0x1d, 0xc0, 0x9d, 0xa2, 0xf,  0x46, 0x49, 0x9f, 0x7c, 0x94, 0xdc,
                           0x35, 0x82, 0x1d, 0x31, 0xbe, 0xd1, 0x2e, 0x12, 0x54, 0x32, 0xd8, 0xd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13450}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28089}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30374}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21419}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32476}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9203, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7433 [("#\207",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS2}),("\150",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("\236",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS1}),("\193\250\200\202",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\237c\182\248?\181\241\171\158",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\189A\203\SYNq\144\&2\237\196d\226s\192\SUB",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("h\187\a\196\RS\\\235\216\SOH\fv3",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("/\185l>/\134\246\153\EOT\237\&5\v\213\STX\138\EOT\211a",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\DC4\STX\211\a-\145",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropSessionExpiryInterval
// 30141,PropSessionExpiryInterval 5579,PropRequestProblemInformation 110,PropRequestResponseInformation
// 9,PropResponseTopic "\ngq\235\NULZ\215n\221\154\171B\147",PropResponseInformation "My\133",PropServerReference
// "\195\130\175\208\156\189\194\183W\243\151f",PropResponseTopic "\246\248M'\DC3",PropRetainAvailable
// 235,PropRequestResponseInformation 66,PropSubscriptionIdentifier 8,PropMaximumQoS 144,PropMessageExpiryInterval
// 27935,PropUserProperty
// "\237\218\146\136\247\179\226\233%\t\208\244\GS5l\r&\141\180\220)\t\ENQS\155\160\217\214\204\GS" "\192\193"]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x82, 0xce, 0x1,  0x1d, 0x9,  0x6d, 0x11, 0x0,  0x0,  0x75, 0xbd, 0x11, 0x0,  0x0,  0x15, 0xcb, 0x17, 0x6e, 0x19,
      0x9,  0x8,  0x0,  0xd,  0xa,  0x67, 0x71, 0xeb, 0x0,  0x5a, 0xd7, 0x6e, 0xdd, 0x9a, 0xab, 0x42, 0x93, 0x1a, 0x0,
      0x3,  0x4d, 0x79, 0x85, 0x1c, 0x0,  0xc,  0xc3, 0x82, 0xaf, 0xd0, 0x9c, 0xbd, 0xc2, 0xb7, 0x57, 0xf3, 0x97, 0x66,
      0x8,  0x0,  0x5,  0xf6, 0xf8, 0x4d, 0x27, 0x13, 0x25, 0xeb, 0x19, 0x42, 0xb,  0x8,  0x24, 0x90, 0x2,  0x0,  0x0,
      0x6d, 0x1f, 0x26, 0x0,  0x1e, 0xed, 0xda, 0x92, 0x88, 0xf7, 0xb3, 0xe2, 0xe9, 0x25, 0x9,  0xd0, 0xf4, 0x1d, 0x35,
      0x6c, 0xd,  0x26, 0x8d, 0xb4, 0xdc, 0x29, 0x9,  0x5,  0x53, 0x9b, 0xa0, 0xd9, 0xd6, 0xcc, 0x1d, 0x0,  0x2,  0xc0,
      0xc1, 0x0,  0x2,  0x23, 0xcf, 0x6,  0x0,  0x1,  0x96, 0x10, 0x0,  0x1,  0xec, 0x2d, 0x0,  0x4,  0xc1, 0xfa, 0xc8,
      0xca, 0x1e, 0x0,  0x9,  0xed, 0x63, 0xb6, 0xf8, 0x3f, 0xb5, 0xf1, 0xab, 0x9e, 0x2e, 0x0,  0xe,  0xbd, 0x41, 0xcb,
      0x16, 0x71, 0x90, 0x32, 0xed, 0xc4, 0x64, 0xe2, 0x73, 0xc0, 0x1a, 0x12, 0x0,  0xc,  0x68, 0xbb, 0x7,  0xc4, 0x1e,
      0x5c, 0xeb, 0xd8, 0x1,  0xc,  0x76, 0x33, 0x1,  0x0,  0x12, 0x2f, 0xb9, 0x6c, 0x3e, 0x2f, 0x86, 0xf6, 0x99, 0x4,
      0xed, 0x35, 0xb,  0xd5, 0x2,  0x8a, 0x4,  0xd3, 0x61, 0x2d, 0x0,  0x6,  0x14, 0x2,  0xd3, 0x7,  0x2d, 0x91, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x23, 0xcf};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x96};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xec};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc1, 0xfa, 0xc8, 0xca};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xed, 0x63, 0xb6, 0xf8, 0x3f, 0xb5, 0xf1, 0xab, 0x9e};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xbd, 0x41, 0xcb, 0x16, 0x71, 0x90, 0x32,
                                     0xed, 0xc4, 0x64, 0xe2, 0x73, 0xc0, 0x1a};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x68, 0xbb, 0x7, 0xc4, 0x1e, 0x5c, 0xeb, 0xd8, 0x1, 0xc, 0x76, 0x33};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x2f, 0xb9, 0x6c, 0x3e, 0x2f, 0x86, 0xf6, 0x99, 0x4,
                                     0xed, 0x35, 0xb,  0xd5, 0x2,  0x8a, 0x4,  0xd3, 0x61};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x14, 0x2, 0xd3, 0x7, 0x2d, 0x91};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0xa, 0x67, 0x71, 0xeb, 0x0, 0x5a, 0xd7, 0x6e, 0xdd, 0x9a, 0xab, 0x42, 0x93};
  uint8_t bytesprops1[] = {0x4d, 0x79, 0x85};
  uint8_t bytesprops2[] = {0xc3, 0x82, 0xaf, 0xd0, 0x9c, 0xbd, 0xc2, 0xb7, 0x57, 0xf3, 0x97, 0x66};
  uint8_t bytesprops3[] = {0xf6, 0xf8, 0x4d, 0x27, 0x13};
  uint8_t bytesprops5[] = {0xc0, 0xc1};
  uint8_t bytesprops4[] = {0xed, 0xda, 0x92, 0x88, 0xf7, 0xb3, 0xe2, 0xe9, 0x25, 0x9,  0xd0, 0xf4, 0x1d, 0x35, 0x6c,
                           0xd,  0x26, 0x8d, 0xb4, 0xdc, 0x29, 0x9,  0x5,  0x53, 0x9b, 0xa0, 0xd9, 0xd6, 0xcc, 0x1d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30141}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5579}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27935}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops4}, .v = {2, (char*)&bytesprops5}}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7433, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22949 [("\139\231\DC1\195J*\243\226Ip\ENQ\158\195U\254<t\142M\ESCR\174\147",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\220\US\SO\186.Z",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS0}),("\168]5\214i\137\ETB`\249V\215\226k\244\245\213g&],",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("g\226\192\218XM\180T@\164{\ACK\ENQ\172\139\151\253\145\NUL}\138K@\EOT\147\169\160o",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("B\235#",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS1}),("/`v\162\NUL\130$r\204\254\151\228\171\nhV\180)b\159D\183,g\ETB\202d\247",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropCorrelationData
// "\212_\247\150R\217\150!B\205d'\188\223\254%\203\254&\GSh\DC2'\191[h(\209",PropSessionExpiryInterval
// 28440,PropServerKeepAlive 25853,PropTopicAlias 1969,PropAuthenticationMethod "MA~'&A",PropSubscriptionIdentifier
// 15,PropReasonString "b\157u\150",PropPayloadFormatIndicator 197,PropCorrelationData
// "\186eJ\198\190\176+='\DC3/B\186\169\142\253\132\201_)\182\174\137\215\226$",PropUserProperty
// "\196T+\213\232\154\&3\DLEP\218\151l\DC3hEn\146\225\143@\FS\136"
// "\ENQ\189)\137Z\137\164\190\SYNJZ",PropSharedSubscriptionAvailable 190,PropMaximumPacketSize
// 25529,PropWillDelayInterval 21290,PropAssignedClientIdentifier
// "\197\USF\ACK\EOT\186~\246\148\SIS\t-\a\239\248E\138\ETXsa\202\152L",PropAuthenticationMethod
// "\238\202\236\147w\223\171\STX\190\234u\233\242\164lG\254\158\199\233sl\228\151\DC3",PropTopicAlias
// 21418,PropUserProperty ">\FS\159\203n\210d\233" "\143\157K\182,\165\184\162a",PropAuthenticationMethod
// "uTC",PropPayloadFormatIndicator 82,PropSubscriptionIdentifier 27,PropSubscriptionIdentifier 13,PropTopicAlias
// 19451,PropRequestProblemInformation 161,PropTopicAlias 29070,PropTopicAliasMaximum 5370,PropAuthenticationMethod
// ",\219\174\203\240\245\174\DC3\128/\200-\v\203\141\206\214\246\146\"\157\&3",PropAuthenticationData
// "W\176\165:teU<\DLE\NUL\188\fn\\-SY\DC4\208dW\DC4\244\230\166\219C6",PropReasonString
// "\158b\204\ENQ\ETB\208\204\DLE]U\215\208m\SO>\176\153\199",PropPayloadFormatIndicator 173,PropMaximumPacketSize 7894]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x82, 0xca, 0x3,  0x59, 0xa5, 0xc8, 0x2,  0x9,  0x0,  0x1c, 0xd4, 0x5f, 0xf7, 0x96, 0x52, 0xd9, 0x96, 0x21, 0x42,
      0xcd, 0x64, 0x27, 0xbc, 0xdf, 0xfe, 0x25, 0xcb, 0xfe, 0x26, 0x1d, 0x68, 0x12, 0x27, 0xbf, 0x5b, 0x68, 0x28, 0xd1,
      0x11, 0x0,  0x0,  0x6f, 0x18, 0x13, 0x64, 0xfd, 0x23, 0x7,  0xb1, 0x15, 0x0,  0x6,  0x4d, 0x41, 0x7e, 0x27, 0x26,
      0x41, 0xb,  0xf,  0x1f, 0x0,  0x4,  0x62, 0x9d, 0x75, 0x96, 0x1,  0xc5, 0x9,  0x0,  0x1a, 0xba, 0x65, 0x4a, 0xc6,
      0xbe, 0xb0, 0x2b, 0x3d, 0x27, 0x13, 0x2f, 0x42, 0xba, 0xa9, 0x8e, 0xfd, 0x84, 0xc9, 0x5f, 0x29, 0xb6, 0xae, 0x89,
      0xd7, 0xe2, 0x24, 0x26, 0x0,  0x16, 0xc4, 0x54, 0x2b, 0xd5, 0xe8, 0x9a, 0x33, 0x10, 0x50, 0xda, 0x97, 0x6c, 0x13,
      0x68, 0x45, 0x6e, 0x92, 0xe1, 0x8f, 0x40, 0x1c, 0x88, 0x0,  0xb,  0x5,  0xbd, 0x29, 0x89, 0x5a, 0x89, 0xa4, 0xbe,
      0x16, 0x4a, 0x5a, 0x2a, 0xbe, 0x27, 0x0,  0x0,  0x63, 0xb9, 0x18, 0x0,  0x0,  0x53, 0x2a, 0x12, 0x0,  0x18, 0xc5,
      0x1f, 0x46, 0x6,  0x4,  0xba, 0x7e, 0xf6, 0x94, 0xf,  0x53, 0x9,  0x2d, 0x7,  0xef, 0xf8, 0x45, 0x8a, 0x3,  0x73,
      0x61, 0xca, 0x98, 0x4c, 0x15, 0x0,  0x19, 0xee, 0xca, 0xec, 0x93, 0x77, 0xdf, 0xab, 0x2,  0xbe, 0xea, 0x75, 0xe9,
      0xf2, 0xa4, 0x6c, 0x47, 0xfe, 0x9e, 0xc7, 0xe9, 0x73, 0x6c, 0xe4, 0x97, 0x13, 0x23, 0x53, 0xaa, 0x26, 0x0,  0x8,
      0x3e, 0x1c, 0x9f, 0xcb, 0x6e, 0xd2, 0x64, 0xe9, 0x0,  0x9,  0x8f, 0x9d, 0x4b, 0xb6, 0x2c, 0xa5, 0xb8, 0xa2, 0x61,
      0x15, 0x0,  0x3,  0x75, 0x54, 0x43, 0x1,  0x52, 0xb,  0x1b, 0xb,  0xd,  0x23, 0x4b, 0xfb, 0x17, 0xa1, 0x23, 0x71,
      0x8e, 0x22, 0x14, 0xfa, 0x15, 0x0,  0x16, 0x2c, 0xdb, 0xae, 0xcb, 0xf0, 0xf5, 0xae, 0x13, 0x80, 0x2f, 0xc8, 0x2d,
      0xb,  0xcb, 0x8d, 0xce, 0xd6, 0xf6, 0x92, 0x22, 0x9d, 0x33, 0x16, 0x0,  0x1c, 0x57, 0xb0, 0xa5, 0x3a, 0x74, 0x65,
      0x55, 0x3c, 0x10, 0x0,  0xbc, 0xc,  0x6e, 0x5c, 0x2d, 0x53, 0x59, 0x14, 0xd0, 0x64, 0x57, 0x14, 0xf4, 0xe6, 0xa6,
      0xdb, 0x43, 0x36, 0x1f, 0x0,  0x12, 0x9e, 0x62, 0xcc, 0x5,  0x17, 0xd0, 0xcc, 0x10, 0x5d, 0x55, 0xd7, 0xd0, 0x6d,
      0xe,  0x3e, 0xb0, 0x99, 0xc7, 0x1,  0xad, 0x27, 0x0,  0x0,  0x1e, 0xd6, 0x0,  0x17, 0x8b, 0xe7, 0x11, 0xc3, 0x4a,
      0x2a, 0xf3, 0xe2, 0x49, 0x70, 0x5,  0x9e, 0xc3, 0x55, 0xfe, 0x3c, 0x74, 0x8e, 0x4d, 0x1b, 0x52, 0xae, 0x93, 0x25,
      0x0,  0x6,  0xdc, 0x1f, 0xe,  0xba, 0x2e, 0x5a, 0x24, 0x0,  0x14, 0xa8, 0x5d, 0x35, 0xd6, 0x69, 0x89, 0x17, 0x60,
      0xf9, 0x56, 0xd7, 0xe2, 0x6b, 0xf4, 0xf5, 0xd5, 0x67, 0x26, 0x5d, 0x2c, 0x2d, 0x0,  0x1c, 0x67, 0xe2, 0xc0, 0xda,
      0x58, 0x4d, 0xb4, 0x54, 0x40, 0xa4, 0x7b, 0x6,  0x5,  0xac, 0x8b, 0x97, 0xfd, 0x91, 0x0,  0x7d, 0x8a, 0x4b, 0x40,
      0x4,  0x93, 0xa9, 0xa0, 0x6f, 0x15, 0x0,  0x3,  0x42, 0xeb, 0x23, 0x1d, 0x0,  0x1c, 0x2f, 0x60, 0x76, 0xa2, 0x0,
      0x82, 0x24, 0x72, 0xcc, 0xfe, 0x97, 0xe4, 0xab, 0xa,  0x68, 0x56, 0xb4, 0x29, 0x62, 0x9f, 0x44, 0xb7, 0x2c, 0x67,
      0x17, 0xca, 0x64, 0xf7, 0x1c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x8b, 0xe7, 0x11, 0xc3, 0x4a, 0x2a, 0xf3, 0xe2, 0x49, 0x70, 0x5, 0x9e,
                                     0xc3, 0x55, 0xfe, 0x3c, 0x74, 0x8e, 0x4d, 0x1b, 0x52, 0xae, 0x93};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdc, 0x1f, 0xe, 0xba, 0x2e, 0x5a};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa8, 0x5d, 0x35, 0xd6, 0x69, 0x89, 0x17, 0x60, 0xf9, 0x56,
                                     0xd7, 0xe2, 0x6b, 0xf4, 0xf5, 0xd5, 0x67, 0x26, 0x5d, 0x2c};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x67, 0xe2, 0xc0, 0xda, 0x58, 0x4d, 0xb4, 0x54, 0x40, 0xa4,
                                     0x7b, 0x6,  0x5,  0xac, 0x8b, 0x97, 0xfd, 0x91, 0x0,  0x7d,
                                     0x8a, 0x4b, 0x40, 0x4,  0x93, 0xa9, 0xa0, 0x6f};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x42, 0xeb, 0x23};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2f, 0x60, 0x76, 0xa2, 0x0,  0x82, 0x24, 0x72, 0xcc, 0xfe,
                                     0x97, 0xe4, 0xab, 0xa,  0x68, 0x56, 0xb4, 0x29, 0x62, 0x9f,
                                     0x44, 0xb7, 0x2c, 0x67, 0x17, 0xca, 0x64, 0xf7};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0xd4, 0x5f, 0xf7, 0x96, 0x52, 0xd9, 0x96, 0x21, 0x42, 0xcd, 0x64, 0x27, 0xbc, 0xdf,
                           0xfe, 0x25, 0xcb, 0xfe, 0x26, 0x1d, 0x68, 0x12, 0x27, 0xbf, 0x5b, 0x68, 0x28, 0xd1};
  uint8_t bytesprops1[] = {0x4d, 0x41, 0x7e, 0x27, 0x26, 0x41};
  uint8_t bytesprops2[] = {0x62, 0x9d, 0x75, 0x96};
  uint8_t bytesprops3[] = {0xba, 0x65, 0x4a, 0xc6, 0xbe, 0xb0, 0x2b, 0x3d, 0x27, 0x13, 0x2f, 0x42, 0xba,
                           0xa9, 0x8e, 0xfd, 0x84, 0xc9, 0x5f, 0x29, 0xb6, 0xae, 0x89, 0xd7, 0xe2, 0x24};
  uint8_t bytesprops5[] = {0x5, 0xbd, 0x29, 0x89, 0x5a, 0x89, 0xa4, 0xbe, 0x16, 0x4a, 0x5a};
  uint8_t bytesprops4[] = {0xc4, 0x54, 0x2b, 0xd5, 0xe8, 0x9a, 0x33, 0x10, 0x50, 0xda, 0x97,
                           0x6c, 0x13, 0x68, 0x45, 0x6e, 0x92, 0xe1, 0x8f, 0x40, 0x1c, 0x88};
  uint8_t bytesprops6[] = {0xc5, 0x1f, 0x46, 0x6,  0x4,  0xba, 0x7e, 0xf6, 0x94, 0xf,  0x53, 0x9,
                           0x2d, 0x7,  0xef, 0xf8, 0x45, 0x8a, 0x3,  0x73, 0x61, 0xca, 0x98, 0x4c};
  uint8_t bytesprops7[] = {0xee, 0xca, 0xec, 0x93, 0x77, 0xdf, 0xab, 0x2,  0xbe, 0xea, 0x75, 0xe9, 0xf2,
                           0xa4, 0x6c, 0x47, 0xfe, 0x9e, 0xc7, 0xe9, 0x73, 0x6c, 0xe4, 0x97, 0x13};
  uint8_t bytesprops9[] = {0x8f, 0x9d, 0x4b, 0xb6, 0x2c, 0xa5, 0xb8, 0xa2, 0x61};
  uint8_t bytesprops8[] = {0x3e, 0x1c, 0x9f, 0xcb, 0x6e, 0xd2, 0x64, 0xe9};
  uint8_t bytesprops10[] = {0x75, 0x54, 0x43};
  uint8_t bytesprops11[] = {0x2c, 0xdb, 0xae, 0xcb, 0xf0, 0xf5, 0xae, 0x13, 0x80, 0x2f, 0xc8,
                            0x2d, 0xb,  0xcb, 0x8d, 0xce, 0xd6, 0xf6, 0x92, 0x22, 0x9d, 0x33};
  uint8_t bytesprops12[] = {0x57, 0xb0, 0xa5, 0x3a, 0x74, 0x65, 0x55, 0x3c, 0x10, 0x0,  0xbc, 0xc,  0x6e, 0x5c,
                            0x2d, 0x53, 0x59, 0x14, 0xd0, 0x64, 0x57, 0x14, 0xf4, 0xe6, 0xa6, 0xdb, 0x43, 0x36};
  uint8_t bytesprops13[] = {0x9e, 0x62, 0xcc, 0x5,  0x17, 0xd0, 0xcc, 0x10, 0x5d,
                            0x55, 0xd7, 0xd0, 0x6d, 0xe,  0x3e, 0xb0, 0x99, 0xc7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28440}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25853}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1969}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops4}, .v = {11, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25529}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21290}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21418}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops8}, .v = {9, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19451}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29070}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5370}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7894}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22949, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26075 [("\230\RS\208\233^^\156",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("%\224",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\243i\159\218$JV\134vJ",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("Oq7\221\r\185\DC1\201\235\133\157\152",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("t\142\NAK)D\139\ENQ\188x\155mV\141\245\134\174\195\GS\187s\231\185\149\t\RSj\FS\NUL\165\217",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\229\234\&5\155\171\154\249^*-;",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS =
// QoS0}),("\241\207\171\132k\CAN+\160\ETB\231\144C\128\166\166ud\201\218Y?\218\161\&9",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropTopicAliasMaximum
// 23913,PropSharedSubscriptionAvailable 9,PropResponseTopic
// "\231\166T*^|\222\250kP\201!l\147\238\250\240\208\146\233z\216f\173\208\RS\ETB",PropSharedSubscriptionAvailable
// 116,PropSessionExpiryInterval 2645,PropSharedSubscriptionAvailable 150,PropTopicAliasMaximum
// 10258,PropMessageExpiryInterval 7567,PropAssignedClientIdentifier
// "(=e\162_\190\152\ETB\207\RS\182l\163\198\DC4\212R\t\241u\187\&3\197^\ETB\227p\223\200",PropPayloadFormatIndicator
// 222,PropPayloadFormatIndicator 175,PropSubscriptionIdentifier 29,PropRetainAvailable 201,PropPayloadFormatIndicator
// 233,PropPayloadFormatIndicator 66,PropResponseTopic "\STX\212",PropAuthenticationData
// "\162\190A#\128+\200H\216\179\241\"a\189\255D\182\220\148\143\247\228\187{.9",PropAuthenticationMethod
// "\220\172H`l<\235\213\128\"\NAK5g\203:q9\245\157\165\245\191\DC1o\244S",PropMaximumQoS 246,PropRetainAvailable
// 48,PropContentType "\217\150E\219,\162\205\NAK\195YUfB\240\136S\200",PropContentType
// "\128\&3\184\DLE\138\226\197\CAN\187\US\242\216",PropMaximumQoS 15,PropMessageExpiryInterval
// 16291,PropAuthenticationMethod "r\219}4\159h\196-\ETBV\142\ETB",PropContentType
// "W\251\179\204\194\178\&7\DC4\n\235A\248I\EOT\246",PropWildcardSubscriptionAvailable 253,PropResponseTopic
// "\250A\129o\196\154U1Do\218\173o\229\146\210\128\SYN",PropWillDelayInterval 22571]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0x83, 0x3,  0x65, 0xdb, 0x8a, 0x2,  0x22, 0x5d, 0x69, 0x2a, 0x9,  0x8,  0x0,  0x1b, 0xe7, 0xa6, 0x54, 0x2a,
      0x5e, 0x7c, 0xde, 0xfa, 0x6b, 0x50, 0xc9, 0x21, 0x6c, 0x93, 0xee, 0xfa, 0xf0, 0xd0, 0x92, 0xe9, 0x7a, 0xd8, 0x66,
      0xad, 0xd0, 0x1e, 0x17, 0x2a, 0x74, 0x11, 0x0,  0x0,  0xa,  0x55, 0x2a, 0x96, 0x22, 0x28, 0x12, 0x2,  0x0,  0x0,
      0x1d, 0x8f, 0x12, 0x0,  0x1d, 0x28, 0x3d, 0x65, 0xa2, 0x5f, 0xbe, 0x98, 0x17, 0xcf, 0x1e, 0xb6, 0x6c, 0xa3, 0xc6,
      0x14, 0xd4, 0x52, 0x9,  0xf1, 0x75, 0xbb, 0x33, 0xc5, 0x5e, 0x17, 0xe3, 0x70, 0xdf, 0xc8, 0x1,  0xde, 0x1,  0xaf,
      0xb,  0x1d, 0x25, 0xc9, 0x1,  0xe9, 0x1,  0x42, 0x8,  0x0,  0x2,  0x2,  0xd4, 0x16, 0x0,  0x1a, 0xa2, 0xbe, 0x41,
      0x23, 0x80, 0x2b, 0xc8, 0x48, 0xd8, 0xb3, 0xf1, 0x22, 0x61, 0xbd, 0xff, 0x44, 0xb6, 0xdc, 0x94, 0x8f, 0xf7, 0xe4,
      0xbb, 0x7b, 0x2e, 0x39, 0x15, 0x0,  0x1a, 0xdc, 0xac, 0x48, 0x60, 0x6c, 0x3c, 0xeb, 0xd5, 0x80, 0x22, 0x15, 0x35,
      0x67, 0xcb, 0x3a, 0x71, 0x39, 0xf5, 0x9d, 0xa5, 0xf5, 0xbf, 0x11, 0x6f, 0xf4, 0x53, 0x24, 0xf6, 0x25, 0x30, 0x3,
      0x0,  0x11, 0xd9, 0x96, 0x45, 0xdb, 0x2c, 0xa2, 0xcd, 0x15, 0xc3, 0x59, 0x55, 0x66, 0x42, 0xf0, 0x88, 0x53, 0xc8,
      0x3,  0x0,  0xc,  0x80, 0x33, 0xb8, 0x10, 0x8a, 0xe2, 0xc5, 0x18, 0xbb, 0x1f, 0xf2, 0xd8, 0x24, 0xf,  0x2,  0x0,
      0x0,  0x3f, 0xa3, 0x15, 0x0,  0xc,  0x72, 0xdb, 0x7d, 0x34, 0x9f, 0x68, 0xc4, 0x2d, 0x17, 0x56, 0x8e, 0x17, 0x3,
      0x0,  0xf,  0x57, 0xfb, 0xb3, 0xcc, 0xc2, 0xb2, 0x37, 0x14, 0xa,  0xeb, 0x41, 0xf8, 0x49, 0x4,  0xf6, 0x28, 0xfd,
      0x8,  0x0,  0x12, 0xfa, 0x41, 0x81, 0x6f, 0xc4, 0x9a, 0x55, 0x31, 0x44, 0x6f, 0xda, 0xad, 0x6f, 0xe5, 0x92, 0xd2,
      0x80, 0x16, 0x18, 0x0,  0x0,  0x58, 0x2b, 0x0,  0x7,  0xe6, 0x1e, 0xd0, 0xe9, 0x5e, 0x5e, 0x9c, 0x26, 0x0,  0x2,
      0x25, 0xe0, 0x25, 0x0,  0xa,  0xf3, 0x69, 0x9f, 0xda, 0x24, 0x4a, 0x56, 0x86, 0x76, 0x4a, 0x12, 0x0,  0xc,  0x4f,
      0x71, 0x37, 0xdd, 0xd,  0xb9, 0x11, 0xc9, 0xeb, 0x85, 0x9d, 0x98, 0x21, 0x0,  0x1e, 0x74, 0x8e, 0x15, 0x29, 0x44,
      0x8b, 0x5,  0xbc, 0x78, 0x9b, 0x6d, 0x56, 0x8d, 0xf5, 0x86, 0xae, 0xc3, 0x1d, 0xbb, 0x73, 0xe7, 0xb9, 0x95, 0x9,
      0x1e, 0x6a, 0x1c, 0x0,  0xa5, 0xd9, 0x0,  0x0,  0xb,  0xe5, 0xea, 0x35, 0x9b, 0xab, 0x9a, 0xf9, 0x5e, 0x2a, 0x2d,
      0x3b, 0x8,  0x0,  0x18, 0xf1, 0xcf, 0xab, 0x84, 0x6b, 0x18, 0x2b, 0xa0, 0x17, 0xe7, 0x90, 0x43, 0x80, 0xa6, 0xa6,
      0x75, 0x64, 0xc9, 0xda, 0x59, 0x3f, 0xda, 0xa1, 0x39, 0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xe6, 0x1e, 0xd0, 0xe9, 0x5e, 0x5e, 0x9c};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x25, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf3, 0x69, 0x9f, 0xda, 0x24, 0x4a, 0x56, 0x86, 0x76, 0x4a};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4f, 0x71, 0x37, 0xdd, 0xd, 0xb9, 0x11, 0xc9, 0xeb, 0x85, 0x9d, 0x98};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x74, 0x8e, 0x15, 0x29, 0x44, 0x8b, 0x5,  0xbc, 0x78, 0x9b,
                                     0x6d, 0x56, 0x8d, 0xf5, 0x86, 0xae, 0xc3, 0x1d, 0xbb, 0x73,
                                     0xe7, 0xb9, 0x95, 0x9,  0x1e, 0x6a, 0x1c, 0x0,  0xa5, 0xd9};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe5, 0xea, 0x35, 0x9b, 0xab, 0x9a, 0xf9, 0x5e, 0x2a, 0x2d, 0x3b};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf1, 0xcf, 0xab, 0x84, 0x6b, 0x18, 0x2b, 0xa0, 0x17, 0xe7, 0x90, 0x43,
                                     0x80, 0xa6, 0xa6, 0x75, 0x64, 0xc9, 0xda, 0x59, 0x3f, 0xda, 0xa1, 0x39};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0xe7, 0xa6, 0x54, 0x2a, 0x5e, 0x7c, 0xde, 0xfa, 0x6b, 0x50, 0xc9, 0x21, 0x6c, 0x93,
                           0xee, 0xfa, 0xf0, 0xd0, 0x92, 0xe9, 0x7a, 0xd8, 0x66, 0xad, 0xd0, 0x1e, 0x17};
  uint8_t bytesprops1[] = {0x28, 0x3d, 0x65, 0xa2, 0x5f, 0xbe, 0x98, 0x17, 0xcf, 0x1e, 0xb6, 0x6c, 0xa3, 0xc6, 0x14,
                           0xd4, 0x52, 0x9,  0xf1, 0x75, 0xbb, 0x33, 0xc5, 0x5e, 0x17, 0xe3, 0x70, 0xdf, 0xc8};
  uint8_t bytesprops2[] = {0x2, 0xd4};
  uint8_t bytesprops3[] = {0xa2, 0xbe, 0x41, 0x23, 0x80, 0x2b, 0xc8, 0x48, 0xd8, 0xb3, 0xf1, 0x22, 0x61,
                           0xbd, 0xff, 0x44, 0xb6, 0xdc, 0x94, 0x8f, 0xf7, 0xe4, 0xbb, 0x7b, 0x2e, 0x39};
  uint8_t bytesprops4[] = {0xdc, 0xac, 0x48, 0x60, 0x6c, 0x3c, 0xeb, 0xd5, 0x80, 0x22, 0x15, 0x35, 0x67,
                           0xcb, 0x3a, 0x71, 0x39, 0xf5, 0x9d, 0xa5, 0xf5, 0xbf, 0x11, 0x6f, 0xf4, 0x53};
  uint8_t bytesprops5[] = {0xd9, 0x96, 0x45, 0xdb, 0x2c, 0xa2, 0xcd, 0x15, 0xc3,
                           0x59, 0x55, 0x66, 0x42, 0xf0, 0x88, 0x53, 0xc8};
  uint8_t bytesprops6[] = {0x80, 0x33, 0xb8, 0x10, 0x8a, 0xe2, 0xc5, 0x18, 0xbb, 0x1f, 0xf2, 0xd8};
  uint8_t bytesprops7[] = {0x72, 0xdb, 0x7d, 0x34, 0x9f, 0x68, 0xc4, 0x2d, 0x17, 0x56, 0x8e, 0x17};
  uint8_t bytesprops8[] = {0x57, 0xfb, 0xb3, 0xcc, 0xc2, 0xb2, 0x37, 0x14, 0xa, 0xeb, 0x41, 0xf8, 0x49, 0x4, 0xf6};
  uint8_t bytesprops9[] = {0xfa, 0x41, 0x81, 0x6f, 0xc4, 0x9a, 0x55, 0x31, 0x44,
                           0x6f, 0xda, 0xad, 0x6f, 0xe5, 0x92, 0xd2, 0x80, 0x16};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23913}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2645}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10258}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7567}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16291}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22571}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26075, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11400 [("\225\&5\173\150\r\146,\248\162\163Y\DEL2|\172\&5%\202\ACK4\172\NUL\167\172p/",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("v[\184U\225<\149\162t\132\235c\194O8\NUL\164\208\ACK_\146\239\233\159",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\197M\bsT\208[\175\238zW@\152\DC4\194)\219",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\t\SI\188\&6\206\242m\207[-]#\NAK\"\232\161\161\ACKh\181;\208",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\163q\148\190U\238\215\136r",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("\DLEsn\GS\187_\137\192\128\ETXz\ENQ\143\137\176U\183\158\ESC\174\213v\143\&9",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),(",\206\248\177)K$\154\&6,n\168?\245\208",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = True, _noLocal = False, _subQoS = QoS0})] [PropRequestResponseInformation 106]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0xa3, 0x1,  0x2c, 0x88, 0x2,  0x19, 0x6a, 0x0,  0x1a, 0xe1, 0x35, 0xad, 0x96, 0xd,  0x92, 0x2c,
                   0xf8, 0xa2, 0xa3, 0x59, 0x7f, 0x32, 0x7c, 0xac, 0x35, 0x25, 0xca, 0x6,  0x34, 0xac, 0x0,  0xa7, 0xac,
                   0x70, 0x2f, 0x19, 0x0,  0x18, 0x76, 0x5b, 0xb8, 0x55, 0xe1, 0x3c, 0x95, 0xa2, 0x74, 0x84, 0xeb, 0x63,
                   0xc2, 0x4f, 0x38, 0x0,  0xa4, 0xd0, 0x6,  0x5f, 0x92, 0xef, 0xe9, 0x9f, 0x19, 0x0,  0x11, 0xc5, 0x4d,
                   0x8,  0x73, 0x54, 0xd0, 0x5b, 0xaf, 0xee, 0x7a, 0x57, 0x40, 0x98, 0x14, 0xc2, 0x29, 0xdb, 0xd,  0x0,
                   0x16, 0x9,  0xf,  0xbc, 0x36, 0xce, 0xf2, 0x6d, 0xcf, 0x5b, 0x2d, 0x5d, 0x23, 0x15, 0x22, 0xe8, 0xa1,
                   0xa1, 0x6,  0x68, 0xb5, 0x3b, 0xd0, 0x20, 0x0,  0x9,  0xa3, 0x71, 0x94, 0xbe, 0x55, 0xee, 0xd7, 0x88,
                   0x72, 0x21, 0x0,  0x18, 0x10, 0x73, 0x6e, 0x1d, 0xbb, 0x5f, 0x89, 0xc0, 0x80, 0x3,  0x7a, 0x5,  0x8f,
                   0x89, 0xb0, 0x55, 0xb7, 0x9e, 0x1b, 0xae, 0xd5, 0x76, 0x8f, 0x39, 0x4,  0x0,  0xf,  0x2c, 0xce, 0xf8,
                   0xb1, 0x29, 0x4b, 0x24, 0x9a, 0x36, 0x2c, 0x6e, 0xa8, 0x3f, 0xf5, 0xd0, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xe1, 0x35, 0xad, 0x96, 0xd,  0x92, 0x2c, 0xf8, 0xa2, 0xa3, 0x59, 0x7f, 0x32,
                                     0x7c, 0xac, 0x35, 0x25, 0xca, 0x6,  0x34, 0xac, 0x0,  0xa7, 0xac, 0x70, 0x2f};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x76, 0x5b, 0xb8, 0x55, 0xe1, 0x3c, 0x95, 0xa2, 0x74, 0x84, 0xeb, 0x63,
                                     0xc2, 0x4f, 0x38, 0x0,  0xa4, 0xd0, 0x6,  0x5f, 0x92, 0xef, 0xe9, 0x9f};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc5, 0x4d, 0x8,  0x73, 0x54, 0xd0, 0x5b, 0xaf, 0xee,
                                     0x7a, 0x57, 0x40, 0x98, 0x14, 0xc2, 0x29, 0xdb};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9,  0xf,  0xbc, 0x36, 0xce, 0xf2, 0x6d, 0xcf, 0x5b, 0x2d, 0x5d,
                                     0x23, 0x15, 0x22, 0xe8, 0xa1, 0xa1, 0x6,  0x68, 0xb5, 0x3b, 0xd0};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa3, 0x71, 0x94, 0xbe, 0x55, 0xee, 0xd7, 0x88, 0x72};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x10, 0x73, 0x6e, 0x1d, 0xbb, 0x5f, 0x89, 0xc0, 0x80, 0x3,  0x7a, 0x5,
                                     0x8f, 0x89, 0xb0, 0x55, 0xb7, 0x9e, 0x1b, 0xae, 0xd5, 0x76, 0x8f, 0x39};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2c, 0xce, 0xf8, 0xb1, 0x29, 0x4b, 0x24, 0x9a,
                                     0x36, 0x2c, 0x6e, 0xa8, 0x3f, 0xf5, 0xd0};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 106}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11400, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30378 [("\197\180 ",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = False, _subQoS =
// QoS2}),("\222\170\NULu[\144\188\r\243\DC3\ETB\245:<^Y\247EW\176W\154\&9f\232\b\a\155",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),(".\147{<\247\180Q\202T.\f\185\134>\DC3n'T\FS\230\201\178}A",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),(">9d\234/%\170N&\242h\234\206\134\134",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("%\217\254\154\133h\199\ACKo%\128\253;_D\137\226\\\175\&9\138\&5\241B\a2\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\241\189ww\ETX\164\226",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("E\180D\152\180\232\246\212\187U\138\209\197\193\160\DC4\164j{\130\253\170",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\201mH\219\192\STX\SUB{H\142Q#",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS0}),("\213\210",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\ENQ]",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropRequestResponseInformation
// 59,PropTopicAlias 944,PropReceiveMaximum 13237,PropTopicAliasMaximum 23923,PropRetainAvailable 252,PropContentType
// "",PropContentType
// "\141\179\244\230`@\DC3\220\213C\SYN\244\SYN\145\188\247U\254\134,\147yK\248)",PropSubscriptionIdentifier
// 5,PropMaximumPacketSize 6461,PropServerReference "?d\DLE\208\168\225\233\188\206",PropSubscriptionIdentifier
// 26,PropAssignedClientIdentifier "*\241\203\230\219LeU\139",PropWildcardSubscriptionAvailable
// 4,PropMessageExpiryInterval 1918,PropMessageExpiryInterval 4697,PropAuthenticationData
// "\135\234\147c[\170>\244\152\193!#\v\SOH\140O\r\244",PropMaximumQoS 63,PropReceiveMaximum 7339,PropTopicAlias
// 1259,PropSessionExpiryInterval 8341]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x82, 0xad, 0x2,  0x76, 0xaa, 0x7b, 0x19, 0x3b, 0x23, 0x3,  0xb0, 0x21, 0x33, 0xb5, 0x22, 0x5d, 0x73, 0x25, 0xfc,
      0x3,  0x0,  0x0,  0x3,  0x0,  0x19, 0x8d, 0xb3, 0xf4, 0xe6, 0x60, 0x40, 0x13, 0xdc, 0xd5, 0x43, 0x16, 0xf4, 0x16,
      0x91, 0xbc, 0xf7, 0x55, 0xfe, 0x86, 0x2c, 0x93, 0x79, 0x4b, 0xf8, 0x29, 0xb,  0x5,  0x27, 0x0,  0x0,  0x19, 0x3d,
      0x1c, 0x0,  0x9,  0x3f, 0x64, 0x10, 0xd0, 0xa8, 0xe1, 0xe9, 0xbc, 0xce, 0xb,  0x1a, 0x12, 0x0,  0x9,  0x2a, 0xf1,
      0xcb, 0xe6, 0xdb, 0x4c, 0x65, 0x55, 0x8b, 0x28, 0x4,  0x2,  0x0,  0x0,  0x7,  0x7e, 0x2,  0x0,  0x0,  0x12, 0x59,
      0x16, 0x0,  0x12, 0x87, 0xea, 0x93, 0x63, 0x5b, 0xaa, 0x3e, 0xf4, 0x98, 0xc1, 0x21, 0x23, 0xb,  0x1,  0x8c, 0x4f,
      0xd,  0xf4, 0x24, 0x3f, 0x21, 0x1c, 0xab, 0x23, 0x4,  0xeb, 0x11, 0x0,  0x0,  0x20, 0x95, 0x0,  0x3,  0xc5, 0xb4,
      0x20, 0x1a, 0x0,  0x1c, 0xde, 0xaa, 0x0,  0x75, 0x5b, 0x90, 0xbc, 0xd,  0xf3, 0x13, 0x17, 0xf5, 0x3a, 0x3c, 0x5e,
      0x59, 0xf7, 0x45, 0x57, 0xb0, 0x57, 0x9a, 0x39, 0x66, 0xe8, 0x8,  0x7,  0x9b, 0x2d, 0x0,  0x18, 0x2e, 0x93, 0x7b,
      0x3c, 0xf7, 0xb4, 0x51, 0xca, 0x54, 0x2e, 0xc,  0xb9, 0x86, 0x3e, 0x13, 0x6e, 0x27, 0x54, 0x1c, 0xe6, 0xc9, 0xb2,
      0x7d, 0x41, 0xe,  0x0,  0xf,  0x3e, 0x39, 0x64, 0xea, 0x2f, 0x25, 0xaa, 0x4e, 0x26, 0xf2, 0x68, 0xea, 0xce, 0x86,
      0x86, 0x22, 0x0,  0x1b, 0x25, 0xd9, 0xfe, 0x9a, 0x85, 0x68, 0xc7, 0x6,  0x6f, 0x25, 0x80, 0xfd, 0x3b, 0x5f, 0x44,
      0x89, 0xe2, 0x5c, 0xaf, 0x39, 0x8a, 0x35, 0xf1, 0x42, 0x7,  0x32, 0xd4, 0xe,  0x0,  0x0,  0x5,  0x0,  0x7,  0xf1,
      0xbd, 0x77, 0x77, 0x3,  0xa4, 0xe2, 0x15, 0x0,  0x16, 0x45, 0xb4, 0x44, 0x98, 0xb4, 0xe8, 0xf6, 0xd4, 0xbb, 0x55,
      0x8a, 0xd1, 0xc5, 0xc1, 0xa0, 0x14, 0xa4, 0x6a, 0x7b, 0x82, 0xfd, 0xaa, 0x29, 0x0,  0xc,  0xc9, 0x6d, 0x48, 0xdb,
      0xc0, 0x2,  0x1a, 0x7b, 0x48, 0x8e, 0x51, 0x23, 0x24, 0x0,  0x2,  0xd5, 0xd2, 0x20, 0x0,  0x2,  0x5,  0x5d, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xc5, 0xb4, 0x20};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xde, 0xaa, 0x0,  0x75, 0x5b, 0x90, 0xbc, 0xd,  0xf3, 0x13,
                                     0x17, 0xf5, 0x3a, 0x3c, 0x5e, 0x59, 0xf7, 0x45, 0x57, 0xb0,
                                     0x57, 0x9a, 0x39, 0x66, 0xe8, 0x8,  0x7,  0x9b};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2e, 0x93, 0x7b, 0x3c, 0xf7, 0xb4, 0x51, 0xca, 0x54, 0x2e, 0xc,  0xb9,
                                     0x86, 0x3e, 0x13, 0x6e, 0x27, 0x54, 0x1c, 0xe6, 0xc9, 0xb2, 0x7d, 0x41};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3e, 0x39, 0x64, 0xea, 0x2f, 0x25, 0xaa, 0x4e,
                                     0x26, 0xf2, 0x68, 0xea, 0xce, 0x86, 0x86};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x25, 0xd9, 0xfe, 0x9a, 0x85, 0x68, 0xc7, 0x6,  0x6f, 0x25, 0x80, 0xfd, 0x3b, 0x5f,
                                     0x44, 0x89, 0xe2, 0x5c, 0xaf, 0x39, 0x8a, 0x35, 0xf1, 0x42, 0x7,  0x32, 0xd4};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf1, 0xbd, 0x77, 0x77, 0x3, 0xa4, 0xe2};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x45, 0xb4, 0x44, 0x98, 0xb4, 0xe8, 0xf6, 0xd4, 0xbb, 0x55, 0x8a,
                                     0xd1, 0xc5, 0xc1, 0xa0, 0x14, 0xa4, 0x6a, 0x7b, 0x82, 0xfd, 0xaa};
  lwmqtt_string_t topic_filter_s7 = {22, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc9, 0x6d, 0x48, 0xdb, 0xc0, 0x2, 0x1a, 0x7b, 0x48, 0x8e, 0x51, 0x23};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xd5, 0xd2};
  lwmqtt_string_t topic_filter_s9 = {2, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x5, 0x5d};
  lwmqtt_string_t topic_filter_s10 = {2, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x8d, 0xb3, 0xf4, 0xe6, 0x60, 0x40, 0x13, 0xdc, 0xd5, 0x43, 0x16, 0xf4, 0x16,
                           0x91, 0xbc, 0xf7, 0x55, 0xfe, 0x86, 0x2c, 0x93, 0x79, 0x4b, 0xf8, 0x29};
  uint8_t bytesprops2[] = {0x3f, 0x64, 0x10, 0xd0, 0xa8, 0xe1, 0xe9, 0xbc, 0xce};
  uint8_t bytesprops3[] = {0x2a, 0xf1, 0xcb, 0xe6, 0xdb, 0x4c, 0x65, 0x55, 0x8b};
  uint8_t bytesprops4[] = {0x87, 0xea, 0x93, 0x63, 0x5b, 0xaa, 0x3e, 0xf4, 0x98,
                           0xc1, 0x21, 0x23, 0xb,  0x1,  0x8c, 0x4f, 0xd,  0xf4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 944}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13237}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23923}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6461}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1918}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4697}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7339}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1259}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8341}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30378, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19363 [("\171\&6)kL\250\200\246\241\214\221\252\198\159`\172N\210\247r\234Q1",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("5\204P\216\&3\131s\130<U\209a\136\183\131",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("QU\168\SYN\199",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\247\236;\229\&9\133\173\208\213T\232\234%\SO\&H\157\193\247\173\DC3\162\CAN\215",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("Lw\SOH\174\223\253}h",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS1}),("\188\156\DLE\147\186;J\202<\236\229\171",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropServerReference
// "1\145\186~\202\162\156\242\234\223}\241\136W\215}O\ETBn\226\STX\228\170'\NUL\250UV\233",PropSubscriptionIdentifierAvailable
// 143,PropAuthenticationMethod
// "?\193\220\DC4\195\223N\192\246x\246:<K\157I\208\204\&6\202\241J\201\210\187\159\188\&8\ESC\136",PropMaximumQoS
// 167,PropSharedSubscriptionAvailable 201,PropMaximumQoS 40,PropTopicAlias 31882,PropAuthenticationMethod
// "_\175\NUL\168}M\220s\142\239\DEL\ETX\203\214\227\207\NULF\186\212\185\208\212\136G\US\145\173",PropReasonString
// "\226;\baD",PropMessageExpiryInterval 1252,PropAuthenticationMethod "\r[\SO",PropResponseTopic
// "L\155\255\139",PropContentType "}N\DC2'\163\185\&9\252y\168>\148\&8\DC4t\225\207\132
// \160\151\204o\EOT_\GS",PropSubscriptionIdentifierAvailable 144,PropSessionExpiryInterval 8274,PropCorrelationData
// "%\ETX\202l9\220V,`\241\205\243u\FS\ETX\179z\172\241\174\128y\CANR\247",PropMaximumQoS 99,PropAuthenticationMethod
// "\206@`\200\221\GS",PropMessageExpiryInterval 32660]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0xc1, 0x2,  0x4b, 0xa3, 0xd5, 0x1,  0x1c, 0x0,  0x1d, 0x31, 0x91, 0xba, 0x7e, 0xca, 0xa2, 0x9c, 0xf2,
      0xea, 0xdf, 0x7d, 0xf1, 0x88, 0x57, 0xd7, 0x7d, 0x4f, 0x17, 0x6e, 0xe2, 0x2,  0xe4, 0xaa, 0x27, 0x0,  0xfa,
      0x55, 0x56, 0xe9, 0x29, 0x8f, 0x15, 0x0,  0x1e, 0x3f, 0xc1, 0xdc, 0x14, 0xc3, 0xdf, 0x4e, 0xc0, 0xf6, 0x78,
      0xf6, 0x3a, 0x3c, 0x4b, 0x9d, 0x49, 0xd0, 0xcc, 0x36, 0xca, 0xf1, 0x4a, 0xc9, 0xd2, 0xbb, 0x9f, 0xbc, 0x38,
      0x1b, 0x88, 0x24, 0xa7, 0x2a, 0xc9, 0x24, 0x28, 0x23, 0x7c, 0x8a, 0x15, 0x0,  0x1c, 0x5f, 0xaf, 0x0,  0xa8,
      0x7d, 0x4d, 0xdc, 0x73, 0x8e, 0xef, 0x7f, 0x3,  0xcb, 0xd6, 0xe3, 0xcf, 0x0,  0x46, 0xba, 0xd4, 0xb9, 0xd0,
      0xd4, 0x88, 0x47, 0x1f, 0x91, 0xad, 0x1f, 0x0,  0x5,  0xe2, 0x3b, 0x8,  0x61, 0x44, 0x2,  0x0,  0x0,  0x4,
      0xe4, 0x15, 0x0,  0x3,  0xd,  0x5b, 0xe,  0x8,  0x0,  0x4,  0x4c, 0x9b, 0xff, 0x8b, 0x3,  0x0,  0x1a, 0x7d,
      0x4e, 0x12, 0x27, 0xa3, 0xb9, 0x39, 0xfc, 0x79, 0xa8, 0x3e, 0x94, 0x38, 0x14, 0x74, 0xe1, 0xcf, 0x84, 0x20,
      0xa0, 0x97, 0xcc, 0x6f, 0x4,  0x5f, 0x1d, 0x29, 0x90, 0x11, 0x0,  0x0,  0x20, 0x52, 0x9,  0x0,  0x19, 0x25,
      0x3,  0xca, 0x6c, 0x39, 0xdc, 0x56, 0x2c, 0x60, 0xf1, 0xcd, 0xf3, 0x75, 0x1c, 0x3,  0xb3, 0x7a, 0xac, 0xf1,
      0xae, 0x80, 0x79, 0x18, 0x52, 0xf7, 0x24, 0x63, 0x15, 0x0,  0x6,  0xce, 0x40, 0x60, 0xc8, 0xdd, 0x1d, 0x2,
      0x0,  0x0,  0x7f, 0x94, 0x0,  0x17, 0xab, 0x36, 0x29, 0x6b, 0x4c, 0xfa, 0xc8, 0xf6, 0xf1, 0xd6, 0xdd, 0xfc,
      0xc6, 0x9f, 0x60, 0xac, 0x4e, 0xd2, 0xf7, 0x72, 0xea, 0x51, 0x31, 0x19, 0x0,  0xf,  0x35, 0xcc, 0x50, 0xd8,
      0x33, 0x83, 0x73, 0x82, 0x3c, 0x55, 0xd1, 0x61, 0x88, 0xb7, 0x83, 0x22, 0x0,  0x5,  0x51, 0x55, 0xa8, 0x16,
      0xc7, 0x2d, 0x0,  0x17, 0xf7, 0xec, 0x3b, 0xe5, 0x39, 0x85, 0xad, 0xd0, 0xd5, 0x54, 0xe8, 0xea, 0x25, 0xe,
      0x48, 0x9d, 0xc1, 0xf7, 0xad, 0x13, 0xa2, 0x18, 0xd7, 0xd,  0x0,  0x8,  0x4c, 0x77, 0x1,  0xae, 0xdf, 0xfd,
      0x7d, 0x68, 0x25, 0x0,  0xc,  0xbc, 0x9c, 0x10, 0x93, 0xba, 0x3b, 0x4a, 0xca, 0x3c, 0xec, 0xe5, 0xab, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x36, 0x29, 0x6b, 0x4c, 0xfa, 0xc8, 0xf6, 0xf1, 0xd6, 0xdd, 0xfc,
                                     0xc6, 0x9f, 0x60, 0xac, 0x4e, 0xd2, 0xf7, 0x72, 0xea, 0x51, 0x31};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x35, 0xcc, 0x50, 0xd8, 0x33, 0x83, 0x73, 0x82,
                                     0x3c, 0x55, 0xd1, 0x61, 0x88, 0xb7, 0x83};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x51, 0x55, 0xa8, 0x16, 0xc7};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf7, 0xec, 0x3b, 0xe5, 0x39, 0x85, 0xad, 0xd0, 0xd5, 0x54, 0xe8, 0xea,
                                     0x25, 0xe,  0x48, 0x9d, 0xc1, 0xf7, 0xad, 0x13, 0xa2, 0x18, 0xd7};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4c, 0x77, 0x1, 0xae, 0xdf, 0xfd, 0x7d, 0x68};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xbc, 0x9c, 0x10, 0x93, 0xba, 0x3b, 0x4a, 0xca, 0x3c, 0xec, 0xe5, 0xab};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0x31, 0x91, 0xba, 0x7e, 0xca, 0xa2, 0x9c, 0xf2, 0xea, 0xdf, 0x7d, 0xf1, 0x88, 0x57, 0xd7,
                           0x7d, 0x4f, 0x17, 0x6e, 0xe2, 0x2,  0xe4, 0xaa, 0x27, 0x0,  0xfa, 0x55, 0x56, 0xe9};
  uint8_t bytesprops1[] = {0x3f, 0xc1, 0xdc, 0x14, 0xc3, 0xdf, 0x4e, 0xc0, 0xf6, 0x78, 0xf6, 0x3a, 0x3c, 0x4b, 0x9d,
                           0x49, 0xd0, 0xcc, 0x36, 0xca, 0xf1, 0x4a, 0xc9, 0xd2, 0xbb, 0x9f, 0xbc, 0x38, 0x1b, 0x88};
  uint8_t bytesprops2[] = {0x5f, 0xaf, 0x0, 0xa8, 0x7d, 0x4d, 0xdc, 0x73, 0x8e, 0xef, 0x7f, 0x3,  0xcb, 0xd6,
                           0xe3, 0xcf, 0x0, 0x46, 0xba, 0xd4, 0xb9, 0xd0, 0xd4, 0x88, 0x47, 0x1f, 0x91, 0xad};
  uint8_t bytesprops3[] = {0xe2, 0x3b, 0x8, 0x61, 0x44};
  uint8_t bytesprops4[] = {0xd, 0x5b, 0xe};
  uint8_t bytesprops5[] = {0x4c, 0x9b, 0xff, 0x8b};
  uint8_t bytesprops6[] = {0x7d, 0x4e, 0x12, 0x27, 0xa3, 0xb9, 0x39, 0xfc, 0x79, 0xa8, 0x3e, 0x94, 0x38,
                           0x14, 0x74, 0xe1, 0xcf, 0x84, 0x20, 0xa0, 0x97, 0xcc, 0x6f, 0x4,  0x5f, 0x1d};
  uint8_t bytesprops7[] = {0x25, 0x3, 0xca, 0x6c, 0x39, 0xdc, 0x56, 0x2c, 0x60, 0xf1, 0xcd, 0xf3, 0x75,
                           0x1c, 0x3, 0xb3, 0x7a, 0xac, 0xf1, 0xae, 0x80, 0x79, 0x18, 0x52, 0xf7};
  uint8_t bytesprops8[] = {0xce, 0x40, 0x60, 0xc8, 0xdd, 0x1d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31882}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1252}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8274}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32660}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19363, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9790 [("\228F\148\174g\141\DC4\140\249o\196",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\177\151IY\145b\217z\r\205(B\253yT[~Z\183f\246^_IZ",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\n\173\216\DC2G\235Y\189fi\DC1\185g\229\bEH\252F\242\216\ACK\231\243\237\242",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),(">A",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\163\133MU\FSV\131
// V\b\ESC\210U\147\&0ma\248",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS0}),("\250.\ETBh\239;\217\248\159\219\202\SOH\FS\135\218 \219\&3\ENQ\153s\199",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\207\SI/?@\201.\216\171h\187\128\242o|\144\158z,W\207\136",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropMessageExpiryInterval 28136,PropRetainAvailable
// 88,PropTopicAliasMaximum 14486,PropMaximumPacketSize 10234,PropPayloadFormatIndicator 110]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0xa7, 0x1,  0x26, 0x3e, 0x11, 0x2,  0x0,  0x0,  0x6d, 0xe8, 0x25, 0x58, 0x22, 0x38, 0x96, 0x27,
                   0x0,  0x0,  0x27, 0xfa, 0x1,  0x6e, 0x0,  0xb,  0xe4, 0x46, 0x94, 0xae, 0x67, 0x8d, 0x14, 0x8c, 0xf9,
                   0x6f, 0xc4, 0x1c, 0x0,  0x19, 0xb1, 0x97, 0x49, 0x59, 0x91, 0x62, 0xd9, 0x7a, 0xd,  0xcd, 0x28, 0x42,
                   0xfd, 0x79, 0x54, 0x5b, 0x7e, 0x5a, 0xb7, 0x66, 0xf6, 0x5e, 0x5f, 0x49, 0x5a, 0x20, 0x0,  0x1a, 0xa,
                   0xad, 0xd8, 0x12, 0x47, 0xeb, 0x59, 0xbd, 0x66, 0x69, 0x11, 0xb9, 0x67, 0xe5, 0x8,  0x45, 0x48, 0xfc,
                   0x46, 0xf2, 0xd8, 0x6,  0xe7, 0xf3, 0xed, 0xf2, 0xa,  0x0,  0x2,  0x3e, 0x41, 0xd,  0x0,  0x12, 0xa3,
                   0x85, 0x4d, 0x55, 0x1c, 0x56, 0x83, 0x20, 0x56, 0x8,  0x1b, 0xd2, 0x55, 0x93, 0x30, 0x6d, 0x61, 0xf8,
                   0x24, 0x0,  0x16, 0xfa, 0x2e, 0x17, 0x68, 0xef, 0x3b, 0xd9, 0xf8, 0x9f, 0xdb, 0xca, 0x1,  0x1c, 0x87,
                   0xda, 0x20, 0xdb, 0x33, 0x5,  0x99, 0x73, 0xc7, 0xa,  0x0,  0x16, 0xcf, 0xf,  0x2f, 0x3f, 0x40, 0xc9,
                   0x2e, 0xd8, 0xab, 0x68, 0xbb, 0x80, 0xf2, 0x6f, 0x7c, 0x90, 0x9e, 0x7a, 0x2c, 0x57, 0xcf, 0x88, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xe4, 0x46, 0x94, 0xae, 0x67, 0x8d, 0x14, 0x8c, 0xf9, 0x6f, 0xc4};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb1, 0x97, 0x49, 0x59, 0x91, 0x62, 0xd9, 0x7a, 0xd,  0xcd, 0x28, 0x42, 0xfd,
                                     0x79, 0x54, 0x5b, 0x7e, 0x5a, 0xb7, 0x66, 0xf6, 0x5e, 0x5f, 0x49, 0x5a};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa,  0xad, 0xd8, 0x12, 0x47, 0xeb, 0x59, 0xbd, 0x66, 0x69, 0x11, 0xb9, 0x67,
                                     0xe5, 0x8,  0x45, 0x48, 0xfc, 0x46, 0xf2, 0xd8, 0x6,  0xe7, 0xf3, 0xed, 0xf2};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3e, 0x41};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa3, 0x85, 0x4d, 0x55, 0x1c, 0x56, 0x83, 0x20, 0x56,
                                     0x8,  0x1b, 0xd2, 0x55, 0x93, 0x30, 0x6d, 0x61, 0xf8};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfa, 0x2e, 0x17, 0x68, 0xef, 0x3b, 0xd9, 0xf8, 0x9f, 0xdb, 0xca,
                                     0x1,  0x1c, 0x87, 0xda, 0x20, 0xdb, 0x33, 0x5,  0x99, 0x73, 0xc7};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xcf, 0xf,  0x2f, 0x3f, 0x40, 0xc9, 0x2e, 0xd8, 0xab, 0x68, 0xbb,
                                     0x80, 0xf2, 0x6f, 0x7c, 0x90, 0x9e, 0x7a, 0x2c, 0x57, 0xcf, 0x88};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28136}},  {.prop = (lwmqtt_prop_t)37, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14486}}, {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10234}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 110}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9790, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29850 [("\ESC\148a",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS =
// QoS2}),("e\"\230B\SYNNm^{\160\218\FS\152\238\232\143\135\180\197\251D\202\205n\STX\161\f\175\165}",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("]\RS\172\169\198\239\243#\136\243\DC37n\177\215k\167\243",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("Q\129=ls\SI\233\136\246\208\170\188\SUBg\134\155B",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("[=",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\174\230\194'q",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\\%\201\190\183\&1\138\217=~\181c\233?\138\160X",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\SI\159f\134\CAN%\254\185\194T\216\145[\248\229\214>\170\216\164",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\164r\209\EOTC\218[-BMGq\236>M\194\139H\216\165:R\132t\179\224\157C\147%",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropMessageExpiryInterval
// 26319,PropSubscriptionIdentifier 27,PropAuthenticationMethod
// "\SOH\200\&0\232\SI\ACK\236\165P\233&\222\255\231\SO\200\128sY\162(|!\196\SI\247",PropServerReference
// "vO\174\253d8\v\150\DC2\STX\187^\am\192%\153w\DC2\205\v",PropCorrelationData "9\f\138b\248L\160\160\151
// \GS\221",PropMessageExpiryInterval 11750,PropTopicAliasMaximum 14828,PropAuthenticationMethod
// "\140\188?\ACKn\238\FSL\NAK\DC1\SYNfM\166\t\162\ACK\221\212\154\t+\181S\152\SUB",PropMessageExpiryInterval
// 10067,PropRetainAvailable 35,PropServerKeepAlive 9584,PropAssignedClientIdentifier
// "<\209\173Y",PropMessageExpiryInterval 12571,PropTopicAliasMaximum 10964,PropPayloadFormatIndicator
// 229,PropAssignedClientIdentifier "\164\156\187",PropServerReference
// "\213\188\SYN\ENQ\232\182j\203\NAK\158",PropSubscriptionIdentifierAvailable 125,PropRetainAvailable
// 81,PropSharedSubscriptionAvailable 18,PropPayloadFormatIndicator 82,PropAssignedClientIdentifier
// "3\236;\DC4\134\228\232\182\245\167rK\247\169\184\166\&7]\DEL\STX5",PropReasonString "\STX\SYNg0\178\143\157y\208\&9
// K<\133\244\232\t_\218,@\174Q\237\156",PropTopicAliasMaximum 964]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x82, 0x8a, 0x3,  0x74, 0x9a, 0xdd, 0x1,  0x2,  0x0,  0x0,  0x66, 0xcf, 0xb,  0x1b, 0x15, 0x0,  0x1a, 0x1,  0xc8,
      0x30, 0xe8, 0xf,  0x6,  0xec, 0xa5, 0x50, 0xe9, 0x26, 0xde, 0xff, 0xe7, 0xe,  0xc8, 0x80, 0x73, 0x59, 0xa2, 0x28,
      0x7c, 0x21, 0xc4, 0xf,  0xf7, 0x1c, 0x0,  0x15, 0x76, 0x4f, 0xae, 0xfd, 0x64, 0x38, 0xb,  0x96, 0x12, 0x2,  0xbb,
      0x5e, 0x7,  0x6d, 0xc0, 0x25, 0x99, 0x77, 0x12, 0xcd, 0xb,  0x9,  0x0,  0xc,  0x39, 0xc,  0x8a, 0x62, 0xf8, 0x4c,
      0xa0, 0xa0, 0x97, 0x20, 0x1d, 0xdd, 0x2,  0x0,  0x0,  0x2d, 0xe6, 0x22, 0x39, 0xec, 0x15, 0x0,  0x1a, 0x8c, 0xbc,
      0x3f, 0x6,  0x6e, 0xee, 0x1c, 0x4c, 0x15, 0x11, 0x16, 0x66, 0x4d, 0xa6, 0x9,  0xa2, 0x6,  0xdd, 0xd4, 0x9a, 0x9,
      0x2b, 0xb5, 0x53, 0x98, 0x1a, 0x2,  0x0,  0x0,  0x27, 0x53, 0x25, 0x23, 0x13, 0x25, 0x70, 0x12, 0x0,  0x4,  0x3c,
      0xd1, 0xad, 0x59, 0x2,  0x0,  0x0,  0x31, 0x1b, 0x22, 0x2a, 0xd4, 0x1,  0xe5, 0x12, 0x0,  0x3,  0xa4, 0x9c, 0xbb,
      0x1c, 0x0,  0xa,  0xd5, 0xbc, 0x16, 0x5,  0xe8, 0xb6, 0x6a, 0xcb, 0x15, 0x9e, 0x29, 0x7d, 0x25, 0x51, 0x2a, 0x12,
      0x1,  0x52, 0x12, 0x0,  0x15, 0x33, 0xec, 0x3b, 0x14, 0x86, 0xe4, 0xe8, 0xb6, 0xf5, 0xa7, 0x72, 0x4b, 0xf7, 0xa9,
      0xb8, 0xa6, 0x37, 0x5d, 0x7f, 0x2,  0x35, 0x1f, 0x0,  0x19, 0x2,  0x16, 0x67, 0x30, 0xb2, 0x8f, 0x9d, 0x79, 0xd0,
      0x39, 0x20, 0x4b, 0x3c, 0x85, 0xf4, 0xe8, 0x9,  0x5f, 0xda, 0x2c, 0x40, 0xae, 0x51, 0xed, 0x9c, 0x22, 0x3,  0xc4,
      0x0,  0x3,  0x1b, 0x94, 0x61, 0x26, 0x0,  0x1e, 0x65, 0x22, 0xe6, 0x42, 0x16, 0x4e, 0x6d, 0x5e, 0x7b, 0xa0, 0xda,
      0x1c, 0x98, 0xee, 0xe8, 0x8f, 0x87, 0xb4, 0xc5, 0xfb, 0x44, 0xca, 0xcd, 0x6e, 0x2,  0xa1, 0xc,  0xaf, 0xa5, 0x7d,
      0x0,  0x0,  0x12, 0x5d, 0x1e, 0xac, 0xa9, 0xc6, 0xef, 0xf3, 0x23, 0x88, 0xf3, 0x13, 0x37, 0x6e, 0xb1, 0xd7, 0x6b,
      0xa7, 0xf3, 0x5,  0x0,  0x11, 0x51, 0x81, 0x3d, 0x6c, 0x73, 0xf,  0xe9, 0x88, 0xf6, 0xd0, 0xaa, 0xbc, 0x1a, 0x67,
      0x86, 0x9b, 0x42, 0x20, 0x0,  0x2,  0x5b, 0x3d, 0x14, 0x0,  0x5,  0xae, 0xe6, 0xc2, 0x27, 0x71, 0x12, 0x0,  0x11,
      0x5c, 0x25, 0xc9, 0xbe, 0xb7, 0x31, 0x8a, 0xd9, 0x3d, 0x7e, 0xb5, 0x63, 0xe9, 0x3f, 0x8a, 0xa0, 0x58, 0x19, 0x0,
      0x14, 0xf,  0x9f, 0x66, 0x86, 0x18, 0x25, 0xfe, 0xb9, 0xc2, 0x54, 0xd8, 0x91, 0x5b, 0xf8, 0xe5, 0xd6, 0x3e, 0xaa,
      0xd8, 0xa4, 0x15, 0x0,  0x1e, 0xa4, 0x72, 0xd1, 0x4,  0x43, 0xda, 0x5b, 0x2d, 0x42, 0x4d, 0x47, 0x71, 0xec, 0x3e,
      0x4d, 0xc2, 0x8b, 0x48, 0xd8, 0xa5, 0x3a, 0x52, 0x84, 0x74, 0xb3, 0xe0, 0x9d, 0x43, 0x93, 0x25, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x1b, 0x94, 0x61};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x65, 0x22, 0xe6, 0x42, 0x16, 0x4e, 0x6d, 0x5e, 0x7b, 0xa0,
                                     0xda, 0x1c, 0x98, 0xee, 0xe8, 0x8f, 0x87, 0xb4, 0xc5, 0xfb,
                                     0x44, 0xca, 0xcd, 0x6e, 0x2,  0xa1, 0xc,  0xaf, 0xa5, 0x7d};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5d, 0x1e, 0xac, 0xa9, 0xc6, 0xef, 0xf3, 0x23, 0x88,
                                     0xf3, 0x13, 0x37, 0x6e, 0xb1, 0xd7, 0x6b, 0xa7, 0xf3};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x51, 0x81, 0x3d, 0x6c, 0x73, 0xf,  0xe9, 0x88, 0xf6,
                                     0xd0, 0xaa, 0xbc, 0x1a, 0x67, 0x86, 0x9b, 0x42};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5b, 0x3d};
  lwmqtt_string_t topic_filter_s4 = {2, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xae, 0xe6, 0xc2, 0x27, 0x71};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x5c, 0x25, 0xc9, 0xbe, 0xb7, 0x31, 0x8a, 0xd9, 0x3d,
                                     0x7e, 0xb5, 0x63, 0xe9, 0x3f, 0x8a, 0xa0, 0x58};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf,  0x9f, 0x66, 0x86, 0x18, 0x25, 0xfe, 0xb9, 0xc2, 0x54,
                                     0xd8, 0x91, 0x5b, 0xf8, 0xe5, 0xd6, 0x3e, 0xaa, 0xd8, 0xa4};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa4, 0x72, 0xd1, 0x4,  0x43, 0xda, 0x5b, 0x2d, 0x42, 0x4d,
                                     0x47, 0x71, 0xec, 0x3e, 0x4d, 0xc2, 0x8b, 0x48, 0xd8, 0xa5,
                                     0x3a, 0x52, 0x84, 0x74, 0xb3, 0xe0, 0x9d, 0x43, 0x93, 0x25};
  lwmqtt_string_t topic_filter_s8 = {30, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0x1,  0xc8, 0x30, 0xe8, 0xf,  0x6,  0xec, 0xa5, 0x50, 0xe9, 0x26, 0xde, 0xff,
                           0xe7, 0xe,  0xc8, 0x80, 0x73, 0x59, 0xa2, 0x28, 0x7c, 0x21, 0xc4, 0xf,  0xf7};
  uint8_t bytesprops1[] = {0x76, 0x4f, 0xae, 0xfd, 0x64, 0x38, 0xb,  0x96, 0x12, 0x2, 0xbb,
                           0x5e, 0x7,  0x6d, 0xc0, 0x25, 0x99, 0x77, 0x12, 0xcd, 0xb};
  uint8_t bytesprops2[] = {0x39, 0xc, 0x8a, 0x62, 0xf8, 0x4c, 0xa0, 0xa0, 0x97, 0x20, 0x1d, 0xdd};
  uint8_t bytesprops3[] = {0x8c, 0xbc, 0x3f, 0x6, 0x6e, 0xee, 0x1c, 0x4c, 0x15, 0x11, 0x16, 0x66, 0x4d,
                           0xa6, 0x9,  0xa2, 0x6, 0xdd, 0xd4, 0x9a, 0x9,  0x2b, 0xb5, 0x53, 0x98, 0x1a};
  uint8_t bytesprops4[] = {0x3c, 0xd1, 0xad, 0x59};
  uint8_t bytesprops5[] = {0xa4, 0x9c, 0xbb};
  uint8_t bytesprops6[] = {0xd5, 0xbc, 0x16, 0x5, 0xe8, 0xb6, 0x6a, 0xcb, 0x15, 0x9e};
  uint8_t bytesprops7[] = {0x33, 0xec, 0x3b, 0x14, 0x86, 0xe4, 0xe8, 0xb6, 0xf5, 0xa7, 0x72,
                           0x4b, 0xf7, 0xa9, 0xb8, 0xa6, 0x37, 0x5d, 0x7f, 0x2,  0x35};
  uint8_t bytesprops8[] = {0x2,  0x16, 0x67, 0x30, 0xb2, 0x8f, 0x9d, 0x79, 0xd0, 0x39, 0x20, 0x4b, 0x3c,
                           0x85, 0xf4, 0xe8, 0x9,  0x5f, 0xda, 0x2c, 0x40, 0xae, 0x51, 0xed, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26319}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11750}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14828}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10067}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9584}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12571}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10964}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 964}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29850, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18338 [("\162\249\GS\153yq\215F\221 \242",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\158\168o!e\ACK\247\202\128\152f\197m\\\176\247(\167\US\214\188ti\225\192",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})]
// [PropWildcardSubscriptionAvailable 74,PropCorrelationData
// "\212\&9\241\219\226\155\134$\130\148\ETB",PropServerReference
// "\133\186\RS\134\232\203\&7\160\143\156BI\221",PropServerKeepAlive 21739,PropTopicAlias
// 16767,PropRequestResponseInformation 119,PropTopicAliasMaximum 17366,PropUserProperty
// "\242\188u\255\247\210E\191yL\224%\a\189\209\159\207&\246\209\DEL"
// "\155\&83\197\178\150\144|\151DO",PropReceiveMaximum 15132,PropWildcardSubscriptionAvailable
// 163,PropMessageExpiryInterval 24957,PropAssignedClientIdentifier
// "N\225O\f\254\177\232\162\171OZ\t\201\163x",PropWildcardSubscriptionAvailable 94,PropReceiveMaximum
// 29341,PropSubscriptionIdentifierAvailable 220,PropReceiveMaximum 73,PropCorrelationData
// "i\128\206\251\215,\255~\ACK\RS",PropReceiveMaximum 731,PropSessionExpiryInterval 14347]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x82, 0xb9, 0x1,  0x47, 0xa2, 0x8b, 0x1,  0x28, 0x4a, 0x9,  0x0,  0xb,  0xd4, 0x39, 0xf1, 0xdb, 0xe2, 0x9b, 0x86,
      0x24, 0x82, 0x94, 0x17, 0x1c, 0x0,  0xd,  0x85, 0xba, 0x1e, 0x86, 0xe8, 0xcb, 0x37, 0xa0, 0x8f, 0x9c, 0x42, 0x49,
      0xdd, 0x13, 0x54, 0xeb, 0x23, 0x41, 0x7f, 0x19, 0x77, 0x22, 0x43, 0xd6, 0x26, 0x0,  0x15, 0xf2, 0xbc, 0x75, 0xff,
      0xf7, 0xd2, 0x45, 0xbf, 0x79, 0x4c, 0xe0, 0x25, 0x7,  0xbd, 0xd1, 0x9f, 0xcf, 0x26, 0xf6, 0xd1, 0x7f, 0x0,  0xb,
      0x9b, 0x38, 0x33, 0xc5, 0xb2, 0x96, 0x90, 0x7c, 0x97, 0x44, 0x4f, 0x21, 0x3b, 0x1c, 0x28, 0xa3, 0x2,  0x0,  0x0,
      0x61, 0x7d, 0x12, 0x0,  0xf,  0x4e, 0xe1, 0x4f, 0xc,  0xfe, 0xb1, 0xe8, 0xa2, 0xab, 0x4f, 0x5a, 0x9,  0xc9, 0xa3,
      0x78, 0x28, 0x5e, 0x21, 0x72, 0x9d, 0x29, 0xdc, 0x21, 0x0,  0x49, 0x9,  0x0,  0xa,  0x69, 0x80, 0xce, 0xfb, 0xd7,
      0x2c, 0xff, 0x7e, 0x6,  0x1e, 0x21, 0x2,  0xdb, 0x11, 0x0,  0x0,  0x38, 0xb,  0x0,  0xb,  0xa2, 0xf9, 0x1d, 0x99,
      0x79, 0x71, 0xd7, 0x46, 0xdd, 0x20, 0xf2, 0x1c, 0x0,  0x19, 0x9e, 0xa8, 0x6f, 0x21, 0x65, 0x6,  0xf7, 0xca, 0x80,
      0x98, 0x66, 0xc5, 0x6d, 0x5c, 0xb0, 0xf7, 0x28, 0xa7, 0x1f, 0xd6, 0xbc, 0x74, 0x69, 0xe1, 0xc0, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xa2, 0xf9, 0x1d, 0x99, 0x79, 0x71, 0xd7, 0x46, 0xdd, 0x20, 0xf2};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9e, 0xa8, 0x6f, 0x21, 0x65, 0x6,  0xf7, 0xca, 0x80, 0x98, 0x66, 0xc5, 0x6d,
                                     0x5c, 0xb0, 0xf7, 0x28, 0xa7, 0x1f, 0xd6, 0xbc, 0x74, 0x69, 0xe1, 0xc0};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0xd4, 0x39, 0xf1, 0xdb, 0xe2, 0x9b, 0x86, 0x24, 0x82, 0x94, 0x17};
  uint8_t bytesprops1[] = {0x85, 0xba, 0x1e, 0x86, 0xe8, 0xcb, 0x37, 0xa0, 0x8f, 0x9c, 0x42, 0x49, 0xdd};
  uint8_t bytesprops3[] = {0x9b, 0x38, 0x33, 0xc5, 0xb2, 0x96, 0x90, 0x7c, 0x97, 0x44, 0x4f};
  uint8_t bytesprops2[] = {0xf2, 0xbc, 0x75, 0xff, 0xf7, 0xd2, 0x45, 0xbf, 0x79, 0x4c, 0xe0,
                           0x25, 0x7,  0xbd, 0xd1, 0x9f, 0xcf, 0x26, 0xf6, 0xd1, 0x7f};
  uint8_t bytesprops4[] = {0x4e, 0xe1, 0x4f, 0xc, 0xfe, 0xb1, 0xe8, 0xa2, 0xab, 0x4f, 0x5a, 0x9, 0xc9, 0xa3, 0x78};
  uint8_t bytesprops5[] = {0x69, 0x80, 0xce, 0xfb, 0xd7, 0x2c, 0xff, 0x7e, 0x6, 0x1e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21739}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16767}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17366}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops2}, .v = {11, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15132}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24957}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29341}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 73}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 731}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14347}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18338, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4108 [("\199\233\131\SYNf\210",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = True, _noLocal = False, _subQoS =
// QoS0}),("j\199\156\237c\EMH\246\212\232\&7\217aJ\193/\r\253\246>\215\t\221",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("c\FSd\247?\136\249Y\DELc\167\ETX\185",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = False, _noLocal = True, _subQoS =
// QoS1}),("\165\213\140\159\225\192\145\NAK$mr\141CDwEw\US\152\180\NAK\GSO\142\188r",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\162\247i\170\139\236sr-\177\215M3e\144\ETX3#\STX`s&\254i\233\179\128\142\SI",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("[k\181}\136\187j<\FS\142\DC4\186\157\214\162",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\202\191;\254\&7%\136\210:\NAKeE\203\&0\DC1\nlG*@\183",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("X\134i\144\&7x\198",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\SO9;\183,",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\SOJ\248\&8\219-jq\145\166\228\144\139\DC4M\SYN\245\220\150.\193K\178\&3\149\132D",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})]
// [PropSubscriptionIdentifierAvailable 201,PropResponseTopic
// "i\161o\252W\176m\244u<\139\191mc\222\238K\177\243\166",PropTopicAliasMaximum 30251,PropReceiveMaximum
// 3997,PropCorrelationData "\208r\ETX\173C",PropRequestProblemInformation 50,PropTopicAlias
// 222,PropMessageExpiryInterval 2395]
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x82, 0x81, 0x2,  0x10, 0xc,  0x31, 0x29, 0xc9, 0x8,  0x0,  0x14, 0x69, 0xa1, 0x6f, 0xfc, 0x57, 0xb0, 0x6d, 0xf4,
      0x75, 0x3c, 0x8b, 0xbf, 0x6d, 0x63, 0xde, 0xee, 0x4b, 0xb1, 0xf3, 0xa6, 0x22, 0x76, 0x2b, 0x21, 0xf,  0x9d, 0x9,
      0x0,  0x5,  0xd0, 0x72, 0x3,  0xad, 0x43, 0x17, 0x32, 0x23, 0x0,  0xde, 0x2,  0x0,  0x0,  0x9,  0x5b, 0x0,  0x6,
      0xc7, 0xe9, 0x83, 0x16, 0x66, 0xd2, 0x18, 0x0,  0x17, 0x6a, 0xc7, 0x9c, 0xed, 0x63, 0x19, 0x48, 0xf6, 0xd4, 0xe8,
      0x37, 0xd9, 0x61, 0x4a, 0xc1, 0x2f, 0xd,  0xfd, 0xf6, 0x3e, 0xd7, 0x9,  0xdd, 0x14, 0x0,  0xd,  0x63, 0x1c, 0x64,
      0xf7, 0x3f, 0x88, 0xf9, 0x59, 0x7f, 0x63, 0xa7, 0x3,  0xb9, 0x25, 0x0,  0x1a, 0xa5, 0xd5, 0x8c, 0x9f, 0xe1, 0xc0,
      0x91, 0x15, 0x24, 0x6d, 0x72, 0x8d, 0x43, 0x44, 0x77, 0x45, 0x77, 0x1f, 0x98, 0xb4, 0x15, 0x1d, 0x4f, 0x8e, 0xbc,
      0x72, 0x2,  0x0,  0x1d, 0xa2, 0xf7, 0x69, 0xaa, 0x8b, 0xec, 0x73, 0x72, 0x2d, 0xb1, 0xd7, 0x4d, 0x33, 0x65, 0x90,
      0x3,  0x33, 0x23, 0x2,  0x60, 0x73, 0x26, 0xfe, 0x69, 0xe9, 0xb3, 0x80, 0x8e, 0xf,  0xd,  0x0,  0xf,  0x5b, 0x6b,
      0xb5, 0x7d, 0x88, 0xbb, 0x6a, 0x3c, 0x1c, 0x8e, 0x14, 0xba, 0x9d, 0xd6, 0xa2, 0x26, 0x0,  0x15, 0xca, 0xbf, 0x3b,
      0xfe, 0x37, 0x25, 0x88, 0xd2, 0x3a, 0x15, 0x65, 0x45, 0xcb, 0x30, 0x11, 0xa,  0x6c, 0x47, 0x2a, 0x40, 0xb7, 0x19,
      0x0,  0x7,  0x58, 0x86, 0x69, 0x90, 0x37, 0x78, 0xc6, 0x1e, 0x0,  0x5,  0xe,  0x39, 0x3b, 0xb7, 0x2c, 0x6,  0x0,
      0x1b, 0xe,  0x4a, 0xf8, 0x38, 0xdb, 0x2d, 0x6a, 0x71, 0x91, 0xa6, 0xe4, 0x90, 0x8b, 0x14, 0x4d, 0x16, 0xf5, 0xdc,
      0x96, 0x2e, 0xc1, 0x4b, 0xb2, 0x33, 0x95, 0x84, 0x44, 0x24, 0x0,  0x0,  0x5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xc7, 0xe9, 0x83, 0x16, 0x66, 0xd2};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0xc7, 0x9c, 0xed, 0x63, 0x19, 0x48, 0xf6, 0xd4, 0xe8, 0x37, 0xd9,
                                     0x61, 0x4a, 0xc1, 0x2f, 0xd,  0xfd, 0xf6, 0x3e, 0xd7, 0x9,  0xdd};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x63, 0x1c, 0x64, 0xf7, 0x3f, 0x88, 0xf9, 0x59, 0x7f, 0x63, 0xa7, 0x3, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa5, 0xd5, 0x8c, 0x9f, 0xe1, 0xc0, 0x91, 0x15, 0x24, 0x6d, 0x72, 0x8d, 0x43,
                                     0x44, 0x77, 0x45, 0x77, 0x1f, 0x98, 0xb4, 0x15, 0x1d, 0x4f, 0x8e, 0xbc, 0x72};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa2, 0xf7, 0x69, 0xaa, 0x8b, 0xec, 0x73, 0x72, 0x2d, 0xb1,
                                     0xd7, 0x4d, 0x33, 0x65, 0x90, 0x3,  0x33, 0x23, 0x2,  0x60,
                                     0x73, 0x26, 0xfe, 0x69, 0xe9, 0xb3, 0x80, 0x8e, 0xf};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x5b, 0x6b, 0xb5, 0x7d, 0x88, 0xbb, 0x6a, 0x3c,
                                     0x1c, 0x8e, 0x14, 0xba, 0x9d, 0xd6, 0xa2};
  lwmqtt_string_t topic_filter_s5 = {15, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xca, 0xbf, 0x3b, 0xfe, 0x37, 0x25, 0x88, 0xd2, 0x3a, 0x15, 0x65,
                                     0x45, 0xcb, 0x30, 0x11, 0xa,  0x6c, 0x47, 0x2a, 0x40, 0xb7};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x58, 0x86, 0x69, 0x90, 0x37, 0x78, 0xc6};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe, 0x39, 0x3b, 0xb7, 0x2c};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe,  0x4a, 0xf8, 0x38, 0xdb, 0x2d, 0x6a, 0x71, 0x91, 0xa6, 0xe4, 0x90, 0x8b, 0x14,
                                     0x4d, 0x16, 0xf5, 0xdc, 0x96, 0x2e, 0xc1, 0x4b, 0xb2, 0x33, 0x95, 0x84, 0x44};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0x69, 0xa1, 0x6f, 0xfc, 0x57, 0xb0, 0x6d, 0xf4, 0x75, 0x3c,
                           0x8b, 0xbf, 0x6d, 0x63, 0xde, 0xee, 0x4b, 0xb1, 0xf3, 0xa6};
  uint8_t bytesprops1[] = {0xd0, 0x72, 0x3, 0xad, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30251}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3997}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 222}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2395}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4108, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28646 [("\224\NAK[\140\150Pw\230\154\136,A\236+U\195sv\137 \161\251K",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\177\&6\255\208\&6s5\196\213\&7\242\172\v?\226_} r2\ENQB\225\136",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),(",\181T\ETX\169&\SOH",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\231\185\DC3\162h\140[&\152A\151\t\128\157\a\143S",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("f\169\228\149VWZ\202B'\230\219\143j\160GJ\187+\175\248;K\185",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("`\ENQ\147P\ESC\152\157\138\168Qq\215\230\199\235I2[",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("X\148:\ENQ\215R\184\152\ACK\221\250\194\185W\248\155\FSI\t\132\251\148\146",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("v\189",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\145\160\130/\197z\202\198Uyv",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2}),("\176Xe",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\DC4\\d\168\230N\241",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1})] [PropResponseTopic
// "\207)",PropSessionExpiryInterval 16655,PropWildcardSubscriptionAvailable 72,PropUserProperty
// "\ETB\GS\140\138\145+\232?<L\178\206c\169\249\138\199"
// "\187)4\255j\NUL[\226Z\253g\237\238c\132\&4\148I\181\&1y\214\153\159\178]m\228\174F",PropRetainAvailable
// 139,PropContentType "M!\195\173\162\b\146%-\141\DEL\185SY\237\DLE\a\ESC\178\186v",PropSubscriptionIdentifier
// 0,PropResponseInformation "\154\207Y\DC3d\187\217",PropCorrelationData "\186",PropResponseInformation
// "\DC2U\253}u\170%f\NUL\155a\STX\237\189\234\246H\153]}O\156\DLE",PropPayloadFormatIndicator
// 81,PropRequestResponseInformation 153,PropAuthenticationMethod "\CAN\180\242K",PropSharedSubscriptionAvailable 112]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x82, 0xd5, 0x2,  0x6f, 0xe6, 0x91, 0x1,  0x8,  0x0,  0x2,  0xcf, 0x29, 0x11, 0x0,  0x0,  0x41, 0xf,  0x28, 0x48,
      0x26, 0x0,  0x11, 0x17, 0x1d, 0x8c, 0x8a, 0x91, 0x2b, 0xe8, 0x3f, 0x3c, 0x4c, 0xb2, 0xce, 0x63, 0xa9, 0xf9, 0x8a,
      0xc7, 0x0,  0x1e, 0xbb, 0x29, 0x34, 0xff, 0x6a, 0x0,  0x5b, 0xe2, 0x5a, 0xfd, 0x67, 0xed, 0xee, 0x63, 0x84, 0x34,
      0x94, 0x49, 0xb5, 0x31, 0x79, 0xd6, 0x99, 0x9f, 0xb2, 0x5d, 0x6d, 0xe4, 0xae, 0x46, 0x25, 0x8b, 0x3,  0x0,  0x15,
      0x4d, 0x21, 0xc3, 0xad, 0xa2, 0x8,  0x92, 0x25, 0x2d, 0x8d, 0x7f, 0xb9, 0x53, 0x59, 0xed, 0x10, 0x7,  0x1b, 0xb2,
      0xba, 0x76, 0xb,  0x0,  0x1a, 0x0,  0x7,  0x9a, 0xcf, 0x59, 0x13, 0x64, 0xbb, 0xd9, 0x9,  0x0,  0x1,  0xba, 0x1a,
      0x0,  0x17, 0x12, 0x55, 0xfd, 0x7d, 0x75, 0xaa, 0x25, 0x66, 0x0,  0x9b, 0x61, 0x2,  0xed, 0xbd, 0xea, 0xf6, 0x48,
      0x99, 0x5d, 0x7d, 0x4f, 0x9c, 0x10, 0x1,  0x51, 0x19, 0x99, 0x15, 0x0,  0x4,  0x18, 0xb4, 0xf2, 0x4b, 0x2a, 0x70,
      0x0,  0x17, 0xe0, 0x15, 0x5b, 0x8c, 0x96, 0x50, 0x77, 0xe6, 0x9a, 0x88, 0x2c, 0x41, 0xec, 0x2b, 0x55, 0xc3, 0x73,
      0x76, 0x89, 0x20, 0xa1, 0xfb, 0x4b, 0x26, 0x0,  0x18, 0xb1, 0x36, 0xff, 0xd0, 0x36, 0x73, 0x35, 0xc4, 0xd5, 0x37,
      0xf2, 0xac, 0xb,  0x3f, 0xe2, 0x5f, 0x7d, 0x20, 0x72, 0x32, 0x5,  0x42, 0xe1, 0x88, 0x12, 0x0,  0x7,  0x2c, 0xb5,
      0x54, 0x3,  0xa9, 0x26, 0x1,  0x14, 0x0,  0x11, 0xe7, 0xb9, 0x13, 0xa2, 0x68, 0x8c, 0x5b, 0x26, 0x98, 0x41, 0x97,
      0x9,  0x80, 0x9d, 0x7,  0x8f, 0x53, 0x4,  0x0,  0x18, 0x66, 0xa9, 0xe4, 0x95, 0x56, 0x57, 0x5a, 0xca, 0x42, 0x27,
      0xe6, 0xdb, 0x8f, 0x6a, 0xa0, 0x47, 0x4a, 0xbb, 0x2b, 0xaf, 0xf8, 0x3b, 0x4b, 0xb9, 0x10, 0x0,  0x12, 0x60, 0x5,
      0x93, 0x50, 0x1b, 0x98, 0x9d, 0x8a, 0xa8, 0x51, 0x71, 0xd7, 0xe6, 0xc7, 0xeb, 0x49, 0x32, 0x5b, 0xe,  0x0,  0x17,
      0x58, 0x94, 0x3a, 0x5,  0xd7, 0x52, 0xb8, 0x98, 0x6,  0xdd, 0xfa, 0xc2, 0xb9, 0x57, 0xf8, 0x9b, 0x1c, 0x49, 0x9,
      0x84, 0xfb, 0x94, 0x92, 0xc,  0x0,  0x2,  0x76, 0xbd, 0x12, 0x0,  0xb,  0x91, 0xa0, 0x82, 0x2f, 0xc5, 0x7a, 0xca,
      0xc6, 0x55, 0x79, 0x76, 0x26, 0x0,  0x3,  0xb0, 0x58, 0x65, 0x2a, 0x0,  0x7,  0x14, 0x5c, 0x64, 0xa8, 0xe6, 0x4e,
      0xf1, 0x29};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xe0, 0x15, 0x5b, 0x8c, 0x96, 0x50, 0x77, 0xe6, 0x9a, 0x88, 0x2c, 0x41,
                                     0xec, 0x2b, 0x55, 0xc3, 0x73, 0x76, 0x89, 0x20, 0xa1, 0xfb, 0x4b};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb1, 0x36, 0xff, 0xd0, 0x36, 0x73, 0x35, 0xc4, 0xd5, 0x37, 0xf2, 0xac,
                                     0xb,  0x3f, 0xe2, 0x5f, 0x7d, 0x20, 0x72, 0x32, 0x5,  0x42, 0xe1, 0x88};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2c, 0xb5, 0x54, 0x3, 0xa9, 0x26, 0x1};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe7, 0xb9, 0x13, 0xa2, 0x68, 0x8c, 0x5b, 0x26, 0x98,
                                     0x41, 0x97, 0x9,  0x80, 0x9d, 0x7,  0x8f, 0x53};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x66, 0xa9, 0xe4, 0x95, 0x56, 0x57, 0x5a, 0xca, 0x42, 0x27, 0xe6, 0xdb,
                                     0x8f, 0x6a, 0xa0, 0x47, 0x4a, 0xbb, 0x2b, 0xaf, 0xf8, 0x3b, 0x4b, 0xb9};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x60, 0x5,  0x93, 0x50, 0x1b, 0x98, 0x9d, 0x8a, 0xa8,
                                     0x51, 0x71, 0xd7, 0xe6, 0xc7, 0xeb, 0x49, 0x32, 0x5b};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x58, 0x94, 0x3a, 0x5,  0xd7, 0x52, 0xb8, 0x98, 0x6,  0xdd, 0xfa, 0xc2,
                                     0xb9, 0x57, 0xf8, 0x9b, 0x1c, 0x49, 0x9,  0x84, 0xfb, 0x94, 0x92};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x76, 0xbd};
  lwmqtt_string_t topic_filter_s7 = {2, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x91, 0xa0, 0x82, 0x2f, 0xc5, 0x7a, 0xca, 0xc6, 0x55, 0x79, 0x76};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xb0, 0x58, 0x65};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x14, 0x5c, 0x64, 0xa8, 0xe6, 0x4e, 0xf1};
  lwmqtt_string_t topic_filter_s10 = {7, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0xcf, 0x29};
  uint8_t bytesprops2[] = {0xbb, 0x29, 0x34, 0xff, 0x6a, 0x0,  0x5b, 0xe2, 0x5a, 0xfd, 0x67, 0xed, 0xee, 0x63, 0x84,
                           0x34, 0x94, 0x49, 0xb5, 0x31, 0x79, 0xd6, 0x99, 0x9f, 0xb2, 0x5d, 0x6d, 0xe4, 0xae, 0x46};
  uint8_t bytesprops1[] = {0x17, 0x1d, 0x8c, 0x8a, 0x91, 0x2b, 0xe8, 0x3f, 0x3c,
                           0x4c, 0xb2, 0xce, 0x63, 0xa9, 0xf9, 0x8a, 0xc7};
  uint8_t bytesprops3[] = {0x4d, 0x21, 0xc3, 0xad, 0xa2, 0x8, 0x92, 0x25, 0x2d, 0x8d, 0x7f,
                           0xb9, 0x53, 0x59, 0xed, 0x10, 0x7, 0x1b, 0xb2, 0xba, 0x76};
  uint8_t bytesprops4[] = {0x9a, 0xcf, 0x59, 0x13, 0x64, 0xbb, 0xd9};
  uint8_t bytesprops5[] = {0xba};
  uint8_t bytesprops6[] = {0x12, 0x55, 0xfd, 0x7d, 0x75, 0xaa, 0x25, 0x66, 0x0,  0x9b, 0x61, 0x2,
                           0xed, 0xbd, 0xea, 0xf6, 0x48, 0x99, 0x5d, 0x7d, 0x4f, 0x9c, 0x10};
  uint8_t bytesprops7[] = {0x18, 0xb4, 0xf2, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16655}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops1}, .v = {30, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 112}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28646, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31174 [(":\243\230#\164\248!\232\150\150+\138m\198\212\"\193f\129\SOH}K\195\171\150",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("4`MS\232\255\169oP\EOT\RS\198P\250r2\135\v\183FW\STX)\173",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("K\167{\179J\RS\NAK3=*T4\208*\145\228\198h\252\246\248\a",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\ETB\245\174A\225F\225\216j\197\147B\t\254\132\216\164\205\150K$\164lT\ETX\212mRv",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\180Sg\a&R\165\162\174g\178\253\GS*\197i\USu_&\229\201\131d\169\231@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\184l\ETX\225\&2\130\189\132\DC22N9\214\175@\197M\241/X#\ACKQ0\250q\DC4\r",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\253C7\NAK\203#\170",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\133\213\133\SUB\235\254\194\&5\223\143\241-\SUB\177n\233\211{\FSE",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})]
// [PropSubscriptionIdentifierAvailable 205,PropWildcardSubscriptionAvailable 32]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0xd8, 0x1,  0x79, 0xc6, 0x4,  0x29, 0xcd, 0x28, 0x20, 0x0,  0x19, 0x3a, 0xf3, 0xe6, 0x23, 0xa4,
                   0xf8, 0x21, 0xe8, 0x96, 0x96, 0x2b, 0x8a, 0x6d, 0xc6, 0xd4, 0x22, 0xc1, 0x66, 0x81, 0x1,  0x7d, 0x4b,
                   0xc3, 0xab, 0x96, 0x1e, 0x0,  0x18, 0x34, 0x60, 0x4d, 0x53, 0xe8, 0xff, 0xa9, 0x6f, 0x50, 0x4,  0x1e,
                   0xc6, 0x50, 0xfa, 0x72, 0x32, 0x87, 0xb,  0xb7, 0x46, 0x57, 0x2,  0x29, 0xad, 0x1a, 0x0,  0x16, 0x4b,
                   0xa7, 0x7b, 0xb3, 0x4a, 0x1e, 0x15, 0x33, 0x3d, 0x2a, 0x54, 0x34, 0xd0, 0x2a, 0x91, 0xe4, 0xc6, 0x68,
                   0xfc, 0xf6, 0xf8, 0x7,  0x4,  0x0,  0x1d, 0x17, 0xf5, 0xae, 0x41, 0xe1, 0x46, 0xe1, 0xd8, 0x6a, 0xc5,
                   0x93, 0x42, 0x9,  0xfe, 0x84, 0xd8, 0xa4, 0xcd, 0x96, 0x4b, 0x24, 0xa4, 0x6c, 0x54, 0x3,  0xd4, 0x6d,
                   0x52, 0x76, 0x22, 0x0,  0x1b, 0xb4, 0x53, 0x67, 0x7,  0x26, 0x52, 0xa5, 0xa2, 0xae, 0x67, 0xb2, 0xfd,
                   0x1d, 0x2a, 0xc5, 0x69, 0x1f, 0x75, 0x5f, 0x26, 0xe5, 0xc9, 0x83, 0x64, 0xa9, 0xe7, 0x40, 0x0,  0x0,
                   0x0,  0x1,  0x0,  0x1c, 0xb8, 0x6c, 0x3,  0xe1, 0x32, 0x82, 0xbd, 0x84, 0x12, 0x32, 0x4e, 0x39, 0xd6,
                   0xaf, 0x40, 0xc5, 0x4d, 0xf1, 0x2f, 0x58, 0x23, 0x6,  0x51, 0x30, 0xfa, 0x71, 0x14, 0xd,  0x2c, 0x0,
                   0x7,  0xfd, 0x43, 0x37, 0x15, 0xcb, 0x23, 0xaa, 0xc,  0x0,  0x14, 0x85, 0xd5, 0x85, 0x1a, 0xeb, 0xfe,
                   0xc2, 0x35, 0xdf, 0x8f, 0xf1, 0x2d, 0x1a, 0xb1, 0x6e, 0xe9, 0xd3, 0x7b, 0x1c, 0x45, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x3a, 0xf3, 0xe6, 0x23, 0xa4, 0xf8, 0x21, 0xe8, 0x96, 0x96, 0x2b, 0x8a, 0x6d,
                                     0xc6, 0xd4, 0x22, 0xc1, 0x66, 0x81, 0x1,  0x7d, 0x4b, 0xc3, 0xab, 0x96};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x34, 0x60, 0x4d, 0x53, 0xe8, 0xff, 0xa9, 0x6f, 0x50, 0x4, 0x1e, 0xc6,
                                     0x50, 0xfa, 0x72, 0x32, 0x87, 0xb,  0xb7, 0x46, 0x57, 0x2, 0x29, 0xad};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4b, 0xa7, 0x7b, 0xb3, 0x4a, 0x1e, 0x15, 0x33, 0x3d, 0x2a, 0x54,
                                     0x34, 0xd0, 0x2a, 0x91, 0xe4, 0xc6, 0x68, 0xfc, 0xf6, 0xf8, 0x7};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x17, 0xf5, 0xae, 0x41, 0xe1, 0x46, 0xe1, 0xd8, 0x6a, 0xc5,
                                     0x93, 0x42, 0x9,  0xfe, 0x84, 0xd8, 0xa4, 0xcd, 0x96, 0x4b,
                                     0x24, 0xa4, 0x6c, 0x54, 0x3,  0xd4, 0x6d, 0x52, 0x76};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb4, 0x53, 0x67, 0x7,  0x26, 0x52, 0xa5, 0xa2, 0xae, 0x67, 0xb2, 0xfd, 0x1d, 0x2a,
                                     0xc5, 0x69, 0x1f, 0x75, 0x5f, 0x26, 0xe5, 0xc9, 0x83, 0x64, 0xa9, 0xe7, 0x40};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb8, 0x6c, 0x3,  0xe1, 0x32, 0x82, 0xbd, 0x84, 0x12, 0x32, 0x4e, 0x39, 0xd6, 0xaf,
                                     0x40, 0xc5, 0x4d, 0xf1, 0x2f, 0x58, 0x23, 0x6,  0x51, 0x30, 0xfa, 0x71, 0x14, 0xd};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfd, 0x43, 0x37, 0x15, 0xcb, 0x23, 0xaa};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x85, 0xd5, 0x85, 0x1a, 0xeb, 0xfe, 0xc2, 0x35, 0xdf, 0x8f,
                                     0xf1, 0x2d, 0x1a, 0xb1, 0x6e, 0xe9, 0xd3, 0x7b, 0x1c, 0x45};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 32}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 31174, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2900 [("\249J\154\194\178Mb\255\165\234\213K\141%\167\ESC\151\152\176\236\214",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("7\144\f>\ACKS$|\SI",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal
// = True, _subQoS = QoS1}),("!",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal
// = True, _subQoS =
// QoS2}),("v\150\SO\163x\160B\220\209E<o\207\211\252\SOH\128\152\226O\212\208\v\SUB\DEL}\172%]",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})]
// [PropReceiveMaximum 24109,PropReceiveMaximum 22392,PropServerKeepAlive 25475,PropWildcardSubscriptionAvailable
// 113,PropMaximumPacketSize 7820,PropUserProperty "\233\185\232u " "\174l\194\209J",PropTopicAlias
// 4142,PropPayloadFormatIndicator 153,PropTopicAlias 32761,PropAuthenticationData
// "#\131\142\ESC\138=\128\158\205\239<\193B\190\DC4{\141\150o#\252w\248\205\217O",PropMaximumQoS
// 57,PropAssignedClientIdentifier "X\130",PropRequestResponseInformation 64,PropServerReference
// "\236\177\b`9\160\ACK\181R\153| \140",PropRequestResponseInformation 207,PropContentType
// "Bh\171X\178\213y\USK\231OK/",PropTopicAliasMaximum 997,PropSubscriptionIdentifierAvailable 87,PropServerKeepAlive
// 7166,PropAuthenticationData "\233v\209D\255V\216:\165\233\&0Mga\182\190\215\241,\247",PropTopicAliasMaximum
// 11701,PropUserProperty "\138\147\241\193\t\154Y" "\207<=lk\179\168l",PropCorrelationData
// "k:o$\250\185\236=Q`\223{w\DC2Y\227\133\144\&0_\r2",PropReceiveMaximum 31719,PropSubscriptionIdentifierAvailable
// 69,PropRetainAvailable 133]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x82, 0x91, 0x2,  0xb,  0x54, 0xc5, 0x1,  0x21, 0x5e, 0x2d, 0x21, 0x57, 0x78, 0x13, 0x63, 0x83, 0x28, 0x71, 0x27,
      0x0,  0x0,  0x1e, 0x8c, 0x26, 0x0,  0x5,  0xe9, 0xb9, 0xe8, 0x75, 0x20, 0x0,  0x5,  0xae, 0x6c, 0xc2, 0xd1, 0x4a,
      0x23, 0x10, 0x2e, 0x1,  0x99, 0x23, 0x7f, 0xf9, 0x16, 0x0,  0x1a, 0x23, 0x83, 0x8e, 0x1b, 0x8a, 0x3d, 0x80, 0x9e,
      0xcd, 0xef, 0x3c, 0xc1, 0x42, 0xbe, 0x14, 0x7b, 0x8d, 0x96, 0x6f, 0x23, 0xfc, 0x77, 0xf8, 0xcd, 0xd9, 0x4f, 0x24,
      0x39, 0x12, 0x0,  0x2,  0x58, 0x82, 0x19, 0x40, 0x1c, 0x0,  0xd,  0xec, 0xb1, 0x8,  0x60, 0x39, 0xa0, 0x6,  0xb5,
      0x52, 0x99, 0x7c, 0x20, 0x8c, 0x19, 0xcf, 0x3,  0x0,  0xd,  0x42, 0x68, 0xab, 0x58, 0xb2, 0xd5, 0x79, 0x1f, 0x4b,
      0xe7, 0x4f, 0x4b, 0x2f, 0x22, 0x3,  0xe5, 0x29, 0x57, 0x13, 0x1b, 0xfe, 0x16, 0x0,  0x14, 0xe9, 0x76, 0xd1, 0x44,
      0xff, 0x56, 0xd8, 0x3a, 0xa5, 0xe9, 0x30, 0x4d, 0x67, 0x61, 0xb6, 0xbe, 0xd7, 0xf1, 0x2c, 0xf7, 0x22, 0x2d, 0xb5,
      0x26, 0x0,  0x7,  0x8a, 0x93, 0xf1, 0xc1, 0x9,  0x9a, 0x59, 0x0,  0x8,  0xcf, 0x3c, 0x3d, 0x6c, 0x6b, 0xb3, 0xa8,
      0x6c, 0x9,  0x0,  0x16, 0x6b, 0x3a, 0x6f, 0x24, 0xfa, 0xb9, 0xec, 0x3d, 0x51, 0x60, 0xdf, 0x7b, 0x77, 0x12, 0x59,
      0xe3, 0x85, 0x90, 0x30, 0x5f, 0xd,  0x32, 0x21, 0x7b, 0xe7, 0x29, 0x45, 0x25, 0x85, 0x0,  0x15, 0xf9, 0x4a, 0x9a,
      0xc2, 0xb2, 0x4d, 0x62, 0xff, 0xa5, 0xea, 0xd5, 0x4b, 0x8d, 0x25, 0xa7, 0x1b, 0x97, 0x98, 0xb0, 0xec, 0xd6, 0x26,
      0x0,  0x9,  0x37, 0x90, 0xc,  0x3e, 0x6,  0x53, 0x24, 0x7c, 0xf,  0x2d, 0x0,  0x1,  0x21, 0x16, 0x0,  0x1d, 0x76,
      0x96, 0xe,  0xa3, 0x78, 0xa0, 0x42, 0xdc, 0xd1, 0x45, 0x3c, 0x6f, 0xcf, 0xd3, 0xfc, 0x1,  0x80, 0x98, 0xe2, 0x4f,
      0xd4, 0xd0, 0xb,  0x1a, 0x7f, 0x7d, 0xac, 0x25, 0x5d, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xf9, 0x4a, 0x9a, 0xc2, 0xb2, 0x4d, 0x62, 0xff, 0xa5, 0xea, 0xd5,
                                     0x4b, 0x8d, 0x25, 0xa7, 0x1b, 0x97, 0x98, 0xb0, 0xec, 0xd6};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x37, 0x90, 0xc, 0x3e, 0x6, 0x53, 0x24, 0x7c, 0xf};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x21};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x76, 0x96, 0xe,  0xa3, 0x78, 0xa0, 0x42, 0xdc, 0xd1, 0x45,
                                     0x3c, 0x6f, 0xcf, 0xd3, 0xfc, 0x1,  0x80, 0x98, 0xe2, 0x4f,
                                     0xd4, 0xd0, 0xb,  0x1a, 0x7f, 0x7d, 0xac, 0x25, 0x5d};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  uint8_t bytesprops1[] = {0xae, 0x6c, 0xc2, 0xd1, 0x4a};
  uint8_t bytesprops0[] = {0xe9, 0xb9, 0xe8, 0x75, 0x20};
  uint8_t bytesprops2[] = {0x23, 0x83, 0x8e, 0x1b, 0x8a, 0x3d, 0x80, 0x9e, 0xcd, 0xef, 0x3c, 0xc1, 0x42,
                           0xbe, 0x14, 0x7b, 0x8d, 0x96, 0x6f, 0x23, 0xfc, 0x77, 0xf8, 0xcd, 0xd9, 0x4f};
  uint8_t bytesprops3[] = {0x58, 0x82};
  uint8_t bytesprops4[] = {0xec, 0xb1, 0x8, 0x60, 0x39, 0xa0, 0x6, 0xb5, 0x52, 0x99, 0x7c, 0x20, 0x8c};
  uint8_t bytesprops5[] = {0x42, 0x68, 0xab, 0x58, 0xb2, 0xd5, 0x79, 0x1f, 0x4b, 0xe7, 0x4f, 0x4b, 0x2f};
  uint8_t bytesprops6[] = {0xe9, 0x76, 0xd1, 0x44, 0xff, 0x56, 0xd8, 0x3a, 0xa5, 0xe9,
                           0x30, 0x4d, 0x67, 0x61, 0xb6, 0xbe, 0xd7, 0xf1, 0x2c, 0xf7};
  uint8_t bytesprops8[] = {0xcf, 0x3c, 0x3d, 0x6c, 0x6b, 0xb3, 0xa8, 0x6c};
  uint8_t bytesprops7[] = {0x8a, 0x93, 0xf1, 0xc1, 0x9, 0x9a, 0x59};
  uint8_t bytesprops9[] = {0x6b, 0x3a, 0x6f, 0x24, 0xfa, 0xb9, 0xec, 0x3d, 0x51, 0x60, 0xdf,
                           0x7b, 0x77, 0x12, 0x59, 0xe3, 0x85, 0x90, 0x30, 0x5f, 0xd,  0x32};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24109}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22392}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25475}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7820}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops0}, .v = {5, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4142}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32761}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 997}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7166}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11701}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops7}, .v = {8, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31719}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 133}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2900, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5776 [("\160\209\185JP\212 \215s\195C\191\159\167\NUL\v%\162\200\178l\239\244\142zm\213",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\f\211)\132\193l",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal =
// True, _subQoS = QoS0}),("\183}i",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("I\255\240\EOT\FS\132\DLE\191",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("\151\170{\nFo\152H.M]s3\DC4\223",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("z\STX\204\&4\191",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS2}),("\v\163\155\DC2\221\212\SYN\180W\148:+m",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\157\DC2a\"\225`\227%\238\227\162\&7\170\215\&5[",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("0\157\235\244iL@\234\177H<",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\ESCs\v|\SOH.\171\GS\STXj\GSA@\186\134\165\204\CAN\154@\DC3\152",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropAuthenticationMethod
// "]D\255\&7L\235\226\155\184`\EM{]2\169\185\145",PropSharedSubscriptionAvailable 7,PropAuthenticationMethod
// "\193\ETBQ\149_\SO\213\EOT2\155\172j\SUBJ",PropSubscriptionIdentifierAvailable 48,PropResponseTopic "h\141"]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0xcd, 0x1,  0x16, 0x90, 0x2e, 0x15, 0x0,  0x11, 0x5d, 0x44, 0xff, 0x37, 0x4c, 0xeb, 0xe2, 0x9b, 0xb8, 0x60,
      0x19, 0x7b, 0x5d, 0x32, 0xa9, 0xb9, 0x91, 0x2a, 0x7,  0x15, 0x0,  0xe,  0xc1, 0x17, 0x51, 0x95, 0x5f, 0xe,  0xd5,
      0x4,  0x32, 0x9b, 0xac, 0x6a, 0x1a, 0x4a, 0x29, 0x30, 0x8,  0x0,  0x2,  0x68, 0x8d, 0x0,  0x1b, 0xa0, 0xd1, 0xb9,
      0x4a, 0x50, 0xd4, 0x20, 0xd7, 0x73, 0xc3, 0x43, 0xbf, 0x9f, 0xa7, 0x0,  0xb,  0x25, 0xa2, 0xc8, 0xb2, 0x6c, 0xef,
      0xf4, 0x8e, 0x7a, 0x6d, 0xd5, 0x9,  0x0,  0x6,  0xc,  0xd3, 0x29, 0x84, 0xc1, 0x6c, 0x1c, 0x0,  0x3,  0xb7, 0x7d,
      0x69, 0x0,  0x0,  0x8,  0x49, 0xff, 0xf0, 0x4,  0x1c, 0x84, 0x10, 0xbf, 0x18, 0x0,  0xf,  0x97, 0xaa, 0x7b, 0xa,
      0x46, 0x6f, 0x98, 0x48, 0x2e, 0x4d, 0x5d, 0x73, 0x33, 0x14, 0xdf, 0x1e, 0x0,  0x5,  0x7a, 0x2,  0xcc, 0x34, 0xbf,
      0x6,  0x0,  0xd,  0xb,  0xa3, 0x9b, 0x12, 0xdd, 0xd4, 0x16, 0xb4, 0x57, 0x94, 0x3a, 0x2b, 0x6d, 0x2e, 0x0,  0x10,
      0x9d, 0x12, 0x61, 0x22, 0xe1, 0x60, 0xe3, 0x25, 0xee, 0xe3, 0xa2, 0x37, 0xaa, 0xd7, 0x35, 0x5b, 0x2a, 0x0,  0xb,
      0x30, 0x9d, 0xeb, 0xf4, 0x69, 0x4c, 0x40, 0xea, 0xb1, 0x48, 0x3c, 0x15, 0x0,  0x16, 0x1b, 0x73, 0xb,  0x7c, 0x1,
      0x2e, 0xab, 0x1d, 0x2,  0x6a, 0x1d, 0x41, 0x40, 0xba, 0x86, 0xa5, 0xcc, 0x18, 0x9a, 0x40, 0x13, 0x98, 0xe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xa0, 0xd1, 0xb9, 0x4a, 0x50, 0xd4, 0x20, 0xd7, 0x73, 0xc3, 0x43, 0xbf, 0x9f, 0xa7,
                                     0x0,  0xb,  0x25, 0xa2, 0xc8, 0xb2, 0x6c, 0xef, 0xf4, 0x8e, 0x7a, 0x6d, 0xd5};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc, 0xd3, 0x29, 0x84, 0xc1, 0x6c};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb7, 0x7d, 0x69};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x49, 0xff, 0xf0, 0x4, 0x1c, 0x84, 0x10, 0xbf};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x97, 0xaa, 0x7b, 0xa,  0x46, 0x6f, 0x98, 0x48,
                                     0x2e, 0x4d, 0x5d, 0x73, 0x33, 0x14, 0xdf};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7a, 0x2, 0xcc, 0x34, 0xbf};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb, 0xa3, 0x9b, 0x12, 0xdd, 0xd4, 0x16, 0xb4, 0x57, 0x94, 0x3a, 0x2b, 0x6d};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x9d, 0x12, 0x61, 0x22, 0xe1, 0x60, 0xe3, 0x25,
                                     0xee, 0xe3, 0xa2, 0x37, 0xaa, 0xd7, 0x35, 0x5b};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x30, 0x9d, 0xeb, 0xf4, 0x69, 0x4c, 0x40, 0xea, 0xb1, 0x48, 0x3c};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x1b, 0x73, 0xb,  0x7c, 0x1,  0x2e, 0xab, 0x1d, 0x2,  0x6a, 0x1d,
                                     0x41, 0x40, 0xba, 0x86, 0xa5, 0xcc, 0x18, 0x9a, 0x40, 0x13, 0x98};
  lwmqtt_string_t topic_filter_s9 = {22, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  uint8_t bytesprops0[] = {0x5d, 0x44, 0xff, 0x37, 0x4c, 0xeb, 0xe2, 0x9b, 0xb8,
                           0x60, 0x19, 0x7b, 0x5d, 0x32, 0xa9, 0xb9, 0x91};
  uint8_t bytesprops1[] = {0xc1, 0x17, 0x51, 0x95, 0x5f, 0xe, 0xd5, 0x4, 0x32, 0x9b, 0xac, 0x6a, 0x1a, 0x4a};
  uint8_t bytesprops2[] = {0x68, 0x8d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5776, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24276 [("\179\243\204\239\187M$\198\241*\231z\ENQ`Xu",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("kw\176}\238\r\199B\189\178D\179)\vd\"\n\SO\&HUl",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropTopicAliasMaximum 18124,PropReasonString
// "\199\253z\EMD\202b\150\EOT`R\218\&9\ETB\DC3E",PropAssignedClientIdentifier
// "\ACK\ENQ\175\SI:|\191m\233\139_h\239\ENQ\174\251.\f\145>\162\156\a!Z\251",PropSharedSubscriptionAvailable
// 77,PropSubscriptionIdentifier 24,PropResponseTopic
// "F\165\209\189x\225\202\STX\135\144\221F\251\219\168\212\235{",PropReasonString
// "\202y\176\144\&5\195\SOH\215\184\237S\SYN\190",PropReceiveMaximum 29384,PropResponseInformation
// "M\218\SO\164\227\GSw\192\188\SO\154W\204K=\247\144\&1\SYN\254V\238\155u\173f",PropWillDelayInterval
// 29671,PropServerReference "\aI\167\&9b\140\200V:F\165\248\234\232",PropAssignedClientIdentifier
// "q]\176\136i\167\"\228\184K\142\223Z\254\152M \DC4j`\EM\SI?E",PropWillDelayInterval
// 668,PropSharedSubscriptionAvailable 250,PropCorrelationData "\DC4$R\"\255",PropAuthenticationData
// "I-\189\176\141\242\a\135\251\210\184!\228;E>^\206g\147\147\DLE\NAK\FS\173k",PropMaximumQoS 10,PropRetainAvailable
// 36,PropAuthenticationData "\146\240E*+\204\247"]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0x96, 0x2,  0x5e, 0xd4, 0xe7, 0x1,  0x22, 0x46, 0xcc, 0x1f, 0x0,  0x10, 0xc7, 0xfd, 0x7a, 0x19, 0x44, 0xca,
      0x62, 0x96, 0x4,  0x60, 0x52, 0xda, 0x39, 0x17, 0x13, 0x45, 0x12, 0x0,  0x1a, 0x6,  0x5,  0xaf, 0xf,  0x3a, 0x7c,
      0xbf, 0x6d, 0xe9, 0x8b, 0x5f, 0x68, 0xef, 0x5,  0xae, 0xfb, 0x2e, 0xc,  0x91, 0x3e, 0xa2, 0x9c, 0x7,  0x21, 0x5a,
      0xfb, 0x2a, 0x4d, 0xb,  0x18, 0x8,  0x0,  0x12, 0x46, 0xa5, 0xd1, 0xbd, 0x78, 0xe1, 0xca, 0x2,  0x87, 0x90, 0xdd,
      0x46, 0xfb, 0xdb, 0xa8, 0xd4, 0xeb, 0x7b, 0x1f, 0x0,  0xd,  0xca, 0x79, 0xb0, 0x90, 0x35, 0xc3, 0x1,  0xd7, 0xb8,
      0xed, 0x53, 0x16, 0xbe, 0x21, 0x72, 0xc8, 0x1a, 0x0,  0x1a, 0x4d, 0xda, 0xe,  0xa4, 0xe3, 0x1d, 0x77, 0xc0, 0xbc,
      0xe,  0x9a, 0x57, 0xcc, 0x4b, 0x3d, 0xf7, 0x90, 0x31, 0x16, 0xfe, 0x56, 0xee, 0x9b, 0x75, 0xad, 0x66, 0x18, 0x0,
      0x0,  0x73, 0xe7, 0x1c, 0x0,  0xe,  0x7,  0x49, 0xa7, 0x39, 0x62, 0x8c, 0xc8, 0x56, 0x3a, 0x46, 0xa5, 0xf8, 0xea,
      0xe8, 0x12, 0x0,  0x18, 0x71, 0x5d, 0xb0, 0x88, 0x69, 0xa7, 0x22, 0xe4, 0xb8, 0x4b, 0x8e, 0xdf, 0x5a, 0xfe, 0x98,
      0x4d, 0x20, 0x14, 0x6a, 0x60, 0x19, 0xf,  0x3f, 0x45, 0x18, 0x0,  0x0,  0x2,  0x9c, 0x2a, 0xfa, 0x9,  0x0,  0x5,
      0x14, 0x24, 0x52, 0x22, 0xff, 0x16, 0x0,  0x1a, 0x49, 0x2d, 0xbd, 0xb0, 0x8d, 0xf2, 0x7,  0x87, 0xfb, 0xd2, 0xb8,
      0x21, 0xe4, 0x3b, 0x45, 0x3e, 0x5e, 0xce, 0x67, 0x93, 0x93, 0x10, 0x15, 0x1c, 0xad, 0x6b, 0x24, 0xa,  0x25, 0x24,
      0x16, 0x0,  0x7,  0x92, 0xf0, 0x45, 0x2a, 0x2b, 0xcc, 0xf7, 0x0,  0x10, 0xb3, 0xf3, 0xcc, 0xef, 0xbb, 0x4d, 0x24,
      0xc6, 0xf1, 0x2a, 0xe7, 0x7a, 0x5,  0x60, 0x58, 0x75, 0xa,  0x0,  0x15, 0x6b, 0x77, 0xb0, 0x7d, 0xee, 0xd,  0xc7,
      0x42, 0xbd, 0xb2, 0x44, 0xb3, 0x29, 0xb,  0x64, 0x22, 0xa,  0xe,  0x48, 0x55, 0x6c, 0x1c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xb3, 0xf3, 0xcc, 0xef, 0xbb, 0x4d, 0x24, 0xc6,
                                     0xf1, 0x2a, 0xe7, 0x7a, 0x5,  0x60, 0x58, 0x75};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6b, 0x77, 0xb0, 0x7d, 0xee, 0xd, 0xc7, 0x42, 0xbd, 0xb2, 0x44,
                                     0xb3, 0x29, 0xb,  0x64, 0x22, 0xa, 0xe,  0x48, 0x55, 0x6c};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0xc7, 0xfd, 0x7a, 0x19, 0x44, 0xca, 0x62, 0x96,
                           0x4,  0x60, 0x52, 0xda, 0x39, 0x17, 0x13, 0x45};
  uint8_t bytesprops1[] = {0x6, 0x5,  0xaf, 0xf,  0x3a, 0x7c, 0xbf, 0x6d, 0xe9, 0x8b, 0x5f, 0x68, 0xef,
                           0x5, 0xae, 0xfb, 0x2e, 0xc,  0x91, 0x3e, 0xa2, 0x9c, 0x7,  0x21, 0x5a, 0xfb};
  uint8_t bytesprops2[] = {0x46, 0xa5, 0xd1, 0xbd, 0x78, 0xe1, 0xca, 0x2,  0x87,
                           0x90, 0xdd, 0x46, 0xfb, 0xdb, 0xa8, 0xd4, 0xeb, 0x7b};
  uint8_t bytesprops3[] = {0xca, 0x79, 0xb0, 0x90, 0x35, 0xc3, 0x1, 0xd7, 0xb8, 0xed, 0x53, 0x16, 0xbe};
  uint8_t bytesprops4[] = {0x4d, 0xda, 0xe,  0xa4, 0xe3, 0x1d, 0x77, 0xc0, 0xbc, 0xe,  0x9a, 0x57, 0xcc,
                           0x4b, 0x3d, 0xf7, 0x90, 0x31, 0x16, 0xfe, 0x56, 0xee, 0x9b, 0x75, 0xad, 0x66};
  uint8_t bytesprops5[] = {0x7, 0x49, 0xa7, 0x39, 0x62, 0x8c, 0xc8, 0x56, 0x3a, 0x46, 0xa5, 0xf8, 0xea, 0xe8};
  uint8_t bytesprops6[] = {0x71, 0x5d, 0xb0, 0x88, 0x69, 0xa7, 0x22, 0xe4, 0xb8, 0x4b, 0x8e, 0xdf,
                           0x5a, 0xfe, 0x98, 0x4d, 0x20, 0x14, 0x6a, 0x60, 0x19, 0xf,  0x3f, 0x45};
  uint8_t bytesprops7[] = {0x14, 0x24, 0x52, 0x22, 0xff};
  uint8_t bytesprops8[] = {0x49, 0x2d, 0xbd, 0xb0, 0x8d, 0xf2, 0x7,  0x87, 0xfb, 0xd2, 0xb8, 0x21, 0xe4,
                           0x3b, 0x45, 0x3e, 0x5e, 0xce, 0x67, 0x93, 0x93, 0x10, 0x15, 0x1c, 0xad, 0x6b};
  uint8_t bytesprops9[] = {0x92, 0xf0, 0x45, 0x2a, 0x2b, 0xcc, 0xf7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18124}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29384}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29671}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 668}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24276, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17953 [("\230\CAN\157,Q",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2}),("W",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS1}),("1/\218k\SOH\193\234\176zfB\215\166+\DC1Rzc",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("?N\223\&4<\167\174\222\&4",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS =
// QoS1}),("\237\v\239\243\170\&0\135\144\178*\146\194if\US\203\&9'\172\166|\128\129m\188|l\141i\164",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\238\232\v\ENQ
// \239\SOH\149\159P",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS1}),("\191\217\139T!It\188\RS\EM\246\171\172\134u\234\170\168R\185\139\229\ESC",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("{\186\SIi\DLE\171\225\241\&6",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("\166",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS2}),("~J\231\169\143\142y\137\254m\135\249\196X\DC4J",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropMaximumQoS
// 139,PropTopicAlias 22521,PropSubscriptionIdentifierAvailable 34,PropUserProperty "\SI+\143\241\230%<\231\227I\214"
// "\167\201<\233 \STX\165lB\229\219W\205Z\159\n\187\222",PropAuthenticationData
// "\207\143,\240\186\203\168\197\143\159\178\134\155\&6\SI\247\159\196\212\186\183gq\199\252\251",PropServerReference
// "!\208\170L_\177\174%\STX\188\206u\SOH;\255\&2\SO\129;\213\SYN\171",PropRequestProblemInformation
// 36,PropServerReference "\192\220AE\232t?/B\129\164\144\NUL\214\144\203q\US\206\EOT",PropPayloadFormatIndicator
// 172,PropWildcardSubscriptionAvailable 221,PropRequestResponseInformation 175,PropWildcardSubscriptionAvailable
// 251,PropWillDelayInterval 7152,PropSubscriptionIdentifier 31,PropCorrelationData
// "U\FSG\203\243\191\251{\\\r.\186\148\242U\SYN\192p\GS\204V",PropTopicAliasMaximum 21728,PropServerReference
// "\DC2\171}+\153\STX\242m\DC1\ACK\155 \235",PropResponseInformation "e",PropResponseTopic ""]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x82, 0xd8, 0x2,  0x46, 0x21, 0xb9, 0x1,  0x24, 0x8b, 0x23, 0x57, 0xf9, 0x29, 0x22, 0x26, 0x0,  0xb,  0xf,  0x2b,
      0x8f, 0xf1, 0xe6, 0x25, 0x3c, 0xe7, 0xe3, 0x49, 0xd6, 0x0,  0x12, 0xa7, 0xc9, 0x3c, 0xe9, 0x20, 0x2,  0xa5, 0x6c,
      0x42, 0xe5, 0xdb, 0x57, 0xcd, 0x5a, 0x9f, 0xa,  0xbb, 0xde, 0x16, 0x0,  0x1a, 0xcf, 0x8f, 0x2c, 0xf0, 0xba, 0xcb,
      0xa8, 0xc5, 0x8f, 0x9f, 0xb2, 0x86, 0x9b, 0x36, 0xf,  0xf7, 0x9f, 0xc4, 0xd4, 0xba, 0xb7, 0x67, 0x71, 0xc7, 0xfc,
      0xfb, 0x1c, 0x0,  0x16, 0x21, 0xd0, 0xaa, 0x4c, 0x5f, 0xb1, 0xae, 0x25, 0x2,  0xbc, 0xce, 0x75, 0x1,  0x3b, 0xff,
      0x32, 0xe,  0x81, 0x3b, 0xd5, 0x16, 0xab, 0x17, 0x24, 0x1c, 0x0,  0x14, 0xc0, 0xdc, 0x41, 0x45, 0xe8, 0x74, 0x3f,
      0x2f, 0x42, 0x81, 0xa4, 0x90, 0x0,  0xd6, 0x90, 0xcb, 0x71, 0x1f, 0xce, 0x4,  0x1,  0xac, 0x28, 0xdd, 0x19, 0xaf,
      0x28, 0xfb, 0x18, 0x0,  0x0,  0x1b, 0xf0, 0xb,  0x1f, 0x9,  0x0,  0x15, 0x55, 0x1c, 0x47, 0xcb, 0xf3, 0xbf, 0xfb,
      0x7b, 0x5c, 0xd,  0x2e, 0xba, 0x94, 0xf2, 0x55, 0x16, 0xc0, 0x70, 0x1d, 0xcc, 0x56, 0x22, 0x54, 0xe0, 0x1c, 0x0,
      0xd,  0x12, 0xab, 0x7d, 0x2b, 0x99, 0x2,  0xf2, 0x6d, 0x11, 0x6,  0x9b, 0x20, 0xeb, 0x1a, 0x0,  0x1,  0x65, 0x8,
      0x0,  0x0,  0x0,  0x5,  0xe6, 0x18, 0x9d, 0x2c, 0x51, 0x26, 0x0,  0x1,  0x57, 0x1d, 0x0,  0x12, 0x31, 0x2f, 0xda,
      0x6b, 0x1,  0xc1, 0xea, 0xb0, 0x7a, 0x66, 0x42, 0xd7, 0xa6, 0x2b, 0x11, 0x52, 0x7a, 0x63, 0x16, 0x0,  0x9,  0x3f,
      0x4e, 0xdf, 0x34, 0x3c, 0xa7, 0xae, 0xde, 0x34, 0x25, 0x0,  0x1e, 0xed, 0xb,  0xef, 0xf3, 0xaa, 0x30, 0x87, 0x90,
      0xb2, 0x2a, 0x92, 0xc2, 0x69, 0x66, 0x1f, 0xcb, 0x39, 0x27, 0xac, 0xa6, 0x7c, 0x80, 0x81, 0x6d, 0xbc, 0x7c, 0x6c,
      0x8d, 0x69, 0xa4, 0x1c, 0x0,  0xa,  0xee, 0xe8, 0xb,  0x5,  0x20, 0xef, 0x1,  0x95, 0x9f, 0x50, 0x2d, 0x0,  0x17,
      0xbf, 0xd9, 0x8b, 0x54, 0x21, 0x49, 0x74, 0xbc, 0x1e, 0x19, 0xf6, 0xab, 0xac, 0x86, 0x75, 0xea, 0xaa, 0xa8, 0x52,
      0xb9, 0x8b, 0xe5, 0x1b, 0x1,  0x0,  0x9,  0x7b, 0xba, 0xf,  0x69, 0x10, 0xab, 0xe1, 0xf1, 0x36, 0x2a, 0x0,  0x1,
      0xa6, 0x20, 0x0,  0x0,  0x2e, 0x0,  0x10, 0x7e, 0x4a, 0xe7, 0xa9, 0x8f, 0x8e, 0x79, 0x89, 0xfe, 0x6d, 0x87, 0xf9,
      0xc4, 0x58, 0x14, 0x4a, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xe6, 0x18, 0x9d, 0x2c, 0x51};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x57};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x31, 0x2f, 0xda, 0x6b, 0x1,  0xc1, 0xea, 0xb0, 0x7a,
                                     0x66, 0x42, 0xd7, 0xa6, 0x2b, 0x11, 0x52, 0x7a, 0x63};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3f, 0x4e, 0xdf, 0x34, 0x3c, 0xa7, 0xae, 0xde, 0x34};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xed, 0xb,  0xef, 0xf3, 0xaa, 0x30, 0x87, 0x90, 0xb2, 0x2a,
                                     0x92, 0xc2, 0x69, 0x66, 0x1f, 0xcb, 0x39, 0x27, 0xac, 0xa6,
                                     0x7c, 0x80, 0x81, 0x6d, 0xbc, 0x7c, 0x6c, 0x8d, 0x69, 0xa4};
  lwmqtt_string_t topic_filter_s4 = {30, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xee, 0xe8, 0xb, 0x5, 0x20, 0xef, 0x1, 0x95, 0x9f, 0x50};
  lwmqtt_string_t topic_filter_s5 = {10, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbf, 0xd9, 0x8b, 0x54, 0x21, 0x49, 0x74, 0xbc, 0x1e, 0x19, 0xf6, 0xab,
                                     0xac, 0x86, 0x75, 0xea, 0xaa, 0xa8, 0x52, 0xb9, 0x8b, 0xe5, 0x1b};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7b, 0xba, 0xf, 0x69, 0x10, 0xab, 0xe1, 0xf1, 0x36};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa6};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0};
  lwmqtt_string_t topic_filter_s9 = {0, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x7e, 0x4a, 0xe7, 0xa9, 0x8f, 0x8e, 0x79, 0x89,
                                      0xfe, 0x6d, 0x87, 0xf9, 0xc4, 0x58, 0x14, 0x4a};
  lwmqtt_string_t topic_filter_s10 = {16, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = true;
  uint8_t bytesprops1[] = {0xa7, 0xc9, 0x3c, 0xe9, 0x20, 0x2,  0xa5, 0x6c, 0x42,
                           0xe5, 0xdb, 0x57, 0xcd, 0x5a, 0x9f, 0xa,  0xbb, 0xde};
  uint8_t bytesprops0[] = {0xf, 0x2b, 0x8f, 0xf1, 0xe6, 0x25, 0x3c, 0xe7, 0xe3, 0x49, 0xd6};
  uint8_t bytesprops2[] = {0xcf, 0x8f, 0x2c, 0xf0, 0xba, 0xcb, 0xa8, 0xc5, 0x8f, 0x9f, 0xb2, 0x86, 0x9b,
                           0x36, 0xf,  0xf7, 0x9f, 0xc4, 0xd4, 0xba, 0xb7, 0x67, 0x71, 0xc7, 0xfc, 0xfb};
  uint8_t bytesprops3[] = {0x21, 0xd0, 0xaa, 0x4c, 0x5f, 0xb1, 0xae, 0x25, 0x2,  0xbc, 0xce,
                           0x75, 0x1,  0x3b, 0xff, 0x32, 0xe,  0x81, 0x3b, 0xd5, 0x16, 0xab};
  uint8_t bytesprops4[] = {0xc0, 0xdc, 0x41, 0x45, 0xe8, 0x74, 0x3f, 0x2f, 0x42, 0x81,
                           0xa4, 0x90, 0x0,  0xd6, 0x90, 0xcb, 0x71, 0x1f, 0xce, 0x4};
  uint8_t bytesprops5[] = {0x55, 0x1c, 0x47, 0xcb, 0xf3, 0xbf, 0xfb, 0x7b, 0x5c, 0xd, 0x2e,
                           0xba, 0x94, 0xf2, 0x55, 0x16, 0xc0, 0x70, 0x1d, 0xcc, 0x56};
  uint8_t bytesprops6[] = {0x12, 0xab, 0x7d, 0x2b, 0x99, 0x2, 0xf2, 0x6d, 0x11, 0x6, 0x9b, 0x20, 0xeb};
  uint8_t bytesprops7[] = {0x65};
  uint8_t bytesprops8[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22521}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops0}, .v = {18, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7152}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 31}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21728}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17953, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26518 [("\NULJ\205v\253\154",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2}),("j\182X\235\201r\170\214\STX\134\241\201\150\253\226\SYN",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("ap\232$>@\178\148\vR\208\227\232\190\&0*N>\US\202\188",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("+b\142\ETB/\213xA\202y\175i)\183\171\142Yw_\228\&2\170\156 \129",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("A\187\CAN\243\184\211b\170\231tK\171\170R\216Gw\149<Q\151\fZ\134\213",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\239",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\204\&7}q)9\NUL\STX@\169Q\193\208\166e\195",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\188\EOT\144%2\198g\206\SYN,\209\175l\213$\150q\DC1",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\245\238,",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropSubscriptionIdentifierAvailable 18,PropSessionExpiryInterval 25344,PropReasonString
// "\227F\166\179\249h",PropResponseTopic
// "\170\253A\254\239}\145Hq\206wNm\199\NULg\DEL\205\167\182\202",PropResponseInformation
// "^\185}\SUB\168\206!N\155b\181'\159\DC2A/\144|",PropWildcardSubscriptionAvailable 79,PropCorrelationData
// "Kxdh\152$\160\147\149\ENQ\\\163",PropRetainAvailable 153,PropServerReference
// "*\223\226\177\177&\234\243\166/\128\164\192D\198\255\228\SOH\170\224\ENQl\155\NUL\225\179o\164-",PropSharedSubscriptionAvailable
// 102,PropWildcardSubscriptionAvailable 89,PropContentType
// "\149s[]_\250\208ij\255\209\174\164z3\CAN\210\181V\185\167?=\ETX\ACK\240\152\225k\210",PropResponseTopic
// "[k\248z\130\227F\249.\136G\254m?j\DC2}\227\STX\178\136EZIb\181\168\185",PropWillDelayInterval 950,PropTopicAlias
// 2166,PropServerKeepAlive 15135,PropServerReference "\"\DC2\156G\al0\216\SIR",PropMessageExpiryInterval
// 20768,PropReceiveMaximum 8940,PropContentType "[\190K\216\156\188 u\160?\229"]
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x82, 0x84, 0x3,  0x67, 0x96, 0xe2, 0x1,  0x29, 0x12, 0x11, 0x0,  0x0,  0x63, 0x0,  0x1f, 0x0,  0x6,  0xe3, 0x46,
      0xa6, 0xb3, 0xf9, 0x68, 0x8,  0x0,  0x15, 0xaa, 0xfd, 0x41, 0xfe, 0xef, 0x7d, 0x91, 0x48, 0x71, 0xce, 0x77, 0x4e,
      0x6d, 0xc7, 0x0,  0x67, 0x7f, 0xcd, 0xa7, 0xb6, 0xca, 0x1a, 0x0,  0x12, 0x5e, 0xb9, 0x7d, 0x1a, 0xa8, 0xce, 0x21,
      0x4e, 0x9b, 0x62, 0xb5, 0x27, 0x9f, 0x12, 0x41, 0x2f, 0x90, 0x7c, 0x28, 0x4f, 0x9,  0x0,  0xc,  0x4b, 0x78, 0x64,
      0x68, 0x98, 0x24, 0xa0, 0x93, 0x95, 0x5,  0x5c, 0xa3, 0x25, 0x99, 0x1c, 0x0,  0x1d, 0x2a, 0xdf, 0xe2, 0xb1, 0xb1,
      0x26, 0xea, 0xf3, 0xa6, 0x2f, 0x80, 0xa4, 0xc0, 0x44, 0xc6, 0xff, 0xe4, 0x1,  0xaa, 0xe0, 0x5,  0x6c, 0x9b, 0x0,
      0xe1, 0xb3, 0x6f, 0xa4, 0x2d, 0x2a, 0x66, 0x28, 0x59, 0x3,  0x0,  0x1e, 0x95, 0x73, 0x5b, 0x5d, 0x5f, 0xfa, 0xd0,
      0x69, 0x6a, 0xff, 0xd1, 0xae, 0xa4, 0x7a, 0x33, 0x18, 0xd2, 0xb5, 0x56, 0xb9, 0xa7, 0x3f, 0x3d, 0x3,  0x6,  0xf0,
      0x98, 0xe1, 0x6b, 0xd2, 0x8,  0x0,  0x1c, 0x5b, 0x6b, 0xf8, 0x7a, 0x82, 0xe3, 0x46, 0xf9, 0x2e, 0x88, 0x47, 0xfe,
      0x6d, 0x3f, 0x6a, 0x12, 0x7d, 0xe3, 0x2,  0xb2, 0x88, 0x45, 0x5a, 0x49, 0x62, 0xb5, 0xa8, 0xb9, 0x18, 0x0,  0x0,
      0x3,  0xb6, 0x23, 0x8,  0x76, 0x13, 0x3b, 0x1f, 0x1c, 0x0,  0xa,  0x22, 0x12, 0x9c, 0x47, 0x7,  0x6c, 0x30, 0xd8,
      0xf,  0x52, 0x2,  0x0,  0x0,  0x51, 0x20, 0x21, 0x22, 0xec, 0x3,  0x0,  0xb,  0x5b, 0xbe, 0x4b, 0xd8, 0x9c, 0xbc,
      0x20, 0x75, 0xa0, 0x3f, 0xe5, 0x0,  0x6,  0x0,  0x4a, 0xcd, 0x76, 0xfd, 0x9a, 0x16, 0x0,  0x10, 0x6a, 0xb6, 0x58,
      0xeb, 0xc9, 0x72, 0xaa, 0xd6, 0x2,  0x86, 0xf1, 0xc9, 0x96, 0xfd, 0xe2, 0x16, 0x12, 0x0,  0x15, 0x61, 0x70, 0xe8,
      0x24, 0x3e, 0x40, 0xb2, 0x94, 0xb,  0x52, 0xd0, 0xe3, 0xe8, 0xbe, 0x30, 0x2a, 0x4e, 0x3e, 0x1f, 0xca, 0xbc, 0x26,
      0x0,  0x19, 0x2b, 0x62, 0x8e, 0x17, 0x2f, 0xd5, 0x78, 0x41, 0xca, 0x79, 0xaf, 0x69, 0x29, 0xb7, 0xab, 0x8e, 0x59,
      0x77, 0x5f, 0xe4, 0x32, 0xaa, 0x9c, 0x20, 0x81, 0x28, 0x0,  0x19, 0x41, 0xbb, 0x18, 0xf3, 0xb8, 0xd3, 0x62, 0xaa,
      0xe7, 0x74, 0x4b, 0xab, 0xaa, 0x52, 0xd8, 0x47, 0x77, 0x95, 0x3c, 0x51, 0x97, 0xc,  0x5a, 0x86, 0xd5, 0x10, 0x0,
      0x1,  0xef, 0x26, 0x0,  0x10, 0xcc, 0x37, 0x7d, 0x71, 0x29, 0x39, 0x0,  0x2,  0x40, 0xa9, 0x51, 0xc1, 0xd0, 0xa6,
      0x65, 0xc3, 0x2c, 0x0,  0x12, 0xbc, 0x4,  0x90, 0x25, 0x32, 0xc6, 0x67, 0xce, 0x16, 0x2c, 0xd1, 0xaf, 0x6c, 0xd5,
      0x24, 0x96, 0x71, 0x11, 0x2a, 0x0,  0x3,  0xf5, 0xee, 0x2c, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x0, 0x4a, 0xcd, 0x76, 0xfd, 0x9a};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0xb6, 0x58, 0xeb, 0xc9, 0x72, 0xaa, 0xd6,
                                     0x2,  0x86, 0xf1, 0xc9, 0x96, 0xfd, 0xe2, 0x16};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x61, 0x70, 0xe8, 0x24, 0x3e, 0x40, 0xb2, 0x94, 0xb,  0x52, 0xd0,
                                     0xe3, 0xe8, 0xbe, 0x30, 0x2a, 0x4e, 0x3e, 0x1f, 0xca, 0xbc};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0x62, 0x8e, 0x17, 0x2f, 0xd5, 0x78, 0x41, 0xca, 0x79, 0xaf, 0x69, 0x29,
                                     0xb7, 0xab, 0x8e, 0x59, 0x77, 0x5f, 0xe4, 0x32, 0xaa, 0x9c, 0x20, 0x81};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x41, 0xbb, 0x18, 0xf3, 0xb8, 0xd3, 0x62, 0xaa, 0xe7, 0x74, 0x4b, 0xab, 0xaa,
                                     0x52, 0xd8, 0x47, 0x77, 0x95, 0x3c, 0x51, 0x97, 0xc,  0x5a, 0x86, 0xd5};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xef};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xcc, 0x37, 0x7d, 0x71, 0x29, 0x39, 0x0,  0x2,
                                     0x40, 0xa9, 0x51, 0xc1, 0xd0, 0xa6, 0x65, 0xc3};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbc, 0x4,  0x90, 0x25, 0x32, 0xc6, 0x67, 0xce, 0x16,
                                     0x2c, 0xd1, 0xaf, 0x6c, 0xd5, 0x24, 0x96, 0x71, 0x11};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xf5, 0xee, 0x2c};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  uint8_t bytesprops0[] = {0xe3, 0x46, 0xa6, 0xb3, 0xf9, 0x68};
  uint8_t bytesprops1[] = {0xaa, 0xfd, 0x41, 0xfe, 0xef, 0x7d, 0x91, 0x48, 0x71, 0xce, 0x77,
                           0x4e, 0x6d, 0xc7, 0x0,  0x67, 0x7f, 0xcd, 0xa7, 0xb6, 0xca};
  uint8_t bytesprops2[] = {0x5e, 0xb9, 0x7d, 0x1a, 0xa8, 0xce, 0x21, 0x4e, 0x9b,
                           0x62, 0xb5, 0x27, 0x9f, 0x12, 0x41, 0x2f, 0x90, 0x7c};
  uint8_t bytesprops3[] = {0x4b, 0x78, 0x64, 0x68, 0x98, 0x24, 0xa0, 0x93, 0x95, 0x5, 0x5c, 0xa3};
  uint8_t bytesprops4[] = {0x2a, 0xdf, 0xe2, 0xb1, 0xb1, 0x26, 0xea, 0xf3, 0xa6, 0x2f, 0x80, 0xa4, 0xc0, 0x44, 0xc6,
                           0xff, 0xe4, 0x1,  0xaa, 0xe0, 0x5,  0x6c, 0x9b, 0x0,  0xe1, 0xb3, 0x6f, 0xa4, 0x2d};
  uint8_t bytesprops5[] = {0x95, 0x73, 0x5b, 0x5d, 0x5f, 0xfa, 0xd0, 0x69, 0x6a, 0xff, 0xd1, 0xae, 0xa4, 0x7a, 0x33,
                           0x18, 0xd2, 0xb5, 0x56, 0xb9, 0xa7, 0x3f, 0x3d, 0x3,  0x6,  0xf0, 0x98, 0xe1, 0x6b, 0xd2};
  uint8_t bytesprops6[] = {0x5b, 0x6b, 0xf8, 0x7a, 0x82, 0xe3, 0x46, 0xf9, 0x2e, 0x88, 0x47, 0xfe, 0x6d, 0x3f,
                           0x6a, 0x12, 0x7d, 0xe3, 0x2,  0xb2, 0x88, 0x45, 0x5a, 0x49, 0x62, 0xb5, 0xa8, 0xb9};
  uint8_t bytesprops7[] = {0x22, 0x12, 0x9c, 0x47, 0x7, 0x6c, 0x30, 0xd8, 0xf, 0x52};
  uint8_t bytesprops8[] = {0x5b, 0xbe, 0x4b, 0xd8, 0x9c, 0xbc, 0x20, 0x75, 0xa0, 0x3f, 0xe5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25344}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 950}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2166}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15135}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20768}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8940}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26518, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23523 [(":Z\253\179\246i\tC\DC4\225\244o",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\144\242\242\&8\223\137pLrC\169\233\142\205;P\227",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\\\t",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\153$\209s\206v>i\252\163\&4U\209\180\245\226\249-\209\158\&5\245\NUL\234\DC10\214",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\218\246\226&[\153t\186\250\SI\199\252\144\201\139\191U?\SI\207?Q",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\242x\138*\224\132\237\229\218\231\&4\189|",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\DLE\EOT\229e\SO\165\202\190",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})]
// [PropMessageExpiryInterval 1813,PropContentType "",PropAuthenticationMethod
// "\146*\STX\150>\233\167?\ra\EM\DEL",PropAuthenticationData
// "t[\132\EM\SI\175l[\SYN41\133\151\DC3\236q\195\CAN\131\232\211\213\188K_\229?",PropMessageExpiryInterval
// 22279,PropTopicAliasMaximum 29118,PropSubscriptionIdentifierAvailable 189,PropRequestProblemInformation
// 76,PropReceiveMaximum 22760,PropReasonString "CBVj\185\243 \ESC\176~a\231k",PropUserProperty
// "\242*\188\196\177\&5\DEL\bKv\207\SYN\215" "\250G\"u\198v`\238\198\DC1_\135\212f\201",PropAssignedClientIdentifier
// "\ETB9\171\SI\144\204\163\a)\232\251\242\DC1Q\132\228\&6\208\200\143Uj\EOT\ESC\135\241",PropSessionExpiryInterval
// 25871,PropSessionExpiryInterval 9023,PropAuthenticationData
// "\208\157Z\nlv\220\151\150\150\&5\169\&6J=\178",PropRequestProblemInformation 137,PropUserProperty
// "\157\a\SUB,\239\ENQ\166\254\246R\245\165\nA\146\255\&7\181V\157\193\DC3\188\230\225"
// "\135\163\189\173H<v\183K\209\ACK e/6\227\221i\EOT\177\226)\161\DC2\215f\237]",PropResponseInformation
// "\aGV\149d\168\129U\143\"\167\230f\180\157C\223\156\217>o\231s\182",PropSessionExpiryInterval 6015,PropReceiveMaximum
// 16296,PropRequestProblemInformation 137]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x82, 0x91, 0x3,  0x5b, 0xe3, 0x90, 0x2,  0x2,  0x0,  0x0,  0x7,  0x15, 0x3,  0x0,  0x0,  0x15, 0x0,  0xc,  0x92,
      0x2a, 0x2,  0x96, 0x3e, 0xe9, 0xa7, 0x3f, 0xd,  0x61, 0x19, 0x7f, 0x16, 0x0,  0x1b, 0x74, 0x5b, 0x84, 0x19, 0xf,
      0xaf, 0x6c, 0x5b, 0x16, 0x34, 0x31, 0x85, 0x97, 0x13, 0xec, 0x71, 0xc3, 0x18, 0x83, 0xe8, 0xd3, 0xd5, 0xbc, 0x4b,
      0x5f, 0xe5, 0x3f, 0x2,  0x0,  0x0,  0x57, 0x7,  0x22, 0x71, 0xbe, 0x29, 0xbd, 0x17, 0x4c, 0x21, 0x58, 0xe8, 0x1f,
      0x0,  0xd,  0x43, 0x42, 0x56, 0x6a, 0xb9, 0xf3, 0x20, 0x1b, 0xb0, 0x7e, 0x61, 0xe7, 0x6b, 0x26, 0x0,  0xd,  0xf2,
      0x2a, 0xbc, 0xc4, 0xb1, 0x35, 0x7f, 0x8,  0x4b, 0x76, 0xcf, 0x16, 0xd7, 0x0,  0xf,  0xfa, 0x47, 0x22, 0x75, 0xc6,
      0x76, 0x60, 0xee, 0xc6, 0x11, 0x5f, 0x87, 0xd4, 0x66, 0xc9, 0x12, 0x0,  0x1a, 0x17, 0x39, 0xab, 0xf,  0x90, 0xcc,
      0xa3, 0x7,  0x29, 0xe8, 0xfb, 0xf2, 0x11, 0x51, 0x84, 0xe4, 0x36, 0xd0, 0xc8, 0x8f, 0x55, 0x6a, 0x4,  0x1b, 0x87,
      0xf1, 0x11, 0x0,  0x0,  0x65, 0xf,  0x11, 0x0,  0x0,  0x23, 0x3f, 0x16, 0x0,  0x10, 0xd0, 0x9d, 0x5a, 0xa,  0x6c,
      0x76, 0xdc, 0x97, 0x96, 0x96, 0x35, 0xa9, 0x36, 0x4a, 0x3d, 0xb2, 0x17, 0x89, 0x26, 0x0,  0x19, 0x9d, 0x7,  0x1a,
      0x2c, 0xef, 0x5,  0xa6, 0xfe, 0xf6, 0x52, 0xf5, 0xa5, 0xa,  0x41, 0x92, 0xff, 0x37, 0xb5, 0x56, 0x9d, 0xc1, 0x13,
      0xbc, 0xe6, 0xe1, 0x0,  0x1c, 0x87, 0xa3, 0xbd, 0xad, 0x48, 0x3c, 0x76, 0xb7, 0x4b, 0xd1, 0x6,  0x20, 0x65, 0x2f,
      0x36, 0xe3, 0xdd, 0x69, 0x4,  0xb1, 0xe2, 0x29, 0xa1, 0x12, 0xd7, 0x66, 0xed, 0x5d, 0x1a, 0x0,  0x18, 0x7,  0x47,
      0x56, 0x95, 0x64, 0xa8, 0x81, 0x55, 0x8f, 0x22, 0xa7, 0xe6, 0x66, 0xb4, 0x9d, 0x43, 0xdf, 0x9c, 0xd9, 0x3e, 0x6f,
      0xe7, 0x73, 0xb6, 0x11, 0x0,  0x0,  0x17, 0x7f, 0x21, 0x3f, 0xa8, 0x17, 0x89, 0x0,  0xc,  0x3a, 0x5a, 0xfd, 0xb3,
      0xf6, 0x69, 0x9,  0x43, 0x14, 0xe1, 0xf4, 0x6f, 0x18, 0x0,  0x11, 0x90, 0xf2, 0xf2, 0x38, 0xdf, 0x89, 0x70, 0x4c,
      0x72, 0x43, 0xa9, 0xe9, 0x8e, 0xcd, 0x3b, 0x50, 0xe3, 0x9,  0x0,  0x2,  0x5c, 0x9,  0xc,  0x0,  0x1b, 0x99, 0x24,
      0xd1, 0x73, 0xce, 0x76, 0x3e, 0x69, 0xfc, 0xa3, 0x34, 0x55, 0xd1, 0xb4, 0xf5, 0xe2, 0xf9, 0x2d, 0xd1, 0x9e, 0x35,
      0xf5, 0x0,  0xea, 0x11, 0x30, 0xd6, 0x25, 0x0,  0x0,  0x19, 0x0,  0x16, 0xda, 0xf6, 0xe2, 0x26, 0x5b, 0x99, 0x74,
      0xba, 0xfa, 0xf,  0xc7, 0xfc, 0x90, 0xc9, 0x8b, 0xbf, 0x55, 0x3f, 0xf,  0xcf, 0x3f, 0x51, 0x15, 0x0,  0xd,  0xf2,
      0x78, 0x8a, 0x2a, 0xe0, 0x84, 0xed, 0xe5, 0xda, 0xe7, 0x34, 0xbd, 0x7c, 0x22, 0x0,  0x8,  0x10, 0x4,  0xe5, 0x65,
      0xe,  0xa5, 0xca, 0xbe, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x3a, 0x5a, 0xfd, 0xb3, 0xf6, 0x69, 0x9, 0x43, 0x14, 0xe1, 0xf4, 0x6f};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x90, 0xf2, 0xf2, 0x38, 0xdf, 0x89, 0x70, 0x4c, 0x72,
                                     0x43, 0xa9, 0xe9, 0x8e, 0xcd, 0x3b, 0x50, 0xe3};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5c, 0x9};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x99, 0x24, 0xd1, 0x73, 0xce, 0x76, 0x3e, 0x69, 0xfc, 0xa3, 0x34, 0x55, 0xd1, 0xb4,
                                     0xf5, 0xe2, 0xf9, 0x2d, 0xd1, 0x9e, 0x35, 0xf5, 0x0,  0xea, 0x11, 0x30, 0xd6};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xda, 0xf6, 0xe2, 0x26, 0x5b, 0x99, 0x74, 0xba, 0xfa, 0xf,  0xc7,
                                     0xfc, 0x90, 0xc9, 0x8b, 0xbf, 0x55, 0x3f, 0xf,  0xcf, 0x3f, 0x51};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf2, 0x78, 0x8a, 0x2a, 0xe0, 0x84, 0xed, 0xe5, 0xda, 0xe7, 0x34, 0xbd, 0x7c};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x10, 0x4, 0xe5, 0x65, 0xe, 0xa5, 0xca, 0xbe};
  lwmqtt_string_t topic_filter_s7 = {8, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x92, 0x2a, 0x2, 0x96, 0x3e, 0xe9, 0xa7, 0x3f, 0xd, 0x61, 0x19, 0x7f};
  uint8_t bytesprops2[] = {0x74, 0x5b, 0x84, 0x19, 0xf,  0xaf, 0x6c, 0x5b, 0x16, 0x34, 0x31, 0x85, 0x97, 0x13,
                           0xec, 0x71, 0xc3, 0x18, 0x83, 0xe8, 0xd3, 0xd5, 0xbc, 0x4b, 0x5f, 0xe5, 0x3f};
  uint8_t bytesprops3[] = {0x43, 0x42, 0x56, 0x6a, 0xb9, 0xf3, 0x20, 0x1b, 0xb0, 0x7e, 0x61, 0xe7, 0x6b};
  uint8_t bytesprops5[] = {0xfa, 0x47, 0x22, 0x75, 0xc6, 0x76, 0x60, 0xee, 0xc6, 0x11, 0x5f, 0x87, 0xd4, 0x66, 0xc9};
  uint8_t bytesprops4[] = {0xf2, 0x2a, 0xbc, 0xc4, 0xb1, 0x35, 0x7f, 0x8, 0x4b, 0x76, 0xcf, 0x16, 0xd7};
  uint8_t bytesprops6[] = {0x17, 0x39, 0xab, 0xf,  0x90, 0xcc, 0xa3, 0x7,  0x29, 0xe8, 0xfb, 0xf2, 0x11,
                           0x51, 0x84, 0xe4, 0x36, 0xd0, 0xc8, 0x8f, 0x55, 0x6a, 0x4,  0x1b, 0x87, 0xf1};
  uint8_t bytesprops7[] = {0xd0, 0x9d, 0x5a, 0xa,  0x6c, 0x76, 0xdc, 0x97,
                           0x96, 0x96, 0x35, 0xa9, 0x36, 0x4a, 0x3d, 0xb2};
  uint8_t bytesprops9[] = {0x87, 0xa3, 0xbd, 0xad, 0x48, 0x3c, 0x76, 0xb7, 0x4b, 0xd1, 0x6,  0x20, 0x65, 0x2f,
                           0x36, 0xe3, 0xdd, 0x69, 0x4,  0xb1, 0xe2, 0x29, 0xa1, 0x12, 0xd7, 0x66, 0xed, 0x5d};
  uint8_t bytesprops8[] = {0x9d, 0x7,  0x1a, 0x2c, 0xef, 0x5,  0xa6, 0xfe, 0xf6, 0x52, 0xf5, 0xa5, 0xa,
                           0x41, 0x92, 0xff, 0x37, 0xb5, 0x56, 0x9d, 0xc1, 0x13, 0xbc, 0xe6, 0xe1};
  uint8_t bytesprops10[] = {0x7,  0x47, 0x56, 0x95, 0x64, 0xa8, 0x81, 0x55, 0x8f, 0x22, 0xa7, 0xe6,
                            0x66, 0xb4, 0x9d, 0x43, 0xdf, 0x9c, 0xd9, 0x3e, 0x6f, 0xe7, 0x73, 0xb6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1813}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22279}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29118}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22760}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops4}, .v = {15, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25871}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9023}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops8}, .v = {28, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6015}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16296}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 137}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23523, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10563 [("\168\239",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("b\DC2\247\191\181;_\144\ETX9R\f\212\n*;",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("M\245\139sC\176\233\&4\SI\136\188%\219\r\ENQ\SOS\142%*R8\171\v\149\180\155",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("F\143\188\229\139~\201\n\GSVs\v",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("M\203\202\148\227\243\227S\239h\b\165\&3\230\DC4B\DEL",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\200\DC1P\EOT&",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS1}),("\200k\212;\251\194\248\153",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("s\233\DEL\210\244\r\226\142\130\195R",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\228\164;\SUB'C\EM\168\199Z\168Yb\SO\EM",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\210|7\DC3\f}\178\DC4\141\DC2\204\NUL\231\224\SOH|}",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropAuthenticationData
// "{",PropMessageExpiryInterval 5895,PropSubscriptionIdentifier 5,PropSessionExpiryInterval
// 25392,PropSharedSubscriptionAvailable 28,PropSubscriptionIdentifierAvailable 62,PropAuthenticationMethod
// "\159\DEL<\155\134%\196",PropAssignedClientIdentifier
// "\\,\192$\202\&5\255\220\ESC\189\244\239\&5@3\n\176\CAN}M,\f\239\216L\207\179o\f",PropPayloadFormatIndicator
// 192,PropAuthenticationData "\f\SI\229\195\254\&3",PropMaximumQoS 239,PropServerReference
// "\190\197Lr\tft\221\254\137\193\\\DC1\182\244x@I\\\223\247\137\206>\CAN\208\255",PropRequestProblemInformation
// 159,PropRetainAvailable 120,PropContentType
// "\EOTD\176\165\131\198\219T\145\236\US\177\&5[\n\STX\198\&7\143\CAN\b\201\186\f\129Kt",PropReasonString
// "\130\249\DC1B\134q\198\206_\217I\183d!P)\DC2\201\b\220\242\199;\220",PropCorrelationData
// "\180bx\129h\NUL\EM\191/\179lg\EM",PropCorrelationData "\175O",PropRetainAvailable 29,PropRequestProblemInformation
// 96,PropMessageExpiryInterval 19278,PropMessageExpiryInterval 32397,PropResponseInformation
// "\a\128Z\207qt\159\207\162\226q\SOH&\143(p\192n9_\216X \DC1\DLE\"\243f;",PropSubscriptionIdentifier
// 4,PropMaximumPacketSize 31914]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x82, 0x97, 0x3,  0x29, 0x43, 0xf0, 0x1,  0x16, 0x0,  0x1,  0x7b, 0x2,  0x0,  0x0,  0x17, 0x7,  0xb,  0x5,  0x11,
      0x0,  0x0,  0x63, 0x30, 0x2a, 0x1c, 0x29, 0x3e, 0x15, 0x0,  0x7,  0x9f, 0x7f, 0x3c, 0x9b, 0x86, 0x25, 0xc4, 0x12,
      0x0,  0x1d, 0x5c, 0x2c, 0xc0, 0x24, 0xca, 0x35, 0xff, 0xdc, 0x1b, 0xbd, 0xf4, 0xef, 0x35, 0x40, 0x33, 0xa,  0xb0,
      0x18, 0x7d, 0x4d, 0x2c, 0xc,  0xef, 0xd8, 0x4c, 0xcf, 0xb3, 0x6f, 0xc,  0x1,  0xc0, 0x16, 0x0,  0x6,  0xc,  0xf,
      0xe5, 0xc3, 0xfe, 0x33, 0x24, 0xef, 0x1c, 0x0,  0x1b, 0xbe, 0xc5, 0x4c, 0x72, 0x9,  0x66, 0x74, 0xdd, 0xfe, 0x89,
      0xc1, 0x5c, 0x11, 0xb6, 0xf4, 0x78, 0x40, 0x49, 0x5c, 0xdf, 0xf7, 0x89, 0xce, 0x3e, 0x18, 0xd0, 0xff, 0x17, 0x9f,
      0x25, 0x78, 0x3,  0x0,  0x1b, 0x4,  0x44, 0xb0, 0xa5, 0x83, 0xc6, 0xdb, 0x54, 0x91, 0xec, 0x1f, 0xb1, 0x35, 0x5b,
      0xa,  0x2,  0xc6, 0x37, 0x8f, 0x18, 0x8,  0xc9, 0xba, 0xc,  0x81, 0x4b, 0x74, 0x1f, 0x0,  0x18, 0x82, 0xf9, 0x11,
      0x42, 0x86, 0x71, 0xc6, 0xce, 0x5f, 0xd9, 0x49, 0xb7, 0x64, 0x21, 0x50, 0x29, 0x12, 0xc9, 0x8,  0xdc, 0xf2, 0xc7,
      0x3b, 0xdc, 0x9,  0x0,  0xd,  0xb4, 0x62, 0x78, 0x81, 0x68, 0x0,  0x19, 0xbf, 0x2f, 0xb3, 0x6c, 0x67, 0x19, 0x9,
      0x0,  0x2,  0xaf, 0x4f, 0x25, 0x1d, 0x17, 0x60, 0x2,  0x0,  0x0,  0x4b, 0x4e, 0x2,  0x0,  0x0,  0x7e, 0x8d, 0x1a,
      0x0,  0x1d, 0x7,  0x80, 0x5a, 0xcf, 0x71, 0x74, 0x9f, 0xcf, 0xa2, 0xe2, 0x71, 0x1,  0x26, 0x8f, 0x28, 0x70, 0xc0,
      0x6e, 0x39, 0x5f, 0xd8, 0x58, 0x20, 0x11, 0x10, 0x22, 0xf3, 0x66, 0x3b, 0xb,  0x4,  0x27, 0x0,  0x0,  0x7c, 0xaa,
      0x0,  0x2,  0xa8, 0xef, 0x1c, 0x0,  0x10, 0x62, 0x12, 0xf7, 0xbf, 0xb5, 0x3b, 0x5f, 0x90, 0x3,  0x39, 0x52, 0xc,
      0xd4, 0xa,  0x2a, 0x3b, 0xd,  0x0,  0x1b, 0x4d, 0xf5, 0x8b, 0x73, 0x43, 0xb0, 0xe9, 0x34, 0xf,  0x88, 0xbc, 0x25,
      0xdb, 0xd,  0x5,  0xe,  0x53, 0x8e, 0x25, 0x2a, 0x52, 0x38, 0xab, 0xb,  0x95, 0xb4, 0x9b, 0x19, 0x0,  0xc,  0x46,
      0x8f, 0xbc, 0xe5, 0x8b, 0x7e, 0xc9, 0xa,  0x1d, 0x56, 0x73, 0xb,  0x10, 0x0,  0x11, 0x4d, 0xcb, 0xca, 0x94, 0xe3,
      0xf3, 0xe3, 0x53, 0xef, 0x68, 0x8,  0xa5, 0x33, 0xe6, 0x14, 0x42, 0x7f, 0xa,  0x0,  0x5,  0xc8, 0x11, 0x50, 0x4,
      0x26, 0x29, 0x0,  0x8,  0xc8, 0x6b, 0xd4, 0x3b, 0xfb, 0xc2, 0xf8, 0x99, 0x1a, 0x0,  0xb,  0x73, 0xe9, 0x7f, 0xd2,
      0xf4, 0xd,  0xe2, 0x8e, 0x82, 0xc3, 0x52, 0x1a, 0x0,  0xf,  0xe4, 0xa4, 0x3b, 0x1a, 0x27, 0x43, 0x19, 0xa8, 0xc7,
      0x5a, 0xa8, 0x59, 0x62, 0xe,  0x19, 0x14, 0x0,  0x11, 0xd2, 0x7c, 0x37, 0x13, 0xc,  0x7d, 0xb2, 0x14, 0x8d, 0x12,
      0xcc, 0x0,  0xe7, 0xe0, 0x1,  0x7c, 0x7d, 0x20, 0x0,  0x0,  0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xa8, 0xef};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x62, 0x12, 0xf7, 0xbf, 0xb5, 0x3b, 0x5f, 0x90,
                                     0x3,  0x39, 0x52, 0xc,  0xd4, 0xa,  0x2a, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4d, 0xf5, 0x8b, 0x73, 0x43, 0xb0, 0xe9, 0x34, 0xf,  0x88, 0xbc, 0x25, 0xdb, 0xd,
                                     0x5,  0xe,  0x53, 0x8e, 0x25, 0x2a, 0x52, 0x38, 0xab, 0xb,  0x95, 0xb4, 0x9b};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x46, 0x8f, 0xbc, 0xe5, 0x8b, 0x7e, 0xc9, 0xa, 0x1d, 0x56, 0x73, 0xb};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4d, 0xcb, 0xca, 0x94, 0xe3, 0xf3, 0xe3, 0x53, 0xef,
                                     0x68, 0x8,  0xa5, 0x33, 0xe6, 0x14, 0x42, 0x7f};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc8, 0x11, 0x50, 0x4, 0x26};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc8, 0x6b, 0xd4, 0x3b, 0xfb, 0xc2, 0xf8, 0x99};
  lwmqtt_string_t topic_filter_s6 = {8, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x73, 0xe9, 0x7f, 0xd2, 0xf4, 0xd, 0xe2, 0x8e, 0x82, 0xc3, 0x52};
  lwmqtt_string_t topic_filter_s7 = {11, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe4, 0xa4, 0x3b, 0x1a, 0x27, 0x43, 0x19, 0xa8,
                                     0xc7, 0x5a, 0xa8, 0x59, 0x62, 0xe,  0x19};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xd2, 0x7c, 0x37, 0x13, 0xc,  0x7d, 0xb2, 0x14, 0x8d,
                                     0x12, 0xcc, 0x0,  0xe7, 0xe0, 0x1,  0x7c, 0x7d};
  lwmqtt_string_t topic_filter_s9 = {17, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0x7b};
  uint8_t bytesprops1[] = {0x9f, 0x7f, 0x3c, 0x9b, 0x86, 0x25, 0xc4};
  uint8_t bytesprops2[] = {0x5c, 0x2c, 0xc0, 0x24, 0xca, 0x35, 0xff, 0xdc, 0x1b, 0xbd, 0xf4, 0xef, 0x35, 0x40, 0x33,
                           0xa,  0xb0, 0x18, 0x7d, 0x4d, 0x2c, 0xc,  0xef, 0xd8, 0x4c, 0xcf, 0xb3, 0x6f, 0xc};
  uint8_t bytesprops3[] = {0xc, 0xf, 0xe5, 0xc3, 0xfe, 0x33};
  uint8_t bytesprops4[] = {0xbe, 0xc5, 0x4c, 0x72, 0x9,  0x66, 0x74, 0xdd, 0xfe, 0x89, 0xc1, 0x5c, 0x11, 0xb6,
                           0xf4, 0x78, 0x40, 0x49, 0x5c, 0xdf, 0xf7, 0x89, 0xce, 0x3e, 0x18, 0xd0, 0xff};
  uint8_t bytesprops5[] = {0x4, 0x44, 0xb0, 0xa5, 0x83, 0xc6, 0xdb, 0x54, 0x91, 0xec, 0x1f, 0xb1, 0x35, 0x5b,
                           0xa, 0x2,  0xc6, 0x37, 0x8f, 0x18, 0x8,  0xc9, 0xba, 0xc,  0x81, 0x4b, 0x74};
  uint8_t bytesprops6[] = {0x82, 0xf9, 0x11, 0x42, 0x86, 0x71, 0xc6, 0xce, 0x5f, 0xd9, 0x49, 0xb7,
                           0x64, 0x21, 0x50, 0x29, 0x12, 0xc9, 0x8,  0xdc, 0xf2, 0xc7, 0x3b, 0xdc};
  uint8_t bytesprops7[] = {0xb4, 0x62, 0x78, 0x81, 0x68, 0x0, 0x19, 0xbf, 0x2f, 0xb3, 0x6c, 0x67, 0x19};
  uint8_t bytesprops8[] = {0xaf, 0x4f};
  uint8_t bytesprops9[] = {0x7,  0x80, 0x5a, 0xcf, 0x71, 0x74, 0x9f, 0xcf, 0xa2, 0xe2, 0x71, 0x1,  0x26, 0x8f, 0x28,
                           0x70, 0xc0, 0x6e, 0x39, 0x5f, 0xd8, 0x58, 0x20, 0x11, 0x10, 0x22, 0xf3, 0x66, 0x3b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5895}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25392}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19278}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32397}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31914}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10563, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30451 [("%\173",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS1}),("\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS1}),("u\167Z\ENQ\NUL\246F\186",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("$Gw\252Le",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\195\180\153\189\221_ip\198\147\v\EM\182\215\RS\225D\173=oL",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\216y\n\207uS5\157\EM\SYN\182\169\188\154",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0}),("\235g\164\247p\SUB~D\219!:\SOH_\192",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\226(\200\&7F\131\255\223q\178;",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS =
// QoS1}),("\228\218\198\182\168j&\DC2y\249>\132\\>\f\225\180\212\vV\188\EOTTx\215",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\ETX",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropMaximumQoS
// 107,PropRequestProblemInformation 8,PropTopicAliasMaximum 31079,PropServerKeepAlive
// 30906,PropSharedSubscriptionAvailable 183,PropMaximumPacketSize 22245,PropAuthenticationMethod
// "\184\181\193\176\186\243\139\201\155\229\136\168\225\DC1\EOTYV\173\ESC\DC3\170",PropRetainAvailable
// 243,PropSubscriptionIdentifier 12,PropCorrelationData "\204\189\132U\215",PropServerReference
// "+\206\240JR\200\168\206\182-\209\163\171O\169:",PropUserProperty "\DC1\145\&2\DC2" "\DC4",PropServerReference
// "?\137hg\168\167N\186Ad\194\DC1",PropMaximumQoS 230,PropServerKeepAlive 16962,PropResponseTopic
// "\204\156l\167\ESC\172\142\223\248\214h[]",PropServerKeepAlive 17136,PropSubscriptionIdentifierAvailable
// 23,PropRequestProblemInformation 1,PropReasonString "\187Az\153H#\151\NULo",PropAuthenticationData
// "*\164",PropResponseTopic
// "\207\195\147\&6\198^\NAK\148Y\191d-\237\234\145\SYN\DLE\130\239\214\CAN\207\248",PropAuthenticationMethod
// "8Ty\200\190^\241T\220.\EM\237\158\ENQ\139\238\186\193\242%\146\205*\ENQ"]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {
      0x82, 0xcf, 0x2,  0x76, 0xf3, 0xc3, 0x1,  0x24, 0x6b, 0x17, 0x8,  0x22, 0x79, 0x67, 0x13, 0x78, 0xba, 0x2a, 0xb7,
      0x27, 0x0,  0x0,  0x56, 0xe5, 0x15, 0x0,  0x15, 0xb8, 0xb5, 0xc1, 0xb0, 0xba, 0xf3, 0x8b, 0xc9, 0x9b, 0xe5, 0x88,
      0xa8, 0xe1, 0x11, 0x4,  0x59, 0x56, 0xad, 0x1b, 0x13, 0xaa, 0x25, 0xf3, 0xb,  0xc,  0x9,  0x0,  0x5,  0xcc, 0xbd,
      0x84, 0x55, 0xd7, 0x1c, 0x0,  0x10, 0x2b, 0xce, 0xf0, 0x4a, 0x52, 0xc8, 0xa8, 0xce, 0xb6, 0x2d, 0xd1, 0xa3, 0xab,
      0x4f, 0xa9, 0x3a, 0x26, 0x0,  0x4,  0x11, 0x91, 0x32, 0x12, 0x0,  0x1,  0x14, 0x1c, 0x0,  0xc,  0x3f, 0x89, 0x68,
      0x67, 0xa8, 0xa7, 0x4e, 0xba, 0x41, 0x64, 0xc2, 0x11, 0x24, 0xe6, 0x13, 0x42, 0x42, 0x8,  0x0,  0xd,  0xcc, 0x9c,
      0x6c, 0xa7, 0x1b, 0xac, 0x8e, 0xdf, 0xf8, 0xd6, 0x68, 0x5b, 0x5d, 0x13, 0x42, 0xf0, 0x29, 0x17, 0x17, 0x1,  0x1f,
      0x0,  0x9,  0xbb, 0x41, 0x7a, 0x99, 0x48, 0x23, 0x97, 0x0,  0x6f, 0x16, 0x0,  0x2,  0x2a, 0xa4, 0x8,  0x0,  0x17,
      0xcf, 0xc3, 0x93, 0x36, 0xc6, 0x5e, 0x15, 0x94, 0x59, 0xbf, 0x64, 0x2d, 0xed, 0xea, 0x91, 0x16, 0x10, 0x82, 0xef,
      0xd6, 0x18, 0xcf, 0xf8, 0x15, 0x0,  0x18, 0x38, 0x54, 0x79, 0xc8, 0xbe, 0x5e, 0xf1, 0x54, 0xdc, 0x2e, 0x19, 0xed,
      0x9e, 0x5,  0x8b, 0xee, 0xba, 0xc1, 0xf2, 0x25, 0x92, 0xcd, 0x2a, 0x5,  0x0,  0x2,  0x25, 0xad, 0x10, 0x0,  0x0,
      0x15, 0x0,  0x1,  0xc5, 0xd,  0x0,  0x8,  0x75, 0xa7, 0x5a, 0x5,  0x0,  0xf6, 0x46, 0xba, 0x9,  0x0,  0x6,  0x24,
      0x47, 0x77, 0xfc, 0x4c, 0x65, 0x16, 0x0,  0x15, 0xc3, 0xb4, 0x99, 0xbd, 0xdd, 0x5f, 0x69, 0x70, 0xc6, 0x93, 0xb,
      0x19, 0xb6, 0xd7, 0x1e, 0xe1, 0x44, 0xad, 0x3d, 0x6f, 0x4c, 0x2c, 0x0,  0xe,  0xd8, 0x79, 0xa,  0xcf, 0x75, 0x53,
      0x35, 0x9d, 0x19, 0x16, 0xb6, 0xa9, 0xbc, 0x9a, 0x0,  0x0,  0xe,  0xeb, 0x67, 0xa4, 0xf7, 0x70, 0x1a, 0x7e, 0x44,
      0xdb, 0x21, 0x3a, 0x1,  0x5f, 0xc0, 0x16, 0x0,  0xb,  0xe2, 0x28, 0xc8, 0x37, 0x46, 0x83, 0xff, 0xdf, 0x71, 0xb2,
      0x3b, 0x29, 0x0,  0x19, 0xe4, 0xda, 0xc6, 0xb6, 0xa8, 0x6a, 0x26, 0x12, 0x79, 0xf9, 0x3e, 0x84, 0x5c, 0x3e, 0xc,
      0xe1, 0xb4, 0xd4, 0xb,  0x56, 0xbc, 0x4,  0x54, 0x78, 0xd7, 0xc,  0x0,  0x1,  0x3,  0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x25, 0xad};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc5};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x75, 0xa7, 0x5a, 0x5, 0x0, 0xf6, 0x46, 0xba};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x24, 0x47, 0x77, 0xfc, 0x4c, 0x65};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc3, 0xb4, 0x99, 0xbd, 0xdd, 0x5f, 0x69, 0x70, 0xc6, 0x93, 0xb,
                                     0x19, 0xb6, 0xd7, 0x1e, 0xe1, 0x44, 0xad, 0x3d, 0x6f, 0x4c};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xd8, 0x79, 0xa, 0xcf, 0x75, 0x53, 0x35, 0x9d, 0x19, 0x16, 0xb6, 0xa9, 0xbc, 0x9a};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xeb, 0x67, 0xa4, 0xf7, 0x70, 0x1a, 0x7e, 0x44, 0xdb, 0x21, 0x3a, 0x1, 0x5f, 0xc0};
  lwmqtt_string_t topic_filter_s7 = {14, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xe2, 0x28, 0xc8, 0x37, 0x46, 0x83, 0xff, 0xdf, 0x71, 0xb2, 0x3b};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe4, 0xda, 0xc6, 0xb6, 0xa8, 0x6a, 0x26, 0x12, 0x79, 0xf9, 0x3e, 0x84, 0x5c,
                                     0x3e, 0xc,  0xe1, 0xb4, 0xd4, 0xb,  0x56, 0xbc, 0x4,  0x54, 0x78, 0xd7};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x3};
  lwmqtt_string_t topic_filter_s10 = {1, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0xb8, 0xb5, 0xc1, 0xb0, 0xba, 0xf3, 0x8b, 0xc9, 0x9b, 0xe5, 0x88,
                           0xa8, 0xe1, 0x11, 0x4,  0x59, 0x56, 0xad, 0x1b, 0x13, 0xaa};
  uint8_t bytesprops1[] = {0xcc, 0xbd, 0x84, 0x55, 0xd7};
  uint8_t bytesprops2[] = {0x2b, 0xce, 0xf0, 0x4a, 0x52, 0xc8, 0xa8, 0xce,
                           0xb6, 0x2d, 0xd1, 0xa3, 0xab, 0x4f, 0xa9, 0x3a};
  uint8_t bytesprops4[] = {0x14};
  uint8_t bytesprops3[] = {0x11, 0x91, 0x32, 0x12};
  uint8_t bytesprops5[] = {0x3f, 0x89, 0x68, 0x67, 0xa8, 0xa7, 0x4e, 0xba, 0x41, 0x64, 0xc2, 0x11};
  uint8_t bytesprops6[] = {0xcc, 0x9c, 0x6c, 0xa7, 0x1b, 0xac, 0x8e, 0xdf, 0xf8, 0xd6, 0x68, 0x5b, 0x5d};
  uint8_t bytesprops7[] = {0xbb, 0x41, 0x7a, 0x99, 0x48, 0x23, 0x97, 0x0, 0x6f};
  uint8_t bytesprops8[] = {0x2a, 0xa4};
  uint8_t bytesprops9[] = {0xcf, 0xc3, 0x93, 0x36, 0xc6, 0x5e, 0x15, 0x94, 0x59, 0xbf, 0x64, 0x2d,
                           0xed, 0xea, 0x91, 0x16, 0x10, 0x82, 0xef, 0xd6, 0x18, 0xcf, 0xf8};
  uint8_t bytesprops10[] = {0x38, 0x54, 0x79, 0xc8, 0xbe, 0x5e, 0xf1, 0x54, 0xdc, 0x2e, 0x19, 0xed,
                            0x9e, 0x5,  0x8b, 0xee, 0xba, 0xc1, 0xf2, 0x25, 0x92, 0xcd, 0x2a, 0x5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31079}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30906}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22245}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops3}, .v = {1, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16962}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17136}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30451, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5141 [("\173\ff",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS1}),("Jm\241\231Tp\203~\220z\153^\194\DC4\227'q\242\ESC1\177\192Q\185\NAK\ETX\139",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\227\229\242\245\173@\183\167\170\152\186\254\253<\SYN\223>|\242\237\137P8",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),(";\204",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\153H\234.\165\EM\135u#\SO\b\141\141\185I\210.\241\136\224",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\186\197\SYN\130",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\251y\216\143Q\220\DC1\248\132\241\NUL\SI\DC3\b\230z\EM\166|",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\148xP\RSO\SI",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})]
// [PropMessageExpiryInterval 30180,PropServerKeepAlive 3352,PropWillDelayInterval 23523,PropMaximumPacketSize
// 1624,PropAuthenticationData "\176\NAKz3+\CANbr\137\DC4\rO\215>\176\235f|\136\US\STX",PropAuthenticationMethod
// "\DEL\158 \228q\246d\210S0\183U",PropMaximumPacketSize 11585,PropSubscriptionIdentifier 1,PropTopicAlias
// 32339,PropMessageExpiryInterval 23859,PropMaximumPacketSize 21817,PropResponseInformation
// "\190s0\DEL}",PropCorrelationData "\186\169)t,B\158\SOH\185g]\245",PropContentType
// "\227\254\&9\223M\166$\231\200#\129\232\224\243p",PropMessageExpiryInterval 20421,PropSubscriptionIdentifierAvailable
// 250,PropSubscriptionIdentifier 4,PropPayloadFormatIndicator 15,PropResponseInformation
// "\DC3\136O\222\211O",PropWillDelayInterval 12115,PropMessageExpiryInterval 5290,PropRequestProblemInformation
// 242,PropAuthenticationMethod
// "<Eo\159\244G\ESC:\179\140<B\222\151\173\&4\176\216\245vKE]\r_\244#",PropMaximumPacketSize 1430,PropTopicAliasMaximum
// 9709,PropMaximumPacketSize 28728,PropMaximumPacketSize 30506,PropMaximumQoS 231,PropSessionExpiryInterval
// 17189,PropServerKeepAlive 3644]
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x82, 0xd4, 0x2,  0x14, 0x15, 0xd0, 0x1,  0x2,  0x0,  0x0,  0x75, 0xe4, 0x13, 0xd,  0x18, 0x18, 0x0,  0x0,  0x5b,
      0xe3, 0x27, 0x0,  0x0,  0x6,  0x58, 0x16, 0x0,  0x15, 0xb0, 0x15, 0x7a, 0x33, 0x2b, 0x18, 0x62, 0x72, 0x89, 0x14,
      0xd,  0x4f, 0xd7, 0x3e, 0xb0, 0xeb, 0x66, 0x7c, 0x88, 0x1f, 0x2,  0x15, 0x0,  0xc,  0x7f, 0x9e, 0x20, 0xe4, 0x71,
      0xf6, 0x64, 0xd2, 0x53, 0x30, 0xb7, 0x55, 0x27, 0x0,  0x0,  0x2d, 0x41, 0xb,  0x1,  0x23, 0x7e, 0x53, 0x2,  0x0,
      0x0,  0x5d, 0x33, 0x27, 0x0,  0x0,  0x55, 0x39, 0x1a, 0x0,  0x5,  0xbe, 0x73, 0x30, 0x7f, 0x7d, 0x9,  0x0,  0xc,
      0xba, 0xa9, 0x29, 0x74, 0x2c, 0x42, 0x9e, 0x1,  0xb9, 0x67, 0x5d, 0xf5, 0x3,  0x0,  0xf,  0xe3, 0xfe, 0x39, 0xdf,
      0x4d, 0xa6, 0x24, 0xe7, 0xc8, 0x23, 0x81, 0xe8, 0xe0, 0xf3, 0x70, 0x2,  0x0,  0x0,  0x4f, 0xc5, 0x29, 0xfa, 0xb,
      0x4,  0x1,  0xf,  0x1a, 0x0,  0x6,  0x13, 0x88, 0x4f, 0xde, 0xd3, 0x4f, 0x18, 0x0,  0x0,  0x2f, 0x53, 0x2,  0x0,
      0x0,  0x14, 0xaa, 0x17, 0xf2, 0x15, 0x0,  0x1b, 0x3c, 0x45, 0x6f, 0x9f, 0xf4, 0x47, 0x1b, 0x3a, 0xb3, 0x8c, 0x3c,
      0x42, 0xde, 0x97, 0xad, 0x34, 0xb0, 0xd8, 0xf5, 0x76, 0x4b, 0x45, 0x5d, 0xd,  0x5f, 0xf4, 0x23, 0x27, 0x0,  0x0,
      0x5,  0x96, 0x22, 0x25, 0xed, 0x27, 0x0,  0x0,  0x70, 0x38, 0x27, 0x0,  0x0,  0x77, 0x2a, 0x24, 0xe7, 0x11, 0x0,
      0x0,  0x43, 0x25, 0x13, 0xe,  0x3c, 0x0,  0x3,  0xad, 0xc,  0x66, 0x1,  0x0,  0x1b, 0x4a, 0x6d, 0xf1, 0xe7, 0x54,
      0x70, 0xcb, 0x7e, 0xdc, 0x7a, 0x99, 0x5e, 0xc2, 0x14, 0xe3, 0x27, 0x71, 0xf2, 0x1b, 0x31, 0xb1, 0xc0, 0x51, 0xb9,
      0x15, 0x3,  0x8b, 0x19, 0x0,  0x17, 0xe3, 0xe5, 0xf2, 0xf5, 0xad, 0x40, 0xb7, 0xa7, 0xaa, 0x98, 0xba, 0xfe, 0xfd,
      0x3c, 0x16, 0xdf, 0x3e, 0x7c, 0xf2, 0xed, 0x89, 0x50, 0x38, 0x1c, 0x0,  0x2,  0x3b, 0xcc, 0x2e, 0x0,  0x14, 0x99,
      0x48, 0xea, 0x2e, 0xa5, 0x19, 0x87, 0x75, 0x23, 0xe,  0x8,  0x8d, 0x8d, 0xb9, 0x49, 0xd2, 0x2e, 0xf1, 0x88, 0xe0,
      0x2a, 0x0,  0x4,  0xba, 0xc5, 0x16, 0x82, 0x9,  0x0,  0x13, 0xfb, 0x79, 0xd8, 0x8f, 0x51, 0xdc, 0x11, 0xf8, 0x84,
      0xf1, 0x0,  0xf,  0x13, 0x8,  0xe6, 0x7a, 0x19, 0xa6, 0x7c, 0x22, 0x0,  0x6,  0x94, 0x78, 0x50, 0x1e, 0x4f, 0xf,
      0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xad, 0xc, 0x66};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x4a, 0x6d, 0xf1, 0xe7, 0x54, 0x70, 0xcb, 0x7e, 0xdc, 0x7a, 0x99, 0x5e, 0xc2, 0x14,
                                     0xe3, 0x27, 0x71, 0xf2, 0x1b, 0x31, 0xb1, 0xc0, 0x51, 0xb9, 0x15, 0x3,  0x8b};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe3, 0xe5, 0xf2, 0xf5, 0xad, 0x40, 0xb7, 0xa7, 0xaa, 0x98, 0xba, 0xfe,
                                     0xfd, 0x3c, 0x16, 0xdf, 0x3e, 0x7c, 0xf2, 0xed, 0x89, 0x50, 0x38};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3b, 0xcc};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x99, 0x48, 0xea, 0x2e, 0xa5, 0x19, 0x87, 0x75, 0x23, 0xe,
                                     0x8,  0x8d, 0x8d, 0xb9, 0x49, 0xd2, 0x2e, 0xf1, 0x88, 0xe0};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xba, 0xc5, 0x16, 0x82};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfb, 0x79, 0xd8, 0x8f, 0x51, 0xdc, 0x11, 0xf8, 0x84, 0xf1,
                                     0x0,  0xf,  0x13, 0x8,  0xe6, 0x7a, 0x19, 0xa6, 0x7c};
  lwmqtt_string_t topic_filter_s6 = {19, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x94, 0x78, 0x50, 0x1e, 0x4f, 0xf};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  uint8_t bytesprops0[] = {0xb0, 0x15, 0x7a, 0x33, 0x2b, 0x18, 0x62, 0x72, 0x89, 0x14, 0xd,
                           0x4f, 0xd7, 0x3e, 0xb0, 0xeb, 0x66, 0x7c, 0x88, 0x1f, 0x2};
  uint8_t bytesprops1[] = {0x7f, 0x9e, 0x20, 0xe4, 0x71, 0xf6, 0x64, 0xd2, 0x53, 0x30, 0xb7, 0x55};
  uint8_t bytesprops2[] = {0xbe, 0x73, 0x30, 0x7f, 0x7d};
  uint8_t bytesprops3[] = {0xba, 0xa9, 0x29, 0x74, 0x2c, 0x42, 0x9e, 0x1, 0xb9, 0x67, 0x5d, 0xf5};
  uint8_t bytesprops4[] = {0xe3, 0xfe, 0x39, 0xdf, 0x4d, 0xa6, 0x24, 0xe7, 0xc8, 0x23, 0x81, 0xe8, 0xe0, 0xf3, 0x70};
  uint8_t bytesprops5[] = {0x13, 0x88, 0x4f, 0xde, 0xd3, 0x4f};
  uint8_t bytesprops6[] = {0x3c, 0x45, 0x6f, 0x9f, 0xf4, 0x47, 0x1b, 0x3a, 0xb3, 0x8c, 0x3c, 0x42, 0xde, 0x97,
                           0xad, 0x34, 0xb0, 0xd8, 0xf5, 0x76, 0x4b, 0x45, 0x5d, 0xd,  0x5f, 0xf4, 0x23};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30180}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3352}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23523}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1624}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11585}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 1}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32339}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23859}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21817}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20421}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12115}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5290}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1430}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9709}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28728}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30506}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17189}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3644}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5141, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8922 [("8[\204Te\235\185\154\136\vI\148\223",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("/\242O\211\r\131\245\210\240\128\SI/@",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\149\136\194\189\ESC\130\154\195\138b\146\NUL\181d\RS\a\216\241\FS\252\144\&3\185$K",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})] [PropMaximumQoS
// 26,PropAssignedClientIdentifier
// "H\DC3\ETB\158\DC1'\220\194^\SOHz\SOH9\184[1h\188\b\RS=\DC4\136a\229\t6:",PropAssignedClientIdentifier
// "\163\208J\209&Yb|_iC>\231",PropWillDelayInterval 13933,PropRequestResponseInformation 204,PropWillDelayInterval
// 15339,PropWildcardSubscriptionAvailable 166]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x7e, 0x22, 0xda, 0x3f, 0x24, 0x1a, 0x12, 0x0,  0x1c, 0x48, 0x13, 0x17, 0x9e, 0x11, 0x27,
                   0xdc, 0xc2, 0x5e, 0x1,  0x7a, 0x1,  0x39, 0xb8, 0x5b, 0x31, 0x68, 0xbc, 0x8,  0x1e, 0x3d, 0x14,
                   0x88, 0x61, 0xe5, 0x9,  0x36, 0x3a, 0x12, 0x0,  0xd,  0xa3, 0xd0, 0x4a, 0xd1, 0x26, 0x59, 0x62,
                   0x7c, 0x5f, 0x69, 0x43, 0x3e, 0xe7, 0x18, 0x0,  0x0,  0x36, 0x6d, 0x19, 0xcc, 0x18, 0x0,  0x0,
                   0x3b, 0xeb, 0x28, 0xa6, 0x0,  0xd,  0x38, 0x5b, 0xcc, 0x54, 0x65, 0xeb, 0xb9, 0x9a, 0x88, 0xb,
                   0x49, 0x94, 0xdf, 0x4,  0x0,  0xd,  0x2f, 0xf2, 0x4f, 0xd3, 0xd,  0x83, 0xf5, 0xd2, 0xf0, 0x80,
                   0xf,  0x2f, 0x40, 0x11, 0x0,  0x19, 0x95, 0x88, 0xc2, 0xbd, 0x1b, 0x82, 0x9a, 0xc3, 0x8a, 0x62,
                   0x92, 0x0,  0xb5, 0x64, 0x1e, 0x7,  0xd8, 0xf1, 0x1c, 0xfc, 0x90, 0x33, 0xb9, 0x24, 0x4b, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x38, 0x5b, 0xcc, 0x54, 0x65, 0xeb, 0xb9, 0x9a, 0x88, 0xb, 0x49, 0x94, 0xdf};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2f, 0xf2, 0x4f, 0xd3, 0xd, 0x83, 0xf5, 0xd2, 0xf0, 0x80, 0xf, 0x2f, 0x40};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x95, 0x88, 0xc2, 0xbd, 0x1b, 0x82, 0x9a, 0xc3, 0x8a, 0x62, 0x92, 0x0, 0xb5,
                                     0x64, 0x1e, 0x7,  0xd8, 0xf1, 0x1c, 0xfc, 0x90, 0x33, 0xb9, 0x24, 0x4b};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0x48, 0x13, 0x17, 0x9e, 0x11, 0x27, 0xdc, 0xc2, 0x5e, 0x1,  0x7a, 0x1, 0x39, 0xb8,
                           0x5b, 0x31, 0x68, 0xbc, 0x8,  0x1e, 0x3d, 0x14, 0x88, 0x61, 0xe5, 0x9, 0x36, 0x3a};
  uint8_t bytesprops1[] = {0xa3, 0xd0, 0x4a, 0xd1, 0x26, 0x59, 0x62, 0x7c, 0x5f, 0x69, 0x43, 0x3e, 0xe7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13933}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15339}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 166}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8922, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10052
// [("\197\182\247\NAK\225g\156\RSB\176\131>\210\163+gM\b]f\247\229C\139\206\250\&7\200N(",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\244\237N\DC2\r\SIT\223\DC2\235\166\252\&3\164\242J2\185\ETB$\209#O\222",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\SUBP\205",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\SO=\180\165\216\210V\143\215h\230\182\212\148\199\230\SUBO\128\ENQX\163\200\244<\DC2g9P\180",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("3z\NUL6\210\254\222.\146\237\247\DEL*_\251",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("j\196\220\190\210\153\196\134\169\GS\DC2\208m6\155{i\204i=Ln9\201O_\NAK#-\177",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("v\NUL\235\199\138\128\&3\DEL\202Q",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS1}),("\239\216H\UStK\244\237\FSl#\234]\220Ll",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropUserProperty
// "\n!\209\175,1\NAK\164\145]\189" "",PropTopicAlias 29464,PropTopicAliasMaximum 9533,PropServerReference
// "O\218\NAK\253J\142D\197cU\128\219\235\SO\244_\171.v\231%\201",PropReceiveMaximum 3003,PropRetainAvailable
// 188,PropTopicAlias 24040,PropRequestProblemInformation 195,PropRequestResponseInformation 227,PropResponseInformation
// "\175\&4\144\136'\137\242\237B\189_M\154-\181\237B\232\155\207Z\145bc\211{\215",PropRequestResponseInformation
// 172,PropAuthenticationData
// "x*!\176\184[$\208\237\166J\192\184\151\134\218l\237\237\188\228B",PropRequestResponseInformation
// 8,PropSharedSubscriptionAvailable 95,PropAssignedClientIdentifier "\220\236\212<\250\230R\221V\165m0\254L"]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x82, 0xc3, 0x2,  0x27, 0x44, 0x89, 0x1,  0x26, 0x0,  0xb,  0xa,  0x21, 0xd1, 0xaf, 0x2c, 0x31, 0x15, 0xa4, 0x91,
      0x5d, 0xbd, 0x0,  0x0,  0x23, 0x73, 0x18, 0x22, 0x25, 0x3d, 0x1c, 0x0,  0x16, 0x4f, 0xda, 0x15, 0xfd, 0x4a, 0x8e,
      0x44, 0xc5, 0x63, 0x55, 0x80, 0xdb, 0xeb, 0xe,  0xf4, 0x5f, 0xab, 0x2e, 0x76, 0xe7, 0x25, 0xc9, 0x21, 0xb,  0xbb,
      0x25, 0xbc, 0x23, 0x5d, 0xe8, 0x17, 0xc3, 0x19, 0xe3, 0x1a, 0x0,  0x1b, 0xaf, 0x34, 0x90, 0x88, 0x27, 0x89, 0xf2,
      0xed, 0x42, 0xbd, 0x5f, 0x4d, 0x9a, 0x2d, 0xb5, 0xed, 0x42, 0xe8, 0x9b, 0xcf, 0x5a, 0x91, 0x62, 0x63, 0xd3, 0x7b,
      0xd7, 0x19, 0xac, 0x16, 0x0,  0x16, 0x78, 0x2a, 0x21, 0xb0, 0xb8, 0x5b, 0x24, 0xd0, 0xed, 0xa6, 0x4a, 0xc0, 0xb8,
      0x97, 0x86, 0xda, 0x6c, 0xed, 0xed, 0xbc, 0xe4, 0x42, 0x19, 0x8,  0x2a, 0x5f, 0x12, 0x0,  0xe,  0xdc, 0xec, 0xd4,
      0x3c, 0xfa, 0xe6, 0x52, 0xdd, 0x56, 0xa5, 0x6d, 0x30, 0xfe, 0x4c, 0x0,  0x1e, 0xc5, 0xb6, 0xf7, 0x15, 0xe1, 0x67,
      0x9c, 0x1e, 0x42, 0xb0, 0x83, 0x3e, 0xd2, 0xa3, 0x2b, 0x67, 0x4d, 0x8,  0x5d, 0x66, 0xf7, 0xe5, 0x43, 0x8b, 0xce,
      0xfa, 0x37, 0xc8, 0x4e, 0x28, 0x4,  0x0,  0x18, 0xf4, 0xed, 0x4e, 0x12, 0xd,  0xf,  0x54, 0xdf, 0x12, 0xeb, 0xa6,
      0xfc, 0x33, 0xa4, 0xf2, 0x4a, 0x32, 0xb9, 0x17, 0x24, 0xd1, 0x23, 0x4f, 0xde, 0x1,  0x0,  0x3,  0x1a, 0x50, 0xcd,
      0x6,  0x0,  0x1e, 0xe,  0x3d, 0xb4, 0xa5, 0xd8, 0xd2, 0x56, 0x8f, 0xd7, 0x68, 0xe6, 0xb6, 0xd4, 0x94, 0xc7, 0xe6,
      0x1a, 0x4f, 0x80, 0x5,  0x58, 0xa3, 0xc8, 0xf4, 0x3c, 0x12, 0x67, 0x39, 0x50, 0xb4, 0x2c, 0x0,  0xf,  0x33, 0x7a,
      0x0,  0x36, 0xd2, 0xfe, 0xde, 0x2e, 0x92, 0xed, 0xf7, 0x7f, 0x2a, 0x5f, 0xfb, 0x24, 0x0,  0x1e, 0x6a, 0xc4, 0xdc,
      0xbe, 0xd2, 0x99, 0xc4, 0x86, 0xa9, 0x1d, 0x12, 0xd0, 0x6d, 0x36, 0x9b, 0x7b, 0x69, 0xcc, 0x69, 0x3d, 0x4c, 0x6e,
      0x39, 0xc9, 0x4f, 0x5f, 0x15, 0x23, 0x2d, 0xb1, 0x2c, 0x0,  0xa,  0x76, 0x0,  0xeb, 0xc7, 0x8a, 0x80, 0x33, 0x7f,
      0xca, 0x51, 0xd,  0x0,  0x10, 0xef, 0xd8, 0x48, 0x1f, 0x74, 0x4b, 0xf4, 0xed, 0x1c, 0x6c, 0x23, 0xea, 0x5d, 0xdc,
      0x4c, 0x6c, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xc5, 0xb6, 0xf7, 0x15, 0xe1, 0x67, 0x9c, 0x1e, 0x42, 0xb0,
                                     0x83, 0x3e, 0xd2, 0xa3, 0x2b, 0x67, 0x4d, 0x8,  0x5d, 0x66,
                                     0xf7, 0xe5, 0x43, 0x8b, 0xce, 0xfa, 0x37, 0xc8, 0x4e, 0x28};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf4, 0xed, 0x4e, 0x12, 0xd,  0xf,  0x54, 0xdf, 0x12, 0xeb, 0xa6, 0xfc,
                                     0x33, 0xa4, 0xf2, 0x4a, 0x32, 0xb9, 0x17, 0x24, 0xd1, 0x23, 0x4f, 0xde};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0x50, 0xcd};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe,  0x3d, 0xb4, 0xa5, 0xd8, 0xd2, 0x56, 0x8f, 0xd7, 0x68,
                                     0xe6, 0xb6, 0xd4, 0x94, 0xc7, 0xe6, 0x1a, 0x4f, 0x80, 0x5,
                                     0x58, 0xa3, 0xc8, 0xf4, 0x3c, 0x12, 0x67, 0x39, 0x50, 0xb4};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x33, 0x7a, 0x0,  0x36, 0xd2, 0xfe, 0xde, 0x2e,
                                     0x92, 0xed, 0xf7, 0x7f, 0x2a, 0x5f, 0xfb};
  lwmqtt_string_t topic_filter_s4 = {15, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6a, 0xc4, 0xdc, 0xbe, 0xd2, 0x99, 0xc4, 0x86, 0xa9, 0x1d,
                                     0x12, 0xd0, 0x6d, 0x36, 0x9b, 0x7b, 0x69, 0xcc, 0x69, 0x3d,
                                     0x4c, 0x6e, 0x39, 0xc9, 0x4f, 0x5f, 0x15, 0x23, 0x2d, 0xb1};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x76, 0x0, 0xeb, 0xc7, 0x8a, 0x80, 0x33, 0x7f, 0xca, 0x51};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xef, 0xd8, 0x48, 0x1f, 0x74, 0x4b, 0xf4, 0xed,
                                     0x1c, 0x6c, 0x23, 0xea, 0x5d, 0xdc, 0x4c, 0x6c};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops0[] = {0xa, 0x21, 0xd1, 0xaf, 0x2c, 0x31, 0x15, 0xa4, 0x91, 0x5d, 0xbd};
  uint8_t bytesprops2[] = {0x4f, 0xda, 0x15, 0xfd, 0x4a, 0x8e, 0x44, 0xc5, 0x63, 0x55, 0x80,
                           0xdb, 0xeb, 0xe,  0xf4, 0x5f, 0xab, 0x2e, 0x76, 0xe7, 0x25, 0xc9};
  uint8_t bytesprops3[] = {0xaf, 0x34, 0x90, 0x88, 0x27, 0x89, 0xf2, 0xed, 0x42, 0xbd, 0x5f, 0x4d, 0x9a, 0x2d,
                           0xb5, 0xed, 0x42, 0xe8, 0x9b, 0xcf, 0x5a, 0x91, 0x62, 0x63, 0xd3, 0x7b, 0xd7};
  uint8_t bytesprops4[] = {0x78, 0x2a, 0x21, 0xb0, 0xb8, 0x5b, 0x24, 0xd0, 0xed, 0xa6, 0x4a,
                           0xc0, 0xb8, 0x97, 0x86, 0xda, 0x6c, 0xed, 0xed, 0xbc, 0xe4, 0x42};
  uint8_t bytesprops5[] = {0xdc, 0xec, 0xd4, 0x3c, 0xfa, 0xe6, 0x52, 0xdd, 0x56, 0xa5, 0x6d, 0x30, 0xfe, 0x4c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops0}, .v = {0, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29464}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9533}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3003}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24040}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10052, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12644 [("\185\166\&5\ACK\169\SOk",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropReceiveMaximum 7431,PropResponseTopic
// "\FS\253\196\NUL\224_XZl\140\163F\143,\193X",PropMaximumQoS 28,PropAuthenticationMethod "99",PropResponseInformation
// "\169\169\190\187|\197\DLE\198",PropResponseInformation "3_>"]
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x3e, 0x31, 0x64, 0x2e, 0x21, 0x1d, 0x7,  0x8,  0x0,  0x10, 0x1c, 0xfd, 0xc4, 0x0, 0xe0,
                   0x5f, 0x58, 0x5a, 0x6c, 0x8c, 0xa3, 0x46, 0x8f, 0x2c, 0xc1, 0x58, 0x24, 0x1c, 0x15, 0x0, 0x2,
                   0x39, 0x39, 0x1a, 0x0,  0x8,  0xa9, 0xa9, 0xbe, 0xbb, 0x7c, 0xc5, 0x10, 0xc6, 0x1a, 0x0, 0x3,
                   0x33, 0x5f, 0x3e, 0x0,  0x7,  0xb9, 0xa6, 0x35, 0x6,  0xa9, 0xe,  0x6b, 0x29, 0x0,  0x0, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xb9, 0xa6, 0x35, 0x6, 0xa9, 0xe, 0x6b};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0x1c, 0xfd, 0xc4, 0x0,  0xe0, 0x5f, 0x58, 0x5a,
                           0x6c, 0x8c, 0xa3, 0x46, 0x8f, 0x2c, 0xc1, 0x58};
  uint8_t bytesprops1[] = {0x39, 0x39};
  uint8_t bytesprops2[] = {0xa9, 0xa9, 0xbe, 0xbb, 0x7c, 0xc5, 0x10, 0xc6};
  uint8_t bytesprops3[] = {0x33, 0x5f, 0x3e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7431}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12644, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4944 [("",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("_k\r\DC2\f\SI\228\155\183\&2\NAK\NULR\a]\202\235\149",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("*>\177\186\&0]\214*\191\206q\"\231\248\230\193\194E\183\238!\241+\233\222,\198t\234\150",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("mP\215\162\&0:<\157\150\b\240m\ETX\235\218\SOH\255I\168\&5I\145\134^\EM",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1})] [PropServerKeepAlive
// 3031,PropTopicAlias 6809,PropWildcardSubscriptionAvailable 52,PropSubscriptionIdentifierAvailable
// 30,PropCorrelationData "n\167*\135\166\SOq\209\STX\EOT\221\NAK\160}'\179\ACK2M\179\US5\225\EMw",PropTopicAlias
// 10360,PropTopicAlias 21111,PropSubscriptionIdentifierAvailable 32,PropWillDelayInterval 537,PropTopicAlias
// 5672,PropContentType "\192\182\164\143X\175\218x",PropMessageExpiryInterval 6031,PropPayloadFormatIndicator
// 210,PropContentType "ih\217C\146U",PropReasonString
// "\223\129\163\176\232\&5+z\DC4\225\"\162*M",PropMessageExpiryInterval 28586,PropServerKeepAlive 20076,PropContentType
// ")\US\157\149\DC2\DC3\242\251L%\143\167U\220\212)c\216\SO"]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0xd9, 0x1,  0x13, 0x50, 0x80, 0x1,  0x13, 0xb,  0xd7, 0x23, 0x1a, 0x99, 0x28, 0x34, 0x29, 0x1e,
                   0x9,  0x0,  0x19, 0x6e, 0xa7, 0x2a, 0x87, 0xa6, 0xe,  0x71, 0xd1, 0x2,  0x4,  0xdd, 0x15, 0xa0, 0x7d,
                   0x27, 0xb3, 0x6,  0x32, 0x4d, 0xb3, 0x1f, 0x35, 0xe1, 0x19, 0x77, 0x23, 0x28, 0x78, 0x23, 0x52, 0x77,
                   0x29, 0x20, 0x18, 0x0,  0x0,  0x2,  0x19, 0x23, 0x16, 0x28, 0x3,  0x0,  0x8,  0xc0, 0xb6, 0xa4, 0x8f,
                   0x58, 0xaf, 0xda, 0x78, 0x2,  0x0,  0x0,  0x17, 0x8f, 0x1,  0xd2, 0x3,  0x0,  0x6,  0x69, 0x68, 0xd9,
                   0x43, 0x92, 0x55, 0x1f, 0x0,  0xe,  0xdf, 0x81, 0xa3, 0xb0, 0xe8, 0x35, 0x2b, 0x7a, 0x14, 0xe1, 0x22,
                   0xa2, 0x2a, 0x4d, 0x2,  0x0,  0x0,  0x6f, 0xaa, 0x13, 0x4e, 0x6c, 0x3,  0x0,  0x13, 0x29, 0x1f, 0x9d,
                   0x95, 0x12, 0x13, 0xf2, 0xfb, 0x4c, 0x25, 0x8f, 0xa7, 0x55, 0xdc, 0xd4, 0x29, 0x63, 0xd8, 0xe,  0x0,
                   0x0,  0x22, 0x0,  0x12, 0x5f, 0x6b, 0xd,  0x12, 0xc,  0xf,  0xe4, 0x9b, 0xb7, 0x32, 0x15, 0x0,  0x52,
                   0x7,  0x5d, 0xca, 0xeb, 0x95, 0x2e, 0x0,  0x1e, 0x2a, 0x3e, 0xb1, 0xba, 0x30, 0x5d, 0xd6, 0x2a, 0xbf,
                   0xce, 0x71, 0x22, 0xe7, 0xf8, 0xe6, 0xc1, 0xc2, 0x45, 0xb7, 0xee, 0x21, 0xf1, 0x2b, 0xe9, 0xde, 0x2c,
                   0xc6, 0x74, 0xea, 0x96, 0x5,  0x0,  0x19, 0x6d, 0x50, 0xd7, 0xa2, 0x30, 0x3a, 0x3c, 0x9d, 0x96, 0x8,
                   0xf0, 0x6d, 0x3,  0xeb, 0xda, 0x1,  0xff, 0x49, 0xa8, 0x35, 0x49, 0x91, 0x86, 0x5e, 0x19, 0x29};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5f, 0x6b, 0xd, 0x12, 0xc, 0xf,  0xe4, 0x9b, 0xb7,
                                     0x32, 0x15, 0x0, 0x52, 0x7, 0x5d, 0xca, 0xeb, 0x95};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2a, 0x3e, 0xb1, 0xba, 0x30, 0x5d, 0xd6, 0x2a, 0xbf, 0xce,
                                     0x71, 0x22, 0xe7, 0xf8, 0xe6, 0xc1, 0xc2, 0x45, 0xb7, 0xee,
                                     0x21, 0xf1, 0x2b, 0xe9, 0xde, 0x2c, 0xc6, 0x74, 0xea, 0x96};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6d, 0x50, 0xd7, 0xa2, 0x30, 0x3a, 0x3c, 0x9d, 0x96, 0x8,  0xf0, 0x6d, 0x3,
                                     0xeb, 0xda, 0x1,  0xff, 0x49, 0xa8, 0x35, 0x49, 0x91, 0x86, 0x5e, 0x19};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  uint8_t bytesprops0[] = {0x6e, 0xa7, 0x2a, 0x87, 0xa6, 0xe,  0x71, 0xd1, 0x2,  0x4,  0xdd, 0x15, 0xa0,
                           0x7d, 0x27, 0xb3, 0x6,  0x32, 0x4d, 0xb3, 0x1f, 0x35, 0xe1, 0x19, 0x77};
  uint8_t bytesprops1[] = {0xc0, 0xb6, 0xa4, 0x8f, 0x58, 0xaf, 0xda, 0x78};
  uint8_t bytesprops2[] = {0x69, 0x68, 0xd9, 0x43, 0x92, 0x55};
  uint8_t bytesprops3[] = {0xdf, 0x81, 0xa3, 0xb0, 0xe8, 0x35, 0x2b, 0x7a, 0x14, 0xe1, 0x22, 0xa2, 0x2a, 0x4d};
  uint8_t bytesprops4[] = {0x29, 0x1f, 0x9d, 0x95, 0x12, 0x13, 0xf2, 0xfb, 0x4c, 0x25,
                           0x8f, 0xa7, 0x55, 0xdc, 0xd4, 0x29, 0x63, 0xd8, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3031}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6809}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10360}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21111}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 537}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5672}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6031}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28586}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20076}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4944, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10380 [("x#\177~\235\205^\211e\221\198\US_r6\166_\SUB\220\237ILW\169\182V\129",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("fv\DC4W\179\ETB\232\n\203",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("\183Q\224\149\199H$\NAK\183\GS\164\130\219 $B\130J\247\250\205V\218",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("w\NAK{\230=\DC2\213",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// True, _subQoS = QoS2}),(".\240\210\165\146h\199\217\159k\147\SO.\155\246\245\233\STX\229P\168\196",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\226I\SYN\248",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS0}),("\150\230\233s",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("\133\135\180\EM",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("_D5",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("gN\213\255\202\196Gnm\180\&4\184Y\219kI\b\140\223\178\DC1u\248\215\132",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\209\EOT\FS\r\251\165\SO{I\218G\179\214\176\184\150\153\160\235\&0\226\aN",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropServerReference
// "\215F\133\CAN\255\253\132Oss\184>\176@s\156[\209\228\161h\251\235\GSkD",PropTopicAliasMaximum
// 20089,PropSubscriptionIdentifierAvailable 66,PropResponseInformation "#v5\132\197\129",PropResponseInformation
// "\228!3\192\&9\176,\162<\DELXm\203]+\246\205\164\156\180b9\208",PropRetainAvailable 206,PropContentType
// "\236`\219\207\149\219\223\210\FS-\FS\217:\SYN\164\157\&9@\220",PropContentType
// "c\196\&2<,JT\193W\221N\a",PropContentType "\236\248q\fZ3\153\&1\211\&7",PropSubscriptionIdentifierAvailable
// 6,PropTopicAliasMaximum 31885,PropCorrelationData
// "\SI\ETBX\132\212\230\140\163\183rr\SOHMy\212\141\250ZZ\172\241\189\154\&1f\"\141k",PropTopicAlias 2659]
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x82, 0xdc, 0x2,  0x28, 0x8c, 0xa0, 0x1,  0x1c, 0x0,  0x1a, 0xd7, 0x46, 0x85, 0x18, 0xff, 0xfd, 0x84, 0x4f, 0x73,
      0x73, 0xb8, 0x3e, 0xb0, 0x40, 0x73, 0x9c, 0x5b, 0xd1, 0xe4, 0xa1, 0x68, 0xfb, 0xeb, 0x1d, 0x6b, 0x44, 0x22, 0x4e,
      0x79, 0x29, 0x42, 0x1a, 0x0,  0x6,  0x23, 0x76, 0x35, 0x84, 0xc5, 0x81, 0x1a, 0x0,  0x17, 0xe4, 0x21, 0x33, 0xc0,
      0x39, 0xb0, 0x2c, 0xa2, 0x3c, 0x7f, 0x58, 0x6d, 0xcb, 0x5d, 0x2b, 0xf6, 0xcd, 0xa4, 0x9c, 0xb4, 0x62, 0x39, 0xd0,
      0x25, 0xce, 0x3,  0x0,  0x13, 0xec, 0x60, 0xdb, 0xcf, 0x95, 0xdb, 0xdf, 0xd2, 0x1c, 0x2d, 0x1c, 0xd9, 0x3a, 0x16,
      0xa4, 0x9d, 0x39, 0x40, 0xdc, 0x3,  0x0,  0xc,  0x63, 0xc4, 0x32, 0x3c, 0x2c, 0x4a, 0x54, 0xc1, 0x57, 0xdd, 0x4e,
      0x7,  0x3,  0x0,  0xa,  0xec, 0xf8, 0x71, 0xc,  0x5a, 0x33, 0x99, 0x31, 0xd3, 0x37, 0x29, 0x6,  0x22, 0x7c, 0x8d,
      0x9,  0x0,  0x1c, 0xf,  0x17, 0x58, 0x84, 0xd4, 0xe6, 0x8c, 0xa3, 0xb7, 0x72, 0x72, 0x1,  0x4d, 0x79, 0xd4, 0x8d,
      0xfa, 0x5a, 0x5a, 0xac, 0xf1, 0xbd, 0x9a, 0x31, 0x66, 0x22, 0x8d, 0x6b, 0x23, 0xa,  0x63, 0x0,  0x1b, 0x78, 0x23,
      0xb1, 0x7e, 0xeb, 0xcd, 0x5e, 0xd3, 0x65, 0xdd, 0xc6, 0x1f, 0x5f, 0x72, 0x36, 0xa6, 0x5f, 0x1a, 0xdc, 0xed, 0x49,
      0x4c, 0x57, 0xa9, 0xb6, 0x56, 0x81, 0x1a, 0x0,  0x9,  0x66, 0x76, 0x14, 0x57, 0xb3, 0x17, 0xe8, 0xa,  0xcb, 0x2a,
      0x0,  0x17, 0xb7, 0x51, 0xe0, 0x95, 0xc7, 0x48, 0x24, 0x15, 0xb7, 0x1d, 0xa4, 0x82, 0xdb, 0x20, 0x24, 0x42, 0x82,
      0x4a, 0xf7, 0xfa, 0xcd, 0x56, 0xda, 0x1d, 0x0,  0x7,  0x77, 0x15, 0x7b, 0xe6, 0x3d, 0x12, 0xd5, 0xe,  0x0,  0x16,
      0x2e, 0xf0, 0xd2, 0xa5, 0x92, 0x68, 0xc7, 0xd9, 0x9f, 0x6b, 0x93, 0xe,  0x2e, 0x9b, 0xf6, 0xf5, 0xe9, 0x2,  0xe5,
      0x50, 0xa8, 0xc4, 0xd,  0x0,  0x4,  0xe2, 0x49, 0x16, 0xf8, 0x24, 0x0,  0x4,  0x96, 0xe6, 0xe9, 0x73, 0x16, 0x0,
      0x4,  0x85, 0x87, 0xb4, 0x19, 0x6,  0x0,  0x3,  0x5f, 0x44, 0x35, 0x16, 0x0,  0x19, 0x67, 0x4e, 0xd5, 0xff, 0xca,
      0xc4, 0x47, 0x6e, 0x6d, 0xb4, 0x34, 0xb8, 0x59, 0xdb, 0x6b, 0x49, 0x8,  0x8c, 0xdf, 0xb2, 0x11, 0x75, 0xf8, 0xd7,
      0x84, 0x8,  0x0,  0x17, 0xd1, 0x4,  0x1c, 0xd,  0xfb, 0xa5, 0xe,  0x7b, 0x49, 0xda, 0x47, 0xb3, 0xd6, 0xb0, 0xb8,
      0x96, 0x99, 0xa0, 0xeb, 0x30, 0xe2, 0x7,  0x4e, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x78, 0x23, 0xb1, 0x7e, 0xeb, 0xcd, 0x5e, 0xd3, 0x65, 0xdd, 0xc6, 0x1f, 0x5f, 0x72,
                                     0x36, 0xa6, 0x5f, 0x1a, 0xdc, 0xed, 0x49, 0x4c, 0x57, 0xa9, 0xb6, 0x56, 0x81};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x66, 0x76, 0x14, 0x57, 0xb3, 0x17, 0xe8, 0xa, 0xcb};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb7, 0x51, 0xe0, 0x95, 0xc7, 0x48, 0x24, 0x15, 0xb7, 0x1d, 0xa4, 0x82,
                                     0xdb, 0x20, 0x24, 0x42, 0x82, 0x4a, 0xf7, 0xfa, 0xcd, 0x56, 0xda};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x77, 0x15, 0x7b, 0xe6, 0x3d, 0x12, 0xd5};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2e, 0xf0, 0xd2, 0xa5, 0x92, 0x68, 0xc7, 0xd9, 0x9f, 0x6b, 0x93,
                                     0xe,  0x2e, 0x9b, 0xf6, 0xf5, 0xe9, 0x2,  0xe5, 0x50, 0xa8, 0xc4};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe2, 0x49, 0x16, 0xf8};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x96, 0xe6, 0xe9, 0x73};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x85, 0x87, 0xb4, 0x19};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x5f, 0x44, 0x35};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x67, 0x4e, 0xd5, 0xff, 0xca, 0xc4, 0x47, 0x6e, 0x6d, 0xb4, 0x34, 0xb8, 0x59,
                                     0xdb, 0x6b, 0x49, 0x8,  0x8c, 0xdf, 0xb2, 0x11, 0x75, 0xf8, 0xd7, 0x84};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0xd1, 0x4,  0x1c, 0xd,  0xfb, 0xa5, 0xe,  0x7b, 0x49, 0xda, 0x47, 0xb3,
                                      0xd6, 0xb0, 0xb8, 0x96, 0x99, 0xa0, 0xeb, 0x30, 0xe2, 0x7,  0x4e};
  lwmqtt_string_t topic_filter_s10 = {23, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0xd7, 0x46, 0x85, 0x18, 0xff, 0xfd, 0x84, 0x4f, 0x73, 0x73, 0xb8, 0x3e, 0xb0,
                           0x40, 0x73, 0x9c, 0x5b, 0xd1, 0xe4, 0xa1, 0x68, 0xfb, 0xeb, 0x1d, 0x6b, 0x44};
  uint8_t bytesprops1[] = {0x23, 0x76, 0x35, 0x84, 0xc5, 0x81};
  uint8_t bytesprops2[] = {0xe4, 0x21, 0x33, 0xc0, 0x39, 0xb0, 0x2c, 0xa2, 0x3c, 0x7f, 0x58, 0x6d,
                           0xcb, 0x5d, 0x2b, 0xf6, 0xcd, 0xa4, 0x9c, 0xb4, 0x62, 0x39, 0xd0};
  uint8_t bytesprops3[] = {0xec, 0x60, 0xdb, 0xcf, 0x95, 0xdb, 0xdf, 0xd2, 0x1c, 0x2d,
                           0x1c, 0xd9, 0x3a, 0x16, 0xa4, 0x9d, 0x39, 0x40, 0xdc};
  uint8_t bytesprops4[] = {0x63, 0xc4, 0x32, 0x3c, 0x2c, 0x4a, 0x54, 0xc1, 0x57, 0xdd, 0x4e, 0x7};
  uint8_t bytesprops5[] = {0xec, 0xf8, 0x71, 0xc, 0x5a, 0x33, 0x99, 0x31, 0xd3, 0x37};
  uint8_t bytesprops6[] = {0xf,  0x17, 0x58, 0x84, 0xd4, 0xe6, 0x8c, 0xa3, 0xb7, 0x72, 0x72, 0x1,  0x4d, 0x79,
                           0xd4, 0x8d, 0xfa, 0x5a, 0x5a, 0xac, 0xf1, 0xbd, 0x9a, 0x31, 0x66, 0x22, 0x8d, 0x6b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20089}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31885}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2659}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10380, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeResponse 18259 [Right QoS0,Left SubErrNotAuthorized,Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0x5, 0x47, 0x53, 0x0, 0x87, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18259);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 23769 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Right QoS1,Left
// SubErrUnspecifiedError,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x8, 0x5c, 0xd9, 0xa1, 0x0, 0x1, 0x80, 0x1, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23769);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
}

// SubscribeResponse 32439 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Right QoS2] []
TEST(SubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x5, 0x7e, 0xb7, 0xa1, 0x1, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32439);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
}

// SubscribeResponse 4983 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Right
// QoS2,Right QoS2,Right QoS1] []
TEST(SubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0xb, 0x13, 0x77, 0x9e, 0x97, 0xa1, 0x2, 0x0, 0xa1, 0x2, 0x2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4983);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 13883 [Right QoS0,Left SubErrPacketIdentifierInUse,Left SubErrPacketIdentifierInUse,Right
// QoS0,Right QoS0,Left SubErrUnspecifiedError,Right QoS0] []
TEST(SubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x9, 0x36, 0x3b, 0x0, 0x91, 0x91, 0x0, 0x0, 0x80, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13883);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
}

// SubscribeResponse 7030 [Right QoS0] []
TEST(SubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0x3, 0x1b, 0x76, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7030);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
}

// SubscribeResponse 27738 [Right QoS0,Right QoS2] []
TEST(SubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x4, 0x6c, 0x5a, 0x0, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27738);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
}

// SubscribeResponse 4324 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Right QoS0,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSharedSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0x9, 0x10, 0xe4, 0x9e, 0x0, 0x0, 0x0, 0x9e, 0xa2, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4324);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 11281 [Left SubErrImplementationSpecificError,Right QoS1,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrQuotaExceeded] []
TEST(SubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0x6, 0x2c, 0x11, 0x83, 0x1, 0xa1, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11281);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 462 [Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0x4, 0x1, 0xce, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 462);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
}

// SubscribeResponse 28404 [Left SubErrTopicFilterInvalid,Left SubErrImplementationSpecificError,Left
// SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0x5, 0x6e, 0xf4, 0x8f, 0x83, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28404);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 12402 [Right QoS0] []
TEST(SubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x3, 0x30, 0x72, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12402);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
}

// SubscribeResponse 4531 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS1,Right QoS0,Right
// QoS1,Left SubErrPacketIdentifierInUse,Right QoS2,Left SubErrNotAuthorized,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS1] []
TEST(SubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0xc, 0x11, 0xb3, 0xa1, 0x2, 0x1, 0x0, 0x1, 0x91, 0x2, 0x87, 0xa1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4531);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
}

// SubscribeResponse 28870 [Right QoS2,Right QoS0,Left SubErrPacketIdentifierInUse,Right QoS1] []
TEST(SubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0x6, 0x70, 0xc6, 0x2, 0x0, 0x91, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28870);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
}

// SubscribeResponse 1085 [Right QoS0,Right QoS0,Left SubErrImplementationSpecificError,Left
// SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0x6, 0x4, 0x3d, 0x0, 0x0, 0x83, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1085);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 11089 [Right QoS1] []
TEST(SubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0x3, 0x2b, 0x51, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11089);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
}

// SubscribeResponse 4816 [Left SubErrQuotaExceeded,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right
// QoS0,Right QoS1,Right QoS0,Left SubErrNotAuthorized,Right QoS1,Left SubErrNotAuthorized,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0xd, 0x12, 0xd0, 0x97, 0xa2, 0x2, 0x0, 0x1, 0x0, 0x87, 0x1, 0x87, 0x9e, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4816);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 24891 [Left SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Right QoS1,Right QoS2,Left
// SubErrTopicFilterInvalid,Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0xb, 0x61, 0x3b, 0x80, 0x91, 0x9e, 0xa2, 0x1, 0x2, 0x8f, 0x1, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24891);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 22923 [Right QoS2,Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS2,Left SubErrTopicFilterInvalid,Right QoS1] []
TEST(SubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0xb, 0x59, 0x8b, 0x2, 0x1, 0xa1, 0x0, 0xa2, 0x2, 0x2, 0x8f, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22923);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 25337 [Right QoS2,Right QoS1,Left SubErrTopicFilterInvalid,Right QoS1,Right QoS2,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0x9, 0x62, 0xf9, 0x2, 0x1, 0x8f, 0x1, 0x2, 0x0, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25337);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 1262 [Left SubErrPacketIdentifierInUse,Right QoS0,Left SubErrPacketIdentifierInUse,Left
// SubErrImplementationSpecificError,Left SubErrImplementationSpecificError,Right QoS0,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrNotAuthorized,Right QoS2] []
TEST(SubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0xc, 0x4, 0xee, 0x91, 0x0, 0x91, 0x83, 0x83, 0x0, 0x0, 0x9e, 0x87, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1262);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 21462 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrQuotaExceeded,Right
// QoS1,Right QoS2,Right QoS0,Left SubErrSharedSubscriptionsNotSupported,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError,Right QoS2,Left SubErrNotAuthorized] []
TEST(SubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0xd, 0x53, 0xd6, 0x2, 0xa2, 0x97, 0x1, 0x2, 0x0, 0x9e, 0x8f, 0x83, 0x2, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21462);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 12076 [Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrImplementationSpecificError,Right
// QoS2,Right QoS0,Right QoS2] []
TEST(SubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x7, 0x2f, 0x2c, 0xa1, 0x83, 0x2, 0x0, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12076);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 3799 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrImplementationSpecificError,Left SubErrTopicFilterInvalid,Right QoS2,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS0] []
TEST(SubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0xa, 0xe, 0xd7, 0x2, 0xa2, 0x83, 0x8f, 0x2, 0xa2, 0x2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3799);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
}

// SubscribeResponse 15314 [Left SubErrUnspecifiedError,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError] []
TEST(SubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x5, 0x3b, 0xd2, 0x80, 0x8f, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15314);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 19515 [Left SubErrNotAuthorized,Right QoS1,Right QoS2,Left SubErrPacketIdentifierInUse,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS0,Left SubErrUnspecifiedError,Left
// SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0xb, 0x4c, 0x3b, 0x87, 0x1, 0x2, 0x91, 0x9e, 0x80, 0x0, 0x80, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19515);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
}

// SubscribeResponse 14835 [Right QoS2,Right QoS2,Right QoS1,Left SubErrUnspecifiedError,Left
// SubErrImplementationSpecificError,Left SubErrNotAuthorized,Right QoS2] []
TEST(SubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x9, 0x39, 0xf3, 0x2, 0x2, 0x1, 0x80, 0x83, 0x87, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14835);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
}

// SubscribeResponse 3036 [Right QoS0,Left SubErrNotAuthorized,Left SubErrImplementationSpecificError] []
TEST(SubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x5, 0xb, 0xdc, 0x0, 0x87, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3036);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 8613 [Right QoS2] []
TEST(SubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0x3, 0x21, 0xa5, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8613);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
}

// SubscribeResponse 14512 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrQuotaExceeded] []
TEST(SubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0x7, 0x38, 0xb0, 0x9e, 0x91, 0x1, 0xa2, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14512);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 18259 [Right QoS0,Left SubErrNotAuthorized,Left SubErrWildcardSubscriptionsNotSupported]
// [PropContentType "\190r\158\201\DC4U\EM\193\&6",PropMessageExpiryInterval 16837,PropPayloadFormatIndicator
// 207,PropReasonString "HB\185\&6\128\NUL\165[\130g(\n\186q7SV&i4\DLE\224ZYn\134\&5",PropRequestProblemInformation
// 131,PropSubscriptionIdentifier 14,PropRequestProblemInformation 176,PropWildcardSubscriptionAvailable
// 245,PropContentType "\149\146%\140h\248\156@Ts\233\t",PropAuthenticationMethod
// "<\207\202D\134\132\148v\215\164\nw\139U\222!\ESC\255HN\235\241\197[\237c",PropSubscriptionIdentifierAvailable
// 117,PropSharedSubscriptionAvailable 155,PropSessionExpiryInterval 24344,PropSharedSubscriptionAvailable
// 210,PropServerReference
// "\201\SO\215/\225C\DC4\SO\SI1\226h\196\142\201:\137\241<P\249\249\131\177",PropWillDelayInterval
// 862,PropServerReference "\163\v\RS\tiS\182\138L\132\236e\168!i\177\202\131_3\243k#\216@",PropServerReference
// "\148\EM\CAN\171\150{.\209\197\155N\238\228$*\164",PropPayloadFormatIndicator 67,PropWillDelayInterval
// 23915,PropSubscriptionIdentifierAvailable 19,PropReasonString
// "\222\&5\187\143\234m\228\136\ENQ\250\132Ih\164\180\139'\177\139\204s\b\167\&8g\CAN\185",PropContentType
// "\145\183\134\238",PropPayloadFormatIndicator 65,PropReceiveMaximum 21654]
TEST(SubACK5QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0xf9, 0x1,  0x47, 0x53, 0xf2, 0x1,  0x3,  0x0,  0x9,  0xbe, 0x72, 0x9e, 0xc9, 0x14, 0x55, 0x19,
                   0xc1, 0x36, 0x2,  0x0,  0x0,  0x41, 0xc5, 0x1,  0xcf, 0x1f, 0x0,  0x1b, 0x48, 0x42, 0xb9, 0x36, 0x80,
                   0x0,  0xa5, 0x5b, 0x82, 0x67, 0x28, 0xa,  0xba, 0x71, 0x37, 0x53, 0x56, 0x26, 0x69, 0x34, 0x10, 0xe0,
                   0x5a, 0x59, 0x6e, 0x86, 0x35, 0x17, 0x83, 0xb,  0xe,  0x17, 0xb0, 0x28, 0xf5, 0x3,  0x0,  0xc,  0x95,
                   0x92, 0x25, 0x8c, 0x68, 0xf8, 0x9c, 0x40, 0x54, 0x73, 0xe9, 0x9,  0x15, 0x0,  0x1a, 0x3c, 0xcf, 0xca,
                   0x44, 0x86, 0x84, 0x94, 0x76, 0xd7, 0xa4, 0xa,  0x77, 0x8b, 0x55, 0xde, 0x21, 0x1b, 0xff, 0x48, 0x4e,
                   0xeb, 0xf1, 0xc5, 0x5b, 0xed, 0x63, 0x29, 0x75, 0x2a, 0x9b, 0x11, 0x0,  0x0,  0x5f, 0x18, 0x2a, 0xd2,
                   0x1c, 0x0,  0x18, 0xc9, 0xe,  0xd7, 0x2f, 0xe1, 0x43, 0x14, 0xe,  0xf,  0x31, 0xe2, 0x68, 0xc4, 0x8e,
                   0xc9, 0x3a, 0x89, 0xf1, 0x3c, 0x50, 0xf9, 0xf9, 0x83, 0xb1, 0x18, 0x0,  0x0,  0x3,  0x5e, 0x1c, 0x0,
                   0x19, 0xa3, 0xb,  0x1e, 0x9,  0x69, 0x53, 0xb6, 0x8a, 0x4c, 0x84, 0xec, 0x65, 0xa8, 0x21, 0x69, 0xb1,
                   0xca, 0x83, 0x5f, 0x33, 0xf3, 0x6b, 0x23, 0xd8, 0x40, 0x1c, 0x0,  0x10, 0x94, 0x19, 0x18, 0xab, 0x96,
                   0x7b, 0x2e, 0xd1, 0xc5, 0x9b, 0x4e, 0xee, 0xe4, 0x24, 0x2a, 0xa4, 0x1,  0x43, 0x18, 0x0,  0x0,  0x5d,
                   0x6b, 0x29, 0x13, 0x1f, 0x0,  0x1b, 0xde, 0x35, 0xbb, 0x8f, 0xea, 0x6d, 0xe4, 0x88, 0x5,  0xfa, 0x84,
                   0x49, 0x68, 0xa4, 0xb4, 0x8b, 0x27, 0xb1, 0x8b, 0xcc, 0x73, 0x8,  0xa7, 0x38, 0x67, 0x18, 0xb9, 0x3,
                   0x0,  0x4,  0x91, 0xb7, 0x86, 0xee, 0x1,  0x41, 0x21, 0x54, 0x96, 0x0,  0x87, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18259);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x87);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
}

// SubscribeResponse 23769 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Right QoS1,Left
// SubErrUnspecifiedError,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported] [PropReceiveMaximum
// 18275,PropWillDelayInterval 20990,PropMessageExpiryInterval 29874,PropReasonString
// "\189n\231\162\244",PropRetainAvailable 56,PropSharedSubscriptionAvailable 115,PropServerReference
// "\169\205\173?TAE@\255\166\216\206O",PropMessageExpiryInterval 5892,PropReceiveMaximum 15408,PropAuthenticationMethod
// "\187%\245\191B\196\189F>\162\&7^,\193\201"]
TEST(SubACK5QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x4c, 0x5c, 0xd9, 0x43, 0x21, 0x47, 0x63, 0x18, 0x0,  0x0,  0x51, 0xfe, 0x2,  0x0,  0x0,
                   0x74, 0xb2, 0x1f, 0x0,  0x5,  0xbd, 0x6e, 0xe7, 0xa2, 0xf4, 0x25, 0x38, 0x2a, 0x73, 0x1c, 0x0,
                   0xd,  0xa9, 0xcd, 0xad, 0x3f, 0x54, 0x41, 0x45, 0x40, 0xff, 0xa6, 0xd8, 0xce, 0x4f, 0x2,  0x0,
                   0x0,  0x17, 0x4,  0x21, 0x3c, 0x30, 0x15, 0x0,  0xf,  0xbb, 0x25, 0xf5, 0xbf, 0x42, 0xc4, 0xbd,
                   0x46, 0x3e, 0xa2, 0x37, 0x5e, 0x2c, 0xc1, 0xc9, 0xa1, 0x0,  0x1,  0x80, 0x1,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23769);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0xA2);
}

// SubscribeResponse 32439 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Right QoS2]
// [PropPayloadFormatIndicator 200,PropPayloadFormatIndicator 41,PropAuthenticationMethod
// "[D\143\DC2P\189\&2^",PropMessageExpiryInterval 11314,PropTopicAliasMaximum 29329,PropAssignedClientIdentifier
// "\GS\DEL\140\&8\140u\232\188\DC3u-1\ESC\200\181\NAK\a\246D\188%\242\191\179\189\175\209\210",PropSubscriptionIdentifier
// 13,PropServerReference "~l",PropAssignedClientIdentifier "\215\152\222\249Ru\193",PropRequestProblemInformation
// 22,PropTopicAlias 26497,PropMaximumQoS 118,PropMaximumPacketSize 16077,PropWillDelayInterval
// 31249,PropWillDelayInterval 29824,PropAuthenticationData "\237\236\224\DELvE\147!",PropContentType
// "^oe\164\131\243\246\164\162\203\218\229g\193\222h\f",PropServerReference "\169\141\240\189\167",PropServerReference
// "]%aq}\134a\176\192F\252\GS\CAN\236\176u\254\196",PropTopicAlias 10763,PropRequestResponseInformation 121]
TEST(SubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0xa5, 0x1,  0x7e, 0xb7, 0x9e, 0x1,  0x1,  0xc8, 0x1,  0x29, 0x15, 0x0,  0x8,  0x5b, 0x44, 0x8f,
                   0x12, 0x50, 0xbd, 0x32, 0x5e, 0x2,  0x0,  0x0,  0x2c, 0x32, 0x22, 0x72, 0x91, 0x12, 0x0,  0x1c, 0x1d,
                   0x7f, 0x8c, 0x38, 0x8c, 0x75, 0xe8, 0xbc, 0x13, 0x75, 0x2d, 0x31, 0x1b, 0xc8, 0xb5, 0x15, 0x7,  0xf6,
                   0x44, 0xbc, 0x25, 0xf2, 0xbf, 0xb3, 0xbd, 0xaf, 0xd1, 0xd2, 0xb,  0xd,  0x1c, 0x0,  0x2,  0x7e, 0x6c,
                   0x12, 0x0,  0x7,  0xd7, 0x98, 0xde, 0xf9, 0x52, 0x75, 0xc1, 0x17, 0x16, 0x23, 0x67, 0x81, 0x24, 0x76,
                   0x27, 0x0,  0x0,  0x3e, 0xcd, 0x18, 0x0,  0x0,  0x7a, 0x11, 0x18, 0x0,  0x0,  0x74, 0x80, 0x16, 0x0,
                   0x8,  0xed, 0xec, 0xe0, 0x7f, 0x76, 0x45, 0x93, 0x21, 0x3,  0x0,  0x11, 0x5e, 0x6f, 0x65, 0xa4, 0x83,
                   0xf3, 0xf6, 0xa4, 0xa2, 0xcb, 0xda, 0xe5, 0x67, 0xc1, 0xde, 0x68, 0xc,  0x1c, 0x0,  0x5,  0xa9, 0x8d,
                   0xf0, 0xbd, 0xa7, 0x1c, 0x0,  0x12, 0x5d, 0x25, 0x61, 0x71, 0x7d, 0x86, 0x61, 0xb0, 0xc0, 0x46, 0xfc,
                   0x1d, 0x18, 0xec, 0xb0, 0x75, 0xfe, 0xc4, 0x23, 0x2a, 0xb,  0x19, 0x79, 0xa1, 0x1,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32439);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
}

// SubscribeResponse 4983 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrQuotaExceeded,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Right
// QoS2,Right QoS2,Right QoS1] [PropWillDelayInterval 17871,PropMessageExpiryInterval 4396,PropContentType
// "\197#\214s",PropSubscriptionIdentifierAvailable 4,PropTopicAliasMaximum 16000,PropReceiveMaximum
// 756,PropAssignedClientIdentifier "\n\177\b>\243C\230\&2\209\186a{"]
TEST(SubACK5QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0x34, 0x13, 0x77, 0x28, 0x18, 0x0,  0x0,  0x45, 0xcf, 0x2,  0x0,  0x0,  0x11,
                   0x2c, 0x3,  0x0,  0x4,  0xc5, 0x23, 0xd6, 0x73, 0x29, 0x4,  0x22, 0x3e, 0x80, 0x21,
                   0x2,  0xf4, 0x12, 0x0,  0xc,  0xa,  0xb1, 0x8,  0x3e, 0xf3, 0x43, 0xe6, 0x32, 0xd1,
                   0xba, 0x61, 0x7b, 0x9e, 0x97, 0xa1, 0x2,  0x0,  0xa1, 0x2,  0x2,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4983);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], 0x97);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0xA1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 13883 [Right QoS0,Left SubErrPacketIdentifierInUse,Left SubErrPacketIdentifierInUse,Right
// QoS0,Right QoS0,Left SubErrUnspecifiedError,Right QoS0] [PropRetainAvailable 105,PropRequestResponseInformation
// 236,PropSessionExpiryInterval 18710,PropRequestResponseInformation 120,PropSharedSubscriptionAvailable
// 214,PropAssignedClientIdentifier "\250\197\157\128",PropSharedSubscriptionAvailable 51,PropResponseInformation
// "\184\239s\133\&1\247\157\144n\239D\234G",PropContentType
// "\172\246\216\166\219B\239B\146",PropRequestProblemInformation 168,PropAssignedClientIdentifier
// "K1)\174\237\&7\SUB\129\&2\158\172\162\217\194b\210k\158b\a`\201s",PropPayloadFormatIndicator 22,PropServerReference
// "k;\135\212\CAN,\241\236\215K)u\231\236\226\135\215\130`\175\231\195\n",PropTopicAlias 23018,PropReceiveMaximum
// 8826,PropSubscriptionIdentifierAvailable 53,PropTopicAliasMaximum 18965,PropContentType
// "\253\SIw\\-\bU\230(\vX\SYNC\245\234",PropWildcardSubscriptionAvailable 204,PropMessageExpiryInterval
// 8078,PropReasonString
// "0C\NUL#\203:\NUL1d\168\142Hk\159\181\NAK\150\201\SUB\195_06f\165dr\220\235",PropMaximumPacketSize
// 13502,PropSubscriptionIdentifier 27,PropMaximumQoS 21,PropUserProperty "\136e\202\216\155%\140A\142"
// "\174_\v\190|8\162\196",PropSubscriptionIdentifierAvailable 212,PropWillDelayInterval 26280,PropMessageExpiryInterval
// 5506]
TEST(SubACK5QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0xe4, 0x1,  0x36, 0x3b, 0xd9, 0x1,  0x25, 0x69, 0x19, 0xec, 0x11, 0x0,  0x0,  0x49, 0x16, 0x19,
                   0x78, 0x2a, 0xd6, 0x12, 0x0,  0x4,  0xfa, 0xc5, 0x9d, 0x80, 0x2a, 0x33, 0x1a, 0x0,  0xd,  0xb8, 0xef,
                   0x73, 0x85, 0x31, 0xf7, 0x9d, 0x90, 0x6e, 0xef, 0x44, 0xea, 0x47, 0x3,  0x0,  0x9,  0xac, 0xf6, 0xd8,
                   0xa6, 0xdb, 0x42, 0xef, 0x42, 0x92, 0x17, 0xa8, 0x12, 0x0,  0x17, 0x4b, 0x31, 0x29, 0xae, 0xed, 0x37,
                   0x1a, 0x81, 0x32, 0x9e, 0xac, 0xa2, 0xd9, 0xc2, 0x62, 0xd2, 0x6b, 0x9e, 0x62, 0x7,  0x60, 0xc9, 0x73,
                   0x1,  0x16, 0x1c, 0x0,  0x17, 0x6b, 0x3b, 0x87, 0xd4, 0x18, 0x2c, 0xf1, 0xec, 0xd7, 0x4b, 0x29, 0x75,
                   0xe7, 0xec, 0xe2, 0x87, 0xd7, 0x82, 0x60, 0xaf, 0xe7, 0xc3, 0xa,  0x23, 0x59, 0xea, 0x21, 0x22, 0x7a,
                   0x29, 0x35, 0x22, 0x4a, 0x15, 0x3,  0x0,  0xf,  0xfd, 0xf,  0x77, 0x5c, 0x2d, 0x8,  0x55, 0xe6, 0x28,
                   0xb,  0x58, 0x16, 0x43, 0xf5, 0xea, 0x28, 0xcc, 0x2,  0x0,  0x0,  0x1f, 0x8e, 0x1f, 0x0,  0x1d, 0x30,
                   0x43, 0x0,  0x23, 0xcb, 0x3a, 0x0,  0x31, 0x64, 0xa8, 0x8e, 0x48, 0x6b, 0x9f, 0xb5, 0x15, 0x96, 0xc9,
                   0x1a, 0xc3, 0x5f, 0x30, 0x36, 0x66, 0xa5, 0x64, 0x72, 0xdc, 0xeb, 0x27, 0x0,  0x0,  0x34, 0xbe, 0xb,
                   0x1b, 0x24, 0x15, 0x26, 0x0,  0x9,  0x88, 0x65, 0xca, 0xd8, 0x9b, 0x25, 0x8c, 0x41, 0x8e, 0x0,  0x8,
                   0xae, 0x5f, 0xb,  0xbe, 0x7c, 0x38, 0xa2, 0xc4, 0x29, 0xd4, 0x18, 0x0,  0x0,  0x66, 0xa8, 0x2,  0x0,
                   0x0,  0x15, 0x82, 0x0,  0x91, 0x91, 0x0,  0x0,  0x80, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13883);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], 0x91);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
}

// SubscribeResponse 7030 [Right QoS0] [PropServerKeepAlive 16046,PropRetainAvailable 15,PropAssignedClientIdentifier
// "\214;\212s_I4",PropSubscriptionIdentifier 0,PropMessageExpiryInterval 25675,PropMaximumQoS
// 127,PropMessageExpiryInterval 15938,PropResponseInformation
// "O\195\200n*S\167A\183\149\191\SUBE\fj,n\156\246\250\239,\207",PropSessionExpiryInterval
// 17485,PropWildcardSubscriptionAvailable 94,PropMaximumQoS 248,PropServerReference
// "7}\190\ETBZ\183\150|\"O\155\ETB\171 \SOHF\198\231\159\SYN5\170\137\159!\179Q",PropUserProperty
// "\140?$\156\154a\206\210\163\215m" "\NUL\193\211nS\168\241\190",PropResponseInformation
// "B\216}4\155^f\a\160q6F\249>\224fL&\254\210j\204\167",PropServerKeepAlive 17141,PropSubscriptionIdentifierAvailable
// 84,PropResponseInformation
// "\172x\249\206\229\228\173\151BrI\247{\183\NUL\202nj0\179\156R\ETX:\149\235\192",PropMessageExpiryInterval
// 32669,PropReasonString "b\\\151\n\197\178\179\195f\253W\a\152\a\156}\t[\187\215\f\227\194*",PropAuthenticationData
// "0^\145\&3\240\DELM\148 R@F\247lw-\192\196\141w\ra\251c",PropMessageExpiryInterval 4202,PropAssignedClientIdentifier
// "f\185\234_L\239\&6N",PropAuthenticationData "2\203j`"]
TEST(SubACK5QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0x8a, 0x2,  0x1b, 0x76, 0x85, 0x2,  0x13, 0x3e, 0xae, 0x25, 0xf,  0x12, 0x0,  0x7,  0xd6, 0x3b,
                   0xd4, 0x73, 0x5f, 0x49, 0x34, 0xb,  0x0,  0x2,  0x0,  0x0,  0x64, 0x4b, 0x24, 0x7f, 0x2,  0x0,  0x0,
                   0x3e, 0x42, 0x1a, 0x0,  0x17, 0x4f, 0xc3, 0xc8, 0x6e, 0x2a, 0x53, 0xa7, 0x41, 0xb7, 0x95, 0xbf, 0x1a,
                   0x45, 0xc,  0x6a, 0x2c, 0x6e, 0x9c, 0xf6, 0xfa, 0xef, 0x2c, 0xcf, 0x11, 0x0,  0x0,  0x44, 0x4d, 0x28,
                   0x5e, 0x24, 0xf8, 0x1c, 0x0,  0x1b, 0x37, 0x7d, 0xbe, 0x17, 0x5a, 0xb7, 0x96, 0x7c, 0x22, 0x4f, 0x9b,
                   0x17, 0xab, 0x20, 0x1,  0x46, 0xc6, 0xe7, 0x9f, 0x16, 0x35, 0xaa, 0x89, 0x9f, 0x21, 0xb3, 0x51, 0x26,
                   0x0,  0xb,  0x8c, 0x3f, 0x24, 0x9c, 0x9a, 0x61, 0xce, 0xd2, 0xa3, 0xd7, 0x6d, 0x0,  0x8,  0x0,  0xc1,
                   0xd3, 0x6e, 0x53, 0xa8, 0xf1, 0xbe, 0x1a, 0x0,  0x17, 0x42, 0xd8, 0x7d, 0x34, 0x9b, 0x5e, 0x66, 0x7,
                   0xa0, 0x71, 0x36, 0x46, 0xf9, 0x3e, 0xe0, 0x66, 0x4c, 0x26, 0xfe, 0xd2, 0x6a, 0xcc, 0xa7, 0x13, 0x42,
                   0xf5, 0x29, 0x54, 0x1a, 0x0,  0x1b, 0xac, 0x78, 0xf9, 0xce, 0xe5, 0xe4, 0xad, 0x97, 0x42, 0x72, 0x49,
                   0xf7, 0x7b, 0xb7, 0x0,  0xca, 0x6e, 0x6a, 0x30, 0xb3, 0x9c, 0x52, 0x3,  0x3a, 0x95, 0xeb, 0xc0, 0x2,
                   0x0,  0x0,  0x7f, 0x9d, 0x1f, 0x0,  0x18, 0x62, 0x5c, 0x97, 0xa,  0xc5, 0xb2, 0xb3, 0xc3, 0x66, 0xfd,
                   0x57, 0x7,  0x98, 0x7,  0x9c, 0x7d, 0x9,  0x5b, 0xbb, 0xd7, 0xc,  0xe3, 0xc2, 0x2a, 0x16, 0x0,  0x18,
                   0x30, 0x5e, 0x91, 0x33, 0xf0, 0x7f, 0x4d, 0x94, 0x20, 0x52, 0x40, 0x46, 0xf7, 0x6c, 0x77, 0x2d, 0xc0,
                   0xc4, 0x8d, 0x77, 0xd,  0x61, 0xfb, 0x63, 0x2,  0x0,  0x0,  0x10, 0x6a, 0x12, 0x0,  0x8,  0x66, 0xb9,
                   0xea, 0x5f, 0x4c, 0xef, 0x36, 0x4e, 0x16, 0x0,  0x4,  0x32, 0xcb, 0x6a, 0x60, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7030);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
}

// SubscribeResponse 27738 [Right QoS0,Right QoS2] [PropWillDelayInterval 18364,PropRetainAvailable
// 74,PropMessageExpiryInterval 26631,PropRequestResponseInformation 103,PropUserProperty
// "\175\DC3\NULTO\218\&2\212L\RS\233\STX\157\161\&6\243\CAN\165\213\DLE"
// "\217D\178\168\231\ENQ\SUBl<\RSL~\213w\148$\146\129\197\173\DC2\189!\223\246\203\234\tX",PropRequestResponseInformation
// 33,PropTopicAliasMaximum 10285]
TEST(SubACK5QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x4e, 0x6c, 0x5a, 0x49, 0x18, 0x0,  0x0,  0x47, 0xbc, 0x25, 0x4a, 0x2,  0x0,  0x0,  0x68,
                   0x7,  0x19, 0x67, 0x26, 0x0,  0x14, 0xaf, 0x13, 0x0,  0x54, 0x4f, 0xda, 0x32, 0xd4, 0x4c, 0x1e,
                   0xe9, 0x2,  0x9d, 0xa1, 0x36, 0xf3, 0x18, 0xa5, 0xd5, 0x10, 0x0,  0x1d, 0xd9, 0x44, 0xb2, 0xa8,
                   0xe7, 0x5,  0x1a, 0x6c, 0x3c, 0x1e, 0x4c, 0x7e, 0xd5, 0x77, 0x94, 0x24, 0x92, 0x81, 0xc5, 0xad,
                   0x12, 0xbd, 0x21, 0xdf, 0xf6, 0xcb, 0xea, 0x9,  0x58, 0x19, 0x21, 0x22, 0x28, 0x2d, 0x0,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27738);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
}

// SubscribeResponse 4324 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Right QoS0,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSharedSubscriptionsNotSupported] [PropMaximumQoS 32,PropReasonString
// "QqM\SOH\r\234H\200\tfW\128\&8\129\130",PropServerReference "\197F\ACKV",PropSharedSubscriptionAvailable
// 151,PropPayloadFormatIndicator 22,PropSessionExpiryInterval 25815,PropAuthenticationMethod
// "\SOH}\228~\168\230\&5?\156gM\211\134s",PropRequestResponseInformation 99,PropTopicAlias 10610,PropTopicAlias
// 17610,PropSharedSubscriptionAvailable 184,PropRetainAvailable 242,PropTopicAliasMaximum
// 25664,PropRequestProblemInformation 200,PropServerReference "\201\162\f\NAK\166\216\145",PropSubscriptionIdentifier
// 29,PropSubscriptionIdentifierAvailable 8,PropRequestResponseInformation 140,PropSessionExpiryInterval
// 13061,PropReceiveMaximum 25226,PropReasonString "\159u\FS\227~G\168mi\178y\178",PropAuthenticationData
// "$$\197V!\234\135\\C&\a",PropRetainAvailable 221,PropContentType
// "i\154\199?\188\EOT\152\188\148\154",PropRetainAvailable 148,PropAuthenticationData
// "\251\225\DC3\186\207\v\STX\"\b\226\184\131\226-\202\173\245\SO\140"]
TEST(SubACK5QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0xad, 0x1,  0x10, 0xe4, 0xa2, 0x1,  0x24, 0x20, 0x1f, 0x0,  0xf,  0x51, 0x71, 0x4d, 0x1,
                   0xd,  0xea, 0x48, 0xc8, 0x9,  0x66, 0x57, 0x80, 0x38, 0x81, 0x82, 0x1c, 0x0,  0x4,  0xc5, 0x46,
                   0x6,  0x56, 0x2a, 0x97, 0x1,  0x16, 0x11, 0x0,  0x0,  0x64, 0xd7, 0x15, 0x0,  0xe,  0x1,  0x7d,
                   0xe4, 0x7e, 0xa8, 0xe6, 0x35, 0x3f, 0x9c, 0x67, 0x4d, 0xd3, 0x86, 0x73, 0x19, 0x63, 0x23, 0x29,
                   0x72, 0x23, 0x44, 0xca, 0x2a, 0xb8, 0x25, 0xf2, 0x22, 0x64, 0x40, 0x17, 0xc8, 0x1c, 0x0,  0x7,
                   0xc9, 0xa2, 0xc,  0x15, 0xa6, 0xd8, 0x91, 0xb,  0x1d, 0x29, 0x8,  0x19, 0x8c, 0x11, 0x0,  0x0,
                   0x33, 0x5,  0x21, 0x62, 0x8a, 0x1f, 0x0,  0xc,  0x9f, 0x75, 0x1c, 0xe3, 0x7e, 0x47, 0xa8, 0x6d,
                   0x69, 0xb2, 0x79, 0xb2, 0x16, 0x0,  0xb,  0x24, 0x24, 0xc5, 0x56, 0x21, 0xea, 0x87, 0x5c, 0x43,
                   0x26, 0x7,  0x25, 0xdd, 0x3,  0x0,  0xa,  0x69, 0x9a, 0xc7, 0x3f, 0xbc, 0x4,  0x98, 0xbc, 0x94,
                   0x9a, 0x25, 0x94, 0x16, 0x0,  0x13, 0xfb, 0xe1, 0x13, 0xba, 0xcf, 0xb,  0x2,  0x22, 0x8,  0xe2,
                   0xb8, 0x83, 0xe2, 0x2d, 0xca, 0xad, 0xf5, 0xe,  0x8c, 0x9e, 0x0,  0x0,  0x0,  0x9e, 0xa2, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4324);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x9E);
  EXPECT_EQ(granted_qos_levels[5], 0xA2);
  EXPECT_EQ(granted_qos_levels[6], 0x9E);
}

// SubscribeResponse 11281 [Left SubErrImplementationSpecificError,Right QoS1,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrQuotaExceeded] [PropMaximumPacketSize
// 8437,PropMessageExpiryInterval 21940]
TEST(SubACK5QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0x11, 0x2c, 0x11, 0xa,  0x27, 0x0, 0x0,  0x20, 0xf5,
                   0x2,  0x0,  0x0,  0x55, 0xb4, 0x83, 0x1, 0xa1, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11281);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
  EXPECT_EQ(granted_qos_levels[3], 0x97);
}

// SubscribeResponse 462 [Right QoS2,Right QoS2] []
TEST(SubACK5QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0x5, 0x1, 0xce, 0x0, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[2];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 462);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
}

// SubscribeResponse 28404 [Left SubErrTopicFilterInvalid,Left SubErrImplementationSpecificError,Left
// SubErrSubscriptionIdentifiersNotSupported] [PropResponseTopic "\193
// \204B\253`\179\135\ETBx\190G.K|lB%;8\191A9\129T",PropRequestResponseInformation
// 146,PropSubscriptionIdentifierAvailable 186,PropUserProperty "\173\NULQ\SYNQ\151\214\&8g\232c\239"
// ")\129\137\NUL/0\DEL\142\186\225\FS\247u\228\176\162d\170\CAN\165&",PropServerReference
// "\DC2\189\255\136\224\158\172\227s\139\206\170\155'\198\172\164\179\171\195\156\187\167rj",PropTopicAliasMaximum
// 18134,PropWildcardSubscriptionAvailable 34,PropReceiveMaximum 31787,PropTopicAliasMaximum 31526,PropReasonString
// "",PropWillDelayInterval 12886,PropCorrelationData
// "\185\224)\139y\198\a\134\NUL?\136\DC1\229\232\EOT%\245%\193\130\176\195\193\150\n>\133<\219",PropRequestResponseInformation
// 12,PropContentType "\221\129\249u\SO\240\141%\DC4<P\162",PropRetainAvailable 168,PropSessionExpiryInterval 25086]
TEST(SubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0xb4, 0x1,  0x6e, 0xf4, 0xad, 0x1,  0x8,  0x0,  0x19, 0xc1, 0x20, 0xcc, 0x42, 0xfd, 0x60, 0xb3,
                   0x87, 0x17, 0x78, 0xbe, 0x47, 0x2e, 0x4b, 0x7c, 0x6c, 0x42, 0x25, 0x3b, 0x38, 0xbf, 0x41, 0x39, 0x81,
                   0x54, 0x19, 0x92, 0x29, 0xba, 0x26, 0x0,  0xc,  0xad, 0x0,  0x51, 0x16, 0x51, 0x97, 0xd6, 0x38, 0x67,
                   0xe8, 0x63, 0xef, 0x0,  0x15, 0x29, 0x81, 0x89, 0x0,  0x2f, 0x30, 0x7f, 0x8e, 0xba, 0xe1, 0x1c, 0xf7,
                   0x75, 0xe4, 0xb0, 0xa2, 0x64, 0xaa, 0x18, 0xa5, 0x26, 0x1c, 0x0,  0x19, 0x12, 0xbd, 0xff, 0x88, 0xe0,
                   0x9e, 0xac, 0xe3, 0x73, 0x8b, 0xce, 0xaa, 0x9b, 0x27, 0xc6, 0xac, 0xa4, 0xb3, 0xab, 0xc3, 0x9c, 0xbb,
                   0xa7, 0x72, 0x6a, 0x22, 0x46, 0xd6, 0x28, 0x22, 0x21, 0x7c, 0x2b, 0x22, 0x7b, 0x26, 0x1f, 0x0,  0x0,
                   0x18, 0x0,  0x0,  0x32, 0x56, 0x9,  0x0,  0x1d, 0xb9, 0xe0, 0x29, 0x8b, 0x79, 0xc6, 0x7,  0x86, 0x0,
                   0x3f, 0x88, 0x11, 0xe5, 0xe8, 0x4,  0x25, 0xf5, 0x25, 0xc1, 0x82, 0xb0, 0xc3, 0xc1, 0x96, 0xa,  0x3e,
                   0x85, 0x3c, 0xdb, 0x19, 0xc,  0x3,  0x0,  0xc,  0xdd, 0x81, 0xf9, 0x75, 0xe,  0xf0, 0x8d, 0x25, 0x14,
                   0x3c, 0x50, 0xa2, 0x25, 0xa8, 0x11, 0x0,  0x0,  0x61, 0xfe, 0x8f, 0x83, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28404);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
}

// SubscribeResponse 12402 [Right QoS0] [PropServerKeepAlive 12829,PropAuthenticationMethod
// "xT\232A\200\243\179N\183\187\159\SOH\128'\223\128\v]\t\252\217",PropTopicAliasMaximum 30013,PropRetainAvailable
// 230,PropCorrelationData "W\203\214\235vJNsV",PropRequestProblemInformation 179,PropResponseInformation
// "\247\157\248\232\DLE",PropTopicAlias 22326,PropTopicAliasMaximum 22294,PropPayloadFormatIndicator 57,PropContentType
// "[Q\214 /\137IP\142\143F\f> \RSS\DC4\131\208l\195di\ESC\238\137\EMl",PropAuthenticationData
// "\140F\207Q\ETB\b5\227\f\197Y\235\152\242\&9\214\172y<k\169\138\188\140D\154\tjg",PropRetainAvailable
// 51,PropRetainAvailable 172,PropRetainAvailable 253,PropMessageExpiryInterval 9032,PropSubscriptionIdentifier
// 1,PropPayloadFormatIndicator 79,PropAuthenticationData "SHH\253",PropRequestProblemInformation
// 247,PropMaximumPacketSize 9573,PropMaximumQoS 252,PropReasonString "\239V\CANa\172\207",PropTopicAlias
// 12474,PropMessageExpiryInterval 7642,PropServerReference "\SYND\151\128\231r\253\174;\162I6\170Qv\138\161\196\179"]
TEST(SubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0xc8, 0x1,  0x30, 0x72, 0xc3, 0x1,  0x13, 0x32, 0x1d, 0x15, 0x0,  0x15, 0x78, 0x54, 0xe8, 0x41,
                   0xc8, 0xf3, 0xb3, 0x4e, 0xb7, 0xbb, 0x9f, 0x1,  0x80, 0x27, 0xdf, 0x80, 0xb,  0x5d, 0x9,  0xfc, 0xd9,
                   0x22, 0x75, 0x3d, 0x25, 0xe6, 0x9,  0x0,  0x9,  0x57, 0xcb, 0xd6, 0xeb, 0x76, 0x4a, 0x4e, 0x73, 0x56,
                   0x17, 0xb3, 0x1a, 0x0,  0x5,  0xf7, 0x9d, 0xf8, 0xe8, 0x10, 0x23, 0x57, 0x36, 0x22, 0x57, 0x16, 0x1,
                   0x39, 0x3,  0x0,  0x1c, 0x5b, 0x51, 0xd6, 0x20, 0x2f, 0x89, 0x49, 0x50, 0x8e, 0x8f, 0x46, 0xc,  0x3e,
                   0x20, 0x1e, 0x53, 0x14, 0x83, 0xd0, 0x6c, 0xc3, 0x64, 0x69, 0x1b, 0xee, 0x89, 0x19, 0x6c, 0x16, 0x0,
                   0x1d, 0x8c, 0x46, 0xcf, 0x51, 0x17, 0x8,  0x35, 0xe3, 0xc,  0xc5, 0x59, 0xeb, 0x98, 0xf2, 0x39, 0xd6,
                   0xac, 0x79, 0x3c, 0x6b, 0xa9, 0x8a, 0xbc, 0x8c, 0x44, 0x9a, 0x9,  0x6a, 0x67, 0x25, 0x33, 0x25, 0xac,
                   0x25, 0xfd, 0x2,  0x0,  0x0,  0x23, 0x48, 0xb,  0x1,  0x1,  0x4f, 0x16, 0x0,  0x4,  0x53, 0x48, 0x48,
                   0xfd, 0x17, 0xf7, 0x27, 0x0,  0x0,  0x25, 0x65, 0x24, 0xfc, 0x1f, 0x0,  0x6,  0xef, 0x56, 0x18, 0x61,
                   0xac, 0xcf, 0x23, 0x30, 0xba, 0x2,  0x0,  0x0,  0x1d, 0xda, 0x1c, 0x0,  0x13, 0x16, 0x44, 0x97, 0x80,
                   0xe7, 0x72, 0xfd, 0xae, 0x3b, 0xa2, 0x49, 0x36, 0xaa, 0x51, 0x76, 0x8a, 0xa1, 0xc4, 0xb3, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12402);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
}

// SubscribeResponse 4531 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS2,Right QoS1,Right QoS0,Right
// QoS1,Left SubErrPacketIdentifierInUse,Right QoS2,Left SubErrNotAuthorized,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS1] [PropResponseInformation
// "\ETXIBj\255\226\218W\182\160^\SO\229\FS\149&Q\205\197\180U\159\SYN\DEL\DC1",PropMessageExpiryInterval
// 1858,PropMaximumQoS 211,PropAssignedClientIdentifier "\214",PropWildcardSubscriptionAvailable 141,PropTopicAlias
// 10848,PropReceiveMaximum 18053,PropSessionExpiryInterval 29263,PropUserProperty
// "\235\218\175\204\160\173Q\v\CAN\241\EM\214\SYN!\141\190=\208X\134\198b\USCS\224\133\&8m\217"
// "A\159\241",PropAssignedClientIdentifier "A",PropRetainAvailable 144,PropSubscriptionIdentifier
// 15,PropResponseInformation "\196\159\157zP\237\"H\165H2.\220\RS\184\DEL\206\177\SYN?",PropCorrelationData
// "J\240\203k\149\229\186`\a\SI\140\GSB\227\ESC\216e\178Su\a",PropTopicAlias 18258,PropResponseInformation
// "\DC1\235\214\185\181.c\231\235\151\202\244\ENQ\164\235\RSy\n\154\162\tlW\188\185\253W\253\188&",PropSubscriptionIdentifierAvailable
// 224,PropWillDelayInterval 16630,PropReasonString "p\210\235Q\165K\164\SI%\252LK",PropServerKeepAlive
// 28422,PropTopicAlias 2521,PropReceiveMaximum 23880,PropMessageExpiryInterval 19301,PropMessageExpiryInterval
// 30257,PropReceiveMaximum 24895,PropReasonString "\136K\fG\189"]
TEST(SubACK5QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0xf7, 0x1,  0x11, 0xb3, 0xe9, 0x1,  0x1a, 0x0,  0x19, 0x3,  0x49, 0x42, 0x6a, 0xff, 0xe2, 0xda,
                   0x57, 0xb6, 0xa0, 0x5e, 0xe,  0xe5, 0x1c, 0x95, 0x26, 0x51, 0xcd, 0xc5, 0xb4, 0x55, 0x9f, 0x16, 0x7f,
                   0x11, 0x2,  0x0,  0x0,  0x7,  0x42, 0x24, 0xd3, 0x12, 0x0,  0x1,  0xd6, 0x28, 0x8d, 0x23, 0x2a, 0x60,
                   0x21, 0x46, 0x85, 0x11, 0x0,  0x0,  0x72, 0x4f, 0x26, 0x0,  0x1e, 0xeb, 0xda, 0xaf, 0xcc, 0xa0, 0xad,
                   0x51, 0xb,  0x18, 0xf1, 0x19, 0xd6, 0x16, 0x21, 0x8d, 0xbe, 0x3d, 0xd0, 0x58, 0x86, 0xc6, 0x62, 0x1f,
                   0x43, 0x53, 0xe0, 0x85, 0x38, 0x6d, 0xd9, 0x0,  0x3,  0x41, 0x9f, 0xf1, 0x12, 0x0,  0x1,  0x41, 0x25,
                   0x90, 0xb,  0xf,  0x1a, 0x0,  0x14, 0xc4, 0x9f, 0x9d, 0x7a, 0x50, 0xed, 0x22, 0x48, 0xa5, 0x48, 0x32,
                   0x2e, 0xdc, 0x1e, 0xb8, 0x7f, 0xce, 0xb1, 0x16, 0x3f, 0x9,  0x0,  0x15, 0x4a, 0xf0, 0xcb, 0x6b, 0x95,
                   0xe5, 0xba, 0x60, 0x7,  0xf,  0x8c, 0x1d, 0x42, 0xe3, 0x1b, 0xd8, 0x65, 0xb2, 0x53, 0x75, 0x7,  0x23,
                   0x47, 0x52, 0x1a, 0x0,  0x1e, 0x11, 0xeb, 0xd6, 0xb9, 0xb5, 0x2e, 0x63, 0xe7, 0xeb, 0x97, 0xca, 0xf4,
                   0x5,  0xa4, 0xeb, 0x1e, 0x79, 0xa,  0x9a, 0xa2, 0x9,  0x6c, 0x57, 0xbc, 0xb9, 0xfd, 0x57, 0xfd, 0xbc,
                   0x26, 0x29, 0xe0, 0x18, 0x0,  0x0,  0x40, 0xf6, 0x1f, 0x0,  0xc,  0x70, 0xd2, 0xeb, 0x51, 0xa5, 0x4b,
                   0xa4, 0xf,  0x25, 0xfc, 0x4c, 0x4b, 0x13, 0x6f, 0x6,  0x23, 0x9,  0xd9, 0x21, 0x5d, 0x48, 0x2,  0x0,
                   0x0,  0x4b, 0x65, 0x2,  0x0,  0x0,  0x76, 0x31, 0x21, 0x61, 0x3f, 0x1f, 0x0,  0x5,  0x88, 0x4b, 0xc,
                   0x47, 0xbd, 0xa1, 0x2,  0x1,  0x0,  0x1,  0x91, 0x2,  0x87, 0xa1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4531);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x91);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], 0x87);
  EXPECT_EQ(granted_qos_levels[8], 0xA1);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
}

// SubscribeResponse 28870 [Right QoS2,Right QoS0,Left SubErrPacketIdentifierInUse,Right QoS1]
// [PropMessageExpiryInterval 23190,PropContentType ";U\133dO\218\193\222\143\154\246\STX\153\ACKc\150",PropReasonString
// "I\f9G\229\DLEV]\DC1.m\155}T\224\158\180\209\179\235\&8\135\224\ACK\GS\208\129",PropAuthenticationMethod
// "\232\194\ENQFj\vUM",PropWillDelayInterval 15848,PropContentType
// "[}K/\239n\216b^Xm!\SYN\154\196\230\222\178\DC4\247\162L8\246\156\193\&1Q",PropAuthenticationMethod
// "<",PropAssignedClientIdentifier
// "\220\ACKi\f\195\203,\ENQ*\220\231l\225\168a\218\166\232\SOoB\226\142.",PropRequestProblemInformation
// 36,PropServerKeepAlive 14686,PropMaximumQoS 16]
TEST(SubACK5QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0x93, 0x1,  0x70, 0xc6, 0x8b, 0x1,  0x2,  0x0,  0x0,  0x5a, 0x96, 0x3,  0x0,  0x10, 0x3b, 0x55,
                   0x85, 0x64, 0x4f, 0xda, 0xc1, 0xde, 0x8f, 0x9a, 0xf6, 0x2,  0x99, 0x6,  0x63, 0x96, 0x1f, 0x0,  0x1b,
                   0x49, 0xc,  0x39, 0x47, 0xe5, 0x10, 0x56, 0x5d, 0x11, 0x2e, 0x6d, 0x9b, 0x7d, 0x54, 0xe0, 0x9e, 0xb4,
                   0xd1, 0xb3, 0xeb, 0x38, 0x87, 0xe0, 0x6,  0x1d, 0xd0, 0x81, 0x15, 0x0,  0x8,  0xe8, 0xc2, 0x5,  0x46,
                   0x6a, 0xb,  0x55, 0x4d, 0x18, 0x0,  0x0,  0x3d, 0xe8, 0x3,  0x0,  0x1c, 0x5b, 0x7d, 0x4b, 0x2f, 0xef,
                   0x6e, 0xd8, 0x62, 0x5e, 0x58, 0x6d, 0x21, 0x16, 0x9a, 0xc4, 0xe6, 0xde, 0xb2, 0x14, 0xf7, 0xa2, 0x4c,
                   0x38, 0xf6, 0x9c, 0xc1, 0x31, 0x51, 0x15, 0x0,  0x1,  0x3c, 0x12, 0x0,  0x18, 0xdc, 0x6,  0x69, 0xc,
                   0xc3, 0xcb, 0x2c, 0x5,  0x2a, 0xdc, 0xe7, 0x6c, 0xe1, 0xa8, 0x61, 0xda, 0xa6, 0xe8, 0xe,  0x6f, 0x42,
                   0xe2, 0x8e, 0x2e, 0x17, 0x24, 0x13, 0x39, 0x5e, 0x24, 0x10, 0x2,  0x0,  0x91, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28870);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x91);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
}

// SubscribeResponse 1085 [Right QoS0,Right QoS0,Left SubErrImplementationSpecificError,Left
// SubErrSubscriptionIdentifiersNotSupported] [PropServerKeepAlive 6900,PropPayloadFormatIndicator
// 43,PropRequestProblemInformation 113,PropWildcardSubscriptionAvailable 45,PropTopicAliasMaximum
// 11413,PropAuthenticationData
// "gP\142\207\ENQ\158c\177\225Qa\v\135\SI\218\212\211\202\&0\SOH,#\196\205\234sB",PropMaximumPacketSize
// 479,PropServerReference "\184\179\147m9\248\202\182\149\159\246\180\154\SUB\185\190\ACK",PropAuthenticationMethod
// "\209J\135K\129\DC4\GS(\DC2",PropAuthenticationMethod
// "V\DC3#\206\153\199\138\216?|\206\182|\197\&5~\r\n\229",PropAuthenticationData
// "\r\241\226\212\US\162\211\179}\190L%\200Q\151*\\\DC3\SI",PropWillDelayInterval 13410,PropRetainAvailable
// 123,PropServerReference "\128\&2\194\a\162\184\ESC\215c1\177L\252\245\&12",PropWillDelayInterval 9499]
TEST(SubACK5QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0xa2, 0x1,  0x4,  0x3d, 0x9a, 0x1,  0x13, 0x1a, 0xf4, 0x1,  0x2b, 0x17, 0x71, 0x28, 0x2d, 0x22,
                   0x2c, 0x95, 0x16, 0x0,  0x1b, 0x67, 0x50, 0x8e, 0xcf, 0x5,  0x9e, 0x63, 0xb1, 0xe1, 0x51, 0x61, 0xb,
                   0x87, 0xf,  0xda, 0xd4, 0xd3, 0xca, 0x30, 0x1,  0x2c, 0x23, 0xc4, 0xcd, 0xea, 0x73, 0x42, 0x27, 0x0,
                   0x0,  0x1,  0xdf, 0x1c, 0x0,  0x11, 0xb8, 0xb3, 0x93, 0x6d, 0x39, 0xf8, 0xca, 0xb6, 0x95, 0x9f, 0xf6,
                   0xb4, 0x9a, 0x1a, 0xb9, 0xbe, 0x6,  0x15, 0x0,  0x9,  0xd1, 0x4a, 0x87, 0x4b, 0x81, 0x14, 0x1d, 0x28,
                   0x12, 0x15, 0x0,  0x13, 0x56, 0x13, 0x23, 0xce, 0x99, 0xc7, 0x8a, 0xd8, 0x3f, 0x7c, 0xce, 0xb6, 0x7c,
                   0xc5, 0x35, 0x7e, 0xd,  0xa,  0xe5, 0x16, 0x0,  0x13, 0xd,  0xf1, 0xe2, 0xd4, 0x1f, 0xa2, 0xd3, 0xb3,
                   0x7d, 0xbe, 0x4c, 0x25, 0xc8, 0x51, 0x97, 0x2a, 0x5c, 0x13, 0xf,  0x18, 0x0,  0x0,  0x34, 0x62, 0x25,
                   0x7b, 0x1c, 0x0,  0x10, 0x80, 0x32, 0xc2, 0x7,  0xa2, 0xb8, 0x1b, 0xd7, 0x63, 0x31, 0xb1, 0x4c, 0xfc,
                   0xf5, 0x31, 0x32, 0x18, 0x0,  0x0,  0x25, 0x1b, 0x0,  0x0,  0x83, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1085);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], 0xA1);
}

// SubscribeResponse 11089 [Right QoS1] [PropReasonString "\247\194\179\147\202\DLE",PropTopicAlias
// 23245,PropAssignedClientIdentifier "xmZi\b\150@\214k%\140m\154H",PropUserProperty "R\v\214\NAK"
// "\190\&7\134\154\232\SIf\228\254\NAK\CANA\161\EOT*\GS\135\SO\DC2\188O|i",PropReasonString
// "\246F:\183\ESC+\"\225\207\209\163\153\202\151\DC1\\\140\167\200\206y\152|\ESCu%\196\153\239)",PropReceiveMaximum
// 6204,PropTopicAlias 26815,PropAuthenticationData
// "\219\163E\SUB\NULO\158\ESCs\ACK\185\vQ4\b\213\SUB:?M\239\196B\DC3",PropWillDelayInterval 15528,PropUserProperty
// "\165" "\234\244\189U\247Y\205\224\b\192\177\&6\228\131",PropAuthenticationData
// "\ETX\251\US\NAK\250\209\227\164D\206\149\213\175\&6)\DEL\190Y\217\252\DLEX\219\164J\159Z",PropServerReference
// "\f{\ACK\209$\201\197\225w\163\194\&23\228Y\252\233\v0\205\181",PropAssignedClientIdentifier
// "\229\163\204\171z\177YW\156\ACK\205N\136\151B\251\159l;",PropSessionExpiryInterval 8174,PropSessionExpiryInterval
// 26444]
TEST(SubACK5QCTest, Decode16) {
  uint8_t pkt[] = {
      0x90, 0xf3, 0x1,  0x2b, 0x51, 0xee, 0x1,  0x1f, 0x0,  0x6,  0xf7, 0xc2, 0xb3, 0x93, 0xca, 0x10, 0x23, 0x5a, 0xcd,
      0x12, 0x0,  0xe,  0x78, 0x6d, 0x5a, 0x69, 0x8,  0x96, 0x40, 0xd6, 0x6b, 0x25, 0x8c, 0x6d, 0x9a, 0x48, 0x26, 0x0,
      0x4,  0x52, 0xb,  0xd6, 0x15, 0x0,  0x17, 0xbe, 0x37, 0x86, 0x9a, 0xe8, 0xf,  0x66, 0xe4, 0xfe, 0x15, 0x18, 0x41,
      0xa1, 0x4,  0x2a, 0x1d, 0x87, 0xe,  0x12, 0xbc, 0x4f, 0x7c, 0x69, 0x1f, 0x0,  0x1e, 0xf6, 0x46, 0x3a, 0xb7, 0x1b,
      0x2b, 0x22, 0xe1, 0xcf, 0xd1, 0xa3, 0x99, 0xca, 0x97, 0x11, 0x5c, 0x8c, 0xa7, 0xc8, 0xce, 0x79, 0x98, 0x7c, 0x1b,
      0x75, 0x25, 0xc4, 0x99, 0xef, 0x29, 0x21, 0x18, 0x3c, 0x23, 0x68, 0xbf, 0x16, 0x0,  0x18, 0xdb, 0xa3, 0x45, 0x1a,
      0x0,  0x4f, 0x9e, 0x1b, 0x73, 0x6,  0xb9, 0xb,  0x51, 0x34, 0x8,  0xd5, 0x1a, 0x3a, 0x3f, 0x4d, 0xef, 0xc4, 0x42,
      0x13, 0x18, 0x0,  0x0,  0x3c, 0xa8, 0x26, 0x0,  0x1,  0xa5, 0x0,  0xe,  0xea, 0xf4, 0xbd, 0x55, 0xf7, 0x59, 0xcd,
      0xe0, 0x8,  0xc0, 0xb1, 0x36, 0xe4, 0x83, 0x16, 0x0,  0x1b, 0x3,  0xfb, 0x1f, 0x15, 0xfa, 0xd1, 0xe3, 0xa4, 0x44,
      0xce, 0x95, 0xd5, 0xaf, 0x36, 0x29, 0x7f, 0xbe, 0x59, 0xd9, 0xfc, 0x10, 0x58, 0xdb, 0xa4, 0x4a, 0x9f, 0x5a, 0x1c,
      0x0,  0x15, 0xc,  0x7b, 0x6,  0xd1, 0x24, 0xc9, 0xc5, 0xe1, 0x77, 0xa3, 0xc2, 0x32, 0x33, 0xe4, 0x59, 0xfc, 0xe9,
      0xb,  0x30, 0xcd, 0xb5, 0x12, 0x0,  0x13, 0xe5, 0xa3, 0xcc, 0xab, 0x7a, 0xb1, 0x59, 0x57, 0x9c, 0x6,  0xcd, 0x4e,
      0x88, 0x97, 0x42, 0xfb, 0x9f, 0x6c, 0x3b, 0x11, 0x0,  0x0,  0x1f, 0xee, 0x11, 0x0,  0x0,  0x67, 0x4c, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11089);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
}

// SubscribeResponse 4816 [Left SubErrQuotaExceeded,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right
// QoS0,Right QoS1,Right QoS0,Left SubErrNotAuthorized,Right QoS1,Left SubErrNotAuthorized,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported] [PropMessageExpiryInterval
// 20581,PropServerReference "\180\166@",PropReasonString "",PropUserProperty "\139\179\177\244"
// "0\DC4)\194",PropTopicAlias 948,PropReceiveMaximum 14675,PropSubscriptionIdentifierAvailable
// 199,PropTopicAliasMaximum 19310,PropWillDelayInterval 8080,PropCorrelationData
// "\137\243\196\196\178",PropTopicAliasMaximum 10347,PropMaximumQoS 180,PropMaximumQoS 19,PropServerReference
// "\175WZ\225p\199\160&\249\b\220\250z\155\136\178g\187_\218\192\168\&2\182\n\148\231",PropMessageExpiryInterval
// 15679,PropCorrelationData "\241W\243\&0\213z\NAK\182\194\DC3\148\192e\222\&1lz\DC1.\214",PropMaximumQoS
// 79,PropSubscriptionIdentifier 21]
TEST(SubACK5QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x86, 0x1,  0x12, 0xd0, 0x78, 0x2,  0x0,  0x0,  0x50, 0x65, 0x1c, 0x0,  0x3,  0xb4, 0xa6,
                   0x40, 0x1f, 0x0,  0x0,  0x26, 0x0,  0x4,  0x8b, 0xb3, 0xb1, 0xf4, 0x0,  0x4,  0x30, 0x14, 0x29,
                   0xc2, 0x23, 0x3,  0xb4, 0x21, 0x39, 0x53, 0x29, 0xc7, 0x22, 0x4b, 0x6e, 0x18, 0x0,  0x0,  0x1f,
                   0x90, 0x9,  0x0,  0x5,  0x89, 0xf3, 0xc4, 0xc4, 0xb2, 0x22, 0x28, 0x6b, 0x24, 0xb4, 0x24, 0x13,
                   0x1c, 0x0,  0x1b, 0xaf, 0x57, 0x5a, 0xe1, 0x70, 0xc7, 0xa0, 0x26, 0xf9, 0x8,  0xdc, 0xfa, 0x7a,
                   0x9b, 0x88, 0xb2, 0x67, 0xbb, 0x5f, 0xda, 0xc0, 0xa8, 0x32, 0xb6, 0xa,  0x94, 0xe7, 0x2,  0x0,
                   0x0,  0x3d, 0x3f, 0x9,  0x0,  0x14, 0xf1, 0x57, 0xf3, 0x30, 0xd5, 0x7a, 0x15, 0xb6, 0xc2, 0x13,
                   0x94, 0xc0, 0x65, 0xde, 0x31, 0x6c, 0x7a, 0x11, 0x2e, 0xd6, 0x24, 0x4f, 0xb,  0x15, 0x97, 0xa2,
                   0x2,  0x0,  0x1,  0x0,  0x87, 0x1,  0x87, 0x9e, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4816);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x97);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x87);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
  EXPECT_EQ(granted_qos_levels[9], 0x9E);
  EXPECT_EQ(granted_qos_levels[10], 0xA2);
}

// SubscribeResponse 24891 [Left SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Right QoS1,Right QoS2,Left
// SubErrTopicFilterInvalid,Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported] [PropContentType
// "\ESC\230\222\175\187\235\US",PropRequestProblemInformation 195,PropServerReference
// "SM\ACKT\184\216p?RH6M=q\DC4\bD\156\128\160\135\244\226(\227\&5\193.\200\132",PropContentType
// "3\218\236\ACK\243`\174\241\225\131\NULm\ETX\183\r\220.\164\144\182\&7k\253J\EM\247\173\171r",PropUserProperty
// "X'\231]\ESCzE\140\179t\191\135\216p" "",PropAuthenticationMethod
// "\156\138\ACK\184\147H\157=\233Y\144\135\b'd\243\251\196\NAKk\nW\171",PropServerReference
// "(\vP2Gn!E\186r*\161zs\198T",PropRequestProblemInformation 227,PropResponseTopic
// "\140C_\237D6\234'@\251\\\155|\184\162\130",PropReasonString
// "g\187s\f\242!t\135\140*\v\140\143B\143\129\188\140\141",PropResponseInformation
// "\193\204\DC4+9Y\200\&0\STX~\253\FS\232;",PropUserProperty
// "\209\STX\223\244\&8\be\242\198\179>\138Z\148\223\CAN\254h-\194\242\254\232@" "\254\246}@\195
// \238\US\204f\202K\210X\202\225\218\207[\219\152J\171$\137",PropTopicAlias 20875,PropSubscriptionIdentifier
// 10,PropCorrelationData "\216\219~B+\224\185\nm \STX@\EOT\213\217\226\222",PropAuthenticationData
// "(\a\174p\182\180",PropTopicAlias 7307,PropResponseTopic
// "@\163!oz\178\136\155..\167\154\139r\t3",PropRequestProblemInformation 48,PropMessageExpiryInterval
// 22413,PropMessageExpiryInterval 27970,PropMaximumQoS 214,PropPayloadFormatIndicator 142,PropReceiveMaximum 26693]
TEST(SubACK5QCTest, Decode18) {
  uint8_t pkt[] = {
      0x90, 0xd7, 0x2,  0x61, 0x3b, 0xca, 0x2,  0x3,  0x0,  0x7,  0x1b, 0xe6, 0xde, 0xaf, 0xbb, 0xeb, 0x1f, 0x17, 0xc3,
      0x1c, 0x0,  0x1e, 0x53, 0x4d, 0x6,  0x54, 0xb8, 0xd8, 0x70, 0x3f, 0x52, 0x48, 0x36, 0x4d, 0x3d, 0x71, 0x14, 0x8,
      0x44, 0x9c, 0x80, 0xa0, 0x87, 0xf4, 0xe2, 0x28, 0xe3, 0x35, 0xc1, 0x2e, 0xc8, 0x84, 0x3,  0x0,  0x1d, 0x33, 0xda,
      0xec, 0x6,  0xf3, 0x60, 0xae, 0xf1, 0xe1, 0x83, 0x0,  0x6d, 0x3,  0xb7, 0xd,  0xdc, 0x2e, 0xa4, 0x90, 0xb6, 0x37,
      0x6b, 0xfd, 0x4a, 0x19, 0xf7, 0xad, 0xab, 0x72, 0x26, 0x0,  0xe,  0x58, 0x27, 0xe7, 0x5d, 0x1b, 0x7a, 0x45, 0x8c,
      0xb3, 0x74, 0xbf, 0x87, 0xd8, 0x70, 0x0,  0x0,  0x15, 0x0,  0x17, 0x9c, 0x8a, 0x6,  0xb8, 0x93, 0x48, 0x9d, 0x3d,
      0xe9, 0x59, 0x90, 0x87, 0x8,  0x27, 0x64, 0xf3, 0xfb, 0xc4, 0x15, 0x6b, 0xa,  0x57, 0xab, 0x1c, 0x0,  0x10, 0x28,
      0xb,  0x50, 0x32, 0x47, 0x6e, 0x21, 0x45, 0xba, 0x72, 0x2a, 0xa1, 0x7a, 0x73, 0xc6, 0x54, 0x17, 0xe3, 0x8,  0x0,
      0x10, 0x8c, 0x43, 0x5f, 0xed, 0x44, 0x36, 0xea, 0x27, 0x40, 0xfb, 0x5c, 0x9b, 0x7c, 0xb8, 0xa2, 0x82, 0x1f, 0x0,
      0x13, 0x67, 0xbb, 0x73, 0xc,  0xf2, 0x21, 0x74, 0x87, 0x8c, 0x2a, 0xb,  0x8c, 0x8f, 0x42, 0x8f, 0x81, 0xbc, 0x8c,
      0x8d, 0x1a, 0x0,  0xe,  0xc1, 0xcc, 0x14, 0x2b, 0x39, 0x59, 0xc8, 0x30, 0x2,  0x7e, 0xfd, 0x1c, 0xe8, 0x3b, 0x26,
      0x0,  0x18, 0xd1, 0x2,  0xdf, 0xf4, 0x38, 0x8,  0x65, 0xf2, 0xc6, 0xb3, 0x3e, 0x8a, 0x5a, 0x94, 0xdf, 0x18, 0xfe,
      0x68, 0x2d, 0xc2, 0xf2, 0xfe, 0xe8, 0x40, 0x0,  0x19, 0xfe, 0xf6, 0x7d, 0x40, 0xc3, 0x20, 0xee, 0x1f, 0xcc, 0x66,
      0xca, 0x4b, 0xd2, 0x58, 0xca, 0xe1, 0xda, 0xcf, 0x5b, 0xdb, 0x98, 0x4a, 0xab, 0x24, 0x89, 0x23, 0x51, 0x8b, 0xb,
      0xa,  0x9,  0x0,  0x11, 0xd8, 0xdb, 0x7e, 0x42, 0x2b, 0xe0, 0xb9, 0xa,  0x6d, 0x20, 0x2,  0x40, 0x4,  0xd5, 0xd9,
      0xe2, 0xde, 0x16, 0x0,  0x6,  0x28, 0x7,  0xae, 0x70, 0xb6, 0xb4, 0x23, 0x1c, 0x8b, 0x8,  0x0,  0x10, 0x40, 0xa3,
      0x21, 0x6f, 0x7a, 0xb2, 0x88, 0x9b, 0x2e, 0x2e, 0xa7, 0x9a, 0x8b, 0x72, 0x9,  0x33, 0x17, 0x30, 0x2,  0x0,  0x0,
      0x57, 0x8d, 0x2,  0x0,  0x0,  0x6d, 0x42, 0x24, 0xd6, 0x1,  0x8e, 0x21, 0x68, 0x45, 0x80, 0x91, 0x9e, 0xa2, 0x1,
      0x2,  0x8f, 0x1,  0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24891);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], 0x9E);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x8F);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0xA1);
}

// SubscribeResponse 22923 [Right QoS2,Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS2,Left SubErrTopicFilterInvalid,Right QoS1]
// [PropMaximumPacketSize 18797,PropResponseInformation
// "\212J\205\SUB\n\241\166\204\142\167\143\158\224\173T\191\130P\238A`Z\FS\ENQ\NAKVM",PropServerReference
// "\165-!\195\&4\ETX1\\3\128Z7\152",PropRequestResponseInformation 221,PropTopicAliasMaximum 3412,PropMaximumPacketSize
// 23942,PropTopicAliasMaximum 19127,PropTopicAliasMaximum 22275,PropSubscriptionIdentifierAvailable
// 180,PropServerKeepAlive 9519,PropMaximumPacketSize 22991,PropRequestResponseInformation 242,PropMaximumPacketSize
// 2183,PropRetainAvailable 122,PropSessionExpiryInterval 11229,PropSubscriptionIdentifierAvailable
// 107,PropSharedSubscriptionAvailable 85,PropRequestProblemInformation 77,PropServerKeepAlive
// 24672,PropMaximumPacketSize 2021,PropMessageExpiryInterval 27111,PropWildcardSubscriptionAvailable
// 84,PropCorrelationData "NR\249\163\ETX\223\227\231",PropReasonString
// "\225\234\202\136\220\134\RSY&\197_\186n\DC3\t;\195g\192\DC3",PropTopicAlias 22559,PropResponseTopic
// "\183\239",PropResponseTopic "Ghf\r+e\215\245Ly\139\173\172\206\v
// \187\137\&0\131\219\225eK;\216\SYN\151\167",PropAssignedClientIdentifier "\187h\219\&3=\226\182\200L\253\206\SO\144"]
TEST(SubACK5QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0xd7, 0x1,  0x59, 0x8b, 0xca, 0x1,  0x27, 0x0,  0x0,  0x49, 0x6d, 0x1a, 0x0,  0x1b, 0xd4, 0x4a,
                   0xcd, 0x1a, 0xa,  0xf1, 0xa6, 0xcc, 0x8e, 0xa7, 0x8f, 0x9e, 0xe0, 0xad, 0x54, 0xbf, 0x82, 0x50, 0xee,
                   0x41, 0x60, 0x5a, 0x1c, 0x5,  0x15, 0x56, 0x4d, 0x1c, 0x0,  0xd,  0xa5, 0x2d, 0x21, 0xc3, 0x34, 0x3,
                   0x31, 0x5c, 0x33, 0x80, 0x5a, 0x37, 0x98, 0x19, 0xdd, 0x22, 0xd,  0x54, 0x27, 0x0,  0x0,  0x5d, 0x86,
                   0x22, 0x4a, 0xb7, 0x22, 0x57, 0x3,  0x29, 0xb4, 0x13, 0x25, 0x2f, 0x27, 0x0,  0x0,  0x59, 0xcf, 0x19,
                   0xf2, 0x27, 0x0,  0x0,  0x8,  0x87, 0x25, 0x7a, 0x11, 0x0,  0x0,  0x2b, 0xdd, 0x29, 0x6b, 0x2a, 0x55,
                   0x17, 0x4d, 0x13, 0x60, 0x60, 0x27, 0x0,  0x0,  0x7,  0xe5, 0x2,  0x0,  0x0,  0x69, 0xe7, 0x28, 0x54,
                   0x9,  0x0,  0x8,  0x4e, 0x52, 0xf9, 0xa3, 0x3,  0xdf, 0xe3, 0xe7, 0x1f, 0x0,  0x14, 0xe1, 0xea, 0xca,
                   0x88, 0xdc, 0x86, 0x1e, 0x59, 0x26, 0xc5, 0x5f, 0xba, 0x6e, 0x13, 0x9,  0x3b, 0xc3, 0x67, 0xc0, 0x13,
                   0x23, 0x58, 0x1f, 0x8,  0x0,  0x2,  0xb7, 0xef, 0x8,  0x0,  0x1d, 0x47, 0x68, 0x66, 0xd,  0x2b, 0x65,
                   0xd7, 0xf5, 0x4c, 0x79, 0x8b, 0xad, 0xac, 0xce, 0xb,  0x20, 0xbb, 0x89, 0x30, 0x83, 0xdb, 0xe1, 0x65,
                   0x4b, 0x3b, 0xd8, 0x16, 0x97, 0xa7, 0x12, 0x0,  0xd,  0xbb, 0x68, 0xdb, 0x33, 0x3d, 0xe2, 0xb6, 0xc8,
                   0x4c, 0xfd, 0xce, 0xe,  0x90, 0x2,  0x1,  0xa1, 0x0,  0xa2, 0x2,  0x2,  0x8f, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22923);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], 0x8F);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
}

// SubscribeResponse 25337 [Right QoS2,Right QoS1,Left SubErrTopicFilterInvalid,Right QoS1,Right QoS2,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported] [PropPayloadFormatIndicator 154,PropSharedSubscriptionAvailable
// 144,PropMaximumPacketSize 754,PropReceiveMaximum 29505,PropMessageExpiryInterval 25170,PropCorrelationData
// "\251nd\185V\225",PropAuthenticationData "\b\238\196\244\194\139\SI\182\170\245G\242",PropMaximumQoS
// 136,PropMaximumQoS 45,PropSessionExpiryInterval 23317,PropSessionExpiryInterval 15511,PropSubscriptionIdentifier
// 0,PropMaximumPacketSize 28677,PropAssignedClientIdentifier
// "\236\173\NUL\195\229\191\219\131\177\150B\rLw\231A\153\144HeA?\185\130h\157",PropPayloadFormatIndicator
// 13,PropSharedSubscriptionAvailable 132,PropResponseInformation "\253",PropMaximumPacketSize
// 13780,PropAuthenticationMethod "\t\190G^V\252\224\129&%\204\193\238\140\190|\163",PropRequestProblemInformation
// 15,PropAssignedClientIdentifier ",\195\224\190\151\SOH p\197\DC4\141\203\&3\168bczA\141\142\USq\209",PropReasonString
// "\180\SYN",PropUserProperty "hLv\163KA\DC2x\225\199\169l\SOHI\177\135Vb\132\164\146\141\235\DELpM-\232\135"
// "\216\255\147\186%\182]f}\189.\168\NAK\152\235h\243\192p?"]
TEST(SubACK5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x90, 0xde, 0x1,  0x62, 0xf9, 0xd3, 0x1,  0x1,  0x9a, 0x2a, 0x90, 0x27, 0x0,  0x0,  0x2,  0xf2, 0x21, 0x73, 0x41,
      0x2,  0x0,  0x0,  0x62, 0x52, 0x9,  0x0,  0x6,  0xfb, 0x6e, 0x64, 0xb9, 0x56, 0xe1, 0x16, 0x0,  0xc,  0x8,  0xee,
      0xc4, 0xf4, 0xc2, 0x8b, 0xf,  0xb6, 0xaa, 0xf5, 0x47, 0xf2, 0x24, 0x88, 0x24, 0x2d, 0x11, 0x0,  0x0,  0x5b, 0x15,
      0x11, 0x0,  0x0,  0x3c, 0x97, 0xb,  0x0,  0x27, 0x0,  0x0,  0x70, 0x5,  0x12, 0x0,  0x1a, 0xec, 0xad, 0x0,  0xc3,
      0xe5, 0xbf, 0xdb, 0x83, 0xb1, 0x96, 0x42, 0xd,  0x4c, 0x77, 0xe7, 0x41, 0x99, 0x90, 0x48, 0x65, 0x41, 0x3f, 0xb9,
      0x82, 0x68, 0x9d, 0x1,  0xd,  0x2a, 0x84, 0x1a, 0x0,  0x1,  0xfd, 0x27, 0x0,  0x0,  0x35, 0xd4, 0x15, 0x0,  0x11,
      0x9,  0xbe, 0x47, 0x5e, 0x56, 0xfc, 0xe0, 0x81, 0x26, 0x25, 0xcc, 0xc1, 0xee, 0x8c, 0xbe, 0x7c, 0xa3, 0x17, 0xf,
      0x12, 0x0,  0x17, 0x2c, 0xc3, 0xe0, 0xbe, 0x97, 0x1,  0x20, 0x70, 0xc5, 0x14, 0x8d, 0xcb, 0x33, 0xa8, 0x62, 0x63,
      0x7a, 0x41, 0x8d, 0x8e, 0x1f, 0x71, 0xd1, 0x1f, 0x0,  0x2,  0xb4, 0x16, 0x26, 0x0,  0x1d, 0x68, 0x4c, 0x76, 0xa3,
      0x4b, 0x41, 0x12, 0x78, 0xe1, 0xc7, 0xa9, 0x6c, 0x1,  0x49, 0xb1, 0x87, 0x56, 0x62, 0x84, 0xa4, 0x92, 0x8d, 0xeb,
      0x7f, 0x70, 0x4d, 0x2d, 0xe8, 0x87, 0x0,  0x14, 0xd8, 0xff, 0x93, 0xba, 0x25, 0xb6, 0x5d, 0x66, 0x7d, 0xbd, 0x2e,
      0xa8, 0x15, 0x98, 0xeb, 0x68, 0xf3, 0xc0, 0x70, 0x3f, 0x2,  0x1,  0x8f, 0x1,  0x2,  0x0,  0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25337);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x9E);
}

// SubscribeResponse 1262 [Left SubErrPacketIdentifierInUse,Right QoS0,Left SubErrPacketIdentifierInUse,Left
// SubErrImplementationSpecificError,Left SubErrImplementationSpecificError,Right QoS0,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrNotAuthorized,Right QoS2] [PropContentType
// "\242&\EOT-\\krC\197\234\&9J3\153GT",PropPayloadFormatIndicator 232,PropSharedSubscriptionAvailable
// 141,PropRetainAvailable 246,PropCorrelationData ">C\SUB\157.\208q\234\138\170lo\247\158\196\202",PropTopicAlias
// 31744,PropWildcardSubscriptionAvailable 209,PropMaximumQoS 222,PropMessageExpiryInterval 13653,PropUserProperty
// "\214G\194\254BG\220\253\136\252\149t\\~2\196\DLE\219\255\141\DC1o^"
// "u\151\220\DC3\151\DLE\248\&5\225\&9V$\145\"\f\173\f_\192}\DC1yn<fK\233F\245x",PropWillDelayInterval
// 6527,PropReasonString "\134\NAK\209!\249\251\245\193 M\ETX(Y\191d\145Uk\255t",PropRequestProblemInformation
// 215,PropTopicAliasMaximum 3772,PropWildcardSubscriptionAvailable 50,PropSubscriptionIdentifier 18,PropCorrelationData
// "\DC4\SYN\175\223\DLE\128\235\140\212\251",PropCorrelationData
// "HO\rKg\150\233\136\f\225\242\129",PropWildcardSubscriptionAvailable 243,PropSubscriptionIdentifierAvailable
// 10,PropAssignedClientIdentifier
// "\223YOR\149\NAK3i\193j8\185\236\250,\166\137YM\239>R\254\ESC$\239U@",PropWillDelayInterval
// 21923,PropAuthenticationData "\171h\DC4\156\n\222\136J",PropTopicAliasMaximum 1295,PropResponseTopic
// "z\134\&4\202*2\176\208S\224\\_/j\"",PropUserProperty "K\218\DC10\SUB\203"
// "\ESC\175\216?(~\212\192]\204\&8m\137\145q\195B"]
TEST(SubACK5QCTest, Decode21) {
  uint8_t pkt[] = {
      0x90, 0xa5, 0x2,  0x4,  0xee, 0x97, 0x2,  0x3,  0x0,  0x10, 0xf2, 0x26, 0x4,  0x2d, 0x5c, 0x6b, 0x72, 0x43, 0xc5,
      0xea, 0x39, 0x4a, 0x33, 0x99, 0x47, 0x54, 0x1,  0xe8, 0x2a, 0x8d, 0x25, 0xf6, 0x9,  0x0,  0x10, 0x3e, 0x43, 0x1a,
      0x9d, 0x2e, 0xd0, 0x71, 0xea, 0x8a, 0xaa, 0x6c, 0x6f, 0xf7, 0x9e, 0xc4, 0xca, 0x23, 0x7c, 0x0,  0x28, 0xd1, 0x24,
      0xde, 0x2,  0x0,  0x0,  0x35, 0x55, 0x26, 0x0,  0x17, 0xd6, 0x47, 0xc2, 0xfe, 0x42, 0x47, 0xdc, 0xfd, 0x88, 0xfc,
      0x95, 0x74, 0x5c, 0x7e, 0x32, 0xc4, 0x10, 0xdb, 0xff, 0x8d, 0x11, 0x6f, 0x5e, 0x0,  0x1e, 0x75, 0x97, 0xdc, 0x13,
      0x97, 0x10, 0xf8, 0x35, 0xe1, 0x39, 0x56, 0x24, 0x91, 0x22, 0xc,  0xad, 0xc,  0x5f, 0xc0, 0x7d, 0x11, 0x79, 0x6e,
      0x3c, 0x66, 0x4b, 0xe9, 0x46, 0xf5, 0x78, 0x18, 0x0,  0x0,  0x19, 0x7f, 0x1f, 0x0,  0x14, 0x86, 0x15, 0xd1, 0x21,
      0xf9, 0xfb, 0xf5, 0xc1, 0x20, 0x4d, 0x3,  0x28, 0x59, 0xbf, 0x64, 0x91, 0x55, 0x6b, 0xff, 0x74, 0x17, 0xd7, 0x22,
      0xe,  0xbc, 0x28, 0x32, 0xb,  0x12, 0x9,  0x0,  0xa,  0x14, 0x16, 0xaf, 0xdf, 0x10, 0x80, 0xeb, 0x8c, 0xd4, 0xfb,
      0x9,  0x0,  0xc,  0x48, 0x4f, 0xd,  0x4b, 0x67, 0x96, 0xe9, 0x88, 0xc,  0xe1, 0xf2, 0x81, 0x28, 0xf3, 0x29, 0xa,
      0x12, 0x0,  0x1c, 0xdf, 0x59, 0x4f, 0x52, 0x95, 0x15, 0x33, 0x69, 0xc1, 0x6a, 0x38, 0xb9, 0xec, 0xfa, 0x2c, 0xa6,
      0x89, 0x59, 0x4d, 0xef, 0x3e, 0x52, 0xfe, 0x1b, 0x24, 0xef, 0x55, 0x40, 0x18, 0x0,  0x0,  0x55, 0xa3, 0x16, 0x0,
      0x8,  0xab, 0x68, 0x14, 0x9c, 0xa,  0xde, 0x88, 0x4a, 0x22, 0x5,  0xf,  0x8,  0x0,  0xf,  0x7a, 0x86, 0x34, 0xca,
      0x2a, 0x32, 0xb0, 0xd0, 0x53, 0xe0, 0x5c, 0x5f, 0x2f, 0x6a, 0x22, 0x26, 0x0,  0x6,  0x4b, 0xda, 0x11, 0x30, 0x1a,
      0xcb, 0x0,  0x11, 0x1b, 0xaf, 0xd8, 0x3f, 0x28, 0x7e, 0xd4, 0xc0, 0x5d, 0xcc, 0x38, 0x6d, 0x89, 0x91, 0x71, 0xc3,
      0x42, 0x91, 0x0,  0x91, 0x83, 0x83, 0x0,  0x0,  0x9e, 0x87, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1262);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x91);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], 0x83);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 21462 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrQuotaExceeded,Right
// QoS1,Right QoS2,Right QoS0,Left SubErrSharedSubscriptionsNotSupported,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError,Right QoS2,Left SubErrNotAuthorized] [PropServerKeepAlive
// 14397,PropSubscriptionIdentifier 32,PropTopicAliasMaximum 5258,PropCorrelationData
// "\ETBr\207\&0<e\197",PropAuthenticationData "=",PropAuthenticationMethod "\209\NULE\224\223JR'\255pb\DC32.\149c\151z'
// \SOae\158l",PropReceiveMaximum 17527]
TEST(SubACK5QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0x43, 0x53, 0xd6, 0x35, 0x13, 0x38, 0x3d, 0xb,  0x20, 0x22, 0x14, 0x8a, 0x9,
                   0x0,  0x7,  0x17, 0x72, 0xcf, 0x30, 0x3c, 0x65, 0xc5, 0x16, 0x0,  0x1,  0x3d, 0x15,
                   0x0,  0x19, 0xd1, 0x0,  0x45, 0xe0, 0xdf, 0x4a, 0x52, 0x27, 0xff, 0x70, 0x62, 0x13,
                   0x32, 0x2e, 0x95, 0x63, 0x97, 0x7a, 0x27, 0x20, 0xe,  0x61, 0x65, 0x9e, 0x6c, 0x21,
                   0x44, 0x77, 0x2,  0xa2, 0x97, 0x1,  0x2,  0x0,  0x9e, 0x8f, 0x83, 0x2,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21462);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x9E);
  EXPECT_EQ(granted_qos_levels[7], 0x8F);
  EXPECT_EQ(granted_qos_levels[8], 0x83);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[10], 0x87);
}

// SubscribeResponse 12076 [Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrImplementationSpecificError,Right
// QoS2,Right QoS0,Right QoS2] [PropSubscriptionIdentifier 0,PropRetainAvailable 202,PropUserProperty
// "\232\180\129\209p\216o\147\255zo\246\DC2%b\225\174T85\RS\237\234C\162$"
// "\161\247{\204H\189\233>\138\175",PropMaximumPacketSize 2747,PropPayloadFormatIndicator 98,PropCorrelationData
// "\185\CANk\215\190*\211\174h\137t\163\154A",PropSubscriptionIdentifier 4,PropAuthenticationData
// "\n9?\132\SUBr\240\DEL\199\131\SYN\230f\132<\218\211\FS\DLE5\223\FS\213\n1\176j\144\129",PropTopicAlias
// 18531,PropSubscriptionIdentifierAvailable 150,PropRequestResponseInformation 101]
TEST(SubACK5QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x76, 0x2f, 0x2c, 0x6e, 0xb,  0x0,  0x25, 0xca, 0x26, 0x0,  0x1a, 0xe8, 0xb4, 0x81,
                   0xd1, 0x70, 0xd8, 0x6f, 0x93, 0xff, 0x7a, 0x6f, 0xf6, 0x12, 0x25, 0x62, 0xe1, 0xae, 0x54,
                   0x38, 0x35, 0x1e, 0xed, 0xea, 0x43, 0xa2, 0x24, 0x0,  0xa,  0xa1, 0xf7, 0x7b, 0xcc, 0x48,
                   0xbd, 0xe9, 0x3e, 0x8a, 0xaf, 0x27, 0x0,  0x0,  0xa,  0xbb, 0x1,  0x62, 0x9,  0x0,  0xe,
                   0xb9, 0x18, 0x6b, 0xd7, 0xbe, 0x2a, 0xd3, 0xae, 0x68, 0x89, 0x74, 0xa3, 0x9a, 0x41, 0xb,
                   0x4,  0x16, 0x0,  0x1d, 0xa,  0x39, 0x3f, 0x84, 0x1a, 0x72, 0xf0, 0x7f, 0xc7, 0x83, 0x16,
                   0xe6, 0x66, 0x84, 0x3c, 0xda, 0xd3, 0x1c, 0x10, 0x35, 0xdf, 0x1c, 0xd5, 0xa,  0x31, 0xb0,
                   0x6a, 0x90, 0x81, 0x23, 0x48, 0x63, 0x29, 0x96, 0x19, 0x65, 0xa1, 0x83, 0x2,  0x0,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12076);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 3799 [Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrImplementationSpecificError,Left SubErrTopicFilterInvalid,Right QoS2,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS0] [PropSubscriptionIdentifier
// 16,PropAuthenticationMethod "",PropMaximumQoS 79,PropMessageExpiryInterval 18369,PropSubscriptionIdentifier
// 30,PropUserProperty "GQ\178\234\199\215\189\173TYU\202\221\201\238\192j\156\DC3e\196\150\b\236<" "
// \236\149-!\251\238\EOT9E\158\204",PropMaximumPacketSize 22281,PropServerKeepAlive 17526,PropResponseTopic
// "\231\146",PropAuthenticationData "9\141\&6s\243s\152\156\247\183\191.\DC3\192/^\225\193u",PropServerKeepAlive
// 28155,PropAssignedClientIdentifier "\144\140#;\RS\154\234\231",PropCorrelationData
// "Ug\228\168\NAK`\RS{\157O\152\&5\157)\237",PropMaximumPacketSize 12102,PropRetainAvailable 214,PropMaximumPacketSize
// 24583,PropTopicAliasMaximum 10997,PropRetainAvailable 249,PropServerKeepAlive 5371,PropUserProperty
// "yR\ACK1\228c\145\139S\SO-\161\239\170\215\252\165\254"
// "a\197\136\224\158\ESC\NUL\237\&9\139\157l\GS\f\f9\SO6",PropRetainAvailable 37,PropSharedSubscriptionAvailable
// 8,PropRequestResponseInformation 161,PropPayloadFormatIndicator 192,PropWillDelayInterval
// 14103,PropMessageExpiryInterval 3544,PropPayloadFormatIndicator 166,PropServerKeepAlive 1582]
TEST(SubACK5QCTest, Decode24) {
  uint8_t pkt[] = {
      0x90, 0xdb, 0x1,  0xe,  0xd7, 0xcf, 0x1,  0xb,  0x10, 0x15, 0x0,  0x0,  0x24, 0x4f, 0x2,  0x0,  0x0,  0x47, 0xc1,
      0xb,  0x1e, 0x26, 0x0,  0x19, 0x47, 0x51, 0xb2, 0xea, 0xc7, 0xd7, 0xbd, 0xad, 0x54, 0x59, 0x55, 0xca, 0xdd, 0xc9,
      0xee, 0xc0, 0x6a, 0x9c, 0x13, 0x65, 0xc4, 0x96, 0x8,  0xec, 0x3c, 0x0,  0xc,  0x20, 0xec, 0x95, 0x2d, 0x21, 0xfb,
      0xee, 0x4,  0x39, 0x45, 0x9e, 0xcc, 0x27, 0x0,  0x0,  0x57, 0x9,  0x13, 0x44, 0x76, 0x8,  0x0,  0x2,  0xe7, 0x92,
      0x16, 0x0,  0x13, 0x39, 0x8d, 0x36, 0x73, 0xf3, 0x73, 0x98, 0x9c, 0xf7, 0xb7, 0xbf, 0x2e, 0x13, 0xc0, 0x2f, 0x5e,
      0xe1, 0xc1, 0x75, 0x13, 0x6d, 0xfb, 0x12, 0x0,  0x8,  0x90, 0x8c, 0x23, 0x3b, 0x1e, 0x9a, 0xea, 0xe7, 0x9,  0x0,
      0xf,  0x55, 0x67, 0xe4, 0xa8, 0x15, 0x60, 0x1e, 0x7b, 0x9d, 0x4f, 0x98, 0x35, 0x9d, 0x29, 0xed, 0x27, 0x0,  0x0,
      0x2f, 0x46, 0x25, 0xd6, 0x27, 0x0,  0x0,  0x60, 0x7,  0x22, 0x2a, 0xf5, 0x25, 0xf9, 0x13, 0x14, 0xfb, 0x26, 0x0,
      0x12, 0x79, 0x52, 0x6,  0x31, 0xe4, 0x63, 0x91, 0x8b, 0x53, 0xe,  0x2d, 0xa1, 0xef, 0xaa, 0xd7, 0xfc, 0xa5, 0xfe,
      0x0,  0x12, 0x61, 0xc5, 0x88, 0xe0, 0x9e, 0x1b, 0x0,  0xed, 0x39, 0x8b, 0x9d, 0x6c, 0x1d, 0xc,  0xc,  0x39, 0xe,
      0x36, 0x25, 0x25, 0x2a, 0x8,  0x19, 0xa1, 0x1,  0xc0, 0x18, 0x0,  0x0,  0x37, 0x17, 0x2,  0x0,  0x0,  0xd,  0xd8,
      0x1,  0xa6, 0x13, 0x6,  0x2e, 0x2,  0xa2, 0x83, 0x8f, 0x2,  0xa2, 0x2,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3799);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0xA2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
}

// SubscribeResponse 15314 [Left SubErrUnspecifiedError,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError] [PropServerKeepAlive 8169,PropAssignedClientIdentifier
// "\158\DC2x\SUB\168\174\218",PropMessageExpiryInterval 31274]
TEST(SubACK5QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x18, 0x3b, 0xd2, 0x12, 0x13, 0x1f, 0xe9, 0x12, 0x0,  0x7,  0x9e, 0x12,
                   0x78, 0x1a, 0xa8, 0xae, 0xda, 0x2,  0x0,  0x0,  0x7a, 0x2a, 0x80, 0x8f, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15314);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x8F);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
}

// SubscribeResponse 19515 [Left SubErrNotAuthorized,Right QoS1,Right QoS2,Left SubErrPacketIdentifierInUse,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS0,Left SubErrUnspecifiedError,Left
// SubErrSubscriptionIdentifiersNotSupported] [PropResponseTopic
// "\237\247`\NAK$\145\201\234*\STX\SYN\132d\ETX\EOT\DC2\236J\146\150\173\ENQX\ETX\219\170",PropRequestProblemInformation
// 238,PropRequestProblemInformation 125,PropResponseTopic "[L\137:RM\218\156C\172O!v\205",PropSessionExpiryInterval
// 3981,PropMessageExpiryInterval 2864,PropSharedSubscriptionAvailable 238,PropRequestProblemInformation
// 69,PropRetainAvailable 199,PropWildcardSubscriptionAvailable 7,PropMessageExpiryInterval 1188,PropMaximumQoS
// 57,PropRequestProblemInformation 236,PropWillDelayInterval 7491,PropAssignedClientIdentifier
// "r\250\136\152B&\204\241/0U\bs\216\ESCVG\217\255",PropResponseInformation
// "\133\184\225\145\135\217]FK\203\f\DC3\187\139l\173\184"]
TEST(SubACK5QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0x88, 0x1,  0x4c, 0x3b, 0x7c, 0x8,  0x0,  0x1a, 0xed, 0xf7, 0x60, 0x15, 0x24, 0x91, 0xc9,
                   0xea, 0x2a, 0x2,  0x16, 0x84, 0x64, 0x3,  0x4,  0x12, 0xec, 0x4a, 0x92, 0x96, 0xad, 0x5,  0x58,
                   0x3,  0xdb, 0xaa, 0x17, 0xee, 0x17, 0x7d, 0x8,  0x0,  0xe,  0x5b, 0x4c, 0x89, 0x3a, 0x52, 0x4d,
                   0xda, 0x9c, 0x43, 0xac, 0x4f, 0x21, 0x76, 0xcd, 0x11, 0x0,  0x0,  0xf,  0x8d, 0x2,  0x0,  0x0,
                   0xb,  0x30, 0x2a, 0xee, 0x17, 0x45, 0x25, 0xc7, 0x28, 0x7,  0x2,  0x0,  0x0,  0x4,  0xa4, 0x24,
                   0x39, 0x17, 0xec, 0x18, 0x0,  0x0,  0x1d, 0x43, 0x12, 0x0,  0x13, 0x72, 0xfa, 0x88, 0x98, 0x42,
                   0x26, 0xcc, 0xf1, 0x2f, 0x30, 0x55, 0x8,  0x73, 0xd8, 0x1b, 0x56, 0x47, 0xd9, 0xff, 0x1a, 0x0,
                   0x11, 0x85, 0xb8, 0xe1, 0x91, 0x87, 0xd9, 0x5d, 0x46, 0x4b, 0xcb, 0xc,  0x13, 0xbb, 0x8b, 0x6c,
                   0xad, 0xb8, 0x87, 0x1,  0x2,  0x91, 0x9e, 0x80, 0x0,  0x80, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19515);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x91);
  EXPECT_EQ(granted_qos_levels[4], 0x9E);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0xA1);
}

// SubscribeResponse 14835 [Right QoS2,Right QoS2,Right QoS1,Left SubErrUnspecifiedError,Left
// SubErrImplementationSpecificError,Left SubErrNotAuthorized,Right QoS2] [PropCorrelationData
// "\188\STXP\176*.\244\176`\198\DC1l=Ra\251\226\231",PropMaximumPacketSize 9578,PropTopicAlias
// 26389,PropAuthenticationData "*\184\157",PropMessageExpiryInterval 13687,PropSubscriptionIdentifierAvailable
// 195,PropRequestProblemInformation 144,PropSessionExpiryInterval 25484,PropReasonString "}\221_\211-",PropContentType
// "}r\DC4#\ENQ\233\200\n\152(\173z|\STX\154!2/\RS\241",PropResponseInformation
// "\253\172R\ENQ\185\232WI\DEL\146\172\165{\209\DC4\DC4\135}\NUL}\157{\222\f",PropRequestResponseInformation
// 253,PropMessageExpiryInterval 20061,PropMessageExpiryInterval 26031,PropRequestResponseInformation
// 28,PropUserProperty "\247\&6\144b\177\157\141\161|\GSR\161F\229Jd\233p\DC1>N\206Nx\248)\249\ESC9"
// "W*L\132%]d\SI\FS\153\NAK\214\147g",PropUserProperty
// "\238\143\244q\176E\235\132\156\206\ENQ\235\DC2\184\134S\144Jo\SOc\151OL["
// "V\223H\156\252ak4\150\212^1\169'\230\196\n6n\166",PropRequestResponseInformation 233,PropMaximumPacketSize
// 3867,PropRequestProblemInformation 24,PropRetainAvailable 135,PropSessionExpiryInterval
// 21423,PropAuthenticationMethod "",PropMessageExpiryInterval 29400,PropAuthenticationData
// "cM\159g#x\244r\t\211Z\245\132\178\145?\217mPV\194\t\179\148\r",PropUserProperty ")\by"
// "j\201V\169\237ipN",PropMaximumPacketSize 31853,PropSharedSubscriptionAvailable
// 54,PropSubscriptionIdentifierAvailable 164]
TEST(SubACK5QCTest, Decode27) {
  uint8_t pkt[] = {
      0x90, 0xb3, 0x2,  0x39, 0xf3, 0xa8, 0x2,  0x9,  0x0,  0x12, 0xbc, 0x2,  0x50, 0xb0, 0x2a, 0x2e, 0xf4, 0xb0, 0x60,
      0xc6, 0x11, 0x6c, 0x3d, 0x52, 0x61, 0xfb, 0xe2, 0xe7, 0x27, 0x0,  0x0,  0x25, 0x6a, 0x23, 0x67, 0x15, 0x16, 0x0,
      0x3,  0x2a, 0xb8, 0x9d, 0x2,  0x0,  0x0,  0x35, 0x77, 0x29, 0xc3, 0x17, 0x90, 0x11, 0x0,  0x0,  0x63, 0x8c, 0x1f,
      0x0,  0x5,  0x7d, 0xdd, 0x5f, 0xd3, 0x2d, 0x3,  0x0,  0x14, 0x7d, 0x72, 0x14, 0x23, 0x5,  0xe9, 0xc8, 0xa,  0x98,
      0x28, 0xad, 0x7a, 0x7c, 0x2,  0x9a, 0x21, 0x32, 0x2f, 0x1e, 0xf1, 0x1a, 0x0,  0x18, 0xfd, 0xac, 0x52, 0x5,  0xb9,
      0xe8, 0x57, 0x49, 0x7f, 0x92, 0xac, 0xa5, 0x7b, 0xd1, 0x14, 0x14, 0x87, 0x7d, 0x0,  0x7d, 0x9d, 0x7b, 0xde, 0xc,
      0x19, 0xfd, 0x2,  0x0,  0x0,  0x4e, 0x5d, 0x2,  0x0,  0x0,  0x65, 0xaf, 0x19, 0x1c, 0x26, 0x0,  0x1d, 0xf7, 0x36,
      0x90, 0x62, 0xb1, 0x9d, 0x8d, 0xa1, 0x7c, 0x1d, 0x52, 0xa1, 0x46, 0xe5, 0x4a, 0x64, 0xe9, 0x70, 0x11, 0x3e, 0x4e,
      0xce, 0x4e, 0x78, 0xf8, 0x29, 0xf9, 0x1b, 0x39, 0x0,  0xe,  0x57, 0x2a, 0x4c, 0x84, 0x25, 0x5d, 0x64, 0xf,  0x1c,
      0x99, 0x15, 0xd6, 0x93, 0x67, 0x26, 0x0,  0x19, 0xee, 0x8f, 0xf4, 0x71, 0xb0, 0x45, 0xeb, 0x84, 0x9c, 0xce, 0x5,
      0xeb, 0x12, 0xb8, 0x86, 0x53, 0x90, 0x4a, 0x6f, 0xe,  0x63, 0x97, 0x4f, 0x4c, 0x5b, 0x0,  0x14, 0x56, 0xdf, 0x48,
      0x9c, 0xfc, 0x61, 0x6b, 0x34, 0x96, 0xd4, 0x5e, 0x31, 0xa9, 0x27, 0xe6, 0xc4, 0xa,  0x36, 0x6e, 0xa6, 0x19, 0xe9,
      0x27, 0x0,  0x0,  0xf,  0x1b, 0x17, 0x18, 0x25, 0x87, 0x11, 0x0,  0x0,  0x53, 0xaf, 0x15, 0x0,  0x0,  0x2,  0x0,
      0x0,  0x72, 0xd8, 0x16, 0x0,  0x19, 0x63, 0x4d, 0x9f, 0x67, 0x23, 0x78, 0xf4, 0x72, 0x9,  0xd3, 0x5a, 0xf5, 0x84,
      0xb2, 0x91, 0x3f, 0xd9, 0x6d, 0x50, 0x56, 0xc2, 0x9,  0xb3, 0x94, 0xd,  0x26, 0x0,  0x3,  0x29, 0x8,  0x79, 0x0,
      0x8,  0x6a, 0xc9, 0x56, 0xa9, 0xed, 0x69, 0x70, 0x4e, 0x27, 0x0,  0x0,  0x7c, 0x6d, 0x2a, 0x36, 0x29, 0xa4, 0x2,
      0x2,  0x1,  0x80, 0x83, 0x87, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14835);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x83);
  EXPECT_EQ(granted_qos_levels[5], 0x87);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
}

// SubscribeResponse 3036 [Right QoS0,Left SubErrNotAuthorized,Left SubErrImplementationSpecificError]
// [PropReceiveMaximum 25407,PropAuthenticationData
// "\224\236\221\b-K\221a\233\161,\229\f\228w5\176/\225\150\233C\245\178\ACK:\233\143\GS",PropResponseInformation
// "\136]j\GS\228*\181\236{\ACKbPk\166\243\218\131\\\nK.\SI\\\ENQc\145j%\232s",PropPayloadFormatIndicator
// 134,PropRetainAvailable 110,PropCorrelationData
// "\133T8\227~M+#|\156\164C\216\157\189\175\202@\160",PropCorrelationData
// "\182\244\248Gq\173b\226\180n\134\130\205QWY\133\226N\201\US\t\187\173\253~\187q\206"]
TEST(SubACK5QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x84, 0x1,  0xb,  0xdc, 0x7e, 0x21, 0x63, 0x3f, 0x16, 0x0,  0x1d, 0xe0, 0xec, 0xdd, 0x8,  0x2d,
                   0x4b, 0xdd, 0x61, 0xe9, 0xa1, 0x2c, 0xe5, 0xc,  0xe4, 0x77, 0x35, 0xb0, 0x2f, 0xe1, 0x96, 0xe9, 0x43,
                   0xf5, 0xb2, 0x6,  0x3a, 0xe9, 0x8f, 0x1d, 0x1a, 0x0,  0x1e, 0x88, 0x5d, 0x6a, 0x1d, 0xe4, 0x2a, 0xb5,
                   0xec, 0x7b, 0x6,  0x62, 0x50, 0x6b, 0xa6, 0xf3, 0xda, 0x83, 0x5c, 0xa,  0x4b, 0x2e, 0xf,  0x5c, 0x5,
                   0x63, 0x91, 0x6a, 0x25, 0xe8, 0x73, 0x1,  0x86, 0x25, 0x6e, 0x9,  0x0,  0x13, 0x85, 0x54, 0x38, 0xe3,
                   0x7e, 0x4d, 0x2b, 0x23, 0x7c, 0x9c, 0xa4, 0x43, 0xd8, 0x9d, 0xbd, 0xaf, 0xca, 0x40, 0xa0, 0x9,  0x0,
                   0x1d, 0xb6, 0xf4, 0xf8, 0x47, 0x71, 0xad, 0x62, 0xe2, 0xb4, 0x6e, 0x86, 0x82, 0xcd, 0x51, 0x57, 0x59,
                   0x85, 0xe2, 0x4e, 0xc9, 0x1f, 0x9,  0xbb, 0xad, 0xfd, 0x7e, 0xbb, 0x71, 0xce, 0x0,  0x87, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3036);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x87);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
}

// SubscribeResponse 8613 [Right QoS2] [PropResponseInformation "\a",PropMaximumQoS
// 233,PropWildcardSubscriptionAvailable 130]
TEST(SubACK5QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0xc, 0x21, 0xa5, 0x8, 0x1a, 0x0, 0x1, 0x7, 0x24, 0xe9, 0x28, 0x82, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8613);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
}

// SubscribeResponse 14512 [Left SubErrSharedSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrQuotaExceeded] [PropSharedSubscriptionAvailable 210]
TEST(SubACK5QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0xa, 0x38, 0xb0, 0x2, 0x2a, 0xd2, 0x9e, 0x91, 0x1, 0xa2, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14512);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
}
