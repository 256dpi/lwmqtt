#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "W\217\244\199\US\166I\171\225H\165\&0\148+>'\185\243\243\254\182\&3\158\130", _pubPktID = 5484, _pubBody =
// "N\151Gu\207\213\209\175\151\241[\RS\128P\129\237\157\250K", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x3b, 0x2f, 0x0,  0x18, 0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48, 0xa5, 0x30, 0x94,
                   0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82, 0x15, 0x6c, 0x4e, 0x97, 0x47, 0x75,
                   0xcf, 0xd5, 0xd1, 0xaf, 0x97, 0xf1, 0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  uint8_t topic_bytes[] = {0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48, 0xa5, 0x30,
                           0x94, 0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4e, 0x97, 0x47, 0x75, 0xcf, 0xd5, 0xd1, 0xaf, 0x97, 0xf1,
                         0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5484, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "W\217\244\199\US\166I\171\225H\165\&0\148+>'\185\243\243\254\182\&3\158\130", _pubPktID = 5484, _pubBody =
// "N\151Gu\207\213\209\175\151\241[\RS\128P\129\237\157\250K", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x3b, 0x2f, 0x0,  0x18, 0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48, 0xa5, 0x30, 0x94,
                   0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82, 0x15, 0x6c, 0x4e, 0x97, 0x47, 0x75,
                   0xcf, 0xd5, 0xd1, 0xaf, 0x97, 0xf1, 0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48, 0xa5, 0x30,
                               0x94, 0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4e, 0x97, 0x47, 0x75, 0xcf, 0xd5, 0xd1, 0xaf, 0x97, 0xf1,
                              0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 5484);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\164_xCoe\161\\\SYN8\247~X\178U\EOT\201\239d\NUL\v\219\239", _pubPktID = 617, _pubBody =
// "\203\"\151M\221\179{\230\DC3c\185\FS\183-\225\169\214\ETX\128\159\170E\186\239\ESC\153\192\142", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x3b, 0x37, 0x0,  0x17, 0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7,
                   0x7e, 0x58, 0xb2, 0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef, 0x2,  0x69, 0xcb,
                   0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9, 0x1c, 0xb7, 0x2d, 0xe1, 0xa9,
                   0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  uint8_t topic_bytes[] = {0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7, 0x7e,
                           0x58, 0xb2, 0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcb, 0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9, 0x1c, 0xb7, 0x2d,
                         0xe1, 0xa9, 0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 617, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\164_xCoe\161\\\SYN8\247~X\178U\EOT\201\239d\NUL\v\219\239", _pubPktID = 617, _pubBody =
// "\203\"\151M\221\179{\230\DC3c\185\FS\183-\225\169\214\ETX\128\159\170E\186\239\ESC\153\192\142", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x3b, 0x37, 0x0,  0x17, 0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7,
                   0x7e, 0x58, 0xb2, 0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef, 0x2,  0x69, 0xcb,
                   0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9, 0x1c, 0xb7, 0x2d, 0xe1, 0xa9,
                   0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7, 0x7e,
                               0x58, 0xb2, 0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcb, 0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9, 0x1c, 0xb7, 0x2d,
                              0xe1, 0xa9, 0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 617);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "]\DEL\239p\251\205\214zi\204\179\194Y\158", _pubPktID = 0, _pubBody =
// "|\207v\144\230\175\FSN\178\165\215\DC3\EM\250\162\187\135\181", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x39, 0x22, 0x0,  0xe,  0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a,
                   0x69, 0xcc, 0xb3, 0xc2, 0x59, 0x9e, 0x7c, 0xcf, 0x76, 0x90, 0xe6, 0xaf,
                   0x1c, 0x4e, 0xb2, 0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  uint8_t topic_bytes[] = {0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a, 0x69, 0xcc, 0xb3, 0xc2, 0x59, 0x9e};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7c, 0xcf, 0x76, 0x90, 0xe6, 0xaf, 0x1c, 0x4e, 0xb2,
                         0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "]\DEL\239p\251\205\214zi\204\179\194Y\158", _pubPktID = 0, _pubBody =
// "|\207v\144\230\175\FSN\178\165\215\DC3\EM\250\162\187\135\181", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x39, 0x22, 0x0,  0xe,  0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a,
                   0x69, 0xcc, 0xb3, 0xc2, 0x59, 0x9e, 0x7c, 0xcf, 0x76, 0x90, 0xe6, 0xaf,
                   0x1c, 0x4e, 0xb2, 0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a, 0x69, 0xcc, 0xb3, 0xc2, 0x59, 0x9e};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7c, 0xcf, 0x76, 0x90, 0xe6, 0xaf, 0x1c, 0x4e, 0xb2,
                              0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\&8\RSE", _pubPktID = 14265,
// _pubBody = "OtS\167", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x3d, 0xc, 0x0, 0x4, 0xff, 0x38, 0x1e, 0x45, 0x37, 0xb9, 0x4f, 0x74, 0x53, 0xa7};
  uint8_t topic_bytes[] = {0xff, 0x38, 0x1e, 0x45};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4f, 0x74, 0x53, 0xa7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 14265, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\&8\RSE", _pubPktID = 14265,
// _pubBody = "OtS\167", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x3d, 0xc, 0x0, 0x4, 0xff, 0x38, 0x1e, 0x45, 0x37, 0xb9, 0x4f, 0x74, 0x53, 0xa7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xff, 0x38, 0x1e, 0x45};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4f, 0x74, 0x53, 0xa7};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14265);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\175\137\vj?Vv\214\&1|l\a\RS\191\237\148\187\223g^\158f\195W\245R\159", _pubPktID = 0, _pubBody =
// "\133\170\157HgVe\197\170\203V\231", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x39, 0x29, 0x0,  0x1b, 0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c,
                   0x7,  0x1e, 0xbf, 0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52,
                   0x9f, 0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  uint8_t topic_bytes[] = {0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c, 0x7,  0x1e, 0xbf,
                           0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52, 0x9f};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\175\137\vj?Vv\214\&1|l\a\RS\191\237\148\187\223g^\158f\195W\245R\159", _pubPktID = 0, _pubBody =
// "\133\170\157HgVe\197\170\203V\231", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x39, 0x29, 0x0,  0x1b, 0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c,
                   0x7,  0x1e, 0xbf, 0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52,
                   0x9f, 0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c, 0x7,  0x1e, 0xbf,
                               0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52, 0x9f};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\fn)\RS", _pubPktID = 5499, _pubBody
// = "\156I\SUB\231\236b\ENQ\137\237\r\NAK:[\222g\135", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x3a, 0x18, 0x0,  0x4, 0xc,  0x6e, 0x29, 0x1e, 0x15, 0x7b, 0x9c, 0x49, 0x1a,
                   0xe7, 0xec, 0x62, 0x5, 0x89, 0xed, 0xd,  0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  uint8_t topic_bytes[] = {0xc, 0x6e, 0x29, 0x1e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9c, 0x49, 0x1a, 0xe7, 0xec, 0x62, 0x5, 0x89, 0xed, 0xd, 0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 5499, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\fn)\RS", _pubPktID = 5499, _pubBody
// = "\156I\SUB\231\236b\ENQ\137\237\r\NAK:[\222g\135", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x3a, 0x18, 0x0,  0x4, 0xc,  0x6e, 0x29, 0x1e, 0x15, 0x7b, 0x9c, 0x49, 0x1a,
                   0xe7, 0xec, 0x62, 0x5, 0x89, 0xed, 0xd,  0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc, 0x6e, 0x29, 0x1e};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9c, 0x49, 0x1a, 0xe7, 0xec, 0x62, 0x5,  0x89,
                              0xed, 0xd,  0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5499);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\213\v\236\218d\193\162h[\237\155\196\145\159\198g\146\138\155\197\164", _pubPktID = 0, _pubBody =
// "\189\233\193\r`$@\171\DC1\230\203j\203\187J\148oG\177\155\SUB\253\232\211\t\DC4#\230", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x38, 0x33, 0x0,  0x15, 0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed,
                   0x9b, 0xc4, 0x91, 0x9f, 0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4, 0xbd, 0xe9, 0xc1,
                   0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb, 0x4a, 0x94, 0x6f,
                   0x47, 0xb1, 0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  uint8_t topic_bytes[] = {0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed, 0x9b,
                           0xc4, 0x91, 0x9f, 0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbd, 0xe9, 0xc1, 0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb,
                         0x4a, 0x94, 0x6f, 0x47, 0xb1, 0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\213\v\236\218d\193\162h[\237\155\196\145\159\198g\146\138\155\197\164", _pubPktID = 0, _pubBody =
// "\189\233\193\r`$@\171\DC1\230\203j\203\187J\148oG\177\155\SUB\253\232\211\t\DC4#\230", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x38, 0x33, 0x0,  0x15, 0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed,
                   0x9b, 0xc4, 0x91, 0x9f, 0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4, 0xbd, 0xe9, 0xc1,
                   0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb, 0x4a, 0x94, 0x6f,
                   0x47, 0xb1, 0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed, 0x9b,
                               0xc4, 0x91, 0x9f, 0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbd, 0xe9, 0xc1, 0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb,
                              0x4a, 0x94, 0x6f, 0x47, 0xb1, 0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "=\249\252\228\210\187\154\150C8*\146,\US8\152\128\152", _pubPktID = 8421, _pubBody =
// "4O\FS\186T\238#\USg\NULl\152\154\239\249\SUB2>H#\188", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x32, 0x2b, 0x0,  0x12, 0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43, 0x38, 0x2a,
                   0x92, 0x2c, 0x1f, 0x38, 0x98, 0x80, 0x98, 0x20, 0xe5, 0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee,
                   0x23, 0x1f, 0x67, 0x0,  0x6c, 0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e, 0x48, 0x23, 0xbc};
  uint8_t topic_bytes[] = {0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43,
                           0x38, 0x2a, 0x92, 0x2c, 0x1f, 0x38, 0x98, 0x80, 0x98};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee, 0x23, 0x1f, 0x67, 0x0, 0x6c,
                         0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e, 0x48, 0x23, 0xbc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 8421, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "=\249\252\228\210\187\154\150C8*\146,\US8\152\128\152", _pubPktID = 8421, _pubBody =
// "4O\FS\186T\238#\USg\NULl\152\154\239\249\SUB2>H#\188", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x32, 0x2b, 0x0,  0x12, 0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43, 0x38, 0x2a,
                   0x92, 0x2c, 0x1f, 0x38, 0x98, 0x80, 0x98, 0x20, 0xe5, 0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee,
                   0x23, 0x1f, 0x67, 0x0,  0x6c, 0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e, 0x48, 0x23, 0xbc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43,
                               0x38, 0x2a, 0x92, 0x2c, 0x1f, 0x38, 0x98, 0x80, 0x98};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee, 0x23, 0x1f, 0x67, 0x0, 0x6c,
                              0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e, 0x48, 0x23, 0xbc};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8421);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\SO\191\141\159\DC1$vw", _pubPktID =
// 301, _pubBody = "`\195\&7\ESC_\216\219\237?~,\244", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x3b, 0x18, 0x0,  0x8,  0xe,  0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77, 0x1,
                   0x2d, 0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  uint8_t topic_bytes[] = {0xe, 0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 301, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\SO\191\141\159\DC1$vw", _pubPktID =
// 301, _pubBody = "`\195\&7\ESC_\216\219\237?~,\244", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x3b, 0x18, 0x0,  0x8,  0xe,  0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77, 0x1,
                   0x2d, 0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe, 0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 301);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\227=\STX\236\214\&2\250\EM@M^\ENQ\161\aE8", _pubPktID = 19635, _pubBody = "\EOT\EM", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x3b, 0x16, 0x0,  0x10, 0xe3, 0x3d, 0x2,  0xec, 0xd6, 0x32, 0xfa, 0x19,
                   0x40, 0x4d, 0x5e, 0x5,  0xa1, 0x7,  0x45, 0x38, 0x4c, 0xb3, 0x4,  0x19};
  uint8_t topic_bytes[] = {0xe3, 0x3d, 0x2, 0xec, 0xd6, 0x32, 0xfa, 0x19, 0x40, 0x4d, 0x5e, 0x5, 0xa1, 0x7, 0x45, 0x38};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4, 0x19};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 19635, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\227=\STX\236\214\&2\250\EM@M^\ENQ\161\aE8", _pubPktID = 19635, _pubBody = "\EOT\EM", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x3b, 0x16, 0x0,  0x10, 0xe3, 0x3d, 0x2,  0xec, 0xd6, 0x32, 0xfa, 0x19,
                   0x40, 0x4d, 0x5e, 0x5,  0xa1, 0x7,  0x45, 0x38, 0x4c, 0xb3, 0x4,  0x19};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe3, 0x3d, 0x2,  0xec, 0xd6, 0x32, 0xfa, 0x19,
                               0x40, 0x4d, 0x5e, 0x5,  0xa1, 0x7,  0x45, 0x38};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4, 0x19};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 19635);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207FX\fp\139\210\201Q\185\161i$\222\214\221\238\n.\134\157L7\178\&1", _pubPktID = 10816, _pubBody =
// "b[\173.*\158(\194-\180ZS\221\236\188\168\182\172p\192\216\246\196\176\200\248\&1\232a", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x34, 0x3a, 0x0,  0x19, 0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1,
                   0x69, 0x24, 0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31, 0x2a,
                   0x40, 0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec,
                   0xbc, 0xa8, 0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  uint8_t topic_bytes[] = {0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1, 0x69, 0x24,
                           0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec, 0xbc,
                         0xa8, 0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 10816, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207FX\fp\139\210\201Q\185\161i$\222\214\221\238\n.\134\157L7\178\&1", _pubPktID = 10816, _pubBody =
// "b[\173.*\158(\194-\180ZS\221\236\188\168\182\172p\192\216\246\196\176\200\248\&1\232a", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x34, 0x3a, 0x0,  0x19, 0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1,
                   0x69, 0x24, 0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31, 0x2a,
                   0x40, 0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec,
                   0xbc, 0xa8, 0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1, 0x69, 0x24,
                               0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec, 0xbc,
                              0xa8, 0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10816);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "C:\210I?H\140\153\163\FS\190\141PA\209Z6\210G=S\217\242\219S\237\226\a", _pubPktID = 780, _pubBody =
// "\185b.\FS\147|\157\223\176\240\ENQy\185\208\DC4\186<E\219\148\131\212\223\133\179\DC1\253\169", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x34, 0x3c, 0x0,  0x1c, 0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe, 0x8d,
                   0x50, 0x41, 0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed, 0xe2, 0x7,
                   0x3,  0xc,  0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9, 0xd0,
                   0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  uint8_t topic_bytes[] = {0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe, 0x8d, 0x50, 0x41,
                           0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed, 0xe2, 0x7};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9, 0xd0,
                         0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 780, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "C:\210I?H\140\153\163\FS\190\141PA\209Z6\210G=S\217\242\219S\237\226\a", _pubPktID = 780, _pubBody =
// "\185b.\FS\147|\157\223\176\240\ENQy\185\208\DC4\186<E\219\148\131\212\223\133\179\DC1\253\169", _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x34, 0x3c, 0x0,  0x1c, 0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe, 0x8d,
                   0x50, 0x41, 0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed, 0xe2, 0x7,
                   0x3,  0xc,  0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9, 0xd0,
                   0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe, 0x8d, 0x50, 0x41,
                               0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed, 0xe2, 0x7};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9, 0xd0,
                              0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 780);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "x\170\228C2\140C\ACKD\FS/[\214\EOT\SOH", _pubPktID = 0, _pubBody = "\185", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x31, 0x12, 0x0,  0xf,  0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c,
                   0x43, 0x6,  0x44, 0x1c, 0x2f, 0x5b, 0xd6, 0x4,  0x1,  0xb9};
  uint8_t topic_bytes[] = {0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c, 0x43, 0x6, 0x44, 0x1c, 0x2f, 0x5b, 0xd6, 0x4, 0x1};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "x\170\228C2\140C\ACKD\FS/[\214\EOT\SOH", _pubPktID = 0, _pubBody = "\185", _pubProps = []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x31, 0x12, 0x0,  0xf,  0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c,
                   0x43, 0x6,  0x44, 0x1c, 0x2f, 0x5b, 0xd6, 0x4,  0x1,  0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c, 0x43, 0x6, 0x44, 0x1c, 0x2f, 0x5b, 0xd6, 0x4, 0x1};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb9};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\EM\181N`\v\241\NAKi\133lU\172
// ~\192\152\DLE2\173\193\158\SOH\252\&8/.\RS", _pubPktID = 21275, _pubBody = "'\189s+\222o/\187^\161", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x32, 0x29, 0x0,  0x1b, 0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55,
                   0xac, 0x20, 0x7e, 0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e,
                   0x1e, 0x53, 0x1b, 0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  uint8_t topic_bytes[] = {0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55, 0xac, 0x20, 0x7e,
                           0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e, 0x1e};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 21275, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\EM\181N`\v\241\NAKi\133lU\172
// ~\192\152\DLE2\173\193\158\SOH\252\&8/.\RS", _pubPktID = 21275, _pubBody = "'\189s+\222o/\187^\161", _pubProps = []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x32, 0x29, 0x0,  0x1b, 0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55,
                   0xac, 0x20, 0x7e, 0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e,
                   0x1e, 0x53, 0x1b, 0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55, 0xac, 0x20, 0x7e,
                               0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e, 0x1e};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 21275);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\176\EMg\233", _pubPktID = 31111,
// _pubBody = "e\163\181)\SYN\133\198/d\225\216\252\177\&5v[\251\&3\219\232\135\&2\251>E\155#\DLE\254", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x34, 0x25, 0x0,  0x4,  0xb0, 0x19, 0x67, 0xe9, 0x79, 0x87, 0x65, 0xa3, 0xb5,
                   0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76, 0x5b,
                   0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  uint8_t topic_bytes[] = {0xb0, 0x19, 0x67, 0xe9};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x65, 0xa3, 0xb5, 0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76,
                         0x5b, 0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 31111, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\176\EMg\233", _pubPktID = 31111,
// _pubBody = "e\163\181)\SYN\133\198/d\225\216\252\177\&5v[\251\&3\219\232\135\&2\251>E\155#\DLE\254", _pubProps = []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x34, 0x25, 0x0,  0x4,  0xb0, 0x19, 0x67, 0xe9, 0x79, 0x87, 0x65, 0xa3, 0xb5,
                   0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76, 0x5b,
                   0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb0, 0x19, 0x67, 0xe9};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x65, 0xa3, 0xb5, 0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76,
                              0x5b, 0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31111);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\169\&0\211V\249\144\&4+[\166\254\135\144\241\n\198\162\233\181\161i\132\132\ENQ\204\191", _pubPktID = 8952,
// _pubBody = "\173A\231|1\170\255\146o\191\190\DC2+uY", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x3b, 0x2d, 0x0,  0x1a, 0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87,
                   0x90, 0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf, 0x22, 0xf8,
                   0xad, 0x41, 0xe7, 0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  uint8_t topic_bytes[] = {0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87, 0x90,
                           0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xad, 0x41, 0xe7, 0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 8952, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\169\&0\211V\249\144\&4+[\166\254\135\144\241\n\198\162\233\181\161i\132\132\ENQ\204\191", _pubPktID = 8952,
// _pubBody = "\173A\231|1\170\255\146o\191\190\DC2+uY", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x3b, 0x2d, 0x0,  0x1a, 0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87,
                   0x90, 0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf, 0x22, 0xf8,
                   0xad, 0x41, 0xe7, 0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87, 0x90,
                               0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xad, 0x41, 0xe7, 0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8952);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192!\207\251\220\139\197\DC3\237\227", _pubPktID = 0, _pubBody =
// "\245Ha\212\EM\NAK\214Qf\253*\177\142\202P\176\144\184\149N\DC4", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0xa,  0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13,
                   0xed, 0xe3, 0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd,
                   0x2a, 0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  uint8_t topic_bytes[] = {0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13, 0xed, 0xe3};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd, 0x2a,
                         0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192!\207\251\220\139\197\DC3\237\227", _pubPktID = 0, _pubBody =
// "\245Ha\212\EM\NAK\214Qf\253*\177\142\202P\176\144\184\149N\DC4", _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0xa,  0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13,
                   0xed, 0xe3, 0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd,
                   0x2a, 0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13, 0xed, 0xe3};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd, 0x2a,
                              0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\244\163\195\181~\198`:\150F\212N",
// _pubPktID = 32625, _pubBody =
// "\158m\139\172\171\135\&7\154\136\129\210{\228\197\SI[\STXw\192\242\239k\178\152Q\211\143S\146", _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x33, 0x2d, 0x0,  0xc,  0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e,
                   0x7f, 0x71, 0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5,
                   0xf,  0x5b, 0x2,  0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  uint8_t topic_bytes[] = {0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5, 0xf,
                         0x5b, 0x2,  0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 32625, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\244\163\195\181~\198`:\150F\212N",
// _pubPktID = 32625, _pubBody =
// "\158m\139\172\171\135\&7\154\136\129\210{\228\197\SI[\STXw\192\242\239k\178\152Q\211\143S\146", _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x33, 0x2d, 0x0,  0xc,  0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e,
                   0x7f, 0x71, 0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5,
                   0xf,  0x5b, 0x2,  0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5, 0xf,
                              0x5b, 0x2,  0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 32625);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\\\v`\145\USn?\217L\147\211\\\SI\254", _pubPktID = 25006, _pubBody =
// "\207\181\171\145\132\166r/\NUL\137\195|e\244P\185", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x33, 0x23, 0x0,  0xf,  0x9c, 0x5c, 0xb,  0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9,
                   0x4c, 0x93, 0xd3, 0x5c, 0xf,  0xfe, 0x61, 0xae, 0xcf, 0xb5, 0xab, 0x91, 0x84,
                   0xa6, 0x72, 0x2f, 0x0,  0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  uint8_t topic_bytes[] = {0x9c, 0x5c, 0xb, 0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9, 0x4c, 0x93, 0xd3, 0x5c, 0xf, 0xfe};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcf, 0xb5, 0xab, 0x91, 0x84, 0xa6, 0x72, 0x2f, 0x0, 0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 25006, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\\\v`\145\USn?\217L\147\211\\\SI\254", _pubPktID = 25006, _pubBody =
// "\207\181\171\145\132\166r/\NUL\137\195|e\244P\185", _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x33, 0x23, 0x0,  0xf,  0x9c, 0x5c, 0xb,  0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9,
                   0x4c, 0x93, 0xd3, 0x5c, 0xf,  0xfe, 0x61, 0xae, 0xcf, 0xb5, 0xab, 0x91, 0x84,
                   0xa6, 0x72, 0x2f, 0x0,  0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0x5c, 0xb, 0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9, 0x4c, 0x93, 0xd3, 0x5c, 0xf, 0xfe};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcf, 0xb5, 0xab, 0x91, 0x84, 0xa6, 0x72, 0x2f,
                              0x0,  0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25006);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\239p\183", _pubPktID = 0, _pubBody
// = "\STX\249\&8\215\vJ\163\136\174\235\187\163\ESCJ(\246", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x31, 0x15, 0x0,  0x3,  0xef, 0x70, 0xb7, 0x2,  0xf9, 0x38, 0xd7, 0xb,
                   0x4a, 0xa3, 0x88, 0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  uint8_t topic_bytes[] = {0xef, 0x70, 0xb7};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2, 0xf9, 0x38, 0xd7, 0xb, 0x4a, 0xa3, 0x88, 0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\239p\183", _pubPktID = 0, _pubBody
// = "\STX\249\&8\215\vJ\163\136\174\235\187\163\ESCJ(\246", _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x31, 0x15, 0x0,  0x3,  0xef, 0x70, 0xb7, 0x2,  0xf9, 0x38, 0xd7, 0xb,
                   0x4a, 0xa3, 0x88, 0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xef, 0x70, 0xb7};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2,  0xf9, 0x38, 0xd7, 0xb,  0x4a, 0xa3, 0x88,
                              0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[\133\227z\244\DC4
// \\\241\207F|\141\128?F\t\249\DC2\DELs\245", _pubPktID = 23725, _pubBody = ";\229\241\239\169\193\152\160\149\FSQ",
// _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x33, 0x25, 0x0,  0x16, 0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1,
                   0xcf, 0x46, 0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5,
                   0x5c, 0xad, 0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  uint8_t topic_bytes[] = {0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1, 0xcf, 0x46,
                           0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 23725, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[\133\227z\244\DC4
// \\\241\207F|\141\128?F\t\249\DC2\DELs\245", _pubPktID = 23725, _pubBody = ";\229\241\239\169\193\152\160\149\FSQ",
// _pubProps = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x33, 0x25, 0x0,  0x16, 0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1,
                   0xcf, 0x46, 0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5,
                   0x5c, 0xad, 0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1, 0xcf, 0x46,
                               0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 23725);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "D\SO\EOTH\207S\243\176T\n\246\234'~^\ETBtz\220X", _pubPktID = 0, _pubBody =
// "\179>\ENQUu\215k\216\ETX\201m\DC2\251\&2\ETB\187m\200\248\140{\n8", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x31, 0x2d, 0x0,  0x14, 0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,  0xf6, 0xea,
                   0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58, 0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b, 0xd8,
                   0x3,  0xc9, 0x6d, 0x12, 0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  uint8_t topic_bytes[] = {0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,
                           0xf6, 0xea, 0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b, 0xd8, 0x3,  0xc9, 0x6d, 0x12,
                         0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "D\SO\EOTH\207S\243\176T\n\246\234'~^\ETBtz\220X", _pubPktID = 0, _pubBody =
// "\179>\ENQUu\215k\216\ETX\201m\DC2\251\&2\ETB\187m\200\248\140{\n8", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x31, 0x2d, 0x0,  0x14, 0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,  0xf6, 0xea,
                   0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58, 0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b, 0xd8,
                   0x3,  0xc9, 0x6d, 0x12, 0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,
                               0xf6, 0xea, 0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b, 0xd8, 0x3,  0xc9, 0x6d, 0x12,
                              0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\144*)\STX\195\&3\195\193\213~9\191FW\136R", _pubPktID = 0, _pubBody = "\155U0$\ENQ\134dV\214\ts.+\ETX\143",
// _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x39, 0x22, 0x0,  0x11, 0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3,
                   0xc1, 0xd5, 0x7e, 0x39, 0xbf, 0x46, 0x57, 0x88, 0x52, 0x9b, 0x55, 0x30,
                   0x24, 0x5,  0x86, 0x64, 0x56, 0xd6, 0x9,  0x73, 0x2e, 0x2b, 0x3,  0x8f};
  uint8_t topic_bytes[] = {0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3, 0xc1,
                           0xd5, 0x7e, 0x39, 0xbf, 0x46, 0x57, 0x88, 0x52};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x55, 0x30, 0x24, 0x5, 0x86, 0x64, 0x56, 0xd6, 0x9, 0x73, 0x2e, 0x2b, 0x3, 0x8f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\144*)\STX\195\&3\195\193\213~9\191FW\136R", _pubPktID = 0, _pubBody = "\155U0$\ENQ\134dV\214\ts.+\ETX\143",
// _pubProps = []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x39, 0x22, 0x0,  0x11, 0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3,
                   0xc1, 0xd5, 0x7e, 0x39, 0xbf, 0x46, 0x57, 0x88, 0x52, 0x9b, 0x55, 0x30,
                   0x24, 0x5,  0x86, 0x64, 0x56, 0xd6, 0x9,  0x73, 0x2e, 0x2b, 0x3,  0x8f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3, 0xc1,
                               0xd5, 0x7e, 0x39, 0xbf, 0x46, 0x57, 0x88, 0x52};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x55, 0x30, 0x24, 0x5, 0x86, 0x64, 0x56, 0xd6, 0x9, 0x73, 0x2e, 0x2b, 0x3, 0x8f};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "G\195\186\214\239K
// \\\226\162\\\"\182", _pubPktID = 3720, _pubBody =
// "\SYN\172\191'(v\"S#\253\175\191\180\243%y\205\195\143\140\247\239\228\\", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x33, 0x29, 0x0,  0xd,  0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c,
                   0x22, 0xb6, 0xe,  0x88, 0x16, 0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf,
                   0xbf, 0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c, 0xf7, 0xef, 0xe4, 0x5c};
  uint8_t topic_bytes[] = {0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c, 0x22, 0xb6};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x16, 0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf, 0xbf,
                         0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c, 0xf7, 0xef, 0xe4, 0x5c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 3720, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "G\195\186\214\239K
// \\\226\162\\\"\182", _pubPktID = 3720, _pubBody =
// "\SYN\172\191'(v\"S#\253\175\191\180\243%y\205\195\143\140\247\239\228\\", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x33, 0x29, 0x0,  0xd,  0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c,
                   0x22, 0xb6, 0xe,  0x88, 0x16, 0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf,
                   0xbf, 0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c, 0xf7, 0xef, 0xe4, 0x5c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c, 0x22, 0xb6};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x16, 0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf, 0xbf,
                              0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c, 0xf7, 0xef, 0xe4, 0x5c};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 3720);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 9592, _pubBody =
// "\ETX\195\133\tbr,\140\146.tE\159\135\176\168{\162X\178Z", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x34, 0x19, 0x0,  0x0,  0x25, 0x78, 0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c,
                   0x92, 0x2e, 0x74, 0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c, 0x92, 0x2e, 0x74,
                         0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 9592, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 9592, _pubBody =
// "\ETX\195\133\tbr,\140\146.tE\159\135\176\168{\162X\178Z", _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x34, 0x19, 0x0,  0x0,  0x25, 0x78, 0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c,
                   0x92, 0x2e, 0x74, 0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c, 0x92, 0x2e, 0x74,
                              0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 9592);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "y\216", _pubPktID = 27633, _pubBody
// = "\t\219\155@MR", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x33, 0xc, 0x0, 0x2, 0x79, 0xd8, 0x6b, 0xf1, 0x9, 0xdb, 0x9b, 0x40, 0x4d, 0x52};
  uint8_t topic_bytes[] = {0x79, 0xd8};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9, 0xdb, 0x9b, 0x40, 0x4d, 0x52};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 27633, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "y\216", _pubPktID = 27633, _pubBody
// = "\t\219\155@MR", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x33, 0xc, 0x0, 0x2, 0x79, 0xd8, 0x6b, 0xf1, 0x9, 0xdb, 0x9b, 0x40, 0x4d, 0x52};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x79, 0xd8};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9, 0xdb, 0x9b, 0x40, 0x4d, 0x52};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 27633);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\253d\178]\206\DLE\163;", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x39, 0xa, 0x0, 0x0, 0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\253d\178]\206\DLE\163;", _pubProps = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x39, 0xa, 0x0, 0x0, 0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ";\204\SI\135:\SYN%u\222\217#\130\225N", _pubPktID = 14774, _pubBody = "\250v\SUB", _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x35, 0x15, 0x0,  0xe,  0x3b, 0xcc, 0xf,  0x87, 0x3a, 0x16, 0x25, 0x75,
                   0xde, 0xd9, 0x23, 0x82, 0xe1, 0x4e, 0x39, 0xb6, 0xfa, 0x76, 0x1a};
  uint8_t topic_bytes[] = {0x3b, 0xcc, 0xf, 0x87, 0x3a, 0x16, 0x25, 0x75, 0xde, 0xd9, 0x23, 0x82, 0xe1, 0x4e};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfa, 0x76, 0x1a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 14774, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ";\204\SI\135:\SYN%u\222\217#\130\225N", _pubPktID = 14774, _pubBody = "\250v\SUB", _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x35, 0x15, 0x0,  0xe,  0x3b, 0xcc, 0xf,  0x87, 0x3a, 0x16, 0x25, 0x75,
                   0xde, 0xd9, 0x23, 0x82, 0xe1, 0x4e, 0x39, 0xb6, 0xfa, 0x76, 0x1a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3b, 0xcc, 0xf, 0x87, 0x3a, 0x16, 0x25, 0x75, 0xde, 0xd9, 0x23, 0x82, 0xe1, 0x4e};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfa, 0x76, 0x1a};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14774);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "M\189d\165\NAK\165J\222\187)\216\178d^\194{\141\141y\145", _pubPktID = 0, _pubBody =
// "\245\129\188\154\242\232\161\228\255\&1lz\153\252~D\r\222\166\ENQ", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x30, 0x2a, 0x0,  0x14, 0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29, 0xd8,
                   0xb2, 0x64, 0x5e, 0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91, 0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8,
                   0xa1, 0xe4, 0xff, 0x31, 0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  uint8_t topic_bytes[] = {0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29,
                           0xd8, 0xb2, 0x64, 0x5e, 0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8, 0xa1, 0xe4, 0xff, 0x31,
                         0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "M\189d\165\NAK\165J\222\187)\216\178d^\194{\141\141y\145", _pubPktID = 0, _pubBody =
// "\245\129\188\154\242\232\161\228\255\&1lz\153\252~D\r\222\166\ENQ", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x30, 0x2a, 0x0,  0x14, 0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29, 0xd8,
                   0xb2, 0x64, 0x5e, 0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91, 0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8,
                   0xa1, 0xe4, 0xff, 0x31, 0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29,
                               0xd8, 0xb2, 0x64, 0x5e, 0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8, 0xa1, 0xe4, 0xff, 0x31,
                              0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "3V\138y.\181\&0", _pubPktID = 0,
// _pubBody = "2\248\176\206\GS<\197b\195`\241\aH", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x31, 0x16, 0x0,  0x7,  0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30, 0x32,
                   0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7,  0x48};
  uint8_t topic_bytes[] = {0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x32, 0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7, 0x48};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "3V\138y.\181\&0", _pubPktID = 0,
// _pubBody = "2\248\176\206\GS<\197b\195`\241\aH", _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x31, 0x16, 0x0,  0x7,  0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30, 0x32,
                   0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7,  0x48};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x32, 0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7, 0x48};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "W\217\244\199\US\166I\171\225H\165\&0\148+>'\185\243\243\254\182\&3\158\130", _pubPktID = 5484, _pubBody =
// "N\151Gu\207\213\209\175\151\241[\RS\128P\129\237\157\250K", _pubProps = [PropReceiveMaximum 26936]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {0x3b, 0x33, 0x0,  0x18, 0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48,
                   0xa5, 0x30, 0x94, 0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82,
                   0x15, 0x6c, 0x3,  0x21, 0x69, 0x38, 0x4e, 0x97, 0x47, 0x75, 0xcf, 0xd5, 0xd1, 0xaf,
                   0x97, 0xf1, 0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  uint8_t topic_bytes[] = {0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48, 0xa5, 0x30,
                           0x94, 0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4e, 0x97, 0x47, 0x75, 0xcf, 0xd5, 0xd1, 0xaf, 0x97, 0xf1,
                         0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26936}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5484, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "W\217\244\199\US\166I\171\225H\165\&0\148+>'\185\243\243\254\182\&3\158\130", _pubPktID = 5484, _pubBody =
// "N\151Gu\207\213\209\175\151\241[\RS\128P\129\237\157\250K", _pubProps = [PropReceiveMaximum 26936]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {0x3b, 0x33, 0x0,  0x18, 0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48,
                   0xa5, 0x30, 0x94, 0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82,
                   0x15, 0x6c, 0x3,  0x21, 0x69, 0x38, 0x4e, 0x97, 0x47, 0x75, 0xcf, 0xd5, 0xd1, 0xaf,
                   0x97, 0xf1, 0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x57, 0xd9, 0xf4, 0xc7, 0x1f, 0xa6, 0x49, 0xab, 0xe1, 0x48, 0xa5, 0x30,
                               0x94, 0x2b, 0x3e, 0x27, 0xb9, 0xf3, 0xf3, 0xfe, 0xb6, 0x33, 0x9e, 0x82};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4e, 0x97, 0x47, 0x75, 0xcf, 0xd5, 0xd1, 0xaf, 0x97, 0xf1,
                              0x5b, 0x1e, 0x80, 0x50, 0x81, 0xed, 0x9d, 0xfa, 0x4b};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 5484);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\164_xCoe\161\\\SYN8\247~X\178U\EOT\201\239d\NUL\v\219\239", _pubPktID = 617, _pubBody =
// "\203\"\151M\221\179{\230\DC3c\185\FS\183-\225\169\214\ETX\128\159\170E\186\239\ESC\153\192\142", _pubProps =
// [PropMaximumQoS 222,PropReceiveMaximum 32352,PropResponseTopic "_-\213",PropSharedSubscriptionAvailable
// 77,PropMessageExpiryInterval 27318,PropSubscriptionIdentifierAvailable 17,PropTopicAlias 4804,PropMaximumQoS
// 245,PropMaximumQoS 33,PropServerReference "\165KJ\219Ap\192\151\200\134\149",PropSharedSubscriptionAvailable
// 196,PropTopicAlias 28672,PropAssignedClientIdentifier "Tl\129`\180&EKq6\201\232\EM(\235\US",PropRetainAvailable
// 117,PropAssignedClientIdentifier "\232\242't\134w\152\212\DC27\155Y\DELx\209s5\197",PropPayloadFormatIndicator
// 133,PropWildcardSubscriptionAvailable 232,PropAuthenticationMethod
// "\227\193\NUL:K\134X\134\245\232\231RB\148\229\214\203\178\186\237\247\252\a9\129lc\DEL\153",PropMaximumQoS
// 231,PropRetainAvailable 124]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x3b, 0xb9, 0x1,  0x0,  0x17, 0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7, 0x7e, 0x58, 0xb2,
      0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef, 0x2,  0x69, 0x80, 0x1,  0x24, 0xde, 0x21, 0x7e, 0x60, 0x8,
      0x0,  0x3,  0x5f, 0x2d, 0xd5, 0x2a, 0x4d, 0x2,  0x0,  0x0,  0x6a, 0xb6, 0x29, 0x11, 0x23, 0x12, 0xc4, 0x24, 0xf5,
      0x24, 0x21, 0x1c, 0x0,  0xb,  0xa5, 0x4b, 0x4a, 0xdb, 0x41, 0x70, 0xc0, 0x97, 0xc8, 0x86, 0x95, 0x2a, 0xc4, 0x23,
      0x70, 0x0,  0x12, 0x0,  0x10, 0x54, 0x6c, 0x81, 0x60, 0xb4, 0x26, 0x45, 0x4b, 0x71, 0x36, 0xc9, 0xe8, 0x19, 0x28,
      0xeb, 0x1f, 0x25, 0x75, 0x12, 0x0,  0x12, 0xe8, 0xf2, 0x27, 0x74, 0x86, 0x77, 0x98, 0xd4, 0x12, 0x37, 0x9b, 0x59,
      0x7f, 0x78, 0xd1, 0x73, 0x35, 0xc5, 0x1,  0x85, 0x28, 0xe8, 0x15, 0x0,  0x1d, 0xe3, 0xc1, 0x0,  0x3a, 0x4b, 0x86,
      0x58, 0x86, 0xf5, 0xe8, 0xe7, 0x52, 0x42, 0x94, 0xe5, 0xd6, 0xcb, 0xb2, 0xba, 0xed, 0xf7, 0xfc, 0x7,  0x39, 0x81,
      0x6c, 0x63, 0x7f, 0x99, 0x24, 0xe7, 0x25, 0x7c, 0xcb, 0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9,
      0x1c, 0xb7, 0x2d, 0xe1, 0xa9, 0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  uint8_t topic_bytes[] = {0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7, 0x7e,
                           0x58, 0xb2, 0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcb, 0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9, 0x1c, 0xb7, 0x2d,
                         0xe1, 0xa9, 0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0x5f, 0x2d, 0xd5};
  uint8_t bytesprops1[] = {0xa5, 0x4b, 0x4a, 0xdb, 0x41, 0x70, 0xc0, 0x97, 0xc8, 0x86, 0x95};
  uint8_t bytesprops2[] = {0x54, 0x6c, 0x81, 0x60, 0xb4, 0x26, 0x45, 0x4b,
                           0x71, 0x36, 0xc9, 0xe8, 0x19, 0x28, 0xeb, 0x1f};
  uint8_t bytesprops3[] = {0xe8, 0xf2, 0x27, 0x74, 0x86, 0x77, 0x98, 0xd4, 0x12,
                           0x37, 0x9b, 0x59, 0x7f, 0x78, 0xd1, 0x73, 0x35, 0xc5};
  uint8_t bytesprops4[] = {0xe3, 0xc1, 0x0,  0x3a, 0x4b, 0x86, 0x58, 0x86, 0xf5, 0xe8, 0xe7, 0x52, 0x42, 0x94, 0xe5,
                           0xd6, 0xcb, 0xb2, 0xba, 0xed, 0xf7, 0xfc, 0x7,  0x39, 0x81, 0x6c, 0x63, 0x7f, 0x99};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32352}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27318}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4804}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28672}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 124}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 617, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\164_xCoe\161\\\SYN8\247~X\178U\EOT\201\239d\NUL\v\219\239", _pubPktID = 617, _pubBody =
// "\203\"\151M\221\179{\230\DC3c\185\FS\183-\225\169\214\ETX\128\159\170E\186\239\ESC\153\192\142", _pubProps =
// [PropMaximumQoS 222,PropReceiveMaximum 32352,PropResponseTopic "_-\213",PropSharedSubscriptionAvailable
// 77,PropMessageExpiryInterval 27318,PropSubscriptionIdentifierAvailable 17,PropTopicAlias 4804,PropMaximumQoS
// 245,PropMaximumQoS 33,PropServerReference "\165KJ\219Ap\192\151\200\134\149",PropSharedSubscriptionAvailable
// 196,PropTopicAlias 28672,PropAssignedClientIdentifier "Tl\129`\180&EKq6\201\232\EM(\235\US",PropRetainAvailable
// 117,PropAssignedClientIdentifier "\232\242't\134w\152\212\DC27\155Y\DELx\209s5\197",PropPayloadFormatIndicator
// 133,PropWildcardSubscriptionAvailable 232,PropAuthenticationMethod
// "\227\193\NUL:K\134X\134\245\232\231RB\148\229\214\203\178\186\237\247\252\a9\129lc\DEL\153",PropMaximumQoS
// 231,PropRetainAvailable 124]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {
      0x3b, 0xb9, 0x1,  0x0,  0x17, 0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7, 0x7e, 0x58, 0xb2,
      0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef, 0x2,  0x69, 0x80, 0x1,  0x24, 0xde, 0x21, 0x7e, 0x60, 0x8,
      0x0,  0x3,  0x5f, 0x2d, 0xd5, 0x2a, 0x4d, 0x2,  0x0,  0x0,  0x6a, 0xb6, 0x29, 0x11, 0x23, 0x12, 0xc4, 0x24, 0xf5,
      0x24, 0x21, 0x1c, 0x0,  0xb,  0xa5, 0x4b, 0x4a, 0xdb, 0x41, 0x70, 0xc0, 0x97, 0xc8, 0x86, 0x95, 0x2a, 0xc4, 0x23,
      0x70, 0x0,  0x12, 0x0,  0x10, 0x54, 0x6c, 0x81, 0x60, 0xb4, 0x26, 0x45, 0x4b, 0x71, 0x36, 0xc9, 0xe8, 0x19, 0x28,
      0xeb, 0x1f, 0x25, 0x75, 0x12, 0x0,  0x12, 0xe8, 0xf2, 0x27, 0x74, 0x86, 0x77, 0x98, 0xd4, 0x12, 0x37, 0x9b, 0x59,
      0x7f, 0x78, 0xd1, 0x73, 0x35, 0xc5, 0x1,  0x85, 0x28, 0xe8, 0x15, 0x0,  0x1d, 0xe3, 0xc1, 0x0,  0x3a, 0x4b, 0x86,
      0x58, 0x86, 0xf5, 0xe8, 0xe7, 0x52, 0x42, 0x94, 0xe5, 0xd6, 0xcb, 0xb2, 0xba, 0xed, 0xf7, 0xfc, 0x7,  0x39, 0x81,
      0x6c, 0x63, 0x7f, 0x99, 0x24, 0xe7, 0x25, 0x7c, 0xcb, 0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9,
      0x1c, 0xb7, 0x2d, 0xe1, 0xa9, 0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa4, 0x5f, 0x78, 0x43, 0x6f, 0x65, 0xa1, 0x5c, 0x16, 0x38, 0xf7, 0x7e,
                               0x58, 0xb2, 0x55, 0x4,  0xc9, 0xef, 0x64, 0x0,  0xb,  0xdb, 0xef};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcb, 0x22, 0x97, 0x4d, 0xdd, 0xb3, 0x7b, 0xe6, 0x13, 0x63, 0xb9, 0x1c, 0xb7, 0x2d,
                              0xe1, 0xa9, 0xd6, 0x3,  0x80, 0x9f, 0xaa, 0x45, 0xba, 0xef, 0x1b, 0x99, 0xc0, 0x8e};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 617);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "]\DEL\239p\251\205\214zi\204\179\194Y\158", _pubPktID = 0, _pubBody =
// "|\207v\144\230\175\FSN\178\165\215\DC3\EM\250\162\187\135\181", _pubProps = [PropMaximumPacketSize
// 10488,PropPayloadFormatIndicator 12,PropResponseTopic
// "`n\227\135Df\149W\177\181\204\163\199\167\227\179\153sS\SYN8\EOTo",PropAuthenticationMethod
// "\138s\203u\213",PropSharedSubscriptionAvailable 77,PropWildcardSubscriptionAvailable
// 166,PropSubscriptionIdentifierAvailable 21,PropResponseTopic "}\182,\rz\137?\187\r",PropAuthenticationMethod
// "",PropResponseInformation "*hT\196\138\173\SO3[\153\&1\238[.\155[",PropSubscriptionIdentifier 3,PropRetainAvailable
// 191,PropServerKeepAlive 21972,PropAuthenticationData "\249\200\209\&2/",PropContentType
// "\198-\246s1u\142h\151\153",PropSubscriptionIdentifier 7,PropRetainAvailable 255,PropCorrelationData
// "\157gh\147\193INa\203\FS\a\232\a\200\ENQ\190\201\192\182\166\139\177\CAN\vRu",PropMaximumQoS 193,PropResponseTopic
// "\199\236#\244J\216\&4#!",PropAssignedClientIdentifier
// "\230\163=9\213|\128[\232\152\148\255M\STX\209>\225\131\131ba\181\199\234\206\231\NULl",PropMaximumPacketSize
// 4488,PropTopicAliasMaximum 28636,PropAssignedClientIdentifier
// "\153\236<L\245\192\NAK\156\239\155\131x\199\a",PropRequestResponseInformation 47]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x39, 0xfa, 0x1,  0x0,  0xe,  0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a, 0x69, 0xcc, 0xb3, 0xc2,
                   0x59, 0x9e, 0xd6, 0x1,  0x27, 0x0,  0x0,  0x28, 0xf8, 0x1,  0xc,  0x8,  0x0,  0x17, 0x60, 0x6e, 0xe3,
                   0x87, 0x44, 0x66, 0x95, 0x57, 0xb1, 0xb5, 0xcc, 0xa3, 0xc7, 0xa7, 0xe3, 0xb3, 0x99, 0x73, 0x53, 0x16,
                   0x38, 0x4,  0x6f, 0x15, 0x0,  0x5,  0x8a, 0x73, 0xcb, 0x75, 0xd5, 0x2a, 0x4d, 0x28, 0xa6, 0x29, 0x15,
                   0x8,  0x0,  0x9,  0x7d, 0xb6, 0x2c, 0xd,  0x7a, 0x89, 0x3f, 0xbb, 0xd,  0x15, 0x0,  0x0,  0x1a, 0x0,
                   0x10, 0x2a, 0x68, 0x54, 0xc4, 0x8a, 0xad, 0xe,  0x33, 0x5b, 0x99, 0x31, 0xee, 0x5b, 0x2e, 0x9b, 0x5b,
                   0xb,  0x3,  0x25, 0xbf, 0x13, 0x55, 0xd4, 0x16, 0x0,  0x5,  0xf9, 0xc8, 0xd1, 0x32, 0x2f, 0x3,  0x0,
                   0xa,  0xc6, 0x2d, 0xf6, 0x73, 0x31, 0x75, 0x8e, 0x68, 0x97, 0x99, 0xb,  0x7,  0x25, 0xff, 0x9,  0x0,
                   0x1a, 0x9d, 0x67, 0x68, 0x93, 0xc1, 0x49, 0x4e, 0x61, 0xcb, 0x1c, 0x7,  0xe8, 0x7,  0xc8, 0x5,  0xbe,
                   0xc9, 0xc0, 0xb6, 0xa6, 0x8b, 0xb1, 0x18, 0xb,  0x52, 0x75, 0x24, 0xc1, 0x8,  0x0,  0x9,  0xc7, 0xec,
                   0x23, 0xf4, 0x4a, 0xd8, 0x34, 0x23, 0x21, 0x12, 0x0,  0x1c, 0xe6, 0xa3, 0x3d, 0x39, 0xd5, 0x7c, 0x80,
                   0x5b, 0xe8, 0x98, 0x94, 0xff, 0x4d, 0x2,  0xd1, 0x3e, 0xe1, 0x83, 0x83, 0x62, 0x61, 0xb5, 0xc7, 0xea,
                   0xce, 0xe7, 0x0,  0x6c, 0x27, 0x0,  0x0,  0x11, 0x88, 0x22, 0x6f, 0xdc, 0x12, 0x0,  0xe,  0x99, 0xec,
                   0x3c, 0x4c, 0xf5, 0xc0, 0x15, 0x9c, 0xef, 0x9b, 0x83, 0x78, 0xc7, 0x7,  0x19, 0x2f, 0x7c, 0xcf, 0x76,
                   0x90, 0xe6, 0xaf, 0x1c, 0x4e, 0xb2, 0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  uint8_t topic_bytes[] = {0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a, 0x69, 0xcc, 0xb3, 0xc2, 0x59, 0x9e};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x7c, 0xcf, 0x76, 0x90, 0xe6, 0xaf, 0x1c, 0x4e, 0xb2,
                         0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0x60, 0x6e, 0xe3, 0x87, 0x44, 0x66, 0x95, 0x57, 0xb1, 0xb5, 0xcc, 0xa3,
                           0xc7, 0xa7, 0xe3, 0xb3, 0x99, 0x73, 0x53, 0x16, 0x38, 0x4,  0x6f};
  uint8_t bytesprops1[] = {0x8a, 0x73, 0xcb, 0x75, 0xd5};
  uint8_t bytesprops2[] = {0x7d, 0xb6, 0x2c, 0xd, 0x7a, 0x89, 0x3f, 0xbb, 0xd};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x2a, 0x68, 0x54, 0xc4, 0x8a, 0xad, 0xe,  0x33,
                           0x5b, 0x99, 0x31, 0xee, 0x5b, 0x2e, 0x9b, 0x5b};
  uint8_t bytesprops5[] = {0xf9, 0xc8, 0xd1, 0x32, 0x2f};
  uint8_t bytesprops6[] = {0xc6, 0x2d, 0xf6, 0x73, 0x31, 0x75, 0x8e, 0x68, 0x97, 0x99};
  uint8_t bytesprops7[] = {0x9d, 0x67, 0x68, 0x93, 0xc1, 0x49, 0x4e, 0x61, 0xcb, 0x1c, 0x7, 0xe8, 0x7,
                           0xc8, 0x5,  0xbe, 0xc9, 0xc0, 0xb6, 0xa6, 0x8b, 0xb1, 0x18, 0xb, 0x52, 0x75};
  uint8_t bytesprops8[] = {0xc7, 0xec, 0x23, 0xf4, 0x4a, 0xd8, 0x34, 0x23, 0x21};
  uint8_t bytesprops9[] = {0xe6, 0xa3, 0x3d, 0x39, 0xd5, 0x7c, 0x80, 0x5b, 0xe8, 0x98, 0x94, 0xff, 0x4d, 0x2,
                           0xd1, 0x3e, 0xe1, 0x83, 0x83, 0x62, 0x61, 0xb5, 0xc7, 0xea, 0xce, 0xe7, 0x0,  0x6c};
  uint8_t bytesprops10[] = {0x99, 0xec, 0x3c, 0x4c, 0xf5, 0xc0, 0x15, 0x9c, 0xef, 0x9b, 0x83, 0x78, 0xc7, 0x7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10488}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21972}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4488}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28636}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 47}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "]\DEL\239p\251\205\214zi\204\179\194Y\158", _pubPktID = 0, _pubBody =
// "|\207v\144\230\175\FSN\178\165\215\DC3\EM\250\162\187\135\181", _pubProps = [PropMaximumPacketSize
// 10488,PropPayloadFormatIndicator 12,PropResponseTopic
// "`n\227\135Df\149W\177\181\204\163\199\167\227\179\153sS\SYN8\EOTo",PropAuthenticationMethod
// "\138s\203u\213",PropSharedSubscriptionAvailable 77,PropWildcardSubscriptionAvailable
// 166,PropSubscriptionIdentifierAvailable 21,PropResponseTopic "}\182,\rz\137?\187\r",PropAuthenticationMethod
// "",PropResponseInformation "*hT\196\138\173\SO3[\153\&1\238[.\155[",PropSubscriptionIdentifier 3,PropRetainAvailable
// 191,PropServerKeepAlive 21972,PropAuthenticationData "\249\200\209\&2/",PropContentType
// "\198-\246s1u\142h\151\153",PropSubscriptionIdentifier 7,PropRetainAvailable 255,PropCorrelationData
// "\157gh\147\193INa\203\FS\a\232\a\200\ENQ\190\201\192\182\166\139\177\CAN\vRu",PropMaximumQoS 193,PropResponseTopic
// "\199\236#\244J\216\&4#!",PropAssignedClientIdentifier
// "\230\163=9\213|\128[\232\152\148\255M\STX\209>\225\131\131ba\181\199\234\206\231\NULl",PropMaximumPacketSize
// 4488,PropTopicAliasMaximum 28636,PropAssignedClientIdentifier
// "\153\236<L\245\192\NAK\156\239\155\131x\199\a",PropRequestResponseInformation 47]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x39, 0xfa, 0x1,  0x0,  0xe,  0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a, 0x69, 0xcc, 0xb3, 0xc2,
                   0x59, 0x9e, 0xd6, 0x1,  0x27, 0x0,  0x0,  0x28, 0xf8, 0x1,  0xc,  0x8,  0x0,  0x17, 0x60, 0x6e, 0xe3,
                   0x87, 0x44, 0x66, 0x95, 0x57, 0xb1, 0xb5, 0xcc, 0xa3, 0xc7, 0xa7, 0xe3, 0xb3, 0x99, 0x73, 0x53, 0x16,
                   0x38, 0x4,  0x6f, 0x15, 0x0,  0x5,  0x8a, 0x73, 0xcb, 0x75, 0xd5, 0x2a, 0x4d, 0x28, 0xa6, 0x29, 0x15,
                   0x8,  0x0,  0x9,  0x7d, 0xb6, 0x2c, 0xd,  0x7a, 0x89, 0x3f, 0xbb, 0xd,  0x15, 0x0,  0x0,  0x1a, 0x0,
                   0x10, 0x2a, 0x68, 0x54, 0xc4, 0x8a, 0xad, 0xe,  0x33, 0x5b, 0x99, 0x31, 0xee, 0x5b, 0x2e, 0x9b, 0x5b,
                   0xb,  0x3,  0x25, 0xbf, 0x13, 0x55, 0xd4, 0x16, 0x0,  0x5,  0xf9, 0xc8, 0xd1, 0x32, 0x2f, 0x3,  0x0,
                   0xa,  0xc6, 0x2d, 0xf6, 0x73, 0x31, 0x75, 0x8e, 0x68, 0x97, 0x99, 0xb,  0x7,  0x25, 0xff, 0x9,  0x0,
                   0x1a, 0x9d, 0x67, 0x68, 0x93, 0xc1, 0x49, 0x4e, 0x61, 0xcb, 0x1c, 0x7,  0xe8, 0x7,  0xc8, 0x5,  0xbe,
                   0xc9, 0xc0, 0xb6, 0xa6, 0x8b, 0xb1, 0x18, 0xb,  0x52, 0x75, 0x24, 0xc1, 0x8,  0x0,  0x9,  0xc7, 0xec,
                   0x23, 0xf4, 0x4a, 0xd8, 0x34, 0x23, 0x21, 0x12, 0x0,  0x1c, 0xe6, 0xa3, 0x3d, 0x39, 0xd5, 0x7c, 0x80,
                   0x5b, 0xe8, 0x98, 0x94, 0xff, 0x4d, 0x2,  0xd1, 0x3e, 0xe1, 0x83, 0x83, 0x62, 0x61, 0xb5, 0xc7, 0xea,
                   0xce, 0xe7, 0x0,  0x6c, 0x27, 0x0,  0x0,  0x11, 0x88, 0x22, 0x6f, 0xdc, 0x12, 0x0,  0xe,  0x99, 0xec,
                   0x3c, 0x4c, 0xf5, 0xc0, 0x15, 0x9c, 0xef, 0x9b, 0x83, 0x78, 0xc7, 0x7,  0x19, 0x2f, 0x7c, 0xcf, 0x76,
                   0x90, 0xe6, 0xaf, 0x1c, 0x4e, 0xb2, 0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5d, 0x7f, 0xef, 0x70, 0xfb, 0xcd, 0xd6, 0x7a, 0x69, 0xcc, 0xb3, 0xc2, 0x59, 0x9e};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7c, 0xcf, 0x76, 0x90, 0xe6, 0xaf, 0x1c, 0x4e, 0xb2,
                              0xa5, 0xd7, 0x13, 0x19, 0xfa, 0xa2, 0xbb, 0x87, 0xb5};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\&8\RSE", _pubPktID = 14265,
// _pubBody = "OtS\167", _pubProps = [PropTopicAliasMaximum 24809]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x3d, 0x10, 0x0,  0x4,  0xff, 0x38, 0x1e, 0x45, 0x37,
                   0xb9, 0x3,  0x22, 0x60, 0xe9, 0x4f, 0x74, 0x53, 0xa7};
  uint8_t topic_bytes[] = {0xff, 0x38, 0x1e, 0x45};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4f, 0x74, 0x53, 0xa7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24809}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 14265, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\&8\RSE", _pubPktID = 14265,
// _pubBody = "OtS\167", _pubProps = [PropTopicAliasMaximum 24809]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x3d, 0x10, 0x0,  0x4,  0xff, 0x38, 0x1e, 0x45, 0x37,
                   0xb9, 0x3,  0x22, 0x60, 0xe9, 0x4f, 0x74, 0x53, 0xa7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xff, 0x38, 0x1e, 0x45};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4f, 0x74, 0x53, 0xa7};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14265);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\175\137\vj?Vv\214\&1|l\a\RS\191\237\148\187\223g^\158f\195W\245R\159", _pubPktID = 0, _pubBody =
// "\133\170\157HgVe\197\170\203V\231", _pubProps = [PropReceiveMaximum 21892,PropTopicAlias
// 15063,PropResponseInformation "\182H\aU\ETX$\176_\214a\178\217;PJN\DC1\237\149\219\EM\155\174\249",PropReceiveMaximum
// 4741,PropWildcardSubscriptionAvailable 144,PropMaximumPacketSize 15811,PropAuthenticationData
// "\159&\DLE\t\236\229\181\205\174\191\247\190\212\182\&8\177\160#\239\230\200a",PropAuthenticationData
// "\191\240\208\200fEkt\239\ESC\162XS3X\ACK\180\241\204\185",PropMessageExpiryInterval 32048,PropRetainAvailable
// 81,PropCorrelationData "\163\233\156\b'\241\197\238\227'\203\&7~\b\202\235q\234\171\213\201WX"]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x39, 0xa6, 0x1,  0x0,  0x1b, 0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c, 0x7,
                   0x1e, 0xbf, 0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52, 0x9f, 0x7c, 0x21,
                   0x55, 0x84, 0x23, 0x3a, 0xd7, 0x1a, 0x0,  0x18, 0xb6, 0x48, 0x7,  0x55, 0x3,  0x24, 0xb0, 0x5f, 0xd6,
                   0x61, 0xb2, 0xd9, 0x3b, 0x50, 0x4a, 0x4e, 0x11, 0xed, 0x95, 0xdb, 0x19, 0x9b, 0xae, 0xf9, 0x21, 0x12,
                   0x85, 0x28, 0x90, 0x27, 0x0,  0x0,  0x3d, 0xc3, 0x16, 0x0,  0x16, 0x9f, 0x26, 0x10, 0x9,  0xec, 0xe5,
                   0xb5, 0xcd, 0xae, 0xbf, 0xf7, 0xbe, 0xd4, 0xb6, 0x38, 0xb1, 0xa0, 0x23, 0xef, 0xe6, 0xc8, 0x61, 0x16,
                   0x0,  0x14, 0xbf, 0xf0, 0xd0, 0xc8, 0x66, 0x45, 0x6b, 0x74, 0xef, 0x1b, 0xa2, 0x58, 0x53, 0x33, 0x58,
                   0x6,  0xb4, 0xf1, 0xcc, 0xb9, 0x2,  0x0,  0x0,  0x7d, 0x30, 0x25, 0x51, 0x9,  0x0,  0x17, 0xa3, 0xe9,
                   0x9c, 0x8,  0x27, 0xf1, 0xc5, 0xee, 0xe3, 0x27, 0xcb, 0x37, 0x7e, 0x8,  0xca, 0xeb, 0x71, 0xea, 0xab,
                   0xd5, 0xc9, 0x57, 0x58, 0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  uint8_t topic_bytes[] = {0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c, 0x7,  0x1e, 0xbf,
                           0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52, 0x9f};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0xb6, 0x48, 0x7,  0x55, 0x3,  0x24, 0xb0, 0x5f, 0xd6, 0x61, 0xb2, 0xd9,
                           0x3b, 0x50, 0x4a, 0x4e, 0x11, 0xed, 0x95, 0xdb, 0x19, 0x9b, 0xae, 0xf9};
  uint8_t bytesprops1[] = {0x9f, 0x26, 0x10, 0x9,  0xec, 0xe5, 0xb5, 0xcd, 0xae, 0xbf, 0xf7,
                           0xbe, 0xd4, 0xb6, 0x38, 0xb1, 0xa0, 0x23, 0xef, 0xe6, 0xc8, 0x61};
  uint8_t bytesprops2[] = {0xbf, 0xf0, 0xd0, 0xc8, 0x66, 0x45, 0x6b, 0x74, 0xef, 0x1b,
                           0xa2, 0x58, 0x53, 0x33, 0x58, 0x6,  0xb4, 0xf1, 0xcc, 0xb9};
  uint8_t bytesprops3[] = {0xa3, 0xe9, 0x9c, 0x8,  0x27, 0xf1, 0xc5, 0xee, 0xe3, 0x27, 0xcb, 0x37,
                           0x7e, 0x8,  0xca, 0xeb, 0x71, 0xea, 0xab, 0xd5, 0xc9, 0x57, 0x58};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21892}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15063}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4741}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15811}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32048}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\175\137\vj?Vv\214\&1|l\a\RS\191\237\148\187\223g^\158f\195W\245R\159", _pubPktID = 0, _pubBody =
// "\133\170\157HgVe\197\170\203V\231", _pubProps = [PropReceiveMaximum 21892,PropTopicAlias
// 15063,PropResponseInformation "\182H\aU\ETX$\176_\214a\178\217;PJN\DC1\237\149\219\EM\155\174\249",PropReceiveMaximum
// 4741,PropWildcardSubscriptionAvailable 144,PropMaximumPacketSize 15811,PropAuthenticationData
// "\159&\DLE\t\236\229\181\205\174\191\247\190\212\182\&8\177\160#\239\230\200a",PropAuthenticationData
// "\191\240\208\200fEkt\239\ESC\162XS3X\ACK\180\241\204\185",PropMessageExpiryInterval 32048,PropRetainAvailable
// 81,PropCorrelationData "\163\233\156\b'\241\197\238\227'\203\&7~\b\202\235q\234\171\213\201WX"]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x39, 0xa6, 0x1,  0x0,  0x1b, 0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c, 0x7,
                   0x1e, 0xbf, 0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52, 0x9f, 0x7c, 0x21,
                   0x55, 0x84, 0x23, 0x3a, 0xd7, 0x1a, 0x0,  0x18, 0xb6, 0x48, 0x7,  0x55, 0x3,  0x24, 0xb0, 0x5f, 0xd6,
                   0x61, 0xb2, 0xd9, 0x3b, 0x50, 0x4a, 0x4e, 0x11, 0xed, 0x95, 0xdb, 0x19, 0x9b, 0xae, 0xf9, 0x21, 0x12,
                   0x85, 0x28, 0x90, 0x27, 0x0,  0x0,  0x3d, 0xc3, 0x16, 0x0,  0x16, 0x9f, 0x26, 0x10, 0x9,  0xec, 0xe5,
                   0xb5, 0xcd, 0xae, 0xbf, 0xf7, 0xbe, 0xd4, 0xb6, 0x38, 0xb1, 0xa0, 0x23, 0xef, 0xe6, 0xc8, 0x61, 0x16,
                   0x0,  0x14, 0xbf, 0xf0, 0xd0, 0xc8, 0x66, 0x45, 0x6b, 0x74, 0xef, 0x1b, 0xa2, 0x58, 0x53, 0x33, 0x58,
                   0x6,  0xb4, 0xf1, 0xcc, 0xb9, 0x2,  0x0,  0x0,  0x7d, 0x30, 0x25, 0x51, 0x9,  0x0,  0x17, 0xa3, 0xe9,
                   0x9c, 0x8,  0x27, 0xf1, 0xc5, 0xee, 0xe3, 0x27, 0xcb, 0x37, 0x7e, 0x8,  0xca, 0xeb, 0x71, 0xea, 0xab,
                   0xd5, 0xc9, 0x57, 0x58, 0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xaf, 0x89, 0xb,  0x6a, 0x3f, 0x56, 0x76, 0xd6, 0x31, 0x7c, 0x6c, 0x7,  0x1e, 0xbf,
                               0xed, 0x94, 0xbb, 0xdf, 0x67, 0x5e, 0x9e, 0x66, 0xc3, 0x57, 0xf5, 0x52, 0x9f};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x85, 0xaa, 0x9d, 0x48, 0x67, 0x56, 0x65, 0xc5, 0xaa, 0xcb, 0x56, 0xe7};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\fn)\RS", _pubPktID = 5499, _pubBody
// = "\156I\SUB\231\236b\ENQ\137\237\r\NAK:[\222g\135", _pubProps = [PropResponseInformation
// "!mQ\NUL\213\194T\222",PropAuthenticationData
// "L\185\136R\252E\189\233\220\193\SYN;\182\234\239[\188\&1\171\143%\144\242",PropReceiveMaximum 4689,PropResponseTopic
// "\CANgB#\ENQz\195$\SOH\221\164M\STXa\203d8K*",PropSharedSubscriptionAvailable 169,PropMaximumPacketSize
// 5137,PropRequestProblemInformation 210,PropResponseTopic
// "\185$\SO\155\135\151\DLE\ETB\178#\200\\\210\216\SOH\197u\CAN'\n\224\206",PropUserProperty
// "l6\149r\NAK\188\191~\155\128@8c\245\\'\144\169\231"
// "\\\204E\175\SI\156\150XH\185\247\254\RSy",PropSessionExpiryInterval 8146,PropReasonString
// "s\221@M\SI\254",PropReceiveMaximum 14585,PropUserProperty ")H\207\234P\197Pv"
// "s8tQ\163QX\SUB\171\223\149\178\248H\a\243\136\163\183",PropMessageExpiryInterval 11331,PropReasonString
// "(R!\207\172E*-\192\184\227",PropWillDelayInterval 23672]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x3a, 0xe9, 0x1,  0x0,  0x4,  0xc,  0x6e, 0x29, 0x1e, 0x15, 0x7b, 0xcf, 0x1,  0x1a, 0x0,  0x8,  0x21,
                   0x6d, 0x51, 0x0,  0xd5, 0xc2, 0x54, 0xde, 0x16, 0x0,  0x17, 0x4c, 0xb9, 0x88, 0x52, 0xfc, 0x45, 0xbd,
                   0xe9, 0xdc, 0xc1, 0x16, 0x3b, 0xb6, 0xea, 0xef, 0x5b, 0xbc, 0x31, 0xab, 0x8f, 0x25, 0x90, 0xf2, 0x21,
                   0x12, 0x51, 0x8,  0x0,  0x13, 0x18, 0x67, 0x42, 0x23, 0x5,  0x7a, 0xc3, 0x24, 0x1,  0xdd, 0xa4, 0x4d,
                   0x2,  0x61, 0xcb, 0x64, 0x38, 0x4b, 0x2a, 0x2a, 0xa9, 0x27, 0x0,  0x0,  0x14, 0x11, 0x17, 0xd2, 0x8,
                   0x0,  0x16, 0xb9, 0x24, 0xe,  0x9b, 0x87, 0x97, 0x10, 0x17, 0xb2, 0x23, 0xc8, 0x5c, 0xd2, 0xd8, 0x1,
                   0xc5, 0x75, 0x18, 0x27, 0xa,  0xe0, 0xce, 0x26, 0x0,  0x13, 0x6c, 0x36, 0x95, 0x72, 0x15, 0xbc, 0xbf,
                   0x7e, 0x9b, 0x80, 0x40, 0x38, 0x63, 0xf5, 0x5c, 0x27, 0x90, 0xa9, 0xe7, 0x0,  0xe,  0x5c, 0xcc, 0x45,
                   0xaf, 0xf,  0x9c, 0x96, 0x58, 0x48, 0xb9, 0xf7, 0xfe, 0x1e, 0x79, 0x11, 0x0,  0x0,  0x1f, 0xd2, 0x1f,
                   0x0,  0x6,  0x73, 0xdd, 0x40, 0x4d, 0xf,  0xfe, 0x21, 0x38, 0xf9, 0x26, 0x0,  0x8,  0x29, 0x48, 0xcf,
                   0xea, 0x50, 0xc5, 0x50, 0x76, 0x0,  0x13, 0x73, 0x38, 0x74, 0x51, 0xa3, 0x51, 0x58, 0x1a, 0xab, 0xdf,
                   0x95, 0xb2, 0xf8, 0x48, 0x7,  0xf3, 0x88, 0xa3, 0xb7, 0x2,  0x0,  0x0,  0x2c, 0x43, 0x1f, 0x0,  0xb,
                   0x28, 0x52, 0x21, 0xcf, 0xac, 0x45, 0x2a, 0x2d, 0xc0, 0xb8, 0xe3, 0x18, 0x0,  0x0,  0x5c, 0x78, 0x9c,
                   0x49, 0x1a, 0xe7, 0xec, 0x62, 0x5,  0x89, 0xed, 0xd,  0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  uint8_t topic_bytes[] = {0xc, 0x6e, 0x29, 0x1e};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x9c, 0x49, 0x1a, 0xe7, 0xec, 0x62, 0x5, 0x89, 0xed, 0xd, 0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops0[] = {0x21, 0x6d, 0x51, 0x0, 0xd5, 0xc2, 0x54, 0xde};
  uint8_t bytesprops1[] = {0x4c, 0xb9, 0x88, 0x52, 0xfc, 0x45, 0xbd, 0xe9, 0xdc, 0xc1, 0x16, 0x3b,
                           0xb6, 0xea, 0xef, 0x5b, 0xbc, 0x31, 0xab, 0x8f, 0x25, 0x90, 0xf2};
  uint8_t bytesprops2[] = {0x18, 0x67, 0x42, 0x23, 0x5,  0x7a, 0xc3, 0x24, 0x1, 0xdd,
                           0xa4, 0x4d, 0x2,  0x61, 0xcb, 0x64, 0x38, 0x4b, 0x2a};
  uint8_t bytesprops3[] = {0xb9, 0x24, 0xe,  0x9b, 0x87, 0x97, 0x10, 0x17, 0xb2, 0x23, 0xc8,
                           0x5c, 0xd2, 0xd8, 0x1,  0xc5, 0x75, 0x18, 0x27, 0xa,  0xe0, 0xce};
  uint8_t bytesprops5[] = {0x5c, 0xcc, 0x45, 0xaf, 0xf, 0x9c, 0x96, 0x58, 0x48, 0xb9, 0xf7, 0xfe, 0x1e, 0x79};
  uint8_t bytesprops4[] = {0x6c, 0x36, 0x95, 0x72, 0x15, 0xbc, 0xbf, 0x7e, 0x9b, 0x80,
                           0x40, 0x38, 0x63, 0xf5, 0x5c, 0x27, 0x90, 0xa9, 0xe7};
  uint8_t bytesprops6[] = {0x73, 0xdd, 0x40, 0x4d, 0xf, 0xfe};
  uint8_t bytesprops8[] = {0x73, 0x38, 0x74, 0x51, 0xa3, 0x51, 0x58, 0x1a, 0xab, 0xdf,
                           0x95, 0xb2, 0xf8, 0x48, 0x7,  0xf3, 0x88, 0xa3, 0xb7};
  uint8_t bytesprops7[] = {0x29, 0x48, 0xcf, 0xea, 0x50, 0xc5, 0x50, 0x76};
  uint8_t bytesprops9[] = {0x28, 0x52, 0x21, 0xcf, 0xac, 0x45, 0x2a, 0x2d, 0xc0, 0xb8, 0xe3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4689}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5137}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops4}, .v = {14, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8146}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14585}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops7}, .v = {19, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11331}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23672}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 5499, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\fn)\RS", _pubPktID = 5499, _pubBody
// = "\156I\SUB\231\236b\ENQ\137\237\r\NAK:[\222g\135", _pubProps = [PropResponseInformation
// "!mQ\NUL\213\194T\222",PropAuthenticationData
// "L\185\136R\252E\189\233\220\193\SYN;\182\234\239[\188\&1\171\143%\144\242",PropReceiveMaximum 4689,PropResponseTopic
// "\CANgB#\ENQz\195$\SOH\221\164M\STXa\203d8K*",PropSharedSubscriptionAvailable 169,PropMaximumPacketSize
// 5137,PropRequestProblemInformation 210,PropResponseTopic
// "\185$\SO\155\135\151\DLE\ETB\178#\200\\\210\216\SOH\197u\CAN'\n\224\206",PropUserProperty
// "l6\149r\NAK\188\191~\155\128@8c\245\\'\144\169\231"
// "\\\204E\175\SI\156\150XH\185\247\254\RSy",PropSessionExpiryInterval 8146,PropReasonString
// "s\221@M\SI\254",PropReceiveMaximum 14585,PropUserProperty ")H\207\234P\197Pv"
// "s8tQ\163QX\SUB\171\223\149\178\248H\a\243\136\163\183",PropMessageExpiryInterval 11331,PropReasonString
// "(R!\207\172E*-\192\184\227",PropWillDelayInterval 23672]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x3a, 0xe9, 0x1,  0x0,  0x4,  0xc,  0x6e, 0x29, 0x1e, 0x15, 0x7b, 0xcf, 0x1,  0x1a, 0x0,  0x8,  0x21,
                   0x6d, 0x51, 0x0,  0xd5, 0xc2, 0x54, 0xde, 0x16, 0x0,  0x17, 0x4c, 0xb9, 0x88, 0x52, 0xfc, 0x45, 0xbd,
                   0xe9, 0xdc, 0xc1, 0x16, 0x3b, 0xb6, 0xea, 0xef, 0x5b, 0xbc, 0x31, 0xab, 0x8f, 0x25, 0x90, 0xf2, 0x21,
                   0x12, 0x51, 0x8,  0x0,  0x13, 0x18, 0x67, 0x42, 0x23, 0x5,  0x7a, 0xc3, 0x24, 0x1,  0xdd, 0xa4, 0x4d,
                   0x2,  0x61, 0xcb, 0x64, 0x38, 0x4b, 0x2a, 0x2a, 0xa9, 0x27, 0x0,  0x0,  0x14, 0x11, 0x17, 0xd2, 0x8,
                   0x0,  0x16, 0xb9, 0x24, 0xe,  0x9b, 0x87, 0x97, 0x10, 0x17, 0xb2, 0x23, 0xc8, 0x5c, 0xd2, 0xd8, 0x1,
                   0xc5, 0x75, 0x18, 0x27, 0xa,  0xe0, 0xce, 0x26, 0x0,  0x13, 0x6c, 0x36, 0x95, 0x72, 0x15, 0xbc, 0xbf,
                   0x7e, 0x9b, 0x80, 0x40, 0x38, 0x63, 0xf5, 0x5c, 0x27, 0x90, 0xa9, 0xe7, 0x0,  0xe,  0x5c, 0xcc, 0x45,
                   0xaf, 0xf,  0x9c, 0x96, 0x58, 0x48, 0xb9, 0xf7, 0xfe, 0x1e, 0x79, 0x11, 0x0,  0x0,  0x1f, 0xd2, 0x1f,
                   0x0,  0x6,  0x73, 0xdd, 0x40, 0x4d, 0xf,  0xfe, 0x21, 0x38, 0xf9, 0x26, 0x0,  0x8,  0x29, 0x48, 0xcf,
                   0xea, 0x50, 0xc5, 0x50, 0x76, 0x0,  0x13, 0x73, 0x38, 0x74, 0x51, 0xa3, 0x51, 0x58, 0x1a, 0xab, 0xdf,
                   0x95, 0xb2, 0xf8, 0x48, 0x7,  0xf3, 0x88, 0xa3, 0xb7, 0x2,  0x0,  0x0,  0x2c, 0x43, 0x1f, 0x0,  0xb,
                   0x28, 0x52, 0x21, 0xcf, 0xac, 0x45, 0x2a, 0x2d, 0xc0, 0xb8, 0xe3, 0x18, 0x0,  0x0,  0x5c, 0x78, 0x9c,
                   0x49, 0x1a, 0xe7, 0xec, 0x62, 0x5,  0x89, 0xed, 0xd,  0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc, 0x6e, 0x29, 0x1e};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9c, 0x49, 0x1a, 0xe7, 0xec, 0x62, 0x5,  0x89,
                              0xed, 0xd,  0x15, 0x3a, 0x5b, 0xde, 0x67, 0x87};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 5499);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\213\v\236\218d\193\162h[\237\155\196\145\159\198g\146\138\155\197\164", _pubPktID = 0, _pubBody =
// "\189\233\193\r`$@\171\DC1\230\203j\203\187J\148oG\177\155\SUB\253\232\211\t\DC4#\230", _pubProps =
// [PropAssignedClientIdentifier "\189Q\242\130\236\n\SI\134\185\171",PropReasonString
// "\131y\173\229O\161\156\238\EM\233\174\174\DC1\FS\DLEQ\158",PropCorrelationData
// "Yz\DC3]\196RY\139y3\194\252\&7\v\221\b\192\228\170\251\132\200\200",PropAuthenticationMethod
// "\243\133e\207\EOT,\198\&3S\151\225\222\US\161f",PropAssignedClientIdentifier
// "\200\195-\140+\SYN#U\249\153",PropAuthenticationMethod ">\211\231Y\154\190XNa)",PropWillDelayInterval
// 21746,PropServerReference "\DC2\150\230P%",PropAuthenticationData "4Up\210\193a",PropSubscriptionIdentifier
// 17,PropMessageExpiryInterval 29495,PropWildcardSubscriptionAvailable 235,PropMessageExpiryInterval
// 30240,PropWildcardSubscriptionAvailable 67,PropAuthenticationData
// "\ETB\141@\176,\234B\164t]l\US\232\RS)\\\SUB\175:,\221Jg>",PropRequestResponseInformation 169,PropServerReference
// "7\\\156U\140b\ESC\248",PropReceiveMaximum 29471,PropAuthenticationData "\149\152\199\&2-8M\229\209\182U\137\241"]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x38, 0xfd, 0x1,  0x0,  0x15, 0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed, 0x9b, 0xc4, 0x91, 0x9f,
      0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4, 0xc8, 0x1,  0x12, 0x0,  0xa,  0xbd, 0x51, 0xf2, 0x82, 0xec, 0xa,  0xf,
      0x86, 0xb9, 0xab, 0x1f, 0x0,  0x11, 0x83, 0x79, 0xad, 0xe5, 0x4f, 0xa1, 0x9c, 0xee, 0x19, 0xe9, 0xae, 0xae, 0x11,
      0x1c, 0x10, 0x51, 0x9e, 0x9,  0x0,  0x17, 0x59, 0x7a, 0x13, 0x5d, 0xc4, 0x52, 0x59, 0x8b, 0x79, 0x33, 0xc2, 0xfc,
      0x37, 0xb,  0xdd, 0x8,  0xc0, 0xe4, 0xaa, 0xfb, 0x84, 0xc8, 0xc8, 0x15, 0x0,  0xf,  0xf3, 0x85, 0x65, 0xcf, 0x4,
      0x2c, 0xc6, 0x33, 0x53, 0x97, 0xe1, 0xde, 0x1f, 0xa1, 0x66, 0x12, 0x0,  0xa,  0xc8, 0xc3, 0x2d, 0x8c, 0x2b, 0x16,
      0x23, 0x55, 0xf9, 0x99, 0x15, 0x0,  0xa,  0x3e, 0xd3, 0xe7, 0x59, 0x9a, 0xbe, 0x58, 0x4e, 0x61, 0x29, 0x18, 0x0,
      0x0,  0x54, 0xf2, 0x1c, 0x0,  0x5,  0x12, 0x96, 0xe6, 0x50, 0x25, 0x16, 0x0,  0x6,  0x34, 0x55, 0x70, 0xd2, 0xc1,
      0x61, 0xb,  0x11, 0x2,  0x0,  0x0,  0x73, 0x37, 0x28, 0xeb, 0x2,  0x0,  0x0,  0x76, 0x20, 0x28, 0x43, 0x16, 0x0,
      0x18, 0x17, 0x8d, 0x40, 0xb0, 0x2c, 0xea, 0x42, 0xa4, 0x74, 0x5d, 0x6c, 0x1f, 0xe8, 0x1e, 0x29, 0x5c, 0x1a, 0xaf,
      0x3a, 0x2c, 0xdd, 0x4a, 0x67, 0x3e, 0x19, 0xa9, 0x1c, 0x0,  0x8,  0x37, 0x5c, 0x9c, 0x55, 0x8c, 0x62, 0x1b, 0xf8,
      0x21, 0x73, 0x1f, 0x16, 0x0,  0xd,  0x95, 0x98, 0xc7, 0x32, 0x2d, 0x38, 0x4d, 0xe5, 0xd1, 0xb6, 0x55, 0x89, 0xf1,
      0xbd, 0xe9, 0xc1, 0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb, 0x4a, 0x94, 0x6f, 0x47, 0xb1,
      0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  uint8_t topic_bytes[] = {0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed, 0x9b,
                           0xc4, 0x91, 0x9f, 0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbd, 0xe9, 0xc1, 0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb,
                         0x4a, 0x94, 0x6f, 0x47, 0xb1, 0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0xbd, 0x51, 0xf2, 0x82, 0xec, 0xa, 0xf, 0x86, 0xb9, 0xab};
  uint8_t bytesprops1[] = {0x83, 0x79, 0xad, 0xe5, 0x4f, 0xa1, 0x9c, 0xee, 0x19,
                           0xe9, 0xae, 0xae, 0x11, 0x1c, 0x10, 0x51, 0x9e};
  uint8_t bytesprops2[] = {0x59, 0x7a, 0x13, 0x5d, 0xc4, 0x52, 0x59, 0x8b, 0x79, 0x33, 0xc2, 0xfc,
                           0x37, 0xb,  0xdd, 0x8,  0xc0, 0xe4, 0xaa, 0xfb, 0x84, 0xc8, 0xc8};
  uint8_t bytesprops3[] = {0xf3, 0x85, 0x65, 0xcf, 0x4, 0x2c, 0xc6, 0x33, 0x53, 0x97, 0xe1, 0xde, 0x1f, 0xa1, 0x66};
  uint8_t bytesprops4[] = {0xc8, 0xc3, 0x2d, 0x8c, 0x2b, 0x16, 0x23, 0x55, 0xf9, 0x99};
  uint8_t bytesprops5[] = {0x3e, 0xd3, 0xe7, 0x59, 0x9a, 0xbe, 0x58, 0x4e, 0x61, 0x29};
  uint8_t bytesprops6[] = {0x12, 0x96, 0xe6, 0x50, 0x25};
  uint8_t bytesprops7[] = {0x34, 0x55, 0x70, 0xd2, 0xc1, 0x61};
  uint8_t bytesprops8[] = {0x17, 0x8d, 0x40, 0xb0, 0x2c, 0xea, 0x42, 0xa4, 0x74, 0x5d, 0x6c, 0x1f,
                           0xe8, 0x1e, 0x29, 0x5c, 0x1a, 0xaf, 0x3a, 0x2c, 0xdd, 0x4a, 0x67, 0x3e};
  uint8_t bytesprops9[] = {0x37, 0x5c, 0x9c, 0x55, 0x8c, 0x62, 0x1b, 0xf8};
  uint8_t bytesprops10[] = {0x95, 0x98, 0xc7, 0x32, 0x2d, 0x38, 0x4d, 0xe5, 0xd1, 0xb6, 0x55, 0x89, 0xf1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21746}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29495}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30240}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29471}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\213\v\236\218d\193\162h[\237\155\196\145\159\198g\146\138\155\197\164", _pubPktID = 0, _pubBody =
// "\189\233\193\r`$@\171\DC1\230\203j\203\187J\148oG\177\155\SUB\253\232\211\t\DC4#\230", _pubProps =
// [PropAssignedClientIdentifier "\189Q\242\130\236\n\SI\134\185\171",PropReasonString
// "\131y\173\229O\161\156\238\EM\233\174\174\DC1\FS\DLEQ\158",PropCorrelationData
// "Yz\DC3]\196RY\139y3\194\252\&7\v\221\b\192\228\170\251\132\200\200",PropAuthenticationMethod
// "\243\133e\207\EOT,\198\&3S\151\225\222\US\161f",PropAssignedClientIdentifier
// "\200\195-\140+\SYN#U\249\153",PropAuthenticationMethod ">\211\231Y\154\190XNa)",PropWillDelayInterval
// 21746,PropServerReference "\DC2\150\230P%",PropAuthenticationData "4Up\210\193a",PropSubscriptionIdentifier
// 17,PropMessageExpiryInterval 29495,PropWildcardSubscriptionAvailable 235,PropMessageExpiryInterval
// 30240,PropWildcardSubscriptionAvailable 67,PropAuthenticationData
// "\ETB\141@\176,\234B\164t]l\US\232\RS)\\\SUB\175:,\221Jg>",PropRequestResponseInformation 169,PropServerReference
// "7\\\156U\140b\ESC\248",PropReceiveMaximum 29471,PropAuthenticationData "\149\152\199\&2-8M\229\209\182U\137\241"]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {
      0x38, 0xfd, 0x1,  0x0,  0x15, 0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed, 0x9b, 0xc4, 0x91, 0x9f,
      0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4, 0xc8, 0x1,  0x12, 0x0,  0xa,  0xbd, 0x51, 0xf2, 0x82, 0xec, 0xa,  0xf,
      0x86, 0xb9, 0xab, 0x1f, 0x0,  0x11, 0x83, 0x79, 0xad, 0xe5, 0x4f, 0xa1, 0x9c, 0xee, 0x19, 0xe9, 0xae, 0xae, 0x11,
      0x1c, 0x10, 0x51, 0x9e, 0x9,  0x0,  0x17, 0x59, 0x7a, 0x13, 0x5d, 0xc4, 0x52, 0x59, 0x8b, 0x79, 0x33, 0xc2, 0xfc,
      0x37, 0xb,  0xdd, 0x8,  0xc0, 0xe4, 0xaa, 0xfb, 0x84, 0xc8, 0xc8, 0x15, 0x0,  0xf,  0xf3, 0x85, 0x65, 0xcf, 0x4,
      0x2c, 0xc6, 0x33, 0x53, 0x97, 0xe1, 0xde, 0x1f, 0xa1, 0x66, 0x12, 0x0,  0xa,  0xc8, 0xc3, 0x2d, 0x8c, 0x2b, 0x16,
      0x23, 0x55, 0xf9, 0x99, 0x15, 0x0,  0xa,  0x3e, 0xd3, 0xe7, 0x59, 0x9a, 0xbe, 0x58, 0x4e, 0x61, 0x29, 0x18, 0x0,
      0x0,  0x54, 0xf2, 0x1c, 0x0,  0x5,  0x12, 0x96, 0xe6, 0x50, 0x25, 0x16, 0x0,  0x6,  0x34, 0x55, 0x70, 0xd2, 0xc1,
      0x61, 0xb,  0x11, 0x2,  0x0,  0x0,  0x73, 0x37, 0x28, 0xeb, 0x2,  0x0,  0x0,  0x76, 0x20, 0x28, 0x43, 0x16, 0x0,
      0x18, 0x17, 0x8d, 0x40, 0xb0, 0x2c, 0xea, 0x42, 0xa4, 0x74, 0x5d, 0x6c, 0x1f, 0xe8, 0x1e, 0x29, 0x5c, 0x1a, 0xaf,
      0x3a, 0x2c, 0xdd, 0x4a, 0x67, 0x3e, 0x19, 0xa9, 0x1c, 0x0,  0x8,  0x37, 0x5c, 0x9c, 0x55, 0x8c, 0x62, 0x1b, 0xf8,
      0x21, 0x73, 0x1f, 0x16, 0x0,  0xd,  0x95, 0x98, 0xc7, 0x32, 0x2d, 0x38, 0x4d, 0xe5, 0xd1, 0xb6, 0x55, 0x89, 0xf1,
      0xbd, 0xe9, 0xc1, 0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb, 0x4a, 0x94, 0x6f, 0x47, 0xb1,
      0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xd5, 0xb,  0xec, 0xda, 0x64, 0xc1, 0xa2, 0x68, 0x5b, 0xed, 0x9b,
                               0xc4, 0x91, 0x9f, 0xc6, 0x67, 0x92, 0x8a, 0x9b, 0xc5, 0xa4};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbd, 0xe9, 0xc1, 0xd,  0x60, 0x24, 0x40, 0xab, 0x11, 0xe6, 0xcb, 0x6a, 0xcb, 0xbb,
                              0x4a, 0x94, 0x6f, 0x47, 0xb1, 0x9b, 0x1a, 0xfd, 0xe8, 0xd3, 0x9,  0x14, 0x23, 0xe6};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "=\249\252\228\210\187\154\150C8*\146,\US8\152\128\152", _pubPktID = 8421, _pubBody =
// "4O\FS\186T\238#\USg\NULl\152\154\239\249\SUB2>H#\188", _pubProps = [PropReasonString
// "\191\&3j\158\NUL%\255\ACK\a\180^\EOT\b\211 &H\239\168\"\229X",PropSessionExpiryInterval 27418,PropWillDelayInterval
// 22825,PropRetainAvailable 208,PropSharedSubscriptionAvailable 195,PropSubscriptionIdentifierAvailable
// 100,PropReasonString "
// r\155\221\NUL\139!\219\DC3\153\178|\160\248\210M5!\201\155\bV\232T\144I-",PropPayloadFormatIndicator
// 140,PropUserProperty "@R\"\149\188\183\140\161l\133\175,\249\230\EM\159\141+^\172Ncp\SII'\179*"
// "\218\251\177\193\218b\EM\250\"\222)\192Dx\180\DC2]\179\245\222\246}\135\169\171\152\n\240t",PropSubscriptionIdentifier
// 0,PropAssignedClientIdentifier "|'G\210\215\153\210\203\248\210@\152Ih\NAK90\205q\161&",PropAuthenticationData
// "\RSk%'\253\241",PropAuthenticationMethod "\190",PropAuthenticationData
// "\248k\129\199\250\US\198\\f\158\190\213\144Q\245~\166\205+\\m%\179\"i\\\191",PropAuthenticationData
// "\146\ESC\DLE\152E\151\228u\214_\214EW\143-\219U(df\186\DC1\ETX\208\230O",PropUserProperty
// "\171\235{\242q\162\178E\209\193\136*\195I\151e\177L\165\164\179\b~<pK\ENQ,\253k"
// "\129\129Zjfv\"l\226\184\202\157\186\181NF\190#\221\SUB",PropMessageExpiryInterval 18159,PropReceiveMaximum
// 860,PropMaximumQoS 17,PropMessageExpiryInterval 32091,PropReceiveMaximum 15944,PropCorrelationData
// "\222\188[IIf",PropContentType
// "z\166r\130\148\NUL\193\225\208\226c\145\247=\194C\\p%z\137#\247\164tds\211\187d",PropAssignedClientIdentifier
// "\216\241c\245\233\196W\182d&\137z\ACKY\179V\"f\173Q\242\215"]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x32, 0xa2, 0x3,  0x0,  0x12, 0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43, 0x38, 0x2a, 0x92, 0x2c, 0x1f,
      0x38, 0x98, 0x80, 0x98, 0x20, 0xe5, 0xf5, 0x2,  0x1f, 0x0,  0x16, 0xbf, 0x33, 0x6a, 0x9e, 0x0,  0x25, 0xff, 0x6,
      0x7,  0xb4, 0x5e, 0x4,  0x8,  0xd3, 0x20, 0x26, 0x48, 0xef, 0xa8, 0x22, 0xe5, 0x58, 0x11, 0x0,  0x0,  0x6b, 0x1a,
      0x18, 0x0,  0x0,  0x59, 0x29, 0x25, 0xd0, 0x2a, 0xc3, 0x29, 0x64, 0x1f, 0x0,  0x1b, 0x20, 0x72, 0x9b, 0xdd, 0x0,
      0x8b, 0x21, 0xdb, 0x13, 0x99, 0xb2, 0x7c, 0xa0, 0xf8, 0xd2, 0x4d, 0x35, 0x21, 0xc9, 0x9b, 0x8,  0x56, 0xe8, 0x54,
      0x90, 0x49, 0x2d, 0x1,  0x8c, 0x26, 0x0,  0x1c, 0x40, 0x52, 0x22, 0x95, 0xbc, 0xb7, 0x8c, 0xa1, 0x6c, 0x85, 0xaf,
      0x2c, 0xf9, 0xe6, 0x19, 0x9f, 0x8d, 0x2b, 0x5e, 0xac, 0x4e, 0x63, 0x70, 0xf,  0x49, 0x27, 0xb3, 0x2a, 0x0,  0x1d,
      0xda, 0xfb, 0xb1, 0xc1, 0xda, 0x62, 0x19, 0xfa, 0x22, 0xde, 0x29, 0xc0, 0x44, 0x78, 0xb4, 0x12, 0x5d, 0xb3, 0xf5,
      0xde, 0xf6, 0x7d, 0x87, 0xa9, 0xab, 0x98, 0xa,  0xf0, 0x74, 0xb,  0x0,  0x12, 0x0,  0x15, 0x7c, 0x27, 0x47, 0xd2,
      0xd7, 0x99, 0xd2, 0xcb, 0xf8, 0xd2, 0x40, 0x98, 0x49, 0x68, 0x15, 0x39, 0x30, 0xcd, 0x71, 0xa1, 0x26, 0x16, 0x0,
      0x6,  0x1e, 0x6b, 0x25, 0x27, 0xfd, 0xf1, 0x15, 0x0,  0x1,  0xbe, 0x16, 0x0,  0x1b, 0xf8, 0x6b, 0x81, 0xc7, 0xfa,
      0x1f, 0xc6, 0x5c, 0x66, 0x9e, 0xbe, 0xd5, 0x90, 0x51, 0xf5, 0x7e, 0xa6, 0xcd, 0x2b, 0x5c, 0x6d, 0x25, 0xb3, 0x22,
      0x69, 0x5c, 0xbf, 0x16, 0x0,  0x1a, 0x92, 0x1b, 0x10, 0x98, 0x45, 0x97, 0xe4, 0x75, 0xd6, 0x5f, 0xd6, 0x45, 0x57,
      0x8f, 0x2d, 0xdb, 0x55, 0x28, 0x64, 0x66, 0xba, 0x11, 0x3,  0xd0, 0xe6, 0x4f, 0x26, 0x0,  0x1e, 0xab, 0xeb, 0x7b,
      0xf2, 0x71, 0xa2, 0xb2, 0x45, 0xd1, 0xc1, 0x88, 0x2a, 0xc3, 0x49, 0x97, 0x65, 0xb1, 0x4c, 0xa5, 0xa4, 0xb3, 0x8,
      0x7e, 0x3c, 0x70, 0x4b, 0x5,  0x2c, 0xfd, 0x6b, 0x0,  0x14, 0x81, 0x81, 0x5a, 0x6a, 0x66, 0x76, 0x22, 0x6c, 0xe2,
      0xb8, 0xca, 0x9d, 0xba, 0xb5, 0x4e, 0x46, 0xbe, 0x23, 0xdd, 0x1a, 0x2,  0x0,  0x0,  0x46, 0xef, 0x21, 0x3,  0x5c,
      0x24, 0x11, 0x2,  0x0,  0x0,  0x7d, 0x5b, 0x21, 0x3e, 0x48, 0x9,  0x0,  0x6,  0xde, 0xbc, 0x5b, 0x49, 0x49, 0x66,
      0x3,  0x0,  0x1e, 0x7a, 0xa6, 0x72, 0x82, 0x94, 0x0,  0xc1, 0xe1, 0xd0, 0xe2, 0x63, 0x91, 0xf7, 0x3d, 0xc2, 0x43,
      0x5c, 0x70, 0x25, 0x7a, 0x89, 0x23, 0xf7, 0xa4, 0x74, 0x64, 0x73, 0xd3, 0xbb, 0x64, 0x12, 0x0,  0x16, 0xd8, 0xf1,
      0x63, 0xf5, 0xe9, 0xc4, 0x57, 0xb6, 0x64, 0x26, 0x89, 0x7a, 0x6,  0x59, 0xb3, 0x56, 0x22, 0x66, 0xad, 0x51, 0xf2,
      0xd7, 0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee, 0x23, 0x1f, 0x67, 0x0,  0x6c, 0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e,
      0x48, 0x23, 0xbc};
  uint8_t topic_bytes[] = {0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43,
                           0x38, 0x2a, 0x92, 0x2c, 0x1f, 0x38, 0x98, 0x80, 0x98};
  lwmqtt_string_t topic = {18, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee, 0x23, 0x1f, 0x67, 0x0, 0x6c,
                         0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e, 0x48, 0x23, 0xbc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xbf, 0x33, 0x6a, 0x9e, 0x0,  0x25, 0xff, 0x6,  0x7,  0xb4, 0x5e,
                           0x4,  0x8,  0xd3, 0x20, 0x26, 0x48, 0xef, 0xa8, 0x22, 0xe5, 0x58};
  uint8_t bytesprops1[] = {0x20, 0x72, 0x9b, 0xdd, 0x0,  0x8b, 0x21, 0xdb, 0x13, 0x99, 0xb2, 0x7c, 0xa0, 0xf8,
                           0xd2, 0x4d, 0x35, 0x21, 0xc9, 0x9b, 0x8,  0x56, 0xe8, 0x54, 0x90, 0x49, 0x2d};
  uint8_t bytesprops3[] = {0xda, 0xfb, 0xb1, 0xc1, 0xda, 0x62, 0x19, 0xfa, 0x22, 0xde, 0x29, 0xc0, 0x44, 0x78, 0xb4,
                           0x12, 0x5d, 0xb3, 0xf5, 0xde, 0xf6, 0x7d, 0x87, 0xa9, 0xab, 0x98, 0xa,  0xf0, 0x74};
  uint8_t bytesprops2[] = {0x40, 0x52, 0x22, 0x95, 0xbc, 0xb7, 0x8c, 0xa1, 0x6c, 0x85, 0xaf, 0x2c, 0xf9, 0xe6,
                           0x19, 0x9f, 0x8d, 0x2b, 0x5e, 0xac, 0x4e, 0x63, 0x70, 0xf,  0x49, 0x27, 0xb3, 0x2a};
  uint8_t bytesprops4[] = {0x7c, 0x27, 0x47, 0xd2, 0xd7, 0x99, 0xd2, 0xcb, 0xf8, 0xd2, 0x40,
                           0x98, 0x49, 0x68, 0x15, 0x39, 0x30, 0xcd, 0x71, 0xa1, 0x26};
  uint8_t bytesprops5[] = {0x1e, 0x6b, 0x25, 0x27, 0xfd, 0xf1};
  uint8_t bytesprops6[] = {0xbe};
  uint8_t bytesprops7[] = {0xf8, 0x6b, 0x81, 0xc7, 0xfa, 0x1f, 0xc6, 0x5c, 0x66, 0x9e, 0xbe, 0xd5, 0x90, 0x51,
                           0xf5, 0x7e, 0xa6, 0xcd, 0x2b, 0x5c, 0x6d, 0x25, 0xb3, 0x22, 0x69, 0x5c, 0xbf};
  uint8_t bytesprops8[] = {0x92, 0x1b, 0x10, 0x98, 0x45, 0x97, 0xe4, 0x75, 0xd6, 0x5f, 0xd6, 0x45, 0x57,
                           0x8f, 0x2d, 0xdb, 0x55, 0x28, 0x64, 0x66, 0xba, 0x11, 0x3,  0xd0, 0xe6, 0x4f};
  uint8_t bytesprops10[] = {0x81, 0x81, 0x5a, 0x6a, 0x66, 0x76, 0x22, 0x6c, 0xe2, 0xb8,
                            0xca, 0x9d, 0xba, 0xb5, 0x4e, 0x46, 0xbe, 0x23, 0xdd, 0x1a};
  uint8_t bytesprops9[] = {0xab, 0xeb, 0x7b, 0xf2, 0x71, 0xa2, 0xb2, 0x45, 0xd1, 0xc1, 0x88, 0x2a, 0xc3, 0x49, 0x97,
                           0x65, 0xb1, 0x4c, 0xa5, 0xa4, 0xb3, 0x8,  0x7e, 0x3c, 0x70, 0x4b, 0x5,  0x2c, 0xfd, 0x6b};
  uint8_t bytesprops11[] = {0xde, 0xbc, 0x5b, 0x49, 0x49, 0x66};
  uint8_t bytesprops12[] = {0x7a, 0xa6, 0x72, 0x82, 0x94, 0x0,  0xc1, 0xe1, 0xd0, 0xe2, 0x63, 0x91, 0xf7, 0x3d, 0xc2,
                            0x43, 0x5c, 0x70, 0x25, 0x7a, 0x89, 0x23, 0xf7, 0xa4, 0x74, 0x64, 0x73, 0xd3, 0xbb, 0x64};
  uint8_t bytesprops13[] = {0xd8, 0xf1, 0x63, 0xf5, 0xe9, 0xc4, 0x57, 0xb6, 0x64, 0x26, 0x89,
                            0x7a, 0x6,  0x59, 0xb3, 0x56, 0x22, 0x66, 0xad, 0x51, 0xf2, 0xd7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27418}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22825}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops2}, .v = {29, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops9}, .v = {20, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18159}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 860}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32091}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15944}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 8421, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "=\249\252\228\210\187\154\150C8*\146,\US8\152\128\152", _pubPktID = 8421, _pubBody =
// "4O\FS\186T\238#\USg\NULl\152\154\239\249\SUB2>H#\188", _pubProps = [PropReasonString
// "\191\&3j\158\NUL%\255\ACK\a\180^\EOT\b\211 &H\239\168\"\229X",PropSessionExpiryInterval 27418,PropWillDelayInterval
// 22825,PropRetainAvailable 208,PropSharedSubscriptionAvailable 195,PropSubscriptionIdentifierAvailable
// 100,PropReasonString "
// r\155\221\NUL\139!\219\DC3\153\178|\160\248\210M5!\201\155\bV\232T\144I-",PropPayloadFormatIndicator
// 140,PropUserProperty "@R\"\149\188\183\140\161l\133\175,\249\230\EM\159\141+^\172Ncp\SII'\179*"
// "\218\251\177\193\218b\EM\250\"\222)\192Dx\180\DC2]\179\245\222\246}\135\169\171\152\n\240t",PropSubscriptionIdentifier
// 0,PropAssignedClientIdentifier "|'G\210\215\153\210\203\248\210@\152Ih\NAK90\205q\161&",PropAuthenticationData
// "\RSk%'\253\241",PropAuthenticationMethod "\190",PropAuthenticationData
// "\248k\129\199\250\US\198\\f\158\190\213\144Q\245~\166\205+\\m%\179\"i\\\191",PropAuthenticationData
// "\146\ESC\DLE\152E\151\228u\214_\214EW\143-\219U(df\186\DC1\ETX\208\230O",PropUserProperty
// "\171\235{\242q\162\178E\209\193\136*\195I\151e\177L\165\164\179\b~<pK\ENQ,\253k"
// "\129\129Zjfv\"l\226\184\202\157\186\181NF\190#\221\SUB",PropMessageExpiryInterval 18159,PropReceiveMaximum
// 860,PropMaximumQoS 17,PropMessageExpiryInterval 32091,PropReceiveMaximum 15944,PropCorrelationData
// "\222\188[IIf",PropContentType
// "z\166r\130\148\NUL\193\225\208\226c\145\247=\194C\\p%z\137#\247\164tds\211\187d",PropAssignedClientIdentifier
// "\216\241c\245\233\196W\182d&\137z\ACKY\179V\"f\173Q\242\215"]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {
      0x32, 0xa2, 0x3,  0x0,  0x12, 0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43, 0x38, 0x2a, 0x92, 0x2c, 0x1f,
      0x38, 0x98, 0x80, 0x98, 0x20, 0xe5, 0xf5, 0x2,  0x1f, 0x0,  0x16, 0xbf, 0x33, 0x6a, 0x9e, 0x0,  0x25, 0xff, 0x6,
      0x7,  0xb4, 0x5e, 0x4,  0x8,  0xd3, 0x20, 0x26, 0x48, 0xef, 0xa8, 0x22, 0xe5, 0x58, 0x11, 0x0,  0x0,  0x6b, 0x1a,
      0x18, 0x0,  0x0,  0x59, 0x29, 0x25, 0xd0, 0x2a, 0xc3, 0x29, 0x64, 0x1f, 0x0,  0x1b, 0x20, 0x72, 0x9b, 0xdd, 0x0,
      0x8b, 0x21, 0xdb, 0x13, 0x99, 0xb2, 0x7c, 0xa0, 0xf8, 0xd2, 0x4d, 0x35, 0x21, 0xc9, 0x9b, 0x8,  0x56, 0xe8, 0x54,
      0x90, 0x49, 0x2d, 0x1,  0x8c, 0x26, 0x0,  0x1c, 0x40, 0x52, 0x22, 0x95, 0xbc, 0xb7, 0x8c, 0xa1, 0x6c, 0x85, 0xaf,
      0x2c, 0xf9, 0xe6, 0x19, 0x9f, 0x8d, 0x2b, 0x5e, 0xac, 0x4e, 0x63, 0x70, 0xf,  0x49, 0x27, 0xb3, 0x2a, 0x0,  0x1d,
      0xda, 0xfb, 0xb1, 0xc1, 0xda, 0x62, 0x19, 0xfa, 0x22, 0xde, 0x29, 0xc0, 0x44, 0x78, 0xb4, 0x12, 0x5d, 0xb3, 0xf5,
      0xde, 0xf6, 0x7d, 0x87, 0xa9, 0xab, 0x98, 0xa,  0xf0, 0x74, 0xb,  0x0,  0x12, 0x0,  0x15, 0x7c, 0x27, 0x47, 0xd2,
      0xd7, 0x99, 0xd2, 0xcb, 0xf8, 0xd2, 0x40, 0x98, 0x49, 0x68, 0x15, 0x39, 0x30, 0xcd, 0x71, 0xa1, 0x26, 0x16, 0x0,
      0x6,  0x1e, 0x6b, 0x25, 0x27, 0xfd, 0xf1, 0x15, 0x0,  0x1,  0xbe, 0x16, 0x0,  0x1b, 0xf8, 0x6b, 0x81, 0xc7, 0xfa,
      0x1f, 0xc6, 0x5c, 0x66, 0x9e, 0xbe, 0xd5, 0x90, 0x51, 0xf5, 0x7e, 0xa6, 0xcd, 0x2b, 0x5c, 0x6d, 0x25, 0xb3, 0x22,
      0x69, 0x5c, 0xbf, 0x16, 0x0,  0x1a, 0x92, 0x1b, 0x10, 0x98, 0x45, 0x97, 0xe4, 0x75, 0xd6, 0x5f, 0xd6, 0x45, 0x57,
      0x8f, 0x2d, 0xdb, 0x55, 0x28, 0x64, 0x66, 0xba, 0x11, 0x3,  0xd0, 0xe6, 0x4f, 0x26, 0x0,  0x1e, 0xab, 0xeb, 0x7b,
      0xf2, 0x71, 0xa2, 0xb2, 0x45, 0xd1, 0xc1, 0x88, 0x2a, 0xc3, 0x49, 0x97, 0x65, 0xb1, 0x4c, 0xa5, 0xa4, 0xb3, 0x8,
      0x7e, 0x3c, 0x70, 0x4b, 0x5,  0x2c, 0xfd, 0x6b, 0x0,  0x14, 0x81, 0x81, 0x5a, 0x6a, 0x66, 0x76, 0x22, 0x6c, 0xe2,
      0xb8, 0xca, 0x9d, 0xba, 0xb5, 0x4e, 0x46, 0xbe, 0x23, 0xdd, 0x1a, 0x2,  0x0,  0x0,  0x46, 0xef, 0x21, 0x3,  0x5c,
      0x24, 0x11, 0x2,  0x0,  0x0,  0x7d, 0x5b, 0x21, 0x3e, 0x48, 0x9,  0x0,  0x6,  0xde, 0xbc, 0x5b, 0x49, 0x49, 0x66,
      0x3,  0x0,  0x1e, 0x7a, 0xa6, 0x72, 0x82, 0x94, 0x0,  0xc1, 0xe1, 0xd0, 0xe2, 0x63, 0x91, 0xf7, 0x3d, 0xc2, 0x43,
      0x5c, 0x70, 0x25, 0x7a, 0x89, 0x23, 0xf7, 0xa4, 0x74, 0x64, 0x73, 0xd3, 0xbb, 0x64, 0x12, 0x0,  0x16, 0xd8, 0xf1,
      0x63, 0xf5, 0xe9, 0xc4, 0x57, 0xb6, 0x64, 0x26, 0x89, 0x7a, 0x6,  0x59, 0xb3, 0x56, 0x22, 0x66, 0xad, 0x51, 0xf2,
      0xd7, 0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee, 0x23, 0x1f, 0x67, 0x0,  0x6c, 0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e,
      0x48, 0x23, 0xbc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3d, 0xf9, 0xfc, 0xe4, 0xd2, 0xbb, 0x9a, 0x96, 0x43,
                               0x38, 0x2a, 0x92, 0x2c, 0x1f, 0x38, 0x98, 0x80, 0x98};
  lwmqtt_string_t exp_topic = {18, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x34, 0x4f, 0x1c, 0xba, 0x54, 0xee, 0x23, 0x1f, 0x67, 0x0, 0x6c,
                              0x98, 0x9a, 0xef, 0xf9, 0x1a, 0x32, 0x3e, 0x48, 0x23, 0xbc};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 8421);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 18);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\SO\191\141\159\DC1$vw", _pubPktID =
// 301, _pubBody = "`\195\&7\ESC_\216\219\237?~,\244", _pubProps = [PropRequestProblemInformation
// 64,PropAuthenticationMethod "\195(Y\170_\225oG\251\178\174",PropSubscriptionIdentifier 23,PropAuthenticationMethod
// "&+E\184\152\135P",PropRequestResponseInformation 211,PropCorrelationData
// "\209\236W\234V0\EM\GS`\168[\NUL",PropSessionExpiryInterval 22216,PropPayloadFormatIndicator 110,PropTopicAlias
// 1570,PropContentType "\190J]\222\198tA\254Y\135\152D\175\DEL\214\217\135h\225",PropMessageExpiryInterval
// 13095,PropContentType "\t{\ACK\234?/\240[\ESC\141\&5b\181\238t\170u\154\176",PropContentType
// "\ESC\USR\241\&4\134\&7\167\RSWIJMl4)S\204\SO_\\\152\173\192",PropRequestProblemInformation 132,PropResponseTopic
// "f\ETB\177\135\237\ETX\NAKb6\166\162\167,Mke\165",PropResponseInformation
// "\f\237-'\145\&7#\145\177\148X",PropServerReference
// "\178,m}\251I\185\250\EM;}d>T(p\253\226\NUL80\141B\r6",PropReceiveMaximum 30594,PropTopicAlias
// 26876,PropWildcardSubscriptionAvailable 211,PropRequestResponseInformation 173,PropMaximumPacketSize
// 2974,PropReceiveMaximum 6700,PropRequestResponseInformation 193,PropTopicAlias 29250,PropAuthenticationData
// "]\240\151\162\&3\175\154\202\221\RS>8\SOH\247c \209\240j\162\191",PropServerReference
// "PQ$\158l\254\DC1",PropMessageExpiryInterval 31929,PropSessionExpiryInterval 31705,PropAssignedClientIdentifier
// "\153\139\247\160\179\134uyzk\243i_H7\r\255\STXg\189(\v"]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x3b, 0xb9, 0x2,  0x0,  0x8,  0xe,  0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77, 0x1,  0x2d, 0x9f, 0x2,  0x17, 0x40,
      0x15, 0x0,  0xb,  0xc3, 0x28, 0x59, 0xaa, 0x5f, 0xe1, 0x6f, 0x47, 0xfb, 0xb2, 0xae, 0xb,  0x17, 0x15, 0x0,  0x7,
      0x26, 0x2b, 0x45, 0xb8, 0x98, 0x87, 0x50, 0x19, 0xd3, 0x9,  0x0,  0xc,  0xd1, 0xec, 0x57, 0xea, 0x56, 0x30, 0x19,
      0x1d, 0x60, 0xa8, 0x5b, 0x0,  0x11, 0x0,  0x0,  0x56, 0xc8, 0x1,  0x6e, 0x23, 0x6,  0x22, 0x3,  0x0,  0x13, 0xbe,
      0x4a, 0x5d, 0xde, 0xc6, 0x74, 0x41, 0xfe, 0x59, 0x87, 0x98, 0x44, 0xaf, 0x7f, 0xd6, 0xd9, 0x87, 0x68, 0xe1, 0x2,
      0x0,  0x0,  0x33, 0x27, 0x3,  0x0,  0x13, 0x9,  0x7b, 0x6,  0xea, 0x3f, 0x2f, 0xf0, 0x5b, 0x1b, 0x8d, 0x35, 0x62,
      0xb5, 0xee, 0x74, 0xaa, 0x75, 0x9a, 0xb0, 0x3,  0x0,  0x18, 0x1b, 0x1f, 0x52, 0xf1, 0x34, 0x86, 0x37, 0xa7, 0x1e,
      0x57, 0x49, 0x4a, 0x4d, 0x6c, 0x34, 0x29, 0x53, 0xcc, 0xe,  0x5f, 0x5c, 0x98, 0xad, 0xc0, 0x17, 0x84, 0x8,  0x0,
      0x11, 0x66, 0x17, 0xb1, 0x87, 0xed, 0x3,  0x15, 0x62, 0x36, 0xa6, 0xa2, 0xa7, 0x2c, 0x4d, 0x6b, 0x65, 0xa5, 0x1a,
      0x0,  0xb,  0xc,  0xed, 0x2d, 0x27, 0x91, 0x37, 0x23, 0x91, 0xb1, 0x94, 0x58, 0x1c, 0x0,  0x19, 0xb2, 0x2c, 0x6d,
      0x7d, 0xfb, 0x49, 0xb9, 0xfa, 0x19, 0x3b, 0x7d, 0x64, 0x3e, 0x54, 0x28, 0x70, 0xfd, 0xe2, 0x0,  0x38, 0x30, 0x8d,
      0x42, 0xd,  0x36, 0x21, 0x77, 0x82, 0x23, 0x68, 0xfc, 0x28, 0xd3, 0x19, 0xad, 0x27, 0x0,  0x0,  0xb,  0x9e, 0x21,
      0x1a, 0x2c, 0x19, 0xc1, 0x23, 0x72, 0x42, 0x16, 0x0,  0x15, 0x5d, 0xf0, 0x97, 0xa2, 0x33, 0xaf, 0x9a, 0xca, 0xdd,
      0x1e, 0x3e, 0x38, 0x1,  0xf7, 0x63, 0x20, 0xd1, 0xf0, 0x6a, 0xa2, 0xbf, 0x1c, 0x0,  0x7,  0x50, 0x51, 0x24, 0x9e,
      0x6c, 0xfe, 0x11, 0x2,  0x0,  0x0,  0x7c, 0xb9, 0x11, 0x0,  0x0,  0x7b, 0xd9, 0x12, 0x0,  0x16, 0x99, 0x8b, 0xf7,
      0xa0, 0xb3, 0x86, 0x75, 0x79, 0x7a, 0x6b, 0xf3, 0x69, 0x5f, 0x48, 0x37, 0xd,  0xff, 0x2,  0x67, 0xbd, 0x28, 0xb,
      0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  uint8_t topic_bytes[] = {0xe, 0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0xc3, 0x28, 0x59, 0xaa, 0x5f, 0xe1, 0x6f, 0x47, 0xfb, 0xb2, 0xae};
  uint8_t bytesprops1[] = {0x26, 0x2b, 0x45, 0xb8, 0x98, 0x87, 0x50};
  uint8_t bytesprops2[] = {0xd1, 0xec, 0x57, 0xea, 0x56, 0x30, 0x19, 0x1d, 0x60, 0xa8, 0x5b, 0x0};
  uint8_t bytesprops3[] = {0xbe, 0x4a, 0x5d, 0xde, 0xc6, 0x74, 0x41, 0xfe, 0x59, 0x87,
                           0x98, 0x44, 0xaf, 0x7f, 0xd6, 0xd9, 0x87, 0x68, 0xe1};
  uint8_t bytesprops4[] = {0x9,  0x7b, 0x6,  0xea, 0x3f, 0x2f, 0xf0, 0x5b, 0x1b, 0x8d,
                           0x35, 0x62, 0xb5, 0xee, 0x74, 0xaa, 0x75, 0x9a, 0xb0};
  uint8_t bytesprops5[] = {0x1b, 0x1f, 0x52, 0xf1, 0x34, 0x86, 0x37, 0xa7, 0x1e, 0x57, 0x49, 0x4a,
                           0x4d, 0x6c, 0x34, 0x29, 0x53, 0xcc, 0xe,  0x5f, 0x5c, 0x98, 0xad, 0xc0};
  uint8_t bytesprops6[] = {0x66, 0x17, 0xb1, 0x87, 0xed, 0x3,  0x15, 0x62, 0x36,
                           0xa6, 0xa2, 0xa7, 0x2c, 0x4d, 0x6b, 0x65, 0xa5};
  uint8_t bytesprops7[] = {0xc, 0xed, 0x2d, 0x27, 0x91, 0x37, 0x23, 0x91, 0xb1, 0x94, 0x58};
  uint8_t bytesprops8[] = {0xb2, 0x2c, 0x6d, 0x7d, 0xfb, 0x49, 0xb9, 0xfa, 0x19, 0x3b, 0x7d, 0x64, 0x3e,
                           0x54, 0x28, 0x70, 0xfd, 0xe2, 0x0,  0x38, 0x30, 0x8d, 0x42, 0xd,  0x36};
  uint8_t bytesprops9[] = {0x5d, 0xf0, 0x97, 0xa2, 0x33, 0xaf, 0x9a, 0xca, 0xdd, 0x1e, 0x3e,
                           0x38, 0x1,  0xf7, 0x63, 0x20, 0xd1, 0xf0, 0x6a, 0xa2, 0xbf};
  uint8_t bytesprops10[] = {0x50, 0x51, 0x24, 0x9e, 0x6c, 0xfe, 0x11};
  uint8_t bytesprops11[] = {0x99, 0x8b, 0xf7, 0xa0, 0xb3, 0x86, 0x75, 0x79, 0x7a, 0x6b, 0xf3,
                            0x69, 0x5f, 0x48, 0x37, 0xd,  0xff, 0x2,  0x67, 0xbd, 0x28, 0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22216}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1570}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13095}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30594}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26876}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2974}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6700}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29250}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31929}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31705}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 301, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\SO\191\141\159\DC1$vw", _pubPktID =
// 301, _pubBody = "`\195\&7\ESC_\216\219\237?~,\244", _pubProps = [PropRequestProblemInformation
// 64,PropAuthenticationMethod "\195(Y\170_\225oG\251\178\174",PropSubscriptionIdentifier 23,PropAuthenticationMethod
// "&+E\184\152\135P",PropRequestResponseInformation 211,PropCorrelationData
// "\209\236W\234V0\EM\GS`\168[\NUL",PropSessionExpiryInterval 22216,PropPayloadFormatIndicator 110,PropTopicAlias
// 1570,PropContentType "\190J]\222\198tA\254Y\135\152D\175\DEL\214\217\135h\225",PropMessageExpiryInterval
// 13095,PropContentType "\t{\ACK\234?/\240[\ESC\141\&5b\181\238t\170u\154\176",PropContentType
// "\ESC\USR\241\&4\134\&7\167\RSWIJMl4)S\204\SO_\\\152\173\192",PropRequestProblemInformation 132,PropResponseTopic
// "f\ETB\177\135\237\ETX\NAKb6\166\162\167,Mke\165",PropResponseInformation
// "\f\237-'\145\&7#\145\177\148X",PropServerReference
// "\178,m}\251I\185\250\EM;}d>T(p\253\226\NUL80\141B\r6",PropReceiveMaximum 30594,PropTopicAlias
// 26876,PropWildcardSubscriptionAvailable 211,PropRequestResponseInformation 173,PropMaximumPacketSize
// 2974,PropReceiveMaximum 6700,PropRequestResponseInformation 193,PropTopicAlias 29250,PropAuthenticationData
// "]\240\151\162\&3\175\154\202\221\RS>8\SOH\247c \209\240j\162\191",PropServerReference
// "PQ$\158l\254\DC1",PropMessageExpiryInterval 31929,PropSessionExpiryInterval 31705,PropAssignedClientIdentifier
// "\153\139\247\160\179\134uyzk\243i_H7\r\255\STXg\189(\v"]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {
      0x3b, 0xb9, 0x2,  0x0,  0x8,  0xe,  0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77, 0x1,  0x2d, 0x9f, 0x2,  0x17, 0x40,
      0x15, 0x0,  0xb,  0xc3, 0x28, 0x59, 0xaa, 0x5f, 0xe1, 0x6f, 0x47, 0xfb, 0xb2, 0xae, 0xb,  0x17, 0x15, 0x0,  0x7,
      0x26, 0x2b, 0x45, 0xb8, 0x98, 0x87, 0x50, 0x19, 0xd3, 0x9,  0x0,  0xc,  0xd1, 0xec, 0x57, 0xea, 0x56, 0x30, 0x19,
      0x1d, 0x60, 0xa8, 0x5b, 0x0,  0x11, 0x0,  0x0,  0x56, 0xc8, 0x1,  0x6e, 0x23, 0x6,  0x22, 0x3,  0x0,  0x13, 0xbe,
      0x4a, 0x5d, 0xde, 0xc6, 0x74, 0x41, 0xfe, 0x59, 0x87, 0x98, 0x44, 0xaf, 0x7f, 0xd6, 0xd9, 0x87, 0x68, 0xe1, 0x2,
      0x0,  0x0,  0x33, 0x27, 0x3,  0x0,  0x13, 0x9,  0x7b, 0x6,  0xea, 0x3f, 0x2f, 0xf0, 0x5b, 0x1b, 0x8d, 0x35, 0x62,
      0xb5, 0xee, 0x74, 0xaa, 0x75, 0x9a, 0xb0, 0x3,  0x0,  0x18, 0x1b, 0x1f, 0x52, 0xf1, 0x34, 0x86, 0x37, 0xa7, 0x1e,
      0x57, 0x49, 0x4a, 0x4d, 0x6c, 0x34, 0x29, 0x53, 0xcc, 0xe,  0x5f, 0x5c, 0x98, 0xad, 0xc0, 0x17, 0x84, 0x8,  0x0,
      0x11, 0x66, 0x17, 0xb1, 0x87, 0xed, 0x3,  0x15, 0x62, 0x36, 0xa6, 0xa2, 0xa7, 0x2c, 0x4d, 0x6b, 0x65, 0xa5, 0x1a,
      0x0,  0xb,  0xc,  0xed, 0x2d, 0x27, 0x91, 0x37, 0x23, 0x91, 0xb1, 0x94, 0x58, 0x1c, 0x0,  0x19, 0xb2, 0x2c, 0x6d,
      0x7d, 0xfb, 0x49, 0xb9, 0xfa, 0x19, 0x3b, 0x7d, 0x64, 0x3e, 0x54, 0x28, 0x70, 0xfd, 0xe2, 0x0,  0x38, 0x30, 0x8d,
      0x42, 0xd,  0x36, 0x21, 0x77, 0x82, 0x23, 0x68, 0xfc, 0x28, 0xd3, 0x19, 0xad, 0x27, 0x0,  0x0,  0xb,  0x9e, 0x21,
      0x1a, 0x2c, 0x19, 0xc1, 0x23, 0x72, 0x42, 0x16, 0x0,  0x15, 0x5d, 0xf0, 0x97, 0xa2, 0x33, 0xaf, 0x9a, 0xca, 0xdd,
      0x1e, 0x3e, 0x38, 0x1,  0xf7, 0x63, 0x20, 0xd1, 0xf0, 0x6a, 0xa2, 0xbf, 0x1c, 0x0,  0x7,  0x50, 0x51, 0x24, 0x9e,
      0x6c, 0xfe, 0x11, 0x2,  0x0,  0x0,  0x7c, 0xb9, 0x11, 0x0,  0x0,  0x7b, 0xd9, 0x12, 0x0,  0x16, 0x99, 0x8b, 0xf7,
      0xa0, 0xb3, 0x86, 0x75, 0x79, 0x7a, 0x6b, 0xf3, 0x69, 0x5f, 0x48, 0x37, 0xd,  0xff, 0x2,  0x67, 0xbd, 0x28, 0xb,
      0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe, 0xbf, 0x8d, 0x9f, 0x11, 0x24, 0x76, 0x77};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x60, 0xc3, 0x37, 0x1b, 0x5f, 0xd8, 0xdb, 0xed, 0x3f, 0x7e, 0x2c, 0xf4};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 301);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\227=\STX\236\214\&2\250\EM@M^\ENQ\161\aE8", _pubPktID = 19635, _pubBody = "\EOT\EM", _pubProps = [PropTopicAlias
// 28762,PropReceiveMaximum 4549,PropCorrelationData "\237o*OO%\201P\232^u[\158",PropAuthenticationData
// "\128\189\154\SO\180\SOH]sH\253s\165w\148\219\215\251\130f\NAK\131\152\208;",PropCorrelationData
// "\214\NAK\214MlRr\138\242\DC4\167e]`X;\ENQ\188A^\218+\DC4>6%\155\255\250O",PropReceiveMaximum
// 6189,PropSubscriptionIdentifier 13,PropMaximumPacketSize 31985,PropServerReference
// "\NUL\229\SOH\tJu\233\131NV\203\168\239\220\203\SOH\166E5\228\141\212\173\250X\DLE>?"]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x3b, 0x92, 0x1,  0x0,  0x10, 0xe3, 0x3d, 0x2,  0xec, 0xd6, 0x32, 0xfa, 0x19, 0x40, 0x4d, 0x5e, 0x5,
                   0xa1, 0x7,  0x45, 0x38, 0x4c, 0xb3, 0x7b, 0x23, 0x70, 0x5a, 0x21, 0x11, 0xc5, 0x9,  0x0,  0xd,  0xed,
                   0x6f, 0x2a, 0x4f, 0x4f, 0x25, 0xc9, 0x50, 0xe8, 0x5e, 0x75, 0x5b, 0x9e, 0x16, 0x0,  0x18, 0x80, 0xbd,
                   0x9a, 0xe,  0xb4, 0x1,  0x5d, 0x73, 0x48, 0xfd, 0x73, 0xa5, 0x77, 0x94, 0xdb, 0xd7, 0xfb, 0x82, 0x66,
                   0x15, 0x83, 0x98, 0xd0, 0x3b, 0x9,  0x0,  0x1e, 0xd6, 0x15, 0xd6, 0x4d, 0x6c, 0x52, 0x72, 0x8a, 0xf2,
                   0x14, 0xa7, 0x65, 0x5d, 0x60, 0x58, 0x3b, 0x5,  0xbc, 0x41, 0x5e, 0xda, 0x2b, 0x14, 0x3e, 0x36, 0x25,
                   0x9b, 0xff, 0xfa, 0x4f, 0x21, 0x18, 0x2d, 0xb,  0xd,  0x27, 0x0,  0x0,  0x7c, 0xf1, 0x1c, 0x0,  0x1c,
                   0x0,  0xe5, 0x1,  0x9,  0x4a, 0x75, 0xe9, 0x83, 0x4e, 0x56, 0xcb, 0xa8, 0xef, 0xdc, 0xcb, 0x1,  0xa6,
                   0x45, 0x35, 0xe4, 0x8d, 0xd4, 0xad, 0xfa, 0x58, 0x10, 0x3e, 0x3f, 0x4,  0x19};
  uint8_t topic_bytes[] = {0xe3, 0x3d, 0x2, 0xec, 0xd6, 0x32, 0xfa, 0x19, 0x40, 0x4d, 0x5e, 0x5, 0xa1, 0x7, 0x45, 0x38};
  lwmqtt_string_t topic = {16, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x4, 0x19};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 2;

  uint8_t bytesprops0[] = {0xed, 0x6f, 0x2a, 0x4f, 0x4f, 0x25, 0xc9, 0x50, 0xe8, 0x5e, 0x75, 0x5b, 0x9e};
  uint8_t bytesprops1[] = {0x80, 0xbd, 0x9a, 0xe,  0xb4, 0x1,  0x5d, 0x73, 0x48, 0xfd, 0x73, 0xa5,
                           0x77, 0x94, 0xdb, 0xd7, 0xfb, 0x82, 0x66, 0x15, 0x83, 0x98, 0xd0, 0x3b};
  uint8_t bytesprops2[] = {0xd6, 0x15, 0xd6, 0x4d, 0x6c, 0x52, 0x72, 0x8a, 0xf2, 0x14, 0xa7, 0x65, 0x5d, 0x60, 0x58,
                           0x3b, 0x5,  0xbc, 0x41, 0x5e, 0xda, 0x2b, 0x14, 0x3e, 0x36, 0x25, 0x9b, 0xff, 0xfa, 0x4f};
  uint8_t bytesprops3[] = {0x0,  0xe5, 0x1,  0x9,  0x4a, 0x75, 0xe9, 0x83, 0x4e, 0x56, 0xcb, 0xa8, 0xef, 0xdc,
                           0xcb, 0x1,  0xa6, 0x45, 0x35, 0xe4, 0x8d, 0xd4, 0xad, 0xfa, 0x58, 0x10, 0x3e, 0x3f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28762}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4549}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6189}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31985}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 19635, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\227=\STX\236\214\&2\250\EM@M^\ENQ\161\aE8", _pubPktID = 19635, _pubBody = "\EOT\EM", _pubProps = [PropTopicAlias
// 28762,PropReceiveMaximum 4549,PropCorrelationData "\237o*OO%\201P\232^u[\158",PropAuthenticationData
// "\128\189\154\SO\180\SOH]sH\253s\165w\148\219\215\251\130f\NAK\131\152\208;",PropCorrelationData
// "\214\NAK\214MlRr\138\242\DC4\167e]`X;\ENQ\188A^\218+\DC4>6%\155\255\250O",PropReceiveMaximum
// 6189,PropSubscriptionIdentifier 13,PropMaximumPacketSize 31985,PropServerReference
// "\NUL\229\SOH\tJu\233\131NV\203\168\239\220\203\SOH\166E5\228\141\212\173\250X\DLE>?"]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x3b, 0x92, 0x1,  0x0,  0x10, 0xe3, 0x3d, 0x2,  0xec, 0xd6, 0x32, 0xfa, 0x19, 0x40, 0x4d, 0x5e, 0x5,
                   0xa1, 0x7,  0x45, 0x38, 0x4c, 0xb3, 0x7b, 0x23, 0x70, 0x5a, 0x21, 0x11, 0xc5, 0x9,  0x0,  0xd,  0xed,
                   0x6f, 0x2a, 0x4f, 0x4f, 0x25, 0xc9, 0x50, 0xe8, 0x5e, 0x75, 0x5b, 0x9e, 0x16, 0x0,  0x18, 0x80, 0xbd,
                   0x9a, 0xe,  0xb4, 0x1,  0x5d, 0x73, 0x48, 0xfd, 0x73, 0xa5, 0x77, 0x94, 0xdb, 0xd7, 0xfb, 0x82, 0x66,
                   0x15, 0x83, 0x98, 0xd0, 0x3b, 0x9,  0x0,  0x1e, 0xd6, 0x15, 0xd6, 0x4d, 0x6c, 0x52, 0x72, 0x8a, 0xf2,
                   0x14, 0xa7, 0x65, 0x5d, 0x60, 0x58, 0x3b, 0x5,  0xbc, 0x41, 0x5e, 0xda, 0x2b, 0x14, 0x3e, 0x36, 0x25,
                   0x9b, 0xff, 0xfa, 0x4f, 0x21, 0x18, 0x2d, 0xb,  0xd,  0x27, 0x0,  0x0,  0x7c, 0xf1, 0x1c, 0x0,  0x1c,
                   0x0,  0xe5, 0x1,  0x9,  0x4a, 0x75, 0xe9, 0x83, 0x4e, 0x56, 0xcb, 0xa8, 0xef, 0xdc, 0xcb, 0x1,  0xa6,
                   0x45, 0x35, 0xe4, 0x8d, 0xd4, 0xad, 0xfa, 0x58, 0x10, 0x3e, 0x3f, 0x4,  0x19};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe3, 0x3d, 0x2,  0xec, 0xd6, 0x32, 0xfa, 0x19,
                               0x40, 0x4d, 0x5e, 0x5,  0xa1, 0x7,  0x45, 0x38};
  lwmqtt_string_t exp_topic = {16, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4, 0x19};
  lwmqtt_string_t exp_body = {2, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 19635);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 16);
  EXPECT_EQ(msg.payload_len, 2);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 2);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207FX\fp\139\210\201Q\185\161i$\222\214\221\238\n.\134\157L7\178\&1", _pubPktID = 10816, _pubBody =
// "b[\173.*\158(\194-\180ZS\221\236\188\168\182\172p\192\216\246\196\176\200\248\&1\232a", _pubProps =
// [PropReceiveMaximum 25251,PropResponseInformation
// "X\221\143\223\163\136V\DC1\175\145\155\US\\\DC3\ESC\159l\DC2/\a\143v\163\227\n\235",PropMaximumQoS
// 199,PropAssignedClientIdentifier "\ETBk\211",PropMessageExpiryInterval 1041,PropTopicAliasMaximum
// 2064,PropMessageExpiryInterval 14828,PropReasonString
// "x\DLE\ESC\244\138\235\246\137\235:\255\177",PropAuthenticationData
// "\162\233\a\215\148\245\255\148NIrB",PropUserProperty "\225}q\142\171-Z^Bt}\179r\241\SO\ETX2e\ACK0\249"
// "L\160/\NULi\177E%o\191x>",PropMaximumQoS 99,PropSessionExpiryInterval 8860,PropWildcardSubscriptionAvailable
// 211,PropReasonString "\189\253\207\129\167\209VT\SOH}[\t\220\CANAB\146\168",PropAuthenticationMethod ""]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x34, 0xd6, 0x1,  0x0,  0x19, 0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1, 0x69,
                   0x24, 0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31, 0x2a, 0x40, 0x9a, 0x1,
                   0x21, 0x62, 0xa3, 0x1a, 0x0,  0x1a, 0x58, 0xdd, 0x8f, 0xdf, 0xa3, 0x88, 0x56, 0x11, 0xaf, 0x91, 0x9b,
                   0x1f, 0x5c, 0x13, 0x1b, 0x9f, 0x6c, 0x12, 0x2f, 0x7,  0x8f, 0x76, 0xa3, 0xe3, 0xa,  0xeb, 0x24, 0xc7,
                   0x12, 0x0,  0x3,  0x17, 0x6b, 0xd3, 0x2,  0x0,  0x0,  0x4,  0x11, 0x22, 0x8,  0x10, 0x2,  0x0,  0x0,
                   0x39, 0xec, 0x1f, 0x0,  0xc,  0x78, 0x10, 0x1b, 0xf4, 0x8a, 0xeb, 0xf6, 0x89, 0xeb, 0x3a, 0xff, 0xb1,
                   0x16, 0x0,  0xc,  0xa2, 0xe9, 0x7,  0xd7, 0x94, 0xf5, 0xff, 0x94, 0x4e, 0x49, 0x72, 0x42, 0x26, 0x0,
                   0x15, 0xe1, 0x7d, 0x71, 0x8e, 0xab, 0x2d, 0x5a, 0x5e, 0x42, 0x74, 0x7d, 0xb3, 0x72, 0xf1, 0xe,  0x3,
                   0x32, 0x65, 0x6,  0x30, 0xf9, 0x0,  0xc,  0x4c, 0xa0, 0x2f, 0x0,  0x69, 0xb1, 0x45, 0x25, 0x6f, 0xbf,
                   0x78, 0x3e, 0x24, 0x63, 0x11, 0x0,  0x0,  0x22, 0x9c, 0x28, 0xd3, 0x1f, 0x0,  0x12, 0xbd, 0xfd, 0xcf,
                   0x81, 0xa7, 0xd1, 0x56, 0x54, 0x1,  0x7d, 0x5b, 0x9,  0xdc, 0x18, 0x41, 0x42, 0x92, 0xa8, 0x15, 0x0,
                   0x0,  0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec, 0xbc, 0xa8,
                   0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  uint8_t topic_bytes[] = {0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1, 0x69, 0x24,
                           0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec, 0xbc,
                         0xa8, 0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0x58, 0xdd, 0x8f, 0xdf, 0xa3, 0x88, 0x56, 0x11, 0xaf, 0x91, 0x9b, 0x1f, 0x5c,
                           0x13, 0x1b, 0x9f, 0x6c, 0x12, 0x2f, 0x7,  0x8f, 0x76, 0xa3, 0xe3, 0xa,  0xeb};
  uint8_t bytesprops1[] = {0x17, 0x6b, 0xd3};
  uint8_t bytesprops2[] = {0x78, 0x10, 0x1b, 0xf4, 0x8a, 0xeb, 0xf6, 0x89, 0xeb, 0x3a, 0xff, 0xb1};
  uint8_t bytesprops3[] = {0xa2, 0xe9, 0x7, 0xd7, 0x94, 0xf5, 0xff, 0x94, 0x4e, 0x49, 0x72, 0x42};
  uint8_t bytesprops5[] = {0x4c, 0xa0, 0x2f, 0x0, 0x69, 0xb1, 0x45, 0x25, 0x6f, 0xbf, 0x78, 0x3e};
  uint8_t bytesprops4[] = {0xe1, 0x7d, 0x71, 0x8e, 0xab, 0x2d, 0x5a, 0x5e, 0x42, 0x74, 0x7d,
                           0xb3, 0x72, 0xf1, 0xe,  0x3,  0x32, 0x65, 0x6,  0x30, 0xf9};
  uint8_t bytesprops6[] = {0xbd, 0xfd, 0xcf, 0x81, 0xa7, 0xd1, 0x56, 0x54, 0x1,
                           0x7d, 0x5b, 0x9,  0xdc, 0x18, 0x41, 0x42, 0x92, 0xa8};
  uint8_t bytesprops7[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25251}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1041}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2064}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14828}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops4}, .v = {12, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8860}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 10816, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\207FX\fp\139\210\201Q\185\161i$\222\214\221\238\n.\134\157L7\178\&1", _pubPktID = 10816, _pubBody =
// "b[\173.*\158(\194-\180ZS\221\236\188\168\182\172p\192\216\246\196\176\200\248\&1\232a", _pubProps =
// [PropReceiveMaximum 25251,PropResponseInformation
// "X\221\143\223\163\136V\DC1\175\145\155\US\\\DC3\ESC\159l\DC2/\a\143v\163\227\n\235",PropMaximumQoS
// 199,PropAssignedClientIdentifier "\ETBk\211",PropMessageExpiryInterval 1041,PropTopicAliasMaximum
// 2064,PropMessageExpiryInterval 14828,PropReasonString
// "x\DLE\ESC\244\138\235\246\137\235:\255\177",PropAuthenticationData
// "\162\233\a\215\148\245\255\148NIrB",PropUserProperty "\225}q\142\171-Z^Bt}\179r\241\SO\ETX2e\ACK0\249"
// "L\160/\NULi\177E%o\191x>",PropMaximumQoS 99,PropSessionExpiryInterval 8860,PropWildcardSubscriptionAvailable
// 211,PropReasonString "\189\253\207\129\167\209VT\SOH}[\t\220\CANAB\146\168",PropAuthenticationMethod ""]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {0x34, 0xd6, 0x1,  0x0,  0x19, 0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1, 0x69,
                   0x24, 0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31, 0x2a, 0x40, 0x9a, 0x1,
                   0x21, 0x62, 0xa3, 0x1a, 0x0,  0x1a, 0x58, 0xdd, 0x8f, 0xdf, 0xa3, 0x88, 0x56, 0x11, 0xaf, 0x91, 0x9b,
                   0x1f, 0x5c, 0x13, 0x1b, 0x9f, 0x6c, 0x12, 0x2f, 0x7,  0x8f, 0x76, 0xa3, 0xe3, 0xa,  0xeb, 0x24, 0xc7,
                   0x12, 0x0,  0x3,  0x17, 0x6b, 0xd3, 0x2,  0x0,  0x0,  0x4,  0x11, 0x22, 0x8,  0x10, 0x2,  0x0,  0x0,
                   0x39, 0xec, 0x1f, 0x0,  0xc,  0x78, 0x10, 0x1b, 0xf4, 0x8a, 0xeb, 0xf6, 0x89, 0xeb, 0x3a, 0xff, 0xb1,
                   0x16, 0x0,  0xc,  0xa2, 0xe9, 0x7,  0xd7, 0x94, 0xf5, 0xff, 0x94, 0x4e, 0x49, 0x72, 0x42, 0x26, 0x0,
                   0x15, 0xe1, 0x7d, 0x71, 0x8e, 0xab, 0x2d, 0x5a, 0x5e, 0x42, 0x74, 0x7d, 0xb3, 0x72, 0xf1, 0xe,  0x3,
                   0x32, 0x65, 0x6,  0x30, 0xf9, 0x0,  0xc,  0x4c, 0xa0, 0x2f, 0x0,  0x69, 0xb1, 0x45, 0x25, 0x6f, 0xbf,
                   0x78, 0x3e, 0x24, 0x63, 0x11, 0x0,  0x0,  0x22, 0x9c, 0x28, 0xd3, 0x1f, 0x0,  0x12, 0xbd, 0xfd, 0xcf,
                   0x81, 0xa7, 0xd1, 0x56, 0x54, 0x1,  0x7d, 0x5b, 0x9,  0xdc, 0x18, 0x41, 0x42, 0x92, 0xa8, 0x15, 0x0,
                   0x0,  0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec, 0xbc, 0xa8,
                   0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0x46, 0x58, 0xc,  0x70, 0x8b, 0xd2, 0xc9, 0x51, 0xb9, 0xa1, 0x69, 0x24,
                               0xde, 0xd6, 0xdd, 0xee, 0xa,  0x2e, 0x86, 0x9d, 0x4c, 0x37, 0xb2, 0x31};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x62, 0x5b, 0xad, 0x2e, 0x2a, 0x9e, 0x28, 0xc2, 0x2d, 0xb4, 0x5a, 0x53, 0xdd, 0xec, 0xbc,
                              0xa8, 0xb6, 0xac, 0x70, 0xc0, 0xd8, 0xf6, 0xc4, 0xb0, 0xc8, 0xf8, 0x31, 0xe8, 0x61};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10816);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "C:\210I?H\140\153\163\FS\190\141PA\209Z6\210G=S\217\242\219S\237\226\a", _pubPktID = 780, _pubBody =
// "\185b.\FS\147|\157\223\176\240\ENQy\185\208\DC4\186<E\219\148\131\212\223\133\179\DC1\253\169", _pubProps =
// [PropTopicAlias 25305,PropPayloadFormatIndicator 5,PropReasonString ")",PropTopicAlias 30889]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {0x34, 0x49, 0x0,  0x1c, 0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe,
                   0x8d, 0x50, 0x41, 0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed,
                   0xe2, 0x7,  0x3,  0xc,  0xc,  0x23, 0x62, 0xd9, 0x1,  0x5,  0x1f, 0x0,  0x1,  0x29, 0x23,
                   0x78, 0xa9, 0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9,
                   0xd0, 0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  uint8_t topic_bytes[] = {0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe, 0x8d, 0x50, 0x41,
                           0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed, 0xe2, 0x7};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9, 0xd0,
                         0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0x29};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25305}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30889}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 780, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "C:\210I?H\140\153\163\FS\190\141PA\209Z6\210G=S\217\242\219S\237\226\a", _pubPktID = 780, _pubBody =
// "\185b.\FS\147|\157\223\176\240\ENQy\185\208\DC4\186<E\219\148\131\212\223\133\179\DC1\253\169", _pubProps =
// [PropTopicAlias 25305,PropPayloadFormatIndicator 5,PropReasonString ")",PropTopicAlias 30889]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {0x34, 0x49, 0x0,  0x1c, 0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe,
                   0x8d, 0x50, 0x41, 0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed,
                   0xe2, 0x7,  0x3,  0xc,  0xc,  0x23, 0x62, 0xd9, 0x1,  0x5,  0x1f, 0x0,  0x1,  0x29, 0x23,
                   0x78, 0xa9, 0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9,
                   0xd0, 0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x43, 0x3a, 0xd2, 0x49, 0x3f, 0x48, 0x8c, 0x99, 0xa3, 0x1c, 0xbe, 0x8d, 0x50, 0x41,
                               0xd1, 0x5a, 0x36, 0xd2, 0x47, 0x3d, 0x53, 0xd9, 0xf2, 0xdb, 0x53, 0xed, 0xe2, 0x7};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb9, 0x62, 0x2e, 0x1c, 0x93, 0x7c, 0x9d, 0xdf, 0xb0, 0xf0, 0x5,  0x79, 0xb9, 0xd0,
                              0x14, 0xba, 0x3c, 0x45, 0xdb, 0x94, 0x83, 0xd4, 0xdf, 0x85, 0xb3, 0x11, 0xfd, 0xa9};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 780);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "x\170\228C2\140C\ACKD\FS/[\214\EOT\SOH", _pubPktID = 0, _pubBody = "\185", _pubProps = [PropTopicAliasMaximum
// 21735,PropMaximumPacketSize 23247,PropResponseTopic "\253\195\224\216d\206\EOT\167?\163CZ\163",PropServerKeepAlive
// 1098,PropMessageExpiryInterval 15291,PropWildcardSubscriptionAvailable 116,PropTopicAlias
// 13184,PropSubscriptionIdentifier 23,PropTopicAliasMaximum 22231,PropRetainAvailable 205,PropUserProperty
// "\164\227\165\164\178\EOT.\134X\216\ENQ^\198\&8\206\133\249\131\t]=\208\177\174" "c",PropMaximumPacketSize
// 1168,PropReceiveMaximum 18513]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {0x31, 0x65, 0x0,  0xf,  0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c, 0x43, 0x6,  0x44, 0x1c, 0x2f,
                   0x5b, 0xd6, 0x4,  0x1,  0x52, 0x22, 0x54, 0xe7, 0x27, 0x0,  0x0,  0x5a, 0xcf, 0x8,  0x0,
                   0xd,  0xfd, 0xc3, 0xe0, 0xd8, 0x64, 0xce, 0x4,  0xa7, 0x3f, 0xa3, 0x43, 0x5a, 0xa3, 0x13,
                   0x4,  0x4a, 0x2,  0x0,  0x0,  0x3b, 0xbb, 0x28, 0x74, 0x23, 0x33, 0x80, 0xb,  0x17, 0x22,
                   0x56, 0xd7, 0x25, 0xcd, 0x26, 0x0,  0x18, 0xa4, 0xe3, 0xa5, 0xa4, 0xb2, 0x4,  0x2e, 0x86,
                   0x58, 0xd8, 0x5,  0x5e, 0xc6, 0x38, 0xce, 0x85, 0xf9, 0x83, 0x9,  0x5d, 0x3d, 0xd0, 0xb1,
                   0xae, 0x0,  0x1,  0x63, 0x27, 0x0,  0x0,  0x4,  0x90, 0x21, 0x48, 0x51, 0xb9};
  uint8_t topic_bytes[] = {0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c, 0x43, 0x6, 0x44, 0x1c, 0x2f, 0x5b, 0xd6, 0x4, 0x1};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0xfd, 0xc3, 0xe0, 0xd8, 0x64, 0xce, 0x4, 0xa7, 0x3f, 0xa3, 0x43, 0x5a, 0xa3};
  uint8_t bytesprops2[] = {0x63};
  uint8_t bytesprops1[] = {0xa4, 0xe3, 0xa5, 0xa4, 0xb2, 0x4,  0x2e, 0x86, 0x58, 0xd8, 0x5,  0x5e,
                           0xc6, 0x38, 0xce, 0x85, 0xf9, 0x83, 0x9,  0x5d, 0x3d, 0xd0, 0xb1, 0xae};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21735}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23247}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1098}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15291}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13184}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22231}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops1}, .v = {1, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1168}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18513}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "x\170\228C2\140C\ACKD\FS/[\214\EOT\SOH", _pubPktID = 0, _pubBody = "\185", _pubProps = [PropTopicAliasMaximum
// 21735,PropMaximumPacketSize 23247,PropResponseTopic "\253\195\224\216d\206\EOT\167?\163CZ\163",PropServerKeepAlive
// 1098,PropMessageExpiryInterval 15291,PropWildcardSubscriptionAvailable 116,PropTopicAlias
// 13184,PropSubscriptionIdentifier 23,PropTopicAliasMaximum 22231,PropRetainAvailable 205,PropUserProperty
// "\164\227\165\164\178\EOT.\134X\216\ENQ^\198\&8\206\133\249\131\t]=\208\177\174" "c",PropMaximumPacketSize
// 1168,PropReceiveMaximum 18513]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {0x31, 0x65, 0x0,  0xf,  0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c, 0x43, 0x6,  0x44, 0x1c, 0x2f,
                   0x5b, 0xd6, 0x4,  0x1,  0x52, 0x22, 0x54, 0xe7, 0x27, 0x0,  0x0,  0x5a, 0xcf, 0x8,  0x0,
                   0xd,  0xfd, 0xc3, 0xe0, 0xd8, 0x64, 0xce, 0x4,  0xa7, 0x3f, 0xa3, 0x43, 0x5a, 0xa3, 0x13,
                   0x4,  0x4a, 0x2,  0x0,  0x0,  0x3b, 0xbb, 0x28, 0x74, 0x23, 0x33, 0x80, 0xb,  0x17, 0x22,
                   0x56, 0xd7, 0x25, 0xcd, 0x26, 0x0,  0x18, 0xa4, 0xe3, 0xa5, 0xa4, 0xb2, 0x4,  0x2e, 0x86,
                   0x58, 0xd8, 0x5,  0x5e, 0xc6, 0x38, 0xce, 0x85, 0xf9, 0x83, 0x9,  0x5d, 0x3d, 0xd0, 0xb1,
                   0xae, 0x0,  0x1,  0x63, 0x27, 0x0,  0x0,  0x4,  0x90, 0x21, 0x48, 0x51, 0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x78, 0xaa, 0xe4, 0x43, 0x32, 0x8c, 0x43, 0x6, 0x44, 0x1c, 0x2f, 0x5b, 0xd6, 0x4, 0x1};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb9};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\EM\181N`\v\241\NAKi\133lU\172
// ~\192\152\DLE2\173\193\158\SOH\252\&8/.\RS", _pubPktID = 21275, _pubBody = "'\189s+\222o/\187^\161", _pubProps =
// [PropTopicAliasMaximum 21929,PropResponseInformation "9\236S.4\nB\SYN",PropMaximumPacketSize 29128,PropUserProperty
// "'\209\DC2\f%l\254\138\"\180;\165\235\174\228f\247$r\ETB\DEL\176\167>#xJm\254"
// "\160\182\229\218|\\\172\216\161Q\SI]\141\252\192\&3\210;\181\236\DC2\191BQ",PropAuthenticationData
// "R='\201\138\DC3c\SUBXM\155\129\200@\189B\186H6\EM]\131x\130\159\215\189\238K",PropUserProperty
// "O\CAN\191\144\250\GSL6\193a\ENQu\ETX\151\EMW\145\r\223\178\ETX"
// "\GSv\248\238L\234\137\SYN\DC2%:V\129yh\199\189\DC3\167N\DC49{\t\137",PropMaximumPacketSize 20573,PropContentType
// "F$'T\241\232\151\161",PropSharedSubscriptionAvailable 97]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x32, 0xdd, 0x1,  0x0,  0x1b, 0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55, 0xac, 0x20, 0x7e,
      0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e, 0x1e, 0x53, 0x1b, 0xb2, 0x1,  0x22, 0x55,
      0xa9, 0x1a, 0x0,  0x8,  0x39, 0xec, 0x53, 0x2e, 0x34, 0xa,  0x42, 0x16, 0x27, 0x0,  0x0,  0x71, 0xc8, 0x26, 0x0,
      0x1d, 0x27, 0xd1, 0x12, 0xc,  0x25, 0x6c, 0xfe, 0x8a, 0x22, 0xb4, 0x3b, 0xa5, 0xeb, 0xae, 0xe4, 0x66, 0xf7, 0x24,
      0x72, 0x17, 0x7f, 0xb0, 0xa7, 0x3e, 0x23, 0x78, 0x4a, 0x6d, 0xfe, 0x0,  0x18, 0xa0, 0xb6, 0xe5, 0xda, 0x7c, 0x5c,
      0xac, 0xd8, 0xa1, 0x51, 0xf,  0x5d, 0x8d, 0xfc, 0xc0, 0x33, 0xd2, 0x3b, 0xb5, 0xec, 0x12, 0xbf, 0x42, 0x51, 0x16,
      0x0,  0x1d, 0x52, 0x3d, 0x27, 0xc9, 0x8a, 0x13, 0x63, 0x1a, 0x58, 0x4d, 0x9b, 0x81, 0xc8, 0x40, 0xbd, 0x42, 0xba,
      0x48, 0x36, 0x19, 0x5d, 0x83, 0x78, 0x82, 0x9f, 0xd7, 0xbd, 0xee, 0x4b, 0x26, 0x0,  0x15, 0x4f, 0x18, 0xbf, 0x90,
      0xfa, 0x1d, 0x4c, 0x36, 0xc1, 0x61, 0x5,  0x75, 0x3,  0x97, 0x19, 0x57, 0x91, 0xd,  0xdf, 0xb2, 0x3,  0x0,  0x19,
      0x1d, 0x76, 0xf8, 0xee, 0x4c, 0xea, 0x89, 0x16, 0x12, 0x25, 0x3a, 0x56, 0x81, 0x79, 0x68, 0xc7, 0xbd, 0x13, 0xa7,
      0x4e, 0x14, 0x39, 0x7b, 0x9,  0x89, 0x27, 0x0,  0x0,  0x50, 0x5d, 0x3,  0x0,  0x8,  0x46, 0x24, 0x27, 0x54, 0xf1,
      0xe8, 0x97, 0xa1, 0x2a, 0x61, 0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  uint8_t topic_bytes[] = {0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55, 0xac, 0x20, 0x7e,
                           0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e, 0x1e};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 10;

  uint8_t bytesprops0[] = {0x39, 0xec, 0x53, 0x2e, 0x34, 0xa, 0x42, 0x16};
  uint8_t bytesprops2[] = {0xa0, 0xb6, 0xe5, 0xda, 0x7c, 0x5c, 0xac, 0xd8, 0xa1, 0x51, 0xf,  0x5d,
                           0x8d, 0xfc, 0xc0, 0x33, 0xd2, 0x3b, 0xb5, 0xec, 0x12, 0xbf, 0x42, 0x51};
  uint8_t bytesprops1[] = {0x27, 0xd1, 0x12, 0xc,  0x25, 0x6c, 0xfe, 0x8a, 0x22, 0xb4, 0x3b, 0xa5, 0xeb, 0xae, 0xe4,
                           0x66, 0xf7, 0x24, 0x72, 0x17, 0x7f, 0xb0, 0xa7, 0x3e, 0x23, 0x78, 0x4a, 0x6d, 0xfe};
  uint8_t bytesprops3[] = {0x52, 0x3d, 0x27, 0xc9, 0x8a, 0x13, 0x63, 0x1a, 0x58, 0x4d, 0x9b, 0x81, 0xc8, 0x40, 0xbd,
                           0x42, 0xba, 0x48, 0x36, 0x19, 0x5d, 0x83, 0x78, 0x82, 0x9f, 0xd7, 0xbd, 0xee, 0x4b};
  uint8_t bytesprops5[] = {0x1d, 0x76, 0xf8, 0xee, 0x4c, 0xea, 0x89, 0x16, 0x12, 0x25, 0x3a, 0x56, 0x81,
                           0x79, 0x68, 0xc7, 0xbd, 0x13, 0xa7, 0x4e, 0x14, 0x39, 0x7b, 0x9,  0x89};
  uint8_t bytesprops4[] = {0x4f, 0x18, 0xbf, 0x90, 0xfa, 0x1d, 0x4c, 0x36, 0xc1, 0x61, 0x5,
                           0x75, 0x3,  0x97, 0x19, 0x57, 0x91, 0xd,  0xdf, 0xb2, 0x3};
  uint8_t bytesprops6[] = {0x46, 0x24, 0x27, 0x54, 0xf1, 0xe8, 0x97, 0xa1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21929}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29128}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {24, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops4}, .v = {25, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20573}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 97}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 21275, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\EM\181N`\v\241\NAKi\133lU\172
// ~\192\152\DLE2\173\193\158\SOH\252\&8/.\RS", _pubPktID = 21275, _pubBody = "'\189s+\222o/\187^\161", _pubProps =
// [PropTopicAliasMaximum 21929,PropResponseInformation "9\236S.4\nB\SYN",PropMaximumPacketSize 29128,PropUserProperty
// "'\209\DC2\f%l\254\138\"\180;\165\235\174\228f\247$r\ETB\DEL\176\167>#xJm\254"
// "\160\182\229\218|\\\172\216\161Q\SI]\141\252\192\&3\210;\181\236\DC2\191BQ",PropAuthenticationData
// "R='\201\138\DC3c\SUBXM\155\129\200@\189B\186H6\EM]\131x\130\159\215\189\238K",PropUserProperty
// "O\CAN\191\144\250\GSL6\193a\ENQu\ETX\151\EMW\145\r\223\178\ETX"
// "\GSv\248\238L\234\137\SYN\DC2%:V\129yh\199\189\DC3\167N\DC49{\t\137",PropMaximumPacketSize 20573,PropContentType
// "F$'T\241\232\151\161",PropSharedSubscriptionAvailable 97]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {
      0x32, 0xdd, 0x1,  0x0,  0x1b, 0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55, 0xac, 0x20, 0x7e,
      0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e, 0x1e, 0x53, 0x1b, 0xb2, 0x1,  0x22, 0x55,
      0xa9, 0x1a, 0x0,  0x8,  0x39, 0xec, 0x53, 0x2e, 0x34, 0xa,  0x42, 0x16, 0x27, 0x0,  0x0,  0x71, 0xc8, 0x26, 0x0,
      0x1d, 0x27, 0xd1, 0x12, 0xc,  0x25, 0x6c, 0xfe, 0x8a, 0x22, 0xb4, 0x3b, 0xa5, 0xeb, 0xae, 0xe4, 0x66, 0xf7, 0x24,
      0x72, 0x17, 0x7f, 0xb0, 0xa7, 0x3e, 0x23, 0x78, 0x4a, 0x6d, 0xfe, 0x0,  0x18, 0xa0, 0xb6, 0xe5, 0xda, 0x7c, 0x5c,
      0xac, 0xd8, 0xa1, 0x51, 0xf,  0x5d, 0x8d, 0xfc, 0xc0, 0x33, 0xd2, 0x3b, 0xb5, 0xec, 0x12, 0xbf, 0x42, 0x51, 0x16,
      0x0,  0x1d, 0x52, 0x3d, 0x27, 0xc9, 0x8a, 0x13, 0x63, 0x1a, 0x58, 0x4d, 0x9b, 0x81, 0xc8, 0x40, 0xbd, 0x42, 0xba,
      0x48, 0x36, 0x19, 0x5d, 0x83, 0x78, 0x82, 0x9f, 0xd7, 0xbd, 0xee, 0x4b, 0x26, 0x0,  0x15, 0x4f, 0x18, 0xbf, 0x90,
      0xfa, 0x1d, 0x4c, 0x36, 0xc1, 0x61, 0x5,  0x75, 0x3,  0x97, 0x19, 0x57, 0x91, 0xd,  0xdf, 0xb2, 0x3,  0x0,  0x19,
      0x1d, 0x76, 0xf8, 0xee, 0x4c, 0xea, 0x89, 0x16, 0x12, 0x25, 0x3a, 0x56, 0x81, 0x79, 0x68, 0xc7, 0xbd, 0x13, 0xa7,
      0x4e, 0x14, 0x39, 0x7b, 0x9,  0x89, 0x27, 0x0,  0x0,  0x50, 0x5d, 0x3,  0x0,  0x8,  0x46, 0x24, 0x27, 0x54, 0xf1,
      0xe8, 0x97, 0xa1, 0x2a, 0x61, 0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x19, 0xb5, 0x4e, 0x60, 0xb,  0xf1, 0x15, 0x69, 0x85, 0x6c, 0x55, 0xac, 0x20, 0x7e,
                               0xc0, 0x98, 0x10, 0x32, 0xad, 0xc1, 0x9e, 0x1,  0xfc, 0x38, 0x2f, 0x2e, 0x1e};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x27, 0xbd, 0x73, 0x2b, 0xde, 0x6f, 0x2f, 0xbb, 0x5e, 0xa1};
  lwmqtt_string_t exp_body = {10, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 21275);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 10);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 10);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\176\EMg\233", _pubPktID = 31111,
// _pubBody = "e\163\181)\SYN\133\198/d\225\216\252\177\&5v[\251\&3\219\232\135\&2\251>E\155#\DLE\254", _pubProps =
// [PropWillDelayInterval 9651,PropAssignedClientIdentifier
// "\187\193]\153&\208#\238\DLE\180n?\NAK\244n\SYN\248\167\151\135\164\179\183\205",PropServerReference
// "p",PropServerKeepAlive 9508,PropReceiveMaximum 4115,PropContentType
// "\fP\153\219\190\224\GS\229\FS\175\176\202\&8CD\193\131h",PropAuthenticationMethod "w\\",PropTopicAliasMaximum
// 13378,PropWildcardSubscriptionAvailable 106,PropWildcardSubscriptionAvailable 38,PropSessionExpiryInterval
// 1710,PropReceiveMaximum 22280,PropAssignedClientIdentifier ")",PropCorrelationData
// "\a*\163\&9W.\223N\RS\215\170{\a\DC23\"\f\207\129{\212a\bxK",PropAuthenticationMethod
// "i\183\129\NAK\129\v\190\CAN4",PropRetainAvailable 213,PropMaximumPacketSize 11201,PropMessageExpiryInterval
// 14252,PropResponseInformation "w2\248\193",PropTopicAlias 1304,PropReasonString
// "Z\ACK\230\131\214\146\&7\228\141\229\209\&5\214z\221\NAK\244\241y\220\252\193\240p\189\&7J\154\196",PropPayloadFormatIndicator
// 153,PropMaximumPacketSize 11435,PropWildcardSubscriptionAvailable 74,PropMaximumPacketSize
// 23532,PropRequestResponseInformation 85,PropServerReference "\229bn\164\160*X\192\237\195js?\226\163\&8bx\187"]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x34, 0x82, 0x2,  0x0,  0x4,  0xb0, 0x19, 0x67, 0xe9, 0x79, 0x87, 0xdb, 0x1,  0x18, 0x0,  0x0,  0x25, 0xb3, 0x12,
      0x0,  0x18, 0xbb, 0xc1, 0x5d, 0x99, 0x26, 0xd0, 0x23, 0xee, 0x10, 0xb4, 0x6e, 0x3f, 0x15, 0xf4, 0x6e, 0x16, 0xf8,
      0xa7, 0x97, 0x87, 0xa4, 0xb3, 0xb7, 0xcd, 0x1c, 0x0,  0x1,  0x70, 0x13, 0x25, 0x24, 0x21, 0x10, 0x13, 0x3,  0x0,
      0x12, 0xc,  0x50, 0x99, 0xdb, 0xbe, 0xe0, 0x1d, 0xe5, 0x1c, 0xaf, 0xb0, 0xca, 0x38, 0x43, 0x44, 0xc1, 0x83, 0x68,
      0x15, 0x0,  0x2,  0x77, 0x5c, 0x22, 0x34, 0x42, 0x28, 0x6a, 0x28, 0x26, 0x11, 0x0,  0x0,  0x6,  0xae, 0x21, 0x57,
      0x8,  0x12, 0x0,  0x1,  0x29, 0x9,  0x0,  0x19, 0x7,  0x2a, 0xa3, 0x39, 0x57, 0x2e, 0xdf, 0x4e, 0x1e, 0xd7, 0xaa,
      0x7b, 0x7,  0x12, 0x33, 0x22, 0xc,  0xcf, 0x81, 0x7b, 0xd4, 0x61, 0x8,  0x78, 0x4b, 0x15, 0x0,  0x9,  0x69, 0xb7,
      0x81, 0x15, 0x81, 0xb,  0xbe, 0x18, 0x34, 0x25, 0xd5, 0x27, 0x0,  0x0,  0x2b, 0xc1, 0x2,  0x0,  0x0,  0x37, 0xac,
      0x1a, 0x0,  0x4,  0x77, 0x32, 0xf8, 0xc1, 0x23, 0x5,  0x18, 0x1f, 0x0,  0x1d, 0x5a, 0x6,  0xe6, 0x83, 0xd6, 0x92,
      0x37, 0xe4, 0x8d, 0xe5, 0xd1, 0x35, 0xd6, 0x7a, 0xdd, 0x15, 0xf4, 0xf1, 0x79, 0xdc, 0xfc, 0xc1, 0xf0, 0x70, 0xbd,
      0x37, 0x4a, 0x9a, 0xc4, 0x1,  0x99, 0x27, 0x0,  0x0,  0x2c, 0xab, 0x28, 0x4a, 0x27, 0x0,  0x0,  0x5b, 0xec, 0x19,
      0x55, 0x1c, 0x0,  0x13, 0xe5, 0x62, 0x6e, 0xa4, 0xa0, 0x2a, 0x58, 0xc0, 0xed, 0xc3, 0x6a, 0x73, 0x3f, 0xe2, 0xa3,
      0x38, 0x62, 0x78, 0xbb, 0x65, 0xa3, 0xb5, 0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76,
      0x5b, 0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  uint8_t topic_bytes[] = {0xb0, 0x19, 0x67, 0xe9};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x65, 0xa3, 0xb5, 0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76,
                         0x5b, 0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0xbb, 0xc1, 0x5d, 0x99, 0x26, 0xd0, 0x23, 0xee, 0x10, 0xb4, 0x6e, 0x3f,
                           0x15, 0xf4, 0x6e, 0x16, 0xf8, 0xa7, 0x97, 0x87, 0xa4, 0xb3, 0xb7, 0xcd};
  uint8_t bytesprops1[] = {0x70};
  uint8_t bytesprops2[] = {0xc,  0x50, 0x99, 0xdb, 0xbe, 0xe0, 0x1d, 0xe5, 0x1c,
                           0xaf, 0xb0, 0xca, 0x38, 0x43, 0x44, 0xc1, 0x83, 0x68};
  uint8_t bytesprops3[] = {0x77, 0x5c};
  uint8_t bytesprops4[] = {0x29};
  uint8_t bytesprops5[] = {0x7,  0x2a, 0xa3, 0x39, 0x57, 0x2e, 0xdf, 0x4e, 0x1e, 0xd7, 0xaa, 0x7b, 0x7,
                           0x12, 0x33, 0x22, 0xc,  0xcf, 0x81, 0x7b, 0xd4, 0x61, 0x8,  0x78, 0x4b};
  uint8_t bytesprops6[] = {0x69, 0xb7, 0x81, 0x15, 0x81, 0xb, 0xbe, 0x18, 0x34};
  uint8_t bytesprops7[] = {0x77, 0x32, 0xf8, 0xc1};
  uint8_t bytesprops8[] = {0x5a, 0x6,  0xe6, 0x83, 0xd6, 0x92, 0x37, 0xe4, 0x8d, 0xe5, 0xd1, 0x35, 0xd6, 0x7a, 0xdd,
                           0x15, 0xf4, 0xf1, 0x79, 0xdc, 0xfc, 0xc1, 0xf0, 0x70, 0xbd, 0x37, 0x4a, 0x9a, 0xc4};
  uint8_t bytesprops9[] = {0xe5, 0x62, 0x6e, 0xa4, 0xa0, 0x2a, 0x58, 0xc0, 0xed, 0xc3,
                           0x6a, 0x73, 0x3f, 0xe2, 0xa3, 0x38, 0x62, 0x78, 0xbb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9651}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9508}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4115}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13378}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1710}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22280}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11201}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14252}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1304}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11435}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23532}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 31111, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\176\EMg\233", _pubPktID = 31111,
// _pubBody = "e\163\181)\SYN\133\198/d\225\216\252\177\&5v[\251\&3\219\232\135\&2\251>E\155#\DLE\254", _pubProps =
// [PropWillDelayInterval 9651,PropAssignedClientIdentifier
// "\187\193]\153&\208#\238\DLE\180n?\NAK\244n\SYN\248\167\151\135\164\179\183\205",PropServerReference
// "p",PropServerKeepAlive 9508,PropReceiveMaximum 4115,PropContentType
// "\fP\153\219\190\224\GS\229\FS\175\176\202\&8CD\193\131h",PropAuthenticationMethod "w\\",PropTopicAliasMaximum
// 13378,PropWildcardSubscriptionAvailable 106,PropWildcardSubscriptionAvailable 38,PropSessionExpiryInterval
// 1710,PropReceiveMaximum 22280,PropAssignedClientIdentifier ")",PropCorrelationData
// "\a*\163\&9W.\223N\RS\215\170{\a\DC23\"\f\207\129{\212a\bxK",PropAuthenticationMethod
// "i\183\129\NAK\129\v\190\CAN4",PropRetainAvailable 213,PropMaximumPacketSize 11201,PropMessageExpiryInterval
// 14252,PropResponseInformation "w2\248\193",PropTopicAlias 1304,PropReasonString
// "Z\ACK\230\131\214\146\&7\228\141\229\209\&5\214z\221\NAK\244\241y\220\252\193\240p\189\&7J\154\196",PropPayloadFormatIndicator
// 153,PropMaximumPacketSize 11435,PropWildcardSubscriptionAvailable 74,PropMaximumPacketSize
// 23532,PropRequestResponseInformation 85,PropServerReference "\229bn\164\160*X\192\237\195js?\226\163\&8bx\187"]}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {
      0x34, 0x82, 0x2,  0x0,  0x4,  0xb0, 0x19, 0x67, 0xe9, 0x79, 0x87, 0xdb, 0x1,  0x18, 0x0,  0x0,  0x25, 0xb3, 0x12,
      0x0,  0x18, 0xbb, 0xc1, 0x5d, 0x99, 0x26, 0xd0, 0x23, 0xee, 0x10, 0xb4, 0x6e, 0x3f, 0x15, 0xf4, 0x6e, 0x16, 0xf8,
      0xa7, 0x97, 0x87, 0xa4, 0xb3, 0xb7, 0xcd, 0x1c, 0x0,  0x1,  0x70, 0x13, 0x25, 0x24, 0x21, 0x10, 0x13, 0x3,  0x0,
      0x12, 0xc,  0x50, 0x99, 0xdb, 0xbe, 0xe0, 0x1d, 0xe5, 0x1c, 0xaf, 0xb0, 0xca, 0x38, 0x43, 0x44, 0xc1, 0x83, 0x68,
      0x15, 0x0,  0x2,  0x77, 0x5c, 0x22, 0x34, 0x42, 0x28, 0x6a, 0x28, 0x26, 0x11, 0x0,  0x0,  0x6,  0xae, 0x21, 0x57,
      0x8,  0x12, 0x0,  0x1,  0x29, 0x9,  0x0,  0x19, 0x7,  0x2a, 0xa3, 0x39, 0x57, 0x2e, 0xdf, 0x4e, 0x1e, 0xd7, 0xaa,
      0x7b, 0x7,  0x12, 0x33, 0x22, 0xc,  0xcf, 0x81, 0x7b, 0xd4, 0x61, 0x8,  0x78, 0x4b, 0x15, 0x0,  0x9,  0x69, 0xb7,
      0x81, 0x15, 0x81, 0xb,  0xbe, 0x18, 0x34, 0x25, 0xd5, 0x27, 0x0,  0x0,  0x2b, 0xc1, 0x2,  0x0,  0x0,  0x37, 0xac,
      0x1a, 0x0,  0x4,  0x77, 0x32, 0xf8, 0xc1, 0x23, 0x5,  0x18, 0x1f, 0x0,  0x1d, 0x5a, 0x6,  0xe6, 0x83, 0xd6, 0x92,
      0x37, 0xe4, 0x8d, 0xe5, 0xd1, 0x35, 0xd6, 0x7a, 0xdd, 0x15, 0xf4, 0xf1, 0x79, 0xdc, 0xfc, 0xc1, 0xf0, 0x70, 0xbd,
      0x37, 0x4a, 0x9a, 0xc4, 0x1,  0x99, 0x27, 0x0,  0x0,  0x2c, 0xab, 0x28, 0x4a, 0x27, 0x0,  0x0,  0x5b, 0xec, 0x19,
      0x55, 0x1c, 0x0,  0x13, 0xe5, 0x62, 0x6e, 0xa4, 0xa0, 0x2a, 0x58, 0xc0, 0xed, 0xc3, 0x6a, 0x73, 0x3f, 0xe2, 0xa3,
      0x38, 0x62, 0x78, 0xbb, 0x65, 0xa3, 0xb5, 0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76,
      0x5b, 0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb0, 0x19, 0x67, 0xe9};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x65, 0xa3, 0xb5, 0x29, 0x16, 0x85, 0xc6, 0x2f, 0x64, 0xe1, 0xd8, 0xfc, 0xb1, 0x35, 0x76,
                              0x5b, 0xfb, 0x33, 0xdb, 0xe8, 0x87, 0x32, 0xfb, 0x3e, 0x45, 0x9b, 0x23, 0x10, 0xfe};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 31111);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\169\&0\211V\249\144\&4+[\166\254\135\144\241\n\198\162\233\181\161i\132\132\ENQ\204\191", _pubPktID = 8952,
// _pubBody = "\173A\231|1\170\255\146o\191\190\DC2+uY", _pubProps = [PropSessionExpiryInterval
// 30113,PropAuthenticationData "F\253?\\\253\158\SYN\SOw\214\165\154\216\150G\189\234\235:\166",PropAuthenticationData
// "\233\DC1\174\158\255L\201\&1\254\155\229\213\228\150\156\220\234\159\&7\131*\249\208z\182\129n$",PropPayloadFormatIndicator
// 15,PropSessionExpiryInterval 21520,PropSubscriptionIdentifierAvailable 118,PropReasonString
// "\238\160|\130\186\233",PropResponseTopic "\165L\199\251m7H\RS\146 N\ESC1\163Pf",PropTopicAliasMaximum
// 10251,PropMaximumQoS 145,PropAuthenticationMethod
// "\155t\149\&8m\SUB\DC3\229\210\139\218\168\226\236,\143\195\DC4\a\RS\NUL2\193",PropTopicAlias
// 14385,PropCorrelationData
// "#\147\235m\194j\255_\202\196\148\166M\189\146\213\128\155K\236\237\150]h\RS6\212\STX\153\189",PropServerReference
// "\242",PropReceiveMaximum 30036,PropSubscriptionIdentifier 7,PropMessageExpiryInterval
// 20179,PropSubscriptionIdentifierAvailable 224,PropServerReference "="]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x3b, 0xe6, 0x1,  0x0,  0x1a, 0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87,
                   0x90, 0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf, 0x22, 0xf8, 0xb7,
                   0x1,  0x11, 0x0,  0x0,  0x75, 0xa1, 0x16, 0x0,  0x14, 0x46, 0xfd, 0x3f, 0x5c, 0xfd, 0x9e, 0x16, 0xe,
                   0x77, 0xd6, 0xa5, 0x9a, 0xd8, 0x96, 0x47, 0xbd, 0xea, 0xeb, 0x3a, 0xa6, 0x16, 0x0,  0x1c, 0xe9, 0x11,
                   0xae, 0x9e, 0xff, 0x4c, 0xc9, 0x31, 0xfe, 0x9b, 0xe5, 0xd5, 0xe4, 0x96, 0x9c, 0xdc, 0xea, 0x9f, 0x37,
                   0x83, 0x2a, 0xf9, 0xd0, 0x7a, 0xb6, 0x81, 0x6e, 0x24, 0x1,  0xf,  0x11, 0x0,  0x0,  0x54, 0x10, 0x29,
                   0x76, 0x1f, 0x0,  0x6,  0xee, 0xa0, 0x7c, 0x82, 0xba, 0xe9, 0x8,  0x0,  0x10, 0xa5, 0x4c, 0xc7, 0xfb,
                   0x6d, 0x37, 0x48, 0x1e, 0x92, 0x20, 0x4e, 0x1b, 0x31, 0xa3, 0x50, 0x66, 0x22, 0x28, 0xb,  0x24, 0x91,
                   0x15, 0x0,  0x17, 0x9b, 0x74, 0x95, 0x38, 0x6d, 0x1a, 0x13, 0xe5, 0xd2, 0x8b, 0xda, 0xa8, 0xe2, 0xec,
                   0x2c, 0x8f, 0xc3, 0x14, 0x7,  0x1e, 0x0,  0x32, 0xc1, 0x23, 0x38, 0x31, 0x9,  0x0,  0x1e, 0x23, 0x93,
                   0xeb, 0x6d, 0xc2, 0x6a, 0xff, 0x5f, 0xca, 0xc4, 0x94, 0xa6, 0x4d, 0xbd, 0x92, 0xd5, 0x80, 0x9b, 0x4b,
                   0xec, 0xed, 0x96, 0x5d, 0x68, 0x1e, 0x36, 0xd4, 0x2,  0x99, 0xbd, 0x1c, 0x0,  0x1,  0xf2, 0x21, 0x75,
                   0x54, 0xb,  0x7,  0x2,  0x0,  0x0,  0x4e, 0xd3, 0x29, 0xe0, 0x1c, 0x0,  0x1,  0x3d, 0xad, 0x41, 0xe7,
                   0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  uint8_t topic_bytes[] = {0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87, 0x90,
                           0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xad, 0x41, 0xe7, 0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x46, 0xfd, 0x3f, 0x5c, 0xfd, 0x9e, 0x16, 0xe,  0x77, 0xd6,
                           0xa5, 0x9a, 0xd8, 0x96, 0x47, 0xbd, 0xea, 0xeb, 0x3a, 0xa6};
  uint8_t bytesprops1[] = {0xe9, 0x11, 0xae, 0x9e, 0xff, 0x4c, 0xc9, 0x31, 0xfe, 0x9b, 0xe5, 0xd5, 0xe4, 0x96,
                           0x9c, 0xdc, 0xea, 0x9f, 0x37, 0x83, 0x2a, 0xf9, 0xd0, 0x7a, 0xb6, 0x81, 0x6e, 0x24};
  uint8_t bytesprops2[] = {0xee, 0xa0, 0x7c, 0x82, 0xba, 0xe9};
  uint8_t bytesprops3[] = {0xa5, 0x4c, 0xc7, 0xfb, 0x6d, 0x37, 0x48, 0x1e,
                           0x92, 0x20, 0x4e, 0x1b, 0x31, 0xa3, 0x50, 0x66};
  uint8_t bytesprops4[] = {0x9b, 0x74, 0x95, 0x38, 0x6d, 0x1a, 0x13, 0xe5, 0xd2, 0x8b, 0xda, 0xa8,
                           0xe2, 0xec, 0x2c, 0x8f, 0xc3, 0x14, 0x7,  0x1e, 0x0,  0x32, 0xc1};
  uint8_t bytesprops5[] = {0x23, 0x93, 0xeb, 0x6d, 0xc2, 0x6a, 0xff, 0x5f, 0xca, 0xc4, 0x94, 0xa6, 0x4d, 0xbd, 0x92,
                           0xd5, 0x80, 0x9b, 0x4b, 0xec, 0xed, 0x96, 0x5d, 0x68, 0x1e, 0x36, 0xd4, 0x2,  0x99, 0xbd};
  uint8_t bytesprops6[] = {0xf2};
  uint8_t bytesprops7[] = {0x3d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30113}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21520}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10251}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14385}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30036}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20179}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 8952, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\169\&0\211V\249\144\&4+[\166\254\135\144\241\n\198\162\233\181\161i\132\132\ENQ\204\191", _pubPktID = 8952,
// _pubBody = "\173A\231|1\170\255\146o\191\190\DC2+uY", _pubProps = [PropSessionExpiryInterval
// 30113,PropAuthenticationData "F\253?\\\253\158\SYN\SOw\214\165\154\216\150G\189\234\235:\166",PropAuthenticationData
// "\233\DC1\174\158\255L\201\&1\254\155\229\213\228\150\156\220\234\159\&7\131*\249\208z\182\129n$",PropPayloadFormatIndicator
// 15,PropSessionExpiryInterval 21520,PropSubscriptionIdentifierAvailable 118,PropReasonString
// "\238\160|\130\186\233",PropResponseTopic "\165L\199\251m7H\RS\146 N\ESC1\163Pf",PropTopicAliasMaximum
// 10251,PropMaximumQoS 145,PropAuthenticationMethod
// "\155t\149\&8m\SUB\DC3\229\210\139\218\168\226\236,\143\195\DC4\a\RS\NUL2\193",PropTopicAlias
// 14385,PropCorrelationData
// "#\147\235m\194j\255_\202\196\148\166M\189\146\213\128\155K\236\237\150]h\RS6\212\STX\153\189",PropServerReference
// "\242",PropReceiveMaximum 30036,PropSubscriptionIdentifier 7,PropMessageExpiryInterval
// 20179,PropSubscriptionIdentifierAvailable 224,PropServerReference "="]}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x3b, 0xe6, 0x1,  0x0,  0x1a, 0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87,
                   0x90, 0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf, 0x22, 0xf8, 0xb7,
                   0x1,  0x11, 0x0,  0x0,  0x75, 0xa1, 0x16, 0x0,  0x14, 0x46, 0xfd, 0x3f, 0x5c, 0xfd, 0x9e, 0x16, 0xe,
                   0x77, 0xd6, 0xa5, 0x9a, 0xd8, 0x96, 0x47, 0xbd, 0xea, 0xeb, 0x3a, 0xa6, 0x16, 0x0,  0x1c, 0xe9, 0x11,
                   0xae, 0x9e, 0xff, 0x4c, 0xc9, 0x31, 0xfe, 0x9b, 0xe5, 0xd5, 0xe4, 0x96, 0x9c, 0xdc, 0xea, 0x9f, 0x37,
                   0x83, 0x2a, 0xf9, 0xd0, 0x7a, 0xb6, 0x81, 0x6e, 0x24, 0x1,  0xf,  0x11, 0x0,  0x0,  0x54, 0x10, 0x29,
                   0x76, 0x1f, 0x0,  0x6,  0xee, 0xa0, 0x7c, 0x82, 0xba, 0xe9, 0x8,  0x0,  0x10, 0xa5, 0x4c, 0xc7, 0xfb,
                   0x6d, 0x37, 0x48, 0x1e, 0x92, 0x20, 0x4e, 0x1b, 0x31, 0xa3, 0x50, 0x66, 0x22, 0x28, 0xb,  0x24, 0x91,
                   0x15, 0x0,  0x17, 0x9b, 0x74, 0x95, 0x38, 0x6d, 0x1a, 0x13, 0xe5, 0xd2, 0x8b, 0xda, 0xa8, 0xe2, 0xec,
                   0x2c, 0x8f, 0xc3, 0x14, 0x7,  0x1e, 0x0,  0x32, 0xc1, 0x23, 0x38, 0x31, 0x9,  0x0,  0x1e, 0x23, 0x93,
                   0xeb, 0x6d, 0xc2, 0x6a, 0xff, 0x5f, 0xca, 0xc4, 0x94, 0xa6, 0x4d, 0xbd, 0x92, 0xd5, 0x80, 0x9b, 0x4b,
                   0xec, 0xed, 0x96, 0x5d, 0x68, 0x1e, 0x36, 0xd4, 0x2,  0x99, 0xbd, 0x1c, 0x0,  0x1,  0xf2, 0x21, 0x75,
                   0x54, 0xb,  0x7,  0x2,  0x0,  0x0,  0x4e, 0xd3, 0x29, 0xe0, 0x1c, 0x0,  0x1,  0x3d, 0xad, 0x41, 0xe7,
                   0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa9, 0x30, 0xd3, 0x56, 0xf9, 0x90, 0x34, 0x2b, 0x5b, 0xa6, 0xfe, 0x87, 0x90,
                               0xf1, 0xa,  0xc6, 0xa2, 0xe9, 0xb5, 0xa1, 0x69, 0x84, 0x84, 0x5,  0xcc, 0xbf};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xad, 0x41, 0xe7, 0x7c, 0x31, 0xaa, 0xff, 0x92, 0x6f, 0xbf, 0xbe, 0x12, 0x2b, 0x75, 0x59};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8952);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192!\207\251\220\139\197\DC3\237\227", _pubPktID = 0, _pubBody =
// "\245Ha\212\EM\NAK\214Qf\253*\177\142\202P\176\144\184\149N\DC4", _pubProps = [PropTopicAlias
// 3759,PropResponseInformation
// "\245\164\GS\240\187}\174_\151\ACK?s\DLE2\169+>\151\236\152c\182\b\170\246",PropAssignedClientIdentifier
// "\169\144\210\176\DLE\251Z\157\181.\146\208\224h\194DM\GS\167\NUL\250p\230dN",PropResponseInformation
// "X\142\143\234\134\SUB",PropSharedSubscriptionAvailable 170,PropAssignedClientIdentifier
// "5H\226\179\205\205:\DLE\EOT7\197",PropRequestProblemInformation 49,PropMaximumPacketSize
// 20134,PropAuthenticationData "\248'/Y\163M\183\162wG\"\214O\157\154\241_0\138\221\142\ENQ",PropAuthenticationData
// "\129\142\250\191\157\CANwJP\NUL\234\159\&2v\213{\ENQ\226",PropWillDelayInterval 29261,PropRequestResponseInformation
// 250,PropSubscriptionIdentifierAvailable 166,PropReceiveMaximum 5141,PropContentType
// "\248E\130iq\199\135\148\247\210\249\161\239",PropWillDelayInterval 13294,PropResponseTopic "\192\253\130
// \186\b\183",PropReasonString "8\209Z\ETX\240uer\136F\242\SYNJZ\202\&2\216&\208\&4M6\146",PropReasonString
// "\242\&9h%\150{\204\238\219\162\231\248\194\216,D\178\194O\230\209\t5\134",PropMessageExpiryInterval 21649]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x38, 0x91, 0x2,  0x0,  0xa,  0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13, 0xed, 0xe3, 0xee, 0x1,  0x23, 0xe,
      0xaf, 0x1a, 0x0,  0x19, 0xf5, 0xa4, 0x1d, 0xf0, 0xbb, 0x7d, 0xae, 0x5f, 0x97, 0x6,  0x3f, 0x73, 0x10, 0x32, 0xa9,
      0x2b, 0x3e, 0x97, 0xec, 0x98, 0x63, 0xb6, 0x8,  0xaa, 0xf6, 0x12, 0x0,  0x19, 0xa9, 0x90, 0xd2, 0xb0, 0x10, 0xfb,
      0x5a, 0x9d, 0xb5, 0x2e, 0x92, 0xd0, 0xe0, 0x68, 0xc2, 0x44, 0x4d, 0x1d, 0xa7, 0x0,  0xfa, 0x70, 0xe6, 0x64, 0x4e,
      0x1a, 0x0,  0x6,  0x58, 0x8e, 0x8f, 0xea, 0x86, 0x1a, 0x2a, 0xaa, 0x12, 0x0,  0xb,  0x35, 0x48, 0xe2, 0xb3, 0xcd,
      0xcd, 0x3a, 0x10, 0x4,  0x37, 0xc5, 0x17, 0x31, 0x27, 0x0,  0x0,  0x4e, 0xa6, 0x16, 0x0,  0x16, 0xf8, 0x27, 0x2f,
      0x59, 0xa3, 0x4d, 0xb7, 0xa2, 0x77, 0x47, 0x22, 0xd6, 0x4f, 0x9d, 0x9a, 0xf1, 0x5f, 0x30, 0x8a, 0xdd, 0x8e, 0x5,
      0x16, 0x0,  0x12, 0x81, 0x8e, 0xfa, 0xbf, 0x9d, 0x18, 0x77, 0x4a, 0x50, 0x0,  0xea, 0x9f, 0x32, 0x76, 0xd5, 0x7b,
      0x5,  0xe2, 0x18, 0x0,  0x0,  0x72, 0x4d, 0x19, 0xfa, 0x29, 0xa6, 0x21, 0x14, 0x15, 0x3,  0x0,  0xd,  0xf8, 0x45,
      0x82, 0x69, 0x71, 0xc7, 0x87, 0x94, 0xf7, 0xd2, 0xf9, 0xa1, 0xef, 0x18, 0x0,  0x0,  0x33, 0xee, 0x8,  0x0,  0x7,
      0xc0, 0xfd, 0x82, 0x20, 0xba, 0x8,  0xb7, 0x1f, 0x0,  0x17, 0x38, 0xd1, 0x5a, 0x3,  0xf0, 0x75, 0x65, 0x72, 0x88,
      0x46, 0xf2, 0x16, 0x4a, 0x5a, 0xca, 0x32, 0xd8, 0x26, 0xd0, 0x34, 0x4d, 0x36, 0x92, 0x1f, 0x0,  0x18, 0xf2, 0x39,
      0x68, 0x25, 0x96, 0x7b, 0xcc, 0xee, 0xdb, 0xa2, 0xe7, 0xf8, 0xc2, 0xd8, 0x2c, 0x44, 0xb2, 0xc2, 0x4f, 0xe6, 0xd1,
      0x9,  0x35, 0x86, 0x2,  0x0,  0x0,  0x54, 0x91, 0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd, 0x2a,
      0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  uint8_t topic_bytes[] = {0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13, 0xed, 0xe3};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd, 0x2a,
                         0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xf5, 0xa4, 0x1d, 0xf0, 0xbb, 0x7d, 0xae, 0x5f, 0x97, 0x6, 0x3f, 0x73, 0x10,
                           0x32, 0xa9, 0x2b, 0x3e, 0x97, 0xec, 0x98, 0x63, 0xb6, 0x8, 0xaa, 0xf6};
  uint8_t bytesprops1[] = {0xa9, 0x90, 0xd2, 0xb0, 0x10, 0xfb, 0x5a, 0x9d, 0xb5, 0x2e, 0x92, 0xd0, 0xe0,
                           0x68, 0xc2, 0x44, 0x4d, 0x1d, 0xa7, 0x0,  0xfa, 0x70, 0xe6, 0x64, 0x4e};
  uint8_t bytesprops2[] = {0x58, 0x8e, 0x8f, 0xea, 0x86, 0x1a};
  uint8_t bytesprops3[] = {0x35, 0x48, 0xe2, 0xb3, 0xcd, 0xcd, 0x3a, 0x10, 0x4, 0x37, 0xc5};
  uint8_t bytesprops4[] = {0xf8, 0x27, 0x2f, 0x59, 0xa3, 0x4d, 0xb7, 0xa2, 0x77, 0x47, 0x22,
                           0xd6, 0x4f, 0x9d, 0x9a, 0xf1, 0x5f, 0x30, 0x8a, 0xdd, 0x8e, 0x5};
  uint8_t bytesprops5[] = {0x81, 0x8e, 0xfa, 0xbf, 0x9d, 0x18, 0x77, 0x4a, 0x50,
                           0x0,  0xea, 0x9f, 0x32, 0x76, 0xd5, 0x7b, 0x5,  0xe2};
  uint8_t bytesprops6[] = {0xf8, 0x45, 0x82, 0x69, 0x71, 0xc7, 0x87, 0x94, 0xf7, 0xd2, 0xf9, 0xa1, 0xef};
  uint8_t bytesprops7[] = {0xc0, 0xfd, 0x82, 0x20, 0xba, 0x8, 0xb7};
  uint8_t bytesprops8[] = {0x38, 0xd1, 0x5a, 0x3,  0xf0, 0x75, 0x65, 0x72, 0x88, 0x46, 0xf2, 0x16,
                           0x4a, 0x5a, 0xca, 0x32, 0xd8, 0x26, 0xd0, 0x34, 0x4d, 0x36, 0x92};
  uint8_t bytesprops9[] = {0xf2, 0x39, 0x68, 0x25, 0x96, 0x7b, 0xcc, 0xee, 0xdb, 0xa2, 0xe7, 0xf8,
                           0xc2, 0xd8, 0x2c, 0x44, 0xb2, 0xc2, 0x4f, 0xe6, 0xd1, 0x9,  0x35, 0x86};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3759}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20134}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29261}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5141}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13294}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21649}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\192!\207\251\220\139\197\DC3\237\227", _pubPktID = 0, _pubBody =
// "\245Ha\212\EM\NAK\214Qf\253*\177\142\202P\176\144\184\149N\DC4", _pubProps = [PropTopicAlias
// 3759,PropResponseInformation
// "\245\164\GS\240\187}\174_\151\ACK?s\DLE2\169+>\151\236\152c\182\b\170\246",PropAssignedClientIdentifier
// "\169\144\210\176\DLE\251Z\157\181.\146\208\224h\194DM\GS\167\NUL\250p\230dN",PropResponseInformation
// "X\142\143\234\134\SUB",PropSharedSubscriptionAvailable 170,PropAssignedClientIdentifier
// "5H\226\179\205\205:\DLE\EOT7\197",PropRequestProblemInformation 49,PropMaximumPacketSize
// 20134,PropAuthenticationData "\248'/Y\163M\183\162wG\"\214O\157\154\241_0\138\221\142\ENQ",PropAuthenticationData
// "\129\142\250\191\157\CANwJP\NUL\234\159\&2v\213{\ENQ\226",PropWillDelayInterval 29261,PropRequestResponseInformation
// 250,PropSubscriptionIdentifierAvailable 166,PropReceiveMaximum 5141,PropContentType
// "\248E\130iq\199\135\148\247\210\249\161\239",PropWillDelayInterval 13294,PropResponseTopic "\192\253\130
// \186\b\183",PropReasonString "8\209Z\ETX\240uer\136F\242\SYNJZ\202\&2\216&\208\&4M6\146",PropReasonString
// "\242\&9h%\150{\204\238\219\162\231\248\194\216,D\178\194O\230\209\t5\134",PropMessageExpiryInterval 21649]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {
      0x38, 0x91, 0x2,  0x0,  0xa,  0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13, 0xed, 0xe3, 0xee, 0x1,  0x23, 0xe,
      0xaf, 0x1a, 0x0,  0x19, 0xf5, 0xa4, 0x1d, 0xf0, 0xbb, 0x7d, 0xae, 0x5f, 0x97, 0x6,  0x3f, 0x73, 0x10, 0x32, 0xa9,
      0x2b, 0x3e, 0x97, 0xec, 0x98, 0x63, 0xb6, 0x8,  0xaa, 0xf6, 0x12, 0x0,  0x19, 0xa9, 0x90, 0xd2, 0xb0, 0x10, 0xfb,
      0x5a, 0x9d, 0xb5, 0x2e, 0x92, 0xd0, 0xe0, 0x68, 0xc2, 0x44, 0x4d, 0x1d, 0xa7, 0x0,  0xfa, 0x70, 0xe6, 0x64, 0x4e,
      0x1a, 0x0,  0x6,  0x58, 0x8e, 0x8f, 0xea, 0x86, 0x1a, 0x2a, 0xaa, 0x12, 0x0,  0xb,  0x35, 0x48, 0xe2, 0xb3, 0xcd,
      0xcd, 0x3a, 0x10, 0x4,  0x37, 0xc5, 0x17, 0x31, 0x27, 0x0,  0x0,  0x4e, 0xa6, 0x16, 0x0,  0x16, 0xf8, 0x27, 0x2f,
      0x59, 0xa3, 0x4d, 0xb7, 0xa2, 0x77, 0x47, 0x22, 0xd6, 0x4f, 0x9d, 0x9a, 0xf1, 0x5f, 0x30, 0x8a, 0xdd, 0x8e, 0x5,
      0x16, 0x0,  0x12, 0x81, 0x8e, 0xfa, 0xbf, 0x9d, 0x18, 0x77, 0x4a, 0x50, 0x0,  0xea, 0x9f, 0x32, 0x76, 0xd5, 0x7b,
      0x5,  0xe2, 0x18, 0x0,  0x0,  0x72, 0x4d, 0x19, 0xfa, 0x29, 0xa6, 0x21, 0x14, 0x15, 0x3,  0x0,  0xd,  0xf8, 0x45,
      0x82, 0x69, 0x71, 0xc7, 0x87, 0x94, 0xf7, 0xd2, 0xf9, 0xa1, 0xef, 0x18, 0x0,  0x0,  0x33, 0xee, 0x8,  0x0,  0x7,
      0xc0, 0xfd, 0x82, 0x20, 0xba, 0x8,  0xb7, 0x1f, 0x0,  0x17, 0x38, 0xd1, 0x5a, 0x3,  0xf0, 0x75, 0x65, 0x72, 0x88,
      0x46, 0xf2, 0x16, 0x4a, 0x5a, 0xca, 0x32, 0xd8, 0x26, 0xd0, 0x34, 0x4d, 0x36, 0x92, 0x1f, 0x0,  0x18, 0xf2, 0x39,
      0x68, 0x25, 0x96, 0x7b, 0xcc, 0xee, 0xdb, 0xa2, 0xe7, 0xf8, 0xc2, 0xd8, 0x2c, 0x44, 0xb2, 0xc2, 0x4f, 0xe6, 0xd1,
      0x9,  0x35, 0x86, 0x2,  0x0,  0x0,  0x54, 0x91, 0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd, 0x2a,
      0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xc0, 0x21, 0xcf, 0xfb, 0xdc, 0x8b, 0xc5, 0x13, 0xed, 0xe3};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x48, 0x61, 0xd4, 0x19, 0x15, 0xd6, 0x51, 0x66, 0xfd, 0x2a,
                              0xb1, 0x8e, 0xca, 0x50, 0xb0, 0x90, 0xb8, 0x95, 0x4e, 0x14};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\244\163\195\181~\198`:\150F\212N",
// _pubPktID = 32625, _pubBody =
// "\158m\139\172\171\135\&7\154\136\129\210{\228\197\SI[\STXw\192\242\239k\178\152Q\211\143S\146", _pubProps =
// [PropRetainAvailable 200,PropUserProperty "%\166w" "",PropReasonString "\237\166:\221\247RP\b",PropResponseTopic
// "F\161\242\a\175\186\140'\182\EOT=\208-\218\EOTL\225",PropAuthenticationData
// "\154?.'<\181\175R\167\197j\217\183\232\r\134\216\215\n\EOT",PropSubscriptionIdentifier 28]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x33, 0x70, 0x0,  0xc,  0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e, 0x7f,
                   0x71, 0x42, 0x25, 0xc8, 0x26, 0x0,  0x3,  0x25, 0xa6, 0x77, 0x0,  0x0,  0x1f, 0x0,  0x8,  0xed, 0xa6,
                   0x3a, 0xdd, 0xf7, 0x52, 0x50, 0x8,  0x8,  0x0,  0x11, 0x46, 0xa1, 0xf2, 0x7,  0xaf, 0xba, 0x8c, 0x27,
                   0xb6, 0x4,  0x3d, 0xd0, 0x2d, 0xda, 0x4,  0x4c, 0xe1, 0x16, 0x0,  0x14, 0x9a, 0x3f, 0x2e, 0x27, 0x3c,
                   0xb5, 0xaf, 0x52, 0xa7, 0xc5, 0x6a, 0xd9, 0xb7, 0xe8, 0xd,  0x86, 0xd8, 0xd7, 0xa,  0x4,  0xb,  0x1c,
                   0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5, 0xf,  0x5b, 0x2,
                   0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  uint8_t topic_bytes[] = {0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5, 0xf,
                         0x5b, 0x2,  0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops0[] = {0x25, 0xa6, 0x77};
  uint8_t bytesprops2[] = {0xed, 0xa6, 0x3a, 0xdd, 0xf7, 0x52, 0x50, 0x8};
  uint8_t bytesprops3[] = {0x46, 0xa1, 0xf2, 0x7,  0xaf, 0xba, 0x8c, 0x27, 0xb6,
                           0x4,  0x3d, 0xd0, 0x2d, 0xda, 0x4,  0x4c, 0xe1};
  uint8_t bytesprops4[] = {0x9a, 0x3f, 0x2e, 0x27, 0x3c, 0xb5, 0xaf, 0x52, 0xa7, 0xc5,
                           0x6a, 0xd9, 0xb7, 0xe8, 0xd,  0x86, 0xd8, 0xd7, 0xa,  0x4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops0}, .v = {0, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 32625, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "\244\163\195\181~\198`:\150F\212N",
// _pubPktID = 32625, _pubBody =
// "\158m\139\172\171\135\&7\154\136\129\210{\228\197\SI[\STXw\192\242\239k\178\152Q\211\143S\146", _pubProps =
// [PropRetainAvailable 200,PropUserProperty "%\166w" "",PropReasonString "\237\166:\221\247RP\b",PropResponseTopic
// "F\161\242\a\175\186\140'\182\EOT=\208-\218\EOTL\225",PropAuthenticationData
// "\154?.'<\181\175R\167\197j\217\183\232\r\134\216\215\n\EOT",PropSubscriptionIdentifier 28]}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x33, 0x70, 0x0,  0xc,  0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e, 0x7f,
                   0x71, 0x42, 0x25, 0xc8, 0x26, 0x0,  0x3,  0x25, 0xa6, 0x77, 0x0,  0x0,  0x1f, 0x0,  0x8,  0xed, 0xa6,
                   0x3a, 0xdd, 0xf7, 0x52, 0x50, 0x8,  0x8,  0x0,  0x11, 0x46, 0xa1, 0xf2, 0x7,  0xaf, 0xba, 0x8c, 0x27,
                   0xb6, 0x4,  0x3d, 0xd0, 0x2d, 0xda, 0x4,  0x4c, 0xe1, 0x16, 0x0,  0x14, 0x9a, 0x3f, 0x2e, 0x27, 0x3c,
                   0xb5, 0xaf, 0x52, 0xa7, 0xc5, 0x6a, 0xd9, 0xb7, 0xe8, 0xd,  0x86, 0xd8, 0xd7, 0xa,  0x4,  0xb,  0x1c,
                   0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5, 0xf,  0x5b, 0x2,
                   0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf4, 0xa3, 0xc3, 0xb5, 0x7e, 0xc6, 0x60, 0x3a, 0x96, 0x46, 0xd4, 0x4e};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9e, 0x6d, 0x8b, 0xac, 0xab, 0x87, 0x37, 0x9a, 0x88, 0x81, 0xd2, 0x7b, 0xe4, 0xc5, 0xf,
                              0x5b, 0x2,  0x77, 0xc0, 0xf2, 0xef, 0x6b, 0xb2, 0x98, 0x51, 0xd3, 0x8f, 0x53, 0x92};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 32625);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\\\v`\145\USn?\217L\147\211\\\SI\254", _pubPktID = 25006, _pubBody =
// "\207\181\171\145\132\166r/\NUL\137\195|e\244P\185", _pubProps = [PropResponseInformation
// "P\171\221\201qC\168\EMD\255\220@\144\fgX\161",PropSharedSubscriptionAvailable 14,PropWillDelayInterval
// 28881,PropUserProperty "\140\245\172R\142\163\214\f*N\SUB]\196\183\185\&8\242\f\237\184+hL\186\252\182{\162\&4"
// "l\172\&0q\167.",PropMessageExpiryInterval 7945,PropSharedSubscriptionAvailable 254,PropTopicAliasMaximum
// 5168,PropMaximumPacketSize 18305,PropReasonString "\DLEX\154\137\214\187\202\155s&o\172A\204L&zd",PropServerReference
// "t\DC2\222\180\241u\DC1\150\244\NUL\184\184\171\206\231\NUL\242k\163\ETX\EOT\196\224\248\224",PropSubscriptionIdentifierAvailable
// 196,PropMaximumPacketSize 1305,PropSubscriptionIdentifier 26,PropMessageExpiryInterval
// 20834,PropWildcardSubscriptionAvailable 162,PropSubscriptionIdentifier 5,PropAuthenticationMethod
// "\220u\139\169",PropReasonString "\196[",PropSessionExpiryInterval 11673,PropUserProperty
// ":@1b\178\ETB\249,)\129\251\184'Xb\198\DLER\SYN"
// "\153\188F5\215\167\243&P\207V\137\242\DELw\128M'\217\232]\151,T",PropSubscriptionIdentifier
// 16,PropWildcardSubscriptionAvailable 109,PropContentType
// "\137\168\&9{\224\239\138+\226\186\ETB{\243/\182G\239\197/\228\230T ",PropMessageExpiryInterval
// 267,PropMessageExpiryInterval 5907,PropResponseTopic
// "\233{\213\216(\221\150\&0\158\246`u\203\194it\162\135\&3nT\211\SYN\ENQ\179",PropSubscriptionIdentifier 12]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x33, 0xc1, 0x2,  0x0,  0xf,  0x9c, 0x5c, 0xb,  0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9, 0x4c, 0x93, 0xd3, 0x5c,
      0xf,  0xfe, 0x61, 0xae, 0x9c, 0x2,  0x1a, 0x0,  0x11, 0x50, 0xab, 0xdd, 0xc9, 0x71, 0x43, 0xa8, 0x19, 0x44,
      0xff, 0xdc, 0x40, 0x90, 0xc,  0x67, 0x58, 0xa1, 0x2a, 0xe,  0x18, 0x0,  0x0,  0x70, 0xd1, 0x26, 0x0,  0x1d,
      0x8c, 0xf5, 0xac, 0x52, 0x8e, 0xa3, 0xd6, 0xc,  0x2a, 0x4e, 0x1a, 0x5d, 0xc4, 0xb7, 0xb9, 0x38, 0xf2, 0xc,
      0xed, 0xb8, 0x2b, 0x68, 0x4c, 0xba, 0xfc, 0xb6, 0x7b, 0xa2, 0x34, 0x0,  0x6,  0x6c, 0xac, 0x30, 0x71, 0xa7,
      0x2e, 0x2,  0x0,  0x0,  0x1f, 0x9,  0x2a, 0xfe, 0x22, 0x14, 0x30, 0x27, 0x0,  0x0,  0x47, 0x81, 0x1f, 0x0,
      0x12, 0x10, 0x58, 0x9a, 0x89, 0xd6, 0xbb, 0xca, 0x9b, 0x73, 0x26, 0x6f, 0xac, 0x41, 0xcc, 0x4c, 0x26, 0x7a,
      0x64, 0x1c, 0x0,  0x19, 0x74, 0x12, 0xde, 0xb4, 0xf1, 0x75, 0x11, 0x96, 0xf4, 0x0,  0xb8, 0xb8, 0xab, 0xce,
      0xe7, 0x0,  0xf2, 0x6b, 0xa3, 0x3,  0x4,  0xc4, 0xe0, 0xf8, 0xe0, 0x29, 0xc4, 0x27, 0x0,  0x0,  0x5,  0x19,
      0xb,  0x1a, 0x2,  0x0,  0x0,  0x51, 0x62, 0x28, 0xa2, 0xb,  0x5,  0x15, 0x0,  0x4,  0xdc, 0x75, 0x8b, 0xa9,
      0x1f, 0x0,  0x2,  0xc4, 0x5b, 0x11, 0x0,  0x0,  0x2d, 0x99, 0x26, 0x0,  0x13, 0x3a, 0x40, 0x31, 0x62, 0xb2,
      0x17, 0xf9, 0x2c, 0x29, 0x81, 0xfb, 0xb8, 0x27, 0x58, 0x62, 0xc6, 0x10, 0x52, 0x16, 0x0,  0x18, 0x99, 0xbc,
      0x46, 0x35, 0xd7, 0xa7, 0xf3, 0x26, 0x50, 0xcf, 0x56, 0x89, 0xf2, 0x7f, 0x77, 0x80, 0x4d, 0x27, 0xd9, 0xe8,
      0x5d, 0x97, 0x2c, 0x54, 0xb,  0x10, 0x28, 0x6d, 0x3,  0x0,  0x17, 0x89, 0xa8, 0x39, 0x7b, 0xe0, 0xef, 0x8a,
      0x2b, 0xe2, 0xba, 0x17, 0x7b, 0xf3, 0x2f, 0xb6, 0x47, 0xef, 0xc5, 0x2f, 0xe4, 0xe6, 0x54, 0x20, 0x2,  0x0,
      0x0,  0x1,  0xb,  0x2,  0x0,  0x0,  0x17, 0x13, 0x8,  0x0,  0x19, 0xe9, 0x7b, 0xd5, 0xd8, 0x28, 0xdd, 0x96,
      0x30, 0x9e, 0xf6, 0x60, 0x75, 0xcb, 0xc2, 0x69, 0x74, 0xa2, 0x87, 0x33, 0x6e, 0x54, 0xd3, 0x16, 0x5,  0xb3,
      0xb,  0xc,  0xcf, 0xb5, 0xab, 0x91, 0x84, 0xa6, 0x72, 0x2f, 0x0,  0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  uint8_t topic_bytes[] = {0x9c, 0x5c, 0xb, 0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9, 0x4c, 0x93, 0xd3, 0x5c, 0xf, 0xfe};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xcf, 0xb5, 0xab, 0x91, 0x84, 0xa6, 0x72, 0x2f, 0x0, 0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops0[] = {0x50, 0xab, 0xdd, 0xc9, 0x71, 0x43, 0xa8, 0x19, 0x44,
                           0xff, 0xdc, 0x40, 0x90, 0xc,  0x67, 0x58, 0xa1};
  uint8_t bytesprops2[] = {0x6c, 0xac, 0x30, 0x71, 0xa7, 0x2e};
  uint8_t bytesprops1[] = {0x8c, 0xf5, 0xac, 0x52, 0x8e, 0xa3, 0xd6, 0xc,  0x2a, 0x4e, 0x1a, 0x5d, 0xc4, 0xb7, 0xb9,
                           0x38, 0xf2, 0xc,  0xed, 0xb8, 0x2b, 0x68, 0x4c, 0xba, 0xfc, 0xb6, 0x7b, 0xa2, 0x34};
  uint8_t bytesprops3[] = {0x10, 0x58, 0x9a, 0x89, 0xd6, 0xbb, 0xca, 0x9b, 0x73,
                           0x26, 0x6f, 0xac, 0x41, 0xcc, 0x4c, 0x26, 0x7a, 0x64};
  uint8_t bytesprops4[] = {0x74, 0x12, 0xde, 0xb4, 0xf1, 0x75, 0x11, 0x96, 0xf4, 0x0,  0xb8, 0xb8, 0xab,
                           0xce, 0xe7, 0x0,  0xf2, 0x6b, 0xa3, 0x3,  0x4,  0xc4, 0xe0, 0xf8, 0xe0};
  uint8_t bytesprops5[] = {0xdc, 0x75, 0x8b, 0xa9};
  uint8_t bytesprops6[] = {0xc4, 0x5b};
  uint8_t bytesprops8[] = {0x99, 0xbc, 0x46, 0x35, 0xd7, 0xa7, 0xf3, 0x26, 0x50, 0xcf, 0x56, 0x89,
                           0xf2, 0x7f, 0x77, 0x80, 0x4d, 0x27, 0xd9, 0xe8, 0x5d, 0x97, 0x2c, 0x54};
  uint8_t bytesprops7[] = {0x3a, 0x40, 0x31, 0x62, 0xb2, 0x17, 0xf9, 0x2c, 0x29, 0x81,
                           0xfb, 0xb8, 0x27, 0x58, 0x62, 0xc6, 0x10, 0x52, 0x16};
  uint8_t bytesprops9[] = {0x89, 0xa8, 0x39, 0x7b, 0xe0, 0xef, 0x8a, 0x2b, 0xe2, 0xba, 0x17, 0x7b,
                           0xf3, 0x2f, 0xb6, 0x47, 0xef, 0xc5, 0x2f, 0xe4, 0xe6, 0x54, 0x20};
  uint8_t bytesprops10[] = {0xe9, 0x7b, 0xd5, 0xd8, 0x28, 0xdd, 0x96, 0x30, 0x9e, 0xf6, 0x60, 0x75, 0xcb,
                            0xc2, 0x69, 0x74, 0xa2, 0x87, 0x33, 0x6e, 0x54, 0xd3, 0x16, 0x5,  0xb3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28881}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {6, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7945}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5168}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18305}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1305}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20834}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11673}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops7}, .v = {24, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 267}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5907}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 25006, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\156\\\v`\145\USn?\217L\147\211\\\SI\254", _pubPktID = 25006, _pubBody =
// "\207\181\171\145\132\166r/\NUL\137\195|e\244P\185", _pubProps = [PropResponseInformation
// "P\171\221\201qC\168\EMD\255\220@\144\fgX\161",PropSharedSubscriptionAvailable 14,PropWillDelayInterval
// 28881,PropUserProperty "\140\245\172R\142\163\214\f*N\SUB]\196\183\185\&8\242\f\237\184+hL\186\252\182{\162\&4"
// "l\172\&0q\167.",PropMessageExpiryInterval 7945,PropSharedSubscriptionAvailable 254,PropTopicAliasMaximum
// 5168,PropMaximumPacketSize 18305,PropReasonString "\DLEX\154\137\214\187\202\155s&o\172A\204L&zd",PropServerReference
// "t\DC2\222\180\241u\DC1\150\244\NUL\184\184\171\206\231\NUL\242k\163\ETX\EOT\196\224\248\224",PropSubscriptionIdentifierAvailable
// 196,PropMaximumPacketSize 1305,PropSubscriptionIdentifier 26,PropMessageExpiryInterval
// 20834,PropWildcardSubscriptionAvailable 162,PropSubscriptionIdentifier 5,PropAuthenticationMethod
// "\220u\139\169",PropReasonString "\196[",PropSessionExpiryInterval 11673,PropUserProperty
// ":@1b\178\ETB\249,)\129\251\184'Xb\198\DLER\SYN"
// "\153\188F5\215\167\243&P\207V\137\242\DELw\128M'\217\232]\151,T",PropSubscriptionIdentifier
// 16,PropWildcardSubscriptionAvailable 109,PropContentType
// "\137\168\&9{\224\239\138+\226\186\ETB{\243/\182G\239\197/\228\230T ",PropMessageExpiryInterval
// 267,PropMessageExpiryInterval 5907,PropResponseTopic
// "\233{\213\216(\221\150\&0\158\246`u\203\194it\162\135\&3nT\211\SYN\ENQ\179",PropSubscriptionIdentifier 12]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {
      0x33, 0xc1, 0x2,  0x0,  0xf,  0x9c, 0x5c, 0xb,  0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9, 0x4c, 0x93, 0xd3, 0x5c,
      0xf,  0xfe, 0x61, 0xae, 0x9c, 0x2,  0x1a, 0x0,  0x11, 0x50, 0xab, 0xdd, 0xc9, 0x71, 0x43, 0xa8, 0x19, 0x44,
      0xff, 0xdc, 0x40, 0x90, 0xc,  0x67, 0x58, 0xa1, 0x2a, 0xe,  0x18, 0x0,  0x0,  0x70, 0xd1, 0x26, 0x0,  0x1d,
      0x8c, 0xf5, 0xac, 0x52, 0x8e, 0xa3, 0xd6, 0xc,  0x2a, 0x4e, 0x1a, 0x5d, 0xc4, 0xb7, 0xb9, 0x38, 0xf2, 0xc,
      0xed, 0xb8, 0x2b, 0x68, 0x4c, 0xba, 0xfc, 0xb6, 0x7b, 0xa2, 0x34, 0x0,  0x6,  0x6c, 0xac, 0x30, 0x71, 0xa7,
      0x2e, 0x2,  0x0,  0x0,  0x1f, 0x9,  0x2a, 0xfe, 0x22, 0x14, 0x30, 0x27, 0x0,  0x0,  0x47, 0x81, 0x1f, 0x0,
      0x12, 0x10, 0x58, 0x9a, 0x89, 0xd6, 0xbb, 0xca, 0x9b, 0x73, 0x26, 0x6f, 0xac, 0x41, 0xcc, 0x4c, 0x26, 0x7a,
      0x64, 0x1c, 0x0,  0x19, 0x74, 0x12, 0xde, 0xb4, 0xf1, 0x75, 0x11, 0x96, 0xf4, 0x0,  0xb8, 0xb8, 0xab, 0xce,
      0xe7, 0x0,  0xf2, 0x6b, 0xa3, 0x3,  0x4,  0xc4, 0xe0, 0xf8, 0xe0, 0x29, 0xc4, 0x27, 0x0,  0x0,  0x5,  0x19,
      0xb,  0x1a, 0x2,  0x0,  0x0,  0x51, 0x62, 0x28, 0xa2, 0xb,  0x5,  0x15, 0x0,  0x4,  0xdc, 0x75, 0x8b, 0xa9,
      0x1f, 0x0,  0x2,  0xc4, 0x5b, 0x11, 0x0,  0x0,  0x2d, 0x99, 0x26, 0x0,  0x13, 0x3a, 0x40, 0x31, 0x62, 0xb2,
      0x17, 0xf9, 0x2c, 0x29, 0x81, 0xfb, 0xb8, 0x27, 0x58, 0x62, 0xc6, 0x10, 0x52, 0x16, 0x0,  0x18, 0x99, 0xbc,
      0x46, 0x35, 0xd7, 0xa7, 0xf3, 0x26, 0x50, 0xcf, 0x56, 0x89, 0xf2, 0x7f, 0x77, 0x80, 0x4d, 0x27, 0xd9, 0xe8,
      0x5d, 0x97, 0x2c, 0x54, 0xb,  0x10, 0x28, 0x6d, 0x3,  0x0,  0x17, 0x89, 0xa8, 0x39, 0x7b, 0xe0, 0xef, 0x8a,
      0x2b, 0xe2, 0xba, 0x17, 0x7b, 0xf3, 0x2f, 0xb6, 0x47, 0xef, 0xc5, 0x2f, 0xe4, 0xe6, 0x54, 0x20, 0x2,  0x0,
      0x0,  0x1,  0xb,  0x2,  0x0,  0x0,  0x17, 0x13, 0x8,  0x0,  0x19, 0xe9, 0x7b, 0xd5, 0xd8, 0x28, 0xdd, 0x96,
      0x30, 0x9e, 0xf6, 0x60, 0x75, 0xcb, 0xc2, 0x69, 0x74, 0xa2, 0x87, 0x33, 0x6e, 0x54, 0xd3, 0x16, 0x5,  0xb3,
      0xb,  0xc,  0xcf, 0xb5, 0xab, 0x91, 0x84, 0xa6, 0x72, 0x2f, 0x0,  0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9c, 0x5c, 0xb, 0x60, 0x91, 0x1f, 0x6e, 0x3f, 0xd9, 0x4c, 0x93, 0xd3, 0x5c, 0xf, 0xfe};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xcf, 0xb5, 0xab, 0x91, 0x84, 0xa6, 0x72, 0x2f,
                              0x0,  0x89, 0xc3, 0x7c, 0x65, 0xf4, 0x50, 0xb9};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25006);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\239p\183", _pubPktID = 0, _pubBody
// = "\STX\249\&8\215\vJ\163\136\174\235\187\163\ESCJ(\246", _pubProps = [PropResponseInformation
// "\235SGi\157",PropMaximumQoS 13,PropTopicAliasMaximum 11062,PropRetainAvailable 5,PropContentType
// "\225T\209m5\145\241\225\244VH\131\192",PropServerReference
// "\147\213\137%\253\130\240A~=\245\208KQ\252\225\170\182\237\162x\",\\",PropTopicAliasMaximum
// 4266,PropAuthenticationMethod "T\237o\195;\130\&2/",PropSubscriptionIdentifier 26,PropSharedSubscriptionAvailable
// 217,PropMessageExpiryInterval 25018,PropReasonString "\171%",PropSubscriptionIdentifier 12,PropTopicAlias
// 23933,PropServerKeepAlive 18136,PropReasonString
// "\f\141$cR\131\&2f6\157\157R\SO`\238-\f\245m\221\&2\DC1\128C\182\143\250",PropAuthenticationData
// "{\197\227\&1\ETB\SYN\GS\190l\243",PropContentType
// "\245>C;\130\233{R\215\DLED\226K",PropWildcardSubscriptionAvailable 158,PropMessageExpiryInterval
// 14738,PropRequestResponseInformation 28,PropMaximumPacketSize 12465,PropMaximumQoS 234,PropReceiveMaximum
// 4522,PropPayloadFormatIndicator 153,PropTopicAlias 5567,PropRetainAvailable 217]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x31, 0xca, 0x1,  0x0,  0x3,  0xef, 0x70, 0xb7, 0xb3, 0x1,  0x1a, 0x0,  0x5,  0xeb, 0x53, 0x47, 0x69, 0x9d, 0x24,
      0xd,  0x22, 0x2b, 0x36, 0x25, 0x5,  0x3,  0x0,  0xd,  0xe1, 0x54, 0xd1, 0x6d, 0x35, 0x91, 0xf1, 0xe1, 0xf4, 0x56,
      0x48, 0x83, 0xc0, 0x1c, 0x0,  0x18, 0x93, 0xd5, 0x89, 0x25, 0xfd, 0x82, 0xf0, 0x41, 0x7e, 0x3d, 0xf5, 0xd0, 0x4b,
      0x51, 0xfc, 0xe1, 0xaa, 0xb6, 0xed, 0xa2, 0x78, 0x22, 0x2c, 0x5c, 0x22, 0x10, 0xaa, 0x15, 0x0,  0x8,  0x54, 0xed,
      0x6f, 0xc3, 0x3b, 0x82, 0x32, 0x2f, 0xb,  0x1a, 0x2a, 0xd9, 0x2,  0x0,  0x0,  0x61, 0xba, 0x1f, 0x0,  0x2,  0xab,
      0x25, 0xb,  0xc,  0x23, 0x5d, 0x7d, 0x13, 0x46, 0xd8, 0x1f, 0x0,  0x1b, 0xc,  0x8d, 0x24, 0x63, 0x52, 0x83, 0x32,
      0x66, 0x36, 0x9d, 0x9d, 0x52, 0xe,  0x60, 0xee, 0x2d, 0xc,  0xf5, 0x6d, 0xdd, 0x32, 0x11, 0x80, 0x43, 0xb6, 0x8f,
      0xfa, 0x16, 0x0,  0xa,  0x7b, 0xc5, 0xe3, 0x31, 0x17, 0x16, 0x1d, 0xbe, 0x6c, 0xf3, 0x3,  0x0,  0xd,  0xf5, 0x3e,
      0x43, 0x3b, 0x82, 0xe9, 0x7b, 0x52, 0xd7, 0x10, 0x44, 0xe2, 0x4b, 0x28, 0x9e, 0x2,  0x0,  0x0,  0x39, 0x92, 0x19,
      0x1c, 0x27, 0x0,  0x0,  0x30, 0xb1, 0x24, 0xea, 0x21, 0x11, 0xaa, 0x1,  0x99, 0x23, 0x15, 0xbf, 0x25, 0xd9, 0x2,
      0xf9, 0x38, 0xd7, 0xb,  0x4a, 0xa3, 0x88, 0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  uint8_t topic_bytes[] = {0xef, 0x70, 0xb7};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x2, 0xf9, 0x38, 0xd7, 0xb, 0x4a, 0xa3, 0x88, 0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  uint8_t bytesprops0[] = {0xeb, 0x53, 0x47, 0x69, 0x9d};
  uint8_t bytesprops1[] = {0xe1, 0x54, 0xd1, 0x6d, 0x35, 0x91, 0xf1, 0xe1, 0xf4, 0x56, 0x48, 0x83, 0xc0};
  uint8_t bytesprops2[] = {0x93, 0xd5, 0x89, 0x25, 0xfd, 0x82, 0xf0, 0x41, 0x7e, 0x3d, 0xf5, 0xd0,
                           0x4b, 0x51, 0xfc, 0xe1, 0xaa, 0xb6, 0xed, 0xa2, 0x78, 0x22, 0x2c, 0x5c};
  uint8_t bytesprops3[] = {0x54, 0xed, 0x6f, 0xc3, 0x3b, 0x82, 0x32, 0x2f};
  uint8_t bytesprops4[] = {0xab, 0x25};
  uint8_t bytesprops5[] = {0xc,  0x8d, 0x24, 0x63, 0x52, 0x83, 0x32, 0x66, 0x36, 0x9d, 0x9d, 0x52, 0xe, 0x60,
                           0xee, 0x2d, 0xc,  0xf5, 0x6d, 0xdd, 0x32, 0x11, 0x80, 0x43, 0xb6, 0x8f, 0xfa};
  uint8_t bytesprops6[] = {0x7b, 0xc5, 0xe3, 0x31, 0x17, 0x16, 0x1d, 0xbe, 0x6c, 0xf3};
  uint8_t bytesprops7[] = {0xf5, 0x3e, 0x43, 0x3b, 0x82, 0xe9, 0x7b, 0x52, 0xd7, 0x10, 0x44, 0xe2, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11062}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4266}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25018}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23933}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18136}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14738}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12465}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4522}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5567}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 217}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\239p\183", _pubPktID = 0, _pubBody
// = "\STX\249\&8\215\vJ\163\136\174\235\187\163\ESCJ(\246", _pubProps = [PropResponseInformation
// "\235SGi\157",PropMaximumQoS 13,PropTopicAliasMaximum 11062,PropRetainAvailable 5,PropContentType
// "\225T\209m5\145\241\225\244VH\131\192",PropServerReference
// "\147\213\137%\253\130\240A~=\245\208KQ\252\225\170\182\237\162x\",\\",PropTopicAliasMaximum
// 4266,PropAuthenticationMethod "T\237o\195;\130\&2/",PropSubscriptionIdentifier 26,PropSharedSubscriptionAvailable
// 217,PropMessageExpiryInterval 25018,PropReasonString "\171%",PropSubscriptionIdentifier 12,PropTopicAlias
// 23933,PropServerKeepAlive 18136,PropReasonString
// "\f\141$cR\131\&2f6\157\157R\SO`\238-\f\245m\221\&2\DC1\128C\182\143\250",PropAuthenticationData
// "{\197\227\&1\ETB\SYN\GS\190l\243",PropContentType
// "\245>C;\130\233{R\215\DLED\226K",PropWildcardSubscriptionAvailable 158,PropMessageExpiryInterval
// 14738,PropRequestResponseInformation 28,PropMaximumPacketSize 12465,PropMaximumQoS 234,PropReceiveMaximum
// 4522,PropPayloadFormatIndicator 153,PropTopicAlias 5567,PropRetainAvailable 217]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x31, 0xca, 0x1,  0x0,  0x3,  0xef, 0x70, 0xb7, 0xb3, 0x1,  0x1a, 0x0,  0x5,  0xeb, 0x53, 0x47, 0x69, 0x9d, 0x24,
      0xd,  0x22, 0x2b, 0x36, 0x25, 0x5,  0x3,  0x0,  0xd,  0xe1, 0x54, 0xd1, 0x6d, 0x35, 0x91, 0xf1, 0xe1, 0xf4, 0x56,
      0x48, 0x83, 0xc0, 0x1c, 0x0,  0x18, 0x93, 0xd5, 0x89, 0x25, 0xfd, 0x82, 0xf0, 0x41, 0x7e, 0x3d, 0xf5, 0xd0, 0x4b,
      0x51, 0xfc, 0xe1, 0xaa, 0xb6, 0xed, 0xa2, 0x78, 0x22, 0x2c, 0x5c, 0x22, 0x10, 0xaa, 0x15, 0x0,  0x8,  0x54, 0xed,
      0x6f, 0xc3, 0x3b, 0x82, 0x32, 0x2f, 0xb,  0x1a, 0x2a, 0xd9, 0x2,  0x0,  0x0,  0x61, 0xba, 0x1f, 0x0,  0x2,  0xab,
      0x25, 0xb,  0xc,  0x23, 0x5d, 0x7d, 0x13, 0x46, 0xd8, 0x1f, 0x0,  0x1b, 0xc,  0x8d, 0x24, 0x63, 0x52, 0x83, 0x32,
      0x66, 0x36, 0x9d, 0x9d, 0x52, 0xe,  0x60, 0xee, 0x2d, 0xc,  0xf5, 0x6d, 0xdd, 0x32, 0x11, 0x80, 0x43, 0xb6, 0x8f,
      0xfa, 0x16, 0x0,  0xa,  0x7b, 0xc5, 0xe3, 0x31, 0x17, 0x16, 0x1d, 0xbe, 0x6c, 0xf3, 0x3,  0x0,  0xd,  0xf5, 0x3e,
      0x43, 0x3b, 0x82, 0xe9, 0x7b, 0x52, 0xd7, 0x10, 0x44, 0xe2, 0x4b, 0x28, 0x9e, 0x2,  0x0,  0x0,  0x39, 0x92, 0x19,
      0x1c, 0x27, 0x0,  0x0,  0x30, 0xb1, 0x24, 0xea, 0x21, 0x11, 0xaa, 0x1,  0x99, 0x23, 0x15, 0xbf, 0x25, 0xd9, 0x2,
      0xf9, 0x38, 0xd7, 0xb,  0x4a, 0xa3, 0x88, 0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xef, 0x70, 0xb7};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x2,  0xf9, 0x38, 0xd7, 0xb,  0x4a, 0xa3, 0x88,
                              0xae, 0xeb, 0xbb, 0xa3, 0x1b, 0x4a, 0x28, 0xf6};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[\133\227z\244\DC4
// \\\241\207F|\141\128?F\t\249\DC2\DELs\245", _pubPktID = 23725, _pubBody = ";\229\241\239\169\193\152\160\149\FSQ",
// _pubProps = [PropTopicAliasMaximum 30663,PropContentType "\SIl|\n#E\186\&9^",PropTopicAliasMaximum
// 28043,PropResponseTopic "\150 ",PropSharedSubscriptionAvailable 110,PropAuthenticationMethod
// "\241",PropTopicAliasMaximum 11571,PropRetainAvailable 10,PropPayloadFormatIndicator 44,PropMaximumQoS
// 227,PropCorrelationData "M \206)\128]",PropMaximumQoS 68,PropMessageExpiryInterval 13477,PropContentType
// "\230\&8\192\175Y\255\&9\190\218inU\216",PropMaximumPacketSize 25908,PropSubscriptionIdentifierAvailable
// 248,PropSharedSubscriptionAvailable 222]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {0x33, 0x75, 0x0,  0x16, 0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1, 0xcf, 0x46,
                   0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5, 0x5c, 0xad, 0x4f, 0x22,
                   0x77, 0xc7, 0x3,  0x0,  0x9,  0xf,  0x6c, 0x7c, 0xa,  0x23, 0x45, 0xba, 0x39, 0x5e, 0x22,
                   0x6d, 0x8b, 0x8,  0x0,  0x2,  0x96, 0x20, 0x2a, 0x6e, 0x15, 0x0,  0x1,  0xf1, 0x22, 0x2d,
                   0x33, 0x25, 0xa,  0x1,  0x2c, 0x24, 0xe3, 0x9,  0x0,  0x6,  0x4d, 0x20, 0xce, 0x29, 0x80,
                   0x5d, 0x24, 0x44, 0x2,  0x0,  0x0,  0x34, 0xa5, 0x3,  0x0,  0xd,  0xe6, 0x38, 0xc0, 0xaf,
                   0x59, 0xff, 0x39, 0xbe, 0xda, 0x69, 0x6e, 0x55, 0xd8, 0x27, 0x0,  0x0,  0x65, 0x34, 0x29,
                   0xf8, 0x2a, 0xde, 0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  uint8_t topic_bytes[] = {0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1, 0xcf, 0x46,
                           0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5};
  lwmqtt_string_t topic = {22, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0xf, 0x6c, 0x7c, 0xa, 0x23, 0x45, 0xba, 0x39, 0x5e};
  uint8_t bytesprops1[] = {0x96, 0x20};
  uint8_t bytesprops2[] = {0xf1};
  uint8_t bytesprops3[] = {0x4d, 0x20, 0xce, 0x29, 0x80, 0x5d};
  uint8_t bytesprops4[] = {0xe6, 0x38, 0xc0, 0xaf, 0x59, 0xff, 0x39, 0xbe, 0xda, 0x69, 0x6e, 0x55, 0xd8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30663}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28043}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11571}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13477}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25908}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 222}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 23725, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "[\133\227z\244\DC4
// \\\241\207F|\141\128?F\t\249\DC2\DELs\245", _pubPktID = 23725, _pubBody = ";\229\241\239\169\193\152\160\149\FSQ",
// _pubProps = [PropTopicAliasMaximum 30663,PropContentType "\SIl|\n#E\186\&9^",PropTopicAliasMaximum
// 28043,PropResponseTopic "\150 ",PropSharedSubscriptionAvailable 110,PropAuthenticationMethod
// "\241",PropTopicAliasMaximum 11571,PropRetainAvailable 10,PropPayloadFormatIndicator 44,PropMaximumQoS
// 227,PropCorrelationData "M \206)\128]",PropMaximumQoS 68,PropMessageExpiryInterval 13477,PropContentType
// "\230\&8\192\175Y\255\&9\190\218inU\216",PropMaximumPacketSize 25908,PropSubscriptionIdentifierAvailable
// 248,PropSharedSubscriptionAvailable 222]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {0x33, 0x75, 0x0,  0x16, 0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1, 0xcf, 0x46,
                   0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5, 0x5c, 0xad, 0x4f, 0x22,
                   0x77, 0xc7, 0x3,  0x0,  0x9,  0xf,  0x6c, 0x7c, 0xa,  0x23, 0x45, 0xba, 0x39, 0x5e, 0x22,
                   0x6d, 0x8b, 0x8,  0x0,  0x2,  0x96, 0x20, 0x2a, 0x6e, 0x15, 0x0,  0x1,  0xf1, 0x22, 0x2d,
                   0x33, 0x25, 0xa,  0x1,  0x2c, 0x24, 0xe3, 0x9,  0x0,  0x6,  0x4d, 0x20, 0xce, 0x29, 0x80,
                   0x5d, 0x24, 0x44, 0x2,  0x0,  0x0,  0x34, 0xa5, 0x3,  0x0,  0xd,  0xe6, 0x38, 0xc0, 0xaf,
                   0x59, 0xff, 0x39, 0xbe, 0xda, 0x69, 0x6e, 0x55, 0xd8, 0x27, 0x0,  0x0,  0x65, 0x34, 0x29,
                   0xf8, 0x2a, 0xde, 0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5b, 0x85, 0xe3, 0x7a, 0xf4, 0x14, 0x20, 0x5c, 0xf1, 0xcf, 0x46,
                               0x7c, 0x8d, 0x80, 0x3f, 0x46, 0x9,  0xf9, 0x12, 0x7f, 0x73, 0xf5};
  lwmqtt_string_t exp_topic = {22, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3b, 0xe5, 0xf1, 0xef, 0xa9, 0xc1, 0x98, 0xa0, 0x95, 0x1c, 0x51};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 23725);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 22);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "D\SO\EOTH\207S\243\176T\n\246\234'~^\ETBtz\220X", _pubPktID = 0, _pubBody =
// "\179>\ENQUu\215k\216\ETX\201m\DC2\251\&2\ETB\187m\200\248\140{\n8", _pubProps = [PropServerReference
// "\DLEE>i\167+\232\177\165\211\CAN\162F4\143*\251\GS\206",PropReceiveMaximum 15189,PropAuthenticationData
// "{Q\174\191\n\216\188",PropSharedSubscriptionAvailable 244,PropResponseInformation
// "#\175^\233\133\154I\187",PropMessageExpiryInterval 854,PropResponseTopic "\248\245\237n",PropResponseTopic
// "\137a\227ZD\136",PropResponseTopic ")\GS",PropRetainAvailable 56,PropWildcardSubscriptionAvailable
// 220,PropSubscriptionIdentifierAvailable 177,PropMaximumQoS 216,PropReceiveMaximum
// 21295,PropSharedSubscriptionAvailable 193,PropWillDelayInterval 30278,PropSessionExpiryInterval 21047,PropMaximumQoS
// 120,PropWillDelayInterval 18244,PropRequestResponseInformation 191,PropMessageExpiryInterval 24947,PropUserProperty
// "\149\165\NUL\253\137\219\t"
// "\146\DC2\216u\164\ESC\153dVP\b\174v\162~\222\140\204\b\STX\143)\245\243H\241\199\154\216\199",PropAuthenticationData
// "c\203\158",PropSubscriptionIdentifierAvailable 114,PropSubscriptionIdentifierAvailable 194,PropAuthenticationMethod
// "\SI",PropCorrelationData "E(\233\128|\205\178\136\SOH\DC3\216\&9\240W<M\156"]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {0x31, 0xea, 0x1,  0x0,  0x14, 0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,  0xf6, 0xea,
                   0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58, 0xbb, 0x1,  0x1c, 0x0,  0x13, 0x10, 0x45, 0x3e, 0x69,
                   0xa7, 0x2b, 0xe8, 0xb1, 0xa5, 0xd3, 0x18, 0xa2, 0x46, 0x34, 0x8f, 0x2a, 0xfb, 0x1d, 0xce, 0x21, 0x3b,
                   0x55, 0x16, 0x0,  0x7,  0x7b, 0x51, 0xae, 0xbf, 0xa,  0xd8, 0xbc, 0x2a, 0xf4, 0x1a, 0x0,  0x8,  0x23,
                   0xaf, 0x5e, 0xe9, 0x85, 0x9a, 0x49, 0xbb, 0x2,  0x0,  0x0,  0x3,  0x56, 0x8,  0x0,  0x4,  0xf8, 0xf5,
                   0xed, 0x6e, 0x8,  0x0,  0x6,  0x89, 0x61, 0xe3, 0x5a, 0x44, 0x88, 0x8,  0x0,  0x2,  0x29, 0x1d, 0x25,
                   0x38, 0x28, 0xdc, 0x29, 0xb1, 0x24, 0xd8, 0x21, 0x53, 0x2f, 0x2a, 0xc1, 0x18, 0x0,  0x0,  0x76, 0x46,
                   0x11, 0x0,  0x0,  0x52, 0x37, 0x24, 0x78, 0x18, 0x0,  0x0,  0x47, 0x44, 0x19, 0xbf, 0x2,  0x0,  0x0,
                   0x61, 0x73, 0x26, 0x0,  0x7,  0x95, 0xa5, 0x0,  0xfd, 0x89, 0xdb, 0x9,  0x0,  0x1e, 0x92, 0x12, 0xd8,
                   0x75, 0xa4, 0x1b, 0x99, 0x64, 0x56, 0x50, 0x8,  0xae, 0x76, 0xa2, 0x7e, 0xde, 0x8c, 0xcc, 0x8,  0x2,
                   0x8f, 0x29, 0xf5, 0xf3, 0x48, 0xf1, 0xc7, 0x9a, 0xd8, 0xc7, 0x16, 0x0,  0x3,  0x63, 0xcb, 0x9e, 0x29,
                   0x72, 0x29, 0xc2, 0x15, 0x0,  0x1,  0xf,  0x9,  0x0,  0x11, 0x45, 0x28, 0xe9, 0x80, 0x7c, 0xcd, 0xb2,
                   0x88, 0x1,  0x13, 0xd8, 0x39, 0xf0, 0x57, 0x3c, 0x4d, 0x9c, 0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b,
                   0xd8, 0x3,  0xc9, 0x6d, 0x12, 0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  uint8_t topic_bytes[] = {0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,
                           0xf6, 0xea, 0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b, 0xd8, 0x3,  0xc9, 0x6d, 0x12,
                         0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0x10, 0x45, 0x3e, 0x69, 0xa7, 0x2b, 0xe8, 0xb1, 0xa5, 0xd3,
                           0x18, 0xa2, 0x46, 0x34, 0x8f, 0x2a, 0xfb, 0x1d, 0xce};
  uint8_t bytesprops1[] = {0x7b, 0x51, 0xae, 0xbf, 0xa, 0xd8, 0xbc};
  uint8_t bytesprops2[] = {0x23, 0xaf, 0x5e, 0xe9, 0x85, 0x9a, 0x49, 0xbb};
  uint8_t bytesprops3[] = {0xf8, 0xf5, 0xed, 0x6e};
  uint8_t bytesprops4[] = {0x89, 0x61, 0xe3, 0x5a, 0x44, 0x88};
  uint8_t bytesprops5[] = {0x29, 0x1d};
  uint8_t bytesprops7[] = {0x92, 0x12, 0xd8, 0x75, 0xa4, 0x1b, 0x99, 0x64, 0x56, 0x50, 0x8,  0xae, 0x76, 0xa2, 0x7e,
                           0xde, 0x8c, 0xcc, 0x8,  0x2,  0x8f, 0x29, 0xf5, 0xf3, 0x48, 0xf1, 0xc7, 0x9a, 0xd8, 0xc7};
  uint8_t bytesprops6[] = {0x95, 0xa5, 0x0, 0xfd, 0x89, 0xdb, 0x9};
  uint8_t bytesprops8[] = {0x63, 0xcb, 0x9e};
  uint8_t bytesprops9[] = {0xf};
  uint8_t bytesprops10[] = {0x45, 0x28, 0xe9, 0x80, 0x7c, 0xcd, 0xb2, 0x88, 0x1,
                            0x13, 0xd8, 0x39, 0xf0, 0x57, 0x3c, 0x4d, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15189}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 854}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21295}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30278}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21047}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18244}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24947}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops6}, .v = {30, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "D\SO\EOTH\207S\243\176T\n\246\234'~^\ETBtz\220X", _pubPktID = 0, _pubBody =
// "\179>\ENQUu\215k\216\ETX\201m\DC2\251\&2\ETB\187m\200\248\140{\n8", _pubProps = [PropServerReference
// "\DLEE>i\167+\232\177\165\211\CAN\162F4\143*\251\GS\206",PropReceiveMaximum 15189,PropAuthenticationData
// "{Q\174\191\n\216\188",PropSharedSubscriptionAvailable 244,PropResponseInformation
// "#\175^\233\133\154I\187",PropMessageExpiryInterval 854,PropResponseTopic "\248\245\237n",PropResponseTopic
// "\137a\227ZD\136",PropResponseTopic ")\GS",PropRetainAvailable 56,PropWildcardSubscriptionAvailable
// 220,PropSubscriptionIdentifierAvailable 177,PropMaximumQoS 216,PropReceiveMaximum
// 21295,PropSharedSubscriptionAvailable 193,PropWillDelayInterval 30278,PropSessionExpiryInterval 21047,PropMaximumQoS
// 120,PropWillDelayInterval 18244,PropRequestResponseInformation 191,PropMessageExpiryInterval 24947,PropUserProperty
// "\149\165\NUL\253\137\219\t"
// "\146\DC2\216u\164\ESC\153dVP\b\174v\162~\222\140\204\b\STX\143)\245\243H\241\199\154\216\199",PropAuthenticationData
// "c\203\158",PropSubscriptionIdentifierAvailable 114,PropSubscriptionIdentifierAvailable 194,PropAuthenticationMethod
// "\SI",PropCorrelationData "E(\233\128|\205\178\136\SOH\DC3\216\&9\240W<M\156"]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {0x31, 0xea, 0x1,  0x0,  0x14, 0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,  0xf6, 0xea,
                   0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58, 0xbb, 0x1,  0x1c, 0x0,  0x13, 0x10, 0x45, 0x3e, 0x69,
                   0xa7, 0x2b, 0xe8, 0xb1, 0xa5, 0xd3, 0x18, 0xa2, 0x46, 0x34, 0x8f, 0x2a, 0xfb, 0x1d, 0xce, 0x21, 0x3b,
                   0x55, 0x16, 0x0,  0x7,  0x7b, 0x51, 0xae, 0xbf, 0xa,  0xd8, 0xbc, 0x2a, 0xf4, 0x1a, 0x0,  0x8,  0x23,
                   0xaf, 0x5e, 0xe9, 0x85, 0x9a, 0x49, 0xbb, 0x2,  0x0,  0x0,  0x3,  0x56, 0x8,  0x0,  0x4,  0xf8, 0xf5,
                   0xed, 0x6e, 0x8,  0x0,  0x6,  0x89, 0x61, 0xe3, 0x5a, 0x44, 0x88, 0x8,  0x0,  0x2,  0x29, 0x1d, 0x25,
                   0x38, 0x28, 0xdc, 0x29, 0xb1, 0x24, 0xd8, 0x21, 0x53, 0x2f, 0x2a, 0xc1, 0x18, 0x0,  0x0,  0x76, 0x46,
                   0x11, 0x0,  0x0,  0x52, 0x37, 0x24, 0x78, 0x18, 0x0,  0x0,  0x47, 0x44, 0x19, 0xbf, 0x2,  0x0,  0x0,
                   0x61, 0x73, 0x26, 0x0,  0x7,  0x95, 0xa5, 0x0,  0xfd, 0x89, 0xdb, 0x9,  0x0,  0x1e, 0x92, 0x12, 0xd8,
                   0x75, 0xa4, 0x1b, 0x99, 0x64, 0x56, 0x50, 0x8,  0xae, 0x76, 0xa2, 0x7e, 0xde, 0x8c, 0xcc, 0x8,  0x2,
                   0x8f, 0x29, 0xf5, 0xf3, 0x48, 0xf1, 0xc7, 0x9a, 0xd8, 0xc7, 0x16, 0x0,  0x3,  0x63, 0xcb, 0x9e, 0x29,
                   0x72, 0x29, 0xc2, 0x15, 0x0,  0x1,  0xf,  0x9,  0x0,  0x11, 0x45, 0x28, 0xe9, 0x80, 0x7c, 0xcd, 0xb2,
                   0x88, 0x1,  0x13, 0xd8, 0x39, 0xf0, 0x57, 0x3c, 0x4d, 0x9c, 0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b,
                   0xd8, 0x3,  0xc9, 0x6d, 0x12, 0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x44, 0xe,  0x4,  0x48, 0xcf, 0x53, 0xf3, 0xb0, 0x54, 0xa,
                               0xf6, 0xea, 0x27, 0x7e, 0x5e, 0x17, 0x74, 0x7a, 0xdc, 0x58};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb3, 0x3e, 0x5,  0x55, 0x75, 0xd7, 0x6b, 0xd8, 0x3,  0xc9, 0x6d, 0x12,
                              0xfb, 0x32, 0x17, 0xbb, 0x6d, 0xc8, 0xf8, 0x8c, 0x7b, 0xa,  0x38};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\144*)\STX\195\&3\195\193\213~9\191FW\136R", _pubPktID = 0, _pubBody = "\155U0$\ENQ\134dV\214\ts.+\ETX\143",
// _pubProps = [PropCorrelationData "\208\213\188\228\159~\156\197P\146a",PropResponseInformation "Jk
// ,\178\176\200\140\fi\137p\253k\172E`\139J\221\&4\197p\166AO\180\169\238\198",PropMaximumPacketSize
// 9290,PropUserProperty "o\187\161\DEL;"
// "\200\&1z\DC3\250`\228\&2t?@\DC3\165\131K\USq\GS\170\212S",PropWillDelayInterval 4415,PropResponseTopic
// "\137\173\CAN\ENQ\205B\\\222\SOH~\230a",PropResponseInformation "B\136e&\153\161\f\ESCCP\132\131$\SIj\191"]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x39, 0x9d, 0x1,  0x0,  0x11, 0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3, 0xc1, 0xd5, 0x7e,
                   0x39, 0xbf, 0x46, 0x57, 0x88, 0x52, 0x7a, 0x9,  0x0,  0xb,  0xd0, 0xd5, 0xbc, 0xe4, 0x9f, 0x7e,
                   0x9c, 0xc5, 0x50, 0x92, 0x61, 0x1a, 0x0,  0x1e, 0x4a, 0x6b, 0x20, 0x2c, 0xb2, 0xb0, 0xc8, 0x8c,
                   0xc,  0x69, 0x89, 0x70, 0xfd, 0x6b, 0xac, 0x45, 0x60, 0x8b, 0x4a, 0xdd, 0x34, 0xc5, 0x70, 0xa6,
                   0x41, 0x4f, 0xb4, 0xa9, 0xee, 0xc6, 0x27, 0x0,  0x0,  0x24, 0x4a, 0x26, 0x0,  0x5,  0x6f, 0xbb,
                   0xa1, 0x7f, 0x3b, 0x0,  0x15, 0xc8, 0x31, 0x7a, 0x13, 0xfa, 0x60, 0xe4, 0x32, 0x74, 0x3f, 0x40,
                   0x13, 0xa5, 0x83, 0x4b, 0x1f, 0x71, 0x1d, 0xaa, 0xd4, 0x53, 0x18, 0x0,  0x0,  0x11, 0x3f, 0x8,
                   0x0,  0xc,  0x89, 0xad, 0x18, 0x5,  0xcd, 0x42, 0x5c, 0xde, 0x1,  0x7e, 0xe6, 0x61, 0x1a, 0x0,
                   0x10, 0x42, 0x88, 0x65, 0x26, 0x99, 0xa1, 0xc,  0x1b, 0x43, 0x50, 0x84, 0x83, 0x24, 0xf,  0x6a,
                   0xbf, 0x9b, 0x55, 0x30, 0x24, 0x5,  0x86, 0x64, 0x56, 0xd6, 0x9,  0x73, 0x2e, 0x2b, 0x3,  0x8f};
  uint8_t topic_bytes[] = {0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3, 0xc1,
                           0xd5, 0x7e, 0x39, 0xbf, 0x46, 0x57, 0x88, 0x52};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9b, 0x55, 0x30, 0x24, 0x5, 0x86, 0x64, 0x56, 0xd6, 0x9, 0x73, 0x2e, 0x2b, 0x3, 0x8f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0xd0, 0xd5, 0xbc, 0xe4, 0x9f, 0x7e, 0x9c, 0xc5, 0x50, 0x92, 0x61};
  uint8_t bytesprops1[] = {0x4a, 0x6b, 0x20, 0x2c, 0xb2, 0xb0, 0xc8, 0x8c, 0xc,  0x69, 0x89, 0x70, 0xfd, 0x6b, 0xac,
                           0x45, 0x60, 0x8b, 0x4a, 0xdd, 0x34, 0xc5, 0x70, 0xa6, 0x41, 0x4f, 0xb4, 0xa9, 0xee, 0xc6};
  uint8_t bytesprops3[] = {0xc8, 0x31, 0x7a, 0x13, 0xfa, 0x60, 0xe4, 0x32, 0x74, 0x3f, 0x40,
                           0x13, 0xa5, 0x83, 0x4b, 0x1f, 0x71, 0x1d, 0xaa, 0xd4, 0x53};
  uint8_t bytesprops2[] = {0x6f, 0xbb, 0xa1, 0x7f, 0x3b};
  uint8_t bytesprops4[] = {0x89, 0xad, 0x18, 0x5, 0xcd, 0x42, 0x5c, 0xde, 0x1, 0x7e, 0xe6, 0x61};
  uint8_t bytesprops5[] = {0x42, 0x88, 0x65, 0x26, 0x99, 0xa1, 0xc,  0x1b,
                           0x43, 0x50, 0x84, 0x83, 0x24, 0xf,  0x6a, 0xbf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9290}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops2}, .v = {21, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4415}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\178\144*)\STX\195\&3\195\193\213~9\191FW\136R", _pubPktID = 0, _pubBody = "\155U0$\ENQ\134dV\214\ts.+\ETX\143",
// _pubProps = [PropCorrelationData "\208\213\188\228\159~\156\197P\146a",PropResponseInformation "Jk
// ,\178\176\200\140\fi\137p\253k\172E`\139J\221\&4\197p\166AO\180\169\238\198",PropMaximumPacketSize
// 9290,PropUserProperty "o\187\161\DEL;"
// "\200\&1z\DC3\250`\228\&2t?@\DC3\165\131K\USq\GS\170\212S",PropWillDelayInterval 4415,PropResponseTopic
// "\137\173\CAN\ENQ\205B\\\222\SOH~\230a",PropResponseInformation "B\136e&\153\161\f\ESCCP\132\131$\SIj\191"]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {0x39, 0x9d, 0x1,  0x0,  0x11, 0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3, 0xc1, 0xd5, 0x7e,
                   0x39, 0xbf, 0x46, 0x57, 0x88, 0x52, 0x7a, 0x9,  0x0,  0xb,  0xd0, 0xd5, 0xbc, 0xe4, 0x9f, 0x7e,
                   0x9c, 0xc5, 0x50, 0x92, 0x61, 0x1a, 0x0,  0x1e, 0x4a, 0x6b, 0x20, 0x2c, 0xb2, 0xb0, 0xc8, 0x8c,
                   0xc,  0x69, 0x89, 0x70, 0xfd, 0x6b, 0xac, 0x45, 0x60, 0x8b, 0x4a, 0xdd, 0x34, 0xc5, 0x70, 0xa6,
                   0x41, 0x4f, 0xb4, 0xa9, 0xee, 0xc6, 0x27, 0x0,  0x0,  0x24, 0x4a, 0x26, 0x0,  0x5,  0x6f, 0xbb,
                   0xa1, 0x7f, 0x3b, 0x0,  0x15, 0xc8, 0x31, 0x7a, 0x13, 0xfa, 0x60, 0xe4, 0x32, 0x74, 0x3f, 0x40,
                   0x13, 0xa5, 0x83, 0x4b, 0x1f, 0x71, 0x1d, 0xaa, 0xd4, 0x53, 0x18, 0x0,  0x0,  0x11, 0x3f, 0x8,
                   0x0,  0xc,  0x89, 0xad, 0x18, 0x5,  0xcd, 0x42, 0x5c, 0xde, 0x1,  0x7e, 0xe6, 0x61, 0x1a, 0x0,
                   0x10, 0x42, 0x88, 0x65, 0x26, 0x99, 0xa1, 0xc,  0x1b, 0x43, 0x50, 0x84, 0x83, 0x24, 0xf,  0x6a,
                   0xbf, 0x9b, 0x55, 0x30, 0x24, 0x5,  0x86, 0x64, 0x56, 0xd6, 0x9,  0x73, 0x2e, 0x2b, 0x3,  0x8f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb2, 0x90, 0x2a, 0x29, 0x2,  0xc3, 0x33, 0xc3, 0xc1,
                               0xd5, 0x7e, 0x39, 0xbf, 0x46, 0x57, 0x88, 0x52};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9b, 0x55, 0x30, 0x24, 0x5, 0x86, 0x64, 0x56, 0xd6, 0x9, 0x73, 0x2e, 0x2b, 0x3, 0x8f};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "G\195\186\214\239K
// \\\226\162\\\"\182", _pubPktID = 3720, _pubBody =
// "\SYN\172\191'(v\"S#\253\175\191\180\243%y\205\195\143\140\247\239\228\\", _pubProps = [PropServerReference
// "\DLEH+*\229\139\&6\242\210\b\221}hh6\219Cm\249\130U\230\168d\b\158",PropSubscriptionIdentifierAvailable
// 251,PropAssignedClientIdentifier "\198\DC1\n\161WEz\128",PropMessageExpiryInterval 8698,PropTopicAlias
// 21888,PropRetainAvailable 83,PropSubscriptionIdentifier 3,PropAuthenticationData
// "\203\240wO\tq>\150\163\145c7!Xg\135\\\239/",PropTopicAliasMaximum 20949,PropPayloadFormatIndicator
// 248,PropServerReference "\222\128\154\141\152=\DC3NW'_\222\241\NUL\221",PropSharedSubscriptionAvailable
// 142,PropSessionExpiryInterval 21222,PropAuthenticationMethod "\158B\NAK\210\148v*",PropPayloadFormatIndicator
// 47,PropRetainAvailable 106,PropResponseInformation
// "1Zl\199\205\143\249\234\232\237\214\128\130<\187\228I\EM\186\208\228#\247D\202\226\141",PropResponseTopic
// "a#\152\218C>",PropReceiveMaximum 17584,PropPayloadFormatIndicator 157,PropSubscriptionIdentifier
// 15,PropAuthenticationData "|\220\CAN<z\238\SI\186eJMT[D\156",PropReasonString
// "\235R\215\134'\v\211\155\DC3\223\ENQ\224\FS\136\179\245P,\132",PropCorrelationData
// "L\DC1\RS\v\SUBf3\171\249\&9\247\SYN\n!\198bUZ\212\205\128U\CAN\214|\f\183",PropResponseTopic
// "\229w\175\207\203J\ETXs\bc_\162*\196\209\220j`",PropWildcardSubscriptionAvailable 200,PropSubscriptionIdentifier
// 29,PropPayloadFormatIndicator 20,PropContentType "\245\156\150t\"\170\DEL\176{O\157\210t\134\199"]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {
      0x33, 0xc4, 0x2,  0x0,  0xd,  0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c, 0x22, 0xb6, 0xe,
      0x88, 0x99, 0x2,  0x1c, 0x0,  0x1a, 0x10, 0x48, 0x2b, 0x2a, 0xe5, 0x8b, 0x36, 0xf2, 0xd2, 0x8,  0xdd, 0x7d, 0x68,
      0x68, 0x36, 0xdb, 0x43, 0x6d, 0xf9, 0x82, 0x55, 0xe6, 0xa8, 0x64, 0x8,  0x9e, 0x29, 0xfb, 0x12, 0x0,  0x8,  0xc6,
      0x11, 0xa,  0xa1, 0x57, 0x45, 0x7a, 0x80, 0x2,  0x0,  0x0,  0x21, 0xfa, 0x23, 0x55, 0x80, 0x25, 0x53, 0xb,  0x3,
      0x16, 0x0,  0x13, 0xcb, 0xf0, 0x77, 0x4f, 0x9,  0x71, 0x3e, 0x96, 0xa3, 0x91, 0x63, 0x37, 0x21, 0x58, 0x67, 0x87,
      0x5c, 0xef, 0x2f, 0x22, 0x51, 0xd5, 0x1,  0xf8, 0x1c, 0x0,  0xf,  0xde, 0x80, 0x9a, 0x8d, 0x98, 0x3d, 0x13, 0x4e,
      0x57, 0x27, 0x5f, 0xde, 0xf1, 0x0,  0xdd, 0x2a, 0x8e, 0x11, 0x0,  0x0,  0x52, 0xe6, 0x15, 0x0,  0x7,  0x9e, 0x42,
      0x15, 0xd2, 0x94, 0x76, 0x2a, 0x1,  0x2f, 0x25, 0x6a, 0x1a, 0x0,  0x1b, 0x31, 0x5a, 0x6c, 0xc7, 0xcd, 0x8f, 0xf9,
      0xea, 0xe8, 0xed, 0xd6, 0x80, 0x82, 0x3c, 0xbb, 0xe4, 0x49, 0x19, 0xba, 0xd0, 0xe4, 0x23, 0xf7, 0x44, 0xca, 0xe2,
      0x8d, 0x8,  0x0,  0x6,  0x61, 0x23, 0x98, 0xda, 0x43, 0x3e, 0x21, 0x44, 0xb0, 0x1,  0x9d, 0xb,  0xf,  0x16, 0x0,
      0xf,  0x7c, 0xdc, 0x18, 0x3c, 0x7a, 0xee, 0xf,  0xba, 0x65, 0x4a, 0x4d, 0x54, 0x5b, 0x44, 0x9c, 0x1f, 0x0,  0x13,
      0xeb, 0x52, 0xd7, 0x86, 0x27, 0xb,  0xd3, 0x9b, 0x13, 0xdf, 0x5,  0xe0, 0x1c, 0x88, 0xb3, 0xf5, 0x50, 0x2c, 0x84,
      0x9,  0x0,  0x1b, 0x4c, 0x11, 0x1e, 0xb,  0x1a, 0x66, 0x33, 0xab, 0xf9, 0x39, 0xf7, 0x16, 0xa,  0x21, 0xc6, 0x62,
      0x55, 0x5a, 0xd4, 0xcd, 0x80, 0x55, 0x18, 0xd6, 0x7c, 0xc,  0xb7, 0x8,  0x0,  0x12, 0xe5, 0x77, 0xaf, 0xcf, 0xcb,
      0x4a, 0x3,  0x73, 0x8,  0x63, 0x5f, 0xa2, 0x2a, 0xc4, 0xd1, 0xdc, 0x6a, 0x60, 0x28, 0xc8, 0xb,  0x1d, 0x1,  0x14,
      0x3,  0x0,  0xf,  0xf5, 0x9c, 0x96, 0x74, 0x22, 0xaa, 0x7f, 0xb0, 0x7b, 0x4f, 0x9d, 0xd2, 0x74, 0x86, 0xc7, 0x16,
      0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf, 0xbf, 0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c,
      0xf7, 0xef, 0xe4, 0x5c};
  uint8_t topic_bytes[] = {0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c, 0x22, 0xb6};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x16, 0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf, 0xbf,
                         0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c, 0xf7, 0xef, 0xe4, 0x5c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0x10, 0x48, 0x2b, 0x2a, 0xe5, 0x8b, 0x36, 0xf2, 0xd2, 0x8,  0xdd, 0x7d, 0x68,
                           0x68, 0x36, 0xdb, 0x43, 0x6d, 0xf9, 0x82, 0x55, 0xe6, 0xa8, 0x64, 0x8,  0x9e};
  uint8_t bytesprops1[] = {0xc6, 0x11, 0xa, 0xa1, 0x57, 0x45, 0x7a, 0x80};
  uint8_t bytesprops2[] = {0xcb, 0xf0, 0x77, 0x4f, 0x9,  0x71, 0x3e, 0x96, 0xa3, 0x91,
                           0x63, 0x37, 0x21, 0x58, 0x67, 0x87, 0x5c, 0xef, 0x2f};
  uint8_t bytesprops3[] = {0xde, 0x80, 0x9a, 0x8d, 0x98, 0x3d, 0x13, 0x4e, 0x57, 0x27, 0x5f, 0xde, 0xf1, 0x0, 0xdd};
  uint8_t bytesprops4[] = {0x9e, 0x42, 0x15, 0xd2, 0x94, 0x76, 0x2a};
  uint8_t bytesprops5[] = {0x31, 0x5a, 0x6c, 0xc7, 0xcd, 0x8f, 0xf9, 0xea, 0xe8, 0xed, 0xd6, 0x80, 0x82, 0x3c,
                           0xbb, 0xe4, 0x49, 0x19, 0xba, 0xd0, 0xe4, 0x23, 0xf7, 0x44, 0xca, 0xe2, 0x8d};
  uint8_t bytesprops6[] = {0x61, 0x23, 0x98, 0xda, 0x43, 0x3e};
  uint8_t bytesprops7[] = {0x7c, 0xdc, 0x18, 0x3c, 0x7a, 0xee, 0xf, 0xba, 0x65, 0x4a, 0x4d, 0x54, 0x5b, 0x44, 0x9c};
  uint8_t bytesprops8[] = {0xeb, 0x52, 0xd7, 0x86, 0x27, 0xb,  0xd3, 0x9b, 0x13, 0xdf,
                           0x5,  0xe0, 0x1c, 0x88, 0xb3, 0xf5, 0x50, 0x2c, 0x84};
  uint8_t bytesprops9[] = {0x4c, 0x11, 0x1e, 0xb,  0x1a, 0x66, 0x33, 0xab, 0xf9, 0x39, 0xf7, 0x16, 0xa, 0x21,
                           0xc6, 0x62, 0x55, 0x5a, 0xd4, 0xcd, 0x80, 0x55, 0x18, 0xd6, 0x7c, 0xc,  0xb7};
  uint8_t bytesprops10[] = {0xe5, 0x77, 0xaf, 0xcf, 0xcb, 0x4a, 0x3,  0x73, 0x8,
                            0x63, 0x5f, 0xa2, 0x2a, 0xc4, 0xd1, 0xdc, 0x6a, 0x60};
  uint8_t bytesprops11[] = {0xf5, 0x9c, 0x96, 0x74, 0x22, 0xaa, 0x7f, 0xb0, 0x7b, 0x4f, 0x9d, 0xd2, 0x74, 0x86, 0xc7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8698}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21888}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20949}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21222}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17584}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 3720, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "G\195\186\214\239K
// \\\226\162\\\"\182", _pubPktID = 3720, _pubBody =
// "\SYN\172\191'(v\"S#\253\175\191\180\243%y\205\195\143\140\247\239\228\\", _pubProps = [PropServerReference
// "\DLEH+*\229\139\&6\242\210\b\221}hh6\219Cm\249\130U\230\168d\b\158",PropSubscriptionIdentifierAvailable
// 251,PropAssignedClientIdentifier "\198\DC1\n\161WEz\128",PropMessageExpiryInterval 8698,PropTopicAlias
// 21888,PropRetainAvailable 83,PropSubscriptionIdentifier 3,PropAuthenticationData
// "\203\240wO\tq>\150\163\145c7!Xg\135\\\239/",PropTopicAliasMaximum 20949,PropPayloadFormatIndicator
// 248,PropServerReference "\222\128\154\141\152=\DC3NW'_\222\241\NUL\221",PropSharedSubscriptionAvailable
// 142,PropSessionExpiryInterval 21222,PropAuthenticationMethod "\158B\NAK\210\148v*",PropPayloadFormatIndicator
// 47,PropRetainAvailable 106,PropResponseInformation
// "1Zl\199\205\143\249\234\232\237\214\128\130<\187\228I\EM\186\208\228#\247D\202\226\141",PropResponseTopic
// "a#\152\218C>",PropReceiveMaximum 17584,PropPayloadFormatIndicator 157,PropSubscriptionIdentifier
// 15,PropAuthenticationData "|\220\CAN<z\238\SI\186eJMT[D\156",PropReasonString
// "\235R\215\134'\v\211\155\DC3\223\ENQ\224\FS\136\179\245P,\132",PropCorrelationData
// "L\DC1\RS\v\SUBf3\171\249\&9\247\SYN\n!\198bUZ\212\205\128U\CAN\214|\f\183",PropResponseTopic
// "\229w\175\207\203J\ETXs\bc_\162*\196\209\220j`",PropWildcardSubscriptionAvailable 200,PropSubscriptionIdentifier
// 29,PropPayloadFormatIndicator 20,PropContentType "\245\156\150t\"\170\DEL\176{O\157\210t\134\199"]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {
      0x33, 0xc4, 0x2,  0x0,  0xd,  0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c, 0x22, 0xb6, 0xe,
      0x88, 0x99, 0x2,  0x1c, 0x0,  0x1a, 0x10, 0x48, 0x2b, 0x2a, 0xe5, 0x8b, 0x36, 0xf2, 0xd2, 0x8,  0xdd, 0x7d, 0x68,
      0x68, 0x36, 0xdb, 0x43, 0x6d, 0xf9, 0x82, 0x55, 0xe6, 0xa8, 0x64, 0x8,  0x9e, 0x29, 0xfb, 0x12, 0x0,  0x8,  0xc6,
      0x11, 0xa,  0xa1, 0x57, 0x45, 0x7a, 0x80, 0x2,  0x0,  0x0,  0x21, 0xfa, 0x23, 0x55, 0x80, 0x25, 0x53, 0xb,  0x3,
      0x16, 0x0,  0x13, 0xcb, 0xf0, 0x77, 0x4f, 0x9,  0x71, 0x3e, 0x96, 0xa3, 0x91, 0x63, 0x37, 0x21, 0x58, 0x67, 0x87,
      0x5c, 0xef, 0x2f, 0x22, 0x51, 0xd5, 0x1,  0xf8, 0x1c, 0x0,  0xf,  0xde, 0x80, 0x9a, 0x8d, 0x98, 0x3d, 0x13, 0x4e,
      0x57, 0x27, 0x5f, 0xde, 0xf1, 0x0,  0xdd, 0x2a, 0x8e, 0x11, 0x0,  0x0,  0x52, 0xe6, 0x15, 0x0,  0x7,  0x9e, 0x42,
      0x15, 0xd2, 0x94, 0x76, 0x2a, 0x1,  0x2f, 0x25, 0x6a, 0x1a, 0x0,  0x1b, 0x31, 0x5a, 0x6c, 0xc7, 0xcd, 0x8f, 0xf9,
      0xea, 0xe8, 0xed, 0xd6, 0x80, 0x82, 0x3c, 0xbb, 0xe4, 0x49, 0x19, 0xba, 0xd0, 0xe4, 0x23, 0xf7, 0x44, 0xca, 0xe2,
      0x8d, 0x8,  0x0,  0x6,  0x61, 0x23, 0x98, 0xda, 0x43, 0x3e, 0x21, 0x44, 0xb0, 0x1,  0x9d, 0xb,  0xf,  0x16, 0x0,
      0xf,  0x7c, 0xdc, 0x18, 0x3c, 0x7a, 0xee, 0xf,  0xba, 0x65, 0x4a, 0x4d, 0x54, 0x5b, 0x44, 0x9c, 0x1f, 0x0,  0x13,
      0xeb, 0x52, 0xd7, 0x86, 0x27, 0xb,  0xd3, 0x9b, 0x13, 0xdf, 0x5,  0xe0, 0x1c, 0x88, 0xb3, 0xf5, 0x50, 0x2c, 0x84,
      0x9,  0x0,  0x1b, 0x4c, 0x11, 0x1e, 0xb,  0x1a, 0x66, 0x33, 0xab, 0xf9, 0x39, 0xf7, 0x16, 0xa,  0x21, 0xc6, 0x62,
      0x55, 0x5a, 0xd4, 0xcd, 0x80, 0x55, 0x18, 0xd6, 0x7c, 0xc,  0xb7, 0x8,  0x0,  0x12, 0xe5, 0x77, 0xaf, 0xcf, 0xcb,
      0x4a, 0x3,  0x73, 0x8,  0x63, 0x5f, 0xa2, 0x2a, 0xc4, 0xd1, 0xdc, 0x6a, 0x60, 0x28, 0xc8, 0xb,  0x1d, 0x1,  0x14,
      0x3,  0x0,  0xf,  0xf5, 0x9c, 0x96, 0x74, 0x22, 0xaa, 0x7f, 0xb0, 0x7b, 0x4f, 0x9d, 0xd2, 0x74, 0x86, 0xc7, 0x16,
      0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf, 0xbf, 0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c,
      0xf7, 0xef, 0xe4, 0x5c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x47, 0xc3, 0xba, 0xd6, 0xef, 0x4b, 0x20, 0x5c, 0xe2, 0xa2, 0x5c, 0x22, 0xb6};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x16, 0xac, 0xbf, 0x27, 0x28, 0x76, 0x22, 0x53, 0x23, 0xfd, 0xaf, 0xbf,
                              0xb4, 0xf3, 0x25, 0x79, 0xcd, 0xc3, 0x8f, 0x8c, 0xf7, 0xef, 0xe4, 0x5c};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 3720);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 9592, _pubBody =
// "\ETX\195\133\tbr,\140\146.tE\159\135\176\168{\162X\178Z", _pubProps = [PropRequestResponseInformation
// 55,PropSubscriptionIdentifierAvailable 91,PropRetainAvailable 219,PropResponseTopic
// "\208w#\158(\224\210\EM}m'\b\218N\239I\CAN\232\196\188\148",PropAuthenticationMethod
// "u\215\205\253\146\235\147>\163\254\190\178-\RS\EOT\191UX\RSTi\217\218\187",PropMessageExpiryInterval
// 14822,PropTopicAliasMaximum 7462,PropRequestProblemInformation 58,PropUserProperty
// "\237\217\129\178\170\183s\203\DC2g\162\152\SO\202m\162\219*\179"
// "\238Q?\150\189E[\218\175U\SYN\213\228\179|w\215\&9\EM9\151Y\ENQ_",PropUserProperty "\SI\DC2\166Ml\"$e~\128B"
// "\133\209\242\249\155\SYN\255\134\134\&6'+\194)\131\205\194\175%\US\135\ENQ\ENQ\192\184\219",PropCorrelationData
// "\ENQ\\\216T4\174",PropTopicAliasMaximum 14458,PropMaximumPacketSize 16732,PropMessageExpiryInterval
// 5436,PropSubscriptionIdentifier 4,PropContentType "\t\ESC\DC2\187\213L\236",PropRequestResponseInformation
// 153,PropMessageExpiryInterval 16625,PropTopicAliasMaximum 11137,PropAuthenticationMethod ""]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x34, 0xe7, 0x1,  0x0,  0x0,  0x25, 0x78, 0xcc, 0x1,  0x19, 0x37, 0x29, 0x5b, 0x25, 0xdb, 0x8,  0x0,
                   0x15, 0xd0, 0x77, 0x23, 0x9e, 0x28, 0xe0, 0xd2, 0x19, 0x7d, 0x6d, 0x27, 0x8,  0xda, 0x4e, 0xef, 0x49,
                   0x18, 0xe8, 0xc4, 0xbc, 0x94, 0x15, 0x0,  0x18, 0x75, 0xd7, 0xcd, 0xfd, 0x92, 0xeb, 0x93, 0x3e, 0xa3,
                   0xfe, 0xbe, 0xb2, 0x2d, 0x1e, 0x4,  0xbf, 0x55, 0x58, 0x1e, 0x54, 0x69, 0xd9, 0xda, 0xbb, 0x2,  0x0,
                   0x0,  0x39, 0xe6, 0x22, 0x1d, 0x26, 0x17, 0x3a, 0x26, 0x0,  0x13, 0xed, 0xd9, 0x81, 0xb2, 0xaa, 0xb7,
                   0x73, 0xcb, 0x12, 0x67, 0xa2, 0x98, 0xe,  0xca, 0x6d, 0xa2, 0xdb, 0x2a, 0xb3, 0x0,  0x18, 0xee, 0x51,
                   0x3f, 0x96, 0xbd, 0x45, 0x5b, 0xda, 0xaf, 0x55, 0x16, 0xd5, 0xe4, 0xb3, 0x7c, 0x77, 0xd7, 0x39, 0x19,
                   0x39, 0x97, 0x59, 0x5,  0x5f, 0x26, 0x0,  0xb,  0xf,  0x12, 0xa6, 0x4d, 0x6c, 0x22, 0x24, 0x65, 0x7e,
                   0x80, 0x42, 0x0,  0x1a, 0x85, 0xd1, 0xf2, 0xf9, 0x9b, 0x16, 0xff, 0x86, 0x86, 0x36, 0x27, 0x2b, 0xc2,
                   0x29, 0x83, 0xcd, 0xc2, 0xaf, 0x25, 0x1f, 0x87, 0x5,  0x5,  0xc0, 0xb8, 0xdb, 0x9,  0x0,  0x6,  0x5,
                   0x5c, 0xd8, 0x54, 0x34, 0xae, 0x22, 0x38, 0x7a, 0x27, 0x0,  0x0,  0x41, 0x5c, 0x2,  0x0,  0x0,  0x15,
                   0x3c, 0xb,  0x4,  0x3,  0x0,  0x7,  0x9,  0x1b, 0x12, 0xbb, 0xd5, 0x4c, 0xec, 0x19, 0x99, 0x2,  0x0,
                   0x0,  0x40, 0xf1, 0x22, 0x2b, 0x81, 0x15, 0x0,  0x0,  0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c,
                   0x92, 0x2e, 0x74, 0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c, 0x92, 0x2e, 0x74,
                         0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xd0, 0x77, 0x23, 0x9e, 0x28, 0xe0, 0xd2, 0x19, 0x7d, 0x6d, 0x27,
                           0x8,  0xda, 0x4e, 0xef, 0x49, 0x18, 0xe8, 0xc4, 0xbc, 0x94};
  uint8_t bytesprops1[] = {0x75, 0xd7, 0xcd, 0xfd, 0x92, 0xeb, 0x93, 0x3e, 0xa3, 0xfe, 0xbe, 0xb2,
                           0x2d, 0x1e, 0x4,  0xbf, 0x55, 0x58, 0x1e, 0x54, 0x69, 0xd9, 0xda, 0xbb};
  uint8_t bytesprops3[] = {0xee, 0x51, 0x3f, 0x96, 0xbd, 0x45, 0x5b, 0xda, 0xaf, 0x55, 0x16, 0xd5,
                           0xe4, 0xb3, 0x7c, 0x77, 0xd7, 0x39, 0x19, 0x39, 0x97, 0x59, 0x5,  0x5f};
  uint8_t bytesprops2[] = {0xed, 0xd9, 0x81, 0xb2, 0xaa, 0xb7, 0x73, 0xcb, 0x12, 0x67,
                           0xa2, 0x98, 0xe,  0xca, 0x6d, 0xa2, 0xdb, 0x2a, 0xb3};
  uint8_t bytesprops5[] = {0x85, 0xd1, 0xf2, 0xf9, 0x9b, 0x16, 0xff, 0x86, 0x86, 0x36, 0x27, 0x2b, 0xc2,
                           0x29, 0x83, 0xcd, 0xc2, 0xaf, 0x25, 0x1f, 0x87, 0x5,  0x5,  0xc0, 0xb8, 0xdb};
  uint8_t bytesprops4[] = {0xf, 0x12, 0xa6, 0x4d, 0x6c, 0x22, 0x24, 0x65, 0x7e, 0x80, 0x42};
  uint8_t bytesprops6[] = {0x5, 0x5c, 0xd8, 0x54, 0x34, 0xae};
  uint8_t bytesprops7[] = {0x9, 0x1b, 0x12, 0xbb, 0xd5, 0x4c, 0xec};
  uint8_t bytesprops8[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14822}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7462}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops2}, .v = {24, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops4}, .v = {26, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14458}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16732}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5436}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16625}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11137}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 9592, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "", _pubPktID = 9592, _pubBody =
// "\ETX\195\133\tbr,\140\146.tE\159\135\176\168{\162X\178Z", _pubProps = [PropRequestResponseInformation
// 55,PropSubscriptionIdentifierAvailable 91,PropRetainAvailable 219,PropResponseTopic
// "\208w#\158(\224\210\EM}m'\b\218N\239I\CAN\232\196\188\148",PropAuthenticationMethod
// "u\215\205\253\146\235\147>\163\254\190\178-\RS\EOT\191UX\RSTi\217\218\187",PropMessageExpiryInterval
// 14822,PropTopicAliasMaximum 7462,PropRequestProblemInformation 58,PropUserProperty
// "\237\217\129\178\170\183s\203\DC2g\162\152\SO\202m\162\219*\179"
// "\238Q?\150\189E[\218\175U\SYN\213\228\179|w\215\&9\EM9\151Y\ENQ_",PropUserProperty "\SI\DC2\166Ml\"$e~\128B"
// "\133\209\242\249\155\SYN\255\134\134\&6'+\194)\131\205\194\175%\US\135\ENQ\ENQ\192\184\219",PropCorrelationData
// "\ENQ\\\216T4\174",PropTopicAliasMaximum 14458,PropMaximumPacketSize 16732,PropMessageExpiryInterval
// 5436,PropSubscriptionIdentifier 4,PropContentType "\t\ESC\DC2\187\213L\236",PropRequestResponseInformation
// 153,PropMessageExpiryInterval 16625,PropTopicAliasMaximum 11137,PropAuthenticationMethod ""]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {0x34, 0xe7, 0x1,  0x0,  0x0,  0x25, 0x78, 0xcc, 0x1,  0x19, 0x37, 0x29, 0x5b, 0x25, 0xdb, 0x8,  0x0,
                   0x15, 0xd0, 0x77, 0x23, 0x9e, 0x28, 0xe0, 0xd2, 0x19, 0x7d, 0x6d, 0x27, 0x8,  0xda, 0x4e, 0xef, 0x49,
                   0x18, 0xe8, 0xc4, 0xbc, 0x94, 0x15, 0x0,  0x18, 0x75, 0xd7, 0xcd, 0xfd, 0x92, 0xeb, 0x93, 0x3e, 0xa3,
                   0xfe, 0xbe, 0xb2, 0x2d, 0x1e, 0x4,  0xbf, 0x55, 0x58, 0x1e, 0x54, 0x69, 0xd9, 0xda, 0xbb, 0x2,  0x0,
                   0x0,  0x39, 0xe6, 0x22, 0x1d, 0x26, 0x17, 0x3a, 0x26, 0x0,  0x13, 0xed, 0xd9, 0x81, 0xb2, 0xaa, 0xb7,
                   0x73, 0xcb, 0x12, 0x67, 0xa2, 0x98, 0xe,  0xca, 0x6d, 0xa2, 0xdb, 0x2a, 0xb3, 0x0,  0x18, 0xee, 0x51,
                   0x3f, 0x96, 0xbd, 0x45, 0x5b, 0xda, 0xaf, 0x55, 0x16, 0xd5, 0xe4, 0xb3, 0x7c, 0x77, 0xd7, 0x39, 0x19,
                   0x39, 0x97, 0x59, 0x5,  0x5f, 0x26, 0x0,  0xb,  0xf,  0x12, 0xa6, 0x4d, 0x6c, 0x22, 0x24, 0x65, 0x7e,
                   0x80, 0x42, 0x0,  0x1a, 0x85, 0xd1, 0xf2, 0xf9, 0x9b, 0x16, 0xff, 0x86, 0x86, 0x36, 0x27, 0x2b, 0xc2,
                   0x29, 0x83, 0xcd, 0xc2, 0xaf, 0x25, 0x1f, 0x87, 0x5,  0x5,  0xc0, 0xb8, 0xdb, 0x9,  0x0,  0x6,  0x5,
                   0x5c, 0xd8, 0x54, 0x34, 0xae, 0x22, 0x38, 0x7a, 0x27, 0x0,  0x0,  0x41, 0x5c, 0x2,  0x0,  0x0,  0x15,
                   0x3c, 0xb,  0x4,  0x3,  0x0,  0x7,  0x9,  0x1b, 0x12, 0xbb, 0xd5, 0x4c, 0xec, 0x19, 0x99, 0x2,  0x0,
                   0x0,  0x40, 0xf1, 0x22, 0x2b, 0x81, 0x15, 0x0,  0x0,  0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c,
                   0x92, 0x2e, 0x74, 0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3,  0xc3, 0x85, 0x9,  0x62, 0x72, 0x2c, 0x8c, 0x92, 0x2e, 0x74,
                              0x45, 0x9f, 0x87, 0xb0, 0xa8, 0x7b, 0xa2, 0x58, 0xb2, 0x5a};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 9592);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "y\216", _pubPktID = 27633, _pubBody
// = "\t\219\155@MR", _pubProps = [PropMessageExpiryInterval 13541,PropSubscriptionIdentifierAvailable
// 64,PropRequestProblemInformation 165,PropSessionExpiryInterval 19172,PropSubscriptionIdentifierAvailable
// 207,PropSharedSubscriptionAvailable 216,PropReasonString
// "\239\&7\209\&4\"\RS\210\252\152\247w\DELq\137}\231\221\&25\250\166\156\209\215C\232\US,",PropSubscriptionIdentifier
// 17,PropCorrelationData
// "\169`\195\182Q\144Rs\133\247\157\229Q1`o\SYN\NUL1\245S\v\SYN\167\155\129\&6\226\SUB\203",PropPayloadFormatIndicator
// 164,PropTopicAlias 25481,PropTopicAliasMaximum 2367,PropCorrelationData
// "\DC4{\160{\203\130\240\201\r\218\212\168O",PropSubscriptionIdentifier 24,PropAssignedClientIdentifier
// "gfW\212\230\243\228\235\182\223\RSxZ\135\227\163\249\217\177[\218|\194Nt\143\224\239G\t",PropReasonString
// "\239\242\158q#\202\v\221\SYN\191\&2N\218\129]=sa",PropRetainAvailable 139,PropTopicAliasMaximum
// 31979,PropSubscriptionIdentifier 19,PropServerReference
// "\157C\209\r\201\233\136W\195\229\f=\ENQJ\230%.\142\138j\208\175p\146",PropSubscriptionIdentifier 16]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {0x33, 0xd6, 0x1,  0x0,  0x2,  0x79, 0xd8, 0x6b, 0xf1, 0xc8, 0x1,  0x2,  0x0,  0x0,  0x34, 0xe5, 0x29,
                   0x40, 0x17, 0xa5, 0x11, 0x0,  0x0,  0x4a, 0xe4, 0x29, 0xcf, 0x2a, 0xd8, 0x1f, 0x0,  0x1c, 0xef, 0x37,
                   0xd1, 0x34, 0x22, 0x1e, 0xd2, 0xfc, 0x98, 0xf7, 0x77, 0x7f, 0x71, 0x89, 0x7d, 0xe7, 0xdd, 0x32, 0x35,
                   0xfa, 0xa6, 0x9c, 0xd1, 0xd7, 0x43, 0xe8, 0x1f, 0x2c, 0xb,  0x11, 0x9,  0x0,  0x1e, 0xa9, 0x60, 0xc3,
                   0xb6, 0x51, 0x90, 0x52, 0x73, 0x85, 0xf7, 0x9d, 0xe5, 0x51, 0x31, 0x60, 0x6f, 0x16, 0x0,  0x31, 0xf5,
                   0x53, 0xb,  0x16, 0xa7, 0x9b, 0x81, 0x36, 0xe2, 0x1a, 0xcb, 0x1,  0xa4, 0x23, 0x63, 0x89, 0x22, 0x9,
                   0x3f, 0x9,  0x0,  0xd,  0x14, 0x7b, 0xa0, 0x7b, 0xcb, 0x82, 0xf0, 0xc9, 0xd,  0xda, 0xd4, 0xa8, 0x4f,
                   0xb,  0x18, 0x12, 0x0,  0x1e, 0x67, 0x66, 0x57, 0xd4, 0xe6, 0xf3, 0xe4, 0xeb, 0xb6, 0xdf, 0x1e, 0x78,
                   0x5a, 0x87, 0xe3, 0xa3, 0xf9, 0xd9, 0xb1, 0x5b, 0xda, 0x7c, 0xc2, 0x4e, 0x74, 0x8f, 0xe0, 0xef, 0x47,
                   0x9,  0x1f, 0x0,  0x12, 0xef, 0xf2, 0x9e, 0x71, 0x23, 0xca, 0xb,  0xdd, 0x16, 0xbf, 0x32, 0x4e, 0xda,
                   0x81, 0x5d, 0x3d, 0x73, 0x61, 0x25, 0x8b, 0x22, 0x7c, 0xeb, 0xb,  0x13, 0x1c, 0x0,  0x18, 0x9d, 0x43,
                   0xd1, 0xd,  0xc9, 0xe9, 0x88, 0x57, 0xc3, 0xe5, 0xc,  0x3d, 0x5,  0x4a, 0xe6, 0x25, 0x2e, 0x8e, 0x8a,
                   0x6a, 0xd0, 0xaf, 0x70, 0x92, 0xb,  0x10, 0x9,  0xdb, 0x9b, 0x40, 0x4d, 0x52};
  uint8_t topic_bytes[] = {0x79, 0xd8};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x9, 0xdb, 0x9b, 0x40, 0x4d, 0x52};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytesprops0[] = {0xef, 0x37, 0xd1, 0x34, 0x22, 0x1e, 0xd2, 0xfc, 0x98, 0xf7, 0x77, 0x7f, 0x71, 0x89,
                           0x7d, 0xe7, 0xdd, 0x32, 0x35, 0xfa, 0xa6, 0x9c, 0xd1, 0xd7, 0x43, 0xe8, 0x1f, 0x2c};
  uint8_t bytesprops1[] = {0xa9, 0x60, 0xc3, 0xb6, 0x51, 0x90, 0x52, 0x73, 0x85, 0xf7, 0x9d, 0xe5, 0x51, 0x31, 0x60,
                           0x6f, 0x16, 0x0,  0x31, 0xf5, 0x53, 0xb,  0x16, 0xa7, 0x9b, 0x81, 0x36, 0xe2, 0x1a, 0xcb};
  uint8_t bytesprops2[] = {0x14, 0x7b, 0xa0, 0x7b, 0xcb, 0x82, 0xf0, 0xc9, 0xd, 0xda, 0xd4, 0xa8, 0x4f};
  uint8_t bytesprops3[] = {0x67, 0x66, 0x57, 0xd4, 0xe6, 0xf3, 0xe4, 0xeb, 0xb6, 0xdf, 0x1e, 0x78, 0x5a, 0x87, 0xe3,
                           0xa3, 0xf9, 0xd9, 0xb1, 0x5b, 0xda, 0x7c, 0xc2, 0x4e, 0x74, 0x8f, 0xe0, 0xef, 0x47, 0x9};
  uint8_t bytesprops4[] = {0xef, 0xf2, 0x9e, 0x71, 0x23, 0xca, 0xb,  0xdd, 0x16,
                           0xbf, 0x32, 0x4e, 0xda, 0x81, 0x5d, 0x3d, 0x73, 0x61};
  uint8_t bytesprops5[] = {0x9d, 0x43, 0xd1, 0xd,  0xc9, 0xe9, 0x88, 0x57, 0xc3, 0xe5, 0xc,  0x3d,
                           0x5,  0x4a, 0xe6, 0x25, 0x2e, 0x8e, 0x8a, 0x6a, 0xd0, 0xaf, 0x70, 0x92};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13541}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19172}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25481}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2367}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31979}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 27633, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "y\216", _pubPktID = 27633, _pubBody
// = "\t\219\155@MR", _pubProps = [PropMessageExpiryInterval 13541,PropSubscriptionIdentifierAvailable
// 64,PropRequestProblemInformation 165,PropSessionExpiryInterval 19172,PropSubscriptionIdentifierAvailable
// 207,PropSharedSubscriptionAvailable 216,PropReasonString
// "\239\&7\209\&4\"\RS\210\252\152\247w\DELq\137}\231\221\&25\250\166\156\209\215C\232\US,",PropSubscriptionIdentifier
// 17,PropCorrelationData
// "\169`\195\182Q\144Rs\133\247\157\229Q1`o\SYN\NUL1\245S\v\SYN\167\155\129\&6\226\SUB\203",PropPayloadFormatIndicator
// 164,PropTopicAlias 25481,PropTopicAliasMaximum 2367,PropCorrelationData
// "\DC4{\160{\203\130\240\201\r\218\212\168O",PropSubscriptionIdentifier 24,PropAssignedClientIdentifier
// "gfW\212\230\243\228\235\182\223\RSxZ\135\227\163\249\217\177[\218|\194Nt\143\224\239G\t",PropReasonString
// "\239\242\158q#\202\v\221\SYN\191\&2N\218\129]=sa",PropRetainAvailable 139,PropTopicAliasMaximum
// 31979,PropSubscriptionIdentifier 19,PropServerReference
// "\157C\209\r\201\233\136W\195\229\f=\ENQJ\230%.\142\138j\208\175p\146",PropSubscriptionIdentifier 16]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {0x33, 0xd6, 0x1,  0x0,  0x2,  0x79, 0xd8, 0x6b, 0xf1, 0xc8, 0x1,  0x2,  0x0,  0x0,  0x34, 0xe5, 0x29,
                   0x40, 0x17, 0xa5, 0x11, 0x0,  0x0,  0x4a, 0xe4, 0x29, 0xcf, 0x2a, 0xd8, 0x1f, 0x0,  0x1c, 0xef, 0x37,
                   0xd1, 0x34, 0x22, 0x1e, 0xd2, 0xfc, 0x98, 0xf7, 0x77, 0x7f, 0x71, 0x89, 0x7d, 0xe7, 0xdd, 0x32, 0x35,
                   0xfa, 0xa6, 0x9c, 0xd1, 0xd7, 0x43, 0xe8, 0x1f, 0x2c, 0xb,  0x11, 0x9,  0x0,  0x1e, 0xa9, 0x60, 0xc3,
                   0xb6, 0x51, 0x90, 0x52, 0x73, 0x85, 0xf7, 0x9d, 0xe5, 0x51, 0x31, 0x60, 0x6f, 0x16, 0x0,  0x31, 0xf5,
                   0x53, 0xb,  0x16, 0xa7, 0x9b, 0x81, 0x36, 0xe2, 0x1a, 0xcb, 0x1,  0xa4, 0x23, 0x63, 0x89, 0x22, 0x9,
                   0x3f, 0x9,  0x0,  0xd,  0x14, 0x7b, 0xa0, 0x7b, 0xcb, 0x82, 0xf0, 0xc9, 0xd,  0xda, 0xd4, 0xa8, 0x4f,
                   0xb,  0x18, 0x12, 0x0,  0x1e, 0x67, 0x66, 0x57, 0xd4, 0xe6, 0xf3, 0xe4, 0xeb, 0xb6, 0xdf, 0x1e, 0x78,
                   0x5a, 0x87, 0xe3, 0xa3, 0xf9, 0xd9, 0xb1, 0x5b, 0xda, 0x7c, 0xc2, 0x4e, 0x74, 0x8f, 0xe0, 0xef, 0x47,
                   0x9,  0x1f, 0x0,  0x12, 0xef, 0xf2, 0x9e, 0x71, 0x23, 0xca, 0xb,  0xdd, 0x16, 0xbf, 0x32, 0x4e, 0xda,
                   0x81, 0x5d, 0x3d, 0x73, 0x61, 0x25, 0x8b, 0x22, 0x7c, 0xeb, 0xb,  0x13, 0x1c, 0x0,  0x18, 0x9d, 0x43,
                   0xd1, 0xd,  0xc9, 0xe9, 0x88, 0x57, 0xc3, 0xe5, 0xc,  0x3d, 0x5,  0x4a, 0xe6, 0x25, 0x2e, 0x8e, 0x8a,
                   0x6a, 0xd0, 0xaf, 0x70, 0x92, 0xb,  0x10, 0x9,  0xdb, 0x9b, 0x40, 0x4d, 0x52};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x79, 0xd8};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x9, 0xdb, 0x9b, 0x40, 0x4d, 0x52};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 27633);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\253d\178]\206\DLE\163;", _pubProps = [PropWillDelayInterval 17530,PropTopicAliasMaximum
// 20683,PropMessageExpiryInterval 5805,PropRetainAvailable 19,PropUserProperty
// "\175\144\192\152\231U\141\191\ETB\149\254\227X\149\a\CAN\168Qa2\DLE"
// "\200c\DLE\204\149b\146\231\&4eO\FS\170\145.\253\247o\134'h\160",PropMessageExpiryInterval 804]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {0x39, 0x4f, 0x0,  0x0,  0x44, 0x18, 0x0,  0x0,  0x44, 0x7a, 0x22, 0x50, 0xcb, 0x2,  0x0,  0x0,  0x16,
                   0xad, 0x25, 0x13, 0x26, 0x0,  0x15, 0xaf, 0x90, 0xc0, 0x98, 0xe7, 0x55, 0x8d, 0xbf, 0x17, 0x95, 0xfe,
                   0xe3, 0x58, 0x95, 0x7,  0x18, 0xa8, 0x51, 0x61, 0x32, 0x10, 0x0,  0x16, 0xc8, 0x63, 0x10, 0xcc, 0x95,
                   0x62, 0x92, 0xe7, 0x34, 0x65, 0x4f, 0x1c, 0xaa, 0x91, 0x2e, 0xfd, 0xf7, 0x6f, 0x86, 0x27, 0x68, 0xa0,
                   0x2,  0x0,  0x0,  0x3,  0x24, 0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  uint8_t topic_bytes[] = {0};
  lwmqtt_string_t topic = {0, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 8;

  uint8_t bytesprops1[] = {0xc8, 0x63, 0x10, 0xcc, 0x95, 0x62, 0x92, 0xe7, 0x34, 0x65, 0x4f,
                           0x1c, 0xaa, 0x91, 0x2e, 0xfd, 0xf7, 0x6f, 0x86, 0x27, 0x68, 0xa0};
  uint8_t bytesprops0[] = {0xaf, 0x90, 0xc0, 0x98, 0xe7, 0x55, 0x8d, 0xbf, 0x17, 0x95, 0xfe,
                           0xe3, 0x58, 0x95, 0x7,  0x18, 0xa8, 0x51, 0x61, 0x32, 0x10};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17530}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20683}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5805}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops0}, .v = {22, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 804}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "", _pubPktID = 0, _pubBody =
// "\253d\178]\206\DLE\163;", _pubProps = [PropWillDelayInterval 17530,PropTopicAliasMaximum
// 20683,PropMessageExpiryInterval 5805,PropRetainAvailable 19,PropUserProperty
// "\175\144\192\152\231U\141\191\ETB\149\254\227X\149\a\CAN\168Qa2\DLE"
// "\200c\DLE\204\149b\146\231\&4eO\FS\170\145.\253\247o\134'h\160",PropMessageExpiryInterval 804]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {0x39, 0x4f, 0x0,  0x0,  0x44, 0x18, 0x0,  0x0,  0x44, 0x7a, 0x22, 0x50, 0xcb, 0x2,  0x0,  0x0,  0x16,
                   0xad, 0x25, 0x13, 0x26, 0x0,  0x15, 0xaf, 0x90, 0xc0, 0x98, 0xe7, 0x55, 0x8d, 0xbf, 0x17, 0x95, 0xfe,
                   0xe3, 0x58, 0x95, 0x7,  0x18, 0xa8, 0x51, 0x61, 0x32, 0x10, 0x0,  0x16, 0xc8, 0x63, 0x10, 0xcc, 0x95,
                   0x62, 0x92, 0xe7, 0x34, 0x65, 0x4f, 0x1c, 0xaa, 0x91, 0x2e, 0xfd, 0xf7, 0x6f, 0x86, 0x27, 0x68, 0xa0,
                   0x2,  0x0,  0x0,  0x3,  0x24, 0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0};
  lwmqtt_string_t exp_topic = {0, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfd, 0x64, 0xb2, 0x5d, 0xce, 0x10, 0xa3, 0x3b};
  lwmqtt_string_t exp_body = {8, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 0);
  EXPECT_EQ(msg.payload_len, 8);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 8);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ";\204\SI\135:\SYN%u\222\217#\130\225N", _pubPktID = 14774, _pubBody = "\250v\SUB", _pubProps =
// [PropMessageExpiryInterval 2660,PropRequestProblemInformation 166,PropSessionExpiryInterval 11525,PropServerKeepAlive
// 5182,PropMessageExpiryInterval 27872,PropMessageExpiryInterval 24795,PropWillDelayInterval
// 12455,PropMessageExpiryInterval 27092,PropCorrelationData "\165s9\164\151\186",PropPayloadFormatIndicator
// 6,PropReasonString "\DLE%q\242@\130`\133lp\155\179\145"]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {0x35, 0x54, 0x0,  0xe,  0x3b, 0xcc, 0xf,  0x87, 0x3a, 0x16, 0x25, 0x75, 0xde, 0xd9, 0x23,
                   0x82, 0xe1, 0x4e, 0x39, 0xb6, 0x3e, 0x2,  0x0,  0x0,  0xa,  0x64, 0x17, 0xa6, 0x11, 0x0,
                   0x0,  0x2d, 0x5,  0x13, 0x14, 0x3e, 0x2,  0x0,  0x0,  0x6c, 0xe0, 0x2,  0x0,  0x0,  0x60,
                   0xdb, 0x18, 0x0,  0x0,  0x30, 0xa7, 0x2,  0x0,  0x0,  0x69, 0xd4, 0x9,  0x0,  0x6,  0xa5,
                   0x73, 0x39, 0xa4, 0x97, 0xba, 0x1,  0x6,  0x1f, 0x0,  0xd,  0x10, 0x25, 0x71, 0xf2, 0x40,
                   0x82, 0x60, 0x85, 0x6c, 0x70, 0x9b, 0xb3, 0x91, 0xfa, 0x76, 0x1a};
  uint8_t topic_bytes[] = {0x3b, 0xcc, 0xf, 0x87, 0x3a, 0x16, 0x25, 0x75, 0xde, 0xd9, 0x23, 0x82, 0xe1, 0x4e};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfa, 0x76, 0x1a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xa5, 0x73, 0x39, 0xa4, 0x97, 0xba};
  uint8_t bytesprops1[] = {0x10, 0x25, 0x71, 0xf2, 0x40, 0x82, 0x60, 0x85, 0x6c, 0x70, 0x9b, 0xb3, 0x91};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2660}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11525}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5182}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27872}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24795}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12455}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27092}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 14774, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// ";\204\SI\135:\SYN%u\222\217#\130\225N", _pubPktID = 14774, _pubBody = "\250v\SUB", _pubProps =
// [PropMessageExpiryInterval 2660,PropRequestProblemInformation 166,PropSessionExpiryInterval 11525,PropServerKeepAlive
// 5182,PropMessageExpiryInterval 27872,PropMessageExpiryInterval 24795,PropWillDelayInterval
// 12455,PropMessageExpiryInterval 27092,PropCorrelationData "\165s9\164\151\186",PropPayloadFormatIndicator
// 6,PropReasonString "\DLE%q\242@\130`\133lp\155\179\145"]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {0x35, 0x54, 0x0,  0xe,  0x3b, 0xcc, 0xf,  0x87, 0x3a, 0x16, 0x25, 0x75, 0xde, 0xd9, 0x23,
                   0x82, 0xe1, 0x4e, 0x39, 0xb6, 0x3e, 0x2,  0x0,  0x0,  0xa,  0x64, 0x17, 0xa6, 0x11, 0x0,
                   0x0,  0x2d, 0x5,  0x13, 0x14, 0x3e, 0x2,  0x0,  0x0,  0x6c, 0xe0, 0x2,  0x0,  0x0,  0x60,
                   0xdb, 0x18, 0x0,  0x0,  0x30, 0xa7, 0x2,  0x0,  0x0,  0x69, 0xd4, 0x9,  0x0,  0x6,  0xa5,
                   0x73, 0x39, 0xa4, 0x97, 0xba, 0x1,  0x6,  0x1f, 0x0,  0xd,  0x10, 0x25, 0x71, 0xf2, 0x40,
                   0x82, 0x60, 0x85, 0x6c, 0x70, 0x9b, 0xb3, 0x91, 0xfa, 0x76, 0x1a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3b, 0xcc, 0xf, 0x87, 0x3a, 0x16, 0x25, 0x75, 0xde, 0xd9, 0x23, 0x82, 0xe1, 0x4e};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfa, 0x76, 0x1a};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14774);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "M\189d\165\NAK\165J\222\187)\216\178d^\194{\141\141y\145", _pubPktID = 0, _pubBody =
// "\245\129\188\154\242\232\161\228\255\&1lz\153\252~D\r\222\166\ENQ", _pubProps = [PropPayloadFormatIndicator
// 241,PropPayloadFormatIndicator 35,PropTopicAliasMaximum 26102,PropTopicAlias 18197,PropTopicAlias
// 25483,PropSessionExpiryInterval 27654,PropAssignedClientIdentifier "\206\145\164\154V\DC3!\f(",PropResponseTopic
// "F\233\225\208\172A\218\165ql\212\244\168\174Z\158:Q\ESC\153\245\176\&6\142",PropCorrelationData
// "\146\169!\238\195D\204\250c8(\128\SYN\251\166\239)\138\178\156i\162\156]",PropSharedSubscriptionAvailable
// 64,PropCorrelationData "x2\137\204(\204\222",PropSharedSubscriptionAvailable 227,PropCorrelationData
// "g\STXSE*\131\240-\190\ACK\155%n_\130\226\255dR\162",PropReasonString
// "\193\185pZ\NUL\156\171\185LE\132\253\US\229\185\DEL\211\201i\DLE8\184\228\RS\196S\247\247",PropAuthenticationData
// "\238\172",PropSharedSubscriptionAvailable 148,PropUserProperty
// "\160\193\191\DC2AA\232\150W\161\252\177\227\a\175\160\SYNL\212\239fO\247'<.\ENQ\224{"
// "\184?u*}_F\134\&8(\r\242|a\186O2"]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x30, 0xfe, 0x1,  0x0,  0x14, 0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29, 0xd8, 0xb2, 0x64, 0x5e,
      0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91, 0xd2, 0x1,  0x1,  0xf1, 0x1,  0x23, 0x22, 0x65, 0xf6, 0x23, 0x47, 0x15, 0x23,
      0x63, 0x8b, 0x11, 0x0,  0x0,  0x6c, 0x6,  0x12, 0x0,  0x9,  0xce, 0x91, 0xa4, 0x9a, 0x56, 0x13, 0x21, 0xc,  0x28,
      0x8,  0x0,  0x18, 0x46, 0xe9, 0xe1, 0xd0, 0xac, 0x41, 0xda, 0xa5, 0x71, 0x6c, 0xd4, 0xf4, 0xa8, 0xae, 0x5a, 0x9e,
      0x3a, 0x51, 0x1b, 0x99, 0xf5, 0xb0, 0x36, 0x8e, 0x9,  0x0,  0x18, 0x92, 0xa9, 0x21, 0xee, 0xc3, 0x44, 0xcc, 0xfa,
      0x63, 0x38, 0x28, 0x80, 0x16, 0xfb, 0xa6, 0xef, 0x29, 0x8a, 0xb2, 0x9c, 0x69, 0xa2, 0x9c, 0x5d, 0x2a, 0x40, 0x9,
      0x0,  0x7,  0x78, 0x32, 0x89, 0xcc, 0x28, 0xcc, 0xde, 0x2a, 0xe3, 0x9,  0x0,  0x14, 0x67, 0x2,  0x53, 0x45, 0x2a,
      0x83, 0xf0, 0x2d, 0xbe, 0x6,  0x9b, 0x25, 0x6e, 0x5f, 0x82, 0xe2, 0xff, 0x64, 0x52, 0xa2, 0x1f, 0x0,  0x1c, 0xc1,
      0xb9, 0x70, 0x5a, 0x0,  0x9c, 0xab, 0xb9, 0x4c, 0x45, 0x84, 0xfd, 0x1f, 0xe5, 0xb9, 0x7f, 0xd3, 0xc9, 0x69, 0x10,
      0x38, 0xb8, 0xe4, 0x1e, 0xc4, 0x53, 0xf7, 0xf7, 0x16, 0x0,  0x2,  0xee, 0xac, 0x2a, 0x94, 0x26, 0x0,  0x1d, 0xa0,
      0xc1, 0xbf, 0x12, 0x41, 0x41, 0xe8, 0x96, 0x57, 0xa1, 0xfc, 0xb1, 0xe3, 0x7,  0xaf, 0xa0, 0x16, 0x4c, 0xd4, 0xef,
      0x66, 0x4f, 0xf7, 0x27, 0x3c, 0x2e, 0x5,  0xe0, 0x7b, 0x0,  0x11, 0xb8, 0x3f, 0x75, 0x2a, 0x7d, 0x5f, 0x46, 0x86,
      0x38, 0x28, 0xd,  0xf2, 0x7c, 0x61, 0xba, 0x4f, 0x32, 0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8, 0xa1, 0xe4, 0xff, 0x31,
      0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  uint8_t topic_bytes[] = {0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29,
                           0xd8, 0xb2, 0x64, 0x5e, 0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91};
  lwmqtt_string_t topic = {20, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8, 0xa1, 0xe4, 0xff, 0x31,
                         0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0xce, 0x91, 0xa4, 0x9a, 0x56, 0x13, 0x21, 0xc, 0x28};
  uint8_t bytesprops1[] = {0x46, 0xe9, 0xe1, 0xd0, 0xac, 0x41, 0xda, 0xa5, 0x71, 0x6c, 0xd4, 0xf4,
                           0xa8, 0xae, 0x5a, 0x9e, 0x3a, 0x51, 0x1b, 0x99, 0xf5, 0xb0, 0x36, 0x8e};
  uint8_t bytesprops2[] = {0x92, 0xa9, 0x21, 0xee, 0xc3, 0x44, 0xcc, 0xfa, 0x63, 0x38, 0x28, 0x80,
                           0x16, 0xfb, 0xa6, 0xef, 0x29, 0x8a, 0xb2, 0x9c, 0x69, 0xa2, 0x9c, 0x5d};
  uint8_t bytesprops3[] = {0x78, 0x32, 0x89, 0xcc, 0x28, 0xcc, 0xde};
  uint8_t bytesprops4[] = {0x67, 0x2,  0x53, 0x45, 0x2a, 0x83, 0xf0, 0x2d, 0xbe, 0x6,
                           0x9b, 0x25, 0x6e, 0x5f, 0x82, 0xe2, 0xff, 0x64, 0x52, 0xa2};
  uint8_t bytesprops5[] = {0xc1, 0xb9, 0x70, 0x5a, 0x0,  0x9c, 0xab, 0xb9, 0x4c, 0x45, 0x84, 0xfd, 0x1f, 0xe5,
                           0xb9, 0x7f, 0xd3, 0xc9, 0x69, 0x10, 0x38, 0xb8, 0xe4, 0x1e, 0xc4, 0x53, 0xf7, 0xf7};
  uint8_t bytesprops6[] = {0xee, 0xac};
  uint8_t bytesprops8[] = {0xb8, 0x3f, 0x75, 0x2a, 0x7d, 0x5f, 0x46, 0x86, 0x38,
                           0x28, 0xd,  0xf2, 0x7c, 0x61, 0xba, 0x4f, 0x32};
  uint8_t bytesprops7[] = {0xa0, 0xc1, 0xbf, 0x12, 0x41, 0x41, 0xe8, 0x96, 0x57, 0xa1, 0xfc, 0xb1, 0xe3, 0x7, 0xaf,
                           0xa0, 0x16, 0x4c, 0xd4, 0xef, 0x66, 0x4f, 0xf7, 0x27, 0x3c, 0x2e, 0x5,  0xe0, 0x7b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26102}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18197}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25483}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27654}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops7}, .v = {17, (char*)&bytesprops8}}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "M\189d\165\NAK\165J\222\187)\216\178d^\194{\141\141y\145", _pubPktID = 0, _pubBody =
// "\245\129\188\154\242\232\161\228\255\&1lz\153\252~D\r\222\166\ENQ", _pubProps = [PropPayloadFormatIndicator
// 241,PropPayloadFormatIndicator 35,PropTopicAliasMaximum 26102,PropTopicAlias 18197,PropTopicAlias
// 25483,PropSessionExpiryInterval 27654,PropAssignedClientIdentifier "\206\145\164\154V\DC3!\f(",PropResponseTopic
// "F\233\225\208\172A\218\165ql\212\244\168\174Z\158:Q\ESC\153\245\176\&6\142",PropCorrelationData
// "\146\169!\238\195D\204\250c8(\128\SYN\251\166\239)\138\178\156i\162\156]",PropSharedSubscriptionAvailable
// 64,PropCorrelationData "x2\137\204(\204\222",PropSharedSubscriptionAvailable 227,PropCorrelationData
// "g\STXSE*\131\240-\190\ACK\155%n_\130\226\255dR\162",PropReasonString
// "\193\185pZ\NUL\156\171\185LE\132\253\US\229\185\DEL\211\201i\DLE8\184\228\RS\196S\247\247",PropAuthenticationData
// "\238\172",PropSharedSubscriptionAvailable 148,PropUserProperty
// "\160\193\191\DC2AA\232\150W\161\252\177\227\a\175\160\SYNL\212\239fO\247'<.\ENQ\224{"
// "\184?u*}_F\134\&8(\r\242|a\186O2"]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {
      0x30, 0xfe, 0x1,  0x0,  0x14, 0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29, 0xd8, 0xb2, 0x64, 0x5e,
      0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91, 0xd2, 0x1,  0x1,  0xf1, 0x1,  0x23, 0x22, 0x65, 0xf6, 0x23, 0x47, 0x15, 0x23,
      0x63, 0x8b, 0x11, 0x0,  0x0,  0x6c, 0x6,  0x12, 0x0,  0x9,  0xce, 0x91, 0xa4, 0x9a, 0x56, 0x13, 0x21, 0xc,  0x28,
      0x8,  0x0,  0x18, 0x46, 0xe9, 0xe1, 0xd0, 0xac, 0x41, 0xda, 0xa5, 0x71, 0x6c, 0xd4, 0xf4, 0xa8, 0xae, 0x5a, 0x9e,
      0x3a, 0x51, 0x1b, 0x99, 0xf5, 0xb0, 0x36, 0x8e, 0x9,  0x0,  0x18, 0x92, 0xa9, 0x21, 0xee, 0xc3, 0x44, 0xcc, 0xfa,
      0x63, 0x38, 0x28, 0x80, 0x16, 0xfb, 0xa6, 0xef, 0x29, 0x8a, 0xb2, 0x9c, 0x69, 0xa2, 0x9c, 0x5d, 0x2a, 0x40, 0x9,
      0x0,  0x7,  0x78, 0x32, 0x89, 0xcc, 0x28, 0xcc, 0xde, 0x2a, 0xe3, 0x9,  0x0,  0x14, 0x67, 0x2,  0x53, 0x45, 0x2a,
      0x83, 0xf0, 0x2d, 0xbe, 0x6,  0x9b, 0x25, 0x6e, 0x5f, 0x82, 0xe2, 0xff, 0x64, 0x52, 0xa2, 0x1f, 0x0,  0x1c, 0xc1,
      0xb9, 0x70, 0x5a, 0x0,  0x9c, 0xab, 0xb9, 0x4c, 0x45, 0x84, 0xfd, 0x1f, 0xe5, 0xb9, 0x7f, 0xd3, 0xc9, 0x69, 0x10,
      0x38, 0xb8, 0xe4, 0x1e, 0xc4, 0x53, 0xf7, 0xf7, 0x16, 0x0,  0x2,  0xee, 0xac, 0x2a, 0x94, 0x26, 0x0,  0x1d, 0xa0,
      0xc1, 0xbf, 0x12, 0x41, 0x41, 0xe8, 0x96, 0x57, 0xa1, 0xfc, 0xb1, 0xe3, 0x7,  0xaf, 0xa0, 0x16, 0x4c, 0xd4, 0xef,
      0x66, 0x4f, 0xf7, 0x27, 0x3c, 0x2e, 0x5,  0xe0, 0x7b, 0x0,  0x11, 0xb8, 0x3f, 0x75, 0x2a, 0x7d, 0x5f, 0x46, 0x86,
      0x38, 0x28, 0xd,  0xf2, 0x7c, 0x61, 0xba, 0x4f, 0x32, 0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8, 0xa1, 0xe4, 0xff, 0x31,
      0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x4d, 0xbd, 0x64, 0xa5, 0x15, 0xa5, 0x4a, 0xde, 0xbb, 0x29,
                               0xd8, 0xb2, 0x64, 0x5e, 0xc2, 0x7b, 0x8d, 0x8d, 0x79, 0x91};
  lwmqtt_string_t exp_topic = {20, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf5, 0x81, 0xbc, 0x9a, 0xf2, 0xe8, 0xa1, 0xe4, 0xff, 0x31,
                              0x6c, 0x7a, 0x99, 0xfc, 0x7e, 0x44, 0xd,  0xde, 0xa6, 0x5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 20);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "3V\138y.\181\&0", _pubPktID = 0,
// _pubBody = "2\248\176\206\GS<\197b\195`\241\aH", _pubProps = [PropRequestProblemInformation 172]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x31, 0x19, 0x0,  0x7,  0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30, 0x2, 0x17, 0xac,
                   0x32, 0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7, 0x48};
  uint8_t topic_bytes[] = {0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x32, 0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7, 0x48};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 172}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "3V\138y.\181\&0", _pubPktID = 0,
// _pubBody = "2\248\176\206\GS<\197b\195`\241\aH", _pubProps = [PropRequestProblemInformation 172]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x31, 0x19, 0x0,  0x7,  0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30, 0x2, 0x17, 0xac,
                   0x32, 0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7, 0x48};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x33, 0x56, 0x8a, 0x79, 0x2e, 0xb5, 0x30};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x32, 0xf8, 0xb0, 0xce, 0x1d, 0x3c, 0xc5, 0x62, 0xc3, 0x60, 0xf1, 0x7, 0x48};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ACK (PubACK 14158 0 [])
TEST(PubACKACK311QCTest, Encode1) {
  uint8_t pkt[] = {0x40, 0x2, 0x37, 0x4e};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 14158, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 14158 0 [])
TEST(PubACKACK311QCTest, Decode1) {
  uint8_t pkt[] = {0x40, 0x2, 0x37, 0x4e};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14158);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 24514 0 [])
TEST(PubACKACK311QCTest, Encode2) {
  uint8_t pkt[] = {0x40, 0x2, 0x5f, 0xc2};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 24514, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 24514 0 [])
TEST(PubACKACK311QCTest, Decode2) {
  uint8_t pkt[] = {0x40, 0x2, 0x5f, 0xc2};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24514);
  EXPECT_EQ(status, 0);
}

// REC (PubREC 28006 0 [])
TEST(PubACKREC311QCTest, Encode3) {
  uint8_t pkt[] = {0x50, 0x2, 0x6d, 0x66};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREC_PACKET, 0, 28006, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REC (PubREC 28006 0 [])
TEST(PubACKREC311QCTest, Decode3) {
  uint8_t pkt[] = {0x50, 0x2, 0x6d, 0x66};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREC_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28006);
  EXPECT_EQ(status, 0);
}

// COMP (PubCOMP 4881 0 [])
TEST(PubACKCOMP311QCTest, Encode4) {
  uint8_t pkt[] = {0x70, 0x2, 0x13, 0x11};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, 0, 4881, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 4881 0 [])
TEST(PubACKCOMP311QCTest, Decode4) {
  uint8_t pkt[] = {0x70, 0x2, 0x13, 0x11};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4881);
  EXPECT_EQ(status, 0);
}

// COMP (PubCOMP 4353 0 [])
TEST(PubACKCOMP311QCTest, Encode5) {
  uint8_t pkt[] = {0x70, 0x2, 0x11, 0x1};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, 0, 4353, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 4353 0 [])
TEST(PubACKCOMP311QCTest, Decode5) {
  uint8_t pkt[] = {0x70, 0x2, 0x11, 0x1};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4353);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 15872 0 [])
TEST(PubACKACK311QCTest, Encode6) {
  uint8_t pkt[] = {0x40, 0x2, 0x3e, 0x0};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 15872, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 15872 0 [])
TEST(PubACKACK311QCTest, Decode6) {
  uint8_t pkt[] = {0x40, 0x2, 0x3e, 0x0};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15872);
  EXPECT_EQ(status, 0);
}

// REL (PubREL 21231 0 [])
TEST(PubACKREL311QCTest, Encode7) {
  uint8_t pkt[] = {0x62, 0x2, 0x52, 0xef};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, 0, 21231, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 21231 0 [])
TEST(PubACKREL311QCTest, Decode7) {
  uint8_t pkt[] = {0x62, 0x2, 0x52, 0xef};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21231);
  EXPECT_EQ(status, 0);
}

// REL (PubREL 10396 0 [])
TEST(PubACKREL311QCTest, Encode8) {
  uint8_t pkt[] = {0x62, 0x2, 0x28, 0x9c};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, 0, 10396, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 10396 0 [])
TEST(PubACKREL311QCTest, Decode8) {
  uint8_t pkt[] = {0x62, 0x2, 0x28, 0x9c};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10396);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 26705 0 [])
TEST(PubACKACK311QCTest, Encode9) {
  uint8_t pkt[] = {0x40, 0x2, 0x68, 0x51};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 26705, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 26705 0 [])
TEST(PubACKACK311QCTest, Decode9) {
  uint8_t pkt[] = {0x40, 0x2, 0x68, 0x51};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26705);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 17554 0 [])
TEST(PubACKACK311QCTest, Encode10) {
  uint8_t pkt[] = {0x40, 0x2, 0x44, 0x92};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 17554, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 17554 0 [])
TEST(PubACKACK311QCTest, Decode10) {
  uint8_t pkt[] = {0x40, 0x2, 0x44, 0x92};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17554);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 24500 0 [])
TEST(PubACKACK311QCTest, Encode11) {
  uint8_t pkt[] = {0x40, 0x2, 0x5f, 0xb4};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 24500, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 24500 0 [])
TEST(PubACKACK311QCTest, Decode11) {
  uint8_t pkt[] = {0x40, 0x2, 0x5f, 0xb4};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24500);
  EXPECT_EQ(status, 0);
}

// COMP (PubCOMP 30295 0 [])
TEST(PubACKCOMP311QCTest, Encode12) {
  uint8_t pkt[] = {0x70, 0x2, 0x76, 0x57};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, 0, 30295, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 30295 0 [])
TEST(PubACKCOMP311QCTest, Decode12) {
  uint8_t pkt[] = {0x70, 0x2, 0x76, 0x57};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30295);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 17870 0 [])
TEST(PubACKACK311QCTest, Encode13) {
  uint8_t pkt[] = {0x40, 0x2, 0x45, 0xce};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 17870, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 17870 0 [])
TEST(PubACKACK311QCTest, Decode13) {
  uint8_t pkt[] = {0x40, 0x2, 0x45, 0xce};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17870);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 18661 0 [])
TEST(PubACKACK311QCTest, Encode14) {
  uint8_t pkt[] = {0x40, 0x2, 0x48, 0xe5};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 18661, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 18661 0 [])
TEST(PubACKACK311QCTest, Decode14) {
  uint8_t pkt[] = {0x40, 0x2, 0x48, 0xe5};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18661);
  EXPECT_EQ(status, 0);
}

// REC (PubREC 32292 0 [])
TEST(PubACKREC311QCTest, Encode15) {
  uint8_t pkt[] = {0x50, 0x2, 0x7e, 0x24};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREC_PACKET, 0, 32292, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REC (PubREC 32292 0 [])
TEST(PubACKREC311QCTest, Decode15) {
  uint8_t pkt[] = {0x50, 0x2, 0x7e, 0x24};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREC_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32292);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 11679 0 [])
TEST(PubACKACK311QCTest, Encode16) {
  uint8_t pkt[] = {0x40, 0x2, 0x2d, 0x9f};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 11679, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 11679 0 [])
TEST(PubACKACK311QCTest, Decode16) {
  uint8_t pkt[] = {0x40, 0x2, 0x2d, 0x9f};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11679);
  EXPECT_EQ(status, 0);
}

// COMP (PubCOMP 24709 0 [])
TEST(PubACKCOMP311QCTest, Encode17) {
  uint8_t pkt[] = {0x70, 0x2, 0x60, 0x85};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, 0, 24709, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 24709 0 [])
TEST(PubACKCOMP311QCTest, Decode17) {
  uint8_t pkt[] = {0x70, 0x2, 0x60, 0x85};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24709);
  EXPECT_EQ(status, 0);
}

// REL (PubREL 19085 0 [])
TEST(PubACKREL311QCTest, Encode18) {
  uint8_t pkt[] = {0x62, 0x2, 0x4a, 0x8d};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, 0, 19085, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 19085 0 [])
TEST(PubACKREL311QCTest, Decode18) {
  uint8_t pkt[] = {0x62, 0x2, 0x4a, 0x8d};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19085);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 23245 0 [])
TEST(PubACKACK311QCTest, Encode19) {
  uint8_t pkt[] = {0x40, 0x2, 0x5a, 0xcd};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 23245, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 23245 0 [])
TEST(PubACKACK311QCTest, Decode19) {
  uint8_t pkt[] = {0x40, 0x2, 0x5a, 0xcd};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23245);
  EXPECT_EQ(status, 0);
}

// REL (PubREL 27855 0 [])
TEST(PubACKREL311QCTest, Encode20) {
  uint8_t pkt[] = {0x62, 0x2, 0x6c, 0xcf};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, 0, 27855, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 27855 0 [])
TEST(PubACKREL311QCTest, Decode20) {
  uint8_t pkt[] = {0x62, 0x2, 0x6c, 0xcf};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27855);
  EXPECT_EQ(status, 0);
}

// REL (PubREL 3263 0 [])
TEST(PubACKREL311QCTest, Encode21) {
  uint8_t pkt[] = {0x62, 0x2, 0xc, 0xbf};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, 0, 3263, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 3263 0 [])
TEST(PubACKREL311QCTest, Decode21) {
  uint8_t pkt[] = {0x62, 0x2, 0xc, 0xbf};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3263);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 4790 0 [])
TEST(PubACKACK311QCTest, Encode22) {
  uint8_t pkt[] = {0x40, 0x2, 0x12, 0xb6};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 4790, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 4790 0 [])
TEST(PubACKACK311QCTest, Decode22) {
  uint8_t pkt[] = {0x40, 0x2, 0x12, 0xb6};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4790);
  EXPECT_EQ(status, 0);
}

// REL (PubREL 7224 0 [])
TEST(PubACKREL311QCTest, Encode23) {
  uint8_t pkt[] = {0x62, 0x2, 0x1c, 0x38};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, 0, 7224, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 7224 0 [])
TEST(PubACKREL311QCTest, Decode23) {
  uint8_t pkt[] = {0x62, 0x2, 0x1c, 0x38};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7224);
  EXPECT_EQ(status, 0);
}

// REL (PubREL 15593 0 [])
TEST(PubACKREL311QCTest, Encode24) {
  uint8_t pkt[] = {0x62, 0x2, 0x3c, 0xe9};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, 0, 15593, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 15593 0 [])
TEST(PubACKREL311QCTest, Decode24) {
  uint8_t pkt[] = {0x62, 0x2, 0x3c, 0xe9};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15593);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 9801 0 [])
TEST(PubACKACK311QCTest, Encode25) {
  uint8_t pkt[] = {0x40, 0x2, 0x26, 0x49};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 9801, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 9801 0 [])
TEST(PubACKACK311QCTest, Decode25) {
  uint8_t pkt[] = {0x40, 0x2, 0x26, 0x49};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9801);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 19499 0 [])
TEST(PubACKACK311QCTest, Encode26) {
  uint8_t pkt[] = {0x40, 0x2, 0x4c, 0x2b};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, 0, 19499, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 19499 0 [])
TEST(PubACKACK311QCTest, Decode26) {
  uint8_t pkt[] = {0x40, 0x2, 0x4c, 0x2b};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19499);
  EXPECT_EQ(status, 0);
}

// COMP (PubCOMP 13110 0 [])
TEST(PubACKCOMP311QCTest, Encode27) {
  uint8_t pkt[] = {0x70, 0x2, 0x33, 0x36};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, 0, 13110, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 13110 0 [])
TEST(PubACKCOMP311QCTest, Decode27) {
  uint8_t pkt[] = {0x70, 0x2, 0x33, 0x36};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13110);
  EXPECT_EQ(status, 0);
}

// REC (PubREC 25388 0 [])
TEST(PubACKREC311QCTest, Encode28) {
  uint8_t pkt[] = {0x50, 0x2, 0x63, 0x2c};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBREC_PACKET, 0, 25388, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REC (PubREC 25388 0 [])
TEST(PubACKREC311QCTest, Decode28) {
  uint8_t pkt[] = {0x50, 0x2, 0x63, 0x2c};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBREC_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25388);
  EXPECT_EQ(status, 0);
}

// COMP (PubCOMP 5812 0 [])
TEST(PubACKCOMP311QCTest, Encode29) {
  uint8_t pkt[] = {0x70, 0x2, 0x16, 0xb4};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, 0, 5812, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 5812 0 [])
TEST(PubACKCOMP311QCTest, Decode29) {
  uint8_t pkt[] = {0x70, 0x2, 0x16, 0xb4};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5812);
  EXPECT_EQ(status, 0);
}

// COMP (PubCOMP 30696 0 [])
TEST(PubACKCOMP311QCTest, Encode30) {
  uint8_t pkt[] = {0x70, 0x2, 0x77, 0xe8};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, 0, 30696, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 30696 0 [])
TEST(PubACKCOMP311QCTest, Decode30) {
  uint8_t pkt[] = {0x70, 0x2, 0x77, 0xe8};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT311, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30696);
  EXPECT_EQ(status, 0);
}

// ACK (PubACK 14158 242 [PropPayloadFormatIndicator 151,PropAssignedClientIdentifier
// "$\221x7Y6M\132qc\213\177_\129vMq\157j\DEL@\229\186\210\252~\DC1C\ESC\195",PropWildcardSubscriptionAvailable
// 68,PropWildcardSubscriptionAvailable 216,PropAuthenticationMethod
// "\219\159g\228G\204\177X^\STXPU\246Dr\176/\151\n;\176\188\135\145",PropUserProperty
// "\DLE\250\235\241G\199\229?\250\240\218\&8\171\130M\251\244K"
// "-\242\233j\203[\200z\163\136\206\&6^\135\170\169\151\&5\240\217h\174",PropMessageExpiryInterval
// 31665,PropReasonString "\129\215\202\&2\236\142x\136\\\232e\245B\ETB\n",PropReceiveMaximum 23944,PropReasonString
// "\170|\244\a\139\143u}\243\140%\SI`tu\180\CANCF\161\173\129\161 \v\173X\206as",PropContentType "<50\231!M)"])
TEST(PubACKACK5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x40, 0xb9, 0x1,  0x37, 0x4e, 0xf2, 0xb4, 0x1,  0x1,  0x97, 0x12, 0x0,  0x1e, 0x24, 0xdd, 0x78, 0x37, 0x59, 0x36,
      0x4d, 0x84, 0x71, 0x63, 0xd5, 0xb1, 0x5f, 0x81, 0x76, 0x4d, 0x71, 0x9d, 0x6a, 0x7f, 0x40, 0xe5, 0xba, 0xd2, 0xfc,
      0x7e, 0x11, 0x43, 0x1b, 0xc3, 0x28, 0x44, 0x28, 0xd8, 0x15, 0x0,  0x18, 0xdb, 0x9f, 0x67, 0xe4, 0x47, 0xcc, 0xb1,
      0x58, 0x5e, 0x2,  0x50, 0x55, 0xf6, 0x44, 0x72, 0xb0, 0x2f, 0x97, 0xa,  0x3b, 0xb0, 0xbc, 0x87, 0x91, 0x26, 0x0,
      0x12, 0x10, 0xfa, 0xeb, 0xf1, 0x47, 0xc7, 0xe5, 0x3f, 0xfa, 0xf0, 0xda, 0x38, 0xab, 0x82, 0x4d, 0xfb, 0xf4, 0x4b,
      0x0,  0x16, 0x2d, 0xf2, 0xe9, 0x6a, 0xcb, 0x5b, 0xc8, 0x7a, 0xa3, 0x88, 0xce, 0x36, 0x5e, 0x87, 0xaa, 0xa9, 0x97,
      0x35, 0xf0, 0xd9, 0x68, 0xae, 0x2,  0x0,  0x0,  0x7b, 0xb1, 0x1f, 0x0,  0xf,  0x81, 0xd7, 0xca, 0x32, 0xec, 0x8e,
      0x78, 0x88, 0x5c, 0xe8, 0x65, 0xf5, 0x42, 0x17, 0xa,  0x21, 0x5d, 0x88, 0x1f, 0x0,  0x1e, 0xaa, 0x7c, 0xf4, 0x7,
      0x8b, 0x8f, 0x75, 0x7d, 0xf3, 0x8c, 0x25, 0xf,  0x60, 0x74, 0x75, 0xb4, 0x18, 0x43, 0x46, 0xa1, 0xad, 0x81, 0xa1,
      0x20, 0xb,  0xad, 0x58, 0xce, 0x61, 0x73, 0x3,  0x0,  0x7,  0x3c, 0x35, 0x30, 0xe7, 0x21, 0x4d, 0x29};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x24, 0xdd, 0x78, 0x37, 0x59, 0x36, 0x4d, 0x84, 0x71, 0x63, 0xd5, 0xb1, 0x5f, 0x81, 0x76,
                           0x4d, 0x71, 0x9d, 0x6a, 0x7f, 0x40, 0xe5, 0xba, 0xd2, 0xfc, 0x7e, 0x11, 0x43, 0x1b, 0xc3};
  uint8_t bytesprops1[] = {0xdb, 0x9f, 0x67, 0xe4, 0x47, 0xcc, 0xb1, 0x58, 0x5e, 0x2,  0x50, 0x55,
                           0xf6, 0x44, 0x72, 0xb0, 0x2f, 0x97, 0xa,  0x3b, 0xb0, 0xbc, 0x87, 0x91};
  uint8_t bytesprops3[] = {0x2d, 0xf2, 0xe9, 0x6a, 0xcb, 0x5b, 0xc8, 0x7a, 0xa3, 0x88, 0xce,
                           0x36, 0x5e, 0x87, 0xaa, 0xa9, 0x97, 0x35, 0xf0, 0xd9, 0x68, 0xae};
  uint8_t bytesprops2[] = {0x10, 0xfa, 0xeb, 0xf1, 0x47, 0xc7, 0xe5, 0x3f, 0xfa,
                           0xf0, 0xda, 0x38, 0xab, 0x82, 0x4d, 0xfb, 0xf4, 0x4b};
  uint8_t bytesprops4[] = {0x81, 0xd7, 0xca, 0x32, 0xec, 0x8e, 0x78, 0x88, 0x5c, 0xe8, 0x65, 0xf5, 0x42, 0x17, 0xa};
  uint8_t bytesprops5[] = {0xaa, 0x7c, 0xf4, 0x7,  0x8b, 0x8f, 0x75, 0x7d, 0xf3, 0x8c, 0x25, 0xf,  0x60, 0x74, 0x75,
                           0xb4, 0x18, 0x43, 0x46, 0xa1, 0xad, 0x81, 0xa1, 0x20, 0xb,  0xad, 0x58, 0xce, 0x61, 0x73};
  uint8_t bytesprops6[] = {0x3c, 0x35, 0x30, 0xe7, 0x21, 0x4d, 0x29};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops2}, .v = {22, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31665}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23944}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 14158, 242, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 14158 242 [PropPayloadFormatIndicator 151,PropAssignedClientIdentifier
// "$\221x7Y6M\132qc\213\177_\129vMq\157j\DEL@\229\186\210\252~\DC1C\ESC\195",PropWildcardSubscriptionAvailable
// 68,PropWildcardSubscriptionAvailable 216,PropAuthenticationMethod
// "\219\159g\228G\204\177X^\STXPU\246Dr\176/\151\n;\176\188\135\145",PropUserProperty
// "\DLE\250\235\241G\199\229?\250\240\218\&8\171\130M\251\244K"
// "-\242\233j\203[\200z\163\136\206\&6^\135\170\169\151\&5\240\217h\174",PropMessageExpiryInterval
// 31665,PropReasonString "\129\215\202\&2\236\142x\136\\\232e\245B\ETB\n",PropReceiveMaximum 23944,PropReasonString
// "\170|\244\a\139\143u}\243\140%\SI`tu\180\CANCF\161\173\129\161 \v\173X\206as",PropContentType "<50\231!M)"])
TEST(PubACKACK5QCTest, Decode1) {
  uint8_t pkt[] = {
      0x40, 0xb9, 0x1,  0x37, 0x4e, 0xf2, 0xb4, 0x1,  0x1,  0x97, 0x12, 0x0,  0x1e, 0x24, 0xdd, 0x78, 0x37, 0x59, 0x36,
      0x4d, 0x84, 0x71, 0x63, 0xd5, 0xb1, 0x5f, 0x81, 0x76, 0x4d, 0x71, 0x9d, 0x6a, 0x7f, 0x40, 0xe5, 0xba, 0xd2, 0xfc,
      0x7e, 0x11, 0x43, 0x1b, 0xc3, 0x28, 0x44, 0x28, 0xd8, 0x15, 0x0,  0x18, 0xdb, 0x9f, 0x67, 0xe4, 0x47, 0xcc, 0xb1,
      0x58, 0x5e, 0x2,  0x50, 0x55, 0xf6, 0x44, 0x72, 0xb0, 0x2f, 0x97, 0xa,  0x3b, 0xb0, 0xbc, 0x87, 0x91, 0x26, 0x0,
      0x12, 0x10, 0xfa, 0xeb, 0xf1, 0x47, 0xc7, 0xe5, 0x3f, 0xfa, 0xf0, 0xda, 0x38, 0xab, 0x82, 0x4d, 0xfb, 0xf4, 0x4b,
      0x0,  0x16, 0x2d, 0xf2, 0xe9, 0x6a, 0xcb, 0x5b, 0xc8, 0x7a, 0xa3, 0x88, 0xce, 0x36, 0x5e, 0x87, 0xaa, 0xa9, 0x97,
      0x35, 0xf0, 0xd9, 0x68, 0xae, 0x2,  0x0,  0x0,  0x7b, 0xb1, 0x1f, 0x0,  0xf,  0x81, 0xd7, 0xca, 0x32, 0xec, 0x8e,
      0x78, 0x88, 0x5c, 0xe8, 0x65, 0xf5, 0x42, 0x17, 0xa,  0x21, 0x5d, 0x88, 0x1f, 0x0,  0x1e, 0xaa, 0x7c, 0xf4, 0x7,
      0x8b, 0x8f, 0x75, 0x7d, 0xf3, 0x8c, 0x25, 0xf,  0x60, 0x74, 0x75, 0xb4, 0x18, 0x43, 0x46, 0xa1, 0xad, 0x81, 0xa1,
      0x20, 0xb,  0xad, 0x58, 0xce, 0x61, 0x73, 0x3,  0x0,  0x7,  0x3c, 0x35, 0x30, 0xe7, 0x21, 0x4d, 0x29};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14158);
  EXPECT_EQ(status, 242);
}

// ACK (PubACK 24514 112 [PropRetainAvailable 24,PropRetainAvailable 183,PropUserProperty "7\a\a\194~\164\142\SYN\149"
// "\160\a6!\175U>\200\188\228\254s",PropAssignedClientIdentifier
// ":\188\SUB/\NAK\219\183`X\144\&3\167\166\155O\232",PropMaximumQoS 118,PropRetainAvailable 81,PropResponseInformation
// "\253\237\DC3\186\158\STX\197\DELm\FS ",PropSharedSubscriptionAvailable 106,PropSubscriptionIdentifier
// 5,PropReasonString "\232\183H\138\140\DC1%\154\154?\t*X\163",PropTopicAlias 15968,PropAuthenticationMethod
// "\212\168[;t2\b\DELc\216\201\213r\189\226\SOH\227\238\225u\232\&7\158\SOHk\204\171\146",PropRequestProblemInformation
// 163])
TEST(PubACKACK5QCTest, Encode2) {
  uint8_t pkt[] = {0x40, 0x80, 0x1,  0x5f, 0xc2, 0x70, 0x7c, 0x25, 0x18, 0x25, 0xb7, 0x26, 0x0,  0x9,  0x37, 0x7,  0x7,
                   0xc2, 0x7e, 0xa4, 0x8e, 0x16, 0x95, 0x0,  0xc,  0xa0, 0x7,  0x36, 0x21, 0xaf, 0x55, 0x3e, 0xc8, 0xbc,
                   0xe4, 0xfe, 0x73, 0x12, 0x0,  0x10, 0x3a, 0xbc, 0x1a, 0x2f, 0x15, 0xdb, 0xb7, 0x60, 0x58, 0x90, 0x33,
                   0xa7, 0xa6, 0x9b, 0x4f, 0xe8, 0x24, 0x76, 0x25, 0x51, 0x1a, 0x0,  0xb,  0xfd, 0xed, 0x13, 0xba, 0x9e,
                   0x2,  0xc5, 0x7f, 0x6d, 0x1c, 0x20, 0x2a, 0x6a, 0xb,  0x5,  0x1f, 0x0,  0xe,  0xe8, 0xb7, 0x48, 0x8a,
                   0x8c, 0x11, 0x25, 0x9a, 0x9a, 0x3f, 0x9,  0x2a, 0x58, 0xa3, 0x23, 0x3e, 0x60, 0x15, 0x0,  0x1c, 0xd4,
                   0xa8, 0x5b, 0x3b, 0x74, 0x32, 0x8,  0x7f, 0x63, 0xd8, 0xc9, 0xd5, 0x72, 0xbd, 0xe2, 0x1,  0xe3, 0xee,
                   0xe1, 0x75, 0xe8, 0x37, 0x9e, 0x1,  0x6b, 0xcc, 0xab, 0x92, 0x17, 0xa3};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops1[] = {0xa0, 0x7, 0x36, 0x21, 0xaf, 0x55, 0x3e, 0xc8, 0xbc, 0xe4, 0xfe, 0x73};
  uint8_t bytesprops0[] = {0x37, 0x7, 0x7, 0xc2, 0x7e, 0xa4, 0x8e, 0x16, 0x95};
  uint8_t bytesprops2[] = {0x3a, 0xbc, 0x1a, 0x2f, 0x15, 0xdb, 0xb7, 0x60,
                           0x58, 0x90, 0x33, 0xa7, 0xa6, 0x9b, 0x4f, 0xe8};
  uint8_t bytesprops3[] = {0xfd, 0xed, 0x13, 0xba, 0x9e, 0x2, 0xc5, 0x7f, 0x6d, 0x1c, 0x20};
  uint8_t bytesprops4[] = {0xe8, 0xb7, 0x48, 0x8a, 0x8c, 0x11, 0x25, 0x9a, 0x9a, 0x3f, 0x9, 0x2a, 0x58, 0xa3};
  uint8_t bytesprops5[] = {0xd4, 0xa8, 0x5b, 0x3b, 0x74, 0x32, 0x8,  0x7f, 0x63, 0xd8, 0xc9, 0xd5, 0x72, 0xbd,
                           0xe2, 0x1,  0xe3, 0xee, 0xe1, 0x75, 0xe8, 0x37, 0x9e, 0x1,  0x6b, 0xcc, 0xab, 0x92};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops0}, .v = {12, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15968}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 163}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 24514, 112, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 24514 112 [PropRetainAvailable 24,PropRetainAvailable 183,PropUserProperty "7\a\a\194~\164\142\SYN\149"
// "\160\a6!\175U>\200\188\228\254s",PropAssignedClientIdentifier
// ":\188\SUB/\NAK\219\183`X\144\&3\167\166\155O\232",PropMaximumQoS 118,PropRetainAvailable 81,PropResponseInformation
// "\253\237\DC3\186\158\STX\197\DELm\FS ",PropSharedSubscriptionAvailable 106,PropSubscriptionIdentifier
// 5,PropReasonString "\232\183H\138\140\DC1%\154\154?\t*X\163",PropTopicAlias 15968,PropAuthenticationMethod
// "\212\168[;t2\b\DELc\216\201\213r\189\226\SOH\227\238\225u\232\&7\158\SOHk\204\171\146",PropRequestProblemInformation
// 163])
TEST(PubACKACK5QCTest, Decode2) {
  uint8_t pkt[] = {0x40, 0x80, 0x1,  0x5f, 0xc2, 0x70, 0x7c, 0x25, 0x18, 0x25, 0xb7, 0x26, 0x0,  0x9,  0x37, 0x7,  0x7,
                   0xc2, 0x7e, 0xa4, 0x8e, 0x16, 0x95, 0x0,  0xc,  0xa0, 0x7,  0x36, 0x21, 0xaf, 0x55, 0x3e, 0xc8, 0xbc,
                   0xe4, 0xfe, 0x73, 0x12, 0x0,  0x10, 0x3a, 0xbc, 0x1a, 0x2f, 0x15, 0xdb, 0xb7, 0x60, 0x58, 0x90, 0x33,
                   0xa7, 0xa6, 0x9b, 0x4f, 0xe8, 0x24, 0x76, 0x25, 0x51, 0x1a, 0x0,  0xb,  0xfd, 0xed, 0x13, 0xba, 0x9e,
                   0x2,  0xc5, 0x7f, 0x6d, 0x1c, 0x20, 0x2a, 0x6a, 0xb,  0x5,  0x1f, 0x0,  0xe,  0xe8, 0xb7, 0x48, 0x8a,
                   0x8c, 0x11, 0x25, 0x9a, 0x9a, 0x3f, 0x9,  0x2a, 0x58, 0xa3, 0x23, 0x3e, 0x60, 0x15, 0x0,  0x1c, 0xd4,
                   0xa8, 0x5b, 0x3b, 0x74, 0x32, 0x8,  0x7f, 0x63, 0xd8, 0xc9, 0xd5, 0x72, 0xbd, 0xe2, 0x1,  0xe3, 0xee,
                   0xe1, 0x75, 0xe8, 0x37, 0x9e, 0x1,  0x6b, 0xcc, 0xab, 0x92, 0x17, 0xa3};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24514);
  EXPECT_EQ(status, 112);
}

// REC (PubREC 28006 97 [PropContentType "G\182\185\187}\152\140",PropServerReference
// "5\240\171\174\178kR\175\144\171\CAN]\138K\ACK\NULX\237\203\183r1\182f\156",PropReasonString
// "\244QV\168\&3\168\&7\158\SOH\RS\205\nk",PropServerKeepAlive 524,PropResponseTopic
// "2\246\135C3\200\202x2|E;\156\DLE\207\184\222\212\255\STX\205\196 0G",PropUserProperty
// "\a\251\249\215G\242\&9\NAKW\GS\217\r4JX\184\164\186:@\f\b\181\205"
// "\188nW\NAK;\192\161\229\189\175\EMG\222\&1\ACK\ETB\160",PropSharedSubscriptionAvailable 48,PropServerReference
// "#~\RS\246\ETB1t\206\246F\SUB\161\193\145\224N\154 D\213#",PropRequestResponseInformation 234,PropAuthenticationData
// "\148\194W\253)\169=@\t",PropReasonString
// "\a\173Z\203h\204\168\209)\DEL\SOH\ETX\159`\181-\208\175N_\173",PropTopicAliasMaximum 30918,PropRetainAvailable
// 251,PropResponseTopic
// "\ACKB\US\176[\180\128\210\178\182\236\ACK\236\161\ETX;\209\142-*\241\248\146",PropSessionExpiryInterval
// 12702,PropRequestProblemInformation 195,PropAuthenticationMethod
// "\221D\238F\235]\ETB\145]\137V\226N\179\220",PropRequestResponseInformation 33,PropReasonString
// "\139\177\248\195\&7K\165*Ep\132L\210\&7nN@\r\209",PropAuthenticationMethod
// "\180\255\&7\188\CANdr?m\142\218i\SI\173\222v",PropRequestResponseInformation 216,PropMaximumPacketSize
// 898,PropWillDelayInterval 13715,PropRequestProblemInformation 163,PropWillDelayInterval
// 7662,PropSharedSubscriptionAvailable 214])
TEST(PubACKREC5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x50, 0xc0, 0x2,  0x6d, 0x66, 0x61, 0xbb, 0x2,  0x3,  0x0,  0x7,  0x47, 0xb6, 0xb9, 0xbb, 0x7d, 0x98, 0x8c, 0x1c,
      0x0,  0x19, 0x35, 0xf0, 0xab, 0xae, 0xb2, 0x6b, 0x52, 0xaf, 0x90, 0xab, 0x18, 0x5d, 0x8a, 0x4b, 0x6,  0x0,  0x58,
      0xed, 0xcb, 0xb7, 0x72, 0x31, 0xb6, 0x66, 0x9c, 0x1f, 0x0,  0xd,  0xf4, 0x51, 0x56, 0xa8, 0x33, 0xa8, 0x37, 0x9e,
      0x1,  0x1e, 0xcd, 0xa,  0x6b, 0x13, 0x2,  0xc,  0x8,  0x0,  0x19, 0x32, 0xf6, 0x87, 0x43, 0x33, 0xc8, 0xca, 0x78,
      0x32, 0x7c, 0x45, 0x3b, 0x9c, 0x10, 0xcf, 0xb8, 0xde, 0xd4, 0xff, 0x2,  0xcd, 0xc4, 0x20, 0x30, 0x47, 0x26, 0x0,
      0x18, 0x7,  0xfb, 0xf9, 0xd7, 0x47, 0xf2, 0x39, 0x15, 0x57, 0x1d, 0xd9, 0xd,  0x34, 0x4a, 0x58, 0xb8, 0xa4, 0xba,
      0x3a, 0x40, 0xc,  0x8,  0xb5, 0xcd, 0x0,  0x11, 0xbc, 0x6e, 0x57, 0x15, 0x3b, 0xc0, 0xa1, 0xe5, 0xbd, 0xaf, 0x19,
      0x47, 0xde, 0x31, 0x6,  0x17, 0xa0, 0x2a, 0x30, 0x1c, 0x0,  0x15, 0x23, 0x7e, 0x1e, 0xf6, 0x17, 0x31, 0x74, 0xce,
      0xf6, 0x46, 0x1a, 0xa1, 0xc1, 0x91, 0xe0, 0x4e, 0x9a, 0x20, 0x44, 0xd5, 0x23, 0x19, 0xea, 0x16, 0x0,  0x9,  0x94,
      0xc2, 0x57, 0xfd, 0x29, 0xa9, 0x3d, 0x40, 0x9,  0x1f, 0x0,  0x15, 0x7,  0xad, 0x5a, 0xcb, 0x68, 0xcc, 0xa8, 0xd1,
      0x29, 0x7f, 0x1,  0x3,  0x9f, 0x60, 0xb5, 0x2d, 0xd0, 0xaf, 0x4e, 0x5f, 0xad, 0x22, 0x78, 0xc6, 0x25, 0xfb, 0x8,
      0x0,  0x17, 0x6,  0x42, 0x1f, 0xb0, 0x5b, 0xb4, 0x80, 0xd2, 0xb2, 0xb6, 0xec, 0x6,  0xec, 0xa1, 0x3,  0x3b, 0xd1,
      0x8e, 0x2d, 0x2a, 0xf1, 0xf8, 0x92, 0x11, 0x0,  0x0,  0x31, 0x9e, 0x17, 0xc3, 0x15, 0x0,  0xf,  0xdd, 0x44, 0xee,
      0x46, 0xeb, 0x5d, 0x17, 0x91, 0x5d, 0x89, 0x56, 0xe2, 0x4e, 0xb3, 0xdc, 0x19, 0x21, 0x1f, 0x0,  0x13, 0x8b, 0xb1,
      0xf8, 0xc3, 0x37, 0x4b, 0xa5, 0x2a, 0x45, 0x70, 0x84, 0x4c, 0xd2, 0x37, 0x6e, 0x4e, 0x40, 0xd,  0xd1, 0x15, 0x0,
      0x10, 0xb4, 0xff, 0x37, 0xbc, 0x18, 0x64, 0x72, 0x3f, 0x6d, 0x8e, 0xda, 0x69, 0xf,  0xad, 0xde, 0x76, 0x19, 0xd8,
      0x27, 0x0,  0x0,  0x3,  0x82, 0x18, 0x0,  0x0,  0x35, 0x93, 0x17, 0xa3, 0x18, 0x0,  0x0,  0x1d, 0xee, 0x2a, 0xd6};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x47, 0xb6, 0xb9, 0xbb, 0x7d, 0x98, 0x8c};
  uint8_t bytesprops1[] = {0x35, 0xf0, 0xab, 0xae, 0xb2, 0x6b, 0x52, 0xaf, 0x90, 0xab, 0x18, 0x5d, 0x8a,
                           0x4b, 0x6,  0x0,  0x58, 0xed, 0xcb, 0xb7, 0x72, 0x31, 0xb6, 0x66, 0x9c};
  uint8_t bytesprops2[] = {0xf4, 0x51, 0x56, 0xa8, 0x33, 0xa8, 0x37, 0x9e, 0x1, 0x1e, 0xcd, 0xa, 0x6b};
  uint8_t bytesprops3[] = {0x32, 0xf6, 0x87, 0x43, 0x33, 0xc8, 0xca, 0x78, 0x32, 0x7c, 0x45, 0x3b, 0x9c,
                           0x10, 0xcf, 0xb8, 0xde, 0xd4, 0xff, 0x2,  0xcd, 0xc4, 0x20, 0x30, 0x47};
  uint8_t bytesprops5[] = {0xbc, 0x6e, 0x57, 0x15, 0x3b, 0xc0, 0xa1, 0xe5, 0xbd,
                           0xaf, 0x19, 0x47, 0xde, 0x31, 0x6,  0x17, 0xa0};
  uint8_t bytesprops4[] = {0x7,  0xfb, 0xf9, 0xd7, 0x47, 0xf2, 0x39, 0x15, 0x57, 0x1d, 0xd9, 0xd,
                           0x34, 0x4a, 0x58, 0xb8, 0xa4, 0xba, 0x3a, 0x40, 0xc,  0x8,  0xb5, 0xcd};
  uint8_t bytesprops6[] = {0x23, 0x7e, 0x1e, 0xf6, 0x17, 0x31, 0x74, 0xce, 0xf6, 0x46, 0x1a,
                           0xa1, 0xc1, 0x91, 0xe0, 0x4e, 0x9a, 0x20, 0x44, 0xd5, 0x23};
  uint8_t bytesprops7[] = {0x94, 0xc2, 0x57, 0xfd, 0x29, 0xa9, 0x3d, 0x40, 0x9};
  uint8_t bytesprops8[] = {0x7, 0xad, 0x5a, 0xcb, 0x68, 0xcc, 0xa8, 0xd1, 0x29, 0x7f, 0x1,
                           0x3, 0x9f, 0x60, 0xb5, 0x2d, 0xd0, 0xaf, 0x4e, 0x5f, 0xad};
  uint8_t bytesprops9[] = {0x6,  0x42, 0x1f, 0xb0, 0x5b, 0xb4, 0x80, 0xd2, 0xb2, 0xb6, 0xec, 0x6,
                           0xec, 0xa1, 0x3,  0x3b, 0xd1, 0x8e, 0x2d, 0x2a, 0xf1, 0xf8, 0x92};
  uint8_t bytesprops10[] = {0xdd, 0x44, 0xee, 0x46, 0xeb, 0x5d, 0x17, 0x91, 0x5d, 0x89, 0x56, 0xe2, 0x4e, 0xb3, 0xdc};
  uint8_t bytesprops11[] = {0x8b, 0xb1, 0xf8, 0xc3, 0x37, 0x4b, 0xa5, 0x2a, 0x45, 0x70,
                            0x84, 0x4c, 0xd2, 0x37, 0x6e, 0x4e, 0x40, 0xd,  0xd1};
  uint8_t bytesprops12[] = {0xb4, 0xff, 0x37, 0xbc, 0x18, 0x64, 0x72, 0x3f,
                            0x6d, 0x8e, 0xda, 0x69, 0xf,  0xad, 0xde, 0x76};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 524}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops4}, .v = {17, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30918}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12702}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 898}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13715}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7662}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 214}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREC_PACKET, 0, 28006, 97, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REC (PubREC 28006 97 [PropContentType "G\182\185\187}\152\140",PropServerReference
// "5\240\171\174\178kR\175\144\171\CAN]\138K\ACK\NULX\237\203\183r1\182f\156",PropReasonString
// "\244QV\168\&3\168\&7\158\SOH\RS\205\nk",PropServerKeepAlive 524,PropResponseTopic
// "2\246\135C3\200\202x2|E;\156\DLE\207\184\222\212\255\STX\205\196 0G",PropUserProperty
// "\a\251\249\215G\242\&9\NAKW\GS\217\r4JX\184\164\186:@\f\b\181\205"
// "\188nW\NAK;\192\161\229\189\175\EMG\222\&1\ACK\ETB\160",PropSharedSubscriptionAvailable 48,PropServerReference
// "#~\RS\246\ETB1t\206\246F\SUB\161\193\145\224N\154 D\213#",PropRequestResponseInformation 234,PropAuthenticationData
// "\148\194W\253)\169=@\t",PropReasonString
// "\a\173Z\203h\204\168\209)\DEL\SOH\ETX\159`\181-\208\175N_\173",PropTopicAliasMaximum 30918,PropRetainAvailable
// 251,PropResponseTopic
// "\ACKB\US\176[\180\128\210\178\182\236\ACK\236\161\ETX;\209\142-*\241\248\146",PropSessionExpiryInterval
// 12702,PropRequestProblemInformation 195,PropAuthenticationMethod
// "\221D\238F\235]\ETB\145]\137V\226N\179\220",PropRequestResponseInformation 33,PropReasonString
// "\139\177\248\195\&7K\165*Ep\132L\210\&7nN@\r\209",PropAuthenticationMethod
// "\180\255\&7\188\CANdr?m\142\218i\SI\173\222v",PropRequestResponseInformation 216,PropMaximumPacketSize
// 898,PropWillDelayInterval 13715,PropRequestProblemInformation 163,PropWillDelayInterval
// 7662,PropSharedSubscriptionAvailable 214])
TEST(PubACKREC5QCTest, Decode3) {
  uint8_t pkt[] = {
      0x50, 0xc0, 0x2,  0x6d, 0x66, 0x61, 0xbb, 0x2,  0x3,  0x0,  0x7,  0x47, 0xb6, 0xb9, 0xbb, 0x7d, 0x98, 0x8c, 0x1c,
      0x0,  0x19, 0x35, 0xf0, 0xab, 0xae, 0xb2, 0x6b, 0x52, 0xaf, 0x90, 0xab, 0x18, 0x5d, 0x8a, 0x4b, 0x6,  0x0,  0x58,
      0xed, 0xcb, 0xb7, 0x72, 0x31, 0xb6, 0x66, 0x9c, 0x1f, 0x0,  0xd,  0xf4, 0x51, 0x56, 0xa8, 0x33, 0xa8, 0x37, 0x9e,
      0x1,  0x1e, 0xcd, 0xa,  0x6b, 0x13, 0x2,  0xc,  0x8,  0x0,  0x19, 0x32, 0xf6, 0x87, 0x43, 0x33, 0xc8, 0xca, 0x78,
      0x32, 0x7c, 0x45, 0x3b, 0x9c, 0x10, 0xcf, 0xb8, 0xde, 0xd4, 0xff, 0x2,  0xcd, 0xc4, 0x20, 0x30, 0x47, 0x26, 0x0,
      0x18, 0x7,  0xfb, 0xf9, 0xd7, 0x47, 0xf2, 0x39, 0x15, 0x57, 0x1d, 0xd9, 0xd,  0x34, 0x4a, 0x58, 0xb8, 0xa4, 0xba,
      0x3a, 0x40, 0xc,  0x8,  0xb5, 0xcd, 0x0,  0x11, 0xbc, 0x6e, 0x57, 0x15, 0x3b, 0xc0, 0xa1, 0xe5, 0xbd, 0xaf, 0x19,
      0x47, 0xde, 0x31, 0x6,  0x17, 0xa0, 0x2a, 0x30, 0x1c, 0x0,  0x15, 0x23, 0x7e, 0x1e, 0xf6, 0x17, 0x31, 0x74, 0xce,
      0xf6, 0x46, 0x1a, 0xa1, 0xc1, 0x91, 0xe0, 0x4e, 0x9a, 0x20, 0x44, 0xd5, 0x23, 0x19, 0xea, 0x16, 0x0,  0x9,  0x94,
      0xc2, 0x57, 0xfd, 0x29, 0xa9, 0x3d, 0x40, 0x9,  0x1f, 0x0,  0x15, 0x7,  0xad, 0x5a, 0xcb, 0x68, 0xcc, 0xa8, 0xd1,
      0x29, 0x7f, 0x1,  0x3,  0x9f, 0x60, 0xb5, 0x2d, 0xd0, 0xaf, 0x4e, 0x5f, 0xad, 0x22, 0x78, 0xc6, 0x25, 0xfb, 0x8,
      0x0,  0x17, 0x6,  0x42, 0x1f, 0xb0, 0x5b, 0xb4, 0x80, 0xd2, 0xb2, 0xb6, 0xec, 0x6,  0xec, 0xa1, 0x3,  0x3b, 0xd1,
      0x8e, 0x2d, 0x2a, 0xf1, 0xf8, 0x92, 0x11, 0x0,  0x0,  0x31, 0x9e, 0x17, 0xc3, 0x15, 0x0,  0xf,  0xdd, 0x44, 0xee,
      0x46, 0xeb, 0x5d, 0x17, 0x91, 0x5d, 0x89, 0x56, 0xe2, 0x4e, 0xb3, 0xdc, 0x19, 0x21, 0x1f, 0x0,  0x13, 0x8b, 0xb1,
      0xf8, 0xc3, 0x37, 0x4b, 0xa5, 0x2a, 0x45, 0x70, 0x84, 0x4c, 0xd2, 0x37, 0x6e, 0x4e, 0x40, 0xd,  0xd1, 0x15, 0x0,
      0x10, 0xb4, 0xff, 0x37, 0xbc, 0x18, 0x64, 0x72, 0x3f, 0x6d, 0x8e, 0xda, 0x69, 0xf,  0xad, 0xde, 0x76, 0x19, 0xd8,
      0x27, 0x0,  0x0,  0x3,  0x82, 0x18, 0x0,  0x0,  0x35, 0x93, 0x17, 0xa3, 0x18, 0x0,  0x0,  0x1d, 0xee, 0x2a, 0xd6};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREC_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28006);
  EXPECT_EQ(status, 97);
}

// COMP (PubCOMP 4881 118 [PropRequestResponseInformation 20,PropReasonString
// "C`\222z3\193?\178\138\b\219\141`(\167R",PropUserProperty "^\222" "\176\147\235\221",PropTopicAliasMaximum
// 2888,PropReasonString "\182KF\205\167\184\165x\205)^\187\203F",PropMaximumQoS 143])
TEST(PubACKCOMP5QCTest, Encode4) {
  uint8_t pkt[] = {0x70, 0x3a, 0x13, 0x11, 0x76, 0x36, 0x19, 0x14, 0x1f, 0x0,  0x10, 0x43, 0x60, 0xde, 0x7a,
                   0x33, 0xc1, 0x3f, 0xb2, 0x8a, 0x8,  0xdb, 0x8d, 0x60, 0x28, 0xa7, 0x52, 0x26, 0x0,  0x2,
                   0x5e, 0xde, 0x0,  0x4,  0xb0, 0x93, 0xeb, 0xdd, 0x22, 0xb,  0x48, 0x1f, 0x0,  0xe,  0xb6,
                   0x4b, 0x46, 0xcd, 0xa7, 0xb8, 0xa5, 0x78, 0xcd, 0x29, 0x5e, 0xbb, 0xcb, 0x46, 0x24, 0x8f};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x43, 0x60, 0xde, 0x7a, 0x33, 0xc1, 0x3f, 0xb2,
                           0x8a, 0x8,  0xdb, 0x8d, 0x60, 0x28, 0xa7, 0x52};
  uint8_t bytesprops2[] = {0xb0, 0x93, 0xeb, 0xdd};
  uint8_t bytesprops1[] = {0x5e, 0xde};
  uint8_t bytesprops3[] = {0xb6, 0x4b, 0x46, 0xcd, 0xa7, 0xb8, 0xa5, 0x78, 0xcd, 0x29, 0x5e, 0xbb, 0xcb, 0x46};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops1}, .v = {4, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2888}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 143}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, 0, 4881, 118, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 4881 118 [PropRequestResponseInformation 20,PropReasonString
// "C`\222z3\193?\178\138\b\219\141`(\167R",PropUserProperty "^\222" "\176\147\235\221",PropTopicAliasMaximum
// 2888,PropReasonString "\182KF\205\167\184\165x\205)^\187\203F",PropMaximumQoS 143])
TEST(PubACKCOMP5QCTest, Decode4) {
  uint8_t pkt[] = {0x70, 0x3a, 0x13, 0x11, 0x76, 0x36, 0x19, 0x14, 0x1f, 0x0,  0x10, 0x43, 0x60, 0xde, 0x7a,
                   0x33, 0xc1, 0x3f, 0xb2, 0x8a, 0x8,  0xdb, 0x8d, 0x60, 0x28, 0xa7, 0x52, 0x26, 0x0,  0x2,
                   0x5e, 0xde, 0x0,  0x4,  0xb0, 0x93, 0xeb, 0xdd, 0x22, 0xb,  0x48, 0x1f, 0x0,  0xe,  0xb6,
                   0x4b, 0x46, 0xcd, 0xa7, 0xb8, 0xa5, 0x78, 0xcd, 0x29, 0x5e, 0xbb, 0xcb, 0x46, 0x24, 0x8f};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4881);
  EXPECT_EQ(status, 118);
}

// COMP (PubCOMP 4353 234 [PropMessageExpiryInterval 2524,PropUserProperty
// "N\146\DC4\220\140+\201\DC4E\159\140J\186\233\230H\161\140\196\171\170vw`"
// "?\190o\214\238*\216\t\158\NUL\198\137",PropServerReference
// "X$\218\\\ESCMB\149\&5\251\152?\FSd6\138\194",PropSharedSubscriptionAvailable 129,PropPayloadFormatIndicator
// 73,PropSubscriptionIdentifier 15,PropReasonString "\172\172N\175\229\&7\154",PropWillDelayInterval
// 10616,PropSubscriptionIdentifierAvailable 208,PropSubscriptionIdentifierAvailable 92,PropRequestResponseInformation
// 184,PropMessageExpiryInterval 25121,PropSharedSubscriptionAvailable 33,PropMessageExpiryInterval 1066])
TEST(PubACKCOMP5QCTest, Encode5) {
  uint8_t pkt[] = {0x70, 0x6d, 0x11, 0x1,  0xea, 0x69, 0x2,  0x0,  0x0,  0x9,  0xdc, 0x26, 0x0,  0x18, 0x4e, 0x92,
                   0x14, 0xdc, 0x8c, 0x2b, 0xc9, 0x14, 0x45, 0x9f, 0x8c, 0x4a, 0xba, 0xe9, 0xe6, 0x48, 0xa1, 0x8c,
                   0xc4, 0xab, 0xaa, 0x76, 0x77, 0x60, 0x0,  0xc,  0x3f, 0xbe, 0x6f, 0xd6, 0xee, 0x2a, 0xd8, 0x9,
                   0x9e, 0x0,  0xc6, 0x89, 0x1c, 0x0,  0x11, 0x58, 0x24, 0xda, 0x5c, 0x1b, 0x4d, 0x42, 0x95, 0x35,
                   0xfb, 0x98, 0x3f, 0x1c, 0x64, 0x36, 0x8a, 0xc2, 0x2a, 0x81, 0x1,  0x49, 0xb,  0xf,  0x1f, 0x0,
                   0x7,  0xac, 0xac, 0x4e, 0xaf, 0xe5, 0x37, 0x9a, 0x18, 0x0,  0x0,  0x29, 0x78, 0x29, 0xd0, 0x29,
                   0x5c, 0x19, 0xb8, 0x2,  0x0,  0x0,  0x62, 0x21, 0x2a, 0x21, 0x2,  0x0,  0x0,  0x4,  0x2a};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops1[] = {0x3f, 0xbe, 0x6f, 0xd6, 0xee, 0x2a, 0xd8, 0x9, 0x9e, 0x0, 0xc6, 0x89};
  uint8_t bytesprops0[] = {0x4e, 0x92, 0x14, 0xdc, 0x8c, 0x2b, 0xc9, 0x14, 0x45, 0x9f, 0x8c, 0x4a,
                           0xba, 0xe9, 0xe6, 0x48, 0xa1, 0x8c, 0xc4, 0xab, 0xaa, 0x76, 0x77, 0x60};
  uint8_t bytesprops2[] = {0x58, 0x24, 0xda, 0x5c, 0x1b, 0x4d, 0x42, 0x95, 0x35,
                           0xfb, 0x98, 0x3f, 0x1c, 0x64, 0x36, 0x8a, 0xc2};
  uint8_t bytesprops3[] = {0xac, 0xac, 0x4e, 0xaf, 0xe5, 0x37, 0x9a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2524}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops0}, .v = {12, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10616}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25121}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1066}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, 0, 4353, 234, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 4353 234 [PropMessageExpiryInterval 2524,PropUserProperty
// "N\146\DC4\220\140+\201\DC4E\159\140J\186\233\230H\161\140\196\171\170vw`"
// "?\190o\214\238*\216\t\158\NUL\198\137",PropServerReference
// "X$\218\\\ESCMB\149\&5\251\152?\FSd6\138\194",PropSharedSubscriptionAvailable 129,PropPayloadFormatIndicator
// 73,PropSubscriptionIdentifier 15,PropReasonString "\172\172N\175\229\&7\154",PropWillDelayInterval
// 10616,PropSubscriptionIdentifierAvailable 208,PropSubscriptionIdentifierAvailable 92,PropRequestResponseInformation
// 184,PropMessageExpiryInterval 25121,PropSharedSubscriptionAvailable 33,PropMessageExpiryInterval 1066])
TEST(PubACKCOMP5QCTest, Decode5) {
  uint8_t pkt[] = {0x70, 0x6d, 0x11, 0x1,  0xea, 0x69, 0x2,  0x0,  0x0,  0x9,  0xdc, 0x26, 0x0,  0x18, 0x4e, 0x92,
                   0x14, 0xdc, 0x8c, 0x2b, 0xc9, 0x14, 0x45, 0x9f, 0x8c, 0x4a, 0xba, 0xe9, 0xe6, 0x48, 0xa1, 0x8c,
                   0xc4, 0xab, 0xaa, 0x76, 0x77, 0x60, 0x0,  0xc,  0x3f, 0xbe, 0x6f, 0xd6, 0xee, 0x2a, 0xd8, 0x9,
                   0x9e, 0x0,  0xc6, 0x89, 0x1c, 0x0,  0x11, 0x58, 0x24, 0xda, 0x5c, 0x1b, 0x4d, 0x42, 0x95, 0x35,
                   0xfb, 0x98, 0x3f, 0x1c, 0x64, 0x36, 0x8a, 0xc2, 0x2a, 0x81, 0x1,  0x49, 0xb,  0xf,  0x1f, 0x0,
                   0x7,  0xac, 0xac, 0x4e, 0xaf, 0xe5, 0x37, 0x9a, 0x18, 0x0,  0x0,  0x29, 0x78, 0x29, 0xd0, 0x29,
                   0x5c, 0x19, 0xb8, 0x2,  0x0,  0x0,  0x62, 0x21, 0x2a, 0x21, 0x2,  0x0,  0x0,  0x4,  0x2a};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4353);
  EXPECT_EQ(status, 234);
}

// ACK (PubACK 15872 214 [PropReceiveMaximum 30923,PropServerReference "\191\221u\175",PropUserProperty "4v]\t\n~
// \t\210a\222\SYNN3\152" "\236\203\217r\161\179\245\ENQu\255\250\152\NAKF\238",PropTopicAlias
// 11786,PropMaximumPacketSize 30163,PropSubscriptionIdentifierAvailable 10,PropSubscriptionIdentifier
// 16,PropAuthenticationMethod ":\v\136\&1\138\183\DC2=\181\SUB\135\&5",PropAssignedClientIdentifier
// "b)\139",PropContentType "T\178\186\134^\149\130\200\a\199\128NtC\184o\156Q\172",PropAssignedClientIdentifier
// "tu/\180\141\191\184*\134\t\165\SOR%\190\243>\138\152 C\233\147e\v\172B\203\132",PropWildcardSubscriptionAvailable
// 205,PropContentType "f\b{\208\232C",PropSessionExpiryInterval 10209,PropMaximumQoS 161,PropReasonString
// "\188\179\240\f/\188Hd\r1\231\144\f\173p\\\134\SO_\213\EOT\253\&3~{\235M\RSZ",PropAuthenticationMethod
// "\205\213u\DLE\n\238"])
TEST(PubACKACK5QCTest, Encode6) {
  uint8_t pkt[] = {0x40, 0xc4, 0x1,  0x3e, 0x0,  0xd6, 0xbf, 0x1,  0x21, 0x78, 0xcb, 0x1c, 0x0,  0x4,  0xbf, 0xdd, 0x75,
                   0xaf, 0x26, 0x0,  0xf,  0x34, 0x76, 0x5d, 0x9,  0xa,  0x7e, 0x20, 0x9,  0xd2, 0x61, 0xde, 0x16, 0x4e,
                   0x33, 0x98, 0x0,  0xf,  0xec, 0xcb, 0xd9, 0x72, 0xa1, 0xb3, 0xf5, 0x5,  0x75, 0xff, 0xfa, 0x98, 0x15,
                   0x46, 0xee, 0x23, 0x2e, 0xa,  0x27, 0x0,  0x0,  0x75, 0xd3, 0x29, 0xa,  0xb,  0x10, 0x15, 0x0,  0xc,
                   0x3a, 0xb,  0x88, 0x31, 0x8a, 0xb7, 0x12, 0x3d, 0xb5, 0x1a, 0x87, 0x35, 0x12, 0x0,  0x3,  0x62, 0x29,
                   0x8b, 0x3,  0x0,  0x13, 0x54, 0xb2, 0xba, 0x86, 0x5e, 0x95, 0x82, 0xc8, 0x7,  0xc7, 0x80, 0x4e, 0x74,
                   0x43, 0xb8, 0x6f, 0x9c, 0x51, 0xac, 0x12, 0x0,  0x1d, 0x74, 0x75, 0x2f, 0xb4, 0x8d, 0xbf, 0xb8, 0x2a,
                   0x86, 0x9,  0xa5, 0xe,  0x52, 0x25, 0xbe, 0xf3, 0x3e, 0x8a, 0x98, 0x20, 0x43, 0xe9, 0x93, 0x65, 0xb,
                   0xac, 0x42, 0xcb, 0x84, 0x28, 0xcd, 0x3,  0x0,  0x6,  0x66, 0x8,  0x7b, 0xd0, 0xe8, 0x43, 0x11, 0x0,
                   0x0,  0x27, 0xe1, 0x24, 0xa1, 0x1f, 0x0,  0x1d, 0xbc, 0xb3, 0xf0, 0xc,  0x2f, 0xbc, 0x48, 0x64, 0xd,
                   0x31, 0xe7, 0x90, 0xc,  0xad, 0x70, 0x5c, 0x86, 0xe,  0x5f, 0xd5, 0x4,  0xfd, 0x33, 0x7e, 0x7b, 0xeb,
                   0x4d, 0x1e, 0x5a, 0x15, 0x0,  0x6,  0xcd, 0xd5, 0x75, 0x10, 0xa,  0xee};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xbf, 0xdd, 0x75, 0xaf};
  uint8_t bytesprops2[] = {0xec, 0xcb, 0xd9, 0x72, 0xa1, 0xb3, 0xf5, 0x5, 0x75, 0xff, 0xfa, 0x98, 0x15, 0x46, 0xee};
  uint8_t bytesprops1[] = {0x34, 0x76, 0x5d, 0x9, 0xa, 0x7e, 0x20, 0x9, 0xd2, 0x61, 0xde, 0x16, 0x4e, 0x33, 0x98};
  uint8_t bytesprops3[] = {0x3a, 0xb, 0x88, 0x31, 0x8a, 0xb7, 0x12, 0x3d, 0xb5, 0x1a, 0x87, 0x35};
  uint8_t bytesprops4[] = {0x62, 0x29, 0x8b};
  uint8_t bytesprops5[] = {0x54, 0xb2, 0xba, 0x86, 0x5e, 0x95, 0x82, 0xc8, 0x7, 0xc7,
                           0x80, 0x4e, 0x74, 0x43, 0xb8, 0x6f, 0x9c, 0x51, 0xac};
  uint8_t bytesprops6[] = {0x74, 0x75, 0x2f, 0xb4, 0x8d, 0xbf, 0xb8, 0x2a, 0x86, 0x9, 0xa5, 0xe,  0x52, 0x25, 0xbe,
                           0xf3, 0x3e, 0x8a, 0x98, 0x20, 0x43, 0xe9, 0x93, 0x65, 0xb, 0xac, 0x42, 0xcb, 0x84};
  uint8_t bytesprops7[] = {0x66, 0x8, 0x7b, 0xd0, 0xe8, 0x43};
  uint8_t bytesprops8[] = {0xbc, 0xb3, 0xf0, 0xc,  0x2f, 0xbc, 0x48, 0x64, 0xd,  0x31, 0xe7, 0x90, 0xc,  0xad, 0x70,
                           0x5c, 0x86, 0xe,  0x5f, 0xd5, 0x4,  0xfd, 0x33, 0x7e, 0x7b, 0xeb, 0x4d, 0x1e, 0x5a};
  uint8_t bytesprops9[] = {0xcd, 0xd5, 0x75, 0x10, 0xa, 0xee};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30923}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops1}, .v = {15, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11786}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30163}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10209}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 15872, 214, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 15872 214 [PropReceiveMaximum 30923,PropServerReference "\191\221u\175",PropUserProperty "4v]\t\n~
// \t\210a\222\SYNN3\152" "\236\203\217r\161\179\245\ENQu\255\250\152\NAKF\238",PropTopicAlias
// 11786,PropMaximumPacketSize 30163,PropSubscriptionIdentifierAvailable 10,PropSubscriptionIdentifier
// 16,PropAuthenticationMethod ":\v\136\&1\138\183\DC2=\181\SUB\135\&5",PropAssignedClientIdentifier
// "b)\139",PropContentType "T\178\186\134^\149\130\200\a\199\128NtC\184o\156Q\172",PropAssignedClientIdentifier
// "tu/\180\141\191\184*\134\t\165\SOR%\190\243>\138\152 C\233\147e\v\172B\203\132",PropWildcardSubscriptionAvailable
// 205,PropContentType "f\b{\208\232C",PropSessionExpiryInterval 10209,PropMaximumQoS 161,PropReasonString
// "\188\179\240\f/\188Hd\r1\231\144\f\173p\\\134\SO_\213\EOT\253\&3~{\235M\RSZ",PropAuthenticationMethod
// "\205\213u\DLE\n\238"])
TEST(PubACKACK5QCTest, Decode6) {
  uint8_t pkt[] = {0x40, 0xc4, 0x1,  0x3e, 0x0,  0xd6, 0xbf, 0x1,  0x21, 0x78, 0xcb, 0x1c, 0x0,  0x4,  0xbf, 0xdd, 0x75,
                   0xaf, 0x26, 0x0,  0xf,  0x34, 0x76, 0x5d, 0x9,  0xa,  0x7e, 0x20, 0x9,  0xd2, 0x61, 0xde, 0x16, 0x4e,
                   0x33, 0x98, 0x0,  0xf,  0xec, 0xcb, 0xd9, 0x72, 0xa1, 0xb3, 0xf5, 0x5,  0x75, 0xff, 0xfa, 0x98, 0x15,
                   0x46, 0xee, 0x23, 0x2e, 0xa,  0x27, 0x0,  0x0,  0x75, 0xd3, 0x29, 0xa,  0xb,  0x10, 0x15, 0x0,  0xc,
                   0x3a, 0xb,  0x88, 0x31, 0x8a, 0xb7, 0x12, 0x3d, 0xb5, 0x1a, 0x87, 0x35, 0x12, 0x0,  0x3,  0x62, 0x29,
                   0x8b, 0x3,  0x0,  0x13, 0x54, 0xb2, 0xba, 0x86, 0x5e, 0x95, 0x82, 0xc8, 0x7,  0xc7, 0x80, 0x4e, 0x74,
                   0x43, 0xb8, 0x6f, 0x9c, 0x51, 0xac, 0x12, 0x0,  0x1d, 0x74, 0x75, 0x2f, 0xb4, 0x8d, 0xbf, 0xb8, 0x2a,
                   0x86, 0x9,  0xa5, 0xe,  0x52, 0x25, 0xbe, 0xf3, 0x3e, 0x8a, 0x98, 0x20, 0x43, 0xe9, 0x93, 0x65, 0xb,
                   0xac, 0x42, 0xcb, 0x84, 0x28, 0xcd, 0x3,  0x0,  0x6,  0x66, 0x8,  0x7b, 0xd0, 0xe8, 0x43, 0x11, 0x0,
                   0x0,  0x27, 0xe1, 0x24, 0xa1, 0x1f, 0x0,  0x1d, 0xbc, 0xb3, 0xf0, 0xc,  0x2f, 0xbc, 0x48, 0x64, 0xd,
                   0x31, 0xe7, 0x90, 0xc,  0xad, 0x70, 0x5c, 0x86, 0xe,  0x5f, 0xd5, 0x4,  0xfd, 0x33, 0x7e, 0x7b, 0xeb,
                   0x4d, 0x1e, 0x5a, 0x15, 0x0,  0x6,  0xcd, 0xd5, 0x75, 0x10, 0xa,  0xee};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15872);
  EXPECT_EQ(status, 214);
}

// REL (PubREL 21231 228 [PropUserProperty "\v"
// "\138\213\v=-\147\SYN8\221%\224\240!S\135JEj\210\203\206\217`\202H\ETB+",PropServerKeepAlive
// 5414,PropWillDelayInterval 17971,PropContentType "\244\a",PropTopicAliasMaximum 17656,PropReceiveMaximum
// 9191,PropRetainAvailable 122,PropUserProperty "h\140\179\254\r\232\172\215&\144\189\146\131\SUB@l\255\138\162"
// "\186/-U)\232\245\&2",PropMessageExpiryInterval 660,PropServerKeepAlive 9579,PropPayloadFormatIndicator
// 187,PropPayloadFormatIndicator 214,PropReasonString "\247b\200g\248y\137!\220k8o\221\&6",PropResponseInformation
// "wkdM/\138\232\SO\199\203\US\180\143Qfof\161\RSv\247\233B\132OM"])
TEST(PubACKREL5QCTest, Encode7) {
  uint8_t pkt[] = {0x62, 0x95, 0x1,  0x52, 0xef, 0xe4, 0x90, 0x1,  0x26, 0x0,  0x1,  0xb,  0x0,  0x1b, 0x8a, 0xd5, 0xb,
                   0x3d, 0x2d, 0x93, 0x16, 0x38, 0xdd, 0x25, 0xe0, 0xf0, 0x21, 0x53, 0x87, 0x4a, 0x45, 0x6a, 0xd2, 0xcb,
                   0xce, 0xd9, 0x60, 0xca, 0x48, 0x17, 0x2b, 0x13, 0x15, 0x26, 0x18, 0x0,  0x0,  0x46, 0x33, 0x3,  0x0,
                   0x2,  0xf4, 0x7,  0x22, 0x44, 0xf8, 0x21, 0x23, 0xe7, 0x25, 0x7a, 0x26, 0x0,  0x13, 0x68, 0x8c, 0xb3,
                   0xfe, 0xd,  0xe8, 0xac, 0xd7, 0x26, 0x90, 0xbd, 0x92, 0x83, 0x1a, 0x40, 0x6c, 0xff, 0x8a, 0xa2, 0x0,
                   0x8,  0xba, 0x2f, 0x2d, 0x55, 0x29, 0xe8, 0xf5, 0x32, 0x2,  0x0,  0x0,  0x2,  0x94, 0x13, 0x25, 0x6b,
                   0x1,  0xbb, 0x1,  0xd6, 0x1f, 0x0,  0xe,  0xf7, 0x62, 0xc8, 0x67, 0xf8, 0x79, 0x89, 0x21, 0xdc, 0x6b,
                   0x38, 0x6f, 0xdd, 0x36, 0x1a, 0x0,  0x1a, 0x77, 0x6b, 0x64, 0x4d, 0x2f, 0x8a, 0xe8, 0xe,  0xc7, 0xcb,
                   0x1f, 0xb4, 0x8f, 0x51, 0x66, 0x6f, 0x66, 0xa1, 0x1e, 0x76, 0xf7, 0xe9, 0x42, 0x84, 0x4f, 0x4d};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops1[] = {0x8a, 0xd5, 0xb,  0x3d, 0x2d, 0x93, 0x16, 0x38, 0xdd, 0x25, 0xe0, 0xf0, 0x21, 0x53,
                           0x87, 0x4a, 0x45, 0x6a, 0xd2, 0xcb, 0xce, 0xd9, 0x60, 0xca, 0x48, 0x17, 0x2b};
  uint8_t bytesprops0[] = {0xb};
  uint8_t bytesprops2[] = {0xf4, 0x7};
  uint8_t bytesprops4[] = {0xba, 0x2f, 0x2d, 0x55, 0x29, 0xe8, 0xf5, 0x32};
  uint8_t bytesprops3[] = {0x68, 0x8c, 0xb3, 0xfe, 0xd,  0xe8, 0xac, 0xd7, 0x26, 0x90,
                           0xbd, 0x92, 0x83, 0x1a, 0x40, 0x6c, 0xff, 0x8a, 0xa2};
  uint8_t bytesprops5[] = {0xf7, 0x62, 0xc8, 0x67, 0xf8, 0x79, 0x89, 0x21, 0xdc, 0x6b, 0x38, 0x6f, 0xdd, 0x36};
  uint8_t bytesprops6[] = {0x77, 0x6b, 0x64, 0x4d, 0x2f, 0x8a, 0xe8, 0xe,  0xc7, 0xcb, 0x1f, 0xb4, 0x8f,
                           0x51, 0x66, 0x6f, 0x66, 0xa1, 0x1e, 0x76, 0xf7, 0xe9, 0x42, 0x84, 0x4f, 0x4d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops0}, .v = {27, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5414}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17971}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17656}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9191}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops3}, .v = {8, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 660}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9579}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, 0, 21231, 228, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 21231 228 [PropUserProperty "\v"
// "\138\213\v=-\147\SYN8\221%\224\240!S\135JEj\210\203\206\217`\202H\ETB+",PropServerKeepAlive
// 5414,PropWillDelayInterval 17971,PropContentType "\244\a",PropTopicAliasMaximum 17656,PropReceiveMaximum
// 9191,PropRetainAvailable 122,PropUserProperty "h\140\179\254\r\232\172\215&\144\189\146\131\SUB@l\255\138\162"
// "\186/-U)\232\245\&2",PropMessageExpiryInterval 660,PropServerKeepAlive 9579,PropPayloadFormatIndicator
// 187,PropPayloadFormatIndicator 214,PropReasonString "\247b\200g\248y\137!\220k8o\221\&6",PropResponseInformation
// "wkdM/\138\232\SO\199\203\US\180\143Qfof\161\RSv\247\233B\132OM"])
TEST(PubACKREL5QCTest, Decode7) {
  uint8_t pkt[] = {0x62, 0x95, 0x1,  0x52, 0xef, 0xe4, 0x90, 0x1,  0x26, 0x0,  0x1,  0xb,  0x0,  0x1b, 0x8a, 0xd5, 0xb,
                   0x3d, 0x2d, 0x93, 0x16, 0x38, 0xdd, 0x25, 0xe0, 0xf0, 0x21, 0x53, 0x87, 0x4a, 0x45, 0x6a, 0xd2, 0xcb,
                   0xce, 0xd9, 0x60, 0xca, 0x48, 0x17, 0x2b, 0x13, 0x15, 0x26, 0x18, 0x0,  0x0,  0x46, 0x33, 0x3,  0x0,
                   0x2,  0xf4, 0x7,  0x22, 0x44, 0xf8, 0x21, 0x23, 0xe7, 0x25, 0x7a, 0x26, 0x0,  0x13, 0x68, 0x8c, 0xb3,
                   0xfe, 0xd,  0xe8, 0xac, 0xd7, 0x26, 0x90, 0xbd, 0x92, 0x83, 0x1a, 0x40, 0x6c, 0xff, 0x8a, 0xa2, 0x0,
                   0x8,  0xba, 0x2f, 0x2d, 0x55, 0x29, 0xe8, 0xf5, 0x32, 0x2,  0x0,  0x0,  0x2,  0x94, 0x13, 0x25, 0x6b,
                   0x1,  0xbb, 0x1,  0xd6, 0x1f, 0x0,  0xe,  0xf7, 0x62, 0xc8, 0x67, 0xf8, 0x79, 0x89, 0x21, 0xdc, 0x6b,
                   0x38, 0x6f, 0xdd, 0x36, 0x1a, 0x0,  0x1a, 0x77, 0x6b, 0x64, 0x4d, 0x2f, 0x8a, 0xe8, 0xe,  0xc7, 0xcb,
                   0x1f, 0xb4, 0x8f, 0x51, 0x66, 0x6f, 0x66, 0xa1, 0x1e, 0x76, 0xf7, 0xe9, 0x42, 0x84, 0x4f, 0x4d};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21231);
  EXPECT_EQ(status, 228);
}

// REL (PubREL 10396 126 [PropWildcardSubscriptionAvailable 80,PropReceiveMaximum 30778,PropSubscriptionIdentifier
// 13,PropRequestProblemInformation 23,PropMaximumQoS 91,PropContentType
// "\164\248\174\155\177\251\SOH\187\SOH*\179Q\132\146\171\201\254\254\187\223\132\226Z\DC3E",PropServerReference
// "\185\163\188DA\253\SOH\224\239\t\199\136\173\219#\229Ty\151\210)",PropTopicAliasMaximum 15956,PropAuthenticationData
// "\SYN\171U\192\141\251\196\b\196\180p\140C\234aH5\228\241~\165F\245\197\169",PropRequestResponseInformation
// 16,PropReasonString
// "\208U?\187\206S_5\129\215V\255\196q\188e\244L\229W\135\184\247\253",PropRequestProblemInformation 233])
TEST(PubACKREL5QCTest, Encode8) {
  uint8_t pkt[] = {0x62, 0x81, 0x1,  0x28, 0x9c, 0x7e, 0x7d, 0x28, 0x50, 0x21, 0x78, 0x3a, 0xb,  0xd,  0x17, 0x17, 0x24,
                   0x5b, 0x3,  0x0,  0x19, 0xa4, 0xf8, 0xae, 0x9b, 0xb1, 0xfb, 0x1,  0xbb, 0x1,  0x2a, 0xb3, 0x51, 0x84,
                   0x92, 0xab, 0xc9, 0xfe, 0xfe, 0xbb, 0xdf, 0x84, 0xe2, 0x5a, 0x13, 0x45, 0x1c, 0x0,  0x15, 0xb9, 0xa3,
                   0xbc, 0x44, 0x41, 0xfd, 0x1,  0xe0, 0xef, 0x9,  0xc7, 0x88, 0xad, 0xdb, 0x23, 0xe5, 0x54, 0x79, 0x97,
                   0xd2, 0x29, 0x22, 0x3e, 0x54, 0x16, 0x0,  0x19, 0x16, 0xab, 0x55, 0xc0, 0x8d, 0xfb, 0xc4, 0x8,  0xc4,
                   0xb4, 0x70, 0x8c, 0x43, 0xea, 0x61, 0x48, 0x35, 0xe4, 0xf1, 0x7e, 0xa5, 0x46, 0xf5, 0xc5, 0xa9, 0x19,
                   0x10, 0x1f, 0x0,  0x18, 0xd0, 0x55, 0x3f, 0xbb, 0xce, 0x53, 0x5f, 0x35, 0x81, 0xd7, 0x56, 0xff, 0xc4,
                   0x71, 0xbc, 0x65, 0xf4, 0x4c, 0xe5, 0x57, 0x87, 0xb8, 0xf7, 0xfd, 0x17, 0xe9};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xa4, 0xf8, 0xae, 0x9b, 0xb1, 0xfb, 0x1,  0xbb, 0x1,  0x2a, 0xb3, 0x51, 0x84,
                           0x92, 0xab, 0xc9, 0xfe, 0xfe, 0xbb, 0xdf, 0x84, 0xe2, 0x5a, 0x13, 0x45};
  uint8_t bytesprops1[] = {0xb9, 0xa3, 0xbc, 0x44, 0x41, 0xfd, 0x1,  0xe0, 0xef, 0x9, 0xc7,
                           0x88, 0xad, 0xdb, 0x23, 0xe5, 0x54, 0x79, 0x97, 0xd2, 0x29};
  uint8_t bytesprops2[] = {0x16, 0xab, 0x55, 0xc0, 0x8d, 0xfb, 0xc4, 0x8,  0xc4, 0xb4, 0x70, 0x8c, 0x43,
                           0xea, 0x61, 0x48, 0x35, 0xe4, 0xf1, 0x7e, 0xa5, 0x46, 0xf5, 0xc5, 0xa9};
  uint8_t bytesprops3[] = {0xd0, 0x55, 0x3f, 0xbb, 0xce, 0x53, 0x5f, 0x35, 0x81, 0xd7, 0x56, 0xff,
                           0xc4, 0x71, 0xbc, 0x65, 0xf4, 0x4c, 0xe5, 0x57, 0x87, 0xb8, 0xf7, 0xfd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30778}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15956}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 233}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, 0, 10396, 126, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 10396 126 [PropWildcardSubscriptionAvailable 80,PropReceiveMaximum 30778,PropSubscriptionIdentifier
// 13,PropRequestProblemInformation 23,PropMaximumQoS 91,PropContentType
// "\164\248\174\155\177\251\SOH\187\SOH*\179Q\132\146\171\201\254\254\187\223\132\226Z\DC3E",PropServerReference
// "\185\163\188DA\253\SOH\224\239\t\199\136\173\219#\229Ty\151\210)",PropTopicAliasMaximum 15956,PropAuthenticationData
// "\SYN\171U\192\141\251\196\b\196\180p\140C\234aH5\228\241~\165F\245\197\169",PropRequestResponseInformation
// 16,PropReasonString
// "\208U?\187\206S_5\129\215V\255\196q\188e\244L\229W\135\184\247\253",PropRequestProblemInformation 233])
TEST(PubACKREL5QCTest, Decode8) {
  uint8_t pkt[] = {0x62, 0x81, 0x1,  0x28, 0x9c, 0x7e, 0x7d, 0x28, 0x50, 0x21, 0x78, 0x3a, 0xb,  0xd,  0x17, 0x17, 0x24,
                   0x5b, 0x3,  0x0,  0x19, 0xa4, 0xf8, 0xae, 0x9b, 0xb1, 0xfb, 0x1,  0xbb, 0x1,  0x2a, 0xb3, 0x51, 0x84,
                   0x92, 0xab, 0xc9, 0xfe, 0xfe, 0xbb, 0xdf, 0x84, 0xe2, 0x5a, 0x13, 0x45, 0x1c, 0x0,  0x15, 0xb9, 0xa3,
                   0xbc, 0x44, 0x41, 0xfd, 0x1,  0xe0, 0xef, 0x9,  0xc7, 0x88, 0xad, 0xdb, 0x23, 0xe5, 0x54, 0x79, 0x97,
                   0xd2, 0x29, 0x22, 0x3e, 0x54, 0x16, 0x0,  0x19, 0x16, 0xab, 0x55, 0xc0, 0x8d, 0xfb, 0xc4, 0x8,  0xc4,
                   0xb4, 0x70, 0x8c, 0x43, 0xea, 0x61, 0x48, 0x35, 0xe4, 0xf1, 0x7e, 0xa5, 0x46, 0xf5, 0xc5, 0xa9, 0x19,
                   0x10, 0x1f, 0x0,  0x18, 0xd0, 0x55, 0x3f, 0xbb, 0xce, 0x53, 0x5f, 0x35, 0x81, 0xd7, 0x56, 0xff, 0xc4,
                   0x71, 0xbc, 0x65, 0xf4, 0x4c, 0xe5, 0x57, 0x87, 0xb8, 0xf7, 0xfd, 0x17, 0xe9};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10396);
  EXPECT_EQ(status, 126);
}

// ACK (PubACK 26705 173 [PropMessageExpiryInterval 20244,PropMessageExpiryInterval 16583,PropTopicAliasMaximum 21731])
TEST(PubACKACK5QCTest, Encode9) {
  uint8_t pkt[] = {0x40, 0x11, 0x68, 0x51, 0xad, 0xd,  0x2,  0x0,  0x0, 0x4f,
                   0x14, 0x2,  0x0,  0x0,  0x40, 0xc7, 0x22, 0x54, 0xe3};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20244}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16583}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21731}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 26705, 173, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 26705 173 [PropMessageExpiryInterval 20244,PropMessageExpiryInterval 16583,PropTopicAliasMaximum 21731])
TEST(PubACKACK5QCTest, Decode9) {
  uint8_t pkt[] = {0x40, 0x11, 0x68, 0x51, 0xad, 0xd,  0x2,  0x0,  0x0, 0x4f,
                   0x14, 0x2,  0x0,  0x0,  0x40, 0xc7, 0x22, 0x54, 0xe3};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26705);
  EXPECT_EQ(status, 173);
}

// ACK (PubACK 17554 3 [PropResponseTopic "\236\&7c\190\212%\SI\177\208\201e\220)\251",PropAssignedClientIdentifier
// "\EOTU\155\252e\156\155l\EM\214t\192\170\184_\213\207\SI\SUB\243\152\253\151\FS\210\244\193\235\SYN-",PropMessageExpiryInterval
// 742,PropTopicAliasMaximum 3228,PropServerKeepAlive 28550,PropServerKeepAlive 4076])
TEST(PubACKACK5QCTest, Encode10) {
  uint8_t pkt[] = {0x40, 0x44, 0x44, 0x92, 0x3,  0x40, 0x8,  0x0,  0xe,  0xec, 0x37, 0x63, 0xbe, 0xd4,
                   0x25, 0xf,  0xb1, 0xd0, 0xc9, 0x65, 0xdc, 0x29, 0xfb, 0x12, 0x0,  0x1e, 0x4,  0x55,
                   0x9b, 0xfc, 0x65, 0x9c, 0x9b, 0x6c, 0x19, 0xd6, 0x74, 0xc0, 0xaa, 0xb8, 0x5f, 0xd5,
                   0xcf, 0xf,  0x1a, 0xf3, 0x98, 0xfd, 0x97, 0x1c, 0xd2, 0xf4, 0xc1, 0xeb, 0x16, 0x2d,
                   0x2,  0x0,  0x0,  0x2,  0xe6, 0x22, 0xc,  0x9c, 0x13, 0x6f, 0x86, 0x13, 0xf,  0xec};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xec, 0x37, 0x63, 0xbe, 0xd4, 0x25, 0xf, 0xb1, 0xd0, 0xc9, 0x65, 0xdc, 0x29, 0xfb};
  uint8_t bytesprops1[] = {0x4,  0x55, 0x9b, 0xfc, 0x65, 0x9c, 0x9b, 0x6c, 0x19, 0xd6, 0x74, 0xc0, 0xaa, 0xb8, 0x5f,
                           0xd5, 0xcf, 0xf,  0x1a, 0xf3, 0x98, 0xfd, 0x97, 0x1c, 0xd2, 0xf4, 0xc1, 0xeb, 0x16, 0x2d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 742}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3228}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28550}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4076}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 17554, 3, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 17554 3 [PropResponseTopic "\236\&7c\190\212%\SI\177\208\201e\220)\251",PropAssignedClientIdentifier
// "\EOTU\155\252e\156\155l\EM\214t\192\170\184_\213\207\SI\SUB\243\152\253\151\FS\210\244\193\235\SYN-",PropMessageExpiryInterval
// 742,PropTopicAliasMaximum 3228,PropServerKeepAlive 28550,PropServerKeepAlive 4076])
TEST(PubACKACK5QCTest, Decode10) {
  uint8_t pkt[] = {0x40, 0x44, 0x44, 0x92, 0x3,  0x40, 0x8,  0x0,  0xe,  0xec, 0x37, 0x63, 0xbe, 0xd4,
                   0x25, 0xf,  0xb1, 0xd0, 0xc9, 0x65, 0xdc, 0x29, 0xfb, 0x12, 0x0,  0x1e, 0x4,  0x55,
                   0x9b, 0xfc, 0x65, 0x9c, 0x9b, 0x6c, 0x19, 0xd6, 0x74, 0xc0, 0xaa, 0xb8, 0x5f, 0xd5,
                   0xcf, 0xf,  0x1a, 0xf3, 0x98, 0xfd, 0x97, 0x1c, 0xd2, 0xf4, 0xc1, 0xeb, 0x16, 0x2d,
                   0x2,  0x0,  0x0,  0x2,  0xe6, 0x22, 0xc,  0x9c, 0x13, 0x6f, 0x86, 0x13, 0xf,  0xec};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17554);
  EXPECT_EQ(status, 3);
}

// ACK (PubACK 24500 54 [PropSharedSubscriptionAvailable 63])
TEST(PubACKACK5QCTest, Encode11) {
  uint8_t pkt[] = {0x40, 0x6, 0x5f, 0xb4, 0x36, 0x2, 0x2a, 0x3f};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 63}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 24500, 54, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 24500 54 [PropSharedSubscriptionAvailable 63])
TEST(PubACKACK5QCTest, Decode11) {
  uint8_t pkt[] = {0x40, 0x6, 0x5f, 0xb4, 0x36, 0x2, 0x2a, 0x3f};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24500);
  EXPECT_EQ(status, 54);
}

// COMP (PubCOMP 30295 75 [PropServerReference
// ".a\212\129`\195`^\245\213\253:Wg9\148\152(\190\189\193",PropServerKeepAlive 2248,PropSubscriptionIdentifier
// 9,PropRequestResponseInformation 218,PropTopicAlias 26472,PropUserProperty
// "\181\217\219\227\249\ENQEk\241f\220m\DC3;\205\137b\EOTm"
// "\237\251\237\174\182\199\246\209MrUky\201\ETB\150'l\155\153\208\FS\171\&2\185\211\DC4",PropWildcardSubscriptionAvailable
// 213,PropRequestProblemInformation 87,PropSessionExpiryInterval 15186,PropPayloadFormatIndicator
// 155,PropServerKeepAlive 6136,PropMessageExpiryInterval 16008,PropRetainAvailable 202,PropTopicAliasMaximum
// 26810,PropReceiveMaximum 2675,PropRetainAvailable 48,PropSharedSubscriptionAvailable 38,PropResponseTopic
// "MF\171\192\203aZ5\SYN\158\239R\SI",PropUserProperty "L\NULa YLB\t\138;F\244\165\164N\SOHi"
// "\210h\166k\195\&9\131O\254\145\148\236H\249z\144\236\137",PropSessionExpiryInterval 17413,PropAuthenticationData
// "[\184"])
TEST(PubACKCOMP5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x70, 0xbb, 0x1,  0x76, 0x57, 0x4b, 0xb6, 0x1,  0x1c, 0x0,  0x15, 0x2e, 0x61, 0xd4, 0x81, 0x60, 0xc3, 0x60, 0x5e,
      0xf5, 0xd5, 0xfd, 0x3a, 0x57, 0x67, 0x39, 0x94, 0x98, 0x28, 0xbe, 0xbd, 0xc1, 0x13, 0x8,  0xc8, 0xb,  0x9,  0x19,
      0xda, 0x23, 0x67, 0x68, 0x26, 0x0,  0x13, 0xb5, 0xd9, 0xdb, 0xe3, 0xf9, 0x5,  0x45, 0x6b, 0xf1, 0x66, 0xdc, 0x6d,
      0x13, 0x3b, 0xcd, 0x89, 0x62, 0x4,  0x6d, 0x0,  0x1b, 0xed, 0xfb, 0xed, 0xae, 0xb6, 0xc7, 0xf6, 0xd1, 0x4d, 0x72,
      0x55, 0x6b, 0x79, 0xc9, 0x17, 0x96, 0x27, 0x6c, 0x9b, 0x99, 0xd0, 0x1c, 0xab, 0x32, 0xb9, 0xd3, 0x14, 0x28, 0xd5,
      0x17, 0x57, 0x11, 0x0,  0x0,  0x3b, 0x52, 0x1,  0x9b, 0x13, 0x17, 0xf8, 0x2,  0x0,  0x0,  0x3e, 0x88, 0x25, 0xca,
      0x22, 0x68, 0xba, 0x21, 0xa,  0x73, 0x25, 0x30, 0x2a, 0x26, 0x8,  0x0,  0xd,  0x4d, 0x46, 0xab, 0xc0, 0xcb, 0x61,
      0x5a, 0x35, 0x16, 0x9e, 0xef, 0x52, 0xf,  0x26, 0x0,  0x11, 0x4c, 0x0,  0x61, 0x20, 0x59, 0x4c, 0x42, 0x9,  0x8a,
      0x3b, 0x46, 0xf4, 0xa5, 0xa4, 0x4e, 0x1,  0x69, 0x0,  0x12, 0xd2, 0x68, 0xa6, 0x6b, 0xc3, 0x39, 0x83, 0x4f, 0xfe,
      0x91, 0x94, 0xec, 0x48, 0xf9, 0x7a, 0x90, 0xec, 0x89, 0x11, 0x0,  0x0,  0x44, 0x5,  0x16, 0x0,  0x2,  0x5b, 0xb8};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x2e, 0x61, 0xd4, 0x81, 0x60, 0xc3, 0x60, 0x5e, 0xf5, 0xd5, 0xfd,
                           0x3a, 0x57, 0x67, 0x39, 0x94, 0x98, 0x28, 0xbe, 0xbd, 0xc1};
  uint8_t bytesprops2[] = {0xed, 0xfb, 0xed, 0xae, 0xb6, 0xc7, 0xf6, 0xd1, 0x4d, 0x72, 0x55, 0x6b, 0x79, 0xc9,
                           0x17, 0x96, 0x27, 0x6c, 0x9b, 0x99, 0xd0, 0x1c, 0xab, 0x32, 0xb9, 0xd3, 0x14};
  uint8_t bytesprops1[] = {0xb5, 0xd9, 0xdb, 0xe3, 0xf9, 0x5,  0x45, 0x6b, 0xf1, 0x66,
                           0xdc, 0x6d, 0x13, 0x3b, 0xcd, 0x89, 0x62, 0x4,  0x6d};
  uint8_t bytesprops3[] = {0x4d, 0x46, 0xab, 0xc0, 0xcb, 0x61, 0x5a, 0x35, 0x16, 0x9e, 0xef, 0x52, 0xf};
  uint8_t bytesprops5[] = {0xd2, 0x68, 0xa6, 0x6b, 0xc3, 0x39, 0x83, 0x4f, 0xfe,
                           0x91, 0x94, 0xec, 0x48, 0xf9, 0x7a, 0x90, 0xec, 0x89};
  uint8_t bytesprops4[] = {0x4c, 0x0,  0x61, 0x20, 0x59, 0x4c, 0x42, 0x9, 0x8a,
                           0x3b, 0x46, 0xf4, 0xa5, 0xa4, 0x4e, 0x1,  0x69};
  uint8_t bytesprops6[] = {0x5b, 0xb8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2248}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26472}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops1}, .v = {27, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15186}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6136}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16008}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26810}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2675}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops4}, .v = {18, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17413}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, 0, 30295, 75, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 30295 75 [PropServerReference
// ".a\212\129`\195`^\245\213\253:Wg9\148\152(\190\189\193",PropServerKeepAlive 2248,PropSubscriptionIdentifier
// 9,PropRequestResponseInformation 218,PropTopicAlias 26472,PropUserProperty
// "\181\217\219\227\249\ENQEk\241f\220m\DC3;\205\137b\EOTm"
// "\237\251\237\174\182\199\246\209MrUky\201\ETB\150'l\155\153\208\FS\171\&2\185\211\DC4",PropWildcardSubscriptionAvailable
// 213,PropRequestProblemInformation 87,PropSessionExpiryInterval 15186,PropPayloadFormatIndicator
// 155,PropServerKeepAlive 6136,PropMessageExpiryInterval 16008,PropRetainAvailable 202,PropTopicAliasMaximum
// 26810,PropReceiveMaximum 2675,PropRetainAvailable 48,PropSharedSubscriptionAvailable 38,PropResponseTopic
// "MF\171\192\203aZ5\SYN\158\239R\SI",PropUserProperty "L\NULa YLB\t\138;F\244\165\164N\SOHi"
// "\210h\166k\195\&9\131O\254\145\148\236H\249z\144\236\137",PropSessionExpiryInterval 17413,PropAuthenticationData
// "[\184"])
TEST(PubACKCOMP5QCTest, Decode12) {
  uint8_t pkt[] = {
      0x70, 0xbb, 0x1,  0x76, 0x57, 0x4b, 0xb6, 0x1,  0x1c, 0x0,  0x15, 0x2e, 0x61, 0xd4, 0x81, 0x60, 0xc3, 0x60, 0x5e,
      0xf5, 0xd5, 0xfd, 0x3a, 0x57, 0x67, 0x39, 0x94, 0x98, 0x28, 0xbe, 0xbd, 0xc1, 0x13, 0x8,  0xc8, 0xb,  0x9,  0x19,
      0xda, 0x23, 0x67, 0x68, 0x26, 0x0,  0x13, 0xb5, 0xd9, 0xdb, 0xe3, 0xf9, 0x5,  0x45, 0x6b, 0xf1, 0x66, 0xdc, 0x6d,
      0x13, 0x3b, 0xcd, 0x89, 0x62, 0x4,  0x6d, 0x0,  0x1b, 0xed, 0xfb, 0xed, 0xae, 0xb6, 0xc7, 0xf6, 0xd1, 0x4d, 0x72,
      0x55, 0x6b, 0x79, 0xc9, 0x17, 0x96, 0x27, 0x6c, 0x9b, 0x99, 0xd0, 0x1c, 0xab, 0x32, 0xb9, 0xd3, 0x14, 0x28, 0xd5,
      0x17, 0x57, 0x11, 0x0,  0x0,  0x3b, 0x52, 0x1,  0x9b, 0x13, 0x17, 0xf8, 0x2,  0x0,  0x0,  0x3e, 0x88, 0x25, 0xca,
      0x22, 0x68, 0xba, 0x21, 0xa,  0x73, 0x25, 0x30, 0x2a, 0x26, 0x8,  0x0,  0xd,  0x4d, 0x46, 0xab, 0xc0, 0xcb, 0x61,
      0x5a, 0x35, 0x16, 0x9e, 0xef, 0x52, 0xf,  0x26, 0x0,  0x11, 0x4c, 0x0,  0x61, 0x20, 0x59, 0x4c, 0x42, 0x9,  0x8a,
      0x3b, 0x46, 0xf4, 0xa5, 0xa4, 0x4e, 0x1,  0x69, 0x0,  0x12, 0xd2, 0x68, 0xa6, 0x6b, 0xc3, 0x39, 0x83, 0x4f, 0xfe,
      0x91, 0x94, 0xec, 0x48, 0xf9, 0x7a, 0x90, 0xec, 0x89, 0x11, 0x0,  0x0,  0x44, 0x5,  0x16, 0x0,  0x2,  0x5b, 0xb8};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30295);
  EXPECT_EQ(status, 75);
}

// ACK (PubACK 17870 173 [PropSubscriptionIdentifier 9,PropTopicAliasMaximum 27702,PropRequestProblemInformation
// 7,PropResponseInformation "\SOHl\191\254\n\r\240\207",PropTopicAliasMaximum 28514,PropMessageExpiryInterval
// 24956,PropWillDelayInterval 28443,PropMaximumQoS 65])
TEST(PubACKACK5QCTest, Encode13) {
  uint8_t pkt[] = {0x40, 0x25, 0x45, 0xce, 0xad, 0x21, 0xb,  0x9, 0x22, 0x6c, 0x36, 0x17, 0x7,
                   0x1a, 0x0,  0x8,  0x1,  0x6c, 0xbf, 0xfe, 0xa, 0xd,  0xf0, 0xcf, 0x22, 0x6f,
                   0x62, 0x2,  0x0,  0x0,  0x61, 0x7c, 0x18, 0x0, 0x0,  0x6f, 0x1b, 0x24, 0x41};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x1, 0x6c, 0xbf, 0xfe, 0xa, 0xd, 0xf0, 0xcf};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27702}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28514}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24956}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28443}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 65}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 17870, 173, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 17870 173 [PropSubscriptionIdentifier 9,PropTopicAliasMaximum 27702,PropRequestProblemInformation
// 7,PropResponseInformation "\SOHl\191\254\n\r\240\207",PropTopicAliasMaximum 28514,PropMessageExpiryInterval
// 24956,PropWillDelayInterval 28443,PropMaximumQoS 65])
TEST(PubACKACK5QCTest, Decode13) {
  uint8_t pkt[] = {0x40, 0x25, 0x45, 0xce, 0xad, 0x21, 0xb,  0x9, 0x22, 0x6c, 0x36, 0x17, 0x7,
                   0x1a, 0x0,  0x8,  0x1,  0x6c, 0xbf, 0xfe, 0xa, 0xd,  0xf0, 0xcf, 0x22, 0x6f,
                   0x62, 0x2,  0x0,  0x0,  0x61, 0x7c, 0x18, 0x0, 0x0,  0x6f, 0x1b, 0x24, 0x41};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17870);
  EXPECT_EQ(status, 173);
}

// ACK (PubACK 18661 48 [PropResponseInformation "\208W1\a\216]\131\236U\r\219",PropMessageExpiryInterval
// 16564,PropMessageExpiryInterval 3562,PropWillDelayInterval 4868,PropSubscriptionIdentifier 27,PropTopicAlias 12787])
TEST(PubACKACK5QCTest, Encode14) {
  uint8_t pkt[] = {0x40, 0x26, 0x48, 0xe5, 0x30, 0x22, 0x1a, 0x0, 0xb,  0xd0, 0x57, 0x31, 0x7, 0xd8,
                   0x5d, 0x83, 0xec, 0x55, 0xd,  0xdb, 0x2,  0x0, 0x0,  0x40, 0xb4, 0x2,  0x0, 0x0,
                   0xd,  0xea, 0x18, 0x0,  0x0,  0x13, 0x4,  0xb, 0x1b, 0x23, 0x31, 0xf3};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xd0, 0x57, 0x31, 0x7, 0xd8, 0x5d, 0x83, 0xec, 0x55, 0xd, 0xdb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16564}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3562}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4868}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12787}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 18661, 48, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 18661 48 [PropResponseInformation "\208W1\a\216]\131\236U\r\219",PropMessageExpiryInterval
// 16564,PropMessageExpiryInterval 3562,PropWillDelayInterval 4868,PropSubscriptionIdentifier 27,PropTopicAlias 12787])
TEST(PubACKACK5QCTest, Decode14) {
  uint8_t pkt[] = {0x40, 0x26, 0x48, 0xe5, 0x30, 0x22, 0x1a, 0x0, 0xb,  0xd0, 0x57, 0x31, 0x7, 0xd8,
                   0x5d, 0x83, 0xec, 0x55, 0xd,  0xdb, 0x2,  0x0, 0x0,  0x40, 0xb4, 0x2,  0x0, 0x0,
                   0xd,  0xea, 0x18, 0x0,  0x0,  0x13, 0x4,  0xb, 0x1b, 0x23, 0x31, 0xf3};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18661);
  EXPECT_EQ(status, 48);
}

// REC (PubREC 32292 34 [PropSessionExpiryInterval 19966,PropSessionExpiryInterval 16597,PropServerKeepAlive
// 16525,PropUserProperty "\214d\189\196\EM\163\224\198D\205\176\DLE\\\220\166\149\162(\176"
// "\DEL\b\216\138Y^.\SOH<\242",PropResponseInformation
// "\193\&6\208]\239\211A\188G\226\152\GS\162{&\221",PropTopicAliasMaximum 5330,PropPayloadFormatIndicator
// 244,PropAssignedClientIdentifier
// "\207\207\180\230uB\228<\208\162I\246\152\169Y\tTB!HQ\ENQ\191\191bP\n\237y\145",PropRequestProblemInformation
// 72,PropWildcardSubscriptionAvailable 53,PropUserProperty "\239#1\142\242\&5\237\173\254\ACK\r\226\137`e~\232"
// "W\SUB",PropReasonString "\214",PropContentType "\159\193+Gt\153|\210\133\218",PropSharedSubscriptionAvailable
// 17,PropSubscriptionIdentifier 6,PropAuthenticationData
// "j\192g\216\&1\208\158\152\238\176\218\164w",PropRetainAvailable 251,PropServerReference
// "\SUB\247\226\ETBpb\255\235_\EM\133\145\198kA\192\188\&5\217\213X\130\170/\208-mv\205",PropWillDelayInterval
// 6096,PropTopicAliasMaximum 27681])
TEST(PubACKREC5QCTest, Encode15) {
  uint8_t pkt[] = {0x50, 0xd8, 0x1,  0x7e, 0x24, 0x22, 0xd3, 0x1,  0x11, 0x0,  0x0,  0x4d, 0xfe, 0x11, 0x0,  0x0,  0x40,
                   0xd5, 0x13, 0x40, 0x8d, 0x26, 0x0,  0x13, 0xd6, 0x64, 0xbd, 0xc4, 0x19, 0xa3, 0xe0, 0xc6, 0x44, 0xcd,
                   0xb0, 0x10, 0x5c, 0xdc, 0xa6, 0x95, 0xa2, 0x28, 0xb0, 0x0,  0xa,  0x7f, 0x8,  0xd8, 0x8a, 0x59, 0x5e,
                   0x2e, 0x1,  0x3c, 0xf2, 0x1a, 0x0,  0x10, 0xc1, 0x36, 0xd0, 0x5d, 0xef, 0xd3, 0x41, 0xbc, 0x47, 0xe2,
                   0x98, 0x1d, 0xa2, 0x7b, 0x26, 0xdd, 0x22, 0x14, 0xd2, 0x1,  0xf4, 0x12, 0x0,  0x1e, 0xcf, 0xcf, 0xb4,
                   0xe6, 0x75, 0x42, 0xe4, 0x3c, 0xd0, 0xa2, 0x49, 0xf6, 0x98, 0xa9, 0x59, 0x9,  0x54, 0x42, 0x21, 0x48,
                   0x51, 0x5,  0xbf, 0xbf, 0x62, 0x50, 0xa,  0xed, 0x79, 0x91, 0x17, 0x48, 0x28, 0x35, 0x26, 0x0,  0x11,
                   0xef, 0x23, 0x31, 0x8e, 0xf2, 0x35, 0xed, 0xad, 0xfe, 0x6,  0xd,  0xe2, 0x89, 0x60, 0x65, 0x7e, 0xe8,
                   0x0,  0x2,  0x57, 0x1a, 0x1f, 0x0,  0x1,  0xd6, 0x3,  0x0,  0xa,  0x9f, 0xc1, 0x2b, 0x47, 0x74, 0x99,
                   0x7c, 0xd2, 0x85, 0xda, 0x2a, 0x11, 0xb,  0x6,  0x16, 0x0,  0xd,  0x6a, 0xc0, 0x67, 0xd8, 0x31, 0xd0,
                   0x9e, 0x98, 0xee, 0xb0, 0xda, 0xa4, 0x77, 0x25, 0xfb, 0x1c, 0x0,  0x1d, 0x1a, 0xf7, 0xe2, 0x17, 0x70,
                   0x62, 0xff, 0xeb, 0x5f, 0x19, 0x85, 0x91, 0xc6, 0x6b, 0x41, 0xc0, 0xbc, 0x35, 0xd9, 0xd5, 0x58, 0x82,
                   0xaa, 0x2f, 0xd0, 0x2d, 0x6d, 0x76, 0xcd, 0x18, 0x0,  0x0,  0x17, 0xd0, 0x22, 0x6c, 0x21};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops1[] = {0x7f, 0x8, 0xd8, 0x8a, 0x59, 0x5e, 0x2e, 0x1, 0x3c, 0xf2};
  uint8_t bytesprops0[] = {0xd6, 0x64, 0xbd, 0xc4, 0x19, 0xa3, 0xe0, 0xc6, 0x44, 0xcd,
                           0xb0, 0x10, 0x5c, 0xdc, 0xa6, 0x95, 0xa2, 0x28, 0xb0};
  uint8_t bytesprops2[] = {0xc1, 0x36, 0xd0, 0x5d, 0xef, 0xd3, 0x41, 0xbc,
                           0x47, 0xe2, 0x98, 0x1d, 0xa2, 0x7b, 0x26, 0xdd};
  uint8_t bytesprops3[] = {0xcf, 0xcf, 0xb4, 0xe6, 0x75, 0x42, 0xe4, 0x3c, 0xd0, 0xa2, 0x49, 0xf6, 0x98, 0xa9, 0x59,
                           0x9,  0x54, 0x42, 0x21, 0x48, 0x51, 0x5,  0xbf, 0xbf, 0x62, 0x50, 0xa,  0xed, 0x79, 0x91};
  uint8_t bytesprops5[] = {0x57, 0x1a};
  uint8_t bytesprops4[] = {0xef, 0x23, 0x31, 0x8e, 0xf2, 0x35, 0xed, 0xad, 0xfe,
                           0x6,  0xd,  0xe2, 0x89, 0x60, 0x65, 0x7e, 0xe8};
  uint8_t bytesprops6[] = {0xd6};
  uint8_t bytesprops7[] = {0x9f, 0xc1, 0x2b, 0x47, 0x74, 0x99, 0x7c, 0xd2, 0x85, 0xda};
  uint8_t bytesprops8[] = {0x6a, 0xc0, 0x67, 0xd8, 0x31, 0xd0, 0x9e, 0x98, 0xee, 0xb0, 0xda, 0xa4, 0x77};
  uint8_t bytesprops9[] = {0x1a, 0xf7, 0xe2, 0x17, 0x70, 0x62, 0xff, 0xeb, 0x5f, 0x19, 0x85, 0x91, 0xc6, 0x6b, 0x41,
                           0xc0, 0xbc, 0x35, 0xd9, 0xd5, 0x58, 0x82, 0xaa, 0x2f, 0xd0, 0x2d, 0x6d, 0x76, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19966}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16597}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16525}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops0}, .v = {10, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5330}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops4}, .v = {2, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6096}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27681}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREC_PACKET, 0, 32292, 34, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REC (PubREC 32292 34 [PropSessionExpiryInterval 19966,PropSessionExpiryInterval 16597,PropServerKeepAlive
// 16525,PropUserProperty "\214d\189\196\EM\163\224\198D\205\176\DLE\\\220\166\149\162(\176"
// "\DEL\b\216\138Y^.\SOH<\242",PropResponseInformation
// "\193\&6\208]\239\211A\188G\226\152\GS\162{&\221",PropTopicAliasMaximum 5330,PropPayloadFormatIndicator
// 244,PropAssignedClientIdentifier
// "\207\207\180\230uB\228<\208\162I\246\152\169Y\tTB!HQ\ENQ\191\191bP\n\237y\145",PropRequestProblemInformation
// 72,PropWildcardSubscriptionAvailable 53,PropUserProperty "\239#1\142\242\&5\237\173\254\ACK\r\226\137`e~\232"
// "W\SUB",PropReasonString "\214",PropContentType "\159\193+Gt\153|\210\133\218",PropSharedSubscriptionAvailable
// 17,PropSubscriptionIdentifier 6,PropAuthenticationData
// "j\192g\216\&1\208\158\152\238\176\218\164w",PropRetainAvailable 251,PropServerReference
// "\SUB\247\226\ETBpb\255\235_\EM\133\145\198kA\192\188\&5\217\213X\130\170/\208-mv\205",PropWillDelayInterval
// 6096,PropTopicAliasMaximum 27681])
TEST(PubACKREC5QCTest, Decode15) {
  uint8_t pkt[] = {0x50, 0xd8, 0x1,  0x7e, 0x24, 0x22, 0xd3, 0x1,  0x11, 0x0,  0x0,  0x4d, 0xfe, 0x11, 0x0,  0x0,  0x40,
                   0xd5, 0x13, 0x40, 0x8d, 0x26, 0x0,  0x13, 0xd6, 0x64, 0xbd, 0xc4, 0x19, 0xa3, 0xe0, 0xc6, 0x44, 0xcd,
                   0xb0, 0x10, 0x5c, 0xdc, 0xa6, 0x95, 0xa2, 0x28, 0xb0, 0x0,  0xa,  0x7f, 0x8,  0xd8, 0x8a, 0x59, 0x5e,
                   0x2e, 0x1,  0x3c, 0xf2, 0x1a, 0x0,  0x10, 0xc1, 0x36, 0xd0, 0x5d, 0xef, 0xd3, 0x41, 0xbc, 0x47, 0xe2,
                   0x98, 0x1d, 0xa2, 0x7b, 0x26, 0xdd, 0x22, 0x14, 0xd2, 0x1,  0xf4, 0x12, 0x0,  0x1e, 0xcf, 0xcf, 0xb4,
                   0xe6, 0x75, 0x42, 0xe4, 0x3c, 0xd0, 0xa2, 0x49, 0xf6, 0x98, 0xa9, 0x59, 0x9,  0x54, 0x42, 0x21, 0x48,
                   0x51, 0x5,  0xbf, 0xbf, 0x62, 0x50, 0xa,  0xed, 0x79, 0x91, 0x17, 0x48, 0x28, 0x35, 0x26, 0x0,  0x11,
                   0xef, 0x23, 0x31, 0x8e, 0xf2, 0x35, 0xed, 0xad, 0xfe, 0x6,  0xd,  0xe2, 0x89, 0x60, 0x65, 0x7e, 0xe8,
                   0x0,  0x2,  0x57, 0x1a, 0x1f, 0x0,  0x1,  0xd6, 0x3,  0x0,  0xa,  0x9f, 0xc1, 0x2b, 0x47, 0x74, 0x99,
                   0x7c, 0xd2, 0x85, 0xda, 0x2a, 0x11, 0xb,  0x6,  0x16, 0x0,  0xd,  0x6a, 0xc0, 0x67, 0xd8, 0x31, 0xd0,
                   0x9e, 0x98, 0xee, 0xb0, 0xda, 0xa4, 0x77, 0x25, 0xfb, 0x1c, 0x0,  0x1d, 0x1a, 0xf7, 0xe2, 0x17, 0x70,
                   0x62, 0xff, 0xeb, 0x5f, 0x19, 0x85, 0x91, 0xc6, 0x6b, 0x41, 0xc0, 0xbc, 0x35, 0xd9, 0xd5, 0x58, 0x82,
                   0xaa, 0x2f, 0xd0, 0x2d, 0x6d, 0x76, 0xcd, 0x18, 0x0,  0x0,  0x17, 0xd0, 0x22, 0x6c, 0x21};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREC_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32292);
  EXPECT_EQ(status, 34);
}

// ACK (PubACK 11679 6 [PropAssignedClientIdentifier
// "\220\SO\167\167t\180\223\201\n^<\b\r\221\ETX\226\212\RS",PropResponseTopic "\168\SOf",PropMessageExpiryInterval
// 14878,PropRequestResponseInformation 5,PropWillDelayInterval 14209,PropReceiveMaximum 10194,PropSessionExpiryInterval
// 3797,PropResponseInformation "Xc",PropReceiveMaximum 3172,PropRetainAvailable 121,PropRetainAvailable
// 176,PropAssignedClientIdentifier
// "1\211sTO3q\SOH\230\r\142\172\SUB\193\176\133X\135\132\130\246\CAN\153\217\251",PropServerReference
// "-\SOH\140EEI<\184",PropCorrelationData
// "\146\205&\252\217\144|\DC1\151\218O\NUL,\RS\200\218\174\144\DEL\251\247$Z\239T'"])
TEST(PubACKACK5QCTest, Encode16) {
  uint8_t pkt[] = {0x40, 0x83, 0x1,  0x2d, 0x9f, 0x6,  0x7f, 0x12, 0x0,  0x12, 0xdc, 0xe,  0xa7, 0xa7, 0x74, 0xb4, 0xdf,
                   0xc9, 0xa,  0x5e, 0x3c, 0x8,  0xd,  0xdd, 0x3,  0xe2, 0xd4, 0x1e, 0x8,  0x0,  0x3,  0xa8, 0xe,  0x66,
                   0x2,  0x0,  0x0,  0x3a, 0x1e, 0x19, 0x5,  0x18, 0x0,  0x0,  0x37, 0x81, 0x21, 0x27, 0xd2, 0x11, 0x0,
                   0x0,  0xe,  0xd5, 0x1a, 0x0,  0x2,  0x58, 0x63, 0x21, 0xc,  0x64, 0x25, 0x79, 0x25, 0xb0, 0x12, 0x0,
                   0x19, 0x31, 0xd3, 0x73, 0x54, 0x4f, 0x33, 0x71, 0x1,  0xe6, 0xd,  0x8e, 0xac, 0x1a, 0xc1, 0xb0, 0x85,
                   0x58, 0x87, 0x84, 0x82, 0xf6, 0x18, 0x99, 0xd9, 0xfb, 0x1c, 0x0,  0x8,  0x2d, 0x1,  0x8c, 0x45, 0x45,
                   0x49, 0x3c, 0xb8, 0x9,  0x0,  0x1a, 0x92, 0xcd, 0x26, 0xfc, 0xd9, 0x90, 0x7c, 0x11, 0x97, 0xda, 0x4f,
                   0x0,  0x2c, 0x1e, 0xc8, 0xda, 0xae, 0x90, 0x7f, 0xfb, 0xf7, 0x24, 0x5a, 0xef, 0x54, 0x27};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xdc, 0xe,  0xa7, 0xa7, 0x74, 0xb4, 0xdf, 0xc9, 0xa,
                           0x5e, 0x3c, 0x8,  0xd,  0xdd, 0x3,  0xe2, 0xd4, 0x1e};
  uint8_t bytesprops1[] = {0xa8, 0xe, 0x66};
  uint8_t bytesprops2[] = {0x58, 0x63};
  uint8_t bytesprops3[] = {0x31, 0xd3, 0x73, 0x54, 0x4f, 0x33, 0x71, 0x1,  0xe6, 0xd,  0x8e, 0xac, 0x1a,
                           0xc1, 0xb0, 0x85, 0x58, 0x87, 0x84, 0x82, 0xf6, 0x18, 0x99, 0xd9, 0xfb};
  uint8_t bytesprops4[] = {0x2d, 0x1, 0x8c, 0x45, 0x45, 0x49, 0x3c, 0xb8};
  uint8_t bytesprops5[] = {0x92, 0xcd, 0x26, 0xfc, 0xd9, 0x90, 0x7c, 0x11, 0x97, 0xda, 0x4f, 0x0,  0x2c,
                           0x1e, 0xc8, 0xda, 0xae, 0x90, 0x7f, 0xfb, 0xf7, 0x24, 0x5a, 0xef, 0x54, 0x27};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14878}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14209}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10194}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3797}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3172}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 11679, 6, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 11679 6 [PropAssignedClientIdentifier
// "\220\SO\167\167t\180\223\201\n^<\b\r\221\ETX\226\212\RS",PropResponseTopic "\168\SOf",PropMessageExpiryInterval
// 14878,PropRequestResponseInformation 5,PropWillDelayInterval 14209,PropReceiveMaximum 10194,PropSessionExpiryInterval
// 3797,PropResponseInformation "Xc",PropReceiveMaximum 3172,PropRetainAvailable 121,PropRetainAvailable
// 176,PropAssignedClientIdentifier
// "1\211sTO3q\SOH\230\r\142\172\SUB\193\176\133X\135\132\130\246\CAN\153\217\251",PropServerReference
// "-\SOH\140EEI<\184",PropCorrelationData
// "\146\205&\252\217\144|\DC1\151\218O\NUL,\RS\200\218\174\144\DEL\251\247$Z\239T'"])
TEST(PubACKACK5QCTest, Decode16) {
  uint8_t pkt[] = {0x40, 0x83, 0x1,  0x2d, 0x9f, 0x6,  0x7f, 0x12, 0x0,  0x12, 0xdc, 0xe,  0xa7, 0xa7, 0x74, 0xb4, 0xdf,
                   0xc9, 0xa,  0x5e, 0x3c, 0x8,  0xd,  0xdd, 0x3,  0xe2, 0xd4, 0x1e, 0x8,  0x0,  0x3,  0xa8, 0xe,  0x66,
                   0x2,  0x0,  0x0,  0x3a, 0x1e, 0x19, 0x5,  0x18, 0x0,  0x0,  0x37, 0x81, 0x21, 0x27, 0xd2, 0x11, 0x0,
                   0x0,  0xe,  0xd5, 0x1a, 0x0,  0x2,  0x58, 0x63, 0x21, 0xc,  0x64, 0x25, 0x79, 0x25, 0xb0, 0x12, 0x0,
                   0x19, 0x31, 0xd3, 0x73, 0x54, 0x4f, 0x33, 0x71, 0x1,  0xe6, 0xd,  0x8e, 0xac, 0x1a, 0xc1, 0xb0, 0x85,
                   0x58, 0x87, 0x84, 0x82, 0xf6, 0x18, 0x99, 0xd9, 0xfb, 0x1c, 0x0,  0x8,  0x2d, 0x1,  0x8c, 0x45, 0x45,
                   0x49, 0x3c, 0xb8, 0x9,  0x0,  0x1a, 0x92, 0xcd, 0x26, 0xfc, 0xd9, 0x90, 0x7c, 0x11, 0x97, 0xda, 0x4f,
                   0x0,  0x2c, 0x1e, 0xc8, 0xda, 0xae, 0x90, 0x7f, 0xfb, 0xf7, 0x24, 0x5a, 0xef, 0x54, 0x27};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11679);
  EXPECT_EQ(status, 6);
}

// COMP (PubCOMP 24709 179 [PropUserProperty "s" "\STX\133&\236f\NUL\137\STXXg\215+!",PropServerReference
// ":\238M<\197\&8\229\&8\168c\150\217\190A\206\a\166\166\DC4[mo",PropTopicAlias 3894,PropTopicAliasMaximum
// 26084,PropRetainAvailable 195,PropServerReference
// "\224\DEL|\149\SI\200\169N\208)Tw\DLE\FS\DEL",PropResponseInformation "\160]\SIL\226\EOT\172mJ\149\184J1~\US\DEL*2
// \USE\215K\188*h\188\141\151",PropSubscriptionIdentifier 3,PropSessionExpiryInterval
// 25529,PropAssignedClientIdentifier
// "\129a\SUB\233\&2\DC4Pl=F\190Z\DEL7\186\140U\243\213\220\170C",PropSubscriptionIdentifier 19,PropRetainAvailable
// 243,PropServerKeepAlive 4192,PropUserProperty "\228\129\255\131\ENQ\216\211\255D"
// "\215\220V\NAK\249\&8\164\EMqH\143\229\199G}B\186",PropPayloadFormatIndicator 191,PropRequestProblemInformation
// 77,PropServerReference "o\145S\207wq\245G\202\ESC\188\169\139",PropMessageExpiryInterval 4286,PropWillDelayInterval
// 7675,PropPayloadFormatIndicator 79,PropAssignedClientIdentifier "i\253\DELSEQ\t\tze8",PropTopicAliasMaximum
// 28032,PropCorrelationData "C\168\\k\DLE\244\240r\142vRy\132",PropMessageExpiryInterval
// 19088,PropSubscriptionIdentifierAvailable 208,PropResponseInformation
// "EP\143\SYN\ACK\196\152\SI\185`\220&\NAKq%i\206C\168\243C#\202\204\138\154",PropReceiveMaximum 21789])
TEST(PubACKCOMP5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x70, 0x99, 0x2,  0x60, 0x85, 0xb3, 0x94, 0x2,  0x26, 0x0,  0x1,  0x73, 0x0,  0xd,  0x2,  0x85, 0x26, 0xec, 0x66,
      0x0,  0x89, 0x2,  0x58, 0x67, 0xd7, 0x2b, 0x21, 0x1c, 0x0,  0x16, 0x3a, 0xee, 0x4d, 0x3c, 0xc5, 0x38, 0xe5, 0x38,
      0xa8, 0x63, 0x96, 0xd9, 0xbe, 0x41, 0xce, 0x7,  0xa6, 0xa6, 0x14, 0x5b, 0x6d, 0x6f, 0x23, 0xf,  0x36, 0x22, 0x65,
      0xe4, 0x25, 0xc3, 0x1c, 0x0,  0xf,  0xe0, 0x7f, 0x7c, 0x95, 0xf,  0xc8, 0xa9, 0x4e, 0xd0, 0x29, 0x54, 0x77, 0x10,
      0x1c, 0x7f, 0x1a, 0x0,  0x1d, 0xa0, 0x5d, 0xf,  0x4c, 0xe2, 0x4,  0xac, 0x6d, 0x4a, 0x95, 0xb8, 0x4a, 0x31, 0x7e,
      0x1f, 0x7f, 0x2a, 0x32, 0x20, 0x1f, 0x45, 0xd7, 0x4b, 0xbc, 0x2a, 0x68, 0xbc, 0x8d, 0x97, 0xb,  0x3,  0x11, 0x0,
      0x0,  0x63, 0xb9, 0x12, 0x0,  0x16, 0x81, 0x61, 0x1a, 0xe9, 0x32, 0x14, 0x50, 0x6c, 0x3d, 0x46, 0xbe, 0x5a, 0x7f,
      0x37, 0xba, 0x8c, 0x55, 0xf3, 0xd5, 0xdc, 0xaa, 0x43, 0xb,  0x13, 0x25, 0xf3, 0x13, 0x10, 0x60, 0x26, 0x0,  0x9,
      0xe4, 0x81, 0xff, 0x83, 0x5,  0xd8, 0xd3, 0xff, 0x44, 0x0,  0x11, 0xd7, 0xdc, 0x56, 0x15, 0xf9, 0x38, 0xa4, 0x19,
      0x71, 0x48, 0x8f, 0xe5, 0xc7, 0x47, 0x7d, 0x42, 0xba, 0x1,  0xbf, 0x17, 0x4d, 0x1c, 0x0,  0xd,  0x6f, 0x91, 0x53,
      0xcf, 0x77, 0x71, 0xf5, 0x47, 0xca, 0x1b, 0xbc, 0xa9, 0x8b, 0x2,  0x0,  0x0,  0x10, 0xbe, 0x18, 0x0,  0x0,  0x1d,
      0xfb, 0x1,  0x4f, 0x12, 0x0,  0xb,  0x69, 0xfd, 0x7f, 0x53, 0x45, 0x51, 0x9,  0x9,  0x7a, 0x65, 0x38, 0x22, 0x6d,
      0x80, 0x9,  0x0,  0xd,  0x43, 0xa8, 0x5c, 0x6b, 0x10, 0xf4, 0xf0, 0x72, 0x8e, 0x76, 0x52, 0x79, 0x84, 0x2,  0x0,
      0x0,  0x4a, 0x90, 0x29, 0xd0, 0x1a, 0x0,  0x1a, 0x45, 0x50, 0x8f, 0x16, 0x6,  0xc4, 0x98, 0xf,  0xb9, 0x60, 0xdc,
      0x26, 0x15, 0x71, 0x25, 0x69, 0xce, 0x43, 0xa8, 0xf3, 0x43, 0x23, 0xca, 0xcc, 0x8a, 0x9a, 0x21, 0x55, 0x1d};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops1[] = {0x2, 0x85, 0x26, 0xec, 0x66, 0x0, 0x89, 0x2, 0x58, 0x67, 0xd7, 0x2b, 0x21};
  uint8_t bytesprops0[] = {0x73};
  uint8_t bytesprops2[] = {0x3a, 0xee, 0x4d, 0x3c, 0xc5, 0x38, 0xe5, 0x38, 0xa8, 0x63, 0x96,
                           0xd9, 0xbe, 0x41, 0xce, 0x7,  0xa6, 0xa6, 0x14, 0x5b, 0x6d, 0x6f};
  uint8_t bytesprops3[] = {0xe0, 0x7f, 0x7c, 0x95, 0xf, 0xc8, 0xa9, 0x4e, 0xd0, 0x29, 0x54, 0x77, 0x10, 0x1c, 0x7f};
  uint8_t bytesprops4[] = {0xa0, 0x5d, 0xf,  0x4c, 0xe2, 0x4,  0xac, 0x6d, 0x4a, 0x95, 0xb8, 0x4a, 0x31, 0x7e, 0x1f,
                           0x7f, 0x2a, 0x32, 0x20, 0x1f, 0x45, 0xd7, 0x4b, 0xbc, 0x2a, 0x68, 0xbc, 0x8d, 0x97};
  uint8_t bytesprops5[] = {0x81, 0x61, 0x1a, 0xe9, 0x32, 0x14, 0x50, 0x6c, 0x3d, 0x46, 0xbe,
                           0x5a, 0x7f, 0x37, 0xba, 0x8c, 0x55, 0xf3, 0xd5, 0xdc, 0xaa, 0x43};
  uint8_t bytesprops7[] = {0xd7, 0xdc, 0x56, 0x15, 0xf9, 0x38, 0xa4, 0x19, 0x71,
                           0x48, 0x8f, 0xe5, 0xc7, 0x47, 0x7d, 0x42, 0xba};
  uint8_t bytesprops6[] = {0xe4, 0x81, 0xff, 0x83, 0x5, 0xd8, 0xd3, 0xff, 0x44};
  uint8_t bytesprops8[] = {0x6f, 0x91, 0x53, 0xcf, 0x77, 0x71, 0xf5, 0x47, 0xca, 0x1b, 0xbc, 0xa9, 0x8b};
  uint8_t bytesprops9[] = {0x69, 0xfd, 0x7f, 0x53, 0x45, 0x51, 0x9, 0x9, 0x7a, 0x65, 0x38};
  uint8_t bytesprops10[] = {0x43, 0xa8, 0x5c, 0x6b, 0x10, 0xf4, 0xf0, 0x72, 0x8e, 0x76, 0x52, 0x79, 0x84};
  uint8_t bytesprops11[] = {0x45, 0x50, 0x8f, 0x16, 0x6,  0xc4, 0x98, 0xf,  0xb9, 0x60, 0xdc, 0x26, 0x15,
                            0x71, 0x25, 0x69, 0xce, 0x43, 0xa8, 0xf3, 0x43, 0x23, 0xca, 0xcc, 0x8a, 0x9a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops0}, .v = {13, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3894}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26084}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25529}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4192}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops6}, .v = {17, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4286}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7675}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28032}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19088}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21789}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, 0, 24709, 179, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 24709 179 [PropUserProperty "s" "\STX\133&\236f\NUL\137\STXXg\215+!",PropServerReference
// ":\238M<\197\&8\229\&8\168c\150\217\190A\206\a\166\166\DC4[mo",PropTopicAlias 3894,PropTopicAliasMaximum
// 26084,PropRetainAvailable 195,PropServerReference
// "\224\DEL|\149\SI\200\169N\208)Tw\DLE\FS\DEL",PropResponseInformation "\160]\SIL\226\EOT\172mJ\149\184J1~\US\DEL*2
// \USE\215K\188*h\188\141\151",PropSubscriptionIdentifier 3,PropSessionExpiryInterval
// 25529,PropAssignedClientIdentifier
// "\129a\SUB\233\&2\DC4Pl=F\190Z\DEL7\186\140U\243\213\220\170C",PropSubscriptionIdentifier 19,PropRetainAvailable
// 243,PropServerKeepAlive 4192,PropUserProperty "\228\129\255\131\ENQ\216\211\255D"
// "\215\220V\NAK\249\&8\164\EMqH\143\229\199G}B\186",PropPayloadFormatIndicator 191,PropRequestProblemInformation
// 77,PropServerReference "o\145S\207wq\245G\202\ESC\188\169\139",PropMessageExpiryInterval 4286,PropWillDelayInterval
// 7675,PropPayloadFormatIndicator 79,PropAssignedClientIdentifier "i\253\DELSEQ\t\tze8",PropTopicAliasMaximum
// 28032,PropCorrelationData "C\168\\k\DLE\244\240r\142vRy\132",PropMessageExpiryInterval
// 19088,PropSubscriptionIdentifierAvailable 208,PropResponseInformation
// "EP\143\SYN\ACK\196\152\SI\185`\220&\NAKq%i\206C\168\243C#\202\204\138\154",PropReceiveMaximum 21789])
TEST(PubACKCOMP5QCTest, Decode17) {
  uint8_t pkt[] = {
      0x70, 0x99, 0x2,  0x60, 0x85, 0xb3, 0x94, 0x2,  0x26, 0x0,  0x1,  0x73, 0x0,  0xd,  0x2,  0x85, 0x26, 0xec, 0x66,
      0x0,  0x89, 0x2,  0x58, 0x67, 0xd7, 0x2b, 0x21, 0x1c, 0x0,  0x16, 0x3a, 0xee, 0x4d, 0x3c, 0xc5, 0x38, 0xe5, 0x38,
      0xa8, 0x63, 0x96, 0xd9, 0xbe, 0x41, 0xce, 0x7,  0xa6, 0xa6, 0x14, 0x5b, 0x6d, 0x6f, 0x23, 0xf,  0x36, 0x22, 0x65,
      0xe4, 0x25, 0xc3, 0x1c, 0x0,  0xf,  0xe0, 0x7f, 0x7c, 0x95, 0xf,  0xc8, 0xa9, 0x4e, 0xd0, 0x29, 0x54, 0x77, 0x10,
      0x1c, 0x7f, 0x1a, 0x0,  0x1d, 0xa0, 0x5d, 0xf,  0x4c, 0xe2, 0x4,  0xac, 0x6d, 0x4a, 0x95, 0xb8, 0x4a, 0x31, 0x7e,
      0x1f, 0x7f, 0x2a, 0x32, 0x20, 0x1f, 0x45, 0xd7, 0x4b, 0xbc, 0x2a, 0x68, 0xbc, 0x8d, 0x97, 0xb,  0x3,  0x11, 0x0,
      0x0,  0x63, 0xb9, 0x12, 0x0,  0x16, 0x81, 0x61, 0x1a, 0xe9, 0x32, 0x14, 0x50, 0x6c, 0x3d, 0x46, 0xbe, 0x5a, 0x7f,
      0x37, 0xba, 0x8c, 0x55, 0xf3, 0xd5, 0xdc, 0xaa, 0x43, 0xb,  0x13, 0x25, 0xf3, 0x13, 0x10, 0x60, 0x26, 0x0,  0x9,
      0xe4, 0x81, 0xff, 0x83, 0x5,  0xd8, 0xd3, 0xff, 0x44, 0x0,  0x11, 0xd7, 0xdc, 0x56, 0x15, 0xf9, 0x38, 0xa4, 0x19,
      0x71, 0x48, 0x8f, 0xe5, 0xc7, 0x47, 0x7d, 0x42, 0xba, 0x1,  0xbf, 0x17, 0x4d, 0x1c, 0x0,  0xd,  0x6f, 0x91, 0x53,
      0xcf, 0x77, 0x71, 0xf5, 0x47, 0xca, 0x1b, 0xbc, 0xa9, 0x8b, 0x2,  0x0,  0x0,  0x10, 0xbe, 0x18, 0x0,  0x0,  0x1d,
      0xfb, 0x1,  0x4f, 0x12, 0x0,  0xb,  0x69, 0xfd, 0x7f, 0x53, 0x45, 0x51, 0x9,  0x9,  0x7a, 0x65, 0x38, 0x22, 0x6d,
      0x80, 0x9,  0x0,  0xd,  0x43, 0xa8, 0x5c, 0x6b, 0x10, 0xf4, 0xf0, 0x72, 0x8e, 0x76, 0x52, 0x79, 0x84, 0x2,  0x0,
      0x0,  0x4a, 0x90, 0x29, 0xd0, 0x1a, 0x0,  0x1a, 0x45, 0x50, 0x8f, 0x16, 0x6,  0xc4, 0x98, 0xf,  0xb9, 0x60, 0xdc,
      0x26, 0x15, 0x71, 0x25, 0x69, 0xce, 0x43, 0xa8, 0xf3, 0x43, 0x23, 0xca, 0xcc, 0x8a, 0x9a, 0x21, 0x55, 0x1d};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24709);
  EXPECT_EQ(status, 179);
}

// REL (PubREL 19085 19 [PropAuthenticationData "\229\EMU\215\170\189\150q\171\133\137\143\GS",PropContentType
// "|\203?\153\139\v\164\NAKo\190\&2y\224\246[\203\156\234\170\149\186\153\241_4\247\252\182\139",PropTopicAliasMaximum
// 23515,PropResponseTopic "\202QE\EM\128\131\254\206w\ETBg",PropServerKeepAlive 2467,PropMessageExpiryInterval
// 23054,PropWildcardSubscriptionAvailable 68,PropSessionExpiryInterval 14963,PropWillDelayInterval
// 26769,PropRequestProblemInformation 93,PropResponseInformation "\142",PropTopicAliasMaximum
// 12142,PropAuthenticationData ")\232\161Yh\138\205\172:\SI\221\tD\238\GSR\135!<\200",PropSessionExpiryInterval
// 26062,PropSubscriptionIdentifier 1,PropRequestProblemInformation 12,PropResponseInformation
// "+\236\139\&6%\170",PropServerKeepAlive 27551,PropSharedSubscriptionAvailable 176,PropAuthenticationData
// "\NAK#\203\137\157\133)E\138\&9\168\142\SOH\228m\221\199\214\240\249\151\215J\233$B\190\161\178",PropWillDelayInterval
// 3405,PropPayloadFormatIndicator 15,PropUserProperty "\244\&6\179"
// "[\187\130LMUA*\STX\168Mk\232\DELe\145\134\137",PropMaximumPacketSize 6947,PropPayloadFormatIndicator 122])
TEST(PubACKREL5QCTest, Encode18) {
  uint8_t pkt[] = {0x62, 0xd9, 0x1,  0x4a, 0x8d, 0x13, 0xd4, 0x1,  0x16, 0x0,  0xd,  0xe5, 0x19, 0x55, 0xd7, 0xaa, 0xbd,
                   0x96, 0x71, 0xab, 0x85, 0x89, 0x8f, 0x1d, 0x3,  0x0,  0x1d, 0x7c, 0xcb, 0x3f, 0x99, 0x8b, 0xb,  0xa4,
                   0x15, 0x6f, 0xbe, 0x32, 0x79, 0xe0, 0xf6, 0x5b, 0xcb, 0x9c, 0xea, 0xaa, 0x95, 0xba, 0x99, 0xf1, 0x5f,
                   0x34, 0xf7, 0xfc, 0xb6, 0x8b, 0x22, 0x5b, 0xdb, 0x8,  0x0,  0xb,  0xca, 0x51, 0x45, 0x19, 0x80, 0x83,
                   0xfe, 0xce, 0x77, 0x17, 0x67, 0x13, 0x9,  0xa3, 0x2,  0x0,  0x0,  0x5a, 0xe,  0x28, 0x44, 0x11, 0x0,
                   0x0,  0x3a, 0x73, 0x18, 0x0,  0x0,  0x68, 0x91, 0x17, 0x5d, 0x1a, 0x0,  0x1,  0x8e, 0x22, 0x2f, 0x6e,
                   0x16, 0x0,  0x14, 0x29, 0xe8, 0xa1, 0x59, 0x68, 0x8a, 0xcd, 0xac, 0x3a, 0xf,  0xdd, 0x9,  0x44, 0xee,
                   0x1d, 0x52, 0x87, 0x21, 0x3c, 0xc8, 0x11, 0x0,  0x0,  0x65, 0xce, 0xb,  0x1,  0x17, 0xc,  0x1a, 0x0,
                   0x6,  0x2b, 0xec, 0x8b, 0x36, 0x25, 0xaa, 0x13, 0x6b, 0x9f, 0x2a, 0xb0, 0x16, 0x0,  0x1d, 0x15, 0x23,
                   0xcb, 0x89, 0x9d, 0x85, 0x29, 0x45, 0x8a, 0x39, 0xa8, 0x8e, 0x1,  0xe4, 0x6d, 0xdd, 0xc7, 0xd6, 0xf0,
                   0xf9, 0x97, 0xd7, 0x4a, 0xe9, 0x24, 0x42, 0xbe, 0xa1, 0xb2, 0x18, 0x0,  0x0,  0xd,  0x4d, 0x1,  0xf,
                   0x26, 0x0,  0x3,  0xf4, 0x36, 0xb3, 0x0,  0x12, 0x5b, 0xbb, 0x82, 0x4c, 0x4d, 0x55, 0x41, 0x2a, 0x2,
                   0xa8, 0x4d, 0x6b, 0xe8, 0x7f, 0x65, 0x91, 0x86, 0x89, 0x27, 0x0,  0x0,  0x1b, 0x23, 0x1,  0x7a};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xe5, 0x19, 0x55, 0xd7, 0xaa, 0xbd, 0x96, 0x71, 0xab, 0x85, 0x89, 0x8f, 0x1d};
  uint8_t bytesprops1[] = {0x7c, 0xcb, 0x3f, 0x99, 0x8b, 0xb,  0xa4, 0x15, 0x6f, 0xbe, 0x32, 0x79, 0xe0, 0xf6, 0x5b,
                           0xcb, 0x9c, 0xea, 0xaa, 0x95, 0xba, 0x99, 0xf1, 0x5f, 0x34, 0xf7, 0xfc, 0xb6, 0x8b};
  uint8_t bytesprops2[] = {0xca, 0x51, 0x45, 0x19, 0x80, 0x83, 0xfe, 0xce, 0x77, 0x17, 0x67};
  uint8_t bytesprops3[] = {0x8e};
  uint8_t bytesprops4[] = {0x29, 0xe8, 0xa1, 0x59, 0x68, 0x8a, 0xcd, 0xac, 0x3a, 0xf,
                           0xdd, 0x9,  0x44, 0xee, 0x1d, 0x52, 0x87, 0x21, 0x3c, 0xc8};
  uint8_t bytesprops5[] = {0x2b, 0xec, 0x8b, 0x36, 0x25, 0xaa};
  uint8_t bytesprops6[] = {0x15, 0x23, 0xcb, 0x89, 0x9d, 0x85, 0x29, 0x45, 0x8a, 0x39, 0xa8, 0x8e, 0x1,  0xe4, 0x6d,
                           0xdd, 0xc7, 0xd6, 0xf0, 0xf9, 0x97, 0xd7, 0x4a, 0xe9, 0x24, 0x42, 0xbe, 0xa1, 0xb2};
  uint8_t bytesprops8[] = {0x5b, 0xbb, 0x82, 0x4c, 0x4d, 0x55, 0x41, 0x2a, 0x2,
                           0xa8, 0x4d, 0x6b, 0xe8, 0x7f, 0x65, 0x91, 0x86, 0x89};
  uint8_t bytesprops7[] = {0xf4, 0x36, 0xb3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23515}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2467}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23054}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14963}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26769}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12142}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26062}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 1}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27551}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3405}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops7}, .v = {18, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6947}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 122}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, 0, 19085, 19, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 19085 19 [PropAuthenticationData "\229\EMU\215\170\189\150q\171\133\137\143\GS",PropContentType
// "|\203?\153\139\v\164\NAKo\190\&2y\224\246[\203\156\234\170\149\186\153\241_4\247\252\182\139",PropTopicAliasMaximum
// 23515,PropResponseTopic "\202QE\EM\128\131\254\206w\ETBg",PropServerKeepAlive 2467,PropMessageExpiryInterval
// 23054,PropWildcardSubscriptionAvailable 68,PropSessionExpiryInterval 14963,PropWillDelayInterval
// 26769,PropRequestProblemInformation 93,PropResponseInformation "\142",PropTopicAliasMaximum
// 12142,PropAuthenticationData ")\232\161Yh\138\205\172:\SI\221\tD\238\GSR\135!<\200",PropSessionExpiryInterval
// 26062,PropSubscriptionIdentifier 1,PropRequestProblemInformation 12,PropResponseInformation
// "+\236\139\&6%\170",PropServerKeepAlive 27551,PropSharedSubscriptionAvailable 176,PropAuthenticationData
// "\NAK#\203\137\157\133)E\138\&9\168\142\SOH\228m\221\199\214\240\249\151\215J\233$B\190\161\178",PropWillDelayInterval
// 3405,PropPayloadFormatIndicator 15,PropUserProperty "\244\&6\179"
// "[\187\130LMUA*\STX\168Mk\232\DELe\145\134\137",PropMaximumPacketSize 6947,PropPayloadFormatIndicator 122])
TEST(PubACKREL5QCTest, Decode18) {
  uint8_t pkt[] = {0x62, 0xd9, 0x1,  0x4a, 0x8d, 0x13, 0xd4, 0x1,  0x16, 0x0,  0xd,  0xe5, 0x19, 0x55, 0xd7, 0xaa, 0xbd,
                   0x96, 0x71, 0xab, 0x85, 0x89, 0x8f, 0x1d, 0x3,  0x0,  0x1d, 0x7c, 0xcb, 0x3f, 0x99, 0x8b, 0xb,  0xa4,
                   0x15, 0x6f, 0xbe, 0x32, 0x79, 0xe0, 0xf6, 0x5b, 0xcb, 0x9c, 0xea, 0xaa, 0x95, 0xba, 0x99, 0xf1, 0x5f,
                   0x34, 0xf7, 0xfc, 0xb6, 0x8b, 0x22, 0x5b, 0xdb, 0x8,  0x0,  0xb,  0xca, 0x51, 0x45, 0x19, 0x80, 0x83,
                   0xfe, 0xce, 0x77, 0x17, 0x67, 0x13, 0x9,  0xa3, 0x2,  0x0,  0x0,  0x5a, 0xe,  0x28, 0x44, 0x11, 0x0,
                   0x0,  0x3a, 0x73, 0x18, 0x0,  0x0,  0x68, 0x91, 0x17, 0x5d, 0x1a, 0x0,  0x1,  0x8e, 0x22, 0x2f, 0x6e,
                   0x16, 0x0,  0x14, 0x29, 0xe8, 0xa1, 0x59, 0x68, 0x8a, 0xcd, 0xac, 0x3a, 0xf,  0xdd, 0x9,  0x44, 0xee,
                   0x1d, 0x52, 0x87, 0x21, 0x3c, 0xc8, 0x11, 0x0,  0x0,  0x65, 0xce, 0xb,  0x1,  0x17, 0xc,  0x1a, 0x0,
                   0x6,  0x2b, 0xec, 0x8b, 0x36, 0x25, 0xaa, 0x13, 0x6b, 0x9f, 0x2a, 0xb0, 0x16, 0x0,  0x1d, 0x15, 0x23,
                   0xcb, 0x89, 0x9d, 0x85, 0x29, 0x45, 0x8a, 0x39, 0xa8, 0x8e, 0x1,  0xe4, 0x6d, 0xdd, 0xc7, 0xd6, 0xf0,
                   0xf9, 0x97, 0xd7, 0x4a, 0xe9, 0x24, 0x42, 0xbe, 0xa1, 0xb2, 0x18, 0x0,  0x0,  0xd,  0x4d, 0x1,  0xf,
                   0x26, 0x0,  0x3,  0xf4, 0x36, 0xb3, 0x0,  0x12, 0x5b, 0xbb, 0x82, 0x4c, 0x4d, 0x55, 0x41, 0x2a, 0x2,
                   0xa8, 0x4d, 0x6b, 0xe8, 0x7f, 0x65, 0x91, 0x86, 0x89, 0x27, 0x0,  0x0,  0x1b, 0x23, 0x1,  0x7a};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19085);
  EXPECT_EQ(status, 19);
}

// ACK (PubACK 23245 69 [])
TEST(PubACKACK5QCTest, Encode19) {
  uint8_t pkt[] = {0x40, 0x3, 0x5a, 0xcd, 0x45};
  uint8_t buf[sizeof(pkt) + 10];

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 23245, 69, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 23245 69 [])
TEST(PubACKACK5QCTest, Decode19) {
  uint8_t pkt[] = {0x40, 0x3, 0x5a, 0xcd, 0x45};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23245);
  EXPECT_EQ(status, 69);
}

// REL (PubREL 27855 141 [PropServerKeepAlive 19509,PropContentType "m\t\147\154\249\169\\\137V\224\t",PropReasonString
// "J\EMe_\213\196\176\242M4\180\153\246\237\242\fW}\169\246\&5J\151Y",PropReasonString "\216\194'^\203\162#"])
TEST(PubACKREL5QCTest, Encode20) {
  uint8_t pkt[] = {0x62, 0x3a, 0x6c, 0xcf, 0x8d, 0x36, 0x13, 0x4c, 0x35, 0x3,  0x0,  0xb,  0x6d, 0x9,  0x93,
                   0x9a, 0xf9, 0xa9, 0x5c, 0x89, 0x56, 0xe0, 0x9,  0x1f, 0x0,  0x18, 0x4a, 0x19, 0x65, 0x5f,
                   0xd5, 0xc4, 0xb0, 0xf2, 0x4d, 0x34, 0xb4, 0x99, 0xf6, 0xed, 0xf2, 0xc,  0x57, 0x7d, 0xa9,
                   0xf6, 0x35, 0x4a, 0x97, 0x59, 0x1f, 0x0,  0x7,  0xd8, 0xc2, 0x27, 0x5e, 0xcb, 0xa2, 0x23};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x6d, 0x9, 0x93, 0x9a, 0xf9, 0xa9, 0x5c, 0x89, 0x56, 0xe0, 0x9};
  uint8_t bytesprops1[] = {0x4a, 0x19, 0x65, 0x5f, 0xd5, 0xc4, 0xb0, 0xf2, 0x4d, 0x34, 0xb4, 0x99,
                           0xf6, 0xed, 0xf2, 0xc,  0x57, 0x7d, 0xa9, 0xf6, 0x35, 0x4a, 0x97, 0x59};
  uint8_t bytesprops2[] = {0xd8, 0xc2, 0x27, 0x5e, 0xcb, 0xa2, 0x23};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19509}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, 0, 27855, 141, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 27855 141 [PropServerKeepAlive 19509,PropContentType "m\t\147\154\249\169\\\137V\224\t",PropReasonString
// "J\EMe_\213\196\176\242M4\180\153\246\237\242\fW}\169\246\&5J\151Y",PropReasonString "\216\194'^\203\162#"])
TEST(PubACKREL5QCTest, Decode20) {
  uint8_t pkt[] = {0x62, 0x3a, 0x6c, 0xcf, 0x8d, 0x36, 0x13, 0x4c, 0x35, 0x3,  0x0,  0xb,  0x6d, 0x9,  0x93,
                   0x9a, 0xf9, 0xa9, 0x5c, 0x89, 0x56, 0xe0, 0x9,  0x1f, 0x0,  0x18, 0x4a, 0x19, 0x65, 0x5f,
                   0xd5, 0xc4, 0xb0, 0xf2, 0x4d, 0x34, 0xb4, 0x99, 0xf6, 0xed, 0xf2, 0xc,  0x57, 0x7d, 0xa9,
                   0xf6, 0x35, 0x4a, 0x97, 0x59, 0x1f, 0x0,  0x7,  0xd8, 0xc2, 0x27, 0x5e, 0xcb, 0xa2, 0x23};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27855);
  EXPECT_EQ(status, 141);
}

// REL (PubREL 3263 165 [PropWillDelayInterval 32544,PropResponseTopic "\137{\DC2\203",PropWillDelayInterval
// 23614,PropUserProperty "\168\DLET\187\239"
// "Mzl\aL~\247-\196\176\128\t\133b\n\139\156\SYN\215$",PropMessageExpiryInterval
// 21151,PropSubscriptionIdentifierAvailable 159,PropServerReference
// "\251p\131\223iH\195\165L*\SO\148\147\163\166aNK4\155?U\DC4j?\EM\245",PropTopicAlias 1847,PropMaximumPacketSize
// 21817,PropSubscriptionIdentifierAvailable 13,PropServerKeepAlive 6055])
TEST(PubACKREL5QCTest, Encode21) {
  uint8_t pkt[] = {0x62, 0x65, 0xc,  0xbf, 0xa5, 0x61, 0x18, 0x0,  0x0,  0x7f, 0x20, 0x8,  0x0,  0x4,  0x89,
                   0x7b, 0x12, 0xcb, 0x18, 0x0,  0x0,  0x5c, 0x3e, 0x26, 0x0,  0x5,  0xa8, 0x10, 0x54, 0xbb,
                   0xef, 0x0,  0x14, 0x4d, 0x7a, 0x6c, 0x7,  0x4c, 0x7e, 0xf7, 0x2d, 0xc4, 0xb0, 0x80, 0x9,
                   0x85, 0x62, 0xa,  0x8b, 0x9c, 0x16, 0xd7, 0x24, 0x2,  0x0,  0x0,  0x52, 0x9f, 0x29, 0x9f,
                   0x1c, 0x0,  0x1b, 0xfb, 0x70, 0x83, 0xdf, 0x69, 0x48, 0xc3, 0xa5, 0x4c, 0x2a, 0xe,  0x94,
                   0x93, 0xa3, 0xa6, 0x61, 0x4e, 0x4b, 0x34, 0x9b, 0x3f, 0x55, 0x14, 0x6a, 0x3f, 0x19, 0xf5,
                   0x23, 0x7,  0x37, 0x27, 0x0,  0x0,  0x55, 0x39, 0x29, 0xd,  0x13, 0x17, 0xa7};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x89, 0x7b, 0x12, 0xcb};
  uint8_t bytesprops2[] = {0x4d, 0x7a, 0x6c, 0x7,  0x4c, 0x7e, 0xf7, 0x2d, 0xc4, 0xb0,
                           0x80, 0x9,  0x85, 0x62, 0xa,  0x8b, 0x9c, 0x16, 0xd7, 0x24};
  uint8_t bytesprops1[] = {0xa8, 0x10, 0x54, 0xbb, 0xef};
  uint8_t bytesprops3[] = {0xfb, 0x70, 0x83, 0xdf, 0x69, 0x48, 0xc3, 0xa5, 0x4c, 0x2a, 0xe,  0x94, 0x93, 0xa3,
                           0xa6, 0x61, 0x4e, 0x4b, 0x34, 0x9b, 0x3f, 0x55, 0x14, 0x6a, 0x3f, 0x19, 0xf5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32544}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23614}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops1}, .v = {20, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21151}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1847}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21817}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6055}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, 0, 3263, 165, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 3263 165 [PropWillDelayInterval 32544,PropResponseTopic "\137{\DC2\203",PropWillDelayInterval
// 23614,PropUserProperty "\168\DLET\187\239"
// "Mzl\aL~\247-\196\176\128\t\133b\n\139\156\SYN\215$",PropMessageExpiryInterval
// 21151,PropSubscriptionIdentifierAvailable 159,PropServerReference
// "\251p\131\223iH\195\165L*\SO\148\147\163\166aNK4\155?U\DC4j?\EM\245",PropTopicAlias 1847,PropMaximumPacketSize
// 21817,PropSubscriptionIdentifierAvailable 13,PropServerKeepAlive 6055])
TEST(PubACKREL5QCTest, Decode21) {
  uint8_t pkt[] = {0x62, 0x65, 0xc,  0xbf, 0xa5, 0x61, 0x18, 0x0,  0x0,  0x7f, 0x20, 0x8,  0x0,  0x4,  0x89,
                   0x7b, 0x12, 0xcb, 0x18, 0x0,  0x0,  0x5c, 0x3e, 0x26, 0x0,  0x5,  0xa8, 0x10, 0x54, 0xbb,
                   0xef, 0x0,  0x14, 0x4d, 0x7a, 0x6c, 0x7,  0x4c, 0x7e, 0xf7, 0x2d, 0xc4, 0xb0, 0x80, 0x9,
                   0x85, 0x62, 0xa,  0x8b, 0x9c, 0x16, 0xd7, 0x24, 0x2,  0x0,  0x0,  0x52, 0x9f, 0x29, 0x9f,
                   0x1c, 0x0,  0x1b, 0xfb, 0x70, 0x83, 0xdf, 0x69, 0x48, 0xc3, 0xa5, 0x4c, 0x2a, 0xe,  0x94,
                   0x93, 0xa3, 0xa6, 0x61, 0x4e, 0x4b, 0x34, 0x9b, 0x3f, 0x55, 0x14, 0x6a, 0x3f, 0x19, 0xf5,
                   0x23, 0x7,  0x37, 0x27, 0x0,  0x0,  0x55, 0x39, 0x29, 0xd,  0x13, 0x17, 0xa7};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3263);
  EXPECT_EQ(status, 165);
}

// ACK (PubACK 4790 175 [PropMaximumQoS 117,PropReasonString
// "\181\DLE\138gK<\208\137\191(\b\171J\248",PropPayloadFormatIndicator 127,PropReasonString
// "\230\227T'",PropAssignedClientIdentifier "\151\246<",PropPayloadFormatIndicator 43,PropRequestResponseInformation
// 68,PropSharedSubscriptionAvailable 86,PropResponseInformation
// "\DC46\138\142\169^\ACKI\169#\158",PropTopicAliasMaximum 10914,PropMaximumPacketSize 27768,PropPayloadFormatIndicator
// 121,PropAuthenticationMethod "\244+",PropMaximumPacketSize 10461,PropPayloadFormatIndicator 40,PropUserProperty
// "\135\n\128\&5\253Q)\189\252\183\149&\146\180\226\254b\181\208B\NUL"
// "\151\230\165\&8\149Z\152\165\182\DC4\175\ETB\247\223Wd\DC3m8\250a&\DC2\147\t6%0jF",PropMessageExpiryInterval
// 8278,PropUserProperty "\211\NUL\164[_,\164\136\254)\178=@\t!MY\243\139j\210F\225}"
// "\164\213\&7M/\212\193\163\164M0\234\145jIi\128\240\178\170\143\SOB\157W\EM",PropUserProperty
// "\DEL\n\198\185\NUL\DEL\217,\234\203\152#"
// "g\NUL\242\ETX\v\255\DC1\220<\235\175\FS\150f\FS\247",PropRequestResponseInformation 215,PropReceiveMaximum
// 27875,PropServerReference
// "{;`\241\188\ACK\229\155\&4H\189\DC4X\199\175\b\157\184\253\&5\141\231\152\142\145\212\211\&6",PropCorrelationData
// "\130@\234U\232\223l\179\185",PropAssignedClientIdentifier
// "[\193A\ENQz#\251\201\179:\213Z\161\ESC7M\SI\193%&",PropAssignedClientIdentifier
// ">\216\141E\166(\SO\172\128\151",PropMessageExpiryInterval 31417,PropMessageExpiryInterval
// 10052,PropWillDelayInterval 26979])
TEST(PubACKACK5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x40, 0xc9, 0x2,  0x12, 0xb6, 0xaf, 0xc4, 0x2,  0x24, 0x75, 0x1f, 0x0,  0xe,  0xb5, 0x10, 0x8a, 0x67, 0x4b, 0x3c,
      0xd0, 0x89, 0xbf, 0x28, 0x8,  0xab, 0x4a, 0xf8, 0x1,  0x7f, 0x1f, 0x0,  0x4,  0xe6, 0xe3, 0x54, 0x27, 0x12, 0x0,
      0x3,  0x97, 0xf6, 0x3c, 0x1,  0x2b, 0x19, 0x44, 0x2a, 0x56, 0x1a, 0x0,  0xb,  0x14, 0x36, 0x8a, 0x8e, 0xa9, 0x5e,
      0x6,  0x49, 0xa9, 0x23, 0x9e, 0x22, 0x2a, 0xa2, 0x27, 0x0,  0x0,  0x6c, 0x78, 0x1,  0x79, 0x15, 0x0,  0x2,  0xf4,
      0x2b, 0x27, 0x0,  0x0,  0x28, 0xdd, 0x1,  0x28, 0x26, 0x0,  0x15, 0x87, 0xa,  0x80, 0x35, 0xfd, 0x51, 0x29, 0xbd,
      0xfc, 0xb7, 0x95, 0x26, 0x92, 0xb4, 0xe2, 0xfe, 0x62, 0xb5, 0xd0, 0x42, 0x0,  0x0,  0x1e, 0x97, 0xe6, 0xa5, 0x38,
      0x95, 0x5a, 0x98, 0xa5, 0xb6, 0x14, 0xaf, 0x17, 0xf7, 0xdf, 0x57, 0x64, 0x13, 0x6d, 0x38, 0xfa, 0x61, 0x26, 0x12,
      0x93, 0x9,  0x36, 0x25, 0x30, 0x6a, 0x46, 0x2,  0x0,  0x0,  0x20, 0x56, 0x26, 0x0,  0x18, 0xd3, 0x0,  0xa4, 0x5b,
      0x5f, 0x2c, 0xa4, 0x88, 0xfe, 0x29, 0xb2, 0x3d, 0x40, 0x9,  0x21, 0x4d, 0x59, 0xf3, 0x8b, 0x6a, 0xd2, 0x46, 0xe1,
      0x7d, 0x0,  0x1a, 0xa4, 0xd5, 0x37, 0x4d, 0x2f, 0xd4, 0xc1, 0xa3, 0xa4, 0x4d, 0x30, 0xea, 0x91, 0x6a, 0x49, 0x69,
      0x80, 0xf0, 0xb2, 0xaa, 0x8f, 0xe,  0x42, 0x9d, 0x57, 0x19, 0x26, 0x0,  0xc,  0x7f, 0xa,  0xc6, 0xb9, 0x0,  0x7f,
      0xd9, 0x2c, 0xea, 0xcb, 0x98, 0x23, 0x0,  0x10, 0x67, 0x0,  0xf2, 0x3,  0xb,  0xff, 0x11, 0xdc, 0x3c, 0xeb, 0xaf,
      0x1c, 0x96, 0x66, 0x1c, 0xf7, 0x19, 0xd7, 0x21, 0x6c, 0xe3, 0x1c, 0x0,  0x1c, 0x7b, 0x3b, 0x60, 0xf1, 0xbc, 0x6,
      0xe5, 0x9b, 0x34, 0x48, 0xbd, 0x14, 0x58, 0xc7, 0xaf, 0x8,  0x9d, 0xb8, 0xfd, 0x35, 0x8d, 0xe7, 0x98, 0x8e, 0x91,
      0xd4, 0xd3, 0x36, 0x9,  0x0,  0x9,  0x82, 0x40, 0xea, 0x55, 0xe8, 0xdf, 0x6c, 0xb3, 0xb9, 0x12, 0x0,  0x14, 0x5b,
      0xc1, 0x41, 0x5,  0x7a, 0x23, 0xfb, 0xc9, 0xb3, 0x3a, 0xd5, 0x5a, 0xa1, 0x1b, 0x37, 0x4d, 0xf,  0xc1, 0x25, 0x26,
      0x12, 0x0,  0xa,  0x3e, 0xd8, 0x8d, 0x45, 0xa6, 0x28, 0xe,  0xac, 0x80, 0x97, 0x2,  0x0,  0x0,  0x7a, 0xb9, 0x2,
      0x0,  0x0,  0x27, 0x44, 0x18, 0x0,  0x0,  0x69, 0x63};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xb5, 0x10, 0x8a, 0x67, 0x4b, 0x3c, 0xd0, 0x89, 0xbf, 0x28, 0x8, 0xab, 0x4a, 0xf8};
  uint8_t bytesprops1[] = {0xe6, 0xe3, 0x54, 0x27};
  uint8_t bytesprops2[] = {0x97, 0xf6, 0x3c};
  uint8_t bytesprops3[] = {0x14, 0x36, 0x8a, 0x8e, 0xa9, 0x5e, 0x6, 0x49, 0xa9, 0x23, 0x9e};
  uint8_t bytesprops4[] = {0xf4, 0x2b};
  uint8_t bytesprops6[] = {0x97, 0xe6, 0xa5, 0x38, 0x95, 0x5a, 0x98, 0xa5, 0xb6, 0x14, 0xaf, 0x17, 0xf7, 0xdf, 0x57,
                           0x64, 0x13, 0x6d, 0x38, 0xfa, 0x61, 0x26, 0x12, 0x93, 0x9,  0x36, 0x25, 0x30, 0x6a, 0x46};
  uint8_t bytesprops5[] = {0x87, 0xa,  0x80, 0x35, 0xfd, 0x51, 0x29, 0xbd, 0xfc, 0xb7, 0x95,
                           0x26, 0x92, 0xb4, 0xe2, 0xfe, 0x62, 0xb5, 0xd0, 0x42, 0x0};
  uint8_t bytesprops8[] = {0xa4, 0xd5, 0x37, 0x4d, 0x2f, 0xd4, 0xc1, 0xa3, 0xa4, 0x4d, 0x30, 0xea, 0x91,
                           0x6a, 0x49, 0x69, 0x80, 0xf0, 0xb2, 0xaa, 0x8f, 0xe,  0x42, 0x9d, 0x57, 0x19};
  uint8_t bytesprops7[] = {0xd3, 0x0, 0xa4, 0x5b, 0x5f, 0x2c, 0xa4, 0x88, 0xfe, 0x29, 0xb2, 0x3d,
                           0x40, 0x9, 0x21, 0x4d, 0x59, 0xf3, 0x8b, 0x6a, 0xd2, 0x46, 0xe1, 0x7d};
  uint8_t bytesprops10[] = {0x67, 0x0,  0xf2, 0x3,  0xb,  0xff, 0x11, 0xdc,
                            0x3c, 0xeb, 0xaf, 0x1c, 0x96, 0x66, 0x1c, 0xf7};
  uint8_t bytesprops9[] = {0x7f, 0xa, 0xc6, 0xb9, 0x0, 0x7f, 0xd9, 0x2c, 0xea, 0xcb, 0x98, 0x23};
  uint8_t bytesprops11[] = {0x7b, 0x3b, 0x60, 0xf1, 0xbc, 0x6,  0xe5, 0x9b, 0x34, 0x48, 0xbd, 0x14, 0x58, 0xc7,
                            0xaf, 0x8,  0x9d, 0xb8, 0xfd, 0x35, 0x8d, 0xe7, 0x98, 0x8e, 0x91, 0xd4, 0xd3, 0x36};
  uint8_t bytesprops12[] = {0x82, 0x40, 0xea, 0x55, 0xe8, 0xdf, 0x6c, 0xb3, 0xb9};
  uint8_t bytesprops13[] = {0x5b, 0xc1, 0x41, 0x5,  0x7a, 0x23, 0xfb, 0xc9, 0xb3, 0x3a,
                            0xd5, 0x5a, 0xa1, 0x1b, 0x37, 0x4d, 0xf,  0xc1, 0x25, 0x26};
  uint8_t bytesprops14[] = {0x3e, 0xd8, 0x8d, 0x45, 0xa6, 0x28, 0xe, 0xac, 0x80, 0x97};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10914}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27768}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10461}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops5}, .v = {30, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8278}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops7}, .v = {26, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops9}, .v = {16, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27875}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31417}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10052}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26979}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 4790, 175, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 4790 175 [PropMaximumQoS 117,PropReasonString
// "\181\DLE\138gK<\208\137\191(\b\171J\248",PropPayloadFormatIndicator 127,PropReasonString
// "\230\227T'",PropAssignedClientIdentifier "\151\246<",PropPayloadFormatIndicator 43,PropRequestResponseInformation
// 68,PropSharedSubscriptionAvailable 86,PropResponseInformation
// "\DC46\138\142\169^\ACKI\169#\158",PropTopicAliasMaximum 10914,PropMaximumPacketSize 27768,PropPayloadFormatIndicator
// 121,PropAuthenticationMethod "\244+",PropMaximumPacketSize 10461,PropPayloadFormatIndicator 40,PropUserProperty
// "\135\n\128\&5\253Q)\189\252\183\149&\146\180\226\254b\181\208B\NUL"
// "\151\230\165\&8\149Z\152\165\182\DC4\175\ETB\247\223Wd\DC3m8\250a&\DC2\147\t6%0jF",PropMessageExpiryInterval
// 8278,PropUserProperty "\211\NUL\164[_,\164\136\254)\178=@\t!MY\243\139j\210F\225}"
// "\164\213\&7M/\212\193\163\164M0\234\145jIi\128\240\178\170\143\SOB\157W\EM",PropUserProperty
// "\DEL\n\198\185\NUL\DEL\217,\234\203\152#"
// "g\NUL\242\ETX\v\255\DC1\220<\235\175\FS\150f\FS\247",PropRequestResponseInformation 215,PropReceiveMaximum
// 27875,PropServerReference
// "{;`\241\188\ACK\229\155\&4H\189\DC4X\199\175\b\157\184\253\&5\141\231\152\142\145\212\211\&6",PropCorrelationData
// "\130@\234U\232\223l\179\185",PropAssignedClientIdentifier
// "[\193A\ENQz#\251\201\179:\213Z\161\ESC7M\SI\193%&",PropAssignedClientIdentifier
// ">\216\141E\166(\SO\172\128\151",PropMessageExpiryInterval 31417,PropMessageExpiryInterval
// 10052,PropWillDelayInterval 26979])
TEST(PubACKACK5QCTest, Decode22) {
  uint8_t pkt[] = {
      0x40, 0xc9, 0x2,  0x12, 0xb6, 0xaf, 0xc4, 0x2,  0x24, 0x75, 0x1f, 0x0,  0xe,  0xb5, 0x10, 0x8a, 0x67, 0x4b, 0x3c,
      0xd0, 0x89, 0xbf, 0x28, 0x8,  0xab, 0x4a, 0xf8, 0x1,  0x7f, 0x1f, 0x0,  0x4,  0xe6, 0xe3, 0x54, 0x27, 0x12, 0x0,
      0x3,  0x97, 0xf6, 0x3c, 0x1,  0x2b, 0x19, 0x44, 0x2a, 0x56, 0x1a, 0x0,  0xb,  0x14, 0x36, 0x8a, 0x8e, 0xa9, 0x5e,
      0x6,  0x49, 0xa9, 0x23, 0x9e, 0x22, 0x2a, 0xa2, 0x27, 0x0,  0x0,  0x6c, 0x78, 0x1,  0x79, 0x15, 0x0,  0x2,  0xf4,
      0x2b, 0x27, 0x0,  0x0,  0x28, 0xdd, 0x1,  0x28, 0x26, 0x0,  0x15, 0x87, 0xa,  0x80, 0x35, 0xfd, 0x51, 0x29, 0xbd,
      0xfc, 0xb7, 0x95, 0x26, 0x92, 0xb4, 0xe2, 0xfe, 0x62, 0xb5, 0xd0, 0x42, 0x0,  0x0,  0x1e, 0x97, 0xe6, 0xa5, 0x38,
      0x95, 0x5a, 0x98, 0xa5, 0xb6, 0x14, 0xaf, 0x17, 0xf7, 0xdf, 0x57, 0x64, 0x13, 0x6d, 0x38, 0xfa, 0x61, 0x26, 0x12,
      0x93, 0x9,  0x36, 0x25, 0x30, 0x6a, 0x46, 0x2,  0x0,  0x0,  0x20, 0x56, 0x26, 0x0,  0x18, 0xd3, 0x0,  0xa4, 0x5b,
      0x5f, 0x2c, 0xa4, 0x88, 0xfe, 0x29, 0xb2, 0x3d, 0x40, 0x9,  0x21, 0x4d, 0x59, 0xf3, 0x8b, 0x6a, 0xd2, 0x46, 0xe1,
      0x7d, 0x0,  0x1a, 0xa4, 0xd5, 0x37, 0x4d, 0x2f, 0xd4, 0xc1, 0xa3, 0xa4, 0x4d, 0x30, 0xea, 0x91, 0x6a, 0x49, 0x69,
      0x80, 0xf0, 0xb2, 0xaa, 0x8f, 0xe,  0x42, 0x9d, 0x57, 0x19, 0x26, 0x0,  0xc,  0x7f, 0xa,  0xc6, 0xb9, 0x0,  0x7f,
      0xd9, 0x2c, 0xea, 0xcb, 0x98, 0x23, 0x0,  0x10, 0x67, 0x0,  0xf2, 0x3,  0xb,  0xff, 0x11, 0xdc, 0x3c, 0xeb, 0xaf,
      0x1c, 0x96, 0x66, 0x1c, 0xf7, 0x19, 0xd7, 0x21, 0x6c, 0xe3, 0x1c, 0x0,  0x1c, 0x7b, 0x3b, 0x60, 0xf1, 0xbc, 0x6,
      0xe5, 0x9b, 0x34, 0x48, 0xbd, 0x14, 0x58, 0xc7, 0xaf, 0x8,  0x9d, 0xb8, 0xfd, 0x35, 0x8d, 0xe7, 0x98, 0x8e, 0x91,
      0xd4, 0xd3, 0x36, 0x9,  0x0,  0x9,  0x82, 0x40, 0xea, 0x55, 0xe8, 0xdf, 0x6c, 0xb3, 0xb9, 0x12, 0x0,  0x14, 0x5b,
      0xc1, 0x41, 0x5,  0x7a, 0x23, 0xfb, 0xc9, 0xb3, 0x3a, 0xd5, 0x5a, 0xa1, 0x1b, 0x37, 0x4d, 0xf,  0xc1, 0x25, 0x26,
      0x12, 0x0,  0xa,  0x3e, 0xd8, 0x8d, 0x45, 0xa6, 0x28, 0xe,  0xac, 0x80, 0x97, 0x2,  0x0,  0x0,  0x7a, 0xb9, 0x2,
      0x0,  0x0,  0x27, 0x44, 0x18, 0x0,  0x0,  0x69, 0x63};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4790);
  EXPECT_EQ(status, 175);
}

// REL (PubREL 7224 239 [PropResponseInformation "\199[\249",PropServerReference
// "\f\DC3{(\200Z\154\ETBc\215\216\169A8\170\183\DC1\159\209\139\&0[\242\230\143m\242\&2",PropContentType
// "\196~\ESC",PropAuthenticationMethod "\152\&4P\136",PropSessionExpiryInterval 6962,PropWildcardSubscriptionAvailable
// 7,PropPayloadFormatIndicator 79,PropCorrelationData
// "\181\187\SOH\157\180\183m9x\137m\164\166\SUB\248\207D\186\140\162\183\&4\247\158\n\b",PropResponseInformation
// "{\DEL\245\EOT\240!\196\177h\146\SI\203a\CAN\231{G8\231\237wu8\186qq \RS",PropMessageExpiryInterval
// 188,PropTopicAlias 5684,PropSubscriptionIdentifier 3,PropServerReference
// "!L\185\237e\229\213\200\179",PropContentType "\GS\231\156T",PropTopicAliasMaximum 19004,PropMessageExpiryInterval
// 5773,PropRequestResponseInformation 61,PropMessageExpiryInterval 32275,PropTopicAliasMaximum
// 15152,PropSessionExpiryInterval 17393,PropRequestProblemInformation 50,PropSessionExpiryInterval 1871,PropMaximumQoS
// 106,PropAuthenticationMethod "!\SI\DC2L\160\240\215>=\221dyqs\158y\177",PropReasonString
// ")\166Rt\207\180[\215Mt\f\205\138\SOH-T\ACK\196ee\222H]\177\215\175~\193\198",PropSessionExpiryInterval
// 16563,PropSessionExpiryInterval 29528,PropContentType "B\163\DC4/\177q;@? \146{\144"])
TEST(PubACKREL5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x62, 0x87, 0x2,  0x1c, 0x38, 0xef, 0x82, 0x2,  0x1a, 0x0,  0x3,  0xc7, 0x5b, 0xf9, 0x1c, 0x0,  0x1c, 0xc,  0x13,
      0x7b, 0x28, 0xc8, 0x5a, 0x9a, 0x17, 0x63, 0xd7, 0xd8, 0xa9, 0x41, 0x38, 0xaa, 0xb7, 0x11, 0x9f, 0xd1, 0x8b, 0x30,
      0x5b, 0xf2, 0xe6, 0x8f, 0x6d, 0xf2, 0x32, 0x3,  0x0,  0x3,  0xc4, 0x7e, 0x1b, 0x15, 0x0,  0x4,  0x98, 0x34, 0x50,
      0x88, 0x11, 0x0,  0x0,  0x1b, 0x32, 0x28, 0x7,  0x1,  0x4f, 0x9,  0x0,  0x1a, 0xb5, 0xbb, 0x1,  0x9d, 0xb4, 0xb7,
      0x6d, 0x39, 0x78, 0x89, 0x6d, 0xa4, 0xa6, 0x1a, 0xf8, 0xcf, 0x44, 0xba, 0x8c, 0xa2, 0xb7, 0x34, 0xf7, 0x9e, 0xa,
      0x8,  0x1a, 0x0,  0x1c, 0x7b, 0x7f, 0xf5, 0x4,  0xf0, 0x21, 0xc4, 0xb1, 0x68, 0x92, 0xf,  0xcb, 0x61, 0x18, 0xe7,
      0x7b, 0x47, 0x38, 0xe7, 0xed, 0x77, 0x75, 0x38, 0xba, 0x71, 0x71, 0x20, 0x1e, 0x2,  0x0,  0x0,  0x0,  0xbc, 0x23,
      0x16, 0x34, 0xb,  0x3,  0x1c, 0x0,  0x9,  0x21, 0x4c, 0xb9, 0xed, 0x65, 0xe5, 0xd5, 0xc8, 0xb3, 0x3,  0x0,  0x4,
      0x1d, 0xe7, 0x9c, 0x54, 0x22, 0x4a, 0x3c, 0x2,  0x0,  0x0,  0x16, 0x8d, 0x19, 0x3d, 0x2,  0x0,  0x0,  0x7e, 0x13,
      0x22, 0x3b, 0x30, 0x11, 0x0,  0x0,  0x43, 0xf1, 0x17, 0x32, 0x11, 0x0,  0x0,  0x7,  0x4f, 0x24, 0x6a, 0x15, 0x0,
      0x11, 0x21, 0xf,  0x12, 0x4c, 0xa0, 0xf0, 0xd7, 0x3e, 0x3d, 0xdd, 0x64, 0x79, 0x71, 0x73, 0x9e, 0x79, 0xb1, 0x1f,
      0x0,  0x1d, 0x29, 0xa6, 0x52, 0x74, 0xcf, 0xb4, 0x5b, 0xd7, 0x4d, 0x74, 0xc,  0xcd, 0x8a, 0x1,  0x2d, 0x54, 0x6,
      0xc4, 0x65, 0x65, 0xde, 0x48, 0x5d, 0xb1, 0xd7, 0xaf, 0x7e, 0xc1, 0xc6, 0x11, 0x0,  0x0,  0x40, 0xb3, 0x11, 0x0,
      0x0,  0x73, 0x58, 0x3,  0x0,  0xd,  0x42, 0xa3, 0x14, 0x2f, 0xb1, 0x71, 0x3b, 0x40, 0x3f, 0x20, 0x92, 0x7b, 0x90};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xc7, 0x5b, 0xf9};
  uint8_t bytesprops1[] = {0xc,  0x13, 0x7b, 0x28, 0xc8, 0x5a, 0x9a, 0x17, 0x63, 0xd7, 0xd8, 0xa9, 0x41, 0x38,
                           0xaa, 0xb7, 0x11, 0x9f, 0xd1, 0x8b, 0x30, 0x5b, 0xf2, 0xe6, 0x8f, 0x6d, 0xf2, 0x32};
  uint8_t bytesprops2[] = {0xc4, 0x7e, 0x1b};
  uint8_t bytesprops3[] = {0x98, 0x34, 0x50, 0x88};
  uint8_t bytesprops4[] = {0xb5, 0xbb, 0x1,  0x9d, 0xb4, 0xb7, 0x6d, 0x39, 0x78, 0x89, 0x6d, 0xa4, 0xa6,
                           0x1a, 0xf8, 0xcf, 0x44, 0xba, 0x8c, 0xa2, 0xb7, 0x34, 0xf7, 0x9e, 0xa,  0x8};
  uint8_t bytesprops5[] = {0x7b, 0x7f, 0xf5, 0x4,  0xf0, 0x21, 0xc4, 0xb1, 0x68, 0x92, 0xf,  0xcb, 0x61, 0x18,
                           0xe7, 0x7b, 0x47, 0x38, 0xe7, 0xed, 0x77, 0x75, 0x38, 0xba, 0x71, 0x71, 0x20, 0x1e};
  uint8_t bytesprops6[] = {0x21, 0x4c, 0xb9, 0xed, 0x65, 0xe5, 0xd5, 0xc8, 0xb3};
  uint8_t bytesprops7[] = {0x1d, 0xe7, 0x9c, 0x54};
  uint8_t bytesprops8[] = {0x21, 0xf,  0x12, 0x4c, 0xa0, 0xf0, 0xd7, 0x3e, 0x3d,
                           0xdd, 0x64, 0x79, 0x71, 0x73, 0x9e, 0x79, 0xb1};
  uint8_t bytesprops9[] = {0x29, 0xa6, 0x52, 0x74, 0xcf, 0xb4, 0x5b, 0xd7, 0x4d, 0x74, 0xc,  0xcd, 0x8a, 0x1, 0x2d,
                           0x54, 0x6,  0xc4, 0x65, 0x65, 0xde, 0x48, 0x5d, 0xb1, 0xd7, 0xaf, 0x7e, 0xc1, 0xc6};
  uint8_t bytesprops10[] = {0x42, 0xa3, 0x14, 0x2f, 0xb1, 0x71, 0x3b, 0x40, 0x3f, 0x20, 0x92, 0x7b, 0x90};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6962}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 188}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5684}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19004}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5773}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32275}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15152}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17393}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1871}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16563}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29528}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, 0, 7224, 239, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 7224 239 [PropResponseInformation "\199[\249",PropServerReference
// "\f\DC3{(\200Z\154\ETBc\215\216\169A8\170\183\DC1\159\209\139\&0[\242\230\143m\242\&2",PropContentType
// "\196~\ESC",PropAuthenticationMethod "\152\&4P\136",PropSessionExpiryInterval 6962,PropWildcardSubscriptionAvailable
// 7,PropPayloadFormatIndicator 79,PropCorrelationData
// "\181\187\SOH\157\180\183m9x\137m\164\166\SUB\248\207D\186\140\162\183\&4\247\158\n\b",PropResponseInformation
// "{\DEL\245\EOT\240!\196\177h\146\SI\203a\CAN\231{G8\231\237wu8\186qq \RS",PropMessageExpiryInterval
// 188,PropTopicAlias 5684,PropSubscriptionIdentifier 3,PropServerReference
// "!L\185\237e\229\213\200\179",PropContentType "\GS\231\156T",PropTopicAliasMaximum 19004,PropMessageExpiryInterval
// 5773,PropRequestResponseInformation 61,PropMessageExpiryInterval 32275,PropTopicAliasMaximum
// 15152,PropSessionExpiryInterval 17393,PropRequestProblemInformation 50,PropSessionExpiryInterval 1871,PropMaximumQoS
// 106,PropAuthenticationMethod "!\SI\DC2L\160\240\215>=\221dyqs\158y\177",PropReasonString
// ")\166Rt\207\180[\215Mt\f\205\138\SOH-T\ACK\196ee\222H]\177\215\175~\193\198",PropSessionExpiryInterval
// 16563,PropSessionExpiryInterval 29528,PropContentType "B\163\DC4/\177q;@? \146{\144"])
TEST(PubACKREL5QCTest, Decode23) {
  uint8_t pkt[] = {
      0x62, 0x87, 0x2,  0x1c, 0x38, 0xef, 0x82, 0x2,  0x1a, 0x0,  0x3,  0xc7, 0x5b, 0xf9, 0x1c, 0x0,  0x1c, 0xc,  0x13,
      0x7b, 0x28, 0xc8, 0x5a, 0x9a, 0x17, 0x63, 0xd7, 0xd8, 0xa9, 0x41, 0x38, 0xaa, 0xb7, 0x11, 0x9f, 0xd1, 0x8b, 0x30,
      0x5b, 0xf2, 0xe6, 0x8f, 0x6d, 0xf2, 0x32, 0x3,  0x0,  0x3,  0xc4, 0x7e, 0x1b, 0x15, 0x0,  0x4,  0x98, 0x34, 0x50,
      0x88, 0x11, 0x0,  0x0,  0x1b, 0x32, 0x28, 0x7,  0x1,  0x4f, 0x9,  0x0,  0x1a, 0xb5, 0xbb, 0x1,  0x9d, 0xb4, 0xb7,
      0x6d, 0x39, 0x78, 0x89, 0x6d, 0xa4, 0xa6, 0x1a, 0xf8, 0xcf, 0x44, 0xba, 0x8c, 0xa2, 0xb7, 0x34, 0xf7, 0x9e, 0xa,
      0x8,  0x1a, 0x0,  0x1c, 0x7b, 0x7f, 0xf5, 0x4,  0xf0, 0x21, 0xc4, 0xb1, 0x68, 0x92, 0xf,  0xcb, 0x61, 0x18, 0xe7,
      0x7b, 0x47, 0x38, 0xe7, 0xed, 0x77, 0x75, 0x38, 0xba, 0x71, 0x71, 0x20, 0x1e, 0x2,  0x0,  0x0,  0x0,  0xbc, 0x23,
      0x16, 0x34, 0xb,  0x3,  0x1c, 0x0,  0x9,  0x21, 0x4c, 0xb9, 0xed, 0x65, 0xe5, 0xd5, 0xc8, 0xb3, 0x3,  0x0,  0x4,
      0x1d, 0xe7, 0x9c, 0x54, 0x22, 0x4a, 0x3c, 0x2,  0x0,  0x0,  0x16, 0x8d, 0x19, 0x3d, 0x2,  0x0,  0x0,  0x7e, 0x13,
      0x22, 0x3b, 0x30, 0x11, 0x0,  0x0,  0x43, 0xf1, 0x17, 0x32, 0x11, 0x0,  0x0,  0x7,  0x4f, 0x24, 0x6a, 0x15, 0x0,
      0x11, 0x21, 0xf,  0x12, 0x4c, 0xa0, 0xf0, 0xd7, 0x3e, 0x3d, 0xdd, 0x64, 0x79, 0x71, 0x73, 0x9e, 0x79, 0xb1, 0x1f,
      0x0,  0x1d, 0x29, 0xa6, 0x52, 0x74, 0xcf, 0xb4, 0x5b, 0xd7, 0x4d, 0x74, 0xc,  0xcd, 0x8a, 0x1,  0x2d, 0x54, 0x6,
      0xc4, 0x65, 0x65, 0xde, 0x48, 0x5d, 0xb1, 0xd7, 0xaf, 0x7e, 0xc1, 0xc6, 0x11, 0x0,  0x0,  0x40, 0xb3, 0x11, 0x0,
      0x0,  0x73, 0x58, 0x3,  0x0,  0xd,  0x42, 0xa3, 0x14, 0x2f, 0xb1, 0x71, 0x3b, 0x40, 0x3f, 0x20, 0x92, 0x7b, 0x90};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7224);
  EXPECT_EQ(status, 239);
}

// REL (PubREL 15593 241 [PropSubscriptionIdentifier 15,PropServerReference "g\155\204r",PropContentType
// "~\185\214g\196n\162\178j\STX\242\145\130\140\162~j\176\220'\201\163\NAK\131\166\143\GS",PropSubscriptionIdentifierAvailable
// 86,PropServerReference "5;\132zUx\169azP",PropResponseTopic
// "\139\226\248\211R=9\227\&3\195\247-;@k",PropResponseTopic "q\185yDL\184\189<D",PropUserProperty
// "!4Y\145P\EOT=\163\ETB*p\253\176" "\253-\160P\148\139s\180\246",PropResponseInformation
// "\225E\EOT\150\233\227r!kx;(\142\145\r7\184]\149\136\172)'q8\218",PropUserProperty
// "\131\229\159\240\205\r\240\181\&6\179\144\255H\216D\161\235\207\NAK\161l"
// "\ACK\131[\\\190\204s7\STX\140\216",PropServerReference
// "|\CAN\205\130^\218\238\253\255\243\&0?\229\254\169+\246\148\186r\EOT",PropServerReference
// "\164\254\203\150\133Yc\SYN\168\ACK\216\&2\179\233\227\250\GS\r)\238\247\129\255\SO\180\140",PropServerKeepAlive
// 18881,PropCorrelationData "\247\146m\188$\146",PropAssignedClientIdentifier "\DC1\"\143\226\\",PropServerReference
// "{\DLE\144SQ\222-9\a;W\197=?\167\195%",PropSharedSubscriptionAvailable 195,PropMessageExpiryInterval
// 5958,PropWillDelayInterval 4830,PropServerReference
// "O=n\158\"\136\188\135i\142\242\193E^\152\190Ll}\217@\163,\128\191",PropTopicAliasMaximum
// 25878,PropSubscriptionIdentifier 20,PropCorrelationData
// "\DC3\ETB\243)\133B\203\na\FS\254\208",PropSubscriptionIdentifierAvailable 141,PropServerKeepAlive
// 22346,PropReasonString "\155\202\199v\144\237",PropWillDelayInterval 9852,PropServerKeepAlive 25296])
TEST(PubACKREL5QCTest, Encode24) {
  uint8_t pkt[] = {
      0x62, 0xe5, 0x2,  0x3c, 0xe9, 0xf1, 0xe0, 0x2,  0xb,  0xf,  0x1c, 0x0,  0x4,  0x67, 0x9b, 0xcc, 0x72, 0x3,  0x0,
      0x1b, 0x7e, 0xb9, 0xd6, 0x67, 0xc4, 0x6e, 0xa2, 0xb2, 0x6a, 0x2,  0xf2, 0x91, 0x82, 0x8c, 0xa2, 0x7e, 0x6a, 0xb0,
      0xdc, 0x27, 0xc9, 0xa3, 0x15, 0x83, 0xa6, 0x8f, 0x1d, 0x29, 0x56, 0x1c, 0x0,  0xa,  0x35, 0x3b, 0x84, 0x7a, 0x55,
      0x78, 0xa9, 0x61, 0x7a, 0x50, 0x8,  0x0,  0xf,  0x8b, 0xe2, 0xf8, 0xd3, 0x52, 0x3d, 0x39, 0xe3, 0x33, 0xc3, 0xf7,
      0x2d, 0x3b, 0x40, 0x6b, 0x8,  0x0,  0x9,  0x71, 0xb9, 0x79, 0x44, 0x4c, 0xb8, 0xbd, 0x3c, 0x44, 0x26, 0x0,  0xd,
      0x21, 0x34, 0x59, 0x91, 0x50, 0x4,  0x3d, 0xa3, 0x17, 0x2a, 0x70, 0xfd, 0xb0, 0x0,  0x9,  0xfd, 0x2d, 0xa0, 0x50,
      0x94, 0x8b, 0x73, 0xb4, 0xf6, 0x1a, 0x0,  0x1a, 0xe1, 0x45, 0x4,  0x96, 0xe9, 0xe3, 0x72, 0x21, 0x6b, 0x78, 0x3b,
      0x28, 0x8e, 0x91, 0xd,  0x37, 0xb8, 0x5d, 0x95, 0x88, 0xac, 0x29, 0x27, 0x71, 0x38, 0xda, 0x26, 0x0,  0x15, 0x83,
      0xe5, 0x9f, 0xf0, 0xcd, 0xd,  0xf0, 0xb5, 0x36, 0xb3, 0x90, 0xff, 0x48, 0xd8, 0x44, 0xa1, 0xeb, 0xcf, 0x15, 0xa1,
      0x6c, 0x0,  0xb,  0x6,  0x83, 0x5b, 0x5c, 0xbe, 0xcc, 0x73, 0x37, 0x2,  0x8c, 0xd8, 0x1c, 0x0,  0x15, 0x7c, 0x18,
      0xcd, 0x82, 0x5e, 0xda, 0xee, 0xfd, 0xff, 0xf3, 0x30, 0x3f, 0xe5, 0xfe, 0xa9, 0x2b, 0xf6, 0x94, 0xba, 0x72, 0x4,
      0x1c, 0x0,  0x1a, 0xa4, 0xfe, 0xcb, 0x96, 0x85, 0x59, 0x63, 0x16, 0xa8, 0x6,  0xd8, 0x32, 0xb3, 0xe9, 0xe3, 0xfa,
      0x1d, 0xd,  0x29, 0xee, 0xf7, 0x81, 0xff, 0xe,  0xb4, 0x8c, 0x13, 0x49, 0xc1, 0x9,  0x0,  0x6,  0xf7, 0x92, 0x6d,
      0xbc, 0x24, 0x92, 0x12, 0x0,  0x5,  0x11, 0x22, 0x8f, 0xe2, 0x5c, 0x1c, 0x0,  0x11, 0x7b, 0x10, 0x90, 0x53, 0x51,
      0xde, 0x2d, 0x39, 0x7,  0x3b, 0x57, 0xc5, 0x3d, 0x3f, 0xa7, 0xc3, 0x25, 0x2a, 0xc3, 0x2,  0x0,  0x0,  0x17, 0x46,
      0x18, 0x0,  0x0,  0x12, 0xde, 0x1c, 0x0,  0x19, 0x4f, 0x3d, 0x6e, 0x9e, 0x22, 0x88, 0xbc, 0x87, 0x69, 0x8e, 0xf2,
      0xc1, 0x45, 0x5e, 0x98, 0xbe, 0x4c, 0x6c, 0x7d, 0xd9, 0x40, 0xa3, 0x2c, 0x80, 0xbf, 0x22, 0x65, 0x16, 0xb,  0x14,
      0x9,  0x0,  0xc,  0x13, 0x17, 0xf3, 0x29, 0x85, 0x42, 0xcb, 0xa,  0x61, 0x1c, 0xfe, 0xd0, 0x29, 0x8d, 0x13, 0x57,
      0x4a, 0x1f, 0x0,  0x6,  0x9b, 0xca, 0xc7, 0x76, 0x90, 0xed, 0x18, 0x0,  0x0,  0x26, 0x7c, 0x13, 0x62, 0xd0};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x67, 0x9b, 0xcc, 0x72};
  uint8_t bytesprops1[] = {0x7e, 0xb9, 0xd6, 0x67, 0xc4, 0x6e, 0xa2, 0xb2, 0x6a, 0x2,  0xf2, 0x91, 0x82, 0x8c,
                           0xa2, 0x7e, 0x6a, 0xb0, 0xdc, 0x27, 0xc9, 0xa3, 0x15, 0x83, 0xa6, 0x8f, 0x1d};
  uint8_t bytesprops2[] = {0x35, 0x3b, 0x84, 0x7a, 0x55, 0x78, 0xa9, 0x61, 0x7a, 0x50};
  uint8_t bytesprops3[] = {0x8b, 0xe2, 0xf8, 0xd3, 0x52, 0x3d, 0x39, 0xe3, 0x33, 0xc3, 0xf7, 0x2d, 0x3b, 0x40, 0x6b};
  uint8_t bytesprops4[] = {0x71, 0xb9, 0x79, 0x44, 0x4c, 0xb8, 0xbd, 0x3c, 0x44};
  uint8_t bytesprops6[] = {0xfd, 0x2d, 0xa0, 0x50, 0x94, 0x8b, 0x73, 0xb4, 0xf6};
  uint8_t bytesprops5[] = {0x21, 0x34, 0x59, 0x91, 0x50, 0x4, 0x3d, 0xa3, 0x17, 0x2a, 0x70, 0xfd, 0xb0};
  uint8_t bytesprops7[] = {0xe1, 0x45, 0x4,  0x96, 0xe9, 0xe3, 0x72, 0x21, 0x6b, 0x78, 0x3b, 0x28, 0x8e,
                           0x91, 0xd,  0x37, 0xb8, 0x5d, 0x95, 0x88, 0xac, 0x29, 0x27, 0x71, 0x38, 0xda};
  uint8_t bytesprops9[] = {0x6, 0x83, 0x5b, 0x5c, 0xbe, 0xcc, 0x73, 0x37, 0x2, 0x8c, 0xd8};
  uint8_t bytesprops8[] = {0x83, 0xe5, 0x9f, 0xf0, 0xcd, 0xd,  0xf0, 0xb5, 0x36, 0xb3, 0x90,
                           0xff, 0x48, 0xd8, 0x44, 0xa1, 0xeb, 0xcf, 0x15, 0xa1, 0x6c};
  uint8_t bytesprops10[] = {0x7c, 0x18, 0xcd, 0x82, 0x5e, 0xda, 0xee, 0xfd, 0xff, 0xf3, 0x30,
                            0x3f, 0xe5, 0xfe, 0xa9, 0x2b, 0xf6, 0x94, 0xba, 0x72, 0x4};
  uint8_t bytesprops11[] = {0xa4, 0xfe, 0xcb, 0x96, 0x85, 0x59, 0x63, 0x16, 0xa8, 0x6,  0xd8, 0x32, 0xb3,
                            0xe9, 0xe3, 0xfa, 0x1d, 0xd,  0x29, 0xee, 0xf7, 0x81, 0xff, 0xe,  0xb4, 0x8c};
  uint8_t bytesprops12[] = {0xf7, 0x92, 0x6d, 0xbc, 0x24, 0x92};
  uint8_t bytesprops13[] = {0x11, 0x22, 0x8f, 0xe2, 0x5c};
  uint8_t bytesprops14[] = {0x7b, 0x10, 0x90, 0x53, 0x51, 0xde, 0x2d, 0x39, 0x7,
                            0x3b, 0x57, 0xc5, 0x3d, 0x3f, 0xa7, 0xc3, 0x25};
  uint8_t bytesprops15[] = {0x4f, 0x3d, 0x6e, 0x9e, 0x22, 0x88, 0xbc, 0x87, 0x69, 0x8e, 0xf2, 0xc1, 0x45,
                            0x5e, 0x98, 0xbe, 0x4c, 0x6c, 0x7d, 0xd9, 0x40, 0xa3, 0x2c, 0x80, 0xbf};
  uint8_t bytesprops16[] = {0x13, 0x17, 0xf3, 0x29, 0x85, 0x42, 0xcb, 0xa, 0x61, 0x1c, 0xfe, 0xd0};
  uint8_t bytesprops17[] = {0x9b, 0xca, 0xc7, 0x76, 0x90, 0xed};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops5}, .v = {9, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops8}, .v = {11, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18881}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5958}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4830}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25878}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22346}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops17}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9852}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25296}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, 0, 15593, 241, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REL (PubREL 15593 241 [PropSubscriptionIdentifier 15,PropServerReference "g\155\204r",PropContentType
// "~\185\214g\196n\162\178j\STX\242\145\130\140\162~j\176\220'\201\163\NAK\131\166\143\GS",PropSubscriptionIdentifierAvailable
// 86,PropServerReference "5;\132zUx\169azP",PropResponseTopic
// "\139\226\248\211R=9\227\&3\195\247-;@k",PropResponseTopic "q\185yDL\184\189<D",PropUserProperty
// "!4Y\145P\EOT=\163\ETB*p\253\176" "\253-\160P\148\139s\180\246",PropResponseInformation
// "\225E\EOT\150\233\227r!kx;(\142\145\r7\184]\149\136\172)'q8\218",PropUserProperty
// "\131\229\159\240\205\r\240\181\&6\179\144\255H\216D\161\235\207\NAK\161l"
// "\ACK\131[\\\190\204s7\STX\140\216",PropServerReference
// "|\CAN\205\130^\218\238\253\255\243\&0?\229\254\169+\246\148\186r\EOT",PropServerReference
// "\164\254\203\150\133Yc\SYN\168\ACK\216\&2\179\233\227\250\GS\r)\238\247\129\255\SO\180\140",PropServerKeepAlive
// 18881,PropCorrelationData "\247\146m\188$\146",PropAssignedClientIdentifier "\DC1\"\143\226\\",PropServerReference
// "{\DLE\144SQ\222-9\a;W\197=?\167\195%",PropSharedSubscriptionAvailable 195,PropMessageExpiryInterval
// 5958,PropWillDelayInterval 4830,PropServerReference
// "O=n\158\"\136\188\135i\142\242\193E^\152\190Ll}\217@\163,\128\191",PropTopicAliasMaximum
// 25878,PropSubscriptionIdentifier 20,PropCorrelationData
// "\DC3\ETB\243)\133B\203\na\FS\254\208",PropSubscriptionIdentifierAvailable 141,PropServerKeepAlive
// 22346,PropReasonString "\155\202\199v\144\237",PropWillDelayInterval 9852,PropServerKeepAlive 25296])
TEST(PubACKREL5QCTest, Decode24) {
  uint8_t pkt[] = {
      0x62, 0xe5, 0x2,  0x3c, 0xe9, 0xf1, 0xe0, 0x2,  0xb,  0xf,  0x1c, 0x0,  0x4,  0x67, 0x9b, 0xcc, 0x72, 0x3,  0x0,
      0x1b, 0x7e, 0xb9, 0xd6, 0x67, 0xc4, 0x6e, 0xa2, 0xb2, 0x6a, 0x2,  0xf2, 0x91, 0x82, 0x8c, 0xa2, 0x7e, 0x6a, 0xb0,
      0xdc, 0x27, 0xc9, 0xa3, 0x15, 0x83, 0xa6, 0x8f, 0x1d, 0x29, 0x56, 0x1c, 0x0,  0xa,  0x35, 0x3b, 0x84, 0x7a, 0x55,
      0x78, 0xa9, 0x61, 0x7a, 0x50, 0x8,  0x0,  0xf,  0x8b, 0xe2, 0xf8, 0xd3, 0x52, 0x3d, 0x39, 0xe3, 0x33, 0xc3, 0xf7,
      0x2d, 0x3b, 0x40, 0x6b, 0x8,  0x0,  0x9,  0x71, 0xb9, 0x79, 0x44, 0x4c, 0xb8, 0xbd, 0x3c, 0x44, 0x26, 0x0,  0xd,
      0x21, 0x34, 0x59, 0x91, 0x50, 0x4,  0x3d, 0xa3, 0x17, 0x2a, 0x70, 0xfd, 0xb0, 0x0,  0x9,  0xfd, 0x2d, 0xa0, 0x50,
      0x94, 0x8b, 0x73, 0xb4, 0xf6, 0x1a, 0x0,  0x1a, 0xe1, 0x45, 0x4,  0x96, 0xe9, 0xe3, 0x72, 0x21, 0x6b, 0x78, 0x3b,
      0x28, 0x8e, 0x91, 0xd,  0x37, 0xb8, 0x5d, 0x95, 0x88, 0xac, 0x29, 0x27, 0x71, 0x38, 0xda, 0x26, 0x0,  0x15, 0x83,
      0xe5, 0x9f, 0xf0, 0xcd, 0xd,  0xf0, 0xb5, 0x36, 0xb3, 0x90, 0xff, 0x48, 0xd8, 0x44, 0xa1, 0xeb, 0xcf, 0x15, 0xa1,
      0x6c, 0x0,  0xb,  0x6,  0x83, 0x5b, 0x5c, 0xbe, 0xcc, 0x73, 0x37, 0x2,  0x8c, 0xd8, 0x1c, 0x0,  0x15, 0x7c, 0x18,
      0xcd, 0x82, 0x5e, 0xda, 0xee, 0xfd, 0xff, 0xf3, 0x30, 0x3f, 0xe5, 0xfe, 0xa9, 0x2b, 0xf6, 0x94, 0xba, 0x72, 0x4,
      0x1c, 0x0,  0x1a, 0xa4, 0xfe, 0xcb, 0x96, 0x85, 0x59, 0x63, 0x16, 0xa8, 0x6,  0xd8, 0x32, 0xb3, 0xe9, 0xe3, 0xfa,
      0x1d, 0xd,  0x29, 0xee, 0xf7, 0x81, 0xff, 0xe,  0xb4, 0x8c, 0x13, 0x49, 0xc1, 0x9,  0x0,  0x6,  0xf7, 0x92, 0x6d,
      0xbc, 0x24, 0x92, 0x12, 0x0,  0x5,  0x11, 0x22, 0x8f, 0xe2, 0x5c, 0x1c, 0x0,  0x11, 0x7b, 0x10, 0x90, 0x53, 0x51,
      0xde, 0x2d, 0x39, 0x7,  0x3b, 0x57, 0xc5, 0x3d, 0x3f, 0xa7, 0xc3, 0x25, 0x2a, 0xc3, 0x2,  0x0,  0x0,  0x17, 0x46,
      0x18, 0x0,  0x0,  0x12, 0xde, 0x1c, 0x0,  0x19, 0x4f, 0x3d, 0x6e, 0x9e, 0x22, 0x88, 0xbc, 0x87, 0x69, 0x8e, 0xf2,
      0xc1, 0x45, 0x5e, 0x98, 0xbe, 0x4c, 0x6c, 0x7d, 0xd9, 0x40, 0xa3, 0x2c, 0x80, 0xbf, 0x22, 0x65, 0x16, 0xb,  0x14,
      0x9,  0x0,  0xc,  0x13, 0x17, 0xf3, 0x29, 0x85, 0x42, 0xcb, 0xa,  0x61, 0x1c, 0xfe, 0xd0, 0x29, 0x8d, 0x13, 0x57,
      0x4a, 0x1f, 0x0,  0x6,  0x9b, 0xca, 0xc7, 0x76, 0x90, 0xed, 0x18, 0x0,  0x0,  0x26, 0x7c, 0x13, 0x62, 0xd0};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREL_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15593);
  EXPECT_EQ(status, 241);
}

// ACK (PubACK 9801 212 [PropRequestResponseInformation 95,PropTopicAliasMaximum 17145,PropServerReference
// "l\161\186\ETB@\170\253\206\191\180.P\255\EOTa\140\211yM_\139\167v\149(W\133",PropSubscriptionIdentifier
// 9,PropMaximumQoS 184,PropContentType "\252\218\ACK\183qm!\"F3\166r+\230\ESC",PropReasonString "\"",PropResponseTopic
// "G\238\162\243\151V\241\247YEB\EM\138\172\193bU\USQ",PropTopicAlias 22489,PropAuthenticationMethod
// "\154'\144\137\DC3\SOH\DC2\DC4\145\172Q\r\196\169\SO[?\211o\136K\198",PropServerReference
// "\214{\238\SYN:0\233\194\152wdW\240Sa\EOT=\229Trp",PropMaximumQoS 212])
TEST(PubACKACK5QCTest, Encode25) {
  uint8_t pkt[] = {0x40, 0x8e, 0x1,  0x26, 0x49, 0xd4, 0x89, 0x1,  0x19, 0x5f, 0x22, 0x42, 0xf9, 0x1c, 0x0,  0x1b, 0x6c,
                   0xa1, 0xba, 0x17, 0x40, 0xaa, 0xfd, 0xce, 0xbf, 0xb4, 0x2e, 0x50, 0xff, 0x4,  0x61, 0x8c, 0xd3, 0x79,
                   0x4d, 0x5f, 0x8b, 0xa7, 0x76, 0x95, 0x28, 0x57, 0x85, 0xb,  0x9,  0x24, 0xb8, 0x3,  0x0,  0xf,  0xfc,
                   0xda, 0x6,  0xb7, 0x71, 0x6d, 0x21, 0x22, 0x46, 0x33, 0xa6, 0x72, 0x2b, 0xe6, 0x1b, 0x1f, 0x0,  0x1,
                   0x22, 0x8,  0x0,  0x13, 0x47, 0xee, 0xa2, 0xf3, 0x97, 0x56, 0xf1, 0xf7, 0x59, 0x45, 0x42, 0x19, 0x8a,
                   0xac, 0xc1, 0x62, 0x55, 0x1f, 0x51, 0x23, 0x57, 0xd9, 0x15, 0x0,  0x16, 0x9a, 0x27, 0x90, 0x89, 0x13,
                   0x1,  0x12, 0x14, 0x91, 0xac, 0x51, 0xd,  0xc4, 0xa9, 0xe,  0x5b, 0x3f, 0xd3, 0x6f, 0x88, 0x4b, 0xc6,
                   0x1c, 0x0,  0x15, 0xd6, 0x7b, 0xee, 0x16, 0x3a, 0x30, 0xe9, 0xc2, 0x98, 0x77, 0x64, 0x57, 0xf0, 0x53,
                   0x61, 0x4,  0x3d, 0xe5, 0x54, 0x72, 0x70, 0x24, 0xd4};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x6c, 0xa1, 0xba, 0x17, 0x40, 0xaa, 0xfd, 0xce, 0xbf, 0xb4, 0x2e, 0x50, 0xff, 0x4,
                           0x61, 0x8c, 0xd3, 0x79, 0x4d, 0x5f, 0x8b, 0xa7, 0x76, 0x95, 0x28, 0x57, 0x85};
  uint8_t bytesprops1[] = {0xfc, 0xda, 0x6, 0xb7, 0x71, 0x6d, 0x21, 0x22, 0x46, 0x33, 0xa6, 0x72, 0x2b, 0xe6, 0x1b};
  uint8_t bytesprops2[] = {0x22};
  uint8_t bytesprops3[] = {0x47, 0xee, 0xa2, 0xf3, 0x97, 0x56, 0xf1, 0xf7, 0x59, 0x45,
                           0x42, 0x19, 0x8a, 0xac, 0xc1, 0x62, 0x55, 0x1f, 0x51};
  uint8_t bytesprops4[] = {0x9a, 0x27, 0x90, 0x89, 0x13, 0x1,  0x12, 0x14, 0x91, 0xac, 0x51,
                           0xd,  0xc4, 0xa9, 0xe,  0x5b, 0x3f, 0xd3, 0x6f, 0x88, 0x4b, 0xc6};
  uint8_t bytesprops5[] = {0xd6, 0x7b, 0xee, 0x16, 0x3a, 0x30, 0xe9, 0xc2, 0x98, 0x77, 0x64,
                           0x57, 0xf0, 0x53, 0x61, 0x4,  0x3d, 0xe5, 0x54, 0x72, 0x70};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17145}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22489}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 212}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 9801, 212, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 9801 212 [PropRequestResponseInformation 95,PropTopicAliasMaximum 17145,PropServerReference
// "l\161\186\ETB@\170\253\206\191\180.P\255\EOTa\140\211yM_\139\167v\149(W\133",PropSubscriptionIdentifier
// 9,PropMaximumQoS 184,PropContentType "\252\218\ACK\183qm!\"F3\166r+\230\ESC",PropReasonString "\"",PropResponseTopic
// "G\238\162\243\151V\241\247YEB\EM\138\172\193bU\USQ",PropTopicAlias 22489,PropAuthenticationMethod
// "\154'\144\137\DC3\SOH\DC2\DC4\145\172Q\r\196\169\SO[?\211o\136K\198",PropServerReference
// "\214{\238\SYN:0\233\194\152wdW\240Sa\EOT=\229Trp",PropMaximumQoS 212])
TEST(PubACKACK5QCTest, Decode25) {
  uint8_t pkt[] = {0x40, 0x8e, 0x1,  0x26, 0x49, 0xd4, 0x89, 0x1,  0x19, 0x5f, 0x22, 0x42, 0xf9, 0x1c, 0x0,  0x1b, 0x6c,
                   0xa1, 0xba, 0x17, 0x40, 0xaa, 0xfd, 0xce, 0xbf, 0xb4, 0x2e, 0x50, 0xff, 0x4,  0x61, 0x8c, 0xd3, 0x79,
                   0x4d, 0x5f, 0x8b, 0xa7, 0x76, 0x95, 0x28, 0x57, 0x85, 0xb,  0x9,  0x24, 0xb8, 0x3,  0x0,  0xf,  0xfc,
                   0xda, 0x6,  0xb7, 0x71, 0x6d, 0x21, 0x22, 0x46, 0x33, 0xa6, 0x72, 0x2b, 0xe6, 0x1b, 0x1f, 0x0,  0x1,
                   0x22, 0x8,  0x0,  0x13, 0x47, 0xee, 0xa2, 0xf3, 0x97, 0x56, 0xf1, 0xf7, 0x59, 0x45, 0x42, 0x19, 0x8a,
                   0xac, 0xc1, 0x62, 0x55, 0x1f, 0x51, 0x23, 0x57, 0xd9, 0x15, 0x0,  0x16, 0x9a, 0x27, 0x90, 0x89, 0x13,
                   0x1,  0x12, 0x14, 0x91, 0xac, 0x51, 0xd,  0xc4, 0xa9, 0xe,  0x5b, 0x3f, 0xd3, 0x6f, 0x88, 0x4b, 0xc6,
                   0x1c, 0x0,  0x15, 0xd6, 0x7b, 0xee, 0x16, 0x3a, 0x30, 0xe9, 0xc2, 0x98, 0x77, 0x64, 0x57, 0xf0, 0x53,
                   0x61, 0x4,  0x3d, 0xe5, 0x54, 0x72, 0x70, 0x24, 0xd4};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9801);
  EXPECT_EQ(status, 212);
}

// ACK (PubACK 19499 97 [PropSubscriptionIdentifierAvailable 13,PropSessionExpiryInterval 1817,PropContentType
// "H\v",PropMessageExpiryInterval 381,PropContentType "5",PropCorrelationData
// "[\249\213jv\149e\ENQ+\149.\152\200",PropAssignedClientIdentifier
// "\187{h\152\223\DC1\188_\201\131Eu\180\158\156\195^",PropAuthenticationMethod
// "1\140o\236\220H\188\207\US\203",PropRequestProblemInformation 228,PropUserProperty
// "$q\DC2\ACK\244\186s\237\180\163\&5\255\218\251\253\134\163\202\CAN\182\196\ESC\244\205$s"
// "\ESC\ACK\US=t\ESC/&\225+",PropTopicAlias 9888,PropMessageExpiryInterval 18438,PropServerReference
// "\202j\141\155\157\EOT9\171\220\231-\254\FS#@T\178j\240\165.\237b",PropRetainAvailable
// 164,PropRequestProblemInformation 220,PropRequestResponseInformation 86,PropMessageExpiryInterval
// 29647,PropPayloadFormatIndicator 168,PropReasonString "L",PropMaximumQoS 156,PropTopicAlias
// 300,PropPayloadFormatIndicator 9,PropPayloadFormatIndicator 171,PropUserProperty "\EOT\232\151\201\186)"
// "\219\128g\197Q\190fhro\186\ACK\139YA"])
TEST(PubACKACK5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x40, 0xcc, 0x1,  0x4c, 0x2b, 0x61, 0xc7, 0x1,  0x29, 0xd,  0x11, 0x0,  0x0,  0x7,  0x19, 0x3,  0x0,  0x2,  0x48,
      0xb,  0x2,  0x0,  0x0,  0x1,  0x7d, 0x3,  0x0,  0x1,  0x35, 0x9,  0x0,  0xd,  0x5b, 0xf9, 0xd5, 0x6a, 0x76, 0x95,
      0x65, 0x5,  0x2b, 0x95, 0x2e, 0x98, 0xc8, 0x12, 0x0,  0x11, 0xbb, 0x7b, 0x68, 0x98, 0xdf, 0x11, 0xbc, 0x5f, 0xc9,
      0x83, 0x45, 0x75, 0xb4, 0x9e, 0x9c, 0xc3, 0x5e, 0x15, 0x0,  0xa,  0x31, 0x8c, 0x6f, 0xec, 0xdc, 0x48, 0xbc, 0xcf,
      0x1f, 0xcb, 0x17, 0xe4, 0x26, 0x0,  0x1a, 0x24, 0x71, 0x12, 0x6,  0xf4, 0xba, 0x73, 0xed, 0xb4, 0xa3, 0x35, 0xff,
      0xda, 0xfb, 0xfd, 0x86, 0xa3, 0xca, 0x18, 0xb6, 0xc4, 0x1b, 0xf4, 0xcd, 0x24, 0x73, 0x0,  0xa,  0x1b, 0x6,  0x1f,
      0x3d, 0x74, 0x1b, 0x2f, 0x26, 0xe1, 0x2b, 0x23, 0x26, 0xa0, 0x2,  0x0,  0x0,  0x48, 0x6,  0x1c, 0x0,  0x17, 0xca,
      0x6a, 0x8d, 0x9b, 0x9d, 0x4,  0x39, 0xab, 0xdc, 0xe7, 0x2d, 0xfe, 0x1c, 0x23, 0x40, 0x54, 0xb2, 0x6a, 0xf0, 0xa5,
      0x2e, 0xed, 0x62, 0x25, 0xa4, 0x17, 0xdc, 0x19, 0x56, 0x2,  0x0,  0x0,  0x73, 0xcf, 0x1,  0xa8, 0x1f, 0x0,  0x1,
      0x4c, 0x24, 0x9c, 0x23, 0x1,  0x2c, 0x1,  0x9,  0x1,  0xab, 0x26, 0x0,  0x6,  0x4,  0xe8, 0x97, 0xc9, 0xba, 0x29,
      0x0,  0xf,  0xdb, 0x80, 0x67, 0xc5, 0x51, 0xbe, 0x66, 0x68, 0x72, 0x6f, 0xba, 0x6,  0x8b, 0x59, 0x41};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x48, 0xb};
  uint8_t bytesprops1[] = {0x35};
  uint8_t bytesprops2[] = {0x5b, 0xf9, 0xd5, 0x6a, 0x76, 0x95, 0x65, 0x5, 0x2b, 0x95, 0x2e, 0x98, 0xc8};
  uint8_t bytesprops3[] = {0xbb, 0x7b, 0x68, 0x98, 0xdf, 0x11, 0xbc, 0x5f, 0xc9,
                           0x83, 0x45, 0x75, 0xb4, 0x9e, 0x9c, 0xc3, 0x5e};
  uint8_t bytesprops4[] = {0x31, 0x8c, 0x6f, 0xec, 0xdc, 0x48, 0xbc, 0xcf, 0x1f, 0xcb};
  uint8_t bytesprops6[] = {0x1b, 0x6, 0x1f, 0x3d, 0x74, 0x1b, 0x2f, 0x26, 0xe1, 0x2b};
  uint8_t bytesprops5[] = {0x24, 0x71, 0x12, 0x6,  0xf4, 0xba, 0x73, 0xed, 0xb4, 0xa3, 0x35, 0xff, 0xda,
                           0xfb, 0xfd, 0x86, 0xa3, 0xca, 0x18, 0xb6, 0xc4, 0x1b, 0xf4, 0xcd, 0x24, 0x73};
  uint8_t bytesprops7[] = {0xca, 0x6a, 0x8d, 0x9b, 0x9d, 0x4,  0x39, 0xab, 0xdc, 0xe7, 0x2d, 0xfe,
                           0x1c, 0x23, 0x40, 0x54, 0xb2, 0x6a, 0xf0, 0xa5, 0x2e, 0xed, 0x62};
  uint8_t bytesprops8[] = {0x4c};
  uint8_t bytesprops10[] = {0xdb, 0x80, 0x67, 0xc5, 0x51, 0xbe, 0x66, 0x68, 0x72, 0x6f, 0xba, 0x6, 0x8b, 0x59, 0x41};
  uint8_t bytesprops9[] = {0x4, 0xe8, 0x97, 0xc9, 0xba, 0x29};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1817}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 381}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops5}, .v = {10, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9888}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18438}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29647}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 300}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops9}, .v = {15, (char*)&bytesprops10}}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, 0, 19499, 97, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ACK (PubACK 19499 97 [PropSubscriptionIdentifierAvailable 13,PropSessionExpiryInterval 1817,PropContentType
// "H\v",PropMessageExpiryInterval 381,PropContentType "5",PropCorrelationData
// "[\249\213jv\149e\ENQ+\149.\152\200",PropAssignedClientIdentifier
// "\187{h\152\223\DC1\188_\201\131Eu\180\158\156\195^",PropAuthenticationMethod
// "1\140o\236\220H\188\207\US\203",PropRequestProblemInformation 228,PropUserProperty
// "$q\DC2\ACK\244\186s\237\180\163\&5\255\218\251\253\134\163\202\CAN\182\196\ESC\244\205$s"
// "\ESC\ACK\US=t\ESC/&\225+",PropTopicAlias 9888,PropMessageExpiryInterval 18438,PropServerReference
// "\202j\141\155\157\EOT9\171\220\231-\254\FS#@T\178j\240\165.\237b",PropRetainAvailable
// 164,PropRequestProblemInformation 220,PropRequestResponseInformation 86,PropMessageExpiryInterval
// 29647,PropPayloadFormatIndicator 168,PropReasonString "L",PropMaximumQoS 156,PropTopicAlias
// 300,PropPayloadFormatIndicator 9,PropPayloadFormatIndicator 171,PropUserProperty "\EOT\232\151\201\186)"
// "\219\128g\197Q\190fhro\186\ACK\139YA"])
TEST(PubACKACK5QCTest, Decode26) {
  uint8_t pkt[] = {
      0x40, 0xcc, 0x1,  0x4c, 0x2b, 0x61, 0xc7, 0x1,  0x29, 0xd,  0x11, 0x0,  0x0,  0x7,  0x19, 0x3,  0x0,  0x2,  0x48,
      0xb,  0x2,  0x0,  0x0,  0x1,  0x7d, 0x3,  0x0,  0x1,  0x35, 0x9,  0x0,  0xd,  0x5b, 0xf9, 0xd5, 0x6a, 0x76, 0x95,
      0x65, 0x5,  0x2b, 0x95, 0x2e, 0x98, 0xc8, 0x12, 0x0,  0x11, 0xbb, 0x7b, 0x68, 0x98, 0xdf, 0x11, 0xbc, 0x5f, 0xc9,
      0x83, 0x45, 0x75, 0xb4, 0x9e, 0x9c, 0xc3, 0x5e, 0x15, 0x0,  0xa,  0x31, 0x8c, 0x6f, 0xec, 0xdc, 0x48, 0xbc, 0xcf,
      0x1f, 0xcb, 0x17, 0xe4, 0x26, 0x0,  0x1a, 0x24, 0x71, 0x12, 0x6,  0xf4, 0xba, 0x73, 0xed, 0xb4, 0xa3, 0x35, 0xff,
      0xda, 0xfb, 0xfd, 0x86, 0xa3, 0xca, 0x18, 0xb6, 0xc4, 0x1b, 0xf4, 0xcd, 0x24, 0x73, 0x0,  0xa,  0x1b, 0x6,  0x1f,
      0x3d, 0x74, 0x1b, 0x2f, 0x26, 0xe1, 0x2b, 0x23, 0x26, 0xa0, 0x2,  0x0,  0x0,  0x48, 0x6,  0x1c, 0x0,  0x17, 0xca,
      0x6a, 0x8d, 0x9b, 0x9d, 0x4,  0x39, 0xab, 0xdc, 0xe7, 0x2d, 0xfe, 0x1c, 0x23, 0x40, 0x54, 0xb2, 0x6a, 0xf0, 0xa5,
      0x2e, 0xed, 0x62, 0x25, 0xa4, 0x17, 0xdc, 0x19, 0x56, 0x2,  0x0,  0x0,  0x73, 0xcf, 0x1,  0xa8, 0x1f, 0x0,  0x1,
      0x4c, 0x24, 0x9c, 0x23, 0x1,  0x2c, 0x1,  0x9,  0x1,  0xab, 0x26, 0x0,  0x6,  0x4,  0xe8, 0x97, 0xc9, 0xba, 0x29,
      0x0,  0xf,  0xdb, 0x80, 0x67, 0xc5, 0x51, 0xbe, 0x66, 0x68, 0x72, 0x6f, 0xba, 0x6,  0x8b, 0x59, 0x41};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBACK_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19499);
  EXPECT_EQ(status, 97);
}

// COMP (PubCOMP 13110 221 [PropReceiveMaximum 13389,PropMaximumQoS 104,PropResponseTopic
// "\167\204\129\136\201\EM\167\219\SYN\212\192\232\SOnI\132",PropWildcardSubscriptionAvailable
// 49,PropSharedSubscriptionAvailable 241,PropSharedSubscriptionAvailable 113,PropReceiveMaximum
// 11896,PropAuthenticationData "z\250^:\194\184\143\221\US8\150\143\164\227",PropRequestResponseInformation
// 55,PropPayloadFormatIndicator 168,PropWillDelayInterval 15344,PropReceiveMaximum 14492,PropRequestProblemInformation
// 195,PropReceiveMaximum 13118,PropTopicAliasMaximum 32101,PropSubscriptionIdentifier 13,PropAssignedClientIdentifier
// "\250x\156J\243\200\&5\DC1T\161\vl\215\131\230\180\182\DEL\173\234lO5",PropMaximumQoS 27,PropMaximumQoS
// 221,PropSessionExpiryInterval 6935,PropTopicAliasMaximum 3750])
TEST(PubACKCOMP5QCTest, Encode27) {
  uint8_t pkt[] = {0x70, 0x72, 0x33, 0x36, 0xdd, 0x6e, 0x21, 0x34, 0x4d, 0x24, 0x68, 0x8,  0x0,  0x10, 0xa7, 0xcc, 0x81,
                   0x88, 0xc9, 0x19, 0xa7, 0xdb, 0x16, 0xd4, 0xc0, 0xe8, 0xe,  0x6e, 0x49, 0x84, 0x28, 0x31, 0x2a, 0xf1,
                   0x2a, 0x71, 0x21, 0x2e, 0x78, 0x16, 0x0,  0xe,  0x7a, 0xfa, 0x5e, 0x3a, 0xc2, 0xb8, 0x8f, 0xdd, 0x1f,
                   0x38, 0x96, 0x8f, 0xa4, 0xe3, 0x19, 0x37, 0x1,  0xa8, 0x18, 0x0,  0x0,  0x3b, 0xf0, 0x21, 0x38, 0x9c,
                   0x17, 0xc3, 0x21, 0x33, 0x3e, 0x22, 0x7d, 0x65, 0xb,  0xd,  0x12, 0x0,  0x17, 0xfa, 0x78, 0x9c, 0x4a,
                   0xf3, 0xc8, 0x35, 0x11, 0x54, 0xa1, 0xb,  0x6c, 0xd7, 0x83, 0xe6, 0xb4, 0xb6, 0x7f, 0xad, 0xea, 0x6c,
                   0x4f, 0x35, 0x24, 0x1b, 0x24, 0xdd, 0x11, 0x0,  0x0,  0x1b, 0x17, 0x22, 0xe,  0xa6};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xa7, 0xcc, 0x81, 0x88, 0xc9, 0x19, 0xa7, 0xdb,
                           0x16, 0xd4, 0xc0, 0xe8, 0xe,  0x6e, 0x49, 0x84};
  uint8_t bytesprops1[] = {0x7a, 0xfa, 0x5e, 0x3a, 0xc2, 0xb8, 0x8f, 0xdd, 0x1f, 0x38, 0x96, 0x8f, 0xa4, 0xe3};
  uint8_t bytesprops2[] = {0xfa, 0x78, 0x9c, 0x4a, 0xf3, 0xc8, 0x35, 0x11, 0x54, 0xa1, 0xb, 0x6c,
                           0xd7, 0x83, 0xe6, 0xb4, 0xb6, 0x7f, 0xad, 0xea, 0x6c, 0x4f, 0x35};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13389}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11896}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15344}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14492}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13118}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32101}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6935}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3750}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, 0, 13110, 221, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 13110 221 [PropReceiveMaximum 13389,PropMaximumQoS 104,PropResponseTopic
// "\167\204\129\136\201\EM\167\219\SYN\212\192\232\SOnI\132",PropWildcardSubscriptionAvailable
// 49,PropSharedSubscriptionAvailable 241,PropSharedSubscriptionAvailable 113,PropReceiveMaximum
// 11896,PropAuthenticationData "z\250^:\194\184\143\221\US8\150\143\164\227",PropRequestResponseInformation
// 55,PropPayloadFormatIndicator 168,PropWillDelayInterval 15344,PropReceiveMaximum 14492,PropRequestProblemInformation
// 195,PropReceiveMaximum 13118,PropTopicAliasMaximum 32101,PropSubscriptionIdentifier 13,PropAssignedClientIdentifier
// "\250x\156J\243\200\&5\DC1T\161\vl\215\131\230\180\182\DEL\173\234lO5",PropMaximumQoS 27,PropMaximumQoS
// 221,PropSessionExpiryInterval 6935,PropTopicAliasMaximum 3750])
TEST(PubACKCOMP5QCTest, Decode27) {
  uint8_t pkt[] = {0x70, 0x72, 0x33, 0x36, 0xdd, 0x6e, 0x21, 0x34, 0x4d, 0x24, 0x68, 0x8,  0x0,  0x10, 0xa7, 0xcc, 0x81,
                   0x88, 0xc9, 0x19, 0xa7, 0xdb, 0x16, 0xd4, 0xc0, 0xe8, 0xe,  0x6e, 0x49, 0x84, 0x28, 0x31, 0x2a, 0xf1,
                   0x2a, 0x71, 0x21, 0x2e, 0x78, 0x16, 0x0,  0xe,  0x7a, 0xfa, 0x5e, 0x3a, 0xc2, 0xb8, 0x8f, 0xdd, 0x1f,
                   0x38, 0x96, 0x8f, 0xa4, 0xe3, 0x19, 0x37, 0x1,  0xa8, 0x18, 0x0,  0x0,  0x3b, 0xf0, 0x21, 0x38, 0x9c,
                   0x17, 0xc3, 0x21, 0x33, 0x3e, 0x22, 0x7d, 0x65, 0xb,  0xd,  0x12, 0x0,  0x17, 0xfa, 0x78, 0x9c, 0x4a,
                   0xf3, 0xc8, 0x35, 0x11, 0x54, 0xa1, 0xb,  0x6c, 0xd7, 0x83, 0xe6, 0xb4, 0xb6, 0x7f, 0xad, 0xea, 0x6c,
                   0x4f, 0x35, 0x24, 0x1b, 0x24, 0xdd, 0x11, 0x0,  0x0,  0x1b, 0x17, 0x22, 0xe,  0xa6};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13110);
  EXPECT_EQ(status, 221);
}

// REC (PubREC 25388 230 [PropMaximumQoS 62,PropCorrelationData "\185\195",PropMessageExpiryInterval
// 31098,PropServerReference "",PropSubscriptionIdentifier 4,PropResponseTopic
// "GA\182z\195%b\234i\155\176\b\ETB+\149",PropServerReference "1\161\164=",PropSessionExpiryInterval
// 30227,PropResponseTopic "\240i",PropResponseTopic
// "e\EOT\188\148`!\179\194\&2n\245w\150\250(\140\231\205'\ENQ\DC3",PropSubscriptionIdentifierAvailable 57])
TEST(PubACKREC5QCTest, Encode28) {
  uint8_t pkt[] = {0x50, 0x52, 0x63, 0x2c, 0xe6, 0x4e, 0x24, 0x3e, 0x9,  0x0,  0x2,  0xb9, 0xc3, 0x2,  0x0,  0x0,  0x79,
                   0x7a, 0x1c, 0x0,  0x0,  0xb,  0x4,  0x8,  0x0,  0xf,  0x47, 0x41, 0xb6, 0x7a, 0xc3, 0x25, 0x62, 0xea,
                   0x69, 0x9b, 0xb0, 0x8,  0x17, 0x2b, 0x95, 0x1c, 0x0,  0x4,  0x31, 0xa1, 0xa4, 0x3d, 0x11, 0x0,  0x0,
                   0x76, 0x13, 0x8,  0x0,  0x2,  0xf0, 0x69, 0x8,  0x0,  0x15, 0x65, 0x4,  0xbc, 0x94, 0x60, 0x21, 0xb3,
                   0xc2, 0x32, 0x6e, 0xf5, 0x77, 0x96, 0xfa, 0x28, 0x8c, 0xe7, 0xcd, 0x27, 0x5,  0x13, 0x29, 0x39};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0xb9, 0xc3};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x47, 0x41, 0xb6, 0x7a, 0xc3, 0x25, 0x62, 0xea, 0x69, 0x9b, 0xb0, 0x8, 0x17, 0x2b, 0x95};
  uint8_t bytesprops3[] = {0x31, 0xa1, 0xa4, 0x3d};
  uint8_t bytesprops4[] = {0xf0, 0x69};
  uint8_t bytesprops5[] = {0x65, 0x4,  0xbc, 0x94, 0x60, 0x21, 0xb3, 0xc2, 0x32, 0x6e, 0xf5,
                           0x77, 0x96, 0xfa, 0x28, 0x8c, 0xe7, 0xcd, 0x27, 0x5,  0x13};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31098}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30227}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 57}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBREC_PACKET, 0, 25388, 230, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// REC (PubREC 25388 230 [PropMaximumQoS 62,PropCorrelationData "\185\195",PropMessageExpiryInterval
// 31098,PropServerReference "",PropSubscriptionIdentifier 4,PropResponseTopic
// "GA\182z\195%b\234i\155\176\b\ETB+\149",PropServerReference "1\161\164=",PropSessionExpiryInterval
// 30227,PropResponseTopic "\240i",PropResponseTopic
// "e\EOT\188\148`!\179\194\&2n\245w\150\250(\140\231\205'\ENQ\DC3",PropSubscriptionIdentifierAvailable 57])
TEST(PubACKREC5QCTest, Decode28) {
  uint8_t pkt[] = {0x50, 0x52, 0x63, 0x2c, 0xe6, 0x4e, 0x24, 0x3e, 0x9,  0x0,  0x2,  0xb9, 0xc3, 0x2,  0x0,  0x0,  0x79,
                   0x7a, 0x1c, 0x0,  0x0,  0xb,  0x4,  0x8,  0x0,  0xf,  0x47, 0x41, 0xb6, 0x7a, 0xc3, 0x25, 0x62, 0xea,
                   0x69, 0x9b, 0xb0, 0x8,  0x17, 0x2b, 0x95, 0x1c, 0x0,  0x4,  0x31, 0xa1, 0xa4, 0x3d, 0x11, 0x0,  0x0,
                   0x76, 0x13, 0x8,  0x0,  0x2,  0xf0, 0x69, 0x8,  0x0,  0x15, 0x65, 0x4,  0xbc, 0x94, 0x60, 0x21, 0xb3,
                   0xc2, 0x32, 0x6e, 0xf5, 0x77, 0x96, 0xfa, 0x28, 0x8c, 0xe7, 0xcd, 0x27, 0x5,  0x13, 0x29, 0x39};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBREC_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25388);
  EXPECT_EQ(status, 230);
}

// COMP (PubCOMP 5812 238 [PropAuthenticationData "P9\\\230\247",PropSubscriptionIdentifier
// 2,PropSubscriptionIdentifierAvailable 110])
TEST(PubACKCOMP5QCTest, Encode29) {
  uint8_t pkt[] = {0x70, 0x10, 0x16, 0xb4, 0xee, 0xc, 0x16, 0x0,  0x5,
                   0x50, 0x39, 0x5c, 0xe6, 0xf7, 0xb, 0x2,  0x29, 0x6e};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x50, 0x39, 0x5c, 0xe6, 0xf7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 2}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 110}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, 0, 5812, 238, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 5812 238 [PropAuthenticationData "P9\\\230\247",PropSubscriptionIdentifier
// 2,PropSubscriptionIdentifierAvailable 110])
TEST(PubACKCOMP5QCTest, Decode29) {
  uint8_t pkt[] = {0x70, 0x10, 0x16, 0xb4, 0xee, 0xc, 0x16, 0x0,  0x5,
                   0x50, 0x39, 0x5c, 0xe6, 0xf7, 0xb, 0x2,  0x29, 0x6e};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5812);
  EXPECT_EQ(status, 238);
}

// COMP (PubCOMP 30696 65 [PropServerKeepAlive 9554,PropContentType "\ESC+\236\172p",PropMaximumPacketSize
// 29701,PropAuthenticationMethod
// "h\254\204\141\200\234\188\&8\242\246\212*B\RS\EM\246\r\168\202\ACKm",PropWillDelayInterval 4219,PropRetainAvailable
// 71,PropRetainAvailable 100,PropMaximumQoS 214,PropSessionExpiryInterval 7076,PropSharedSubscriptionAvailable
// 145,PropServerReference "r\183\253C\157\200k \249w\164\147e=x\179T\134[$\240o\198K",PropRetainAvailable
// 98,PropPayloadFormatIndicator 154,PropServerKeepAlive 31424,PropRequestProblemInformation
// 217,PropSharedSubscriptionAvailable 181,PropPayloadFormatIndicator 219,PropMessageExpiryInterval
// 31400,PropRequestProblemInformation 53,PropServerKeepAlive 18882,PropRequestProblemInformation
// 36,PropSubscriptionIdentifierAvailable 44,PropServerKeepAlive 17813,PropRetainAvailable 254,PropTopicAlias
// 5704,PropAssignedClientIdentifier "|\210\200Vg\247i\133\SUB\221\168y\255",PropMaximumQoS
// 72,PropWildcardSubscriptionAvailable 227,PropSessionExpiryInterval 8466])
TEST(PubACKCOMP5QCTest, Encode30) {
  uint8_t pkt[] = {0x70, 0x96, 0x1,  0x77, 0xe8, 0x41, 0x91, 0x1,  0x13, 0x25, 0x52, 0x3,  0x0,  0x5,  0x1b, 0x2b,
                   0xec, 0xac, 0x70, 0x27, 0x0,  0x0,  0x74, 0x5,  0x15, 0x0,  0x15, 0x68, 0xfe, 0xcc, 0x8d, 0xc8,
                   0xea, 0xbc, 0x38, 0xf2, 0xf6, 0xd4, 0x2a, 0x42, 0x1e, 0x19, 0xf6, 0xd,  0xa8, 0xca, 0x6,  0x6d,
                   0x18, 0x0,  0x0,  0x10, 0x7b, 0x25, 0x47, 0x25, 0x64, 0x24, 0xd6, 0x11, 0x0,  0x0,  0x1b, 0xa4,
                   0x2a, 0x91, 0x1c, 0x0,  0x18, 0x72, 0xb7, 0xfd, 0x43, 0x9d, 0xc8, 0x6b, 0x20, 0xf9, 0x77, 0xa4,
                   0x93, 0x65, 0x3d, 0x78, 0xb3, 0x54, 0x86, 0x5b, 0x24, 0xf0, 0x6f, 0xc6, 0x4b, 0x25, 0x62, 0x1,
                   0x9a, 0x13, 0x7a, 0xc0, 0x17, 0xd9, 0x2a, 0xb5, 0x1,  0xdb, 0x2,  0x0,  0x0,  0x7a, 0xa8, 0x17,
                   0x35, 0x13, 0x49, 0xc2, 0x17, 0x24, 0x29, 0x2c, 0x13, 0x45, 0x95, 0x25, 0xfe, 0x23, 0x16, 0x48,
                   0x12, 0x0,  0xd,  0x7c, 0xd2, 0xc8, 0x56, 0x67, 0xf7, 0x69, 0x85, 0x1a, 0xdd, 0xa8, 0x79, 0xff,
                   0x24, 0x48, 0x28, 0xe3, 0x11, 0x0,  0x0,  0x21, 0x12};
  uint8_t buf[sizeof(pkt) + 10];
  uint8_t bytesprops0[] = {0x1b, 0x2b, 0xec, 0xac, 0x70};
  uint8_t bytesprops1[] = {0x68, 0xfe, 0xcc, 0x8d, 0xc8, 0xea, 0xbc, 0x38, 0xf2, 0xf6, 0xd4,
                           0x2a, 0x42, 0x1e, 0x19, 0xf6, 0xd,  0xa8, 0xca, 0x6,  0x6d};
  uint8_t bytesprops2[] = {0x72, 0xb7, 0xfd, 0x43, 0x9d, 0xc8, 0x6b, 0x20, 0xf9, 0x77, 0xa4, 0x93,
                           0x65, 0x3d, 0x78, 0xb3, 0x54, 0x86, 0x5b, 0x24, 0xf0, 0x6f, 0xc6, 0x4b};
  uint8_t bytesprops3[] = {0x7c, 0xd2, 0xc8, 0x56, 0x67, 0xf7, 0x69, 0x85, 0x1a, 0xdd, 0xa8, 0x79, 0xff};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9554}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29701}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4219}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7076}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31424}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31400}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18882}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17813}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5704}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8466}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len;
  lwmqtt_err_t err =
      lwmqtt_encode_ack(buf, sizeof(buf), &len, LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, 0, 30696, 65, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// COMP (PubCOMP 30696 65 [PropServerKeepAlive 9554,PropContentType "\ESC+\236\172p",PropMaximumPacketSize
// 29701,PropAuthenticationMethod
// "h\254\204\141\200\234\188\&8\242\246\212*B\RS\EM\246\r\168\202\ACKm",PropWillDelayInterval 4219,PropRetainAvailable
// 71,PropRetainAvailable 100,PropMaximumQoS 214,PropSessionExpiryInterval 7076,PropSharedSubscriptionAvailable
// 145,PropServerReference "r\183\253C\157\200k \249w\164\147e=x\179T\134[$\240o\198K",PropRetainAvailable
// 98,PropPayloadFormatIndicator 154,PropServerKeepAlive 31424,PropRequestProblemInformation
// 217,PropSharedSubscriptionAvailable 181,PropPayloadFormatIndicator 219,PropMessageExpiryInterval
// 31400,PropRequestProblemInformation 53,PropServerKeepAlive 18882,PropRequestProblemInformation
// 36,PropSubscriptionIdentifierAvailable 44,PropServerKeepAlive 17813,PropRetainAvailable 254,PropTopicAlias
// 5704,PropAssignedClientIdentifier "|\210\200Vg\247i\133\SUB\221\168y\255",PropMaximumQoS
// 72,PropWildcardSubscriptionAvailable 227,PropSessionExpiryInterval 8466])
TEST(PubACKCOMP5QCTest, Decode30) {
  uint8_t pkt[] = {0x70, 0x96, 0x1,  0x77, 0xe8, 0x41, 0x91, 0x1,  0x13, 0x25, 0x52, 0x3,  0x0,  0x5,  0x1b, 0x2b,
                   0xec, 0xac, 0x70, 0x27, 0x0,  0x0,  0x74, 0x5,  0x15, 0x0,  0x15, 0x68, 0xfe, 0xcc, 0x8d, 0xc8,
                   0xea, 0xbc, 0x38, 0xf2, 0xf6, 0xd4, 0x2a, 0x42, 0x1e, 0x19, 0xf6, 0xd,  0xa8, 0xca, 0x6,  0x6d,
                   0x18, 0x0,  0x0,  0x10, 0x7b, 0x25, 0x47, 0x25, 0x64, 0x24, 0xd6, 0x11, 0x0,  0x0,  0x1b, 0xa4,
                   0x2a, 0x91, 0x1c, 0x0,  0x18, 0x72, 0xb7, 0xfd, 0x43, 0x9d, 0xc8, 0x6b, 0x20, 0xf9, 0x77, 0xa4,
                   0x93, 0x65, 0x3d, 0x78, 0xb3, 0x54, 0x86, 0x5b, 0x24, 0xf0, 0x6f, 0xc6, 0x4b, 0x25, 0x62, 0x1,
                   0x9a, 0x13, 0x7a, 0xc0, 0x17, 0xd9, 0x2a, 0xb5, 0x1,  0xdb, 0x2,  0x0,  0x0,  0x7a, 0xa8, 0x17,
                   0x35, 0x13, 0x49, 0xc2, 0x17, 0x24, 0x29, 0x2c, 0x13, 0x45, 0x95, 0x25, 0xfe, 0x23, 0x16, 0x48,
                   0x12, 0x0,  0xd,  0x7c, 0xd2, 0xc8, 0x56, 0x67, 0xf7, 0x69, 0x85, 0x1a, 0xdd, 0xa8, 0x79, 0xff,
                   0x24, 0x48, 0x28, 0xe3, 0x11, 0x0,  0x0,  0x21, 0x12};
  uint16_t packet_id;
  uint8_t status;
  lwmqtt_serialized_properties_t props;
  bool dup;
  lwmqtt_err_t err =
      lwmqtt_decode_ack(pkt, sizeof(pkt), LWMQTT_MQTT5, LWMQTT_PUBCOMP_PACKET, &dup, &packet_id, &status, &props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 30696);
  EXPECT_EQ(status, 65);
}

// ConnectRequest {_username = Just "]k\133\158\155\DC3\CANdB\149\244\NAKV\174", _password = Just
// "\243e\SUB\196D\v\196W8P\245\&6", _lastWill = Nothing, _cleanSession = True, _keepAlive = 1258, _connID =
// "q\SOH\220\128\ncN%\188\&7\248FP@\170\NUL\DELN\194\221o", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x3f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x4,  0xea, 0x0,  0x15, 0x71, 0x1,  0xdc,
                   0x80, 0xa,  0x63, 0x4e, 0x25, 0xbc, 0x37, 0xf8, 0x46, 0x50, 0x40, 0xaa, 0x0,  0x7f, 0x4e, 0xc2, 0xdd,
                   0x6f, 0x0,  0xe,  0x5d, 0x6b, 0x85, 0x9e, 0x9b, 0x13, 0x18, 0x64, 0x42, 0x95, 0xf4, 0x15, 0x56, 0xae,
                   0x0,  0xc,  0xf3, 0x65, 0x1a, 0xc4, 0x44, 0xb,  0xc4, 0x57, 0x38, 0x50, 0xf5, 0x36};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1258;
  uint8_t client_id_bytes[] = {0x71, 0x1,  0xdc, 0x80, 0xa, 0x63, 0x4e, 0x25, 0xbc, 0x37, 0xf8,
                               0x46, 0x50, 0x40, 0xaa, 0x0, 0x7f, 0x4e, 0xc2, 0xdd, 0x6f};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5d, 0x6b, 0x85, 0x9e, 0x9b, 0x13, 0x18, 0x64, 0x42, 0x95, 0xf4, 0x15, 0x56, 0xae};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf3, 0x65, 0x1a, 0xc4, 0x44, 0xb, 0xc4, 0x57, 0x38, 0x50, 0xf5, 0x36};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "G>+\146\187X\SUB\205\220Z.\247\207\STX", _password = Just "l\254", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "H\158\252\SO\244\128\177\DC3\140m\154C\228\255\209\SO\252\215Wt\129t}\131", _willMsg =
// ";\228r\149\RS]\243u\250o\247\164,_\199", _willProps = []}), _cleanSession = False, _keepAlive = 6895, _connID =
// "/\215\GS\133\&67\233\250\218\RS\249)\ETB", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x58, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x1a, 0xef, 0x0,  0xd,  0x2f,
                   0xd7, 0x1d, 0x85, 0x36, 0x37, 0xe9, 0xfa, 0xda, 0x1e, 0xf9, 0x29, 0x17, 0x0,  0x18, 0x48,
                   0x9e, 0xfc, 0xe,  0xf4, 0x80, 0xb1, 0x13, 0x8c, 0x6d, 0x9a, 0x43, 0xe4, 0xff, 0xd1, 0xe,
                   0xfc, 0xd7, 0x57, 0x74, 0x81, 0x74, 0x7d, 0x83, 0x0,  0xf,  0x3b, 0xe4, 0x72, 0x95, 0x1e,
                   0x5d, 0xf3, 0x75, 0xfa, 0x6f, 0xf7, 0xa4, 0x2c, 0x5f, 0xc7, 0x0,  0xe,  0x47, 0x3e, 0x2b,
                   0x92, 0xbb, 0x58, 0x1a, 0xcd, 0xdc, 0x5a, 0x2e, 0xf7, 0xcf, 0x2,  0x0,  0x2,  0x6c, 0xfe};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x48, 0x9e, 0xfc, 0xe, 0xf4, 0x80, 0xb1, 0x13, 0x8c, 0x6d, 0x9a, 0x43,
                                0xe4, 0xff, 0xd1, 0xe, 0xfc, 0xd7, 0x57, 0x74, 0x81, 0x74, 0x7d, 0x83};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3b, 0xe4, 0x72, 0x95, 0x1e, 0x5d, 0xf3, 0x75,
                                  0xfa, 0x6f, 0xf7, 0xa4, 0x2c, 0x5f, 0xc7};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6895;
  uint8_t client_id_bytes[] = {0x2f, 0xd7, 0x1d, 0x85, 0x36, 0x37, 0xe9, 0xfa, 0xda, 0x1e, 0xf9, 0x29, 0x17};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x47, 0x3e, 0x2b, 0x92, 0xbb, 0x58, 0x1a, 0xcd, 0xdc, 0x5a, 0x2e, 0xf7, 0xcf, 0x2};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6c, 0xfe};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "P\174D\148^\175O\GS", _password = Nothing, _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS0, _willTopic =
// "\133\148;\217\ETX\ESCx\227\193\b\220\220\&2^\206\247,\208\184E\206g\130\RS\174\176\224", _willMsg =
// "&2\134`\139\156\254r\254!RA2\206\243\188", _willProps = []}), _cleanSession = False, _keepAlive = 25004, _connID =
// "/}b5\208\133\FS\133\214c\NUL\151\144\NUL\172\SO\168&&\150\174\191N\206", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x5d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xa4, 0x61, 0xac, 0x0,  0x18, 0x2f, 0x7d,
                   0x62, 0x35, 0xd0, 0x85, 0x1c, 0x85, 0xd6, 0x63, 0x0,  0x97, 0x90, 0x0,  0xac, 0xe,  0xa8, 0x26,
                   0x26, 0x96, 0xae, 0xbf, 0x4e, 0xce, 0x0,  0x1b, 0x85, 0x94, 0x3b, 0xd9, 0x3,  0x1b, 0x78, 0xe3,
                   0xc1, 0x8,  0xdc, 0xdc, 0x32, 0x5e, 0xce, 0xf7, 0x2c, 0xd0, 0xb8, 0x45, 0xce, 0x67, 0x82, 0x1e,
                   0xae, 0xb0, 0xe0, 0x0,  0x10, 0x26, 0x32, 0x86, 0x60, 0x8b, 0x9c, 0xfe, 0x72, 0xfe, 0x21, 0x52,
                   0x41, 0x32, 0xce, 0xf3, 0xbc, 0x0,  0x8,  0x50, 0xae, 0x44, 0x94, 0x5e, 0xaf, 0x4f, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x85, 0x94, 0x3b, 0xd9, 0x3,  0x1b, 0x78, 0xe3, 0xc1, 0x8,  0xdc, 0xdc, 0x32, 0x5e,
                                0xce, 0xf7, 0x2c, 0xd0, 0xb8, 0x45, 0xce, 0x67, 0x82, 0x1e, 0xae, 0xb0, 0xe0};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x26, 0x32, 0x86, 0x60, 0x8b, 0x9c, 0xfe, 0x72,
                                  0xfe, 0x21, 0x52, 0x41, 0x32, 0xce, 0xf3, 0xbc};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25004;
  uint8_t client_id_bytes[] = {0x2f, 0x7d, 0x62, 0x35, 0xd0, 0x85, 0x1c, 0x85, 0xd6, 0x63, 0x0,  0x97,
                               0x90, 0x0,  0xac, 0xe,  0xa8, 0x26, 0x26, 0x96, 0xae, 0xbf, 0x4e, 0xce};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x50, 0xae, 0x44, 0x94, 0x5e, 0xaf, 0x4f, 0x1d};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "t~B\193\194g\135.\205\195'\202\&4\254\167\130&}\131\SO(",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\167\209\SI\144\184\148\175\153P3\152[\245s\f\160\STX\173\250\248\&6|\vh\134\236\&6\214\237E", _willMsg =
// "K9\178\239\192\180\&4\159\238\219\254cw\137\\K\177\175\230", _willProps = []}), _cleanSession = False, _keepAlive =
// 30510, _connID = "\254\DC1x\142\180\241\164\178u\EMn\150\196Ks<d\"\167G\133\156\167j-\197\131N\207", _properties =
// []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x5e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2c, 0x77, 0x2e, 0x0,  0x1d, 0xfe, 0x11,
                   0x78, 0x8e, 0xb4, 0xf1, 0xa4, 0xb2, 0x75, 0x19, 0x6e, 0x96, 0xc4, 0x4b, 0x73, 0x3c, 0x64, 0x22,
                   0xa7, 0x47, 0x85, 0x9c, 0xa7, 0x6a, 0x2d, 0xc5, 0x83, 0x4e, 0xcf, 0x0,  0x1e, 0xa7, 0xd1, 0xf,
                   0x90, 0xb8, 0x94, 0xaf, 0x99, 0x50, 0x33, 0x98, 0x5b, 0xf5, 0x73, 0xc,  0xa0, 0x2,  0xad, 0xfa,
                   0xf8, 0x36, 0x7c, 0xb,  0x68, 0x86, 0xec, 0x36, 0xd6, 0xed, 0x45, 0x0,  0x13, 0x4b, 0x39, 0xb2,
                   0xef, 0xc0, 0xb4, 0x34, 0x9f, 0xee, 0xdb, 0xfe, 0x63, 0x77, 0x89, 0x5c, 0x4b, 0xb1, 0xaf, 0xe6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa7, 0xd1, 0xf,  0x90, 0xb8, 0x94, 0xaf, 0x99, 0x50, 0x33,
                                0x98, 0x5b, 0xf5, 0x73, 0xc,  0xa0, 0x2,  0xad, 0xfa, 0xf8,
                                0x36, 0x7c, 0xb,  0x68, 0x86, 0xec, 0x36, 0xd6, 0xed, 0x45};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4b, 0x39, 0xb2, 0xef, 0xc0, 0xb4, 0x34, 0x9f, 0xee, 0xdb,
                                  0xfe, 0x63, 0x77, 0x89, 0x5c, 0x4b, 0xb1, 0xaf, 0xe6};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30510;
  uint8_t client_id_bytes[] = {0xfe, 0x11, 0x78, 0x8e, 0xb4, 0xf1, 0xa4, 0xb2, 0x75, 0x19, 0x6e, 0x96, 0xc4, 0x4b, 0x73,
                               0x3c, 0x64, 0x22, 0xa7, 0x47, 0x85, 0x9c, 0xa7, 0x6a, 0x2d, 0xc5, 0x83, 0x4e, 0xcf};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x74, 0x7e, 0x42, 0xc1, 0xc2, 0x67, 0x87, 0x2e, 0xcd, 0xc3, 0x27,
                              0xca, 0x34, 0xfe, 0xa7, 0x82, 0x26, 0x7d, 0x83, 0xe,  0x28};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "+a\134G\173&O\244\236\DEL\157\220\208cK%\244", _password = Nothing, _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\STX", _willMsg =
// "9\f\152&\203\196\153\156^\250\135\135\203\221\139\220S", _willProps = []}), _cleanSession = True, _keepAlive =
// 19375, _connID = "/\\r\181\177\142o\161\139@\150@F", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x42, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8e, 0x4b, 0xaf, 0x0,  0xd,
                   0x2f, 0x5c, 0x72, 0xb5, 0xb1, 0x8e, 0x6f, 0xa1, 0x8b, 0x40, 0x96, 0x40, 0x46, 0x0,
                   0x1,  0x2,  0x0,  0x11, 0x39, 0xc,  0x98, 0x26, 0xcb, 0xc4, 0x99, 0x9c, 0x5e, 0xfa,
                   0x87, 0x87, 0xcb, 0xdd, 0x8b, 0xdc, 0x53, 0x0,  0x11, 0x2b, 0x61, 0x86, 0x47, 0xad,
                   0x26, 0x4f, 0xf4, 0xec, 0x7f, 0x9d, 0xdc, 0xd0, 0x63, 0x4b, 0x25, 0xf4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x39, 0xc,  0x98, 0x26, 0xcb, 0xc4, 0x99, 0x9c, 0x5e,
                                  0xfa, 0x87, 0x87, 0xcb, 0xdd, 0x8b, 0xdc, 0x53};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19375;
  uint8_t client_id_bytes[] = {0x2f, 0x5c, 0x72, 0xb5, 0xb1, 0x8e, 0x6f, 0xa1, 0x8b, 0x40, 0x96, 0x40, 0x46};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2b, 0x61, 0x86, 0x47, 0xad, 0x26, 0x4f, 0xf4, 0xec,
                              0x7f, 0x9d, 0xdc, 0xd0, 0x63, 0x4b, 0x25, 0xf4};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\190\145\130w(G[n\144\185\"\138A\235\255GZ\SI\251\136*\210
// \238$*\DC3\136\223\238", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\154\153\177L7?\EM \243\242#e\CAN,\194\180\CANV\230y\\\RS", _willMsg = "\147\239z\187\224\229", _willProps = []}),
// _cleanSession = True, _keepAlive = 14576, _connID = "m\168E>\DC1\GSp", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x33, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x38, 0xf0, 0x0,  0x7,
                   0x6d, 0xa8, 0x45, 0x3e, 0x11, 0x1d, 0x70, 0x0,  0x16, 0x9a, 0x99, 0xb1, 0x4c, 0x37,
                   0x3f, 0x19, 0x20, 0xf3, 0xf2, 0x23, 0x65, 0x18, 0x2c, 0xc2, 0xb4, 0x18, 0x56, 0xe6,
                   0x79, 0x5c, 0x1e, 0x0,  0x6,  0x93, 0xef, 0x7a, 0xbb, 0xe0, 0xe5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9a, 0x99, 0xb1, 0x4c, 0x37, 0x3f, 0x19, 0x20, 0xf3, 0xf2, 0x23,
                                0x65, 0x18, 0x2c, 0xc2, 0xb4, 0x18, 0x56, 0xe6, 0x79, 0x5c, 0x1e};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x93, 0xef, 0x7a, 0xbb, 0xe0, 0xe5};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14576;
  uint8_t client_id_bytes[] = {0x6d, 0xa8, 0x45, 0x3e, 0x11, 0x1d, 0x70};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xbe, 0x91, 0x82, 0x77, 0x28, 0x47, 0x5b, 0x6e, 0x90, 0xb9, 0x22, 0x8a, 0x41, 0xeb, 0xff,
                              0x47, 0x5a, 0xf,  0xfb, 0x88, 0x2a, 0xd2, 0x20, 0xee, 0x24, 0x2a, 0x13, 0x88, 0xdf, 0xee};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Ibz\161\NAK]\135\187\244P\201n\128\254LP\157\215\&5 ", _password = Just
// "\DC1\179\173\241Kq\135\157\&0\174?\226\202\185?\NUL\225\201\214\r", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 25611, _connID = "Q0\230c\ENQ\197x\GS\144k\195\162", _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x44, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x64, 0xb,  0x0,  0xc,
                   0x51, 0x30, 0xe6, 0x63, 0x5,  0xc5, 0x78, 0x1d, 0x90, 0x6b, 0xc3, 0xa2, 0x0,  0x14,
                   0x49, 0x62, 0x7a, 0xa1, 0x15, 0x5d, 0x87, 0xbb, 0xf4, 0x50, 0xc9, 0x6e, 0x80, 0xfe,
                   0x4c, 0x50, 0x9d, 0xd7, 0x35, 0x20, 0x0,  0x14, 0x11, 0xb3, 0xad, 0xf1, 0x4b, 0x71,
                   0x87, 0x9d, 0x30, 0xae, 0x3f, 0xe2, 0xca, 0xb9, 0x3f, 0x0,  0xe1, 0xc9, 0xd6, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25611;
  uint8_t client_id_bytes[] = {0x51, 0x30, 0xe6, 0x63, 0x5, 0xc5, 0x78, 0x1d, 0x90, 0x6b, 0xc3, 0xa2};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x49, 0x62, 0x7a, 0xa1, 0x15, 0x5d, 0x87, 0xbb, 0xf4, 0x50,
                              0xc9, 0x6e, 0x80, 0xfe, 0x4c, 0x50, 0x9d, 0xd7, 0x35, 0x20};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x11, 0xb3, 0xad, 0xf1, 0x4b, 0x71, 0x87, 0x9d, 0x30, 0xae,
                              0x3f, 0xe2, 0xca, 0xb9, 0x3f, 0x0,  0xe1, 0xc9, 0xd6, 0xd};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\211\231\&0\207\223D\193V\147\196\212\176\247\139\172\\\193", _password = Nothing,
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 29750, _connID = "{\160+gG\160\227*\159\208'h\197K\222\&2\tP
// \144\148\149\214l\201", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x38, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x80, 0x74, 0x36, 0x0,  0x19, 0x7b,
                   0xa0, 0x2b, 0x67, 0x47, 0xa0, 0xe3, 0x2a, 0x9f, 0xd0, 0x27, 0x68, 0xc5, 0x4b, 0xde, 0x32,
                   0x9,  0x50, 0x20, 0x90, 0x94, 0x95, 0xd6, 0x6c, 0xc9, 0x0,  0x11, 0xd3, 0xe7, 0x30, 0xcf,
                   0xdf, 0x44, 0xc1, 0x56, 0x93, 0xc4, 0xd4, 0xb0, 0xf7, 0x8b, 0xac, 0x5c, 0xc1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29750;
  uint8_t client_id_bytes[] = {0x7b, 0xa0, 0x2b, 0x67, 0x47, 0xa0, 0xe3, 0x2a, 0x9f, 0xd0, 0x27, 0x68, 0xc5,
                               0x4b, 0xde, 0x32, 0x9,  0x50, 0x20, 0x90, 0x94, 0x95, 0xd6, 0x6c, 0xc9};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd3, 0xe7, 0x30, 0xcf, 0xdf, 0x44, 0xc1, 0x56, 0x93,
                              0xc4, 0xd4, 0xb0, 0xf7, 0x8b, 0xac, 0x5c, 0xc1};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "?\212\154\234\129\129", _password = Just "p~)\DELVv\232\EOT,\SUB\142a\223",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\182\210\210\208\161*\ng>\174\214\175\228\181\167\162I=\146!", _willMsg = "2\138c9\234`\186@\186E\164\&9+",
// _willProps = []}), _cleanSession = False, _keepAlive = 19395, _connID =
// "\149n\238G\238\237)\201\164\252\154Z`O\144Gm\245xzg\DC3P", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x5f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x4b, 0xc3, 0x0,  0x17, 0x95, 0x6e, 0xee,
                   0x47, 0xee, 0xed, 0x29, 0xc9, 0xa4, 0xfc, 0x9a, 0x5a, 0x60, 0x4f, 0x90, 0x47, 0x6d, 0xf5, 0x78, 0x7a,
                   0x67, 0x13, 0x50, 0x0,  0x14, 0xb6, 0xd2, 0xd2, 0xd0, 0xa1, 0x2a, 0xa,  0x67, 0x3e, 0xae, 0xd6, 0xaf,
                   0xe4, 0xb5, 0xa7, 0xa2, 0x49, 0x3d, 0x92, 0x21, 0x0,  0xd,  0x32, 0x8a, 0x63, 0x39, 0xea, 0x60, 0xba,
                   0x40, 0xba, 0x45, 0xa4, 0x39, 0x2b, 0x0,  0x6,  0x3f, 0xd4, 0x9a, 0xea, 0x81, 0x81, 0x0,  0xd,  0x70,
                   0x7e, 0x29, 0x7f, 0x56, 0x76, 0xe8, 0x4,  0x2c, 0x1a, 0x8e, 0x61, 0xdf};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb6, 0xd2, 0xd2, 0xd0, 0xa1, 0x2a, 0xa,  0x67, 0x3e, 0xae,
                                0xd6, 0xaf, 0xe4, 0xb5, 0xa7, 0xa2, 0x49, 0x3d, 0x92, 0x21};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x32, 0x8a, 0x63, 0x39, 0xea, 0x60, 0xba, 0x40, 0xba, 0x45, 0xa4, 0x39, 0x2b};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19395;
  uint8_t client_id_bytes[] = {0x95, 0x6e, 0xee, 0x47, 0xee, 0xed, 0x29, 0xc9, 0xa4, 0xfc, 0x9a, 0x5a,
                               0x60, 0x4f, 0x90, 0x47, 0x6d, 0xf5, 0x78, 0x7a, 0x67, 0x13, 0x50};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3f, 0xd4, 0x9a, 0xea, 0x81, 0x81};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x70, 0x7e, 0x29, 0x7f, 0x56, 0x76, 0xe8, 0x4, 0x2c, 0x1a, 0x8e, 0x61, 0xdf};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\150\213\175\169yq`\DC3\185\158\240\US\228H\158\158\192\153", _password = Just
// "\206c\DC1\187", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "'gY\b\203\149\DC3\206\CAN<\CAN\177\205$a\160\135", _willMsg =
// "\162<\STX\222\185\208\196\140\169\175\155\150\NAK\216\r\145\194\173\159\210/\222\f\180\NAK=", _willProps = []}),
// _cleanSession = True, _keepAlive = 5366, _connID = "\230\209$f\202\238\227", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x5c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x14, 0xf6, 0x0,  0x7,  0xe6, 0xd1,
                   0x24, 0x66, 0xca, 0xee, 0xe3, 0x0,  0x11, 0x27, 0x67, 0x59, 0x8,  0xcb, 0x95, 0x13, 0xce, 0x18,
                   0x3c, 0x18, 0xb1, 0xcd, 0x24, 0x61, 0xa0, 0x87, 0x0,  0x1a, 0xa2, 0x3c, 0x2,  0xde, 0xb9, 0xd0,
                   0xc4, 0x8c, 0xa9, 0xaf, 0x9b, 0x96, 0x15, 0xd8, 0xd,  0x91, 0xc2, 0xad, 0x9f, 0xd2, 0x2f, 0xde,
                   0xc,  0xb4, 0x15, 0x3d, 0x0,  0x12, 0x96, 0xd5, 0xaf, 0xa9, 0x79, 0x71, 0x60, 0x13, 0xb9, 0x9e,
                   0xf0, 0x1f, 0xe4, 0x48, 0x9e, 0x9e, 0xc0, 0x99, 0x0,  0x4,  0xce, 0x63, 0x11, 0xbb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x27, 0x67, 0x59, 0x8,  0xcb, 0x95, 0x13, 0xce, 0x18,
                                0x3c, 0x18, 0xb1, 0xcd, 0x24, 0x61, 0xa0, 0x87};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa2, 0x3c, 0x2,  0xde, 0xb9, 0xd0, 0xc4, 0x8c, 0xa9, 0xaf, 0x9b, 0x96, 0x15,
                                  0xd8, 0xd,  0x91, 0xc2, 0xad, 0x9f, 0xd2, 0x2f, 0xde, 0xc,  0xb4, 0x15, 0x3d};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5366;
  uint8_t client_id_bytes[] = {0xe6, 0xd1, 0x24, 0x66, 0xca, 0xee, 0xe3};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x96, 0xd5, 0xaf, 0xa9, 0x79, 0x71, 0x60, 0x13, 0xb9,
                              0x9e, 0xf0, 0x1f, 0xe4, 0x48, 0x9e, 0x9e, 0xc0, 0x99};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xce, 0x63, 0x11, 0xbb};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\129\128\161\159\147\245-e\bJ_\149 \184p.t,\236Q\211\160XD\SUB\239\DEL\DC2\144",
// _password = Just "\240\244", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\135\ETXg\SIO\185\150d\172+QZ", _willMsg = "\232\GS\202P\180x\186\243}<\155\148:\217\145'", _willProps = []}),
// _cleanSession = True, _keepAlive = 30463, _connID = "\171v+\163\172\203\229S\191\242VUR\b\DLE\179J\234", _properties
// = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x61, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x76, 0xff, 0x0,  0x12, 0xab, 0x76, 0x2b,
                   0xa3, 0xac, 0xcb, 0xe5, 0x53, 0xbf, 0xf2, 0x56, 0x55, 0x52, 0x8,  0x10, 0xb3, 0x4a, 0xea, 0x0,  0xc,
                   0x87, 0x3,  0x67, 0xf,  0x4f, 0xb9, 0x96, 0x64, 0xac, 0x2b, 0x51, 0x5a, 0x0,  0x10, 0xe8, 0x1d, 0xca,
                   0x50, 0xb4, 0x78, 0xba, 0xf3, 0x7d, 0x3c, 0x9b, 0x94, 0x3a, 0xd9, 0x91, 0x27, 0x0,  0x1d, 0x81, 0x80,
                   0xa1, 0x9f, 0x93, 0xf5, 0x2d, 0x65, 0x8,  0x4a, 0x5f, 0x95, 0x20, 0xb8, 0x70, 0x2e, 0x74, 0x2c, 0xec,
                   0x51, 0xd3, 0xa0, 0x58, 0x44, 0x1a, 0xef, 0x7f, 0x12, 0x90, 0x0,  0x2,  0xf0, 0xf4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x3, 0x67, 0xf, 0x4f, 0xb9, 0x96, 0x64, 0xac, 0x2b, 0x51, 0x5a};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe8, 0x1d, 0xca, 0x50, 0xb4, 0x78, 0xba, 0xf3,
                                  0x7d, 0x3c, 0x9b, 0x94, 0x3a, 0xd9, 0x91, 0x27};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30463;
  uint8_t client_id_bytes[] = {0xab, 0x76, 0x2b, 0xa3, 0xac, 0xcb, 0xe5, 0x53, 0xbf,
                               0xf2, 0x56, 0x55, 0x52, 0x8,  0x10, 0xb3, 0x4a, 0xea};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x81, 0x80, 0xa1, 0x9f, 0x93, 0xf5, 0x2d, 0x65, 0x8,  0x4a, 0x5f, 0x95, 0x20, 0xb8, 0x70,
                              0x2e, 0x74, 0x2c, 0xec, 0x51, 0xd3, 0xa0, 0x58, 0x44, 0x1a, 0xef, 0x7f, 0x12, 0x90};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf0, 0xf4};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ".2\214\236%\167C\190\248\193\211@$\248", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "\211\192\177\134\&8\245\197\148\144\238\147T?",
// _willMsg = "Ws\ETB\210;\DC3\230~\159t\212k(\175\174\"\239\CAN\193\229\255", _willProps = []}), _cleanSession = False,
// _keepAlive = 24806, _connID = "\226W\228\136%h\248C\190\131\204\147f\NAKn\148 \184\208#\240\FSf\FS3T\231",
// _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x5d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xac, 0x60, 0xe6, 0x0,  0x1b, 0xe2, 0x57,
                   0xe4, 0x88, 0x25, 0x68, 0xf8, 0x43, 0xbe, 0x83, 0xcc, 0x93, 0x66, 0x15, 0x6e, 0x94, 0x20, 0xb8,
                   0xd0, 0x23, 0xf0, 0x1c, 0x66, 0x1c, 0x33, 0x54, 0xe7, 0x0,  0xd,  0xd3, 0xc0, 0xb1, 0x86, 0x38,
                   0xf5, 0xc5, 0x94, 0x90, 0xee, 0x93, 0x54, 0x3f, 0x0,  0x15, 0x57, 0x73, 0x17, 0xd2, 0x3b, 0x13,
                   0xe6, 0x7e, 0x9f, 0x74, 0xd4, 0x6b, 0x28, 0xaf, 0xae, 0x22, 0xef, 0x18, 0xc1, 0xe5, 0xff, 0x0,
                   0xe,  0x2e, 0x32, 0xd6, 0xec, 0x25, 0xa7, 0x43, 0xbe, 0xf8, 0xc1, 0xd3, 0x40, 0x24, 0xf8};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd3, 0xc0, 0xb1, 0x86, 0x38, 0xf5, 0xc5, 0x94, 0x90, 0xee, 0x93, 0x54, 0x3f};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x57, 0x73, 0x17, 0xd2, 0x3b, 0x13, 0xe6, 0x7e, 0x9f, 0x74, 0xd4,
                                  0x6b, 0x28, 0xaf, 0xae, 0x22, 0xef, 0x18, 0xc1, 0xe5, 0xff};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24806;
  uint8_t client_id_bytes[] = {0xe2, 0x57, 0xe4, 0x88, 0x25, 0x68, 0xf8, 0x43, 0xbe, 0x83, 0xcc, 0x93, 0x66, 0x15,
                               0x6e, 0x94, 0x20, 0xb8, 0xd0, 0x23, 0xf0, 0x1c, 0x66, 0x1c, 0x33, 0x54, 0xe7};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2e, 0x32, 0xd6, 0xec, 0x25, 0xa7, 0x43, 0xbe, 0xf8, 0xc1, 0xd3, 0x40, 0x24, 0xf8};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\RST\210\144\vR\152\r\144sH\140S\216X\252D\232\156", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\DC3\214I\EM\233B\b", _willMsg =
// "iT\rof/\249~4Z(<[iN\168@!g", _willProps = []}), _cleanSession = False, _keepAlive = 10052, _connID =
// "\ENQB\207E\189\199FE\196\245\ACK\135\200N\n\187\177\209\128\171", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x3e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x4,  0x27, 0x44, 0x0,  0x14, 0x5,  0x42,
                   0xcf, 0x45, 0xbd, 0xc7, 0x46, 0x45, 0xc4, 0xf5, 0x6,  0x87, 0xc8, 0x4e, 0xa,  0xbb, 0xb1, 0xd1,
                   0x80, 0xab, 0x0,  0x7,  0x13, 0xd6, 0x49, 0x19, 0xe9, 0x42, 0x8,  0x0,  0x13, 0x69, 0x54, 0xd,
                   0x6f, 0x66, 0x2f, 0xf9, 0x7e, 0x34, 0x5a, 0x28, 0x3c, 0x5b, 0x69, 0x4e, 0xa8, 0x40, 0x21, 0x67};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x13, 0xd6, 0x49, 0x19, 0xe9, 0x42, 0x8};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x69, 0x54, 0xd,  0x6f, 0x66, 0x2f, 0xf9, 0x7e, 0x34, 0x5a,
                                  0x28, 0x3c, 0x5b, 0x69, 0x4e, 0xa8, 0x40, 0x21, 0x67};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10052;
  uint8_t client_id_bytes[] = {0x5, 0x42, 0xcf, 0x45, 0xbd, 0xc7, 0x46, 0x45, 0xc4, 0xf5,
                               0x6, 0x87, 0xc8, 0x4e, 0xa,  0xbb, 0xb1, 0xd1, 0x80, 0xab};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x1e, 0x54, 0xd2, 0x90, 0xb,  0x52, 0x98, 0xd,  0x90, 0x73,
                              0x48, 0x8c, 0x53, 0xd8, 0x58, 0xfc, 0x44, 0xe8, 0x9c};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "jp\210\SYN<%F\215\168\207J\225\152z\151X\253\132\"", _password = Nothing, _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\181J\251\141\ETX", _willMsg = "|\ETB",
// _willProps = []}), _cleanSession = True, _keepAlive = 2920, _connID =
// "\203M+\171|\132nj\193\FS\a\\\DC1\230\202\DC2Id;\200", _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8e, 0xb,  0x68, 0x0,  0x14, 0xcb, 0x4d, 0x2b,
                   0xab, 0x7c, 0x84, 0x6e, 0x6a, 0xc1, 0x1c, 0x7,  0x5c, 0x11, 0xe6, 0xca, 0x12, 0x49, 0x64, 0x3b, 0xc8,
                   0x0,  0x5,  0xb5, 0x4a, 0xfb, 0x8d, 0x3,  0x0,  0x2,  0x7c, 0x17, 0x0,  0x13, 0x6a, 0x70, 0xd2, 0x16,
                   0x3c, 0x25, 0x46, 0xd7, 0xa8, 0xcf, 0x4a, 0xe1, 0x98, 0x7a, 0x97, 0x58, 0xfd, 0x84, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb5, 0x4a, 0xfb, 0x8d, 0x3};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7c, 0x17};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2920;
  uint8_t client_id_bytes[] = {0xcb, 0x4d, 0x2b, 0xab, 0x7c, 0x84, 0x6e, 0x6a, 0xc1, 0x1c,
                               0x7,  0x5c, 0x11, 0xe6, 0xca, 0x12, 0x49, 0x64, 0x3b, 0xc8};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x6a, 0x70, 0xd2, 0x16, 0x3c, 0x25, 0x46, 0xd7, 0xa8, 0xcf,
                              0x4a, 0xe1, 0x98, 0x7a, 0x97, 0x58, 0xfd, 0x84, 0x22};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\192\STX\129_\195-\215\163\200JG\249<", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\152e\130\v\SOH\ACK\224\EOT\165\199(&g\SO\ACK\211\169\&1\DC3\243\199\ETB\221\138+", _willMsg =
// "H\197\&7\SOH\253\237", _willProps = []}), _cleanSession = True, _keepAlive = 2714, _connID =
// "\243Q\STX\222\243oB\DC4\136\201n\GS\146", _properties = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x3c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0xa,  0x9a, 0x0,  0xd,  0xf3, 0x51,
                   0x2,  0xde, 0xf3, 0x6f, 0x42, 0x14, 0x88, 0xc9, 0x6e, 0x1d, 0x92, 0x0,  0x19, 0x98, 0x65, 0x82,
                   0xb,  0x1,  0x6,  0xe0, 0x4,  0xa5, 0xc7, 0x28, 0x26, 0x67, 0xe,  0x6,  0xd3, 0xa9, 0x31, 0x13,
                   0xf3, 0xc7, 0x17, 0xdd, 0x8a, 0x2b, 0x0,  0x6,  0x48, 0xc5, 0x37, 0x1,  0xfd, 0xed};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x98, 0x65, 0x82, 0xb,  0x1,  0x6,  0xe0, 0x4,  0xa5, 0xc7, 0x28, 0x26, 0x67,
                                0xe,  0x6,  0xd3, 0xa9, 0x31, 0x13, 0xf3, 0xc7, 0x17, 0xdd, 0x8a, 0x2b};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x48, 0xc5, 0x37, 0x1, 0xfd, 0xed};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2714;
  uint8_t client_id_bytes[] = {0xf3, 0x51, 0x2, 0xde, 0xf3, 0x6f, 0x42, 0x14, 0x88, 0xc9, 0x6e, 0x1d, 0x92};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc0, 0x2, 0x81, 0x5f, 0xc3, 0x2d, 0xd7, 0xa3, 0xc8, 0x4a, 0x47, 0xf9, 0x3c};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 26866, _connID = "^\239\188\197\142\229[\ESC\211E\188\233\195", _properties = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x19, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2,  0x68, 0xf2, 0x0, 0xd,
                   0x5e, 0xef, 0xbc, 0xc5, 0x8e, 0xe5, 0x5b, 0x1b, 0xd3, 0x45, 0xbc, 0xe9, 0xc3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26866;
  uint8_t client_id_bytes[] = {0x5e, 0xef, 0xbc, 0xc5, 0x8e, 0xe5, 0x5b, 0x1b, 0xd3, 0x45, 0xbc, 0xe9, 0xc3};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\159\254c\245[\164\r\135bMz\150\205`e\233\140\135YrN\180\GS\186\140\209As",
// _password = Just "<\FS\172b\196\SI\220\203\NUL`<v\134\195e", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 27380, _connID = "\164\253\255\190/Pv\232\ESC\DEL\DLE", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x6a, 0xf4, 0x0,  0xb,  0xa4,
                   0xfd, 0xff, 0xbe, 0x2f, 0x50, 0x76, 0xe8, 0x1b, 0x7f, 0x10, 0x0,  0x1c, 0x9f, 0xfe, 0x63,
                   0xf5, 0x5b, 0xa4, 0xd,  0x87, 0x62, 0x4d, 0x7a, 0x96, 0xcd, 0x60, 0x65, 0xe9, 0x8c, 0x87,
                   0x59, 0x72, 0x4e, 0xb4, 0x1d, 0xba, 0x8c, 0xd1, 0x41, 0x73, 0x0,  0xf,  0x3c, 0x1c, 0xac,
                   0x62, 0xc4, 0xf,  0xdc, 0xcb, 0x0,  0x60, 0x3c, 0x76, 0x86, 0xc3, 0x65};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27380;
  uint8_t client_id_bytes[] = {0xa4, 0xfd, 0xff, 0xbe, 0x2f, 0x50, 0x76, 0xe8, 0x1b, 0x7f, 0x10};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x9f, 0xfe, 0x63, 0xf5, 0x5b, 0xa4, 0xd,  0x87, 0x62, 0x4d, 0x7a, 0x96, 0xcd, 0x60,
                              0x65, 0xe9, 0x8c, 0x87, 0x59, 0x72, 0x4e, 0xb4, 0x1d, 0xba, 0x8c, 0xd1, 0x41, 0x73};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3c, 0x1c, 0xac, 0x62, 0xc4, 0xf, 0xdc, 0xcb, 0x0, 0x60, 0x3c, 0x76, 0x86, 0xc3, 0x65};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "6\139\225\160\222Yv\ETB\184\SUB\RS\SO\234}G\231", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "#\147F\FS\155\DC4#\190\181\197\164\ESC\166\191Z\ENQ\247\143\216\251\140\232\161>\239\135", _willMsg =
// "\232\233\vx\202\163\SOH\188\142\245iS\"H\226\158\228\235\182tA\252\ACK\191\183j8", _willProps = []}), _cleanSession
// = False, _keepAlive = 2005, _connID = "\SODv\236\176\168\ETB \EOT", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x24, 0x7,  0xd5, 0x0,  0x9,  0xe,  0x44,
                   0x76, 0xec, 0xb0, 0xa8, 0x17, 0x20, 0x4,  0x0,  0x1a, 0x23, 0x93, 0x46, 0x1c, 0x9b, 0x14, 0x23,
                   0xbe, 0xb5, 0xc5, 0xa4, 0x1b, 0xa6, 0xbf, 0x5a, 0x5,  0xf7, 0x8f, 0xd8, 0xfb, 0x8c, 0xe8, 0xa1,
                   0x3e, 0xef, 0x87, 0x0,  0x1b, 0xe8, 0xe9, 0xb,  0x78, 0xca, 0xa3, 0x1,  0xbc, 0x8e, 0xf5, 0x69,
                   0x53, 0x22, 0x48, 0xe2, 0x9e, 0xe4, 0xeb, 0xb6, 0x74, 0x41, 0xfc, 0x6,  0xbf, 0xb7, 0x6a, 0x38};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x23, 0x93, 0x46, 0x1c, 0x9b, 0x14, 0x23, 0xbe, 0xb5, 0xc5, 0xa4, 0x1b, 0xa6,
                                0xbf, 0x5a, 0x5,  0xf7, 0x8f, 0xd8, 0xfb, 0x8c, 0xe8, 0xa1, 0x3e, 0xef, 0x87};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe8, 0xe9, 0xb,  0x78, 0xca, 0xa3, 0x1,  0xbc, 0x8e, 0xf5, 0x69, 0x53, 0x22, 0x48,
                                  0xe2, 0x9e, 0xe4, 0xeb, 0xb6, 0x74, 0x41, 0xfc, 0x6,  0xbf, 0xb7, 0x6a, 0x38};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2005;
  uint8_t client_id_bytes[] = {0xe, 0x44, 0x76, 0xec, 0xb0, 0xa8, 0x17, 0x20, 0x4};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x36, 0x8b, 0xe1, 0xa0, 0xde, 0x59, 0x76, 0x17,
                              0xb8, 0x1a, 0x1e, 0xe,  0xea, 0x7d, 0x47, 0xe7};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "5\189\229", _password = Just "\SO\229\SUB\207\196\181|6\242\192@", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "v<3?)\161", _willMsg =
// "\202\&9\147\164]\233\219\201F\146ox)xa", _willProps = []}), _cleanSession = False, _keepAlive = 31959, _connID =
// "K\181", _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x39, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x7c, 0xd7, 0x0,  0x2,  0x4b,
                   0xb5, 0x0,  0x6,  0x76, 0x3c, 0x33, 0x3f, 0x29, 0xa1, 0x0,  0xf,  0xca, 0x39, 0x93, 0xa4,
                   0x5d, 0xe9, 0xdb, 0xc9, 0x46, 0x92, 0x6f, 0x78, 0x29, 0x78, 0x61, 0x0,  0x3,  0x35, 0xbd,
                   0xe5, 0x0,  0xb,  0xe,  0xe5, 0x1a, 0xcf, 0xc4, 0xb5, 0x7c, 0x36, 0xf2, 0xc0, 0x40};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x76, 0x3c, 0x33, 0x3f, 0x29, 0xa1};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xca, 0x39, 0x93, 0xa4, 0x5d, 0xe9, 0xdb, 0xc9,
                                  0x46, 0x92, 0x6f, 0x78, 0x29, 0x78, 0x61};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 31959;
  uint8_t client_id_bytes[] = {0x4b, 0xb5};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x35, 0xbd, 0xe5};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe, 0xe5, 0x1a, 0xcf, 0xc4, 0xb5, 0x7c, 0x36, 0xf2, 0xc0, 0x40};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "$\DC3o!\SI\253}\212\230\FS`\217X\171[", _password = Just "u", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "\SOH$\ETB\192\157\196En", _willMsg =
// "\215\209\DLE\STX\164!\185\142\223\197\154\"\159\249\167,[\130", _willProps = []}), _cleanSession = True, _keepAlive
// = 14833, _connID = "\ETX@W\177\213>\v\227\232\224C\r\156\220j\DC4\170\177g\190-&\193", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x55, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x39, 0xf1, 0x0,  0x17, 0x3,
                   0x40, 0x57, 0xb1, 0xd5, 0x3e, 0xb,  0xe3, 0xe8, 0xe0, 0x43, 0xd,  0x9c, 0xdc, 0x6a, 0x14,
                   0xaa, 0xb1, 0x67, 0xbe, 0x2d, 0x26, 0xc1, 0x0,  0x8,  0x1,  0x24, 0x17, 0xc0, 0x9d, 0xc4,
                   0x45, 0x6e, 0x0,  0x12, 0xd7, 0xd1, 0x10, 0x2,  0xa4, 0x21, 0xb9, 0x8e, 0xdf, 0xc5, 0x9a,
                   0x22, 0x9f, 0xf9, 0xa7, 0x2c, 0x5b, 0x82, 0x0,  0xf,  0x24, 0x13, 0x6f, 0x21, 0xf,  0xfd,
                   0x7d, 0xd4, 0xe6, 0x1c, 0x60, 0xd9, 0x58, 0xab, 0x5b, 0x0,  0x1,  0x75};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1, 0x24, 0x17, 0xc0, 0x9d, 0xc4, 0x45, 0x6e};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd7, 0xd1, 0x10, 0x2,  0xa4, 0x21, 0xb9, 0x8e, 0xdf,
                                  0xc5, 0x9a, 0x22, 0x9f, 0xf9, 0xa7, 0x2c, 0x5b, 0x82};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14833;
  uint8_t client_id_bytes[] = {0x3,  0x40, 0x57, 0xb1, 0xd5, 0x3e, 0xb,  0xe3, 0xe8, 0xe0, 0x43, 0xd,
                               0x9c, 0xdc, 0x6a, 0x14, 0xaa, 0xb1, 0x67, 0xbe, 0x2d, 0x26, 0xc1};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x24, 0x13, 0x6f, 0x21, 0xf, 0xfd, 0x7d, 0xd4, 0xe6, 0x1c, 0x60, 0xd9, 0x58, 0xab, 0x5b};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x75};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\vA%3\NAK\141\215\DC1\202\232\133\157m&\195\DLE\177S\169-s\174ot\177\US\t\176",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\168\SO\185\228vJA\194DR\140\201\EOT\155\ETB!", _willMsg = "a\EM\252\SYNH\190\200 B\143\EOT\ETXl' \174\145\159n",
// _willProps = []}), _cleanSession = True, _keepAlive = 28777, _connID =
// "+3\250\223\230[8\232\GS\FS\191\141\166\159\EOT", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x60, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8e, 0x70, 0x69, 0x0,  0xf,  0x2b, 0x33, 0xfa,
                   0xdf, 0xe6, 0x5b, 0x38, 0xe8, 0x1d, 0x1c, 0xbf, 0x8d, 0xa6, 0x9f, 0x4,  0x0,  0x10, 0xa8, 0xe,  0xb9,
                   0xe4, 0x76, 0x4a, 0x41, 0xc2, 0x44, 0x52, 0x8c, 0xc9, 0x4,  0x9b, 0x17, 0x21, 0x0,  0x13, 0x61, 0x19,
                   0xfc, 0x16, 0x48, 0xbe, 0xc8, 0x20, 0x42, 0x8f, 0x4,  0x3,  0x6c, 0x27, 0x20, 0xae, 0x91, 0x9f, 0x6e,
                   0x0,  0x1c, 0xb,  0x41, 0x25, 0x33, 0x15, 0x8d, 0xd7, 0x11, 0xca, 0xe8, 0x85, 0x9d, 0x6d, 0x26, 0xc3,
                   0x10, 0xb1, 0x53, 0xa9, 0x2d, 0x73, 0xae, 0x6f, 0x74, 0xb1, 0x1f, 0x9,  0xb0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa8, 0xe,  0xb9, 0xe4, 0x76, 0x4a, 0x41, 0xc2,
                                0x44, 0x52, 0x8c, 0xc9, 0x4,  0x9b, 0x17, 0x21};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x61, 0x19, 0xfc, 0x16, 0x48, 0xbe, 0xc8, 0x20, 0x42, 0x8f,
                                  0x4,  0x3,  0x6c, 0x27, 0x20, 0xae, 0x91, 0x9f, 0x6e};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28777;
  uint8_t client_id_bytes[] = {0x2b, 0x33, 0xfa, 0xdf, 0xe6, 0x5b, 0x38, 0xe8, 0x1d, 0x1c, 0xbf, 0x8d, 0xa6, 0x9f, 0x4};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb,  0x41, 0x25, 0x33, 0x15, 0x8d, 0xd7, 0x11, 0xca, 0xe8, 0x85, 0x9d, 0x6d, 0x26,
                              0xc3, 0x10, 0xb1, 0x53, 0xa9, 0x2d, 0x73, 0xae, 0x6f, 0x74, 0xb1, 0x1f, 0x9,  0xb0};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\154\187ln", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\147\234\128\171\v\219\164\138\218W\166", _willMsg =
// "\210\254\161\ENQ\v\192\253\DLE\176\204-\222Uv\154m\FSi+", _willProps = []}), _cleanSession = True, _keepAlive =
// 23669, _connID = "$\237\&8\219\166I\143>\251N\190&hL\173\150*\131\212>\211\244\SI\149\243\SYN\179\154\EOT",
// _properties = []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x4b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x36, 0x5c, 0x75, 0x0,  0x1d, 0x24, 0xed,
                   0x38, 0xdb, 0xa6, 0x49, 0x8f, 0x3e, 0xfb, 0x4e, 0xbe, 0x26, 0x68, 0x4c, 0xad, 0x96, 0x2a, 0x83,
                   0xd4, 0x3e, 0xd3, 0xf4, 0xf,  0x95, 0xf3, 0x16, 0xb3, 0x9a, 0x4,  0x0,  0xb,  0x93, 0xea, 0x80,
                   0xab, 0xb,  0xdb, 0xa4, 0x8a, 0xda, 0x57, 0xa6, 0x0,  0x13, 0xd2, 0xfe, 0xa1, 0x5,  0xb,  0xc0,
                   0xfd, 0x10, 0xb0, 0xcc, 0x2d, 0xde, 0x55, 0x76, 0x9a, 0x6d, 0x1c, 0x69, 0x2b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x93, 0xea, 0x80, 0xab, 0xb, 0xdb, 0xa4, 0x8a, 0xda, 0x57, 0xa6};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd2, 0xfe, 0xa1, 0x5,  0xb,  0xc0, 0xfd, 0x10, 0xb0, 0xcc,
                                  0x2d, 0xde, 0x55, 0x76, 0x9a, 0x6d, 0x1c, 0x69, 0x2b};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23669;
  uint8_t client_id_bytes[] = {0x24, 0xed, 0x38, 0xdb, 0xa6, 0x49, 0x8f, 0x3e, 0xfb, 0x4e, 0xbe, 0x26, 0x68, 0x4c, 0xad,
                               0x96, 0x2a, 0x83, 0xd4, 0x3e, 0xd3, 0xf4, 0xf,  0x95, 0xf3, 0x16, 0xb3, 0x9a, 0x4};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9a, 0xbb, 0x6c, 0x6e};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\143,\SOH\155g\228PV\DC2<\233\167\240`\US", _password = Just
// "e\nm=f\140\230Dl\161\225\170\162v\164\EOTc\207\195\255\131n$G\179w", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\178\225\170J\183\NAK\128\201\233\247\215q\NAK\v\165A\US\228", _willMsg =
// "-\155\216\170\221I\188\147:\179\167:", _willProps = []}), _cleanSession = False, _keepAlive = 24031, _connID =
// "\SI5", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x5d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x5d, 0xdf, 0x0,  0x2,  0xf,  0x35,
                   0x0,  0x12, 0xb2, 0xe1, 0xaa, 0x4a, 0xb7, 0x15, 0x80, 0xc9, 0xe9, 0xf7, 0xd7, 0x71, 0x15, 0xb,
                   0xa5, 0x41, 0x1f, 0xe4, 0x0,  0xc,  0x2d, 0x9b, 0xd8, 0xaa, 0xdd, 0x49, 0xbc, 0x93, 0x3a, 0xb3,
                   0xa7, 0x3a, 0x0,  0xf,  0x8f, 0x2c, 0x1,  0x9b, 0x67, 0xe4, 0x50, 0x56, 0x12, 0x3c, 0xe9, 0xa7,
                   0xf0, 0x60, 0x1f, 0x0,  0x1a, 0x65, 0xa,  0x6d, 0x3d, 0x66, 0x8c, 0xe6, 0x44, 0x6c, 0xa1, 0xe1,
                   0xaa, 0xa2, 0x76, 0xa4, 0x4,  0x63, 0xcf, 0xc3, 0xff, 0x83, 0x6e, 0x24, 0x47, 0xb3, 0x77};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb2, 0xe1, 0xaa, 0x4a, 0xb7, 0x15, 0x80, 0xc9, 0xe9,
                                0xf7, 0xd7, 0x71, 0x15, 0xb,  0xa5, 0x41, 0x1f, 0xe4};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2d, 0x9b, 0xd8, 0xaa, 0xdd, 0x49, 0xbc, 0x93, 0x3a, 0xb3, 0xa7, 0x3a};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24031;
  uint8_t client_id_bytes[] = {0xf, 0x35};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8f, 0x2c, 0x1, 0x9b, 0x67, 0xe4, 0x50, 0x56, 0x12, 0x3c, 0xe9, 0xa7, 0xf0, 0x60, 0x1f};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x65, 0xa,  0x6d, 0x3d, 0x66, 0x8c, 0xe6, 0x44, 0x6c, 0xa1, 0xe1, 0xaa, 0xa2,
                              0x76, 0xa4, 0x4,  0x63, 0xcf, 0xc3, 0xff, 0x83, 0x6e, 0x24, 0x47, 0xb3, 0x77};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\141\198\185\130\140v\STX\135\128\CAN", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "Y\242i\225Ly\163\177\f\138\135/TW\n\DC3\217\RS\251c\244\DLEs\CAN\178mU>\SO", _willMsg = "Z", _willProps = []}),
// _cleanSession = True, _keepAlive = 14148, _connID = "hRi\ESC\170\202\226\252\ACK\209\SYN\222k\188", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x3c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x37, 0x44, 0x0, 0xe,  0x68, 0x52,
                   0x69, 0x1b, 0xaa, 0xca, 0xe2, 0xfc, 0x6,  0xd1, 0x16, 0xde, 0x6b, 0xbc, 0x0, 0x1d, 0x59, 0xf2,
                   0x69, 0xe1, 0x4c, 0x79, 0xa3, 0xb1, 0xc,  0x8a, 0x87, 0x2f, 0x54, 0x57, 0xa, 0x13, 0xd9, 0x1e,
                   0xfb, 0x63, 0xf4, 0x10, 0x73, 0x18, 0xb2, 0x6d, 0x55, 0x3e, 0xe,  0x0,  0x1, 0x5a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x59, 0xf2, 0x69, 0xe1, 0x4c, 0x79, 0xa3, 0xb1, 0xc,  0x8a, 0x87, 0x2f, 0x54, 0x57, 0xa,
                                0x13, 0xd9, 0x1e, 0xfb, 0x63, 0xf4, 0x10, 0x73, 0x18, 0xb2, 0x6d, 0x55, 0x3e, 0xe};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5a};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14148;
  uint8_t client_id_bytes[] = {0x68, 0x52, 0x69, 0x1b, 0xaa, 0xca, 0xe2, 0xfc, 0x6, 0xd1, 0x16, 0xde, 0x6b, 0xbc};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x8d, 0xc6, 0xb9, 0x82, 0x8c, 0x76, 0x2, 0x87, 0x80, 0x18};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\167\155\251\197h\150N", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "'m\f$\SI\138a\SInjUa;\229\155Z\157\&2", _willMsg =
// "94H\150\255\251\134\159\242\&1H", _willProps = []}), _cleanSession = True, _keepAlive = 31273, _connID =
// "\211\132J\179\217\&3\245\247\151\a\182", _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x38, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2e, 0x7a, 0x29, 0x0,  0xb,  0xd3,
                   0x84, 0x4a, 0xb3, 0xd9, 0x33, 0xf5, 0xf7, 0x97, 0x7,  0xb6, 0x0,  0x12, 0x27, 0x6d, 0xc,
                   0x24, 0xf,  0x8a, 0x61, 0xf,  0x6e, 0x6a, 0x55, 0x61, 0x3b, 0xe5, 0x9b, 0x5a, 0x9d, 0x32,
                   0x0,  0xb,  0x39, 0x34, 0x48, 0x96, 0xff, 0xfb, 0x86, 0x9f, 0xf2, 0x31, 0x48};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x27, 0x6d, 0xc,  0x24, 0xf,  0x8a, 0x61, 0xf,  0x6e,
                                0x6a, 0x55, 0x61, 0x3b, 0xe5, 0x9b, 0x5a, 0x9d, 0x32};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x39, 0x34, 0x48, 0x96, 0xff, 0xfb, 0x86, 0x9f, 0xf2, 0x31, 0x48};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31273;
  uint8_t client_id_bytes[] = {0xd3, 0x84, 0x4a, 0xb3, 0xd9, 0x33, 0xf5, 0xf7, 0x97, 0x7, 0xb6};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa7, 0x9b, 0xfb, 0xc5, 0x68, 0x96, 0x4e};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\152", _password = Just
// "\174\152x,\214O\183\249,o\"\137\170m\244\164\203\ACK\186\179\217@ _[\r>", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "A\SUB\166x\NUL", _willMsg = "\253\&0\131n\162\236\192\DEL \150.\SI\174\163",
// _willProps = []}), _cleanSession = True, _keepAlive = 11096, _connID =
// "\207\r\183\&5c`\208+\186d/\132'X\238\247\DLEO\130\241\201\158\234", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x2b, 0x58, 0x0,  0x17, 0xcf, 0xd,
                   0xb7, 0x35, 0x63, 0x60, 0xd0, 0x2b, 0xba, 0x64, 0x2f, 0x84, 0x27, 0x58, 0xee, 0xf7, 0x10, 0x4f,
                   0x82, 0xf1, 0xc9, 0x9e, 0xea, 0x0,  0x5,  0x41, 0x1a, 0xa6, 0x78, 0x0,  0x0,  0xe,  0xfd, 0x30,
                   0x83, 0x6e, 0xa2, 0xec, 0xc0, 0x7f, 0x20, 0x96, 0x2e, 0xf,  0xae, 0xa3, 0x0,  0x1,  0x98, 0x0,
                   0x1b, 0xae, 0x98, 0x78, 0x2c, 0xd6, 0x4f, 0xb7, 0xf9, 0x2c, 0x6f, 0x22, 0x89, 0xaa, 0x6d, 0xf4,
                   0xa4, 0xcb, 0x6,  0xba, 0xb3, 0xd9, 0x40, 0x20, 0x5f, 0x5b, 0xd,  0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x41, 0x1a, 0xa6, 0x78, 0x0};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfd, 0x30, 0x83, 0x6e, 0xa2, 0xec, 0xc0, 0x7f, 0x20, 0x96, 0x2e, 0xf, 0xae, 0xa3};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11096;
  uint8_t client_id_bytes[] = {0xcf, 0xd,  0xb7, 0x35, 0x63, 0x60, 0xd0, 0x2b, 0xba, 0x64, 0x2f, 0x84,
                               0x27, 0x58, 0xee, 0xf7, 0x10, 0x4f, 0x82, 0xf1, 0xc9, 0x9e, 0xea};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x98};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xae, 0x98, 0x78, 0x2c, 0xd6, 0x4f, 0xb7, 0xf9, 0x2c, 0x6f, 0x22, 0x89, 0xaa, 0x6d,
                              0xf4, 0xa4, 0xcb, 0x6,  0xba, 0xb3, 0xd9, 0x40, 0x20, 0x5f, 0x5b, 0xd,  0x3e};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\254\216\220\247\151\136\DC1\188~L\248\142", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "U6Dw\178\166\201q\230\187\STX\187>P\180\&1\224[W\181\GS:", _willMsg = "", _willProps = []}), _cleanSession = False,
// _keepAlive = 29562, _connID = "~\233\223\144\214,\GSg\DLE\144\196=<", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8c, 0x73, 0x7a, 0x0,  0xd,  0x7e, 0xe9, 0xdf,
                   0x90, 0xd6, 0x2c, 0x1d, 0x67, 0x10, 0x90, 0xc4, 0x3d, 0x3c, 0x0,  0x16, 0x55, 0x36, 0x44, 0x77, 0xb2,
                   0xa6, 0xc9, 0x71, 0xe6, 0xbb, 0x2,  0xbb, 0x3e, 0x50, 0xb4, 0x31, 0xe0, 0x5b, 0x57, 0xb5, 0x1d, 0x3a,
                   0x0,  0x0,  0x0,  0xc,  0xfe, 0xd8, 0xdc, 0xf7, 0x97, 0x88, 0x11, 0xbc, 0x7e, 0x4c, 0xf8, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x55, 0x36, 0x44, 0x77, 0xb2, 0xa6, 0xc9, 0x71, 0xe6, 0xbb, 0x2,
                                0xbb, 0x3e, 0x50, 0xb4, 0x31, 0xe0, 0x5b, 0x57, 0xb5, 0x1d, 0x3a};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29562;
  uint8_t client_id_bytes[] = {0x7e, 0xe9, 0xdf, 0x90, 0xd6, 0x2c, 0x1d, 0x67, 0x10, 0x90, 0xc4, 0x3d, 0x3c};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfe, 0xd8, 0xdc, 0xf7, 0x97, 0x88, 0x11, 0xbc, 0x7e, 0x4c, 0xf8, 0x8e};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "W\NAK1\208\fP\SYN\143\223", _password = Just
// "-\161\CAN\233\GSA\129\195n,\214\STX\138", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1,
// _willTopic = "\163", _willMsg = "^\216\194\&8-V`\191\"\215\247\221\210\t\EOT\SOt\209\205\SI\SO", _willProps = []}),
// _cleanSession = True, _keepAlive = 7229, _connID = "h$3\ESC%\229\134-\RS\205O", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x4b, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x1c, 0x3d, 0x0,  0xb,  0x68, 0x24,
                   0x33, 0x1b, 0x25, 0xe5, 0x86, 0x2d, 0x1e, 0xcd, 0x4f, 0x0,  0x1,  0xa3, 0x0,  0x15, 0x5e, 0xd8,
                   0xc2, 0x38, 0x2d, 0x56, 0x60, 0xbf, 0x22, 0xd7, 0xf7, 0xdd, 0xd2, 0x9,  0x4,  0xe,  0x74, 0xd1,
                   0xcd, 0xf,  0xe,  0x0,  0x9,  0x57, 0x15, 0x31, 0xd0, 0xc,  0x50, 0x16, 0x8f, 0xdf, 0x0,  0xd,
                   0x2d, 0xa1, 0x18, 0xe9, 0x1d, 0x41, 0x81, 0xc3, 0x6e, 0x2c, 0xd6, 0x2,  0x8a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa3};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5e, 0xd8, 0xc2, 0x38, 0x2d, 0x56, 0x60, 0xbf, 0x22, 0xd7, 0xf7,
                                  0xdd, 0xd2, 0x9,  0x4,  0xe,  0x74, 0xd1, 0xcd, 0xf,  0xe};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7229;
  uint8_t client_id_bytes[] = {0x68, 0x24, 0x33, 0x1b, 0x25, 0xe5, 0x86, 0x2d, 0x1e, 0xcd, 0x4f};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x57, 0x15, 0x31, 0xd0, 0xc, 0x50, 0x16, 0x8f, 0xdf};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2d, 0xa1, 0x18, 0xe9, 0x1d, 0x41, 0x81, 0xc3, 0x6e, 0x2c, 0xd6, 0x2, 0x8a};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "E\158", _password = Nothing, _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "\SUB\167\200rR\DEL\237>\147\&3\t-\134,", _willMsg =
// "\EOT{\DC2S\216=\181\216\SOH\225\153\&6(\205\197\&1\ETX\STX\DEL", _willProps = []}), _cleanSession = True, _keepAlive
// = 27479, _connID = "\237\&2\143\179g\138\189\190\155l\NUL\242~\ETXJ\222^\147-\STX\140\210\198a\249", _properties =
// []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x86, 0x6b, 0x57, 0x0,  0x19, 0xed, 0x32,
                   0x8f, 0xb3, 0x67, 0x8a, 0xbd, 0xbe, 0x9b, 0x6c, 0x0,  0xf2, 0x7e, 0x3,  0x4a, 0xde, 0x5e, 0x93,
                   0x2d, 0x2,  0x8c, 0xd2, 0xc6, 0x61, 0xf9, 0x0,  0xe,  0x1a, 0xa7, 0xc8, 0x72, 0x52, 0x7f, 0xed,
                   0x3e, 0x93, 0x33, 0x9,  0x2d, 0x86, 0x2c, 0x0,  0x13, 0x4,  0x7b, 0x12, 0x53, 0xd8, 0x3d, 0xb5,
                   0xd8, 0x1,  0xe1, 0x99, 0x36, 0x28, 0xcd, 0xc5, 0x31, 0x3,  0x2,  0x7f, 0x0,  0x2,  0x45, 0x9e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1a, 0xa7, 0xc8, 0x72, 0x52, 0x7f, 0xed, 0x3e, 0x93, 0x33, 0x9, 0x2d, 0x86, 0x2c};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4,  0x7b, 0x12, 0x53, 0xd8, 0x3d, 0xb5, 0xd8, 0x1, 0xe1,
                                  0x99, 0x36, 0x28, 0xcd, 0xc5, 0x31, 0x3,  0x2,  0x7f};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27479;
  uint8_t client_id_bytes[] = {0xed, 0x32, 0x8f, 0xb3, 0x67, 0x8a, 0xbd, 0xbe, 0x9b, 0x6c, 0x0,  0xf2, 0x7e,
                               0x3,  0x4a, 0xde, 0x5e, 0x93, 0x2d, 0x2,  0x8c, 0xd2, 0xc6, 0x61, 0xf9};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x45, 0x9e};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\201\216\NAK\238\243\185\202\212?\188\224\STX/\198h\162\159z\193", _password = Just
// "\220\192\199\173G\186\161\178", _lastWill = Nothing, _cleanSession = True, _keepAlive = 7221, _connID =
// "\191nx\FSO\157\147i\209\143\DC2\STX\160\SI\215", _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0x1c, 0x35, 0x0,  0xf,  0xbf,
                   0x6e, 0x78, 0x1c, 0x4f, 0x9d, 0x93, 0x69, 0xd1, 0x8f, 0x12, 0x2,  0xa0, 0xf,  0xd7, 0x0,
                   0x13, 0xc9, 0xd8, 0x15, 0xee, 0xf3, 0xb9, 0xca, 0xd4, 0x3f, 0xbc, 0xe0, 0x2,  0x2f, 0xc6,
                   0x68, 0xa2, 0x9f, 0x7a, 0xc1, 0x0,  0x8,  0xdc, 0xc0, 0xc7, 0xad, 0x47, 0xba, 0xa1, 0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7221;
  uint8_t client_id_bytes[] = {0xbf, 0x6e, 0x78, 0x1c, 0x4f, 0x9d, 0x93, 0x69, 0xd1, 0x8f, 0x12, 0x2, 0xa0, 0xf, 0xd7};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc9, 0xd8, 0x15, 0xee, 0xf3, 0xb9, 0xca, 0xd4, 0x3f, 0xbc,
                              0xe0, 0x2,  0x2f, 0xc6, 0x68, 0xa2, 0x9f, 0x7a, 0xc1};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdc, 0xc0, 0xc7, 0xad, 0x47, 0xba, 0xa1, 0xb2};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "]k\133\158\155\DC3\CANdB\149\244\NAKV\174", _password = Just
// "\243e\SUB\196D\v\196W8P\245\&6", _lastWill = Nothing, _cleanSession = True, _keepAlive = 1258, _connID =
// "q\SOH\220\128\ncN%\188\&7\248FP@\170\NUL\DELN\194\221o", _properties = [PropResponseInformation
// "\206Z\167\210\141\164\"\180\184mzlv\176\149\207?\137\234",PropAssignedClientIdentifier "hf",PropServerReference
// "aj\NUL\173\200\232\211\EMC,q\b]y\136f\EOT\ENQ:>E",PropTopicAliasMaximum 23557,PropSubscriptionIdentifierAvailable
// 215,PropReasonString
// "\192|;\RS\214}\216\205\196\151\160q\178\DLE\251\224\201`\209\DLE=\198\EOT-",PropSharedSubscriptionAvailable
// 29,PropReceiveMaximum 13694,PropServerKeepAlive 28821,PropRetainAvailable 74,PropResponseTopic "\190\129\133\208"]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0xa4, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x4,  0xea, 0x64, 0x1a, 0x0,  0x13,
                   0xce, 0x5a, 0xa7, 0xd2, 0x8d, 0xa4, 0x22, 0xb4, 0xb8, 0x6d, 0x7a, 0x6c, 0x76, 0xb0, 0x95, 0xcf, 0x3f,
                   0x89, 0xea, 0x12, 0x0,  0x2,  0x68, 0x66, 0x1c, 0x0,  0x15, 0x61, 0x6a, 0x0,  0xad, 0xc8, 0xe8, 0xd3,
                   0x19, 0x43, 0x2c, 0x71, 0x8,  0x5d, 0x79, 0x88, 0x66, 0x4,  0x5,  0x3a, 0x3e, 0x45, 0x22, 0x5c, 0x5,
                   0x29, 0xd7, 0x1f, 0x0,  0x18, 0xc0, 0x7c, 0x3b, 0x1e, 0xd6, 0x7d, 0xd8, 0xcd, 0xc4, 0x97, 0xa0, 0x71,
                   0xb2, 0x10, 0xfb, 0xe0, 0xc9, 0x60, 0xd1, 0x10, 0x3d, 0xc6, 0x4,  0x2d, 0x2a, 0x1d, 0x21, 0x35, 0x7e,
                   0x13, 0x70, 0x95, 0x25, 0x4a, 0x8,  0x0,  0x4,  0xbe, 0x81, 0x85, 0xd0, 0x0,  0x15, 0x71, 0x1,  0xdc,
                   0x80, 0xa,  0x63, 0x4e, 0x25, 0xbc, 0x37, 0xf8, 0x46, 0x50, 0x40, 0xaa, 0x0,  0x7f, 0x4e, 0xc2, 0xdd,
                   0x6f, 0x0,  0xe,  0x5d, 0x6b, 0x85, 0x9e, 0x9b, 0x13, 0x18, 0x64, 0x42, 0x95, 0xf4, 0x15, 0x56, 0xae,
                   0x0,  0xc,  0xf3, 0x65, 0x1a, 0xc4, 0x44, 0xb,  0xc4, 0x57, 0x38, 0x50, 0xf5, 0x36};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xce, 0x5a, 0xa7, 0xd2, 0x8d, 0xa4, 0x22, 0xb4, 0xb8, 0x6d,
                           0x7a, 0x6c, 0x76, 0xb0, 0x95, 0xcf, 0x3f, 0x89, 0xea};
  uint8_t bytesprops1[] = {0x68, 0x66};
  uint8_t bytesprops2[] = {0x61, 0x6a, 0x0,  0xad, 0xc8, 0xe8, 0xd3, 0x19, 0x43, 0x2c, 0x71,
                           0x8,  0x5d, 0x79, 0x88, 0x66, 0x4,  0x5,  0x3a, 0x3e, 0x45};
  uint8_t bytesprops3[] = {0xc0, 0x7c, 0x3b, 0x1e, 0xd6, 0x7d, 0xd8, 0xcd, 0xc4, 0x97, 0xa0, 0x71,
                           0xb2, 0x10, 0xfb, 0xe0, 0xc9, 0x60, 0xd1, 0x10, 0x3d, 0xc6, 0x4,  0x2d};
  uint8_t bytesprops4[] = {0xbe, 0x81, 0x85, 0xd0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23557}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13694}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28821}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 1258;
  uint8_t client_id_bytes[] = {0x71, 0x1,  0xdc, 0x80, 0xa, 0x63, 0x4e, 0x25, 0xbc, 0x37, 0xf8,
                               0x46, 0x50, 0x40, 0xaa, 0x0, 0x7f, 0x4e, 0xc2, 0xdd, 0x6f};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5d, 0x6b, 0x85, 0x9e, 0x9b, 0x13, 0x18, 0x64, 0x42, 0x95, 0xf4, 0x15, 0x56, 0xae};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf3, 0x65, 0x1a, 0xc4, 0x44, 0xb, 0xc4, 0x57, 0x38, 0x50, 0xf5, 0x36};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "G>+\146\187X\SUB\205\220Z.\247\207\STX", _password = Just "l\254", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "H\158\252\SO\244\128\177\DC3\140m\154C\228\255\209\SO\252\215Wt\129t}\131", _willMsg =
// ";\228r\149\RS]\243u\250o\247\164,_\199", _willProps = [PropSubscriptionIdentifier 9,PropSessionExpiryInterval
// 20324,PropRequestResponseInformation 35,PropServerReference "",PropRequestProblemInformation
// 170,PropSessionExpiryInterval 14603,PropWillDelayInterval 29990,PropSubscriptionIdentifierAvailable 90]}),
// _cleanSession = False, _keepAlive = 6895, _connID = "/\215\GS\133\&67\233\250\218\RS\249)\ETB", _properties =
// [PropSharedSubscriptionAvailable 226,PropTopicAliasMaximum 13928]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x79, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x1a, 0xef, 0x5,  0x2a, 0xe2, 0x22,
                   0x36, 0x68, 0x0,  0xd,  0x2f, 0xd7, 0x1d, 0x85, 0x36, 0x37, 0xe9, 0xfa, 0xda, 0x1e, 0xf9, 0x29,
                   0x17, 0x1a, 0xb,  0x9,  0x11, 0x0,  0x0,  0x4f, 0x64, 0x19, 0x23, 0x1c, 0x0,  0x0,  0x17, 0xaa,
                   0x11, 0x0,  0x0,  0x39, 0xb,  0x18, 0x0,  0x0,  0x75, 0x26, 0x29, 0x5a, 0x0,  0x18, 0x48, 0x9e,
                   0xfc, 0xe,  0xf4, 0x80, 0xb1, 0x13, 0x8c, 0x6d, 0x9a, 0x43, 0xe4, 0xff, 0xd1, 0xe,  0xfc, 0xd7,
                   0x57, 0x74, 0x81, 0x74, 0x7d, 0x83, 0x0,  0xf,  0x3b, 0xe4, 0x72, 0x95, 0x1e, 0x5d, 0xf3, 0x75,
                   0xfa, 0x6f, 0xf7, 0xa4, 0x2c, 0x5f, 0xc7, 0x0,  0xe,  0x47, 0x3e, 0x2b, 0x92, 0xbb, 0x58, 0x1a,
                   0xcd, 0xdc, 0x5a, 0x2e, 0xf7, 0xcf, 0x2,  0x0,  0x2,  0x6c, 0xfe};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13928}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20324}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14603}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29990}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 90}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x48, 0x9e, 0xfc, 0xe, 0xf4, 0x80, 0xb1, 0x13, 0x8c, 0x6d, 0x9a, 0x43,
                                0xe4, 0xff, 0xd1, 0xe, 0xfc, 0xd7, 0x57, 0x74, 0x81, 0x74, 0x7d, 0x83};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3b, 0xe4, 0x72, 0x95, 0x1e, 0x5d, 0xf3, 0x75,
                                  0xfa, 0x6f, 0xf7, 0xa4, 0x2c, 0x5f, 0xc7};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6895;
  uint8_t client_id_bytes[] = {0x2f, 0xd7, 0x1d, 0x85, 0x36, 0x37, 0xe9, 0xfa, 0xda, 0x1e, 0xf9, 0x29, 0x17};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x47, 0x3e, 0x2b, 0x92, 0xbb, 0x58, 0x1a, 0xcd, 0xdc, 0x5a, 0x2e, 0xf7, 0xcf, 0x2};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6c, 0xfe};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "P\174D\148^\175O\GS", _password = Nothing, _lastWill = Just (LastWill {_willRetain
// = True, _willQoS = QoS0, _willTopic =
// "\133\148;\217\ETX\ESCx\227\193\b\220\220\&2^\206\247,\208\184E\206g\130\RS\174\176\224", _willMsg =
// "&2\134`\139\156\254r\254!RA2\206\243\188", _willProps = [PropRequestResponseInformation 41,PropServerKeepAlive
// 6037,PropWillDelayInterval 27175,PropRequestResponseInformation 221,PropResponseInformation
// "~\DC1?\131\177\194E\176\251mF\241\251\180E\SOH\159",PropServerReference
// "\180'\165\245\215\158",PropWildcardSubscriptionAvailable 180,PropCorrelationData
// "Id\SOH\213\219L\168\173\DC1y",PropSubscriptionIdentifier 9,PropMessageExpiryInterval 13265,PropResponseTopic
// "<\208\227\226Q\vIi\163\231\244\200F\162\&1)\SO\EM\206",PropUserProperty
// "\139\145bW\CAN\204\244\213B\245\245\SO\242\189K\176\137\231T-\\\DC3"
// "cx_\162\173\171+dB\ETB\198Z\216\232jpq\140\211HX:\248\158\US,",PropTopicAlias
// 30639,PropSubscriptionIdentifierAvailable 134,PropWillDelayInterval 32737,PropServerReference
// "\SI\b",PropMessageExpiryInterval 15476,PropCorrelationData "\161\240*\233n\RS\216
// \213p)\146B\136e\199\158\223\166X\169\183",PropPayloadFormatIndicator 9]}), _cleanSession = False, _keepAlive =
// 25004, _connID = "/}b5\208\133\FS\133\214c\NUL\151\144\NUL\172\SO\168&&\150\174\191N\206", _properties =
// [PropServerReference "Z\160\206\229X\251-H\tu'\NUL\252\RS\244d\238",PropSharedSubscriptionAvailable
// 203,PropSharedSubscriptionAvailable 239,PropContentType "\165\SUBU\206\&5\250;H",PropAssignedClientIdentifier
// "yHF3\182\170\&0\174%\238\SO\152\ESC\191\176\&7Ov",PropMaximumQoS 220,PropServerKeepAlive
// 29952,PropSubscriptionIdentifier 11,PropMaximumQoS 184,PropReasonString
// "\214\136n*\250\233\\m\208\DC3L\a\135\192\EM\201\RSL\228",PropResponseInformation
// "\ETX\137\247F",PropMessageExpiryInterval 6277,PropAuthenticationData "\DC1q\214\&2\206F\137#\240\144D<4p\NUL"]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0x8e, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xa4, 0x61, 0xac, 0x75, 0x1c, 0x0,  0x11, 0x5a, 0xa0,
      0xce, 0xe5, 0x58, 0xfb, 0x2d, 0x48, 0x9,  0x75, 0x27, 0x0,  0xfc, 0x1e, 0xf4, 0x64, 0xee, 0x2a, 0xcb, 0x2a, 0xef,
      0x3,  0x0,  0x8,  0xa5, 0x1a, 0x55, 0xce, 0x35, 0xfa, 0x3b, 0x48, 0x12, 0x0,  0x12, 0x79, 0x48, 0x46, 0x33, 0xb6,
      0xaa, 0x30, 0xae, 0x25, 0xee, 0xe,  0x98, 0x1b, 0xbf, 0xb0, 0x37, 0x4f, 0x76, 0x24, 0xdc, 0x13, 0x75, 0x0,  0xb,
      0xb,  0x24, 0xb8, 0x1f, 0x0,  0x13, 0xd6, 0x88, 0x6e, 0x2a, 0xfa, 0xe9, 0x5c, 0x6d, 0xd0, 0x13, 0x4c, 0x7,  0x87,
      0xc0, 0x19, 0xc9, 0x1e, 0x4c, 0xe4, 0x1a, 0x0,  0x4,  0x3,  0x89, 0xf7, 0x46, 0x2,  0x0,  0x0,  0x18, 0x85, 0x16,
      0x0,  0xf,  0x11, 0x71, 0xd6, 0x32, 0xce, 0x46, 0x89, 0x23, 0xf0, 0x90, 0x44, 0x3c, 0x34, 0x70, 0x0,  0x0,  0x18,
      0x2f, 0x7d, 0x62, 0x35, 0xd0, 0x85, 0x1c, 0x85, 0xd6, 0x63, 0x0,  0x97, 0x90, 0x0,  0xac, 0xe,  0xa8, 0x26, 0x26,
      0x96, 0xae, 0xbf, 0x4e, 0xce, 0xb9, 0x1,  0x19, 0x29, 0x13, 0x17, 0x95, 0x18, 0x0,  0x0,  0x6a, 0x27, 0x19, 0xdd,
      0x1a, 0x0,  0x11, 0x7e, 0x11, 0x3f, 0x83, 0xb1, 0xc2, 0x45, 0xb0, 0xfb, 0x6d, 0x46, 0xf1, 0xfb, 0xb4, 0x45, 0x1,
      0x9f, 0x1c, 0x0,  0x6,  0xb4, 0x27, 0xa5, 0xf5, 0xd7, 0x9e, 0x28, 0xb4, 0x9,  0x0,  0xa,  0x49, 0x64, 0x1,  0xd5,
      0xdb, 0x4c, 0xa8, 0xad, 0x11, 0x79, 0xb,  0x9,  0x2,  0x0,  0x0,  0x33, 0xd1, 0x8,  0x0,  0x13, 0x3c, 0xd0, 0xe3,
      0xe2, 0x51, 0xb,  0x49, 0x69, 0xa3, 0xe7, 0xf4, 0xc8, 0x46, 0xa2, 0x31, 0x29, 0xe,  0x19, 0xce, 0x26, 0x0,  0x16,
      0x8b, 0x91, 0x62, 0x57, 0x18, 0xcc, 0xf4, 0xd5, 0x42, 0xf5, 0xf5, 0xe,  0xf2, 0xbd, 0x4b, 0xb0, 0x89, 0xe7, 0x54,
      0x2d, 0x5c, 0x13, 0x0,  0x1a, 0x63, 0x78, 0x5f, 0xa2, 0xad, 0xab, 0x2b, 0x64, 0x42, 0x17, 0xc6, 0x5a, 0xd8, 0xe8,
      0x6a, 0x70, 0x71, 0x8c, 0xd3, 0x48, 0x58, 0x3a, 0xf8, 0x9e, 0x1f, 0x2c, 0x23, 0x77, 0xaf, 0x29, 0x86, 0x18, 0x0,
      0x0,  0x7f, 0xe1, 0x1c, 0x0,  0x2,  0xf,  0x8,  0x2,  0x0,  0x0,  0x3c, 0x74, 0x9,  0x0,  0x16, 0xa1, 0xf0, 0x2a,
      0xe9, 0x6e, 0x1e, 0xd8, 0x20, 0xd5, 0x70, 0x29, 0x92, 0x42, 0x88, 0x65, 0xc7, 0x9e, 0xdf, 0xa6, 0x58, 0xa9, 0xb7,
      0x1,  0x9,  0x0,  0x1b, 0x85, 0x94, 0x3b, 0xd9, 0x3,  0x1b, 0x78, 0xe3, 0xc1, 0x8,  0xdc, 0xdc, 0x32, 0x5e, 0xce,
      0xf7, 0x2c, 0xd0, 0xb8, 0x45, 0xce, 0x67, 0x82, 0x1e, 0xae, 0xb0, 0xe0, 0x0,  0x10, 0x26, 0x32, 0x86, 0x60, 0x8b,
      0x9c, 0xfe, 0x72, 0xfe, 0x21, 0x52, 0x41, 0x32, 0xce, 0xf3, 0xbc, 0x0,  0x8,  0x50, 0xae, 0x44, 0x94, 0x5e, 0xaf,
      0x4f, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5a, 0xa0, 0xce, 0xe5, 0x58, 0xfb, 0x2d, 0x48, 0x9,
                           0x75, 0x27, 0x0,  0xfc, 0x1e, 0xf4, 0x64, 0xee};
  uint8_t bytesprops1[] = {0xa5, 0x1a, 0x55, 0xce, 0x35, 0xfa, 0x3b, 0x48};
  uint8_t bytesprops2[] = {0x79, 0x48, 0x46, 0x33, 0xb6, 0xaa, 0x30, 0xae, 0x25,
                           0xee, 0xe,  0x98, 0x1b, 0xbf, 0xb0, 0x37, 0x4f, 0x76};
  uint8_t bytesprops3[] = {0xd6, 0x88, 0x6e, 0x2a, 0xfa, 0xe9, 0x5c, 0x6d, 0xd0, 0x13,
                           0x4c, 0x7,  0x87, 0xc0, 0x19, 0xc9, 0x1e, 0x4c, 0xe4};
  uint8_t bytesprops4[] = {0x3, 0x89, 0xf7, 0x46};
  uint8_t bytesprops5[] = {0x11, 0x71, 0xd6, 0x32, 0xce, 0x46, 0x89, 0x23, 0xf0, 0x90, 0x44, 0x3c, 0x34, 0x70, 0x0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29952}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6277}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x7e, 0x11, 0x3f, 0x83, 0xb1, 0xc2, 0x45, 0xb0, 0xfb,
                               0x6d, 0x46, 0xf1, 0xfb, 0xb4, 0x45, 0x1,  0x9f};
  uint8_t byteswillprops1[] = {0xb4, 0x27, 0xa5, 0xf5, 0xd7, 0x9e};
  uint8_t byteswillprops2[] = {0x49, 0x64, 0x1, 0xd5, 0xdb, 0x4c, 0xa8, 0xad, 0x11, 0x79};
  uint8_t byteswillprops3[] = {0x3c, 0xd0, 0xe3, 0xe2, 0x51, 0xb,  0x49, 0x69, 0xa3, 0xe7,
                               0xf4, 0xc8, 0x46, 0xa2, 0x31, 0x29, 0xe,  0x19, 0xce};
  uint8_t byteswillprops5[] = {0x63, 0x78, 0x5f, 0xa2, 0xad, 0xab, 0x2b, 0x64, 0x42, 0x17, 0xc6, 0x5a, 0xd8,
                               0xe8, 0x6a, 0x70, 0x71, 0x8c, 0xd3, 0x48, 0x58, 0x3a, 0xf8, 0x9e, 0x1f, 0x2c};
  uint8_t byteswillprops4[] = {0x8b, 0x91, 0x62, 0x57, 0x18, 0xcc, 0xf4, 0xd5, 0x42, 0xf5, 0xf5,
                               0xe,  0xf2, 0xbd, 0x4b, 0xb0, 0x89, 0xe7, 0x54, 0x2d, 0x5c, 0x13};
  uint8_t byteswillprops6[] = {0xf, 0x8};
  uint8_t byteswillprops7[] = {0xa1, 0xf0, 0x2a, 0xe9, 0x6e, 0x1e, 0xd8, 0x20, 0xd5, 0x70, 0x29,
                               0x92, 0x42, 0x88, 0x65, 0xc7, 0x9e, 0xdf, 0xa6, 0x58, 0xa9, 0xb7};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6037}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27175}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13265}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {22, (char*)&byteswillprops4}, .v = {26, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30639}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32737}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15476}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 9}},
  };

  lwmqtt_properties_t willprops = {19, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x85, 0x94, 0x3b, 0xd9, 0x3,  0x1b, 0x78, 0xe3, 0xc1, 0x8,  0xdc, 0xdc, 0x32, 0x5e,
                                0xce, 0xf7, 0x2c, 0xd0, 0xb8, 0x45, 0xce, 0x67, 0x82, 0x1e, 0xae, 0xb0, 0xe0};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x26, 0x32, 0x86, 0x60, 0x8b, 0x9c, 0xfe, 0x72,
                                  0xfe, 0x21, 0x52, 0x41, 0x32, 0xce, 0xf3, 0xbc};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 25004;
  uint8_t client_id_bytes[] = {0x2f, 0x7d, 0x62, 0x35, 0xd0, 0x85, 0x1c, 0x85, 0xd6, 0x63, 0x0,  0x97,
                               0x90, 0x0,  0xac, 0xe,  0xa8, 0x26, 0x26, 0x96, 0xae, 0xbf, 0x4e, 0xce};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x50, 0xae, 0x44, 0x94, 0x5e, 0xaf, 0x4f, 0x1d};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "t~B\193\194g\135.\205\195'\202\&4\254\167\130&}\131\SO(",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\167\209\SI\144\184\148\175\153P3\152[\245s\f\160\STX\173\250\248\&6|\vh\134\236\&6\214\237E", _willMsg =
// "K9\178\239\192\180\&4\159\238\219\254cw\137\\K\177\175\230", _willProps = [PropReasonString
// "\CAN<&\222\203P5N\225\250\235\225\186\240<@\227\&6\169\169",PropReasonString
// "\205\n\152#\251\168\162\NUL\f\133\252\b\FS\151\US\180\136\&5\209k\237\154",PropMessageExpiryInterval
// 177,PropSharedSubscriptionAvailable 106,PropResponseInformation
// "c7`F#l\162\173\133\236\v\198\224\DC4E\n\167\ACK",PropMaximumQoS 250,PropReceiveMaximum 1733,PropRetainAvailable
// 190,PropSharedSubscriptionAvailable 152,PropMaximumPacketSize 18199,PropResponseInformation "\166\171\210\207\135
// \190\134\188\"\SOW4\136\&2~\163\&0\237\195\191\&9\237\189 2",PropSubscriptionIdentifier 6,PropTopicAlias
// 3403,PropServerReference "",PropTopicAliasMaximum 6329,PropSharedSubscriptionAvailable
// 65,PropSubscriptionIdentifierAvailable 0,PropAuthenticationData "_\STX\222?P\253\STX}\165s\141"]}), _cleanSession =
// False, _keepAlive = 30510, _connID =
// "\254\DC1x\142\180\241\164\178u\EMn\150\196Ks<d\"\167G\133\156\167j-\197\131N\207", _properties =
// [PropSharedSubscriptionAvailable 250,PropMaximumPacketSize 20027,PropWillDelayInterval 21926,PropServerReference
// "\ACK\241\135\RS\141j-\r~\170/\218\226\230&\158\237|\161",PropAuthenticationData "",PropRetainAvailable
// 139,PropSharedSubscriptionAvailable 60,PropTopicAliasMaximum 12873,PropAuthenticationData
// "\245\186\214\RSN\237M\a\253\DC1\177\180#\205\185\166QH\189\193C\231\244\152\153\254\b^g",PropSessionExpiryInterval
// 24345,PropReceiveMaximum 16120,PropSubscriptionIdentifier 28]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xe2, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6c, 0x77, 0x2e, 0x56, 0x2a, 0xfa, 0x27, 0x0,  0x0,
      0x4e, 0x3b, 0x18, 0x0,  0x0,  0x55, 0xa6, 0x1c, 0x0,  0x13, 0x6,  0xf1, 0x87, 0x1e, 0x8d, 0x6a, 0x2d, 0xd,  0x7e,
      0xaa, 0x2f, 0xda, 0xe2, 0xe6, 0x26, 0x9e, 0xed, 0x7c, 0xa1, 0x16, 0x0,  0x0,  0x25, 0x8b, 0x2a, 0x3c, 0x22, 0x32,
      0x49, 0x16, 0x0,  0x1d, 0xf5, 0xba, 0xd6, 0x1e, 0x4e, 0xed, 0x4d, 0x7,  0xfd, 0x11, 0xb1, 0xb4, 0x23, 0xcd, 0xb9,
      0xa6, 0x51, 0x48, 0xbd, 0xc1, 0x43, 0xe7, 0xf4, 0x98, 0x99, 0xfe, 0x8,  0x5e, 0x67, 0x11, 0x0,  0x0,  0x5f, 0x19,
      0x21, 0x3e, 0xf8, 0xb,  0x1c, 0x0,  0x1d, 0xfe, 0x11, 0x78, 0x8e, 0xb4, 0xf1, 0xa4, 0xb2, 0x75, 0x19, 0x6e, 0x96,
      0xc4, 0x4b, 0x73, 0x3c, 0x64, 0x22, 0xa7, 0x47, 0x85, 0x9c, 0xa7, 0x6a, 0x2d, 0xc5, 0x83, 0x4e, 0xcf, 0x94, 0x1,
      0x1f, 0x0,  0x14, 0x18, 0x3c, 0x26, 0xde, 0xcb, 0x50, 0x35, 0x4e, 0xe1, 0xfa, 0xeb, 0xe1, 0xba, 0xf0, 0x3c, 0x40,
      0xe3, 0x36, 0xa9, 0xa9, 0x1f, 0x0,  0x16, 0xcd, 0xa,  0x98, 0x23, 0xfb, 0xa8, 0xa2, 0x0,  0xc,  0x85, 0xfc, 0x8,
      0x1c, 0x97, 0x1f, 0xb4, 0x88, 0x35, 0xd1, 0x6b, 0xed, 0x9a, 0x2,  0x0,  0x0,  0x0,  0xb1, 0x2a, 0x6a, 0x1a, 0x0,
      0x12, 0x63, 0x37, 0x60, 0x46, 0x23, 0x6c, 0xa2, 0xad, 0x85, 0xec, 0xb,  0xc6, 0xe0, 0x14, 0x45, 0xa,  0xa7, 0x6,
      0x24, 0xfa, 0x21, 0x6,  0xc5, 0x25, 0xbe, 0x2a, 0x98, 0x27, 0x0,  0x0,  0x47, 0x17, 0x1a, 0x0,  0x1a, 0xa6, 0xab,
      0xd2, 0xcf, 0x87, 0x20, 0xbe, 0x86, 0xbc, 0x22, 0xe,  0x57, 0x34, 0x88, 0x32, 0x7e, 0xa3, 0x30, 0xed, 0xc3, 0xbf,
      0x39, 0xed, 0xbd, 0x20, 0x32, 0xb,  0x6,  0x23, 0xd,  0x4b, 0x1c, 0x0,  0x0,  0x22, 0x18, 0xb9, 0x2a, 0x41, 0x29,
      0x0,  0x16, 0x0,  0xb,  0x5f, 0x2,  0xde, 0x3f, 0x50, 0xfd, 0x2,  0x7d, 0xa5, 0x73, 0x8d, 0x0,  0x1e, 0xa7, 0xd1,
      0xf,  0x90, 0xb8, 0x94, 0xaf, 0x99, 0x50, 0x33, 0x98, 0x5b, 0xf5, 0x73, 0xc,  0xa0, 0x2,  0xad, 0xfa, 0xf8, 0x36,
      0x7c, 0xb,  0x68, 0x86, 0xec, 0x36, 0xd6, 0xed, 0x45, 0x0,  0x13, 0x4b, 0x39, 0xb2, 0xef, 0xc0, 0xb4, 0x34, 0x9f,
      0xee, 0xdb, 0xfe, 0x63, 0x77, 0x89, 0x5c, 0x4b, 0xb1, 0xaf, 0xe6, 0x0,  0x15, 0x74, 0x7e, 0x42, 0xc1, 0xc2, 0x67,
      0x87, 0x2e, 0xcd, 0xc3, 0x27, 0xca, 0x34, 0xfe, 0xa7, 0x82, 0x26, 0x7d, 0x83, 0xe,  0x28};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6,  0xf1, 0x87, 0x1e, 0x8d, 0x6a, 0x2d, 0xd,  0x7e, 0xaa,
                           0x2f, 0xda, 0xe2, 0xe6, 0x26, 0x9e, 0xed, 0x7c, 0xa1};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0xf5, 0xba, 0xd6, 0x1e, 0x4e, 0xed, 0x4d, 0x7,  0xfd, 0x11, 0xb1, 0xb4, 0x23, 0xcd, 0xb9,
                           0xa6, 0x51, 0x48, 0xbd, 0xc1, 0x43, 0xe7, 0xf4, 0x98, 0x99, 0xfe, 0x8,  0x5e, 0x67};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20027}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21926}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12873}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24345}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16120}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x18, 0x3c, 0x26, 0xde, 0xcb, 0x50, 0x35, 0x4e, 0xe1, 0xfa,
                               0xeb, 0xe1, 0xba, 0xf0, 0x3c, 0x40, 0xe3, 0x36, 0xa9, 0xa9};
  uint8_t byteswillprops1[] = {0xcd, 0xa,  0x98, 0x23, 0xfb, 0xa8, 0xa2, 0x0,  0xc,  0x85, 0xfc,
                               0x8,  0x1c, 0x97, 0x1f, 0xb4, 0x88, 0x35, 0xd1, 0x6b, 0xed, 0x9a};
  uint8_t byteswillprops2[] = {0x63, 0x37, 0x60, 0x46, 0x23, 0x6c, 0xa2, 0xad, 0x85,
                               0xec, 0xb,  0xc6, 0xe0, 0x14, 0x45, 0xa,  0xa7, 0x6};
  uint8_t byteswillprops3[] = {0xa6, 0xab, 0xd2, 0xcf, 0x87, 0x20, 0xbe, 0x86, 0xbc, 0x22, 0xe,  0x57, 0x34,
                               0x88, 0x32, 0x7e, 0xa3, 0x30, 0xed, 0xc3, 0xbf, 0x39, 0xed, 0xbd, 0x20, 0x32};
  uint8_t byteswillprops4[] = {0};
  uint8_t byteswillprops5[] = {0x5f, 0x2, 0xde, 0x3f, 0x50, 0xfd, 0x2, 0x7d, 0xa5, 0x73, 0x8d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 177}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1733}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18199}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3403}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6329}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa7, 0xd1, 0xf,  0x90, 0xb8, 0x94, 0xaf, 0x99, 0x50, 0x33,
                                0x98, 0x5b, 0xf5, 0x73, 0xc,  0xa0, 0x2,  0xad, 0xfa, 0xf8,
                                0x36, 0x7c, 0xb,  0x68, 0x86, 0xec, 0x36, 0xd6, 0xed, 0x45};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4b, 0x39, 0xb2, 0xef, 0xc0, 0xb4, 0x34, 0x9f, 0xee, 0xdb,
                                  0xfe, 0x63, 0x77, 0x89, 0x5c, 0x4b, 0xb1, 0xaf, 0xe6};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30510;
  uint8_t client_id_bytes[] = {0xfe, 0x11, 0x78, 0x8e, 0xb4, 0xf1, 0xa4, 0xb2, 0x75, 0x19, 0x6e, 0x96, 0xc4, 0x4b, 0x73,
                               0x3c, 0x64, 0x22, 0xa7, 0x47, 0x85, 0x9c, 0xa7, 0x6a, 0x2d, 0xc5, 0x83, 0x4e, 0xcf};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x74, 0x7e, 0x42, 0xc1, 0xc2, 0x67, 0x87, 0x2e, 0xcd, 0xc3, 0x27,
                              0xca, 0x34, 0xfe, 0xa7, 0x82, 0x26, 0x7d, 0x83, 0xe,  0x28};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "+a\134G\173&O\244\236\DEL\157\220\208cK%\244", _password = Nothing, _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\STX", _willMsg =
// "9\f\152&\203\196\153\156^\250\135\135\203\221\139\220S", _willProps = [PropWildcardSubscriptionAvailable
// 105,PropSubscriptionIdentifierAvailable 156,PropMessageExpiryInterval 15607,PropReceiveMaximum
// 6513,PropWildcardSubscriptionAvailable 17,PropMaximumPacketSize 16736,PropSharedSubscriptionAvailable
// 217,PropTopicAliasMaximum 24529,PropTopicAliasMaximum 30836,PropAuthenticationData
// "SJ\149\227j\161\215\230\209\190\129\245\237S<\151\239*<\192\225Hf\167\205",PropRequestProblemInformation
// 49,PropReceiveMaximum 26676,PropRequestResponseInformation 23,PropReceiveMaximum 2378,PropUserProperty
// "\198\&8\243\145\SO\140\RS}m\175" "\167\136fl",PropMessageExpiryInterval 24188,PropServerReference
// "qx&",PropTopicAliasMaximum 29686,PropSharedSubscriptionAvailable 96,PropAuthenticationMethod
// "\198\239t\208\247\202g$\188\EOTj\a\215\182\159s\227\233+C\162\DC1<\225L\SO\253\236\NUL\211",PropContentType
// "r\227\138u%w\209\171>\162\161\152\&1\SYN\233Bh\180\177D",PropRetainAvailable 215,PropMessageExpiryInterval
// 7547,PropMessageExpiryInterval 10918]}), _cleanSession = True, _keepAlive = 19375, _connID =
// "/\\r\181\177\142o\161\139@\150@F", _properties = [PropAuthenticationMethod
// "\vo\194$\179o\253LB\SO\ACK\ETB\227T?zh\218\196\158\&5\SI'`B\137",PropAuthenticationData
// "\170\199",PropMaximumPacketSize 21294,PropAuthenticationData
// "\142j\132^\171\191\174U(\249\193\223\SYN-\237\145\128\146",PropAssignedClientIdentifier
// "\239W\rf\218}5\202g\RS\NUL\128-\198\179\223\227\145 \145\b\184",PropServerKeepAlive 9655,PropTopicAliasMaximum
// 23525,PropAuthenticationData "\166\169\&0\b\DEL\251\243\&3\STX\251\140n\224eMvn\ETB",PropRetainAvailable
// 61,PropMessageExpiryInterval 26294,PropSessionExpiryInterval 20677,PropTopicAliasMaximum
// 24479,PropMessageExpiryInterval 4904,PropUserProperty "\249\&0\217#\141\140\DLE\153f\154\CANnZ\DC1VzoY"
// "\216\191\206\168\a'\147\134",PropMaximumQoS 234,PropServerReference
// "V\RST\239\"J\214\128\146\246=bZ\DC3\182r\DLE",PropSharedSubscriptionAvailable 158,PropContentType
// "\tP\222\197\146\ENQ\211L\227D\232\171_h\NAK\146k[\STX\221\n\146",PropWillDelayInterval
// 27789,PropSubscriptionIdentifier 16]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x10, 0xc9, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8e, 0x4b, 0xaf, 0xdb, 0x1,  0x15, 0x0,  0x1a, 0xb,
      0x6f, 0xc2, 0x24, 0xb3, 0x6f, 0xfd, 0x4c, 0x42, 0xe,  0x6,  0x17, 0xe3, 0x54, 0x3f, 0x7a, 0x68, 0xda, 0xc4, 0x9e,
      0x35, 0xf,  0x27, 0x60, 0x42, 0x89, 0x16, 0x0,  0x2,  0xaa, 0xc7, 0x27, 0x0,  0x0,  0x53, 0x2e, 0x16, 0x0,  0x12,
      0x8e, 0x6a, 0x84, 0x5e, 0xab, 0xbf, 0xae, 0x55, 0x28, 0xf9, 0xc1, 0xdf, 0x16, 0x2d, 0xed, 0x91, 0x80, 0x92, 0x12,
      0x0,  0x16, 0xef, 0x57, 0xd,  0x66, 0xda, 0x7d, 0x35, 0xca, 0x67, 0x1e, 0x0,  0x80, 0x2d, 0xc6, 0xb3, 0xdf, 0xe3,
      0x91, 0x20, 0x91, 0x8,  0xb8, 0x13, 0x25, 0xb7, 0x22, 0x5b, 0xe5, 0x16, 0x0,  0x12, 0xa6, 0xa9, 0x30, 0x8,  0x7f,
      0xfb, 0xf3, 0x33, 0x2,  0xfb, 0x8c, 0x6e, 0xe0, 0x65, 0x4d, 0x76, 0x6e, 0x17, 0x25, 0x3d, 0x2,  0x0,  0x0,  0x66,
      0xb6, 0x11, 0x0,  0x0,  0x50, 0xc5, 0x22, 0x5f, 0x9f, 0x2,  0x0,  0x0,  0x13, 0x28, 0x26, 0x0,  0x12, 0xf9, 0x30,
      0xd9, 0x23, 0x8d, 0x8c, 0x10, 0x99, 0x66, 0x9a, 0x18, 0x6e, 0x5a, 0x11, 0x56, 0x7a, 0x6f, 0x59, 0x0,  0x8,  0xd8,
      0xbf, 0xce, 0xa8, 0x7,  0x27, 0x93, 0x86, 0x24, 0xea, 0x1c, 0x0,  0x11, 0x56, 0x1e, 0x54, 0xef, 0x22, 0x4a, 0xd6,
      0x80, 0x92, 0xf6, 0x3d, 0x62, 0x5a, 0x13, 0xb6, 0x72, 0x10, 0x2a, 0x9e, 0x3,  0x0,  0x16, 0x9,  0x50, 0xde, 0xc5,
      0x92, 0x5,  0xd3, 0x4c, 0xe3, 0x44, 0xe8, 0xab, 0x5f, 0x68, 0x15, 0x92, 0x6b, 0x5b, 0x2,  0xdd, 0xa,  0x92, 0x18,
      0x0,  0x0,  0x6c, 0x8d, 0xb,  0x10, 0x0,  0xd,  0x2f, 0x5c, 0x72, 0xb5, 0xb1, 0x8e, 0x6f, 0xa1, 0x8b, 0x40, 0x96,
      0x40, 0x46, 0xa8, 0x1,  0x28, 0x69, 0x29, 0x9c, 0x2,  0x0,  0x0,  0x3c, 0xf7, 0x21, 0x19, 0x71, 0x28, 0x11, 0x27,
      0x0,  0x0,  0x41, 0x60, 0x2a, 0xd9, 0x22, 0x5f, 0xd1, 0x22, 0x78, 0x74, 0x16, 0x0,  0x19, 0x53, 0x4a, 0x95, 0xe3,
      0x6a, 0xa1, 0xd7, 0xe6, 0xd1, 0xbe, 0x81, 0xf5, 0xed, 0x53, 0x3c, 0x97, 0xef, 0x2a, 0x3c, 0xc0, 0xe1, 0x48, 0x66,
      0xa7, 0xcd, 0x17, 0x31, 0x21, 0x68, 0x34, 0x19, 0x17, 0x21, 0x9,  0x4a, 0x26, 0x0,  0xa,  0xc6, 0x38, 0xf3, 0x91,
      0xe,  0x8c, 0x1e, 0x7d, 0x6d, 0xaf, 0x0,  0x4,  0xa7, 0x88, 0x66, 0x6c, 0x2,  0x0,  0x0,  0x5e, 0x7c, 0x1c, 0x0,
      0x3,  0x71, 0x78, 0x26, 0x22, 0x73, 0xf6, 0x2a, 0x60, 0x15, 0x0,  0x1e, 0xc6, 0xef, 0x74, 0xd0, 0xf7, 0xca, 0x67,
      0x24, 0xbc, 0x4,  0x6a, 0x7,  0xd7, 0xb6, 0x9f, 0x73, 0xe3, 0xe9, 0x2b, 0x43, 0xa2, 0x11, 0x3c, 0xe1, 0x4c, 0xe,
      0xfd, 0xec, 0x0,  0xd3, 0x3,  0x0,  0x14, 0x72, 0xe3, 0x8a, 0x75, 0x25, 0x77, 0xd1, 0xab, 0x3e, 0xa2, 0xa1, 0x98,
      0x31, 0x16, 0xe9, 0x42, 0x68, 0xb4, 0xb1, 0x44, 0x25, 0xd7, 0x2,  0x0,  0x0,  0x1d, 0x7b, 0x2,  0x0,  0x0,  0x2a,
      0xa6, 0x0,  0x1,  0x2,  0x0,  0x11, 0x39, 0xc,  0x98, 0x26, 0xcb, 0xc4, 0x99, 0x9c, 0x5e, 0xfa, 0x87, 0x87, 0xcb,
      0xdd, 0x8b, 0xdc, 0x53, 0x0,  0x11, 0x2b, 0x61, 0x86, 0x47, 0xad, 0x26, 0x4f, 0xf4, 0xec, 0x7f, 0x9d, 0xdc, 0xd0,
      0x63, 0x4b, 0x25, 0xf4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb,  0x6f, 0xc2, 0x24, 0xb3, 0x6f, 0xfd, 0x4c, 0x42, 0xe,  0x6,  0x17, 0xe3,
                           0x54, 0x3f, 0x7a, 0x68, 0xda, 0xc4, 0x9e, 0x35, 0xf,  0x27, 0x60, 0x42, 0x89};
  uint8_t bytesprops1[] = {0xaa, 0xc7};
  uint8_t bytesprops2[] = {0x8e, 0x6a, 0x84, 0x5e, 0xab, 0xbf, 0xae, 0x55, 0x28,
                           0xf9, 0xc1, 0xdf, 0x16, 0x2d, 0xed, 0x91, 0x80, 0x92};
  uint8_t bytesprops3[] = {0xef, 0x57, 0xd,  0x66, 0xda, 0x7d, 0x35, 0xca, 0x67, 0x1e, 0x0,
                           0x80, 0x2d, 0xc6, 0xb3, 0xdf, 0xe3, 0x91, 0x20, 0x91, 0x8,  0xb8};
  uint8_t bytesprops4[] = {0xa6, 0xa9, 0x30, 0x8,  0x7f, 0xfb, 0xf3, 0x33, 0x2,
                           0xfb, 0x8c, 0x6e, 0xe0, 0x65, 0x4d, 0x76, 0x6e, 0x17};
  uint8_t bytesprops6[] = {0xd8, 0xbf, 0xce, 0xa8, 0x7, 0x27, 0x93, 0x86};
  uint8_t bytesprops5[] = {0xf9, 0x30, 0xd9, 0x23, 0x8d, 0x8c, 0x10, 0x99, 0x66,
                           0x9a, 0x18, 0x6e, 0x5a, 0x11, 0x56, 0x7a, 0x6f, 0x59};
  uint8_t bytesprops7[] = {0x56, 0x1e, 0x54, 0xef, 0x22, 0x4a, 0xd6, 0x80, 0x92,
                           0xf6, 0x3d, 0x62, 0x5a, 0x13, 0xb6, 0x72, 0x10};
  uint8_t bytesprops8[] = {0x9,  0x50, 0xde, 0xc5, 0x92, 0x5,  0xd3, 0x4c, 0xe3, 0x44, 0xe8,
                           0xab, 0x5f, 0x68, 0x15, 0x92, 0x6b, 0x5b, 0x2,  0xdd, 0xa,  0x92};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21294}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9655}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23525}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26294}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20677}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24479}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4904}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops5}, .v = {8, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27789}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x53, 0x4a, 0x95, 0xe3, 0x6a, 0xa1, 0xd7, 0xe6, 0xd1, 0xbe, 0x81, 0xf5, 0xed,
                               0x53, 0x3c, 0x97, 0xef, 0x2a, 0x3c, 0xc0, 0xe1, 0x48, 0x66, 0xa7, 0xcd};
  uint8_t byteswillprops2[] = {0xa7, 0x88, 0x66, 0x6c};
  uint8_t byteswillprops1[] = {0xc6, 0x38, 0xf3, 0x91, 0xe, 0x8c, 0x1e, 0x7d, 0x6d, 0xaf};
  uint8_t byteswillprops3[] = {0x71, 0x78, 0x26};
  uint8_t byteswillprops4[] = {0xc6, 0xef, 0x74, 0xd0, 0xf7, 0xca, 0x67, 0x24, 0xbc, 0x4,
                               0x6a, 0x7,  0xd7, 0xb6, 0x9f, 0x73, 0xe3, 0xe9, 0x2b, 0x43,
                               0xa2, 0x11, 0x3c, 0xe1, 0x4c, 0xe,  0xfd, 0xec, 0x0,  0xd3};
  uint8_t byteswillprops5[] = {0x72, 0xe3, 0x8a, 0x75, 0x25, 0x77, 0xd1, 0xab, 0x3e, 0xa2,
                               0xa1, 0x98, 0x31, 0x16, 0xe9, 0x42, 0x68, 0xb4, 0xb1, 0x44};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15607}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6513}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16736}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24529}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30836}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26676}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2378}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {10, (char*)&byteswillprops1}, .v = {4, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24188}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29686}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7547}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10918}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x39, 0xc,  0x98, 0x26, 0xcb, 0xc4, 0x99, 0x9c, 0x5e,
                                  0xfa, 0x87, 0x87, 0xcb, 0xdd, 0x8b, 0xdc, 0x53};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 19375;
  uint8_t client_id_bytes[] = {0x2f, 0x5c, 0x72, 0xb5, 0xb1, 0x8e, 0x6f, 0xa1, 0x8b, 0x40, 0x96, 0x40, 0x46};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2b, 0x61, 0x86, 0x47, 0xad, 0x26, 0x4f, 0xf4, 0xec,
                              0x7f, 0x9d, 0xdc, 0xd0, 0x63, 0x4b, 0x25, 0xf4};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\190\145\130w(G[n\144\185\"\138A\235\255GZ\SI\251\136*\210
// \238$*\DC3\136\223\238", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\154\153\177L7?\EM \243\242#e\CAN,\194\180\CANV\230y\\\RS", _willMsg = "\147\239z\187\224\229", _willProps =
// [PropAuthenticationData "\241\210\DC1Z1~\SI\144\145\147\128wM\240j$JO",PropCorrelationData
// "\243~\240\171\SUBIE\146||\180bl*\177Tl\DC2<\166\214m\200n^Z\235%",PropResponseTopic
// "\186\147%X\DLE?\144\190\FS\231\181\235",PropRetainAvailable 229,PropUserProperty "\ENQ\138\178\161+"
// "\ESC\DC3\173\228-\131\243\244\160\168c\185\139t\177\175\235\140B\147\ENQ\DC1",PropSharedSubscriptionAvailable
// 184,PropSubscriptionIdentifierAvailable 161,PropReasonString
// "\134b\131\172\139\167+\193O+\247kz:\NAK\199\&6\175f",PropServerReference
// "\172\ENQ\FS\236\213\210\215\188;%\SO\149",PropResponseTopic "\NUL[T\ETX\140\NAK\206\138",PropMaximumPacketSize
// 6713,PropSessionExpiryInterval 3395,PropMessageExpiryInterval 10996,PropServerKeepAlive 1444,PropReasonString
// "D\158\254YfR\212h\206w\ETXR=\185\142\SOL@\177\221\159\154\166\221\SYN\231%",PropMessageExpiryInterval
// 21083,PropServerReference "\206\r\ACK\SYN\175\238o\SOEO\160.%n\173\SYND\157\226g\209\225Q",PropMessageExpiryInterval
// 6337,PropTopicAliasMaximum 716,PropMessageExpiryInterval 25841,PropSubscriptionIdentifierAvailable
// 229,PropReasonString "\225P\193\&9",PropWildcardSubscriptionAvailable 159,PropMaximumQoS 51,PropTopicAliasMaximum
// 6727,PropReceiveMaximum 11377]}), _cleanSession = True, _keepAlive = 14576, _connID = "m\168E>\DC1\GSp", _properties
// = [PropAuthenticationMethod
// "A%\137\149\&1\210_|\201\174\181\172;\209g&\207\&6\241\134aC\NUL\197\SUBH\191",PropAuthenticationData
// "\185\230\ENQ\152\203\183\SYNc\192\GS{;\b\217\142\255",PropRequestProblemInformation 150,PropResponseTopic
// "\236\250\153\194yY]\167\194\249\157o\241\144*\185[\219\244",PropSharedSubscriptionAvailable
// 15,PropSubscriptionIdentifierAvailable 77,PropRetainAvailable 151,PropSessionExpiryInterval 17635,PropContentType
// "\170wU\187\DC2)/O0\183;\220\140J\193\190r\136",PropServerKeepAlive 30845,PropWillDelayInterval
// 20450,PropAuthenticationMethod
// "\159\227Q\">\223\251'\242e\146v\138\237\&8\140\170\t\ENQP\151\tcc\241\EOT&\224\198\140",PropContentType
// "\139\244",PropRequestProblemInformation 170,PropSharedSubscriptionAvailable 140,PropSubscriptionIdentifierAvailable
// 23,PropTopicAlias 20455,PropPayloadFormatIndicator 187]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0x81, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x76, 0x38, 0xf0, 0xa2, 0x1,  0x15, 0x0,  0x1b, 0x41,
      0x25, 0x89, 0x95, 0x31, 0xd2, 0x5f, 0x7c, 0xc9, 0xae, 0xb5, 0xac, 0x3b, 0xd1, 0x67, 0x26, 0xcf, 0x36, 0xf1, 0x86,
      0x61, 0x43, 0x0,  0xc5, 0x1a, 0x48, 0xbf, 0x16, 0x0,  0x10, 0xb9, 0xe6, 0x5,  0x98, 0xcb, 0xb7, 0x16, 0x63, 0xc0,
      0x1d, 0x7b, 0x3b, 0x8,  0xd9, 0x8e, 0xff, 0x17, 0x96, 0x8,  0x0,  0x13, 0xec, 0xfa, 0x99, 0xc2, 0x79, 0x59, 0x5d,
      0xa7, 0xc2, 0xf9, 0x9d, 0x6f, 0xf1, 0x90, 0x2a, 0xb9, 0x5b, 0xdb, 0xf4, 0x2a, 0xf,  0x29, 0x4d, 0x25, 0x97, 0x11,
      0x0,  0x0,  0x44, 0xe3, 0x3,  0x0,  0x12, 0xaa, 0x77, 0x55, 0xbb, 0x12, 0x29, 0x2f, 0x4f, 0x30, 0xb7, 0x3b, 0xdc,
      0x8c, 0x4a, 0xc1, 0xbe, 0x72, 0x88, 0x13, 0x78, 0x7d, 0x18, 0x0,  0x0,  0x4f, 0xe2, 0x15, 0x0,  0x1e, 0x9f, 0xe3,
      0x51, 0x22, 0x3e, 0xdf, 0xfb, 0x27, 0xf2, 0x65, 0x92, 0x76, 0x8a, 0xed, 0x38, 0x8c, 0xaa, 0x9,  0x5,  0x50, 0x97,
      0x9,  0x63, 0x63, 0xf1, 0x4,  0x26, 0xe0, 0xc6, 0x8c, 0x3,  0x0,  0x2,  0x8b, 0xf4, 0x17, 0xaa, 0x2a, 0x8c, 0x29,
      0x17, 0x23, 0x4f, 0xe7, 0x1,  0xbb, 0x0,  0x7,  0x6d, 0xa8, 0x45, 0x3e, 0x11, 0x1d, 0x70, 0x88, 0x2,  0x16, 0x0,
      0x12, 0xf1, 0xd2, 0x11, 0x5a, 0x31, 0x7e, 0xf,  0x90, 0x91, 0x93, 0x80, 0x77, 0x4d, 0xf0, 0x6a, 0x24, 0x4a, 0x4f,
      0x9,  0x0,  0x1c, 0xf3, 0x7e, 0xf0, 0xab, 0x1a, 0x49, 0x45, 0x92, 0x7c, 0x7c, 0xb4, 0x62, 0x6c, 0x2a, 0xb1, 0x54,
      0x6c, 0x12, 0x3c, 0xa6, 0xd6, 0x6d, 0xc8, 0x6e, 0x5e, 0x5a, 0xeb, 0x25, 0x8,  0x0,  0xc,  0xba, 0x93, 0x25, 0x58,
      0x10, 0x3f, 0x90, 0xbe, 0x1c, 0xe7, 0xb5, 0xeb, 0x25, 0xe5, 0x26, 0x0,  0x5,  0x5,  0x8a, 0xb2, 0xa1, 0x2b, 0x0,
      0x16, 0x1b, 0x13, 0xad, 0xe4, 0x2d, 0x83, 0xf3, 0xf4, 0xa0, 0xa8, 0x63, 0xb9, 0x8b, 0x74, 0xb1, 0xaf, 0xeb, 0x8c,
      0x42, 0x93, 0x5,  0x11, 0x2a, 0xb8, 0x29, 0xa1, 0x1f, 0x0,  0x13, 0x86, 0x62, 0x83, 0xac, 0x8b, 0xa7, 0x2b, 0xc1,
      0x4f, 0x2b, 0xf7, 0x6b, 0x7a, 0x3a, 0x15, 0xc7, 0x36, 0xaf, 0x66, 0x1c, 0x0,  0xc,  0xac, 0x5,  0x1c, 0xec, 0xd5,
      0xd2, 0xd7, 0xbc, 0x3b, 0x25, 0xe,  0x95, 0x8,  0x0,  0x8,  0x0,  0x5b, 0x54, 0x3,  0x8c, 0x15, 0xce, 0x8a, 0x27,
      0x0,  0x0,  0x1a, 0x39, 0x11, 0x0,  0x0,  0xd,  0x43, 0x2,  0x0,  0x0,  0x2a, 0xf4, 0x13, 0x5,  0xa4, 0x1f, 0x0,
      0x1b, 0x44, 0x9e, 0xfe, 0x59, 0x66, 0x52, 0xd4, 0x68, 0xce, 0x77, 0x3,  0x52, 0x3d, 0xb9, 0x8e, 0xe,  0x4c, 0x40,
      0xb1, 0xdd, 0x9f, 0x9a, 0xa6, 0xdd, 0x16, 0xe7, 0x25, 0x2,  0x0,  0x0,  0x52, 0x5b, 0x1c, 0x0,  0x17, 0xce, 0xd,
      0x6,  0x16, 0xaf, 0xee, 0x6f, 0xe,  0x45, 0x4f, 0xa0, 0x2e, 0x25, 0x6e, 0xad, 0x16, 0x44, 0x9d, 0xe2, 0x67, 0xd1,
      0xe1, 0x51, 0x2,  0x0,  0x0,  0x18, 0xc1, 0x22, 0x2,  0xcc, 0x2,  0x0,  0x0,  0x64, 0xf1, 0x29, 0xe5, 0x1f, 0x0,
      0x4,  0xe1, 0x50, 0xc1, 0x39, 0x28, 0x9f, 0x24, 0x33, 0x22, 0x1a, 0x47, 0x21, 0x2c, 0x71, 0x0,  0x16, 0x9a, 0x99,
      0xb1, 0x4c, 0x37, 0x3f, 0x19, 0x20, 0xf3, 0xf2, 0x23, 0x65, 0x18, 0x2c, 0xc2, 0xb4, 0x18, 0x56, 0xe6, 0x79, 0x5c,
      0x1e, 0x0,  0x6,  0x93, 0xef, 0x7a, 0xbb, 0xe0, 0xe5, 0x0,  0x1e, 0xbe, 0x91, 0x82, 0x77, 0x28, 0x47, 0x5b, 0x6e,
      0x90, 0xb9, 0x22, 0x8a, 0x41, 0xeb, 0xff, 0x47, 0x5a, 0xf,  0xfb, 0x88, 0x2a, 0xd2, 0x20, 0xee, 0x24, 0x2a, 0x13,
      0x88, 0xdf, 0xee};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x41, 0x25, 0x89, 0x95, 0x31, 0xd2, 0x5f, 0x7c, 0xc9, 0xae, 0xb5, 0xac, 0x3b, 0xd1,
                           0x67, 0x26, 0xcf, 0x36, 0xf1, 0x86, 0x61, 0x43, 0x0,  0xc5, 0x1a, 0x48, 0xbf};
  uint8_t bytesprops1[] = {0xb9, 0xe6, 0x5,  0x98, 0xcb, 0xb7, 0x16, 0x63,
                           0xc0, 0x1d, 0x7b, 0x3b, 0x8,  0xd9, 0x8e, 0xff};
  uint8_t bytesprops2[] = {0xec, 0xfa, 0x99, 0xc2, 0x79, 0x59, 0x5d, 0xa7, 0xc2, 0xf9,
                           0x9d, 0x6f, 0xf1, 0x90, 0x2a, 0xb9, 0x5b, 0xdb, 0xf4};
  uint8_t bytesprops3[] = {0xaa, 0x77, 0x55, 0xbb, 0x12, 0x29, 0x2f, 0x4f, 0x30,
                           0xb7, 0x3b, 0xdc, 0x8c, 0x4a, 0xc1, 0xbe, 0x72, 0x88};
  uint8_t bytesprops4[] = {0x9f, 0xe3, 0x51, 0x22, 0x3e, 0xdf, 0xfb, 0x27, 0xf2, 0x65, 0x92, 0x76, 0x8a, 0xed, 0x38,
                           0x8c, 0xaa, 0x9,  0x5,  0x50, 0x97, 0x9,  0x63, 0x63, 0xf1, 0x4,  0x26, 0xe0, 0xc6, 0x8c};
  uint8_t bytesprops5[] = {0x8b, 0xf4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17635}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30845}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20450}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20455}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf1, 0xd2, 0x11, 0x5a, 0x31, 0x7e, 0xf,  0x90, 0x91,
                               0x93, 0x80, 0x77, 0x4d, 0xf0, 0x6a, 0x24, 0x4a, 0x4f};
  uint8_t byteswillprops1[] = {0xf3, 0x7e, 0xf0, 0xab, 0x1a, 0x49, 0x45, 0x92, 0x7c, 0x7c, 0xb4, 0x62, 0x6c, 0x2a,
                               0xb1, 0x54, 0x6c, 0x12, 0x3c, 0xa6, 0xd6, 0x6d, 0xc8, 0x6e, 0x5e, 0x5a, 0xeb, 0x25};
  uint8_t byteswillprops2[] = {0xba, 0x93, 0x25, 0x58, 0x10, 0x3f, 0x90, 0xbe, 0x1c, 0xe7, 0xb5, 0xeb};
  uint8_t byteswillprops4[] = {0x1b, 0x13, 0xad, 0xe4, 0x2d, 0x83, 0xf3, 0xf4, 0xa0, 0xa8, 0x63,
                               0xb9, 0x8b, 0x74, 0xb1, 0xaf, 0xeb, 0x8c, 0x42, 0x93, 0x5,  0x11};
  uint8_t byteswillprops3[] = {0x5, 0x8a, 0xb2, 0xa1, 0x2b};
  uint8_t byteswillprops5[] = {0x86, 0x62, 0x83, 0xac, 0x8b, 0xa7, 0x2b, 0xc1, 0x4f, 0x2b,
                               0xf7, 0x6b, 0x7a, 0x3a, 0x15, 0xc7, 0x36, 0xaf, 0x66};
  uint8_t byteswillprops6[] = {0xac, 0x5, 0x1c, 0xec, 0xd5, 0xd2, 0xd7, 0xbc, 0x3b, 0x25, 0xe, 0x95};
  uint8_t byteswillprops7[] = {0x0, 0x5b, 0x54, 0x3, 0x8c, 0x15, 0xce, 0x8a};
  uint8_t byteswillprops8[] = {0x44, 0x9e, 0xfe, 0x59, 0x66, 0x52, 0xd4, 0x68, 0xce, 0x77, 0x3,  0x52, 0x3d, 0xb9,
                               0x8e, 0xe,  0x4c, 0x40, 0xb1, 0xdd, 0x9f, 0x9a, 0xa6, 0xdd, 0x16, 0xe7, 0x25};
  uint8_t byteswillprops9[] = {0xce, 0xd,  0x6,  0x16, 0xaf, 0xee, 0x6f, 0xe,  0x45, 0x4f, 0xa0, 0x2e,
                               0x25, 0x6e, 0xad, 0x16, 0x44, 0x9d, 0xe2, 0x67, 0xd1, 0xe1, 0x51};
  uint8_t byteswillprops10[] = {0xe1, 0x50, 0xc1, 0x39};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {5, (char*)&byteswillprops3}, .v = {22, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6713}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3395}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10996}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1444}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21083}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6337}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 716}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25841}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6727}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11377}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9a, 0x99, 0xb1, 0x4c, 0x37, 0x3f, 0x19, 0x20, 0xf3, 0xf2, 0x23,
                                0x65, 0x18, 0x2c, 0xc2, 0xb4, 0x18, 0x56, 0xe6, 0x79, 0x5c, 0x1e};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x93, 0xef, 0x7a, 0xbb, 0xe0, 0xe5};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14576;
  uint8_t client_id_bytes[] = {0x6d, 0xa8, 0x45, 0x3e, 0x11, 0x1d, 0x70};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xbe, 0x91, 0x82, 0x77, 0x28, 0x47, 0x5b, 0x6e, 0x90, 0xb9, 0x22, 0x8a, 0x41, 0xeb, 0xff,
                              0x47, 0x5a, 0xf,  0xfb, 0x88, 0x2a, 0xd2, 0x20, 0xee, 0x24, 0x2a, 0x13, 0x88, 0xdf, 0xee};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "Ibz\161\NAK]\135\187\244P\201n\128\254LP\157\215\&5 ", _password = Just
// "\DC1\179\173\241Kq\135\157\&0\174?\226\202\185?\NUL\225\201\214\r", _lastWill = Nothing, _cleanSession = True,
// _keepAlive = 25611, _connID = "Q0\230c\ENQ\197x\GS\144k\195\162", _properties = [PropServerKeepAlive
// 949,PropSessionExpiryInterval 22333,PropResponseInformation
// "-\251\FS3\188k|aR]\144\EM\129R\194\227O",PropReceiveMaximum 31115,PropSubscriptionIdentifierAvailable
// 71,PropServerKeepAlive 4790,PropRequestProblemInformation 225,PropSessionExpiryInterval 21644,PropMaximumQoS
// 202,PropSessionExpiryInterval 2656,PropSharedSubscriptionAvailable 125,PropContentType
// "S\154\157\137=\FS\196\169\DC4d\188\211w\216\241\SUB\DC1{S\191\ETX",PropCorrelationData
// "P\ESC\149\223\201M\244<\SI\218\157?m1<\152X-\221\221\FS\161?",PropPayloadFormatIndicator
// 166,PropRequestResponseInformation 48,PropRequestProblemInformation 60,PropAssignedClientIdentifier
// "F\236\f\FS\236\234\167sx\138F\162\194RXo\172H\a\165",PropSessionExpiryInterval 10945,PropAuthenticationData
// "iV\ACK\202\159\254c\220\212\171@\215\134\168\194.?\167\244\EOT",PropServerReference
// "\173\195K\STX\176\158\NUL]\EM\243z\251\129\147Z\195",PropResponseTopic
// "[\US\EOT\240|\241\234j",PropPayloadFormatIndicator 219,PropAuthenticationData
// "\175\196\163]\133\206\&7\208q\228\194\&9H"]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0x95, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x64, 0xb,  0xcf, 0x1,  0x13, 0x3,  0xb5, 0x11,
      0x0,  0x0,  0x57, 0x3d, 0x1a, 0x0,  0x11, 0x2d, 0xfb, 0x1c, 0x33, 0xbc, 0x6b, 0x7c, 0x61, 0x52, 0x5d, 0x90, 0x19,
      0x81, 0x52, 0xc2, 0xe3, 0x4f, 0x21, 0x79, 0x8b, 0x29, 0x47, 0x13, 0x12, 0xb6, 0x17, 0xe1, 0x11, 0x0,  0x0,  0x54,
      0x8c, 0x24, 0xca, 0x11, 0x0,  0x0,  0xa,  0x60, 0x2a, 0x7d, 0x3,  0x0,  0x15, 0x53, 0x9a, 0x9d, 0x89, 0x3d, 0x1c,
      0xc4, 0xa9, 0x14, 0x64, 0xbc, 0xd3, 0x77, 0xd8, 0xf1, 0x1a, 0x11, 0x7b, 0x53, 0xbf, 0x3,  0x9,  0x0,  0x17, 0x50,
      0x1b, 0x95, 0xdf, 0xc9, 0x4d, 0xf4, 0x3c, 0xf,  0xda, 0x9d, 0x3f, 0x6d, 0x31, 0x3c, 0x98, 0x58, 0x2d, 0xdd, 0xdd,
      0x1c, 0xa1, 0x3f, 0x1,  0xa6, 0x19, 0x30, 0x17, 0x3c, 0x12, 0x0,  0x14, 0x46, 0xec, 0xc,  0x1c, 0xec, 0xea, 0xa7,
      0x73, 0x78, 0x8a, 0x46, 0xa2, 0xc2, 0x52, 0x58, 0x6f, 0xac, 0x48, 0x7,  0xa5, 0x11, 0x0,  0x0,  0x2a, 0xc1, 0x16,
      0x0,  0x14, 0x69, 0x56, 0x6,  0xca, 0x9f, 0xfe, 0x63, 0xdc, 0xd4, 0xab, 0x40, 0xd7, 0x86, 0xa8, 0xc2, 0x2e, 0x3f,
      0xa7, 0xf4, 0x4,  0x1c, 0x0,  0x10, 0xad, 0xc3, 0x4b, 0x2,  0xb0, 0x9e, 0x0,  0x5d, 0x19, 0xf3, 0x7a, 0xfb, 0x81,
      0x93, 0x5a, 0xc3, 0x8,  0x0,  0x8,  0x5b, 0x1f, 0x4,  0xf0, 0x7c, 0xf1, 0xea, 0x6a, 0x1,  0xdb, 0x16, 0x0,  0xd,
      0xaf, 0xc4, 0xa3, 0x5d, 0x85, 0xce, 0x37, 0xd0, 0x71, 0xe4, 0xc2, 0x39, 0x48, 0x0,  0xc,  0x51, 0x30, 0xe6, 0x63,
      0x5,  0xc5, 0x78, 0x1d, 0x90, 0x6b, 0xc3, 0xa2, 0x0,  0x14, 0x49, 0x62, 0x7a, 0xa1, 0x15, 0x5d, 0x87, 0xbb, 0xf4,
      0x50, 0xc9, 0x6e, 0x80, 0xfe, 0x4c, 0x50, 0x9d, 0xd7, 0x35, 0x20, 0x0,  0x14, 0x11, 0xb3, 0xad, 0xf1, 0x4b, 0x71,
      0x87, 0x9d, 0x30, 0xae, 0x3f, 0xe2, 0xca, 0xb9, 0x3f, 0x0,  0xe1, 0xc9, 0xd6, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2d, 0xfb, 0x1c, 0x33, 0xbc, 0x6b, 0x7c, 0x61, 0x52,
                           0x5d, 0x90, 0x19, 0x81, 0x52, 0xc2, 0xe3, 0x4f};
  uint8_t bytesprops1[] = {0x53, 0x9a, 0x9d, 0x89, 0x3d, 0x1c, 0xc4, 0xa9, 0x14, 0x64, 0xbc,
                           0xd3, 0x77, 0xd8, 0xf1, 0x1a, 0x11, 0x7b, 0x53, 0xbf, 0x3};
  uint8_t bytesprops2[] = {0x50, 0x1b, 0x95, 0xdf, 0xc9, 0x4d, 0xf4, 0x3c, 0xf,  0xda, 0x9d, 0x3f,
                           0x6d, 0x31, 0x3c, 0x98, 0x58, 0x2d, 0xdd, 0xdd, 0x1c, 0xa1, 0x3f};
  uint8_t bytesprops3[] = {0x46, 0xec, 0xc,  0x1c, 0xec, 0xea, 0xa7, 0x73, 0x78, 0x8a,
                           0x46, 0xa2, 0xc2, 0x52, 0x58, 0x6f, 0xac, 0x48, 0x7,  0xa5};
  uint8_t bytesprops4[] = {0x69, 0x56, 0x6,  0xca, 0x9f, 0xfe, 0x63, 0xdc, 0xd4, 0xab,
                           0x40, 0xd7, 0x86, 0xa8, 0xc2, 0x2e, 0x3f, 0xa7, 0xf4, 0x4};
  uint8_t bytesprops5[] = {0xad, 0xc3, 0x4b, 0x2,  0xb0, 0x9e, 0x0,  0x5d,
                           0x19, 0xf3, 0x7a, 0xfb, 0x81, 0x93, 0x5a, 0xc3};
  uint8_t bytesprops6[] = {0x5b, 0x1f, 0x4, 0xf0, 0x7c, 0xf1, 0xea, 0x6a};
  uint8_t bytesprops7[] = {0xaf, 0xc4, 0xa3, 0x5d, 0x85, 0xce, 0x37, 0xd0, 0x71, 0xe4, 0xc2, 0x39, 0x48};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 949}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22333}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31115}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4790}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21644}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2656}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10945}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25611;
  uint8_t client_id_bytes[] = {0x51, 0x30, 0xe6, 0x63, 0x5, 0xc5, 0x78, 0x1d, 0x90, 0x6b, 0xc3, 0xa2};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x49, 0x62, 0x7a, 0xa1, 0x15, 0x5d, 0x87, 0xbb, 0xf4, 0x50,
                              0xc9, 0x6e, 0x80, 0xfe, 0x4c, 0x50, 0x9d, 0xd7, 0x35, 0x20};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x11, 0xb3, 0xad, 0xf1, 0x4b, 0x71, 0x87, 0x9d, 0x30, 0xae,
                              0x3f, 0xe2, 0xca, 0xb9, 0x3f, 0x0,  0xe1, 0xc9, 0xd6, 0xd};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\211\231\&0\207\223D\193V\147\196\212\176\247\139\172\\\193", _password = Nothing,
// _lastWill = Nothing, _cleanSession = False, _keepAlive = 29750, _connID = "{\160+gG\160\227*\159\208'h\197K\222\&2\tP
// \144\148\149\214l\201", _properties = [PropRequestProblemInformation 82,PropTopicAlias
// 30469,PropPayloadFormatIndicator 16,PropWildcardSubscriptionAvailable 2,PropSessionExpiryInterval
// 29247,PropReceiveMaximum 21019,PropPayloadFormatIndicator 103,PropWildcardSubscriptionAvailable
// 180,PropResponseInformation "\187_\188\240\187\DEL\148\224o1\187\151\161o\206\154hT",PropAuthenticationData
// "\SIF[\230\SOH\158?\\\248",PropAuthenticationData "{\247\132\200M",PropUserProperty
// "\220\245\193\&7\239t\\l;\144D\236\SI\205\239`"
// "M\215\206\150\231{\177v\163\212\178\223\149<\DC3t\250:\160Nk[\216",PropResponseTopic
// "f\152\SYN\\bVz\fEl\172\&5",PropRequestProblemInformation 242,PropPayloadFormatIndicator
// 179,PropMessageExpiryInterval 12926,PropWildcardSubscriptionAvailable 184,PropMaximumPacketSize
// 27860,PropPayloadFormatIndicator 161,PropServerKeepAlive 9236,PropSubscriptionIdentifierAvailable 174,PropContentType
// "\130k\162@\aqL${\206\156&y\159\254_\169\254\131~q\SOH\174x",PropResponseTopic
// "\ETX-y\ETXT\255&!1\142\197\209\199\138\215\132\254$\245",PropResponseInformation "\"\247\"",PropMaximumQoS 8]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0x83, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x80, 0x74, 0x36, 0xc9, 0x1,  0x17, 0x52, 0x23, 0x77,
      0x5,  0x1,  0x10, 0x28, 0x2,  0x11, 0x0,  0x0,  0x72, 0x3f, 0x21, 0x52, 0x1b, 0x1,  0x67, 0x28, 0xb4, 0x1a, 0x0,
      0x12, 0xbb, 0x5f, 0xbc, 0xf0, 0xbb, 0x7f, 0x94, 0xe0, 0x6f, 0x31, 0xbb, 0x97, 0xa1, 0x6f, 0xce, 0x9a, 0x68, 0x54,
      0x16, 0x0,  0x9,  0xf,  0x46, 0x5b, 0xe6, 0x1,  0x9e, 0x3f, 0x5c, 0xf8, 0x16, 0x0,  0x5,  0x7b, 0xf7, 0x84, 0xc8,
      0x4d, 0x26, 0x0,  0x10, 0xdc, 0xf5, 0xc1, 0x37, 0xef, 0x74, 0x5c, 0x6c, 0x3b, 0x90, 0x44, 0xec, 0xf,  0xcd, 0xef,
      0x60, 0x0,  0x17, 0x4d, 0xd7, 0xce, 0x96, 0xe7, 0x7b, 0xb1, 0x76, 0xa3, 0xd4, 0xb2, 0xdf, 0x95, 0x3c, 0x13, 0x74,
      0xfa, 0x3a, 0xa0, 0x4e, 0x6b, 0x5b, 0xd8, 0x8,  0x0,  0xc,  0x66, 0x98, 0x16, 0x5c, 0x62, 0x56, 0x7a, 0xc,  0x45,
      0x6c, 0xac, 0x35, 0x17, 0xf2, 0x1,  0xb3, 0x2,  0x0,  0x0,  0x32, 0x7e, 0x28, 0xb8, 0x27, 0x0,  0x0,  0x6c, 0xd4,
      0x1,  0xa1, 0x13, 0x24, 0x14, 0x29, 0xae, 0x3,  0x0,  0x18, 0x82, 0x6b, 0xa2, 0x40, 0x7,  0x71, 0x4c, 0x24, 0x7b,
      0xce, 0x9c, 0x26, 0x79, 0x9f, 0xfe, 0x5f, 0xa9, 0xfe, 0x83, 0x7e, 0x71, 0x1,  0xae, 0x78, 0x8,  0x0,  0x13, 0x3,
      0x2d, 0x79, 0x3,  0x54, 0xff, 0x26, 0x21, 0x31, 0x8e, 0xc5, 0xd1, 0xc7, 0x8a, 0xd7, 0x84, 0xfe, 0x24, 0xf5, 0x1a,
      0x0,  0x3,  0x22, 0xf7, 0x22, 0x24, 0x8,  0x0,  0x19, 0x7b, 0xa0, 0x2b, 0x67, 0x47, 0xa0, 0xe3, 0x2a, 0x9f, 0xd0,
      0x27, 0x68, 0xc5, 0x4b, 0xde, 0x32, 0x9,  0x50, 0x20, 0x90, 0x94, 0x95, 0xd6, 0x6c, 0xc9, 0x0,  0x11, 0xd3, 0xe7,
      0x30, 0xcf, 0xdf, 0x44, 0xc1, 0x56, 0x93, 0xc4, 0xd4, 0xb0, 0xf7, 0x8b, 0xac, 0x5c, 0xc1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbb, 0x5f, 0xbc, 0xf0, 0xbb, 0x7f, 0x94, 0xe0, 0x6f,
                           0x31, 0xbb, 0x97, 0xa1, 0x6f, 0xce, 0x9a, 0x68, 0x54};
  uint8_t bytesprops1[] = {0xf, 0x46, 0x5b, 0xe6, 0x1, 0x9e, 0x3f, 0x5c, 0xf8};
  uint8_t bytesprops2[] = {0x7b, 0xf7, 0x84, 0xc8, 0x4d};
  uint8_t bytesprops4[] = {0x4d, 0xd7, 0xce, 0x96, 0xe7, 0x7b, 0xb1, 0x76, 0xa3, 0xd4, 0xb2, 0xdf,
                           0x95, 0x3c, 0x13, 0x74, 0xfa, 0x3a, 0xa0, 0x4e, 0x6b, 0x5b, 0xd8};
  uint8_t bytesprops3[] = {0xdc, 0xf5, 0xc1, 0x37, 0xef, 0x74, 0x5c, 0x6c,
                           0x3b, 0x90, 0x44, 0xec, 0xf,  0xcd, 0xef, 0x60};
  uint8_t bytesprops5[] = {0x66, 0x98, 0x16, 0x5c, 0x62, 0x56, 0x7a, 0xc, 0x45, 0x6c, 0xac, 0x35};
  uint8_t bytesprops6[] = {0x82, 0x6b, 0xa2, 0x40, 0x7,  0x71, 0x4c, 0x24, 0x7b, 0xce, 0x9c, 0x26,
                           0x79, 0x9f, 0xfe, 0x5f, 0xa9, 0xfe, 0x83, 0x7e, 0x71, 0x1,  0xae, 0x78};
  uint8_t bytesprops7[] = {0x3,  0x2d, 0x79, 0x3,  0x54, 0xff, 0x26, 0x21, 0x31, 0x8e,
                           0xc5, 0xd1, 0xc7, 0x8a, 0xd7, 0x84, 0xfe, 0x24, 0xf5};
  uint8_t bytesprops8[] = {0x22, 0xf7, 0x22};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30469}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29247}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21019}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops3}, .v = {23, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12926}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27860}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9236}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29750;
  uint8_t client_id_bytes[] = {0x7b, 0xa0, 0x2b, 0x67, 0x47, 0xa0, 0xe3, 0x2a, 0x9f, 0xd0, 0x27, 0x68, 0xc5,
                               0x4b, 0xde, 0x32, 0x9,  0x50, 0x20, 0x90, 0x94, 0x95, 0xd6, 0x6c, 0xc9};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd3, 0xe7, 0x30, 0xcf, 0xdf, 0x44, 0xc1, 0x56, 0x93,
                              0xc4, 0xd4, 0xb0, 0xf7, 0x8b, 0xac, 0x5c, 0xc1};
  lwmqtt_string_t username = {17, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "?\212\154\234\129\129", _password = Just "p~)\DELVv\232\EOT,\SUB\142a\223",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\182\210\210\208\161*\ng>\174\214\175\228\181\167\162I=\146!", _willMsg = "2\138c9\234`\186@\186E\164\&9+",
// _willProps = [PropMaximumPacketSize 25044,PropMaximumQoS 93,PropSubscriptionIdentifierAvailable 130,PropUserProperty
// "\230\188\156\182\145\220mb\fpl\178<\194\&1Hm\132\181?\166|\ACKg\137\&8x\EOT" "\155\&96k",PropResponseTopic
// "\158\239\253j\168\ENQV>\133<\189",PropWildcardSubscriptionAvailable 150,PropSubscriptionIdentifier
// 14,PropCorrelationData "\240\129\155u\164\216\161\178/C",PropSharedSubscriptionAvailable 161,PropServerReference
// "\134*:\200,\219s\EM\253F\255\209.\229\227",PropRequestResponseInformation 96,PropPayloadFormatIndicator
// 45,PropRequestProblemInformation 133,PropRetainAvailable 164,PropServerReference
// "V?rv\237\150\169F\191|\a\162\ENQ\211\193\&4\239\&1\231>",PropRequestResponseInformation
// 227,PropSubscriptionIdentifier 18]}), _cleanSession = False, _keepAlive = 19395, _connID =
// "\149n\238G\238\237)\201\164\252\154Z`O\144Gm\245xzg\DC3P", _properties = [PropSubscriptionIdentifierAvailable
// 150,PropAuthenticationMethod
// "|\ESC\221\172\ESC\171\190\216\190d\154\148i\216\&1\225\&9\211r\185;\FS\fy",PropWildcardSubscriptionAvailable
// 151,PropPayloadFormatIndicator 78,PropAuthenticationMethod "",PropTopicAlias 3919,PropUserProperty
// "\ETB\211\SUBY\224\&1\146\189/\159\ESC" "\245m\175\226\nn\225\164\172(u\r3\152\223\b\227\174Q",PropMaximumQoS
// 237,PropTopicAlias 1648,PropReceiveMaximum 8601,PropAuthenticationData "D\138}\191\133{",PropSessionExpiryInterval
// 12319,PropWildcardSubscriptionAvailable 99,PropReasonString
// "h\231\NULS\DEL6F1?\156`No\ACK$~\191\v\180-KQ\128\228.\171*",PropMaximumPacketSize 16400,PropMessageExpiryInterval
// 3583,PropResponseTopic
// "\205_\ENQ]\130\234_\128\RS\176\235\216\247M\211\234u\aC\161\163\190k\184h",PropServerReference
// "a\167Y4\r\211\196}\236\DELO\156",PropWildcardSubscriptionAvailable 14]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0x9e, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x4b, 0xc3, 0xb7, 0x1,  0x29, 0x96, 0x15, 0x0,
      0x18, 0x7c, 0x1b, 0xdd, 0xac, 0x1b, 0xab, 0xbe, 0xd8, 0xbe, 0x64, 0x9a, 0x94, 0x69, 0xd8, 0x31, 0xe1, 0x39, 0xd3,
      0x72, 0xb9, 0x3b, 0x1c, 0xc,  0x79, 0x28, 0x97, 0x1,  0x4e, 0x15, 0x0,  0x0,  0x23, 0xf,  0x4f, 0x26, 0x0,  0xb,
      0x17, 0xd3, 0x1a, 0x59, 0xe0, 0x31, 0x92, 0xbd, 0x2f, 0x9f, 0x1b, 0x0,  0x13, 0xf5, 0x6d, 0xaf, 0xe2, 0xa,  0x6e,
      0xe1, 0xa4, 0xac, 0x28, 0x75, 0xd,  0x33, 0x98, 0xdf, 0x8,  0xe3, 0xae, 0x51, 0x24, 0xed, 0x23, 0x6,  0x70, 0x21,
      0x21, 0x99, 0x16, 0x0,  0x6,  0x44, 0x8a, 0x7d, 0xbf, 0x85, 0x7b, 0x11, 0x0,  0x0,  0x30, 0x1f, 0x28, 0x63, 0x1f,
      0x0,  0x1b, 0x68, 0xe7, 0x0,  0x53, 0x7f, 0x36, 0x46, 0x31, 0x3f, 0x9c, 0x60, 0x4e, 0x6f, 0x6,  0x24, 0x7e, 0xbf,
      0xb,  0xb4, 0x2d, 0x4b, 0x51, 0x80, 0xe4, 0x2e, 0xab, 0x2a, 0x27, 0x0,  0x0,  0x40, 0x10, 0x2,  0x0,  0x0,  0xd,
      0xff, 0x8,  0x0,  0x19, 0xcd, 0x5f, 0x5,  0x5d, 0x82, 0xea, 0x5f, 0x80, 0x1e, 0xb0, 0xeb, 0xd8, 0xf7, 0x4d, 0xd3,
      0xea, 0x75, 0x7,  0x43, 0xa1, 0xa3, 0xbe, 0x6b, 0xb8, 0x68, 0x1c, 0x0,  0xc,  0x61, 0xa7, 0x59, 0x34, 0xd,  0xd3,
      0xc4, 0x7d, 0xec, 0x7f, 0x4f, 0x9c, 0x28, 0xe,  0x0,  0x17, 0x95, 0x6e, 0xee, 0x47, 0xee, 0xed, 0x29, 0xc9, 0xa4,
      0xfc, 0x9a, 0x5a, 0x60, 0x4f, 0x90, 0x47, 0x6d, 0xf5, 0x78, 0x7a, 0x67, 0x13, 0x50, 0x84, 0x1,  0x27, 0x0,  0x0,
      0x61, 0xd4, 0x24, 0x5d, 0x29, 0x82, 0x26, 0x0,  0x1c, 0xe6, 0xbc, 0x9c, 0xb6, 0x91, 0xdc, 0x6d, 0x62, 0xc,  0x70,
      0x6c, 0xb2, 0x3c, 0xc2, 0x31, 0x48, 0x6d, 0x84, 0xb5, 0x3f, 0xa6, 0x7c, 0x6,  0x67, 0x89, 0x38, 0x78, 0x4,  0x0,
      0x4,  0x9b, 0x39, 0x36, 0x6b, 0x8,  0x0,  0xb,  0x9e, 0xef, 0xfd, 0x6a, 0xa8, 0x5,  0x56, 0x3e, 0x85, 0x3c, 0xbd,
      0x28, 0x96, 0xb,  0xe,  0x9,  0x0,  0xa,  0xf0, 0x81, 0x9b, 0x75, 0xa4, 0xd8, 0xa1, 0xb2, 0x2f, 0x43, 0x2a, 0xa1,
      0x1c, 0x0,  0xf,  0x86, 0x2a, 0x3a, 0xc8, 0x2c, 0xdb, 0x73, 0x19, 0xfd, 0x46, 0xff, 0xd1, 0x2e, 0xe5, 0xe3, 0x19,
      0x60, 0x1,  0x2d, 0x17, 0x85, 0x25, 0xa4, 0x1c, 0x0,  0x14, 0x56, 0x3f, 0x72, 0x76, 0xed, 0x96, 0xa9, 0x46, 0xbf,
      0x7c, 0x7,  0xa2, 0x5,  0xd3, 0xc1, 0x34, 0xef, 0x31, 0xe7, 0x3e, 0x19, 0xe3, 0xb,  0x12, 0x0,  0x14, 0xb6, 0xd2,
      0xd2, 0xd0, 0xa1, 0x2a, 0xa,  0x67, 0x3e, 0xae, 0xd6, 0xaf, 0xe4, 0xb5, 0xa7, 0xa2, 0x49, 0x3d, 0x92, 0x21, 0x0,
      0xd,  0x32, 0x8a, 0x63, 0x39, 0xea, 0x60, 0xba, 0x40, 0xba, 0x45, 0xa4, 0x39, 0x2b, 0x0,  0x6,  0x3f, 0xd4, 0x9a,
      0xea, 0x81, 0x81, 0x0,  0xd,  0x70, 0x7e, 0x29, 0x7f, 0x56, 0x76, 0xe8, 0x4,  0x2c, 0x1a, 0x8e, 0x61, 0xdf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7c, 0x1b, 0xdd, 0xac, 0x1b, 0xab, 0xbe, 0xd8, 0xbe, 0x64, 0x9a, 0x94,
                           0x69, 0xd8, 0x31, 0xe1, 0x39, 0xd3, 0x72, 0xb9, 0x3b, 0x1c, 0xc,  0x79};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops3[] = {0xf5, 0x6d, 0xaf, 0xe2, 0xa,  0x6e, 0xe1, 0xa4, 0xac, 0x28,
                           0x75, 0xd,  0x33, 0x98, 0xdf, 0x8,  0xe3, 0xae, 0x51};
  uint8_t bytesprops2[] = {0x17, 0xd3, 0x1a, 0x59, 0xe0, 0x31, 0x92, 0xbd, 0x2f, 0x9f, 0x1b};
  uint8_t bytesprops4[] = {0x44, 0x8a, 0x7d, 0xbf, 0x85, 0x7b};
  uint8_t bytesprops5[] = {0x68, 0xe7, 0x0,  0x53, 0x7f, 0x36, 0x46, 0x31, 0x3f, 0x9c, 0x60, 0x4e, 0x6f, 0x6,
                           0x24, 0x7e, 0xbf, 0xb,  0xb4, 0x2d, 0x4b, 0x51, 0x80, 0xe4, 0x2e, 0xab, 0x2a};
  uint8_t bytesprops6[] = {0xcd, 0x5f, 0x5,  0x5d, 0x82, 0xea, 0x5f, 0x80, 0x1e, 0xb0, 0xeb, 0xd8, 0xf7,
                           0x4d, 0xd3, 0xea, 0x75, 0x7,  0x43, 0xa1, 0xa3, 0xbe, 0x6b, 0xb8, 0x68};
  uint8_t bytesprops7[] = {0x61, 0xa7, 0x59, 0x34, 0xd, 0xd3, 0xc4, 0x7d, 0xec, 0x7f, 0x4f, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3919}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops2}, .v = {19, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1648}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8601}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12319}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16400}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3583}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 14}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x9b, 0x39, 0x36, 0x6b};
  uint8_t byteswillprops0[] = {0xe6, 0xbc, 0x9c, 0xb6, 0x91, 0xdc, 0x6d, 0x62, 0xc, 0x70, 0x6c, 0xb2, 0x3c, 0xc2,
                               0x31, 0x48, 0x6d, 0x84, 0xb5, 0x3f, 0xa6, 0x7c, 0x6, 0x67, 0x89, 0x38, 0x78, 0x4};
  uint8_t byteswillprops2[] = {0x9e, 0xef, 0xfd, 0x6a, 0xa8, 0x5, 0x56, 0x3e, 0x85, 0x3c, 0xbd};
  uint8_t byteswillprops3[] = {0xf0, 0x81, 0x9b, 0x75, 0xa4, 0xd8, 0xa1, 0xb2, 0x2f, 0x43};
  uint8_t byteswillprops4[] = {0x86, 0x2a, 0x3a, 0xc8, 0x2c, 0xdb, 0x73, 0x19,
                               0xfd, 0x46, 0xff, 0xd1, 0x2e, 0xe5, 0xe3};
  uint8_t byteswillprops5[] = {0x56, 0x3f, 0x72, 0x76, 0xed, 0x96, 0xa9, 0x46, 0xbf, 0x7c,
                               0x7,  0xa2, 0x5,  0xd3, 0xc1, 0x34, 0xef, 0x31, 0xe7, 0x3e};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25044}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {28, (char*)&byteswillprops0}, .v = {4, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
  };

  lwmqtt_properties_t willprops = {17, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb6, 0xd2, 0xd2, 0xd0, 0xa1, 0x2a, 0xa,  0x67, 0x3e, 0xae,
                                0xd6, 0xaf, 0xe4, 0xb5, 0xa7, 0xa2, 0x49, 0x3d, 0x92, 0x21};
  lwmqtt_string_t will_topic = {20, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x32, 0x8a, 0x63, 0x39, 0xea, 0x60, 0xba, 0x40, 0xba, 0x45, 0xa4, 0x39, 0x2b};
  lwmqtt_string_t will_payload = {13, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19395;
  uint8_t client_id_bytes[] = {0x95, 0x6e, 0xee, 0x47, 0xee, 0xed, 0x29, 0xc9, 0xa4, 0xfc, 0x9a, 0x5a,
                               0x60, 0x4f, 0x90, 0x47, 0x6d, 0xf5, 0x78, 0x7a, 0x67, 0x13, 0x50};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3f, 0xd4, 0x9a, 0xea, 0x81, 0x81};
  lwmqtt_string_t username = {6, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x70, 0x7e, 0x29, 0x7f, 0x56, 0x76, 0xe8, 0x4, 0x2c, 0x1a, 0x8e, 0x61, 0xdf};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\150\213\175\169yq`\DC3\185\158\240\US\228H\158\158\192\153", _password = Just
// "\206c\DC1\187", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS2, _willTopic =
// "'gY\b\203\149\DC3\206\CAN<\CAN\177\205$a\160\135", _willMsg =
// "\162<\STX\222\185\208\196\140\169\175\155\150\NAK\216\r\145\194\173\159\210/\222\f\180\NAK=", _willProps =
// [PropReceiveMaximum 726,PropMessageExpiryInterval 30408,PropSharedSubscriptionAvailable 87,PropResponseTopic
// "\165\"x\149\130\196\231N\234\222\180]'\RS\241\"K\189\239\213",PropResponseInformation
// "G{($\238\&3\184\135w\r\245\215\237\131\157\ENQ'\140\SYN",PropResponseTopic
// "\160\163\192Sx\193\234\220\164\FS\161\163.\192U\182#=RA",PropSubscriptionIdentifier 7,PropRequestProblemInformation
// 165,PropReceiveMaximum 10578,PropSubscriptionIdentifier 2,PropTopicAliasMaximum 7623,PropSharedSubscriptionAvailable
// 28,PropRequestProblemInformation 169,PropWillDelayInterval 32532,PropAuthenticationData
// "\218<Nd\238h\205\156!$]\220",PropMessageExpiryInterval 12084,PropTopicAlias 22979,PropServerKeepAlive
// 28253,PropSessionExpiryInterval 14469,PropCorrelationData
// "(\143b\133/?\193V\161\251\227C\205\EOTs\218\172!\DEL\244}V\186G,\229=H",PropAuthenticationMethod
// "",PropServerKeepAlive 20225,PropReasonString "\RS3\205\175\215-J\218\254V,\235\189",PropServerKeepAlive 23004]}),
// _cleanSession = True, _keepAlive = 5366, _connID = "\230\209$f\202\238\227", _properties = [PropMaximumPacketSize
// 6392,PropMessageExpiryInterval 10871,PropReceiveMaximum 18277,PropWildcardSubscriptionAvailable
// 28,PropRequestProblemInformation 221,PropAssignedClientIdentifier
// "\177\&5];\215\191\186CY\184+\167\242\DLE\133\190n\225\"\197\219\SO\217\163",PropTopicAlias 2934,PropServerReference
// "\221\&2\DEL\236\153\NAK\161\172C",PropServerReference "\EM#3\202'\SI\EOT\177\215\211\225\FS",PropResponseTopic
// "\rMB\231\131\&7W\187\189\&6+6\245\214s\a\180\129\186\145",PropResponseInformation
// "v\161\142$\129\181\201\157\135\f\b\139F\EOTMA'\174)U\180\SUB\129\217\217q\192\EOTK",PropServerReference
// "v\234\232l",PropCorrelationData "aI\187\184u\244\215w\ETB\216\188U!\EM\183",PropPayloadFormatIndicator
// 224,PropAuthenticationData "",PropUserProperty "\NUL\227\190\191\140\192V\237Jm>\a\152\197)"
// "\202^\229G\149\166\NUL=\186\179\201\216,\185\231\154;\FS\228\241\&8\215M\133",PropAssignedClientIdentifier
// "\153\238_dL}\251\226r\191\145\240>",PropReceiveMaximum 11564,PropResponseInformation
// "\138{\ESC\137A|\240_,H1\202F\243",PropSharedSubscriptionAvailable 196,PropResponseTopic
// "-6p\190\&3\160`\186\247jK,R{-\203\146",PropAuthenticationMethod
// "\251\168\249n\"\STXu\NAK\167!\184h-\255F\170s",PropRequestProblemInformation 50,PropWillDelayInterval
// 8644,PropContentType "9\147]\133s\f2)\EM\168\&5\166\DELNl\242\t\145\&6+\182\223",PropServerKeepAlive
// 28557,PropTopicAlias 12014,PropRetainAvailable 73,PropResponseInformation "6\a\CAN0\EOT.\170\DC1P"]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xe7, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x14, 0xf6, 0xcd, 0x2,  0x27, 0x0,  0x0,  0x18,
      0xf8, 0x2,  0x0,  0x0,  0x2a, 0x77, 0x21, 0x47, 0x65, 0x28, 0x1c, 0x17, 0xdd, 0x12, 0x0,  0x18, 0xb1, 0x35, 0x5d,
      0x3b, 0xd7, 0xbf, 0xba, 0x43, 0x59, 0xb8, 0x2b, 0xa7, 0xf2, 0x10, 0x85, 0xbe, 0x6e, 0xe1, 0x22, 0xc5, 0xdb, 0xe,
      0xd9, 0xa3, 0x23, 0xb,  0x76, 0x1c, 0x0,  0x9,  0xdd, 0x32, 0x7f, 0xec, 0x99, 0x15, 0xa1, 0xac, 0x43, 0x1c, 0x0,
      0xc,  0x19, 0x23, 0x33, 0xca, 0x27, 0xf,  0x4,  0xb1, 0xd7, 0xd3, 0xe1, 0x1c, 0x8,  0x0,  0x14, 0xd,  0x4d, 0x42,
      0xe7, 0x83, 0x37, 0x57, 0xbb, 0xbd, 0x36, 0x2b, 0x36, 0xf5, 0xd6, 0x73, 0x7,  0xb4, 0x81, 0xba, 0x91, 0x1a, 0x0,
      0x1d, 0x76, 0xa1, 0x8e, 0x24, 0x81, 0xb5, 0xc9, 0x9d, 0x87, 0xc,  0x8,  0x8b, 0x46, 0x4,  0x4d, 0x41, 0x27, 0xae,
      0x29, 0x55, 0xb4, 0x1a, 0x81, 0xd9, 0xd9, 0x71, 0xc0, 0x4,  0x4b, 0x1c, 0x0,  0x4,  0x76, 0xea, 0xe8, 0x6c, 0x9,
      0x0,  0xf,  0x61, 0x49, 0xbb, 0xb8, 0x75, 0xf4, 0xd7, 0x77, 0x17, 0xd8, 0xbc, 0x55, 0x21, 0x19, 0xb7, 0x1,  0xe0,
      0x16, 0x0,  0x0,  0x26, 0x0,  0xf,  0x0,  0xe3, 0xbe, 0xbf, 0x8c, 0xc0, 0x56, 0xed, 0x4a, 0x6d, 0x3e, 0x7,  0x98,
      0xc5, 0x29, 0x0,  0x18, 0xca, 0x5e, 0xe5, 0x47, 0x95, 0xa6, 0x0,  0x3d, 0xba, 0xb3, 0xc9, 0xd8, 0x2c, 0xb9, 0xe7,
      0x9a, 0x3b, 0x1c, 0xe4, 0xf1, 0x38, 0xd7, 0x4d, 0x85, 0x12, 0x0,  0xd,  0x99, 0xee, 0x5f, 0x64, 0x4c, 0x7d, 0xfb,
      0xe2, 0x72, 0xbf, 0x91, 0xf0, 0x3e, 0x21, 0x2d, 0x2c, 0x1a, 0x0,  0xe,  0x8a, 0x7b, 0x1b, 0x89, 0x41, 0x7c, 0xf0,
      0x5f, 0x2c, 0x48, 0x31, 0xca, 0x46, 0xf3, 0x2a, 0xc4, 0x8,  0x0,  0x11, 0x2d, 0x36, 0x70, 0xbe, 0x33, 0xa0, 0x60,
      0xba, 0xf7, 0x6a, 0x4b, 0x2c, 0x52, 0x7b, 0x2d, 0xcb, 0x92, 0x15, 0x0,  0x11, 0xfb, 0xa8, 0xf9, 0x6e, 0x22, 0x2,
      0x75, 0x15, 0xa7, 0x21, 0xb8, 0x68, 0x2d, 0xff, 0x46, 0xaa, 0x73, 0x17, 0x32, 0x18, 0x0,  0x0,  0x21, 0xc4, 0x3,
      0x0,  0x16, 0x39, 0x93, 0x5d, 0x85, 0x73, 0xc,  0x32, 0x29, 0x19, 0xa8, 0x35, 0xa6, 0x7f, 0x4e, 0x6c, 0xf2, 0x9,
      0x91, 0x36, 0x2b, 0xb6, 0xdf, 0x13, 0x6f, 0x8d, 0x23, 0x2e, 0xee, 0x25, 0x49, 0x1a, 0x0,  0x9,  0x36, 0x7,  0x18,
      0x30, 0x4,  0x2e, 0xaa, 0x11, 0x50, 0x0,  0x7,  0xe6, 0xd1, 0x24, 0x66, 0xca, 0xee, 0xe3, 0xba, 0x1,  0x21, 0x2,
      0xd6, 0x2,  0x0,  0x0,  0x76, 0xc8, 0x2a, 0x57, 0x8,  0x0,  0x14, 0xa5, 0x22, 0x78, 0x95, 0x82, 0xc4, 0xe7, 0x4e,
      0xea, 0xde, 0xb4, 0x5d, 0x27, 0x1e, 0xf1, 0x22, 0x4b, 0xbd, 0xef, 0xd5, 0x1a, 0x0,  0x13, 0x47, 0x7b, 0x28, 0x24,
      0xee, 0x33, 0xb8, 0x87, 0x77, 0xd,  0xf5, 0xd7, 0xed, 0x83, 0x9d, 0x5,  0x27, 0x8c, 0x16, 0x8,  0x0,  0x14, 0xa0,
      0xa3, 0xc0, 0x53, 0x78, 0xc1, 0xea, 0xdc, 0xa4, 0x1c, 0xa1, 0xa3, 0x2e, 0xc0, 0x55, 0xb6, 0x23, 0x3d, 0x52, 0x41,
      0xb,  0x7,  0x17, 0xa5, 0x21, 0x29, 0x52, 0xb,  0x2,  0x22, 0x1d, 0xc7, 0x2a, 0x1c, 0x17, 0xa9, 0x18, 0x0,  0x0,
      0x7f, 0x14, 0x16, 0x0,  0xc,  0xda, 0x3c, 0x4e, 0x64, 0xee, 0x68, 0xcd, 0x9c, 0x21, 0x24, 0x5d, 0xdc, 0x2,  0x0,
      0x0,  0x2f, 0x34, 0x23, 0x59, 0xc3, 0x13, 0x6e, 0x5d, 0x11, 0x0,  0x0,  0x38, 0x85, 0x9,  0x0,  0x1c, 0x28, 0x8f,
      0x62, 0x85, 0x2f, 0x3f, 0xc1, 0x56, 0xa1, 0xfb, 0xe3, 0x43, 0xcd, 0x4,  0x73, 0xda, 0xac, 0x21, 0x7f, 0xf4, 0x7d,
      0x56, 0xba, 0x47, 0x2c, 0xe5, 0x3d, 0x48, 0x15, 0x0,  0x0,  0x13, 0x4f, 0x1,  0x1f, 0x0,  0xd,  0x1e, 0x33, 0xcd,
      0xaf, 0xd7, 0x2d, 0x4a, 0xda, 0xfe, 0x56, 0x2c, 0xeb, 0xbd, 0x13, 0x59, 0xdc, 0x0,  0x11, 0x27, 0x67, 0x59, 0x8,
      0xcb, 0x95, 0x13, 0xce, 0x18, 0x3c, 0x18, 0xb1, 0xcd, 0x24, 0x61, 0xa0, 0x87, 0x0,  0x1a, 0xa2, 0x3c, 0x2,  0xde,
      0xb9, 0xd0, 0xc4, 0x8c, 0xa9, 0xaf, 0x9b, 0x96, 0x15, 0xd8, 0xd,  0x91, 0xc2, 0xad, 0x9f, 0xd2, 0x2f, 0xde, 0xc,
      0xb4, 0x15, 0x3d, 0x0,  0x12, 0x96, 0xd5, 0xaf, 0xa9, 0x79, 0x71, 0x60, 0x13, 0xb9, 0x9e, 0xf0, 0x1f, 0xe4, 0x48,
      0x9e, 0x9e, 0xc0, 0x99, 0x0,  0x4,  0xce, 0x63, 0x11, 0xbb};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb1, 0x35, 0x5d, 0x3b, 0xd7, 0xbf, 0xba, 0x43, 0x59, 0xb8, 0x2b, 0xa7,
                           0xf2, 0x10, 0x85, 0xbe, 0x6e, 0xe1, 0x22, 0xc5, 0xdb, 0xe,  0xd9, 0xa3};
  uint8_t bytesprops1[] = {0xdd, 0x32, 0x7f, 0xec, 0x99, 0x15, 0xa1, 0xac, 0x43};
  uint8_t bytesprops2[] = {0x19, 0x23, 0x33, 0xca, 0x27, 0xf, 0x4, 0xb1, 0xd7, 0xd3, 0xe1, 0x1c};
  uint8_t bytesprops3[] = {0xd,  0x4d, 0x42, 0xe7, 0x83, 0x37, 0x57, 0xbb, 0xbd, 0x36,
                           0x2b, 0x36, 0xf5, 0xd6, 0x73, 0x7,  0xb4, 0x81, 0xba, 0x91};
  uint8_t bytesprops4[] = {0x76, 0xa1, 0x8e, 0x24, 0x81, 0xb5, 0xc9, 0x9d, 0x87, 0xc,  0x8,  0x8b, 0x46, 0x4, 0x4d,
                           0x41, 0x27, 0xae, 0x29, 0x55, 0xb4, 0x1a, 0x81, 0xd9, 0xd9, 0x71, 0xc0, 0x4,  0x4b};
  uint8_t bytesprops5[] = {0x76, 0xea, 0xe8, 0x6c};
  uint8_t bytesprops6[] = {0x61, 0x49, 0xbb, 0xb8, 0x75, 0xf4, 0xd7, 0x77, 0x17, 0xd8, 0xbc, 0x55, 0x21, 0x19, 0xb7};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops9[] = {0xca, 0x5e, 0xe5, 0x47, 0x95, 0xa6, 0x0,  0x3d, 0xba, 0xb3, 0xc9, 0xd8,
                           0x2c, 0xb9, 0xe7, 0x9a, 0x3b, 0x1c, 0xe4, 0xf1, 0x38, 0xd7, 0x4d, 0x85};
  uint8_t bytesprops8[] = {0x0, 0xe3, 0xbe, 0xbf, 0x8c, 0xc0, 0x56, 0xed, 0x4a, 0x6d, 0x3e, 0x7, 0x98, 0xc5, 0x29};
  uint8_t bytesprops10[] = {0x99, 0xee, 0x5f, 0x64, 0x4c, 0x7d, 0xfb, 0xe2, 0x72, 0xbf, 0x91, 0xf0, 0x3e};
  uint8_t bytesprops11[] = {0x8a, 0x7b, 0x1b, 0x89, 0x41, 0x7c, 0xf0, 0x5f, 0x2c, 0x48, 0x31, 0xca, 0x46, 0xf3};
  uint8_t bytesprops12[] = {0x2d, 0x36, 0x70, 0xbe, 0x33, 0xa0, 0x60, 0xba, 0xf7,
                            0x6a, 0x4b, 0x2c, 0x52, 0x7b, 0x2d, 0xcb, 0x92};
  uint8_t bytesprops13[] = {0xfb, 0xa8, 0xf9, 0x6e, 0x22, 0x2,  0x75, 0x15, 0xa7,
                            0x21, 0xb8, 0x68, 0x2d, 0xff, 0x46, 0xaa, 0x73};
  uint8_t bytesprops14[] = {0x39, 0x93, 0x5d, 0x85, 0x73, 0xc, 0x32, 0x29, 0x19, 0xa8, 0x35,
                            0xa6, 0x7f, 0x4e, 0x6c, 0xf2, 0x9, 0x91, 0x36, 0x2b, 0xb6, 0xdf};
  uint8_t bytesprops15[] = {0x36, 0x7, 0x18, 0x30, 0x4, 0x2e, 0xaa, 0x11, 0x50};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6392}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10871}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18277}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2934}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops8}, .v = {24, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11564}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8644}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28557}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12014}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops15}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa5, 0x22, 0x78, 0x95, 0x82, 0xc4, 0xe7, 0x4e, 0xea, 0xde,
                               0xb4, 0x5d, 0x27, 0x1e, 0xf1, 0x22, 0x4b, 0xbd, 0xef, 0xd5};
  uint8_t byteswillprops1[] = {0x47, 0x7b, 0x28, 0x24, 0xee, 0x33, 0xb8, 0x87, 0x77, 0xd,
                               0xf5, 0xd7, 0xed, 0x83, 0x9d, 0x5,  0x27, 0x8c, 0x16};
  uint8_t byteswillprops2[] = {0xa0, 0xa3, 0xc0, 0x53, 0x78, 0xc1, 0xea, 0xdc, 0xa4, 0x1c,
                               0xa1, 0xa3, 0x2e, 0xc0, 0x55, 0xb6, 0x23, 0x3d, 0x52, 0x41};
  uint8_t byteswillprops3[] = {0xda, 0x3c, 0x4e, 0x64, 0xee, 0x68, 0xcd, 0x9c, 0x21, 0x24, 0x5d, 0xdc};
  uint8_t byteswillprops4[] = {0x28, 0x8f, 0x62, 0x85, 0x2f, 0x3f, 0xc1, 0x56, 0xa1, 0xfb, 0xe3, 0x43, 0xcd, 0x4,
                               0x73, 0xda, 0xac, 0x21, 0x7f, 0xf4, 0x7d, 0x56, 0xba, 0x47, 0x2c, 0xe5, 0x3d, 0x48};
  uint8_t byteswillprops5[] = {0};
  uint8_t byteswillprops6[] = {0x1e, 0x33, 0xcd, 0xaf, 0xd7, 0x2d, 0x4a, 0xda, 0xfe, 0x56, 0x2c, 0xeb, 0xbd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 726}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30408}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10578}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 2}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7623}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32532}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12084}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22979}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28253}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14469}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20225}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23004}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x27, 0x67, 0x59, 0x8,  0xcb, 0x95, 0x13, 0xce, 0x18,
                                0x3c, 0x18, 0xb1, 0xcd, 0x24, 0x61, 0xa0, 0x87};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa2, 0x3c, 0x2,  0xde, 0xb9, 0xd0, 0xc4, 0x8c, 0xa9, 0xaf, 0x9b, 0x96, 0x15,
                                  0xd8, 0xd,  0x91, 0xc2, 0xad, 0x9f, 0xd2, 0x2f, 0xde, 0xc,  0xb4, 0x15, 0x3d};
  lwmqtt_string_t will_payload = {26, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 5366;
  uint8_t client_id_bytes[] = {0xe6, 0xd1, 0x24, 0x66, 0xca, 0xee, 0xe3};
  lwmqtt_string_t client_id = {7, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x96, 0xd5, 0xaf, 0xa9, 0x79, 0x71, 0x60, 0x13, 0xb9,
                              0x9e, 0xf0, 0x1f, 0xe4, 0x48, 0x9e, 0x9e, 0xc0, 0x99};
  lwmqtt_string_t username = {18, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xce, 0x63, 0x11, 0xbb};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\129\128\161\159\147\245-e\bJ_\149 \184p.t,\236Q\211\160XD\SUB\239\DEL\DC2\144",
// _password = Just "\240\244", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\135\ETXg\SIO\185\150d\172+QZ", _willMsg = "\232\GS\202P\180x\186\243}<\155\148:\217\145'", _willProps =
// [PropResponseInformation "\156\196\210\158\219\156+'\RS\190\199yd\"\NAK",PropMessageExpiryInterval
// 23010,PropAssignedClientIdentifier "\DEL\231K\158\NUL\FS",PropSubscriptionIdentifier 24,PropAuthenticationData
// "W\EOT\GS\192l",PropRequestProblemInformation 26,PropSubscriptionIdentifierAvailable 196,PropSubscriptionIdentifier
// 7,PropMaximumQoS 107,PropReceiveMaximum 6946,PropSubscriptionIdentifierAvailable
// 74,PropSubscriptionIdentifierAvailable 84,PropRetainAvailable 210,PropRetainAvailable 227,PropCorrelationData
// "4T\235",PropTopicAlias 2606,PropContentType
// "\196_\RSz\218\DC2\129\240\142\SI;\178\128\214\n2Xa\255\152",PropReasonString
// "\188\SO\EOT\153\ETBi\251",PropCorrelationData "\ACK\151j",PropServerKeepAlive 32148,PropResponseTopic
// "\233\244(",PropUserProperty "\144\&4\SOH\DC4\211\148\238p" "\208\142\165],=\178\246",PropSubscriptionIdentifier
// 7,PropAuthenticationData "\213\&3\164\208JRg\195yY\201\186U\DC4w2*\230a\140\194K%\CAN\198\136",PropMaximumPacketSize
// 9903,PropReceiveMaximum 8076,PropRetainAvailable 52]}), _cleanSession = True, _keepAlive = 30463, _connID =
// "\171v+\163\172\203\229S\191\242VUR\b\DLE\179J\234", _properties = [PropSharedSubscriptionAvailable
// 231,PropServerKeepAlive 30540,PropWillDelayInterval 5194,PropWillDelayInterval 15709,PropAuthenticationData
// "\247\&5\f\212\162\r\198\148\245A\191u\188pHR",PropRequestProblemInformation 159,PropAuthenticationData
// "\145<\GSaD\195",PropSharedSubscriptionAvailable 185,PropReasonString
// "!\183\142\222L[8\141\DC1\184c\163\tMb\173\DC3}\133\250\189\183",PropCorrelationData
// "\173\144\163\ENQ%V\221\viP",PropCorrelationData "\251\189\NUL\175\199R\rL\226IT\205",PropPayloadFormatIndicator
// 251,PropSharedSubscriptionAvailable 19,PropAssignedClientIdentifier
// "\221\175\203/ii\241\176\164E\US\196#\180\201A-=q8\242\230f\v`",PropResponseInformation
// "v9m5@\235\192\204\202\246\249\132\238\155Er\234\213]<k\"",PropReceiveMaximum 862,PropReasonString
// "i",PropServerReference
// "V\155\&5\186:\201\136\201K]\201bSN\DELT6f\236iX\162+#\157\245\195\fu",PropRequestProblemInformation
// 54,PropPayloadFormatIndicator 120,PropWildcardSubscriptionAvailable 168]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0xe3, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x76, 0xff, 0xca, 0x1,  0x2a, 0xe7, 0x13, 0x77,
      0x4c, 0x18, 0x0,  0x0,  0x14, 0x4a, 0x18, 0x0,  0x0,  0x3d, 0x5d, 0x16, 0x0,  0x10, 0xf7, 0x35, 0xc,  0xd4, 0xa2,
      0xd,  0xc6, 0x94, 0xf5, 0x41, 0xbf, 0x75, 0xbc, 0x70, 0x48, 0x52, 0x17, 0x9f, 0x16, 0x0,  0x6,  0x91, 0x3c, 0x1d,
      0x61, 0x44, 0xc3, 0x2a, 0xb9, 0x1f, 0x0,  0x16, 0x21, 0xb7, 0x8e, 0xde, 0x4c, 0x5b, 0x38, 0x8d, 0x11, 0xb8, 0x63,
      0xa3, 0x9,  0x4d, 0x62, 0xad, 0x13, 0x7d, 0x85, 0xfa, 0xbd, 0xb7, 0x9,  0x0,  0xa,  0xad, 0x90, 0xa3, 0x5,  0x25,
      0x56, 0xdd, 0xb,  0x69, 0x50, 0x9,  0x0,  0xc,  0xfb, 0xbd, 0x0,  0xaf, 0xc7, 0x52, 0xd,  0x4c, 0xe2, 0x49, 0x54,
      0xcd, 0x1,  0xfb, 0x2a, 0x13, 0x12, 0x0,  0x19, 0xdd, 0xaf, 0xcb, 0x2f, 0x69, 0x69, 0xf1, 0xb0, 0xa4, 0x45, 0x1f,
      0xc4, 0x23, 0xb4, 0xc9, 0x41, 0x2d, 0x3d, 0x71, 0x38, 0xf2, 0xe6, 0x66, 0xb,  0x60, 0x1a, 0x0,  0x16, 0x76, 0x39,
      0x6d, 0x35, 0x40, 0xeb, 0xc0, 0xcc, 0xca, 0xf6, 0xf9, 0x84, 0xee, 0x9b, 0x45, 0x72, 0xea, 0xd5, 0x5d, 0x3c, 0x6b,
      0x22, 0x21, 0x3,  0x5e, 0x1f, 0x0,  0x1,  0x69, 0x1c, 0x0,  0x1d, 0x56, 0x9b, 0x35, 0xba, 0x3a, 0xc9, 0x88, 0xc9,
      0x4b, 0x5d, 0xc9, 0x62, 0x53, 0x4e, 0x7f, 0x54, 0x36, 0x66, 0xec, 0x69, 0x58, 0xa2, 0x2b, 0x23, 0x9d, 0xf5, 0xc3,
      0xc,  0x75, 0x17, 0x36, 0x1,  0x78, 0x28, 0xa8, 0x0,  0x12, 0xab, 0x76, 0x2b, 0xa3, 0xac, 0xcb, 0xe5, 0x53, 0xbf,
      0xf2, 0x56, 0x55, 0x52, 0x8,  0x10, 0xb3, 0x4a, 0xea, 0xb4, 0x1,  0x1a, 0x0,  0xf,  0x9c, 0xc4, 0xd2, 0x9e, 0xdb,
      0x9c, 0x2b, 0x27, 0x1e, 0xbe, 0xc7, 0x79, 0x64, 0x22, 0x15, 0x2,  0x0,  0x0,  0x59, 0xe2, 0x12, 0x0,  0x6,  0x7f,
      0xe7, 0x4b, 0x9e, 0x0,  0x1c, 0xb,  0x18, 0x16, 0x0,  0x5,  0x57, 0x4,  0x1d, 0xc0, 0x6c, 0x17, 0x1a, 0x29, 0xc4,
      0xb,  0x7,  0x24, 0x6b, 0x21, 0x1b, 0x22, 0x29, 0x4a, 0x29, 0x54, 0x25, 0xd2, 0x25, 0xe3, 0x9,  0x0,  0x3,  0x34,
      0x54, 0xeb, 0x23, 0xa,  0x2e, 0x3,  0x0,  0x14, 0xc4, 0x5f, 0x1e, 0x7a, 0xda, 0x12, 0x81, 0xf0, 0x8e, 0xf,  0x3b,
      0xb2, 0x80, 0xd6, 0xa,  0x32, 0x58, 0x61, 0xff, 0x98, 0x1f, 0x0,  0x7,  0xbc, 0xe,  0x4,  0x99, 0x17, 0x69, 0xfb,
      0x9,  0x0,  0x3,  0x6,  0x97, 0x6a, 0x13, 0x7d, 0x94, 0x8,  0x0,  0x3,  0xe9, 0xf4, 0x28, 0x26, 0x0,  0x8,  0x90,
      0x34, 0x1,  0x14, 0xd3, 0x94, 0xee, 0x70, 0x0,  0x8,  0xd0, 0x8e, 0xa5, 0x5d, 0x2c, 0x3d, 0xb2, 0xf6, 0xb,  0x7,
      0x16, 0x0,  0x1a, 0xd5, 0x33, 0xa4, 0xd0, 0x4a, 0x52, 0x67, 0xc3, 0x79, 0x59, 0xc9, 0xba, 0x55, 0x14, 0x77, 0x32,
      0x2a, 0xe6, 0x61, 0x8c, 0xc2, 0x4b, 0x25, 0x18, 0xc6, 0x88, 0x27, 0x0,  0x0,  0x26, 0xaf, 0x21, 0x1f, 0x8c, 0x25,
      0x34, 0x0,  0xc,  0x87, 0x3,  0x67, 0xf,  0x4f, 0xb9, 0x96, 0x64, 0xac, 0x2b, 0x51, 0x5a, 0x0,  0x10, 0xe8, 0x1d,
      0xca, 0x50, 0xb4, 0x78, 0xba, 0xf3, 0x7d, 0x3c, 0x9b, 0x94, 0x3a, 0xd9, 0x91, 0x27, 0x0,  0x1d, 0x81, 0x80, 0xa1,
      0x9f, 0x93, 0xf5, 0x2d, 0x65, 0x8,  0x4a, 0x5f, 0x95, 0x20, 0xb8, 0x70, 0x2e, 0x74, 0x2c, 0xec, 0x51, 0xd3, 0xa0,
      0x58, 0x44, 0x1a, 0xef, 0x7f, 0x12, 0x90, 0x0,  0x2,  0xf0, 0xf4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf7, 0x35, 0xc,  0xd4, 0xa2, 0xd,  0xc6, 0x94,
                           0xf5, 0x41, 0xbf, 0x75, 0xbc, 0x70, 0x48, 0x52};
  uint8_t bytesprops1[] = {0x91, 0x3c, 0x1d, 0x61, 0x44, 0xc3};
  uint8_t bytesprops2[] = {0x21, 0xb7, 0x8e, 0xde, 0x4c, 0x5b, 0x38, 0x8d, 0x11, 0xb8, 0x63,
                           0xa3, 0x9,  0x4d, 0x62, 0xad, 0x13, 0x7d, 0x85, 0xfa, 0xbd, 0xb7};
  uint8_t bytesprops3[] = {0xad, 0x90, 0xa3, 0x5, 0x25, 0x56, 0xdd, 0xb, 0x69, 0x50};
  uint8_t bytesprops4[] = {0xfb, 0xbd, 0x0, 0xaf, 0xc7, 0x52, 0xd, 0x4c, 0xe2, 0x49, 0x54, 0xcd};
  uint8_t bytesprops5[] = {0xdd, 0xaf, 0xcb, 0x2f, 0x69, 0x69, 0xf1, 0xb0, 0xa4, 0x45, 0x1f, 0xc4, 0x23,
                           0xb4, 0xc9, 0x41, 0x2d, 0x3d, 0x71, 0x38, 0xf2, 0xe6, 0x66, 0xb,  0x60};
  uint8_t bytesprops6[] = {0x76, 0x39, 0x6d, 0x35, 0x40, 0xeb, 0xc0, 0xcc, 0xca, 0xf6, 0xf9,
                           0x84, 0xee, 0x9b, 0x45, 0x72, 0xea, 0xd5, 0x5d, 0x3c, 0x6b, 0x22};
  uint8_t bytesprops7[] = {0x69};
  uint8_t bytesprops8[] = {0x56, 0x9b, 0x35, 0xba, 0x3a, 0xc9, 0x88, 0xc9, 0x4b, 0x5d, 0xc9, 0x62, 0x53, 0x4e, 0x7f,
                           0x54, 0x36, 0x66, 0xec, 0x69, 0x58, 0xa2, 0x2b, 0x23, 0x9d, 0xf5, 0xc3, 0xc,  0x75};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30540}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5194}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15709}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 862}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 168}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9c, 0xc4, 0xd2, 0x9e, 0xdb, 0x9c, 0x2b, 0x27,
                               0x1e, 0xbe, 0xc7, 0x79, 0x64, 0x22, 0x15};
  uint8_t byteswillprops1[] = {0x7f, 0xe7, 0x4b, 0x9e, 0x0, 0x1c};
  uint8_t byteswillprops2[] = {0x57, 0x4, 0x1d, 0xc0, 0x6c};
  uint8_t byteswillprops3[] = {0x34, 0x54, 0xeb};
  uint8_t byteswillprops4[] = {0xc4, 0x5f, 0x1e, 0x7a, 0xda, 0x12, 0x81, 0xf0, 0x8e, 0xf,
                               0x3b, 0xb2, 0x80, 0xd6, 0xa,  0x32, 0x58, 0x61, 0xff, 0x98};
  uint8_t byteswillprops5[] = {0xbc, 0xe, 0x4, 0x99, 0x17, 0x69, 0xfb};
  uint8_t byteswillprops6[] = {0x6, 0x97, 0x6a};
  uint8_t byteswillprops7[] = {0xe9, 0xf4, 0x28};
  uint8_t byteswillprops9[] = {0xd0, 0x8e, 0xa5, 0x5d, 0x2c, 0x3d, 0xb2, 0xf6};
  uint8_t byteswillprops8[] = {0x90, 0x34, 0x1, 0x14, 0xd3, 0x94, 0xee, 0x70};
  uint8_t byteswillprops10[] = {0xd5, 0x33, 0xa4, 0xd0, 0x4a, 0x52, 0x67, 0xc3, 0x79, 0x59, 0xc9, 0xba, 0x55,
                                0x14, 0x77, 0x32, 0x2a, 0xe6, 0x61, 0x8c, 0xc2, 0x4b, 0x25, 0x18, 0xc6, 0x88};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23010}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6946}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2606}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32148}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops8}, .v = {8, (char*)&byteswillprops9}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9903}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8076}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 52}},
  };

  lwmqtt_properties_t willprops = {27, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x87, 0x3, 0x67, 0xf, 0x4f, 0xb9, 0x96, 0x64, 0xac, 0x2b, 0x51, 0x5a};
  lwmqtt_string_t will_topic = {12, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe8, 0x1d, 0xca, 0x50, 0xb4, 0x78, 0xba, 0xf3,
                                  0x7d, 0x3c, 0x9b, 0x94, 0x3a, 0xd9, 0x91, 0x27};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30463;
  uint8_t client_id_bytes[] = {0xab, 0x76, 0x2b, 0xa3, 0xac, 0xcb, 0xe5, 0x53, 0xbf,
                               0xf2, 0x56, 0x55, 0x52, 0x8,  0x10, 0xb3, 0x4a, 0xea};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x81, 0x80, 0xa1, 0x9f, 0x93, 0xf5, 0x2d, 0x65, 0x8,  0x4a, 0x5f, 0x95, 0x20, 0xb8, 0x70,
                              0x2e, 0x74, 0x2c, 0xec, 0x51, 0xd3, 0xa0, 0x58, 0x44, 0x1a, 0xef, 0x7f, 0x12, 0x90};
  lwmqtt_string_t username = {29, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf0, 0xf4};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just ".2\214\236%\167C\190\248\193\211@$\248", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "\211\192\177\134\&8\245\197\148\144\238\147T?",
// _willMsg = "Ws\ETB\210;\DC3\230~\159t\212k(\175\174\"\239\CAN\193\229\255", _willProps = [PropAuthenticationMethod
// "",PropServerReference "\"o\220\230\&2\155\146{\NAK\r\192\&0\128\NAK\136\238*\ENQ\189F",PropAssignedClientIdentifier
// "\ETXlE\161\233b\ETX\EOT\142\141]\237V\199e\198\218\162q\GSE\152\179+K\178\r6"]}), _cleanSession = False, _keepAlive
// = 24806, _connID = "\226W\228\136%h\248C\190\131\204\147f\NAKn\148 \184\208#\240\FSf\FS3T\231", _properties =
// [PropTopicAlias 4710,PropMessageExpiryInterval 25682,PropResponseTopic
// "\DEL\235\130l\224S+?-\EOT1f\154",PropUserProperty "\SOH\139\245\"\179\231\174\150\176\173"
// "_\204\142v\216\182\250\186\&6\206\GS\SUB\236\223\239\132\180:\251^\ETBU\163\182\&1\234\255\&9",PropRequestProblemInformation
// 235,PropRetainAvailable 63,PropCorrelationData "{\142U\245\218\143\209p\GS\a3\232\ACK4\a+\167"]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x10, 0xf3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xac, 0x60, 0xe6, 0x5b, 0x23, 0x12, 0x66, 0x2,  0x0,
      0x0,  0x64, 0x52, 0x8,  0x0,  0xd,  0x7f, 0xeb, 0x82, 0x6c, 0xe0, 0x53, 0x2b, 0x3f, 0x2d, 0x4,  0x31, 0x66, 0x9a,
      0x26, 0x0,  0xa,  0x1,  0x8b, 0xf5, 0x22, 0xb3, 0xe7, 0xae, 0x96, 0xb0, 0xad, 0x0,  0x1c, 0x5f, 0xcc, 0x8e, 0x76,
      0xd8, 0xb6, 0xfa, 0xba, 0x36, 0xce, 0x1d, 0x1a, 0xec, 0xdf, 0xef, 0x84, 0xb4, 0x3a, 0xfb, 0x5e, 0x17, 0x55, 0xa3,
      0xb6, 0x31, 0xea, 0xff, 0x39, 0x17, 0xeb, 0x25, 0x3f, 0x9,  0x0,  0x11, 0x7b, 0x8e, 0x55, 0xf5, 0xda, 0x8f, 0xd1,
      0x70, 0x1d, 0x7,  0x33, 0xe8, 0x6,  0x34, 0x7,  0x2b, 0xa7, 0x0,  0x1b, 0xe2, 0x57, 0xe4, 0x88, 0x25, 0x68, 0xf8,
      0x43, 0xbe, 0x83, 0xcc, 0x93, 0x66, 0x15, 0x6e, 0x94, 0x20, 0xb8, 0xd0, 0x23, 0xf0, 0x1c, 0x66, 0x1c, 0x33, 0x54,
      0xe7, 0x39, 0x15, 0x0,  0x0,  0x1c, 0x0,  0x14, 0x22, 0x6f, 0xdc, 0xe6, 0x32, 0x9b, 0x92, 0x7b, 0x15, 0xd,  0xc0,
      0x30, 0x80, 0x15, 0x88, 0xee, 0x2a, 0x5,  0xbd, 0x46, 0x12, 0x0,  0x1c, 0x3,  0x6c, 0x45, 0xa1, 0xe9, 0x62, 0x3,
      0x4,  0x8e, 0x8d, 0x5d, 0xed, 0x56, 0xc7, 0x65, 0xc6, 0xda, 0xa2, 0x71, 0x1d, 0x45, 0x98, 0xb3, 0x2b, 0x4b, 0xb2,
      0xd,  0x36, 0x0,  0xd,  0xd3, 0xc0, 0xb1, 0x86, 0x38, 0xf5, 0xc5, 0x94, 0x90, 0xee, 0x93, 0x54, 0x3f, 0x0,  0x15,
      0x57, 0x73, 0x17, 0xd2, 0x3b, 0x13, 0xe6, 0x7e, 0x9f, 0x74, 0xd4, 0x6b, 0x28, 0xaf, 0xae, 0x22, 0xef, 0x18, 0xc1,
      0xe5, 0xff, 0x0,  0xe,  0x2e, 0x32, 0xd6, 0xec, 0x25, 0xa7, 0x43, 0xbe, 0xf8, 0xc1, 0xd3, 0x40, 0x24, 0xf8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7f, 0xeb, 0x82, 0x6c, 0xe0, 0x53, 0x2b, 0x3f, 0x2d, 0x4, 0x31, 0x66, 0x9a};
  uint8_t bytesprops2[] = {0x5f, 0xcc, 0x8e, 0x76, 0xd8, 0xb6, 0xfa, 0xba, 0x36, 0xce, 0x1d, 0x1a, 0xec, 0xdf,
                           0xef, 0x84, 0xb4, 0x3a, 0xfb, 0x5e, 0x17, 0x55, 0xa3, 0xb6, 0x31, 0xea, 0xff, 0x39};
  uint8_t bytesprops1[] = {0x1, 0x8b, 0xf5, 0x22, 0xb3, 0xe7, 0xae, 0x96, 0xb0, 0xad};
  uint8_t bytesprops3[] = {0x7b, 0x8e, 0x55, 0xf5, 0xda, 0x8f, 0xd1, 0x70, 0x1d,
                           0x7,  0x33, 0xe8, 0x6,  0x34, 0x7,  0x2b, 0xa7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4710}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25682}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops1}, .v = {28, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops1[] = {0x22, 0x6f, 0xdc, 0xe6, 0x32, 0x9b, 0x92, 0x7b, 0x15, 0xd,
                               0xc0, 0x30, 0x80, 0x15, 0x88, 0xee, 0x2a, 0x5,  0xbd, 0x46};
  uint8_t byteswillprops2[] = {0x3,  0x6c, 0x45, 0xa1, 0xe9, 0x62, 0x3,  0x4,  0x8e, 0x8d, 0x5d, 0xed, 0x56, 0xc7,
                               0x65, 0xc6, 0xda, 0xa2, 0x71, 0x1d, 0x45, 0x98, 0xb3, 0x2b, 0x4b, 0xb2, 0xd,  0x36};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&byteswillprops2}}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd3, 0xc0, 0xb1, 0x86, 0x38, 0xf5, 0xc5, 0x94, 0x90, 0xee, 0x93, 0x54, 0x3f};
  lwmqtt_string_t will_topic = {13, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x57, 0x73, 0x17, 0xd2, 0x3b, 0x13, 0xe6, 0x7e, 0x9f, 0x74, 0xd4,
                                  0x6b, 0x28, 0xaf, 0xae, 0x22, 0xef, 0x18, 0xc1, 0xe5, 0xff};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24806;
  uint8_t client_id_bytes[] = {0xe2, 0x57, 0xe4, 0x88, 0x25, 0x68, 0xf8, 0x43, 0xbe, 0x83, 0xcc, 0x93, 0x66, 0x15,
                               0x6e, 0x94, 0x20, 0xb8, 0xd0, 0x23, 0xf0, 0x1c, 0x66, 0x1c, 0x33, 0x54, 0xe7};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2e, 0x32, 0xd6, 0xec, 0x25, 0xa7, 0x43, 0xbe, 0xf8, 0xc1, 0xd3, 0x40, 0x24, 0xf8};
  lwmqtt_string_t username = {14, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\RST\210\144\vR\152\r\144sH\140S\216X\252D\232\156", _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\DC3\214I\EM\233B\b", _willMsg =
// "iT\rof/\249~4Z(<[iN\168@!g", _willProps = [PropMaximumQoS 167,PropMaximumPacketSize 12242]}), _cleanSession = False,
// _keepAlive = 10052, _connID = "\ENQB\207E\189\199FE\196\245\ACK\135\200N\n\187\177\209\128\171", _properties =
// [PropServerReference "KI",PropAssignedClientIdentifier "\225\242\&7/?\240\213\232",PropReasonString
// "(\f\SYN\234\199\138\137\244J",PropAuthenticationMethod "\191\&0g\212\184\253\SOH\169\142i\245'\137",PropReasonString
// ">\163\212\151\ENQJ",PropTopicAlias 4538,PropUserProperty "K"
// "NF\225SC\170)\240\174\143\DC4\219\176L.\201\249\238?\227",PropResponseTopic
// "\NUL\169(3\131\&4.\135\&1L\189\191%Y\144\175\196\DLE\ETB\251\223'^[F\238-\172R",PropPayloadFormatIndicator
// 243,PropRetainAvailable 64,PropSharedSubscriptionAvailable 101,PropRequestResponseInformation 30]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0xd6, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x44, 0x27, 0x44, 0x7a, 0x1c, 0x0,  0x2,
                   0x4b, 0x49, 0x12, 0x0,  0x8,  0xe1, 0xf2, 0x37, 0x2f, 0x3f, 0xf0, 0xd5, 0xe8, 0x1f, 0x0,  0x9,  0x28,
                   0xc,  0x16, 0xea, 0xc7, 0x8a, 0x89, 0xf4, 0x4a, 0x15, 0x0,  0xd,  0xbf, 0x30, 0x67, 0xd4, 0xb8, 0xfd,
                   0x1,  0xa9, 0x8e, 0x69, 0xf5, 0x27, 0x89, 0x1f, 0x0,  0x6,  0x3e, 0xa3, 0xd4, 0x97, 0x5,  0x4a, 0x23,
                   0x11, 0xba, 0x26, 0x0,  0x1,  0x4b, 0x0,  0x14, 0x4e, 0x46, 0xe1, 0x53, 0x43, 0xaa, 0x29, 0xf0, 0xae,
                   0x8f, 0x14, 0xdb, 0xb0, 0x4c, 0x2e, 0xc9, 0xf9, 0xee, 0x3f, 0xe3, 0x8,  0x0,  0x1d, 0x0,  0xa9, 0x28,
                   0x33, 0x83, 0x34, 0x2e, 0x87, 0x31, 0x4c, 0xbd, 0xbf, 0x25, 0x59, 0x90, 0xaf, 0xc4, 0x10, 0x17, 0xfb,
                   0xdf, 0x27, 0x5e, 0x5b, 0x46, 0xee, 0x2d, 0xac, 0x52, 0x1,  0xf3, 0x25, 0x40, 0x2a, 0x65, 0x19, 0x1e,
                   0x0,  0x14, 0x5,  0x42, 0xcf, 0x45, 0xbd, 0xc7, 0x46, 0x45, 0xc4, 0xf5, 0x6,  0x87, 0xc8, 0x4e, 0xa,
                   0xbb, 0xb1, 0xd1, 0x80, 0xab, 0x7,  0x24, 0xa7, 0x27, 0x0,  0x0,  0x2f, 0xd2, 0x0,  0x7,  0x13, 0xd6,
                   0x49, 0x19, 0xe9, 0x42, 0x8,  0x0,  0x13, 0x69, 0x54, 0xd,  0x6f, 0x66, 0x2f, 0xf9, 0x7e, 0x34, 0x5a,
                   0x28, 0x3c, 0x5b, 0x69, 0x4e, 0xa8, 0x40, 0x21, 0x67, 0x0,  0x13, 0x1e, 0x54, 0xd2, 0x90, 0xb,  0x52,
                   0x98, 0xd,  0x90, 0x73, 0x48, 0x8c, 0x53, 0xd8, 0x58, 0xfc, 0x44, 0xe8, 0x9c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4b, 0x49};
  uint8_t bytesprops1[] = {0xe1, 0xf2, 0x37, 0x2f, 0x3f, 0xf0, 0xd5, 0xe8};
  uint8_t bytesprops2[] = {0x28, 0xc, 0x16, 0xea, 0xc7, 0x8a, 0x89, 0xf4, 0x4a};
  uint8_t bytesprops3[] = {0xbf, 0x30, 0x67, 0xd4, 0xb8, 0xfd, 0x1, 0xa9, 0x8e, 0x69, 0xf5, 0x27, 0x89};
  uint8_t bytesprops4[] = {0x3e, 0xa3, 0xd4, 0x97, 0x5, 0x4a};
  uint8_t bytesprops6[] = {0x4e, 0x46, 0xe1, 0x53, 0x43, 0xaa, 0x29, 0xf0, 0xae, 0x8f,
                           0x14, 0xdb, 0xb0, 0x4c, 0x2e, 0xc9, 0xf9, 0xee, 0x3f, 0xe3};
  uint8_t bytesprops5[] = {0x4b};
  uint8_t bytesprops7[] = {0x0,  0xa9, 0x28, 0x33, 0x83, 0x34, 0x2e, 0x87, 0x31, 0x4c, 0xbd, 0xbf, 0x25, 0x59, 0x90,
                           0xaf, 0xc4, 0x10, 0x17, 0xfb, 0xdf, 0x27, 0x5e, 0x5b, 0x46, 0xee, 0x2d, 0xac, 0x52};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4538}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops5}, .v = {20, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 30}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12242}},
  };

  lwmqtt_properties_t willprops = {2, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x13, 0xd6, 0x49, 0x19, 0xe9, 0x42, 0x8};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x69, 0x54, 0xd,  0x6f, 0x66, 0x2f, 0xf9, 0x7e, 0x34, 0x5a,
                                  0x28, 0x3c, 0x5b, 0x69, 0x4e, 0xa8, 0x40, 0x21, 0x67};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 10052;
  uint8_t client_id_bytes[] = {0x5, 0x42, 0xcf, 0x45, 0xbd, 0xc7, 0x46, 0x45, 0xc4, 0xf5,
                               0x6, 0x87, 0xc8, 0x4e, 0xa,  0xbb, 0xb1, 0xd1, 0x80, 0xab};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x1e, 0x54, 0xd2, 0x90, 0xb,  0x52, 0x98, 0xd,  0x90, 0x73,
                              0x48, 0x8c, 0x53, 0xd8, 0x58, 0xfc, 0x44, 0xe8, 0x9c};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "jp\210\SYN<%F\215\168\207J\225\152z\151X\253\132\"", _password = Nothing, _lastWill
// = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\181J\251\141\ETX", _willMsg = "|\ETB",
// _willProps = [PropMaximumPacketSize 28427,PropUserProperty "#H'\FS\151\161\162\DC2!\DEL$"
// "\249\225yW\183<\204(\CAN\ESC\253\DC2",PropWildcardSubscriptionAvailable 72,PropSessionExpiryInterval
// 30643,PropMaximumPacketSize 19796,PropMaximumPacketSize 29954,PropReceiveMaximum 12271,PropMaximumQoS
// 96,PropReceiveMaximum 15941,PropRequestResponseInformation 113,PropMaximumQoS 138,PropServerReference
// "\213\133\146\239\133\193N\177\249\133\200\243\158\&7\205\187\215\129\"",PropWildcardSubscriptionAvailable
// 169,PropRequestResponseInformation 145,PropContentType
// "\233\134\&6\163\140#/?\161G\b\SOwA\245\186\169\DLE\194\142c\135\161\193\233s\207{R\255",PropSharedSubscriptionAvailable
// 26,PropAssignedClientIdentifier
// "\ACK\ETB!\218a\ENQH\157\192\244\210\178\203\146\212\225\138\&9d\152\253\220\SO\156}\209\159",PropSharedSubscriptionAvailable
// 67,PropPayloadFormatIndicator 111,PropAuthenticationData "\207\234E!\209[\157
// \"\130K\182\219\215\224\twg\242\229u\149\r\CAN\215J\137\170\188",PropMessageExpiryInterval 27923]}), _cleanSession =
// True, _keepAlive = 2920, _connID = "\203M+\171|\132nj\193\FS\a\\\DC1\230\202\DC2Id;\200", _properties =
// [PropResponseTopic "\152\r_\209\243\142\DC1\147\195\155i~\221]\130\160\156\ETXq\226",PropServerReference
// "@\164\241\EM\US1\250\SI",PropSubscriptionIdentifierAvailable 109,PropAuthenticationMethod
// "\173\138",PropWillDelayInterval 11874,PropSubscriptionIdentifierAvailable 154,PropSubscriptionIdentifierAvailable
// 219,PropServerKeepAlive 11283,PropMaximumQoS 158,PropReasonString
// "&\232\254\190z\234t\EOT\251G\219\232\160Ed",PropServerReference
// "\n\226\nR!\198\234\227\166\130",PropMessageExpiryInterval 2976,PropMessageExpiryInterval 30462,PropServerReference
// "\232\215\237\161\140\"\208a:\DC4g\174\253\217\172e\179\176\v",PropWildcardSubscriptionAvailable 187,PropMaximumQoS
// 52,PropReceiveMaximum 10715,PropAuthenticationMethod "?\194\132\SI\225\203\189\164\220x\229\183@\DC3\ETX
// \a\DELn\159\190\232S\v",PropTopicAlias 23900,PropMaximumPacketSize 1537,PropAuthenticationData
// "\NUL",PropMessageExpiryInterval 8705,PropMaximumPacketSize 19667,PropMessageExpiryInterval
// 2344,PropRequestResponseInformation 137,PropContentType
// "\195\201\&8\174\144\203\146\136^\DLE:n\USN\199\160\&4\ESC:,v4e\161\ETB",PropTopicAliasMaximum 18306]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0xda, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8e, 0xb,  0x68, 0xd4, 0x1,  0x8,  0x0,  0x14, 0x98,
      0xd,  0x5f, 0xd1, 0xf3, 0x8e, 0x11, 0x93, 0xc3, 0x9b, 0x69, 0x7e, 0xdd, 0x5d, 0x82, 0xa0, 0x9c, 0x3,  0x71, 0xe2,
      0x1c, 0x0,  0x8,  0x40, 0xa4, 0xf1, 0x19, 0x1f, 0x31, 0xfa, 0xf,  0x29, 0x6d, 0x15, 0x0,  0x2,  0xad, 0x8a, 0x18,
      0x0,  0x0,  0x2e, 0x62, 0x29, 0x9a, 0x29, 0xdb, 0x13, 0x2c, 0x13, 0x24, 0x9e, 0x1f, 0x0,  0xf,  0x26, 0xe8, 0xfe,
      0xbe, 0x7a, 0xea, 0x74, 0x4,  0xfb, 0x47, 0xdb, 0xe8, 0xa0, 0x45, 0x64, 0x1c, 0x0,  0xa,  0xa,  0xe2, 0xa,  0x52,
      0x21, 0xc6, 0xea, 0xe3, 0xa6, 0x82, 0x2,  0x0,  0x0,  0xb,  0xa0, 0x2,  0x0,  0x0,  0x76, 0xfe, 0x1c, 0x0,  0x13,
      0xe8, 0xd7, 0xed, 0xa1, 0x8c, 0x22, 0xd0, 0x61, 0x3a, 0x14, 0x67, 0xae, 0xfd, 0xd9, 0xac, 0x65, 0xb3, 0xb0, 0xb,
      0x28, 0xbb, 0x24, 0x34, 0x21, 0x29, 0xdb, 0x15, 0x0,  0x18, 0x3f, 0xc2, 0x84, 0xf,  0xe1, 0xcb, 0xbd, 0xa4, 0xdc,
      0x78, 0xe5, 0xb7, 0x40, 0x13, 0x3,  0x20, 0x7,  0x7f, 0x6e, 0x9f, 0xbe, 0xe8, 0x53, 0xb,  0x23, 0x5d, 0x5c, 0x27,
      0x0,  0x0,  0x6,  0x1,  0x16, 0x0,  0x1,  0x0,  0x2,  0x0,  0x0,  0x22, 0x1,  0x27, 0x0,  0x0,  0x4c, 0xd3, 0x2,
      0x0,  0x0,  0x9,  0x28, 0x19, 0x89, 0x3,  0x0,  0x19, 0xc3, 0xc9, 0x38, 0xae, 0x90, 0xcb, 0x92, 0x88, 0x5e, 0x10,
      0x3a, 0x6e, 0x1f, 0x4e, 0xc7, 0xa0, 0x34, 0x1b, 0x3a, 0x2c, 0x76, 0x34, 0x65, 0xa1, 0x17, 0x22, 0x47, 0x82, 0x0,
      0x14, 0xcb, 0x4d, 0x2b, 0xab, 0x7c, 0x84, 0x6e, 0x6a, 0xc1, 0x1c, 0x7,  0x5c, 0x11, 0xe6, 0xca, 0x12, 0x49, 0x64,
      0x3b, 0xc8, 0xc2, 0x1,  0x27, 0x0,  0x0,  0x6f, 0xb,  0x26, 0x0,  0xb,  0x23, 0x48, 0x27, 0x1c, 0x97, 0xa1, 0xa2,
      0x12, 0x21, 0x7f, 0x24, 0x0,  0xc,  0xf9, 0xe1, 0x79, 0x57, 0xb7, 0x3c, 0xcc, 0x28, 0x18, 0x1b, 0xfd, 0x12, 0x28,
      0x48, 0x11, 0x0,  0x0,  0x77, 0xb3, 0x27, 0x0,  0x0,  0x4d, 0x54, 0x27, 0x0,  0x0,  0x75, 0x2,  0x21, 0x2f, 0xef,
      0x24, 0x60, 0x21, 0x3e, 0x45, 0x19, 0x71, 0x24, 0x8a, 0x1c, 0x0,  0x13, 0xd5, 0x85, 0x92, 0xef, 0x85, 0xc1, 0x4e,
      0xb1, 0xf9, 0x85, 0xc8, 0xf3, 0x9e, 0x37, 0xcd, 0xbb, 0xd7, 0x81, 0x22, 0x28, 0xa9, 0x19, 0x91, 0x3,  0x0,  0x1e,
      0xe9, 0x86, 0x36, 0xa3, 0x8c, 0x23, 0x2f, 0x3f, 0xa1, 0x47, 0x8,  0xe,  0x77, 0x41, 0xf5, 0xba, 0xa9, 0x10, 0xc2,
      0x8e, 0x63, 0x87, 0xa1, 0xc1, 0xe9, 0x73, 0xcf, 0x7b, 0x52, 0xff, 0x2a, 0x1a, 0x12, 0x0,  0x1b, 0x6,  0x17, 0x21,
      0xda, 0x61, 0x5,  0x48, 0x9d, 0xc0, 0xf4, 0xd2, 0xb2, 0xcb, 0x92, 0xd4, 0xe1, 0x8a, 0x39, 0x64, 0x98, 0xfd, 0xdc,
      0xe,  0x9c, 0x7d, 0xd1, 0x9f, 0x2a, 0x43, 0x1,  0x6f, 0x16, 0x0,  0x1d, 0xcf, 0xea, 0x45, 0x21, 0xd1, 0x5b, 0x9d,
      0x20, 0x22, 0x82, 0x4b, 0xb6, 0xdb, 0xd7, 0xe0, 0x9,  0x77, 0x67, 0xf2, 0xe5, 0x75, 0x95, 0xd,  0x18, 0xd7, 0x4a,
      0x89, 0xaa, 0xbc, 0x2,  0x0,  0x0,  0x6d, 0x13, 0x0,  0x5,  0xb5, 0x4a, 0xfb, 0x8d, 0x3,  0x0,  0x2,  0x7c, 0x17,
      0x0,  0x13, 0x6a, 0x70, 0xd2, 0x16, 0x3c, 0x25, 0x46, 0xd7, 0xa8, 0xcf, 0x4a, 0xe1, 0x98, 0x7a, 0x97, 0x58, 0xfd,
      0x84, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x98, 0xd,  0x5f, 0xd1, 0xf3, 0x8e, 0x11, 0x93, 0xc3, 0x9b,
                           0x69, 0x7e, 0xdd, 0x5d, 0x82, 0xa0, 0x9c, 0x3,  0x71, 0xe2};
  uint8_t bytesprops1[] = {0x40, 0xa4, 0xf1, 0x19, 0x1f, 0x31, 0xfa, 0xf};
  uint8_t bytesprops2[] = {0xad, 0x8a};
  uint8_t bytesprops3[] = {0x26, 0xe8, 0xfe, 0xbe, 0x7a, 0xea, 0x74, 0x4, 0xfb, 0x47, 0xdb, 0xe8, 0xa0, 0x45, 0x64};
  uint8_t bytesprops4[] = {0xa, 0xe2, 0xa, 0x52, 0x21, 0xc6, 0xea, 0xe3, 0xa6, 0x82};
  uint8_t bytesprops5[] = {0xe8, 0xd7, 0xed, 0xa1, 0x8c, 0x22, 0xd0, 0x61, 0x3a, 0x14,
                           0x67, 0xae, 0xfd, 0xd9, 0xac, 0x65, 0xb3, 0xb0, 0xb};
  uint8_t bytesprops6[] = {0x3f, 0xc2, 0x84, 0xf,  0xe1, 0xcb, 0xbd, 0xa4, 0xdc, 0x78, 0xe5, 0xb7,
                           0x40, 0x13, 0x3,  0x20, 0x7,  0x7f, 0x6e, 0x9f, 0xbe, 0xe8, 0x53, 0xb};
  uint8_t bytesprops7[] = {0x0};
  uint8_t bytesprops8[] = {0xc3, 0xc9, 0x38, 0xae, 0x90, 0xcb, 0x92, 0x88, 0x5e, 0x10, 0x3a, 0x6e, 0x1f,
                           0x4e, 0xc7, 0xa0, 0x34, 0x1b, 0x3a, 0x2c, 0x76, 0x34, 0x65, 0xa1, 0x17};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11874}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11283}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2976}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30462}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10715}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23900}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1537}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8705}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19667}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2344}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18306}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xf9, 0xe1, 0x79, 0x57, 0xb7, 0x3c, 0xcc, 0x28, 0x18, 0x1b, 0xfd, 0x12};
  uint8_t byteswillprops0[] = {0x23, 0x48, 0x27, 0x1c, 0x97, 0xa1, 0xa2, 0x12, 0x21, 0x7f, 0x24};
  uint8_t byteswillprops2[] = {0xd5, 0x85, 0x92, 0xef, 0x85, 0xc1, 0x4e, 0xb1, 0xf9, 0x85,
                               0xc8, 0xf3, 0x9e, 0x37, 0xcd, 0xbb, 0xd7, 0x81, 0x22};
  uint8_t byteswillprops3[] = {0xe9, 0x86, 0x36, 0xa3, 0x8c, 0x23, 0x2f, 0x3f, 0xa1, 0x47,
                               0x8,  0xe,  0x77, 0x41, 0xf5, 0xba, 0xa9, 0x10, 0xc2, 0x8e,
                               0x63, 0x87, 0xa1, 0xc1, 0xe9, 0x73, 0xcf, 0x7b, 0x52, 0xff};
  uint8_t byteswillprops4[] = {0x6,  0x17, 0x21, 0xda, 0x61, 0x5,  0x48, 0x9d, 0xc0, 0xf4, 0xd2, 0xb2, 0xcb, 0x92,
                               0xd4, 0xe1, 0x8a, 0x39, 0x64, 0x98, 0xfd, 0xdc, 0xe,  0x9c, 0x7d, 0xd1, 0x9f};
  uint8_t byteswillprops5[] = {0xcf, 0xea, 0x45, 0x21, 0xd1, 0x5b, 0x9d, 0x20, 0x22, 0x82, 0x4b, 0xb6, 0xdb, 0xd7, 0xe0,
                               0x9,  0x77, 0x67, 0xf2, 0xe5, 0x75, 0x95, 0xd,  0x18, 0xd7, 0x4a, 0x89, 0xaa, 0xbc};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28427}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {11, (char*)&byteswillprops0}, .v = {12, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30643}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19796}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29954}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12271}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15941}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27923}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb5, 0x4a, 0xfb, 0x8d, 0x3};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x7c, 0x17};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2920;
  uint8_t client_id_bytes[] = {0xcb, 0x4d, 0x2b, 0xab, 0x7c, 0x84, 0x6e, 0x6a, 0xc1, 0x1c,
                               0x7,  0x5c, 0x11, 0xe6, 0xca, 0x12, 0x49, 0x64, 0x3b, 0xc8};
  lwmqtt_string_t client_id = {20, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x6a, 0x70, 0xd2, 0x16, 0x3c, 0x25, 0x46, 0xd7, 0xa8, 0xcf,
                              0x4a, 0xe1, 0x98, 0x7a, 0x97, 0x58, 0xfd, 0x84, 0x22};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\192\STX\129_\195-\215\163\200JG\249<", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic =
// "\152e\130\v\SOH\ACK\224\EOT\165\199(&g\SO\ACK\211\169\&1\DC3\243\199\ETB\221\138+", _willMsg =
// "H\197\&7\SOH\253\237", _willProps = [PropTopicAlias 18478,PropMessageExpiryInterval 9048,PropUserProperty
// "\CAN\246G" "d\187\128B\136\196",PropWillDelayInterval 13590,PropSubscriptionIdentifierAvailable 146]}),
// _cleanSession = True, _keepAlive = 2714, _connID = "\243Q\STX\222\243oB\DC4\136\201n\GS\146", _properties =
// [PropMessageExpiryInterval 5905,PropWildcardSubscriptionAvailable 81,PropMaximumQoS 39,PropUserProperty
// "_\183o\SOS\ETX\255(\DC4\r3N\159\&5\171\219\210\151\173\215\r0\229\151\132}\187\149;"
// "l\247ax\228\155\195$\EOT\DC3",PropAuthenticationMethod
// "\236\DC1\176;\NAK\NAK\160",PropSubscriptionIdentifierAvailable 215,PropServerKeepAlive 4430,PropResponseInformation
// "\232\182Nh\211\&3\CAN\212\148\220\157\&4\212wR\251Rw>\vJ\v\221",PropMessageExpiryInterval 9422,PropTopicAliasMaximum
// 10403,PropRetainAvailable 248,PropRetainAvailable 204,PropReasonString
// "\242gK\218`&\129\170p`\248c\NAKXC\177\"\b\228g\238\205,\168",PropTopicAliasMaximum 22359,PropReasonString
// "\200\226\191\167K\ACK\206\154\214D(\US\250\231\&7\218\158Q\242\"U\239\STX",PropTopicAlias
// 30940,PropAssignedClientIdentifier "\204r1\fp\SO\NUL`.\166\221e\234Z",PropWildcardSubscriptionAvailable
// 231,PropPayloadFormatIndicator 67,PropSubscriptionIdentifier 26,PropServerReference "N\234\b\175
// \150&\194Z\va!!\149*\"\143{U\231",PropServerKeepAlive 12428,PropAssignedClientIdentifier
// "\FS\142\245\147\169DU\ETB\242[\245\198\186\132\158\135\164q\173[\210\129\189\165A\\2",PropServerReference
// ">\RS\249\190\132\158\248\192\180\206\131u\168=\SYN\FS!\DELZ\221|\136K\179\162\196\SOH\226e[",PropResponseInformation
// "(\187\187\198\&3\ESC\189r~\DLE\143\204h<",PropAssignedClientIdentifier
// "\248\189\155S6}\128w\160\181\ETB2g]\154\133m/\163\160\ESCW\DC2\181",PropMessageExpiryInterval
// 7073,PropServerReference "\216=\207\233\242R]",PropReceiveMaximum 8978]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x10, 0xbe, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x76, 0xa,  0x9a, 0xd3, 0x2,  0x2,  0x0,  0x0,  0x17,
      0x11, 0x28, 0x51, 0x24, 0x27, 0x26, 0x0,  0x1d, 0x5f, 0xb7, 0x6f, 0xe,  0x53, 0x3,  0xff, 0x28, 0x14, 0xd,  0x33,
      0x4e, 0x9f, 0x35, 0xab, 0xdb, 0xd2, 0x97, 0xad, 0xd7, 0xd,  0x30, 0xe5, 0x97, 0x84, 0x7d, 0xbb, 0x95, 0x3b, 0x0,
      0xa,  0x6c, 0xf7, 0x61, 0x78, 0xe4, 0x9b, 0xc3, 0x24, 0x4,  0x13, 0x15, 0x0,  0x7,  0xec, 0x11, 0xb0, 0x3b, 0x15,
      0x15, 0xa0, 0x29, 0xd7, 0x13, 0x11, 0x4e, 0x1a, 0x0,  0x17, 0xe8, 0xb6, 0x4e, 0x68, 0xd3, 0x33, 0x18, 0xd4, 0x94,
      0xdc, 0x9d, 0x34, 0xd4, 0x77, 0x52, 0xfb, 0x52, 0x77, 0x3e, 0xb,  0x4a, 0xb,  0xdd, 0x2,  0x0,  0x0,  0x24, 0xce,
      0x22, 0x28, 0xa3, 0x25, 0xf8, 0x25, 0xcc, 0x1f, 0x0,  0x18, 0xf2, 0x67, 0x4b, 0xda, 0x60, 0x26, 0x81, 0xaa, 0x70,
      0x60, 0xf8, 0x63, 0x15, 0x58, 0x43, 0xb1, 0x22, 0x8,  0xe4, 0x67, 0xee, 0xcd, 0x2c, 0xa8, 0x22, 0x57, 0x57, 0x1f,
      0x0,  0x17, 0xc8, 0xe2, 0xbf, 0xa7, 0x4b, 0x6,  0xce, 0x9a, 0xd6, 0x44, 0x28, 0x1f, 0xfa, 0xe7, 0x37, 0xda, 0x9e,
      0x51, 0xf2, 0x22, 0x55, 0xef, 0x2,  0x23, 0x78, 0xdc, 0x12, 0x0,  0xe,  0xcc, 0x72, 0x31, 0xc,  0x70, 0xe,  0x0,
      0x60, 0x2e, 0xa6, 0xdd, 0x65, 0xea, 0x5a, 0x28, 0xe7, 0x1,  0x43, 0xb,  0x1a, 0x1c, 0x0,  0x14, 0x4e, 0xea, 0x8,
      0xaf, 0x20, 0x96, 0x26, 0xc2, 0x5a, 0xb,  0x61, 0x21, 0x21, 0x95, 0x2a, 0x22, 0x8f, 0x7b, 0x55, 0xe7, 0x13, 0x30,
      0x8c, 0x12, 0x0,  0x1b, 0x1c, 0x8e, 0xf5, 0x93, 0xa9, 0x44, 0x55, 0x17, 0xf2, 0x5b, 0xf5, 0xc6, 0xba, 0x84, 0x9e,
      0x87, 0xa4, 0x71, 0xad, 0x5b, 0xd2, 0x81, 0xbd, 0xa5, 0x41, 0x5c, 0x32, 0x1c, 0x0,  0x1e, 0x3e, 0x1e, 0xf9, 0xbe,
      0x84, 0x9e, 0xf8, 0xc0, 0xb4, 0xce, 0x83, 0x75, 0xa8, 0x3d, 0x16, 0x1c, 0x21, 0x7f, 0x5a, 0xdd, 0x7c, 0x88, 0x4b,
      0xb3, 0xa2, 0xc4, 0x1,  0xe2, 0x65, 0x5b, 0x1a, 0x0,  0xe,  0x28, 0xbb, 0xbb, 0xc6, 0x33, 0x1b, 0xbd, 0x72, 0x7e,
      0x10, 0x8f, 0xcc, 0x68, 0x3c, 0x12, 0x0,  0x18, 0xf8, 0xbd, 0x9b, 0x53, 0x36, 0x7d, 0x80, 0x77, 0xa0, 0xb5, 0x17,
      0x32, 0x67, 0x5d, 0x9a, 0x85, 0x6d, 0x2f, 0xa3, 0xa0, 0x1b, 0x57, 0x12, 0xb5, 0x2,  0x0,  0x0,  0x1b, 0xa1, 0x1c,
      0x0,  0x7,  0xd8, 0x3d, 0xcf, 0xe9, 0xf2, 0x52, 0x5d, 0x21, 0x23, 0x12, 0x0,  0xd,  0xf3, 0x51, 0x2,  0xde, 0xf3,
      0x6f, 0x42, 0x14, 0x88, 0xc9, 0x6e, 0x1d, 0x92, 0x1d, 0x23, 0x48, 0x2e, 0x2,  0x0,  0x0,  0x23, 0x58, 0x26, 0x0,
      0x3,  0x18, 0xf6, 0x47, 0x0,  0x6,  0x64, 0xbb, 0x80, 0x42, 0x88, 0xc4, 0x18, 0x0,  0x0,  0x35, 0x16, 0x29, 0x92,
      0x0,  0x19, 0x98, 0x65, 0x82, 0xb,  0x1,  0x6,  0xe0, 0x4,  0xa5, 0xc7, 0x28, 0x26, 0x67, 0xe,  0x6,  0xd3, 0xa9,
      0x31, 0x13, 0xf3, 0xc7, 0x17, 0xdd, 0x8a, 0x2b, 0x0,  0x6,  0x48, 0xc5, 0x37, 0x1,  0xfd, 0xed, 0x0,  0xd,  0xc0,
      0x2,  0x81, 0x5f, 0xc3, 0x2d, 0xd7, 0xa3, 0xc8, 0x4a, 0x47, 0xf9, 0x3c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x6c, 0xf7, 0x61, 0x78, 0xe4, 0x9b, 0xc3, 0x24, 0x4, 0x13};
  uint8_t bytesprops0[] = {0x5f, 0xb7, 0x6f, 0xe,  0x53, 0x3, 0xff, 0x28, 0x14, 0xd,  0x33, 0x4e, 0x9f, 0x35, 0xab,
                           0xdb, 0xd2, 0x97, 0xad, 0xd7, 0xd, 0x30, 0xe5, 0x97, 0x84, 0x7d, 0xbb, 0x95, 0x3b};
  uint8_t bytesprops2[] = {0xec, 0x11, 0xb0, 0x3b, 0x15, 0x15, 0xa0};
  uint8_t bytesprops3[] = {0xe8, 0xb6, 0x4e, 0x68, 0xd3, 0x33, 0x18, 0xd4, 0x94, 0xdc, 0x9d, 0x34,
                           0xd4, 0x77, 0x52, 0xfb, 0x52, 0x77, 0x3e, 0xb,  0x4a, 0xb,  0xdd};
  uint8_t bytesprops4[] = {0xf2, 0x67, 0x4b, 0xda, 0x60, 0x26, 0x81, 0xaa, 0x70, 0x60, 0xf8, 0x63,
                           0x15, 0x58, 0x43, 0xb1, 0x22, 0x8,  0xe4, 0x67, 0xee, 0xcd, 0x2c, 0xa8};
  uint8_t bytesprops5[] = {0xc8, 0xe2, 0xbf, 0xa7, 0x4b, 0x6,  0xce, 0x9a, 0xd6, 0x44, 0x28, 0x1f,
                           0xfa, 0xe7, 0x37, 0xda, 0x9e, 0x51, 0xf2, 0x22, 0x55, 0xef, 0x2};
  uint8_t bytesprops6[] = {0xcc, 0x72, 0x31, 0xc, 0x70, 0xe, 0x0, 0x60, 0x2e, 0xa6, 0xdd, 0x65, 0xea, 0x5a};
  uint8_t bytesprops7[] = {0x4e, 0xea, 0x8,  0xaf, 0x20, 0x96, 0x26, 0xc2, 0x5a, 0xb,
                           0x61, 0x21, 0x21, 0x95, 0x2a, 0x22, 0x8f, 0x7b, 0x55, 0xe7};
  uint8_t bytesprops8[] = {0x1c, 0x8e, 0xf5, 0x93, 0xa9, 0x44, 0x55, 0x17, 0xf2, 0x5b, 0xf5, 0xc6, 0xba, 0x84,
                           0x9e, 0x87, 0xa4, 0x71, 0xad, 0x5b, 0xd2, 0x81, 0xbd, 0xa5, 0x41, 0x5c, 0x32};
  uint8_t bytesprops9[] = {0x3e, 0x1e, 0xf9, 0xbe, 0x84, 0x9e, 0xf8, 0xc0, 0xb4, 0xce, 0x83, 0x75, 0xa8, 0x3d, 0x16,
                           0x1c, 0x21, 0x7f, 0x5a, 0xdd, 0x7c, 0x88, 0x4b, 0xb3, 0xa2, 0xc4, 0x1,  0xe2, 0x65, 0x5b};
  uint8_t bytesprops10[] = {0x28, 0xbb, 0xbb, 0xc6, 0x33, 0x1b, 0xbd, 0x72, 0x7e, 0x10, 0x8f, 0xcc, 0x68, 0x3c};
  uint8_t bytesprops11[] = {0xf8, 0xbd, 0x9b, 0x53, 0x36, 0x7d, 0x80, 0x77, 0xa0, 0xb5, 0x17, 0x32,
                            0x67, 0x5d, 0x9a, 0x85, 0x6d, 0x2f, 0xa3, 0xa0, 0x1b, 0x57, 0x12, 0xb5};
  uint8_t bytesprops12[] = {0xd8, 0x3d, 0xcf, 0xe9, 0xf2, 0x52, 0x5d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5905}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops0}, .v = {10, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4430}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9422}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10403}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22359}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30940}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12428}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7073}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8978}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x64, 0xbb, 0x80, 0x42, 0x88, 0xc4};
  uint8_t byteswillprops0[] = {0x18, 0xf6, 0x47};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18478}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9048}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {3, (char*)&byteswillprops0}, .v = {6, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13590}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 146}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x98, 0x65, 0x82, 0xb,  0x1,  0x6,  0xe0, 0x4,  0xa5, 0xc7, 0x28, 0x26, 0x67,
                                0xe,  0x6,  0xd3, 0xa9, 0x31, 0x13, 0xf3, 0xc7, 0x17, 0xdd, 0x8a, 0x2b};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x48, 0xc5, 0x37, 0x1, 0xfd, 0xed};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2714;
  uint8_t client_id_bytes[] = {0xf3, 0x51, 0x2, 0xde, 0xf3, 0x6f, 0x42, 0x14, 0x88, 0xc9, 0x6e, 0x1d, 0x92};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xc0, 0x2, 0x81, 0x5f, 0xc3, 0x2d, 0xd7, 0xa3, 0xc8, 0x4a, 0x47, 0xf9, 0x3c};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 26866, _connID = "^\239\188\197\142\229[\ESC\211E\188\233\195", _properties = [PropPayloadFormatIndicator
// 176,PropAuthenticationData
// "\158\211w\167\182<\128#\237:{\130\139\247\220\179z\137\NAK&\190\236\ENQ>\210l8\141\241",PropAssignedClientIdentifier
// "IY=\r\180\164\181%{",PropWildcardSubscriptionAvailable 192,PropCorrelationData
// "G\210\STX\231\151h\ENQH\166\RS\254\207y",PropMaximumQoS 165,PropSessionExpiryInterval 9460,PropResponseInformation
// "\238\168f\154\218RA\188\179oo\140\155\DC2d?$p1U\149\230\169\240\DLE\161\188\SOH\176\165",PropReasonString
// "\t!",PropMaximumPacketSize 28298,PropContentType "
// \209\174\146\178\214\141\160n&\DLE\b\154U\234\&9\rn\SI=\158\151\252",PropRequestProblemInformation
// 244,PropRequestProblemInformation 196,PropMessageExpiryInterval 31638,PropPayloadFormatIndicator
// 143,PropSubscriptionIdentifier 26,PropCorrelationData "[\200\152r\ETX"]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0xbc, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2,  0x68, 0xf2, 0xa1, 0x1,  0x1,
                   0xb0, 0x16, 0x0,  0x1d, 0x9e, 0xd3, 0x77, 0xa7, 0xb6, 0x3c, 0x80, 0x23, 0xed, 0x3a, 0x7b, 0x82,
                   0x8b, 0xf7, 0xdc, 0xb3, 0x7a, 0x89, 0x15, 0x26, 0xbe, 0xec, 0x5,  0x3e, 0xd2, 0x6c, 0x38, 0x8d,
                   0xf1, 0x12, 0x0,  0x9,  0x49, 0x59, 0x3d, 0xd,  0xb4, 0xa4, 0xb5, 0x25, 0x7b, 0x28, 0xc0, 0x9,
                   0x0,  0xd,  0x47, 0xd2, 0x2,  0xe7, 0x97, 0x68, 0x5,  0x48, 0xa6, 0x1e, 0xfe, 0xcf, 0x79, 0x24,
                   0xa5, 0x11, 0x0,  0x0,  0x24, 0xf4, 0x1a, 0x0,  0x1e, 0xee, 0xa8, 0x66, 0x9a, 0xda, 0x52, 0x41,
                   0xbc, 0xb3, 0x6f, 0x6f, 0x8c, 0x9b, 0x12, 0x64, 0x3f, 0x24, 0x70, 0x31, 0x55, 0x95, 0xe6, 0xa9,
                   0xf0, 0x10, 0xa1, 0xbc, 0x1,  0xb0, 0xa5, 0x1f, 0x0,  0x2,  0x9,  0x21, 0x27, 0x0,  0x0,  0x6e,
                   0x8a, 0x3,  0x0,  0x17, 0x20, 0xd1, 0xae, 0x92, 0xb2, 0xd6, 0x8d, 0xa0, 0x6e, 0x26, 0x10, 0x8,
                   0x9a, 0x55, 0xea, 0x39, 0xd,  0x6e, 0xf,  0x3d, 0x9e, 0x97, 0xfc, 0x17, 0xf4, 0x17, 0xc4, 0x2,
                   0x0,  0x0,  0x7b, 0x96, 0x1,  0x8f, 0xb,  0x1a, 0x9,  0x0,  0x5,  0x5b, 0xc8, 0x98, 0x72, 0x3,
                   0x0,  0xd,  0x5e, 0xef, 0xbc, 0xc5, 0x8e, 0xe5, 0x5b, 0x1b, 0xd3, 0x45, 0xbc, 0xe9, 0xc3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9e, 0xd3, 0x77, 0xa7, 0xb6, 0x3c, 0x80, 0x23, 0xed, 0x3a, 0x7b, 0x82, 0x8b, 0xf7, 0xdc,
                           0xb3, 0x7a, 0x89, 0x15, 0x26, 0xbe, 0xec, 0x5,  0x3e, 0xd2, 0x6c, 0x38, 0x8d, 0xf1};
  uint8_t bytesprops1[] = {0x49, 0x59, 0x3d, 0xd, 0xb4, 0xa4, 0xb5, 0x25, 0x7b};
  uint8_t bytesprops2[] = {0x47, 0xd2, 0x2, 0xe7, 0x97, 0x68, 0x5, 0x48, 0xa6, 0x1e, 0xfe, 0xcf, 0x79};
  uint8_t bytesprops3[] = {0xee, 0xa8, 0x66, 0x9a, 0xda, 0x52, 0x41, 0xbc, 0xb3, 0x6f, 0x6f, 0x8c, 0x9b, 0x12, 0x64,
                           0x3f, 0x24, 0x70, 0x31, 0x55, 0x95, 0xe6, 0xa9, 0xf0, 0x10, 0xa1, 0xbc, 0x1,  0xb0, 0xa5};
  uint8_t bytesprops4[] = {0x9, 0x21};
  uint8_t bytesprops5[] = {0x20, 0xd1, 0xae, 0x92, 0xb2, 0xd6, 0x8d, 0xa0, 0x6e, 0x26, 0x10, 0x8,
                           0x9a, 0x55, 0xea, 0x39, 0xd,  0x6e, 0xf,  0x3d, 0x9e, 0x97, 0xfc};
  uint8_t bytesprops6[] = {0x5b, 0xc8, 0x98, 0x72, 0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9460}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28298}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31638}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26866;
  uint8_t client_id_bytes[] = {0x5e, 0xef, 0xbc, 0xc5, 0x8e, 0xe5, 0x5b, 0x1b, 0xd3, 0x45, 0xbc, 0xe9, 0xc3};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\159\254c\245[\164\r\135bMz\150\205`e\233\140\135YrN\180\GS\186\140\209As",
// _password = Just "<\FS\172b\196\SI\220\203\NUL`<v\134\195e", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 27380, _connID = "\164\253\255\190/Pv\232\ESC\DEL\DLE", _properties = [PropMaximumPacketSize
// 913,PropAssignedClientIdentifier "",PropRetainAvailable 189,PropMessageExpiryInterval 534,PropServerKeepAlive
// 5455,PropMessageExpiryInterval 20257,PropUserProperty
// "\197?\SIN\223!\213}xc\176\aU\177\197\237B\169\233\161\182\ESCrI9"
// "\n\DC2\217\210\219\147\148\172%0\137\222\171\204",PropSharedSubscriptionAvailable 130,PropSessionExpiryInterval
// 10730,PropCorrelationData
// "+B\216\245\143\247\234@\226$\200wfBp\187\202\253Gz\252\198R^&%H",PropPayloadFormatIndicator 164,PropMaximumQoS
// 147,PropTopicAliasMaximum 26571,PropResponseTopic "\220\211%\166",PropRequestProblemInformation
// 1,PropWillDelayInterval 19598,PropServerReference
// "U{HY*\139\183G\231\178D\252E\NUL\128\a\209J\179\US\178\219\247\205\192\215",PropSubscriptionIdentifier
// 27,PropUserProperty "}\139"
// "\148\132.\213{!\222\146$\NAK&\248@(\138\n+\210T\162V?\245\139\232",PropWildcardSubscriptionAvailable
// 139,PropAssignedClientIdentifier "\CAN\206\195\133\186\244\164",PropAssignedClientIdentifier
// "\174`>\187\209)9\165<\EOT\174\n\248\135\224m\140~\ar",PropTopicAliasMaximum 25773,PropCorrelationData
// "D\153\200f-\134",PropUserProperty "_\STX\142\230\DC2\227F\255U\NAK\ENQ@[\243\140\243G\195"
// "]\EM\213\167\243\144\187X\188\232\226\183\DLEz|=\196n\236!\235\SOH\223J\182^C)"]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x10, 0xe6, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x6a, 0xf4, 0x9e, 0x2,  0x27, 0x0,  0x0,  0x3,
      0x91, 0x12, 0x0,  0x0,  0x25, 0xbd, 0x2,  0x0,  0x0,  0x2,  0x16, 0x13, 0x15, 0x4f, 0x2,  0x0,  0x0,  0x4f, 0x21,
      0x26, 0x0,  0x19, 0xc5, 0x3f, 0xf,  0x4e, 0xdf, 0x21, 0xd5, 0x7d, 0x78, 0x63, 0xb0, 0x7,  0x55, 0xb1, 0xc5, 0xed,
      0x42, 0xa9, 0xe9, 0xa1, 0xb6, 0x1b, 0x72, 0x49, 0x39, 0x0,  0xe,  0xa,  0x12, 0xd9, 0xd2, 0xdb, 0x93, 0x94, 0xac,
      0x25, 0x30, 0x89, 0xde, 0xab, 0xcc, 0x2a, 0x82, 0x11, 0x0,  0x0,  0x29, 0xea, 0x9,  0x0,  0x1b, 0x2b, 0x42, 0xd8,
      0xf5, 0x8f, 0xf7, 0xea, 0x40, 0xe2, 0x24, 0xc8, 0x77, 0x66, 0x42, 0x70, 0xbb, 0xca, 0xfd, 0x47, 0x7a, 0xfc, 0xc6,
      0x52, 0x5e, 0x26, 0x25, 0x48, 0x1,  0xa4, 0x24, 0x93, 0x22, 0x67, 0xcb, 0x8,  0x0,  0x4,  0xdc, 0xd3, 0x25, 0xa6,
      0x17, 0x1,  0x18, 0x0,  0x0,  0x4c, 0x8e, 0x1c, 0x0,  0x1a, 0x55, 0x7b, 0x48, 0x59, 0x2a, 0x8b, 0xb7, 0x47, 0xe7,
      0xb2, 0x44, 0xfc, 0x45, 0x0,  0x80, 0x7,  0xd1, 0x4a, 0xb3, 0x1f, 0xb2, 0xdb, 0xf7, 0xcd, 0xc0, 0xd7, 0xb,  0x1b,
      0x26, 0x0,  0x2,  0x7d, 0x8b, 0x0,  0x19, 0x94, 0x84, 0x2e, 0xd5, 0x7b, 0x21, 0xde, 0x92, 0x24, 0x15, 0x26, 0xf8,
      0x40, 0x28, 0x8a, 0xa,  0x2b, 0xd2, 0x54, 0xa2, 0x56, 0x3f, 0xf5, 0x8b, 0xe8, 0x28, 0x8b, 0x12, 0x0,  0x7,  0x18,
      0xce, 0xc3, 0x85, 0xba, 0xf4, 0xa4, 0x12, 0x0,  0x14, 0xae, 0x60, 0x3e, 0xbb, 0xd1, 0x29, 0x39, 0xa5, 0x3c, 0x4,
      0xae, 0xa,  0xf8, 0x87, 0xe0, 0x6d, 0x8c, 0x7e, 0x7,  0x72, 0x22, 0x64, 0xad, 0x9,  0x0,  0x6,  0x44, 0x99, 0xc8,
      0x66, 0x2d, 0x86, 0x26, 0x0,  0x12, 0x5f, 0x2,  0x8e, 0xe6, 0x12, 0xe3, 0x46, 0xff, 0x55, 0x15, 0x5,  0x40, 0x5b,
      0xf3, 0x8c, 0xf3, 0x47, 0xc3, 0x0,  0x1c, 0x5d, 0x19, 0xd5, 0xa7, 0xf3, 0x90, 0xbb, 0x58, 0xbc, 0xe8, 0xe2, 0xb7,
      0x10, 0x7a, 0x7c, 0x3d, 0xc4, 0x6e, 0xec, 0x21, 0xeb, 0x1,  0xdf, 0x4a, 0xb6, 0x5e, 0x43, 0x29, 0x0,  0xb,  0xa4,
      0xfd, 0xff, 0xbe, 0x2f, 0x50, 0x76, 0xe8, 0x1b, 0x7f, 0x10, 0x0,  0x1c, 0x9f, 0xfe, 0x63, 0xf5, 0x5b, 0xa4, 0xd,
      0x87, 0x62, 0x4d, 0x7a, 0x96, 0xcd, 0x60, 0x65, 0xe9, 0x8c, 0x87, 0x59, 0x72, 0x4e, 0xb4, 0x1d, 0xba, 0x8c, 0xd1,
      0x41, 0x73, 0x0,  0xf,  0x3c, 0x1c, 0xac, 0x62, 0xc4, 0xf,  0xdc, 0xcb, 0x0,  0x60, 0x3c, 0x76, 0x86, 0xc3, 0x65};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops2[] = {0xa, 0x12, 0xd9, 0xd2, 0xdb, 0x93, 0x94, 0xac, 0x25, 0x30, 0x89, 0xde, 0xab, 0xcc};
  uint8_t bytesprops1[] = {0xc5, 0x3f, 0xf,  0x4e, 0xdf, 0x21, 0xd5, 0x7d, 0x78, 0x63, 0xb0, 0x7, 0x55,
                           0xb1, 0xc5, 0xed, 0x42, 0xa9, 0xe9, 0xa1, 0xb6, 0x1b, 0x72, 0x49, 0x39};
  uint8_t bytesprops3[] = {0x2b, 0x42, 0xd8, 0xf5, 0x8f, 0xf7, 0xea, 0x40, 0xe2, 0x24, 0xc8, 0x77, 0x66, 0x42,
                           0x70, 0xbb, 0xca, 0xfd, 0x47, 0x7a, 0xfc, 0xc6, 0x52, 0x5e, 0x26, 0x25, 0x48};
  uint8_t bytesprops4[] = {0xdc, 0xd3, 0x25, 0xa6};
  uint8_t bytesprops5[] = {0x55, 0x7b, 0x48, 0x59, 0x2a, 0x8b, 0xb7, 0x47, 0xe7, 0xb2, 0x44, 0xfc, 0x45,
                           0x0,  0x80, 0x7,  0xd1, 0x4a, 0xb3, 0x1f, 0xb2, 0xdb, 0xf7, 0xcd, 0xc0, 0xd7};
  uint8_t bytesprops7[] = {0x94, 0x84, 0x2e, 0xd5, 0x7b, 0x21, 0xde, 0x92, 0x24, 0x15, 0x26, 0xf8, 0x40,
                           0x28, 0x8a, 0xa,  0x2b, 0xd2, 0x54, 0xa2, 0x56, 0x3f, 0xf5, 0x8b, 0xe8};
  uint8_t bytesprops6[] = {0x7d, 0x8b};
  uint8_t bytesprops8[] = {0x18, 0xce, 0xc3, 0x85, 0xba, 0xf4, 0xa4};
  uint8_t bytesprops9[] = {0xae, 0x60, 0x3e, 0xbb, 0xd1, 0x29, 0x39, 0xa5, 0x3c, 0x4,
                           0xae, 0xa,  0xf8, 0x87, 0xe0, 0x6d, 0x8c, 0x7e, 0x7,  0x72};
  uint8_t bytesprops10[] = {0x44, 0x99, 0xc8, 0x66, 0x2d, 0x86};
  uint8_t bytesprops12[] = {0x5d, 0x19, 0xd5, 0xa7, 0xf3, 0x90, 0xbb, 0x58, 0xbc, 0xe8, 0xe2, 0xb7, 0x10, 0x7a,
                            0x7c, 0x3d, 0xc4, 0x6e, 0xec, 0x21, 0xeb, 0x1,  0xdf, 0x4a, 0xb6, 0x5e, 0x43, 0x29};
  uint8_t bytesprops11[] = {0x5f, 0x2, 0x8e, 0xe6, 0x12, 0xe3, 0x46, 0xff, 0x55,
                            0x15, 0x5, 0x40, 0x5b, 0xf3, 0x8c, 0xf3, 0x47, 0xc3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 913}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 534}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5455}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20257}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops1}, .v = {14, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10730}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26571}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19598}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops6}, .v = {25, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25773}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&bytesprops11}, .v = {28, (char*)&bytesprops12}}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 27380;
  uint8_t client_id_bytes[] = {0xa4, 0xfd, 0xff, 0xbe, 0x2f, 0x50, 0x76, 0xe8, 0x1b, 0x7f, 0x10};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x9f, 0xfe, 0x63, 0xf5, 0x5b, 0xa4, 0xd,  0x87, 0x62, 0x4d, 0x7a, 0x96, 0xcd, 0x60,
                              0x65, 0xe9, 0x8c, 0x87, 0x59, 0x72, 0x4e, 0xb4, 0x1d, 0xba, 0x8c, 0xd1, 0x41, 0x73};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3c, 0x1c, 0xac, 0x62, 0xc4, 0xf, 0xdc, 0xcb, 0x0, 0x60, 0x3c, 0x76, 0x86, 0xc3, 0x65};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "6\139\225\160\222Yv\ETB\184\SUB\RS\SO\234}G\231", _lastWill =
// Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "#\147F\FS\155\DC4#\190\181\197\164\ESC\166\191Z\ENQ\247\143\216\251\140\232\161>\239\135", _willMsg =
// "\232\233\vx\202\163\SOH\188\142\245iS\"H\226\158\228\235\182tA\252\ACK\191\183j8", _willProps =
// [PropRequestProblemInformation 207,PropTopicAlias 4199,PropResponseInformation
// "\183\249\163+\210\167/\229",PropContentType "\191\220\171\CAN\213\&5;\235\140
// \231HX\248p.\132-\199W\168X\239#oa\172\162g(",PropUserProperty ""
// "\218\&1R\149p\193\226\143",PropAuthenticationMethod "\130",PropSessionExpiryInterval 2593,PropTopicAlias
// 23065,PropSessionExpiryInterval 4102,PropPayloadFormatIndicator 35,PropAuthenticationMethod "1r4"]}), _cleanSession =
// False, _keepAlive = 2005, _connID = "\SODv\236\176\168\ETB \EOT", _properties = [PropAuthenticationData
// "\247v\GS\229TS\208\161\DC1\235_\242\236\147J\175*R]",PropAssignedClientIdentifier "",PropCorrelationData
// "t\185\183\SOH!n\197\215\177\DC1O\fI\167\217(\\\253\138\206\193\213",PropReasonString
// "9\185\FSh\184\223l\134\162\151x\246O\226\216\164",PropTopicAliasMaximum 11736,PropMaximumQoS 32,PropServerReference
// "\199[3\248\148\186\DC4\149\NAK\166\"\132\198\249\v\t\167*H/z\183r\DC4#\191\STXT",PropResponseTopic
// "\236\196\199\207;N\222M\162\f\"\175\221\186",PropResponseTopic
// "\218\139\220f\247\ESC}\132\152\205\149\154\156\RS\ESC\199\223\223\158\&8\230$",PropResponseTopic
// "\STXs\246\190\ENQB`\178o\186\218\153\131\RS",PropAuthenticationData
// "\173V\209T\246\ENQ\v\152\ENQ\152\247\157\DEL\218\186u\202\a\193",PropWillDelayInterval
// 4378,PropMessageExpiryInterval 17537,PropRequestResponseInformation 119,PropReceiveMaximum 18892,PropServerReference
// "\200\132\&4\128W\178\DEL\156\131\182\149\240\GS\GS\182B\225N\152A`^\154P",PropRequestResponseInformation
// 200,PropWildcardSubscriptionAvailable 134,PropMessageExpiryInterval 8274,PropSharedSubscriptionAvailable
// 11,PropMaximumQoS 111,PropCorrelationData "R/\147\191\&1\132\233y\131\136\&0\248F",PropPayloadFormatIndicator
// 50,PropTopicAliasMaximum 2391]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x10, 0xc0, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x64, 0x7,  0xd5, 0x86, 0x2,  0x16, 0x0,  0x13, 0xf7,
      0x76, 0x1d, 0xe5, 0x54, 0x53, 0xd0, 0xa1, 0x11, 0xeb, 0x5f, 0xf2, 0xec, 0x93, 0x4a, 0xaf, 0x2a, 0x52, 0x5d, 0x12,
      0x0,  0x0,  0x9,  0x0,  0x16, 0x74, 0xb9, 0xb7, 0x1,  0x21, 0x6e, 0xc5, 0xd7, 0xb1, 0x11, 0x4f, 0xc,  0x49, 0xa7,
      0xd9, 0x28, 0x5c, 0xfd, 0x8a, 0xce, 0xc1, 0xd5, 0x1f, 0x0,  0x10, 0x39, 0xb9, 0x1c, 0x68, 0xb8, 0xdf, 0x6c, 0x86,
      0xa2, 0x97, 0x78, 0xf6, 0x4f, 0xe2, 0xd8, 0xa4, 0x22, 0x2d, 0xd8, 0x24, 0x20, 0x1c, 0x0,  0x1c, 0xc7, 0x5b, 0x33,
      0xf8, 0x94, 0xba, 0x14, 0x95, 0x15, 0xa6, 0x22, 0x84, 0xc6, 0xf9, 0xb,  0x9,  0xa7, 0x2a, 0x48, 0x2f, 0x7a, 0xb7,
      0x72, 0x14, 0x23, 0xbf, 0x2,  0x54, 0x8,  0x0,  0xe,  0xec, 0xc4, 0xc7, 0xcf, 0x3b, 0x4e, 0xde, 0x4d, 0xa2, 0xc,
      0x22, 0xaf, 0xdd, 0xba, 0x8,  0x0,  0x16, 0xda, 0x8b, 0xdc, 0x66, 0xf7, 0x1b, 0x7d, 0x84, 0x98, 0xcd, 0x95, 0x9a,
      0x9c, 0x1e, 0x1b, 0xc7, 0xdf, 0xdf, 0x9e, 0x38, 0xe6, 0x24, 0x8,  0x0,  0xe,  0x2,  0x73, 0xf6, 0xbe, 0x5,  0x42,
      0x60, 0xb2, 0x6f, 0xba, 0xda, 0x99, 0x83, 0x1e, 0x16, 0x0,  0x13, 0xad, 0x56, 0xd1, 0x54, 0xf6, 0x5,  0xb,  0x98,
      0x5,  0x98, 0xf7, 0x9d, 0x7f, 0xda, 0xba, 0x75, 0xca, 0x7,  0xc1, 0x18, 0x0,  0x0,  0x11, 0x1a, 0x2,  0x0,  0x0,
      0x44, 0x81, 0x19, 0x77, 0x21, 0x49, 0xcc, 0x1c, 0x0,  0x18, 0xc8, 0x84, 0x34, 0x80, 0x57, 0xb2, 0x7f, 0x9c, 0x83,
      0xb6, 0x95, 0xf0, 0x1d, 0x1d, 0xb6, 0x42, 0xe1, 0x4e, 0x98, 0x41, 0x60, 0x5e, 0x9a, 0x50, 0x19, 0xc8, 0x28, 0x86,
      0x2,  0x0,  0x0,  0x20, 0x52, 0x2a, 0xb,  0x24, 0x6f, 0x9,  0x0,  0xd,  0x52, 0x2f, 0x93, 0xbf, 0x31, 0x84, 0xe9,
      0x79, 0x83, 0x88, 0x30, 0xf8, 0x46, 0x1,  0x32, 0x22, 0x9,  0x57, 0x0,  0x9,  0xe,  0x44, 0x76, 0xec, 0xb0, 0xa8,
      0x17, 0x20, 0x4,  0x57, 0x17, 0xcf, 0x23, 0x10, 0x67, 0x1a, 0x0,  0x8,  0xb7, 0xf9, 0xa3, 0x2b, 0xd2, 0xa7, 0x2f,
      0xe5, 0x3,  0x0,  0x1e, 0xbf, 0xdc, 0xab, 0x18, 0xd5, 0x35, 0x3b, 0xeb, 0x8c, 0x20, 0xe7, 0x48, 0x58, 0xf8, 0x70,
      0x2e, 0x84, 0x2d, 0xc7, 0x57, 0xa8, 0x58, 0xef, 0x23, 0x6f, 0x61, 0xac, 0xa2, 0x67, 0x28, 0x26, 0x0,  0x0,  0x0,
      0x8,  0xda, 0x31, 0x52, 0x95, 0x70, 0xc1, 0xe2, 0x8f, 0x15, 0x0,  0x1,  0x82, 0x11, 0x0,  0x0,  0xa,  0x21, 0x23,
      0x5a, 0x19, 0x11, 0x0,  0x0,  0x10, 0x6,  0x1,  0x23, 0x15, 0x0,  0x3,  0x31, 0x72, 0x34, 0x0,  0x1a, 0x23, 0x93,
      0x46, 0x1c, 0x9b, 0x14, 0x23, 0xbe, 0xb5, 0xc5, 0xa4, 0x1b, 0xa6, 0xbf, 0x5a, 0x5,  0xf7, 0x8f, 0xd8, 0xfb, 0x8c,
      0xe8, 0xa1, 0x3e, 0xef, 0x87, 0x0,  0x1b, 0xe8, 0xe9, 0xb,  0x78, 0xca, 0xa3, 0x1,  0xbc, 0x8e, 0xf5, 0x69, 0x53,
      0x22, 0x48, 0xe2, 0x9e, 0xe4, 0xeb, 0xb6, 0x74, 0x41, 0xfc, 0x6,  0xbf, 0xb7, 0x6a, 0x38, 0x0,  0x10, 0x36, 0x8b,
      0xe1, 0xa0, 0xde, 0x59, 0x76, 0x17, 0xb8, 0x1a, 0x1e, 0xe,  0xea, 0x7d, 0x47, 0xe7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf7, 0x76, 0x1d, 0xe5, 0x54, 0x53, 0xd0, 0xa1, 0x11, 0xeb,
                           0x5f, 0xf2, 0xec, 0x93, 0x4a, 0xaf, 0x2a, 0x52, 0x5d};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x74, 0xb9, 0xb7, 0x1,  0x21, 0x6e, 0xc5, 0xd7, 0xb1, 0x11, 0x4f,
                           0xc,  0x49, 0xa7, 0xd9, 0x28, 0x5c, 0xfd, 0x8a, 0xce, 0xc1, 0xd5};
  uint8_t bytesprops3[] = {0x39, 0xb9, 0x1c, 0x68, 0xb8, 0xdf, 0x6c, 0x86,
                           0xa2, 0x97, 0x78, 0xf6, 0x4f, 0xe2, 0xd8, 0xa4};
  uint8_t bytesprops4[] = {0xc7, 0x5b, 0x33, 0xf8, 0x94, 0xba, 0x14, 0x95, 0x15, 0xa6, 0x22, 0x84, 0xc6, 0xf9,
                           0xb,  0x9,  0xa7, 0x2a, 0x48, 0x2f, 0x7a, 0xb7, 0x72, 0x14, 0x23, 0xbf, 0x2,  0x54};
  uint8_t bytesprops5[] = {0xec, 0xc4, 0xc7, 0xcf, 0x3b, 0x4e, 0xde, 0x4d, 0xa2, 0xc, 0x22, 0xaf, 0xdd, 0xba};
  uint8_t bytesprops6[] = {0xda, 0x8b, 0xdc, 0x66, 0xf7, 0x1b, 0x7d, 0x84, 0x98, 0xcd, 0x95,
                           0x9a, 0x9c, 0x1e, 0x1b, 0xc7, 0xdf, 0xdf, 0x9e, 0x38, 0xe6, 0x24};
  uint8_t bytesprops7[] = {0x2, 0x73, 0xf6, 0xbe, 0x5, 0x42, 0x60, 0xb2, 0x6f, 0xba, 0xda, 0x99, 0x83, 0x1e};
  uint8_t bytesprops8[] = {0xad, 0x56, 0xd1, 0x54, 0xf6, 0x5,  0xb,  0x98, 0x5, 0x98,
                           0xf7, 0x9d, 0x7f, 0xda, 0xba, 0x75, 0xca, 0x7,  0xc1};
  uint8_t bytesprops9[] = {0xc8, 0x84, 0x34, 0x80, 0x57, 0xb2, 0x7f, 0x9c, 0x83, 0xb6, 0x95, 0xf0,
                           0x1d, 0x1d, 0xb6, 0x42, 0xe1, 0x4e, 0x98, 0x41, 0x60, 0x5e, 0x9a, 0x50};
  uint8_t bytesprops10[] = {0x52, 0x2f, 0x93, 0xbf, 0x31, 0x84, 0xe9, 0x79, 0x83, 0x88, 0x30, 0xf8, 0x46};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11736}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4378}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17537}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18892}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8274}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2391}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xb7, 0xf9, 0xa3, 0x2b, 0xd2, 0xa7, 0x2f, 0xe5};
  uint8_t byteswillprops1[] = {0xbf, 0xdc, 0xab, 0x18, 0xd5, 0x35, 0x3b, 0xeb, 0x8c, 0x20,
                               0xe7, 0x48, 0x58, 0xf8, 0x70, 0x2e, 0x84, 0x2d, 0xc7, 0x57,
                               0xa8, 0x58, 0xef, 0x23, 0x6f, 0x61, 0xac, 0xa2, 0x67, 0x28};
  uint8_t byteswillprops3[] = {0xda, 0x31, 0x52, 0x95, 0x70, 0xc1, 0xe2, 0x8f};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops4[] = {0x82};
  uint8_t byteswillprops5[] = {0x31, 0x72, 0x34};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4199}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops2}, .v = {8, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2593}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23065}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4102}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {11, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x23, 0x93, 0x46, 0x1c, 0x9b, 0x14, 0x23, 0xbe, 0xb5, 0xc5, 0xa4, 0x1b, 0xa6,
                                0xbf, 0x5a, 0x5,  0xf7, 0x8f, 0xd8, 0xfb, 0x8c, 0xe8, 0xa1, 0x3e, 0xef, 0x87};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe8, 0xe9, 0xb,  0x78, 0xca, 0xa3, 0x1,  0xbc, 0x8e, 0xf5, 0x69, 0x53, 0x22, 0x48,
                                  0xe2, 0x9e, 0xe4, 0xeb, 0xb6, 0x74, 0x41, 0xfc, 0x6,  0xbf, 0xb7, 0x6a, 0x38};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2005;
  uint8_t client_id_bytes[] = {0xe, 0x44, 0x76, 0xec, 0xb0, 0xa8, 0x17, 0x20, 0x4};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x36, 0x8b, 0xe1, 0xa0, 0xde, 0x59, 0x76, 0x17,
                              0xb8, 0x1a, 0x1e, 0xe,  0xea, 0x7d, 0x47, 0xe7};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "5\189\229", _password = Just "\SO\229\SUB\207\196\181|6\242\192@", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "v<3?)\161", _willMsg =
// "\202\&9\147\164]\233\219\201F\146ox)xa", _willProps = [PropAssignedClientIdentifier
// "Dc\147\242\153",PropResponseTopic "\EM\b-\DELBH@}\187\218\162\213\134",PropResponseInformation
// "\n1b\217:bmW\202_jM\223\157\162\CAN\ETX\168",PropSubscriptionIdentifierAvailable 100,PropAuthenticationData
// "\204z\an",PropSessionExpiryInterval 8296,PropContentType "\235\149\162!\EOT\244
// \207\170\221\185\238e\174\167:n}A~\172\255*\165\NUL\131\128a",PropAuthenticationMethod "%",PropResponseTopic
// "\DC4\191Y\141\&9\170m",PropMaximumPacketSize 24666,PropPayloadFormatIndicator 239,PropReceiveMaximum
// 30525,PropTopicAliasMaximum 26970,PropRequestProblemInformation 125,PropServerReference
// "\190\205;9?\139\178\185\SYN\SUB\201\a",PropTopicAlias 26971,PropMessageExpiryInterval 5356,PropReceiveMaximum
// 5790,PropRequestResponseInformation 218,PropServerReference "\206",PropServerReference
// "-\SUB\149\226\222",PropSubscriptionIdentifier 12,PropWillDelayInterval 9880,PropRequestResponseInformation 52]}),
// _cleanSession = False, _keepAlive = 31959, _connID = "K\181", _properties = [PropWildcardSubscriptionAvailable
// 193,PropTopicAlias 23844,PropRequestProblemInformation 174,PropWildcardSubscriptionAvailable
// 246,PropResponseInformation "H",PropMessageExpiryInterval 4039,PropTopicAlias 29447,PropMessageExpiryInterval
// 9745,PropContentType "\220b\195\246X\148\GS&\192\211%\136\149",PropCorrelationData
// "\137C\140\217\ETX\165\196\135g\224\196\130\237\NAK\198\224\DEL\179",PropResponseTopic
// "\142\191\170\182\239\131\SUB\251\141\182VI",PropServerReference
// "k&|\204\142\171\220\133\163\248l\247\136,\136`\182e;)\219nY\DC4\129",PropRetainAvailable 42,PropRetainAvailable
// 141,PropResponseTopic "\196\177\&7\243\DC4\245\193\DC4\234",PropMaximumPacketSize 23721,PropAuthenticationMethod
// "\231`@P\184\169U\255|\DLE",PropReasonString "\228/\245lwe)\150\SO\246\ESCT\135>\188\250",PropAuthenticationMethod
// "\158\164\182\SO-O\192\205\162\175\161\172\SI\198B\224WS\207\212\145\DC4",PropSharedSubscriptionAvailable
// 210,PropPayloadFormatIndicator 185,PropMessageExpiryInterval 2096,PropTopicAlias 13639,PropRetainAvailable
// 168,PropTopicAliasMaximum 9785,PropContentType "\v\DC3I",PropAssignedClientIdentifier
// "\176\155\178\141",PropRetainAvailable 76]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x10, 0xbd, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x7c, 0xd7, 0xd8, 0x1,  0x28, 0xc1, 0x23, 0x5d,
      0x24, 0x17, 0xae, 0x28, 0xf6, 0x1a, 0x0,  0x1,  0x48, 0x2,  0x0,  0x0,  0xf,  0xc7, 0x23, 0x73, 0x7,  0x2,  0x0,
      0x0,  0x26, 0x11, 0x3,  0x0,  0xd,  0xdc, 0x62, 0xc3, 0xf6, 0x58, 0x94, 0x1d, 0x26, 0xc0, 0xd3, 0x25, 0x88, 0x95,
      0x9,  0x0,  0x12, 0x89, 0x43, 0x8c, 0xd9, 0x3,  0xa5, 0xc4, 0x87, 0x67, 0xe0, 0xc4, 0x82, 0xed, 0x15, 0xc6, 0xe0,
      0x7f, 0xb3, 0x8,  0x0,  0xc,  0x8e, 0xbf, 0xaa, 0xb6, 0xef, 0x83, 0x1a, 0xfb, 0x8d, 0xb6, 0x56, 0x49, 0x1c, 0x0,
      0x19, 0x6b, 0x26, 0x7c, 0xcc, 0x8e, 0xab, 0xdc, 0x85, 0xa3, 0xf8, 0x6c, 0xf7, 0x88, 0x2c, 0x88, 0x60, 0xb6, 0x65,
      0x3b, 0x29, 0xdb, 0x6e, 0x59, 0x14, 0x81, 0x25, 0x2a, 0x25, 0x8d, 0x8,  0x0,  0x9,  0xc4, 0xb1, 0x37, 0xf3, 0x14,
      0xf5, 0xc1, 0x14, 0xea, 0x27, 0x0,  0x0,  0x5c, 0xa9, 0x15, 0x0,  0xa,  0xe7, 0x60, 0x40, 0x50, 0xb8, 0xa9, 0x55,
      0xff, 0x7c, 0x10, 0x1f, 0x0,  0x10, 0xe4, 0x2f, 0xf5, 0x6c, 0x77, 0x65, 0x29, 0x96, 0xe,  0xf6, 0x1b, 0x54, 0x87,
      0x3e, 0xbc, 0xfa, 0x15, 0x0,  0x16, 0x9e, 0xa4, 0xb6, 0xe,  0x2d, 0x4f, 0xc0, 0xcd, 0xa2, 0xaf, 0xa1, 0xac, 0xf,
      0xc6, 0x42, 0xe0, 0x57, 0x53, 0xcf, 0xd4, 0x91, 0x14, 0x2a, 0xd2, 0x1,  0xb9, 0x2,  0x0,  0x0,  0x8,  0x30, 0x23,
      0x35, 0x47, 0x25, 0xa8, 0x22, 0x26, 0x39, 0x3,  0x0,  0x3,  0xb,  0x13, 0x49, 0x12, 0x0,  0x4,  0xb0, 0x9b, 0xb2,
      0x8d, 0x25, 0x4c, 0x0,  0x2,  0x4b, 0xb5, 0xa8, 0x1,  0x12, 0x0,  0x5,  0x44, 0x63, 0x93, 0xf2, 0x99, 0x8,  0x0,
      0xd,  0x19, 0x8,  0x2d, 0x7f, 0x42, 0x48, 0x40, 0x7d, 0xbb, 0xda, 0xa2, 0xd5, 0x86, 0x1a, 0x0,  0x12, 0xa,  0x31,
      0x62, 0xd9, 0x3a, 0x62, 0x6d, 0x57, 0xca, 0x5f, 0x6a, 0x4d, 0xdf, 0x9d, 0xa2, 0x18, 0x3,  0xa8, 0x29, 0x64, 0x16,
      0x0,  0x4,  0xcc, 0x7a, 0x7,  0x6e, 0x11, 0x0,  0x0,  0x20, 0x68, 0x3,  0x0,  0x1c, 0xeb, 0x95, 0xa2, 0x21, 0x4,
      0xf4, 0x20, 0xcf, 0xaa, 0xdd, 0xb9, 0xee, 0x65, 0xae, 0xa7, 0x3a, 0x6e, 0x7d, 0x41, 0x7e, 0xac, 0xff, 0x2a, 0xa5,
      0x0,  0x83, 0x80, 0x61, 0x15, 0x0,  0x1,  0x25, 0x8,  0x0,  0x7,  0x14, 0xbf, 0x59, 0x8d, 0x39, 0xaa, 0x6d, 0x27,
      0x0,  0x0,  0x60, 0x5a, 0x1,  0xef, 0x21, 0x77, 0x3d, 0x22, 0x69, 0x5a, 0x17, 0x7d, 0x1c, 0x0,  0xc,  0xbe, 0xcd,
      0x3b, 0x39, 0x3f, 0x8b, 0xb2, 0xb9, 0x16, 0x1a, 0xc9, 0x7,  0x23, 0x69, 0x5b, 0x2,  0x0,  0x0,  0x14, 0xec, 0x21,
      0x16, 0x9e, 0x19, 0xda, 0x1c, 0x0,  0x1,  0xce, 0x1c, 0x0,  0x5,  0x2d, 0x1a, 0x95, 0xe2, 0xde, 0xb,  0xc,  0x18,
      0x0,  0x0,  0x26, 0x98, 0x19, 0x34, 0x0,  0x6,  0x76, 0x3c, 0x33, 0x3f, 0x29, 0xa1, 0x0,  0xf,  0xca, 0x39, 0x93,
      0xa4, 0x5d, 0xe9, 0xdb, 0xc9, 0x46, 0x92, 0x6f, 0x78, 0x29, 0x78, 0x61, 0x0,  0x3,  0x35, 0xbd, 0xe5, 0x0,  0xb,
      0xe,  0xe5, 0x1a, 0xcf, 0xc4, 0xb5, 0x7c, 0x36, 0xf2, 0xc0, 0x40};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x48};
  uint8_t bytesprops1[] = {0xdc, 0x62, 0xc3, 0xf6, 0x58, 0x94, 0x1d, 0x26, 0xc0, 0xd3, 0x25, 0x88, 0x95};
  uint8_t bytesprops2[] = {0x89, 0x43, 0x8c, 0xd9, 0x3,  0xa5, 0xc4, 0x87, 0x67,
                           0xe0, 0xc4, 0x82, 0xed, 0x15, 0xc6, 0xe0, 0x7f, 0xb3};
  uint8_t bytesprops3[] = {0x8e, 0xbf, 0xaa, 0xb6, 0xef, 0x83, 0x1a, 0xfb, 0x8d, 0xb6, 0x56, 0x49};
  uint8_t bytesprops4[] = {0x6b, 0x26, 0x7c, 0xcc, 0x8e, 0xab, 0xdc, 0x85, 0xa3, 0xf8, 0x6c, 0xf7, 0x88,
                           0x2c, 0x88, 0x60, 0xb6, 0x65, 0x3b, 0x29, 0xdb, 0x6e, 0x59, 0x14, 0x81};
  uint8_t bytesprops5[] = {0xc4, 0xb1, 0x37, 0xf3, 0x14, 0xf5, 0xc1, 0x14, 0xea};
  uint8_t bytesprops6[] = {0xe7, 0x60, 0x40, 0x50, 0xb8, 0xa9, 0x55, 0xff, 0x7c, 0x10};
  uint8_t bytesprops7[] = {0xe4, 0x2f, 0xf5, 0x6c, 0x77, 0x65, 0x29, 0x96,
                           0xe,  0xf6, 0x1b, 0x54, 0x87, 0x3e, 0xbc, 0xfa};
  uint8_t bytesprops8[] = {0x9e, 0xa4, 0xb6, 0xe,  0x2d, 0x4f, 0xc0, 0xcd, 0xa2, 0xaf, 0xa1,
                           0xac, 0xf,  0xc6, 0x42, 0xe0, 0x57, 0x53, 0xcf, 0xd4, 0x91, 0x14};
  uint8_t bytesprops9[] = {0xb, 0x13, 0x49};
  uint8_t bytesprops10[] = {0xb0, 0x9b, 0xb2, 0x8d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23844}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4039}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29447}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9745}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23721}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2096}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13639}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9785}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 76}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x44, 0x63, 0x93, 0xf2, 0x99};
  uint8_t byteswillprops1[] = {0x19, 0x8, 0x2d, 0x7f, 0x42, 0x48, 0x40, 0x7d, 0xbb, 0xda, 0xa2, 0xd5, 0x86};
  uint8_t byteswillprops2[] = {0xa,  0x31, 0x62, 0xd9, 0x3a, 0x62, 0x6d, 0x57, 0xca,
                               0x5f, 0x6a, 0x4d, 0xdf, 0x9d, 0xa2, 0x18, 0x3,  0xa8};
  uint8_t byteswillprops3[] = {0xcc, 0x7a, 0x7, 0x6e};
  uint8_t byteswillprops4[] = {0xeb, 0x95, 0xa2, 0x21, 0x4,  0xf4, 0x20, 0xcf, 0xaa, 0xdd, 0xb9, 0xee, 0x65, 0xae,
                               0xa7, 0x3a, 0x6e, 0x7d, 0x41, 0x7e, 0xac, 0xff, 0x2a, 0xa5, 0x0,  0x83, 0x80, 0x61};
  uint8_t byteswillprops5[] = {0x25};
  uint8_t byteswillprops6[] = {0x14, 0xbf, 0x59, 0x8d, 0x39, 0xaa, 0x6d};
  uint8_t byteswillprops7[] = {0xbe, 0xcd, 0x3b, 0x39, 0x3f, 0x8b, 0xb2, 0xb9, 0x16, 0x1a, 0xc9, 0x7};
  uint8_t byteswillprops8[] = {0xce};
  uint8_t byteswillprops9[] = {0x2d, 0x1a, 0x95, 0xe2, 0xde};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8296}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24666}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30525}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26970}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26971}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5356}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5790}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9880}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 52}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x76, 0x3c, 0x33, 0x3f, 0x29, 0xa1};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xca, 0x39, 0x93, 0xa4, 0x5d, 0xe9, 0xdb, 0xc9,
                                  0x46, 0x92, 0x6f, 0x78, 0x29, 0x78, 0x61};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 31959;
  uint8_t client_id_bytes[] = {0x4b, 0xb5};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x35, 0xbd, 0xe5};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xe, 0xe5, 0x1a, 0xcf, 0xc4, 0xb5, 0x7c, 0x36, 0xf2, 0xc0, 0x40};
  lwmqtt_string_t password = {11, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "$\DC3o!\SI\253}\212\230\FS`\217X\171[", _password = Just "u", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "\SOH$\ETB\192\157\196En", _willMsg =
// "\215\209\DLE\STX\164!\185\142\223\197\154\"\159\249\167,[\130", _willProps = [PropResponseInformation
// "X\203\245\ETX\160\216$T\219\195\ETB\193\226$\226\t\nKAcO\175\191\142\ACK\DC45\177]",PropWildcardSubscriptionAvailable
// 17,PropSubscriptionIdentifierAvailable 13,PropSharedSubscriptionAvailable 69,PropMessageExpiryInterval
// 3564,PropRequestResponseInformation 11,PropRetainAvailable 134,PropServerReference
// "\ETB\224A\152\215\RS\SO",PropSharedSubscriptionAvailable 37,PropRequestProblemInformation
// 119,PropSubscriptionIdentifierAvailable 218,PropResponseTopic "\159W\b\243",PropRequestResponseInformation
// 83,PropMessageExpiryInterval 11545,PropWildcardSubscriptionAvailable 245,PropPayloadFormatIndicator
// 154,PropMaximumQoS 150,PropSubscriptionIdentifier 22,PropServerKeepAlive 19385,PropWildcardSubscriptionAvailable
// 14,PropServerReference "\230",PropTopicAliasMaximum 19038]}), _cleanSession = True, _keepAlive = 14833, _connID =
// "\ETX@W\177\213>\v\227\232\224C\r\156\220j\DC4\170\177g\190-&\193", _properties = [PropTopicAlias
// 5177,PropServerKeepAlive 10636,PropAuthenticationMethod
// "\139\ETB\255\239\DLEL\180m\163I\SYN\233\SI\GS\CAN\155]p3\243\220\&8\243\b\192\SI&B",PropReasonString
// "J\138\STX\NAKz\207\&5\191\b\SUB\163\246R\US\135\211k\DC2)6[",PropMessageExpiryInterval 13679,PropReceiveMaximum
// 379,PropSubscriptionIdentifier 6,PropMessageExpiryInterval 28433,PropSubscriptionIdentifier
// 10,PropAssignedClientIdentifier "\148\177\154",PropReasonString "+\NULN\159\154R2\155R\170\FS",PropServerReference
// "4!+\178\141+\186\&5~\220F\134\GSUH\166\132\171aH",PropAuthenticationMethod
// "\250\209?\194\195\EMzH\224M\182\131\GS\\",PropSharedSubscriptionAvailable 22,PropPayloadFormatIndicator
// 213,PropResponseTopic "e",PropMessageExpiryInterval 30484,PropRequestProblemInformation
// 196,PropPayloadFormatIndicator 191,PropServerReference "\254\216\ACK\159\156\187\255!\234\NUL\r",PropReasonString
// "9Q\r\239\f",PropResponseTopic
// "bR\154\214v\148\139\252\153\225\128\\L\143\131\ESC\f\220\225\238\&8\ETB\201",PropWillDelayInterval
// 18510,PropMessageExpiryInterval 19228]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x10, 0x8e, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x39, 0xf1, 0xd5, 0x1,  0x23, 0x14, 0x39, 0x13,
      0x29, 0x8c, 0x15, 0x0,  0x1c, 0x8b, 0x17, 0xff, 0xef, 0x10, 0x4c, 0xb4, 0x6d, 0xa3, 0x49, 0x16, 0xe9, 0xf,  0x1d,
      0x18, 0x9b, 0x5d, 0x70, 0x33, 0xf3, 0xdc, 0x38, 0xf3, 0x8,  0xc0, 0xf,  0x26, 0x42, 0x1f, 0x0,  0x15, 0x4a, 0x8a,
      0x2,  0x15, 0x7a, 0xcf, 0x35, 0xbf, 0x8,  0x1a, 0xa3, 0xf6, 0x52, 0x1f, 0x87, 0xd3, 0x6b, 0x12, 0x29, 0x36, 0x5b,
      0x2,  0x0,  0x0,  0x35, 0x6f, 0x21, 0x1,  0x7b, 0xb,  0x6,  0x2,  0x0,  0x0,  0x6f, 0x11, 0xb,  0xa,  0x12, 0x0,
      0x3,  0x94, 0xb1, 0x9a, 0x1f, 0x0,  0xb,  0x2b, 0x0,  0x4e, 0x9f, 0x9a, 0x52, 0x32, 0x9b, 0x52, 0xaa, 0x1c, 0x1c,
      0x0,  0x14, 0x34, 0x21, 0x2b, 0xb2, 0x8d, 0x2b, 0xba, 0x35, 0x7e, 0xdc, 0x46, 0x86, 0x1d, 0x55, 0x48, 0xa6, 0x84,
      0xab, 0x61, 0x48, 0x15, 0x0,  0xe,  0xfa, 0xd1, 0x3f, 0xc2, 0xc3, 0x19, 0x7a, 0x48, 0xe0, 0x4d, 0xb6, 0x83, 0x1d,
      0x5c, 0x2a, 0x16, 0x1,  0xd5, 0x8,  0x0,  0x1,  0x65, 0x2,  0x0,  0x0,  0x77, 0x14, 0x17, 0xc4, 0x1,  0xbf, 0x1c,
      0x0,  0xb,  0xfe, 0xd8, 0x6,  0x9f, 0x9c, 0xbb, 0xff, 0x21, 0xea, 0x0,  0xd,  0x1f, 0x0,  0x5,  0x39, 0x51, 0xd,
      0xef, 0xc,  0x8,  0x0,  0x17, 0x62, 0x52, 0x9a, 0xd6, 0x76, 0x94, 0x8b, 0xfc, 0x99, 0xe1, 0x80, 0x5c, 0x4c, 0x8f,
      0x83, 0x1b, 0xc,  0xdc, 0xe1, 0xee, 0x38, 0x17, 0xc9, 0x18, 0x0,  0x0,  0x48, 0x4e, 0x2,  0x0,  0x0,  0x4b, 0x1c,
      0x0,  0x17, 0x3,  0x40, 0x57, 0xb1, 0xd5, 0x3e, 0xb,  0xe3, 0xe8, 0xe0, 0x43, 0xd,  0x9c, 0xdc, 0x6a, 0x14, 0xaa,
      0xb1, 0x67, 0xbe, 0x2d, 0x26, 0xc1, 0x61, 0x1a, 0x0,  0x1d, 0x58, 0xcb, 0xf5, 0x3,  0xa0, 0xd8, 0x24, 0x54, 0xdb,
      0xc3, 0x17, 0xc1, 0xe2, 0x24, 0xe2, 0x9,  0xa,  0x4b, 0x41, 0x63, 0x4f, 0xaf, 0xbf, 0x8e, 0x6,  0x14, 0x35, 0xb1,
      0x5d, 0x28, 0x11, 0x29, 0xd,  0x2a, 0x45, 0x2,  0x0,  0x0,  0xd,  0xec, 0x19, 0xb,  0x25, 0x86, 0x1c, 0x0,  0x7,
      0x17, 0xe0, 0x41, 0x98, 0xd7, 0x1e, 0xe,  0x2a, 0x25, 0x17, 0x77, 0x29, 0xda, 0x8,  0x0,  0x4,  0x9f, 0x57, 0x8,
      0xf3, 0x19, 0x53, 0x2,  0x0,  0x0,  0x2d, 0x19, 0x28, 0xf5, 0x1,  0x9a, 0x24, 0x96, 0xb,  0x16, 0x13, 0x4b, 0xb9,
      0x28, 0xe,  0x1c, 0x0,  0x1,  0xe6, 0x22, 0x4a, 0x5e, 0x0,  0x8,  0x1,  0x24, 0x17, 0xc0, 0x9d, 0xc4, 0x45, 0x6e,
      0x0,  0x12, 0xd7, 0xd1, 0x10, 0x2,  0xa4, 0x21, 0xb9, 0x8e, 0xdf, 0xc5, 0x9a, 0x22, 0x9f, 0xf9, 0xa7, 0x2c, 0x5b,
      0x82, 0x0,  0xf,  0x24, 0x13, 0x6f, 0x21, 0xf,  0xfd, 0x7d, 0xd4, 0xe6, 0x1c, 0x60, 0xd9, 0x58, 0xab, 0x5b, 0x0,
      0x1,  0x75};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8b, 0x17, 0xff, 0xef, 0x10, 0x4c, 0xb4, 0x6d, 0xa3, 0x49, 0x16, 0xe9, 0xf,  0x1d,
                           0x18, 0x9b, 0x5d, 0x70, 0x33, 0xf3, 0xdc, 0x38, 0xf3, 0x8,  0xc0, 0xf,  0x26, 0x42};
  uint8_t bytesprops1[] = {0x4a, 0x8a, 0x2,  0x15, 0x7a, 0xcf, 0x35, 0xbf, 0x8,  0x1a, 0xa3,
                           0xf6, 0x52, 0x1f, 0x87, 0xd3, 0x6b, 0x12, 0x29, 0x36, 0x5b};
  uint8_t bytesprops2[] = {0x94, 0xb1, 0x9a};
  uint8_t bytesprops3[] = {0x2b, 0x0, 0x4e, 0x9f, 0x9a, 0x52, 0x32, 0x9b, 0x52, 0xaa, 0x1c};
  uint8_t bytesprops4[] = {0x34, 0x21, 0x2b, 0xb2, 0x8d, 0x2b, 0xba, 0x35, 0x7e, 0xdc,
                           0x46, 0x86, 0x1d, 0x55, 0x48, 0xa6, 0x84, 0xab, 0x61, 0x48};
  uint8_t bytesprops5[] = {0xfa, 0xd1, 0x3f, 0xc2, 0xc3, 0x19, 0x7a, 0x48, 0xe0, 0x4d, 0xb6, 0x83, 0x1d, 0x5c};
  uint8_t bytesprops6[] = {0x65};
  uint8_t bytesprops7[] = {0xfe, 0xd8, 0x6, 0x9f, 0x9c, 0xbb, 0xff, 0x21, 0xea, 0x0, 0xd};
  uint8_t bytesprops8[] = {0x39, 0x51, 0xd, 0xef, 0xc};
  uint8_t bytesprops9[] = {0x62, 0x52, 0x9a, 0xd6, 0x76, 0x94, 0x8b, 0xfc, 0x99, 0xe1, 0x80, 0x5c,
                           0x4c, 0x8f, 0x83, 0x1b, 0xc,  0xdc, 0xe1, 0xee, 0x38, 0x17, 0xc9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5177}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10636}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13679}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 379}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28433}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30484}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18510}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19228}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x58, 0xcb, 0xf5, 0x3,  0xa0, 0xd8, 0x24, 0x54, 0xdb, 0xc3, 0x17, 0xc1, 0xe2, 0x24, 0xe2,
                               0x9,  0xa,  0x4b, 0x41, 0x63, 0x4f, 0xaf, 0xbf, 0x8e, 0x6,  0x14, 0x35, 0xb1, 0x5d};
  uint8_t byteswillprops1[] = {0x17, 0xe0, 0x41, 0x98, 0xd7, 0x1e, 0xe};
  uint8_t byteswillprops2[] = {0x9f, 0x57, 0x8, 0xf3};
  uint8_t byteswillprops3[] = {0xe6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3564}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11545}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19385}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19038}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1, 0x24, 0x17, 0xc0, 0x9d, 0xc4, 0x45, 0x6e};
  lwmqtt_string_t will_topic = {8, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd7, 0xd1, 0x10, 0x2,  0xa4, 0x21, 0xb9, 0x8e, 0xdf,
                                  0xc5, 0x9a, 0x22, 0x9f, 0xf9, 0xa7, 0x2c, 0x5b, 0x82};
  lwmqtt_string_t will_payload = {18, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14833;
  uint8_t client_id_bytes[] = {0x3,  0x40, 0x57, 0xb1, 0xd5, 0x3e, 0xb,  0xe3, 0xe8, 0xe0, 0x43, 0xd,
                               0x9c, 0xdc, 0x6a, 0x14, 0xaa, 0xb1, 0x67, 0xbe, 0x2d, 0x26, 0xc1};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x24, 0x13, 0x6f, 0x21, 0xf, 0xfd, 0x7d, 0xd4, 0xe6, 0x1c, 0x60, 0xd9, 0x58, 0xab, 0x5b};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x75};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\vA%3\NAK\141\215\DC1\202\232\133\157m&\195\DLE\177S\169-s\174ot\177\US\t\176",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\168\SO\185\228vJA\194DR\140\201\EOT\155\ETB!", _willMsg = "a\EM\252\SYNH\190\200 B\143\EOT\ETXl' \174\145\159n",
// _willProps = [PropReasonString
// "\DC3\255\206k\133-D\SYN39\212\\\242iul\tw\239Tn\227I\251R\233Y|\216",PropRetainAvailable
// 252,PropWildcardSubscriptionAvailable 49,PropSubscriptionIdentifier 1,PropTopicAlias 562,PropAuthenticationData
// "\248v4\196\DC2\211^G\189[\178\n\255\148",PropUserProperty
// "R\DC4\176\244\&13a\237\140\214\216:\171\136n\202\170\213\ETB\f%"
// "\195\149J\141RA\209E;H\176\134\179\209\156\164\197\229=<\129\DC4",PropReasonString
// "\DC34\NUL<\245\177\164\CAN?\255nK.[\153\201\233\242\220\135\160\198\149\169",PropTopicAliasMaximum
// 29408,PropSessionExpiryInterval 21193,PropSubscriptionIdentifier 7,PropWildcardSubscriptionAvailable
// 147,PropSharedSubscriptionAvailable 26,PropReasonString "",PropServerKeepAlive 14535,PropWillDelayInterval
// 21614,PropRequestResponseInformation 161,PropAuthenticationData "",PropAuthenticationMethod
// "sV\187\173=\biD\168\181\r_\SO\167\230\208\232V{\254\177]",PropSharedSubscriptionAvailable
// 40,PropMessageExpiryInterval 13486,PropSubscriptionIdentifierAvailable 33]}), _cleanSession = True, _keepAlive =
// 28777, _connID = "+3\250\223\230[8\232\GS\FS\191\141\166\159\EOT", _properties = [PropWildcardSubscriptionAvailable
// 102,PropRequestResponseInformation 196,PropSubscriptionIdentifier 14,PropMessageExpiryInterval
// 15373,PropWillDelayInterval 5915,PropRequestProblemInformation 1,PropAuthenticationMethod
// "\FS\205",PropSubscriptionIdentifierAvailable 112,PropMessageExpiryInterval 14235,PropResponseTopic
// "\DLE\155y\190\200G\220H\248\200`5y\216\243\255\214&\170%\251\DC1\140&\247\249\129",PropServerKeepAlive
// 5011,PropRetainAvailable 132,PropSubscriptionIdentifier 6,PropSubscriptionIdentifier 28,PropTopicAliasMaximum
// 10090,PropSubscriptionIdentifierAvailable 185,PropSharedSubscriptionAvailable 254,PropSubscriptionIdentifierAvailable
// 93,PropTopicAlias 90,PropMessageExpiryInterval 1532,PropResponseInformation
// "\155\171\&5\210J\184K",PropServerKeepAlive 28224]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x10, 0x8b, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8e, 0x70, 0x69, 0x63, 0x28, 0x66, 0x19, 0xc4, 0xb,
      0xe,  0x2,  0x0,  0x0,  0x3c, 0xd,  0x18, 0x0,  0x0,  0x17, 0x1b, 0x17, 0x1,  0x15, 0x0,  0x2,  0x1c, 0xcd, 0x29,
      0x70, 0x2,  0x0,  0x0,  0x37, 0x9b, 0x8,  0x0,  0x1b, 0x10, 0x9b, 0x79, 0xbe, 0xc8, 0x47, 0xdc, 0x48, 0xf8, 0xc8,
      0x60, 0x35, 0x79, 0xd8, 0xf3, 0xff, 0xd6, 0x26, 0xaa, 0x25, 0xfb, 0x11, 0x8c, 0x26, 0xf7, 0xf9, 0x81, 0x13, 0x13,
      0x93, 0x25, 0x84, 0xb,  0x6,  0xb,  0x1c, 0x22, 0x27, 0x6a, 0x29, 0xb9, 0x2a, 0xfe, 0x29, 0x5d, 0x23, 0x0,  0x5a,
      0x2,  0x0,  0x0,  0x5,  0xfc, 0x1a, 0x0,  0x7,  0x9b, 0xab, 0x35, 0xd2, 0x4a, 0xb8, 0x4b, 0x13, 0x6e, 0x40, 0x0,
      0xf,  0x2b, 0x33, 0xfa, 0xdf, 0xe6, 0x5b, 0x38, 0xe8, 0x1d, 0x1c, 0xbf, 0x8d, 0xa6, 0x9f, 0x4,  0xc5, 0x1,  0x1f,
      0x0,  0x1d, 0x13, 0xff, 0xce, 0x6b, 0x85, 0x2d, 0x44, 0x16, 0x33, 0x39, 0xd4, 0x5c, 0xf2, 0x69, 0x75, 0x6c, 0x9,
      0x77, 0xef, 0x54, 0x6e, 0xe3, 0x49, 0xfb, 0x52, 0xe9, 0x59, 0x7c, 0xd8, 0x25, 0xfc, 0x28, 0x31, 0xb,  0x1,  0x23,
      0x2,  0x32, 0x16, 0x0,  0xe,  0xf8, 0x76, 0x34, 0xc4, 0x12, 0xd3, 0x5e, 0x47, 0xbd, 0x5b, 0xb2, 0xa,  0xff, 0x94,
      0x26, 0x0,  0x15, 0x52, 0x14, 0xb0, 0xf4, 0x31, 0x33, 0x61, 0xed, 0x8c, 0xd6, 0xd8, 0x3a, 0xab, 0x88, 0x6e, 0xca,
      0xaa, 0xd5, 0x17, 0xc,  0x25, 0x0,  0x16, 0xc3, 0x95, 0x4a, 0x8d, 0x52, 0x41, 0xd1, 0x45, 0x3b, 0x48, 0xb0, 0x86,
      0xb3, 0xd1, 0x9c, 0xa4, 0xc5, 0xe5, 0x3d, 0x3c, 0x81, 0x14, 0x1f, 0x0,  0x18, 0x13, 0x34, 0x0,  0x3c, 0xf5, 0xb1,
      0xa4, 0x18, 0x3f, 0xff, 0x6e, 0x4b, 0x2e, 0x5b, 0x99, 0xc9, 0xe9, 0xf2, 0xdc, 0x87, 0xa0, 0xc6, 0x95, 0xa9, 0x22,
      0x72, 0xe0, 0x11, 0x0,  0x0,  0x52, 0xc9, 0xb,  0x7,  0x28, 0x93, 0x2a, 0x1a, 0x1f, 0x0,  0x0,  0x13, 0x38, 0xc7,
      0x18, 0x0,  0x0,  0x54, 0x6e, 0x19, 0xa1, 0x16, 0x0,  0x0,  0x15, 0x0,  0x16, 0x73, 0x56, 0xbb, 0xad, 0x3d, 0x8,
      0x69, 0x44, 0xa8, 0xb5, 0xd,  0x5f, 0xe,  0xa7, 0xe6, 0xd0, 0xe8, 0x56, 0x7b, 0xfe, 0xb1, 0x5d, 0x2a, 0x28, 0x2,
      0x0,  0x0,  0x34, 0xae, 0x29, 0x21, 0x0,  0x10, 0xa8, 0xe,  0xb9, 0xe4, 0x76, 0x4a, 0x41, 0xc2, 0x44, 0x52, 0x8c,
      0xc9, 0x4,  0x9b, 0x17, 0x21, 0x0,  0x13, 0x61, 0x19, 0xfc, 0x16, 0x48, 0xbe, 0xc8, 0x20, 0x42, 0x8f, 0x4,  0x3,
      0x6c, 0x27, 0x20, 0xae, 0x91, 0x9f, 0x6e, 0x0,  0x1c, 0xb,  0x41, 0x25, 0x33, 0x15, 0x8d, 0xd7, 0x11, 0xca, 0xe8,
      0x85, 0x9d, 0x6d, 0x26, 0xc3, 0x10, 0xb1, 0x53, 0xa9, 0x2d, 0x73, 0xae, 0x6f, 0x74, 0xb1, 0x1f, 0x9,  0xb0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1c, 0xcd};
  uint8_t bytesprops1[] = {0x10, 0x9b, 0x79, 0xbe, 0xc8, 0x47, 0xdc, 0x48, 0xf8, 0xc8, 0x60, 0x35, 0x79, 0xd8,
                           0xf3, 0xff, 0xd6, 0x26, 0xaa, 0x25, 0xfb, 0x11, 0x8c, 0x26, 0xf7, 0xf9, 0x81};
  uint8_t bytesprops2[] = {0x9b, 0xab, 0x35, 0xd2, 0x4a, 0xb8, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15373}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5915}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14235}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5011}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10090}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 90}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1532}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28224}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x13, 0xff, 0xce, 0x6b, 0x85, 0x2d, 0x44, 0x16, 0x33, 0x39, 0xd4, 0x5c, 0xf2, 0x69, 0x75,
                               0x6c, 0x9,  0x77, 0xef, 0x54, 0x6e, 0xe3, 0x49, 0xfb, 0x52, 0xe9, 0x59, 0x7c, 0xd8};
  uint8_t byteswillprops1[] = {0xf8, 0x76, 0x34, 0xc4, 0x12, 0xd3, 0x5e, 0x47, 0xbd, 0x5b, 0xb2, 0xa, 0xff, 0x94};
  uint8_t byteswillprops3[] = {0xc3, 0x95, 0x4a, 0x8d, 0x52, 0x41, 0xd1, 0x45, 0x3b, 0x48, 0xb0,
                               0x86, 0xb3, 0xd1, 0x9c, 0xa4, 0xc5, 0xe5, 0x3d, 0x3c, 0x81, 0x14};
  uint8_t byteswillprops2[] = {0x52, 0x14, 0xb0, 0xf4, 0x31, 0x33, 0x61, 0xed, 0x8c, 0xd6, 0xd8,
                               0x3a, 0xab, 0x88, 0x6e, 0xca, 0xaa, 0xd5, 0x17, 0xc,  0x25};
  uint8_t byteswillprops4[] = {0x13, 0x34, 0x0,  0x3c, 0xf5, 0xb1, 0xa4, 0x18, 0x3f, 0xff, 0x6e, 0x4b,
                               0x2e, 0x5b, 0x99, 0xc9, 0xe9, 0xf2, 0xdc, 0x87, 0xa0, 0xc6, 0x95, 0xa9};
  uint8_t byteswillprops5[] = {0};
  uint8_t byteswillprops6[] = {0};
  uint8_t byteswillprops7[] = {0x73, 0x56, 0xbb, 0xad, 0x3d, 0x8,  0x69, 0x44, 0xa8, 0xb5, 0xd,
                               0x5f, 0xe,  0xa7, 0xe6, 0xd0, 0xe8, 0x56, 0x7b, 0xfe, 0xb1, 0x5d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 1}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 562}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {21, (char*)&byteswillprops2}, .v = {22, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29408}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21193}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14535}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21614}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13486}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 33}},
  };

  lwmqtt_properties_t willprops = {22, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa8, 0xe,  0xb9, 0xe4, 0x76, 0x4a, 0x41, 0xc2,
                                0x44, 0x52, 0x8c, 0xc9, 0x4,  0x9b, 0x17, 0x21};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x61, 0x19, 0xfc, 0x16, 0x48, 0xbe, 0xc8, 0x20, 0x42, 0x8f,
                                  0x4,  0x3,  0x6c, 0x27, 0x20, 0xae, 0x91, 0x9f, 0x6e};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 28777;
  uint8_t client_id_bytes[] = {0x2b, 0x33, 0xfa, 0xdf, 0xe6, 0x5b, 0x38, 0xe8, 0x1d, 0x1c, 0xbf, 0x8d, 0xa6, 0x9f, 0x4};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb,  0x41, 0x25, 0x33, 0x15, 0x8d, 0xd7, 0x11, 0xca, 0xe8, 0x85, 0x9d, 0x6d, 0x26,
                              0xc3, 0x10, 0xb1, 0x53, 0xa9, 0x2d, 0x73, 0xae, 0x6f, 0x74, 0xb1, 0x1f, 0x9,  0xb0};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\154\187ln", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\147\234\128\171\v\219\164\138\218W\166", _willMsg =
// "\210\254\161\ENQ\v\192\253\DLE\176\204-\222Uv\154m\FSi+", _willProps = [PropAuthenticationData
// "\133\184W\221\160:\250\209q\DELF",PropMessageExpiryInterval 30765,PropTopicAlias 6533]}), _cleanSession = True,
// _keepAlive = 23669, _connID =
// "$\237\&8\219\166I\143>\251N\190&hL\173\150*\131\212>\211\244\SI\149\243\SYN\179\154\EOT", _properties =
// [PropContentType "\ETX\255)\146\212\218E8\SIt\STX}\203\215\210\DC3\ETB\248\216!\202\169Z\233\151",PropTopicAlias
// 13785,PropRequestProblemInformation 107,PropAssignedClientIdentifier "G\161\SYN\168[\154\210\195f\233n'"]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x99, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x76, 0x5c, 0x75, 0x30, 0x3,  0x0,
                   0x19, 0x3,  0xff, 0x29, 0x92, 0xd4, 0xda, 0x45, 0x38, 0xf,  0x74, 0x2,  0x7d, 0xcb, 0xd7, 0xd2,
                   0x13, 0x17, 0xf8, 0xd8, 0x21, 0xca, 0xa9, 0x5a, 0xe9, 0x97, 0x23, 0x35, 0xd9, 0x17, 0x6b, 0x12,
                   0x0,  0xc,  0x47, 0xa1, 0x16, 0xa8, 0x5b, 0x9a, 0xd2, 0xc3, 0x66, 0xe9, 0x6e, 0x27, 0x0,  0x1d,
                   0x24, 0xed, 0x38, 0xdb, 0xa6, 0x49, 0x8f, 0x3e, 0xfb, 0x4e, 0xbe, 0x26, 0x68, 0x4c, 0xad, 0x96,
                   0x2a, 0x83, 0xd4, 0x3e, 0xd3, 0xf4, 0xf,  0x95, 0xf3, 0x16, 0xb3, 0x9a, 0x4,  0x16, 0x16, 0x0,
                   0xb,  0x85, 0xb8, 0x57, 0xdd, 0xa0, 0x3a, 0xfa, 0xd1, 0x71, 0x7f, 0x46, 0x2,  0x0,  0x0,  0x78,
                   0x2d, 0x23, 0x19, 0x85, 0x0,  0xb,  0x93, 0xea, 0x80, 0xab, 0xb,  0xdb, 0xa4, 0x8a, 0xda, 0x57,
                   0xa6, 0x0,  0x13, 0xd2, 0xfe, 0xa1, 0x5,  0xb,  0xc0, 0xfd, 0x10, 0xb0, 0xcc, 0x2d, 0xde, 0x55,
                   0x76, 0x9a, 0x6d, 0x1c, 0x69, 0x2b, 0x0,  0x4,  0x9a, 0xbb, 0x6c, 0x6e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3,  0xff, 0x29, 0x92, 0xd4, 0xda, 0x45, 0x38, 0xf,  0x74, 0x2,  0x7d, 0xcb,
                           0xd7, 0xd2, 0x13, 0x17, 0xf8, 0xd8, 0x21, 0xca, 0xa9, 0x5a, 0xe9, 0x97};
  uint8_t bytesprops1[] = {0x47, 0xa1, 0x16, 0xa8, 0x5b, 0x9a, 0xd2, 0xc3, 0x66, 0xe9, 0x6e, 0x27};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13785}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x85, 0xb8, 0x57, 0xdd, 0xa0, 0x3a, 0xfa, 0xd1, 0x71, 0x7f, 0x46};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30765}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6533}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x93, 0xea, 0x80, 0xab, 0xb, 0xdb, 0xa4, 0x8a, 0xda, 0x57, 0xa6};
  lwmqtt_string_t will_topic = {11, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd2, 0xfe, 0xa1, 0x5,  0xb,  0xc0, 0xfd, 0x10, 0xb0, 0xcc,
                                  0x2d, 0xde, 0x55, 0x76, 0x9a, 0x6d, 0x1c, 0x69, 0x2b};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23669;
  uint8_t client_id_bytes[] = {0x24, 0xed, 0x38, 0xdb, 0xa6, 0x49, 0x8f, 0x3e, 0xfb, 0x4e, 0xbe, 0x26, 0x68, 0x4c, 0xad,
                               0x96, 0x2a, 0x83, 0xd4, 0x3e, 0xd3, 0xf4, 0xf,  0x95, 0xf3, 0x16, 0xb3, 0x9a, 0x4};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x9a, 0xbb, 0x6c, 0x6e};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\143,\SOH\155g\228PV\DC2<\233\167\240`\US", _password = Just
// "e\nm=f\140\230Dl\161\225\170\162v\164\EOTc\207\195\255\131n$G\179w", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\178\225\170J\183\NAK\128\201\233\247\215q\NAK\v\165A\US\228", _willMsg =
// "-\155\216\170\221I\188\147:\179\167:", _willProps = []}), _cleanSession = False, _keepAlive = 24031, _connID =
// "\SI5", _properties = [PropSharedSubscriptionAvailable 174,PropMaximumQoS 176,PropCorrelationData "\216\189j,
// i0djrea&|L<\194\r\190\229\239\174\253\193\GS",PropAssignedClientIdentifier
// "\ESC\234\207\&0kQky\146\132\177R\173C",PropResponseTopic "\fS~\173\230d
// \178\175\197\251K\161I$\226\148\ETB\237g\137~R\US",PropRequestResponseInformation 150,PropServerKeepAlive
// 20269,PropReceiveMaximum 13007,PropSharedSubscriptionAvailable 86,PropWildcardSubscriptionAvailable
// 86,PropSubscriptionIdentifier 9,PropSharedSubscriptionAvailable 61,PropSharedSubscriptionAvailable
// 165,PropWildcardSubscriptionAvailable 74,PropResponseInformation
// "\"<\192&\ENQ\253\215\137-\245\236\US\252`\184\&1\DC3V\t\130d\201\EOTj7",PropRetainAvailable 228,PropUserProperty
// "\SI\224j^J'\204e\214\181\137\162\185}\182\221\204P\179.H"
// "el\244\142B\137C}\CAN+6,\DEL;hg\234\226\151\237\&7\168",PropMaximumQoS 67,PropRequestProblemInformation
// 72,PropAuthenticationMethod "\200C\DLET\192\226h\134\167KO\ACK\132f\US\237",PropCorrelationData
// "\232\251\196\248nH\158\ENQ\192\129\STX\240\203\STX\137w\128\FS.\134Z\NAK\165x\229\"\203\DC3:",PropAuthenticationMethod
// "\159k\224\206\DC2\176\US\183,\216\&7\175\161\150/\227\&7\250s\201\128$K\249\239\151",PropAssignedClientIdentifier
// "\DEL6=\143\SI\246\a\163r\SOH\217\NUL\EMnd!",PropMessageExpiryInterval 25593,PropMaximumPacketSize
// 24532,PropRequestProblemInformation 63,PropSubscriptionIdentifierAvailable 47,PropReceiveMaximum
// 22000,PropMaximumPacketSize 7757,PropRetainAvailable 32]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x10, 0x8d, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x5d, 0xdf, 0xad, 0x2,  0x2a, 0xae, 0x24, 0xb0,
      0x9,  0x0,  0x19, 0xd8, 0xbd, 0x6a, 0x2c, 0x20, 0x69, 0x30, 0x64, 0x6a, 0x72, 0x65, 0x61, 0x26, 0x7c, 0x4c, 0x3c,
      0xc2, 0xd,  0xbe, 0xe5, 0xef, 0xae, 0xfd, 0xc1, 0x1d, 0x12, 0x0,  0xe,  0x1b, 0xea, 0xcf, 0x30, 0x6b, 0x51, 0x6b,
      0x79, 0x92, 0x84, 0xb1, 0x52, 0xad, 0x43, 0x8,  0x0,  0x18, 0xc,  0x53, 0x7e, 0xad, 0xe6, 0x64, 0x20, 0xb2, 0xaf,
      0xc5, 0xfb, 0x4b, 0xa1, 0x49, 0x24, 0xe2, 0x94, 0x17, 0xed, 0x67, 0x89, 0x7e, 0x52, 0x1f, 0x19, 0x96, 0x13, 0x4f,
      0x2d, 0x21, 0x32, 0xcf, 0x2a, 0x56, 0x28, 0x56, 0xb,  0x9,  0x2a, 0x3d, 0x2a, 0xa5, 0x28, 0x4a, 0x1a, 0x0,  0x19,
      0x22, 0x3c, 0xc0, 0x26, 0x5,  0xfd, 0xd7, 0x89, 0x2d, 0xf5, 0xec, 0x1f, 0xfc, 0x60, 0xb8, 0x31, 0x13, 0x56, 0x9,
      0x82, 0x64, 0xc9, 0x4,  0x6a, 0x37, 0x25, 0xe4, 0x26, 0x0,  0x15, 0xf,  0xe0, 0x6a, 0x5e, 0x4a, 0x27, 0xcc, 0x65,
      0xd6, 0xb5, 0x89, 0xa2, 0xb9, 0x7d, 0xb6, 0xdd, 0xcc, 0x50, 0xb3, 0x2e, 0x48, 0x0,  0x16, 0x65, 0x6c, 0xf4, 0x8e,
      0x42, 0x89, 0x43, 0x7d, 0x18, 0x2b, 0x36, 0x2c, 0x7f, 0x3b, 0x68, 0x67, 0xea, 0xe2, 0x97, 0xed, 0x37, 0xa8, 0x24,
      0x43, 0x17, 0x48, 0x15, 0x0,  0x10, 0xc8, 0x43, 0x10, 0x54, 0xc0, 0xe2, 0x68, 0x86, 0xa7, 0x4b, 0x4f, 0x6,  0x84,
      0x66, 0x1f, 0xed, 0x9,  0x0,  0x1d, 0xe8, 0xfb, 0xc4, 0xf8, 0x6e, 0x48, 0x9e, 0x5,  0xc0, 0x81, 0x2,  0xf0, 0xcb,
      0x2,  0x89, 0x77, 0x80, 0x1c, 0x2e, 0x86, 0x5a, 0x15, 0xa5, 0x78, 0xe5, 0x22, 0xcb, 0x13, 0x3a, 0x15, 0x0,  0x1a,
      0x9f, 0x6b, 0xe0, 0xce, 0x12, 0xb0, 0x1f, 0xb7, 0x2c, 0xd8, 0x37, 0xaf, 0xa1, 0x96, 0x2f, 0xe3, 0x37, 0xfa, 0x73,
      0xc9, 0x80, 0x24, 0x4b, 0xf9, 0xef, 0x97, 0x12, 0x0,  0x10, 0x7f, 0x36, 0x3d, 0x8f, 0xf,  0xf6, 0x7,  0xa3, 0x72,
      0x1,  0xd9, 0x0,  0x19, 0x6e, 0x64, 0x21, 0x2,  0x0,  0x0,  0x63, 0xf9, 0x27, 0x0,  0x0,  0x5f, 0xd4, 0x17, 0x3f,
      0x29, 0x2f, 0x21, 0x55, 0xf0, 0x27, 0x0,  0x0,  0x1e, 0x4d, 0x25, 0x20, 0x0,  0x2,  0xf,  0x35, 0x0,  0x0,  0x12,
      0xb2, 0xe1, 0xaa, 0x4a, 0xb7, 0x15, 0x80, 0xc9, 0xe9, 0xf7, 0xd7, 0x71, 0x15, 0xb,  0xa5, 0x41, 0x1f, 0xe4, 0x0,
      0xc,  0x2d, 0x9b, 0xd8, 0xaa, 0xdd, 0x49, 0xbc, 0x93, 0x3a, 0xb3, 0xa7, 0x3a, 0x0,  0xf,  0x8f, 0x2c, 0x1,  0x9b,
      0x67, 0xe4, 0x50, 0x56, 0x12, 0x3c, 0xe9, 0xa7, 0xf0, 0x60, 0x1f, 0x0,  0x1a, 0x65, 0xa,  0x6d, 0x3d, 0x66, 0x8c,
      0xe6, 0x44, 0x6c, 0xa1, 0xe1, 0xaa, 0xa2, 0x76, 0xa4, 0x4,  0x63, 0xcf, 0xc3, 0xff, 0x83, 0x6e, 0x24, 0x47, 0xb3,
      0x77};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd8, 0xbd, 0x6a, 0x2c, 0x20, 0x69, 0x30, 0x64, 0x6a, 0x72, 0x65, 0x61, 0x26,
                           0x7c, 0x4c, 0x3c, 0xc2, 0xd,  0xbe, 0xe5, 0xef, 0xae, 0xfd, 0xc1, 0x1d};
  uint8_t bytesprops1[] = {0x1b, 0xea, 0xcf, 0x30, 0x6b, 0x51, 0x6b, 0x79, 0x92, 0x84, 0xb1, 0x52, 0xad, 0x43};
  uint8_t bytesprops2[] = {0xc,  0x53, 0x7e, 0xad, 0xe6, 0x64, 0x20, 0xb2, 0xaf, 0xc5, 0xfb, 0x4b,
                           0xa1, 0x49, 0x24, 0xe2, 0x94, 0x17, 0xed, 0x67, 0x89, 0x7e, 0x52, 0x1f};
  uint8_t bytesprops3[] = {0x22, 0x3c, 0xc0, 0x26, 0x5,  0xfd, 0xd7, 0x89, 0x2d, 0xf5, 0xec, 0x1f, 0xfc,
                           0x60, 0xb8, 0x31, 0x13, 0x56, 0x9,  0x82, 0x64, 0xc9, 0x4,  0x6a, 0x37};
  uint8_t bytesprops5[] = {0x65, 0x6c, 0xf4, 0x8e, 0x42, 0x89, 0x43, 0x7d, 0x18, 0x2b, 0x36,
                           0x2c, 0x7f, 0x3b, 0x68, 0x67, 0xea, 0xe2, 0x97, 0xed, 0x37, 0xa8};
  uint8_t bytesprops4[] = {0xf,  0xe0, 0x6a, 0x5e, 0x4a, 0x27, 0xcc, 0x65, 0xd6, 0xb5, 0x89,
                           0xa2, 0xb9, 0x7d, 0xb6, 0xdd, 0xcc, 0x50, 0xb3, 0x2e, 0x48};
  uint8_t bytesprops6[] = {0xc8, 0x43, 0x10, 0x54, 0xc0, 0xe2, 0x68, 0x86,
                           0xa7, 0x4b, 0x4f, 0x6,  0x84, 0x66, 0x1f, 0xed};
  uint8_t bytesprops7[] = {0xe8, 0xfb, 0xc4, 0xf8, 0x6e, 0x48, 0x9e, 0x5,  0xc0, 0x81, 0x2,  0xf0, 0xcb, 0x2, 0x89,
                           0x77, 0x80, 0x1c, 0x2e, 0x86, 0x5a, 0x15, 0xa5, 0x78, 0xe5, 0x22, 0xcb, 0x13, 0x3a};
  uint8_t bytesprops8[] = {0x9f, 0x6b, 0xe0, 0xce, 0x12, 0xb0, 0x1f, 0xb7, 0x2c, 0xd8, 0x37, 0xaf, 0xa1,
                           0x96, 0x2f, 0xe3, 0x37, 0xfa, 0x73, 0xc9, 0x80, 0x24, 0x4b, 0xf9, 0xef, 0x97};
  uint8_t bytesprops9[] = {0x7f, 0x36, 0x3d, 0x8f, 0xf, 0xf6, 0x7, 0xa3, 0x72, 0x1, 0xd9, 0x0, 0x19, 0x6e, 0x64, 0x21};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20269}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13007}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 9}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops4}, .v = {22, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25593}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24532}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22000}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7757}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 32}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb2, 0xe1, 0xaa, 0x4a, 0xb7, 0x15, 0x80, 0xc9, 0xe9,
                                0xf7, 0xd7, 0x71, 0x15, 0xb,  0xa5, 0x41, 0x1f, 0xe4};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x2d, 0x9b, 0xd8, 0xaa, 0xdd, 0x49, 0xbc, 0x93, 0x3a, 0xb3, 0xa7, 0x3a};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 24031;
  uint8_t client_id_bytes[] = {0xf, 0x35};
  lwmqtt_string_t client_id = {2, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x8f, 0x2c, 0x1, 0x9b, 0x67, 0xe4, 0x50, 0x56, 0x12, 0x3c, 0xe9, 0xa7, 0xf0, 0x60, 0x1f};
  lwmqtt_string_t username = {15, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x65, 0xa,  0x6d, 0x3d, 0x66, 0x8c, 0xe6, 0x44, 0x6c, 0xa1, 0xe1, 0xaa, 0xa2,
                              0x76, 0xa4, 0x4,  0x63, 0xcf, 0xc3, 0xff, 0x83, 0x6e, 0x24, 0x47, 0xb3, 0x77};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\141\198\185\130\140v\STX\135\128\CAN", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic =
// "Y\242i\225Ly\163\177\f\138\135/TW\n\DC3\217\RS\251c\244\DLEs\CAN\178mU>\SO", _willMsg = "Z", _willProps =
// [PropSharedSubscriptionAvailable 173,PropRetainAvailable 148,PropAuthenticationData
// "l\225\ETX\t2\EOT>\248~\235\230\191\167\ACK\t\164\198\GS\NAK\243\165\128\130[1\181\210",PropContentType
// "`w\166Xy\224\226\193\153",PropAssignedClientIdentifier
// "!W\150o6\128\137\183\144\FS,c\227\144f\216\157",PropWillDelayInterval 23920,PropRetainAvailable
// 175,PropSharedSubscriptionAvailable 98,PropPayloadFormatIndicator 78,PropResponseInformation
// "\241^n}\171-\fv'\EOT\205_\177",PropAuthenticationMethod "\151,\142\177\133\213",PropServerKeepAlive
// 8086,PropSubscriptionIdentifierAvailable 121,PropMessageExpiryInterval 18973,PropTopicAlias
// 10091,PropMessageExpiryInterval 1594,PropServerKeepAlive 18996,PropWillDelayInterval 5991,PropContentType
// "\ETX\SOH\159Wp\214\187\176\246\166\185\235}\154\141s\178G\208G",PropRequestResponseInformation
// 14,PropMaximumPacketSize 23991,PropMessageExpiryInterval 21828,PropPayloadFormatIndicator
// 18,PropSessionExpiryInterval 24926]}), _cleanSession = True, _keepAlive = 14148, _connID =
// "hRi\ESC\170\202\226\252\ACK\209\SYN\222k\188", _properties = [PropTopicAliasMaximum
// 25143,PropAssignedClientIdentifier
// "\182\214\141\162k(\231?\161I\168\189\220\236\DC4\DLE\131\240!Z\166\183p\a_",PropRetainAvailable
// 207,PropRetainAvailable 84,PropTopicAlias 30203]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x9b, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x66, 0x37, 0x44, 0x26, 0x22, 0x62, 0x37,
                   0x12, 0x0,  0x19, 0xb6, 0xd6, 0x8d, 0xa2, 0x6b, 0x28, 0xe7, 0x3f, 0xa1, 0x49, 0xa8, 0xbd, 0xdc, 0xec,
                   0x14, 0x10, 0x83, 0xf0, 0x21, 0x5a, 0xa6, 0xb7, 0x70, 0x7,  0x5f, 0x25, 0xcf, 0x25, 0x54, 0x23, 0x75,
                   0xfb, 0x0,  0xe,  0x68, 0x52, 0x69, 0x1b, 0xaa, 0xca, 0xe2, 0xfc, 0x6,  0xd1, 0x16, 0xde, 0x6b, 0xbc,
                   0xaa, 0x1,  0x2a, 0xad, 0x25, 0x94, 0x16, 0x0,  0x1b, 0x6c, 0xe1, 0x3,  0x9,  0x32, 0x4,  0x3e, 0xf8,
                   0x7e, 0xeb, 0xe6, 0xbf, 0xa7, 0x6,  0x9,  0xa4, 0xc6, 0x1d, 0x15, 0xf3, 0xa5, 0x80, 0x82, 0x5b, 0x31,
                   0xb5, 0xd2, 0x3,  0x0,  0x9,  0x60, 0x77, 0xa6, 0x58, 0x79, 0xe0, 0xe2, 0xc1, 0x99, 0x12, 0x0,  0x11,
                   0x21, 0x57, 0x96, 0x6f, 0x36, 0x80, 0x89, 0xb7, 0x90, 0x1c, 0x2c, 0x63, 0xe3, 0x90, 0x66, 0xd8, 0x9d,
                   0x18, 0x0,  0x0,  0x5d, 0x70, 0x25, 0xaf, 0x2a, 0x62, 0x1,  0x4e, 0x1a, 0x0,  0xd,  0xf1, 0x5e, 0x6e,
                   0x7d, 0xab, 0x2d, 0xc,  0x76, 0x27, 0x4,  0xcd, 0x5f, 0xb1, 0x15, 0x0,  0x6,  0x97, 0x2c, 0x8e, 0xb1,
                   0x85, 0xd5, 0x13, 0x1f, 0x96, 0x29, 0x79, 0x2,  0x0,  0x0,  0x4a, 0x1d, 0x23, 0x27, 0x6b, 0x2,  0x0,
                   0x0,  0x6,  0x3a, 0x13, 0x4a, 0x34, 0x18, 0x0,  0x0,  0x17, 0x67, 0x3,  0x0,  0x14, 0x3,  0x1,  0x9f,
                   0x57, 0x70, 0xd6, 0xbb, 0xb0, 0xf6, 0xa6, 0xb9, 0xeb, 0x7d, 0x9a, 0x8d, 0x73, 0xb2, 0x47, 0xd0, 0x47,
                   0x19, 0xe,  0x27, 0x0,  0x0,  0x5d, 0xb7, 0x2,  0x0,  0x0,  0x55, 0x44, 0x1,  0x12, 0x11, 0x0,  0x0,
                   0x61, 0x5e, 0x0,  0x1d, 0x59, 0xf2, 0x69, 0xe1, 0x4c, 0x79, 0xa3, 0xb1, 0xc,  0x8a, 0x87, 0x2f, 0x54,
                   0x57, 0xa,  0x13, 0xd9, 0x1e, 0xfb, 0x63, 0xf4, 0x10, 0x73, 0x18, 0xb2, 0x6d, 0x55, 0x3e, 0xe,  0x0,
                   0x1,  0x5a, 0x0,  0xa,  0x8d, 0xc6, 0xb9, 0x82, 0x8c, 0x76, 0x2,  0x87, 0x80, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb6, 0xd6, 0x8d, 0xa2, 0x6b, 0x28, 0xe7, 0x3f, 0xa1, 0x49, 0xa8, 0xbd, 0xdc,
                           0xec, 0x14, 0x10, 0x83, 0xf0, 0x21, 0x5a, 0xa6, 0xb7, 0x70, 0x7,  0x5f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25143}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30203}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x6c, 0xe1, 0x3,  0x9,  0x32, 0x4,  0x3e, 0xf8, 0x7e, 0xeb, 0xe6, 0xbf, 0xa7, 0x6,
                               0x9,  0xa4, 0xc6, 0x1d, 0x15, 0xf3, 0xa5, 0x80, 0x82, 0x5b, 0x31, 0xb5, 0xd2};
  uint8_t byteswillprops1[] = {0x60, 0x77, 0xa6, 0x58, 0x79, 0xe0, 0xe2, 0xc1, 0x99};
  uint8_t byteswillprops2[] = {0x21, 0x57, 0x96, 0x6f, 0x36, 0x80, 0x89, 0xb7, 0x90,
                               0x1c, 0x2c, 0x63, 0xe3, 0x90, 0x66, 0xd8, 0x9d};
  uint8_t byteswillprops3[] = {0xf1, 0x5e, 0x6e, 0x7d, 0xab, 0x2d, 0xc, 0x76, 0x27, 0x4, 0xcd, 0x5f, 0xb1};
  uint8_t byteswillprops4[] = {0x97, 0x2c, 0x8e, 0xb1, 0x85, 0xd5};
  uint8_t byteswillprops5[] = {0x3,  0x1,  0x9f, 0x57, 0x70, 0xd6, 0xbb, 0xb0, 0xf6, 0xa6,
                               0xb9, 0xeb, 0x7d, 0x9a, 0x8d, 0x73, 0xb2, 0x47, 0xd0, 0x47};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23920}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8086}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18973}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10091}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1594}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18996}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5991}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23991}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21828}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24926}},
  };

  lwmqtt_properties_t willprops = {24, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x59, 0xf2, 0x69, 0xe1, 0x4c, 0x79, 0xa3, 0xb1, 0xc,  0x8a, 0x87, 0x2f, 0x54, 0x57, 0xa,
                                0x13, 0xd9, 0x1e, 0xfb, 0x63, 0xf4, 0x10, 0x73, 0x18, 0xb2, 0x6d, 0x55, 0x3e, 0xe};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5a};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14148;
  uint8_t client_id_bytes[] = {0x68, 0x52, 0x69, 0x1b, 0xaa, 0xca, 0xe2, 0xfc, 0x6, 0xd1, 0x16, 0xde, 0x6b, 0xbc};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x8d, 0xc6, 0xb9, 0x82, 0x8c, 0x76, 0x2, 0x87, 0x80, 0x18};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\167\155\251\197h\150N", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "'m\f$\SI\138a\SInjUa;\229\155Z\157\&2", _willMsg =
// "94H\150\255\251\134\159\242\&1H", _willProps = [PropSubscriptionIdentifier 5,PropResponseTopic
// "h\STXD1\243\FS\186\195\&7\200\191\134\187\DC3\157\158^\188\SIQ\151\&9\182_\bN$M",PropMessageExpiryInterval
// 24513,PropTopicAliasMaximum 1955,PropSubscriptionIdentifierAvailable 212,PropServerReference
// "M[\201NC\169\SO\195\194l\138$$\169\167\US\v"]}), _cleanSession = True, _keepAlive = 31273, _connID =
// "\211\132J\179\217\&3\245\247\151\a\182", _properties = [PropRequestProblemInformation 110,PropReceiveMaximum
// 4976,PropServerKeepAlive 27226,PropWildcardSubscriptionAvailable 69,PropSubscriptionIdentifier 6]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x8e, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6e, 0x7a, 0x29, 0xc,  0x17, 0x6e, 0x21,
                   0x13, 0x70, 0x13, 0x6a, 0x5a, 0x28, 0x45, 0xb,  0x6,  0x0,  0xb,  0xd3, 0x84, 0x4a, 0xb3, 0xd9, 0x33,
                   0xf5, 0xf7, 0x97, 0x7,  0xb6, 0x3f, 0xb,  0x5,  0x8,  0x0,  0x1c, 0x68, 0x2,  0x44, 0x31, 0xf3, 0x1c,
                   0xba, 0xc3, 0x37, 0xc8, 0xbf, 0x86, 0xbb, 0x13, 0x9d, 0x9e, 0x5e, 0xbc, 0xf,  0x51, 0x97, 0x39, 0xb6,
                   0x5f, 0x8,  0x4e, 0x24, 0x4d, 0x2,  0x0,  0x0,  0x5f, 0xc1, 0x22, 0x7,  0xa3, 0x29, 0xd4, 0x1c, 0x0,
                   0x11, 0x4d, 0x5b, 0xc9, 0x4e, 0x43, 0xa9, 0xe,  0xc3, 0xc2, 0x6c, 0x8a, 0x24, 0x24, 0xa9, 0xa7, 0x1f,
                   0xb,  0x0,  0x12, 0x27, 0x6d, 0xc,  0x24, 0xf,  0x8a, 0x61, 0xf,  0x6e, 0x6a, 0x55, 0x61, 0x3b, 0xe5,
                   0x9b, 0x5a, 0x9d, 0x32, 0x0,  0xb,  0x39, 0x34, 0x48, 0x96, 0xff, 0xfb, 0x86, 0x9f, 0xf2, 0x31, 0x48,
                   0x0,  0x7,  0xa7, 0x9b, 0xfb, 0xc5, 0x68, 0x96, 0x4e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 110}},    {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4976}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27226}}, {.prop = (lwmqtt_prop_t)40, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x68, 0x2,  0x44, 0x31, 0xf3, 0x1c, 0xba, 0xc3, 0x37, 0xc8, 0xbf, 0x86, 0xbb, 0x13,
                               0x9d, 0x9e, 0x5e, 0xbc, 0xf,  0x51, 0x97, 0x39, 0xb6, 0x5f, 0x8,  0x4e, 0x24, 0x4d};
  uint8_t byteswillprops1[] = {0x4d, 0x5b, 0xc9, 0x4e, 0x43, 0xa9, 0xe,  0xc3, 0xc2,
                               0x6c, 0x8a, 0x24, 0x24, 0xa9, 0xa7, 0x1f, 0xb};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24513}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1955}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops1}}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x27, 0x6d, 0xc,  0x24, 0xf,  0x8a, 0x61, 0xf,  0x6e,
                                0x6a, 0x55, 0x61, 0x3b, 0xe5, 0x9b, 0x5a, 0x9d, 0x32};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x39, 0x34, 0x48, 0x96, 0xff, 0xfb, 0x86, 0x9f, 0xf2, 0x31, 0x48};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 31273;
  uint8_t client_id_bytes[] = {0xd3, 0x84, 0x4a, 0xb3, 0xd9, 0x33, 0xf5, 0xf7, 0x97, 0x7, 0xb6};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa7, 0x9b, 0xfb, 0xc5, 0x68, 0x96, 0x4e};
  lwmqtt_string_t password = {7, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\152", _password = Just
// "\174\152x,\214O\183\249,o\"\137\170m\244\164\203\ACK\186\179\217@ _[\r>", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "A\SUB\166x\NUL", _willMsg = "\253\&0\131n\162\236\192\DEL \150.\SI\174\163",
// _willProps = [PropTopicAliasMaximum 29074,PropResponseInformation
// "\DC1:\215Jj/]\232k\GS\185\209r\148L\ETB\180{\254D\189\248\b\208\227",PropMessageExpiryInterval
// 29782,PropAssignedClientIdentifier "H\DC1\STXQ>9H\GS\129\243\199\238\168\&7a",PropSessionExpiryInterval
// 30959,PropMessageExpiryInterval 28052,PropTopicAlias 24618,PropRequestProblemInformation 237,PropServerReference
// "Pq#\186\195\246\&8*\132\&1\240]\167E\139\236\NAK\253\EM\130\178\SOSF\RS\146\v>e\147",PropMaximumPacketSize
// 15564,PropCorrelationData "\174\232\166+\155\182\172\ACKX\ACK\154\190\206\182",PropTopicAlias 28312,PropTopicAlias
// 21162,PropMaximumPacketSize 29667,PropSharedSubscriptionAvailable 101,PropTopicAlias 5194,PropCorrelationData
// "\153{\152\231A\216\226\146\ACK\247h9C\194\233",PropPayloadFormatIndicator 112,PropAssignedClientIdentifier
// "@\204\136\246\229\209{c\233\n",PropSubscriptionIdentifierAvailable 156]}), _cleanSession = True, _keepAlive = 11096,
// _connID = "\207\r\183\&5c`\208+\186d/\132'X\238\247\DLEO\130\241\201\158\234", _properties = [PropCorrelationData
// "\248\DC1\135`\136\191\f\199\169>\EMt\SUB\CAN\145I\181\216&",PropUserProperty
// "\DC2\v\219\&7K\147\nL\189\219\163\230\166$\ETB\214kc\178r\236s\231"
// "\140A\244\133\155O\224x\US\138\221\153\176\216\132,\SOH\236\129\253\DELb",PropResponseTopic
// "\213\219nQ/\210@y\173\191\178bk\USs\SOH\197",PropUserProperty "\187\232\149z\147\STXw\178\188;\253"
// "\225W^\187\201n&\t!0\131~\218\ACK\173W]\188\188\f\192\143\SOH\NULBs\160}\154",PropSubscriptionIdentifierAvailable
// 80,PropMaximumQoS 214,PropMaximumPacketSize 30233,PropResponseInformation
// "\186N\SOT\202\163\f\144\241f\130\&5\153:",PropMaximumPacketSize 30201,PropUserProperty
// "\ESC\174\231\185y\167\182E\EM\ESC\DC23p\233\181H\DLE\166\216"
// "3\145\253\180\213\174\228P\n\208\181\SI\146\231I",PropTopicAlias 6216,PropSubscriptionIdentifierAvailable
// 68,PropCorrelationData
// "X\172\&5\ESC\224k`P\USX[\219te\183\188\134\224\227\192\SIT\156\243<\152",PropAuthenticationData
// "\164\248\165\169\&4_\146\230~\143GG\ESC\231\a\221\209\202\223\&8\185db\155>\RS\208\161\US",PropRequestProblemInformation
// 252,PropRequestResponseInformation 153,PropServerKeepAlive 26215,PropServerKeepAlive 322,PropResponseInformation
// "Q\NUL&\198\EMn\165\222\239\160\190\130\186\232\170\225/\\\189\DC1",PropSharedSubscriptionAvailable
// 226,PropRequestProblemInformation 166,PropSharedSubscriptionAvailable 58,PropResponseTopic
// "\149\168\171_s\164\&1S\160\208#C|\195\201\194",PropAuthenticationMethod
// "\176\186\181\ACK\250\218\CAN\ETB\DC3\170\148\ETB",PropMaximumPacketSize 25408,PropAuthenticationMethod
// "^\209\215\243\225]\184n\157\174>\226w@<\228\196\GS\145",PropMaximumPacketSize 28989,PropUserProperty
// "\208\141rK\240\232\NAK" "\SOHZn
// \SYN\219\&7uu<\255\179\DC3r&\152p\166\233\154!L\SUB\SOH!Q\157\135/",PropReceiveMaximum 22326,PropAuthenticationMethod
// "u\191\238\160\165\SUB"]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x10, 0xbc, 0x5,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x2b, 0x58, 0xaf, 0x3,  0x9,  0x0,  0x13, 0xf8,
      0x11, 0x87, 0x60, 0x88, 0xbf, 0xc,  0xc7, 0xa9, 0x3e, 0x19, 0x74, 0x1a, 0x18, 0x91, 0x49, 0xb5, 0xd8, 0x26, 0x26,
      0x0,  0x17, 0x12, 0xb,  0xdb, 0x37, 0x4b, 0x93, 0xa,  0x4c, 0xbd, 0xdb, 0xa3, 0xe6, 0xa6, 0x24, 0x17, 0xd6, 0x6b,
      0x63, 0xb2, 0x72, 0xec, 0x73, 0xe7, 0x0,  0x16, 0x8c, 0x41, 0xf4, 0x85, 0x9b, 0x4f, 0xe0, 0x78, 0x1f, 0x8a, 0xdd,
      0x99, 0xb0, 0xd8, 0x84, 0x2c, 0x1,  0xec, 0x81, 0xfd, 0x7f, 0x62, 0x8,  0x0,  0x11, 0xd5, 0xdb, 0x6e, 0x51, 0x2f,
      0xd2, 0x40, 0x79, 0xad, 0xbf, 0xb2, 0x62, 0x6b, 0x1f, 0x73, 0x1,  0xc5, 0x26, 0x0,  0xb,  0xbb, 0xe8, 0x95, 0x7a,
      0x93, 0x2,  0x77, 0xb2, 0xbc, 0x3b, 0xfd, 0x0,  0x1d, 0xe1, 0x57, 0x5e, 0xbb, 0xc9, 0x6e, 0x26, 0x9,  0x21, 0x30,
      0x83, 0x7e, 0xda, 0x6,  0xad, 0x57, 0x5d, 0xbc, 0xbc, 0xc,  0xc0, 0x8f, 0x1,  0x0,  0x42, 0x73, 0xa0, 0x7d, 0x9a,
      0x29, 0x50, 0x24, 0xd6, 0x27, 0x0,  0x0,  0x76, 0x19, 0x1a, 0x0,  0xe,  0xba, 0x4e, 0xe,  0x54, 0xca, 0xa3, 0xc,
      0x90, 0xf1, 0x66, 0x82, 0x35, 0x99, 0x3a, 0x27, 0x0,  0x0,  0x75, 0xf9, 0x26, 0x0,  0x13, 0x1b, 0xae, 0xe7, 0xb9,
      0x79, 0xa7, 0xb6, 0x45, 0x19, 0x1b, 0x12, 0x33, 0x70, 0xe9, 0xb5, 0x48, 0x10, 0xa6, 0xd8, 0x0,  0xf,  0x33, 0x91,
      0xfd, 0xb4, 0xd5, 0xae, 0xe4, 0x50, 0xa,  0xd0, 0xb5, 0xf,  0x92, 0xe7, 0x49, 0x23, 0x18, 0x48, 0x29, 0x44, 0x9,
      0x0,  0x1a, 0x58, 0xac, 0x35, 0x1b, 0xe0, 0x6b, 0x60, 0x50, 0x1f, 0x58, 0x5b, 0xdb, 0x74, 0x65, 0xb7, 0xbc, 0x86,
      0xe0, 0xe3, 0xc0, 0xf,  0x54, 0x9c, 0xf3, 0x3c, 0x98, 0x16, 0x0,  0x1d, 0xa4, 0xf8, 0xa5, 0xa9, 0x34, 0x5f, 0x92,
      0xe6, 0x7e, 0x8f, 0x47, 0x47, 0x1b, 0xe7, 0x7,  0xdd, 0xd1, 0xca, 0xdf, 0x38, 0xb9, 0x64, 0x62, 0x9b, 0x3e, 0x1e,
      0xd0, 0xa1, 0x1f, 0x17, 0xfc, 0x19, 0x99, 0x13, 0x66, 0x67, 0x13, 0x1,  0x42, 0x1a, 0x0,  0x14, 0x51, 0x0,  0x26,
      0xc6, 0x19, 0x6e, 0xa5, 0xde, 0xef, 0xa0, 0xbe, 0x82, 0xba, 0xe8, 0xaa, 0xe1, 0x2f, 0x5c, 0xbd, 0x11, 0x2a, 0xe2,
      0x17, 0xa6, 0x2a, 0x3a, 0x8,  0x0,  0x10, 0x95, 0xa8, 0xab, 0x5f, 0x73, 0xa4, 0x31, 0x53, 0xa0, 0xd0, 0x23, 0x43,
      0x7c, 0xc3, 0xc9, 0xc2, 0x15, 0x0,  0xc,  0xb0, 0xba, 0xb5, 0x6,  0xfa, 0xda, 0x18, 0x17, 0x13, 0xaa, 0x94, 0x17,
      0x27, 0x0,  0x0,  0x63, 0x40, 0x15, 0x0,  0x13, 0x5e, 0xd1, 0xd7, 0xf3, 0xe1, 0x5d, 0xb8, 0x6e, 0x9d, 0xae, 0x3e,
      0xe2, 0x77, 0x40, 0x3c, 0xe4, 0xc4, 0x1d, 0x91, 0x27, 0x0,  0x0,  0x71, 0x3d, 0x26, 0x0,  0x7,  0xd0, 0x8d, 0x72,
      0x4b, 0xf0, 0xe8, 0x15, 0x0,  0x1d, 0x1,  0x5a, 0x6e, 0x20, 0x16, 0xdb, 0x37, 0x75, 0x75, 0x3c, 0xff, 0xb3, 0x13,
      0x72, 0x26, 0x98, 0x70, 0xa6, 0xe9, 0x9a, 0x21, 0x4c, 0x1a, 0x1,  0x21, 0x51, 0x9d, 0x87, 0x2f, 0x21, 0x57, 0x36,
      0x15, 0x0,  0x6,  0x75, 0xbf, 0xee, 0xa0, 0xa5, 0x1a, 0x0,  0x17, 0xcf, 0xd,  0xb7, 0x35, 0x63, 0x60, 0xd0, 0x2b,
      0xba, 0x64, 0x2f, 0x84, 0x27, 0x58, 0xee, 0xf7, 0x10, 0x4f, 0x82, 0xf1, 0xc9, 0x9e, 0xea, 0xaf, 0x1,  0x22, 0x71,
      0x92, 0x1a, 0x0,  0x19, 0x11, 0x3a, 0xd7, 0x4a, 0x6a, 0x2f, 0x5d, 0xe8, 0x6b, 0x1d, 0xb9, 0xd1, 0x72, 0x94, 0x4c,
      0x17, 0xb4, 0x7b, 0xfe, 0x44, 0xbd, 0xf8, 0x8,  0xd0, 0xe3, 0x2,  0x0,  0x0,  0x74, 0x56, 0x12, 0x0,  0xf,  0x48,
      0x11, 0x2,  0x51, 0x3e, 0x39, 0x48, 0x1d, 0x81, 0xf3, 0xc7, 0xee, 0xa8, 0x37, 0x61, 0x11, 0x0,  0x0,  0x78, 0xef,
      0x2,  0x0,  0x0,  0x6d, 0x94, 0x23, 0x60, 0x2a, 0x17, 0xed, 0x1c, 0x0,  0x1e, 0x50, 0x71, 0x23, 0xba, 0xc3, 0xf6,
      0x38, 0x2a, 0x84, 0x31, 0xf0, 0x5d, 0xa7, 0x45, 0x8b, 0xec, 0x15, 0xfd, 0x19, 0x82, 0xb2, 0xe,  0x53, 0x46, 0x1e,
      0x92, 0xb,  0x3e, 0x65, 0x93, 0x27, 0x0,  0x0,  0x3c, 0xcc, 0x9,  0x0,  0xe,  0xae, 0xe8, 0xa6, 0x2b, 0x9b, 0xb6,
      0xac, 0x6,  0x58, 0x6,  0x9a, 0xbe, 0xce, 0xb6, 0x23, 0x6e, 0x98, 0x23, 0x52, 0xaa, 0x27, 0x0,  0x0,  0x73, 0xe3,
      0x2a, 0x65, 0x23, 0x14, 0x4a, 0x9,  0x0,  0xf,  0x99, 0x7b, 0x98, 0xe7, 0x41, 0xd8, 0xe2, 0x92, 0x6,  0xf7, 0x68,
      0x39, 0x43, 0xc2, 0xe9, 0x1,  0x70, 0x12, 0x0,  0xa,  0x40, 0xcc, 0x88, 0xf6, 0xe5, 0xd1, 0x7b, 0x63, 0xe9, 0xa,
      0x29, 0x9c, 0x0,  0x5,  0x41, 0x1a, 0xa6, 0x78, 0x0,  0x0,  0xe,  0xfd, 0x30, 0x83, 0x6e, 0xa2, 0xec, 0xc0, 0x7f,
      0x20, 0x96, 0x2e, 0xf,  0xae, 0xa3, 0x0,  0x1,  0x98, 0x0,  0x1b, 0xae, 0x98, 0x78, 0x2c, 0xd6, 0x4f, 0xb7, 0xf9,
      0x2c, 0x6f, 0x22, 0x89, 0xaa, 0x6d, 0xf4, 0xa4, 0xcb, 0x6,  0xba, 0xb3, 0xd9, 0x40, 0x20, 0x5f, 0x5b, 0xd,  0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf8, 0x11, 0x87, 0x60, 0x88, 0xbf, 0xc,  0xc7, 0xa9, 0x3e,
                           0x19, 0x74, 0x1a, 0x18, 0x91, 0x49, 0xb5, 0xd8, 0x26};
  uint8_t bytesprops2[] = {0x8c, 0x41, 0xf4, 0x85, 0x9b, 0x4f, 0xe0, 0x78, 0x1f, 0x8a, 0xdd,
                           0x99, 0xb0, 0xd8, 0x84, 0x2c, 0x1,  0xec, 0x81, 0xfd, 0x7f, 0x62};
  uint8_t bytesprops1[] = {0x12, 0xb,  0xdb, 0x37, 0x4b, 0x93, 0xa,  0x4c, 0xbd, 0xdb, 0xa3, 0xe6,
                           0xa6, 0x24, 0x17, 0xd6, 0x6b, 0x63, 0xb2, 0x72, 0xec, 0x73, 0xe7};
  uint8_t bytesprops3[] = {0xd5, 0xdb, 0x6e, 0x51, 0x2f, 0xd2, 0x40, 0x79, 0xad,
                           0xbf, 0xb2, 0x62, 0x6b, 0x1f, 0x73, 0x1,  0xc5};
  uint8_t bytesprops5[] = {0xe1, 0x57, 0x5e, 0xbb, 0xc9, 0x6e, 0x26, 0x9, 0x21, 0x30, 0x83, 0x7e, 0xda, 0x6, 0xad,
                           0x57, 0x5d, 0xbc, 0xbc, 0xc,  0xc0, 0x8f, 0x1, 0x0,  0x42, 0x73, 0xa0, 0x7d, 0x9a};
  uint8_t bytesprops4[] = {0xbb, 0xe8, 0x95, 0x7a, 0x93, 0x2, 0x77, 0xb2, 0xbc, 0x3b, 0xfd};
  uint8_t bytesprops6[] = {0xba, 0x4e, 0xe, 0x54, 0xca, 0xa3, 0xc, 0x90, 0xf1, 0x66, 0x82, 0x35, 0x99, 0x3a};
  uint8_t bytesprops8[] = {0x33, 0x91, 0xfd, 0xb4, 0xd5, 0xae, 0xe4, 0x50, 0xa, 0xd0, 0xb5, 0xf, 0x92, 0xe7, 0x49};
  uint8_t bytesprops7[] = {0x1b, 0xae, 0xe7, 0xb9, 0x79, 0xa7, 0xb6, 0x45, 0x19, 0x1b,
                           0x12, 0x33, 0x70, 0xe9, 0xb5, 0x48, 0x10, 0xa6, 0xd8};
  uint8_t bytesprops9[] = {0x58, 0xac, 0x35, 0x1b, 0xe0, 0x6b, 0x60, 0x50, 0x1f, 0x58, 0x5b, 0xdb, 0x74,
                           0x65, 0xb7, 0xbc, 0x86, 0xe0, 0xe3, 0xc0, 0xf,  0x54, 0x9c, 0xf3, 0x3c, 0x98};
  uint8_t bytesprops10[] = {0xa4, 0xf8, 0xa5, 0xa9, 0x34, 0x5f, 0x92, 0xe6, 0x7e, 0x8f, 0x47, 0x47, 0x1b, 0xe7, 0x7,
                            0xdd, 0xd1, 0xca, 0xdf, 0x38, 0xb9, 0x64, 0x62, 0x9b, 0x3e, 0x1e, 0xd0, 0xa1, 0x1f};
  uint8_t bytesprops11[] = {0x51, 0x0,  0x26, 0xc6, 0x19, 0x6e, 0xa5, 0xde, 0xef, 0xa0,
                            0xbe, 0x82, 0xba, 0xe8, 0xaa, 0xe1, 0x2f, 0x5c, 0xbd, 0x11};
  uint8_t bytesprops12[] = {0x95, 0xa8, 0xab, 0x5f, 0x73, 0xa4, 0x31, 0x53,
                            0xa0, 0xd0, 0x23, 0x43, 0x7c, 0xc3, 0xc9, 0xc2};
  uint8_t bytesprops13[] = {0xb0, 0xba, 0xb5, 0x6, 0xfa, 0xda, 0x18, 0x17, 0x13, 0xaa, 0x94, 0x17};
  uint8_t bytesprops14[] = {0x5e, 0xd1, 0xd7, 0xf3, 0xe1, 0x5d, 0xb8, 0x6e, 0x9d, 0xae,
                            0x3e, 0xe2, 0x77, 0x40, 0x3c, 0xe4, 0xc4, 0x1d, 0x91};
  uint8_t bytesprops16[] = {0x1,  0x5a, 0x6e, 0x20, 0x16, 0xdb, 0x37, 0x75, 0x75, 0x3c, 0xff, 0xb3, 0x13, 0x72, 0x26,
                            0x98, 0x70, 0xa6, 0xe9, 0x9a, 0x21, 0x4c, 0x1a, 0x1,  0x21, 0x51, 0x9d, 0x87, 0x2f};
  uint8_t bytesprops15[] = {0xd0, 0x8d, 0x72, 0x4b, 0xf0, 0xe8, 0x15};
  uint8_t bytesprops17[] = {0x75, 0xbf, 0xee, 0xa0, 0xa5, 0x1a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops1}, .v = {22, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops4}, .v = {29, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30233}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30201}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops7}, .v = {15, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6216}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26215}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 322}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25408}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28989}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops15}, .v = {29, (char*)&bytesprops16}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22326}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops17}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x11, 0x3a, 0xd7, 0x4a, 0x6a, 0x2f, 0x5d, 0xe8, 0x6b, 0x1d, 0xb9, 0xd1, 0x72,
                               0x94, 0x4c, 0x17, 0xb4, 0x7b, 0xfe, 0x44, 0xbd, 0xf8, 0x8,  0xd0, 0xe3};
  uint8_t byteswillprops1[] = {0x48, 0x11, 0x2, 0x51, 0x3e, 0x39, 0x48, 0x1d, 0x81, 0xf3, 0xc7, 0xee, 0xa8, 0x37, 0x61};
  uint8_t byteswillprops2[] = {0x50, 0x71, 0x23, 0xba, 0xc3, 0xf6, 0x38, 0x2a, 0x84, 0x31,
                               0xf0, 0x5d, 0xa7, 0x45, 0x8b, 0xec, 0x15, 0xfd, 0x19, 0x82,
                               0xb2, 0xe,  0x53, 0x46, 0x1e, 0x92, 0xb,  0x3e, 0x65, 0x93};
  uint8_t byteswillprops3[] = {0xae, 0xe8, 0xa6, 0x2b, 0x9b, 0xb6, 0xac, 0x6, 0x58, 0x6, 0x9a, 0xbe, 0xce, 0xb6};
  uint8_t byteswillprops4[] = {0x99, 0x7b, 0x98, 0xe7, 0x41, 0xd8, 0xe2, 0x92, 0x6, 0xf7, 0x68, 0x39, 0x43, 0xc2, 0xe9};
  uint8_t byteswillprops5[] = {0x40, 0xcc, 0x88, 0xf6, 0xe5, 0xd1, 0x7b, 0x63, 0xe9, 0xa};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29074}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29782}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30959}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28052}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24618}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15564}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28312}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21162}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29667}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5194}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 156}},
  };

  lwmqtt_properties_t willprops = {20, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x41, 0x1a, 0xa6, 0x78, 0x0};
  lwmqtt_string_t will_topic = {5, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfd, 0x30, 0x83, 0x6e, 0xa2, 0xec, 0xc0, 0x7f, 0x20, 0x96, 0x2e, 0xf, 0xae, 0xa3};
  lwmqtt_string_t will_payload = {14, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11096;
  uint8_t client_id_bytes[] = {0xcf, 0xd,  0xb7, 0x35, 0x63, 0x60, 0xd0, 0x2b, 0xba, 0x64, 0x2f, 0x84,
                               0x27, 0x58, 0xee, 0xf7, 0x10, 0x4f, 0x82, 0xf1, 0xc9, 0x9e, 0xea};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x98};
  lwmqtt_string_t username = {1, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xae, 0x98, 0x78, 0x2c, 0xd6, 0x4f, 0xb7, 0xf9, 0x2c, 0x6f, 0x22, 0x89, 0xaa, 0x6d,
                              0xf4, 0xa4, 0xcb, 0x6,  0xba, 0xb3, 0xd9, 0x40, 0x20, 0x5f, 0x5b, 0xd,  0x3e};
  lwmqtt_string_t password = {27, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\254\216\220\247\151\136\DC1\188~L\248\142", _password = Nothing, _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic =
// "U6Dw\178\166\201q\230\187\STX\187>P\180\&1\224[W\181\GS:", _willMsg = "", _willProps = [PropSubscriptionIdentifier
// 25,PropAuthenticationMethod "E\191\190\250<\151\DC1\DC4\224\176\SIg\150",PropMaximumQoS 137,PropTopicAlias
// 21105,PropReceiveMaximum 18226,PropTopicAliasMaximum 5839,PropAssignedClientIdentifier
// "\242D",PropRequestResponseInformation 6,PropPayloadFormatIndicator 144,PropSessionExpiryInterval 500,PropContentType
// "\135F\188K&\177\206-g\SO\EOT\249\143VE+B\196@P5\EOT\230\a\185\228\EM\130",PropRetainAvailable 6,PropServerReference
// "cA\195\179\&0\173\173\220=%;\f\139\158M",PropReasonString "\247Ir\176\"l\128",PropReasonString
// "\179D\192\169\242fb\b-\192\NAK",PropMaximumPacketSize 10906]}), _cleanSession = False, _keepAlive = 29562, _connID =
// "~\233\223\144\214,\GSg\DLE\144\196=<", _properties = [PropSharedSubscriptionAvailable 138,PropWillDelayInterval
// 12879,PropServerKeepAlive 6550,PropReceiveMaximum 10913,PropUserProperty "\234:\143a_\244\"\244\STX3\240\220y\141"
// "!\FS\166\169\238\145\136)\239\199*\208a\175\225\171\230\238\194\144n\ACK\SOH\174\178",PropMessageExpiryInterval
// 30709,PropSharedSubscriptionAvailable 102,PropAuthenticationMethod
// "b0\181\226\ENQ\130\189uwJ\166/\178\176\SOH=\205\&1\240E\190\164\r8G*B"]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x9c, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8c, 0x73, 0x7a, 0x5e, 0x2a, 0x8a, 0x18,
                   0x0,  0x0,  0x32, 0x4f, 0x13, 0x19, 0x96, 0x21, 0x2a, 0xa1, 0x26, 0x0,  0xe,  0xea, 0x3a, 0x8f, 0x61,
                   0x5f, 0xf4, 0x22, 0xf4, 0x2,  0x33, 0xf0, 0xdc, 0x79, 0x8d, 0x0,  0x19, 0x21, 0x1c, 0xa6, 0xa9, 0xee,
                   0x91, 0x88, 0x29, 0xef, 0xc7, 0x2a, 0xd0, 0x61, 0xaf, 0xe1, 0xab, 0xe6, 0xee, 0xc2, 0x90, 0x6e, 0x6,
                   0x1,  0xae, 0xb2, 0x2,  0x0,  0x0,  0x77, 0xf5, 0x2a, 0x66, 0x15, 0x0,  0x1b, 0x62, 0x30, 0xb5, 0xe2,
                   0x5,  0x82, 0xbd, 0x75, 0x77, 0x4a, 0xa6, 0x2f, 0xb2, 0xb0, 0x1,  0x3d, 0xcd, 0x31, 0xf0, 0x45, 0xbe,
                   0xa4, 0xd,  0x38, 0x47, 0x2a, 0x42, 0x0,  0xd,  0x7e, 0xe9, 0xdf, 0x90, 0xd6, 0x2c, 0x1d, 0x67, 0x10,
                   0x90, 0xc4, 0x3d, 0x3c, 0x7b, 0xb,  0x19, 0x15, 0x0,  0xd,  0x45, 0xbf, 0xbe, 0xfa, 0x3c, 0x97, 0x11,
                   0x14, 0xe0, 0xb0, 0xf,  0x67, 0x96, 0x24, 0x89, 0x23, 0x52, 0x71, 0x21, 0x47, 0x32, 0x22, 0x16, 0xcf,
                   0x12, 0x0,  0x2,  0xf2, 0x44, 0x19, 0x6,  0x1,  0x90, 0x11, 0x0,  0x0,  0x1,  0xf4, 0x3,  0x0,  0x1c,
                   0x87, 0x46, 0xbc, 0x4b, 0x26, 0xb1, 0xce, 0x2d, 0x67, 0xe,  0x4,  0xf9, 0x8f, 0x56, 0x45, 0x2b, 0x42,
                   0xc4, 0x40, 0x50, 0x35, 0x4,  0xe6, 0x7,  0xb9, 0xe4, 0x19, 0x82, 0x25, 0x6,  0x1c, 0x0,  0xf,  0x63,
                   0x41, 0xc3, 0xb3, 0x30, 0xad, 0xad, 0xdc, 0x3d, 0x25, 0x3b, 0xc,  0x8b, 0x9e, 0x4d, 0x1f, 0x0,  0x7,
                   0xf7, 0x49, 0x72, 0xb0, 0x22, 0x6c, 0x80, 0x1f, 0x0,  0xb,  0xb3, 0x44, 0xc0, 0xa9, 0xf2, 0x66, 0x62,
                   0x8,  0x2d, 0xc0, 0x15, 0x27, 0x0,  0x0,  0x2a, 0x9a, 0x0,  0x16, 0x55, 0x36, 0x44, 0x77, 0xb2, 0xa6,
                   0xc9, 0x71, 0xe6, 0xbb, 0x2,  0xbb, 0x3e, 0x50, 0xb4, 0x31, 0xe0, 0x5b, 0x57, 0xb5, 0x1d, 0x3a, 0x0,
                   0x0,  0x0,  0xc,  0xfe, 0xd8, 0xdc, 0xf7, 0x97, 0x88, 0x11, 0xbc, 0x7e, 0x4c, 0xf8, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x21, 0x1c, 0xa6, 0xa9, 0xee, 0x91, 0x88, 0x29, 0xef, 0xc7, 0x2a, 0xd0, 0x61,
                           0xaf, 0xe1, 0xab, 0xe6, 0xee, 0xc2, 0x90, 0x6e, 0x6,  0x1,  0xae, 0xb2};
  uint8_t bytesprops0[] = {0xea, 0x3a, 0x8f, 0x61, 0x5f, 0xf4, 0x22, 0xf4, 0x2, 0x33, 0xf0, 0xdc, 0x79, 0x8d};
  uint8_t bytesprops2[] = {0x62, 0x30, 0xb5, 0xe2, 0x5,  0x82, 0xbd, 0x75, 0x77, 0x4a, 0xa6, 0x2f, 0xb2, 0xb0,
                           0x1,  0x3d, 0xcd, 0x31, 0xf0, 0x45, 0xbe, 0xa4, 0xd,  0x38, 0x47, 0x2a, 0x42};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12879}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6550}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10913}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops0}, .v = {25, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30709}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x45, 0xbf, 0xbe, 0xfa, 0x3c, 0x97, 0x11, 0x14, 0xe0, 0xb0, 0xf, 0x67, 0x96};
  uint8_t byteswillprops1[] = {0xf2, 0x44};
  uint8_t byteswillprops2[] = {0x87, 0x46, 0xbc, 0x4b, 0x26, 0xb1, 0xce, 0x2d, 0x67, 0xe, 0x4,  0xf9, 0x8f, 0x56,
                               0x45, 0x2b, 0x42, 0xc4, 0x40, 0x50, 0x35, 0x4,  0xe6, 0x7, 0xb9, 0xe4, 0x19, 0x82};
  uint8_t byteswillprops3[] = {0x63, 0x41, 0xc3, 0xb3, 0x30, 0xad, 0xad, 0xdc, 0x3d, 0x25, 0x3b, 0xc, 0x8b, 0x9e, 0x4d};
  uint8_t byteswillprops4[] = {0xf7, 0x49, 0x72, 0xb0, 0x22, 0x6c, 0x80};
  uint8_t byteswillprops5[] = {0xb3, 0x44, 0xc0, 0xa9, 0xf2, 0x66, 0x62, 0x8, 0x2d, 0xc0, 0x15};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 25}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21105}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18226}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5839}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 500}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10906}},
  };

  lwmqtt_properties_t willprops = {16, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x55, 0x36, 0x44, 0x77, 0xb2, 0xa6, 0xc9, 0x71, 0xe6, 0xbb, 0x2,
                                0xbb, 0x3e, 0x50, 0xb4, 0x31, 0xe0, 0x5b, 0x57, 0xb5, 0x1d, 0x3a};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0};
  lwmqtt_string_t will_payload = {0, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 29562;
  uint8_t client_id_bytes[] = {0x7e, 0xe9, 0xdf, 0x90, 0xd6, 0x2c, 0x1d, 0x67, 0x10, 0x90, 0xc4, 0x3d, 0x3c};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xfe, 0xd8, 0xdc, 0xf7, 0x97, 0x88, 0x11, 0xbc, 0x7e, 0x4c, 0xf8, 0x8e};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "W\NAK1\208\fP\SYN\143\223", _password = Just
// "-\161\CAN\233\GSA\129\195n,\214\STX\138", _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1,
// _willTopic = "\163", _willMsg = "^\216\194\&8-V`\191\"\215\247\221\210\t\EOT\SOt\209\205\SI\SO", _willProps =
// [PropContentType "\193\248h\151I\195\152\213\179o\200\169\171^M",PropMaximumPacketSize 9787,PropRetainAvailable
// 109,PropMaximumQoS 223,PropAuthenticationMethod
// "\187G\SYN\192>Z\DEL\211\206\248I@\161c7\149\f\162+\202\129\SI\EOT\176}1$\213\210",PropContentType
// "\135\DC2,=:\ACK\224H\176\207\131\142\240\151\208.",PropReasonString
// "\134_\167\DLE\234",PropSubscriptionIdentifierAvailable 104,PropContentType
// "\150\158\135\212g\132\145\246_5\255!\"g*",PropTopicAliasMaximum 597,PropAuthenticationMethod
// "m\218\166/;\223-\DC2Q\255\150\144\152\242\251\132\223\t\156\212\190ej\217W\n\218\134\182",PropMaximumPacketSize
// 28656,PropRequestResponseInformation 219]}), _cleanSession = True, _keepAlive = 7229, _connID =
// "h$3\ESC%\229\134-\RS\205O", _properties = [PropMessageExpiryInterval 23408]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0xe7, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x1c, 0x3d, 0x5,  0x2,  0x0,  0x0,
                   0x5b, 0x70, 0x0,  0xb,  0x68, 0x24, 0x33, 0x1b, 0x25, 0xe5, 0x86, 0x2d, 0x1e, 0xcd, 0x4f, 0x94, 0x1,
                   0x3,  0x0,  0xf,  0xc1, 0xf8, 0x68, 0x97, 0x49, 0xc3, 0x98, 0xd5, 0xb3, 0x6f, 0xc8, 0xa9, 0xab, 0x5e,
                   0x4d, 0x27, 0x0,  0x0,  0x26, 0x3b, 0x25, 0x6d, 0x24, 0xdf, 0x15, 0x0,  0x1d, 0xbb, 0x47, 0x16, 0xc0,
                   0x3e, 0x5a, 0x7f, 0xd3, 0xce, 0xf8, 0x49, 0x40, 0xa1, 0x63, 0x37, 0x95, 0xc,  0xa2, 0x2b, 0xca, 0x81,
                   0xf,  0x4,  0xb0, 0x7d, 0x31, 0x24, 0xd5, 0xd2, 0x3,  0x0,  0x10, 0x87, 0x12, 0x2c, 0x3d, 0x3a, 0x6,
                   0xe0, 0x48, 0xb0, 0xcf, 0x83, 0x8e, 0xf0, 0x97, 0xd0, 0x2e, 0x1f, 0x0,  0x5,  0x86, 0x5f, 0xa7, 0x10,
                   0xea, 0x29, 0x68, 0x3,  0x0,  0xf,  0x96, 0x9e, 0x87, 0xd4, 0x67, 0x84, 0x91, 0xf6, 0x5f, 0x35, 0xff,
                   0x21, 0x22, 0x67, 0x2a, 0x22, 0x2,  0x55, 0x15, 0x0,  0x1d, 0x6d, 0xda, 0xa6, 0x2f, 0x3b, 0xdf, 0x2d,
                   0x12, 0x51, 0xff, 0x96, 0x90, 0x98, 0xf2, 0xfb, 0x84, 0xdf, 0x9,  0x9c, 0xd4, 0xbe, 0x65, 0x6a, 0xd9,
                   0x57, 0xa,  0xda, 0x86, 0xb6, 0x27, 0x0,  0x0,  0x6f, 0xf0, 0x19, 0xdb, 0x0,  0x1,  0xa3, 0x0,  0x15,
                   0x5e, 0xd8, 0xc2, 0x38, 0x2d, 0x56, 0x60, 0xbf, 0x22, 0xd7, 0xf7, 0xdd, 0xd2, 0x9,  0x4,  0xe,  0x74,
                   0xd1, 0xcd, 0xf,  0xe,  0x0,  0x9,  0x57, 0x15, 0x31, 0xd0, 0xc,  0x50, 0x16, 0x8f, 0xdf, 0x0,  0xd,
                   0x2d, 0xa1, 0x18, 0xe9, 0x1d, 0x41, 0x81, 0xc3, 0x6e, 0x2c, 0xd6, 0x2,  0x8a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23408}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc1, 0xf8, 0x68, 0x97, 0x49, 0xc3, 0x98, 0xd5,
                               0xb3, 0x6f, 0xc8, 0xa9, 0xab, 0x5e, 0x4d};
  uint8_t byteswillprops1[] = {0xbb, 0x47, 0x16, 0xc0, 0x3e, 0x5a, 0x7f, 0xd3, 0xce, 0xf8, 0x49, 0x40, 0xa1, 0x63, 0x37,
                               0x95, 0xc,  0xa2, 0x2b, 0xca, 0x81, 0xf,  0x4,  0xb0, 0x7d, 0x31, 0x24, 0xd5, 0xd2};
  uint8_t byteswillprops2[] = {0x87, 0x12, 0x2c, 0x3d, 0x3a, 0x6,  0xe0, 0x48,
                               0xb0, 0xcf, 0x83, 0x8e, 0xf0, 0x97, 0xd0, 0x2e};
  uint8_t byteswillprops3[] = {0x86, 0x5f, 0xa7, 0x10, 0xea};
  uint8_t byteswillprops4[] = {0x96, 0x9e, 0x87, 0xd4, 0x67, 0x84, 0x91, 0xf6,
                               0x5f, 0x35, 0xff, 0x21, 0x22, 0x67, 0x2a};
  uint8_t byteswillprops5[] = {0x6d, 0xda, 0xa6, 0x2f, 0x3b, 0xdf, 0x2d, 0x12, 0x51, 0xff, 0x96, 0x90, 0x98, 0xf2, 0xfb,
                               0x84, 0xdf, 0x9,  0x9c, 0xd4, 0xbe, 0x65, 0x6a, 0xd9, 0x57, 0xa,  0xda, 0x86, 0xb6};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9787}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 597}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28656}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 219}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xa3};
  lwmqtt_string_t will_topic = {1, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x5e, 0xd8, 0xc2, 0x38, 0x2d, 0x56, 0x60, 0xbf, 0x22, 0xd7, 0xf7,
                                  0xdd, 0xd2, 0x9,  0x4,  0xe,  0x74, 0xd1, 0xcd, 0xf,  0xe};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7229;
  uint8_t client_id_bytes[] = {0x68, 0x24, 0x33, 0x1b, 0x25, 0xe5, 0x86, 0x2d, 0x1e, 0xcd, 0x4f};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x57, 0x15, 0x31, 0xd0, 0xc, 0x50, 0x16, 0x8f, 0xdf};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2d, 0xa1, 0x18, 0xe9, 0x1d, 0x41, 0x81, 0xc3, 0x6e, 0x2c, 0xd6, 0x2, 0x8a};
  lwmqtt_string_t password = {13, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "E\158", _password = Nothing, _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS0, _willTopic = "\SUB\167\200rR\DEL\237>\147\&3\t-\134,", _willMsg =
// "\EOT{\DC2S\216=\181\216\SOH\225\153\&6(\205\197\&1\ETX\STX\DEL", _willProps = [PropAssignedClientIdentifier
// "\128\147\216",PropResponseTopic "\223\n\ETX\154",PropAuthenticationMethod "",PropMessageExpiryInterval
// 25357,PropRetainAvailable 106,PropUserProperty "\143\RS=-\160\211kh/\145\222\245Y_P\b"
// "\230v\246\"\\",PropRequestProblemInformation 234,PropResponseTopic ",",PropMaximumPacketSize
// 5551,PropSessionExpiryInterval 17112,PropSharedSubscriptionAvailable 218,PropReceiveMaximum
// 12477,PropSharedSubscriptionAvailable 247]}), _cleanSession = True, _keepAlive = 27479, _connID =
// "\237\&2\143\179g\138\189\190\155l\NUL\242~\ETXJ\222^\147-\STX\140\210\198a\249", _properties = [PropRetainAvailable
// 170,PropRequestProblemInformation 45,PropAssignedClientIdentifier
// "\234\177`\245r\153\235\130\209\227-\190a\208\n\195\141\188\RSD",PropRequestResponseInformation 3]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0xb5, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x86, 0x6b, 0x57, 0x1d, 0x25, 0xaa, 0x17,
                   0x2d, 0x12, 0x0,  0x14, 0xea, 0xb1, 0x60, 0xf5, 0x72, 0x99, 0xeb, 0x82, 0xd1, 0xe3, 0x2d, 0xbe, 0x61,
                   0xd0, 0xa,  0xc3, 0x8d, 0xbc, 0x1e, 0x44, 0x19, 0x3,  0x0,  0x19, 0xed, 0x32, 0x8f, 0xb3, 0x67, 0x8a,
                   0xbd, 0xbe, 0x9b, 0x6c, 0x0,  0xf2, 0x7e, 0x3,  0x4a, 0xde, 0x5e, 0x93, 0x2d, 0x2,  0x8c, 0xd2, 0xc6,
                   0x61, 0xf9, 0x48, 0x12, 0x0,  0x3,  0x80, 0x93, 0xd8, 0x8,  0x0,  0x4,  0xdf, 0xa,  0x3,  0x9a, 0x15,
                   0x0,  0x0,  0x2,  0x0,  0x0,  0x63, 0xd,  0x25, 0x6a, 0x26, 0x0,  0x10, 0x8f, 0x1e, 0x3d, 0x2d, 0xa0,
                   0xd3, 0x6b, 0x68, 0x2f, 0x91, 0xde, 0xf5, 0x59, 0x5f, 0x50, 0x8,  0x0,  0x5,  0xe6, 0x76, 0xf6, 0x22,
                   0x5c, 0x17, 0xea, 0x8,  0x0,  0x1,  0x2c, 0x27, 0x0,  0x0,  0x15, 0xaf, 0x11, 0x0,  0x0,  0x42, 0xd8,
                   0x2a, 0xda, 0x21, 0x30, 0xbd, 0x2a, 0xf7, 0x0,  0xe,  0x1a, 0xa7, 0xc8, 0x72, 0x52, 0x7f, 0xed, 0x3e,
                   0x93, 0x33, 0x9,  0x2d, 0x86, 0x2c, 0x0,  0x13, 0x4,  0x7b, 0x12, 0x53, 0xd8, 0x3d, 0xb5, 0xd8, 0x1,
                   0xe1, 0x99, 0x36, 0x28, 0xcd, 0xc5, 0x31, 0x3,  0x2,  0x7f, 0x0,  0x2,  0x45, 0x9e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xea, 0xb1, 0x60, 0xf5, 0x72, 0x99, 0xeb, 0x82, 0xd1, 0xe3,
                           0x2d, 0xbe, 0x61, 0xd0, 0xa,  0xc3, 0x8d, 0xbc, 0x1e, 0x44};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 3}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x80, 0x93, 0xd8};
  uint8_t byteswillprops1[] = {0xdf, 0xa, 0x3, 0x9a};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops4[] = {0xe6, 0x76, 0xf6, 0x22, 0x5c};
  uint8_t byteswillprops3[] = {0x8f, 0x1e, 0x3d, 0x2d, 0xa0, 0xd3, 0x6b, 0x68,
                               0x2f, 0x91, 0xde, 0xf5, 0x59, 0x5f, 0x50, 0x8};
  uint8_t byteswillprops5[] = {0x2c};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25357}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {16, (char*)&byteswillprops3}, .v = {5, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5551}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17112}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12477}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 247}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x1a, 0xa7, 0xc8, 0x72, 0x52, 0x7f, 0xed, 0x3e, 0x93, 0x33, 0x9, 0x2d, 0x86, 0x2c};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4,  0x7b, 0x12, 0x53, 0xd8, 0x3d, 0xb5, 0xd8, 0x1, 0xe1,
                                  0x99, 0x36, 0x28, 0xcd, 0xc5, 0x31, 0x3,  0x2,  0x7f};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 27479;
  uint8_t client_id_bytes[] = {0xed, 0x32, 0x8f, 0xb3, 0x67, 0x8a, 0xbd, 0xbe, 0x9b, 0x6c, 0x0,  0xf2, 0x7e,
                               0x3,  0x4a, 0xde, 0x5e, 0x93, 0x2d, 0x2,  0x8c, 0xd2, 0xc6, 0x61, 0xf9};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x45, 0x9e};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\201\216\NAK\238\243\185\202\212?\188\224\STX/\198h\162\159z\193", _password = Just
// "\220\192\199\173G\186\161\178", _lastWill = Nothing, _cleanSession = True, _keepAlive = 7221, _connID =
// "\191nx\FSO\157\147i\209\143\DC2\STX\160\SI\215", _properties = [PropServerKeepAlive 1856,PropMaximumQoS
// 140,PropWillDelayInterval 20535,PropRequestProblemInformation 95,PropRequestResponseInformation
// 227,PropTopicAliasMaximum 7849,PropAuthenticationMethod "\GS=\US3\242\255\249\EM\245",PropMaximumPacketSize
// 2330,PropResponseTopic
// "\178-\216<\130\163\141\171\190\198W\173\222\FS\a\251\152\b\RS\CAN\186\189z\DC3E\141",PropSharedSubscriptionAvailable
// 179,PropRequestResponseInformation 51,PropWillDelayInterval 26586,PropSubscriptionIdentifierAvailable 192]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x85, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0x1c, 0x35, 0x4a, 0x13, 0x7,
                   0x40, 0x24, 0x8c, 0x18, 0x0,  0x0,  0x50, 0x37, 0x17, 0x5f, 0x19, 0xe3, 0x22, 0x1e, 0xa9, 0x15,
                   0x0,  0x9,  0x1d, 0x3d, 0x1f, 0x33, 0xf2, 0xff, 0xf9, 0x19, 0xf5, 0x27, 0x0,  0x0,  0x9,  0x1a,
                   0x8,  0x0,  0x1a, 0xb2, 0x2d, 0xd8, 0x3c, 0x82, 0xa3, 0x8d, 0xab, 0xbe, 0xc6, 0x57, 0xad, 0xde,
                   0x1c, 0x7,  0xfb, 0x98, 0x8,  0x1e, 0x18, 0xba, 0xbd, 0x7a, 0x13, 0x45, 0x8d, 0x2a, 0xb3, 0x19,
                   0x33, 0x18, 0x0,  0x0,  0x67, 0xda, 0x29, 0xc0, 0x0,  0xf,  0xbf, 0x6e, 0x78, 0x1c, 0x4f, 0x9d,
                   0x93, 0x69, 0xd1, 0x8f, 0x12, 0x2,  0xa0, 0xf,  0xd7, 0x0,  0x13, 0xc9, 0xd8, 0x15, 0xee, 0xf3,
                   0xb9, 0xca, 0xd4, 0x3f, 0xbc, 0xe0, 0x2,  0x2f, 0xc6, 0x68, 0xa2, 0x9f, 0x7a, 0xc1, 0x0,  0x8,
                   0xdc, 0xc0, 0xc7, 0xad, 0x47, 0xba, 0xa1, 0xb2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1d, 0x3d, 0x1f, 0x33, 0xf2, 0xff, 0xf9, 0x19, 0xf5};
  uint8_t bytesprops1[] = {0xb2, 0x2d, 0xd8, 0x3c, 0x82, 0xa3, 0x8d, 0xab, 0xbe, 0xc6, 0x57, 0xad, 0xde,
                           0x1c, 0x7,  0xfb, 0x98, 0x8,  0x1e, 0x18, 0xba, 0xbd, 0x7a, 0x13, 0x45, 0x8d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1856}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20535}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7849}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2330}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26586}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 192}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 7221;
  uint8_t client_id_bytes[] = {0xbf, 0x6e, 0x78, 0x1c, 0x4f, 0x9d, 0x93, 0x69, 0xd1, 0x8f, 0x12, 0x2, 0xa0, 0xf, 0xd7};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xc9, 0xd8, 0x15, 0xee, 0xf3, 0xb9, 0xca, 0xd4, 0x3f, 0xbc,
                              0xe0, 0x2,  0x2f, 0xc6, 0x68, 0xa2, 0x9f, 0x7a, 0xc1};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdc, 0xc0, 0xc7, 0xad, 0x47, 0xba, 0xa1, 0xb2};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15317 [("\211!\219\245}\191K\196\v\188\"\238\237R\242F\240\177\144\229",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\200c\DC2\DC4\SO",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\ni",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("v\212>\RS\195wS\195p",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\DLE|\233_$",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\249\204\STX\180\161\213{b_\SOHVAT",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\191\217\230\191\SUB\239\135\250\206K\133\131\159)OE\ACK\DC2#\203\133=~",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("B\a\136\184\225Dtd\170\&1\162\128O\189e\160\233\186\135B\248",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x7c, 0x3b, 0xd5, 0x0,  0x14, 0xd3, 0x21, 0xdb, 0xf5, 0x7d, 0xbf, 0x4b, 0xc4, 0xb,  0xbc,
                   0x22, 0xee, 0xed, 0x52, 0xf2, 0x46, 0xf0, 0xb1, 0x90, 0xe5, 0x1,  0x0,  0x5,  0xc8, 0x63, 0x12,
                   0x14, 0xe,  0x1,  0x0,  0x2,  0xa,  0x69, 0x0,  0x0,  0x9,  0x76, 0xd4, 0x3e, 0x1e, 0xc3, 0x77,
                   0x53, 0xc3, 0x70, 0x0,  0x0,  0x5,  0x10, 0x7c, 0xe9, 0x5f, 0x24, 0x2,  0x0,  0xd,  0xf9, 0xcc,
                   0x2,  0xb4, 0xa1, 0xd5, 0x7b, 0x62, 0x5f, 0x1,  0x56, 0x41, 0x54, 0x1,  0x0,  0x17, 0xbf, 0xd9,
                   0xe6, 0xbf, 0x1a, 0xef, 0x87, 0xfa, 0xce, 0x4b, 0x85, 0x83, 0x9f, 0x29, 0x4f, 0x45, 0x6,  0x12,
                   0x23, 0xcb, 0x85, 0x3d, 0x7e, 0x2,  0x0,  0x15, 0x42, 0x7,  0x88, 0xb8, 0xe1, 0x44, 0x74, 0x64,
                   0xaa, 0x31, 0xa2, 0x80, 0x4f, 0xbd, 0x65, 0xa0, 0xe9, 0xba, 0x87, 0x42, 0xf8, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xd3, 0x21, 0xdb, 0xf5, 0x7d, 0xbf, 0x4b, 0xc4, 0xb,  0xbc,
                                     0x22, 0xee, 0xed, 0x52, 0xf2, 0x46, 0xf0, 0xb1, 0x90, 0xe5};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc8, 0x63, 0x12, 0x14, 0xe};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa, 0x69};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x76, 0xd4, 0x3e, 0x1e, 0xc3, 0x77, 0x53, 0xc3, 0x70};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x10, 0x7c, 0xe9, 0x5f, 0x24};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf9, 0xcc, 0x2, 0xb4, 0xa1, 0xd5, 0x7b, 0x62, 0x5f, 0x1, 0x56, 0x41, 0x54};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbf, 0xd9, 0xe6, 0xbf, 0x1a, 0xef, 0x87, 0xfa, 0xce, 0x4b, 0x85, 0x83,
                                     0x9f, 0x29, 0x4f, 0x45, 0x6,  0x12, 0x23, 0xcb, 0x85, 0x3d, 0x7e};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x42, 0x7,  0x88, 0xb8, 0xe1, 0x44, 0x74, 0x64, 0xaa, 0x31, 0xa2,
                                     0x80, 0x4f, 0xbd, 0x65, 0xa0, 0xe9, 0xba, 0x87, 0x42, 0xf8};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15317, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2981 [("p\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("^w\186",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2}),("Q\CANiG\n\136\149\SOH\aL\225\243%\139\253W\156FD)\188r5\236s\179^\166",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\144\145\182\194\&1'\245",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x36, 0xb,  0xa5, 0x0,  0x2,  0x70, 0xc5, 0x1,  0x0,  0x3,  0x5e, 0x77, 0xba,
                   0x2,  0x0,  0x1c, 0x51, 0x18, 0x69, 0x47, 0xa,  0x88, 0x95, 0x1,  0x7,  0x4c, 0xe1,
                   0xf3, 0x25, 0x8b, 0xfd, 0x57, 0x9c, 0x46, 0x44, 0x29, 0xbc, 0x72, 0x35, 0xec, 0x73,
                   0xb3, 0x5e, 0xa6, 0x1,  0x0,  0x7,  0x90, 0x91, 0xb6, 0xc2, 0x31, 0x27, 0xf5, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x70, 0xc5};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5e, 0x77, 0xba};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x51, 0x18, 0x69, 0x47, 0xa,  0x88, 0x95, 0x1,  0x7,  0x4c,
                                     0xe1, 0xf3, 0x25, 0x8b, 0xfd, 0x57, 0x9c, 0x46, 0x44, 0x29,
                                     0xbc, 0x72, 0x35, 0xec, 0x73, 0xb3, 0x5e, 0xa6};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x90, 0x91, 0xb6, 0xc2, 0x31, 0x27, 0xf5};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2981, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15094 [("\210\248\243\&0\128\183m\131\255\nK\158\GS\237\168\184^\196\151
// \163i\204\242\EM/\208",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("\195=\233\&0\253\&5Li\207\224\152Y@mA[\139<\135y;\188",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x39, 0x3a, 0xf6, 0x0,  0x1b, 0xd2, 0xf8, 0xf3, 0x30, 0x80, 0xb7, 0x6d, 0x83, 0xff,
                   0xa,  0x4b, 0x9e, 0x1d, 0xed, 0xa8, 0xb8, 0x5e, 0xc4, 0x97, 0x20, 0xa3, 0x69, 0xcc, 0xf2,
                   0x19, 0x2f, 0xd0, 0x2,  0x0,  0x16, 0xc3, 0x3d, 0xe9, 0x30, 0xfd, 0x35, 0x4c, 0x69, 0xcf,
                   0xe0, 0x98, 0x59, 0x40, 0x6d, 0x41, 0x5b, 0x8b, 0x3c, 0x87, 0x79, 0x3b, 0xbc, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xd2, 0xf8, 0xf3, 0x30, 0x80, 0xb7, 0x6d, 0x83, 0xff, 0xa,  0x4b, 0x9e, 0x1d, 0xed,
                                     0xa8, 0xb8, 0x5e, 0xc4, 0x97, 0x20, 0xa3, 0x69, 0xcc, 0xf2, 0x19, 0x2f, 0xd0};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc3, 0x3d, 0xe9, 0x30, 0xfd, 0x35, 0x4c, 0x69, 0xcf, 0xe0, 0x98,
                                     0x59, 0x40, 0x6d, 0x41, 0x5b, 0x8b, 0x3c, 0x87, 0x79, 0x3b, 0xbc};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15094, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31975 [("v\DC3\131\242\151\153\129\216\200a\205\NAK\v\195!\164#\222\225\ESC<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("a\238tQ\162\133\229\228\DC3<\233\243=Bx`\165\DLE\146J\255",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("*i\190\134\153\235\221\NUL\181\244\166\143\v\164o2",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("{\242\196\145X\GS
// \170E\155\&3m\235\143B\220h-",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\240\182WL\223\230\175\ETX\195gN\NAK\STXM\DC4\SYN\240k\a\229\195\151\248\199",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\144\195e\r\DC2\190\186\229\NUL\DEL\167\202\DC4\190\184X\bB\189\217\236\174<\253\&2\144\US\SYNq",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\136\&9\f\v\189\145\182%\141\241\CAN\176>-\209|;",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\191u\SYN\194\143\199\229#\182\174\STX\150\132\152\142\DC3\US{\221}\245\208\241\211B\155\&8",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("63\167",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS
// = QoS0})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xcd, 0x1,  0x7c, 0xe7, 0x0,  0x15, 0x76, 0x13, 0x83, 0xf2, 0x97, 0x99, 0x81, 0xd8, 0xc8, 0x61, 0xcd, 0x15,
      0xb,  0xc3, 0x21, 0xa4, 0x23, 0xde, 0xe1, 0x1b, 0x3c, 0x1,  0x0,  0x15, 0x61, 0xee, 0x74, 0x51, 0xa2, 0x85, 0xe5,
      0xe4, 0x13, 0x3c, 0xe9, 0xf3, 0x3d, 0x42, 0x78, 0x60, 0xa5, 0x10, 0x92, 0x4a, 0xff, 0x1,  0x0,  0x10, 0x2a, 0x69,
      0xbe, 0x86, 0x99, 0xeb, 0xdd, 0x0,  0xb5, 0xf4, 0xa6, 0x8f, 0xb,  0xa4, 0x6f, 0x32, 0x1,  0x0,  0x12, 0x7b, 0xf2,
      0xc4, 0x91, 0x58, 0x1d, 0x20, 0xaa, 0x45, 0x9b, 0x33, 0x6d, 0xeb, 0x8f, 0x42, 0xdc, 0x68, 0x2d, 0x0,  0x0,  0x18,
      0xf0, 0xb6, 0x57, 0x4c, 0xdf, 0xe6, 0xaf, 0x3,  0xc3, 0x67, 0x4e, 0x15, 0x2,  0x4d, 0x14, 0x16, 0xf0, 0x6b, 0x7,
      0xe5, 0xc3, 0x97, 0xf8, 0xc7, 0x1,  0x0,  0x1d, 0x90, 0xc3, 0x65, 0xd,  0x12, 0xbe, 0xba, 0xe5, 0x0,  0x7f, 0xa7,
      0xca, 0x14, 0xbe, 0xb8, 0x58, 0x8,  0x42, 0xbd, 0xd9, 0xec, 0xae, 0x3c, 0xfd, 0x32, 0x90, 0x1f, 0x16, 0x71, 0x1,
      0x0,  0x11, 0x88, 0x39, 0xc,  0xb,  0xbd, 0x91, 0xb6, 0x25, 0x8d, 0xf1, 0x18, 0xb0, 0x3e, 0x2d, 0xd1, 0x7c, 0x3b,
      0x1,  0x0,  0x1b, 0xbf, 0x75, 0x16, 0xc2, 0x8f, 0xc7, 0xe5, 0x23, 0xb6, 0xae, 0x2,  0x96, 0x84, 0x98, 0x8e, 0x13,
      0x1f, 0x7b, 0xdd, 0x7d, 0xf5, 0xd0, 0xf1, 0xd3, 0x42, 0x9b, 0x38, 0x1,  0x0,  0x3,  0x36, 0x33, 0xa7, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x76, 0x13, 0x83, 0xf2, 0x97, 0x99, 0x81, 0xd8, 0xc8, 0x61, 0xcd,
                                     0x15, 0xb,  0xc3, 0x21, 0xa4, 0x23, 0xde, 0xe1, 0x1b, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x61, 0xee, 0x74, 0x51, 0xa2, 0x85, 0xe5, 0xe4, 0x13, 0x3c, 0xe9,
                                     0xf3, 0x3d, 0x42, 0x78, 0x60, 0xa5, 0x10, 0x92, 0x4a, 0xff};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2a, 0x69, 0xbe, 0x86, 0x99, 0xeb, 0xdd, 0x0,
                                     0xb5, 0xf4, 0xa6, 0x8f, 0xb,  0xa4, 0x6f, 0x32};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x7b, 0xf2, 0xc4, 0x91, 0x58, 0x1d, 0x20, 0xaa, 0x45,
                                     0x9b, 0x33, 0x6d, 0xeb, 0x8f, 0x42, 0xdc, 0x68, 0x2d};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf0, 0xb6, 0x57, 0x4c, 0xdf, 0xe6, 0xaf, 0x3,  0xc3, 0x67, 0x4e, 0x15,
                                     0x2,  0x4d, 0x14, 0x16, 0xf0, 0x6b, 0x7,  0xe5, 0xc3, 0x97, 0xf8, 0xc7};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x90, 0xc3, 0x65, 0xd,  0x12, 0xbe, 0xba, 0xe5, 0x0,  0x7f,
                                     0xa7, 0xca, 0x14, 0xbe, 0xb8, 0x58, 0x8,  0x42, 0xbd, 0xd9,
                                     0xec, 0xae, 0x3c, 0xfd, 0x32, 0x90, 0x1f, 0x16, 0x71};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x88, 0x39, 0xc,  0xb,  0xbd, 0x91, 0xb6, 0x25, 0x8d,
                                     0xf1, 0x18, 0xb0, 0x3e, 0x2d, 0xd1, 0x7c, 0x3b};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbf, 0x75, 0x16, 0xc2, 0x8f, 0xc7, 0xe5, 0x23, 0xb6, 0xae, 0x2,  0x96, 0x84, 0x98,
                                     0x8e, 0x13, 0x1f, 0x7b, 0xdd, 0x7d, 0xf5, 0xd0, 0xf1, 0xd3, 0x42, 0x9b, 0x38};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x36, 0x33, 0xa7};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 31975, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25478 [("\219SY?\CAN\SOHQE\164",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\183\ENQ\209\132\194\DELz\220\v\150\RSf\145?a\170\217x\159\172",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("v\193\162\ETX\200\RSE\250\235",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x31, 0x63, 0x86, 0x0,  0x9,  0xdb, 0x53, 0x59, 0x3f, 0x18, 0x1,  0x51, 0x45, 0xa4, 0x0,  0x0,
                   0x14, 0xb7, 0x5,  0xd1, 0x84, 0xc2, 0x7f, 0x7a, 0xdc, 0xb,  0x96, 0x1e, 0x66, 0x91, 0x3f, 0x61, 0xaa,
                   0xd9, 0x78, 0x9f, 0xac, 0x2,  0x0,  0x9,  0x76, 0xc1, 0xa2, 0x3,  0xc8, 0x1e, 0x45, 0xfa, 0xeb, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xdb, 0x53, 0x59, 0x3f, 0x18, 0x1, 0x51, 0x45, 0xa4};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb7, 0x5,  0xd1, 0x84, 0xc2, 0x7f, 0x7a, 0xdc, 0xb,  0x96,
                                     0x1e, 0x66, 0x91, 0x3f, 0x61, 0xaa, 0xd9, 0x78, 0x9f, 0xac};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x76, 0xc1, 0xa2, 0x3, 0xc8, 0x1e, 0x45, 0xfa, 0xeb};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25478, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10292
// [("\216C\ACK\176Ru\154\153\169y\232\US\188\236\130\166\245\218\&8\219\141\156\&2\174\210\231\171\f",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("F\251\229\161W\204c\GS\232y\155\133\149\FS\RS\168!Ni!\230\225\223\"*",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("z\255\209",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x43, 0x28, 0x34, 0x0,  0x1c, 0xd8, 0x43, 0x6,  0xb0, 0x52, 0x75, 0x9a, 0x99,
                   0xa9, 0x79, 0xe8, 0x1f, 0xbc, 0xec, 0x82, 0xa6, 0xf5, 0xda, 0x38, 0xdb, 0x8d, 0x9c,
                   0x32, 0xae, 0xd2, 0xe7, 0xab, 0xc,  0x2,  0x0,  0x19, 0x46, 0xfb, 0xe5, 0xa1, 0x57,
                   0xcc, 0x63, 0x1d, 0xe8, 0x79, 0x9b, 0x85, 0x95, 0x1c, 0x1e, 0xa8, 0x21, 0x4e, 0x69,
                   0x21, 0xe6, 0xe1, 0xdf, 0x22, 0x2a, 0x1,  0x0,  0x3,  0x7a, 0xff, 0xd1, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xd8, 0x43, 0x6,  0xb0, 0x52, 0x75, 0x9a, 0x99, 0xa9, 0x79, 0xe8, 0x1f, 0xbc, 0xec,
                                     0x82, 0xa6, 0xf5, 0xda, 0x38, 0xdb, 0x8d, 0x9c, 0x32, 0xae, 0xd2, 0xe7, 0xab, 0xc};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x46, 0xfb, 0xe5, 0xa1, 0x57, 0xcc, 0x63, 0x1d, 0xe8, 0x79, 0x9b, 0x85, 0x95,
                                     0x1c, 0x1e, 0xa8, 0x21, 0x4e, 0x69, 0x21, 0xe6, 0xe1, 0xdf, 0x22, 0x2a};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7a, 0xff, 0xd1};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10292, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28082
// [("\140\149\246\194\167\STX\161y\249\132\156~\130\254\201\SOH\t]\158a%Ix(\237v\155\239",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\239\191\NAKC\239\fO\ENQ\137\212*j\228\209\255\241\218\177\130",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\249]\224\SUBw\152l\185\139\aYg\DC1\SOHS\133\172",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("9\191\NAK(\225n\196\ETBp\206\175",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\131\SOHT\174\251+&V\131\139\217F\DC1\151\228j\247b\229",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\138\148\167\139=\204k2\161\181/\146\&0\141]\181\151\NUL\r\188\"\v\132\&1",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\202}\DLEqP\f\228\&3\199\161dJk\216\142XIapF0\134_\205\197\141\244\222\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\137ya\140\155\\\DEL\204\FS\216\244Xt\190\NULg\242\174\151\160\243",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\"\DC4#\179\&1\GS#B\162\161\244\172c\DC4&\225",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\193^\197\214\CAN\240\155v(\145\239\174\201\134\236\232l\177\163",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0xeb, 0x1,  0x6d, 0xb2, 0x0,  0x1c, 0x8c, 0x95, 0xf6, 0xc2, 0xa7, 0x2,  0xa1, 0x79, 0xf9, 0x84,
                   0x9c, 0x7e, 0x82, 0xfe, 0xc9, 0x1,  0x9,  0x5d, 0x9e, 0x61, 0x25, 0x49, 0x78, 0x28, 0xed, 0x76, 0x9b,
                   0xef, 0x1,  0x0,  0x13, 0xef, 0xbf, 0x15, 0x43, 0xef, 0xc,  0x4f, 0x5,  0x89, 0xd4, 0x2a, 0x6a, 0xe4,
                   0xd1, 0xff, 0xf1, 0xda, 0xb1, 0x82, 0x1,  0x0,  0x11, 0xf9, 0x5d, 0xe0, 0x1a, 0x77, 0x98, 0x6c, 0xb9,
                   0x8b, 0x7,  0x59, 0x67, 0x11, 0x1,  0x53, 0x85, 0xac, 0x0,  0x0,  0xb,  0x39, 0xbf, 0x15, 0x28, 0xe1,
                   0x6e, 0xc4, 0x17, 0x70, 0xce, 0xaf, 0x1,  0x0,  0x13, 0x83, 0x1,  0x54, 0xae, 0xfb, 0x2b, 0x26, 0x56,
                   0x83, 0x8b, 0xd9, 0x46, 0x11, 0x97, 0xe4, 0x6a, 0xf7, 0x62, 0xe5, 0x0,  0x0,  0x18, 0x8a, 0x94, 0xa7,
                   0x8b, 0x3d, 0xcc, 0x6b, 0x32, 0xa1, 0xb5, 0x2f, 0x92, 0x30, 0x8d, 0x5d, 0xb5, 0x97, 0x0,  0xd,  0xbc,
                   0x22, 0xb,  0x84, 0x31, 0x1,  0x0,  0x1d, 0xca, 0x7d, 0x10, 0x71, 0x50, 0xc,  0xe4, 0x33, 0xc7, 0xa1,
                   0x64, 0x4a, 0x6b, 0xd8, 0x8e, 0x58, 0x49, 0x61, 0x70, 0x46, 0x30, 0x86, 0x5f, 0xcd, 0xc5, 0x8d, 0xf4,
                   0xde, 0x87, 0x0,  0x0,  0x15, 0x89, 0x79, 0x61, 0x8c, 0x9b, 0x5c, 0x7f, 0xcc, 0x1c, 0xd8, 0xf4, 0x58,
                   0x74, 0xbe, 0x0,  0x67, 0xf2, 0xae, 0x97, 0xa0, 0xf3, 0x2,  0x0,  0x10, 0x22, 0x14, 0x23, 0xb3, 0x31,
                   0x1d, 0x23, 0x42, 0xa2, 0xa1, 0xf4, 0xac, 0x63, 0x14, 0x26, 0xe1, 0x2,  0x0,  0x13, 0xc1, 0x5e, 0xc5,
                   0xd6, 0x18, 0xf0, 0x9b, 0x76, 0x28, 0x91, 0xef, 0xae, 0xc9, 0x86, 0xec, 0xe8, 0x6c, 0xb1, 0xa3, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x8c, 0x95, 0xf6, 0xc2, 0xa7, 0x2,  0xa1, 0x79, 0xf9, 0x84,
                                     0x9c, 0x7e, 0x82, 0xfe, 0xc9, 0x1,  0x9,  0x5d, 0x9e, 0x61,
                                     0x25, 0x49, 0x78, 0x28, 0xed, 0x76, 0x9b, 0xef};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xef, 0xbf, 0x15, 0x43, 0xef, 0xc,  0x4f, 0x5,  0x89, 0xd4,
                                     0x2a, 0x6a, 0xe4, 0xd1, 0xff, 0xf1, 0xda, 0xb1, 0x82};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf9, 0x5d, 0xe0, 0x1a, 0x77, 0x98, 0x6c, 0xb9, 0x8b,
                                     0x7,  0x59, 0x67, 0x11, 0x1,  0x53, 0x85, 0xac};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x39, 0xbf, 0x15, 0x28, 0xe1, 0x6e, 0xc4, 0x17, 0x70, 0xce, 0xaf};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x83, 0x1,  0x54, 0xae, 0xfb, 0x2b, 0x26, 0x56, 0x83, 0x8b,
                                     0xd9, 0x46, 0x11, 0x97, 0xe4, 0x6a, 0xf7, 0x62, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8a, 0x94, 0xa7, 0x8b, 0x3d, 0xcc, 0x6b, 0x32, 0xa1, 0xb5, 0x2f, 0x92,
                                     0x30, 0x8d, 0x5d, 0xb5, 0x97, 0x0,  0xd,  0xbc, 0x22, 0xb,  0x84, 0x31};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xca, 0x7d, 0x10, 0x71, 0x50, 0xc,  0xe4, 0x33, 0xc7, 0xa1,
                                     0x64, 0x4a, 0x6b, 0xd8, 0x8e, 0x58, 0x49, 0x61, 0x70, 0x46,
                                     0x30, 0x86, 0x5f, 0xcd, 0xc5, 0x8d, 0xf4, 0xde, 0x87};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x89, 0x79, 0x61, 0x8c, 0x9b, 0x5c, 0x7f, 0xcc, 0x1c, 0xd8, 0xf4,
                                     0x58, 0x74, 0xbe, 0x0,  0x67, 0xf2, 0xae, 0x97, 0xa0, 0xf3};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x22, 0x14, 0x23, 0xb3, 0x31, 0x1d, 0x23, 0x42,
                                     0xa2, 0xa1, 0xf4, 0xac, 0x63, 0x14, 0x26, 0xe1};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xc1, 0x5e, 0xc5, 0xd6, 0x18, 0xf0, 0x9b, 0x76, 0x28, 0x91,
                                     0xef, 0xae, 0xc9, 0x86, 0xec, 0xe8, 0x6c, 0xb1, 0xa3};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28082, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8250 [("\237(\254^Q",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("=\197G\215j^\203%xY\252S\159\251\180\234\169\174\246\185\251",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\223H\213n$\254\160\161A\252\180\193Z\219\143",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("=\193w\237l:\149\177\EOT\a\200",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\217k\215\DC3\211\248\152\216\156\139\ETBo\175\246\239\183\DC3&\SYN1G\139\196n\164",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x5e, 0x20, 0x3a, 0x0,  0x5,  0xed, 0x28, 0xfe, 0x5e, 0x51, 0x1,  0x0,  0x15, 0x3d, 0xc5,
                   0x47, 0xd7, 0x6a, 0x5e, 0xcb, 0x25, 0x78, 0x59, 0xfc, 0x53, 0x9f, 0xfb, 0xb4, 0xea, 0xa9, 0xae,
                   0xf6, 0xb9, 0xfb, 0x2,  0x0,  0xf,  0xdf, 0x48, 0xd5, 0x6e, 0x24, 0xfe, 0xa0, 0xa1, 0x41, 0xfc,
                   0xb4, 0xc1, 0x5a, 0xdb, 0x8f, 0x1,  0x0,  0xb,  0x3d, 0xc1, 0x77, 0xed, 0x6c, 0x3a, 0x95, 0xb1,
                   0x4,  0x7,  0xc8, 0x0,  0x0,  0x19, 0xd9, 0x6b, 0xd7, 0x13, 0xd3, 0xf8, 0x98, 0xd8, 0x9c, 0x8b,
                   0x17, 0x6f, 0xaf, 0xf6, 0xef, 0xb7, 0x13, 0x26, 0x16, 0x31, 0x47, 0x8b, 0xc4, 0x6e, 0xa4, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x28, 0xfe, 0x5e, 0x51};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3d, 0xc5, 0x47, 0xd7, 0x6a, 0x5e, 0xcb, 0x25, 0x78, 0x59, 0xfc,
                                     0x53, 0x9f, 0xfb, 0xb4, 0xea, 0xa9, 0xae, 0xf6, 0xb9, 0xfb};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdf, 0x48, 0xd5, 0x6e, 0x24, 0xfe, 0xa0, 0xa1,
                                     0x41, 0xfc, 0xb4, 0xc1, 0x5a, 0xdb, 0x8f};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3d, 0xc1, 0x77, 0xed, 0x6c, 0x3a, 0x95, 0xb1, 0x4, 0x7, 0xc8};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd9, 0x6b, 0xd7, 0x13, 0xd3, 0xf8, 0x98, 0xd8, 0x9c, 0x8b, 0x17, 0x6f, 0xaf,
                                     0xf6, 0xef, 0xb7, 0x13, 0x26, 0x16, 0x31, 0x47, 0x8b, 0xc4, 0x6e, 0xa4};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8250, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2359 [("\EM\174:\184\155\&9\131\194\148",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0xe, 0x9, 0x37, 0x0, 0x9, 0x19, 0xae, 0x3a, 0xb8, 0x9b, 0x39, 0x83, 0xc2, 0x94, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x19, 0xae, 0x3a, 0xb8, 0x9b, 0x39, 0x83, 0xc2, 0x94};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2359, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16794 [("K\236r=\152\194\134Z}\181\&3:\143\143u\164\DC1\208\150\146\248\ETB",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\RS\SUB\bJ\131u",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\195J\198\164\135",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\188\161\156\135\DEL\148\RS\249@\DC3\187",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\216mP\206\&1\135\r\155\237\&0\DC4R\175$\254h\NAKN\f",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x53, 0x41, 0x9a, 0x0,  0x16, 0x4b, 0xec, 0x72, 0x3d, 0x98, 0xc2, 0x86, 0x5a, 0x7d, 0xb5, 0x33,
                   0x3a, 0x8f, 0x8f, 0x75, 0xa4, 0x11, 0xd0, 0x96, 0x92, 0xf8, 0x17, 0x1,  0x0,  0x6,  0x1e, 0x1a, 0x8,
                   0x4a, 0x83, 0x75, 0x1,  0x0,  0x0,  0x0,  0x0,  0x5,  0xc3, 0x4a, 0xc6, 0xa4, 0x87, 0x0,  0x0,  0xb,
                   0xbc, 0xa1, 0x9c, 0x87, 0x7f, 0x94, 0x1e, 0xf9, 0x40, 0x13, 0xbb, 0x0,  0x0,  0x13, 0xd8, 0x6d, 0x50,
                   0xce, 0x31, 0x87, 0xd,  0x9b, 0xed, 0x30, 0x14, 0x52, 0xaf, 0x24, 0xfe, 0x68, 0x15, 0x4e, 0xc,  0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x4b, 0xec, 0x72, 0x3d, 0x98, 0xc2, 0x86, 0x5a, 0x7d, 0xb5, 0x33,
                                     0x3a, 0x8f, 0x8f, 0x75, 0xa4, 0x11, 0xd0, 0x96, 0x92, 0xf8, 0x17};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0x1a, 0x8, 0x4a, 0x83, 0x75};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc3, 0x4a, 0xc6, 0xa4, 0x87};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbc, 0xa1, 0x9c, 0x87, 0x7f, 0x94, 0x1e, 0xf9, 0x40, 0x13, 0xbb};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd8, 0x6d, 0x50, 0xce, 0x31, 0x87, 0xd,  0x9b, 0xed, 0x30,
                                     0x14, 0x52, 0xaf, 0x24, 0xfe, 0x68, 0x15, 0x4e, 0xc};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 16794, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9525 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("Y",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("yTU\212\STX\n0g\ETB\216;\193\141^of\176\131l\247\243\175\226W!\218\226\143&Y",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\129",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\158\142\237\223\DEL\238TE#\174\&4\RS\247x\152d\195\167u\246\255\201\167\162=\206-",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\169\195$\148J\198r\134D\151\160\STX%j\191\201\209\170\156t\r\244k\183\198",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\DC4&y\247\168\&1W\NUL\245\&6\237\210\150i",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("cQ_y\200\249",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\STX\217 \170>\EM",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\STX\135*",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("]\141\210\RS\186\238\n\ESC\GSj\131\174\190;\136\207Ofzf'",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0xa9, 0x1,  0x25, 0x35, 0x0,  0x0,  0x1,  0x0,  0x1,  0x59, 0x0,  0x0,  0x1e, 0x79, 0x54,
                   0x55, 0xd4, 0x2,  0xa,  0x30, 0x67, 0x17, 0xd8, 0x3b, 0xc1, 0x8d, 0x5e, 0x6f, 0x66, 0xb0, 0x83,
                   0x6c, 0xf7, 0xf3, 0xaf, 0xe2, 0x57, 0x21, 0xda, 0xe2, 0x8f, 0x26, 0x59, 0x0,  0x0,  0x1,  0x81,
                   0x2,  0x0,  0x1b, 0x9e, 0x8e, 0xed, 0xdf, 0x7f, 0xee, 0x54, 0x45, 0x23, 0xae, 0x34, 0x1e, 0xf7,
                   0x78, 0x98, 0x64, 0xc3, 0xa7, 0x75, 0xf6, 0xff, 0xc9, 0xa7, 0xa2, 0x3d, 0xce, 0x2d, 0x0,  0x0,
                   0x19, 0xa9, 0xc3, 0x24, 0x94, 0x4a, 0xc6, 0x72, 0x86, 0x44, 0x97, 0xa0, 0x2,  0x25, 0x6a, 0xbf,
                   0xc9, 0xd1, 0xaa, 0x9c, 0x74, 0xd,  0xf4, 0x6b, 0xb7, 0xc6, 0x1,  0x0,  0xe,  0x14, 0x26, 0x79,
                   0xf7, 0xa8, 0x31, 0x57, 0x0,  0xf5, 0x36, 0xed, 0xd2, 0x96, 0x69, 0x2,  0x0,  0x6,  0x63, 0x51,
                   0x5f, 0x79, 0xc8, 0xf9, 0x1,  0x0,  0x6,  0x2,  0xd9, 0x20, 0xaa, 0x3e, 0x19, 0x1,  0x0,  0x3,
                   0x2,  0x87, 0x2a, 0x0,  0x0,  0x15, 0x5d, 0x8d, 0xd2, 0x1e, 0xba, 0xee, 0xa,  0x1b, 0x1d, 0x6a,
                   0x83, 0xae, 0xbe, 0x3b, 0x88, 0xcf, 0x4f, 0x66, 0x7a, 0x66, 0x27, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x59};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x79, 0x54, 0x55, 0xd4, 0x2,  0xa,  0x30, 0x67, 0x17, 0xd8,
                                     0x3b, 0xc1, 0x8d, 0x5e, 0x6f, 0x66, 0xb0, 0x83, 0x6c, 0xf7,
                                     0xf3, 0xaf, 0xe2, 0x57, 0x21, 0xda, 0xe2, 0x8f, 0x26, 0x59};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x81};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9e, 0x8e, 0xed, 0xdf, 0x7f, 0xee, 0x54, 0x45, 0x23, 0xae, 0x34, 0x1e, 0xf7, 0x78,
                                     0x98, 0x64, 0xc3, 0xa7, 0x75, 0xf6, 0xff, 0xc9, 0xa7, 0xa2, 0x3d, 0xce, 0x2d};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa9, 0xc3, 0x24, 0x94, 0x4a, 0xc6, 0x72, 0x86, 0x44, 0x97, 0xa0, 0x2, 0x25,
                                     0x6a, 0xbf, 0xc9, 0xd1, 0xaa, 0x9c, 0x74, 0xd,  0xf4, 0x6b, 0xb7, 0xc6};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x14, 0x26, 0x79, 0xf7, 0xa8, 0x31, 0x57, 0x0, 0xf5, 0x36, 0xed, 0xd2, 0x96, 0x69};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x63, 0x51, 0x5f, 0x79, 0xc8, 0xf9};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2, 0xd9, 0x20, 0xaa, 0x3e, 0x19};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2, 0x87, 0x2a};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x5d, 0x8d, 0xd2, 0x1e, 0xba, 0xee, 0xa,  0x1b, 0x1d, 0x6a, 0x83,
                                      0xae, 0xbe, 0x3b, 0x88, 0xcf, 0x4f, 0x66, 0x7a, 0x66, 0x27};
  lwmqtt_string_t topic_filter_s10 = {21, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9525, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25695 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\186\219\215",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\201bK\187'\a\ENQ\157\250\DLE",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("X\223\196\156",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\244hB>\204s
// 1\US\233\145\133\178:\129\154\238z\SYN\152-\244tq\DC1\146",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\EOT\188\214C\158\190\234\ETBt\229\GSR\139N\217\SO\240\245\ENQ\173G;\153@\183",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("W406\252\156\\\212\&3\b\203$\187\247\DC2\235\v\134\181\231",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\191\ESC+\"q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("!\138\RS@\137\CANP!\SOH]\f\250\244\251h\232\242\241\241\218",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\STX\134\223\174XA\133.\245g\FS~\224\173\r\158\EOT\165\NAK",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0xa4, 0x1,  0x64, 0x5f, 0x0,  0x0,  0x2,  0x0,  0x3,  0xba, 0xdb, 0xd7, 0x0,  0x0,  0xa,  0xc9,
                   0x62, 0x4b, 0xbb, 0x27, 0x7,  0x5,  0x9d, 0xfa, 0x10, 0x2,  0x0,  0x4,  0x58, 0xdf, 0xc4, 0x9c, 0x2,
                   0x0,  0x1a, 0xf4, 0x68, 0x42, 0x3e, 0xcc, 0x73, 0x20, 0x31, 0x1f, 0xe9, 0x91, 0x85, 0xb2, 0x3a, 0x81,
                   0x9a, 0xee, 0x7a, 0x16, 0x98, 0x2d, 0xf4, 0x74, 0x71, 0x11, 0x92, 0x0,  0x0,  0x19, 0x4,  0xbc, 0xd6,
                   0x43, 0x9e, 0xbe, 0xea, 0x17, 0x74, 0xe5, 0x1d, 0x52, 0x8b, 0x4e, 0xd9, 0xe,  0xf0, 0xf5, 0x5,  0xad,
                   0x47, 0x3b, 0x99, 0x40, 0xb7, 0x1,  0x0,  0x14, 0x57, 0x34, 0x30, 0x36, 0xfc, 0x9c, 0x5c, 0xd4, 0x33,
                   0x8,  0xcb, 0x24, 0xbb, 0xf7, 0x12, 0xeb, 0xb,  0x86, 0xb5, 0xe7, 0x1,  0x0,  0x5,  0xbf, 0x1b, 0x2b,
                   0x22, 0x71, 0x0,  0x0,  0x14, 0x21, 0x8a, 0x1e, 0x40, 0x89, 0x18, 0x50, 0x21, 0x1,  0x5d, 0xc,  0xfa,
                   0xf4, 0xfb, 0x68, 0xe8, 0xf2, 0xf1, 0xf1, 0xda, 0x2,  0x0,  0x13, 0x2,  0x86, 0xdf, 0xae, 0x58, 0x41,
                   0x85, 0x2e, 0xf5, 0x67, 0x1c, 0x7e, 0xe0, 0xad, 0xd,  0x9e, 0x4,  0xa5, 0x15, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xba, 0xdb, 0xd7};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc9, 0x62, 0x4b, 0xbb, 0x27, 0x7, 0x5, 0x9d, 0xfa, 0x10};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58, 0xdf, 0xc4, 0x9c};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf4, 0x68, 0x42, 0x3e, 0xcc, 0x73, 0x20, 0x31, 0x1f, 0xe9, 0x91, 0x85, 0xb2,
                                     0x3a, 0x81, 0x9a, 0xee, 0x7a, 0x16, 0x98, 0x2d, 0xf4, 0x74, 0x71, 0x11, 0x92};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4,  0xbc, 0xd6, 0x43, 0x9e, 0xbe, 0xea, 0x17, 0x74, 0xe5, 0x1d, 0x52, 0x8b,
                                     0x4e, 0xd9, 0xe,  0xf0, 0xf5, 0x5,  0xad, 0x47, 0x3b, 0x99, 0x40, 0xb7};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x57, 0x34, 0x30, 0x36, 0xfc, 0x9c, 0x5c, 0xd4, 0x33, 0x8,
                                     0xcb, 0x24, 0xbb, 0xf7, 0x12, 0xeb, 0xb,  0x86, 0xb5, 0xe7};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbf, 0x1b, 0x2b, 0x22, 0x71};
  lwmqtt_string_t topic_filter_s7 = {5, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x21, 0x8a, 0x1e, 0x40, 0x89, 0x18, 0x50, 0x21, 0x1,  0x5d,
                                     0xc,  0xfa, 0xf4, 0xfb, 0x68, 0xe8, 0xf2, 0xf1, 0xf1, 0xda};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2,  0x86, 0xdf, 0xae, 0x58, 0x41, 0x85, 0x2e, 0xf5, 0x67,
                                     0x1c, 0x7e, 0xe0, 0xad, 0xd,  0x9e, 0x4,  0xa5, 0x15};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25695, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14957
// [("'\STX-\199\148\232\\4\ETB\240D\\\DC2G\221\175\253\255\200\151\129\253\175\163\209a",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\133%J[\196Z\167\222\147\176\SYN\173\170@h\164",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\214\172\142\169\CANa\255\&7!H+OU`z\"\SUB\129\146[[",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\136`\150!\205",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("Ig\181\204}",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS\157",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0x5f, 0x3a, 0x6d, 0x0,  0x1a, 0x27, 0x2,  0x2d, 0xc7, 0x94, 0xe8, 0x5c, 0x34, 0x17, 0xf0, 0x44,
                   0x5c, 0x12, 0x47, 0xdd, 0xaf, 0xfd, 0xff, 0xc8, 0x97, 0x81, 0xfd, 0xaf, 0xa3, 0xd1, 0x61, 0x0,  0x0,
                   0x10, 0x85, 0x25, 0x4a, 0x5b, 0xc4, 0x5a, 0xa7, 0xde, 0x93, 0xb0, 0x16, 0xad, 0xaa, 0x40, 0x68, 0xa4,
                   0x1,  0x0,  0x15, 0xd6, 0xac, 0x8e, 0xa9, 0x18, 0x61, 0xff, 0x37, 0x21, 0x48, 0x2b, 0x4f, 0x55, 0x60,
                   0x7a, 0x22, 0x1a, 0x81, 0x92, 0x5b, 0x5b, 0x2,  0x0,  0x5,  0x88, 0x60, 0x96, 0x21, 0xcd, 0x1,  0x0,
                   0x5,  0x49, 0x67, 0xb5, 0xcc, 0x7d, 0x0,  0x0,  0x2,  0x1d, 0x9d, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x27, 0x2,  0x2d, 0xc7, 0x94, 0xe8, 0x5c, 0x34, 0x17, 0xf0, 0x44, 0x5c, 0x12,
                                     0x47, 0xdd, 0xaf, 0xfd, 0xff, 0xc8, 0x97, 0x81, 0xfd, 0xaf, 0xa3, 0xd1, 0x61};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x85, 0x25, 0x4a, 0x5b, 0xc4, 0x5a, 0xa7, 0xde,
                                     0x93, 0xb0, 0x16, 0xad, 0xaa, 0x40, 0x68, 0xa4};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd6, 0xac, 0x8e, 0xa9, 0x18, 0x61, 0xff, 0x37, 0x21, 0x48, 0x2b,
                                     0x4f, 0x55, 0x60, 0x7a, 0x22, 0x1a, 0x81, 0x92, 0x5b, 0x5b};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x60, 0x96, 0x21, 0xcd};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x49, 0x67, 0xb5, 0xcc, 0x7d};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1d, 0x9d};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14957, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12087 [("\SOH\160\au5\136\&6\222",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2}),("\202SR62\ENQ<\140\142k",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\141\ACK\147\209\&2\239\163\250\214V",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\227a\EOT0{
// \198\DC2\248\240s_m`\210\198~\128e\240\202\SOH",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\197%;s04\250{\144\SIN\157\136\156\157\221\232\250",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("86f\234\181\141#g\FS]\237x\187\200B\224Q\158\&3\234\STX\a1\233\\\FS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("0\194w\220\142\208!>\246\138\133\163\SOH|\246I\FS$D\252`!\FS@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\172\226p\DC4E\160\DC3\225",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\230A<\165\132",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0xa3, 0x1,  0x2f, 0x37, 0x0,  0x8,  0x1,  0xa0, 0x7,  0x75, 0x35, 0x88, 0x36, 0xde, 0x2,  0x0,
                   0xa,  0xca, 0x53, 0x52, 0x36, 0x32, 0x5,  0x3c, 0x8c, 0x8e, 0x6b, 0x1,  0x0,  0xa,  0x8d, 0x6,  0x93,
                   0xd1, 0x32, 0xef, 0xa3, 0xfa, 0xd6, 0x56, 0x2,  0x0,  0x16, 0xe3, 0x61, 0x4,  0x30, 0x7b, 0x20, 0xc6,
                   0x12, 0xf8, 0xf0, 0x73, 0x5f, 0x6d, 0x60, 0xd2, 0xc6, 0x7e, 0x80, 0x65, 0xf0, 0xca, 0x1,  0x2,  0x0,
                   0x12, 0xc5, 0x25, 0x3b, 0x73, 0x30, 0x34, 0xfa, 0x7b, 0x90, 0xf,  0x4e, 0x9d, 0x88, 0x9c, 0x9d, 0xdd,
                   0xe8, 0xfa, 0x2,  0x0,  0x0,  0x1,  0x0,  0x1a, 0x38, 0x36, 0x66, 0xea, 0xb5, 0x8d, 0x23, 0x67, 0x1c,
                   0x5d, 0xed, 0x78, 0xbb, 0xc8, 0x42, 0xe0, 0x51, 0x9e, 0x33, 0xea, 0x2,  0x7,  0x31, 0xe9, 0x5c, 0x1c,
                   0x2,  0x0,  0x18, 0x30, 0xc2, 0x77, 0xdc, 0x8e, 0xd0, 0x21, 0x3e, 0xf6, 0x8a, 0x85, 0xa3, 0x1,  0x7c,
                   0xf6, 0x49, 0x1c, 0x24, 0x44, 0xfc, 0x60, 0x21, 0x1c, 0x40, 0x0,  0x0,  0x8,  0xac, 0xe2, 0x70, 0x14,
                   0x45, 0xa0, 0x13, 0xe1, 0x0,  0x0,  0x5,  0xe6, 0x41, 0x3c, 0xa5, 0x84, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x1, 0xa0, 0x7, 0x75, 0x35, 0x88, 0x36, 0xde};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xca, 0x53, 0x52, 0x36, 0x32, 0x5, 0x3c, 0x8c, 0x8e, 0x6b};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8d, 0x6, 0x93, 0xd1, 0x32, 0xef, 0xa3, 0xfa, 0xd6, 0x56};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe3, 0x61, 0x4,  0x30, 0x7b, 0x20, 0xc6, 0x12, 0xf8, 0xf0, 0x73,
                                     0x5f, 0x6d, 0x60, 0xd2, 0xc6, 0x7e, 0x80, 0x65, 0xf0, 0xca, 0x1};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc5, 0x25, 0x3b, 0x73, 0x30, 0x34, 0xfa, 0x7b, 0x90,
                                     0xf,  0x4e, 0x9d, 0x88, 0x9c, 0x9d, 0xdd, 0xe8, 0xfa};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x38, 0x36, 0x66, 0xea, 0xb5, 0x8d, 0x23, 0x67, 0x1c, 0x5d, 0xed, 0x78, 0xbb,
                                     0xc8, 0x42, 0xe0, 0x51, 0x9e, 0x33, 0xea, 0x2,  0x7,  0x31, 0xe9, 0x5c, 0x1c};
  lwmqtt_string_t topic_filter_s6 = {26, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x30, 0xc2, 0x77, 0xdc, 0x8e, 0xd0, 0x21, 0x3e, 0xf6, 0x8a, 0x85, 0xa3,
                                     0x1,  0x7c, 0xf6, 0x49, 0x1c, 0x24, 0x44, 0xfc, 0x60, 0x21, 0x1c, 0x40};
  lwmqtt_string_t topic_filter_s7 = {24, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xac, 0xe2, 0x70, 0x14, 0x45, 0xa0, 0x13, 0xe1};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe6, 0x41, 0x3c, 0xa5, 0x84};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12087, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12264 [("\196k\DC4\147L\142U\156\ENQ\US\184Vi",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("v\GSMX\152\167\US\241\&0\144",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("ZW\174\198D$\r\232\220afgJM\NAKe\174\158\192\138\223\ESCs\172d\140M",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\EOT\184\184Pt\214-\228:\SI\193\207\136",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\202\223|X\252\nU\158b~\143\&8\GS#",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\162#D\147((1X ",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\130\219\DC4\157\150w",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("|\141\195",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0x79, 0x2f, 0xe8, 0x0,  0xd,  0xc4, 0x6b, 0x14, 0x93, 0x4c, 0x8e, 0x55, 0x9c, 0x5,  0x1f,
                   0xb8, 0x56, 0x69, 0x0,  0x0,  0xa,  0x76, 0x1d, 0x4d, 0x58, 0x98, 0xa7, 0x1f, 0xf1, 0x30, 0x90,
                   0x1,  0x0,  0x1b, 0x5a, 0x57, 0xae, 0xc6, 0x44, 0x24, 0xd,  0xe8, 0xdc, 0x61, 0x66, 0x67, 0x4a,
                   0x4d, 0x15, 0x65, 0xae, 0x9e, 0xc0, 0x8a, 0xdf, 0x1b, 0x73, 0xac, 0x64, 0x8c, 0x4d, 0x1,  0x0,
                   0xd,  0x4,  0xb8, 0xb8, 0x50, 0x74, 0xd6, 0x2d, 0xe4, 0x3a, 0xf,  0xc1, 0xcf, 0x88, 0x0,  0x0,
                   0xe,  0xca, 0xdf, 0x7c, 0x58, 0xfc, 0xa,  0x55, 0x9e, 0x62, 0x7e, 0x8f, 0x38, 0x1d, 0x23, 0x1,
                   0x0,  0x9,  0xa2, 0x23, 0x44, 0x93, 0x28, 0x28, 0x31, 0x58, 0x20, 0x1,  0x0,  0x6,  0x82, 0xdb,
                   0x14, 0x9d, 0x96, 0x77, 0x2,  0x0,  0x3,  0x7c, 0x8d, 0xc3, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xc4, 0x6b, 0x14, 0x93, 0x4c, 0x8e, 0x55, 0x9c, 0x5, 0x1f, 0xb8, 0x56, 0x69};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x76, 0x1d, 0x4d, 0x58, 0x98, 0xa7, 0x1f, 0xf1, 0x30, 0x90};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5a, 0x57, 0xae, 0xc6, 0x44, 0x24, 0xd,  0xe8, 0xdc, 0x61, 0x66, 0x67, 0x4a, 0x4d,
                                     0x15, 0x65, 0xae, 0x9e, 0xc0, 0x8a, 0xdf, 0x1b, 0x73, 0xac, 0x64, 0x8c, 0x4d};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4, 0xb8, 0xb8, 0x50, 0x74, 0xd6, 0x2d, 0xe4, 0x3a, 0xf, 0xc1, 0xcf, 0x88};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xca, 0xdf, 0x7c, 0x58, 0xfc, 0xa, 0x55, 0x9e, 0x62, 0x7e, 0x8f, 0x38, 0x1d, 0x23};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa2, 0x23, 0x44, 0x93, 0x28, 0x28, 0x31, 0x58, 0x20};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x82, 0xdb, 0x14, 0x9d, 0x96, 0x77};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7c, 0x8d, 0xc3};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12264, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23519 [("R\219\&9\207\231\198)2}\160",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\229\250\209",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("P\243-\232\133v`;l\157\243\238\130\251x\239\172\210\144\US2\251@h\138\228Mt\140",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\n\133g\194",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("y\239\128\199)K\206~\242\246\SO*Anb2&\190\169#b",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\tz\SI\249\US2%R\176\a\163Kn\141\187\198\211x\246)]",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0x6f, 0x5b, 0xdf, 0x0,  0xa,  0x52, 0xdb, 0x39, 0xcf, 0xe7, 0xc6, 0x29, 0x32, 0x7d, 0xa0, 0x0,
                   0x0,  0x0,  0x1,  0x0,  0x3,  0xe5, 0xfa, 0xd1, 0x0,  0x0,  0x1d, 0x50, 0xf3, 0x2d, 0xe8, 0x85, 0x76,
                   0x60, 0x3b, 0x6c, 0x9d, 0xf3, 0xee, 0x82, 0xfb, 0x78, 0xef, 0xac, 0xd2, 0x90, 0x1f, 0x32, 0xfb, 0x40,
                   0x68, 0x8a, 0xe4, 0x4d, 0x74, 0x8c, 0x0,  0x0,  0x4,  0xa,  0x85, 0x67, 0xc2, 0x1,  0x0,  0x15, 0x79,
                   0xef, 0x80, 0xc7, 0x29, 0x4b, 0xce, 0x7e, 0xf2, 0xf6, 0xe,  0x2a, 0x41, 0x6e, 0x62, 0x32, 0x26, 0xbe,
                   0xa9, 0x23, 0x62, 0x0,  0x0,  0x15, 0x9,  0x7a, 0xf,  0xf9, 0x1f, 0x32, 0x25, 0x52, 0xb0, 0x7,  0xa3,
                   0x4b, 0x6e, 0x8d, 0xbb, 0xc6, 0xd3, 0x78, 0xf6, 0x29, 0x5d, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x52, 0xdb, 0x39, 0xcf, 0xe7, 0xc6, 0x29, 0x32, 0x7d, 0xa0};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0xfa, 0xd1};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x50, 0xf3, 0x2d, 0xe8, 0x85, 0x76, 0x60, 0x3b, 0x6c, 0x9d,
                                     0xf3, 0xee, 0x82, 0xfb, 0x78, 0xef, 0xac, 0xd2, 0x90, 0x1f,
                                     0x32, 0xfb, 0x40, 0x68, 0x8a, 0xe4, 0x4d, 0x74, 0x8c};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa, 0x85, 0x67, 0xc2};
  lwmqtt_string_t topic_filter_s4 = {4, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x79, 0xef, 0x80, 0xc7, 0x29, 0x4b, 0xce, 0x7e, 0xf2, 0xf6, 0xe,
                                     0x2a, 0x41, 0x6e, 0x62, 0x32, 0x26, 0xbe, 0xa9, 0x23, 0x62};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x9,  0x7a, 0xf,  0xf9, 0x1f, 0x32, 0x25, 0x52, 0xb0, 0x7, 0xa3,
                                     0x4b, 0x6e, 0x8d, 0xbb, 0xc6, 0xd3, 0x78, 0xf6, 0x29, 0x5d};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23519, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29383 [(",\NAK\169\178hV\136\f\td\219\232\130\128\161",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("x\r\128\171A\130\134\&6\DC1oU\179\212\t~\136\247\SO3",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(")o=\233\v\SOH\204,\183\ESCkM^\133\224\&5\200H",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\210\198\219\203\239\165d<\213b\DC4UR\142\235\248\NULp\131\235\184\147\223kF\157\137\150\218\b",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("mm\223\&8\CAN\fO\no",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\192\143D`V'\SYNt\SI\233\133\&5\248\252\145\247C\130\192\218\SUBo",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\173\253\163N\216\207\129+_ \235e2\r5}\146",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\223\ETX\244nSoNK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("/\239uT\EOT",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("f\241DK\SUB\ETB\DLEfe[\RS\CAN\222\ESCp\230Z\232v9e\246",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0xc8, 0x1,  0x72, 0xc7, 0x0,  0xf,  0x2c, 0x15, 0xa9, 0xb2, 0x68, 0x56, 0x88, 0xc,  0x9,  0x64,
                   0xdb, 0xe8, 0x82, 0x80, 0xa1, 0x1,  0x0,  0x13, 0x78, 0xd,  0x80, 0xab, 0x41, 0x82, 0x86, 0x36, 0x11,
                   0x6f, 0x55, 0xb3, 0xd4, 0x9,  0x7e, 0x88, 0xf7, 0xe,  0x33, 0x2,  0x0,  0x12, 0x29, 0x6f, 0x3d, 0xe9,
                   0xb,  0x1,  0xcc, 0x2c, 0xb7, 0x1b, 0x6b, 0x4d, 0x5e, 0x85, 0xe0, 0x35, 0xc8, 0x48, 0x0,  0x0,  0x1e,
                   0xd2, 0xc6, 0xdb, 0xcb, 0xef, 0xa5, 0x64, 0x3c, 0xd5, 0x62, 0x14, 0x55, 0x52, 0x8e, 0xeb, 0xf8, 0x0,
                   0x70, 0x83, 0xeb, 0xb8, 0x93, 0xdf, 0x6b, 0x46, 0x9d, 0x89, 0x96, 0xda, 0x8,  0x1,  0x0,  0x9,  0x6d,
                   0x6d, 0xdf, 0x38, 0x18, 0xc,  0x4f, 0xa,  0x6f, 0x0,  0x0,  0x0,  0x2,  0x0,  0x16, 0xc0, 0x8f, 0x44,
                   0x60, 0x56, 0x27, 0x16, 0x74, 0xf,  0xe9, 0x85, 0x35, 0xf8, 0xfc, 0x91, 0xf7, 0x43, 0x82, 0xc0, 0xda,
                   0x1a, 0x6f, 0x0,  0x0,  0x11, 0xad, 0xfd, 0xa3, 0x4e, 0xd8, 0xcf, 0x81, 0x2b, 0x5f, 0x20, 0xeb, 0x65,
                   0x32, 0xd,  0x35, 0x7d, 0x92, 0x1,  0x0,  0x8,  0xdf, 0x3,  0xf4, 0x6e, 0x53, 0x6f, 0x4e, 0x4b, 0x1,
                   0x0,  0x5,  0x2f, 0xef, 0x75, 0x54, 0x4,  0x1,  0x0,  0x16, 0x66, 0xf1, 0x44, 0x4b, 0x1a, 0x17, 0x10,
                   0x66, 0x65, 0x5b, 0x1e, 0x18, 0xde, 0x1b, 0x70, 0xe6, 0x5a, 0xe8, 0x76, 0x39, 0x65, 0xf6, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x2c, 0x15, 0xa9, 0xb2, 0x68, 0x56, 0x88, 0xc,
                                     0x9,  0x64, 0xdb, 0xe8, 0x82, 0x80, 0xa1};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x78, 0xd,  0x80, 0xab, 0x41, 0x82, 0x86, 0x36, 0x11, 0x6f,
                                     0x55, 0xb3, 0xd4, 0x9,  0x7e, 0x88, 0xf7, 0xe,  0x33};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x29, 0x6f, 0x3d, 0xe9, 0xb,  0x1,  0xcc, 0x2c, 0xb7,
                                     0x1b, 0x6b, 0x4d, 0x5e, 0x85, 0xe0, 0x35, 0xc8, 0x48};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd2, 0xc6, 0xdb, 0xcb, 0xef, 0xa5, 0x64, 0x3c, 0xd5, 0x62,
                                     0x14, 0x55, 0x52, 0x8e, 0xeb, 0xf8, 0x0,  0x70, 0x83, 0xeb,
                                     0xb8, 0x93, 0xdf, 0x6b, 0x46, 0x9d, 0x89, 0x96, 0xda, 0x8};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x6d, 0x6d, 0xdf, 0x38, 0x18, 0xc, 0x4f, 0xa, 0x6f};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc0, 0x8f, 0x44, 0x60, 0x56, 0x27, 0x16, 0x74, 0xf,  0xe9, 0x85,
                                     0x35, 0xf8, 0xfc, 0x91, 0xf7, 0x43, 0x82, 0xc0, 0xda, 0x1a, 0x6f};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xad, 0xfd, 0xa3, 0x4e, 0xd8, 0xcf, 0x81, 0x2b, 0x5f,
                                     0x20, 0xeb, 0x65, 0x32, 0xd,  0x35, 0x7d, 0x92};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xdf, 0x3, 0xf4, 0x6e, 0x53, 0x6f, 0x4e, 0x4b};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2f, 0xef, 0x75, 0x54, 0x4};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x66, 0xf1, 0x44, 0x4b, 0x1a, 0x17, 0x10, 0x66, 0x65, 0x5b, 0x1e,
                                      0x18, 0xde, 0x1b, 0x70, 0xe6, 0x5a, 0xe8, 0x76, 0x39, 0x65, 0xf6};
  lwmqtt_string_t topic_filter_s10 = {22, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29383, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22596 [("Z\234}C\SUB\171\&5&\204(&\179-\EOTJ4Z\158^\r/\210",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\155\DLE\244\181\FSv!R\140\a\235\ENQ\187D\133;",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\247\DC267\FS'\131\SI\183\GS(6\151",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("-F\209r\195e^\215\133\254\177R\253\173\165\FS\DLE?\DC3\203Qm\153\228 4\EM\156\228",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("*\206\rj\188y\249\188o\SI\163Sfn\ENQ:II3",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("\177B:\171\142\240\238\222",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0x7f, 0x58, 0x44, 0x0,  0x16, 0x5a, 0xea, 0x7d, 0x43, 0x1a, 0xab, 0x35, 0x26, 0xcc, 0x28, 0x26,
                   0xb3, 0x2d, 0x4,  0x4a, 0x34, 0x5a, 0x9e, 0x5e, 0xd,  0x2f, 0xd2, 0x1,  0x0,  0x10, 0x9b, 0x10, 0xf4,
                   0xb5, 0x1c, 0x76, 0x21, 0x52, 0x8c, 0x7,  0xeb, 0x5,  0xbb, 0x44, 0x85, 0x3b, 0x1,  0x0,  0xd,  0xf7,
                   0x12, 0x36, 0x37, 0x1c, 0x27, 0x83, 0xf,  0xb7, 0x1d, 0x28, 0x36, 0x97, 0x0,  0x0,  0x1d, 0x2d, 0x46,
                   0xd1, 0x72, 0xc3, 0x65, 0x5e, 0xd7, 0x85, 0xfe, 0xb1, 0x52, 0xfd, 0xad, 0xa5, 0x1c, 0x10, 0x3f, 0x13,
                   0xcb, 0x51, 0x6d, 0x99, 0xe4, 0x20, 0x34, 0x19, 0x9c, 0xe4, 0x0,  0x0,  0x13, 0x2a, 0xce, 0xd,  0x6a,
                   0xbc, 0x79, 0xf9, 0xbc, 0x6f, 0xf,  0xa3, 0x53, 0x66, 0x6e, 0x5,  0x3a, 0x49, 0x49, 0x33, 0x1,  0x0,
                   0x8,  0xb1, 0x42, 0x3a, 0xab, 0x8e, 0xf0, 0xee, 0xde, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x5a, 0xea, 0x7d, 0x43, 0x1a, 0xab, 0x35, 0x26, 0xcc, 0x28, 0x26,
                                     0xb3, 0x2d, 0x4,  0x4a, 0x34, 0x5a, 0x9e, 0x5e, 0xd,  0x2f, 0xd2};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9b, 0x10, 0xf4, 0xb5, 0x1c, 0x76, 0x21, 0x52,
                                     0x8c, 0x7,  0xeb, 0x5,  0xbb, 0x44, 0x85, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf7, 0x12, 0x36, 0x37, 0x1c, 0x27, 0x83, 0xf, 0xb7, 0x1d, 0x28, 0x36, 0x97};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2d, 0x46, 0xd1, 0x72, 0xc3, 0x65, 0x5e, 0xd7, 0x85, 0xfe,
                                     0xb1, 0x52, 0xfd, 0xad, 0xa5, 0x1c, 0x10, 0x3f, 0x13, 0xcb,
                                     0x51, 0x6d, 0x99, 0xe4, 0x20, 0x34, 0x19, 0x9c, 0xe4};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2a, 0xce, 0xd,  0x6a, 0xbc, 0x79, 0xf9, 0xbc, 0x6f, 0xf,
                                     0xa3, 0x53, 0x66, 0x6e, 0x5,  0x3a, 0x49, 0x49, 0x33};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb1, 0x42, 0x3a, 0xab, 0x8e, 0xf0, 0xee, 0xde};
  lwmqtt_string_t topic_filter_s5 = {8, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22596, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11045 [("\234\249\222\145'",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0}),("\217Z\205\221w\220\&3\151\252\147\160\134\236\ru\149\189",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("J\221\215\236\181\158\210\253l\a\191z\189\211\SOq\150",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("BFVB\232\190z@:\164\132\215)\182\230\141\225\GS",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0x47, 0x2b, 0x25, 0x0,  0x5,  0xea, 0xf9, 0xde, 0x91, 0x27, 0x0,  0x0,  0x11, 0xd9,
                   0x5a, 0xcd, 0xdd, 0x77, 0xdc, 0x33, 0x97, 0xfc, 0x93, 0xa0, 0x86, 0xec, 0xd,  0x75, 0x95,
                   0xbd, 0x0,  0x0,  0x11, 0x4a, 0xdd, 0xd7, 0xec, 0xb5, 0x9e, 0xd2, 0xfd, 0x6c, 0x7,  0xbf,
                   0x7a, 0xbd, 0xd3, 0xe,  0x71, 0x96, 0x0,  0x0,  0x12, 0x42, 0x46, 0x56, 0x42, 0xe8, 0xbe,
                   0x7a, 0x40, 0x3a, 0xa4, 0x84, 0xd7, 0x29, 0xb6, 0xe6, 0x8d, 0xe1, 0x1d, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xea, 0xf9, 0xde, 0x91, 0x27};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd9, 0x5a, 0xcd, 0xdd, 0x77, 0xdc, 0x33, 0x97, 0xfc,
                                     0x93, 0xa0, 0x86, 0xec, 0xd,  0x75, 0x95, 0xbd};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4a, 0xdd, 0xd7, 0xec, 0xb5, 0x9e, 0xd2, 0xfd, 0x6c,
                                     0x7,  0xbf, 0x7a, 0xbd, 0xd3, 0xe,  0x71, 0x96};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x42, 0x46, 0x56, 0x42, 0xe8, 0xbe, 0x7a, 0x40, 0x3a,
                                     0xa4, 0x84, 0xd7, 0x29, 0xb6, 0xe6, 0x8d, 0xe1, 0x1d};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11045, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21249 [("7\141\154\230\129\244\236\138'\RS\208h&Y\170\r\229q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("Q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\150+:_x<S\165o\"}\138\GS\189\239\246h\223\203\245\138\187",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Z\220\vb\170-\249\195\209\191[\195E\149\205\"\205~\249\211:\211eZ\248R",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\167\248\246\139\157{\159tb\163\204_\210\&8\177\f\182\234\RS>w\178Z\250\SYN\210\178L",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\250z\226\216\161\ETX\ACK\136\206\ESC\173\US\218\247\CAN\SI\213)z>z\188-E\195\128\181L\248'",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("W\185i\STX8n",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),(",\244N\145.o\200\211.\221B{\185",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0xad, 0x1,  0x53, 0x1,  0x0,  0x12, 0x37, 0x8d, 0x9a, 0xe6, 0x81, 0xf4, 0xec, 0x8a, 0x27,
                   0x1e, 0xd0, 0x68, 0x26, 0x59, 0xaa, 0xd,  0xe5, 0x71, 0x1,  0x0,  0x1,  0x51, 0x0,  0x0,  0x16,
                   0x96, 0x2b, 0x3a, 0x5f, 0x78, 0x3c, 0x53, 0xa5, 0x6f, 0x22, 0x7d, 0x8a, 0x1d, 0xbd, 0xef, 0xf6,
                   0x68, 0xdf, 0xcb, 0xf5, 0x8a, 0xbb, 0x1,  0x0,  0x1a, 0x5a, 0xdc, 0xb,  0x62, 0xaa, 0x2d, 0xf9,
                   0xc3, 0xd1, 0xbf, 0x5b, 0xc3, 0x45, 0x95, 0xcd, 0x22, 0xcd, 0x7e, 0xf9, 0xd3, 0x3a, 0xd3, 0x65,
                   0x5a, 0xf8, 0x52, 0x2,  0x0,  0x1c, 0xa7, 0xf8, 0xf6, 0x8b, 0x9d, 0x7b, 0x9f, 0x74, 0x62, 0xa3,
                   0xcc, 0x5f, 0xd2, 0x38, 0xb1, 0xc,  0xb6, 0xea, 0x1e, 0x3e, 0x77, 0xb2, 0x5a, 0xfa, 0x16, 0xd2,
                   0xb2, 0x4c, 0x2,  0x0,  0x1e, 0xfa, 0x7a, 0xe2, 0xd8, 0xa1, 0x3,  0x6,  0x88, 0xce, 0x1b, 0xad,
                   0x1f, 0xda, 0xf7, 0x18, 0xf,  0xd5, 0x29, 0x7a, 0x3e, 0x7a, 0xbc, 0x2d, 0x45, 0xc3, 0x80, 0xb5,
                   0x4c, 0xf8, 0x27, 0x1,  0x0,  0x6,  0x57, 0xb9, 0x69, 0x2,  0x38, 0x6e, 0x0,  0x0,  0x0,  0x0,
                   0x0,  0xd,  0x2c, 0xf4, 0x4e, 0x91, 0x2e, 0x6f, 0xc8, 0xd3, 0x2e, 0xdd, 0x42, 0x7b, 0xb9, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x37, 0x8d, 0x9a, 0xe6, 0x81, 0xf4, 0xec, 0x8a, 0x27,
                                     0x1e, 0xd0, 0x68, 0x26, 0x59, 0xaa, 0xd,  0xe5, 0x71};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x51};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x96, 0x2b, 0x3a, 0x5f, 0x78, 0x3c, 0x53, 0xa5, 0x6f, 0x22, 0x7d,
                                     0x8a, 0x1d, 0xbd, 0xef, 0xf6, 0x68, 0xdf, 0xcb, 0xf5, 0x8a, 0xbb};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5a, 0xdc, 0xb,  0x62, 0xaa, 0x2d, 0xf9, 0xc3, 0xd1, 0xbf, 0x5b, 0xc3, 0x45,
                                     0x95, 0xcd, 0x22, 0xcd, 0x7e, 0xf9, 0xd3, 0x3a, 0xd3, 0x65, 0x5a, 0xf8, 0x52};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7, 0xf8, 0xf6, 0x8b, 0x9d, 0x7b, 0x9f, 0x74, 0x62, 0xa3,
                                     0xcc, 0x5f, 0xd2, 0x38, 0xb1, 0xc,  0xb6, 0xea, 0x1e, 0x3e,
                                     0x77, 0xb2, 0x5a, 0xfa, 0x16, 0xd2, 0xb2, 0x4c};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfa, 0x7a, 0xe2, 0xd8, 0xa1, 0x3,  0x6,  0x88, 0xce, 0x1b,
                                     0xad, 0x1f, 0xda, 0xf7, 0x18, 0xf,  0xd5, 0x29, 0x7a, 0x3e,
                                     0x7a, 0xbc, 0x2d, 0x45, 0xc3, 0x80, 0xb5, 0x4c, 0xf8, 0x27};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x57, 0xb9, 0x69, 0x2, 0x38, 0x6e};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0};
  lwmqtt_string_t topic_filter_s7 = {0, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2c, 0xf4, 0x4e, 0x91, 0x2e, 0x6f, 0xc8, 0xd3, 0x2e, 0xdd, 0x42, 0x7b, 0xb9};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21249, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32237 [("4kW\253\213\191\228\173\&8\EM\n",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("n\199=\255]\ETX\237\&4\249V\187\139\228\DELVS\208~\231\232\208\203\187JH\153D\214\183",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("I\199\145I:\210\ETX\150\215N\aE3l\184",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS2}),("\NAK6\182D\195\163\&3y\228P\236\212\201\235T\a\151\SUB4\235\185\ETBs",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\128j\150\163\160%mXs\152",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x69, 0x7d, 0xed, 0x0,  0xb,  0x34, 0x6b, 0x57, 0xfd, 0xd5, 0xbf, 0xe4, 0xad, 0x38, 0x19,
                   0xa,  0x1,  0x0,  0x1d, 0x6e, 0xc7, 0x3d, 0xff, 0x5d, 0x3,  0xed, 0x34, 0xf9, 0x56, 0xbb, 0x8b,
                   0xe4, 0x7f, 0x56, 0x53, 0xd0, 0x7e, 0xe7, 0xe8, 0xd0, 0xcb, 0xbb, 0x4a, 0x48, 0x99, 0x44, 0xd6,
                   0xb7, 0x1,  0x0,  0xf,  0x49, 0xc7, 0x91, 0x49, 0x3a, 0xd2, 0x3,  0x96, 0xd7, 0x4e, 0x7,  0x45,
                   0x33, 0x6c, 0xb8, 0x2,  0x0,  0x17, 0x15, 0x36, 0xb6, 0x44, 0xc3, 0xa3, 0x33, 0x79, 0xe4, 0x50,
                   0xec, 0xd4, 0xc9, 0xeb, 0x54, 0x7,  0x97, 0x1a, 0x34, 0xeb, 0xb9, 0x17, 0x73, 0x2,  0x0,  0xa,
                   0x80, 0x6a, 0x96, 0xa3, 0xa0, 0x25, 0x6d, 0x58, 0x73, 0x98, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x34, 0x6b, 0x57, 0xfd, 0xd5, 0xbf, 0xe4, 0xad, 0x38, 0x19, 0xa};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e, 0xc7, 0x3d, 0xff, 0x5d, 0x3,  0xed, 0x34, 0xf9, 0x56,
                                     0xbb, 0x8b, 0xe4, 0x7f, 0x56, 0x53, 0xd0, 0x7e, 0xe7, 0xe8,
                                     0xd0, 0xcb, 0xbb, 0x4a, 0x48, 0x99, 0x44, 0xd6, 0xb7};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x49, 0xc7, 0x91, 0x49, 0x3a, 0xd2, 0x3, 0x96,
                                     0xd7, 0x4e, 0x7,  0x45, 0x33, 0x6c, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x15, 0x36, 0xb6, 0x44, 0xc3, 0xa3, 0x33, 0x79, 0xe4, 0x50, 0xec, 0xd4,
                                     0xc9, 0xeb, 0x54, 0x7,  0x97, 0x1a, 0x34, 0xeb, 0xb9, 0x17, 0x73};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x80, 0x6a, 0x96, 0xa3, 0xa0, 0x25, 0x6d, 0x58, 0x73, 0x98};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32237, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1376 [(";\183\191\187\221\202\191\DC3FT\197\175\DC4\217>'\224\SIEx\189\194,",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("IaJ\ACK{\144@\ACK)XK\128\\7\ETX\159\146\SYN\141",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("o\209\197\246\162b\NAK\141\232A8\174\ACK\205\242+\ETX\SOHp\129\232\SUB\205\209&",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\US",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x52, 0x5,  0x60, 0x0,  0x17, 0x3b, 0xb7, 0xbf, 0xbb, 0xdd, 0xca, 0xbf, 0x13, 0x46, 0x54, 0xc5,
                   0xaf, 0x14, 0xd9, 0x3e, 0x27, 0xe0, 0xf,  0x45, 0x78, 0xbd, 0xc2, 0x2c, 0x2,  0x0,  0x13, 0x49, 0x61,
                   0x4a, 0x6,  0x7b, 0x90, 0x40, 0x6,  0x29, 0x58, 0x4b, 0x80, 0x5c, 0x37, 0x3,  0x9f, 0x92, 0x16, 0x8d,
                   0x0,  0x0,  0x19, 0x6f, 0xd1, 0xc5, 0xf6, 0xa2, 0x62, 0x15, 0x8d, 0xe8, 0x41, 0x38, 0xae, 0x6,  0xcd,
                   0xf2, 0x2b, 0x3,  0x1,  0x70, 0x81, 0xe8, 0x1a, 0xcd, 0xd1, 0x26, 0x2,  0x0,  0x1,  0x1f, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0xb7, 0xbf, 0xbb, 0xdd, 0xca, 0xbf, 0x13, 0x46, 0x54, 0xc5, 0xaf,
                                     0x14, 0xd9, 0x3e, 0x27, 0xe0, 0xf,  0x45, 0x78, 0xbd, 0xc2, 0x2c};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x49, 0x61, 0x4a, 0x6,  0x7b, 0x90, 0x40, 0x6,  0x29, 0x58,
                                     0x4b, 0x80, 0x5c, 0x37, 0x3,  0x9f, 0x92, 0x16, 0x8d};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6f, 0xd1, 0xc5, 0xf6, 0xa2, 0x62, 0x15, 0x8d, 0xe8, 0x41, 0x38, 0xae, 0x6,
                                     0xcd, 0xf2, 0x2b, 0x3,  0x1,  0x70, 0x81, 0xe8, 0x1a, 0xcd, 0xd1, 0x26};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1f};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 1376, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20213 [("\228\181kq\t",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\217\&9\137\SYN\SUB\221t\182\SImim\223\212]",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\128",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\182\130\204\SOH\136\244\204\152",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("\163\SI&zW\202\147_\174~O\152\137\242\205\DC3\131\180w \252\148",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("H\DELG\141Np",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("b\201E\195z\240\\k\177\&0\240\216\209\199=\139\251\222\254\173",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("cw,\227\r\161\128\EM:\197/\f\DEL\143\174\169\241\238&",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("-\131\DC3-/\EOTY\146\153]\138\149\250e\132m\EOTrrX\226",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0x95, 0x1,  0x4e, 0xf5, 0x0,  0x5,  0xe4, 0xb5, 0x6b, 0x71, 0x9,  0x0,  0x0,  0xf,  0xd9, 0x39,
                   0x89, 0x16, 0x1a, 0xdd, 0x74, 0xb6, 0xf,  0x6d, 0x69, 0x6d, 0xdf, 0xd4, 0x5d, 0x1,  0x0,  0x1,  0x80,
                   0x0,  0x0,  0x0,  0x2,  0x0,  0x8,  0xb6, 0x82, 0xcc, 0x1,  0x88, 0xf4, 0xcc, 0x98, 0x1,  0x0,  0x16,
                   0xa3, 0xf,  0x26, 0x7a, 0x57, 0xca, 0x93, 0x5f, 0xae, 0x7e, 0x4f, 0x98, 0x89, 0xf2, 0xcd, 0x13, 0x83,
                   0xb4, 0x77, 0x20, 0xfc, 0x94, 0x2,  0x0,  0x6,  0x48, 0x7f, 0x47, 0x8d, 0x4e, 0x70, 0x1,  0x0,  0x14,
                   0x62, 0xc9, 0x45, 0xc3, 0x7a, 0xf0, 0x5c, 0x6b, 0xb1, 0x30, 0xf0, 0xd8, 0xd1, 0xc7, 0x3d, 0x8b, 0xfb,
                   0xde, 0xfe, 0xad, 0x2,  0x0,  0x13, 0x63, 0x77, 0x2c, 0xe3, 0xd,  0xa1, 0x80, 0x19, 0x3a, 0xc5, 0x2f,
                   0xc,  0x7f, 0x8f, 0xae, 0xa9, 0xf1, 0xee, 0x26, 0x1,  0x0,  0x15, 0x2d, 0x83, 0x13, 0x2d, 0x2f, 0x4,
                   0x59, 0x92, 0x99, 0x5d, 0x8a, 0x95, 0xfa, 0x65, 0x84, 0x6d, 0x4,  0x72, 0x72, 0x58, 0xe2, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xe4, 0xb5, 0x6b, 0x71, 0x9};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd9, 0x39, 0x89, 0x16, 0x1a, 0xdd, 0x74, 0xb6,
                                     0xf,  0x6d, 0x69, 0x6d, 0xdf, 0xd4, 0x5d};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x80};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb6, 0x82, 0xcc, 0x1, 0x88, 0xf4, 0xcc, 0x98};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa3, 0xf,  0x26, 0x7a, 0x57, 0xca, 0x93, 0x5f, 0xae, 0x7e, 0x4f,
                                     0x98, 0x89, 0xf2, 0xcd, 0x13, 0x83, 0xb4, 0x77, 0x20, 0xfc, 0x94};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x48, 0x7f, 0x47, 0x8d, 0x4e, 0x70};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x62, 0xc9, 0x45, 0xc3, 0x7a, 0xf0, 0x5c, 0x6b, 0xb1, 0x30,
                                     0xf0, 0xd8, 0xd1, 0xc7, 0x3d, 0x8b, 0xfb, 0xde, 0xfe, 0xad};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x63, 0x77, 0x2c, 0xe3, 0xd,  0xa1, 0x80, 0x19, 0x3a, 0xc5,
                                     0x2f, 0xc,  0x7f, 0x8f, 0xae, 0xa9, 0xf1, 0xee, 0x26};
  lwmqtt_string_t topic_filter_s8 = {19, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2d, 0x83, 0x13, 0x2d, 0x2f, 0x4, 0x59, 0x92, 0x99, 0x5d, 0x8a,
                                     0x95, 0xfa, 0x65, 0x84, 0x6d, 0x4, 0x72, 0x72, 0x58, 0xe2};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20213, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2875 [("\171\ESC\137\SO\239\178N8\149$\239",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\n\NUL\183\220@\191
// \EOTb\199+\141\"\152\234\207\191=\166\f\nR;\249:",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x2c, 0xb,  0x3b, 0x0,  0xb,  0xab, 0x1b, 0x89, 0xe,  0xef, 0xb2, 0x4e, 0x38, 0x95, 0x24,
                   0xef, 0x1,  0x0,  0x19, 0xa,  0x0,  0xb7, 0xdc, 0x40, 0xbf, 0x20, 0x4,  0x62, 0xc7, 0x2b, 0x8d,
                   0x22, 0x98, 0xea, 0xcf, 0xbf, 0x3d, 0xa6, 0xc,  0xa,  0x52, 0x3b, 0xf9, 0x3a, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x1b, 0x89, 0xe, 0xef, 0xb2, 0x4e, 0x38, 0x95, 0x24, 0xef};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa,  0x0,  0xb7, 0xdc, 0x40, 0xbf, 0x20, 0x4, 0x62, 0xc7, 0x2b, 0x8d, 0x22,
                                     0x98, 0xea, 0xcf, 0xbf, 0x3d, 0xa6, 0xc,  0xa, 0x52, 0x3b, 0xf9, 0x3a};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2875, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13469 [("\144\198\151\135\DC4%l",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\249\GS\245H\207\198\162qF\184@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\198\163V\201\199\CANp\234\161a\f",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\212R\209'",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\STX\192\151\241\157\237\211\129SA\NUL\189\a\138\161\204\137\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("a\225rVu\DLE\US\SOH\242\166$5\217\135?,\DLE\229HF\180\"\207\151",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\232\224",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("oI\179\175\197\204\237\STX\216\167",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\146G*\165",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\v\ENQU\202r'\152\228+\231dA\182MS\255*\137\135\175(",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("+\221^T7\161\222\SOHq>U\192R\187\247\201\195\249\165\214\&9\138\&0b",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0xab, 0x1,  0x34, 0x9d, 0x0,  0x7,  0x90, 0xc6, 0x97, 0x87, 0x14, 0x25, 0x6c, 0x1,  0x0,
                   0xb,  0xf9, 0x1d, 0xf5, 0x48, 0xcf, 0xc6, 0xa2, 0x71, 0x46, 0xb8, 0x40, 0x1,  0x0,  0xb,  0xc6,
                   0xa3, 0x56, 0xc9, 0xc7, 0x18, 0x70, 0xea, 0xa1, 0x61, 0xc,  0x2,  0x0,  0x4,  0xd4, 0x52, 0xd1,
                   0x27, 0x1,  0x0,  0x12, 0x2,  0xc0, 0x97, 0xf1, 0x9d, 0xed, 0xd3, 0x81, 0x53, 0x41, 0x0,  0xbd,
                   0x7,  0x8a, 0xa1, 0xcc, 0x89, 0x1e, 0x1,  0x0,  0x18, 0x61, 0xe1, 0x72, 0x56, 0x75, 0x10, 0x1f,
                   0x1,  0xf2, 0xa6, 0x24, 0x35, 0xd9, 0x87, 0x3f, 0x2c, 0x10, 0xe5, 0x48, 0x46, 0xb4, 0x22, 0xcf,
                   0x97, 0x0,  0x0,  0x2,  0xe8, 0xe0, 0x1,  0x0,  0xa,  0x6f, 0x49, 0xb3, 0xaf, 0xc5, 0xcc, 0xed,
                   0x2,  0xd8, 0xa7, 0x1,  0x0,  0x4,  0x92, 0x47, 0x2a, 0xa5, 0x2,  0x0,  0x15, 0xb,  0x5,  0x55,
                   0xca, 0x72, 0x27, 0x98, 0xe4, 0x2b, 0xe7, 0x64, 0x41, 0xb6, 0x4d, 0x53, 0xff, 0x2a, 0x89, 0x87,
                   0xaf, 0x28, 0x2,  0x0,  0x18, 0x2b, 0xdd, 0x5e, 0x54, 0x37, 0xa1, 0xde, 0x1,  0x71, 0x3e, 0x55,
                   0xc0, 0x52, 0xbb, 0xf7, 0xc9, 0xc3, 0xf9, 0xa5, 0xd6, 0x39, 0x8a, 0x30, 0x62, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x90, 0xc6, 0x97, 0x87, 0x14, 0x25, 0x6c};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf9, 0x1d, 0xf5, 0x48, 0xcf, 0xc6, 0xa2, 0x71, 0x46, 0xb8, 0x40};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc6, 0xa3, 0x56, 0xc9, 0xc7, 0x18, 0x70, 0xea, 0xa1, 0x61, 0xc};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd4, 0x52, 0xd1, 0x27};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2,  0xc0, 0x97, 0xf1, 0x9d, 0xed, 0xd3, 0x81, 0x53,
                                     0x41, 0x0,  0xbd, 0x7,  0x8a, 0xa1, 0xcc, 0x89, 0x1e};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x61, 0xe1, 0x72, 0x56, 0x75, 0x10, 0x1f, 0x1,  0xf2, 0xa6, 0x24, 0x35,
                                     0xd9, 0x87, 0x3f, 0x2c, 0x10, 0xe5, 0x48, 0x46, 0xb4, 0x22, 0xcf, 0x97};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xe8, 0xe0};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6f, 0x49, 0xb3, 0xaf, 0xc5, 0xcc, 0xed, 0x2, 0xd8, 0xa7};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x92, 0x47, 0x2a, 0xa5};
  lwmqtt_string_t topic_filter_s8 = {4, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xb,  0x5,  0x55, 0xca, 0x72, 0x27, 0x98, 0xe4, 0x2b, 0xe7, 0x64,
                                     0x41, 0xb6, 0x4d, 0x53, 0xff, 0x2a, 0x89, 0x87, 0xaf, 0x28};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x2b, 0xdd, 0x5e, 0x54, 0x37, 0xa1, 0xde, 0x1,  0x71, 0x3e, 0x55, 0xc0,
                                      0x52, 0xbb, 0xf7, 0xc9, 0xc3, 0xf9, 0xa5, 0xd6, 0x39, 0x8a, 0x30, 0x62};
  lwmqtt_string_t topic_filter_s10 = {24, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13469, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9632 [("9\192\243\129\177\140\182\244C\213\169\203\&4z!Y\215\&3\200\FS|K\216)",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\150M\179",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x23, 0x25, 0xa0, 0x0,  0x18, 0x39, 0xc0, 0xf3, 0x81, 0xb1, 0x8c, 0xb6,
                   0xf4, 0x43, 0xd5, 0xa9, 0xcb, 0x34, 0x7a, 0x21, 0x59, 0xd7, 0x33, 0xc8, 0x1c,
                   0x7c, 0x4b, 0xd8, 0x29, 0x1,  0x0,  0x3,  0x96, 0x4d, 0xb3, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x39, 0xc0, 0xf3, 0x81, 0xb1, 0x8c, 0xb6, 0xf4, 0x43, 0xd5, 0xa9, 0xcb,
                                     0x34, 0x7a, 0x21, 0x59, 0xd7, 0x33, 0xc8, 0x1c, 0x7c, 0x4b, 0xd8, 0x29};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x96, 0x4d, 0xb3};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9632, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32536 [("\STXFdF1}k\173 c{\188a\199\bh$\SYN\179\&1\a6\DLE\DC1\181",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("{\238\131\204\f\255\221\189\217b\165\148-\170\248\223\222\134{\151p\247\153\164\n",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\137\236\169\249\206aNj\160O\152b\176\230M\205\GS\146\184\213",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("N=\251\238D\139\DC3\SYNL\154))\182\221\132\150\225",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\223!\135V\191\128\&4\190\223\171\&3\234][\195%\175\f||mp\"\214\252\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("r\158\170l\"uyP\tR\f\152\176\140\213\227\&6I\249\187A\177\&7\159\136",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\163\196",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0xa3, 0x1,  0x7f, 0x18, 0x0,  0x19, 0x2,  0x46, 0x64, 0x46, 0x31, 0x7d, 0x6b, 0xad, 0x20, 0x63,
                   0x7b, 0xbc, 0x61, 0xc7, 0x8,  0x68, 0x24, 0x16, 0xb3, 0x31, 0x7,  0x36, 0x10, 0x11, 0xb5, 0x1,  0x0,
                   0x19, 0x7b, 0xee, 0x83, 0xcc, 0xc,  0xff, 0xdd, 0xbd, 0xd9, 0x62, 0xa5, 0x94, 0x2d, 0xaa, 0xf8, 0xdf,
                   0xde, 0x86, 0x7b, 0x97, 0x70, 0xf7, 0x99, 0xa4, 0xa,  0x1,  0x0,  0x14, 0x89, 0xec, 0xa9, 0xf9, 0xce,
                   0x61, 0x4e, 0x6a, 0xa0, 0x4f, 0x98, 0x62, 0xb0, 0xe6, 0x4d, 0xcd, 0x1d, 0x92, 0xb8, 0xd5, 0x2,  0x0,
                   0x11, 0x4e, 0x3d, 0xfb, 0xee, 0x44, 0x8b, 0x13, 0x16, 0x4c, 0x9a, 0x29, 0x29, 0xb6, 0xdd, 0x84, 0x96,
                   0xe1, 0x2,  0x0,  0x1a, 0xdf, 0x21, 0x87, 0x56, 0xbf, 0x80, 0x34, 0xbe, 0xdf, 0xab, 0x33, 0xea, 0x5d,
                   0x5b, 0xc3, 0x25, 0xaf, 0xc,  0x7c, 0x7c, 0x6d, 0x70, 0x22, 0xd6, 0xfc, 0xaa, 0x2,  0x0,  0x19, 0x72,
                   0x9e, 0xaa, 0x6c, 0x22, 0x75, 0x79, 0x50, 0x9,  0x52, 0xc,  0x98, 0xb0, 0x8c, 0xd5, 0xe3, 0x36, 0x49,
                   0xf9, 0xbb, 0x41, 0xb1, 0x37, 0x9f, 0x88, 0x2,  0x0,  0x2,  0xa3, 0xc4, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x2,  0x46, 0x64, 0x46, 0x31, 0x7d, 0x6b, 0xad, 0x20, 0x63, 0x7b, 0xbc, 0x61,
                                     0xc7, 0x8,  0x68, 0x24, 0x16, 0xb3, 0x31, 0x7,  0x36, 0x10, 0x11, 0xb5};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7b, 0xee, 0x83, 0xcc, 0xc,  0xff, 0xdd, 0xbd, 0xd9, 0x62, 0xa5, 0x94, 0x2d,
                                     0xaa, 0xf8, 0xdf, 0xde, 0x86, 0x7b, 0x97, 0x70, 0xf7, 0x99, 0xa4, 0xa};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x89, 0xec, 0xa9, 0xf9, 0xce, 0x61, 0x4e, 0x6a, 0xa0, 0x4f,
                                     0x98, 0x62, 0xb0, 0xe6, 0x4d, 0xcd, 0x1d, 0x92, 0xb8, 0xd5};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4e, 0x3d, 0xfb, 0xee, 0x44, 0x8b, 0x13, 0x16, 0x4c,
                                     0x9a, 0x29, 0x29, 0xb6, 0xdd, 0x84, 0x96, 0xe1};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xdf, 0x21, 0x87, 0x56, 0xbf, 0x80, 0x34, 0xbe, 0xdf, 0xab, 0x33, 0xea, 0x5d,
                                     0x5b, 0xc3, 0x25, 0xaf, 0xc,  0x7c, 0x7c, 0x6d, 0x70, 0x22, 0xd6, 0xfc, 0xaa};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x72, 0x9e, 0xaa, 0x6c, 0x22, 0x75, 0x79, 0x50, 0x9,  0x52, 0xc,  0x98, 0xb0,
                                     0x8c, 0xd5, 0xe3, 0x36, 0x49, 0xf9, 0xbb, 0x41, 0xb1, 0x37, 0x9f, 0x88};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa3, 0xc4};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32536, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8552 [("]4\248\137\131\225_b\212\169\ETB\r",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\189\197\252R\ESC\GSJu",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("8#\221F96b\232\216\162\191\129(\152\184\DEL",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("`\173\EM\193X\175l}[\182\b\194\146S0;0\ESCkSX#:",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\139E\182\226c{\194\248\214N?\196\221\221\195%<\SI9",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\134\147\229\f\251`A\191\GS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("h\248Ay\190)%\\6\168\199",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\182\ETB\208\179\128\200\169RV\232=S+D\223S",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\172\216\203\210O\225",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x95, 0x1,  0x21, 0x68, 0x0,  0xc,  0x5d, 0x34, 0xf8, 0x89, 0x83, 0xe1, 0x5f, 0x62, 0xd4, 0xa9,
                   0x17, 0xd,  0x2,  0x0,  0x8,  0xbd, 0xc5, 0xfc, 0x52, 0x1b, 0x1d, 0x4a, 0x75, 0x2,  0x0,  0x10, 0x38,
                   0x23, 0xdd, 0x46, 0x39, 0x36, 0x62, 0xe8, 0xd8, 0xa2, 0xbf, 0x81, 0x28, 0x98, 0xb8, 0x7f, 0x2,  0x0,
                   0x17, 0x60, 0xad, 0x19, 0xc1, 0x58, 0xaf, 0x6c, 0x7d, 0x5b, 0xb6, 0x8,  0xc2, 0x92, 0x53, 0x30, 0x3b,
                   0x30, 0x1b, 0x6b, 0x53, 0x58, 0x23, 0x3a, 0x1,  0x0,  0x13, 0x8b, 0x45, 0xb6, 0xe2, 0x63, 0x7b, 0xc2,
                   0xf8, 0xd6, 0x4e, 0x3f, 0xc4, 0xdd, 0xdd, 0xc3, 0x25, 0x3c, 0xf,  0x39, 0x1,  0x0,  0x9,  0x86, 0x93,
                   0xe5, 0xc,  0xfb, 0x60, 0x41, 0xbf, 0x1d, 0x0,  0x0,  0xb,  0x68, 0xf8, 0x41, 0x79, 0xbe, 0x29, 0x25,
                   0x5c, 0x36, 0xa8, 0xc7, 0x0,  0x0,  0x10, 0xb6, 0x17, 0xd0, 0xb3, 0x80, 0xc8, 0xa9, 0x52, 0x56, 0xe8,
                   0x3d, 0x53, 0x2b, 0x44, 0xdf, 0x53, 0x1,  0x0,  0x6,  0xac, 0xd8, 0xcb, 0xd2, 0x4f, 0xe1, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x5d, 0x34, 0xf8, 0x89, 0x83, 0xe1, 0x5f, 0x62, 0xd4, 0xa9, 0x17, 0xd};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbd, 0xc5, 0xfc, 0x52, 0x1b, 0x1d, 0x4a, 0x75};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x38, 0x23, 0xdd, 0x46, 0x39, 0x36, 0x62, 0xe8,
                                     0xd8, 0xa2, 0xbf, 0x81, 0x28, 0x98, 0xb8, 0x7f};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x60, 0xad, 0x19, 0xc1, 0x58, 0xaf, 0x6c, 0x7d, 0x5b, 0xb6, 0x8, 0xc2,
                                     0x92, 0x53, 0x30, 0x3b, 0x30, 0x1b, 0x6b, 0x53, 0x58, 0x23, 0x3a};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8b, 0x45, 0xb6, 0xe2, 0x63, 0x7b, 0xc2, 0xf8, 0xd6, 0x4e,
                                     0x3f, 0xc4, 0xdd, 0xdd, 0xc3, 0x25, 0x3c, 0xf,  0x39};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x86, 0x93, 0xe5, 0xc, 0xfb, 0x60, 0x41, 0xbf, 0x1d};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x68, 0xf8, 0x41, 0x79, 0xbe, 0x29, 0x25, 0x5c, 0x36, 0xa8, 0xc7};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb6, 0x17, 0xd0, 0xb3, 0x80, 0xc8, 0xa9, 0x52,
                                     0x56, 0xe8, 0x3d, 0x53, 0x2b, 0x44, 0xdf, 0x53};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xac, 0xd8, 0xcb, 0xd2, 0x4f, 0xe1};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8552, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21918 [("\253`\DLE\211u\248\DLE\EM\254\171\202\139\231",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\232K\189x\159_\CAN>\184'\159\128dT\156,Sx",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\143\f\GS\206\232\253e\EOTnk\201\SOH\129\176\DLE}\249\186\178*\248C\143\134\192\232\DC1T",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\152\143d\215c\ACK\243*\227%\223e5a\210z}\170=7%c\157",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\213\\n\ETX\EM\163L\232\170",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),(".",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\130$g=T];\221D\158\145\220\214\154",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),(")?Gbx/Ti\252/-\ACK\149\&5\176\184\156\\\CAN\ENQ\GS\191",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\139~1f\212\151\NUL\158C_8P",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("mt\246\185$\ENQjC\163\161\DC1\CAN\195\SO-i\224\241\208m",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0xc0, 0x1,  0x55, 0x9e, 0x0,  0xd,  0xfd, 0x60, 0x10, 0xd3, 0x75, 0xf8, 0x10, 0x19, 0xfe, 0xab,
                   0xca, 0x8b, 0xe7, 0x0,  0x0,  0x12, 0xe8, 0x4b, 0xbd, 0x78, 0x9f, 0x5f, 0x18, 0x3e, 0xb8, 0x27, 0x9f,
                   0x80, 0x64, 0x54, 0x9c, 0x2c, 0x53, 0x78, 0x0,  0x0,  0x1c, 0x8f, 0xc,  0x1d, 0xce, 0xe8, 0xfd, 0x65,
                   0x4,  0x6e, 0x6b, 0xc9, 0x1,  0x81, 0xb0, 0x10, 0x7d, 0xf9, 0xba, 0xb2, 0x2a, 0xf8, 0x43, 0x8f, 0x86,
                   0xc0, 0xe8, 0x11, 0x54, 0x2,  0x0,  0x17, 0x98, 0x8f, 0x64, 0xd7, 0x63, 0x6,  0xf3, 0x2a, 0xe3, 0x25,
                   0xdf, 0x65, 0x35, 0x61, 0xd2, 0x7a, 0x7d, 0xaa, 0x3d, 0x37, 0x25, 0x63, 0x9d, 0x2,  0x0,  0x9,  0xd5,
                   0x5c, 0x6e, 0x3,  0x19, 0xa3, 0x4c, 0xe8, 0xaa, 0x1,  0x0,  0x1,  0x2e, 0x1,  0x0,  0xe,  0x82, 0x24,
                   0x67, 0x3d, 0x54, 0x5d, 0x3b, 0xdd, 0x44, 0x9e, 0x91, 0xdc, 0xd6, 0x9a, 0x1,  0x0,  0x16, 0x29, 0x3f,
                   0x47, 0x62, 0x78, 0x2f, 0x54, 0x69, 0xfc, 0x2f, 0x2d, 0x6,  0x95, 0x35, 0xb0, 0xb8, 0x9c, 0x5c, 0x18,
                   0x5,  0x1d, 0xbf, 0x2,  0x0,  0xc,  0x8b, 0x7e, 0x31, 0x66, 0xd4, 0x97, 0x0,  0x9e, 0x43, 0x5f, 0x38,
                   0x50, 0x2,  0x0,  0x14, 0x6d, 0x74, 0xf6, 0xb9, 0x24, 0x5,  0x6a, 0x43, 0xa3, 0xa1, 0x11, 0x18, 0xc3,
                   0xe,  0x2d, 0x69, 0xe0, 0xf1, 0xd0, 0x6d, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xfd, 0x60, 0x10, 0xd3, 0x75, 0xf8, 0x10, 0x19, 0xfe, 0xab, 0xca, 0x8b, 0xe7};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe8, 0x4b, 0xbd, 0x78, 0x9f, 0x5f, 0x18, 0x3e, 0xb8,
                                     0x27, 0x9f, 0x80, 0x64, 0x54, 0x9c, 0x2c, 0x53, 0x78};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8f, 0xc,  0x1d, 0xce, 0xe8, 0xfd, 0x65, 0x4,  0x6e, 0x6b,
                                     0xc9, 0x1,  0x81, 0xb0, 0x10, 0x7d, 0xf9, 0xba, 0xb2, 0x2a,
                                     0xf8, 0x43, 0x8f, 0x86, 0xc0, 0xe8, 0x11, 0x54};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x98, 0x8f, 0x64, 0xd7, 0x63, 0x6,  0xf3, 0x2a, 0xe3, 0x25, 0xdf, 0x65,
                                     0x35, 0x61, 0xd2, 0x7a, 0x7d, 0xaa, 0x3d, 0x37, 0x25, 0x63, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd5, 0x5c, 0x6e, 0x3, 0x19, 0xa3, 0x4c, 0xe8, 0xaa};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2e};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x82, 0x24, 0x67, 0x3d, 0x54, 0x5d, 0x3b,
                                     0xdd, 0x44, 0x9e, 0x91, 0xdc, 0xd6, 0x9a};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x29, 0x3f, 0x47, 0x62, 0x78, 0x2f, 0x54, 0x69, 0xfc, 0x2f, 0x2d,
                                     0x6,  0x95, 0x35, 0xb0, 0xb8, 0x9c, 0x5c, 0x18, 0x5,  0x1d, 0xbf};
  lwmqtt_string_t topic_filter_s7 = {22, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x8b, 0x7e, 0x31, 0x66, 0xd4, 0x97, 0x0, 0x9e, 0x43, 0x5f, 0x38, 0x50};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x6d, 0x74, 0xf6, 0xb9, 0x24, 0x5,  0x6a, 0x43, 0xa3, 0xa1,
                                     0x11, 0x18, 0xc3, 0xe,  0x2d, 0x69, 0xe0, 0xf1, 0xd0, 0x6d};
  lwmqtt_string_t topic_filter_s9 = {20, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21918, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32402 [("\222d\154J\229\133\152\210\152Q\129\228R\184<\202\149\147\206\245\169",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\195\186",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x1f, 0x7e, 0x92, 0x0,  0x15, 0xde, 0x64, 0x9a, 0x4a, 0xe5, 0x85, 0x98, 0xd2, 0x98, 0x51, 0x81,
                   0xe4, 0x52, 0xb8, 0x3c, 0xca, 0x95, 0x93, 0xce, 0xf5, 0xa9, 0x1,  0x0,  0x2,  0xc3, 0xba, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xde, 0x64, 0x9a, 0x4a, 0xe5, 0x85, 0x98, 0xd2, 0x98, 0x51, 0x81,
                                     0xe4, 0x52, 0xb8, 0x3c, 0xca, 0x95, 0x93, 0xce, 0xf5, 0xa9};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc3, 0xba};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 32402, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15317 [("\211!\219\245}\191K\196\v\188\"\238\237R\242F\240\177\144\229",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\200c\DC2\DC4\SO",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\ni",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("v\212>\RS\195wS\195p",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("\DLE|\233_$",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2}),("\249\204\STX\180\161\213{b_\SOHVAT",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\191\217\230\191\SUB\239\135\250\206K\133\131\159)OE\ACK\DC2#\203\133=~",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("B\a\136\184\225Dtd\170\&1\162\128O\189e\160\233\186\135B\248",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1})] [PropUserProperty "\183\208\ETXh"
// "\218\144)@\207\212",PropAuthenticationMethod "\239r6\SYN0\247\147\148\239\246\140S",PropTopicAliasMaximum
// 24388,PropResponseTopic "\190CB\238O\209U\252\241",PropWildcardSubscriptionAvailable 22,PropMessageExpiryInterval
// 1942,PropSubscriptionIdentifier 10,PropRequestProblemInformation 248,PropWillDelayInterval
// 10721,PropWillDelayInterval 18164,PropWildcardSubscriptionAvailable 164,PropReasonString "n\199@\RS\137\ACK(`\244"]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x82, 0xcd, 0x1,  0x3b, 0xd5, 0x50, 0x26, 0x0,  0x4,  0xb7, 0xd0, 0x3,  0x68, 0x0,  0x6,  0xda, 0x90, 0x29, 0x40,
      0xcf, 0xd4, 0x15, 0x0,  0xc,  0xef, 0x72, 0x36, 0x16, 0x30, 0xf7, 0x93, 0x94, 0xef, 0xf6, 0x8c, 0x53, 0x22, 0x5f,
      0x44, 0x8,  0x0,  0x9,  0xbe, 0x43, 0x42, 0xee, 0x4f, 0xd1, 0x55, 0xfc, 0xf1, 0x28, 0x16, 0x2,  0x0,  0x0,  0x7,
      0x96, 0xb,  0xa,  0x17, 0xf8, 0x18, 0x0,  0x0,  0x29, 0xe1, 0x18, 0x0,  0x0,  0x46, 0xf4, 0x28, 0xa4, 0x1f, 0x0,
      0x9,  0x6e, 0xc7, 0x40, 0x1e, 0x89, 0x6,  0x28, 0x60, 0xf4, 0x0,  0x14, 0xd3, 0x21, 0xdb, 0xf5, 0x7d, 0xbf, 0x4b,
      0xc4, 0xb,  0xbc, 0x22, 0xee, 0xed, 0x52, 0xf2, 0x46, 0xf0, 0xb1, 0x90, 0xe5, 0x1,  0x0,  0x5,  0xc8, 0x63, 0x12,
      0x14, 0xe,  0x29, 0x0,  0x2,  0xa,  0x69, 0x4,  0x0,  0x9,  0x76, 0xd4, 0x3e, 0x1e, 0xc3, 0x77, 0x53, 0xc3, 0x70,
      0x10, 0x0,  0x5,  0x10, 0x7c, 0xe9, 0x5f, 0x24, 0x16, 0x0,  0xd,  0xf9, 0xcc, 0x2,  0xb4, 0xa1, 0xd5, 0x7b, 0x62,
      0x5f, 0x1,  0x56, 0x41, 0x54, 0x21, 0x0,  0x17, 0xbf, 0xd9, 0xe6, 0xbf, 0x1a, 0xef, 0x87, 0xfa, 0xce, 0x4b, 0x85,
      0x83, 0x9f, 0x29, 0x4f, 0x45, 0x6,  0x12, 0x23, 0xcb, 0x85, 0x3d, 0x7e, 0x2,  0x0,  0x15, 0x42, 0x7,  0x88, 0xb8,
      0xe1, 0x44, 0x74, 0x64, 0xaa, 0x31, 0xa2, 0x80, 0x4f, 0xbd, 0x65, 0xa0, 0xe9, 0xba, 0x87, 0x42, 0xf8, 0x19};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xd3, 0x21, 0xdb, 0xf5, 0x7d, 0xbf, 0x4b, 0xc4, 0xb,  0xbc,
                                     0x22, 0xee, 0xed, 0x52, 0xf2, 0x46, 0xf0, 0xb1, 0x90, 0xe5};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc8, 0x63, 0x12, 0x14, 0xe};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa, 0x69};
  lwmqtt_string_t topic_filter_s2 = {2, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x76, 0xd4, 0x3e, 0x1e, 0xc3, 0x77, 0x53, 0xc3, 0x70};
  lwmqtt_string_t topic_filter_s3 = {9, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x10, 0x7c, 0xe9, 0x5f, 0x24};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf9, 0xcc, 0x2, 0xb4, 0xa1, 0xd5, 0x7b, 0x62, 0x5f, 0x1, 0x56, 0x41, 0x54};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbf, 0xd9, 0xe6, 0xbf, 0x1a, 0xef, 0x87, 0xfa, 0xce, 0x4b, 0x85, 0x83,
                                     0x9f, 0x29, 0x4f, 0x45, 0x6,  0x12, 0x23, 0xcb, 0x85, 0x3d, 0x7e};
  lwmqtt_string_t topic_filter_s6 = {23, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x42, 0x7,  0x88, 0xb8, 0xe1, 0x44, 0x74, 0x64, 0xaa, 0x31, 0xa2,
                                     0x80, 0x4f, 0xbd, 0x65, 0xa0, 0xe9, 0xba, 0x87, 0x42, 0xf8};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  uint8_t bytesprops1[] = {0xda, 0x90, 0x29, 0x40, 0xcf, 0xd4};
  uint8_t bytesprops0[] = {0xb7, 0xd0, 0x3, 0x68};
  uint8_t bytesprops2[] = {0xef, 0x72, 0x36, 0x16, 0x30, 0xf7, 0x93, 0x94, 0xef, 0xf6, 0x8c, 0x53};
  uint8_t bytesprops3[] = {0xbe, 0x43, 0x42, 0xee, 0x4f, 0xd1, 0x55, 0xfc, 0xf1};
  uint8_t bytesprops4[] = {0x6e, 0xc7, 0x40, 0x1e, 0x89, 0x6, 0x28, 0x60, 0xf4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops0}, .v = {6, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24388}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1942}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10721}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18164}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15317, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2981 [("p\197",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("^w\186",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("Q\CANiG\n\136\149\SOH\aL\225\243%\139\253W\156FD)\188r5\236s\179^\166",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\144\145\182\194\&1'\245",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2})] [PropRequestProblemInformation 162,PropAuthenticationData
// "\141L<\210>",PropUserProperty "\217\204b\CAN\139 \167\225\179\&7\128"
// "/I\219\193\\2\237~\ESC\243\247,\238es\225`",PropUserProperty "\220C\150(Y\241\CAN"
// "\232\199\224@\ESC$\193\140\190&\173?r",PropPayloadFormatIndicator 83,PropTopicAlias 1481,PropAuthenticationMethod
// "D-b\187\&5\206",PropServerReference "\199\253\232",PropSubscriptionIdentifierAvailable 142,PropRetainAvailable
// 222,PropReceiveMaximum 20709,PropAssignedClientIdentifier
// "\EOT\202\&0\227TN\202\178E<\139\ESC\249$I\246n\EOTs\216*\210\ESC\155",PropSharedSubscriptionAvailable
// 49,PropSubscriptionIdentifier 6,PropSubscriptionIdentifierAvailable 103]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x82, 0xb8, 0x1,  0xb,  0xa5, 0x80, 0x1,  0x17, 0xa2, 0x16, 0x0,  0x5,  0x8d, 0x4c, 0x3c, 0xd2, 0x3e, 0x26, 0x0,
      0xb,  0xd9, 0xcc, 0x62, 0x18, 0x8b, 0x20, 0xa7, 0xe1, 0xb3, 0x37, 0x80, 0x0,  0x11, 0x2f, 0x49, 0xdb, 0xc1, 0x5c,
      0x32, 0xed, 0x7e, 0x1b, 0xf3, 0xf7, 0x2c, 0xee, 0x65, 0x73, 0xe1, 0x60, 0x26, 0x0,  0x7,  0xdc, 0x43, 0x96, 0x28,
      0x59, 0xf1, 0x18, 0x0,  0xd,  0xe8, 0xc7, 0xe0, 0x40, 0x1b, 0x24, 0xc1, 0x8c, 0xbe, 0x26, 0xad, 0x3f, 0x72, 0x1,
      0x53, 0x23, 0x5,  0xc9, 0x15, 0x0,  0x6,  0x44, 0x2d, 0x62, 0xbb, 0x35, 0xce, 0x1c, 0x0,  0x3,  0xc7, 0xfd, 0xe8,
      0x29, 0x8e, 0x25, 0xde, 0x21, 0x50, 0xe5, 0x12, 0x0,  0x18, 0x4,  0xca, 0x30, 0xe3, 0x54, 0x4e, 0xca, 0xb2, 0x45,
      0x3c, 0x8b, 0x1b, 0xf9, 0x24, 0x49, 0xf6, 0x6e, 0x4,  0x73, 0xd8, 0x2a, 0xd2, 0x1b, 0x9b, 0x2a, 0x31, 0xb,  0x6,
      0x29, 0x67, 0x0,  0x2,  0x70, 0xc5, 0x1,  0x0,  0x3,  0x5e, 0x77, 0xba, 0x26, 0x0,  0x1c, 0x51, 0x18, 0x69, 0x47,
      0xa,  0x88, 0x95, 0x1,  0x7,  0x4c, 0xe1, 0xf3, 0x25, 0x8b, 0xfd, 0x57, 0x9c, 0x46, 0x44, 0x29, 0xbc, 0x72, 0x35,
      0xec, 0x73, 0xb3, 0x5e, 0xa6, 0x9,  0x0,  0x7,  0x90, 0x91, 0xb6, 0xc2, 0x31, 0x27, 0xf5, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x70, 0xc5};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5e, 0x77, 0xba};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x51, 0x18, 0x69, 0x47, 0xa,  0x88, 0x95, 0x1,  0x7,  0x4c,
                                     0xe1, 0xf3, 0x25, 0x8b, 0xfd, 0x57, 0x9c, 0x46, 0x44, 0x29,
                                     0xbc, 0x72, 0x35, 0xec, 0x73, 0xb3, 0x5e, 0xa6};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x90, 0x91, 0xb6, 0xc2, 0x31, 0x27, 0xf5};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0x8d, 0x4c, 0x3c, 0xd2, 0x3e};
  uint8_t bytesprops2[] = {0x2f, 0x49, 0xdb, 0xc1, 0x5c, 0x32, 0xed, 0x7e, 0x1b,
                           0xf3, 0xf7, 0x2c, 0xee, 0x65, 0x73, 0xe1, 0x60};
  uint8_t bytesprops1[] = {0xd9, 0xcc, 0x62, 0x18, 0x8b, 0x20, 0xa7, 0xe1, 0xb3, 0x37, 0x80};
  uint8_t bytesprops4[] = {0xe8, 0xc7, 0xe0, 0x40, 0x1b, 0x24, 0xc1, 0x8c, 0xbe, 0x26, 0xad, 0x3f, 0x72};
  uint8_t bytesprops3[] = {0xdc, 0x43, 0x96, 0x28, 0x59, 0xf1, 0x18};
  uint8_t bytesprops5[] = {0x44, 0x2d, 0x62, 0xbb, 0x35, 0xce};
  uint8_t bytesprops6[] = {0xc7, 0xfd, 0xe8};
  uint8_t bytesprops7[] = {0x4,  0xca, 0x30, 0xe3, 0x54, 0x4e, 0xca, 0xb2, 0x45, 0x3c, 0x8b, 0x1b,
                           0xf9, 0x24, 0x49, 0xf6, 0x6e, 0x4,  0x73, 0xd8, 0x2a, 0xd2, 0x1b, 0x9b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {17, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops3}, .v = {13, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1481}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20709}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 103}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2981, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15094 [("\210\248\243\&0\128\183m\131\255\nK\158\GS\237\168\184^\196\151
// \163i\204\242\EM/\208",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\195=\233\&0\253\&5Li\207\224\152Y@mA[\139<\135y;\188",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})] [PropMaximumQoS
// 158,PropCorrelationData "\236\181\195\200s\249>",PropMessageExpiryInterval 1325,PropServerReference
// "",PropRetainAvailable 7,PropWildcardSubscriptionAvailable 73,PropMessageExpiryInterval 11841,PropRetainAvailable
// 253,PropWillDelayInterval 9896,PropPayloadFormatIndicator 235,PropResponseInformation "\157",PropTopicAlias
// 7986,PropRequestResponseInformation 160,PropServerReference "\182\NUL#\212\223\230a\214\249
// \199\174\240\177\198J",PropReceiveMaximum 12853,PropResponseTopic
// "A}7X\179\CAN\154\f\184\147o\b\199\217\149\192\SYN\202\161",PropSessionExpiryInterval 25693,PropTopicAlias
// 28576,PropResponseTopic
// "\SO\166\EM\SI\161\183\NUL[\231\&0\STX\168\145\178H\129g\196\FS",PropSubscriptionIdentifierAvailable
// 17,PropTopicAlias 3483,PropMessageExpiryInterval 23576,PropServerReference
// "\251\142",PropWildcardSubscriptionAvailable 154,PropTopicAliasMaximum 8968,PropRequestResponseInformation
// 107,PropReceiveMaximum 23712,PropReceiveMaximum 12987]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0xd0, 0x1,  0x3a, 0xf6, 0x95, 0x1,  0x24, 0x9e, 0x9,  0x0,  0x7,  0xec, 0xb5, 0xc3, 0xc8, 0x73,
                   0xf9, 0x3e, 0x2,  0x0,  0x0,  0x5,  0x2d, 0x1c, 0x0,  0x0,  0x25, 0x7,  0x28, 0x49, 0x2,  0x0,  0x0,
                   0x2e, 0x41, 0x25, 0xfd, 0x18, 0x0,  0x0,  0x26, 0xa8, 0x1,  0xeb, 0x1a, 0x0,  0x1,  0x9d, 0x23, 0x1f,
                   0x32, 0x19, 0xa0, 0x1c, 0x0,  0x10, 0xb6, 0x0,  0x23, 0xd4, 0xdf, 0xe6, 0x61, 0xd6, 0xf9, 0x20, 0xc7,
                   0xae, 0xf0, 0xb1, 0xc6, 0x4a, 0x21, 0x32, 0x35, 0x8,  0x0,  0x13, 0x41, 0x7d, 0x37, 0x58, 0xb3, 0x18,
                   0x9a, 0xc,  0xb8, 0x93, 0x6f, 0x8,  0xc7, 0xd9, 0x95, 0xc0, 0x16, 0xca, 0xa1, 0x11, 0x0,  0x0,  0x64,
                   0x5d, 0x23, 0x6f, 0xa0, 0x8,  0x0,  0x13, 0xe,  0xa6, 0x19, 0xf,  0xa1, 0xb7, 0x0,  0x5b, 0xe7, 0x30,
                   0x2,  0xa8, 0x91, 0xb2, 0x48, 0x81, 0x67, 0xc4, 0x1c, 0x29, 0x11, 0x23, 0xd,  0x9b, 0x2,  0x0,  0x0,
                   0x5c, 0x18, 0x1c, 0x0,  0x2,  0xfb, 0x8e, 0x28, 0x9a, 0x22, 0x23, 0x8,  0x19, 0x6b, 0x21, 0x5c, 0xa0,
                   0x21, 0x32, 0xbb, 0x0,  0x1b, 0xd2, 0xf8, 0xf3, 0x30, 0x80, 0xb7, 0x6d, 0x83, 0xff, 0xa,  0x4b, 0x9e,
                   0x1d, 0xed, 0xa8, 0xb8, 0x5e, 0xc4, 0x97, 0x20, 0xa3, 0x69, 0xcc, 0xf2, 0x19, 0x2f, 0xd0, 0x22, 0x0,
                   0x16, 0xc3, 0x3d, 0xe9, 0x30, 0xfd, 0x35, 0x4c, 0x69, 0xcf, 0xe0, 0x98, 0x59, 0x40, 0x6d, 0x41, 0x5b,
                   0x8b, 0x3c, 0x87, 0x79, 0x3b, 0xbc, 0x5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xd2, 0xf8, 0xf3, 0x30, 0x80, 0xb7, 0x6d, 0x83, 0xff, 0xa,  0x4b, 0x9e, 0x1d, 0xed,
                                     0xa8, 0xb8, 0x5e, 0xc4, 0x97, 0x20, 0xa3, 0x69, 0xcc, 0xf2, 0x19, 0x2f, 0xd0};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc3, 0x3d, 0xe9, 0x30, 0xfd, 0x35, 0x4c, 0x69, 0xcf, 0xe0, 0x98,
                                     0x59, 0x40, 0x6d, 0x41, 0x5b, 0x8b, 0x3c, 0x87, 0x79, 0x3b, 0xbc};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  uint8_t bytesprops0[] = {0xec, 0xb5, 0xc3, 0xc8, 0x73, 0xf9, 0x3e};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x9d};
  uint8_t bytesprops3[] = {0xb6, 0x0,  0x23, 0xd4, 0xdf, 0xe6, 0x61, 0xd6,
                           0xf9, 0x20, 0xc7, 0xae, 0xf0, 0xb1, 0xc6, 0x4a};
  uint8_t bytesprops4[] = {0x41, 0x7d, 0x37, 0x58, 0xb3, 0x18, 0x9a, 0xc,  0xb8, 0x93,
                           0x6f, 0x8,  0xc7, 0xd9, 0x95, 0xc0, 0x16, 0xca, 0xa1};
  uint8_t bytesprops5[] = {0xe, 0xa6, 0x19, 0xf,  0xa1, 0xb7, 0x0,  0x5b, 0xe7, 0x30,
                           0x2, 0xa8, 0x91, 0xb2, 0x48, 0x81, 0x67, 0xc4, 0x1c};
  uint8_t bytesprops6[] = {0xfb, 0x8e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1325}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11841}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9896}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7986}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12853}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25693}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28576}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3483}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23576}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8968}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23712}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12987}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15094, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31975 [("v\DC3\131\242\151\153\129\216\200a\205\NAK\v\195!\164#\222\225\ESC<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("a\238tQ\162\133\229\228\DC3<\233\243=Bx`\165\DLE\146J\255",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("*i\190\134\153\235\221\NUL\181\244\166\143\v\164o2",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("{\242\196\145X\GS
// \170E\155\&3m\235\143B\220h-",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS0}),("\240\182WL\223\230\175\ETX\195gN\NAK\STXM\DC4\SYN\240k\a\229\195\151\248\199",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\144\195e\r\DC2\190\186\229\NUL\DEL\167\202\DC4\190\184X\bB\189\217\236\174<\253\&2\144\US\SYNq",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\136\&9\f\v\189\145\182%\141\241\CAN\176>-\209|;",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\191u\SYN\194\143\199\229#\182\174\STX\150\132\152\142\DC3\US{\221}\245\208\241\211B\155\&8",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("63\167",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True,
// _subQoS = QoS0})] [PropSharedSubscriptionAvailable 156,PropServerReference
// "\137@\183\246\174\160fX(8\171\202\DLEG\129\224`\135\DEL:\158",PropTopicAliasMaximum
// 19848,PropSubscriptionIdentifierAvailable 207,PropSharedSubscriptionAvailable 239,PropMaximumQoS
// 196,PropMessageExpiryInterval 12949,PropWillDelayInterval 19141,PropSubscriptionIdentifierAvailable 84]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xfd, 0x1,  0x7c, 0xe7, 0x2f, 0x2a, 0x9c, 0x1c, 0x0,  0x15, 0x89, 0x40, 0xb7, 0xf6, 0xae, 0xa0, 0x66, 0x58,
      0x28, 0x38, 0xab, 0xca, 0x10, 0x47, 0x81, 0xe0, 0x60, 0x87, 0x7f, 0x3a, 0x9e, 0x22, 0x4d, 0x88, 0x29, 0xcf, 0x2a,
      0xef, 0x24, 0xc4, 0x2,  0x0,  0x0,  0x32, 0x95, 0x18, 0x0,  0x0,  0x4a, 0xc5, 0x29, 0x54, 0x0,  0x15, 0x76, 0x13,
      0x83, 0xf2, 0x97, 0x99, 0x81, 0xd8, 0xc8, 0x61, 0xcd, 0x15, 0xb,  0xc3, 0x21, 0xa4, 0x23, 0xde, 0xe1, 0x1b, 0x3c,
      0xd,  0x0,  0x15, 0x61, 0xee, 0x74, 0x51, 0xa2, 0x85, 0xe5, 0xe4, 0x13, 0x3c, 0xe9, 0xf3, 0x3d, 0x42, 0x78, 0x60,
      0xa5, 0x10, 0x92, 0x4a, 0xff, 0x2d, 0x0,  0x10, 0x2a, 0x69, 0xbe, 0x86, 0x99, 0xeb, 0xdd, 0x0,  0xb5, 0xf4, 0xa6,
      0x8f, 0xb,  0xa4, 0x6f, 0x32, 0x21, 0x0,  0x12, 0x7b, 0xf2, 0xc4, 0x91, 0x58, 0x1d, 0x20, 0xaa, 0x45, 0x9b, 0x33,
      0x6d, 0xeb, 0x8f, 0x42, 0xdc, 0x68, 0x2d, 0x4,  0x0,  0x18, 0xf0, 0xb6, 0x57, 0x4c, 0xdf, 0xe6, 0xaf, 0x3,  0xc3,
      0x67, 0x4e, 0x15, 0x2,  0x4d, 0x14, 0x16, 0xf0, 0x6b, 0x7,  0xe5, 0xc3, 0x97, 0xf8, 0xc7, 0x25, 0x0,  0x1d, 0x90,
      0xc3, 0x65, 0xd,  0x12, 0xbe, 0xba, 0xe5, 0x0,  0x7f, 0xa7, 0xca, 0x14, 0xbe, 0xb8, 0x58, 0x8,  0x42, 0xbd, 0xd9,
      0xec, 0xae, 0x3c, 0xfd, 0x32, 0x90, 0x1f, 0x16, 0x71, 0xd,  0x0,  0x11, 0x88, 0x39, 0xc,  0xb,  0xbd, 0x91, 0xb6,
      0x25, 0x8d, 0xf1, 0x18, 0xb0, 0x3e, 0x2d, 0xd1, 0x7c, 0x3b, 0x1d, 0x0,  0x1b, 0xbf, 0x75, 0x16, 0xc2, 0x8f, 0xc7,
      0xe5, 0x23, 0xb6, 0xae, 0x2,  0x96, 0x84, 0x98, 0x8e, 0x13, 0x1f, 0x7b, 0xdd, 0x7d, 0xf5, 0xd0, 0xf1, 0xd3, 0x42,
      0x9b, 0x38, 0x29, 0x0,  0x3,  0x36, 0x33, 0xa7, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x76, 0x13, 0x83, 0xf2, 0x97, 0x99, 0x81, 0xd8, 0xc8, 0x61, 0xcd,
                                     0x15, 0xb,  0xc3, 0x21, 0xa4, 0x23, 0xde, 0xe1, 0x1b, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x61, 0xee, 0x74, 0x51, 0xa2, 0x85, 0xe5, 0xe4, 0x13, 0x3c, 0xe9,
                                     0xf3, 0x3d, 0x42, 0x78, 0x60, 0xa5, 0x10, 0x92, 0x4a, 0xff};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2a, 0x69, 0xbe, 0x86, 0x99, 0xeb, 0xdd, 0x0,
                                     0xb5, 0xf4, 0xa6, 0x8f, 0xb,  0xa4, 0x6f, 0x32};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x7b, 0xf2, 0xc4, 0x91, 0x58, 0x1d, 0x20, 0xaa, 0x45,
                                     0x9b, 0x33, 0x6d, 0xeb, 0x8f, 0x42, 0xdc, 0x68, 0x2d};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf0, 0xb6, 0x57, 0x4c, 0xdf, 0xe6, 0xaf, 0x3,  0xc3, 0x67, 0x4e, 0x15,
                                     0x2,  0x4d, 0x14, 0x16, 0xf0, 0x6b, 0x7,  0xe5, 0xc3, 0x97, 0xf8, 0xc7};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x90, 0xc3, 0x65, 0xd,  0x12, 0xbe, 0xba, 0xe5, 0x0,  0x7f,
                                     0xa7, 0xca, 0x14, 0xbe, 0xb8, 0x58, 0x8,  0x42, 0xbd, 0xd9,
                                     0xec, 0xae, 0x3c, 0xfd, 0x32, 0x90, 0x1f, 0x16, 0x71};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x88, 0x39, 0xc,  0xb,  0xbd, 0x91, 0xb6, 0x25, 0x8d,
                                     0xf1, 0x18, 0xb0, 0x3e, 0x2d, 0xd1, 0x7c, 0x3b};
  lwmqtt_string_t topic_filter_s6 = {17, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbf, 0x75, 0x16, 0xc2, 0x8f, 0xc7, 0xe5, 0x23, 0xb6, 0xae, 0x2,  0x96, 0x84, 0x98,
                                     0x8e, 0x13, 0x1f, 0x7b, 0xdd, 0x7d, 0xf5, 0xd0, 0xf1, 0xd3, 0x42, 0x9b, 0x38};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x36, 0x33, 0xa7};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0x89, 0x40, 0xb7, 0xf6, 0xae, 0xa0, 0x66, 0x58, 0x28, 0x38, 0xab,
                           0xca, 0x10, 0x47, 0x81, 0xe0, 0x60, 0x87, 0x7f, 0x3a, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19848}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12949}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19141}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 31975, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25478 [("\219SY?\CAN\SOHQE\164",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\183\ENQ\209\132\194\DELz\220\v\150\RSf\145?a\170\217x\159\172",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("v\193\162\ETX\200\RSE\250\235",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS0})] [PropRequestResponseInformation 169,PropReceiveMaximum
// 141,PropReceiveMaximum 29474,PropMessageExpiryInterval 31401,PropMessageExpiryInterval 5256,PropContentType
// "",PropReasonString "\DC1\STX\191\DC2\170\249@\195\226\146\253\f\219\205\135",PropAuthenticationData
// "\133\234\222\210NY\137\155\DC1\148\208;\216\138\254\166",PropMessageExpiryInterval 7843,PropAuthenticationData
// "\134\150\EMu\202\134\SUB\DC1\DC4N\189\239w\170pWY\212\175i\193\r\216\SYN",PropMaximumPacketSize
// 12152,PropContentType "\215\234\214%\FS\160\195[\"\248",PropSubscriptionIdentifierAvailable 224]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x63, 0x86, 0x6e, 0x19, 0xa9, 0x21, 0x0,  0x8d, 0x21, 0x73, 0x22, 0x2,  0x0,  0x0,
                   0x7a, 0xa9, 0x2,  0x0,  0x0,  0x14, 0x88, 0x3,  0x0,  0x0,  0x1f, 0x0,  0xf,  0x11, 0x2,  0xbf, 0x12,
                   0xaa, 0xf9, 0x40, 0xc3, 0xe2, 0x92, 0xfd, 0xc,  0xdb, 0xcd, 0x87, 0x16, 0x0,  0x10, 0x85, 0xea, 0xde,
                   0xd2, 0x4e, 0x59, 0x89, 0x9b, 0x11, 0x94, 0xd0, 0x3b, 0xd8, 0x8a, 0xfe, 0xa6, 0x2,  0x0,  0x0,  0x1e,
                   0xa3, 0x16, 0x0,  0x18, 0x86, 0x96, 0x19, 0x75, 0xca, 0x86, 0x1a, 0x11, 0x14, 0x4e, 0xbd, 0xef, 0x77,
                   0xaa, 0x70, 0x57, 0x59, 0xd4, 0xaf, 0x69, 0xc1, 0xd,  0xd8, 0x16, 0x27, 0x0,  0x0,  0x2f, 0x78, 0x3,
                   0x0,  0xa,  0xd7, 0xea, 0xd6, 0x25, 0x1c, 0xa0, 0xc3, 0x5b, 0x22, 0xf8, 0x29, 0xe0, 0x0,  0x9,  0xdb,
                   0x53, 0x59, 0x3f, 0x18, 0x1,  0x51, 0x45, 0xa4, 0x2c, 0x0,  0x14, 0xb7, 0x5,  0xd1, 0x84, 0xc2, 0x7f,
                   0x7a, 0xdc, 0xb,  0x96, 0x1e, 0x66, 0x91, 0x3f, 0x61, 0xaa, 0xd9, 0x78, 0x9f, 0xac, 0x16, 0x0,  0x9,
                   0x76, 0xc1, 0xa2, 0x3,  0xc8, 0x1e, 0x45, 0xfa, 0xeb, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xdb, 0x53, 0x59, 0x3f, 0x18, 0x1, 0x51, 0x45, 0xa4};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb7, 0x5,  0xd1, 0x84, 0xc2, 0x7f, 0x7a, 0xdc, 0xb,  0x96,
                                     0x1e, 0x66, 0x91, 0x3f, 0x61, 0xaa, 0xd9, 0x78, 0x9f, 0xac};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x76, 0xc1, 0xa2, 0x3, 0xc8, 0x1e, 0x45, 0xfa, 0xeb};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x11, 0x2, 0xbf, 0x12, 0xaa, 0xf9, 0x40, 0xc3, 0xe2, 0x92, 0xfd, 0xc, 0xdb, 0xcd, 0x87};
  uint8_t bytesprops2[] = {0x85, 0xea, 0xde, 0xd2, 0x4e, 0x59, 0x89, 0x9b,
                           0x11, 0x94, 0xd0, 0x3b, 0xd8, 0x8a, 0xfe, 0xa6};
  uint8_t bytesprops3[] = {0x86, 0x96, 0x19, 0x75, 0xca, 0x86, 0x1a, 0x11, 0x14, 0x4e, 0xbd, 0xef,
                           0x77, 0xaa, 0x70, 0x57, 0x59, 0xd4, 0xaf, 0x69, 0xc1, 0xd,  0xd8, 0x16};
  uint8_t bytesprops4[] = {0xd7, 0xea, 0xd6, 0x25, 0x1c, 0xa0, 0xc3, 0x5b, 0x22, 0xf8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 141}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29474}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31401}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5256}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7843}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12152}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 224}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25478, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10292
// [("\216C\ACK\176Ru\154\153\169y\232\US\188\236\130\166\245\218\&8\219\141\156\&2\174\210\231\171\f",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("F\251\229\161W\204c\GS\232y\155\133\149\FS\RS\168!Ni!\230\225\223\"*",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("z\255\209",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})]
// [PropSharedSubscriptionAvailable 81,PropMessageExpiryInterval 27436,PropServerKeepAlive 4051,PropReasonString
// "\f\197\253\156",PropSubscriptionIdentifierAvailable 230,PropAssignedClientIdentifier
// "~q\156\178=8/\244\ETX\212jm\183",PropWillDelayInterval 2198,PropResponseInformation
// "\150\255\CAN\169F8\v\169\199\ACK\tm6\237a\184\212G\185\175\128n\144A\144\DC2}\212",PropSubscriptionIdentifierAvailable
// 233,PropSharedSubscriptionAvailable 118,PropMessageExpiryInterval 2277,PropServerKeepAlive 14258,PropMaximumQoS
// 3,PropTopicAliasMaximum 15364,PropRetainAvailable 21,PropRetainAvailable 110,PropMaximumPacketSize
// 17605,PropMaximumPacketSize 26875,PropSubscriptionIdentifierAvailable 75,PropWillDelayInterval 195,PropReceiveMaximum
// 12419,PropReasonString "+\186\224\238 \239\t\187\200\133\211O#*LD\SYN\244g_5s\143",PropSubscriptionIdentifier
// 6,PropReceiveMaximum 968]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0xd4, 0x1,  0x28, 0x34, 0x8f, 0x1,  0x2a, 0x51, 0x2,  0x0,  0x0,  0x6b, 0x2c, 0x13, 0xf,  0xd3,
                   0x1f, 0x0,  0x4,  0xc,  0xc5, 0xfd, 0x9c, 0x29, 0xe6, 0x12, 0x0,  0xd,  0x7e, 0x71, 0x9c, 0xb2, 0x3d,
                   0x38, 0x2f, 0xf4, 0x3,  0xd4, 0x6a, 0x6d, 0xb7, 0x18, 0x0,  0x0,  0x8,  0x96, 0x1a, 0x0,  0x1c, 0x96,
                   0xff, 0x18, 0xa9, 0x46, 0x38, 0xb,  0xa9, 0xc7, 0x6,  0x9,  0x6d, 0x36, 0xed, 0x61, 0xb8, 0xd4, 0x47,
                   0xb9, 0xaf, 0x80, 0x6e, 0x90, 0x41, 0x90, 0x12, 0x7d, 0xd4, 0x29, 0xe9, 0x2a, 0x76, 0x2,  0x0,  0x0,
                   0x8,  0xe5, 0x13, 0x37, 0xb2, 0x24, 0x3,  0x22, 0x3c, 0x4,  0x25, 0x15, 0x25, 0x6e, 0x27, 0x0,  0x0,
                   0x44, 0xc5, 0x27, 0x0,  0x0,  0x68, 0xfb, 0x29, 0x4b, 0x18, 0x0,  0x0,  0x0,  0xc3, 0x21, 0x30, 0x83,
                   0x1f, 0x0,  0x17, 0x2b, 0xba, 0xe0, 0xee, 0x20, 0xef, 0x9,  0xbb, 0xc8, 0x85, 0xd3, 0x4f, 0x23, 0x2a,
                   0x4c, 0x44, 0x16, 0xf4, 0x67, 0x5f, 0x35, 0x73, 0x8f, 0xb,  0x6,  0x21, 0x3,  0xc8, 0x0,  0x1c, 0xd8,
                   0x43, 0x6,  0xb0, 0x52, 0x75, 0x9a, 0x99, 0xa9, 0x79, 0xe8, 0x1f, 0xbc, 0xec, 0x82, 0xa6, 0xf5, 0xda,
                   0x38, 0xdb, 0x8d, 0x9c, 0x32, 0xae, 0xd2, 0xe7, 0xab, 0xc,  0xe,  0x0,  0x19, 0x46, 0xfb, 0xe5, 0xa1,
                   0x57, 0xcc, 0x63, 0x1d, 0xe8, 0x79, 0x9b, 0x85, 0x95, 0x1c, 0x1e, 0xa8, 0x21, 0x4e, 0x69, 0x21, 0xe6,
                   0xe1, 0xdf, 0x22, 0x2a, 0x15, 0x0,  0x3,  0x7a, 0xff, 0xd1, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xd8, 0x43, 0x6,  0xb0, 0x52, 0x75, 0x9a, 0x99, 0xa9, 0x79, 0xe8, 0x1f, 0xbc, 0xec,
                                     0x82, 0xa6, 0xf5, 0xda, 0x38, 0xdb, 0x8d, 0x9c, 0x32, 0xae, 0xd2, 0xe7, 0xab, 0xc};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x46, 0xfb, 0xe5, 0xa1, 0x57, 0xcc, 0x63, 0x1d, 0xe8, 0x79, 0x9b, 0x85, 0x95,
                                     0x1c, 0x1e, 0xa8, 0x21, 0x4e, 0x69, 0x21, 0xe6, 0xe1, 0xdf, 0x22, 0x2a};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7a, 0xff, 0xd1};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  uint8_t bytesprops0[] = {0xc, 0xc5, 0xfd, 0x9c};
  uint8_t bytesprops1[] = {0x7e, 0x71, 0x9c, 0xb2, 0x3d, 0x38, 0x2f, 0xf4, 0x3, 0xd4, 0x6a, 0x6d, 0xb7};
  uint8_t bytesprops2[] = {0x96, 0xff, 0x18, 0xa9, 0x46, 0x38, 0xb,  0xa9, 0xc7, 0x6,  0x9,  0x6d, 0x36, 0xed,
                           0x61, 0xb8, 0xd4, 0x47, 0xb9, 0xaf, 0x80, 0x6e, 0x90, 0x41, 0x90, 0x12, 0x7d, 0xd4};
  uint8_t bytesprops3[] = {0x2b, 0xba, 0xe0, 0xee, 0x20, 0xef, 0x9,  0xbb, 0xc8, 0x85, 0xd3, 0x4f,
                           0x23, 0x2a, 0x4c, 0x44, 0x16, 0xf4, 0x67, 0x5f, 0x35, 0x73, 0x8f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27436}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4051}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2198}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2277}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14258}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15364}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17605}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26875}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 195}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12419}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 968}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10292, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28082
// [("\140\149\246\194\167\STX\161y\249\132\156~\130\254\201\SOH\t]\158a%Ix(\237v\155\239",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\239\191\NAKC\239\fO\ENQ\137\212*j\228\209\255\241\218\177\130",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\249]\224\SUBw\152l\185\139\aYg\DC1\SOHS\133\172",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("9\191\NAK(\225n\196\ETBp\206\175",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\131\SOHT\174\251+&V\131\139\217F\DC1\151\228j\247b\229",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\138\148\167\139=\204k2\161\181/\146\&0\141]\181\151\NUL\r\188\"\v\132\&1",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\202}\DLEqP\f\228\&3\199\161dJk\216\142XIapF0\134_\205\197\141\244\222\135",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\137ya\140\155\\\DEL\204\FS\216\244Xt\190\NULg\242\174\151\160\243",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\"\DC4#\179\&1\GS#B\162\161\244\172c\DC4&\225",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\193^\197\214\CAN\240\155v(\145\239\174\201\134\236\232l\177\163",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropReasonString
// ";\f\183\150=\237\DLE\162\\H)\183\ENQ\157\DC4\186\224\&0"]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0x81, 0x2,  0x6d, 0xb2, 0x15, 0x1f, 0x0,  0x12, 0x3b, 0xc,  0xb7, 0x96, 0x3d, 0xed, 0x10, 0xa2, 0x5c, 0x48,
      0x29, 0xb7, 0x5,  0x9d, 0x14, 0xba, 0xe0, 0x30, 0x0,  0x1c, 0x8c, 0x95, 0xf6, 0xc2, 0xa7, 0x2,  0xa1, 0x79, 0xf9,
      0x84, 0x9c, 0x7e, 0x82, 0xfe, 0xc9, 0x1,  0x9,  0x5d, 0x9e, 0x61, 0x25, 0x49, 0x78, 0x28, 0xed, 0x76, 0x9b, 0xef,
      0x9,  0x0,  0x13, 0xef, 0xbf, 0x15, 0x43, 0xef, 0xc,  0x4f, 0x5,  0x89, 0xd4, 0x2a, 0x6a, 0xe4, 0xd1, 0xff, 0xf1,
      0xda, 0xb1, 0x82, 0x29, 0x0,  0x11, 0xf9, 0x5d, 0xe0, 0x1a, 0x77, 0x98, 0x6c, 0xb9, 0x8b, 0x7,  0x59, 0x67, 0x11,
      0x1,  0x53, 0x85, 0xac, 0x4,  0x0,  0xb,  0x39, 0xbf, 0x15, 0x28, 0xe1, 0x6e, 0xc4, 0x17, 0x70, 0xce, 0xaf, 0x19,
      0x0,  0x13, 0x83, 0x1,  0x54, 0xae, 0xfb, 0x2b, 0x26, 0x56, 0x83, 0x8b, 0xd9, 0x46, 0x11, 0x97, 0xe4, 0x6a, 0xf7,
      0x62, 0xe5, 0x4,  0x0,  0x18, 0x8a, 0x94, 0xa7, 0x8b, 0x3d, 0xcc, 0x6b, 0x32, 0xa1, 0xb5, 0x2f, 0x92, 0x30, 0x8d,
      0x5d, 0xb5, 0x97, 0x0,  0xd,  0xbc, 0x22, 0xb,  0x84, 0x31, 0xd,  0x0,  0x1d, 0xca, 0x7d, 0x10, 0x71, 0x50, 0xc,
      0xe4, 0x33, 0xc7, 0xa1, 0x64, 0x4a, 0x6b, 0xd8, 0x8e, 0x58, 0x49, 0x61, 0x70, 0x46, 0x30, 0x86, 0x5f, 0xcd, 0xc5,
      0x8d, 0xf4, 0xde, 0x87, 0x18, 0x0,  0x15, 0x89, 0x79, 0x61, 0x8c, 0x9b, 0x5c, 0x7f, 0xcc, 0x1c, 0xd8, 0xf4, 0x58,
      0x74, 0xbe, 0x0,  0x67, 0xf2, 0xae, 0x97, 0xa0, 0xf3, 0x1e, 0x0,  0x10, 0x22, 0x14, 0x23, 0xb3, 0x31, 0x1d, 0x23,
      0x42, 0xa2, 0xa1, 0xf4, 0xac, 0x63, 0x14, 0x26, 0xe1, 0x2,  0x0,  0x13, 0xc1, 0x5e, 0xc5, 0xd6, 0x18, 0xf0, 0x9b,
      0x76, 0x28, 0x91, 0xef, 0xae, 0xc9, 0x86, 0xec, 0xe8, 0x6c, 0xb1, 0xa3, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x8c, 0x95, 0xf6, 0xc2, 0xa7, 0x2,  0xa1, 0x79, 0xf9, 0x84,
                                     0x9c, 0x7e, 0x82, 0xfe, 0xc9, 0x1,  0x9,  0x5d, 0x9e, 0x61,
                                     0x25, 0x49, 0x78, 0x28, 0xed, 0x76, 0x9b, 0xef};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xef, 0xbf, 0x15, 0x43, 0xef, 0xc,  0x4f, 0x5,  0x89, 0xd4,
                                     0x2a, 0x6a, 0xe4, 0xd1, 0xff, 0xf1, 0xda, 0xb1, 0x82};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf9, 0x5d, 0xe0, 0x1a, 0x77, 0x98, 0x6c, 0xb9, 0x8b,
                                     0x7,  0x59, 0x67, 0x11, 0x1,  0x53, 0x85, 0xac};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x39, 0xbf, 0x15, 0x28, 0xe1, 0x6e, 0xc4, 0x17, 0x70, 0xce, 0xaf};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x83, 0x1,  0x54, 0xae, 0xfb, 0x2b, 0x26, 0x56, 0x83, 0x8b,
                                     0xd9, 0x46, 0x11, 0x97, 0xe4, 0x6a, 0xf7, 0x62, 0xe5};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8a, 0x94, 0xa7, 0x8b, 0x3d, 0xcc, 0x6b, 0x32, 0xa1, 0xb5, 0x2f, 0x92,
                                     0x30, 0x8d, 0x5d, 0xb5, 0x97, 0x0,  0xd,  0xbc, 0x22, 0xb,  0x84, 0x31};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xca, 0x7d, 0x10, 0x71, 0x50, 0xc,  0xe4, 0x33, 0xc7, 0xa1,
                                     0x64, 0x4a, 0x6b, 0xd8, 0x8e, 0x58, 0x49, 0x61, 0x70, 0x46,
                                     0x30, 0x86, 0x5f, 0xcd, 0xc5, 0x8d, 0xf4, 0xde, 0x87};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x89, 0x79, 0x61, 0x8c, 0x9b, 0x5c, 0x7f, 0xcc, 0x1c, 0xd8, 0xf4,
                                     0x58, 0x74, 0xbe, 0x0,  0x67, 0xf2, 0xae, 0x97, 0xa0, 0xf3};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x22, 0x14, 0x23, 0xb3, 0x31, 0x1d, 0x23, 0x42,
                                     0xa2, 0xa1, 0xf4, 0xac, 0x63, 0x14, 0x26, 0xe1};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xc1, 0x5e, 0xc5, 0xd6, 0x18, 0xf0, 0x9b, 0x76, 0x28, 0x91,
                                     0xef, 0xae, 0xc9, 0x86, 0xec, 0xe8, 0x6c, 0xb1, 0xa3};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  uint8_t bytesprops0[] = {0x3b, 0xc,  0xb7, 0x96, 0x3d, 0xed, 0x10, 0xa2, 0x5c,
                           0x48, 0x29, 0xb7, 0x5,  0x9d, 0x14, 0xba, 0xe0, 0x30};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28082, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8250 [("\237(\254^Q",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS1}),("=\197G\215j^\203%xY\252S\159\251\180\234\169\174\246\185\251",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\223H\213n$\254\160\161A\252\180\193Z\219\143",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("=\193w\237l:\149\177\EOT\a\200",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\217k\215\DC3\211\248\152\216\156\139\ETBo\175\246\239\183\DC3&\SYN1G\139\196n\164",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})]
// [PropSubscriptionIdentifierAvailable 201,PropRetainAvailable 127,PropReceiveMaximum 3921,PropSessionExpiryInterval
// 14620,PropSessionExpiryInterval 13880,PropWillDelayInterval 25317,PropPayloadFormatIndicator 13,PropTopicAliasMaximum
// 29847,PropMessageExpiryInterval 10331,PropRequestProblemInformation 216,PropPayloadFormatIndicator
// 234,PropMaximumPacketSize 3753,PropMessageExpiryInterval 2418,PropSubscriptionIdentifier
// 6,PropRequestProblemInformation 153,PropPayloadFormatIndicator 236,PropWillDelayInterval 7178,PropServerReference
// "yV\198\185\167n0\RS\178\DELs\221\218\163d\186\128h\150\252\246`\189\133\164\166]\210",PropReceiveMaximum
// 16636,PropPayloadFormatIndicator 119,PropCorrelationData "\FS(WY=\235\139\209f\228\NAK",PropPayloadFormatIndicator
// 0,PropReasonString "",PropReasonString "Iv\173\184O\EM|J\DC3\243\"\255ft4"]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0xe2, 0x1,  0x20, 0x3a, 0x82, 0x1,  0x29, 0xc9, 0x25, 0x7f, 0x21, 0xf,  0x51, 0x11, 0x0,  0x0,
                   0x39, 0x1c, 0x11, 0x0,  0x0,  0x36, 0x38, 0x18, 0x0,  0x0,  0x62, 0xe5, 0x1,  0xd,  0x22, 0x74, 0x97,
                   0x2,  0x0,  0x0,  0x28, 0x5b, 0x17, 0xd8, 0x1,  0xea, 0x27, 0x0,  0x0,  0xe,  0xa9, 0x2,  0x0,  0x0,
                   0x9,  0x72, 0xb,  0x6,  0x17, 0x99, 0x1,  0xec, 0x18, 0x0,  0x0,  0x1c, 0xa,  0x1c, 0x0,  0x1c, 0x79,
                   0x56, 0xc6, 0xb9, 0xa7, 0x6e, 0x30, 0x1e, 0xb2, 0x7f, 0x73, 0xdd, 0xda, 0xa3, 0x64, 0xba, 0x80, 0x68,
                   0x96, 0xfc, 0xf6, 0x60, 0xbd, 0x85, 0xa4, 0xa6, 0x5d, 0xd2, 0x21, 0x40, 0xfc, 0x1,  0x77, 0x9,  0x0,
                   0xb,  0x1c, 0x28, 0x57, 0x59, 0x3d, 0xeb, 0x8b, 0xd1, 0x66, 0xe4, 0x15, 0x1,  0x0,  0x1f, 0x0,  0x0,
                   0x1f, 0x0,  0xf,  0x49, 0x76, 0xad, 0xb8, 0x4f, 0x19, 0x7c, 0x4a, 0x13, 0xf3, 0x22, 0xff, 0x66, 0x74,
                   0x34, 0x0,  0x5,  0xed, 0x28, 0xfe, 0x5e, 0x51, 0x25, 0x0,  0x15, 0x3d, 0xc5, 0x47, 0xd7, 0x6a, 0x5e,
                   0xcb, 0x25, 0x78, 0x59, 0xfc, 0x53, 0x9f, 0xfb, 0xb4, 0xea, 0xa9, 0xae, 0xf6, 0xb9, 0xfb, 0x22, 0x0,
                   0xf,  0xdf, 0x48, 0xd5, 0x6e, 0x24, 0xfe, 0xa0, 0xa1, 0x41, 0xfc, 0xb4, 0xc1, 0x5a, 0xdb, 0x8f, 0xd,
                   0x0,  0xb,  0x3d, 0xc1, 0x77, 0xed, 0x6c, 0x3a, 0x95, 0xb1, 0x4,  0x7,  0xc8, 0x14, 0x0,  0x19, 0xd9,
                   0x6b, 0xd7, 0x13, 0xd3, 0xf8, 0x98, 0xd8, 0x9c, 0x8b, 0x17, 0x6f, 0xaf, 0xf6, 0xef, 0xb7, 0x13, 0x26,
                   0x16, 0x31, 0x47, 0x8b, 0xc4, 0x6e, 0xa4, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xed, 0x28, 0xfe, 0x5e, 0x51};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3d, 0xc5, 0x47, 0xd7, 0x6a, 0x5e, 0xcb, 0x25, 0x78, 0x59, 0xfc,
                                     0x53, 0x9f, 0xfb, 0xb4, 0xea, 0xa9, 0xae, 0xf6, 0xb9, 0xfb};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdf, 0x48, 0xd5, 0x6e, 0x24, 0xfe, 0xa0, 0xa1,
                                     0x41, 0xfc, 0xb4, 0xc1, 0x5a, 0xdb, 0x8f};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3d, 0xc1, 0x77, 0xed, 0x6c, 0x3a, 0x95, 0xb1, 0x4, 0x7, 0xc8};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd9, 0x6b, 0xd7, 0x13, 0xd3, 0xf8, 0x98, 0xd8, 0x9c, 0x8b, 0x17, 0x6f, 0xaf,
                                     0xf6, 0xef, 0xb7, 0x13, 0x26, 0x16, 0x31, 0x47, 0x8b, 0xc4, 0x6e, 0xa4};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0x79, 0x56, 0xc6, 0xb9, 0xa7, 0x6e, 0x30, 0x1e, 0xb2, 0x7f, 0x73, 0xdd, 0xda, 0xa3,
                           0x64, 0xba, 0x80, 0x68, 0x96, 0xfc, 0xf6, 0x60, 0xbd, 0x85, 0xa4, 0xa6, 0x5d, 0xd2};
  uint8_t bytesprops1[] = {0x1c, 0x28, 0x57, 0x59, 0x3d, 0xeb, 0x8b, 0xd1, 0x66, 0xe4, 0x15};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x49, 0x76, 0xad, 0xb8, 0x4f, 0x19, 0x7c, 0x4a, 0x13, 0xf3, 0x22, 0xff, 0x66, 0x74, 0x34};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3921}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14620}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 13880}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25317}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29847}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10331}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3753}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2418}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7178}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 16636}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8250, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2359 [("\EM\174:\184\155\&9\131\194\148",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropSharedSubscriptionAvailable
// 213,PropPayloadFormatIndicator 45,PropRequestProblemInformation 15,PropResponseInformation
// "2Z\216W7\DLEa\ESC4r\DC4h`\EOT\157\&4*Y\181\159\151\201P\152\SYN\245ke",PropTopicAlias 17577,PropMaximumQoS
// 139,PropMessageExpiryInterval 13699,PropRequestResponseInformation 147,PropSubscriptionIdentifierAvailable
// 7,PropSubscriptionIdentifier 25,PropRetainAvailable 108,PropSubscriptionIdentifierAvailable 214,PropContentType
// "M",PropSubscriptionIdentifier 4,PropWildcardSubscriptionAvailable 226,PropReceiveMaximum
// 9422,PropAuthenticationMethod "\242\SO\a\EM",PropWillDelayInterval 26420,PropResponseInformation
// "\\\b(<\201\190\229_\152",PropMessageExpiryInterval 18588,PropAuthenticationData
// "\147\150\&7\241\182\197\209",PropReasonString
// "6\184\&3\145\152\193\242\139\128\201S\224\&9",PropAssignedClientIdentifier
// "\ESC\164\SOH\245\249\197\255\DC3b\155\199\132.",PropWildcardSubscriptionAvailable 76,PropContentType
// "\233\t\166",PropSubscriptionIdentifierAvailable 84,PropMessageExpiryInterval 3926,PropCorrelationData
// "H\172\172\&2\159\\\ETX\164\NAKhc\251\220\206\183 \151\252\140]\166\196",PropTopicAliasMaximum 5271]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0xc6, 0x1,  0x9,  0x37, 0xb6, 0x1,  0x2a, 0xd5, 0x1,  0x2d, 0x17, 0xf,  0x1a, 0x0,  0x1c, 0x32,
                   0x5a, 0xd8, 0x57, 0x37, 0x10, 0x61, 0x1b, 0x34, 0x72, 0x14, 0x68, 0x60, 0x4,  0x9d, 0x34, 0x2a, 0x59,
                   0xb5, 0x9f, 0x97, 0xc9, 0x50, 0x98, 0x16, 0xf5, 0x6b, 0x65, 0x23, 0x44, 0xa9, 0x24, 0x8b, 0x2,  0x0,
                   0x0,  0x35, 0x83, 0x19, 0x93, 0x29, 0x7,  0xb,  0x19, 0x25, 0x6c, 0x29, 0xd6, 0x3,  0x0,  0x1,  0x4d,
                   0xb,  0x4,  0x28, 0xe2, 0x21, 0x24, 0xce, 0x15, 0x0,  0x4,  0xf2, 0xe,  0x7,  0x19, 0x18, 0x0,  0x0,
                   0x67, 0x34, 0x1a, 0x0,  0x9,  0x5c, 0x8,  0x28, 0x3c, 0xc9, 0xbe, 0xe5, 0x5f, 0x98, 0x2,  0x0,  0x0,
                   0x48, 0x9c, 0x16, 0x0,  0x7,  0x93, 0x96, 0x37, 0xf1, 0xb6, 0xc5, 0xd1, 0x1f, 0x0,  0xd,  0x36, 0xb8,
                   0x33, 0x91, 0x98, 0xc1, 0xf2, 0x8b, 0x80, 0xc9, 0x53, 0xe0, 0x39, 0x12, 0x0,  0xd,  0x1b, 0xa4, 0x1,
                   0xf5, 0xf9, 0xc5, 0xff, 0x13, 0x62, 0x9b, 0xc7, 0x84, 0x2e, 0x28, 0x4c, 0x3,  0x0,  0x3,  0xe9, 0x9,
                   0xa6, 0x29, 0x54, 0x2,  0x0,  0x0,  0xf,  0x56, 0x9,  0x0,  0x16, 0x48, 0xac, 0xac, 0x32, 0x9f, 0x5c,
                   0x3,  0xa4, 0x15, 0x68, 0x63, 0xfb, 0xdc, 0xce, 0xb7, 0x20, 0x97, 0xfc, 0x8c, 0x5d, 0xa6, 0xc4, 0x22,
                   0x14, 0x97, 0x0,  0x9,  0x19, 0xae, 0x3a, 0xb8, 0x9b, 0x39, 0x83, 0xc2, 0x94, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x19, 0xae, 0x3a, 0xb8, 0x9b, 0x39, 0x83, 0xc2, 0x94};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0x32, 0x5a, 0xd8, 0x57, 0x37, 0x10, 0x61, 0x1b, 0x34, 0x72, 0x14, 0x68, 0x60, 0x4,
                           0x9d, 0x34, 0x2a, 0x59, 0xb5, 0x9f, 0x97, 0xc9, 0x50, 0x98, 0x16, 0xf5, 0x6b, 0x65};
  uint8_t bytesprops1[] = {0x4d};
  uint8_t bytesprops2[] = {0xf2, 0xe, 0x7, 0x19};
  uint8_t bytesprops3[] = {0x5c, 0x8, 0x28, 0x3c, 0xc9, 0xbe, 0xe5, 0x5f, 0x98};
  uint8_t bytesprops4[] = {0x93, 0x96, 0x37, 0xf1, 0xb6, 0xc5, 0xd1};
  uint8_t bytesprops5[] = {0x36, 0xb8, 0x33, 0x91, 0x98, 0xc1, 0xf2, 0x8b, 0x80, 0xc9, 0x53, 0xe0, 0x39};
  uint8_t bytesprops6[] = {0x1b, 0xa4, 0x1, 0xf5, 0xf9, 0xc5, 0xff, 0x13, 0x62, 0x9b, 0xc7, 0x84, 0x2e};
  uint8_t bytesprops7[] = {0xe9, 0x9, 0xa6};
  uint8_t bytesprops8[] = {0x48, 0xac, 0xac, 0x32, 0x9f, 0x5c, 0x3,  0xa4, 0x15, 0x68, 0x63,
                           0xfb, 0xdc, 0xce, 0xb7, 0x20, 0x97, 0xfc, 0x8c, 0x5d, 0xa6, 0xc4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17577}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13699}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 25}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9422}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26420}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18588}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3926}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5271}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2359, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16794 [("K\236r=\152\194\134Z}\181\&3:\143\143u\164\DC1\208\150\146\248\ETB",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\RS\SUB\bJ\131u",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS1}),("",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS0}),("\195J\198\164\135",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS0}),("\188\161\156\135\DEL\148\RS\249@\DC3\187",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\216mP\206\&1\135\r\155\237\&0\DC4R\175$\254h\NAKN\f",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropAssignedClientIdentifier
// "",PropMessageExpiryInterval 18708,PropContentType
// "F1\ETXrk]@\239\211(\SOH\235\143\DC2\ESCiSucsM\184\161$",PropReceiveMaximum 15395,PropServerReference
// "\181\182/\141L\140\237K\DC2\138\183\NAK\193\&7\132\139k\165\213\151",PropMessageExpiryInterval 5921,PropContentType
// "g\197\204z*\206\186\141\195ln\DLE\190m\DC2\235\213",PropResponseInformation
// "\240\FS,\135\203yI\146e\160\133\190",PropRequestProblemInformation 70,PropSessionExpiryInterval 10978,PropMaximumQoS
// 128,PropMaximumQoS 111]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0xc4, 0x1,  0x41, 0x9a, 0x70, 0x12, 0x0,  0x0,  0x2,  0x0,  0x0,  0x49, 0x14, 0x3,  0x0,  0x18,
                   0x46, 0x31, 0x3,  0x72, 0x6b, 0x5d, 0x40, 0xef, 0xd3, 0x28, 0x1,  0xeb, 0x8f, 0x12, 0x1b, 0x69, 0x53,
                   0x75, 0x63, 0x73, 0x4d, 0xb8, 0xa1, 0x24, 0x21, 0x3c, 0x23, 0x1c, 0x0,  0x14, 0xb5, 0xb6, 0x2f, 0x8d,
                   0x4c, 0x8c, 0xed, 0x4b, 0x12, 0x8a, 0xb7, 0x15, 0xc1, 0x37, 0x84, 0x8b, 0x6b, 0xa5, 0xd5, 0x97, 0x2,
                   0x0,  0x0,  0x17, 0x21, 0x3,  0x0,  0x11, 0x67, 0xc5, 0xcc, 0x7a, 0x2a, 0xce, 0xba, 0x8d, 0xc3, 0x6c,
                   0x6e, 0x10, 0xbe, 0x6d, 0x12, 0xeb, 0xd5, 0x1a, 0x0,  0xc,  0xf0, 0x1c, 0x2c, 0x87, 0xcb, 0x79, 0x49,
                   0x92, 0x65, 0xa0, 0x85, 0xbe, 0x17, 0x46, 0x11, 0x0,  0x0,  0x2a, 0xe2, 0x24, 0x80, 0x24, 0x6f, 0x0,
                   0x16, 0x4b, 0xec, 0x72, 0x3d, 0x98, 0xc2, 0x86, 0x5a, 0x7d, 0xb5, 0x33, 0x3a, 0x8f, 0x8f, 0x75, 0xa4,
                   0x11, 0xd0, 0x96, 0x92, 0xf8, 0x17, 0xd,  0x0,  0x6,  0x1e, 0x1a, 0x8,  0x4a, 0x83, 0x75, 0x15, 0x0,
                   0x0,  0x18, 0x0,  0x5,  0xc3, 0x4a, 0xc6, 0xa4, 0x87, 0x1c, 0x0,  0xb,  0xbc, 0xa1, 0x9c, 0x87, 0x7f,
                   0x94, 0x1e, 0xf9, 0x40, 0x13, 0xbb, 0xc,  0x0,  0x13, 0xd8, 0x6d, 0x50, 0xce, 0x31, 0x87, 0xd,  0x9b,
                   0xed, 0x30, 0x14, 0x52, 0xaf, 0x24, 0xfe, 0x68, 0x15, 0x4e, 0xc,  0x16};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x4b, 0xec, 0x72, 0x3d, 0x98, 0xc2, 0x86, 0x5a, 0x7d, 0xb5, 0x33,
                                     0x3a, 0x8f, 0x8f, 0x75, 0xa4, 0x11, 0xd0, 0x96, 0x92, 0xf8, 0x17};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0x1a, 0x8, 0x4a, 0x83, 0x75};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc3, 0x4a, 0xc6, 0xa4, 0x87};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbc, 0xa1, 0x9c, 0x87, 0x7f, 0x94, 0x1e, 0xf9, 0x40, 0x13, 0xbb};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd8, 0x6d, 0x50, 0xce, 0x31, 0x87, 0xd,  0x9b, 0xed, 0x30,
                                     0x14, 0x52, 0xaf, 0x24, 0xfe, 0x68, 0x15, 0x4e, 0xc};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x46, 0x31, 0x3,  0x72, 0x6b, 0x5d, 0x40, 0xef, 0xd3, 0x28, 0x1,  0xeb,
                           0x8f, 0x12, 0x1b, 0x69, 0x53, 0x75, 0x63, 0x73, 0x4d, 0xb8, 0xa1, 0x24};
  uint8_t bytesprops2[] = {0xb5, 0xb6, 0x2f, 0x8d, 0x4c, 0x8c, 0xed, 0x4b, 0x12, 0x8a,
                           0xb7, 0x15, 0xc1, 0x37, 0x84, 0x8b, 0x6b, 0xa5, 0xd5, 0x97};
  uint8_t bytesprops3[] = {0x67, 0xc5, 0xcc, 0x7a, 0x2a, 0xce, 0xba, 0x8d, 0xc3,
                           0x6c, 0x6e, 0x10, 0xbe, 0x6d, 0x12, 0xeb, 0xd5};
  uint8_t bytesprops4[] = {0xf0, 0x1c, 0x2c, 0x87, 0xcb, 0x79, 0x49, 0x92, 0x65, 0xa0, 0x85, 0xbe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18708}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15395}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5921}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10978}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 111}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 16794, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9525 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("Y",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS0}),("yTU\212\STX\n0g\ETB\216;\193\141^of\176\131l\247\243\175\226W!\218\226\143&Y",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\129",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2}),("\158\142\237\223\DEL\238TE#\174\&4\RS\247x\152d\195\167u\246\255\201\167\162=\206-",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\169\195$\148J\198r\134D\151\160\STX%j\191\201\209\170\156t\r\244k\183\198",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\DC4&y\247\168\&1W\NUL\245\&6\237\210\150i",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("cQ_y\200\249",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\STX\217 \170>\EM",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\STX\135*",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False,
// _subQoS = QoS0}),("]\141\210\RS\186\238\n\ESC\GSj\131\174\190;\136\207Ofzf'",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})]
// [PropWildcardSubscriptionAvailable 205,PropMessageExpiryInterval 18112,PropReceiveMaximum
// 22374,PropPayloadFormatIndicator 97,PropReasonString
// "D:\165\232\200\&4\239=\222\147\149Ck\207\228\130\SOHi\253\161q8\223p\FS\133\SO\156\181\159"]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {0x82, 0xd7, 0x1,  0x25, 0x35, 0x2d, 0x28, 0xcd, 0x2,  0x0,  0x0,  0x46, 0xc0, 0x21, 0x57, 0x66, 0x1,
                   0x61, 0x1f, 0x0,  0x1e, 0x44, 0x3a, 0xa5, 0xe8, 0xc8, 0x34, 0xef, 0x3d, 0xde, 0x93, 0x95, 0x43, 0x6b,
                   0xcf, 0xe4, 0x82, 0x1,  0x69, 0xfd, 0xa1, 0x71, 0x38, 0xdf, 0x70, 0x1c, 0x85, 0xe,  0x9c, 0xb5, 0x9f,
                   0x0,  0x0,  0x1,  0x0,  0x1,  0x59, 0x18, 0x0,  0x1e, 0x79, 0x54, 0x55, 0xd4, 0x2,  0xa,  0x30, 0x67,
                   0x17, 0xd8, 0x3b, 0xc1, 0x8d, 0x5e, 0x6f, 0x66, 0xb0, 0x83, 0x6c, 0xf7, 0xf3, 0xaf, 0xe2, 0x57, 0x21,
                   0xda, 0xe2, 0x8f, 0x26, 0x59, 0x24, 0x0,  0x1,  0x81, 0x22, 0x0,  0x1b, 0x9e, 0x8e, 0xed, 0xdf, 0x7f,
                   0xee, 0x54, 0x45, 0x23, 0xae, 0x34, 0x1e, 0xf7, 0x78, 0x98, 0x64, 0xc3, 0xa7, 0x75, 0xf6, 0xff, 0xc9,
                   0xa7, 0xa2, 0x3d, 0xce, 0x2d, 0x28, 0x0,  0x19, 0xa9, 0xc3, 0x24, 0x94, 0x4a, 0xc6, 0x72, 0x86, 0x44,
                   0x97, 0xa0, 0x2,  0x25, 0x6a, 0xbf, 0xc9, 0xd1, 0xaa, 0x9c, 0x74, 0xd,  0xf4, 0x6b, 0xb7, 0xc6, 0x15,
                   0x0,  0xe,  0x14, 0x26, 0x79, 0xf7, 0xa8, 0x31, 0x57, 0x0,  0xf5, 0x36, 0xed, 0xd2, 0x96, 0x69, 0x16,
                   0x0,  0x6,  0x63, 0x51, 0x5f, 0x79, 0xc8, 0xf9, 0x5,  0x0,  0x6,  0x2,  0xd9, 0x20, 0xaa, 0x3e, 0x19,
                   0x21, 0x0,  0x3,  0x2,  0x87, 0x2a, 0x8,  0x0,  0x15, 0x5d, 0x8d, 0xd2, 0x1e, 0xba, 0xee, 0xa,  0x1b,
                   0x1d, 0x6a, 0x83, 0xae, 0xbe, 0x3b, 0x88, 0xcf, 0x4f, 0x66, 0x7a, 0x66, 0x27, 0x28};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x59};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x79, 0x54, 0x55, 0xd4, 0x2,  0xa,  0x30, 0x67, 0x17, 0xd8,
                                     0x3b, 0xc1, 0x8d, 0x5e, 0x6f, 0x66, 0xb0, 0x83, 0x6c, 0xf7,
                                     0xf3, 0xaf, 0xe2, 0x57, 0x21, 0xda, 0xe2, 0x8f, 0x26, 0x59};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x81};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9e, 0x8e, 0xed, 0xdf, 0x7f, 0xee, 0x54, 0x45, 0x23, 0xae, 0x34, 0x1e, 0xf7, 0x78,
                                     0x98, 0x64, 0xc3, 0xa7, 0x75, 0xf6, 0xff, 0xc9, 0xa7, 0xa2, 0x3d, 0xce, 0x2d};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa9, 0xc3, 0x24, 0x94, 0x4a, 0xc6, 0x72, 0x86, 0x44, 0x97, 0xa0, 0x2, 0x25,
                                     0x6a, 0xbf, 0xc9, 0xd1, 0xaa, 0x9c, 0x74, 0xd,  0xf4, 0x6b, 0xb7, 0xc6};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x14, 0x26, 0x79, 0xf7, 0xa8, 0x31, 0x57, 0x0, 0xf5, 0x36, 0xed, 0xd2, 0x96, 0x69};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x63, 0x51, 0x5f, 0x79, 0xc8, 0xf9};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2, 0xd9, 0x20, 0xaa, 0x3e, 0x19};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2, 0x87, 0x2a};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x5d, 0x8d, 0xd2, 0x1e, 0xba, 0xee, 0xa,  0x1b, 0x1d, 0x6a, 0x83,
                                      0xae, 0xbe, 0x3b, 0x88, 0xcf, 0x4f, 0x66, 0x7a, 0x66, 0x27};
  lwmqtt_string_t topic_filter_s10 = {21, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0x44, 0x3a, 0xa5, 0xe8, 0xc8, 0x34, 0xef, 0x3d, 0xde, 0x93, 0x95, 0x43, 0x6b, 0xcf, 0xe4,
                           0x82, 0x1,  0x69, 0xfd, 0xa1, 0x71, 0x38, 0xdf, 0x70, 0x1c, 0x85, 0xe,  0x9c, 0xb5, 0x9f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18112}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22374}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9525, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 25695 [("",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal
// = True, _subQoS = QoS2}),("\186\219\215",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\201bK\187'\a\ENQ\157\250\DLE",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("X\223\196\156",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\244hB>\204s
// 1\US\233\145\133\178:\129\154\238z\SYN\152-\244tq\DC1\146",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\EOT\188\214C\158\190\234\ETBt\229\GSR\139N\217\SO\240\245\ENQ\173G;\153@\183",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("W406\252\156\\\212\&3\b\203$\187\247\DC2\235\v\134\181\231",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\191\ESC+\"q",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("!\138\RS@\137\CANP!\SOH]\f\250\244\251h\232\242\241\241\218",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\STX\134\223\174XA\133.\245g\FS~\224\173\r\158\EOT\165\NAK",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] [PropContentType
// "13\214}\186\247\170\vg}",PropSharedSubscriptionAvailable 57,PropReceiveMaximum 1860,PropRequestResponseInformation
// 201,PropServerKeepAlive 31340,PropTopicAliasMaximum 14073,PropRequestProblemInformation 46,PropSessionExpiryInterval
// 7295,PropCorrelationData "\143\&5\135w\134\SOH\211v\141\132\202\187%s\140",PropServerReference
// "\DC1\215\170\&9d\155z\225",PropMessageExpiryInterval 6877,PropServerReference
// "\240Q/",PropSharedSubscriptionAvailable 143,PropSharedSubscriptionAvailable 239,PropServerReference
// "\rwMl\152\198h\219\175\148j\198M\244\EOT\227H}\210",PropReceiveMaximum 26293,PropCorrelationData
// "\241n\226\&0\250e\SOH\165\195\255",PropWillDelayInterval 24693,PropAuthenticationData
// "v\NAKa\240h<b\133\196",PropServerKeepAlive 18600,PropResponseTopic
// "\143\EOT\147O\167\234\160\194*\136_\144\134\145\GS\DEL",PropMessageExpiryInterval
// 8194,PropWildcardSubscriptionAvailable 51]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x82, 0xc7, 0x2,  0x64, 0x5f, 0xa1, 0x1,  0x3,  0x0,  0xa,  0x31, 0x33, 0xd6, 0x7d, 0xba, 0xf7, 0xaa, 0xb,  0x67,
      0x7d, 0x2a, 0x39, 0x21, 0x7,  0x44, 0x19, 0xc9, 0x13, 0x7a, 0x6c, 0x22, 0x36, 0xf9, 0x17, 0x2e, 0x11, 0x0,  0x0,
      0x1c, 0x7f, 0x9,  0x0,  0xf,  0x8f, 0x35, 0x87, 0x77, 0x86, 0x1,  0xd3, 0x76, 0x8d, 0x84, 0xca, 0xbb, 0x25, 0x73,
      0x8c, 0x1c, 0x0,  0x8,  0x11, 0xd7, 0xaa, 0x39, 0x64, 0x9b, 0x7a, 0xe1, 0x2,  0x0,  0x0,  0x1a, 0xdd, 0x1c, 0x0,
      0x3,  0xf0, 0x51, 0x2f, 0x2a, 0x8f, 0x2a, 0xef, 0x1c, 0x0,  0x13, 0xd,  0x77, 0x4d, 0x6c, 0x98, 0xc6, 0x68, 0xdb,
      0xaf, 0x94, 0x6a, 0xc6, 0x4d, 0xf4, 0x4,  0xe3, 0x48, 0x7d, 0xd2, 0x21, 0x66, 0xb5, 0x9,  0x0,  0xa,  0xf1, 0x6e,
      0xe2, 0x30, 0xfa, 0x65, 0x1,  0xa5, 0xc3, 0xff, 0x18, 0x0,  0x0,  0x60, 0x75, 0x16, 0x0,  0x9,  0x76, 0x15, 0x61,
      0xf0, 0x68, 0x3c, 0x62, 0x85, 0xc4, 0x13, 0x48, 0xa8, 0x8,  0x0,  0x10, 0x8f, 0x4,  0x93, 0x4f, 0xa7, 0xea, 0xa0,
      0xc2, 0x2a, 0x88, 0x5f, 0x90, 0x86, 0x91, 0x1d, 0x7f, 0x2,  0x0,  0x0,  0x20, 0x2,  0x28, 0x33, 0x0,  0x0,  0x26,
      0x0,  0x3,  0xba, 0xdb, 0xd7, 0x0,  0x0,  0xa,  0xc9, 0x62, 0x4b, 0xbb, 0x27, 0x7,  0x5,  0x9d, 0xfa, 0x10, 0x2a,
      0x0,  0x4,  0x58, 0xdf, 0xc4, 0x9c, 0x2a, 0x0,  0x1a, 0xf4, 0x68, 0x42, 0x3e, 0xcc, 0x73, 0x20, 0x31, 0x1f, 0xe9,
      0x91, 0x85, 0xb2, 0x3a, 0x81, 0x9a, 0xee, 0x7a, 0x16, 0x98, 0x2d, 0xf4, 0x74, 0x71, 0x11, 0x92, 0x10, 0x0,  0x19,
      0x4,  0xbc, 0xd6, 0x43, 0x9e, 0xbe, 0xea, 0x17, 0x74, 0xe5, 0x1d, 0x52, 0x8b, 0x4e, 0xd9, 0xe,  0xf0, 0xf5, 0x5,
      0xad, 0x47, 0x3b, 0x99, 0x40, 0xb7, 0x11, 0x0,  0x14, 0x57, 0x34, 0x30, 0x36, 0xfc, 0x9c, 0x5c, 0xd4, 0x33, 0x8,
      0xcb, 0x24, 0xbb, 0xf7, 0x12, 0xeb, 0xb,  0x86, 0xb5, 0xe7, 0x9,  0x0,  0x5,  0xbf, 0x1b, 0x2b, 0x22, 0x71, 0x28,
      0x0,  0x14, 0x21, 0x8a, 0x1e, 0x40, 0x89, 0x18, 0x50, 0x21, 0x1,  0x5d, 0xc,  0xfa, 0xf4, 0xfb, 0x68, 0xe8, 0xf2,
      0xf1, 0xf1, 0xda, 0x6,  0x0,  0x13, 0x2,  0x86, 0xdf, 0xae, 0x58, 0x41, 0x85, 0x2e, 0xf5, 0x67, 0x1c, 0x7e, 0xe0,
      0xad, 0xd,  0x9e, 0x4,  0xa5, 0x15, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xba, 0xdb, 0xd7};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc9, 0x62, 0x4b, 0xbb, 0x27, 0x7, 0x5, 0x9d, 0xfa, 0x10};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58, 0xdf, 0xc4, 0x9c};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xf4, 0x68, 0x42, 0x3e, 0xcc, 0x73, 0x20, 0x31, 0x1f, 0xe9, 0x91, 0x85, 0xb2,
                                     0x3a, 0x81, 0x9a, 0xee, 0x7a, 0x16, 0x98, 0x2d, 0xf4, 0x74, 0x71, 0x11, 0x92};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4,  0xbc, 0xd6, 0x43, 0x9e, 0xbe, 0xea, 0x17, 0x74, 0xe5, 0x1d, 0x52, 0x8b,
                                     0x4e, 0xd9, 0xe,  0xf0, 0xf5, 0x5,  0xad, 0x47, 0x3b, 0x99, 0x40, 0xb7};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x57, 0x34, 0x30, 0x36, 0xfc, 0x9c, 0x5c, 0xd4, 0x33, 0x8,
                                     0xcb, 0x24, 0xbb, 0xf7, 0x12, 0xeb, 0xb,  0x86, 0xb5, 0xe7};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xbf, 0x1b, 0x2b, 0x22, 0x71};
  lwmqtt_string_t topic_filter_s7 = {5, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x21, 0x8a, 0x1e, 0x40, 0x89, 0x18, 0x50, 0x21, 0x1,  0x5d,
                                     0xc,  0xfa, 0xf4, 0xfb, 0x68, 0xe8, 0xf2, 0xf1, 0xf1, 0xda};
  lwmqtt_string_t topic_filter_s8 = {20, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2,  0x86, 0xdf, 0xae, 0x58, 0x41, 0x85, 0x2e, 0xf5, 0x67,
                                     0x1c, 0x7e, 0xe0, 0xad, 0xd,  0x9e, 0x4,  0xa5, 0x15};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  uint8_t bytesprops0[] = {0x31, 0x33, 0xd6, 0x7d, 0xba, 0xf7, 0xaa, 0xb, 0x67, 0x7d};
  uint8_t bytesprops1[] = {0x8f, 0x35, 0x87, 0x77, 0x86, 0x1, 0xd3, 0x76, 0x8d, 0x84, 0xca, 0xbb, 0x25, 0x73, 0x8c};
  uint8_t bytesprops2[] = {0x11, 0xd7, 0xaa, 0x39, 0x64, 0x9b, 0x7a, 0xe1};
  uint8_t bytesprops3[] = {0xf0, 0x51, 0x2f};
  uint8_t bytesprops4[] = {0xd,  0x77, 0x4d, 0x6c, 0x98, 0xc6, 0x68, 0xdb, 0xaf, 0x94,
                           0x6a, 0xc6, 0x4d, 0xf4, 0x4,  0xe3, 0x48, 0x7d, 0xd2};
  uint8_t bytesprops5[] = {0xf1, 0x6e, 0xe2, 0x30, 0xfa, 0x65, 0x1, 0xa5, 0xc3, 0xff};
  uint8_t bytesprops6[] = {0x76, 0x15, 0x61, 0xf0, 0x68, 0x3c, 0x62, 0x85, 0xc4};
  uint8_t bytesprops7[] = {0x8f, 0x4,  0x93, 0x4f, 0xa7, 0xea, 0xa0, 0xc2,
                           0x2a, 0x88, 0x5f, 0x90, 0x86, 0x91, 0x1d, 0x7f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1860}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31340}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14073}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7295}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6877}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26293}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24693}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18600}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8194}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 51}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25695, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14957
// [("'\STX-\199\148\232\\4\ETB\240D\\\DC2G\221\175\253\255\200\151\129\253\175\163\209a",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\133%J[\196Z\167\222\147\176\SYN\173\170@h\164",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\214\172\142\169\CANa\255\&7!H+OU`z\"\SUB\129\146[[",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\136`\150!\205",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("Ig\181\204}",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\GS\157",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS
// = QoS2})] [PropPayloadFormatIndicator 60,PropUserProperty "\ESC,ju\138\n\187X\187`k\130\160\211\128\217\177\162
// %\142" "|\166\151\192\&0@\178\165Al\145\134\bf\DC4\141{\187\241",PropReasonString
// "\216\\6\144\227\r|\185\234\221",PropReasonString
// "-\152\230\ACK\248\EM\154z\\\153\v\234[\206!\225",PropAuthenticationMethod
// "\149\169\217\150\v\184\&72\171q#",PropSessionExpiryInterval 28078,PropTopicAlias
// 26867,PropSharedSubscriptionAvailable 140,PropServerReference "C<\174\252",PropMaximumPacketSize
// 436,PropCorrelationData
// "\ETBP\230\172\141[\210\132H\149`\ETX\211\254\229\221\235w\NUL\168\&0",PropMessageExpiryInterval
// 14117,PropAuthenticationData "\174=W\181.\227q\143\211\209\220]\DC2 \241\194",PropMaximumPacketSize
// 24460,PropSessionExpiryInterval 25343,PropReasonString "",PropResponseTopic
// "\159\250\178\139?k\248~6\ESC",PropContentType "\137%\170\&7\154\&4\229x",PropMessageExpiryInterval
// 3773,PropServerKeepAlive 18163]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x82, 0xb1, 0x2,  0x3a, 0x6d, 0xd0, 0x1,  0x1,  0x3c, 0x26, 0x0,  0x15, 0x1b, 0x2c, 0x6a, 0x75, 0x8a, 0xa,  0xbb,
      0x58, 0xbb, 0x60, 0x6b, 0x82, 0xa0, 0xd3, 0x80, 0xd9, 0xb1, 0xa2, 0x20, 0x25, 0x8e, 0x0,  0x13, 0x7c, 0xa6, 0x97,
      0xc0, 0x30, 0x40, 0xb2, 0xa5, 0x41, 0x6c, 0x91, 0x86, 0x8,  0x66, 0x14, 0x8d, 0x7b, 0xbb, 0xf1, 0x1f, 0x0,  0xa,
      0xd8, 0x5c, 0x36, 0x90, 0xe3, 0xd,  0x7c, 0xb9, 0xea, 0xdd, 0x1f, 0x0,  0x10, 0x2d, 0x98, 0xe6, 0x6,  0xf8, 0x19,
      0x9a, 0x7a, 0x5c, 0x99, 0xb,  0xea, 0x5b, 0xce, 0x21, 0xe1, 0x15, 0x0,  0xb,  0x95, 0xa9, 0xd9, 0x96, 0xb,  0xb8,
      0x37, 0x32, 0xab, 0x71, 0x23, 0x11, 0x0,  0x0,  0x6d, 0xae, 0x23, 0x68, 0xf3, 0x2a, 0x8c, 0x1c, 0x0,  0x4,  0x43,
      0x3c, 0xae, 0xfc, 0x27, 0x0,  0x0,  0x1,  0xb4, 0x9,  0x0,  0x15, 0x17, 0x50, 0xe6, 0xac, 0x8d, 0x5b, 0xd2, 0x84,
      0x48, 0x95, 0x60, 0x3,  0xd3, 0xfe, 0xe5, 0xdd, 0xeb, 0x77, 0x0,  0xa8, 0x30, 0x2,  0x0,  0x0,  0x37, 0x25, 0x16,
      0x0,  0x10, 0xae, 0x3d, 0x57, 0xb5, 0x2e, 0xe3, 0x71, 0x8f, 0xd3, 0xd1, 0xdc, 0x5d, 0x12, 0x20, 0xf1, 0xc2, 0x27,
      0x0,  0x0,  0x5f, 0x8c, 0x11, 0x0,  0x0,  0x62, 0xff, 0x1f, 0x0,  0x0,  0x8,  0x0,  0xa,  0x9f, 0xfa, 0xb2, 0x8b,
      0x3f, 0x6b, 0xf8, 0x7e, 0x36, 0x1b, 0x3,  0x0,  0x8,  0x89, 0x25, 0xaa, 0x37, 0x9a, 0x34, 0xe5, 0x78, 0x2,  0x0,
      0x0,  0xe,  0xbd, 0x13, 0x46, 0xf3, 0x0,  0x1a, 0x27, 0x2,  0x2d, 0xc7, 0x94, 0xe8, 0x5c, 0x34, 0x17, 0xf0, 0x44,
      0x5c, 0x12, 0x47, 0xdd, 0xaf, 0xfd, 0xff, 0xc8, 0x97, 0x81, 0xfd, 0xaf, 0xa3, 0xd1, 0x61, 0x0,  0x0,  0x10, 0x85,
      0x25, 0x4a, 0x5b, 0xc4, 0x5a, 0xa7, 0xde, 0x93, 0xb0, 0x16, 0xad, 0xaa, 0x40, 0x68, 0xa4, 0xd,  0x0,  0x15, 0xd6,
      0xac, 0x8e, 0xa9, 0x18, 0x61, 0xff, 0x37, 0x21, 0x48, 0x2b, 0x4f, 0x55, 0x60, 0x7a, 0x22, 0x1a, 0x81, 0x92, 0x5b,
      0x5b, 0xe,  0x0,  0x5,  0x88, 0x60, 0x96, 0x21, 0xcd, 0x1d, 0x0,  0x5,  0x49, 0x67, 0xb5, 0xcc, 0x7d, 0x0,  0x0,
      0x2,  0x1d, 0x9d, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x27, 0x2,  0x2d, 0xc7, 0x94, 0xe8, 0x5c, 0x34, 0x17, 0xf0, 0x44, 0x5c, 0x12,
                                     0x47, 0xdd, 0xaf, 0xfd, 0xff, 0xc8, 0x97, 0x81, 0xfd, 0xaf, 0xa3, 0xd1, 0x61};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x85, 0x25, 0x4a, 0x5b, 0xc4, 0x5a, 0xa7, 0xde,
                                     0x93, 0xb0, 0x16, 0xad, 0xaa, 0x40, 0x68, 0xa4};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd6, 0xac, 0x8e, 0xa9, 0x18, 0x61, 0xff, 0x37, 0x21, 0x48, 0x2b,
                                     0x4f, 0x55, 0x60, 0x7a, 0x22, 0x1a, 0x81, 0x92, 0x5b, 0x5b};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x60, 0x96, 0x21, 0xcd};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x49, 0x67, 0xb5, 0xcc, 0x7d};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1d, 0x9d};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  uint8_t bytesprops1[] = {0x7c, 0xa6, 0x97, 0xc0, 0x30, 0x40, 0xb2, 0xa5, 0x41, 0x6c,
                           0x91, 0x86, 0x8,  0x66, 0x14, 0x8d, 0x7b, 0xbb, 0xf1};
  uint8_t bytesprops0[] = {0x1b, 0x2c, 0x6a, 0x75, 0x8a, 0xa,  0xbb, 0x58, 0xbb, 0x60, 0x6b,
                           0x82, 0xa0, 0xd3, 0x80, 0xd9, 0xb1, 0xa2, 0x20, 0x25, 0x8e};
  uint8_t bytesprops2[] = {0xd8, 0x5c, 0x36, 0x90, 0xe3, 0xd, 0x7c, 0xb9, 0xea, 0xdd};
  uint8_t bytesprops3[] = {0x2d, 0x98, 0xe6, 0x6,  0xf8, 0x19, 0x9a, 0x7a,
                           0x5c, 0x99, 0xb,  0xea, 0x5b, 0xce, 0x21, 0xe1};
  uint8_t bytesprops4[] = {0x95, 0xa9, 0xd9, 0x96, 0xb, 0xb8, 0x37, 0x32, 0xab, 0x71, 0x23};
  uint8_t bytesprops5[] = {0x43, 0x3c, 0xae, 0xfc};
  uint8_t bytesprops6[] = {0x17, 0x50, 0xe6, 0xac, 0x8d, 0x5b, 0xd2, 0x84, 0x48, 0x95, 0x60,
                           0x3,  0xd3, 0xfe, 0xe5, 0xdd, 0xeb, 0x77, 0x0,  0xa8, 0x30};
  uint8_t bytesprops7[] = {0xae, 0x3d, 0x57, 0xb5, 0x2e, 0xe3, 0x71, 0x8f,
                           0xd3, 0xd1, 0xdc, 0x5d, 0x12, 0x20, 0xf1, 0xc2};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0x9f, 0xfa, 0xb2, 0x8b, 0x3f, 0x6b, 0xf8, 0x7e, 0x36, 0x1b};
  uint8_t bytesprops10[] = {0x89, 0x25, 0xaa, 0x37, 0x9a, 0x34, 0xe5, 0x78};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops0}, .v = {19, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28078}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26867}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 436}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14117}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24460}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25343}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {10, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3773}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18163}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14957, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12087 [("\SOH\160\au5\136\&6\222",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\202SR62\ENQ<\140\142k",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\141\ACK\147\209\&2\239\163\250\214V",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\227a\EOT0{ \198\DC2\248\240s_m`\210\198~\128e\240\202\SOH",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\197%;s04\250{\144\SIN\157\136\156\157\221\232\250",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("86f\234\181\141#g\FS]\237x\187\200B\224Q\158\&3\234\STX\a1\233\\\FS",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("0\194w\220\142\208!>\246\138\133\163\SOH|\246I\FS$D\252`!\FS@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\172\226p\DC4E\160\DC3\225",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("\230A<\165\132",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = True, _noLocal = False, _subQoS = QoS1})] [PropMaximumPacketSize 27560,PropReasonString
// "\216\&7\160s\166\151\187\239L\146\177`\136\233\176G",PropServerReference "\RS\254!\151\CAN",PropResponseInformation
// "K*H7\NAK\227\131\&8",PropCorrelationData "o\177\168NB\203\DC1\241\189\SO?\202",PropSessionExpiryInterval
// 6634,PropSubscriptionIdentifier 15,PropAuthenticationData "\198x@\ETB#\198\220\248",PropMessageExpiryInterval
// 24925,PropWillDelayInterval 13925,PropSubscriptionIdentifierAvailable 170,PropAuthenticationData
// "g#H\192\183+\SUB\170y`x\216\159\213?\180\254*\ETB\197\158\159\209\&3sPA",PropUserProperty
// "hp\150\177\128$\SO\SOH\219\131\174\&3 g\240e\134\EOT\187A"
// "\150\170\218\217\n(~\161\242\169\141\144\248\211",PropCorrelationData
// "\185\CANR;4\218A\229\&27\EM3o\188\230\&0%;|je'\148W\142\150>&\NAK\216",PropWillDelayInterval 4592]
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x82, 0xe8, 0x2,  0x2f, 0x37, 0xc3, 0x1,  0x27, 0x0,  0x0,  0x6b, 0xa8, 0x1f, 0x0,  0x10, 0xd8, 0x37, 0xa0, 0x73,
      0xa6, 0x97, 0xbb, 0xef, 0x4c, 0x92, 0xb1, 0x60, 0x88, 0xe9, 0xb0, 0x47, 0x1c, 0x0,  0x5,  0x1e, 0xfe, 0x21, 0x97,
      0x18, 0x1a, 0x0,  0x8,  0x4b, 0x2a, 0x48, 0x37, 0x15, 0xe3, 0x83, 0x38, 0x9,  0x0,  0xc,  0x6f, 0xb1, 0xa8, 0x4e,
      0x42, 0xcb, 0x11, 0xf1, 0xbd, 0xe,  0x3f, 0xca, 0x11, 0x0,  0x0,  0x19, 0xea, 0xb,  0xf,  0x16, 0x0,  0x8,  0xc6,
      0x78, 0x40, 0x17, 0x23, 0xc6, 0xdc, 0xf8, 0x2,  0x0,  0x0,  0x61, 0x5d, 0x18, 0x0,  0x0,  0x36, 0x65, 0x29, 0xaa,
      0x16, 0x0,  0x1b, 0x67, 0x23, 0x48, 0xc0, 0xb7, 0x2b, 0x1a, 0xaa, 0x79, 0x60, 0x78, 0xd8, 0x9f, 0xd5, 0x3f, 0xb4,
      0xfe, 0x2a, 0x17, 0xc5, 0x9e, 0x9f, 0xd1, 0x33, 0x73, 0x50, 0x41, 0x26, 0x0,  0x14, 0x68, 0x70, 0x96, 0xb1, 0x80,
      0x24, 0xe,  0x1,  0xdb, 0x83, 0xae, 0x33, 0x20, 0x67, 0xf0, 0x65, 0x86, 0x4,  0xbb, 0x41, 0x0,  0xe,  0x96, 0xaa,
      0xda, 0xd9, 0xa,  0x28, 0x7e, 0xa1, 0xf2, 0xa9, 0x8d, 0x90, 0xf8, 0xd3, 0x9,  0x0,  0x1e, 0xb9, 0x18, 0x52, 0x3b,
      0x34, 0xda, 0x41, 0xe5, 0x32, 0x37, 0x19, 0x33, 0x6f, 0xbc, 0xe6, 0x30, 0x25, 0x3b, 0x7c, 0x6a, 0x65, 0x27, 0x94,
      0x57, 0x8e, 0x96, 0x3e, 0x26, 0x15, 0xd8, 0x18, 0x0,  0x0,  0x11, 0xf0, 0x0,  0x8,  0x1,  0xa0, 0x7,  0x75, 0x35,
      0x88, 0x36, 0xde, 0x1a, 0x0,  0xa,  0xca, 0x53, 0x52, 0x36, 0x32, 0x5,  0x3c, 0x8c, 0x8e, 0x6b, 0xd,  0x0,  0xa,
      0x8d, 0x6,  0x93, 0xd1, 0x32, 0xef, 0xa3, 0xfa, 0xd6, 0x56, 0x2,  0x0,  0x16, 0xe3, 0x61, 0x4,  0x30, 0x7b, 0x20,
      0xc6, 0x12, 0xf8, 0xf0, 0x73, 0x5f, 0x6d, 0x60, 0xd2, 0xc6, 0x7e, 0x80, 0x65, 0xf0, 0xca, 0x1,  0x1a, 0x0,  0x12,
      0xc5, 0x25, 0x3b, 0x73, 0x30, 0x34, 0xfa, 0x7b, 0x90, 0xf,  0x4e, 0x9d, 0x88, 0x9c, 0x9d, 0xdd, 0xe8, 0xfa, 0x2a,
      0x0,  0x0,  0x19, 0x0,  0x1a, 0x38, 0x36, 0x66, 0xea, 0xb5, 0x8d, 0x23, 0x67, 0x1c, 0x5d, 0xed, 0x78, 0xbb, 0xc8,
      0x42, 0xe0, 0x51, 0x9e, 0x33, 0xea, 0x2,  0x7,  0x31, 0xe9, 0x5c, 0x1c, 0x1a, 0x0,  0x18, 0x30, 0xc2, 0x77, 0xdc,
      0x8e, 0xd0, 0x21, 0x3e, 0xf6, 0x8a, 0x85, 0xa3, 0x1,  0x7c, 0xf6, 0x49, 0x1c, 0x24, 0x44, 0xfc, 0x60, 0x21, 0x1c,
      0x40, 0x4,  0x0,  0x8,  0xac, 0xe2, 0x70, 0x14, 0x45, 0xa0, 0x13, 0xe1, 0xc,  0x0,  0x5,  0xe6, 0x41, 0x3c, 0xa5,
      0x84, 0x9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x1, 0xa0, 0x7, 0x75, 0x35, 0x88, 0x36, 0xde};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xca, 0x53, 0x52, 0x36, 0x32, 0x5, 0x3c, 0x8c, 0x8e, 0x6b};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8d, 0x6, 0x93, 0xd1, 0x32, 0xef, 0xa3, 0xfa, 0xd6, 0x56};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe3, 0x61, 0x4,  0x30, 0x7b, 0x20, 0xc6, 0x12, 0xf8, 0xf0, 0x73,
                                     0x5f, 0x6d, 0x60, 0xd2, 0xc6, 0x7e, 0x80, 0x65, 0xf0, 0xca, 0x1};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc5, 0x25, 0x3b, 0x73, 0x30, 0x34, 0xfa, 0x7b, 0x90,
                                     0xf,  0x4e, 0x9d, 0x88, 0x9c, 0x9d, 0xdd, 0xe8, 0xfa};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x38, 0x36, 0x66, 0xea, 0xb5, 0x8d, 0x23, 0x67, 0x1c, 0x5d, 0xed, 0x78, 0xbb,
                                     0xc8, 0x42, 0xe0, 0x51, 0x9e, 0x33, 0xea, 0x2,  0x7,  0x31, 0xe9, 0x5c, 0x1c};
  lwmqtt_string_t topic_filter_s6 = {26, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x30, 0xc2, 0x77, 0xdc, 0x8e, 0xd0, 0x21, 0x3e, 0xf6, 0x8a, 0x85, 0xa3,
                                     0x1,  0x7c, 0xf6, 0x49, 0x1c, 0x24, 0x44, 0xfc, 0x60, 0x21, 0x1c, 0x40};
  lwmqtt_string_t topic_filter_s7 = {24, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xac, 0xe2, 0x70, 0x14, 0x45, 0xa0, 0x13, 0xe1};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe6, 0x41, 0x3c, 0xa5, 0x84};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  uint8_t bytesprops0[] = {0xd8, 0x37, 0xa0, 0x73, 0xa6, 0x97, 0xbb, 0xef,
                           0x4c, 0x92, 0xb1, 0x60, 0x88, 0xe9, 0xb0, 0x47};
  uint8_t bytesprops1[] = {0x1e, 0xfe, 0x21, 0x97, 0x18};
  uint8_t bytesprops2[] = {0x4b, 0x2a, 0x48, 0x37, 0x15, 0xe3, 0x83, 0x38};
  uint8_t bytesprops3[] = {0x6f, 0xb1, 0xa8, 0x4e, 0x42, 0xcb, 0x11, 0xf1, 0xbd, 0xe, 0x3f, 0xca};
  uint8_t bytesprops4[] = {0xc6, 0x78, 0x40, 0x17, 0x23, 0xc6, 0xdc, 0xf8};
  uint8_t bytesprops5[] = {0x67, 0x23, 0x48, 0xc0, 0xb7, 0x2b, 0x1a, 0xaa, 0x79, 0x60, 0x78, 0xd8, 0x9f, 0xd5,
                           0x3f, 0xb4, 0xfe, 0x2a, 0x17, 0xc5, 0x9e, 0x9f, 0xd1, 0x33, 0x73, 0x50, 0x41};
  uint8_t bytesprops7[] = {0x96, 0xaa, 0xda, 0xd9, 0xa, 0x28, 0x7e, 0xa1, 0xf2, 0xa9, 0x8d, 0x90, 0xf8, 0xd3};
  uint8_t bytesprops6[] = {0x68, 0x70, 0x96, 0xb1, 0x80, 0x24, 0xe,  0x1, 0xdb, 0x83,
                           0xae, 0x33, 0x20, 0x67, 0xf0, 0x65, 0x86, 0x4, 0xbb, 0x41};
  uint8_t bytesprops8[] = {0xb9, 0x18, 0x52, 0x3b, 0x34, 0xda, 0x41, 0xe5, 0x32, 0x37, 0x19, 0x33, 0x6f, 0xbc, 0xe6,
                           0x30, 0x25, 0x3b, 0x7c, 0x6a, 0x65, 0x27, 0x94, 0x57, 0x8e, 0x96, 0x3e, 0x26, 0x15, 0xd8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27560}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6634}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24925}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13925}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops6}, .v = {14, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4592}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12087, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12264 [("\196k\DC4\147L\142U\156\ENQ\US\184Vi",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("v\GSMX\152\167\US\241\&0\144",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("ZW\174\198D$\r\232\220afgJM\NAKe\174\158\192\138\223\ESCs\172d\140M",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\EOT\184\184Pt\214-\228:\SI\193\207\136",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\202\223|X\252\nU\158b~\143\&8\GS#",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\162#D\147((1X
// ",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\130\219\DC4\157\150w",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("|\141\195",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1})] [PropServerReference "\214\STX\ESC[~\135\&4\149\208H\173\SO\233Z
// \156\162\209\207\226>\165\251\247",PropRequestResponseInformation 114,PropResponseTopic
// "\144\131S^\232\227\206{\SO\156\238n\173;\209\246\153\177\136\GS\236\142\220\217",PropServerKeepAlive
// 241,PropRequestProblemInformation 7,PropMaximumQoS 79,PropReasonString
// "\GSHr\217\ETX\211\227\229\197Sg\129?\195D",PropResponseInformation "pZi\157\138\183$J7\150Y<\230
// \220\182\150g\NAK\239A\165g\222\250\SOC",PropSharedSubscriptionAvailable 18,PropTopicAlias 8978,PropResponseTopic
// "\220\187\SOH'\US\172HL\DC2\226z=;$\157f\161\237\190\CAN\186%\254%U\205\250",PropRequestResponseInformation
// 30,PropAuthenticationMethod "\234",PropCorrelationData "\179\242\211\250\195",PropWildcardSubscriptionAvailable
// 200,PropReasonString "\184\135u\222gG\222v\158",PropRetainAvailable 169,PropSubscriptionIdentifier
// 14,PropMessageExpiryInterval 26125]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x82, 0xb2, 0x2,  0x2f, 0xe8, 0xb7, 0x1,  0x1c, 0x0,  0x18, 0xd6, 0x2,  0x1b, 0x5b, 0x7e, 0x87, 0x34, 0x95, 0xd0,
      0x48, 0xad, 0xe,  0xe9, 0x5a, 0x20, 0x9c, 0xa2, 0xd1, 0xcf, 0xe2, 0x3e, 0xa5, 0xfb, 0xf7, 0x19, 0x72, 0x8,  0x0,
      0x18, 0x90, 0x83, 0x53, 0x5e, 0xe8, 0xe3, 0xce, 0x7b, 0xe,  0x9c, 0xee, 0x6e, 0xad, 0x3b, 0xd1, 0xf6, 0x99, 0xb1,
      0x88, 0x1d, 0xec, 0x8e, 0xdc, 0xd9, 0x13, 0x0,  0xf1, 0x17, 0x7,  0x24, 0x4f, 0x1f, 0x0,  0xf,  0x1d, 0x48, 0x72,
      0xd9, 0x3,  0xd3, 0xe3, 0xe5, 0xc5, 0x53, 0x67, 0x81, 0x3f, 0xc3, 0x44, 0x1a, 0x0,  0x1b, 0x70, 0x5a, 0x69, 0x9d,
      0x8a, 0xb7, 0x24, 0x4a, 0x37, 0x96, 0x59, 0x3c, 0xe6, 0x20, 0xdc, 0xb6, 0x96, 0x67, 0x15, 0xef, 0x41, 0xa5, 0x67,
      0xde, 0xfa, 0xe,  0x43, 0x2a, 0x12, 0x23, 0x23, 0x12, 0x8,  0x0,  0x1b, 0xdc, 0xbb, 0x1,  0x27, 0x1f, 0xac, 0x48,
      0x4c, 0x12, 0xe2, 0x7a, 0x3d, 0x3b, 0x24, 0x9d, 0x66, 0xa1, 0xed, 0xbe, 0x18, 0xba, 0x25, 0xfe, 0x25, 0x55, 0xcd,
      0xfa, 0x19, 0x1e, 0x15, 0x0,  0x1,  0xea, 0x9,  0x0,  0x5,  0xb3, 0xf2, 0xd3, 0xfa, 0xc3, 0x28, 0xc8, 0x1f, 0x0,
      0x9,  0xb8, 0x87, 0x75, 0xde, 0x67, 0x47, 0xde, 0x76, 0x9e, 0x25, 0xa9, 0xb,  0xe,  0x2,  0x0,  0x0,  0x66, 0xd,
      0x0,  0xd,  0xc4, 0x6b, 0x14, 0x93, 0x4c, 0x8e, 0x55, 0x9c, 0x5,  0x1f, 0xb8, 0x56, 0x69, 0x24, 0x0,  0xa,  0x76,
      0x1d, 0x4d, 0x58, 0x98, 0xa7, 0x1f, 0xf1, 0x30, 0x90, 0x15, 0x0,  0x1b, 0x5a, 0x57, 0xae, 0xc6, 0x44, 0x24, 0xd,
      0xe8, 0xdc, 0x61, 0x66, 0x67, 0x4a, 0x4d, 0x15, 0x65, 0xae, 0x9e, 0xc0, 0x8a, 0xdf, 0x1b, 0x73, 0xac, 0x64, 0x8c,
      0x4d, 0x2d, 0x0,  0xd,  0x4,  0xb8, 0xb8, 0x50, 0x74, 0xd6, 0x2d, 0xe4, 0x3a, 0xf,  0xc1, 0xcf, 0x88, 0x1c, 0x0,
      0xe,  0xca, 0xdf, 0x7c, 0x58, 0xfc, 0xa,  0x55, 0x9e, 0x62, 0x7e, 0x8f, 0x38, 0x1d, 0x23, 0x1d, 0x0,  0x9,  0xa2,
      0x23, 0x44, 0x93, 0x28, 0x28, 0x31, 0x58, 0x20, 0x1d, 0x0,  0x6,  0x82, 0xdb, 0x14, 0x9d, 0x96, 0x77, 0x26, 0x0,
      0x3,  0x7c, 0x8d, 0xc3, 0x21};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xc4, 0x6b, 0x14, 0x93, 0x4c, 0x8e, 0x55, 0x9c, 0x5, 0x1f, 0xb8, 0x56, 0x69};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x76, 0x1d, 0x4d, 0x58, 0x98, 0xa7, 0x1f, 0xf1, 0x30, 0x90};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5a, 0x57, 0xae, 0xc6, 0x44, 0x24, 0xd,  0xe8, 0xdc, 0x61, 0x66, 0x67, 0x4a, 0x4d,
                                     0x15, 0x65, 0xae, 0x9e, 0xc0, 0x8a, 0xdf, 0x1b, 0x73, 0xac, 0x64, 0x8c, 0x4d};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4, 0xb8, 0xb8, 0x50, 0x74, 0xd6, 0x2d, 0xe4, 0x3a, 0xf, 0xc1, 0xcf, 0x88};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xca, 0xdf, 0x7c, 0x58, 0xfc, 0xa, 0x55, 0x9e, 0x62, 0x7e, 0x8f, 0x38, 0x1d, 0x23};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa2, 0x23, 0x44, 0x93, 0x28, 0x28, 0x31, 0x58, 0x20};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x82, 0xdb, 0x14, 0x9d, 0x96, 0x77};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x7c, 0x8d, 0xc3};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0xd6, 0x2,  0x1b, 0x5b, 0x7e, 0x87, 0x34, 0x95, 0xd0, 0x48, 0xad, 0xe,
                           0xe9, 0x5a, 0x20, 0x9c, 0xa2, 0xd1, 0xcf, 0xe2, 0x3e, 0xa5, 0xfb, 0xf7};
  uint8_t bytesprops1[] = {0x90, 0x83, 0x53, 0x5e, 0xe8, 0xe3, 0xce, 0x7b, 0xe,  0x9c, 0xee, 0x6e,
                           0xad, 0x3b, 0xd1, 0xf6, 0x99, 0xb1, 0x88, 0x1d, 0xec, 0x8e, 0xdc, 0xd9};
  uint8_t bytesprops2[] = {0x1d, 0x48, 0x72, 0xd9, 0x3, 0xd3, 0xe3, 0xe5, 0xc5, 0x53, 0x67, 0x81, 0x3f, 0xc3, 0x44};
  uint8_t bytesprops3[] = {0x70, 0x5a, 0x69, 0x9d, 0x8a, 0xb7, 0x24, 0x4a, 0x37, 0x96, 0x59, 0x3c, 0xe6, 0x20,
                           0xdc, 0xb6, 0x96, 0x67, 0x15, 0xef, 0x41, 0xa5, 0x67, 0xde, 0xfa, 0xe,  0x43};
  uint8_t bytesprops4[] = {0xdc, 0xbb, 0x1,  0x27, 0x1f, 0xac, 0x48, 0x4c, 0x12, 0xe2, 0x7a, 0x3d, 0x3b, 0x24,
                           0x9d, 0x66, 0xa1, 0xed, 0xbe, 0x18, 0xba, 0x25, 0xfe, 0x25, 0x55, 0xcd, 0xfa};
  uint8_t bytesprops5[] = {0xea};
  uint8_t bytesprops6[] = {0xb3, 0xf2, 0xd3, 0xfa, 0xc3};
  uint8_t bytesprops7[] = {0xb8, 0x87, 0x75, 0xde, 0x67, 0x47, 0xde, 0x76, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 241}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8978}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26125}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12264, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 23519 [("R\219\&9\207\231\198)2}\160",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\229\250\209",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("P\243-\232\133v`;l\157\243\238\130\251x\239\172\210\144\US2\251@h\138\228Mt\140",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\n\133g\194",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("y\239\128\199)K\206~\242\246\SO*Anb2&\190\169#b",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\tz\SI\249\US2%R\176\a\163Kn\141\187\198\211x\246)]",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropAssignedClientIdentifier
// "\ESCd\175\ACK",PropSubscriptionIdentifierAvailable 53,PropMessageExpiryInterval 10167,PropUserProperty ""
// "\240\STX\237\185\239\171\252D\175%\214\231\&2\173$",PropServerKeepAlive 27442,PropServerReference
// ".\190\176F\ACK\"\181-\SYN\150\232O5\242\250\186\171\185EgGt",PropRequestResponseInformation 54,PropResponseTopic
// "\SIwVD\245\239",PropRequestResponseInformation 203,PropServerKeepAlive 27526,PropMessageExpiryInterval
// 14075,PropSharedSubscriptionAvailable 167,PropAuthenticationMethod
// "M\245V\212\136G\132\150\187\166\160hRZ$t%q.?Z\179",PropTopicAlias 8832,PropRequestResponseInformation
// 65,PropMessageExpiryInterval 13256,PropResponseTopic
// "\218\220\184s\219\206\151\169\208\231\131p\ENQ\RS\200\201\DC4\f\224\147\t\168"]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x82, 0x82, 0x2,  0x5b, 0xdf, 0x91, 0x1,  0x12, 0x0,  0x4,  0x1b, 0x64, 0xaf, 0x6,  0x29, 0x35, 0x2,  0x0,  0x0,
      0x27, 0xb7, 0x26, 0x0,  0x0,  0x0,  0xf,  0xf0, 0x2,  0xed, 0xb9, 0xef, 0xab, 0xfc, 0x44, 0xaf, 0x25, 0xd6, 0xe7,
      0x32, 0xad, 0x24, 0x13, 0x6b, 0x32, 0x1c, 0x0,  0x16, 0x2e, 0xbe, 0xb0, 0x46, 0x6,  0x22, 0xb5, 0x2d, 0x16, 0x96,
      0xe8, 0x4f, 0x35, 0xf2, 0xfa, 0xba, 0xab, 0xb9, 0x45, 0x67, 0x47, 0x74, 0x19, 0x36, 0x8,  0x0,  0x6,  0xf,  0x77,
      0x56, 0x44, 0xf5, 0xef, 0x19, 0xcb, 0x13, 0x6b, 0x86, 0x2,  0x0,  0x0,  0x36, 0xfb, 0x2a, 0xa7, 0x15, 0x0,  0x16,
      0x4d, 0xf5, 0x56, 0xd4, 0x88, 0x47, 0x84, 0x96, 0xbb, 0xa6, 0xa0, 0x68, 0x52, 0x5a, 0x24, 0x74, 0x25, 0x71, 0x2e,
      0x3f, 0x5a, 0xb3, 0x23, 0x22, 0x80, 0x19, 0x41, 0x2,  0x0,  0x0,  0x33, 0xc8, 0x8,  0x0,  0x16, 0xda, 0xdc, 0xb8,
      0x73, 0xdb, 0xce, 0x97, 0xa9, 0xd0, 0xe7, 0x83, 0x70, 0x5,  0x1e, 0xc8, 0xc9, 0x14, 0xc,  0xe0, 0x93, 0x9,  0xa8,
      0x0,  0xa,  0x52, 0xdb, 0x39, 0xcf, 0xe7, 0xc6, 0x29, 0x32, 0x7d, 0xa0, 0x20, 0x0,  0x0,  0x11, 0x0,  0x3,  0xe5,
      0xfa, 0xd1, 0x14, 0x0,  0x1d, 0x50, 0xf3, 0x2d, 0xe8, 0x85, 0x76, 0x60, 0x3b, 0x6c, 0x9d, 0xf3, 0xee, 0x82, 0xfb,
      0x78, 0xef, 0xac, 0xd2, 0x90, 0x1f, 0x32, 0xfb, 0x40, 0x68, 0x8a, 0xe4, 0x4d, 0x74, 0x8c, 0xc,  0x0,  0x4,  0xa,
      0x85, 0x67, 0xc2, 0x1,  0x0,  0x15, 0x79, 0xef, 0x80, 0xc7, 0x29, 0x4b, 0xce, 0x7e, 0xf2, 0xf6, 0xe,  0x2a, 0x41,
      0x6e, 0x62, 0x32, 0x26, 0xbe, 0xa9, 0x23, 0x62, 0x10, 0x0,  0x15, 0x9,  0x7a, 0xf,  0xf9, 0x1f, 0x32, 0x25, 0x52,
      0xb0, 0x7,  0xa3, 0x4b, 0x6e, 0x8d, 0xbb, 0xc6, 0xd3, 0x78, 0xf6, 0x29, 0x5d, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x52, 0xdb, 0x39, 0xcf, 0xe7, 0xc6, 0x29, 0x32, 0x7d, 0xa0};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe5, 0xfa, 0xd1};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x50, 0xf3, 0x2d, 0xe8, 0x85, 0x76, 0x60, 0x3b, 0x6c, 0x9d,
                                     0xf3, 0xee, 0x82, 0xfb, 0x78, 0xef, 0xac, 0xd2, 0x90, 0x1f,
                                     0x32, 0xfb, 0x40, 0x68, 0x8a, 0xe4, 0x4d, 0x74, 0x8c};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa, 0x85, 0x67, 0xc2};
  lwmqtt_string_t topic_filter_s4 = {4, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x79, 0xef, 0x80, 0xc7, 0x29, 0x4b, 0xce, 0x7e, 0xf2, 0xf6, 0xe,
                                     0x2a, 0x41, 0x6e, 0x62, 0x32, 0x26, 0xbe, 0xa9, 0x23, 0x62};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x9,  0x7a, 0xf,  0xf9, 0x1f, 0x32, 0x25, 0x52, 0xb0, 0x7, 0xa3,
                                     0x4b, 0x6e, 0x8d, 0xbb, 0xc6, 0xd3, 0x78, 0xf6, 0x29, 0x5d};
  lwmqtt_string_t topic_filter_s6 = {21, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0x1b, 0x64, 0xaf, 0x6};
  uint8_t bytesprops2[] = {0xf0, 0x2, 0xed, 0xb9, 0xef, 0xab, 0xfc, 0x44, 0xaf, 0x25, 0xd6, 0xe7, 0x32, 0xad, 0x24};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops3[] = {0x2e, 0xbe, 0xb0, 0x46, 0x6,  0x22, 0xb5, 0x2d, 0x16, 0x96, 0xe8,
                           0x4f, 0x35, 0xf2, 0xfa, 0xba, 0xab, 0xb9, 0x45, 0x67, 0x47, 0x74};
  uint8_t bytesprops4[] = {0xf, 0x77, 0x56, 0x44, 0xf5, 0xef};
  uint8_t bytesprops5[] = {0x4d, 0xf5, 0x56, 0xd4, 0x88, 0x47, 0x84, 0x96, 0xbb, 0xa6, 0xa0,
                           0x68, 0x52, 0x5a, 0x24, 0x74, 0x25, 0x71, 0x2e, 0x3f, 0x5a, 0xb3};
  uint8_t bytesprops6[] = {0xda, 0xdc, 0xb8, 0x73, 0xdb, 0xce, 0x97, 0xa9, 0xd0, 0xe7, 0x83,
                           0x70, 0x5,  0x1e, 0xc8, 0xc9, 0x14, 0xc,  0xe0, 0x93, 0x9,  0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10167}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops1}, .v = {15, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27442}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27526}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14075}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8832}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13256}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23519, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 29383 [(",\NAK\169\178hV\136\f\td\219\232\130\128\161",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("x\r\128\171A\130\134\&6\DC1oU\179\212\t~\136\247\SO3",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),(")o=\233\v\SOH\204,\183\ESCkM^\133\224\&5\200H",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\210\198\219\203\239\165d<\213b\DC4UR\142\235\248\NULp\131\235\184\147\223kF\157\137\150\218\b",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("mm\223\&8\CAN\fO\no",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal
// = True, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\192\143D`V'\SYNt\SI\233\133\&5\248\252\145\247C\130\192\218\SUBo",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\173\253\163N\216\207\129+_ \235e2\r5}\146",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\223\ETX\244nSoNK",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("/\239uT\EOT",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("f\241DK\SUB\ETB\DLEfe[\RS\CAN\222\ESCp\230Z\232v9e\246",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropResponseTopic
// "&.J\226+",PropRequestProblemInformation 153,PropWillDelayInterval 31281,PropRequestProblemInformation 220]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x82, 0xda, 0x1,  0x72, 0xc7, 0x11, 0x8,  0x0,  0x5,  0x26, 0x2e, 0x4a, 0xe2, 0x2b, 0x17, 0x99, 0x18, 0x0,  0x0,
      0x7a, 0x31, 0x17, 0xdc, 0x0,  0xf,  0x2c, 0x15, 0xa9, 0xb2, 0x68, 0x56, 0x88, 0xc,  0x9,  0x64, 0xdb, 0xe8, 0x82,
      0x80, 0xa1, 0x29, 0x0,  0x13, 0x78, 0xd,  0x80, 0xab, 0x41, 0x82, 0x86, 0x36, 0x11, 0x6f, 0x55, 0xb3, 0xd4, 0x9,
      0x7e, 0x88, 0xf7, 0xe,  0x33, 0xe,  0x0,  0x12, 0x29, 0x6f, 0x3d, 0xe9, 0xb,  0x1,  0xcc, 0x2c, 0xb7, 0x1b, 0x6b,
      0x4d, 0x5e, 0x85, 0xe0, 0x35, 0xc8, 0x48, 0x4,  0x0,  0x1e, 0xd2, 0xc6, 0xdb, 0xcb, 0xef, 0xa5, 0x64, 0x3c, 0xd5,
      0x62, 0x14, 0x55, 0x52, 0x8e, 0xeb, 0xf8, 0x0,  0x70, 0x83, 0xeb, 0xb8, 0x93, 0xdf, 0x6b, 0x46, 0x9d, 0x89, 0x96,
      0xda, 0x8,  0x21, 0x0,  0x9,  0x6d, 0x6d, 0xdf, 0x38, 0x18, 0xc,  0x4f, 0xa,  0x6f, 0x2c, 0x0,  0x0,  0x12, 0x0,
      0x16, 0xc0, 0x8f, 0x44, 0x60, 0x56, 0x27, 0x16, 0x74, 0xf,  0xe9, 0x85, 0x35, 0xf8, 0xfc, 0x91, 0xf7, 0x43, 0x82,
      0xc0, 0xda, 0x1a, 0x6f, 0x8,  0x0,  0x11, 0xad, 0xfd, 0xa3, 0x4e, 0xd8, 0xcf, 0x81, 0x2b, 0x5f, 0x20, 0xeb, 0x65,
      0x32, 0xd,  0x35, 0x7d, 0x92, 0xd,  0x0,  0x8,  0xdf, 0x3,  0xf4, 0x6e, 0x53, 0x6f, 0x4e, 0x4b, 0x1d, 0x0,  0x5,
      0x2f, 0xef, 0x75, 0x54, 0x4,  0x11, 0x0,  0x16, 0x66, 0xf1, 0x44, 0x4b, 0x1a, 0x17, 0x10, 0x66, 0x65, 0x5b, 0x1e,
      0x18, 0xde, 0x1b, 0x70, 0xe6, 0x5a, 0xe8, 0x76, 0x39, 0x65, 0xf6, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x2c, 0x15, 0xa9, 0xb2, 0x68, 0x56, 0x88, 0xc,
                                     0x9,  0x64, 0xdb, 0xe8, 0x82, 0x80, 0xa1};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x78, 0xd,  0x80, 0xab, 0x41, 0x82, 0x86, 0x36, 0x11, 0x6f,
                                     0x55, 0xb3, 0xd4, 0x9,  0x7e, 0x88, 0xf7, 0xe,  0x33};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x29, 0x6f, 0x3d, 0xe9, 0xb,  0x1,  0xcc, 0x2c, 0xb7,
                                     0x1b, 0x6b, 0x4d, 0x5e, 0x85, 0xe0, 0x35, 0xc8, 0x48};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd2, 0xc6, 0xdb, 0xcb, 0xef, 0xa5, 0x64, 0x3c, 0xd5, 0x62,
                                     0x14, 0x55, 0x52, 0x8e, 0xeb, 0xf8, 0x0,  0x70, 0x83, 0xeb,
                                     0xb8, 0x93, 0xdf, 0x6b, 0x46, 0x9d, 0x89, 0x96, 0xda, 0x8};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x6d, 0x6d, 0xdf, 0x38, 0x18, 0xc, 0x4f, 0xa, 0x6f};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0};
  lwmqtt_string_t topic_filter_s5 = {0, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc0, 0x8f, 0x44, 0x60, 0x56, 0x27, 0x16, 0x74, 0xf,  0xe9, 0x85,
                                     0x35, 0xf8, 0xfc, 0x91, 0xf7, 0x43, 0x82, 0xc0, 0xda, 0x1a, 0x6f};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xad, 0xfd, 0xa3, 0x4e, 0xd8, 0xcf, 0x81, 0x2b, 0x5f,
                                     0x20, 0xeb, 0x65, 0x32, 0xd,  0x35, 0x7d, 0x92};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xdf, 0x3, 0xf4, 0x6e, 0x53, 0x6f, 0x4e, 0x4b};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2f, 0xef, 0x75, 0x54, 0x4};
  lwmqtt_string_t topic_filter_s9 = {5, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x66, 0xf1, 0x44, 0x4b, 0x1a, 0x17, 0x10, 0x66, 0x65, 0x5b, 0x1e,
                                      0x18, 0xde, 0x1b, 0x70, 0xe6, 0x5a, 0xe8, 0x76, 0x39, 0x65, 0xf6};
  lwmqtt_string_t topic_filter_s10 = {22, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0x26, 0x2e, 0x4a, 0xe2, 0x2b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31281}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 220}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29383, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22596 [("Z\234}C\SUB\171\&5&\204(&\179-\EOTJ4Z\158^\r/\210",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\155\DLE\244\181\FSv!R\140\a\235\ENQ\187D\133;",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("\247\DC267\FS'\131\SI\183\GS(6\151",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("-F\209r\195e^\215\133\254\177R\253\173\165\FS\DLE?\DC3\203Qm\153\228 4\EM\156\228",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("*\206\rj\188y\249\188o\SI\163Sfn\ENQ:II3",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1}),("\177B:\171\142\240\238\222",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2})] [PropMaximumPacketSize
// 14660,PropUserProperty "\168q\218\252\245\145\&6)\201qf\150\RS\EOT\185v\EOT\209\&2"
// "\209_\132\197]J\t\144?\157\192\219\200##2",PropRetainAvailable 205,PropTopicAliasMaximum
// 27309,PropMessageExpiryInterval 18006,PropSessionExpiryInterval 32484,PropCorrelationData
// "{e\150w\178\ENQ",PropServerReference "\170\158E\aB\211D\171M",PropServerReference
// "]\178\135\US\146\241\227\169\&5@\214\197\252\ESC\140MP\211",PropMessageExpiryInterval 27729,PropMaximumPacketSize
// 31247,PropSharedSubscriptionAvailable 63,PropSubscriptionIdentifier 23,PropSessionExpiryInterval
// 15648,PropRequestProblemInformation 36,PropServerReference
// "\202\229\162\218\NAK\NAK\\\n\DC2\f\217",PropSharedSubscriptionAvailable 93,PropMessageExpiryInterval
// 26613,PropMaximumPacketSize 2627,PropContentType "\DC4\178N\138\225\160",PropPayloadFormatIndicator
// 111,PropReasonString "\215\140\212\192\228\DC3\192\191K\n\221T\129;\169\RS\224",PropRequestProblemInformation
// 176,PropRequestProblemInformation 49,PropResponseTopic "",PropServerKeepAlive 17214,PropSubscriptionIdentifier
// 23,PropSubscriptionIdentifier 27,PropRequestProblemInformation 187,PropCorrelationData "\215iw\146\242x\202\184Q"]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0xd1, 0x2,  0x58, 0x44, 0xd0, 0x1,  0x27, 0x0,  0x0,  0x39, 0x44, 0x26, 0x0,  0x13, 0xa8, 0x71, 0xda, 0xfc,
      0xf5, 0x91, 0x36, 0x29, 0xc9, 0x71, 0x66, 0x96, 0x1e, 0x4,  0xb9, 0x76, 0x4,  0xd1, 0x32, 0x0,  0x10, 0xd1, 0x5f,
      0x84, 0xc5, 0x5d, 0x4a, 0x9,  0x90, 0x3f, 0x9d, 0xc0, 0xdb, 0xc8, 0x23, 0x23, 0x32, 0x25, 0xcd, 0x22, 0x6a, 0xad,
      0x2,  0x0,  0x0,  0x46, 0x56, 0x11, 0x0,  0x0,  0x7e, 0xe4, 0x9,  0x0,  0x6,  0x7b, 0x65, 0x96, 0x77, 0xb2, 0x5,
      0x1c, 0x0,  0x9,  0xaa, 0x9e, 0x45, 0x7,  0x42, 0xd3, 0x44, 0xab, 0x4d, 0x1c, 0x0,  0x12, 0x5d, 0xb2, 0x87, 0x1f,
      0x92, 0xf1, 0xe3, 0xa9, 0x35, 0x40, 0xd6, 0xc5, 0xfc, 0x1b, 0x8c, 0x4d, 0x50, 0xd3, 0x2,  0x0,  0x0,  0x6c, 0x51,
      0x27, 0x0,  0x0,  0x7a, 0xf,  0x2a, 0x3f, 0xb,  0x17, 0x11, 0x0,  0x0,  0x3d, 0x20, 0x17, 0x24, 0x1c, 0x0,  0xb,
      0xca, 0xe5, 0xa2, 0xda, 0x15, 0x15, 0x5c, 0xa,  0x12, 0xc,  0xd9, 0x2a, 0x5d, 0x2,  0x0,  0x0,  0x67, 0xf5, 0x27,
      0x0,  0x0,  0xa,  0x43, 0x3,  0x0,  0x6,  0x14, 0xb2, 0x4e, 0x8a, 0xe1, 0xa0, 0x1,  0x6f, 0x1f, 0x0,  0x11, 0xd7,
      0x8c, 0xd4, 0xc0, 0xe4, 0x13, 0xc0, 0xbf, 0x4b, 0xa,  0xdd, 0x54, 0x81, 0x3b, 0xa9, 0x1e, 0xe0, 0x17, 0xb0, 0x17,
      0x31, 0x8,  0x0,  0x0,  0x13, 0x43, 0x3e, 0xb,  0x17, 0xb,  0x1b, 0x17, 0xbb, 0x9,  0x0,  0x9,  0xd7, 0x69, 0x77,
      0x92, 0xf2, 0x78, 0xca, 0xb8, 0x51, 0x0,  0x16, 0x5a, 0xea, 0x7d, 0x43, 0x1a, 0xab, 0x35, 0x26, 0xcc, 0x28, 0x26,
      0xb3, 0x2d, 0x4,  0x4a, 0x34, 0x5a, 0x9e, 0x5e, 0xd,  0x2f, 0xd2, 0x29, 0x0,  0x10, 0x9b, 0x10, 0xf4, 0xb5, 0x1c,
      0x76, 0x21, 0x52, 0x8c, 0x7,  0xeb, 0x5,  0xbb, 0x44, 0x85, 0x3b, 0x2d, 0x0,  0xd,  0xf7, 0x12, 0x36, 0x37, 0x1c,
      0x27, 0x83, 0xf,  0xb7, 0x1d, 0x28, 0x36, 0x97, 0xc,  0x0,  0x1d, 0x2d, 0x46, 0xd1, 0x72, 0xc3, 0x65, 0x5e, 0xd7,
      0x85, 0xfe, 0xb1, 0x52, 0xfd, 0xad, 0xa5, 0x1c, 0x10, 0x3f, 0x13, 0xcb, 0x51, 0x6d, 0x99, 0xe4, 0x20, 0x34, 0x19,
      0x9c, 0xe4, 0x10, 0x0,  0x13, 0x2a, 0xce, 0xd,  0x6a, 0xbc, 0x79, 0xf9, 0xbc, 0x6f, 0xf,  0xa3, 0x53, 0x66, 0x6e,
      0x5,  0x3a, 0x49, 0x49, 0x33, 0x1,  0x0,  0x8,  0xb1, 0x42, 0x3a, 0xab, 0x8e, 0xf0, 0xee, 0xde, 0x26};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x5a, 0xea, 0x7d, 0x43, 0x1a, 0xab, 0x35, 0x26, 0xcc, 0x28, 0x26,
                                     0xb3, 0x2d, 0x4,  0x4a, 0x34, 0x5a, 0x9e, 0x5e, 0xd,  0x2f, 0xd2};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9b, 0x10, 0xf4, 0xb5, 0x1c, 0x76, 0x21, 0x52,
                                     0x8c, 0x7,  0xeb, 0x5,  0xbb, 0x44, 0x85, 0x3b};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf7, 0x12, 0x36, 0x37, 0x1c, 0x27, 0x83, 0xf, 0xb7, 0x1d, 0x28, 0x36, 0x97};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2d, 0x46, 0xd1, 0x72, 0xc3, 0x65, 0x5e, 0xd7, 0x85, 0xfe,
                                     0xb1, 0x52, 0xfd, 0xad, 0xa5, 0x1c, 0x10, 0x3f, 0x13, 0xcb,
                                     0x51, 0x6d, 0x99, 0xe4, 0x20, 0x34, 0x19, 0x9c, 0xe4};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2a, 0xce, 0xd,  0x6a, 0xbc, 0x79, 0xf9, 0xbc, 0x6f, 0xf,
                                     0xa3, 0x53, 0x66, 0x6e, 0x5,  0x3a, 0x49, 0x49, 0x33};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb1, 0x42, 0x3a, 0xab, 0x8e, 0xf0, 0xee, 0xde};
  lwmqtt_string_t topic_filter_s5 = {8, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  uint8_t bytesprops1[] = {0xd1, 0x5f, 0x84, 0xc5, 0x5d, 0x4a, 0x9,  0x90,
                           0x3f, 0x9d, 0xc0, 0xdb, 0xc8, 0x23, 0x23, 0x32};
  uint8_t bytesprops0[] = {0xa8, 0x71, 0xda, 0xfc, 0xf5, 0x91, 0x36, 0x29, 0xc9, 0x71,
                           0x66, 0x96, 0x1e, 0x4,  0xb9, 0x76, 0x4,  0xd1, 0x32};
  uint8_t bytesprops2[] = {0x7b, 0x65, 0x96, 0x77, 0xb2, 0x5};
  uint8_t bytesprops3[] = {0xaa, 0x9e, 0x45, 0x7, 0x42, 0xd3, 0x44, 0xab, 0x4d};
  uint8_t bytesprops4[] = {0x5d, 0xb2, 0x87, 0x1f, 0x92, 0xf1, 0xe3, 0xa9, 0x35,
                           0x40, 0xd6, 0xc5, 0xfc, 0x1b, 0x8c, 0x4d, 0x50, 0xd3};
  uint8_t bytesprops5[] = {0xca, 0xe5, 0xa2, 0xda, 0x15, 0x15, 0x5c, 0xa, 0x12, 0xc, 0xd9};
  uint8_t bytesprops6[] = {0x14, 0xb2, 0x4e, 0x8a, 0xe1, 0xa0};
  uint8_t bytesprops7[] = {0xd7, 0x8c, 0xd4, 0xc0, 0xe4, 0x13, 0xc0, 0xbf, 0x4b,
                           0xa,  0xdd, 0x54, 0x81, 0x3b, 0xa9, 0x1e, 0xe0};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0xd7, 0x69, 0x77, 0x92, 0xf2, 0x78, 0xca, 0xb8, 0x51};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14660}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops0}, .v = {16, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27309}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18006}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32484}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27729}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31247}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15648}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26613}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2627}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17214}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22596, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11045 [("\234\249\222\145'",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS0}),("\217Z\205\221w\220\&3\151\252\147\160\134\236\ru\149\189",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("J\221\215\236\181\158\210\253l\a\191z\189\211\SOq\150",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("BFVB\232\190z@:\164\132\215)\182\230\141\225\GS",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropMaximumPacketSize 12065,PropAuthenticationMethod
// "\227J\166\US*\180\DEL",PropSharedSubscriptionAvailable 15,PropWildcardSubscriptionAvailable
// 214,PropMessageExpiryInterval 4051,PropAuthenticationMethod "\191\217^E\178\249\146\183P?W",PropAuthenticationMethod
// "\FS\167\172\154\171\249\150l%E(\244\164\142D\218\179\&0d\184d\130",PropTopicAlias 26889,PropContentType
// "\142\203}\239&\216\188QFQ\DC1\a5tx\199tX?W\203",PropReceiveMaximum 28577,PropUserProperty "\DC2\128\251\&9"
// "a\DELL\n\218(\236",PropSubscriptionIdentifierAvailable 78,PropWildcardSubscriptionAvailable
// 189,PropSessionExpiryInterval 2405,PropSharedSubscriptionAvailable 232,PropTopicAliasMaximum
// 7516,PropAuthenticationMethod "\NAK\203\171\174M\FSV!\200\SIl0\137O\163sO\228",PropSessionExpiryInterval
// 30122,PropRequestProblemInformation 158,PropResponseInformation
// "D\206\196G\ENQ\227\190a{N\CANS\202\147\ETB\182\210\t\SOH\FS\230\230\192\227;iC!\193\SO",PropMaximumQoS
// 93,PropSharedSubscriptionAvailable 146,PropWildcardSubscriptionAvailable 218,PropRequestProblemInformation
// 110,PropTopicAlias 6109,PropSubscriptionIdentifierAvailable 67,PropContentType
// "\204\253(\255\222\176\228q\251\235\149\US\141L\167\228\146\202\172}W\215\&6\242\142"]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x82, 0xaa, 0x2,  0x2b, 0x25, 0xe1, 0x1,  0x27, 0x0,  0x0,  0x2f, 0x21, 0x15, 0x0,  0x7,  0xe3, 0x4a, 0xa6, 0x1f,
      0x2a, 0xb4, 0x7f, 0x2a, 0xf,  0x28, 0xd6, 0x2,  0x0,  0x0,  0xf,  0xd3, 0x15, 0x0,  0xb,  0xbf, 0xd9, 0x5e, 0x45,
      0xb2, 0xf9, 0x92, 0xb7, 0x50, 0x3f, 0x57, 0x15, 0x0,  0x16, 0x1c, 0xa7, 0xac, 0x9a, 0xab, 0xf9, 0x96, 0x6c, 0x25,
      0x45, 0x28, 0xf4, 0xa4, 0x8e, 0x44, 0xda, 0xb3, 0x30, 0x64, 0xb8, 0x64, 0x82, 0x23, 0x69, 0x9,  0x3,  0x0,  0x15,
      0x8e, 0xcb, 0x7d, 0xef, 0x26, 0xd8, 0xbc, 0x51, 0x46, 0x51, 0x11, 0x7,  0x35, 0x74, 0x78, 0xc7, 0x74, 0x58, 0x3f,
      0x57, 0xcb, 0x21, 0x6f, 0xa1, 0x26, 0x0,  0x4,  0x12, 0x80, 0xfb, 0x39, 0x0,  0x7,  0x61, 0x7f, 0x4c, 0xa,  0xda,
      0x28, 0xec, 0x29, 0x4e, 0x28, 0xbd, 0x11, 0x0,  0x0,  0x9,  0x65, 0x2a, 0xe8, 0x22, 0x1d, 0x5c, 0x15, 0x0,  0x12,
      0x15, 0xcb, 0xab, 0xae, 0x4d, 0x1c, 0x56, 0x21, 0xc8, 0xf,  0x6c, 0x30, 0x89, 0x4f, 0xa3, 0x73, 0x4f, 0xe4, 0x11,
      0x0,  0x0,  0x75, 0xaa, 0x17, 0x9e, 0x1a, 0x0,  0x1e, 0x44, 0xce, 0xc4, 0x47, 0x5,  0xe3, 0xbe, 0x61, 0x7b, 0x4e,
      0x18, 0x53, 0xca, 0x93, 0x17, 0xb6, 0xd2, 0x9,  0x1,  0x1c, 0xe6, 0xe6, 0xc0, 0xe3, 0x3b, 0x69, 0x43, 0x21, 0xc1,
      0xe,  0x24, 0x5d, 0x2a, 0x92, 0x28, 0xda, 0x17, 0x6e, 0x23, 0x17, 0xdd, 0x29, 0x43, 0x3,  0x0,  0x19, 0xcc, 0xfd,
      0x28, 0xff, 0xde, 0xb0, 0xe4, 0x71, 0xfb, 0xeb, 0x95, 0x1f, 0x8d, 0x4c, 0xa7, 0xe4, 0x92, 0xca, 0xac, 0x7d, 0x57,
      0xd7, 0x36, 0xf2, 0x8e, 0x0,  0x5,  0xea, 0xf9, 0xde, 0x91, 0x27, 0x4,  0x0,  0x11, 0xd9, 0x5a, 0xcd, 0xdd, 0x77,
      0xdc, 0x33, 0x97, 0xfc, 0x93, 0xa0, 0x86, 0xec, 0xd,  0x75, 0x95, 0xbd, 0x1c, 0x0,  0x11, 0x4a, 0xdd, 0xd7, 0xec,
      0xb5, 0x9e, 0xd2, 0xfd, 0x6c, 0x7,  0xbf, 0x7a, 0xbd, 0xd3, 0xe,  0x71, 0x96, 0x1c, 0x0,  0x12, 0x42, 0x46, 0x56,
      0x42, 0xe8, 0xbe, 0x7a, 0x40, 0x3a, 0xa4, 0x84, 0xd7, 0x29, 0xb6, 0xe6, 0x8d, 0xe1, 0x1d, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xea, 0xf9, 0xde, 0x91, 0x27};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd9, 0x5a, 0xcd, 0xdd, 0x77, 0xdc, 0x33, 0x97, 0xfc,
                                     0x93, 0xa0, 0x86, 0xec, 0xd,  0x75, 0x95, 0xbd};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4a, 0xdd, 0xd7, 0xec, 0xb5, 0x9e, 0xd2, 0xfd, 0x6c,
                                     0x7,  0xbf, 0x7a, 0xbd, 0xd3, 0xe,  0x71, 0x96};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x42, 0x46, 0x56, 0x42, 0xe8, 0xbe, 0x7a, 0x40, 0x3a,
                                     0xa4, 0x84, 0xd7, 0x29, 0xb6, 0xe6, 0x8d, 0xe1, 0x1d};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0xe3, 0x4a, 0xa6, 0x1f, 0x2a, 0xb4, 0x7f};
  uint8_t bytesprops1[] = {0xbf, 0xd9, 0x5e, 0x45, 0xb2, 0xf9, 0x92, 0xb7, 0x50, 0x3f, 0x57};
  uint8_t bytesprops2[] = {0x1c, 0xa7, 0xac, 0x9a, 0xab, 0xf9, 0x96, 0x6c, 0x25, 0x45, 0x28,
                           0xf4, 0xa4, 0x8e, 0x44, 0xda, 0xb3, 0x30, 0x64, 0xb8, 0x64, 0x82};
  uint8_t bytesprops3[] = {0x8e, 0xcb, 0x7d, 0xef, 0x26, 0xd8, 0xbc, 0x51, 0x46, 0x51, 0x11,
                           0x7,  0x35, 0x74, 0x78, 0xc7, 0x74, 0x58, 0x3f, 0x57, 0xcb};
  uint8_t bytesprops5[] = {0x61, 0x7f, 0x4c, 0xa, 0xda, 0x28, 0xec};
  uint8_t bytesprops4[] = {0x12, 0x80, 0xfb, 0x39};
  uint8_t bytesprops6[] = {0x15, 0xcb, 0xab, 0xae, 0x4d, 0x1c, 0x56, 0x21, 0xc8,
                           0xf,  0x6c, 0x30, 0x89, 0x4f, 0xa3, 0x73, 0x4f, 0xe4};
  uint8_t bytesprops7[] = {0x44, 0xce, 0xc4, 0x47, 0x5,  0xe3, 0xbe, 0x61, 0x7b, 0x4e, 0x18, 0x53, 0xca, 0x93, 0x17,
                           0xb6, 0xd2, 0x9,  0x1,  0x1c, 0xe6, 0xe6, 0xc0, 0xe3, 0x3b, 0x69, 0x43, 0x21, 0xc1, 0xe};
  uint8_t bytesprops8[] = {0xcc, 0xfd, 0x28, 0xff, 0xde, 0xb0, 0xe4, 0x71, 0xfb, 0xeb, 0x95, 0x1f, 0x8d,
                           0x4c, 0xa7, 0xe4, 0x92, 0xca, 0xac, 0x7d, 0x57, 0xd7, 0x36, 0xf2, 0x8e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12065}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4051}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26889}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28577}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops4}, .v = {7, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2405}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7516}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30122}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6109}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11045, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21249 [("7\141\154\230\129\244\236\138'\RS\208h&Y\170\r\229q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("Q",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\150+:_x<S\165o\"}\138\GS\189\239\246h\223\203\245\138\187",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Z\220\vb\170-\249\195\209\191[\195E\149\205\"\205~\249\211:\211eZ\248R",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\167\248\246\139\157{\159tb\163\204_\210\&8\177\f\182\234\RS>w\178Z\250\SYN\210\178L",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\250z\226\216\161\ETX\ACK\136\206\ESC\173\US\218\247\CAN\SI\213)z>z\188-E\195\128\181L\248'",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("W\185i\STX8n",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS0}),(",\244N\145.o\200\211.\221B{\185",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropWillDelayInterval 2019,PropMessageExpiryInterval
// 19515,PropMaximumPacketSize 11361,PropContentType
// "\202'\227\FS\137\206\&6&\131\231\&6\242\ENQ\169",PropTopicAliasMaximum 14955,PropAuthenticationData
// "\146\131,$`=2\DLE\136M\180\184\204y!}\ETX",PropReasonString
// "G\195\238\\\144\162\231\135\249\140'\152\213\&6\200\&7\180U\227\191\t\182f\DC3v3\249Z",PropRequestProblemInformation
// 101,PropPayloadFormatIndicator 153,PropWillDelayInterval 20161,PropAuthenticationData
// "\248\206\195D\167&H\189aFd,\136",PropMaximumPacketSize 8548]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x82, 0xa2, 0x2,  0x53, 0x1,  0x74, 0x18, 0x0,  0x0,  0x7,  0xe3, 0x2,  0x0,  0x0,  0x4c, 0x3b, 0x27, 0x0,  0x0,
      0x2c, 0x61, 0x3,  0x0,  0xe,  0xca, 0x27, 0xe3, 0x1c, 0x89, 0xce, 0x36, 0x26, 0x83, 0xe7, 0x36, 0xf2, 0x5,  0xa9,
      0x22, 0x3a, 0x6b, 0x16, 0x0,  0x11, 0x92, 0x83, 0x2c, 0x24, 0x60, 0x3d, 0x32, 0x10, 0x88, 0x4d, 0xb4, 0xb8, 0xcc,
      0x79, 0x21, 0x7d, 0x3,  0x1f, 0x0,  0x1c, 0x47, 0xc3, 0xee, 0x5c, 0x90, 0xa2, 0xe7, 0x87, 0xf9, 0x8c, 0x27, 0x98,
      0xd5, 0x36, 0xc8, 0x37, 0xb4, 0x55, 0xe3, 0xbf, 0x9,  0xb6, 0x66, 0x13, 0x76, 0x33, 0xf9, 0x5a, 0x17, 0x65, 0x1,
      0x99, 0x18, 0x0,  0x0,  0x4e, 0xc1, 0x16, 0x0,  0xd,  0xf8, 0xce, 0xc3, 0x44, 0xa7, 0x26, 0x48, 0xbd, 0x61, 0x46,
      0x64, 0x2c, 0x88, 0x27, 0x0,  0x0,  0x21, 0x64, 0x0,  0x12, 0x37, 0x8d, 0x9a, 0xe6, 0x81, 0xf4, 0xec, 0x8a, 0x27,
      0x1e, 0xd0, 0x68, 0x26, 0x59, 0xaa, 0xd,  0xe5, 0x71, 0xd,  0x0,  0x1,  0x51, 0x4,  0x0,  0x16, 0x96, 0x2b, 0x3a,
      0x5f, 0x78, 0x3c, 0x53, 0xa5, 0x6f, 0x22, 0x7d, 0x8a, 0x1d, 0xbd, 0xef, 0xf6, 0x68, 0xdf, 0xcb, 0xf5, 0x8a, 0xbb,
      0x1,  0x0,  0x1a, 0x5a, 0xdc, 0xb,  0x62, 0xaa, 0x2d, 0xf9, 0xc3, 0xd1, 0xbf, 0x5b, 0xc3, 0x45, 0x95, 0xcd, 0x22,
      0xcd, 0x7e, 0xf9, 0xd3, 0x3a, 0xd3, 0x65, 0x5a, 0xf8, 0x52, 0x12, 0x0,  0x1c, 0xa7, 0xf8, 0xf6, 0x8b, 0x9d, 0x7b,
      0x9f, 0x74, 0x62, 0xa3, 0xcc, 0x5f, 0xd2, 0x38, 0xb1, 0xc,  0xb6, 0xea, 0x1e, 0x3e, 0x77, 0xb2, 0x5a, 0xfa, 0x16,
      0xd2, 0xb2, 0x4c, 0x2,  0x0,  0x1e, 0xfa, 0x7a, 0xe2, 0xd8, 0xa1, 0x3,  0x6,  0x88, 0xce, 0x1b, 0xad, 0x1f, 0xda,
      0xf7, 0x18, 0xf,  0xd5, 0x29, 0x7a, 0x3e, 0x7a, 0xbc, 0x2d, 0x45, 0xc3, 0x80, 0xb5, 0x4c, 0xf8, 0x27, 0x21, 0x0,
      0x6,  0x57, 0xb9, 0x69, 0x2,  0x38, 0x6e, 0x28, 0x0,  0x0,  0x8,  0x0,  0xd,  0x2c, 0xf4, 0x4e, 0x91, 0x2e, 0x6f,
      0xc8, 0xd3, 0x2e, 0xdd, 0x42, 0x7b, 0xb9, 0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x37, 0x8d, 0x9a, 0xe6, 0x81, 0xf4, 0xec, 0x8a, 0x27,
                                     0x1e, 0xd0, 0x68, 0x26, 0x59, 0xaa, 0xd,  0xe5, 0x71};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x51};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x96, 0x2b, 0x3a, 0x5f, 0x78, 0x3c, 0x53, 0xa5, 0x6f, 0x22, 0x7d,
                                     0x8a, 0x1d, 0xbd, 0xef, 0xf6, 0x68, 0xdf, 0xcb, 0xf5, 0x8a, 0xbb};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5a, 0xdc, 0xb,  0x62, 0xaa, 0x2d, 0xf9, 0xc3, 0xd1, 0xbf, 0x5b, 0xc3, 0x45,
                                     0x95, 0xcd, 0x22, 0xcd, 0x7e, 0xf9, 0xd3, 0x3a, 0xd3, 0x65, 0x5a, 0xf8, 0x52};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7, 0xf8, 0xf6, 0x8b, 0x9d, 0x7b, 0x9f, 0x74, 0x62, 0xa3,
                                     0xcc, 0x5f, 0xd2, 0x38, 0xb1, 0xc,  0xb6, 0xea, 0x1e, 0x3e,
                                     0x77, 0xb2, 0x5a, 0xfa, 0x16, 0xd2, 0xb2, 0x4c};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfa, 0x7a, 0xe2, 0xd8, 0xa1, 0x3,  0x6,  0x88, 0xce, 0x1b,
                                     0xad, 0x1f, 0xda, 0xf7, 0x18, 0xf,  0xd5, 0x29, 0x7a, 0x3e,
                                     0x7a, 0xbc, 0x2d, 0x45, 0xc3, 0x80, 0xb5, 0x4c, 0xf8, 0x27};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x57, 0xb9, 0x69, 0x2, 0x38, 0x6e};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0};
  lwmqtt_string_t topic_filter_s7 = {0, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2c, 0xf4, 0x4e, 0x91, 0x2e, 0x6f, 0xc8, 0xd3, 0x2e, 0xdd, 0x42, 0x7b, 0xb9};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  uint8_t bytesprops0[] = {0xca, 0x27, 0xe3, 0x1c, 0x89, 0xce, 0x36, 0x26, 0x83, 0xe7, 0x36, 0xf2, 0x5, 0xa9};
  uint8_t bytesprops1[] = {0x92, 0x83, 0x2c, 0x24, 0x60, 0x3d, 0x32, 0x10, 0x88,
                           0x4d, 0xb4, 0xb8, 0xcc, 0x79, 0x21, 0x7d, 0x3};
  uint8_t bytesprops2[] = {0x47, 0xc3, 0xee, 0x5c, 0x90, 0xa2, 0xe7, 0x87, 0xf9, 0x8c, 0x27, 0x98, 0xd5, 0x36,
                           0xc8, 0x37, 0xb4, 0x55, 0xe3, 0xbf, 0x9,  0xb6, 0x66, 0x13, 0x76, 0x33, 0xf9, 0x5a};
  uint8_t bytesprops3[] = {0xf8, 0xce, 0xc3, 0x44, 0xa7, 0x26, 0x48, 0xbd, 0x61, 0x46, 0x64, 0x2c, 0x88};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2019}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19515}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11361}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14955}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20161}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8548}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21249, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32237 [("4kW\253\213\191\228\173\&8\EM\n",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("n\199=\255]\ETX\237\&4\249V\187\139\228\DELVS\208~\231\232\208\203\187JH\153D\214\183",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("I\199\145I:\210\ETX\150\215N\aE3l\184",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS =
// QoS2}),("\NAK6\182D\195\163\&3y\228P\236\212\201\235T\a\151\SUB4\235\185\ETBs",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\128j\150\163\160%mXs\152",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0})] [PropSubscriptionIdentifier 31,PropMaximumQoS 183,PropSubscriptionIdentifier
// 15,PropSessionExpiryInterval 3789,PropReceiveMaximum 2999]
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x78, 0x7d, 0xed, 0xe,  0xb,  0x1f, 0x24, 0xb7, 0xb,  0xf,  0x11, 0x0,  0x0,  0xe,  0xcd,
                   0x21, 0xb,  0xb7, 0x0,  0xb,  0x34, 0x6b, 0x57, 0xfd, 0xd5, 0xbf, 0xe4, 0xad, 0x38, 0x19, 0xa,
                   0x25, 0x0,  0x1d, 0x6e, 0xc7, 0x3d, 0xff, 0x5d, 0x3,  0xed, 0x34, 0xf9, 0x56, 0xbb, 0x8b, 0xe4,
                   0x7f, 0x56, 0x53, 0xd0, 0x7e, 0xe7, 0xe8, 0xd0, 0xcb, 0xbb, 0x4a, 0x48, 0x99, 0x44, 0xd6, 0xb7,
                   0x1d, 0x0,  0xf,  0x49, 0xc7, 0x91, 0x49, 0x3a, 0xd2, 0x3,  0x96, 0xd7, 0x4e, 0x7,  0x45, 0x33,
                   0x6c, 0xb8, 0x6,  0x0,  0x17, 0x15, 0x36, 0xb6, 0x44, 0xc3, 0xa3, 0x33, 0x79, 0xe4, 0x50, 0xec,
                   0xd4, 0xc9, 0xeb, 0x54, 0x7,  0x97, 0x1a, 0x34, 0xeb, 0xb9, 0x17, 0x73, 0xa,  0x0,  0xa,  0x80,
                   0x6a, 0x96, 0xa3, 0xa0, 0x25, 0x6d, 0x58, 0x73, 0x98, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x34, 0x6b, 0x57, 0xfd, 0xd5, 0xbf, 0xe4, 0xad, 0x38, 0x19, 0xa};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e, 0xc7, 0x3d, 0xff, 0x5d, 0x3,  0xed, 0x34, 0xf9, 0x56,
                                     0xbb, 0x8b, 0xe4, 0x7f, 0x56, 0x53, 0xd0, 0x7e, 0xe7, 0xe8,
                                     0xd0, 0xcb, 0xbb, 0x4a, 0x48, 0x99, 0x44, 0xd6, 0xb7};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x49, 0xc7, 0x91, 0x49, 0x3a, 0xd2, 0x3, 0x96,
                                     0xd7, 0x4e, 0x7,  0x45, 0x33, 0x6c, 0xb8};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x15, 0x36, 0xb6, 0x44, 0xc3, 0xa3, 0x33, 0x79, 0xe4, 0x50, 0xec, 0xd4,
                                     0xc9, 0xeb, 0x54, 0x7,  0x97, 0x1a, 0x34, 0xeb, 0xb9, 0x17, 0x73};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x80, 0x6a, 0x96, 0xa3, 0xa0, 0x25, 0x6d, 0x58, 0x73, 0x98};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 31}},   {.prop = (lwmqtt_prop_t)36, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},   {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3789}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2999}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32237, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1376 [(";\183\191\187\221\202\191\DC3FT\197\175\DC4\217>'\224\SIEx\189\194,",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("IaJ\ACK{\144@\ACK)XK\128\\7\ETX\159\146\SYN\141",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("o\209\197\246\162b\NAK\141\232A8\174\ACK\205\242+\ETX\SOHp\129\232\SUB\205\209&",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\US",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})] [PropTopicAliasMaximum
// 3417,PropWildcardSubscriptionAvailable 14,PropAuthenticationMethod
// "\154\196\197Yi\207+\182\&4\179Y\170O\174YW\ETX0*Ga\240'/\144\NAK\DC1",PropCorrelationData
// "\159Mp\235\237\145Z\166}\bOz}H\228sPO\196\150\t\242\231\219\201\235\STX;\140%",PropRequestProblemInformation
// 205,PropSubscriptionIdentifier 14,PropWillDelayInterval 11750,PropAuthenticationMethod
// "\195\190y\139\237\226\177\&9\180\145\250\182\&1yLQ\229\185\245|\205",PropUserProperty
// "\133\144;j\FS\240\ETBCYC\SI\240(\199\151\135\186\241\182-G~\190\192(\206\218\227\252<" "\227$\196 ",PropTopicAlias
// 5360,PropAuthenticationData "\167\215\156\DEL.\221\f\190\141\139B,",PropAuthenticationData
// "\159\ETB",PropReceiveMaximum 13603,PropMessageExpiryInterval 30397,PropMessageExpiryInterval
// 19344,PropMessageExpiryInterval 29512,PropServerKeepAlive 4828,PropMaximumQoS 131,PropSharedSubscriptionAvailable
// 56,PropRetainAvailable 52,PropWillDelayInterval 22307,PropMaximumPacketSize 18923,PropCorrelationData
// "\132\204\197\179\&2\136"]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x82, 0xa5, 0x2,  0x5,  0x60, 0xd1, 0x1,  0x22, 0xd,  0x59, 0x28, 0xe,  0x15, 0x0,  0x1b, 0x9a, 0xc4, 0xc5, 0x59,
      0x69, 0xcf, 0x2b, 0xb6, 0x34, 0xb3, 0x59, 0xaa, 0x4f, 0xae, 0x59, 0x57, 0x3,  0x30, 0x2a, 0x47, 0x61, 0xf0, 0x27,
      0x2f, 0x90, 0x15, 0x11, 0x9,  0x0,  0x1e, 0x9f, 0x4d, 0x70, 0xeb, 0xed, 0x91, 0x5a, 0xa6, 0x7d, 0x8,  0x4f, 0x7a,
      0x7d, 0x48, 0xe4, 0x73, 0x50, 0x4f, 0xc4, 0x96, 0x9,  0xf2, 0xe7, 0xdb, 0xc9, 0xeb, 0x2,  0x3b, 0x8c, 0x25, 0x17,
      0xcd, 0xb,  0xe,  0x18, 0x0,  0x0,  0x2d, 0xe6, 0x15, 0x0,  0x15, 0xc3, 0xbe, 0x79, 0x8b, 0xed, 0xe2, 0xb1, 0x39,
      0xb4, 0x91, 0xfa, 0xb6, 0x31, 0x79, 0x4c, 0x51, 0xe5, 0xb9, 0xf5, 0x7c, 0xcd, 0x26, 0x0,  0x1e, 0x85, 0x90, 0x3b,
      0x6a, 0x1c, 0xf0, 0x17, 0x43, 0x59, 0x43, 0xf,  0xf0, 0x28, 0xc7, 0x97, 0x87, 0xba, 0xf1, 0xb6, 0x2d, 0x47, 0x7e,
      0xbe, 0xc0, 0x28, 0xce, 0xda, 0xe3, 0xfc, 0x3c, 0x0,  0x4,  0xe3, 0x24, 0xc4, 0x20, 0x23, 0x14, 0xf0, 0x16, 0x0,
      0xc,  0xa7, 0xd7, 0x9c, 0x7f, 0x2e, 0xdd, 0xc,  0xbe, 0x8d, 0x8b, 0x42, 0x2c, 0x16, 0x0,  0x2,  0x9f, 0x17, 0x21,
      0x35, 0x23, 0x2,  0x0,  0x0,  0x76, 0xbd, 0x2,  0x0,  0x0,  0x4b, 0x90, 0x2,  0x0,  0x0,  0x73, 0x48, 0x13, 0x12,
      0xdc, 0x24, 0x83, 0x2a, 0x38, 0x25, 0x34, 0x18, 0x0,  0x0,  0x57, 0x23, 0x27, 0x0,  0x0,  0x49, 0xeb, 0x9,  0x0,
      0x6,  0x84, 0xcc, 0xc5, 0xb3, 0x32, 0x88, 0x0,  0x17, 0x3b, 0xb7, 0xbf, 0xbb, 0xdd, 0xca, 0xbf, 0x13, 0x46, 0x54,
      0xc5, 0xaf, 0x14, 0xd9, 0x3e, 0x27, 0xe0, 0xf,  0x45, 0x78, 0xbd, 0xc2, 0x2c, 0xa,  0x0,  0x13, 0x49, 0x61, 0x4a,
      0x6,  0x7b, 0x90, 0x40, 0x6,  0x29, 0x58, 0x4b, 0x80, 0x5c, 0x37, 0x3,  0x9f, 0x92, 0x16, 0x8d, 0x28, 0x0,  0x19,
      0x6f, 0xd1, 0xc5, 0xf6, 0xa2, 0x62, 0x15, 0x8d, 0xe8, 0x41, 0x38, 0xae, 0x6,  0xcd, 0xf2, 0x2b, 0x3,  0x1,  0x70,
      0x81, 0xe8, 0x1a, 0xcd, 0xd1, 0x26, 0x6,  0x0,  0x1,  0x1f, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0xb7, 0xbf, 0xbb, 0xdd, 0xca, 0xbf, 0x13, 0x46, 0x54, 0xc5, 0xaf,
                                     0x14, 0xd9, 0x3e, 0x27, 0xe0, 0xf,  0x45, 0x78, 0xbd, 0xc2, 0x2c};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x49, 0x61, 0x4a, 0x6,  0x7b, 0x90, 0x40, 0x6,  0x29, 0x58,
                                     0x4b, 0x80, 0x5c, 0x37, 0x3,  0x9f, 0x92, 0x16, 0x8d};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6f, 0xd1, 0xc5, 0xf6, 0xa2, 0x62, 0x15, 0x8d, 0xe8, 0x41, 0x38, 0xae, 0x6,
                                     0xcd, 0xf2, 0x2b, 0x3,  0x1,  0x70, 0x81, 0xe8, 0x1a, 0xcd, 0xd1, 0x26};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1f};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0x9a, 0xc4, 0xc5, 0x59, 0x69, 0xcf, 0x2b, 0xb6, 0x34, 0xb3, 0x59, 0xaa, 0x4f, 0xae,
                           0x59, 0x57, 0x3,  0x30, 0x2a, 0x47, 0x61, 0xf0, 0x27, 0x2f, 0x90, 0x15, 0x11};
  uint8_t bytesprops1[] = {0x9f, 0x4d, 0x70, 0xeb, 0xed, 0x91, 0x5a, 0xa6, 0x7d, 0x8,  0x4f, 0x7a, 0x7d, 0x48, 0xe4,
                           0x73, 0x50, 0x4f, 0xc4, 0x96, 0x9,  0xf2, 0xe7, 0xdb, 0xc9, 0xeb, 0x2,  0x3b, 0x8c, 0x25};
  uint8_t bytesprops2[] = {0xc3, 0xbe, 0x79, 0x8b, 0xed, 0xe2, 0xb1, 0x39, 0xb4, 0x91, 0xfa,
                           0xb6, 0x31, 0x79, 0x4c, 0x51, 0xe5, 0xb9, 0xf5, 0x7c, 0xcd};
  uint8_t bytesprops4[] = {0xe3, 0x24, 0xc4, 0x20};
  uint8_t bytesprops3[] = {0x85, 0x90, 0x3b, 0x6a, 0x1c, 0xf0, 0x17, 0x43, 0x59, 0x43, 0xf,  0xf0, 0x28, 0xc7, 0x97,
                           0x87, 0xba, 0xf1, 0xb6, 0x2d, 0x47, 0x7e, 0xbe, 0xc0, 0x28, 0xce, 0xda, 0xe3, 0xfc, 0x3c};
  uint8_t bytesprops5[] = {0xa7, 0xd7, 0x9c, 0x7f, 0x2e, 0xdd, 0xc, 0xbe, 0x8d, 0x8b, 0x42, 0x2c};
  uint8_t bytesprops6[] = {0x9f, 0x17};
  uint8_t bytesprops7[] = {0x84, 0xcc, 0xc5, 0xb3, 0x32, 0x88};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3417}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11750}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops3}, .v = {4, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5360}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13603}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30397}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19344}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29512}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4828}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22307}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18923}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 1376, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20213 [("\228\181kq\t",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS0}),("\217\&9\137\SYN\SUB\221t\182\SImim\223\212]",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\128",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\182\130\204\SOH\136\244\204\152",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("\163\SI&zW\202\147_\174~O\152\137\242\205\DC3\131\180w
// \252\148",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("H\DELG\141Np",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("b\201E\195z\240\\k\177\&0\240\216\209\199=\139\251\222\254\173",SubOptions {_retainHandling
// = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("cw,\227\r\161\128\EM:\197/\f\DEL\143\174\169\241\238&",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("-\131\DC3-/\EOTY\146\153]\138\149\250e\132m\EOTrrX\226",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropServerReference
// "\ESC[a\203\142\130h\DC3\241\218\DC2",PropResponseInformation "\131\&5\a\225uB",PropSubscriptionIdentifier
// 29,PropAuthenticationMethod "*\178|
// (\t\230\220\221m\159\194\b\205\r\211\215\159\195\156\245\131\233\187\b\247\&7\183\133I",PropTopicAliasMaximum
// 22977,PropServerReference "\158\SOH\187",PropUserProperty "\163[(Z\241%hh\231m"
// "/\160\220\175Z\US\236\&8\231\EM\167=t\160",PropRequestResponseInformation 47,PropReasonString
// "\229A5\f\NAK\153\150\SYN\206\EM\166Th\219\STX\233",PropWildcardSubscriptionAvailable 148,PropWillDelayInterval
// 2769,PropPayloadFormatIndicator 147,PropSubscriptionIdentifier 5,PropReasonString "\ETB
// h\201A\138H\142\207\240\252\150\a\226\a\255\134*",PropCorrelationData "\198\132@D@*\DC1Q\152",PropWillDelayInterval
// 29082,PropAuthenticationMethod "\ETX\137\r\154\189o0m\202Wn<&\193dl",PropAuthenticationData
// "E!\195B5o\193\&6\212\129\DC2j\141\frEb\229\187a\STX\250\&0\215\214\200\185\233",PropPayloadFormatIndicator
// 107,PropServerReference
// "\220\225\221\DC3\146\190\\^\220\ETXd\EML\143t\157Z\153$p\SYN\222\181",PropAssignedClientIdentifier
// "\199\184\DEL\NUL{/\ETB\244\220\ENQx\229\159\a\188\172",PropMaximumPacketSize 26239,PropResponseInformation
// "\\\GStF</y5",PropPayloadFormatIndicator 59,PropAuthenticationMethod
// "\171\205Y\194\206\133\STX\154yi\174\205[\DC3\205\212\tJ\153\"\201n\163"]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x82, 0xca, 0x3,  0x4e, 0xf5, 0xb3, 0x2,  0x1c, 0x0,  0xb,  0x1b, 0x5b, 0x61, 0xcb, 0x8e, 0x82, 0x68, 0x13, 0xf1,
      0xda, 0x12, 0x1a, 0x0,  0x6,  0x83, 0x35, 0x7,  0xe1, 0x75, 0x42, 0xb,  0x1d, 0x15, 0x0,  0x1e, 0x2a, 0xb2, 0x7c,
      0x20, 0x28, 0x9,  0xe6, 0xdc, 0xdd, 0x6d, 0x9f, 0xc2, 0x8,  0xcd, 0xd,  0xd3, 0xd7, 0x9f, 0xc3, 0x9c, 0xf5, 0x83,
      0xe9, 0xbb, 0x8,  0xf7, 0x37, 0xb7, 0x85, 0x49, 0x22, 0x59, 0xc1, 0x1c, 0x0,  0x3,  0x9e, 0x1,  0xbb, 0x26, 0x0,
      0xa,  0xa3, 0x5b, 0x28, 0x5a, 0xf1, 0x25, 0x68, 0x68, 0xe7, 0x6d, 0x0,  0xe,  0x2f, 0xa0, 0xdc, 0xaf, 0x5a, 0x1f,
      0xec, 0x38, 0xe7, 0x19, 0xa7, 0x3d, 0x74, 0xa0, 0x19, 0x2f, 0x1f, 0x0,  0x10, 0xe5, 0x41, 0x35, 0xc,  0x15, 0x99,
      0x96, 0x16, 0xce, 0x19, 0xa6, 0x54, 0x68, 0xdb, 0x2,  0xe9, 0x28, 0x94, 0x18, 0x0,  0x0,  0xa,  0xd1, 0x1,  0x93,
      0xb,  0x5,  0x1f, 0x0,  0x12, 0x17, 0x20, 0x68, 0xc9, 0x41, 0x8a, 0x48, 0x8e, 0xcf, 0xf0, 0xfc, 0x96, 0x7,  0xe2,
      0x7,  0xff, 0x86, 0x2a, 0x9,  0x0,  0x9,  0xc6, 0x84, 0x40, 0x44, 0x40, 0x2a, 0x11, 0x51, 0x98, 0x18, 0x0,  0x0,
      0x71, 0x9a, 0x15, 0x0,  0x10, 0x3,  0x89, 0xd,  0x9a, 0xbd, 0x6f, 0x30, 0x6d, 0xca, 0x57, 0x6e, 0x3c, 0x26, 0xc1,
      0x64, 0x6c, 0x16, 0x0,  0x1c, 0x45, 0x21, 0xc3, 0x42, 0x35, 0x6f, 0xc1, 0x36, 0xd4, 0x81, 0x12, 0x6a, 0x8d, 0xc,
      0x72, 0x45, 0x62, 0xe5, 0xbb, 0x61, 0x2,  0xfa, 0x30, 0xd7, 0xd6, 0xc8, 0xb9, 0xe9, 0x1,  0x6b, 0x1c, 0x0,  0x17,
      0xdc, 0xe1, 0xdd, 0x13, 0x92, 0xbe, 0x5c, 0x5e, 0xdc, 0x3,  0x64, 0x19, 0x4c, 0x8f, 0x74, 0x9d, 0x5a, 0x99, 0x24,
      0x70, 0x16, 0xde, 0xb5, 0x12, 0x0,  0x10, 0xc7, 0xb8, 0x7f, 0x0,  0x7b, 0x2f, 0x17, 0xf4, 0xdc, 0x5,  0x78, 0xe5,
      0x9f, 0x7,  0xbc, 0xac, 0x27, 0x0,  0x0,  0x66, 0x7f, 0x1a, 0x0,  0x8,  0x5c, 0x1d, 0x74, 0x46, 0x3c, 0x2f, 0x79,
      0x35, 0x1,  0x3b, 0x15, 0x0,  0x17, 0xab, 0xcd, 0x59, 0xc2, 0xce, 0x85, 0x2,  0x9a, 0x79, 0x69, 0xae, 0xcd, 0x5b,
      0x13, 0xcd, 0xd4, 0x9,  0x4a, 0x99, 0x22, 0xc9, 0x6e, 0xa3, 0x0,  0x5,  0xe4, 0xb5, 0x6b, 0x71, 0x9,  0x14, 0x0,
      0xf,  0xd9, 0x39, 0x89, 0x16, 0x1a, 0xdd, 0x74, 0xb6, 0xf,  0x6d, 0x69, 0x6d, 0xdf, 0xd4, 0x5d, 0x29, 0x0,  0x1,
      0x80, 0x4,  0x0,  0x0,  0x16, 0x0,  0x8,  0xb6, 0x82, 0xcc, 0x1,  0x88, 0xf4, 0xcc, 0x98, 0x21, 0x0,  0x16, 0xa3,
      0xf,  0x26, 0x7a, 0x57, 0xca, 0x93, 0x5f, 0xae, 0x7e, 0x4f, 0x98, 0x89, 0xf2, 0xcd, 0x13, 0x83, 0xb4, 0x77, 0x20,
      0xfc, 0x94, 0x2,  0x0,  0x6,  0x48, 0x7f, 0x47, 0x8d, 0x4e, 0x70, 0x21, 0x0,  0x14, 0x62, 0xc9, 0x45, 0xc3, 0x7a,
      0xf0, 0x5c, 0x6b, 0xb1, 0x30, 0xf0, 0xd8, 0xd1, 0xc7, 0x3d, 0x8b, 0xfb, 0xde, 0xfe, 0xad, 0x22, 0x0,  0x13, 0x63,
      0x77, 0x2c, 0xe3, 0xd,  0xa1, 0x80, 0x19, 0x3a, 0xc5, 0x2f, 0xc,  0x7f, 0x8f, 0xae, 0xa9, 0xf1, 0xee, 0x26, 0x5,
      0x0,  0x15, 0x2d, 0x83, 0x13, 0x2d, 0x2f, 0x4,  0x59, 0x92, 0x99, 0x5d, 0x8a, 0x95, 0xfa, 0x65, 0x84, 0x6d, 0x4,
      0x72, 0x72, 0x58, 0xe2, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xe4, 0xb5, 0x6b, 0x71, 0x9};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd9, 0x39, 0x89, 0x16, 0x1a, 0xdd, 0x74, 0xb6,
                                     0xf,  0x6d, 0x69, 0x6d, 0xdf, 0xd4, 0x5d};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x80};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xb6, 0x82, 0xcc, 0x1, 0x88, 0xf4, 0xcc, 0x98};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa3, 0xf,  0x26, 0x7a, 0x57, 0xca, 0x93, 0x5f, 0xae, 0x7e, 0x4f,
                                     0x98, 0x89, 0xf2, 0xcd, 0x13, 0x83, 0xb4, 0x77, 0x20, 0xfc, 0x94};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x48, 0x7f, 0x47, 0x8d, 0x4e, 0x70};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x62, 0xc9, 0x45, 0xc3, 0x7a, 0xf0, 0x5c, 0x6b, 0xb1, 0x30,
                                     0xf0, 0xd8, 0xd1, 0xc7, 0x3d, 0x8b, 0xfb, 0xde, 0xfe, 0xad};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x63, 0x77, 0x2c, 0xe3, 0xd,  0xa1, 0x80, 0x19, 0x3a, 0xc5,
                                     0x2f, 0xc,  0x7f, 0x8f, 0xae, 0xa9, 0xf1, 0xee, 0x26};
  lwmqtt_string_t topic_filter_s8 = {19, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x2d, 0x83, 0x13, 0x2d, 0x2f, 0x4, 0x59, 0x92, 0x99, 0x5d, 0x8a,
                                     0x95, 0xfa, 0x65, 0x84, 0x6d, 0x4, 0x72, 0x72, 0x58, 0xe2};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  uint8_t bytesprops0[] = {0x1b, 0x5b, 0x61, 0xcb, 0x8e, 0x82, 0x68, 0x13, 0xf1, 0xda, 0x12};
  uint8_t bytesprops1[] = {0x83, 0x35, 0x7, 0xe1, 0x75, 0x42};
  uint8_t bytesprops2[] = {0x2a, 0xb2, 0x7c, 0x20, 0x28, 0x9,  0xe6, 0xdc, 0xdd, 0x6d, 0x9f, 0xc2, 0x8,  0xcd, 0xd,
                           0xd3, 0xd7, 0x9f, 0xc3, 0x9c, 0xf5, 0x83, 0xe9, 0xbb, 0x8,  0xf7, 0x37, 0xb7, 0x85, 0x49};
  uint8_t bytesprops3[] = {0x9e, 0x1, 0xbb};
  uint8_t bytesprops5[] = {0x2f, 0xa0, 0xdc, 0xaf, 0x5a, 0x1f, 0xec, 0x38, 0xe7, 0x19, 0xa7, 0x3d, 0x74, 0xa0};
  uint8_t bytesprops4[] = {0xa3, 0x5b, 0x28, 0x5a, 0xf1, 0x25, 0x68, 0x68, 0xe7, 0x6d};
  uint8_t bytesprops6[] = {0xe5, 0x41, 0x35, 0xc,  0x15, 0x99, 0x96, 0x16,
                           0xce, 0x19, 0xa6, 0x54, 0x68, 0xdb, 0x2,  0xe9};
  uint8_t bytesprops7[] = {0x17, 0x20, 0x68, 0xc9, 0x41, 0x8a, 0x48, 0x8e, 0xcf,
                           0xf0, 0xfc, 0x96, 0x7,  0xe2, 0x7,  0xff, 0x86, 0x2a};
  uint8_t bytesprops8[] = {0xc6, 0x84, 0x40, 0x44, 0x40, 0x2a, 0x11, 0x51, 0x98};
  uint8_t bytesprops9[] = {0x3,  0x89, 0xd,  0x9a, 0xbd, 0x6f, 0x30, 0x6d,
                           0xca, 0x57, 0x6e, 0x3c, 0x26, 0xc1, 0x64, 0x6c};
  uint8_t bytesprops10[] = {0x45, 0x21, 0xc3, 0x42, 0x35, 0x6f, 0xc1, 0x36, 0xd4, 0x81, 0x12, 0x6a, 0x8d, 0xc,
                            0x72, 0x45, 0x62, 0xe5, 0xbb, 0x61, 0x2,  0xfa, 0x30, 0xd7, 0xd6, 0xc8, 0xb9, 0xe9};
  uint8_t bytesprops11[] = {0xdc, 0xe1, 0xdd, 0x13, 0x92, 0xbe, 0x5c, 0x5e, 0xdc, 0x3,  0x64, 0x19,
                            0x4c, 0x8f, 0x74, 0x9d, 0x5a, 0x99, 0x24, 0x70, 0x16, 0xde, 0xb5};
  uint8_t bytesprops12[] = {0xc7, 0xb8, 0x7f, 0x0,  0x7b, 0x2f, 0x17, 0xf4,
                            0xdc, 0x5,  0x78, 0xe5, 0x9f, 0x7,  0xbc, 0xac};
  uint8_t bytesprops13[] = {0x5c, 0x1d, 0x74, 0x46, 0x3c, 0x2f, 0x79, 0x35};
  uint8_t bytesprops14[] = {0xab, 0xcd, 0x59, 0xc2, 0xce, 0x85, 0x2,  0x9a, 0x79, 0x69, 0xae, 0xcd,
                            0x5b, 0x13, 0xcd, 0xd4, 0x9,  0x4a, 0x99, 0x22, 0xc9, 0x6e, 0xa3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22977}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops4}, .v = {14, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 47}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2769}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29082}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26239}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops14}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20213, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2875 [("\171\ESC\137\SO\239\178N8\149$\239",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\n\NUL\183\220@\191
// \EOTb\199+\141\"\152\234\207\191=\166\f\nR;\249:",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropAuthenticationMethod
// "\220\219X\190k\SOH\DC4\176\215\152|\SOH",PropMessageExpiryInterval 24887,PropReceiveMaximum
// 18721,PropServerReference "^i\194s\239\198I\150'\207\CAN\206",PropMessageExpiryInterval 14718,PropMaximumPacketSize
// 21485,PropCorrelationData "\198V\145P%\198",PropCorrelationData "\248\245\195\189W,-\170$",PropPayloadFormatIndicator
// 177,PropMessageExpiryInterval 26557,PropTopicAlias 28753,PropReceiveMaximum 15450]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x7f, 0xb,  0x3b, 0x52, 0x15, 0x0,  0xc,  0xdc, 0xdb, 0x58, 0xbe, 0x6b, 0x1,  0x14, 0xb0, 0xd7,
                   0x98, 0x7c, 0x1,  0x2,  0x0,  0x0,  0x61, 0x37, 0x21, 0x49, 0x21, 0x1c, 0x0,  0xc,  0x5e, 0x69, 0xc2,
                   0x73, 0xef, 0xc6, 0x49, 0x96, 0x27, 0xcf, 0x18, 0xce, 0x2,  0x0,  0x0,  0x39, 0x7e, 0x27, 0x0,  0x0,
                   0x53, 0xed, 0x9,  0x0,  0x6,  0xc6, 0x56, 0x91, 0x50, 0x25, 0xc6, 0x9,  0x0,  0x9,  0xf8, 0xf5, 0xc3,
                   0xbd, 0x57, 0x2c, 0x2d, 0xaa, 0x24, 0x1,  0xb1, 0x2,  0x0,  0x0,  0x67, 0xbd, 0x23, 0x70, 0x51, 0x21,
                   0x3c, 0x5a, 0x0,  0xb,  0xab, 0x1b, 0x89, 0xe,  0xef, 0xb2, 0x4e, 0x38, 0x95, 0x24, 0xef, 0x15, 0x0,
                   0x19, 0xa,  0x0,  0xb7, 0xdc, 0x40, 0xbf, 0x20, 0x4,  0x62, 0xc7, 0x2b, 0x8d, 0x22, 0x98, 0xea, 0xcf,
                   0xbf, 0x3d, 0xa6, 0xc,  0xa,  0x52, 0x3b, 0xf9, 0x3a, 0x10};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xab, 0x1b, 0x89, 0xe, 0xef, 0xb2, 0x4e, 0x38, 0x95, 0x24, 0xef};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa,  0x0,  0xb7, 0xdc, 0x40, 0xbf, 0x20, 0x4, 0x62, 0xc7, 0x2b, 0x8d, 0x22,
                                     0x98, 0xea, 0xcf, 0xbf, 0x3d, 0xa6, 0xc,  0xa, 0x52, 0x3b, 0xf9, 0x3a};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0xdc, 0xdb, 0x58, 0xbe, 0x6b, 0x1, 0x14, 0xb0, 0xd7, 0x98, 0x7c, 0x1};
  uint8_t bytesprops1[] = {0x5e, 0x69, 0xc2, 0x73, 0xef, 0xc6, 0x49, 0x96, 0x27, 0xcf, 0x18, 0xce};
  uint8_t bytesprops2[] = {0xc6, 0x56, 0x91, 0x50, 0x25, 0xc6};
  uint8_t bytesprops3[] = {0xf8, 0xf5, 0xc3, 0xbd, 0x57, 0x2c, 0x2d, 0xaa, 0x24};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24887}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18721}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14718}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21485}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26557}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28753}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15450}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2875, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13469 [("\144\198\151\135\DC4%l",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\249\GS\245H\207\198\162qF\184@",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\198\163V\201\199\CANp\234\161a\f",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS2}),("\212R\209'",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS =
// QoS1}),("\STX\192\151\241\157\237\211\129SA\NUL\189\a\138\161\204\137\RS",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("a\225rVu\DLE\US\SOH\242\166$5\217\135?,\DLE\229HF\180\"\207\151",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\232\224",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("oI\179\175\197\204\237\STX\216\167",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS1}),("\146G*\165",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\v\ENQU\202r'\152\228+\231dA\182MS\255*\137\135\175(",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("+\221^T7\161\222\SOHq>U\192R\187\247\201\195\249\165\214\&9\138\&0b",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropMaximumQoS 235]
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0xae, 0x1,  0x34, 0x9d, 0x2,  0x24, 0xeb, 0x0,  0x7,  0x90, 0xc6, 0x97, 0x87, 0x14, 0x25, 0x6c,
                   0x25, 0x0,  0xb,  0xf9, 0x1d, 0xf5, 0x48, 0xcf, 0xc6, 0xa2, 0x71, 0x46, 0xb8, 0x40, 0x1,  0x0,  0xb,
                   0xc6, 0xa3, 0x56, 0xc9, 0xc7, 0x18, 0x70, 0xea, 0xa1, 0x61, 0xc,  0xe,  0x0,  0x4,  0xd4, 0x52, 0xd1,
                   0x27, 0x5,  0x0,  0x12, 0x2,  0xc0, 0x97, 0xf1, 0x9d, 0xed, 0xd3, 0x81, 0x53, 0x41, 0x0,  0xbd, 0x7,
                   0x8a, 0xa1, 0xcc, 0x89, 0x1e, 0x19, 0x0,  0x18, 0x61, 0xe1, 0x72, 0x56, 0x75, 0x10, 0x1f, 0x1,  0xf2,
                   0xa6, 0x24, 0x35, 0xd9, 0x87, 0x3f, 0x2c, 0x10, 0xe5, 0x48, 0x46, 0xb4, 0x22, 0xcf, 0x97, 0x20, 0x0,
                   0x2,  0xe8, 0xe0, 0x1,  0x0,  0xa,  0x6f, 0x49, 0xb3, 0xaf, 0xc5, 0xcc, 0xed, 0x2,  0xd8, 0xa7, 0x29,
                   0x0,  0x4,  0x92, 0x47, 0x2a, 0xa5, 0x6,  0x0,  0x15, 0xb,  0x5,  0x55, 0xca, 0x72, 0x27, 0x98, 0xe4,
                   0x2b, 0xe7, 0x64, 0x41, 0xb6, 0x4d, 0x53, 0xff, 0x2a, 0x89, 0x87, 0xaf, 0x28, 0x6,  0x0,  0x18, 0x2b,
                   0xdd, 0x5e, 0x54, 0x37, 0xa1, 0xde, 0x1,  0x71, 0x3e, 0x55, 0xc0, 0x52, 0xbb, 0xf7, 0xc9, 0xc3, 0xf9,
                   0xa5, 0xd6, 0x39, 0x8a, 0x30, 0x62, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x90, 0xc6, 0x97, 0x87, 0x14, 0x25, 0x6c};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf9, 0x1d, 0xf5, 0x48, 0xcf, 0xc6, 0xa2, 0x71, 0x46, 0xb8, 0x40};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc6, 0xa3, 0x56, 0xc9, 0xc7, 0x18, 0x70, 0xea, 0xa1, 0x61, 0xc};
  lwmqtt_string_t topic_filter_s2 = {11, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd4, 0x52, 0xd1, 0x27};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2,  0xc0, 0x97, 0xf1, 0x9d, 0xed, 0xd3, 0x81, 0x53,
                                     0x41, 0x0,  0xbd, 0x7,  0x8a, 0xa1, 0xcc, 0x89, 0x1e};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x61, 0xe1, 0x72, 0x56, 0x75, 0x10, 0x1f, 0x1,  0xf2, 0xa6, 0x24, 0x35,
                                     0xd9, 0x87, 0x3f, 0x2c, 0x10, 0xe5, 0x48, 0x46, 0xb4, 0x22, 0xcf, 0x97};
  lwmqtt_string_t topic_filter_s5 = {24, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xe8, 0xe0};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x6f, 0x49, 0xb3, 0xaf, 0xc5, 0xcc, 0xed, 0x2, 0xd8, 0xa7};
  lwmqtt_string_t topic_filter_s7 = {10, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x92, 0x47, 0x2a, 0xa5};
  lwmqtt_string_t topic_filter_s8 = {4, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xb,  0x5,  0x55, 0xca, 0x72, 0x27, 0x98, 0xe4, 0x2b, 0xe7, 0x64,
                                     0x41, 0xb6, 0x4d, 0x53, 0xff, 0x2a, 0x89, 0x87, 0xaf, 0x28};
  lwmqtt_string_t topic_filter_s9 = {21, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x2b, 0xdd, 0x5e, 0x54, 0x37, 0xa1, 0xde, 0x1,  0x71, 0x3e, 0x55, 0xc0,
                                      0x52, 0xbb, 0xf7, 0xc9, 0xc3, 0xf9, 0xa5, 0xd6, 0x39, 0x8a, 0x30, 0x62};
  lwmqtt_string_t topic_filter_s10 = {24, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 235}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13469, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9632 [("9\192\243\129\177\140\182\244C\213\169\203\&4z!Y\215\&3\200\FS|K\216)",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\150M\179",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2})] [PropAuthenticationData "P,\186K+\tq\225\141\&0\242A\243\128:",PropPayloadFormatIndicator 184]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0x82, 0x38, 0x25, 0xa0, 0x14, 0x16, 0x0,  0xf,  0x50, 0x2c, 0xba, 0x4b, 0x2b, 0x9,  0x71,
                   0xe1, 0x8d, 0x30, 0xf2, 0x41, 0xf3, 0x80, 0x3a, 0x1,  0xb8, 0x0,  0x18, 0x39, 0xc0, 0xf3,
                   0x81, 0xb1, 0x8c, 0xb6, 0xf4, 0x43, 0xd5, 0xa9, 0xcb, 0x34, 0x7a, 0x21, 0x59, 0xd7, 0x33,
                   0xc8, 0x1c, 0x7c, 0x4b, 0xd8, 0x29, 0xd,  0x0,  0x3,  0x96, 0x4d, 0xb3, 0x12};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x39, 0xc0, 0xf3, 0x81, 0xb1, 0x8c, 0xb6, 0xf4, 0x43, 0xd5, 0xa9, 0xcb,
                                     0x34, 0x7a, 0x21, 0x59, 0xd7, 0x33, 0xc8, 0x1c, 0x7c, 0x4b, 0xd8, 0x29};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x96, 0x4d, 0xb3};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0x50, 0x2c, 0xba, 0x4b, 0x2b, 0x9, 0x71, 0xe1, 0x8d, 0x30, 0xf2, 0x41, 0xf3, 0x80, 0x3a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 184}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9632, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32536 [("\STXFdF1}k\173 c{\188a\199\bh$\SYN\179\&1\a6\DLE\DC1\181",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("{\238\131\204\f\255\221\189\217b\165\148-\170\248\223\222\134{\151p\247\153\164\n",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\137\236\169\249\206aNj\160O\152b\176\230M\205\GS\146\184\213",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("N=\251\238D\139\DC3\SYNL\154))\182\221\132\150\225",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\223!\135V\191\128\&4\190\223\171\&3\234][\195%\175\f||mp\"\214\252\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("r\158\170l\"uyP\tR\f\152\176\140\213\227\&6I\249\187A\177\&7\159\136",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\163\196",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropWillDelayInterval 24166,PropAuthenticationMethod
// "\217<zs\168\&6\170a\196\231p(\183\245\222\129\138\&8\157\149!@\217/OL\ENQ",PropAuthenticationData
// "u\255<\EOTp\253\159F\ACK\186\ESC\FS\128\142\129y\145\ETX\160\DC2Ak\225\247T",PropRetainAvailable
// 58,PropRequestResponseInformation 199,PropMessageExpiryInterval 28652,PropWillDelayInterval 18286,PropUserProperty
// "\170J\232\199\167e\224\SYN\192\135\147\166K\155" "\238\196x\SOU\216\f\135AS\178\NUL\b\162m",PropTopicAlias
// 17591,PropSubscriptionIdentifier 8,PropResponseInformation
// "P\236\135\202\171+cu\190e\136A\229\166\198",PropSubscriptionIdentifierAvailable 88,PropMaximumPacketSize
// 26483,PropReasonString "\205*\159\232xL\252\223\NAK\192\205\186\241\197r\180",PropWillDelayInterval
// 22659,PropAuthenticationData "BuQ\143",PropSubscriptionIdentifier 3,PropPayloadFormatIndicator
// 187,PropWillDelayInterval 10250,PropSharedSubscriptionAvailable 205,PropWildcardSubscriptionAvailable
// 37,PropContentType "x\253|\174p\232",PropSubscriptionIdentifierAvailable 132,PropSubscriptionIdentifier
// 20,PropServerKeepAlive 19667,PropSharedSubscriptionAvailable 205,PropResponseTopic "\222p\238"]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x82, 0xf6, 0x2,  0x7f, 0x18, 0xd1, 0x1,  0x18, 0x0,  0x0,  0x5e, 0x66, 0x15, 0x0,  0x1b, 0xd9, 0x3c, 0x7a, 0x73,
      0xa8, 0x36, 0xaa, 0x61, 0xc4, 0xe7, 0x70, 0x28, 0xb7, 0xf5, 0xde, 0x81, 0x8a, 0x38, 0x9d, 0x95, 0x21, 0x40, 0xd9,
      0x2f, 0x4f, 0x4c, 0x5,  0x16, 0x0,  0x19, 0x75, 0xff, 0x3c, 0x4,  0x70, 0xfd, 0x9f, 0x46, 0x6,  0xba, 0x1b, 0x1c,
      0x80, 0x8e, 0x81, 0x79, 0x91, 0x3,  0xa0, 0x12, 0x41, 0x6b, 0xe1, 0xf7, 0x54, 0x25, 0x3a, 0x19, 0xc7, 0x2,  0x0,
      0x0,  0x6f, 0xec, 0x18, 0x0,  0x0,  0x47, 0x6e, 0x26, 0x0,  0xe,  0xaa, 0x4a, 0xe8, 0xc7, 0xa7, 0x65, 0xe0, 0x16,
      0xc0, 0x87, 0x93, 0xa6, 0x4b, 0x9b, 0x0,  0xf,  0xee, 0xc4, 0x78, 0xe,  0x55, 0xd8, 0xc,  0x87, 0x41, 0x53, 0xb2,
      0x0,  0x8,  0xa2, 0x6d, 0x23, 0x44, 0xb7, 0xb,  0x8,  0x1a, 0x0,  0xf,  0x50, 0xec, 0x87, 0xca, 0xab, 0x2b, 0x63,
      0x75, 0xbe, 0x65, 0x88, 0x41, 0xe5, 0xa6, 0xc6, 0x29, 0x58, 0x27, 0x0,  0x0,  0x67, 0x73, 0x1f, 0x0,  0x10, 0xcd,
      0x2a, 0x9f, 0xe8, 0x78, 0x4c, 0xfc, 0xdf, 0x15, 0xc0, 0xcd, 0xba, 0xf1, 0xc5, 0x72, 0xb4, 0x18, 0x0,  0x0,  0x58,
      0x83, 0x16, 0x0,  0x4,  0x42, 0x75, 0x51, 0x8f, 0xb,  0x3,  0x1,  0xbb, 0x18, 0x0,  0x0,  0x28, 0xa,  0x2a, 0xcd,
      0x28, 0x25, 0x3,  0x0,  0x6,  0x78, 0xfd, 0x7c, 0xae, 0x70, 0xe8, 0x29, 0x84, 0xb,  0x14, 0x13, 0x4c, 0xd3, 0x2a,
      0xcd, 0x8,  0x0,  0x3,  0xde, 0x70, 0xee, 0x0,  0x19, 0x2,  0x46, 0x64, 0x46, 0x31, 0x7d, 0x6b, 0xad, 0x20, 0x63,
      0x7b, 0xbc, 0x61, 0xc7, 0x8,  0x68, 0x24, 0x16, 0xb3, 0x31, 0x7,  0x36, 0x10, 0x11, 0xb5, 0x25, 0x0,  0x19, 0x7b,
      0xee, 0x83, 0xcc, 0xc,  0xff, 0xdd, 0xbd, 0xd9, 0x62, 0xa5, 0x94, 0x2d, 0xaa, 0xf8, 0xdf, 0xde, 0x86, 0x7b, 0x97,
      0x70, 0xf7, 0x99, 0xa4, 0xa,  0x21, 0x0,  0x14, 0x89, 0xec, 0xa9, 0xf9, 0xce, 0x61, 0x4e, 0x6a, 0xa0, 0x4f, 0x98,
      0x62, 0xb0, 0xe6, 0x4d, 0xcd, 0x1d, 0x92, 0xb8, 0xd5, 0x12, 0x0,  0x11, 0x4e, 0x3d, 0xfb, 0xee, 0x44, 0x8b, 0x13,
      0x16, 0x4c, 0x9a, 0x29, 0x29, 0xb6, 0xdd, 0x84, 0x96, 0xe1, 0x26, 0x0,  0x1a, 0xdf, 0x21, 0x87, 0x56, 0xbf, 0x80,
      0x34, 0xbe, 0xdf, 0xab, 0x33, 0xea, 0x5d, 0x5b, 0xc3, 0x25, 0xaf, 0xc,  0x7c, 0x7c, 0x6d, 0x70, 0x22, 0xd6, 0xfc,
      0xaa, 0xa,  0x0,  0x19, 0x72, 0x9e, 0xaa, 0x6c, 0x22, 0x75, 0x79, 0x50, 0x9,  0x52, 0xc,  0x98, 0xb0, 0x8c, 0xd5,
      0xe3, 0x36, 0x49, 0xf9, 0xbb, 0x41, 0xb1, 0x37, 0x9f, 0x88, 0x26, 0x0,  0x2,  0xa3, 0xc4, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x2,  0x46, 0x64, 0x46, 0x31, 0x7d, 0x6b, 0xad, 0x20, 0x63, 0x7b, 0xbc, 0x61,
                                     0xc7, 0x8,  0x68, 0x24, 0x16, 0xb3, 0x31, 0x7,  0x36, 0x10, 0x11, 0xb5};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7b, 0xee, 0x83, 0xcc, 0xc,  0xff, 0xdd, 0xbd, 0xd9, 0x62, 0xa5, 0x94, 0x2d,
                                     0xaa, 0xf8, 0xdf, 0xde, 0x86, 0x7b, 0x97, 0x70, 0xf7, 0x99, 0xa4, 0xa};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x89, 0xec, 0xa9, 0xf9, 0xce, 0x61, 0x4e, 0x6a, 0xa0, 0x4f,
                                     0x98, 0x62, 0xb0, 0xe6, 0x4d, 0xcd, 0x1d, 0x92, 0xb8, 0xd5};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x4e, 0x3d, 0xfb, 0xee, 0x44, 0x8b, 0x13, 0x16, 0x4c,
                                     0x9a, 0x29, 0x29, 0xb6, 0xdd, 0x84, 0x96, 0xe1};
  lwmqtt_string_t topic_filter_s3 = {17, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xdf, 0x21, 0x87, 0x56, 0xbf, 0x80, 0x34, 0xbe, 0xdf, 0xab, 0x33, 0xea, 0x5d,
                                     0x5b, 0xc3, 0x25, 0xaf, 0xc,  0x7c, 0x7c, 0x6d, 0x70, 0x22, 0xd6, 0xfc, 0xaa};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x72, 0x9e, 0xaa, 0x6c, 0x22, 0x75, 0x79, 0x50, 0x9,  0x52, 0xc,  0x98, 0xb0,
                                     0x8c, 0xd5, 0xe3, 0x36, 0x49, 0xf9, 0xbb, 0x41, 0xb1, 0x37, 0x9f, 0x88};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa3, 0xc4};
  lwmqtt_string_t topic_filter_s6 = {2, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  uint8_t bytesprops0[] = {0xd9, 0x3c, 0x7a, 0x73, 0xa8, 0x36, 0xaa, 0x61, 0xc4, 0xe7, 0x70, 0x28, 0xb7, 0xf5,
                           0xde, 0x81, 0x8a, 0x38, 0x9d, 0x95, 0x21, 0x40, 0xd9, 0x2f, 0x4f, 0x4c, 0x5};
  uint8_t bytesprops1[] = {0x75, 0xff, 0x3c, 0x4,  0x70, 0xfd, 0x9f, 0x46, 0x6,  0xba, 0x1b, 0x1c, 0x80,
                           0x8e, 0x81, 0x79, 0x91, 0x3,  0xa0, 0x12, 0x41, 0x6b, 0xe1, 0xf7, 0x54};
  uint8_t bytesprops3[] = {0xee, 0xc4, 0x78, 0xe, 0x55, 0xd8, 0xc, 0x87, 0x41, 0x53, 0xb2, 0x0, 0x8, 0xa2, 0x6d};
  uint8_t bytesprops2[] = {0xaa, 0x4a, 0xe8, 0xc7, 0xa7, 0x65, 0xe0, 0x16, 0xc0, 0x87, 0x93, 0xa6, 0x4b, 0x9b};
  uint8_t bytesprops4[] = {0x50, 0xec, 0x87, 0xca, 0xab, 0x2b, 0x63, 0x75, 0xbe, 0x65, 0x88, 0x41, 0xe5, 0xa6, 0xc6};
  uint8_t bytesprops5[] = {0xcd, 0x2a, 0x9f, 0xe8, 0x78, 0x4c, 0xfc, 0xdf,
                           0x15, 0xc0, 0xcd, 0xba, 0xf1, 0xc5, 0x72, 0xb4};
  uint8_t bytesprops6[] = {0x42, 0x75, 0x51, 0x8f};
  uint8_t bytesprops7[] = {0x78, 0xfd, 0x7c, 0xae, 0x70, 0xe8};
  uint8_t bytesprops8[] = {0xde, 0x70, 0xee};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24166}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28652}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18286}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops2}, .v = {15, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17591}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26483}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22659}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10250}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19667}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32536, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8552 [("]4\248\137\131\225_b\212\169\ETB\r",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\189\197\252R\ESC\GSJu",SubOptions {_retainHandling
// = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("8#\221F96b\232\216\162\191\129(\152\184\DEL",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("`\173\EM\193X\175l}[\182\b\194\146S0;0\ESCkSX#:",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\139E\182\226c{\194\248\214N?\196\221\221\195%<\SI9",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\134\147\229\f\251`A\191\GS",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("h\248Ay\190)%\\6\168\199",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS0}),("\182\ETB\208\179\128\200\169RV\232=S+D\223S",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\172\216\203\210O\225",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1})] []
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x96, 0x1,  0x21, 0x68, 0x0,  0x0,  0xc,  0x5d, 0x34, 0xf8, 0x89, 0x83, 0xe1, 0x5f, 0x62, 0xd4,
                   0xa9, 0x17, 0xd,  0x12, 0x0,  0x8,  0xbd, 0xc5, 0xfc, 0x52, 0x1b, 0x1d, 0x4a, 0x75, 0x16, 0x0,  0x10,
                   0x38, 0x23, 0xdd, 0x46, 0x39, 0x36, 0x62, 0xe8, 0xd8, 0xa2, 0xbf, 0x81, 0x28, 0x98, 0xb8, 0x7f, 0xe,
                   0x0,  0x17, 0x60, 0xad, 0x19, 0xc1, 0x58, 0xaf, 0x6c, 0x7d, 0x5b, 0xb6, 0x8,  0xc2, 0x92, 0x53, 0x30,
                   0x3b, 0x30, 0x1b, 0x6b, 0x53, 0x58, 0x23, 0x3a, 0x29, 0x0,  0x13, 0x8b, 0x45, 0xb6, 0xe2, 0x63, 0x7b,
                   0xc2, 0xf8, 0xd6, 0x4e, 0x3f, 0xc4, 0xdd, 0xdd, 0xc3, 0x25, 0x3c, 0xf,  0x39, 0x29, 0x0,  0x9,  0x86,
                   0x93, 0xe5, 0xc,  0xfb, 0x60, 0x41, 0xbf, 0x1d, 0x10, 0x0,  0xb,  0x68, 0xf8, 0x41, 0x79, 0xbe, 0x29,
                   0x25, 0x5c, 0x36, 0xa8, 0xc7, 0x18, 0x0,  0x10, 0xb6, 0x17, 0xd0, 0xb3, 0x80, 0xc8, 0xa9, 0x52, 0x56,
                   0xe8, 0x3d, 0x53, 0x2b, 0x44, 0xdf, 0x53, 0x2d, 0x0,  0x6,  0xac, 0xd8, 0xcb, 0xd2, 0x4f, 0xe1, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x5d, 0x34, 0xf8, 0x89, 0x83, 0xe1, 0x5f, 0x62, 0xd4, 0xa9, 0x17, 0xd};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbd, 0xc5, 0xfc, 0x52, 0x1b, 0x1d, 0x4a, 0x75};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x38, 0x23, 0xdd, 0x46, 0x39, 0x36, 0x62, 0xe8,
                                     0xd8, 0xa2, 0xbf, 0x81, 0x28, 0x98, 0xb8, 0x7f};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x60, 0xad, 0x19, 0xc1, 0x58, 0xaf, 0x6c, 0x7d, 0x5b, 0xb6, 0x8, 0xc2,
                                     0x92, 0x53, 0x30, 0x3b, 0x30, 0x1b, 0x6b, 0x53, 0x58, 0x23, 0x3a};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8b, 0x45, 0xb6, 0xe2, 0x63, 0x7b, 0xc2, 0xf8, 0xd6, 0x4e,
                                     0x3f, 0xc4, 0xdd, 0xdd, 0xc3, 0x25, 0x3c, 0xf,  0x39};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x86, 0x93, 0xe5, 0xc, 0xfb, 0x60, 0x41, 0xbf, 0x1d};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x68, 0xf8, 0x41, 0x79, 0xbe, 0x29, 0x25, 0x5c, 0x36, 0xa8, 0xc7};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb6, 0x17, 0xd0, 0xb3, 0x80, 0xc8, 0xa9, 0x52,
                                     0x56, 0xe8, 0x3d, 0x53, 0x2b, 0x44, 0xdf, 0x53};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xac, 0xd8, 0xcb, 0xd2, 0x4f, 0xe1};
  lwmqtt_string_t topic_filter_s8 = {6, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS1;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8552, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21918 [("\253`\DLE\211u\248\DLE\EM\254\171\202\139\231",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\232K\189x\159_\CAN>\184'\159\128dT\156,Sx",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\143\f\GS\206\232\253e\EOTnk\201\SOH\129\176\DLE}\249\186\178*\248C\143\134\192\232\DC1T",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\152\143d\215c\ACK\243*\227%\223e5a\210z}\170=7%c\157",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\213\\n\ETX\EM\163L\232\170",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),(".",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\130$g=T];\221D\158\145\220\214\154",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = False, _subQoS = QoS1}),(")?Gbx/Ti\252/-\ACK\149\&5\176\184\156\\\CAN\ENQ\GS\191",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\139~1f\212\151\NUL\158C_8P",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("mt\246\185$\ENQjC\163\161\DC1\CAN\195\SO-i\224\241\208m",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})]
// [PropReceiveMaximum 15228,PropPayloadFormatIndicator 153,PropMessageExpiryInterval 10918,PropAuthenticationMethod
// "\253\155)\236",PropAssignedClientIdentifier "\199Oy9\184\130\214SC",PropPayloadFormatIndicator
// 206,PropCorrelationData "\138v>\252\195\147\131\201\248\214W\210",PropRetainAvailable 151,PropPayloadFormatIndicator
// 31,PropMaximumQoS 75,PropReasonString "\212\f",PropSessionExpiryInterval 3402,PropAuthenticationMethod
// "?\181\217\248\DC3gG\177P\232\153\215\182\146\224\197\USyy",PropRequestProblemInformation 35,PropTopicAlias
// 15652,PropAuthenticationData "\DLE3|",PropUserProperty "A\213\211+eKtm2Yi\193\166\138"
// "\220\&4zq&|p\131M\167\NAK\SOHB\168d(u\SOH\254\187\196",PropAuthenticationMethod
// "\DEL",PropWildcardSubscriptionAvailable 87,PropAuthenticationData "\214_\a\ESC\180\155",PropWillDelayInterval
// 16782,PropSubscriptionIdentifier 31,PropCorrelationData "\144\154c\128\FS\142\252\231\234\129:V
// \130\DC3<N\251j\144d"]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x82, 0xf7, 0x2,  0x55, 0x9e, 0xb5, 0x1,  0x21, 0x3b, 0x7c, 0x1,  0x99, 0x2,  0x0,  0x0,  0x2a, 0xa6, 0x15, 0x0,
      0x4,  0xfd, 0x9b, 0x29, 0xec, 0x12, 0x0,  0x9,  0xc7, 0x4f, 0x79, 0x39, 0xb8, 0x82, 0xd6, 0x53, 0x43, 0x1,  0xce,
      0x9,  0x0,  0xc,  0x8a, 0x76, 0x3e, 0xfc, 0xc3, 0x93, 0x83, 0xc9, 0xf8, 0xd6, 0x57, 0xd2, 0x25, 0x97, 0x1,  0x1f,
      0x24, 0x4b, 0x1f, 0x0,  0x2,  0xd4, 0xc,  0x11, 0x0,  0x0,  0xd,  0x4a, 0x15, 0x0,  0x13, 0x3f, 0xb5, 0xd9, 0xf8,
      0x13, 0x67, 0x47, 0xb1, 0x50, 0xe8, 0x99, 0xd7, 0xb6, 0x92, 0xe0, 0xc5, 0x1f, 0x79, 0x79, 0x17, 0x23, 0x23, 0x3d,
      0x24, 0x16, 0x0,  0x3,  0x10, 0x33, 0x7c, 0x26, 0x0,  0xe,  0x41, 0xd5, 0xd3, 0x2b, 0x65, 0x4b, 0x74, 0x6d, 0x32,
      0x59, 0x69, 0xc1, 0xa6, 0x8a, 0x0,  0x15, 0xdc, 0x34, 0x7a, 0x71, 0x26, 0x7c, 0x70, 0x83, 0x4d, 0xa7, 0x15, 0x1,
      0x42, 0xa8, 0x64, 0x28, 0x75, 0x1,  0xfe, 0xbb, 0xc4, 0x15, 0x0,  0x1,  0x7f, 0x28, 0x57, 0x16, 0x0,  0x6,  0xd6,
      0x5f, 0x7,  0x1b, 0xb4, 0x9b, 0x18, 0x0,  0x0,  0x41, 0x8e, 0xb,  0x1f, 0x9,  0x0,  0x15, 0x90, 0x9a, 0x63, 0x80,
      0x1c, 0x8e, 0xfc, 0xe7, 0xea, 0x81, 0x3a, 0x56, 0x20, 0x82, 0x13, 0x3c, 0x4e, 0xfb, 0x6a, 0x90, 0x64, 0x0,  0xd,
      0xfd, 0x60, 0x10, 0xd3, 0x75, 0xf8, 0x10, 0x19, 0xfe, 0xab, 0xca, 0x8b, 0xe7, 0x20, 0x0,  0x12, 0xe8, 0x4b, 0xbd,
      0x78, 0x9f, 0x5f, 0x18, 0x3e, 0xb8, 0x27, 0x9f, 0x80, 0x64, 0x54, 0x9c, 0x2c, 0x53, 0x78, 0xc,  0x0,  0x1c, 0x8f,
      0xc,  0x1d, 0xce, 0xe8, 0xfd, 0x65, 0x4,  0x6e, 0x6b, 0xc9, 0x1,  0x81, 0xb0, 0x10, 0x7d, 0xf9, 0xba, 0xb2, 0x2a,
      0xf8, 0x43, 0x8f, 0x86, 0xc0, 0xe8, 0x11, 0x54, 0x26, 0x0,  0x17, 0x98, 0x8f, 0x64, 0xd7, 0x63, 0x6,  0xf3, 0x2a,
      0xe3, 0x25, 0xdf, 0x65, 0x35, 0x61, 0xd2, 0x7a, 0x7d, 0xaa, 0x3d, 0x37, 0x25, 0x63, 0x9d, 0xe,  0x0,  0x9,  0xd5,
      0x5c, 0x6e, 0x3,  0x19, 0xa3, 0x4c, 0xe8, 0xaa, 0x29, 0x0,  0x1,  0x2e, 0x2d, 0x0,  0xe,  0x82, 0x24, 0x67, 0x3d,
      0x54, 0x5d, 0x3b, 0xdd, 0x44, 0x9e, 0x91, 0xdc, 0xd6, 0x9a, 0x29, 0x0,  0x16, 0x29, 0x3f, 0x47, 0x62, 0x78, 0x2f,
      0x54, 0x69, 0xfc, 0x2f, 0x2d, 0x6,  0x95, 0x35, 0xb0, 0xb8, 0x9c, 0x5c, 0x18, 0x5,  0x1d, 0xbf, 0x22, 0x0,  0xc,
      0x8b, 0x7e, 0x31, 0x66, 0xd4, 0x97, 0x0,  0x9e, 0x43, 0x5f, 0x38, 0x50, 0x6,  0x0,  0x14, 0x6d, 0x74, 0xf6, 0xb9,
      0x24, 0x5,  0x6a, 0x43, 0xa3, 0xa1, 0x11, 0x18, 0xc3, 0xe,  0x2d, 0x69, 0xe0, 0xf1, 0xd0, 0x6d, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xfd, 0x60, 0x10, 0xd3, 0x75, 0xf8, 0x10, 0x19, 0xfe, 0xab, 0xca, 0x8b, 0xe7};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe8, 0x4b, 0xbd, 0x78, 0x9f, 0x5f, 0x18, 0x3e, 0xb8,
                                     0x27, 0x9f, 0x80, 0x64, 0x54, 0x9c, 0x2c, 0x53, 0x78};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8f, 0xc,  0x1d, 0xce, 0xe8, 0xfd, 0x65, 0x4,  0x6e, 0x6b,
                                     0xc9, 0x1,  0x81, 0xb0, 0x10, 0x7d, 0xf9, 0xba, 0xb2, 0x2a,
                                     0xf8, 0x43, 0x8f, 0x86, 0xc0, 0xe8, 0x11, 0x54};
  lwmqtt_string_t topic_filter_s2 = {28, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x98, 0x8f, 0x64, 0xd7, 0x63, 0x6,  0xf3, 0x2a, 0xe3, 0x25, 0xdf, 0x65,
                                     0x35, 0x61, 0xd2, 0x7a, 0x7d, 0xaa, 0x3d, 0x37, 0x25, 0x63, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd5, 0x5c, 0x6e, 0x3, 0x19, 0xa3, 0x4c, 0xe8, 0xaa};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x2e};
  lwmqtt_string_t topic_filter_s5 = {1, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x82, 0x24, 0x67, 0x3d, 0x54, 0x5d, 0x3b,
                                     0xdd, 0x44, 0x9e, 0x91, 0xdc, 0xd6, 0x9a};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x29, 0x3f, 0x47, 0x62, 0x78, 0x2f, 0x54, 0x69, 0xfc, 0x2f, 0x2d,
                                     0x6,  0x95, 0x35, 0xb0, 0xb8, 0x9c, 0x5c, 0x18, 0x5,  0x1d, 0xbf};
  lwmqtt_string_t topic_filter_s7 = {22, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x8b, 0x7e, 0x31, 0x66, 0xd4, 0x97, 0x0, 0x9e, 0x43, 0x5f, 0x38, 0x50};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x6d, 0x74, 0xf6, 0xb9, 0x24, 0x5,  0x6a, 0x43, 0xa3, 0xa1,
                                     0x11, 0x18, 0xc3, 0xe,  0x2d, 0x69, 0xe0, 0xf1, 0xd0, 0x6d};
  lwmqtt_string_t topic_filter_s9 = {20, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS0;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  uint8_t bytesprops0[] = {0xfd, 0x9b, 0x29, 0xec};
  uint8_t bytesprops1[] = {0xc7, 0x4f, 0x79, 0x39, 0xb8, 0x82, 0xd6, 0x53, 0x43};
  uint8_t bytesprops2[] = {0x8a, 0x76, 0x3e, 0xfc, 0xc3, 0x93, 0x83, 0xc9, 0xf8, 0xd6, 0x57, 0xd2};
  uint8_t bytesprops3[] = {0xd4, 0xc};
  uint8_t bytesprops4[] = {0x3f, 0xb5, 0xd9, 0xf8, 0x13, 0x67, 0x47, 0xb1, 0x50, 0xe8,
                           0x99, 0xd7, 0xb6, 0x92, 0xe0, 0xc5, 0x1f, 0x79, 0x79};
  uint8_t bytesprops5[] = {0x10, 0x33, 0x7c};
  uint8_t bytesprops7[] = {0xdc, 0x34, 0x7a, 0x71, 0x26, 0x7c, 0x70, 0x83, 0x4d, 0xa7, 0x15,
                           0x1,  0x42, 0xa8, 0x64, 0x28, 0x75, 0x1,  0xfe, 0xbb, 0xc4};
  uint8_t bytesprops6[] = {0x41, 0xd5, 0xd3, 0x2b, 0x65, 0x4b, 0x74, 0x6d, 0x32, 0x59, 0x69, 0xc1, 0xa6, 0x8a};
  uint8_t bytesprops8[] = {0x7f};
  uint8_t bytesprops9[] = {0xd6, 0x5f, 0x7, 0x1b, 0xb4, 0x9b};
  uint8_t bytesprops10[] = {0x90, 0x9a, 0x63, 0x80, 0x1c, 0x8e, 0xfc, 0xe7, 0xea, 0x81, 0x3a,
                            0x56, 0x20, 0x82, 0x13, 0x3c, 0x4e, 0xfb, 0x6a, 0x90, 0x64};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15228}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10918}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3402}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15652}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops6}, .v = {21, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16782}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 31}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21918, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 32402 [("\222d\154J\229\133\152\210\152Q\129\228R\184<\202\149\147\206\245\169",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\195\186",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS
// = QoS1})] []
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x20, 0x7e, 0x92, 0x0,  0x0,  0x15, 0xde, 0x64, 0x9a, 0x4a, 0xe5, 0x85, 0x98, 0xd2, 0x98, 0x51,
                   0x81, 0xe4, 0x52, 0xb8, 0x3c, 0xca, 0x95, 0x93, 0xce, 0xf5, 0xa9, 0x11, 0x0,  0x2,  0xc3, 0xba, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xde, 0x64, 0x9a, 0x4a, 0xe5, 0x85, 0x98, 0xd2, 0x98, 0x51, 0x81,
                                     0xe4, 0x52, 0xb8, 0x3c, 0xca, 0x95, 0x93, 0xce, 0xf5, 0xa9};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc3, 0xba};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 32402, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeResponse 9775 [Left SubErrUnspecifiedError,Right QoS1,Left SubErrUnspecifiedError,Left
// SubErrSharedSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0x6, 0x26, 0x2f, 0x80, 0x1, 0x80, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9775);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 5148 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Left SubErrQuotaExceeded,Right
// QoS2,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Right QoS1,Right QoS0,Left SubErrNotAuthorized,Right
// QoS2] []
TEST(SubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0xc, 0x14, 0x1c, 0x9e, 0x0, 0x97, 0x2, 0xa2, 0x0, 0x1, 0x0, 0x87, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5148);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 6967 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS1,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x7, 0x1b, 0x37, 0xa2, 0x2, 0x1, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6967);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 10422 [Right QoS1,Right QoS0,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0x6, 0x28, 0xb6, 0x1, 0x0, 0x2, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10422);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 9120 [Left SubErrTopicFilterInvalid,Right QoS0,Right QoS0,Left SubErrQuotaExceeded,Right QoS0,Left
// SubErrImplementationSpecificError] []
TEST(SubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x8, 0x23, 0xa0, 0x8f, 0x0, 0x0, 0x97, 0x0, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9120);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
}

// SubscribeResponse 32151 [Right QoS2,Left SubErrNotAuthorized,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS0] []
TEST(SubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0x7, 0x7d, 0x97, 0x2, 0x87, 0x1, 0xa2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32151);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
}

// SubscribeResponse 26123 [Right QoS1,Right QoS0,Right QoS2] []
TEST(SubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x5, 0x66, 0xb, 0x1, 0x0, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26123);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
}

// SubscribeResponse 29973 [Right QoS2,Left SubErrPacketIdentifierInUse,Left SubErrImplementationSpecificError,Right
// QoS0,Right QoS2,Right QoS1] []
TEST(SubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0x8, 0x75, 0x15, 0x2, 0x91, 0x83, 0x0, 0x2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29973);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 14366 [Left SubErrSharedSubscriptionsNotSupported,Right QoS2,Right QoS1,Left
// SubErrSharedSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0x6, 0x38, 0x1e, 0x9e, 0x2, 0x1, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14366);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 10906 [Left SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right
// QoS1,Left SubErrPacketIdentifierInUse,Left SubErrNotAuthorized,Left SubErrImplementationSpecificError,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrTopicFilterInvalid,Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0xd, 0x2a, 0x9a, 0x80, 0xa2, 0x2, 0x1, 0x91, 0x87, 0x83, 0x9e, 0x1, 0x8f, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10906);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 11558 [Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrQuotaExceeded,Left
// SubErrNotAuthorized,Right QoS0,Right QoS2,Left SubErrQuotaExceeded,Left SubErrImplementationSpecificError] []
TEST(SubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0xc, 0x2d, 0x26, 0x83, 0x80, 0x80, 0xa1, 0x97, 0x87, 0x0, 0x2, 0x97, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11558);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
}

// SubscribeResponse 9362 [Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrPacketIdentifierInUse,Left
// SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x5, 0x24, 0x92, 0xa1, 0x91, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9362);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 23793 [Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS2,Right QoS0,Left SubErrImplementationSpecificError,Right
// QoS0,Left SubErrSharedSubscriptionsNotSupported,Left SubErrSharedSubscriptionsNotSupported,Right QoS0] []
TEST(SubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0xc, 0x5c, 0xf1, 0xa2, 0x9e, 0x1, 0x2, 0x0, 0x83, 0x0, 0x9e, 0x9e, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23793);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 11397 [Left SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS1,Left SubErrImplementationSpecificError,Left
// SubErrTopicFilterInvalid,Right QoS1,Right QoS0,Right QoS1,Right QoS1] []
TEST(SubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0xd, 0x2c, 0x85, 0x8f, 0xa1, 0x0, 0xa2, 0x1, 0x83, 0x8f, 0x1, 0x0, 0x1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11397);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS1);
}

// SubscribeResponse 5337 [Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0x3, 0x14, 0xd9, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5337);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
}

// SubscribeResponse 32213 [Left SubErrQuotaExceeded,Right QoS0,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Right QoS1] []
TEST(SubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0x8, 0x7d, 0xd5, 0x97, 0x0, 0x0, 0x9e, 0xa2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32213);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 1504 [Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrTopicFilterInvalid,Right QoS1,Right QoS1] []
TEST(SubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x8, 0x5, 0xe0, 0xa1, 0x9e, 0x1, 0x8f, 0x1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1504);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 2008 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse,Right
// QoS2,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0x7, 0x7, 0xd8, 0x2, 0x9e, 0x91, 0x2, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2008);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 19894 [Left SubErrNotAuthorized,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrQuotaExceeded] []
TEST(SubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0x8, 0x4d, 0xb6, 0x87, 0x9e, 0xa1, 0x0, 0xa1, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19894);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
}

// SubscribeResponse 12423 [Left SubErrNotAuthorized,Right QoS0,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0x6, 0x30, 0x87, 0x87, 0x0, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12423);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
}

// SubscribeResponse 21901 [Left SubErrQuotaExceeded,Left SubErrImplementationSpecificError,Right QoS0,Right QoS0] []
TEST(SubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x6, 0x55, 0x8d, 0x97, 0x83, 0x0, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21901);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
}

// SubscribeResponse 9953 [Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Right QoS1] []
TEST(SubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0x5, 0x26, 0xe1, 0x0, 0xa2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9953);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
}

// SubscribeResponse 21846 [Left SubErrTopicFilterInvalid,Left SubErrImplementationSpecificError,Right QoS2,Right
// QoS1,Right QoS0,Right QoS0,Left SubErrImplementationSpecificError,Left SubErrTopicFilterInvalid,Right QoS2] []
TEST(SubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0xb, 0x55, 0x56, 0x8f, 0x83, 0x2, 0x1, 0x0, 0x0, 0x83, 0x8f, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21846);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 25983 [Right QoS2] []
TEST(SubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x3, 0x65, 0x7f, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25983);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
}

// SubscribeResponse 803 [Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrNotAuthorized,Right
// QoS2,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1] []
TEST(SubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x8, 0x3, 0x23, 0x0, 0xa2, 0x87, 0x2, 0xa1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 803);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 6677 [Right QoS0,Right QoS1,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError,Right QoS0,Right QoS1,Right QoS2,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrNotAuthorized,Right QoS0] []
TEST(SubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0xd, 0x1a, 0x15, 0x0, 0x1, 0x8f, 0x83, 0x0, 0x1, 0x2, 0x2, 0xa1, 0x87, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6677);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS0);
}

// SubscribeResponse 7481 [Left SubErrNotAuthorized,Right QoS1,Right QoS2,Left SubErrNotAuthorized] []
TEST(SubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x6, 0x1d, 0x39, 0x87, 0x1, 0x2, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7481);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 26117 [Right QoS2,Right QoS0,Right QoS0] []
TEST(SubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x5, 0x66, 0x5, 0x2, 0x0, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26117);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
}

// SubscribeResponse 4603 [Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0x3, 0x11, 0xfb, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4603);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
}

// SubscribeResponse 32025 [Left SubErrPacketIdentifierInUse] []
TEST(SubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0x3, 0x7d, 0x19, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32025);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
}

// SubscribeResponse 9775 [Left SubErrUnspecifiedError,Right QoS1,Left SubErrUnspecifiedError,Left
// SubErrSharedSubscriptionsNotSupported] [PropAuthenticationData
// "\234\f\220v\216\CAN\145\150Z\136\149e\141\251\177Y",PropMaximumQoS 189,PropMaximumQoS 26,PropServerKeepAlive
// 13776,PropSubscriptionIdentifierAvailable 80,PropReceiveMaximum 20785,PropMaximumQoS
// 175,PropSharedSubscriptionAvailable 235,PropAssignedClientIdentifier "\135\196u\130(",PropAuthenticationData
// "\169=0K\139C\199\228|8a\167A\131\251\170\248\253\173p\GS0\DC1\218:",PropRequestResponseInformation
// 90,PropMessageExpiryInterval 19327,PropAuthenticationMethod
// "\246++\171\157\242\170b\130\146\170\166\196\r\162{e\ETB\139wB\DC4<\ACK",PropReceiveMaximum 22897,PropResponseTopic
// "6\149"]
TEST(SubACK5QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0x78, 0x26, 0x2f, 0x71, 0x16, 0x0,  0x10, 0xea, 0xc,  0xdc, 0x76, 0xd8, 0x18, 0x91, 0x96,
                   0x5a, 0x88, 0x95, 0x65, 0x8d, 0xfb, 0xb1, 0x59, 0x24, 0xbd, 0x24, 0x1a, 0x13, 0x35, 0xd0, 0x29,
                   0x50, 0x21, 0x51, 0x31, 0x24, 0xaf, 0x2a, 0xeb, 0x12, 0x0,  0x5,  0x87, 0xc4, 0x75, 0x82, 0x28,
                   0x16, 0x0,  0x19, 0xa9, 0x3d, 0x30, 0x4b, 0x8b, 0x43, 0xc7, 0xe4, 0x7c, 0x38, 0x61, 0xa7, 0x41,
                   0x83, 0xfb, 0xaa, 0xf8, 0xfd, 0xad, 0x70, 0x1d, 0x30, 0x11, 0xda, 0x3a, 0x19, 0x5a, 0x2,  0x0,
                   0x0,  0x4b, 0x7f, 0x15, 0x0,  0x18, 0xf6, 0x2b, 0x2b, 0xab, 0x9d, 0xf2, 0xaa, 0x62, 0x82, 0x92,
                   0xaa, 0xa6, 0xc4, 0xd,  0xa2, 0x7b, 0x65, 0x17, 0x8b, 0x77, 0x42, 0x14, 0x3c, 0x6,  0x21, 0x59,
                   0x71, 0x8,  0x0,  0x2,  0x36, 0x95, 0x80, 0x1,  0x80, 0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9775);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x9E);
}

// SubscribeResponse 5148 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Left SubErrQuotaExceeded,Right
// QoS2,Left SubErrWildcardSubscriptionsNotSupported,Right QoS0,Right QoS1,Right QoS0,Left SubErrNotAuthorized,Right
// QoS2] [PropContentType "\207\134\165\ti\229",PropSharedSubscriptionAvailable 140,PropServerKeepAlive
// 25332,PropRequestResponseInformation 19,PropResponseTopic "
// \246\RS\136I\208\133\STX\153\171\"\249_\193X\b\183PW\SOL\235\215p"]
TEST(SubACK5QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0x38, 0x14, 0x1c, 0x2b, 0x3,  0x0,  0x6,  0xcf, 0x86, 0xa5, 0x9,  0x69, 0xe5, 0x2a,
                   0x8c, 0x13, 0x62, 0xf4, 0x19, 0x13, 0x8,  0x0,  0x18, 0x20, 0xf6, 0x1e, 0x88, 0x49, 0xd0,
                   0x85, 0x2,  0x99, 0xab, 0x22, 0xf9, 0x5f, 0xc1, 0x58, 0x8,  0xb7, 0x50, 0x57, 0xe,  0x4c,
                   0xeb, 0xd7, 0x70, 0x9e, 0x0,  0x97, 0x2,  0xa2, 0x0,  0x1,  0x0,  0x87, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5148);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS2);
}

// SubscribeResponse 6967 [Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS1,Right QoS2,Right QoS2]
// [PropAssignedClientIdentifier "\ENQv\150\148=o\252S\153h",PropCorrelationData "\181\132\131",PropReasonString
// "\175\183\131\164\191\174\r\218g\149\128\222,\213]\188\ACK\131\191\&5",PropTopicAliasMaximum
// 24384,PropSubscriptionIdentifier 14,PropWillDelayInterval 7334,PropRequestProblemInformation 112,PropServerReference
// "\214\154\137\133\160\188\\K"]
TEST(SubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x49, 0x1b, 0x37, 0x41, 0x12, 0x0,  0xa,  0x5,  0x76, 0x96, 0x94, 0x3d, 0x6f, 0xfc,
                   0x53, 0x99, 0x68, 0x9,  0x0,  0x3,  0xb5, 0x84, 0x83, 0x1f, 0x0,  0x14, 0xaf, 0xb7, 0x83,
                   0xa4, 0xbf, 0xae, 0xd,  0xda, 0x67, 0x95, 0x80, 0xde, 0x2c, 0xd5, 0x5d, 0xbc, 0x6,  0x83,
                   0xbf, 0x35, 0x22, 0x5f, 0x40, 0xb,  0xe,  0x18, 0x0,  0x0,  0x1c, 0xa6, 0x17, 0x70, 0x1c,
                   0x0,  0x8,  0xd6, 0x9a, 0x89, 0x85, 0xa0, 0xbc, 0x5c, 0x4b, 0xa2, 0x2,  0x1,  0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6967);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
}

// SubscribeResponse 10422 [Right QoS1,Right QoS0,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported]
// [PropCorrelationData "J",PropTopicAliasMaximum 11259,PropReceiveMaximum 24478,PropRetainAvailable
// 69,PropServerKeepAlive 15906,PropMessageExpiryInterval 21672,PropCorrelationData
// "\202\248\217\205\162\240L\181\164\DC2\DC19E\DEL\234\141\171\149/(A\131*",PropRequestResponseInformation
// 152,PropServerReference "\255\190\b\160\242\247\&9\153\191\145\158\SYNX\DC4^\239\145\181\142",PropResponseTopic
// "B2(\229\218\146",PropMessageExpiryInterval 11438,PropMessageExpiryInterval 15978,PropMaximumQoS
// 147,PropWillDelayInterval 27201,PropSubscriptionIdentifierAvailable 166,PropAssignedClientIdentifier
// "]\183\254\191\148\223\138\248\179\DC42_\170",PropWildcardSubscriptionAvailable 168,PropMaximumQoS
// 166,PropResponseInformation "\218\191o\170f\171\230k\242\&3\155\185\218\ESC\191\193E"]
TEST(SubACK5QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0x92, 0x1,  0x28, 0xb6, 0x8a, 0x1,  0x9,  0x0,  0x1,  0x4a, 0x22, 0x2b, 0xfb, 0x21, 0x5f, 0x9e,
                   0x25, 0x45, 0x13, 0x3e, 0x22, 0x2,  0x0,  0x0,  0x54, 0xa8, 0x9,  0x0,  0x17, 0xca, 0xf8, 0xd9, 0xcd,
                   0xa2, 0xf0, 0x4c, 0xb5, 0xa4, 0x12, 0x11, 0x39, 0x45, 0x7f, 0xea, 0x8d, 0xab, 0x95, 0x2f, 0x28, 0x41,
                   0x83, 0x2a, 0x19, 0x98, 0x1c, 0x0,  0x13, 0xff, 0xbe, 0x8,  0xa0, 0xf2, 0xf7, 0x39, 0x99, 0xbf, 0x91,
                   0x9e, 0x16, 0x58, 0x14, 0x5e, 0xef, 0x91, 0xb5, 0x8e, 0x8,  0x0,  0x6,  0x42, 0x32, 0x28, 0xe5, 0xda,
                   0x92, 0x2,  0x0,  0x0,  0x2c, 0xae, 0x2,  0x0,  0x0,  0x3e, 0x6a, 0x24, 0x93, 0x18, 0x0,  0x0,  0x6a,
                   0x41, 0x29, 0xa6, 0x12, 0x0,  0xd,  0x5d, 0xb7, 0xfe, 0xbf, 0x94, 0xdf, 0x8a, 0xf8, 0xb3, 0x14, 0x32,
                   0x5f, 0xaa, 0x28, 0xa8, 0x24, 0xa6, 0x1a, 0x0,  0x11, 0xda, 0xbf, 0x6f, 0xaa, 0x66, 0xab, 0xe6, 0x6b,
                   0xf2, 0x33, 0x9b, 0xb9, 0xda, 0x1b, 0xbf, 0xc1, 0x45, 0x1,  0x0,  0x2,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10422);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
}

// SubscribeResponse 9120 [Left SubErrTopicFilterInvalid,Right QoS0,Right QoS0,Left SubErrQuotaExceeded,Right QoS0,Left
// SubErrImplementationSpecificError] [PropSubscriptionIdentifierAvailable 68,PropReceiveMaximum 13676]
TEST(SubACK5QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0xe, 0x23, 0xa0, 0x5, 0x29, 0x44, 0x21, 0x35, 0x6c, 0x8f, 0x0, 0x0, 0x97, 0x0, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9120);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x97);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
}

// SubscribeResponse 32151 [Right QoS2,Left SubErrNotAuthorized,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS0] [PropSubscriptionIdentifierAvailable 110,PropAuthenticationMethod
// "\EOT\150\215r\DC4yV\136\161\NAK\221\156\152F\249ROH",PropServerKeepAlive 19882,PropWillDelayInterval
// 1198,PropWillDelayInterval 3411,PropSubscriptionIdentifier 7,PropRequestResponseInformation 86,PropReceiveMaximum
// 19407,PropSubscriptionIdentifier 31,PropAuthenticationData "HLz\144",PropAssignedClientIdentifier
// "\ESC\133\212fS\163P1\238\&5\DC2g\DC3\232T\170\155u\203\202!\DC1\165\189",PropServerKeepAlive
// 25841,PropMessageExpiryInterval 14535,PropResponseTopic "'\228\220\199\175i\171\235V^8M\196X\243\154Q\US\151o\210
// \158\&0\ETB\178\a_\249",PropMaximumQoS 88]
TEST(SubACK5QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0x81, 0x1,  0x7d, 0x97, 0x79, 0x29, 0x6e, 0x15, 0x0,  0x12, 0x4,  0x96, 0xd7, 0x72, 0x14, 0x79,
                   0x56, 0x88, 0xa1, 0x15, 0xdd, 0x9c, 0x98, 0x46, 0xf9, 0x52, 0x4f, 0x48, 0x13, 0x4d, 0xaa, 0x18, 0x0,
                   0x0,  0x4,  0xae, 0x18, 0x0,  0x0,  0xd,  0x53, 0xb,  0x7,  0x19, 0x56, 0x21, 0x4b, 0xcf, 0xb,  0x1f,
                   0x16, 0x0,  0x4,  0x48, 0x4c, 0x7a, 0x90, 0x12, 0x0,  0x18, 0x1b, 0x85, 0xd4, 0x66, 0x53, 0xa3, 0x50,
                   0x31, 0xee, 0x35, 0x12, 0x67, 0x13, 0xe8, 0x54, 0xaa, 0x9b, 0x75, 0xcb, 0xca, 0x21, 0x11, 0xa5, 0xbd,
                   0x13, 0x64, 0xf1, 0x2,  0x0,  0x0,  0x38, 0xc7, 0x8,  0x0,  0x1d, 0x27, 0xe4, 0xdc, 0xc7, 0xaf, 0x69,
                   0xab, 0xeb, 0x56, 0x5e, 0x38, 0x4d, 0xc4, 0x58, 0xf3, 0x9a, 0x51, 0x1f, 0x97, 0x6f, 0xd2, 0x20, 0x9e,
                   0x30, 0x17, 0xb2, 0x7,  0x5f, 0xf9, 0x24, 0x58, 0x2,  0x87, 0x1,  0xa2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32151);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x87);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
}

// SubscribeResponse 26123 [Right QoS1,Right QoS0,Right QoS2] [PropSubscriptionIdentifier 29,PropResponseTopic
// "\211\252\208z\210\233\130\ETB\209?g)@",PropTopicAliasMaximum 12492,PropRetainAvailable 204,PropMessageExpiryInterval
// 130,PropReasonString "\RS4",PropAuthenticationMethod "",PropSessionExpiryInterval 6330,PropServerReference
// "\240\178",PropRequestResponseInformation 108,PropTopicAliasMaximum 7015,PropWillDelayInterval
// 3068,PropSharedSubscriptionAvailable 154,PropTopicAlias 14277,PropRetainAvailable 230]
TEST(SubACK5QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0x45, 0x66, 0xb,  0x3f, 0xb,  0x1d, 0x8,  0x0,  0xd,  0xd3, 0xfc, 0xd0, 0x7a, 0xd2,
                   0xe9, 0x82, 0x17, 0xd1, 0x3f, 0x67, 0x29, 0x40, 0x22, 0x30, 0xcc, 0x25, 0xcc, 0x2,  0x0,
                   0x0,  0x0,  0x82, 0x1f, 0x0,  0x2,  0x1e, 0x34, 0x15, 0x0,  0x0,  0x11, 0x0,  0x0,  0x18,
                   0xba, 0x1c, 0x0,  0x2,  0xf0, 0xb2, 0x19, 0x6c, 0x22, 0x1b, 0x67, 0x18, 0x0,  0x0,  0xb,
                   0xfc, 0x2a, 0x9a, 0x23, 0x37, 0xc5, 0x25, 0xe6, 0x1,  0x0,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26123);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
}

// SubscribeResponse 29973 [Right QoS2,Left SubErrPacketIdentifierInUse,Left SubErrImplementationSpecificError,Right
// QoS0,Right QoS2,Right QoS1] [PropSharedSubscriptionAvailable 1]
TEST(SubACK5QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0xb, 0x75, 0x15, 0x2, 0x2a, 0x1, 0x2, 0x91, 0x83, 0x0, 0x2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 29973);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 14366 [Left SubErrSharedSubscriptionsNotSupported,Right QoS2,Right QoS1,Left
// SubErrSharedSubscriptionsNotSupported] [PropResponseInformation
// "\249\249\190\245\ESC\233z\156\130c\162\SO8?\ESCI\150g\vt\161",PropMessageExpiryInterval 25992,PropContentType
// "\181\v\225\135\SYN\STXUpqu\215\251p\147\DEL\215k\168\r?\GS",PropReasonString
// "\245F\211\152nT\167\232z\216\226\250\NAK\132\232\200\&3",PropAuthenticationMethod
// "\tF\STX\ETB\207.\DC2k\207\181\183c\128e\183\164\225:\198b\131A:\161\216",PropSessionExpiryInterval
// 13747,PropCorrelationData "dJ\150h\185\131\227\172\197;7!\147\151\131\230\ETX\161",PropCorrelationData
// "",PropMessageExpiryInterval 27691,PropSubscriptionIdentifier 2,PropUserProperty ",\224\220U"
// "*\218\139\184\251\223-vb\247\&8&\NAKm;\215\DC11>x\142\250\224$u",PropWildcardSubscriptionAvailable
// 53,PropRequestProblemInformation 219,PropRetainAvailable 131,PropMessageExpiryInterval
// 2028,PropRequestResponseInformation 217,PropRetainAvailable 152,PropRetainAvailable 2,PropRequestResponseInformation
// 108,PropMaximumQoS 202,PropTopicAlias 28925,PropServerKeepAlive 18424]
TEST(SubACK5QCTest, Decode9) {
  uint8_t pkt[] = {
      0x90, 0xce, 0x1,  0x38, 0x1e, 0xc6, 0x1,  0x1a, 0x0,  0x15, 0xf9, 0xf9, 0xbe, 0xf5, 0x1b, 0xe9, 0x7a, 0x9c, 0x82,
      0x63, 0xa2, 0xe,  0x38, 0x3f, 0x1b, 0x49, 0x96, 0x67, 0xb,  0x74, 0xa1, 0x2,  0x0,  0x0,  0x65, 0x88, 0x3,  0x0,
      0x15, 0xb5, 0xb,  0xe1, 0x87, 0x16, 0x2,  0x55, 0x70, 0x71, 0x75, 0xd7, 0xfb, 0x70, 0x93, 0x7f, 0xd7, 0x6b, 0xa8,
      0xd,  0x3f, 0x1d, 0x1f, 0x0,  0x11, 0xf5, 0x46, 0xd3, 0x98, 0x6e, 0x54, 0xa7, 0xe8, 0x7a, 0xd8, 0xe2, 0xfa, 0x15,
      0x84, 0xe8, 0xc8, 0x33, 0x15, 0x0,  0x19, 0x9,  0x46, 0x2,  0x17, 0xcf, 0x2e, 0x12, 0x6b, 0xcf, 0xb5, 0xb7, 0x63,
      0x80, 0x65, 0xb7, 0xa4, 0xe1, 0x3a, 0xc6, 0x62, 0x83, 0x41, 0x3a, 0xa1, 0xd8, 0x11, 0x0,  0x0,  0x35, 0xb3, 0x9,
      0x0,  0x12, 0x64, 0x4a, 0x96, 0x68, 0xb9, 0x83, 0xe3, 0xac, 0xc5, 0x3b, 0x37, 0x21, 0x93, 0x97, 0x83, 0xe6, 0x3,
      0xa1, 0x9,  0x0,  0x0,  0x2,  0x0,  0x0,  0x6c, 0x2b, 0xb,  0x2,  0x26, 0x0,  0x4,  0x2c, 0xe0, 0xdc, 0x55, 0x0,
      0x19, 0x2a, 0xda, 0x8b, 0xb8, 0xfb, 0xdf, 0x2d, 0x76, 0x62, 0xf7, 0x38, 0x26, 0x15, 0x6d, 0x3b, 0xd7, 0x11, 0x31,
      0x3e, 0x78, 0x8e, 0xfa, 0xe0, 0x24, 0x75, 0x28, 0x35, 0x17, 0xdb, 0x25, 0x83, 0x2,  0x0,  0x0,  0x7,  0xec, 0x19,
      0xd9, 0x25, 0x98, 0x25, 0x2,  0x19, 0x6c, 0x24, 0xca, 0x23, 0x70, 0xfd, 0x13, 0x47, 0xf8, 0x9e, 0x2,  0x1,  0x9e};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14366);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x9E);
}

// SubscribeResponse 10906 [Left SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right
// QoS1,Left SubErrPacketIdentifierInUse,Left SubErrNotAuthorized,Left SubErrImplementationSpecificError,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrTopicFilterInvalid,Left SubErrTopicFilterInvalid]
// [PropRequestResponseInformation 143,PropResponseTopic
// "p\DC2\EOT\"\197]\158\199\GS6\US\176\SIK\170\152\134\\\ETXF\231\210\219\195\204\GS\DC3\228A",PropServerKeepAlive
// 19736,PropSubscriptionIdentifier 13,PropAuthenticationMethod "\182>\232\218\NAK\221\DC3
// \DC3\157\175",PropMaximumPacketSize 28526,PropResponseTopic
// "\214P\235\164\151]\147\STX\b\SYNi\144]&g\142\145U\139q",PropReceiveMaximum 14778,PropRequestProblemInformation
// 80,PropRequestProblemInformation 53,PropSubscriptionIdentifierAvailable 113,PropServerKeepAlive
// 11340,PropReceiveMaximum 3459,PropMaximumQoS 115,PropMessageExpiryInterval 13266,PropAssignedClientIdentifier
// "\DEL\179\247\171h\174\243",PropContentType "\145Z\249W\157\159D\206m}V\250E\234\229",PropAuthenticationData
// "\240\182",PropServerKeepAlive 14931,PropRequestProblemInformation 2,PropMaximumPacketSize 23805]
TEST(SubACK5QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0xa1, 0x1,  0x2a, 0x9a, 0x92, 0x1,  0x19, 0x8f, 0x8,  0x0,  0x1d, 0x70, 0x12, 0x4,  0x22, 0xc5,
                   0x5d, 0x9e, 0xc7, 0x1d, 0x36, 0x1f, 0xb0, 0xf,  0x4b, 0xaa, 0x98, 0x86, 0x5c, 0x3,  0x46, 0xe7, 0xd2,
                   0xdb, 0xc3, 0xcc, 0x1d, 0x13, 0xe4, 0x41, 0x13, 0x4d, 0x18, 0xb,  0xd,  0x15, 0x0,  0xb,  0xb6, 0x3e,
                   0xe8, 0xda, 0x15, 0xdd, 0x13, 0x20, 0x13, 0x9d, 0xaf, 0x27, 0x0,  0x0,  0x6f, 0x6e, 0x8,  0x0,  0x14,
                   0xd6, 0x50, 0xeb, 0xa4, 0x97, 0x5d, 0x93, 0x2,  0x8,  0x16, 0x69, 0x90, 0x5d, 0x26, 0x67, 0x8e, 0x91,
                   0x55, 0x8b, 0x71, 0x21, 0x39, 0xba, 0x17, 0x50, 0x17, 0x35, 0x29, 0x71, 0x13, 0x2c, 0x4c, 0x21, 0xd,
                   0x83, 0x24, 0x73, 0x2,  0x0,  0x0,  0x33, 0xd2, 0x12, 0x0,  0x7,  0x7f, 0xb3, 0xf7, 0xab, 0x68, 0xae,
                   0xf3, 0x3,  0x0,  0xf,  0x91, 0x5a, 0xf9, 0x57, 0x9d, 0x9f, 0x44, 0xce, 0x6d, 0x7d, 0x56, 0xfa, 0x45,
                   0xea, 0xe5, 0x16, 0x0,  0x2,  0xf0, 0xb6, 0x13, 0x3a, 0x53, 0x17, 0x2,  0x27, 0x0,  0x0,  0x5c, 0xfd,
                   0x80, 0xa2, 0x2,  0x1,  0x91, 0x87, 0x83, 0x9e, 0x1,  0x8f, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10906);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x91);
  EXPECT_EQ(granted_qos_levels[5], 0x87);
  EXPECT_EQ(granted_qos_levels[6], 0x83);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[9], 0x8F);
  EXPECT_EQ(granted_qos_levels[10], 0x8F);
}

// SubscribeResponse 11558 [Left SubErrImplementationSpecificError,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrQuotaExceeded,Left
// SubErrNotAuthorized,Right QoS0,Right QoS2,Left SubErrQuotaExceeded,Left SubErrImplementationSpecificError]
// [PropResponseInformation "3\SUB\158\ESC\144g\231\155\234/\171",PropSessionExpiryInterval
// 24450,PropPayloadFormatIndicator 177]
TEST(SubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0x22, 0x2d, 0x26, 0x15, 0x1a, 0x0,  0xb,  0x33, 0x1a, 0x9e, 0x1b,
                   0x90, 0x67, 0xe7, 0x9b, 0xea, 0x2f, 0xab, 0x11, 0x0,  0x0,  0x5f, 0x82,
                   0x1,  0xb1, 0x83, 0x80, 0x80, 0xa1, 0x97, 0x87, 0x0,  0x2,  0x97, 0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11558);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0xA1);
  EXPECT_EQ(granted_qos_levels[4], 0x97);
  EXPECT_EQ(granted_qos_levels[5], 0x87);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0x97);
  EXPECT_EQ(granted_qos_levels[9], 0x83);
}

// SubscribeResponse 9362 [Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrPacketIdentifierInUse,Left
// SubErrTopicFilterInvalid] [PropCorrelationData
// "\195\153!\134/\183\202\231\ENQ1\247e\162\&0\202k6",PropTopicAliasMaximum 3409,PropSubscriptionIdentifierAvailable
// 195,PropTopicAliasMaximum 14152,PropSubscriptionIdentifier 16,PropAuthenticationMethod
// "\182\191%p\205JB\254\175\130\SO\235x4Y\ETX\192",PropWillDelayInterval 19872,PropMaximumQoS 150]
TEST(SubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0x3f, 0x24, 0x92, 0x39, 0x9,  0x0,  0x11, 0xc3, 0x99, 0x21, 0x86, 0x2f, 0xb7, 0xca, 0xe7, 0x5,
                   0x31, 0xf7, 0x65, 0xa2, 0x30, 0xca, 0x6b, 0x36, 0x22, 0xd,  0x51, 0x29, 0xc3, 0x22, 0x37, 0x48, 0xb,
                   0x10, 0x15, 0x0,  0x11, 0xb6, 0xbf, 0x25, 0x70, 0xcd, 0x4a, 0x42, 0xfe, 0xaf, 0x82, 0xe,  0xeb, 0x78,
                   0x34, 0x59, 0x3,  0xc0, 0x18, 0x0,  0x0,  0x4d, 0xa0, 0x24, 0x96, 0xa1, 0x91, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9362);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
}

// SubscribeResponse 23793 [Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS2,Right QoS0,Left SubErrImplementationSpecificError,Right
// QoS0,Left SubErrSharedSubscriptionsNotSupported,Left SubErrSharedSubscriptionsNotSupported,Right QoS0]
// [PropAuthenticationData "\218J\135\ACK]\180\255\&7\144\212\v\167H\249$t\153C\222(TEp\220\156$",PropAuthenticationData
// "\223\165^.3{\SUB\213\151\RS\227w!\144\ACKMY\r\198\158\211\250^[\ENQ\238A\SUB\247",PropCorrelationData
// "qN\171\212\209f\NAK9\157\254\225pZ\156\DLEI\173\185\\",PropMessageExpiryInterval 4328,PropMessageExpiryInterval
// 1128,PropSubscriptionIdentifier 21,PropServerReference "\224\158\nd\221\SO\248\222v",PropServerReference
// "\164\233",PropAssignedClientIdentifier "\NAKm@sFU\170A\232\200\166ha\208",PropContentType
// "e\209P\236\130\184\130\138Yf\152f\ETX5X\175",PropRetainAvailable 24,PropRetainAvailable
// 194,PropMessageExpiryInterval 2103,PropWildcardSubscriptionAvailable 90,PropPayloadFormatIndicator
// 104,PropSubscriptionIdentifier 11,PropWildcardSubscriptionAvailable 69,PropReasonString
// "3\255\243",PropRequestResponseInformation 218,PropWillDelayInterval 8806]
TEST(SubACK5QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0xc0, 0x1,  0x5c, 0xf1, 0xb2, 0x1,  0x16, 0x0,  0x1a, 0xda, 0x4a, 0x87, 0x6,  0x5d, 0xb4, 0xff,
                   0x37, 0x90, 0xd4, 0xb,  0xa7, 0x48, 0xf9, 0x24, 0x74, 0x99, 0x43, 0xde, 0x28, 0x54, 0x45, 0x70, 0xdc,
                   0x9c, 0x24, 0x16, 0x0,  0x1d, 0xdf, 0xa5, 0x5e, 0x2e, 0x33, 0x7b, 0x1a, 0xd5, 0x97, 0x1e, 0xe3, 0x77,
                   0x21, 0x90, 0x6,  0x4d, 0x59, 0xd,  0xc6, 0x9e, 0xd3, 0xfa, 0x5e, 0x5b, 0x5,  0xee, 0x41, 0x1a, 0xf7,
                   0x9,  0x0,  0x13, 0x71, 0x4e, 0xab, 0xd4, 0xd1, 0x66, 0x15, 0x39, 0x9d, 0xfe, 0xe1, 0x70, 0x5a, 0x9c,
                   0x10, 0x49, 0xad, 0xb9, 0x5c, 0x2,  0x0,  0x0,  0x10, 0xe8, 0x2,  0x0,  0x0,  0x4,  0x68, 0xb,  0x15,
                   0x1c, 0x0,  0x9,  0xe0, 0x9e, 0xa,  0x64, 0xdd, 0xe,  0xf8, 0xde, 0x76, 0x1c, 0x0,  0x2,  0xa4, 0xe9,
                   0x12, 0x0,  0xe,  0x15, 0x6d, 0x40, 0x73, 0x46, 0x55, 0xaa, 0x41, 0xe8, 0xc8, 0xa6, 0x68, 0x61, 0xd0,
                   0x3,  0x0,  0x10, 0x65, 0xd1, 0x50, 0xec, 0x82, 0xb8, 0x82, 0x8a, 0x59, 0x66, 0x98, 0x66, 0x3,  0x35,
                   0x58, 0xaf, 0x25, 0x18, 0x25, 0xc2, 0x2,  0x0,  0x0,  0x8,  0x37, 0x28, 0x5a, 0x1,  0x68, 0xb,  0xb,
                   0x28, 0x45, 0x1f, 0x0,  0x3,  0x33, 0xff, 0xf3, 0x19, 0xda, 0x18, 0x0,  0x0,  0x22, 0x66, 0xa2, 0x9e,
                   0x1,  0x2,  0x0,  0x83, 0x0,  0x9e, 0x9e, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 23793);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
  EXPECT_EQ(granted_qos_levels[8], 0x9E);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
}

// SubscribeResponse 11397 [Left SubErrTopicFilterInvalid,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS1,Left SubErrImplementationSpecificError,Left
// SubErrTopicFilterInvalid,Right QoS1,Right QoS0,Right QoS1,Right QoS1] [PropServerKeepAlive
// 1598,PropSubscriptionIdentifier 11,PropMessageExpiryInterval 3147,PropReasonString
// "W\247\177\220\221\211\134o8\198\199\237\135SW\167eo\174\f\165\165\226\US\v",PropRequestResponseInformation
// 114,PropReasonString "\STX\187\".\226i\180'",PropRequestResponseInformation 81,PropTopicAlias
// 21854,PropResponseInformation "\DEL\254b)A\131\204(\227\194\226\202",PropCorrelationData
// "\235\185\201\&8\152iV",PropMaximumPacketSize 4310,PropMessageExpiryInterval 6070,PropServerReference
// "M\231\232Vv?m0\SO\214#\143\"\238\133\199+sc",PropTopicAlias 26799,PropRequestResponseInformation
// 100,PropServerReference "\220",PropResponseInformation "\254!-\245C",PropContentType
// "\162\197\244\DC4L\RSPM~2P8\217\132\204>\201\227X\251\134\251",PropSharedSubscriptionAvailable 103,PropReceiveMaximum
// 26130,PropCorrelationData "\NUL\153v\179j\197#\192\235t\164\221V\NAK|i0"]
TEST(SubACK5QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0xc3, 0x1,  0x2c, 0x85, 0xb4, 0x1,  0x13, 0x6,  0x3e, 0xb,  0xb,  0x2,  0x0,  0x0,  0xc,  0x4b,
                   0x1f, 0x0,  0x19, 0x57, 0xf7, 0xb1, 0xdc, 0xdd, 0xd3, 0x86, 0x6f, 0x38, 0xc6, 0xc7, 0xed, 0x87, 0x53,
                   0x57, 0xa7, 0x65, 0x6f, 0xae, 0xc,  0xa5, 0xa5, 0xe2, 0x1f, 0xb,  0x19, 0x72, 0x1f, 0x0,  0x8,  0x2,
                   0xbb, 0x22, 0x2e, 0xe2, 0x69, 0xb4, 0x27, 0x19, 0x51, 0x23, 0x55, 0x5e, 0x1a, 0x0,  0xc,  0x7f, 0xfe,
                   0x62, 0x29, 0x41, 0x83, 0xcc, 0x28, 0xe3, 0xc2, 0xe2, 0xca, 0x9,  0x0,  0x7,  0xeb, 0xb9, 0xc9, 0x38,
                   0x98, 0x69, 0x56, 0x27, 0x0,  0x0,  0x10, 0xd6, 0x2,  0x0,  0x0,  0x17, 0xb6, 0x1c, 0x0,  0x13, 0x4d,
                   0xe7, 0xe8, 0x56, 0x76, 0x3f, 0x6d, 0x30, 0xe,  0xd6, 0x23, 0x8f, 0x22, 0xee, 0x85, 0xc7, 0x2b, 0x73,
                   0x63, 0x23, 0x68, 0xaf, 0x19, 0x64, 0x1c, 0x0,  0x1,  0xdc, 0x1a, 0x0,  0x5,  0xfe, 0x21, 0x2d, 0xf5,
                   0x43, 0x3,  0x0,  0x16, 0xa2, 0xc5, 0xf4, 0x14, 0x4c, 0x1e, 0x50, 0x4d, 0x7e, 0x32, 0x50, 0x38, 0xd9,
                   0x84, 0xcc, 0x3e, 0xc9, 0xe3, 0x58, 0xfb, 0x86, 0xfb, 0x2a, 0x67, 0x21, 0x66, 0x12, 0x9,  0x0,  0x11,
                   0x0,  0x99, 0x76, 0xb3, 0x6a, 0xc5, 0x23, 0xc0, 0xeb, 0x74, 0xa4, 0xdd, 0x56, 0x15, 0x7c, 0x69, 0x30,
                   0x8f, 0xa1, 0x0,  0xa2, 0x1,  0x83, 0x8f, 0x1,  0x0,  0x1,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11397);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], 0xA1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], 0x8F);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS1);
}

// SubscribeResponse 5337 [Left SubErrTopicFilterInvalid] [PropSubscriptionIdentifierAvailable 45,PropCorrelationData
// "\204\r\185L\153\176\USc\190m\215\233\221\NUL\174",PropTopicAlias 5305,PropReasonString "",PropContentType
// "\171\190\177\196\244\164_S3#\229\USc\162H7T\DC19\155_\145\210\203\154\190m5",PropSubscriptionIdentifier
// 26,PropMaximumQoS 122,PropReasonString "q\208\160\130[\213VO\170",PropPayloadFormatIndicator 47,PropMaximumPacketSize
// 10768,PropSubscriptionIdentifier 17,PropSubscriptionIdentifierAvailable 104,PropMessageExpiryInterval
// 27024,PropRequestProblemInformation 236,PropAssignedClientIdentifier
// "\228\SUB\233\ESC",PropWildcardSubscriptionAvailable 194,PropResponseInformation "",PropCorrelationData
// "\237\219\248\"6\v\236\128\NAK\233",PropRequestResponseInformation 80,PropTopicAlias 19929,PropTopicAlias
// 3674,PropAuthenticationMethod "FQp",PropWillDelayInterval 8789,PropSharedSubscriptionAvailable 166,PropTopicAlias
// 17706,PropTopicAlias 3711,PropPayloadFormatIndicator 75,PropAuthenticationData
// "_\133\195\STX:%{\181a\128\204pxv\152\239\170\132\216\139\227",PropReasonString
// "\133\236\146]7c\236a\GS$v\248\230\182\169\165\SO\241\ACK",PropResponseInformation "b;"]
TEST(SubACK5QCTest, Decode15) {
  uint8_t pkt[] = {
      0x90, 0xc9, 0x1,  0x14, 0xd9, 0xc4, 0x1,  0x29, 0x2d, 0x9,  0x0,  0xf,  0xcc, 0xd,  0xb9, 0x4c, 0x99, 0xb0, 0x1f,
      0x63, 0xbe, 0x6d, 0xd7, 0xe9, 0xdd, 0x0,  0xae, 0x23, 0x14, 0xb9, 0x1f, 0x0,  0x0,  0x3,  0x0,  0x1c, 0xab, 0xbe,
      0xb1, 0xc4, 0xf4, 0xa4, 0x5f, 0x53, 0x33, 0x23, 0xe5, 0x1f, 0x63, 0xa2, 0x48, 0x37, 0x54, 0x11, 0x39, 0x9b, 0x5f,
      0x91, 0xd2, 0xcb, 0x9a, 0xbe, 0x6d, 0x35, 0xb,  0x1a, 0x24, 0x7a, 0x1f, 0x0,  0x9,  0x71, 0xd0, 0xa0, 0x82, 0x5b,
      0xd5, 0x56, 0x4f, 0xaa, 0x1,  0x2f, 0x27, 0x0,  0x0,  0x2a, 0x10, 0xb,  0x11, 0x29, 0x68, 0x2,  0x0,  0x0,  0x69,
      0x90, 0x17, 0xec, 0x12, 0x0,  0x4,  0xe4, 0x1a, 0xe9, 0x1b, 0x28, 0xc2, 0x1a, 0x0,  0x0,  0x9,  0x0,  0xa,  0xed,
      0xdb, 0xf8, 0x22, 0x36, 0xb,  0xec, 0x80, 0x15, 0xe9, 0x19, 0x50, 0x23, 0x4d, 0xd9, 0x23, 0xe,  0x5a, 0x15, 0x0,
      0x3,  0x46, 0x51, 0x70, 0x18, 0x0,  0x0,  0x22, 0x55, 0x2a, 0xa6, 0x23, 0x45, 0x2a, 0x23, 0xe,  0x7f, 0x1,  0x4b,
      0x16, 0x0,  0x15, 0x5f, 0x85, 0xc3, 0x2,  0x3a, 0x25, 0x7b, 0xb5, 0x61, 0x80, 0xcc, 0x70, 0x78, 0x76, 0x98, 0xef,
      0xaa, 0x84, 0xd8, 0x8b, 0xe3, 0x1f, 0x0,  0x13, 0x85, 0xec, 0x92, 0x5d, 0x37, 0x63, 0xec, 0x61, 0x1d, 0x24, 0x76,
      0xf8, 0xe6, 0xb6, 0xa9, 0xa5, 0xe,  0xf1, 0x6,  0x1a, 0x0,  0x2,  0x62, 0x3b, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5337);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
}

// SubscribeResponse 32213 [Left SubErrQuotaExceeded,Right QoS0,Right QoS0,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Right QoS1]
// [PropRequestResponseInformation 95,PropAuthenticationMethod "R\NAK",PropWillDelayInterval 32360,PropMaximumPacketSize
// 7542,PropResponseInformation
// "S\150\133\ESC\186\136\230\187\237O\232\164\251\236\190,2\146\147\198\139\152\&6",PropMaximumPacketSize
// 8765,PropSubscriptionIdentifier 19,PropAuthenticationMethod
// "\NAKV\239\253\251\DEL\197\250!\f\249\DC2\229<\145\DC2\130\SUB\DC4\168\132\182\250\245\159\193\SUB\SI\214?",PropResponseInformation
// "V5d6\ENQ",PropContentType "R7\136\236T/G",PropRetainAvailable 232,PropServerKeepAlive 16300,PropWillDelayInterval
// 8409,PropPayloadFormatIndicator 63,PropContentType "\229\149'/\STXd\227\200%\254\159W",PropUserProperty
// "Dj\147\209\216\"\226&6S\158\224\SYN@"
// "k\226V\204\207\174\196q\178pQ\162\183\&1\t\239\&2\135\232(\138N\228\&5\153\234&G",PropServerKeepAlive
// 10969,PropRetainAvailable 217,PropReasonString "\210\FS\138\150M",PropTopicAlias 533]
TEST(SubACK5QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0xc9, 0x1,  0x7d, 0xd5, 0xbf, 0x1,  0x19, 0x5f, 0x15, 0x0,  0x2,  0x52, 0x15, 0x18, 0x0,  0x0,
                   0x7e, 0x68, 0x27, 0x0,  0x0,  0x1d, 0x76, 0x1a, 0x0,  0x17, 0x53, 0x96, 0x85, 0x1b, 0xba, 0x88, 0xe6,
                   0xbb, 0xed, 0x4f, 0xe8, 0xa4, 0xfb, 0xec, 0xbe, 0x2c, 0x32, 0x92, 0x93, 0xc6, 0x8b, 0x98, 0x36, 0x27,
                   0x0,  0x0,  0x22, 0x3d, 0xb,  0x13, 0x15, 0x0,  0x1e, 0x15, 0x56, 0xef, 0xfd, 0xfb, 0x7f, 0xc5, 0xfa,
                   0x21, 0xc,  0xf9, 0x12, 0xe5, 0x3c, 0x91, 0x12, 0x82, 0x1a, 0x14, 0xa8, 0x84, 0xb6, 0xfa, 0xf5, 0x9f,
                   0xc1, 0x1a, 0xf,  0xd6, 0x3f, 0x1a, 0x0,  0x5,  0x56, 0x35, 0x64, 0x36, 0x5,  0x3,  0x0,  0x7,  0x52,
                   0x37, 0x88, 0xec, 0x54, 0x2f, 0x47, 0x25, 0xe8, 0x13, 0x3f, 0xac, 0x18, 0x0,  0x0,  0x20, 0xd9, 0x1,
                   0x3f, 0x3,  0x0,  0xc,  0xe5, 0x95, 0x27, 0x2f, 0x2,  0x64, 0xe3, 0xc8, 0x25, 0xfe, 0x9f, 0x57, 0x26,
                   0x0,  0xe,  0x44, 0x6a, 0x93, 0xd1, 0xd8, 0x22, 0xe2, 0x26, 0x36, 0x53, 0x9e, 0xe0, 0x16, 0x40, 0x0,
                   0x1c, 0x6b, 0xe2, 0x56, 0xcc, 0xcf, 0xae, 0xc4, 0x71, 0xb2, 0x70, 0x51, 0xa2, 0xb7, 0x31, 0x9,  0xef,
                   0x32, 0x87, 0xe8, 0x28, 0x8a, 0x4e, 0xe4, 0x35, 0x99, 0xea, 0x26, 0x47, 0x13, 0x2a, 0xd9, 0x25, 0xd9,
                   0x1f, 0x0,  0x5,  0xd2, 0x1c, 0x8a, 0x96, 0x4d, 0x23, 0x2,  0x15, 0x97, 0x0,  0x0,  0x9e, 0xa2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32213);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x97);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x9E);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 1504 [Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Left SubErrTopicFilterInvalid,Right QoS1,Right QoS1]
// [PropAssignedClientIdentifier
// "]{=K\190\169\DC1\ACK\198O\136\201Q\139A\f\166\129\ENQ_'\129\177-",PropMessageExpiryInterval
// 790,PropWildcardSubscriptionAvailable 36,PropMessageExpiryInterval 14665,PropCorrelationData
// "\DC4z\197\143",PropServerKeepAlive 22506,PropSubscriptionIdentifierAvailable 30,PropSharedSubscriptionAvailable
// 13,PropSharedSubscriptionAvailable 219,PropWildcardSubscriptionAvailable 255,PropMaximumPacketSize
// 14962,PropServerKeepAlive 19142,PropSharedSubscriptionAvailable 249,PropResponseInformation
// "\b$\\\SOH\160",PropAssignedClientIdentifier
// "\EM\157$\ETXj\EOTx\165\212\140@\191\SOH)\148\ENQ\t\129{\SODX\196\US",PropPayloadFormatIndicator
// 195,PropMaximumPacketSize 23289,PropRequestResponseInformation 44,PropResponseTopic
// "\NUL\199\EM{\183\&3h\150-\255\222\220",PropWillDelayInterval 8389,PropUserProperty "\165=\171)`\156\230\219:"
// "]\194",PropAuthenticationData
// "\161US\214\135'c\NUL\ESC\252Qp\DC1,QN_\223\162\EM\197\178bI:",PropMessageExpiryInterval 15146,PropMaximumPacketSize
// 27405,PropCorrelationData "B}\198\SOH\163",PropMessageExpiryInterval 26861,PropAssignedClientIdentifier
// "\159\129\199\236\243\179\b\219\239RU\227\159\149\183b\161r|y\172\202FQ\NUL\"\136\186",PropSessionExpiryInterval
// 30259]
TEST(SubACK5QCTest, Decode17) {
  uint8_t pkt[] = {
      0x90, 0xf4, 0x1,  0x5,  0xe0, 0xea, 0x1,  0x12, 0x0,  0x18, 0x5d, 0x7b, 0x3d, 0x4b, 0xbe, 0xa9, 0x11, 0x6,  0xc6,
      0x4f, 0x88, 0xc9, 0x51, 0x8b, 0x41, 0xc,  0xa6, 0x81, 0x5,  0x5f, 0x27, 0x81, 0xb1, 0x2d, 0x2,  0x0,  0x0,  0x3,
      0x16, 0x28, 0x24, 0x2,  0x0,  0x0,  0x39, 0x49, 0x9,  0x0,  0x4,  0x14, 0x7a, 0xc5, 0x8f, 0x13, 0x57, 0xea, 0x29,
      0x1e, 0x2a, 0xd,  0x2a, 0xdb, 0x28, 0xff, 0x27, 0x0,  0x0,  0x3a, 0x72, 0x13, 0x4a, 0xc6, 0x2a, 0xf9, 0x1a, 0x0,
      0x5,  0x8,  0x24, 0x5c, 0x1,  0xa0, 0x12, 0x0,  0x18, 0x19, 0x9d, 0x24, 0x3,  0x6a, 0x4,  0x78, 0xa5, 0xd4, 0x8c,
      0x40, 0xbf, 0x1,  0x29, 0x94, 0x5,  0x9,  0x81, 0x7b, 0xe,  0x44, 0x58, 0xc4, 0x1f, 0x1,  0xc3, 0x27, 0x0,  0x0,
      0x5a, 0xf9, 0x19, 0x2c, 0x8,  0x0,  0xc,  0x0,  0xc7, 0x19, 0x7b, 0xb7, 0x33, 0x68, 0x96, 0x2d, 0xff, 0xde, 0xdc,
      0x18, 0x0,  0x0,  0x20, 0xc5, 0x26, 0x0,  0x9,  0xa5, 0x3d, 0xab, 0x29, 0x60, 0x9c, 0xe6, 0xdb, 0x3a, 0x0,  0x2,
      0x5d, 0xc2, 0x16, 0x0,  0x19, 0xa1, 0x55, 0x53, 0xd6, 0x87, 0x27, 0x63, 0x0,  0x1b, 0xfc, 0x51, 0x70, 0x11, 0x2c,
      0x51, 0x4e, 0x5f, 0xdf, 0xa2, 0x19, 0xc5, 0xb2, 0x62, 0x49, 0x3a, 0x2,  0x0,  0x0,  0x3b, 0x2a, 0x27, 0x0,  0x0,
      0x6b, 0xd,  0x9,  0x0,  0x5,  0x42, 0x7d, 0xc6, 0x1,  0xa3, 0x2,  0x0,  0x0,  0x68, 0xed, 0x12, 0x0,  0x1c, 0x9f,
      0x81, 0xc7, 0xec, 0xf3, 0xb3, 0x8,  0xdb, 0xef, 0x52, 0x55, 0xe3, 0x9f, 0x95, 0xb7, 0x62, 0xa1, 0x72, 0x7c, 0x79,
      0xac, 0xca, 0x46, 0x51, 0x0,  0x22, 0x88, 0xba, 0x11, 0x0,  0x0,  0x76, 0x33, 0xa1, 0x9e, 0x1,  0x8f, 0x1,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 1504);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 2008 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse,Right
// QoS2,Left SubErrUnspecifiedError] [PropMessageExpiryInterval 29625,PropMessageExpiryInterval
// 15421,PropRequestProblemInformation 41,PropCorrelationData
// "_\233\&9\245\tW<\EMf\218\240v\188\211\DLE\253\141\171\248\214DM\"\149\159}4\167\NUL",PropRequestResponseInformation
// 19,PropReasonString "2\164BN%\a\b\253\242\233\204",PropTopicAlias 26560,PropSharedSubscriptionAvailable
// 21,PropContentType "a\159-\243\&1",PropMessageExpiryInterval 7597,PropRetainAvailable 98,PropPayloadFormatIndicator
// 87,PropSubscriptionIdentifier 31,PropWildcardSubscriptionAvailable 5,PropContentType "",PropUserProperty
// "\ESC\249\SYNna\169"
// "\NAK\221\215\207\r\155Qf\231\194c\177e\226k\187z\191t\212\241D\181\&4\188\f\FS\140",PropSessionExpiryInterval
// 18569,PropSubscriptionIdentifierAvailable 223,PropAssignedClientIdentifier
// "8,\254\&7\160vs\166\&3",PropSharedSubscriptionAvailable 170,PropSharedSubscriptionAvailable 53]
TEST(SubACK5QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0xa0, 0x1,  0x7,  0xd8, 0x97, 0x1,  0x2,  0x0,  0x0,  0x73, 0xb9, 0x2,  0x0,  0x0,  0x3c, 0x3d,
                   0x17, 0x29, 0x9,  0x0,  0x1d, 0x5f, 0xe9, 0x39, 0xf5, 0x9,  0x57, 0x3c, 0x19, 0x66, 0xda, 0xf0, 0x76,
                   0xbc, 0xd3, 0x10, 0xfd, 0x8d, 0xab, 0xf8, 0xd6, 0x44, 0x4d, 0x22, 0x95, 0x9f, 0x7d, 0x34, 0xa7, 0x0,
                   0x19, 0x13, 0x1f, 0x0,  0xb,  0x32, 0xa4, 0x42, 0x4e, 0x25, 0x7,  0x8,  0xfd, 0xf2, 0xe9, 0xcc, 0x23,
                   0x67, 0xc0, 0x2a, 0x15, 0x3,  0x0,  0x5,  0x61, 0x9f, 0x2d, 0xf3, 0x31, 0x2,  0x0,  0x0,  0x1d, 0xad,
                   0x25, 0x62, 0x1,  0x57, 0xb,  0x1f, 0x28, 0x5,  0x3,  0x0,  0x0,  0x26, 0x0,  0x6,  0x1b, 0xf9, 0x16,
                   0x6e, 0x61, 0xa9, 0x0,  0x1c, 0x15, 0xdd, 0xd7, 0xcf, 0xd,  0x9b, 0x51, 0x66, 0xe7, 0xc2, 0x63, 0xb1,
                   0x65, 0xe2, 0x6b, 0xbb, 0x7a, 0xbf, 0x74, 0xd4, 0xf1, 0x44, 0xb5, 0x34, 0xbc, 0xc,  0x1c, 0x8c, 0x11,
                   0x0,  0x0,  0x48, 0x89, 0x29, 0xdf, 0x12, 0x0,  0x9,  0x38, 0x2c, 0xfe, 0x37, 0xa0, 0x76, 0x73, 0xa6,
                   0x33, 0x2a, 0xaa, 0x2a, 0x35, 0x2,  0x9e, 0x91, 0x2,  0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 2008);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], 0x91);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 19894 [Left SubErrNotAuthorized,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrQuotaExceeded] [PropMessageExpiryInterval 5546,PropRetainAvailable 128,PropSharedSubscriptionAvailable
// 109,PropUserProperty "\180E\ESC\241\198\216\"\a\146\141!\162-\237\177\&0\249^\132\218\190\EM\NAK"
// "\153\180",PropTopicAliasMaximum 11791]
TEST(SubACK5QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0x33, 0x4d, 0xb6, 0x2a, 0x2,  0x0,  0x0,  0x15, 0xaa, 0x25, 0x80, 0x2a, 0x6d,
                   0x26, 0x0,  0x17, 0xb4, 0x45, 0x1b, 0xf1, 0xc6, 0xd8, 0x22, 0x7,  0x92, 0x8d, 0x21,
                   0xa2, 0x2d, 0xed, 0xb1, 0x30, 0xf9, 0x5e, 0x84, 0xda, 0xbe, 0x19, 0x15, 0x0,  0x2,
                   0x99, 0xb4, 0x22, 0x2e, 0xf,  0x87, 0x9e, 0xa1, 0x0,  0xa1, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19894);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], 0xA1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], 0xA1);
  EXPECT_EQ(granted_qos_levels[5], 0x97);
}

// SubscribeResponse 12423 [Left SubErrNotAuthorized,Right QoS0,Right QoS2,Right QoS2] [PropRetainAvailable
// 88,PropRetainAvailable 171,PropAssignedClientIdentifier "\147",PropResponseTopic
// "UT\236\244Fb\191\205\240\222]\NAK",PropSubscriptionIdentifierAvailable 66,PropRequestProblemInformation
// 51,PropResponseInformation "Cp\229\155\174\SUB\216a\252\v\227lk;\SO5\182\252",PropReceiveMaximum
// 4603,PropWillDelayInterval 20903,PropTopicAlias 17266,PropAuthenticationData
// "\NUL\231k\154\231V\163",PropSubscriptionIdentifierAvailable 202,PropAuthenticationMethod "\219",PropResponseTopic
// "D\222\131\GS\185p\161\178:_\187\228\237Q]\164\DC30",PropMaximumPacketSize 30253,PropServerKeepAlive
// 10546,PropSessionExpiryInterval 22254,PropPayloadFormatIndicator 253,PropWillDelayInterval 7844,PropWillDelayInterval
// 28606,PropAssignedClientIdentifier
// "1T\254\243I\161\151-\229\232\193\145q\DLE)\DLE\178\223w\128\181\225\195\143\240\v}",PropWildcardSubscriptionAvailable
// 130,PropTopicAliasMaximum 7964,PropWillDelayInterval 25559]
TEST(SubACK5QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0xa9, 0x1,  0x30, 0x87, 0xa1, 0x1,  0x25, 0x58, 0x25, 0xab, 0x12, 0x0,  0x1,  0x93, 0x8,
                   0x0,  0xc,  0x55, 0x54, 0xec, 0xf4, 0x46, 0x62, 0xbf, 0xcd, 0xf0, 0xde, 0x5d, 0x15, 0x29, 0x42,
                   0x17, 0x33, 0x1a, 0x0,  0x12, 0x43, 0x70, 0xe5, 0x9b, 0xae, 0x1a, 0xd8, 0x61, 0xfc, 0xb,  0xe3,
                   0x6c, 0x6b, 0x3b, 0xe,  0x35, 0xb6, 0xfc, 0x21, 0x11, 0xfb, 0x18, 0x0,  0x0,  0x51, 0xa7, 0x23,
                   0x43, 0x72, 0x16, 0x0,  0x7,  0x0,  0xe7, 0x6b, 0x9a, 0xe7, 0x56, 0xa3, 0x29, 0xca, 0x15, 0x0,
                   0x1,  0xdb, 0x8,  0x0,  0x12, 0x44, 0xde, 0x83, 0x1d, 0xb9, 0x70, 0xa1, 0xb2, 0x3a, 0x5f, 0xbb,
                   0xe4, 0xed, 0x51, 0x5d, 0xa4, 0x13, 0x30, 0x27, 0x0,  0x0,  0x76, 0x2d, 0x13, 0x29, 0x32, 0x11,
                   0x0,  0x0,  0x56, 0xee, 0x1,  0xfd, 0x18, 0x0,  0x0,  0x1e, 0xa4, 0x18, 0x0,  0x0,  0x6f, 0xbe,
                   0x12, 0x0,  0x1b, 0x31, 0x54, 0xfe, 0xf3, 0x49, 0xa1, 0x97, 0x2d, 0xe5, 0xe8, 0xc1, 0x91, 0x71,
                   0x10, 0x29, 0x10, 0xb2, 0xdf, 0x77, 0x80, 0xb5, 0xe1, 0xc3, 0x8f, 0xf0, 0xb,  0x7d, 0x28, 0x82,
                   0x22, 0x1f, 0x1c, 0x18, 0x0,  0x0,  0x63, 0xd7, 0x87, 0x0,  0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12423);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
}

// SubscribeResponse 21901 [Left SubErrQuotaExceeded,Left SubErrImplementationSpecificError,Right QoS0,Right QoS0]
// [PropAssignedClientIdentifier "\161\185\170\238\ACK",PropTopicAliasMaximum 13624,PropResponseTopic
// "\US{E\249\134\SOx\215J\243\250#]\130!\165\202e\143\194x'C\DLE\199\223\223f",PropSharedSubscriptionAvailable
// 32,PropTopicAlias 20663,PropRetainAvailable 159,PropResponseTopic "\239%\203\232\173
// \230\177\252e\206\144",PropAuthenticationMethod
// "\132\SYN\DC1\SIJ\189J\225r\134\DC1\130\232@5\ACK",PropAssignedClientIdentifier "\199\144\239\197",PropReceiveMaximum
// 12035,PropAssignedClientIdentifier "\170\147\&0#\147\251n\139\217^~b\229\129",PropMessageExpiryInterval
// 17213,PropAuthenticationMethod
// "\180c\180\170\226\a\134\236\151^Lt\203\175\RSw\149X4Cj\"g\v",PropWildcardSubscriptionAvailable
// 118,PropWildcardSubscriptionAvailable 100,PropUserProperty "c\ah\156"
// "\213\149g\229\252\154U\165\139\194\EOT\139v\247\138bK2\192\187B\224*-\134\155\175 \b\170",PropServerReference
// "x%\SUBm\229\ENQ",PropWildcardSubscriptionAvailable 107,PropServerReference
// "\CAN\182#\213'\228\239\130\205c>\EM|\ETB\131\225V\f\224|k$\176v\208\&5",PropTopicAlias 551,PropMaximumPacketSize
// 28489,PropSessionExpiryInterval 11350,PropTopicAlias 3242,PropRetainAvailable 58]
TEST(SubACK5QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0xfb, 0x1,  0x55, 0x8d, 0xf3, 0x1,  0x12, 0x0,  0x5,  0xa1, 0xb9, 0xaa, 0xee, 0x6,  0x22, 0x35,
                   0x38, 0x8,  0x0,  0x1c, 0x1f, 0x7b, 0x45, 0xf9, 0x86, 0xe,  0x78, 0xd7, 0x4a, 0xf3, 0xfa, 0x23, 0x5d,
                   0x82, 0x21, 0xa5, 0xca, 0x65, 0x8f, 0xc2, 0x78, 0x27, 0x43, 0x10, 0xc7, 0xdf, 0xdf, 0x66, 0x2a, 0x20,
                   0x23, 0x50, 0xb7, 0x25, 0x9f, 0x8,  0x0,  0xc,  0xef, 0x25, 0xcb, 0xe8, 0xad, 0x20, 0xe6, 0xb1, 0xfc,
                   0x65, 0xce, 0x90, 0x15, 0x0,  0x10, 0x84, 0x16, 0x11, 0xf,  0x4a, 0xbd, 0x4a, 0xe1, 0x72, 0x86, 0x11,
                   0x82, 0xe8, 0x40, 0x35, 0x6,  0x12, 0x0,  0x4,  0xc7, 0x90, 0xef, 0xc5, 0x21, 0x2f, 0x3,  0x12, 0x0,
                   0xe,  0xaa, 0x93, 0x30, 0x23, 0x93, 0xfb, 0x6e, 0x8b, 0xd9, 0x5e, 0x7e, 0x62, 0xe5, 0x81, 0x2,  0x0,
                   0x0,  0x43, 0x3d, 0x15, 0x0,  0x18, 0xb4, 0x63, 0xb4, 0xaa, 0xe2, 0x7,  0x86, 0xec, 0x97, 0x5e, 0x4c,
                   0x74, 0xcb, 0xaf, 0x1e, 0x77, 0x95, 0x58, 0x34, 0x43, 0x6a, 0x22, 0x67, 0xb,  0x28, 0x76, 0x28, 0x64,
                   0x26, 0x0,  0x4,  0x63, 0x7,  0x68, 0x9c, 0x0,  0x1e, 0xd5, 0x95, 0x67, 0xe5, 0xfc, 0x9a, 0x55, 0xa5,
                   0x8b, 0xc2, 0x4,  0x8b, 0x76, 0xf7, 0x8a, 0x62, 0x4b, 0x32, 0xc0, 0xbb, 0x42, 0xe0, 0x2a, 0x2d, 0x86,
                   0x9b, 0xaf, 0x20, 0x8,  0xaa, 0x1c, 0x0,  0x6,  0x78, 0x25, 0x1a, 0x6d, 0xe5, 0x5,  0x28, 0x6b, 0x1c,
                   0x0,  0x1a, 0x18, 0xb6, 0x23, 0xd5, 0x27, 0xe4, 0xef, 0x82, 0xcd, 0x63, 0x3e, 0x19, 0x7c, 0x17, 0x83,
                   0xe1, 0x56, 0xc,  0xe0, 0x7c, 0x6b, 0x24, 0xb0, 0x76, 0xd0, 0x35, 0x23, 0x2,  0x27, 0x27, 0x0,  0x0,
                   0x6f, 0x49, 0x11, 0x0,  0x0,  0x2c, 0x56, 0x23, 0xc,  0xaa, 0x25, 0x3a, 0x97, 0x83, 0x0,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21901);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x97);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
}

// SubscribeResponse 9953 [Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Right QoS1]
// [PropSessionExpiryInterval 12233,PropSubscriptionIdentifierAvailable 133,PropTopicAliasMaximum
// 26913,PropReceiveMaximum 13582,PropReceiveMaximum 4922,PropAuthenticationMethod
// "\204\r\b:fo\DC2\160\238\ETX\ENQ\128\139\&0\139\246\218\&8\194",PropMessageExpiryInterval
// 15793,PropAuthenticationMethod "J",PropSubscriptionIdentifierAvailable 80,PropAssignedClientIdentifier
// "",PropResponseTopic "",PropSessionExpiryInterval 23870,PropUserProperty "\185\t"
// "Qi\202\&1\173#\ETB\212L5\226l\DC1H\223\132\157\238\&9\131\184\219\205\t",PropReceiveMaximum
// 16774,PropTopicAliasMaximum 28939,PropResponseInformation
// "\187y\185C\173\136\210\241\209\194X\ETB\212(\197\192\212A\\\226\DC3\206&o0\144\226\173\252)",PropMaximumQoS
// 209,PropTopicAliasMaximum 30629,PropSubscriptionIdentifierAvailable 235,PropMessageExpiryInterval
// 16775,PropWildcardSubscriptionAvailable 24,PropSubscriptionIdentifier 0,PropReasonString
// "\169\255\EOT*\218\131L\182bR@\SO4",PropReasonString "[0qc\193\200\154\181t\USUEF"]
TEST(SubACK5QCTest, Decode22) {
  uint8_t pkt[] = {
      0x90, 0xb9, 0x1,  0x26, 0xe1, 0xb2, 0x1,  0x11, 0x0,  0x0,  0x2f, 0xc9, 0x29, 0x85, 0x22, 0x69, 0x21, 0x21, 0x35,
      0xe,  0x21, 0x13, 0x3a, 0x15, 0x0,  0x13, 0xcc, 0xd,  0x8,  0x3a, 0x66, 0x6f, 0x12, 0xa0, 0xee, 0x3,  0x5,  0x80,
      0x8b, 0x30, 0x8b, 0xf6, 0xda, 0x38, 0xc2, 0x2,  0x0,  0x0,  0x3d, 0xb1, 0x15, 0x0,  0x1,  0x4a, 0x29, 0x50, 0x12,
      0x0,  0x0,  0x8,  0x0,  0x0,  0x11, 0x0,  0x0,  0x5d, 0x3e, 0x26, 0x0,  0x2,  0xb9, 0x9,  0x0,  0x18, 0x51, 0x69,
      0xca, 0x31, 0xad, 0x23, 0x17, 0xd4, 0x4c, 0x35, 0xe2, 0x6c, 0x11, 0x48, 0xdf, 0x84, 0x9d, 0xee, 0x39, 0x83, 0xb8,
      0xdb, 0xcd, 0x9,  0x21, 0x41, 0x86, 0x22, 0x71, 0xb,  0x1a, 0x0,  0x1e, 0xbb, 0x79, 0xb9, 0x43, 0xad, 0x88, 0xd2,
      0xf1, 0xd1, 0xc2, 0x58, 0x17, 0xd4, 0x28, 0xc5, 0xc0, 0xd4, 0x41, 0x5c, 0xe2, 0x13, 0xce, 0x26, 0x6f, 0x30, 0x90,
      0xe2, 0xad, 0xfc, 0x29, 0x24, 0xd1, 0x22, 0x77, 0xa5, 0x29, 0xeb, 0x2,  0x0,  0x0,  0x41, 0x87, 0x28, 0x18, 0xb,
      0x0,  0x1f, 0x0,  0xd,  0xa9, 0xff, 0x4,  0x2a, 0xda, 0x83, 0x4c, 0xb6, 0x62, 0x52, 0x40, 0xe,  0x34, 0x1f, 0x0,
      0xd,  0x5b, 0x30, 0x71, 0x63, 0xc1, 0xc8, 0x9a, 0xb5, 0x74, 0x1f, 0x55, 0x45, 0x46, 0x0,  0xa2, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9953);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
}

// SubscribeResponse 21846 [Left SubErrTopicFilterInvalid,Left SubErrImplementationSpecificError,Right QoS2,Right
// QoS1,Right QoS0,Right QoS0,Left SubErrImplementationSpecificError,Left SubErrTopicFilterInvalid,Right QoS2]
// [PropResponseTopic "1\219\195",PropReceiveMaximum 15914]
TEST(SubACK5QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0x15, 0x55, 0x56, 0x9, 0x8, 0x0, 0x3, 0x31, 0xdb, 0xc3, 0x21,
                   0x3e, 0x2a, 0x8f, 0x83, 0x2, 0x1, 0x0, 0x0, 0x83, 0x8f, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[9];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21846);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x83);
  EXPECT_EQ(granted_qos_levels[7], 0x8F);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
}

// SubscribeResponse 25983 [Right QoS2] [PropContentType
// "\226\147\228\236\217\ACK\EM\208\EOT\226\&2R\194\220?o\ESC\195;\167",PropAuthenticationData
// "s);\STX\212}\159\149\EOTojM]X\190\250\243\255\206y\228\247W\184\FS",PropTopicAlias
// 7197,PropSharedSubscriptionAvailable 46,PropRequestResponseInformation 68,PropResponseInformation
// "\133S\SIZy\249@",PropReasonString "8'\180\EOT\178V\144\210\133\198b\\V\146l\US|a\218\&4\v",PropAuthenticationMethod
// "\SOHwl<\204K\233\221\SI",PropReceiveMaximum 20194,PropWildcardSubscriptionAvailable 45,PropMessageExpiryInterval
// 5182,PropContentType "\197\158\212\SOH\163\206\241`\177G\164\238\RS\187\185\v",PropContentType
// "Kb\140.\224\233\144\182E\"B\214\DLE\162Ry\228o\135\180\DC1\SI\139\&4\ESC\168\246\CANE|",PropContentType
// "\172X\191\201\149\166\DC3\212\218\\\137\193\255\179\GS_\230\232\tS\169\137\SOH\202Y\ETBH\208\133",PropWildcardSubscriptionAvailable
// 87,PropTopicAlias 26805,PropReasonString
// "r\ETX\137\EOT@\223,\222\DC4b\EOT\229\152\EOT\ENQ\ENQC\157i\SO\234\DLE\EOT",PropPayloadFormatIndicator
// 16,PropAssignedClientIdentifier "\151\253;#\236\208/;\ENQq\138\157KR\239\169\230.\150\203,l\137\197",PropReasonString
// "\253`j\135K\142\ENQ6\182\t",PropRetainAvailable 151,PropSubscriptionIdentifierAvailable 255,PropResponseInformation
// "",PropReceiveMaximum 23704,PropReasonString "\ACK\235I\SOH\208\254\150l\172",PropAuthenticationMethod
// "e*{\ESC\215H2\SYN!\re1\208G\173[\SYNdX\194\185\FS\DLE\142[dyt",PropAssignedClientIdentifier
// "\227\SYN\147\170O\223\v\RSp\219D\ETB",PropMaximumPacketSize 23197]
TEST(SubACK5QCTest, Decode24) {
  uint8_t pkt[] = {
      0x90, 0xdd, 0x2,  0x65, 0x7f, 0xd8, 0x2,  0x3,  0x0,  0x14, 0xe2, 0x93, 0xe4, 0xec, 0xd9, 0x6,  0x19, 0xd0, 0x4,
      0xe2, 0x32, 0x52, 0xc2, 0xdc, 0x3f, 0x6f, 0x1b, 0xc3, 0x3b, 0xa7, 0x16, 0x0,  0x19, 0x73, 0x29, 0x3b, 0x2,  0xd4,
      0x7d, 0x9f, 0x95, 0x4,  0x6f, 0x6a, 0x4d, 0x5d, 0x58, 0xbe, 0xfa, 0xf3, 0xff, 0xce, 0x79, 0xe4, 0xf7, 0x57, 0xb8,
      0x1c, 0x23, 0x1c, 0x1d, 0x2a, 0x2e, 0x19, 0x44, 0x1a, 0x0,  0x7,  0x85, 0x53, 0xf,  0x5a, 0x79, 0xf9, 0x40, 0x1f,
      0x0,  0x15, 0x38, 0x27, 0xb4, 0x4,  0xb2, 0x56, 0x90, 0xd2, 0x85, 0xc6, 0x62, 0x5c, 0x56, 0x92, 0x6c, 0x1f, 0x7c,
      0x61, 0xda, 0x34, 0xb,  0x15, 0x0,  0x9,  0x1,  0x77, 0x6c, 0x3c, 0xcc, 0x4b, 0xe9, 0xdd, 0xf,  0x21, 0x4e, 0xe2,
      0x28, 0x2d, 0x2,  0x0,  0x0,  0x14, 0x3e, 0x3,  0x0,  0x10, 0xc5, 0x9e, 0xd4, 0x1,  0xa3, 0xce, 0xf1, 0x60, 0xb1,
      0x47, 0xa4, 0xee, 0x1e, 0xbb, 0xb9, 0xb,  0x3,  0x0,  0x1e, 0x4b, 0x62, 0x8c, 0x2e, 0xe0, 0xe9, 0x90, 0xb6, 0x45,
      0x22, 0x42, 0xd6, 0x10, 0xa2, 0x52, 0x79, 0xe4, 0x6f, 0x87, 0xb4, 0x11, 0xf,  0x8b, 0x34, 0x1b, 0xa8, 0xf6, 0x18,
      0x45, 0x7c, 0x3,  0x0,  0x1d, 0xac, 0x58, 0xbf, 0xc9, 0x95, 0xa6, 0x13, 0xd4, 0xda, 0x5c, 0x89, 0xc1, 0xff, 0xb3,
      0x1d, 0x5f, 0xe6, 0xe8, 0x9,  0x53, 0xa9, 0x89, 0x1,  0xca, 0x59, 0x17, 0x48, 0xd0, 0x85, 0x28, 0x57, 0x23, 0x68,
      0xb5, 0x1f, 0x0,  0x17, 0x72, 0x3,  0x89, 0x4,  0x40, 0xdf, 0x2c, 0xde, 0x14, 0x62, 0x4,  0xe5, 0x98, 0x4,  0x5,
      0x5,  0x43, 0x9d, 0x69, 0xe,  0xea, 0x10, 0x4,  0x1,  0x10, 0x12, 0x0,  0x18, 0x97, 0xfd, 0x3b, 0x23, 0xec, 0xd0,
      0x2f, 0x3b, 0x5,  0x71, 0x8a, 0x9d, 0x4b, 0x52, 0xef, 0xa9, 0xe6, 0x2e, 0x96, 0xcb, 0x2c, 0x6c, 0x89, 0xc5, 0x1f,
      0x0,  0xa,  0xfd, 0x60, 0x6a, 0x87, 0x4b, 0x8e, 0x5,  0x36, 0xb6, 0x9,  0x25, 0x97, 0x29, 0xff, 0x1a, 0x0,  0x0,
      0x21, 0x5c, 0x98, 0x1f, 0x0,  0x9,  0x6,  0xeb, 0x49, 0x1,  0xd0, 0xfe, 0x96, 0x6c, 0xac, 0x15, 0x0,  0x1c, 0x65,
      0x2a, 0x7b, 0x1b, 0xd7, 0x48, 0x32, 0x16, 0x21, 0xd,  0x65, 0x31, 0xd0, 0x47, 0xad, 0x5b, 0x16, 0x64, 0x58, 0xc2,
      0xb9, 0x1c, 0x10, 0x8e, 0x5b, 0x64, 0x79, 0x74, 0x12, 0x0,  0xc,  0xe3, 0x16, 0x93, 0xaa, 0x4f, 0xdf, 0xb,  0x1e,
      0x70, 0xdb, 0x44, 0x17, 0x27, 0x0,  0x0,  0x5a, 0x9d, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25983);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
}

// SubscribeResponse 803 [Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrNotAuthorized,Right
// QoS2,Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1] [PropResponseInformation
// "\198d&ULmk\177@C\ETB\212\229\213\246\193\222\SOH\204",PropRequestResponseInformation 141,PropWillDelayInterval
// 31029,PropMessageExpiryInterval 293,PropMaximumQoS 13,PropUserProperty "\143"
// "a\153Z\DEL\162d\248\129\255\133\173\178R7\173\162\206=\212\DC4",PropAuthenticationData
// "\212%mM\160\229\196\206\140\135\236tC\154>Q\NUL\196|",PropCorrelationData
// "\136.\179z\150\154Z-\232\fL\232",PropMessageExpiryInterval 16324,PropSubscriptionIdentifierAvailable
// 30,PropMessageExpiryInterval 25682,PropWildcardSubscriptionAvailable 61]
TEST(SubACK5QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x7a, 0x3,  0x23, 0x71, 0x1a, 0x0,  0x13, 0xc6, 0x64, 0x26, 0x55, 0x4c, 0x6d, 0x6b, 0xb1,
                   0x40, 0x43, 0x17, 0xd4, 0xe5, 0xd5, 0xf6, 0xc1, 0xde, 0x1,  0xcc, 0x19, 0x8d, 0x18, 0x0,  0x0,
                   0x79, 0x35, 0x2,  0x0,  0x0,  0x1,  0x25, 0x24, 0xd,  0x26, 0x0,  0x1,  0x8f, 0x0,  0x14, 0x61,
                   0x99, 0x5a, 0x7f, 0xa2, 0x64, 0xf8, 0x81, 0xff, 0x85, 0xad, 0xb2, 0x52, 0x37, 0xad, 0xa2, 0xce,
                   0x3d, 0xd4, 0x14, 0x16, 0x0,  0x13, 0xd4, 0x25, 0x6d, 0x4d, 0xa0, 0xe5, 0xc4, 0xce, 0x8c, 0x87,
                   0xec, 0x74, 0x43, 0x9a, 0x3e, 0x51, 0x0,  0xc4, 0x7c, 0x9,  0x0,  0xc,  0x88, 0x2e, 0xb3, 0x7a,
                   0x96, 0x9a, 0x5a, 0x2d, 0xe8, 0xc,  0x4c, 0xe8, 0x2,  0x0,  0x0,  0x3f, 0xc4, 0x29, 0x1e, 0x2,
                   0x0,  0x0,  0x64, 0x52, 0x28, 0x3d, 0x0,  0xa2, 0x87, 0x2,  0xa1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 803);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0xA1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 6677 [Right QoS0,Right QoS1,Left SubErrTopicFilterInvalid,Left
// SubErrImplementationSpecificError,Right QoS0,Right QoS1,Right QoS2,Right QoS2,Left
// SubErrSubscriptionIdentifiersNotSupported,Left SubErrNotAuthorized,Right QoS0] [PropTopicAliasMaximum
// 15406,PropMaximumPacketSize 23595,PropReasonString " \193\129.\STXT\160",PropAuthenticationMethod
// "\181\&0",PropCorrelationData "\185\169\158\190V\137\206\aH&l\138\159z\233\RS\254\&6\ENQ\144",PropMaximumPacketSize
// 1098,PropRequestResponseInformation 86,PropMaximumPacketSize 5354,PropSharedSubscriptionAvailable
// 83,PropRequestProblemInformation 221,PropRequestProblemInformation 203,PropRequestResponseInformation
// 204,PropResponseInformation "*>=\DC3z \252",PropContentType
// "$\133:\188N\213\STXk\144@\226\SYNSd\147\ETX\187",PropAuthenticationData
// "\226]\238\t\234,\251\154\153y\b\132",PropMessageExpiryInterval 17116,PropWildcardSubscriptionAvailable
// 4,PropReceiveMaximum 32286,PropWillDelayInterval 16552,PropCorrelationData
// "t\187\179\f\200\178",PropSharedSubscriptionAvailable 251,PropResponseTopic
// "\178\181$\156\245$M\GS\189h\SIy\129\169\204",PropContentType
// "L\v\247\232\254\209a}\140=<b\211\US\140\&9)1\203\146\NAK\247L\DC2.B\221",PropMessageExpiryInterval
// 23080,PropAssignedClientIdentifier "\148\227\142"]
TEST(SubACK5QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0xd3, 0x1,  0x1a, 0x15, 0xc4, 0x1,  0x22, 0x3c, 0x2e, 0x27, 0x0,  0x0,  0x5c, 0x2b, 0x1f, 0x0,
                   0x7,  0x20, 0xc1, 0x81, 0x2e, 0x2,  0x54, 0xa0, 0x15, 0x0,  0x2,  0xb5, 0x30, 0x9,  0x0,  0x14, 0xb9,
                   0xa9, 0x9e, 0xbe, 0x56, 0x89, 0xce, 0x7,  0x48, 0x26, 0x6c, 0x8a, 0x9f, 0x7a, 0xe9, 0x1e, 0xfe, 0x36,
                   0x5,  0x90, 0x27, 0x0,  0x0,  0x4,  0x4a, 0x19, 0x56, 0x27, 0x0,  0x0,  0x14, 0xea, 0x2a, 0x53, 0x17,
                   0xdd, 0x17, 0xcb, 0x19, 0xcc, 0x1a, 0x0,  0x7,  0x2a, 0x3e, 0x3d, 0x13, 0x7a, 0x20, 0xfc, 0x3,  0x0,
                   0x11, 0x24, 0x85, 0x3a, 0xbc, 0x4e, 0xd5, 0x2,  0x6b, 0x90, 0x40, 0xe2, 0x16, 0x53, 0x64, 0x93, 0x3,
                   0xbb, 0x16, 0x0,  0xc,  0xe2, 0x5d, 0xee, 0x9,  0xea, 0x2c, 0xfb, 0x9a, 0x99, 0x79, 0x8,  0x84, 0x2,
                   0x0,  0x0,  0x42, 0xdc, 0x28, 0x4,  0x21, 0x7e, 0x1e, 0x18, 0x0,  0x0,  0x40, 0xa8, 0x9,  0x0,  0x6,
                   0x74, 0xbb, 0xb3, 0xc,  0xc8, 0xb2, 0x2a, 0xfb, 0x8,  0x0,  0xf,  0xb2, 0xb5, 0x24, 0x9c, 0xf5, 0x24,
                   0x4d, 0x1d, 0xbd, 0x68, 0xf,  0x79, 0x81, 0xa9, 0xcc, 0x3,  0x0,  0x1b, 0x4c, 0xb,  0xf7, 0xe8, 0xfe,
                   0xd1, 0x61, 0x7d, 0x8c, 0x3d, 0x3c, 0x62, 0xd3, 0x1f, 0x8c, 0x39, 0x29, 0x31, 0xcb, 0x92, 0x15, 0xf7,
                   0x4c, 0x12, 0x2e, 0x42, 0xdd, 0x2,  0x0,  0x0,  0x5a, 0x28, 0x12, 0x0,  0x3,  0x94, 0xe3, 0x8e, 0x0,
                   0x1,  0x8f, 0x83, 0x0,  0x1,  0x2,  0x2,  0xa1, 0x87, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6677);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], 0xA1);
  EXPECT_EQ(granted_qos_levels[9], 0x87);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS0);
}

// SubscribeResponse 7481 [Left SubErrNotAuthorized,Right QoS1,Right QoS2,Left SubErrNotAuthorized] [PropServerKeepAlive
// 8029,PropAuthenticationMethod "rS\179\220\137\207\170\247v8D0\ETBs\206\191\v\156/\158\173",PropServerKeepAlive
// 2400,PropRequestProblemInformation 151,PropAuthenticationMethod
// "\170\139\188\SOH+\130\184\166\189\GS\221J}\230v\ACKU\143\DC4\150\254.}E\SUBj",PropTopicAlias
// 18638,PropMessageExpiryInterval 5512,PropReasonString
// "\195\218\"\223\244\188\a\130\ETB6\211X\230Xt\128v\163",PropWildcardSubscriptionAvailable 58,PropServerKeepAlive
// 17394]
TEST(SubACK5QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x66, 0x1d, 0x39, 0x5f, 0x13, 0x1f, 0x5d, 0x15, 0x0,  0x15, 0x72, 0x53, 0xb3, 0xdc,
                   0x89, 0xcf, 0xaa, 0xf7, 0x76, 0x38, 0x44, 0x30, 0x17, 0x73, 0xce, 0xbf, 0xb,  0x9c, 0x2f,
                   0x9e, 0xad, 0x13, 0x9,  0x60, 0x17, 0x97, 0x15, 0x0,  0x1a, 0xaa, 0x8b, 0xbc, 0x1,  0x2b,
                   0x82, 0xb8, 0xa6, 0xbd, 0x1d, 0xdd, 0x4a, 0x7d, 0xe6, 0x76, 0x6,  0x55, 0x8f, 0x14, 0x96,
                   0xfe, 0x2e, 0x7d, 0x45, 0x1a, 0x6a, 0x23, 0x48, 0xce, 0x2,  0x0,  0x0,  0x15, 0x88, 0x1f,
                   0x0,  0x12, 0xc3, 0xda, 0x22, 0xdf, 0xf4, 0xbc, 0x7,  0x82, 0x17, 0x36, 0xd3, 0x58, 0xe6,
                   0x58, 0x74, 0x80, 0x76, 0xa3, 0x28, 0x3a, 0x13, 0x43, 0xf2, 0x87, 0x1,  0x2,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7481);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x87);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
}

// SubscribeResponse 26117 [Right QoS2,Right QoS0,Right QoS0] [PropReasonString
// "\NAK\203\155",PropRequestProblemInformation 235,PropWildcardSubscriptionAvailable 50,PropContentType
// "\176E\219\128\153\155\152\147\154AT\200T\150\SOH0\RS",PropWildcardSubscriptionAvailable 9,PropResponseInformation
// "%\248\239",PropSharedSubscriptionAvailable 2,PropPayloadFormatIndicator 46,PropAuthenticationData
// "\181\147\SO\237\203\159H\199\v\US\177\129E\221)UD\156\188"]
TEST(SubACK5QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x46, 0x66, 0x5,  0x40, 0x1f, 0x0,  0x3,  0x15, 0xcb, 0x9b, 0x17, 0xeb, 0x28, 0x32,
                   0x3,  0x0,  0x11, 0xb0, 0x45, 0xdb, 0x80, 0x99, 0x9b, 0x98, 0x93, 0x9a, 0x41, 0x54, 0xc8,
                   0x54, 0x96, 0x1,  0x30, 0x1e, 0x28, 0x9,  0x1a, 0x0,  0x3,  0x25, 0xf8, 0xef, 0x2a, 0x2,
                   0x1,  0x2e, 0x16, 0x0,  0x13, 0xb5, 0x93, 0xe,  0xed, 0xcb, 0x9f, 0x48, 0xc7, 0xb,  0x1f,
                   0xb1, 0x81, 0x45, 0xdd, 0x29, 0x55, 0x44, 0x9c, 0xbc, 0x2,  0x0,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 26117);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
}

// SubscribeResponse 4603 [Left SubErrWildcardSubscriptionsNotSupported] [PropServerReference
// "\226\204`2\212\&4tl\135\151L\154\149&",PropWildcardSubscriptionAvailable 197,PropSessionExpiryInterval
// 21325,PropAssignedClientIdentifier "\ACKc\180\232\225\182N\181\206\169\129<$",PropWildcardSubscriptionAvailable
// 166,PropServerKeepAlive 21338,PropServerKeepAlive 8899,PropWildcardSubscriptionAvailable
// 156,PropMessageExpiryInterval 3096,PropServerKeepAlive 25030,PropSubscriptionIdentifier 29,PropPayloadFormatIndicator
// 59,PropServerKeepAlive 5386,PropWildcardSubscriptionAvailable 67,PropMessageExpiryInterval 14429]
TEST(SubACK5QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0x4c, 0x11, 0xfb, 0x48, 0x1c, 0x0,  0xe,  0xe2, 0xcc, 0x60, 0x32, 0xd4, 0x34, 0x74, 0x6c,
                   0x87, 0x97, 0x4c, 0x9a, 0x95, 0x26, 0x28, 0xc5, 0x11, 0x0,  0x0,  0x53, 0x4d, 0x12, 0x0,  0xd,
                   0x6,  0x63, 0xb4, 0xe8, 0xe1, 0xb6, 0x4e, 0xb5, 0xce, 0xa9, 0x81, 0x3c, 0x24, 0x28, 0xa6, 0x13,
                   0x53, 0x5a, 0x13, 0x22, 0xc3, 0x28, 0x9c, 0x2,  0x0,  0x0,  0xc,  0x18, 0x13, 0x61, 0xc6, 0xb,
                   0x1d, 0x1,  0x3b, 0x13, 0x15, 0xa,  0x28, 0x43, 0x2,  0x0,  0x0,  0x38, 0x5d, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4603);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
}

// SubscribeResponse 32025 [Left SubErrPacketIdentifierInUse] [PropCorrelationData
// "\NULu\160\251\247\151O\DC4$s4Y\\\252\ESCe=\DC2\223\179X",PropServerReference "\ACKA\194K\128\241
// \193\192Qj\v",PropRetainAvailable 144,PropUserProperty "\195\208\NUL\148I\GS\137\DLE"
// "\234f\216\145\&6&\ngxp&Q\154*\130w",PropAssignedClientIdentifier
// "\RS\152\226\211\166\134\\\SYN\238\180\ETB17Z\a(\176Y",PropAssignedClientIdentifier
// "\227\188I\254\162\184\193?\210C\141\197\158Z\191\143\196t3\SOH\149\246|,\193\182@~\239\191",PropAuthenticationMethod
// "\218",PropServerKeepAlive 4111,PropWildcardSubscriptionAvailable 115,PropMaximumQoS 93,PropResponseInformation
// "\ESC",PropPayloadFormatIndicator 26,PropCorrelationData
// "\182|\RS\248\191\255\&7\180\220\FS(%\186\160\a\221>\DELS\130\176\&6\CAN>r\196\211\217\209",PropAuthenticationMethod
// "=\228ya-\142\EMD\232\217\137\129=\177\214}\192`\205",PropServerKeepAlive 20374,PropTopicAliasMaximum
// 22407,PropWildcardSubscriptionAvailable 208,PropReceiveMaximum 17593,PropMessageExpiryInterval
// 31603,PropReceiveMaximum 17390,PropCorrelationData "\SOm\151\203y\242\191(\173g\178\&9\199>U\187Z\228"]
TEST(SubACK5QCTest, Decode30) {
  uint8_t pkt[] = {
      0x90, 0xf0, 0x1,  0x7d, 0x19, 0xeb, 0x1,  0x9,  0x0,  0x15, 0x0,  0x75, 0xa0, 0xfb, 0xf7, 0x97, 0x4f, 0x14, 0x24,
      0x73, 0x34, 0x59, 0x5c, 0xfc, 0x1b, 0x65, 0x3d, 0x12, 0xdf, 0xb3, 0x58, 0x1c, 0x0,  0xc,  0x6,  0x41, 0xc2, 0x4b,
      0x80, 0xf1, 0x20, 0xc1, 0xc0, 0x51, 0x6a, 0xb,  0x25, 0x90, 0x26, 0x0,  0x8,  0xc3, 0xd0, 0x0,  0x94, 0x49, 0x1d,
      0x89, 0x10, 0x0,  0x10, 0xea, 0x66, 0xd8, 0x91, 0x36, 0x26, 0xa,  0x67, 0x78, 0x70, 0x26, 0x51, 0x9a, 0x2a, 0x82,
      0x77, 0x12, 0x0,  0x12, 0x1e, 0x98, 0xe2, 0xd3, 0xa6, 0x86, 0x5c, 0x16, 0xee, 0xb4, 0x17, 0x31, 0x37, 0x5a, 0x7,
      0x28, 0xb0, 0x59, 0x12, 0x0,  0x1e, 0xe3, 0xbc, 0x49, 0xfe, 0xa2, 0xb8, 0xc1, 0x3f, 0xd2, 0x43, 0x8d, 0xc5, 0x9e,
      0x5a, 0xbf, 0x8f, 0xc4, 0x74, 0x33, 0x1,  0x95, 0xf6, 0x7c, 0x2c, 0xc1, 0xb6, 0x40, 0x7e, 0xef, 0xbf, 0x15, 0x0,
      0x1,  0xda, 0x13, 0x10, 0xf,  0x28, 0x73, 0x24, 0x5d, 0x1a, 0x0,  0x1,  0x1b, 0x1,  0x1a, 0x9,  0x0,  0x1d, 0xb6,
      0x7c, 0x1e, 0xf8, 0xbf, 0xff, 0x37, 0xb4, 0xdc, 0x1c, 0x28, 0x25, 0xba, 0xa0, 0x7,  0xdd, 0x3e, 0x7f, 0x53, 0x82,
      0xb0, 0x36, 0x18, 0x3e, 0x72, 0xc4, 0xd3, 0xd9, 0xd1, 0x15, 0x0,  0x13, 0x3d, 0xe4, 0x79, 0x61, 0x2d, 0x8e, 0x19,
      0x44, 0xe8, 0xd9, 0x89, 0x81, 0x3d, 0xb1, 0xd6, 0x7d, 0xc0, 0x60, 0xcd, 0x13, 0x4f, 0x96, 0x22, 0x57, 0x87, 0x28,
      0xd0, 0x21, 0x44, 0xb9, 0x2,  0x0,  0x0,  0x7b, 0x73, 0x21, 0x43, 0xee, 0x9,  0x0,  0x12, 0xe,  0x6d, 0x97, 0xcb,
      0x79, 0xf2, 0xbf, 0x28, 0xad, 0x67, 0xb2, 0x39, 0xc7, 0x3e, 0x55, 0xbb, 0x5a, 0xe4, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32025);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
}

// UnsubscribeRequest 24378 ["\214\DC35\253\159\129F#\236\204y?\150\128\DC2u\230\211
// O\133\185\r\135\163\177","\225\161,\196C\187\132IH\245\164\210!e\185\145e\139\243\181X8\n\242\182\204\151^\228","{\SUBC\158","\252\142\163gsP\ACK\133\234LY\203\&8\183\251\223\147\128\249","G}\173\207o\181\247\NULk\180\255\243\157o\SOH\199\NAKxD6","\220\ACK\170\&3)c\200`\251o\158"]
// []
TEST(Unsubscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0xa2, 0x7b, 0x5f, 0x3a, 0x0,  0x1a, 0xd6, 0x13, 0x35, 0xfd, 0x9f, 0x81, 0x46, 0x23, 0xec, 0xcc,
                   0x79, 0x3f, 0x96, 0x80, 0x12, 0x75, 0xe6, 0xd3, 0x20, 0x4f, 0x85, 0xb9, 0xd,  0x87, 0xa3, 0xb1,
                   0x0,  0x1d, 0xe1, 0xa1, 0x2c, 0xc4, 0x43, 0xbb, 0x84, 0x49, 0x48, 0xf5, 0xa4, 0xd2, 0x21, 0x65,
                   0xb9, 0x91, 0x65, 0x8b, 0xf3, 0xb5, 0x58, 0x38, 0xa,  0xf2, 0xb6, 0xcc, 0x97, 0x5e, 0xe4, 0x0,
                   0x4,  0x7b, 0x1a, 0x43, 0x9e, 0x0,  0x13, 0xfc, 0x8e, 0xa3, 0x67, 0x73, 0x50, 0x6,  0x85, 0xea,
                   0x4c, 0x59, 0xcb, 0x38, 0xb7, 0xfb, 0xdf, 0x93, 0x80, 0xf9, 0x0,  0x14, 0x47, 0x7d, 0xad, 0xcf,
                   0x6f, 0xb5, 0xf7, 0x0,  0x6b, 0xb4, 0xff, 0xf3, 0x9d, 0x6f, 0x1,  0xc7, 0x15, 0x78, 0x44, 0x36,
                   0x0,  0xb,  0xdc, 0x6,  0xaa, 0x33, 0x29, 0x63, 0xc8, 0x60, 0xfb, 0x6f, 0x9e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xd6, 0x13, 0x35, 0xfd, 0x9f, 0x81, 0x46, 0x23, 0xec, 0xcc, 0x79, 0x3f, 0x96,
                                     0x80, 0x12, 0x75, 0xe6, 0xd3, 0x20, 0x4f, 0x85, 0xb9, 0xd,  0x87, 0xa3, 0xb1};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe1, 0xa1, 0x2c, 0xc4, 0x43, 0xbb, 0x84, 0x49, 0x48, 0xf5,
                                     0xa4, 0xd2, 0x21, 0x65, 0xb9, 0x91, 0x65, 0x8b, 0xf3, 0xb5,
                                     0x58, 0x38, 0xa,  0xf2, 0xb6, 0xcc, 0x97, 0x5e, 0xe4};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7b, 0x1a, 0x43, 0x9e};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfc, 0x8e, 0xa3, 0x67, 0x73, 0x50, 0x6,  0x85, 0xea, 0x4c,
                                     0x59, 0xcb, 0x38, 0xb7, 0xfb, 0xdf, 0x93, 0x80, 0xf9};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x47, 0x7d, 0xad, 0xcf, 0x6f, 0xb5, 0xf7, 0x0,  0x6b, 0xb4,
                                     0xff, 0xf3, 0x9d, 0x6f, 0x1,  0xc7, 0x15, 0x78, 0x44, 0x36};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xdc, 0x6, 0xaa, 0x33, 0x29, 0x63, 0xc8, 0x60, 0xfb, 0x6f, 0x9e};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24378, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 2051
// ["","\193\252\EOT\NAK\244\187T\"A\224\181\EOT\232\248Q\175[\132*\231\160\&9cK\158\209wc1","A3\151\238\144\145\195:\165\&6R\SUB\239\198ypa\225\254\219\245\ETB\225\222e\GS","Q\EM\157\DC2\249\155h\249\139\&89)\243$\186u\190\135t\141\240\&7\164\246","\SUBTW","\132\180L","\212R\181Q4A7m,\SO\SYN\232I\181\207/<S?\252\141<\DELb\231","\NAK\224\rj\137\SOHk4\184\203\169M/\156)\189
// or\v\143\185\215\190\250_\186","\139\218\194\199H9\189","u\178\168\DLE%\214\158\227%\194\as\193y\DLEw)!","\154\225/\145\ETB"]
// []
TEST(Unsubscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0xa2, 0xbf, 0x1,  0x8,  0x3,  0x0,  0x0,  0x0,  0x1d, 0xc1, 0xfc, 0x4,  0x15, 0xf4, 0xbb, 0x54, 0x22,
                   0x41, 0xe0, 0xb5, 0x4,  0xe8, 0xf8, 0x51, 0xaf, 0x5b, 0x84, 0x2a, 0xe7, 0xa0, 0x39, 0x63, 0x4b, 0x9e,
                   0xd1, 0x77, 0x63, 0x31, 0x0,  0x1a, 0x41, 0x33, 0x97, 0xee, 0x90, 0x91, 0xc3, 0x3a, 0xa5, 0x36, 0x52,
                   0x1a, 0xef, 0xc6, 0x79, 0x70, 0x61, 0xe1, 0xfe, 0xdb, 0xf5, 0x17, 0xe1, 0xde, 0x65, 0x1d, 0x0,  0x18,
                   0x51, 0x19, 0x9d, 0x12, 0xf9, 0x9b, 0x68, 0xf9, 0x8b, 0x38, 0x39, 0x29, 0xf3, 0x24, 0xba, 0x75, 0xbe,
                   0x87, 0x74, 0x8d, 0xf0, 0x37, 0xa4, 0xf6, 0x0,  0x3,  0x1a, 0x54, 0x57, 0x0,  0x3,  0x84, 0xb4, 0x4c,
                   0x0,  0x19, 0xd4, 0x52, 0xb5, 0x51, 0x34, 0x41, 0x37, 0x6d, 0x2c, 0xe,  0x16, 0xe8, 0x49, 0xb5, 0xcf,
                   0x2f, 0x3c, 0x53, 0x3f, 0xfc, 0x8d, 0x3c, 0x7f, 0x62, 0xe7, 0x0,  0x1b, 0x15, 0xe0, 0xd,  0x6a, 0x89,
                   0x1,  0x6b, 0x34, 0xb8, 0xcb, 0xa9, 0x4d, 0x2f, 0x9c, 0x29, 0xbd, 0x20, 0x6f, 0x72, 0xb,  0x8f, 0xb9,
                   0xd7, 0xbe, 0xfa, 0x5f, 0xba, 0x0,  0x7,  0x8b, 0xda, 0xc2, 0xc7, 0x48, 0x39, 0xbd, 0x0,  0x12, 0x75,
                   0xb2, 0xa8, 0x10, 0x25, 0xd6, 0x9e, 0xe3, 0x25, 0xc2, 0x7,  0x73, 0xc1, 0x79, 0x10, 0x77, 0x29, 0x21,
                   0x0,  0x5,  0x9a, 0xe1, 0x2f, 0x91, 0x17};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc1, 0xfc, 0x4,  0x15, 0xf4, 0xbb, 0x54, 0x22, 0x41, 0xe0,
                                     0xb5, 0x4,  0xe8, 0xf8, 0x51, 0xaf, 0x5b, 0x84, 0x2a, 0xe7,
                                     0xa0, 0x39, 0x63, 0x4b, 0x9e, 0xd1, 0x77, 0x63, 0x31};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x41, 0x33, 0x97, 0xee, 0x90, 0x91, 0xc3, 0x3a, 0xa5, 0x36, 0x52, 0x1a, 0xef,
                                     0xc6, 0x79, 0x70, 0x61, 0xe1, 0xfe, 0xdb, 0xf5, 0x17, 0xe1, 0xde, 0x65, 0x1d};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x51, 0x19, 0x9d, 0x12, 0xf9, 0x9b, 0x68, 0xf9, 0x8b, 0x38, 0x39, 0x29,
                                     0xf3, 0x24, 0xba, 0x75, 0xbe, 0x87, 0x74, 0x8d, 0xf0, 0x37, 0xa4, 0xf6};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1a, 0x54, 0x57};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x84, 0xb4, 0x4c};
  lwmqtt_string_t topic_filter_s5 = {3, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xd4, 0x52, 0xb5, 0x51, 0x34, 0x41, 0x37, 0x6d, 0x2c, 0xe,  0x16, 0xe8, 0x49,
                                     0xb5, 0xcf, 0x2f, 0x3c, 0x53, 0x3f, 0xfc, 0x8d, 0x3c, 0x7f, 0x62, 0xe7};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x15, 0xe0, 0xd,  0x6a, 0x89, 0x1, 0x6b, 0x34, 0xb8, 0xcb, 0xa9, 0x4d, 0x2f, 0x9c,
                                     0x29, 0xbd, 0x20, 0x6f, 0x72, 0xb, 0x8f, 0xb9, 0xd7, 0xbe, 0xfa, 0x5f, 0xba};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x8b, 0xda, 0xc2, 0xc7, 0x48, 0x39, 0xbd};
  lwmqtt_string_t topic_filter_s8 = {7, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x75, 0xb2, 0xa8, 0x10, 0x25, 0xd6, 0x9e, 0xe3, 0x25,
                                     0xc2, 0x7,  0x73, 0xc1, 0x79, 0x10, 0x77, 0x29, 0x21};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x9a, 0xe1, 0x2f, 0x91, 0x17};
  lwmqtt_string_t topic_filter_s10 = {5, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2051, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 16794
// ["\180g51\142\172",";.#\179\155.\222\244?\199\164\178\134\191\231,6\b;\197C\DC1x\EOTr\131i\173E\181","S\130\144\228\GS\188\147`5\143\243\246\ETB\153R\130\240\213","*\225\\\234\184\136\150J\221\157"]
// []
TEST(Unsubscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0xa2, 0x4a, 0x41, 0x9a, 0x0,  0x6,  0xb4, 0x67, 0x35, 0x31, 0x8e, 0xac, 0x0,  0x1e, 0x3b, 0x2e,
                   0x23, 0xb3, 0x9b, 0x2e, 0xde, 0xf4, 0x3f, 0xc7, 0xa4, 0xb2, 0x86, 0xbf, 0xe7, 0x2c, 0x36, 0x8,
                   0x3b, 0xc5, 0x43, 0x11, 0x78, 0x4,  0x72, 0x83, 0x69, 0xad, 0x45, 0xb5, 0x0,  0x12, 0x53, 0x82,
                   0x90, 0xe4, 0x1d, 0xbc, 0x93, 0x60, 0x35, 0x8f, 0xf3, 0xf6, 0x17, 0x99, 0x52, 0x82, 0xf0, 0xd5,
                   0x0,  0xa,  0x2a, 0xe1, 0x5c, 0xea, 0xb8, 0x88, 0x96, 0x4a, 0xdd, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xb4, 0x67, 0x35, 0x31, 0x8e, 0xac};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3b, 0x2e, 0x23, 0xb3, 0x9b, 0x2e, 0xde, 0xf4, 0x3f, 0xc7,
                                     0xa4, 0xb2, 0x86, 0xbf, 0xe7, 0x2c, 0x36, 0x8,  0x3b, 0xc5,
                                     0x43, 0x11, 0x78, 0x4,  0x72, 0x83, 0x69, 0xad, 0x45, 0xb5};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x53, 0x82, 0x90, 0xe4, 0x1d, 0xbc, 0x93, 0x60, 0x35,
                                     0x8f, 0xf3, 0xf6, 0x17, 0x99, 0x52, 0x82, 0xf0, 0xd5};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2a, 0xe1, 0x5c, 0xea, 0xb8, 0x88, 0x96, 0x4a, 0xdd, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 16794, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 15779
// ["q\143\179\SUB\203\191\213\177]\DC1\148S\175\ESC\200C5\NAK\246\167r\152\198\254\ETXI","jv\241\208\SUB\210","\183\192\222;F\253\246vU\179\SIO\222","\150T\145\198J\tp\138\137'\ESC\157"]
// []
TEST(Unsubscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0xa2, 0x43, 0x3d, 0xa3, 0x0,  0x1a, 0x71, 0x8f, 0xb3, 0x1a, 0xcb, 0xbf, 0xd5, 0xb1,
                   0x5d, 0x11, 0x94, 0x53, 0xaf, 0x1b, 0xc8, 0x43, 0x35, 0x15, 0xf6, 0xa7, 0x72, 0x98,
                   0xc6, 0xfe, 0x3,  0x49, 0x0,  0x6,  0x6a, 0x76, 0xf1, 0xd0, 0x1a, 0xd2, 0x0,  0xd,
                   0xb7, 0xc0, 0xde, 0x3b, 0x46, 0xfd, 0xf6, 0x76, 0x55, 0xb3, 0xf,  0x4f, 0xde, 0x0,
                   0xc,  0x96, 0x54, 0x91, 0xc6, 0x4a, 0x9,  0x70, 0x8a, 0x89, 0x27, 0x1b, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0x8f, 0xb3, 0x1a, 0xcb, 0xbf, 0xd5, 0xb1, 0x5d, 0x11, 0x94, 0x53, 0xaf,
                                     0x1b, 0xc8, 0x43, 0x35, 0x15, 0xf6, 0xa7, 0x72, 0x98, 0xc6, 0xfe, 0x3,  0x49};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0x76, 0xf1, 0xd0, 0x1a, 0xd2};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb7, 0xc0, 0xde, 0x3b, 0x46, 0xfd, 0xf6, 0x76, 0x55, 0xb3, 0xf, 0x4f, 0xde};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x96, 0x54, 0x91, 0xc6, 0x4a, 0x9, 0x70, 0x8a, 0x89, 0x27, 0x1b, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15779, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 2710
// ["\192e\229>\239\247\184\209\158w\SI_X0T","E\243","\225\CAN*E8Q\t-\252B\136.\247\185\250","\144e\204Xj","\195?}\251*\158\210a,W\235\&3\249\219Z\143;","\239\251","","\170/\199\164\194\231\210\t\165(#\r\235i\151d\176QN\SUBX\249\195",",\176%\165\203\137\141\230K\EOT\SUBc\197\155N\202\195\t","5\129\227KZ\180\&7\DC4y^","n\227a\231\134C~\181\163^]\213\146"]
// []
TEST(Unsubscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0xa2, 0x90, 0x1,  0xa,  0x96, 0x0,  0xf,  0xc0, 0x65, 0xe5, 0x3e, 0xef, 0xf7, 0xb8, 0xd1, 0x9e, 0x77,
                   0xf,  0x5f, 0x58, 0x30, 0x54, 0x0,  0x2,  0x45, 0xf3, 0x0,  0xf,  0xe1, 0x18, 0x2a, 0x45, 0x38, 0x51,
                   0x9,  0x2d, 0xfc, 0x42, 0x88, 0x2e, 0xf7, 0xb9, 0xfa, 0x0,  0x5,  0x90, 0x65, 0xcc, 0x58, 0x6a, 0x0,
                   0x11, 0xc3, 0x3f, 0x7d, 0xfb, 0x2a, 0x9e, 0xd2, 0x61, 0x2c, 0x57, 0xeb, 0x33, 0xf9, 0xdb, 0x5a, 0x8f,
                   0x3b, 0x0,  0x2,  0xef, 0xfb, 0x0,  0x0,  0x0,  0x17, 0xaa, 0x2f, 0xc7, 0xa4, 0xc2, 0xe7, 0xd2, 0x9,
                   0xa5, 0x28, 0x23, 0xd,  0xeb, 0x69, 0x97, 0x64, 0xb0, 0x51, 0x4e, 0x1a, 0x58, 0xf9, 0xc3, 0x0,  0x12,
                   0x2c, 0xb0, 0x25, 0xa5, 0xcb, 0x89, 0x8d, 0xe6, 0x4b, 0x4,  0x1a, 0x63, 0xc5, 0x9b, 0x4e, 0xca, 0xc3,
                   0x9,  0x0,  0xa,  0x35, 0x81, 0xe3, 0x4b, 0x5a, 0xb4, 0x37, 0x14, 0x79, 0x5e, 0x0,  0xd,  0x6e, 0xe3,
                   0x61, 0xe7, 0x86, 0x43, 0x7e, 0xb5, 0xa3, 0x5e, 0x5d, 0xd5, 0x92};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xc0, 0x65, 0xe5, 0x3e, 0xef, 0xf7, 0xb8, 0xd1,
                                     0x9e, 0x77, 0xf,  0x5f, 0x58, 0x30, 0x54};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x45, 0xf3};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe1, 0x18, 0x2a, 0x45, 0x38, 0x51, 0x9, 0x2d,
                                     0xfc, 0x42, 0x88, 0x2e, 0xf7, 0xb9, 0xfa};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x90, 0x65, 0xcc, 0x58, 0x6a};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc3, 0x3f, 0x7d, 0xfb, 0x2a, 0x9e, 0xd2, 0x61, 0x2c,
                                     0x57, 0xeb, 0x33, 0xf9, 0xdb, 0x5a, 0x8f, 0x3b};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xef, 0xfb};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xaa, 0x2f, 0xc7, 0xa4, 0xc2, 0xe7, 0xd2, 0x9,  0xa5, 0x28, 0x23, 0xd,
                                     0xeb, 0x69, 0x97, 0x64, 0xb0, 0x51, 0x4e, 0x1a, 0x58, 0xf9, 0xc3};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2c, 0xb0, 0x25, 0xa5, 0xcb, 0x89, 0x8d, 0xe6, 0x4b,
                                     0x4,  0x1a, 0x63, 0xc5, 0x9b, 0x4e, 0xca, 0xc3, 0x9};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x35, 0x81, 0xe3, 0x4b, 0x5a, 0xb4, 0x37, 0x14, 0x79, 0x5e};
  lwmqtt_string_t topic_filter_s9 = {10, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x6e, 0xe3, 0x61, 0xe7, 0x86, 0x43, 0x7e, 0xb5, 0xa3, 0x5e, 0x5d, 0xd5, 0x92};
  lwmqtt_string_t topic_filter_s10 = {13, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2710, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5130
// ["\246\197\169\&5\b\231f\149\170\236\240\171d\142Uq\241\RS\138\&2\222\160F\162\243\176NN\249\208","\STXt(\EM\234#}\242B~\248","","\166\"\128\192\131x<Pt\176BS\158D\v\CAN\129\152\&8","\251\181\178\201\147\176nsp\154\v\147A1a\190\208\NAK\222","<\aQ\200\238\"\132pv*\202\143","M\200\200Z\139\238","\145\143\192Tb(-y\184\252Yq@J_\n\201rE"]
// []
TEST(Unsubscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0xa2, 0x86, 0x1,  0x14, 0xa,  0x0,  0x1e, 0xf6, 0xc5, 0xa9, 0x35, 0x8,  0xe7, 0x66, 0x95, 0xaa,
                   0xec, 0xf0, 0xab, 0x64, 0x8e, 0x55, 0x71, 0xf1, 0x1e, 0x8a, 0x32, 0xde, 0xa0, 0x46, 0xa2, 0xf3,
                   0xb0, 0x4e, 0x4e, 0xf9, 0xd0, 0x0,  0xb,  0x2,  0x74, 0x28, 0x19, 0xea, 0x23, 0x7d, 0xf2, 0x42,
                   0x7e, 0xf8, 0x0,  0x0,  0x0,  0x13, 0xa6, 0x22, 0x80, 0xc0, 0x83, 0x78, 0x3c, 0x50, 0x74, 0xb0,
                   0x42, 0x53, 0x9e, 0x44, 0xb,  0x18, 0x81, 0x98, 0x38, 0x0,  0x13, 0xfb, 0xb5, 0xb2, 0xc9, 0x93,
                   0xb0, 0x6e, 0x73, 0x70, 0x9a, 0xb,  0x93, 0x41, 0x31, 0x61, 0xbe, 0xd0, 0x15, 0xde, 0x0,  0xc,
                   0x3c, 0x7,  0x51, 0xc8, 0xee, 0x22, 0x84, 0x70, 0x76, 0x2a, 0xca, 0x8f, 0x0,  0x6,  0x4d, 0xc8,
                   0xc8, 0x5a, 0x8b, 0xee, 0x0,  0x13, 0x91, 0x8f, 0xc0, 0x54, 0x62, 0x28, 0x2d, 0x79, 0xb8, 0xfc,
                   0x59, 0x71, 0x40, 0x4a, 0x5f, 0xa,  0xc9, 0x72, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xf6, 0xc5, 0xa9, 0x35, 0x8,  0xe7, 0x66, 0x95, 0xaa, 0xec,
                                     0xf0, 0xab, 0x64, 0x8e, 0x55, 0x71, 0xf1, 0x1e, 0x8a, 0x32,
                                     0xde, 0xa0, 0x46, 0xa2, 0xf3, 0xb0, 0x4e, 0x4e, 0xf9, 0xd0};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2, 0x74, 0x28, 0x19, 0xea, 0x23, 0x7d, 0xf2, 0x42, 0x7e, 0xf8};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa6, 0x22, 0x80, 0xc0, 0x83, 0x78, 0x3c, 0x50, 0x74, 0xb0,
                                     0x42, 0x53, 0x9e, 0x44, 0xb,  0x18, 0x81, 0x98, 0x38};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfb, 0xb5, 0xb2, 0xc9, 0x93, 0xb0, 0x6e, 0x73, 0x70, 0x9a,
                                     0xb,  0x93, 0x41, 0x31, 0x61, 0xbe, 0xd0, 0x15, 0xde};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3c, 0x7, 0x51, 0xc8, 0xee, 0x22, 0x84, 0x70, 0x76, 0x2a, 0xca, 0x8f};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4d, 0xc8, 0xc8, 0x5a, 0x8b, 0xee};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x91, 0x8f, 0xc0, 0x54, 0x62, 0x28, 0x2d, 0x79, 0xb8, 0xfc,
                                     0x59, 0x71, 0x40, 0x4a, 0x5f, 0xa,  0xc9, 0x72, 0x45};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5130, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 10000
// ["\FS\130\191W5L\182\156$\165\150tm\255l\234\202\179\208>\219\194\231\DELs\163","\188\202\DLE\SO\251z!\203\ETB\156.Mu\241\151","s\132\130\222\fE\142T\128\&3\v\230\218\&2\210_G6\128\220\251\STX","\t\171%#\219\251\SOH}\175@O\169","1d\CAN\f\SOH\183\253%F*","\195f\ry\161\STX\235\147\NAK\\\189\168","\SUBq;\RS\183\209\228z\166\187\217\155\EM\133[\133:\252\148\SYN","\207\ETB\179"]
// []
TEST(Unsubscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0xa2, 0x8a, 0x1,  0x27, 0x10, 0x0,  0x1a, 0x1c, 0x82, 0xbf, 0x57, 0x35, 0x4c, 0xb6, 0x9c, 0x24,
                   0xa5, 0x96, 0x74, 0x6d, 0xff, 0x6c, 0xea, 0xca, 0xb3, 0xd0, 0x3e, 0xdb, 0xc2, 0xe7, 0x7f, 0x73,
                   0xa3, 0x0,  0xf,  0xbc, 0xca, 0x10, 0xe,  0xfb, 0x7a, 0x21, 0xcb, 0x17, 0x9c, 0x2e, 0x4d, 0x75,
                   0xf1, 0x97, 0x0,  0x16, 0x73, 0x84, 0x82, 0xde, 0xc,  0x45, 0x8e, 0x54, 0x80, 0x33, 0xb,  0xe6,
                   0xda, 0x32, 0xd2, 0x5f, 0x47, 0x36, 0x80, 0xdc, 0xfb, 0x2,  0x0,  0xc,  0x9,  0xab, 0x25, 0x23,
                   0xdb, 0xfb, 0x1,  0x7d, 0xaf, 0x40, 0x4f, 0xa9, 0x0,  0xa,  0x31, 0x64, 0x18, 0xc,  0x1,  0xb7,
                   0xfd, 0x25, 0x46, 0x2a, 0x0,  0xc,  0xc3, 0x66, 0xd,  0x79, 0xa1, 0x2,  0xeb, 0x93, 0x15, 0x5c,
                   0xbd, 0xa8, 0x0,  0x14, 0x1a, 0x71, 0x3b, 0x1e, 0xb7, 0xd1, 0xe4, 0x7a, 0xa6, 0xbb, 0xd9, 0x9b,
                   0x19, 0x85, 0x5b, 0x85, 0x3a, 0xfc, 0x94, 0x16, 0x0,  0x3,  0xcf, 0x17, 0xb3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x1c, 0x82, 0xbf, 0x57, 0x35, 0x4c, 0xb6, 0x9c, 0x24, 0xa5, 0x96, 0x74, 0x6d,
                                     0xff, 0x6c, 0xea, 0xca, 0xb3, 0xd0, 0x3e, 0xdb, 0xc2, 0xe7, 0x7f, 0x73, 0xa3};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbc, 0xca, 0x10, 0xe,  0xfb, 0x7a, 0x21, 0xcb,
                                     0x17, 0x9c, 0x2e, 0x4d, 0x75, 0xf1, 0x97};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x73, 0x84, 0x82, 0xde, 0xc,  0x45, 0x8e, 0x54, 0x80, 0x33, 0xb,
                                     0xe6, 0xda, 0x32, 0xd2, 0x5f, 0x47, 0x36, 0x80, 0xdc, 0xfb, 0x2};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9, 0xab, 0x25, 0x23, 0xdb, 0xfb, 0x1, 0x7d, 0xaf, 0x40, 0x4f, 0xa9};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x64, 0x18, 0xc, 0x1, 0xb7, 0xfd, 0x25, 0x46, 0x2a};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc3, 0x66, 0xd, 0x79, 0xa1, 0x2, 0xeb, 0x93, 0x15, 0x5c, 0xbd, 0xa8};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1a, 0x71, 0x3b, 0x1e, 0xb7, 0xd1, 0xe4, 0x7a, 0xa6, 0xbb,
                                     0xd9, 0x9b, 0x19, 0x85, 0x5b, 0x85, 0x3a, 0xfc, 0x94, 0x16};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xcf, 0x17, 0xb3};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10000, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27754 ["\172U5\DEL\CAN\228","8\240H\r\196\215\174\249;\DEL","\196\130@
// \243\239\224\EM\205\229\136\207\254\167\223\132\193\tA\194A\245\NUL","\224\222\248\EOT\133p^\181\176C\236i7\193\233","\196\184Q\132\RS\SYN&y-\220\&3\GSN\220\172i\ENQ-\143\&9\b\203\226z\253\SI\ACK","\DC1\DC2\SOH\203\"\201\150\136G\ACK\DC3","Y;\167C\134\239\208\r\219\234J\222\197*R\184\150L.\\\178&\NUL\221\229\185\222]","\252\225\DC2~\145\SUBH\232\240\145\206m_u\146*$\254\SYNI\\\174\rk1\157\&5\253\&3\220","1r\226\USM\210o\252\161=\241","]\201\&9"]
// []
TEST(Unsubscribe311QCTest, Encode8) {
  uint8_t pkt[] = {
      0xa2, 0xba, 0x1,  0x6c, 0x6a, 0x0,  0x6,  0xac, 0x55, 0x35, 0x7f, 0x18, 0xe4, 0x0,  0xa,  0x38, 0xf0, 0x48, 0xd,
      0xc4, 0xd7, 0xae, 0xf9, 0x3b, 0x7f, 0x0,  0x17, 0xc4, 0x82, 0x40, 0x20, 0xf3, 0xef, 0xe0, 0x19, 0xcd, 0xe5, 0x88,
      0xcf, 0xfe, 0xa7, 0xdf, 0x84, 0xc1, 0x9,  0x41, 0xc2, 0x41, 0xf5, 0x0,  0x0,  0xf,  0xe0, 0xde, 0xf8, 0x4,  0x85,
      0x70, 0x5e, 0xb5, 0xb0, 0x43, 0xec, 0x69, 0x37, 0xc1, 0xe9, 0x0,  0x1b, 0xc4, 0xb8, 0x51, 0x84, 0x1e, 0x16, 0x26,
      0x79, 0x2d, 0xdc, 0x33, 0x1d, 0x4e, 0xdc, 0xac, 0x69, 0x5,  0x2d, 0x8f, 0x39, 0x8,  0xcb, 0xe2, 0x7a, 0xfd, 0xf,
      0x6,  0x0,  0xb,  0x11, 0x12, 0x1,  0xcb, 0x22, 0xc9, 0x96, 0x88, 0x47, 0x6,  0x13, 0x0,  0x1c, 0x59, 0x3b, 0xa7,
      0x43, 0x86, 0xef, 0xd0, 0xd,  0xdb, 0xea, 0x4a, 0xde, 0xc5, 0x2a, 0x52, 0xb8, 0x96, 0x4c, 0x2e, 0x5c, 0xb2, 0x26,
      0x0,  0xdd, 0xe5, 0xb9, 0xde, 0x5d, 0x0,  0x1e, 0xfc, 0xe1, 0x12, 0x7e, 0x91, 0x1a, 0x48, 0xe8, 0xf0, 0x91, 0xce,
      0x6d, 0x5f, 0x75, 0x92, 0x2a, 0x24, 0xfe, 0x16, 0x49, 0x5c, 0xae, 0xd,  0x6b, 0x31, 0x9d, 0x35, 0xfd, 0x33, 0xdc,
      0x0,  0xb,  0x31, 0x72, 0xe2, 0x1f, 0x4d, 0xd2, 0x6f, 0xfc, 0xa1, 0x3d, 0xf1, 0x0,  0x3,  0x5d, 0xc9, 0x39};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xac, 0x55, 0x35, 0x7f, 0x18, 0xe4};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x38, 0xf0, 0x48, 0xd, 0xc4, 0xd7, 0xae, 0xf9, 0x3b, 0x7f};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc4, 0x82, 0x40, 0x20, 0xf3, 0xef, 0xe0, 0x19, 0xcd, 0xe5, 0x88, 0xcf,
                                     0xfe, 0xa7, 0xdf, 0x84, 0xc1, 0x9,  0x41, 0xc2, 0x41, 0xf5, 0x0};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe0, 0xde, 0xf8, 0x4,  0x85, 0x70, 0x5e, 0xb5,
                                     0xb0, 0x43, 0xec, 0x69, 0x37, 0xc1, 0xe9};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc4, 0xb8, 0x51, 0x84, 0x1e, 0x16, 0x26, 0x79, 0x2d, 0xdc, 0x33, 0x1d, 0x4e, 0xdc,
                                     0xac, 0x69, 0x5,  0x2d, 0x8f, 0x39, 0x8,  0xcb, 0xe2, 0x7a, 0xfd, 0xf,  0x6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x11, 0x12, 0x1, 0xcb, 0x22, 0xc9, 0x96, 0x88, 0x47, 0x6, 0x13};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x59, 0x3b, 0xa7, 0x43, 0x86, 0xef, 0xd0, 0xd,  0xdb, 0xea,
                                     0x4a, 0xde, 0xc5, 0x2a, 0x52, 0xb8, 0x96, 0x4c, 0x2e, 0x5c,
                                     0xb2, 0x26, 0x0,  0xdd, 0xe5, 0xb9, 0xde, 0x5d};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfc, 0xe1, 0x12, 0x7e, 0x91, 0x1a, 0x48, 0xe8, 0xf0, 0x91,
                                     0xce, 0x6d, 0x5f, 0x75, 0x92, 0x2a, 0x24, 0xfe, 0x16, 0x49,
                                     0x5c, 0xae, 0xd,  0x6b, 0x31, 0x9d, 0x35, 0xfd, 0x33, 0xdc};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x31, 0x72, 0xe2, 0x1f, 0x4d, 0xd2, 0x6f, 0xfc, 0xa1, 0x3d, 0xf1};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5d, 0xc9, 0x39};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27754, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 13532 ["\240\FS[\152\DLE\226\153","\239?\170"] []
TEST(Unsubscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0xa2, 0x10, 0x34, 0xdc, 0x0, 0x7, 0xf0, 0x1c, 0x5b,
                   0x98, 0x10, 0xe2, 0x99, 0x0, 0x3, 0xef, 0x3f, 0xaa};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xf0, 0x1c, 0x5b, 0x98, 0x10, 0xe2, 0x99};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xef, 0x3f, 0xaa};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13532, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 8446 ["N-\DC2\189\173\241\ETB\177\&9
// \159\f\fj~\213!7\235\ESCx\194@\217\US[<","-","e\189\238\251\177\189\195\DLE\192\"c\166\SUB\DEL\145\133L\154^\"W\ETB\217\212","\155","X\139\243\DEL","\209\253\253\NUL9D\178\250\155BHo!\229=\135\146","\EM\217\251","\193S","\173M\228Y\v","\DC4>\252W0Y"]
// []
TEST(Unsubscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0xa2, 0x70, 0x20, 0xfe, 0x0,  0x1b, 0x4e, 0x2d, 0x12, 0xbd, 0xad, 0xf1, 0x17, 0xb1, 0x39, 0x20, 0x9f,
                   0xc,  0xc,  0x6a, 0x7e, 0xd5, 0x21, 0x37, 0xeb, 0x1b, 0x78, 0xc2, 0x40, 0xd9, 0x1f, 0x5b, 0x3c, 0x0,
                   0x1,  0x2d, 0x0,  0x18, 0x65, 0xbd, 0xee, 0xfb, 0xb1, 0xbd, 0xc3, 0x10, 0xc0, 0x22, 0x63, 0xa6, 0x1a,
                   0x7f, 0x91, 0x85, 0x4c, 0x9a, 0x5e, 0x22, 0x57, 0x17, 0xd9, 0xd4, 0x0,  0x1,  0x9b, 0x0,  0x4,  0x58,
                   0x8b, 0xf3, 0x7f, 0x0,  0x11, 0xd1, 0xfd, 0xfd, 0x0,  0x39, 0x44, 0xb2, 0xfa, 0x9b, 0x42, 0x48, 0x6f,
                   0x21, 0xe5, 0x3d, 0x87, 0x92, 0x0,  0x3,  0x19, 0xd9, 0xfb, 0x0,  0x2,  0xc1, 0x53, 0x0,  0x5,  0xad,
                   0x4d, 0xe4, 0x59, 0xb,  0x0,  0x6,  0x14, 0x3e, 0xfc, 0x57, 0x30, 0x59};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x4e, 0x2d, 0x12, 0xbd, 0xad, 0xf1, 0x17, 0xb1, 0x39, 0x20, 0x9f, 0xc,  0xc, 0x6a,
                                     0x7e, 0xd5, 0x21, 0x37, 0xeb, 0x1b, 0x78, 0xc2, 0x40, 0xd9, 0x1f, 0x5b, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x65, 0xbd, 0xee, 0xfb, 0xb1, 0xbd, 0xc3, 0x10, 0xc0, 0x22, 0x63, 0xa6,
                                     0x1a, 0x7f, 0x91, 0x85, 0x4c, 0x9a, 0x5e, 0x22, 0x57, 0x17, 0xd9, 0xd4};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9b};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x58, 0x8b, 0xf3, 0x7f};
  lwmqtt_string_t topic_filter_s4 = {4, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd1, 0xfd, 0xfd, 0x0,  0x39, 0x44, 0xb2, 0xfa, 0x9b,
                                     0x42, 0x48, 0x6f, 0x21, 0xe5, 0x3d, 0x87, 0x92};
  lwmqtt_string_t topic_filter_s5 = {17, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x19, 0xd9, 0xfb};
  lwmqtt_string_t topic_filter_s6 = {3, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc1, 0x53};
  lwmqtt_string_t topic_filter_s7 = {2, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xad, 0x4d, 0xe4, 0x59, 0xb};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x14, 0x3e, 0xfc, 0x57, 0x30, 0x59};
  lwmqtt_string_t topic_filter_s9 = {6, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8446, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 16062
// ["\DC4\200\182\217\165`\168\SUB\DLE7\161\153>`\251\222\164\236/\237\214y#\151\242.z","\139\214\221#G*U\227T\173Rn@x\190\128\&5y\194\247\195\175\253wE","\GS\251H\DC4\vJP\189\140\185\154\&6\ETB\ETX","\128","\164\134\216\194\&6\188\138H\199\EOT\183\NULcZ?\216\152\181\221Q\186\186(","N\153\169\195C0fs\136\178\185\191\163\GS\DLE\NUL\163\137\203\244\EM\134","%N\154_","\182\139\236\&1\DEL\208\223\&6&D\244\191\208\GS\155S\221","\133
// \226-gm\142m\195\143\ACK\187RL\224}\157S=\135\230j\143","\221A\DC405q\245^U\188\239\212","\141\201\141\157\242\ACKk\161\185\131\247\CAN\a\240L\180\218Wn\218%\f\247"]
// []
TEST(Unsubscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0xa2, 0xd7, 0x1,  0x3e, 0xbe, 0x0,  0x1b, 0x14, 0xc8, 0xb6, 0xd9, 0xa5, 0x60, 0xa8, 0x1a, 0x10, 0x37,
                   0xa1, 0x99, 0x3e, 0x60, 0xfb, 0xde, 0xa4, 0xec, 0x2f, 0xed, 0xd6, 0x79, 0x23, 0x97, 0xf2, 0x2e, 0x7a,
                   0x0,  0x19, 0x8b, 0xd6, 0xdd, 0x23, 0x47, 0x2a, 0x55, 0xe3, 0x54, 0xad, 0x52, 0x6e, 0x40, 0x78, 0xbe,
                   0x80, 0x35, 0x79, 0xc2, 0xf7, 0xc3, 0xaf, 0xfd, 0x77, 0x45, 0x0,  0xe,  0x1d, 0xfb, 0x48, 0x14, 0xb,
                   0x4a, 0x50, 0xbd, 0x8c, 0xb9, 0x9a, 0x36, 0x17, 0x3,  0x0,  0x1,  0x80, 0x0,  0x17, 0xa4, 0x86, 0xd8,
                   0xc2, 0x36, 0xbc, 0x8a, 0x48, 0xc7, 0x4,  0xb7, 0x0,  0x63, 0x5a, 0x3f, 0xd8, 0x98, 0xb5, 0xdd, 0x51,
                   0xba, 0xba, 0x28, 0x0,  0x16, 0x4e, 0x99, 0xa9, 0xc3, 0x43, 0x30, 0x66, 0x73, 0x88, 0xb2, 0xb9, 0xbf,
                   0xa3, 0x1d, 0x10, 0x0,  0xa3, 0x89, 0xcb, 0xf4, 0x19, 0x86, 0x0,  0x4,  0x25, 0x4e, 0x9a, 0x5f, 0x0,
                   0x11, 0xb6, 0x8b, 0xec, 0x31, 0x7f, 0xd0, 0xdf, 0x36, 0x26, 0x44, 0xf4, 0xbf, 0xd0, 0x1d, 0x9b, 0x53,
                   0xdd, 0x0,  0x17, 0x85, 0x20, 0xe2, 0x2d, 0x67, 0x6d, 0x8e, 0x6d, 0xc3, 0x8f, 0x6,  0xbb, 0x52, 0x4c,
                   0xe0, 0x7d, 0x9d, 0x53, 0x3d, 0x87, 0xe6, 0x6a, 0x8f, 0x0,  0xc,  0xdd, 0x41, 0x14, 0x30, 0x35, 0x71,
                   0xf5, 0x5e, 0x55, 0xbc, 0xef, 0xd4, 0x0,  0x17, 0x8d, 0xc9, 0x8d, 0x9d, 0xf2, 0x6,  0x6b, 0xa1, 0xb9,
                   0x83, 0xf7, 0x18, 0x7,  0xf0, 0x4c, 0xb4, 0xda, 0x57, 0x6e, 0xda, 0x25, 0xc,  0xf7};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x14, 0xc8, 0xb6, 0xd9, 0xa5, 0x60, 0xa8, 0x1a, 0x10, 0x37, 0xa1, 0x99, 0x3e, 0x60,
                                     0xfb, 0xde, 0xa4, 0xec, 0x2f, 0xed, 0xd6, 0x79, 0x23, 0x97, 0xf2, 0x2e, 0x7a};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8b, 0xd6, 0xdd, 0x23, 0x47, 0x2a, 0x55, 0xe3, 0x54, 0xad, 0x52, 0x6e, 0x40,
                                     0x78, 0xbe, 0x80, 0x35, 0x79, 0xc2, 0xf7, 0xc3, 0xaf, 0xfd, 0x77, 0x45};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1d, 0xfb, 0x48, 0x14, 0xb, 0x4a, 0x50, 0xbd, 0x8c, 0xb9, 0x9a, 0x36, 0x17, 0x3};
  lwmqtt_string_t topic_filter_s2 = {14, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x80};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa4, 0x86, 0xd8, 0xc2, 0x36, 0xbc, 0x8a, 0x48, 0xc7, 0x4,  0xb7, 0x0,
                                     0x63, 0x5a, 0x3f, 0xd8, 0x98, 0xb5, 0xdd, 0x51, 0xba, 0xba, 0x28};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4e, 0x99, 0xa9, 0xc3, 0x43, 0x30, 0x66, 0x73, 0x88, 0xb2, 0xb9,
                                     0xbf, 0xa3, 0x1d, 0x10, 0x0,  0xa3, 0x89, 0xcb, 0xf4, 0x19, 0x86};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x25, 0x4e, 0x9a, 0x5f};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb6, 0x8b, 0xec, 0x31, 0x7f, 0xd0, 0xdf, 0x36, 0x26,
                                     0x44, 0xf4, 0xbf, 0xd0, 0x1d, 0x9b, 0x53, 0xdd};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x85, 0x20, 0xe2, 0x2d, 0x67, 0x6d, 0x8e, 0x6d, 0xc3, 0x8f, 0x6, 0xbb,
                                     0x52, 0x4c, 0xe0, 0x7d, 0x9d, 0x53, 0x3d, 0x87, 0xe6, 0x6a, 0x8f};
  lwmqtt_string_t topic_filter_s8 = {23, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xdd, 0x41, 0x14, 0x30, 0x35, 0x71, 0xf5, 0x5e, 0x55, 0xbc, 0xef, 0xd4};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x8d, 0xc9, 0x8d, 0x9d, 0xf2, 0x6,  0x6b, 0xa1, 0xb9, 0x83, 0xf7, 0x18,
                                      0x7,  0xf0, 0x4c, 0xb4, 0xda, 0x57, 0x6e, 0xda, 0x25, 0xc,  0xf7};
  lwmqtt_string_t topic_filter_s10 = {23, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 16062, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 999
// ["kz8\"x_\167\&7\"\185\142\244:j\DC1","|","$\185\f4w\233","T\165\216\ETB\180p\NULe\ETX8\144\DLE4\DC4\GS\226\218\129\RS\SOHz","\172|>\168&\208\226\212\228lp\RSw\196\153\ESC\218\178l\207\rqgP\t\155$\145\ENQ","\EOT\244\t\200\GS\218\166\a\ETBL\218\191\198\183\130OR\ENQn\151\"|"]
// []
TEST(Unsubscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0xa2, 0x6c, 0x3,  0xe7, 0x0,  0xf,  0x6b, 0x7a, 0x38, 0x22, 0x78, 0x5f, 0xa7, 0x37, 0x22, 0xb9,
                   0x8e, 0xf4, 0x3a, 0x6a, 0x11, 0x0,  0x1,  0x7c, 0x0,  0x6,  0x24, 0xb9, 0xc,  0x34, 0x77, 0xe9,
                   0x0,  0x15, 0x54, 0xa5, 0xd8, 0x17, 0xb4, 0x70, 0x0,  0x65, 0x3,  0x38, 0x90, 0x10, 0x34, 0x14,
                   0x1d, 0xe2, 0xda, 0x81, 0x1e, 0x1,  0x7a, 0x0,  0x1d, 0xac, 0x7c, 0x3e, 0xa8, 0x26, 0xd0, 0xe2,
                   0xd4, 0xe4, 0x6c, 0x70, 0x1e, 0x77, 0xc4, 0x99, 0x1b, 0xda, 0xb2, 0x6c, 0xcf, 0xd,  0x71, 0x67,
                   0x50, 0x9,  0x9b, 0x24, 0x91, 0x5,  0x0,  0x16, 0x4,  0xf4, 0x9,  0xc8, 0x1d, 0xda, 0xa6, 0x7,
                   0x17, 0x4c, 0xda, 0xbf, 0xc6, 0xb7, 0x82, 0x4f, 0x52, 0x5,  0x6e, 0x97, 0x22, 0x7c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0x7a, 0x38, 0x22, 0x78, 0x5f, 0xa7, 0x37,
                                     0x22, 0xb9, 0x8e, 0xf4, 0x3a, 0x6a, 0x11};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7c};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x24, 0xb9, 0xc, 0x34, 0x77, 0xe9};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x54, 0xa5, 0xd8, 0x17, 0xb4, 0x70, 0x0,  0x65, 0x3, 0x38, 0x90,
                                     0x10, 0x34, 0x14, 0x1d, 0xe2, 0xda, 0x81, 0x1e, 0x1, 0x7a};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xac, 0x7c, 0x3e, 0xa8, 0x26, 0xd0, 0xe2, 0xd4, 0xe4, 0x6c,
                                     0x70, 0x1e, 0x77, 0xc4, 0x99, 0x1b, 0xda, 0xb2, 0x6c, 0xcf,
                                     0xd,  0x71, 0x67, 0x50, 0x9,  0x9b, 0x24, 0x91, 0x5};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4,  0xf4, 0x9,  0xc8, 0x1d, 0xda, 0xa6, 0x7,  0x17, 0x4c, 0xda,
                                     0xbf, 0xc6, 0xb7, 0x82, 0x4f, 0x52, 0x5,  0x6e, 0x97, 0x22, 0x7c};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 999, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5737
// ["\216\200`8N","z\226\248\NULq\EOT\232\158\NUL\178\131\247\130\n\240\192\225^","?x\STX-5\217\158\213\253+\165\134\173`#\190\229\177\228\177\183\\\204V","[Q","\190\180u\222#\171\SUBik\221\246\227\164)\239\210\EOT4[-","f\SO\237iS\197T\247\250\167?\228\242\170\213_b\215\241\221\153\136\138\229\175","E}\SUB\221S\172
// \FS\189&}v\220"] []
TEST(Unsubscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0xa2, 0x7b, 0x16, 0x69, 0x0,  0x5,  0xd8, 0xc8, 0x60, 0x38, 0x4e, 0x0,  0x12, 0x7a, 0xe2, 0xf8,
                   0x0,  0x71, 0x4,  0xe8, 0x9e, 0x0,  0xb2, 0x83, 0xf7, 0x82, 0xa,  0xf0, 0xc0, 0xe1, 0x5e, 0x0,
                   0x18, 0x3f, 0x78, 0x2,  0x2d, 0x35, 0xd9, 0x9e, 0xd5, 0xfd, 0x2b, 0xa5, 0x86, 0xad, 0x60, 0x23,
                   0xbe, 0xe5, 0xb1, 0xe4, 0xb1, 0xb7, 0x5c, 0xcc, 0x56, 0x0,  0x2,  0x5b, 0x51, 0x0,  0x14, 0xbe,
                   0xb4, 0x75, 0xde, 0x23, 0xab, 0x1a, 0x69, 0x6b, 0xdd, 0xf6, 0xe3, 0xa4, 0x29, 0xef, 0xd2, 0x4,
                   0x34, 0x5b, 0x2d, 0x0,  0x19, 0x66, 0xe,  0xed, 0x69, 0x53, 0xc5, 0x54, 0xf7, 0xfa, 0xa7, 0x3f,
                   0xe4, 0xf2, 0xaa, 0xd5, 0x5f, 0x62, 0xd7, 0xf1, 0xdd, 0x99, 0x88, 0x8a, 0xe5, 0xaf, 0x0,  0xd,
                   0x45, 0x7d, 0x1a, 0xdd, 0x53, 0xac, 0x20, 0x1c, 0xbd, 0x26, 0x7d, 0x76, 0xdc};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xd8, 0xc8, 0x60, 0x38, 0x4e};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7a, 0xe2, 0xf8, 0x0,  0x71, 0x4,  0xe8, 0x9e, 0x0,
                                     0xb2, 0x83, 0xf7, 0x82, 0xa,  0xf0, 0xc0, 0xe1, 0x5e};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x3f, 0x78, 0x2,  0x2d, 0x35, 0xd9, 0x9e, 0xd5, 0xfd, 0x2b, 0xa5, 0x86,
                                     0xad, 0x60, 0x23, 0xbe, 0xe5, 0xb1, 0xe4, 0xb1, 0xb7, 0x5c, 0xcc, 0x56};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5b, 0x51};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbe, 0xb4, 0x75, 0xde, 0x23, 0xab, 0x1a, 0x69, 0x6b, 0xdd,
                                     0xf6, 0xe3, 0xa4, 0x29, 0xef, 0xd2, 0x4,  0x34, 0x5b, 0x2d};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x66, 0xe,  0xed, 0x69, 0x53, 0xc5, 0x54, 0xf7, 0xfa, 0xa7, 0x3f, 0xe4, 0xf2,
                                     0xaa, 0xd5, 0x5f, 0x62, 0xd7, 0xf1, 0xdd, 0x99, 0x88, 0x8a, 0xe5, 0xaf};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x45, 0x7d, 0x1a, 0xdd, 0x53, 0xac, 0x20, 0x1c, 0xbd, 0x26, 0x7d, 0x76, 0xdc};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5737, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 1255
// ["\153\GSI\185K\229\aE*T\235?5*(","9\225=)\198\150\245\192\130\194N\204d\137\162(\248\142n","\163\168\DEL\193\254\161\250\166\204\221\231\250\&9\228\202\163\162%\242c\223\217\250\182","\255\201\247\&9\DC4?\255\229\SI\EOT\228fc\ETB\177\225+b\159\&5O\218\ACK\132","\251\n\SYN~\RS\180\172y\RS\f\228\211*\214","Uq\215s\244Y",""]
// []
TEST(Unsubscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0xa2, 0x76, 0x4,  0xe7, 0x0,  0xf,  0x99, 0x1d, 0x49, 0xb9, 0x4b, 0xe5, 0x7,  0x45, 0x2a,
                   0x54, 0xeb, 0x3f, 0x35, 0x2a, 0x28, 0x0,  0x13, 0x39, 0xe1, 0x3d, 0x29, 0xc6, 0x96, 0xf5,
                   0xc0, 0x82, 0xc2, 0x4e, 0xcc, 0x64, 0x89, 0xa2, 0x28, 0xf8, 0x8e, 0x6e, 0x0,  0x18, 0xa3,
                   0xa8, 0x7f, 0xc1, 0xfe, 0xa1, 0xfa, 0xa6, 0xcc, 0xdd, 0xe7, 0xfa, 0x39, 0xe4, 0xca, 0xa3,
                   0xa2, 0x25, 0xf2, 0x63, 0xdf, 0xd9, 0xfa, 0xb6, 0x0,  0x18, 0xff, 0xc9, 0xf7, 0x39, 0x14,
                   0x3f, 0xff, 0xe5, 0xf,  0x4,  0xe4, 0x66, 0x63, 0x17, 0xb1, 0xe1, 0x2b, 0x62, 0x9f, 0x35,
                   0x4f, 0xda, 0x6,  0x84, 0x0,  0xe,  0xfb, 0xa,  0x16, 0x7e, 0x1e, 0xb4, 0xac, 0x79, 0x1e,
                   0xc,  0xe4, 0xd3, 0x2a, 0xd6, 0x0,  0x6,  0x55, 0x71, 0xd7, 0x73, 0xf4, 0x59, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x99, 0x1d, 0x49, 0xb9, 0x4b, 0xe5, 0x7, 0x45,
                                     0x2a, 0x54, 0xeb, 0x3f, 0x35, 0x2a, 0x28};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x39, 0xe1, 0x3d, 0x29, 0xc6, 0x96, 0xf5, 0xc0, 0x82, 0xc2,
                                     0x4e, 0xcc, 0x64, 0x89, 0xa2, 0x28, 0xf8, 0x8e, 0x6e};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa3, 0xa8, 0x7f, 0xc1, 0xfe, 0xa1, 0xfa, 0xa6, 0xcc, 0xdd, 0xe7, 0xfa,
                                     0x39, 0xe4, 0xca, 0xa3, 0xa2, 0x25, 0xf2, 0x63, 0xdf, 0xd9, 0xfa, 0xb6};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xff, 0xc9, 0xf7, 0x39, 0x14, 0x3f, 0xff, 0xe5, 0xf,  0x4,  0xe4, 0x66,
                                     0x63, 0x17, 0xb1, 0xe1, 0x2b, 0x62, 0x9f, 0x35, 0x4f, 0xda, 0x6,  0x84};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfb, 0xa, 0x16, 0x7e, 0x1e, 0xb4, 0xac, 0x79, 0x1e, 0xc, 0xe4, 0xd3, 0x2a, 0xd6};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x55, 0x71, 0xd7, 0x73, 0xf4, 0x59};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 1255, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22682
// ["\DEL\148\206K\136Hx\216\137\137*\209\248*\186\130\163\206@\US%\179s","\232\&0\131\241\219a\152\207V\185\213v\186[\165\191\DC4`K\144\228\194\ETBVgW","\195\211\171c\216\f\DC2\165`\183Pj\228\216~\238@","5\234\US\174\183$\196V\DLE\168\247\255","h7\224\134\254\229\GSn\131_1\200>e","H\ETB\172+\157d!VF\131\157!\EM\201","\179U.\225i\222\SYN\136b\NULw\SOH\187\&1M\135p:","Y\189?\174\nQyM\165.\"\ENQ\140__\192\254\187\228","\239\222\226\181\184\209\133\199\&7O\254\175","\EOT\229\DC4.X\129\129\&5\204;\230"]
// []
TEST(Unsubscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0xa2, 0xbc, 0x1,  0x58, 0x9a, 0x0,  0x17, 0x7f, 0x94, 0xce, 0x4b, 0x88, 0x48, 0x78, 0xd8, 0x89,
                   0x89, 0x2a, 0xd1, 0xf8, 0x2a, 0xba, 0x82, 0xa3, 0xce, 0x40, 0x1f, 0x25, 0xb3, 0x73, 0x0,  0x1a,
                   0xe8, 0x30, 0x83, 0xf1, 0xdb, 0x61, 0x98, 0xcf, 0x56, 0xb9, 0xd5, 0x76, 0xba, 0x5b, 0xa5, 0xbf,
                   0x14, 0x60, 0x4b, 0x90, 0xe4, 0xc2, 0x17, 0x56, 0x67, 0x57, 0x0,  0x11, 0xc3, 0xd3, 0xab, 0x63,
                   0xd8, 0xc,  0x12, 0xa5, 0x60, 0xb7, 0x50, 0x6a, 0xe4, 0xd8, 0x7e, 0xee, 0x40, 0x0,  0xc,  0x35,
                   0xea, 0x1f, 0xae, 0xb7, 0x24, 0xc4, 0x56, 0x10, 0xa8, 0xf7, 0xff, 0x0,  0xe,  0x68, 0x37, 0xe0,
                   0x86, 0xfe, 0xe5, 0x1d, 0x6e, 0x83, 0x5f, 0x31, 0xc8, 0x3e, 0x65, 0x0,  0xe,  0x48, 0x17, 0xac,
                   0x2b, 0x9d, 0x64, 0x21, 0x56, 0x46, 0x83, 0x9d, 0x21, 0x19, 0xc9, 0x0,  0x12, 0xb3, 0x55, 0x2e,
                   0xe1, 0x69, 0xde, 0x16, 0x88, 0x62, 0x0,  0x77, 0x1,  0xbb, 0x31, 0x4d, 0x87, 0x70, 0x3a, 0x0,
                   0x13, 0x59, 0xbd, 0x3f, 0xae, 0xa,  0x51, 0x79, 0x4d, 0xa5, 0x2e, 0x22, 0x5,  0x8c, 0x5f, 0x5f,
                   0xc0, 0xfe, 0xbb, 0xe4, 0x0,  0xc,  0xef, 0xde, 0xe2, 0xb5, 0xb8, 0xd1, 0x85, 0xc7, 0x37, 0x4f,
                   0xfe, 0xaf, 0x0,  0xb,  0x4,  0xe5, 0x14, 0x2e, 0x58, 0x81, 0x81, 0x35, 0xcc, 0x3b, 0xe6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x7f, 0x94, 0xce, 0x4b, 0x88, 0x48, 0x78, 0xd8, 0x89, 0x89, 0x2a, 0xd1,
                                     0xf8, 0x2a, 0xba, 0x82, 0xa3, 0xce, 0x40, 0x1f, 0x25, 0xb3, 0x73};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe8, 0x30, 0x83, 0xf1, 0xdb, 0x61, 0x98, 0xcf, 0x56, 0xb9, 0xd5, 0x76, 0xba,
                                     0x5b, 0xa5, 0xbf, 0x14, 0x60, 0x4b, 0x90, 0xe4, 0xc2, 0x17, 0x56, 0x67, 0x57};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc3, 0xd3, 0xab, 0x63, 0xd8, 0xc,  0x12, 0xa5, 0x60,
                                     0xb7, 0x50, 0x6a, 0xe4, 0xd8, 0x7e, 0xee, 0x40};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x35, 0xea, 0x1f, 0xae, 0xb7, 0x24, 0xc4, 0x56, 0x10, 0xa8, 0xf7, 0xff};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x68, 0x37, 0xe0, 0x86, 0xfe, 0xe5, 0x1d,
                                     0x6e, 0x83, 0x5f, 0x31, 0xc8, 0x3e, 0x65};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x48, 0x17, 0xac, 0x2b, 0x9d, 0x64, 0x21,
                                     0x56, 0x46, 0x83, 0x9d, 0x21, 0x19, 0xc9};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb3, 0x55, 0x2e, 0xe1, 0x69, 0xde, 0x16, 0x88, 0x62,
                                     0x0,  0x77, 0x1,  0xbb, 0x31, 0x4d, 0x87, 0x70, 0x3a};
  lwmqtt_string_t topic_filter_s6 = {18, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x59, 0xbd, 0x3f, 0xae, 0xa,  0x51, 0x79, 0x4d, 0xa5, 0x2e,
                                     0x22, 0x5,  0x8c, 0x5f, 0x5f, 0xc0, 0xfe, 0xbb, 0xe4};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xef, 0xde, 0xe2, 0xb5, 0xb8, 0xd1, 0x85, 0xc7, 0x37, 0x4f, 0xfe, 0xaf};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x4, 0xe5, 0x14, 0x2e, 0x58, 0x81, 0x81, 0x35, 0xcc, 0x3b, 0xe6};
  lwmqtt_string_t topic_filter_s9 = {11, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22682, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24213 ["\253g\ETX\138\DLEW\170\231\214\133H\RS\206+f|@C\175*,\178\EM"] []
TEST(Unsubscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0xa2, 0x1b, 0x5e, 0x95, 0x0,  0x17, 0xfd, 0x67, 0x3,  0x8a, 0x10, 0x57, 0xaa, 0xe7, 0xd6,
                   0x85, 0x48, 0x1e, 0xce, 0x2b, 0x66, 0x7c, 0x40, 0x43, 0xaf, 0x2a, 0x2c, 0xb2, 0x19};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xfd, 0x67, 0x3,  0x8a, 0x10, 0x57, 0xaa, 0xe7, 0xd6, 0x85, 0x48, 0x1e,
                                     0xce, 0x2b, 0x66, 0x7c, 0x40, 0x43, 0xaf, 0x2a, 0x2c, 0xb2, 0x19};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24213, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26833 ["U\246\DEL\"\254\131\166\165\187}
// \200\GShm\235K\206G\207\253\148\237\168#\193","\250","\234\199f)*\128@\216\214'\215\213","\SO\NULF\227\255\SUBc\189X\168\213\213","\DC2Q\176m\\J","!f2>\204\138\CAN\NUL:\235\222"]
// []
TEST(Unsubscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0xa2, 0x52, 0x68, 0xd1, 0x0,  0x1a, 0x55, 0xf6, 0x7f, 0x22, 0xfe, 0x83, 0xa6, 0xa5, 0xbb, 0x7d, 0x20,
                   0xc8, 0x1d, 0x68, 0x6d, 0xeb, 0x4b, 0xce, 0x47, 0xcf, 0xfd, 0x94, 0xed, 0xa8, 0x23, 0xc1, 0x0,  0x1,
                   0xfa, 0x0,  0xc,  0xea, 0xc7, 0x66, 0x29, 0x2a, 0x80, 0x40, 0xd8, 0xd6, 0x27, 0xd7, 0xd5, 0x0,  0xc,
                   0xe,  0x0,  0x46, 0xe3, 0xff, 0x1a, 0x63, 0xbd, 0x58, 0xa8, 0xd5, 0xd5, 0x0,  0x6,  0x12, 0x51, 0xb0,
                   0x6d, 0x5c, 0x4a, 0x0,  0xb,  0x21, 0x66, 0x32, 0x3e, 0xcc, 0x8a, 0x18, 0x0,  0x3a, 0xeb, 0xde};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x55, 0xf6, 0x7f, 0x22, 0xfe, 0x83, 0xa6, 0xa5, 0xbb, 0x7d, 0x20, 0xc8, 0x1d,
                                     0x68, 0x6d, 0xeb, 0x4b, 0xce, 0x47, 0xcf, 0xfd, 0x94, 0xed, 0xa8, 0x23, 0xc1};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfa};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xea, 0xc7, 0x66, 0x29, 0x2a, 0x80, 0x40, 0xd8, 0xd6, 0x27, 0xd7, 0xd5};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe, 0x0, 0x46, 0xe3, 0xff, 0x1a, 0x63, 0xbd, 0x58, 0xa8, 0xd5, 0xd5};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0x51, 0xb0, 0x6d, 0x5c, 0x4a};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x21, 0x66, 0x32, 0x3e, 0xcc, 0x8a, 0x18, 0x0, 0x3a, 0xeb, 0xde};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26833, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24597 ["\t\134\178\219\159\249\235\250\187","\166)\230\184Y\252\r.B"] []
TEST(Unsubscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0xa2, 0x18, 0x60, 0x15, 0x0,  0x9,  0x9,  0x86, 0xb2, 0xdb, 0x9f, 0xf9, 0xeb,
                   0xfa, 0xbb, 0x0,  0x9,  0xa6, 0x29, 0xe6, 0xb8, 0x59, 0xfc, 0xd,  0x2e, 0x42};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x9, 0x86, 0xb2, 0xdb, 0x9f, 0xf9, 0xeb, 0xfa, 0xbb};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa6, 0x29, 0xe6, 0xb8, 0x59, 0xfc, 0xd, 0x2e, 0x42};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24597, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17778
// ["\136x\150\168\US\251\133\245\161\132","","\156","\b\158G{\v-Ms1\169\219\152\168\DC4\152\236\156\169\r
// L{\144]w<\161","^\n\242r\171T8\161Q\v\135\252\STX8r\191\232\164\NUL\USM\199\151|8G\166","y\b\179\128O\138\242\240@2\163\187~\137\EOT\212\&2\EOT\167\\}f\170:\169x\186~","\b4\215\223kA\248\252\v\173\218\f\217.\171O\210\199\&4\ETX\NULk\f7~\151\&5\142\USL","\223\248\DC3<\163N\164?\DC2%\ENQ\251\214\223\&4\239\&13_3\DEL\SYN*c\NUL\ETX","\215\DC1\218\DC1l\160\ESCV@L\v$\203\195","\221M\253c3\176\146Y\151\250\249^YYC\182n`\ENQg\203s\198\249\232"]
// []
TEST(Unsubscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0xa2, 0xd2, 0x1,  0x45, 0x72, 0x0,  0xa,  0x88, 0x78, 0x96, 0xa8, 0x1f, 0xfb, 0x85, 0xf5, 0xa1, 0x84,
                   0x0,  0x0,  0x0,  0x1,  0x9c, 0x0,  0x1b, 0x8,  0x9e, 0x47, 0x7b, 0xb,  0x2d, 0x4d, 0x73, 0x31, 0xa9,
                   0xdb, 0x98, 0xa8, 0x14, 0x98, 0xec, 0x9c, 0xa9, 0xd,  0x20, 0x4c, 0x7b, 0x90, 0x5d, 0x77, 0x3c, 0xa1,
                   0x0,  0x1b, 0x5e, 0xa,  0xf2, 0x72, 0xab, 0x54, 0x38, 0xa1, 0x51, 0xb,  0x87, 0xfc, 0x2,  0x38, 0x72,
                   0xbf, 0xe8, 0xa4, 0x0,  0x1f, 0x4d, 0xc7, 0x97, 0x7c, 0x38, 0x47, 0xa6, 0x0,  0x1c, 0x79, 0x8,  0xb3,
                   0x80, 0x4f, 0x8a, 0xf2, 0xf0, 0x40, 0x32, 0xa3, 0xbb, 0x7e, 0x89, 0x4,  0xd4, 0x32, 0x4,  0xa7, 0x5c,
                   0x7d, 0x66, 0xaa, 0x3a, 0xa9, 0x78, 0xba, 0x7e, 0x0,  0x1e, 0x8,  0x34, 0xd7, 0xdf, 0x6b, 0x41, 0xf8,
                   0xfc, 0xb,  0xad, 0xda, 0xc,  0xd9, 0x2e, 0xab, 0x4f, 0xd2, 0xc7, 0x34, 0x3,  0x0,  0x6b, 0xc,  0x37,
                   0x7e, 0x97, 0x35, 0x8e, 0x1f, 0x4c, 0x0,  0x1a, 0xdf, 0xf8, 0x13, 0x3c, 0xa3, 0x4e, 0xa4, 0x3f, 0x12,
                   0x25, 0x5,  0xfb, 0xd6, 0xdf, 0x34, 0xef, 0x31, 0x33, 0x5f, 0x33, 0x7f, 0x16, 0x2a, 0x63, 0x0,  0x3,
                   0x0,  0xe,  0xd7, 0x11, 0xda, 0x11, 0x6c, 0xa0, 0x1b, 0x56, 0x40, 0x4c, 0xb,  0x24, 0xcb, 0xc3, 0x0,
                   0x19, 0xdd, 0x4d, 0xfd, 0x63, 0x33, 0xb0, 0x92, 0x59, 0x97, 0xfa, 0xf9, 0x5e, 0x59, 0x59, 0x43, 0xb6,
                   0x6e, 0x60, 0x5,  0x67, 0xcb, 0x73, 0xc6, 0xf9, 0xe8};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x88, 0x78, 0x96, 0xa8, 0x1f, 0xfb, 0x85, 0xf5, 0xa1, 0x84};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9c};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8,  0x9e, 0x47, 0x7b, 0xb, 0x2d, 0x4d, 0x73, 0x31, 0xa9, 0xdb, 0x98, 0xa8, 0x14,
                                     0x98, 0xec, 0x9c, 0xa9, 0xd, 0x20, 0x4c, 0x7b, 0x90, 0x5d, 0x77, 0x3c, 0xa1};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5e, 0xa,  0xf2, 0x72, 0xab, 0x54, 0x38, 0xa1, 0x51, 0xb,  0x87, 0xfc, 0x2, 0x38,
                                     0x72, 0xbf, 0xe8, 0xa4, 0x0,  0x1f, 0x4d, 0xc7, 0x97, 0x7c, 0x38, 0x47, 0xa6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x79, 0x8,  0xb3, 0x80, 0x4f, 0x8a, 0xf2, 0xf0, 0x40, 0x32,
                                     0xa3, 0xbb, 0x7e, 0x89, 0x4,  0xd4, 0x32, 0x4,  0xa7, 0x5c,
                                     0x7d, 0x66, 0xaa, 0x3a, 0xa9, 0x78, 0xba, 0x7e};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8,  0x34, 0xd7, 0xdf, 0x6b, 0x41, 0xf8, 0xfc, 0xb,  0xad,
                                     0xda, 0xc,  0xd9, 0x2e, 0xab, 0x4f, 0xd2, 0xc7, 0x34, 0x3,
                                     0x0,  0x6b, 0xc,  0x37, 0x7e, 0x97, 0x35, 0x8e, 0x1f, 0x4c};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xdf, 0xf8, 0x13, 0x3c, 0xa3, 0x4e, 0xa4, 0x3f, 0x12, 0x25, 0x5,  0xfb, 0xd6,
                                     0xdf, 0x34, 0xef, 0x31, 0x33, 0x5f, 0x33, 0x7f, 0x16, 0x2a, 0x63, 0x0,  0x3};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd7, 0x11, 0xda, 0x11, 0x6c, 0xa0, 0x1b, 0x56, 0x40, 0x4c, 0xb, 0x24, 0xcb, 0xc3};
  lwmqtt_string_t topic_filter_s8 = {14, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xdd, 0x4d, 0xfd, 0x63, 0x33, 0xb0, 0x92, 0x59, 0x97, 0xfa, 0xf9, 0x5e, 0x59,
                                     0x59, 0x43, 0xb6, 0x6e, 0x60, 0x5,  0x67, 0xcb, 0x73, 0xc6, 0xf9, 0xe8};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17778, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 4976
// ["_\190\245~5\207\156\SOHtV\FSY\253Gq\220\&8R\"\148","\CAN\141\210\134\ETBEiWm\158\t}\150O\175\CANHzh\157]q\173BuK\182p","\SUB\156\FS\ENQo#V\174\SYN\EM\150\161\a\231S\236\217\251\185\142\186\216\132\DC1I\"\172=5","\200d\202\182\185\147","\196\172'","kx\GS\134,&\222\152\&0\US\188\202zs\141g\170\174\164\SUB\246\184Wd\135\237","\254\207M\NAK\202g\EOT\135\186\213.\229\222\152","=\137\241~\EOTl","&\"","6\239R\208\161@\FS\US\250\170`\SUB\155{"]
// []
TEST(Unsubscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0xa2, 0xaa, 0x1,  0x13, 0x70, 0x0,  0x14, 0x5f, 0xbe, 0xf5, 0x7e, 0x35, 0xcf, 0x9c, 0x1,  0x74,
                   0x56, 0x1c, 0x59, 0xfd, 0x47, 0x71, 0xdc, 0x38, 0x52, 0x22, 0x94, 0x0,  0x1c, 0x18, 0x8d, 0xd2,
                   0x86, 0x17, 0x45, 0x69, 0x57, 0x6d, 0x9e, 0x9,  0x7d, 0x96, 0x4f, 0xaf, 0x18, 0x48, 0x7a, 0x68,
                   0x9d, 0x5d, 0x71, 0xad, 0x42, 0x75, 0x4b, 0xb6, 0x70, 0x0,  0x1d, 0x1a, 0x9c, 0x1c, 0x5,  0x6f,
                   0x23, 0x56, 0xae, 0x16, 0x19, 0x96, 0xa1, 0x7,  0xe7, 0x53, 0xec, 0xd9, 0xfb, 0xb9, 0x8e, 0xba,
                   0xd8, 0x84, 0x11, 0x49, 0x22, 0xac, 0x3d, 0x35, 0x0,  0x6,  0xc8, 0x64, 0xca, 0xb6, 0xb9, 0x93,
                   0x0,  0x3,  0xc4, 0xac, 0x27, 0x0,  0x1a, 0x6b, 0x78, 0x1d, 0x86, 0x2c, 0x26, 0xde, 0x98, 0x30,
                   0x1f, 0xbc, 0xca, 0x7a, 0x73, 0x8d, 0x67, 0xaa, 0xae, 0xa4, 0x1a, 0xf6, 0xb8, 0x57, 0x64, 0x87,
                   0xed, 0x0,  0xe,  0xfe, 0xcf, 0x4d, 0x15, 0xca, 0x67, 0x4,  0x87, 0xba, 0xd5, 0x2e, 0xe5, 0xde,
                   0x98, 0x0,  0x6,  0x3d, 0x89, 0xf1, 0x7e, 0x4,  0x6c, 0x0,  0x2,  0x26, 0x22, 0x0,  0xe,  0x36,
                   0xef, 0x52, 0xd0, 0xa1, 0x40, 0x1c, 0x1f, 0xfa, 0xaa, 0x60, 0x1a, 0x9b, 0x7b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x5f, 0xbe, 0xf5, 0x7e, 0x35, 0xcf, 0x9c, 0x1,  0x74, 0x56,
                                     0x1c, 0x59, 0xfd, 0x47, 0x71, 0xdc, 0x38, 0x52, 0x22, 0x94};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x18, 0x8d, 0xd2, 0x86, 0x17, 0x45, 0x69, 0x57, 0x6d, 0x9e,
                                     0x9,  0x7d, 0x96, 0x4f, 0xaf, 0x18, 0x48, 0x7a, 0x68, 0x9d,
                                     0x5d, 0x71, 0xad, 0x42, 0x75, 0x4b, 0xb6, 0x70};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0x9c, 0x1c, 0x5,  0x6f, 0x23, 0x56, 0xae, 0x16, 0x19,
                                     0x96, 0xa1, 0x7,  0xe7, 0x53, 0xec, 0xd9, 0xfb, 0xb9, 0x8e,
                                     0xba, 0xd8, 0x84, 0x11, 0x49, 0x22, 0xac, 0x3d, 0x35};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc8, 0x64, 0xca, 0xb6, 0xb9, 0x93};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc4, 0xac, 0x27};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6b, 0x78, 0x1d, 0x86, 0x2c, 0x26, 0xde, 0x98, 0x30, 0x1f, 0xbc, 0xca, 0x7a,
                                     0x73, 0x8d, 0x67, 0xaa, 0xae, 0xa4, 0x1a, 0xf6, 0xb8, 0x57, 0x64, 0x87, 0xed};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfe, 0xcf, 0x4d, 0x15, 0xca, 0x67, 0x4, 0x87, 0xba, 0xd5, 0x2e, 0xe5, 0xde, 0x98};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x3d, 0x89, 0xf1, 0x7e, 0x4, 0x6c};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x26, 0x22};
  lwmqtt_string_t topic_filter_s8 = {2, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x36, 0xef, 0x52, 0xd0, 0xa1, 0x40, 0x1c,
                                     0x1f, 0xfa, 0xaa, 0x60, 0x1a, 0x9b, 0x7b};
  lwmqtt_string_t topic_filter_s9 = {14, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4976, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 12973
// ["\DC1As\216\DLE\214\246\194\220\178\DC3\NULON\198\226\147P\205\SO\129\&4\RS\DC3\206","\171\&0\204\160\CAN.\142\255
// \134\198\220\DEL@\163\216\&2\165\142\225\208","^\163\204\213TZ\"\SO","\136!\167=\170\214\"\232\ESC
// \216\174%\ENQ]\219\133}\226\235","J\182\bT\140Z","\188n\150\191L#\NAK\197\136\194[\192m\141\196\n\211\252","\195\157\173\ACKh\DEL\178\230\r","e(y\DC3\r|+\138\216\196*\227~\180\140DX\250\181\135#\214#;!\225\161\201","1\252\225\175\STX\172\236\SYN\176\&2\"\204\v\RS\b\189","\218\181\178\245x\187\245\167\&5\144\249L:\209\146"]
// []
TEST(Unsubscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0xa2, 0xbc, 0x1,  0x32, 0xad, 0x0,  0x19, 0x11, 0x41, 0x73, 0xd8, 0x10, 0xd6, 0xf6, 0xc2, 0xdc,
                   0xb2, 0x13, 0x0,  0x4f, 0x4e, 0xc6, 0xe2, 0x93, 0x50, 0xcd, 0xe,  0x81, 0x34, 0x1e, 0x13, 0xce,
                   0x0,  0x15, 0xab, 0x30, 0xcc, 0xa0, 0x18, 0x2e, 0x8e, 0xff, 0x20, 0x86, 0xc6, 0xdc, 0x7f, 0x40,
                   0xa3, 0xd8, 0x32, 0xa5, 0x8e, 0xe1, 0xd0, 0x0,  0x8,  0x5e, 0xa3, 0xcc, 0xd5, 0x54, 0x5a, 0x22,
                   0xe,  0x0,  0x14, 0x88, 0x21, 0xa7, 0x3d, 0xaa, 0xd6, 0x22, 0xe8, 0x1b, 0x20, 0xd8, 0xae, 0x25,
                   0x5,  0x5d, 0xdb, 0x85, 0x7d, 0xe2, 0xeb, 0x0,  0x6,  0x4a, 0xb6, 0x8,  0x54, 0x8c, 0x5a, 0x0,
                   0x12, 0xbc, 0x6e, 0x96, 0xbf, 0x4c, 0x23, 0x15, 0xc5, 0x88, 0xc2, 0x5b, 0xc0, 0x6d, 0x8d, 0xc4,
                   0xa,  0xd3, 0xfc, 0x0,  0x9,  0xc3, 0x9d, 0xad, 0x6,  0x68, 0x7f, 0xb2, 0xe6, 0xd,  0x0,  0x1c,
                   0x65, 0x28, 0x79, 0x13, 0xd,  0x7c, 0x2b, 0x8a, 0xd8, 0xc4, 0x2a, 0xe3, 0x7e, 0xb4, 0x8c, 0x44,
                   0x58, 0xfa, 0xb5, 0x87, 0x23, 0xd6, 0x23, 0x3b, 0x21, 0xe1, 0xa1, 0xc9, 0x0,  0x10, 0x31, 0xfc,
                   0xe1, 0xaf, 0x2,  0xac, 0xec, 0x16, 0xb0, 0x32, 0x22, 0xcc, 0xb,  0x1e, 0x8,  0xbd, 0x0,  0xf,
                   0xda, 0xb5, 0xb2, 0xf5, 0x78, 0xbb, 0xf5, 0xa7, 0x35, 0x90, 0xf9, 0x4c, 0x3a, 0xd1, 0x92};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x11, 0x41, 0x73, 0xd8, 0x10, 0xd6, 0xf6, 0xc2, 0xdc, 0xb2, 0x13, 0x0, 0x4f,
                                     0x4e, 0xc6, 0xe2, 0x93, 0x50, 0xcd, 0xe,  0x81, 0x34, 0x1e, 0x13, 0xce};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xab, 0x30, 0xcc, 0xa0, 0x18, 0x2e, 0x8e, 0xff, 0x20, 0x86, 0xc6,
                                     0xdc, 0x7f, 0x40, 0xa3, 0xd8, 0x32, 0xa5, 0x8e, 0xe1, 0xd0};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5e, 0xa3, 0xcc, 0xd5, 0x54, 0x5a, 0x22, 0xe};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x21, 0xa7, 0x3d, 0xaa, 0xd6, 0x22, 0xe8, 0x1b, 0x20,
                                     0xd8, 0xae, 0x25, 0x5,  0x5d, 0xdb, 0x85, 0x7d, 0xe2, 0xeb};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4a, 0xb6, 0x8, 0x54, 0x8c, 0x5a};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xbc, 0x6e, 0x96, 0xbf, 0x4c, 0x23, 0x15, 0xc5, 0x88,
                                     0xc2, 0x5b, 0xc0, 0x6d, 0x8d, 0xc4, 0xa,  0xd3, 0xfc};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc3, 0x9d, 0xad, 0x6, 0x68, 0x7f, 0xb2, 0xe6, 0xd};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x65, 0x28, 0x79, 0x13, 0xd,  0x7c, 0x2b, 0x8a, 0xd8, 0xc4,
                                     0x2a, 0xe3, 0x7e, 0xb4, 0x8c, 0x44, 0x58, 0xfa, 0xb5, 0x87,
                                     0x23, 0xd6, 0x23, 0x3b, 0x21, 0xe1, 0xa1, 0xc9};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x31, 0xfc, 0xe1, 0xaf, 0x2, 0xac, 0xec, 0x16,
                                     0xb0, 0x32, 0x22, 0xcc, 0xb, 0x1e, 0x8,  0xbd};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xda, 0xb5, 0xb2, 0xf5, 0x78, 0xbb, 0xf5, 0xa7,
                                     0x35, 0x90, 0xf9, 0x4c, 0x3a, 0xd1, 0x92};
  lwmqtt_string_t topic_filter_s9 = {15, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12973, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26764
// ["\228\129\194\154UZ\162#\ENQ\166y\194\131\134\146\CAN\249\179\195=\\H\131_\195\ACK","\157>\170,\252e\253\207?\202o\189\&8\149\170\251\138\173}\GS\224\ACK\181\156","\139O+\138\ESC$!\248\160\249K\171\161\214,l\r\191X\ETB*\160\246\a/","","\139\149j\246C\170\168\SI\n\151\SOH\219\243\RS\222\206k\199\ESC\SUB\DC2x(5:!D","\245x0\213\130\200\229\176\SUB$\SOH\ENQ\243\153\147\242\157\219\190","jv\130p\n\255\130\158\213\218O\SYN\194W\191\188","\210\132\229-R&\239\246\ESCe\194\US.\222\DC2&\135$\210YE\129","hM{7","\206N\242@%2\218\216\138\232\155\156\n\US\248z@\207\SYN\211\221\&8\164\239\155"]
// []
TEST(Unsubscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0xa2, 0xd2, 0x1,  0x68, 0x8c, 0x0,  0x1a, 0xe4, 0x81, 0xc2, 0x9a, 0x55, 0x5a, 0xa2, 0x23, 0x5,  0xa6,
                   0x79, 0xc2, 0x83, 0x86, 0x92, 0x18, 0xf9, 0xb3, 0xc3, 0x3d, 0x5c, 0x48, 0x83, 0x5f, 0xc3, 0x6,  0x0,
                   0x18, 0x9d, 0x3e, 0xaa, 0x2c, 0xfc, 0x65, 0xfd, 0xcf, 0x3f, 0xca, 0x6f, 0xbd, 0x38, 0x95, 0xaa, 0xfb,
                   0x8a, 0xad, 0x7d, 0x1d, 0xe0, 0x6,  0xb5, 0x9c, 0x0,  0x19, 0x8b, 0x4f, 0x2b, 0x8a, 0x1b, 0x24, 0x21,
                   0xf8, 0xa0, 0xf9, 0x4b, 0xab, 0xa1, 0xd6, 0x2c, 0x6c, 0xd,  0xbf, 0x58, 0x17, 0x2a, 0xa0, 0xf6, 0x7,
                   0x2f, 0x0,  0x0,  0x0,  0x1b, 0x8b, 0x95, 0x6a, 0xf6, 0x43, 0xaa, 0xa8, 0xf,  0xa,  0x97, 0x1,  0xdb,
                   0xf3, 0x1e, 0xde, 0xce, 0x6b, 0xc7, 0x1b, 0x1a, 0x12, 0x78, 0x28, 0x35, 0x3a, 0x21, 0x44, 0x0,  0x13,
                   0xf5, 0x78, 0x30, 0xd5, 0x82, 0xc8, 0xe5, 0xb0, 0x1a, 0x24, 0x1,  0x5,  0xf3, 0x99, 0x93, 0xf2, 0x9d,
                   0xdb, 0xbe, 0x0,  0x10, 0x6a, 0x76, 0x82, 0x70, 0xa,  0xff, 0x82, 0x9e, 0xd5, 0xda, 0x4f, 0x16, 0xc2,
                   0x57, 0xbf, 0xbc, 0x0,  0x16, 0xd2, 0x84, 0xe5, 0x2d, 0x52, 0x26, 0xef, 0xf6, 0x1b, 0x65, 0xc2, 0x1f,
                   0x2e, 0xde, 0x12, 0x26, 0x87, 0x24, 0xd2, 0x59, 0x45, 0x81, 0x0,  0x4,  0x68, 0x4d, 0x7b, 0x37, 0x0,
                   0x19, 0xce, 0x4e, 0xf2, 0x40, 0x25, 0x32, 0xda, 0xd8, 0x8a, 0xe8, 0x9b, 0x9c, 0xa,  0x1f, 0xf8, 0x7a,
                   0x40, 0xcf, 0x16, 0xd3, 0xdd, 0x38, 0xa4, 0xef, 0x9b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xe4, 0x81, 0xc2, 0x9a, 0x55, 0x5a, 0xa2, 0x23, 0x5,  0xa6, 0x79, 0xc2, 0x83,
                                     0x86, 0x92, 0x18, 0xf9, 0xb3, 0xc3, 0x3d, 0x5c, 0x48, 0x83, 0x5f, 0xc3, 0x6};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9d, 0x3e, 0xaa, 0x2c, 0xfc, 0x65, 0xfd, 0xcf, 0x3f, 0xca, 0x6f, 0xbd,
                                     0x38, 0x95, 0xaa, 0xfb, 0x8a, 0xad, 0x7d, 0x1d, 0xe0, 0x6,  0xb5, 0x9c};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8b, 0x4f, 0x2b, 0x8a, 0x1b, 0x24, 0x21, 0xf8, 0xa0, 0xf9, 0x4b, 0xab, 0xa1,
                                     0xd6, 0x2c, 0x6c, 0xd,  0xbf, 0x58, 0x17, 0x2a, 0xa0, 0xf6, 0x7,  0x2f};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8b, 0x95, 0x6a, 0xf6, 0x43, 0xaa, 0xa8, 0xf,  0xa,  0x97, 0x1,  0xdb, 0xf3, 0x1e,
                                     0xde, 0xce, 0x6b, 0xc7, 0x1b, 0x1a, 0x12, 0x78, 0x28, 0x35, 0x3a, 0x21, 0x44};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf5, 0x78, 0x30, 0xd5, 0x82, 0xc8, 0xe5, 0xb0, 0x1a, 0x24,
                                     0x1,  0x5,  0xf3, 0x99, 0x93, 0xf2, 0x9d, 0xdb, 0xbe};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6a, 0x76, 0x82, 0x70, 0xa,  0xff, 0x82, 0x9e,
                                     0xd5, 0xda, 0x4f, 0x16, 0xc2, 0x57, 0xbf, 0xbc};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd2, 0x84, 0xe5, 0x2d, 0x52, 0x26, 0xef, 0xf6, 0x1b, 0x65, 0xc2,
                                     0x1f, 0x2e, 0xde, 0x12, 0x26, 0x87, 0x24, 0xd2, 0x59, 0x45, 0x81};
  lwmqtt_string_t topic_filter_s7 = {22, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x68, 0x4d, 0x7b, 0x37};
  lwmqtt_string_t topic_filter_s8 = {4, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xce, 0x4e, 0xf2, 0x40, 0x25, 0x32, 0xda, 0xd8, 0x8a, 0xe8, 0x9b, 0x9c, 0xa,
                                     0x1f, 0xf8, 0x7a, 0x40, 0xcf, 0x16, 0xd3, 0xdd, 0x38, 0xa4, 0xef, 0x9b};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26764, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 25855
// ["*\148\DEL\172\179\158\a\ETX\SONJH`\204\245\213\178\t","","\132\212~\"a\157\185J\138:\200\142","\137\206\187\149\181\150l\210\253\178V\167\ESC\239@\GSD\231\139","\219\198\215\184]\249\ESC\146\186\ETB","K\140\254\EOT`\134\206\GS\195\219e\213\200\SIDy\239
// \164","\164\146\155I\172w\DC3b\DC4qa","1k\NAK\130\DLE\202\GS\191\239B\tL\162z\ETX\213l\194\143\&6\SYN\152/\154\219e\NAKi","\247k3\164\228?\NUL\158\201\136y\202\169\202"]
// []
TEST(Unsubscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0xa2, 0x97, 0x1,  0x64, 0xff, 0x0,  0x12, 0x2a, 0x94, 0x7f, 0xac, 0xb3, 0x9e, 0x7,  0x3,  0xe,
                   0x4e, 0x4a, 0x48, 0x60, 0xcc, 0xf5, 0xd5, 0xb2, 0x9,  0x0,  0x0,  0x0,  0xc,  0x84, 0xd4, 0x7e,
                   0x22, 0x61, 0x9d, 0xb9, 0x4a, 0x8a, 0x3a, 0xc8, 0x8e, 0x0,  0x13, 0x89, 0xce, 0xbb, 0x95, 0xb5,
                   0x96, 0x6c, 0xd2, 0xfd, 0xb2, 0x56, 0xa7, 0x1b, 0xef, 0x40, 0x1d, 0x44, 0xe7, 0x8b, 0x0,  0xa,
                   0xdb, 0xc6, 0xd7, 0xb8, 0x5d, 0xf9, 0x1b, 0x92, 0xba, 0x17, 0x0,  0x13, 0x4b, 0x8c, 0xfe, 0x4,
                   0x60, 0x86, 0xce, 0x1d, 0xc3, 0xdb, 0x65, 0xd5, 0xc8, 0xf,  0x44, 0x79, 0xef, 0x20, 0xa4, 0x0,
                   0xb,  0xa4, 0x92, 0x9b, 0x49, 0xac, 0x77, 0x13, 0x62, 0x14, 0x71, 0x61, 0x0,  0x1c, 0x31, 0x6b,
                   0x15, 0x82, 0x10, 0xca, 0x1d, 0xbf, 0xef, 0x42, 0x9,  0x4c, 0xa2, 0x7a, 0x3,  0xd5, 0x6c, 0xc2,
                   0x8f, 0x36, 0x16, 0x98, 0x2f, 0x9a, 0xdb, 0x65, 0x15, 0x69, 0x0,  0xe,  0xf7, 0x6b, 0x33, 0xa4,
                   0xe4, 0x3f, 0x0,  0x9e, 0xc9, 0x88, 0x79, 0xca, 0xa9, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x2a, 0x94, 0x7f, 0xac, 0xb3, 0x9e, 0x7,  0x3,  0xe,
                                     0x4e, 0x4a, 0x48, 0x60, 0xcc, 0xf5, 0xd5, 0xb2, 0x9};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0xd4, 0x7e, 0x22, 0x61, 0x9d, 0xb9, 0x4a, 0x8a, 0x3a, 0xc8, 0x8e};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x89, 0xce, 0xbb, 0x95, 0xb5, 0x96, 0x6c, 0xd2, 0xfd, 0xb2,
                                     0x56, 0xa7, 0x1b, 0xef, 0x40, 0x1d, 0x44, 0xe7, 0x8b};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xdb, 0xc6, 0xd7, 0xb8, 0x5d, 0xf9, 0x1b, 0x92, 0xba, 0x17};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4b, 0x8c, 0xfe, 0x4, 0x60, 0x86, 0xce, 0x1d, 0xc3, 0xdb,
                                     0x65, 0xd5, 0xc8, 0xf, 0x44, 0x79, 0xef, 0x20, 0xa4};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa4, 0x92, 0x9b, 0x49, 0xac, 0x77, 0x13, 0x62, 0x14, 0x71, 0x61};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x31, 0x6b, 0x15, 0x82, 0x10, 0xca, 0x1d, 0xbf, 0xef, 0x42,
                                     0x9,  0x4c, 0xa2, 0x7a, 0x3,  0xd5, 0x6c, 0xc2, 0x8f, 0x36,
                                     0x16, 0x98, 0x2f, 0x9a, 0xdb, 0x65, 0x15, 0x69};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xf7, 0x6b, 0x33, 0xa4, 0xe4, 0x3f, 0x0, 0x9e, 0xc9, 0x88, 0x79, 0xca, 0xa9, 0xca};
  lwmqtt_string_t topic_filter_s8 = {14, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 25855, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 20087 ["","\223$\157\133\154\STXu\172d\221\239W\239\v\142#\151b"] []
TEST(Unsubscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0xa2, 0x18, 0x4e, 0x77, 0x0,  0x0,  0x0,  0x12, 0xdf, 0x24, 0x9d, 0x85, 0x9a,
                   0x2,  0x75, 0xac, 0x64, 0xdd, 0xef, 0x57, 0xef, 0xb,  0x8e, 0x23, 0x97, 0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdf, 0x24, 0x9d, 0x85, 0x9a, 0x2,  0x75, 0xac, 0x64,
                                     0xdd, 0xef, 0x57, 0xef, 0xb,  0x8e, 0x23, 0x97, 0x62};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20087, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 23904
// ["\149\138G<\153B","\176\152\174\227C\212\140\237\176F\225\157","\250\193{\220\129\129\245u\242\229\214\GS\252\173y\184p\165*\244}\215","\ESCB3C\185\170*\235\146\140H11H\198\156\223\DEL\131\144\131\136\224s\209k\b\195\FS"]
// []
TEST(Unsubscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0xa2, 0x4f, 0x5d, 0x60, 0x0,  0x6,  0x95, 0x8a, 0x47, 0x3c, 0x99, 0x42, 0x0,  0xc,  0xb0, 0x98, 0xae,
                   0xe3, 0x43, 0xd4, 0x8c, 0xed, 0xb0, 0x46, 0xe1, 0x9d, 0x0,  0x16, 0xfa, 0xc1, 0x7b, 0xdc, 0x81, 0x81,
                   0xf5, 0x75, 0xf2, 0xe5, 0xd6, 0x1d, 0xfc, 0xad, 0x79, 0xb8, 0x70, 0xa5, 0x2a, 0xf4, 0x7d, 0xd7, 0x0,
                   0x1d, 0x1b, 0x42, 0x33, 0x43, 0xb9, 0xaa, 0x2a, 0xeb, 0x92, 0x8c, 0x48, 0x31, 0x31, 0x48, 0xc6, 0x9c,
                   0xdf, 0x7f, 0x83, 0x90, 0x83, 0x88, 0xe0, 0x73, 0xd1, 0x6b, 0x8,  0xc3, 0x1c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x95, 0x8a, 0x47, 0x3c, 0x99, 0x42};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb0, 0x98, 0xae, 0xe3, 0x43, 0xd4, 0x8c, 0xed, 0xb0, 0x46, 0xe1, 0x9d};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfa, 0xc1, 0x7b, 0xdc, 0x81, 0x81, 0xf5, 0x75, 0xf2, 0xe5, 0xd6,
                                     0x1d, 0xfc, 0xad, 0x79, 0xb8, 0x70, 0xa5, 0x2a, 0xf4, 0x7d, 0xd7};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1b, 0x42, 0x33, 0x43, 0xb9, 0xaa, 0x2a, 0xeb, 0x92, 0x8c,
                                     0x48, 0x31, 0x31, 0x48, 0xc6, 0x9c, 0xdf, 0x7f, 0x83, 0x90,
                                     0x83, 0x88, 0xe0, 0x73, 0xd1, 0x6b, 0x8,  0xc3, 0x1c};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23904, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 18211 ["RU\203\SOH\227Nbl11R~\206d\203\245\&9b\205\253","`\149\SUB<\b\128\137\250\185\176\EM\204"]
// []
TEST(Unsubscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0xa2, 0x26, 0x47, 0x23, 0x0,  0x14, 0x52, 0x55, 0xcb, 0x1,  0xe3, 0x4e, 0x62, 0x6c,
                   0x31, 0x31, 0x52, 0x7e, 0xce, 0x64, 0xcb, 0xf5, 0x39, 0x62, 0xcd, 0xfd, 0x0,  0xc,
                   0x60, 0x95, 0x1a, 0x3c, 0x8,  0x80, 0x89, 0xfa, 0xb9, 0xb0, 0x19, 0xcc};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x52, 0x55, 0xcb, 0x1,  0xe3, 0x4e, 0x62, 0x6c, 0x31, 0x31,
                                     0x52, 0x7e, 0xce, 0x64, 0xcb, 0xf5, 0x39, 0x62, 0xcd, 0xfd};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x60, 0x95, 0x1a, 0x3c, 0x8, 0x80, 0x89, 0xfa, 0xb9, 0xb0, 0x19, 0xcc};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18211, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 14225
// ["w9A\n=\f\239P\248iomV\246\230\219\f\234i\245,\136e","\200\&0&V\131\EM%\176\170R\209\166^<\170\200\220f\222\a\FSD",".2^.\242\r\198","\r\229\166\187f\244\188%\151\213W\198\150\a\f\201\245yH\193\137&9\246\209Ka\148\140\RS","\RSCb/b\143\151\172\STXL\167\129\186\142\252\160\218\NAK\155\134\EOT\191\247w","\206A\231S\173\254M9R\DC3\177$O\225d\222\175+\207\138FN\249\225\231\251"]
// []
TEST(Unsubscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0xa2, 0x92, 0x1,  0x37, 0x91, 0x0,  0x17, 0x77, 0x39, 0x41, 0xa,  0x3d, 0xc,  0xef, 0x50, 0xf8, 0x69,
                   0x6f, 0x6d, 0x56, 0xf6, 0xe6, 0xdb, 0xc,  0xea, 0x69, 0xf5, 0x2c, 0x88, 0x65, 0x0,  0x16, 0xc8, 0x30,
                   0x26, 0x56, 0x83, 0x19, 0x25, 0xb0, 0xaa, 0x52, 0xd1, 0xa6, 0x5e, 0x3c, 0xaa, 0xc8, 0xdc, 0x66, 0xde,
                   0x7,  0x1c, 0x44, 0x0,  0x7,  0x2e, 0x32, 0x5e, 0x2e, 0xf2, 0xd,  0xc6, 0x0,  0x1e, 0xd,  0xe5, 0xa6,
                   0xbb, 0x66, 0xf4, 0xbc, 0x25, 0x97, 0xd5, 0x57, 0xc6, 0x96, 0x7,  0xc,  0xc9, 0xf5, 0x79, 0x48, 0xc1,
                   0x89, 0x26, 0x39, 0xf6, 0xd1, 0x4b, 0x61, 0x94, 0x8c, 0x1e, 0x0,  0x18, 0x1e, 0x43, 0x62, 0x2f, 0x62,
                   0x8f, 0x97, 0xac, 0x2,  0x4c, 0xa7, 0x81, 0xba, 0x8e, 0xfc, 0xa0, 0xda, 0x15, 0x9b, 0x86, 0x4,  0xbf,
                   0xf7, 0x77, 0x0,  0x1a, 0xce, 0x41, 0xe7, 0x53, 0xad, 0xfe, 0x4d, 0x39, 0x52, 0x13, 0xb1, 0x24, 0x4f,
                   0xe1, 0x64, 0xde, 0xaf, 0x2b, 0xcf, 0x8a, 0x46, 0x4e, 0xf9, 0xe1, 0xe7, 0xfb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x77, 0x39, 0x41, 0xa,  0x3d, 0xc,  0xef, 0x50, 0xf8, 0x69, 0x6f, 0x6d,
                                     0x56, 0xf6, 0xe6, 0xdb, 0xc,  0xea, 0x69, 0xf5, 0x2c, 0x88, 0x65};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc8, 0x30, 0x26, 0x56, 0x83, 0x19, 0x25, 0xb0, 0xaa, 0x52, 0xd1,
                                     0xa6, 0x5e, 0x3c, 0xaa, 0xc8, 0xdc, 0x66, 0xde, 0x7,  0x1c, 0x44};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2e, 0x32, 0x5e, 0x2e, 0xf2, 0xd, 0xc6};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd,  0xe5, 0xa6, 0xbb, 0x66, 0xf4, 0xbc, 0x25, 0x97, 0xd5,
                                     0x57, 0xc6, 0x96, 0x7,  0xc,  0xc9, 0xf5, 0x79, 0x48, 0xc1,
                                     0x89, 0x26, 0x39, 0xf6, 0xd1, 0x4b, 0x61, 0x94, 0x8c, 0x1e};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1e, 0x43, 0x62, 0x2f, 0x62, 0x8f, 0x97, 0xac, 0x2, 0x4c, 0xa7, 0x81,
                                     0xba, 0x8e, 0xfc, 0xa0, 0xda, 0x15, 0x9b, 0x86, 0x4, 0xbf, 0xf7, 0x77};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xce, 0x41, 0xe7, 0x53, 0xad, 0xfe, 0x4d, 0x39, 0x52, 0x13, 0xb1, 0x24, 0x4f,
                                     0xe1, 0x64, 0xde, 0xaf, 0x2b, 0xcf, 0x8a, 0x46, 0x4e, 0xf9, 0xe1, 0xe7, 0xfb};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14225, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 19016
// ["Jg\224\251\204?\245=","\241\203b\228\136\148R&\163\232S\US\233R","\202g\168\178\ENQ;\ETB\131\t!4\227\199.E\251","+\200\171{ZW\DC4\ACK\170
// n\253\171=\157'_\155\tW\163\242\a\223","\224_L\250\174\189\ETB\170\156\243\NUL","#V\247\220\&3\202\129\146s\GS\244\149\158xi\231\149\242\DEL\148\172\159\210]\226\EMN","R\ACK\SOH9\148\244/","\153%\252\231\&9\254\131\161\180\161\151\"\239P!_\141T\EMsz\"0"]
// []
TEST(Unsubscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0xa2, 0x94, 0x1,  0x4a, 0x48, 0x0,  0x8,  0x4a, 0x67, 0xe0, 0xfb, 0xcc, 0x3f, 0xf5, 0x3d, 0x0,  0xe,
                   0xf1, 0xcb, 0x62, 0xe4, 0x88, 0x94, 0x52, 0x26, 0xa3, 0xe8, 0x53, 0x1f, 0xe9, 0x52, 0x0,  0x10, 0xca,
                   0x67, 0xa8, 0xb2, 0x5,  0x3b, 0x17, 0x83, 0x9,  0x21, 0x34, 0xe3, 0xc7, 0x2e, 0x45, 0xfb, 0x0,  0x18,
                   0x2b, 0xc8, 0xab, 0x7b, 0x5a, 0x57, 0x14, 0x6,  0xaa, 0x20, 0x6e, 0xfd, 0xab, 0x3d, 0x9d, 0x27, 0x5f,
                   0x9b, 0x9,  0x57, 0xa3, 0xf2, 0x7,  0xdf, 0x0,  0xb,  0xe0, 0x5f, 0x4c, 0xfa, 0xae, 0xbd, 0x17, 0xaa,
                   0x9c, 0xf3, 0x0,  0x0,  0x1b, 0x23, 0x56, 0xf7, 0xdc, 0x33, 0xca, 0x81, 0x92, 0x73, 0x1d, 0xf4, 0x95,
                   0x9e, 0x78, 0x69, 0xe7, 0x95, 0xf2, 0x7f, 0x94, 0xac, 0x9f, 0xd2, 0x5d, 0xe2, 0x19, 0x4e, 0x0,  0x7,
                   0x52, 0x6,  0x1,  0x39, 0x94, 0xf4, 0x2f, 0x0,  0x17, 0x99, 0x25, 0xfc, 0xe7, 0x39, 0xfe, 0x83, 0xa1,
                   0xb4, 0xa1, 0x97, 0x22, 0xef, 0x50, 0x21, 0x5f, 0x8d, 0x54, 0x19, 0x73, 0x7a, 0x22, 0x30};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x4a, 0x67, 0xe0, 0xfb, 0xcc, 0x3f, 0xf5, 0x3d};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf1, 0xcb, 0x62, 0xe4, 0x88, 0x94, 0x52,
                                     0x26, 0xa3, 0xe8, 0x53, 0x1f, 0xe9, 0x52};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xca, 0x67, 0xa8, 0xb2, 0x5,  0x3b, 0x17, 0x83,
                                     0x9,  0x21, 0x34, 0xe3, 0xc7, 0x2e, 0x45, 0xfb};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0xc8, 0xab, 0x7b, 0x5a, 0x57, 0x14, 0x6,  0xaa, 0x20, 0x6e, 0xfd,
                                     0xab, 0x3d, 0x9d, 0x27, 0x5f, 0x9b, 0x9,  0x57, 0xa3, 0xf2, 0x7,  0xdf};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe0, 0x5f, 0x4c, 0xfa, 0xae, 0xbd, 0x17, 0xaa, 0x9c, 0xf3, 0x0};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x23, 0x56, 0xf7, 0xdc, 0x33, 0xca, 0x81, 0x92, 0x73, 0x1d, 0xf4, 0x95, 0x9e, 0x78,
                                     0x69, 0xe7, 0x95, 0xf2, 0x7f, 0x94, 0xac, 0x9f, 0xd2, 0x5d, 0xe2, 0x19, 0x4e};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x52, 0x6, 0x1, 0x39, 0x94, 0xf4, 0x2f};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x99, 0x25, 0xfc, 0xe7, 0x39, 0xfe, 0x83, 0xa1, 0xb4, 0xa1, 0x97, 0x22,
                                     0xef, 0x50, 0x21, 0x5f, 0x8d, 0x54, 0x19, 0x73, 0x7a, 0x22, 0x30};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19016, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24261
// ["/\168j\253\190Jy7\185~F\236J","S\225\251?H\DC1\249\DC3\ETX\182\155[\CAN","}\EOT\136\245\&6b\203\202","9\222\252{E\t\SYNK5\162El\EOTA\171\&4\152\ESC","w\157\&9N\nW\242K\NUL\150a\166~\196\168\226\187\DEL\tU\186\218f\168","l\194\247\SOB\246P/\139","?fa\190\246c\DC2|/\206\SO\149\246\149Ar\153\174\EM\168\SOH\150\163\175\&3\236\191\ENQ\f\158","R$\140\171\234d\136\145\221\151\US8|3\254","\DLE\SI_\219/\178\128k\149\188\203\130J%\245\200P","\186\237'\227\&6\220\179\227\170\228\SOH?=\GS\DC3\224\204\166\tj\ESC|-s;\179",""]
// []
TEST(Unsubscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0xa2, 0xc5, 0x1,  0x5e, 0xc5, 0x0,  0xd,  0x2f, 0xa8, 0x6a, 0xfd, 0xbe, 0x4a, 0x79, 0x37, 0xb9, 0x7e,
                   0x46, 0xec, 0x4a, 0x0,  0xd,  0x53, 0xe1, 0xfb, 0x3f, 0x48, 0x11, 0xf9, 0x13, 0x3,  0xb6, 0x9b, 0x5b,
                   0x18, 0x0,  0x8,  0x7d, 0x4,  0x88, 0xf5, 0x36, 0x62, 0xcb, 0xca, 0x0,  0x12, 0x39, 0xde, 0xfc, 0x7b,
                   0x45, 0x9,  0x16, 0x4b, 0x35, 0xa2, 0x45, 0x6c, 0x4,  0x41, 0xab, 0x34, 0x98, 0x1b, 0x0,  0x18, 0x77,
                   0x9d, 0x39, 0x4e, 0xa,  0x57, 0xf2, 0x4b, 0x0,  0x96, 0x61, 0xa6, 0x7e, 0xc4, 0xa8, 0xe2, 0xbb, 0x7f,
                   0x9,  0x55, 0xba, 0xda, 0x66, 0xa8, 0x0,  0x9,  0x6c, 0xc2, 0xf7, 0xe,  0x42, 0xf6, 0x50, 0x2f, 0x8b,
                   0x0,  0x1e, 0x3f, 0x66, 0x61, 0xbe, 0xf6, 0x63, 0x12, 0x7c, 0x2f, 0xce, 0xe,  0x95, 0xf6, 0x95, 0x41,
                   0x72, 0x99, 0xae, 0x19, 0xa8, 0x1,  0x96, 0xa3, 0xaf, 0x33, 0xec, 0xbf, 0x5,  0xc,  0x9e, 0x0,  0xf,
                   0x52, 0x24, 0x8c, 0xab, 0xea, 0x64, 0x88, 0x91, 0xdd, 0x97, 0x1f, 0x38, 0x7c, 0x33, 0xfe, 0x0,  0x11,
                   0x10, 0xf,  0x5f, 0xdb, 0x2f, 0xb2, 0x80, 0x6b, 0x95, 0xbc, 0xcb, 0x82, 0x4a, 0x25, 0xf5, 0xc8, 0x50,
                   0x0,  0x1a, 0xba, 0xed, 0x27, 0xe3, 0x36, 0xdc, 0xb3, 0xe3, 0xaa, 0xe4, 0x1,  0x3f, 0x3d, 0x1d, 0x13,
                   0xe0, 0xcc, 0xa6, 0x9,  0x6a, 0x1b, 0x7c, 0x2d, 0x73, 0x3b, 0xb3, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x2f, 0xa8, 0x6a, 0xfd, 0xbe, 0x4a, 0x79, 0x37, 0xb9, 0x7e, 0x46, 0xec, 0x4a};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x53, 0xe1, 0xfb, 0x3f, 0x48, 0x11, 0xf9, 0x13, 0x3, 0xb6, 0x9b, 0x5b, 0x18};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7d, 0x4, 0x88, 0xf5, 0x36, 0x62, 0xcb, 0xca};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x39, 0xde, 0xfc, 0x7b, 0x45, 0x9,  0x16, 0x4b, 0x35,
                                     0xa2, 0x45, 0x6c, 0x4,  0x41, 0xab, 0x34, 0x98, 0x1b};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x77, 0x9d, 0x39, 0x4e, 0xa,  0x57, 0xf2, 0x4b, 0x0,  0x96, 0x61, 0xa6,
                                     0x7e, 0xc4, 0xa8, 0xe2, 0xbb, 0x7f, 0x9,  0x55, 0xba, 0xda, 0x66, 0xa8};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6c, 0xc2, 0xf7, 0xe, 0x42, 0xf6, 0x50, 0x2f, 0x8b};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3f, 0x66, 0x61, 0xbe, 0xf6, 0x63, 0x12, 0x7c, 0x2f, 0xce,
                                     0xe,  0x95, 0xf6, 0x95, 0x41, 0x72, 0x99, 0xae, 0x19, 0xa8,
                                     0x1,  0x96, 0xa3, 0xaf, 0x33, 0xec, 0xbf, 0x5,  0xc,  0x9e};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x52, 0x24, 0x8c, 0xab, 0xea, 0x64, 0x88, 0x91,
                                     0xdd, 0x97, 0x1f, 0x38, 0x7c, 0x33, 0xfe};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x10, 0xf,  0x5f, 0xdb, 0x2f, 0xb2, 0x80, 0x6b, 0x95,
                                     0xbc, 0xcb, 0x82, 0x4a, 0x25, 0xf5, 0xc8, 0x50};
  lwmqtt_string_t topic_filter_s8 = {17, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xba, 0xed, 0x27, 0xe3, 0x36, 0xdc, 0xb3, 0xe3, 0xaa, 0xe4, 0x1,  0x3f, 0x3d,
                                     0x1d, 0x13, 0xe0, 0xcc, 0xa6, 0x9,  0x6a, 0x1b, 0x7c, 0x2d, 0x73, 0x3b, 0xb3};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24261, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28335
// ["\131\a\246\226.","-\229QI\184\222\GSz\140","D","","\162\135\151\128\210\134PrL7\213\215\215\238\242\140I\221\230\189b\149\SYN\136\145\&9.\204\r","{\242M\ESCHt\210\SUBS\192\165\128\&00$\247\150y`0\227\181\237\ENQ_\199\253\230","\129\196S\189\178*\221\152}\246\130z\235sE\131\216v\ESC\188prdC\249d"]
// []
TEST(Unsubscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0xa2, 0x72, 0x6e, 0xaf, 0x0,  0x5,  0x83, 0x7,  0xf6, 0xe2, 0x2e, 0x0,  0x9,  0x2d, 0xe5, 0x51, 0x49,
                   0xb8, 0xde, 0x1d, 0x7a, 0x8c, 0x0,  0x1,  0x44, 0x0,  0x0,  0x0,  0x1d, 0xa2, 0x87, 0x97, 0x80, 0xd2,
                   0x86, 0x50, 0x72, 0x4c, 0x37, 0xd5, 0xd7, 0xd7, 0xee, 0xf2, 0x8c, 0x49, 0xdd, 0xe6, 0xbd, 0x62, 0x95,
                   0x16, 0x88, 0x91, 0x39, 0x2e, 0xcc, 0xd,  0x0,  0x1c, 0x7b, 0xf2, 0x4d, 0x1b, 0x48, 0x74, 0xd2, 0x1a,
                   0x53, 0xc0, 0xa5, 0x80, 0x30, 0x30, 0x24, 0xf7, 0x96, 0x79, 0x60, 0x30, 0xe3, 0xb5, 0xed, 0x5,  0x5f,
                   0xc7, 0xfd, 0xe6, 0x0,  0x1a, 0x81, 0xc4, 0x53, 0xbd, 0xb2, 0x2a, 0xdd, 0x98, 0x7d, 0xf6, 0x82, 0x7a,
                   0xeb, 0x73, 0x45, 0x83, 0xd8, 0x76, 0x1b, 0xbc, 0x70, 0x72, 0x64, 0x43, 0xf9, 0x64};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x83, 0x7, 0xf6, 0xe2, 0x2e};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d, 0xe5, 0x51, 0x49, 0xb8, 0xde, 0x1d, 0x7a, 0x8c};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x44};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa2, 0x87, 0x97, 0x80, 0xd2, 0x86, 0x50, 0x72, 0x4c, 0x37,
                                     0xd5, 0xd7, 0xd7, 0xee, 0xf2, 0x8c, 0x49, 0xdd, 0xe6, 0xbd,
                                     0x62, 0x95, 0x16, 0x88, 0x91, 0x39, 0x2e, 0xcc, 0xd};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7b, 0xf2, 0x4d, 0x1b, 0x48, 0x74, 0xd2, 0x1a, 0x53, 0xc0,
                                     0xa5, 0x80, 0x30, 0x30, 0x24, 0xf7, 0x96, 0x79, 0x60, 0x30,
                                     0xe3, 0xb5, 0xed, 0x5,  0x5f, 0xc7, 0xfd, 0xe6};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x81, 0xc4, 0x53, 0xbd, 0xb2, 0x2a, 0xdd, 0x98, 0x7d, 0xf6, 0x82, 0x7a, 0xeb,
                                     0x73, 0x45, 0x83, 0xd8, 0x76, 0x1b, 0xbc, 0x70, 0x72, 0x64, 0x43, 0xf9, 0x64};
  lwmqtt_string_t topic_filter_s6 = {26, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28335, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24378 ["\214\DC35\253\159\129F#\236\204y?\150\128\DC2u\230\211
// O\133\185\r\135\163\177","\225\161,\196C\187\132IH\245\164\210!e\185\145e\139\243\181X8\n\242\182\204\151^\228","{\SUBC\158","\252\142\163gsP\ACK\133\234LY\203\&8\183\251\223\147\128\249","G}\173\207o\181\247\NULk\180\255\243\157o\SOH\199\NAKxD6","\220\ACK\170\&3)c\200`\251o\158"]
// [PropSharedSubscriptionAvailable 212,PropMaximumQoS 50,PropSharedSubscriptionAvailable 163,PropServerReference
// "\182\250",PropTopicAliasMaximum 21621,PropTopicAliasMaximum 5299,PropSharedSubscriptionAvailable
// 40,PropSubscriptionIdentifierAvailable 20,PropAssignedClientIdentifier "\221I\r\179\165\139lK\170\229\183H\241u"]
TEST(Unsubscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0xa2, 0xa2, 0x1,  0x5f, 0x3a, 0x26, 0x2a, 0xd4, 0x24, 0x32, 0x2a, 0xa3, 0x1c, 0x0,  0x2,  0xb6, 0xfa,
                   0x22, 0x54, 0x75, 0x22, 0x14, 0xb3, 0x2a, 0x28, 0x29, 0x14, 0x12, 0x0,  0xe,  0xdd, 0x49, 0xd,  0xb3,
                   0xa5, 0x8b, 0x6c, 0x4b, 0xaa, 0xe5, 0xb7, 0x48, 0xf1, 0x75, 0x0,  0x1a, 0xd6, 0x13, 0x35, 0xfd, 0x9f,
                   0x81, 0x46, 0x23, 0xec, 0xcc, 0x79, 0x3f, 0x96, 0x80, 0x12, 0x75, 0xe6, 0xd3, 0x20, 0x4f, 0x85, 0xb9,
                   0xd,  0x87, 0xa3, 0xb1, 0x0,  0x1d, 0xe1, 0xa1, 0x2c, 0xc4, 0x43, 0xbb, 0x84, 0x49, 0x48, 0xf5, 0xa4,
                   0xd2, 0x21, 0x65, 0xb9, 0x91, 0x65, 0x8b, 0xf3, 0xb5, 0x58, 0x38, 0xa,  0xf2, 0xb6, 0xcc, 0x97, 0x5e,
                   0xe4, 0x0,  0x4,  0x7b, 0x1a, 0x43, 0x9e, 0x0,  0x13, 0xfc, 0x8e, 0xa3, 0x67, 0x73, 0x50, 0x6,  0x85,
                   0xea, 0x4c, 0x59, 0xcb, 0x38, 0xb7, 0xfb, 0xdf, 0x93, 0x80, 0xf9, 0x0,  0x14, 0x47, 0x7d, 0xad, 0xcf,
                   0x6f, 0xb5, 0xf7, 0x0,  0x6b, 0xb4, 0xff, 0xf3, 0x9d, 0x6f, 0x1,  0xc7, 0x15, 0x78, 0x44, 0x36, 0x0,
                   0xb,  0xdc, 0x6,  0xaa, 0x33, 0x29, 0x63, 0xc8, 0x60, 0xfb, 0x6f, 0x9e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb6, 0xfa};
  uint8_t bytesprops1[] = {0xdd, 0x49, 0xd, 0xb3, 0xa5, 0x8b, 0x6c, 0x4b, 0xaa, 0xe5, 0xb7, 0x48, 0xf1, 0x75};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21621}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5299}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0xd6, 0x13, 0x35, 0xfd, 0x9f, 0x81, 0x46, 0x23, 0xec, 0xcc, 0x79, 0x3f, 0x96,
                                     0x80, 0x12, 0x75, 0xe6, 0xd3, 0x20, 0x4f, 0x85, 0xb9, 0xd,  0x87, 0xa3, 0xb1};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe1, 0xa1, 0x2c, 0xc4, 0x43, 0xbb, 0x84, 0x49, 0x48, 0xf5,
                                     0xa4, 0xd2, 0x21, 0x65, 0xb9, 0x91, 0x65, 0x8b, 0xf3, 0xb5,
                                     0x58, 0x38, 0xa,  0xf2, 0xb6, 0xcc, 0x97, 0x5e, 0xe4};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7b, 0x1a, 0x43, 0x9e};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfc, 0x8e, 0xa3, 0x67, 0x73, 0x50, 0x6,  0x85, 0xea, 0x4c,
                                     0x59, 0xcb, 0x38, 0xb7, 0xfb, 0xdf, 0x93, 0x80, 0xf9};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x47, 0x7d, 0xad, 0xcf, 0x6f, 0xb5, 0xf7, 0x0,  0x6b, 0xb4,
                                     0xff, 0xf3, 0x9d, 0x6f, 0x1,  0xc7, 0x15, 0x78, 0x44, 0x36};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xdc, 0x6, 0xaa, 0x33, 0x29, 0x63, 0xc8, 0x60, 0xfb, 0x6f, 0x9e};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24378, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 2051
// ["","\193\252\EOT\NAK\244\187T\"A\224\181\EOT\232\248Q\175[\132*\231\160\&9cK\158\209wc1","A3\151\238\144\145\195:\165\&6R\SUB\239\198ypa\225\254\219\245\ETB\225\222e\GS","Q\EM\157\DC2\249\155h\249\139\&89)\243$\186u\190\135t\141\240\&7\164\246","\SUBTW","\132\180L","\212R\181Q4A7m,\SO\SYN\232I\181\207/<S?\252\141<\DELb\231","\NAK\224\rj\137\SOHk4\184\203\169M/\156)\189
// or\v\143\185\215\190\250_\186","\139\218\194\199H9\189","u\178\168\DLE%\214\158\227%\194\as\193y\DLEw)!","\154\225/\145\ETB"]
// [PropCorrelationData "Z\DLE|\227\n~\ACK\US9;\143xJ\211\DLEK\DEL",PropWillDelayInterval 32129,PropWillDelayInterval
// 20228]
TEST(Unsubscribe5QCTest, Encode2) {
  uint8_t pkt[] = {
      0xa2, 0xde, 0x1,  0x8,  0x3,  0x1e, 0x9,  0x0,  0x11, 0x5a, 0x10, 0x7c, 0xe3, 0xa,  0x7e, 0x6,  0x1f, 0x39, 0x3b,
      0x8f, 0x78, 0x4a, 0xd3, 0x10, 0x4b, 0x7f, 0x18, 0x0,  0x0,  0x7d, 0x81, 0x18, 0x0,  0x0,  0x4f, 0x4,  0x0,  0x0,
      0x0,  0x1d, 0xc1, 0xfc, 0x4,  0x15, 0xf4, 0xbb, 0x54, 0x22, 0x41, 0xe0, 0xb5, 0x4,  0xe8, 0xf8, 0x51, 0xaf, 0x5b,
      0x84, 0x2a, 0xe7, 0xa0, 0x39, 0x63, 0x4b, 0x9e, 0xd1, 0x77, 0x63, 0x31, 0x0,  0x1a, 0x41, 0x33, 0x97, 0xee, 0x90,
      0x91, 0xc3, 0x3a, 0xa5, 0x36, 0x52, 0x1a, 0xef, 0xc6, 0x79, 0x70, 0x61, 0xe1, 0xfe, 0xdb, 0xf5, 0x17, 0xe1, 0xde,
      0x65, 0x1d, 0x0,  0x18, 0x51, 0x19, 0x9d, 0x12, 0xf9, 0x9b, 0x68, 0xf9, 0x8b, 0x38, 0x39, 0x29, 0xf3, 0x24, 0xba,
      0x75, 0xbe, 0x87, 0x74, 0x8d, 0xf0, 0x37, 0xa4, 0xf6, 0x0,  0x3,  0x1a, 0x54, 0x57, 0x0,  0x3,  0x84, 0xb4, 0x4c,
      0x0,  0x19, 0xd4, 0x52, 0xb5, 0x51, 0x34, 0x41, 0x37, 0x6d, 0x2c, 0xe,  0x16, 0xe8, 0x49, 0xb5, 0xcf, 0x2f, 0x3c,
      0x53, 0x3f, 0xfc, 0x8d, 0x3c, 0x7f, 0x62, 0xe7, 0x0,  0x1b, 0x15, 0xe0, 0xd,  0x6a, 0x89, 0x1,  0x6b, 0x34, 0xb8,
      0xcb, 0xa9, 0x4d, 0x2f, 0x9c, 0x29, 0xbd, 0x20, 0x6f, 0x72, 0xb,  0x8f, 0xb9, 0xd7, 0xbe, 0xfa, 0x5f, 0xba, 0x0,
      0x7,  0x8b, 0xda, 0xc2, 0xc7, 0x48, 0x39, 0xbd, 0x0,  0x12, 0x75, 0xb2, 0xa8, 0x10, 0x25, 0xd6, 0x9e, 0xe3, 0x25,
      0xc2, 0x7,  0x73, 0xc1, 0x79, 0x10, 0x77, 0x29, 0x21, 0x0,  0x5,  0x9a, 0xe1, 0x2f, 0x91, 0x17};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5a, 0x10, 0x7c, 0xe3, 0xa,  0x7e, 0x6,  0x1f, 0x39,
                           0x3b, 0x8f, 0x78, 0x4a, 0xd3, 0x10, 0x4b, 0x7f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32129}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20228}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc1, 0xfc, 0x4,  0x15, 0xf4, 0xbb, 0x54, 0x22, 0x41, 0xe0,
                                     0xb5, 0x4,  0xe8, 0xf8, 0x51, 0xaf, 0x5b, 0x84, 0x2a, 0xe7,
                                     0xa0, 0x39, 0x63, 0x4b, 0x9e, 0xd1, 0x77, 0x63, 0x31};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x41, 0x33, 0x97, 0xee, 0x90, 0x91, 0xc3, 0x3a, 0xa5, 0x36, 0x52, 0x1a, 0xef,
                                     0xc6, 0x79, 0x70, 0x61, 0xe1, 0xfe, 0xdb, 0xf5, 0x17, 0xe1, 0xde, 0x65, 0x1d};
  lwmqtt_string_t topic_filter_s2 = {26, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x51, 0x19, 0x9d, 0x12, 0xf9, 0x9b, 0x68, 0xf9, 0x8b, 0x38, 0x39, 0x29,
                                     0xf3, 0x24, 0xba, 0x75, 0xbe, 0x87, 0x74, 0x8d, 0xf0, 0x37, 0xa4, 0xf6};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1a, 0x54, 0x57};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x84, 0xb4, 0x4c};
  lwmqtt_string_t topic_filter_s5 = {3, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xd4, 0x52, 0xb5, 0x51, 0x34, 0x41, 0x37, 0x6d, 0x2c, 0xe,  0x16, 0xe8, 0x49,
                                     0xb5, 0xcf, 0x2f, 0x3c, 0x53, 0x3f, 0xfc, 0x8d, 0x3c, 0x7f, 0x62, 0xe7};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x15, 0xe0, 0xd,  0x6a, 0x89, 0x1, 0x6b, 0x34, 0xb8, 0xcb, 0xa9, 0x4d, 0x2f, 0x9c,
                                     0x29, 0xbd, 0x20, 0x6f, 0x72, 0xb, 0x8f, 0xb9, 0xd7, 0xbe, 0xfa, 0x5f, 0xba};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x8b, 0xda, 0xc2, 0xc7, 0x48, 0x39, 0xbd};
  lwmqtt_string_t topic_filter_s8 = {7, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x75, 0xb2, 0xa8, 0x10, 0x25, 0xd6, 0x9e, 0xe3, 0x25,
                                     0xc2, 0x7,  0x73, 0xc1, 0x79, 0x10, 0x77, 0x29, 0x21};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x9a, 0xe1, 0x2f, 0x91, 0x17};
  lwmqtt_string_t topic_filter_s10 = {5, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2051, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 16794
// ["\180g51\142\172",";.#\179\155.\222\244?\199\164\178\134\191\231,6\b;\197C\DC1x\EOTr\131i\173E\181","S\130\144\228\GS\188\147`5\143\243\246\ETB\153R\130\240\213","*\225\\\234\184\136\150J\221\157"]
// [PropAuthenticationMethod
// "\199\192\241\&5\152c^\130\176\RS.\146\218\&9\151\NUL\FS\130\195X\215\208\155\SYN\143",PropSharedSubscriptionAvailable
// 42,PropCorrelationData "][D\r\bS\180\245\NAK\CANy\240\ESCs\179\146u\237\ETXD\128:\221",PropMessageExpiryInterval
// 25781,PropTopicAliasMaximum 29124,PropTopicAliasMaximum 15771]
TEST(Unsubscribe5QCTest, Encode3) {
  uint8_t pkt[] = {0xa2, 0x8e, 0x1,  0x41, 0x9a, 0x43, 0x15, 0x0,  0x19, 0xc7, 0xc0, 0xf1, 0x35, 0x98, 0x63, 0x5e, 0x82,
                   0xb0, 0x1e, 0x2e, 0x92, 0xda, 0x39, 0x97, 0x0,  0x1c, 0x82, 0xc3, 0x58, 0xd7, 0xd0, 0x9b, 0x16, 0x8f,
                   0x2a, 0x2a, 0x9,  0x0,  0x17, 0x5d, 0x5b, 0x44, 0xd,  0x8,  0x53, 0xb4, 0xf5, 0x15, 0x18, 0x79, 0xf0,
                   0x1b, 0x73, 0xb3, 0x92, 0x75, 0xed, 0x3,  0x44, 0x80, 0x3a, 0xdd, 0x2,  0x0,  0x0,  0x64, 0xb5, 0x22,
                   0x71, 0xc4, 0x22, 0x3d, 0x9b, 0x0,  0x6,  0xb4, 0x67, 0x35, 0x31, 0x8e, 0xac, 0x0,  0x1e, 0x3b, 0x2e,
                   0x23, 0xb3, 0x9b, 0x2e, 0xde, 0xf4, 0x3f, 0xc7, 0xa4, 0xb2, 0x86, 0xbf, 0xe7, 0x2c, 0x36, 0x8,  0x3b,
                   0xc5, 0x43, 0x11, 0x78, 0x4,  0x72, 0x83, 0x69, 0xad, 0x45, 0xb5, 0x0,  0x12, 0x53, 0x82, 0x90, 0xe4,
                   0x1d, 0xbc, 0x93, 0x60, 0x35, 0x8f, 0xf3, 0xf6, 0x17, 0x99, 0x52, 0x82, 0xf0, 0xd5, 0x0,  0xa,  0x2a,
                   0xe1, 0x5c, 0xea, 0xb8, 0x88, 0x96, 0x4a, 0xdd, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc7, 0xc0, 0xf1, 0x35, 0x98, 0x63, 0x5e, 0x82, 0xb0, 0x1e, 0x2e, 0x92, 0xda,
                           0x39, 0x97, 0x0,  0x1c, 0x82, 0xc3, 0x58, 0xd7, 0xd0, 0x9b, 0x16, 0x8f};
  uint8_t bytesprops1[] = {0x5d, 0x5b, 0x44, 0xd,  0x8,  0x53, 0xb4, 0xf5, 0x15, 0x18, 0x79, 0xf0,
                           0x1b, 0x73, 0xb3, 0x92, 0x75, 0xed, 0x3,  0x44, 0x80, 0x3a, 0xdd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25781}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29124}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15771}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xb4, 0x67, 0x35, 0x31, 0x8e, 0xac};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3b, 0x2e, 0x23, 0xb3, 0x9b, 0x2e, 0xde, 0xf4, 0x3f, 0xc7,
                                     0xa4, 0xb2, 0x86, 0xbf, 0xe7, 0x2c, 0x36, 0x8,  0x3b, 0xc5,
                                     0x43, 0x11, 0x78, 0x4,  0x72, 0x83, 0x69, 0xad, 0x45, 0xb5};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x53, 0x82, 0x90, 0xe4, 0x1d, 0xbc, 0x93, 0x60, 0x35,
                                     0x8f, 0xf3, 0xf6, 0x17, 0x99, 0x52, 0x82, 0xf0, 0xd5};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2a, 0xe1, 0x5c, 0xea, 0xb8, 0x88, 0x96, 0x4a, 0xdd, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 16794, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 15779
// ["q\143\179\SUB\203\191\213\177]\DC1\148S\175\ESC\200C5\NAK\246\167r\152\198\254\ETXI","jv\241\208\SUB\210","\183\192\222;F\253\246vU\179\SIO\222","\150T\145\198J\tp\138\137'\ESC\157"]
// [PropTopicAlias 20522,PropCorrelationData "\128\138\241\234\135\208\f\231\197\205",PropAssignedClientIdentifier
// "\202\US\242By\224\DC1_U\DC2j\212\215\182\220\\\254\250r\207\197\rS\195\154\ETB\195",PropPayloadFormatIndicator
// 13,PropAuthenticationData "{\165\180\226^\145G,5:\153I\154-I\228>L",PropMessageExpiryInterval
// 5120,PropSubscriptionIdentifierAvailable 159,PropSubscriptionIdentifierAvailable 44,PropRequestProblemInformation
// 81,PropRequestResponseInformation 129,PropResponseTopic "\186\169\233\FS\248\225v\NUL",PropTopicAlias
// 13028,PropSubscriptionIdentifierAvailable 36]
TEST(Unsubscribe5QCTest, Encode4) {
  uint8_t pkt[] = {0xa2, 0xa6, 0x1,  0x3d, 0xa3, 0x62, 0x23, 0x50, 0x2a, 0x9,  0x0,  0xa,  0x80, 0x8a, 0xf1, 0xea, 0x87,
                   0xd0, 0xc,  0xe7, 0xc5, 0xcd, 0x12, 0x0,  0x1b, 0xca, 0x1f, 0xf2, 0x42, 0x79, 0xe0, 0x11, 0x5f, 0x55,
                   0x12, 0x6a, 0xd4, 0xd7, 0xb6, 0xdc, 0x5c, 0xfe, 0xfa, 0x72, 0xcf, 0xc5, 0xd,  0x53, 0xc3, 0x9a, 0x17,
                   0xc3, 0x1,  0xd,  0x16, 0x0,  0x12, 0x7b, 0xa5, 0xb4, 0xe2, 0x5e, 0x91, 0x47, 0x2c, 0x35, 0x3a, 0x99,
                   0x49, 0x9a, 0x2d, 0x49, 0xe4, 0x3e, 0x4c, 0x2,  0x0,  0x0,  0x14, 0x0,  0x29, 0x9f, 0x29, 0x2c, 0x17,
                   0x51, 0x19, 0x81, 0x8,  0x0,  0x8,  0xba, 0xa9, 0xe9, 0x1c, 0xf8, 0xe1, 0x76, 0x0,  0x23, 0x32, 0xe4,
                   0x29, 0x24, 0x0,  0x1a, 0x71, 0x8f, 0xb3, 0x1a, 0xcb, 0xbf, 0xd5, 0xb1, 0x5d, 0x11, 0x94, 0x53, 0xaf,
                   0x1b, 0xc8, 0x43, 0x35, 0x15, 0xf6, 0xa7, 0x72, 0x98, 0xc6, 0xfe, 0x3,  0x49, 0x0,  0x6,  0x6a, 0x76,
                   0xf1, 0xd0, 0x1a, 0xd2, 0x0,  0xd,  0xb7, 0xc0, 0xde, 0x3b, 0x46, 0xfd, 0xf6, 0x76, 0x55, 0xb3, 0xf,
                   0x4f, 0xde, 0x0,  0xc,  0x96, 0x54, 0x91, 0xc6, 0x4a, 0x9,  0x70, 0x8a, 0x89, 0x27, 0x1b, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x80, 0x8a, 0xf1, 0xea, 0x87, 0xd0, 0xc, 0xe7, 0xc5, 0xcd};
  uint8_t bytesprops1[] = {0xca, 0x1f, 0xf2, 0x42, 0x79, 0xe0, 0x11, 0x5f, 0x55, 0x12, 0x6a, 0xd4, 0xd7, 0xb6,
                           0xdc, 0x5c, 0xfe, 0xfa, 0x72, 0xcf, 0xc5, 0xd,  0x53, 0xc3, 0x9a, 0x17, 0xc3};
  uint8_t bytesprops2[] = {0x7b, 0xa5, 0xb4, 0xe2, 0x5e, 0x91, 0x47, 0x2c, 0x35,
                           0x3a, 0x99, 0x49, 0x9a, 0x2d, 0x49, 0xe4, 0x3e, 0x4c};
  uint8_t bytesprops3[] = {0xba, 0xa9, 0xe9, 0x1c, 0xf8, 0xe1, 0x76, 0x0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20522}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5120}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13028}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 36}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x71, 0x8f, 0xb3, 0x1a, 0xcb, 0xbf, 0xd5, 0xb1, 0x5d, 0x11, 0x94, 0x53, 0xaf,
                                     0x1b, 0xc8, 0x43, 0x35, 0x15, 0xf6, 0xa7, 0x72, 0x98, 0xc6, 0xfe, 0x3,  0x49};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6a, 0x76, 0xf1, 0xd0, 0x1a, 0xd2};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb7, 0xc0, 0xde, 0x3b, 0x46, 0xfd, 0xf6, 0x76, 0x55, 0xb3, 0xf, 0x4f, 0xde};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x96, 0x54, 0x91, 0xc6, 0x4a, 0x9, 0x70, 0x8a, 0x89, 0x27, 0x1b, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15779, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 2710
// ["\192e\229>\239\247\184\209\158w\SI_X0T","E\243","\225\CAN*E8Q\t-\252B\136.\247\185\250","\144e\204Xj","\195?}\251*\158\210a,W\235\&3\249\219Z\143;","\239\251","","\170/\199\164\194\231\210\t\165(#\r\235i\151d\176QN\SUBX\249\195",",\176%\165\203\137\141\230K\EOT\SUBc\197\155N\202\195\t","5\129\227KZ\180\&7\DC4y^","n\227a\231\134C~\181\163^]\213\146"]
// [PropServerReference "\206\FS\243\193\158ik\ENQ\207^K\233{\227\&3%\222\"\167\217\206\163&\204qn\241",PropUserProperty
// "\150q\131t\134u" "\STXC\\\205J\192\134\241\&3\170",PropRetainAvailable 182,PropRequestProblemInformation
// 103,PropWildcardSubscriptionAvailable 20,PropContentType
// "\249/\251u\250\138\n\133\128\226y\222{\167\137Z\183F\198jaw\SYN\215\252\201L",PropSubscriptionIdentifierAvailable
// 208,PropRetainAvailable 195,PropResponseInformation "4|\179+&\161\148m>g\192'\162\ETXO_\153",PropResponseInformation
// "l\137",PropMessageExpiryInterval 14662,PropSharedSubscriptionAvailable 87,PropServerKeepAlive 31815,PropTopicAlias
// 858,PropReceiveMaximum 19278,PropSubscriptionIdentifierAvailable 48,PropWildcardSubscriptionAvailable
// 33,PropTopicAlias 30007,PropRequestResponseInformation 64,PropAssignedClientIdentifier
// "\190\249\131\132M\145\168\EOT\213\187\183T\155~\147\146",PropAuthenticationMethod
// "\NAK\132\215R\NUL\DC3\208):\SYNZT7#\163c\203\185\138-yrNV\173\146",PropSubscriptionIdentifierAvailable
// 116,PropReceiveMaximum 4013,PropUserProperty "\182U\129\228>/\214\254\204"
// "\161\241|B\202\190\r?a\236\128\n\181^\230@\219p",PropServerKeepAlive 22624,PropMessageExpiryInterval 5586]
TEST(Unsubscribe5QCTest, Encode5) {
  uint8_t pkt[] = {
      0xa2, 0xfc, 0x2,  0xa,  0x96, 0xea, 0x1,  0x1c, 0x0,  0x1b, 0xce, 0x1c, 0xf3, 0xc1, 0x9e, 0x69, 0x6b, 0x5,  0xcf,
      0x5e, 0x4b, 0xe9, 0x7b, 0xe3, 0x33, 0x25, 0xde, 0x22, 0xa7, 0xd9, 0xce, 0xa3, 0x26, 0xcc, 0x71, 0x6e, 0xf1, 0x26,
      0x0,  0x6,  0x96, 0x71, 0x83, 0x74, 0x86, 0x75, 0x0,  0xa,  0x2,  0x43, 0x5c, 0xcd, 0x4a, 0xc0, 0x86, 0xf1, 0x33,
      0xaa, 0x25, 0xb6, 0x17, 0x67, 0x28, 0x14, 0x3,  0x0,  0x1b, 0xf9, 0x2f, 0xfb, 0x75, 0xfa, 0x8a, 0xa,  0x85, 0x80,
      0xe2, 0x79, 0xde, 0x7b, 0xa7, 0x89, 0x5a, 0xb7, 0x46, 0xc6, 0x6a, 0x61, 0x77, 0x16, 0xd7, 0xfc, 0xc9, 0x4c, 0x29,
      0xd0, 0x25, 0xc3, 0x1a, 0x0,  0x11, 0x34, 0x7c, 0xb3, 0x2b, 0x26, 0xa1, 0x94, 0x6d, 0x3e, 0x67, 0xc0, 0x27, 0xa2,
      0x3,  0x4f, 0x5f, 0x99, 0x1a, 0x0,  0x2,  0x6c, 0x89, 0x2,  0x0,  0x0,  0x39, 0x46, 0x2a, 0x57, 0x13, 0x7c, 0x47,
      0x23, 0x3,  0x5a, 0x21, 0x4b, 0x4e, 0x29, 0x30, 0x28, 0x21, 0x23, 0x75, 0x37, 0x19, 0x40, 0x12, 0x0,  0x10, 0xbe,
      0xf9, 0x83, 0x84, 0x4d, 0x91, 0xa8, 0x4,  0xd5, 0xbb, 0xb7, 0x54, 0x9b, 0x7e, 0x93, 0x92, 0x15, 0x0,  0x1a, 0x15,
      0x84, 0xd7, 0x52, 0x0,  0x13, 0xd0, 0x29, 0x3a, 0x16, 0x5a, 0x54, 0x37, 0x23, 0xa3, 0x63, 0xcb, 0xb9, 0x8a, 0x2d,
      0x79, 0x72, 0x4e, 0x56, 0xad, 0x92, 0x29, 0x74, 0x21, 0xf,  0xad, 0x26, 0x0,  0x9,  0xb6, 0x55, 0x81, 0xe4, 0x3e,
      0x2f, 0xd6, 0xfe, 0xcc, 0x0,  0x12, 0xa1, 0xf1, 0x7c, 0x42, 0xca, 0xbe, 0xd,  0x3f, 0x61, 0xec, 0x80, 0xa,  0xb5,
      0x5e, 0xe6, 0x40, 0xdb, 0x70, 0x13, 0x58, 0x60, 0x2,  0x0,  0x0,  0x15, 0xd2, 0x0,  0xf,  0xc0, 0x65, 0xe5, 0x3e,
      0xef, 0xf7, 0xb8, 0xd1, 0x9e, 0x77, 0xf,  0x5f, 0x58, 0x30, 0x54, 0x0,  0x2,  0x45, 0xf3, 0x0,  0xf,  0xe1, 0x18,
      0x2a, 0x45, 0x38, 0x51, 0x9,  0x2d, 0xfc, 0x42, 0x88, 0x2e, 0xf7, 0xb9, 0xfa, 0x0,  0x5,  0x90, 0x65, 0xcc, 0x58,
      0x6a, 0x0,  0x11, 0xc3, 0x3f, 0x7d, 0xfb, 0x2a, 0x9e, 0xd2, 0x61, 0x2c, 0x57, 0xeb, 0x33, 0xf9, 0xdb, 0x5a, 0x8f,
      0x3b, 0x0,  0x2,  0xef, 0xfb, 0x0,  0x0,  0x0,  0x17, 0xaa, 0x2f, 0xc7, 0xa4, 0xc2, 0xe7, 0xd2, 0x9,  0xa5, 0x28,
      0x23, 0xd,  0xeb, 0x69, 0x97, 0x64, 0xb0, 0x51, 0x4e, 0x1a, 0x58, 0xf9, 0xc3, 0x0,  0x12, 0x2c, 0xb0, 0x25, 0xa5,
      0xcb, 0x89, 0x8d, 0xe6, 0x4b, 0x4,  0x1a, 0x63, 0xc5, 0x9b, 0x4e, 0xca, 0xc3, 0x9,  0x0,  0xa,  0x35, 0x81, 0xe3,
      0x4b, 0x5a, 0xb4, 0x37, 0x14, 0x79, 0x5e, 0x0,  0xd,  0x6e, 0xe3, 0x61, 0xe7, 0x86, 0x43, 0x7e, 0xb5, 0xa3, 0x5e,
      0x5d, 0xd5, 0x92};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xce, 0x1c, 0xf3, 0xc1, 0x9e, 0x69, 0x6b, 0x5,  0xcf, 0x5e, 0x4b, 0xe9, 0x7b, 0xe3,
                           0x33, 0x25, 0xde, 0x22, 0xa7, 0xd9, 0xce, 0xa3, 0x26, 0xcc, 0x71, 0x6e, 0xf1};
  uint8_t bytesprops2[] = {0x2, 0x43, 0x5c, 0xcd, 0x4a, 0xc0, 0x86, 0xf1, 0x33, 0xaa};
  uint8_t bytesprops1[] = {0x96, 0x71, 0x83, 0x74, 0x86, 0x75};
  uint8_t bytesprops3[] = {0xf9, 0x2f, 0xfb, 0x75, 0xfa, 0x8a, 0xa,  0x85, 0x80, 0xe2, 0x79, 0xde, 0x7b, 0xa7,
                           0x89, 0x5a, 0xb7, 0x46, 0xc6, 0x6a, 0x61, 0x77, 0x16, 0xd7, 0xfc, 0xc9, 0x4c};
  uint8_t bytesprops4[] = {0x34, 0x7c, 0xb3, 0x2b, 0x26, 0xa1, 0x94, 0x6d, 0x3e,
                           0x67, 0xc0, 0x27, 0xa2, 0x3,  0x4f, 0x5f, 0x99};
  uint8_t bytesprops5[] = {0x6c, 0x89};
  uint8_t bytesprops6[] = {0xbe, 0xf9, 0x83, 0x84, 0x4d, 0x91, 0xa8, 0x4,
                           0xd5, 0xbb, 0xb7, 0x54, 0x9b, 0x7e, 0x93, 0x92};
  uint8_t bytesprops7[] = {0x15, 0x84, 0xd7, 0x52, 0x0,  0x13, 0xd0, 0x29, 0x3a, 0x16, 0x5a, 0x54, 0x37,
                           0x23, 0xa3, 0x63, 0xcb, 0xb9, 0x8a, 0x2d, 0x79, 0x72, 0x4e, 0x56, 0xad, 0x92};
  uint8_t bytesprops9[] = {0xa1, 0xf1, 0x7c, 0x42, 0xca, 0xbe, 0xd,  0x3f, 0x61,
                           0xec, 0x80, 0xa,  0xb5, 0x5e, 0xe6, 0x40, 0xdb, 0x70};
  uint8_t bytesprops8[] = {0xb6, 0x55, 0x81, 0xe4, 0x3e, 0x2f, 0xd6, 0xfe, 0xcc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops1}, .v = {10, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14662}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31815}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 858}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19278}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30007}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4013}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops8}, .v = {18, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22624}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5586}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xc0, 0x65, 0xe5, 0x3e, 0xef, 0xf7, 0xb8, 0xd1,
                                     0x9e, 0x77, 0xf,  0x5f, 0x58, 0x30, 0x54};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x45, 0xf3};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe1, 0x18, 0x2a, 0x45, 0x38, 0x51, 0x9, 0x2d,
                                     0xfc, 0x42, 0x88, 0x2e, 0xf7, 0xb9, 0xfa};
  lwmqtt_string_t topic_filter_s2 = {15, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x90, 0x65, 0xcc, 0x58, 0x6a};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc3, 0x3f, 0x7d, 0xfb, 0x2a, 0x9e, 0xd2, 0x61, 0x2c,
                                     0x57, 0xeb, 0x33, 0xf9, 0xdb, 0x5a, 0x8f, 0x3b};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xef, 0xfb};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xaa, 0x2f, 0xc7, 0xa4, 0xc2, 0xe7, 0xd2, 0x9,  0xa5, 0x28, 0x23, 0xd,
                                     0xeb, 0x69, 0x97, 0x64, 0xb0, 0x51, 0x4e, 0x1a, 0x58, 0xf9, 0xc3};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x2c, 0xb0, 0x25, 0xa5, 0xcb, 0x89, 0x8d, 0xe6, 0x4b,
                                     0x4,  0x1a, 0x63, 0xc5, 0x9b, 0x4e, 0xca, 0xc3, 0x9};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x35, 0x81, 0xe3, 0x4b, 0x5a, 0xb4, 0x37, 0x14, 0x79, 0x5e};
  lwmqtt_string_t topic_filter_s9 = {10, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x6e, 0xe3, 0x61, 0xe7, 0x86, 0x43, 0x7e, 0xb5, 0xa3, 0x5e, 0x5d, 0xd5, 0x92};
  lwmqtt_string_t topic_filter_s10 = {13, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2710, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5130
// ["\246\197\169\&5\b\231f\149\170\236\240\171d\142Uq\241\RS\138\&2\222\160F\162\243\176NN\249\208","\STXt(\EM\234#}\242B~\248","","\166\"\128\192\131x<Pt\176BS\158D\v\CAN\129\152\&8","\251\181\178\201\147\176nsp\154\v\147A1a\190\208\NAK\222","<\aQ\200\238\"\132pv*\202\143","M\200\200Z\139\238","\145\143\192Tb(-y\184\252Yq@J_\n\201rE"]
// [PropSubscriptionIdentifierAvailable 249,PropAuthenticationMethod "\rYa4\198\172\ESC}\ENQ\220\237#",PropMaximumQoS
// 162,PropRequestProblemInformation 85,PropAssignedClientIdentifier
// "o\208\218\223d:\227g\142\182\199\186C\DC1\DC4k\212\SOg \210O\226\r1\148",PropResponseTopic
// "\181\NAK\128\226",PropReasonString "F-\SI\185\243\ETB\242U\254",PropReasonString "u",PropMessageExpiryInterval
// 18401,PropRequestProblemInformation 212,PropSubscriptionIdentifierAvailable 248,PropRequestProblemInformation
// 1,PropWillDelayInterval 11451,PropMaximumPacketSize 26947,PropSubscriptionIdentifier 12,PropAuthenticationMethod
// "2\242>\151\250\FS\RS\150\175n~CD0apa[B\212\163",PropRequestResponseInformation 73,PropServerReference
// "\220!\196\255v\205\238\246",PropWillDelayInterval 18917,PropRequestProblemInformation 227,PropAuthenticationMethod
// "\180 \156\EOT\165\ENQ\DC4\173\231\ENQ\DEL\fNsC\148\163\241\221\207\CAN\SOH\209",PropResponseTopic
// "'m\175\213\RSS\131\133F\133+%L;\138M\224",PropSharedSubscriptionAvailable 118,PropResponseInformation
// "\GS/\236\200\FSS\217\210\EM\154\224\217",PropContentType "\252\a\228\NULL<\RS\223\r\186\137\191\253\200\183\ACK"]
TEST(Unsubscribe5QCTest, Encode6) {
  uint8_t pkt[] = {
      0xa2, 0xe6, 0x2,  0x14, 0xa,  0xde, 0x1,  0x29, 0xf9, 0x15, 0x0,  0xc,  0xd,  0x59, 0x61, 0x34, 0xc6, 0xac, 0x1b,
      0x7d, 0x5,  0xdc, 0xed, 0x23, 0x24, 0xa2, 0x17, 0x55, 0x12, 0x0,  0x1a, 0x6f, 0xd0, 0xda, 0xdf, 0x64, 0x3a, 0xe3,
      0x67, 0x8e, 0xb6, 0xc7, 0xba, 0x43, 0x11, 0x14, 0x6b, 0xd4, 0xe,  0x67, 0x20, 0xd2, 0x4f, 0xe2, 0xd,  0x31, 0x94,
      0x8,  0x0,  0x4,  0xb5, 0x15, 0x80, 0xe2, 0x1f, 0x0,  0x9,  0x46, 0x2d, 0xf,  0xb9, 0xf3, 0x17, 0xf2, 0x55, 0xfe,
      0x1f, 0x0,  0x1,  0x75, 0x2,  0x0,  0x0,  0x47, 0xe1, 0x17, 0xd4, 0x29, 0xf8, 0x17, 0x1,  0x18, 0x0,  0x0,  0x2c,
      0xbb, 0x27, 0x0,  0x0,  0x69, 0x43, 0xb,  0xc,  0x15, 0x0,  0x15, 0x32, 0xf2, 0x3e, 0x97, 0xfa, 0x1c, 0x1e, 0x96,
      0xaf, 0x6e, 0x7e, 0x43, 0x44, 0x30, 0x61, 0x70, 0x61, 0x5b, 0x42, 0xd4, 0xa3, 0x19, 0x49, 0x1c, 0x0,  0x8,  0xdc,
      0x21, 0xc4, 0xff, 0x76, 0xcd, 0xee, 0xf6, 0x18, 0x0,  0x0,  0x49, 0xe5, 0x17, 0xe3, 0x15, 0x0,  0x17, 0xb4, 0x20,
      0x9c, 0x4,  0xa5, 0x5,  0x14, 0xad, 0xe7, 0x5,  0x7f, 0xc,  0x4e, 0x73, 0x43, 0x94, 0xa3, 0xf1, 0xdd, 0xcf, 0x18,
      0x1,  0xd1, 0x8,  0x0,  0x11, 0x27, 0x6d, 0xaf, 0xd5, 0x1e, 0x53, 0x83, 0x85, 0x46, 0x85, 0x2b, 0x25, 0x4c, 0x3b,
      0x8a, 0x4d, 0xe0, 0x2a, 0x76, 0x1a, 0x0,  0xc,  0x1d, 0x2f, 0xec, 0xc8, 0x1c, 0x53, 0xd9, 0xd2, 0x19, 0x9a, 0xe0,
      0xd9, 0x3,  0x0,  0x10, 0xfc, 0x7,  0xe4, 0x0,  0x4c, 0x3c, 0x1e, 0xdf, 0xd,  0xba, 0x89, 0xbf, 0xfd, 0xc8, 0xb7,
      0x6,  0x0,  0x1e, 0xf6, 0xc5, 0xa9, 0x35, 0x8,  0xe7, 0x66, 0x95, 0xaa, 0xec, 0xf0, 0xab, 0x64, 0x8e, 0x55, 0x71,
      0xf1, 0x1e, 0x8a, 0x32, 0xde, 0xa0, 0x46, 0xa2, 0xf3, 0xb0, 0x4e, 0x4e, 0xf9, 0xd0, 0x0,  0xb,  0x2,  0x74, 0x28,
      0x19, 0xea, 0x23, 0x7d, 0xf2, 0x42, 0x7e, 0xf8, 0x0,  0x0,  0x0,  0x13, 0xa6, 0x22, 0x80, 0xc0, 0x83, 0x78, 0x3c,
      0x50, 0x74, 0xb0, 0x42, 0x53, 0x9e, 0x44, 0xb,  0x18, 0x81, 0x98, 0x38, 0x0,  0x13, 0xfb, 0xb5, 0xb2, 0xc9, 0x93,
      0xb0, 0x6e, 0x73, 0x70, 0x9a, 0xb,  0x93, 0x41, 0x31, 0x61, 0xbe, 0xd0, 0x15, 0xde, 0x0,  0xc,  0x3c, 0x7,  0x51,
      0xc8, 0xee, 0x22, 0x84, 0x70, 0x76, 0x2a, 0xca, 0x8f, 0x0,  0x6,  0x4d, 0xc8, 0xc8, 0x5a, 0x8b, 0xee, 0x0,  0x13,
      0x91, 0x8f, 0xc0, 0x54, 0x62, 0x28, 0x2d, 0x79, 0xb8, 0xfc, 0x59, 0x71, 0x40, 0x4a, 0x5f, 0xa,  0xc9, 0x72, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd, 0x59, 0x61, 0x34, 0xc6, 0xac, 0x1b, 0x7d, 0x5, 0xdc, 0xed, 0x23};
  uint8_t bytesprops1[] = {0x6f, 0xd0, 0xda, 0xdf, 0x64, 0x3a, 0xe3, 0x67, 0x8e, 0xb6, 0xc7, 0xba, 0x43,
                           0x11, 0x14, 0x6b, 0xd4, 0xe,  0x67, 0x20, 0xd2, 0x4f, 0xe2, 0xd,  0x31, 0x94};
  uint8_t bytesprops2[] = {0xb5, 0x15, 0x80, 0xe2};
  uint8_t bytesprops3[] = {0x46, 0x2d, 0xf, 0xb9, 0xf3, 0x17, 0xf2, 0x55, 0xfe};
  uint8_t bytesprops4[] = {0x75};
  uint8_t bytesprops5[] = {0x32, 0xf2, 0x3e, 0x97, 0xfa, 0x1c, 0x1e, 0x96, 0xaf, 0x6e, 0x7e,
                           0x43, 0x44, 0x30, 0x61, 0x70, 0x61, 0x5b, 0x42, 0xd4, 0xa3};
  uint8_t bytesprops6[] = {0xdc, 0x21, 0xc4, 0xff, 0x76, 0xcd, 0xee, 0xf6};
  uint8_t bytesprops7[] = {0xb4, 0x20, 0x9c, 0x4,  0xa5, 0x5,  0x14, 0xad, 0xe7, 0x5, 0x7f, 0xc,
                           0x4e, 0x73, 0x43, 0x94, 0xa3, 0xf1, 0xdd, 0xcf, 0x18, 0x1, 0xd1};
  uint8_t bytesprops8[] = {0x27, 0x6d, 0xaf, 0xd5, 0x1e, 0x53, 0x83, 0x85, 0x46,
                           0x85, 0x2b, 0x25, 0x4c, 0x3b, 0x8a, 0x4d, 0xe0};
  uint8_t bytesprops9[] = {0x1d, 0x2f, 0xec, 0xc8, 0x1c, 0x53, 0xd9, 0xd2, 0x19, 0x9a, 0xe0, 0xd9};
  uint8_t bytesprops10[] = {0xfc, 0x7, 0xe4, 0x0, 0x4c, 0x3c, 0x1e, 0xdf, 0xd, 0xba, 0x89, 0xbf, 0xfd, 0xc8, 0xb7, 0x6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18401}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11451}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26947}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18917}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xf6, 0xc5, 0xa9, 0x35, 0x8,  0xe7, 0x66, 0x95, 0xaa, 0xec,
                                     0xf0, 0xab, 0x64, 0x8e, 0x55, 0x71, 0xf1, 0x1e, 0x8a, 0x32,
                                     0xde, 0xa0, 0x46, 0xa2, 0xf3, 0xb0, 0x4e, 0x4e, 0xf9, 0xd0};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2, 0x74, 0x28, 0x19, 0xea, 0x23, 0x7d, 0xf2, 0x42, 0x7e, 0xf8};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa6, 0x22, 0x80, 0xc0, 0x83, 0x78, 0x3c, 0x50, 0x74, 0xb0,
                                     0x42, 0x53, 0x9e, 0x44, 0xb,  0x18, 0x81, 0x98, 0x38};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfb, 0xb5, 0xb2, 0xc9, 0x93, 0xb0, 0x6e, 0x73, 0x70, 0x9a,
                                     0xb,  0x93, 0x41, 0x31, 0x61, 0xbe, 0xd0, 0x15, 0xde};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x3c, 0x7, 0x51, 0xc8, 0xee, 0x22, 0x84, 0x70, 0x76, 0x2a, 0xca, 0x8f};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4d, 0xc8, 0xc8, 0x5a, 0x8b, 0xee};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x91, 0x8f, 0xc0, 0x54, 0x62, 0x28, 0x2d, 0x79, 0xb8, 0xfc,
                                     0x59, 0x71, 0x40, 0x4a, 0x5f, 0xa,  0xc9, 0x72, 0x45};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5130, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 10000
// ["\FS\130\191W5L\182\156$\165\150tm\255l\234\202\179\208>\219\194\231\DELs\163","\188\202\DLE\SO\251z!\203\ETB\156.Mu\241\151","s\132\130\222\fE\142T\128\&3\v\230\218\&2\210_G6\128\220\251\STX","\t\171%#\219\251\SOH}\175@O\169","1d\CAN\f\SOH\183\253%F*","\195f\ry\161\STX\235\147\NAK\\\189\168","\SUBq;\RS\183\209\228z\166\187\217\155\EM\133[\133:\252\148\SYN","\207\ETB\179"]
// [PropRequestResponseInformation 152,PropResponseInformation "\231x\165\\\183hU\131\196\GS\STXo\DC2<\203t\168z\155"]
TEST(Unsubscribe5QCTest, Encode7) {
  uint8_t pkt[] = {0xa2, 0xa3, 0x1,  0x27, 0x10, 0x18, 0x19, 0x98, 0x1a, 0x0,  0x13, 0xe7, 0x78, 0xa5, 0x5c, 0xb7, 0x68,
                   0x55, 0x83, 0xc4, 0x1d, 0x2,  0x6f, 0x12, 0x3c, 0xcb, 0x74, 0xa8, 0x7a, 0x9b, 0x0,  0x1a, 0x1c, 0x82,
                   0xbf, 0x57, 0x35, 0x4c, 0xb6, 0x9c, 0x24, 0xa5, 0x96, 0x74, 0x6d, 0xff, 0x6c, 0xea, 0xca, 0xb3, 0xd0,
                   0x3e, 0xdb, 0xc2, 0xe7, 0x7f, 0x73, 0xa3, 0x0,  0xf,  0xbc, 0xca, 0x10, 0xe,  0xfb, 0x7a, 0x21, 0xcb,
                   0x17, 0x9c, 0x2e, 0x4d, 0x75, 0xf1, 0x97, 0x0,  0x16, 0x73, 0x84, 0x82, 0xde, 0xc,  0x45, 0x8e, 0x54,
                   0x80, 0x33, 0xb,  0xe6, 0xda, 0x32, 0xd2, 0x5f, 0x47, 0x36, 0x80, 0xdc, 0xfb, 0x2,  0x0,  0xc,  0x9,
                   0xab, 0x25, 0x23, 0xdb, 0xfb, 0x1,  0x7d, 0xaf, 0x40, 0x4f, 0xa9, 0x0,  0xa,  0x31, 0x64, 0x18, 0xc,
                   0x1,  0xb7, 0xfd, 0x25, 0x46, 0x2a, 0x0,  0xc,  0xc3, 0x66, 0xd,  0x79, 0xa1, 0x2,  0xeb, 0x93, 0x15,
                   0x5c, 0xbd, 0xa8, 0x0,  0x14, 0x1a, 0x71, 0x3b, 0x1e, 0xb7, 0xd1, 0xe4, 0x7a, 0xa6, 0xbb, 0xd9, 0x9b,
                   0x19, 0x85, 0x5b, 0x85, 0x3a, 0xfc, 0x94, 0x16, 0x0,  0x3,  0xcf, 0x17, 0xb3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe7, 0x78, 0xa5, 0x5c, 0xb7, 0x68, 0x55, 0x83, 0xc4, 0x1d,
                           0x2,  0x6f, 0x12, 0x3c, 0xcb, 0x74, 0xa8, 0x7a, 0x9b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x1c, 0x82, 0xbf, 0x57, 0x35, 0x4c, 0xb6, 0x9c, 0x24, 0xa5, 0x96, 0x74, 0x6d,
                                     0xff, 0x6c, 0xea, 0xca, 0xb3, 0xd0, 0x3e, 0xdb, 0xc2, 0xe7, 0x7f, 0x73, 0xa3};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xbc, 0xca, 0x10, 0xe,  0xfb, 0x7a, 0x21, 0xcb,
                                     0x17, 0x9c, 0x2e, 0x4d, 0x75, 0xf1, 0x97};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x73, 0x84, 0x82, 0xde, 0xc,  0x45, 0x8e, 0x54, 0x80, 0x33, 0xb,
                                     0xe6, 0xda, 0x32, 0xd2, 0x5f, 0x47, 0x36, 0x80, 0xdc, 0xfb, 0x2};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9, 0xab, 0x25, 0x23, 0xdb, 0xfb, 0x1, 0x7d, 0xaf, 0x40, 0x4f, 0xa9};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x31, 0x64, 0x18, 0xc, 0x1, 0xb7, 0xfd, 0x25, 0x46, 0x2a};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc3, 0x66, 0xd, 0x79, 0xa1, 0x2, 0xeb, 0x93, 0x15, 0x5c, 0xbd, 0xa8};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1a, 0x71, 0x3b, 0x1e, 0xb7, 0xd1, 0xe4, 0x7a, 0xa6, 0xbb,
                                     0xd9, 0x9b, 0x19, 0x85, 0x5b, 0x85, 0x3a, 0xfc, 0x94, 0x16};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xcf, 0x17, 0xb3};
  lwmqtt_string_t topic_filter_s7 = {3, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10000, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27754 ["\172U5\DEL\CAN\228","8\240H\r\196\215\174\249;\DEL","\196\130@
// \243\239\224\EM\205\229\136\207\254\167\223\132\193\tA\194A\245\NUL","\224\222\248\EOT\133p^\181\176C\236i7\193\233","\196\184Q\132\RS\SYN&y-\220\&3\GSN\220\172i\ENQ-\143\&9\b\203\226z\253\SI\ACK","\DC1\DC2\SOH\203\"\201\150\136G\ACK\DC3","Y;\167C\134\239\208\r\219\234J\222\197*R\184\150L.\\\178&\NUL\221\229\185\222]","\252\225\DC2~\145\SUBH\232\240\145\206m_u\146*$\254\SYNI\\\174\rk1\157\&5\253\&3\220","1r\226\USM\210o\252\161=\241","]\201\&9"]
// [PropCorrelationData "\236u\137\RS\NAK\136\209{",PropSubscriptionIdentifierAvailable 53,PropAuthenticationData
// "5\255\183l!9\173\162\181\157\159*K\238\131\171\253%\SOH\150\165\226"]
TEST(Unsubscribe5QCTest, Encode8) {
  uint8_t pkt[] = {
      0xa2, 0xe1, 0x1,  0x6c, 0x6a, 0x26, 0x9,  0x0,  0x8,  0xec, 0x75, 0x89, 0x1e, 0x15, 0x88, 0xd1, 0x7b, 0x29, 0x35,
      0x16, 0x0,  0x16, 0x35, 0xff, 0xb7, 0x6c, 0x21, 0x39, 0xad, 0xa2, 0xb5, 0x9d, 0x9f, 0x2a, 0x4b, 0xee, 0x83, 0xab,
      0xfd, 0x25, 0x1,  0x96, 0xa5, 0xe2, 0x0,  0x6,  0xac, 0x55, 0x35, 0x7f, 0x18, 0xe4, 0x0,  0xa,  0x38, 0xf0, 0x48,
      0xd,  0xc4, 0xd7, 0xae, 0xf9, 0x3b, 0x7f, 0x0,  0x17, 0xc4, 0x82, 0x40, 0x20, 0xf3, 0xef, 0xe0, 0x19, 0xcd, 0xe5,
      0x88, 0xcf, 0xfe, 0xa7, 0xdf, 0x84, 0xc1, 0x9,  0x41, 0xc2, 0x41, 0xf5, 0x0,  0x0,  0xf,  0xe0, 0xde, 0xf8, 0x4,
      0x85, 0x70, 0x5e, 0xb5, 0xb0, 0x43, 0xec, 0x69, 0x37, 0xc1, 0xe9, 0x0,  0x1b, 0xc4, 0xb8, 0x51, 0x84, 0x1e, 0x16,
      0x26, 0x79, 0x2d, 0xdc, 0x33, 0x1d, 0x4e, 0xdc, 0xac, 0x69, 0x5,  0x2d, 0x8f, 0x39, 0x8,  0xcb, 0xe2, 0x7a, 0xfd,
      0xf,  0x6,  0x0,  0xb,  0x11, 0x12, 0x1,  0xcb, 0x22, 0xc9, 0x96, 0x88, 0x47, 0x6,  0x13, 0x0,  0x1c, 0x59, 0x3b,
      0xa7, 0x43, 0x86, 0xef, 0xd0, 0xd,  0xdb, 0xea, 0x4a, 0xde, 0xc5, 0x2a, 0x52, 0xb8, 0x96, 0x4c, 0x2e, 0x5c, 0xb2,
      0x26, 0x0,  0xdd, 0xe5, 0xb9, 0xde, 0x5d, 0x0,  0x1e, 0xfc, 0xe1, 0x12, 0x7e, 0x91, 0x1a, 0x48, 0xe8, 0xf0, 0x91,
      0xce, 0x6d, 0x5f, 0x75, 0x92, 0x2a, 0x24, 0xfe, 0x16, 0x49, 0x5c, 0xae, 0xd,  0x6b, 0x31, 0x9d, 0x35, 0xfd, 0x33,
      0xdc, 0x0,  0xb,  0x31, 0x72, 0xe2, 0x1f, 0x4d, 0xd2, 0x6f, 0xfc, 0xa1, 0x3d, 0xf1, 0x0,  0x3,  0x5d, 0xc9, 0x39};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xec, 0x75, 0x89, 0x1e, 0x15, 0x88, 0xd1, 0x7b};
  uint8_t bytesprops1[] = {0x35, 0xff, 0xb7, 0x6c, 0x21, 0x39, 0xad, 0xa2, 0xb5, 0x9d, 0x9f,
                           0x2a, 0x4b, 0xee, 0x83, 0xab, 0xfd, 0x25, 0x1,  0x96, 0xa5, 0xe2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xac, 0x55, 0x35, 0x7f, 0x18, 0xe4};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x38, 0xf0, 0x48, 0xd, 0xc4, 0xd7, 0xae, 0xf9, 0x3b, 0x7f};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc4, 0x82, 0x40, 0x20, 0xf3, 0xef, 0xe0, 0x19, 0xcd, 0xe5, 0x88, 0xcf,
                                     0xfe, 0xa7, 0xdf, 0x84, 0xc1, 0x9,  0x41, 0xc2, 0x41, 0xf5, 0x0};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe0, 0xde, 0xf8, 0x4,  0x85, 0x70, 0x5e, 0xb5,
                                     0xb0, 0x43, 0xec, 0x69, 0x37, 0xc1, 0xe9};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc4, 0xb8, 0x51, 0x84, 0x1e, 0x16, 0x26, 0x79, 0x2d, 0xdc, 0x33, 0x1d, 0x4e, 0xdc,
                                     0xac, 0x69, 0x5,  0x2d, 0x8f, 0x39, 0x8,  0xcb, 0xe2, 0x7a, 0xfd, 0xf,  0x6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x11, 0x12, 0x1, 0xcb, 0x22, 0xc9, 0x96, 0x88, 0x47, 0x6, 0x13};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x59, 0x3b, 0xa7, 0x43, 0x86, 0xef, 0xd0, 0xd,  0xdb, 0xea,
                                     0x4a, 0xde, 0xc5, 0x2a, 0x52, 0xb8, 0x96, 0x4c, 0x2e, 0x5c,
                                     0xb2, 0x26, 0x0,  0xdd, 0xe5, 0xb9, 0xde, 0x5d};
  lwmqtt_string_t topic_filter_s6 = {28, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xfc, 0xe1, 0x12, 0x7e, 0x91, 0x1a, 0x48, 0xe8, 0xf0, 0x91,
                                     0xce, 0x6d, 0x5f, 0x75, 0x92, 0x2a, 0x24, 0xfe, 0x16, 0x49,
                                     0x5c, 0xae, 0xd,  0x6b, 0x31, 0x9d, 0x35, 0xfd, 0x33, 0xdc};
  lwmqtt_string_t topic_filter_s7 = {30, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x31, 0x72, 0xe2, 0x1f, 0x4d, 0xd2, 0x6f, 0xfc, 0xa1, 0x3d, 0xf1};
  lwmqtt_string_t topic_filter_s8 = {11, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5d, 0xc9, 0x39};
  lwmqtt_string_t topic_filter_s9 = {3, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27754, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 13532 ["\240\FS[\152\DLE\226\153","\239?\170"] [PropTopicAliasMaximum
// 18770,PropAuthenticationMethod "\195g9\138iB\SIp\ETB\ENQ\188{cnA}nE",PropResponseTopic
// "\150\144\ENQ\202\178\161\175\166",PropResponseTopic "\185{",PropRequestProblemInformation
// 243,PropWildcardSubscriptionAvailable 175,PropRequestResponseInformation 141,PropResponseTopic
// "Z\224\249>\DC3\"\224\FSr\215Z\r\207=\155\153\210@\168k\194\b\200Wlh!\US",PropReceiveMaximum
// 5693,PropSharedSubscriptionAvailable 209,PropServerKeepAlive 8126,PropSubscriptionIdentifierAvailable
// 188,PropTopicAliasMaximum 6378,PropWildcardSubscriptionAvailable 112,PropMessageExpiryInterval 9354,PropReasonString
// "L\142K\176\GS\240N*)\198? \241\156\146\218#K\186\195\176-\187\164",PropRetainAvailable 127,PropMessageExpiryInterval
// 13953,PropRequestResponseInformation 67,PropWillDelayInterval 27638,PropResponseInformation
// "\169\ETX\197s\196<\153\151\201\133\137\n\FS\DC4\170\134wL+\ESCp\STX\205",PropTopicAliasMaximum 18649]
TEST(Unsubscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0xa2, 0xb9, 0x1,  0x34, 0xdc, 0xa7, 0x1,  0x22, 0x49, 0x52, 0x15, 0x0,  0x12, 0xc3, 0x67, 0x39, 0x8a, 0x69, 0x42,
      0xf,  0x70, 0x17, 0x5,  0xbc, 0x7b, 0x63, 0x6e, 0x41, 0x7d, 0x6e, 0x45, 0x8,  0x0,  0x8,  0x96, 0x90, 0x5,  0xca,
      0xb2, 0xa1, 0xaf, 0xa6, 0x8,  0x0,  0x2,  0xb9, 0x7b, 0x17, 0xf3, 0x28, 0xaf, 0x19, 0x8d, 0x8,  0x0,  0x1c, 0x5a,
      0xe0, 0xf9, 0x3e, 0x13, 0x22, 0xe0, 0x1c, 0x72, 0xd7, 0x5a, 0xd,  0xcf, 0x3d, 0x9b, 0x99, 0xd2, 0x40, 0xa8, 0x6b,
      0xc2, 0x8,  0xc8, 0x57, 0x6c, 0x68, 0x21, 0x1f, 0x21, 0x16, 0x3d, 0x2a, 0xd1, 0x13, 0x1f, 0xbe, 0x29, 0xbc, 0x22,
      0x18, 0xea, 0x28, 0x70, 0x2,  0x0,  0x0,  0x24, 0x8a, 0x1f, 0x0,  0x18, 0x4c, 0x8e, 0x4b, 0xb0, 0x1d, 0xf0, 0x4e,
      0x2a, 0x29, 0xc6, 0x3f, 0x20, 0xf1, 0x9c, 0x92, 0xda, 0x23, 0x4b, 0xba, 0xc3, 0xb0, 0x2d, 0xbb, 0xa4, 0x25, 0x7f,
      0x2,  0x0,  0x0,  0x36, 0x81, 0x19, 0x43, 0x18, 0x0,  0x0,  0x6b, 0xf6, 0x1a, 0x0,  0x17, 0xa9, 0x3,  0xc5, 0x73,
      0xc4, 0x3c, 0x99, 0x97, 0xc9, 0x85, 0x89, 0xa,  0x1c, 0x14, 0xaa, 0x86, 0x77, 0x4c, 0x2b, 0x1b, 0x70, 0x2,  0xcd,
      0x22, 0x48, 0xd9, 0x0,  0x7,  0xf0, 0x1c, 0x5b, 0x98, 0x10, 0xe2, 0x99, 0x0,  0x3,  0xef, 0x3f, 0xaa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc3, 0x67, 0x39, 0x8a, 0x69, 0x42, 0xf,  0x70, 0x17,
                           0x5,  0xbc, 0x7b, 0x63, 0x6e, 0x41, 0x7d, 0x6e, 0x45};
  uint8_t bytesprops1[] = {0x96, 0x90, 0x5, 0xca, 0xb2, 0xa1, 0xaf, 0xa6};
  uint8_t bytesprops2[] = {0xb9, 0x7b};
  uint8_t bytesprops3[] = {0x5a, 0xe0, 0xf9, 0x3e, 0x13, 0x22, 0xe0, 0x1c, 0x72, 0xd7, 0x5a, 0xd,  0xcf, 0x3d,
                           0x9b, 0x99, 0xd2, 0x40, 0xa8, 0x6b, 0xc2, 0x8,  0xc8, 0x57, 0x6c, 0x68, 0x21, 0x1f};
  uint8_t bytesprops4[] = {0x4c, 0x8e, 0x4b, 0xb0, 0x1d, 0xf0, 0x4e, 0x2a, 0x29, 0xc6, 0x3f, 0x20,
                           0xf1, 0x9c, 0x92, 0xda, 0x23, 0x4b, 0xba, 0xc3, 0xb0, 0x2d, 0xbb, 0xa4};
  uint8_t bytesprops5[] = {0xa9, 0x3,  0xc5, 0x73, 0xc4, 0x3c, 0x99, 0x97, 0xc9, 0x85, 0x89, 0xa,
                           0x1c, 0x14, 0xaa, 0x86, 0x77, 0x4c, 0x2b, 0x1b, 0x70, 0x2,  0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18770}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5693}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8126}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6378}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9354}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13953}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27638}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18649}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xf0, 0x1c, 0x5b, 0x98, 0x10, 0xe2, 0x99};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xef, 0x3f, 0xaa};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13532, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 8446 ["N-\DC2\189\173\241\ETB\177\&9
// \159\f\fj~\213!7\235\ESCx\194@\217\US[<","-","e\189\238\251\177\189\195\DLE\192\"c\166\SUB\DEL\145\133L\154^\"W\ETB\217\212","\155","X\139\243\DEL","\209\253\253\NUL9D\178\250\155BHo!\229=\135\146","\EM\217\251","\193S","\173M\228Y\v","\DC4>\252W0Y"]
// [PropTopicAlias 28644,PropUserProperty "\157\n\137\241G`]\ACK\SOH\236}\185\146\228\251\217\156Za\146\129\162"
// "\206\169\210S\208\244\NAK\191d\187Y1\213\186\241\255\&3\242o\ENQ\229\191\228\DC2\156",PropRetainAvailable
// 98,PropPayloadFormatIndicator 207,PropRequestProblemInformation 63,PropAssignedClientIdentifier
// "\131\173f\CAN\210_\128+\131\235\180\222\218u7K\199\CAN\CAN\190\206\158\152\232\250",PropSubscriptionIdentifier
// 4,PropSharedSubscriptionAvailable 7,PropMaximumPacketSize 9667,PropSubscriptionIdentifierAvailable 158,PropMaximumQoS
// 80,PropCorrelationData "3\189\&5({Pi\175\&8\135\176\198-\162\155\CAN\209I\NAK*/\DC1\186\137",PropMaximumPacketSize
// 9314,PropSharedSubscriptionAvailable 77,PropReceiveMaximum 15880,PropRetainAvailable 172,PropSessionExpiryInterval
// 28303,PropSubscriptionIdentifierAvailable 18,PropWildcardSubscriptionAvailable 20,PropContentType
// "\221\194\221\145\&7\149\156\204\172\252\158\160N.\179\148\FS\220\167",PropRetainAvailable 128,PropCorrelationData
// "\171\NUL\v\SIY\210\174\"\v\134\154\166\199\131",PropSessionExpiryInterval 2186,PropCorrelationData
// "\133w\187\216<\238wcW\149",PropAuthenticationMethod "\196\221\254(\160 \232\181\NAKE"]
TEST(Unsubscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0xa2, 0xd0, 0x2,  0x20, 0xfe, 0xde, 0x1,  0x23, 0x6f, 0xe4, 0x26, 0x0,  0x16, 0x9d, 0xa,  0x89, 0xf1, 0x47, 0x60,
      0x5d, 0x6,  0x1,  0xec, 0x7d, 0xb9, 0x92, 0xe4, 0xfb, 0xd9, 0x9c, 0x5a, 0x61, 0x92, 0x81, 0xa2, 0x0,  0x19, 0xce,
      0xa9, 0xd2, 0x53, 0xd0, 0xf4, 0x15, 0xbf, 0x64, 0xbb, 0x59, 0x31, 0xd5, 0xba, 0xf1, 0xff, 0x33, 0xf2, 0x6f, 0x5,
      0xe5, 0xbf, 0xe4, 0x12, 0x9c, 0x25, 0x62, 0x1,  0xcf, 0x17, 0x3f, 0x12, 0x0,  0x19, 0x83, 0xad, 0x66, 0x18, 0xd2,
      0x5f, 0x80, 0x2b, 0x83, 0xeb, 0xb4, 0xde, 0xda, 0x75, 0x37, 0x4b, 0xc7, 0x18, 0x18, 0xbe, 0xce, 0x9e, 0x98, 0xe8,
      0xfa, 0xb,  0x4,  0x2a, 0x7,  0x27, 0x0,  0x0,  0x25, 0xc3, 0x29, 0x9e, 0x24, 0x50, 0x9,  0x0,  0x18, 0x33, 0xbd,
      0x35, 0x28, 0x7b, 0x50, 0x69, 0xaf, 0x38, 0x87, 0xb0, 0xc6, 0x2d, 0xa2, 0x9b, 0x18, 0xd1, 0x49, 0x15, 0x2a, 0x2f,
      0x11, 0xba, 0x89, 0x27, 0x0,  0x0,  0x24, 0x62, 0x2a, 0x4d, 0x21, 0x3e, 0x8,  0x25, 0xac, 0x11, 0x0,  0x0,  0x6e,
      0x8f, 0x29, 0x12, 0x28, 0x14, 0x3,  0x0,  0x13, 0xdd, 0xc2, 0xdd, 0x91, 0x37, 0x95, 0x9c, 0xcc, 0xac, 0xfc, 0x9e,
      0xa0, 0x4e, 0x2e, 0xb3, 0x94, 0x1c, 0xdc, 0xa7, 0x25, 0x80, 0x9,  0x0,  0xe,  0xab, 0x0,  0xb,  0xf,  0x59, 0xd2,
      0xae, 0x22, 0xb,  0x86, 0x9a, 0xa6, 0xc7, 0x83, 0x11, 0x0,  0x0,  0x8,  0x8a, 0x9,  0x0,  0xa,  0x85, 0x77, 0xbb,
      0xd8, 0x3c, 0xee, 0x77, 0x63, 0x57, 0x95, 0x15, 0x0,  0xa,  0xc4, 0xdd, 0xfe, 0x28, 0xa0, 0x20, 0xe8, 0xb5, 0x15,
      0x45, 0x0,  0x1b, 0x4e, 0x2d, 0x12, 0xbd, 0xad, 0xf1, 0x17, 0xb1, 0x39, 0x20, 0x9f, 0xc,  0xc,  0x6a, 0x7e, 0xd5,
      0x21, 0x37, 0xeb, 0x1b, 0x78, 0xc2, 0x40, 0xd9, 0x1f, 0x5b, 0x3c, 0x0,  0x1,  0x2d, 0x0,  0x18, 0x65, 0xbd, 0xee,
      0xfb, 0xb1, 0xbd, 0xc3, 0x10, 0xc0, 0x22, 0x63, 0xa6, 0x1a, 0x7f, 0x91, 0x85, 0x4c, 0x9a, 0x5e, 0x22, 0x57, 0x17,
      0xd9, 0xd4, 0x0,  0x1,  0x9b, 0x0,  0x4,  0x58, 0x8b, 0xf3, 0x7f, 0x0,  0x11, 0xd1, 0xfd, 0xfd, 0x0,  0x39, 0x44,
      0xb2, 0xfa, 0x9b, 0x42, 0x48, 0x6f, 0x21, 0xe5, 0x3d, 0x87, 0x92, 0x0,  0x3,  0x19, 0xd9, 0xfb, 0x0,  0x2,  0xc1,
      0x53, 0x0,  0x5,  0xad, 0x4d, 0xe4, 0x59, 0xb,  0x0,  0x6,  0x14, 0x3e, 0xfc, 0x57, 0x30, 0x59};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0xce, 0xa9, 0xd2, 0x53, 0xd0, 0xf4, 0x15, 0xbf, 0x64, 0xbb, 0x59, 0x31, 0xd5,
                           0xba, 0xf1, 0xff, 0x33, 0xf2, 0x6f, 0x5,  0xe5, 0xbf, 0xe4, 0x12, 0x9c};
  uint8_t bytesprops0[] = {0x9d, 0xa,  0x89, 0xf1, 0x47, 0x60, 0x5d, 0x6,  0x1,  0xec, 0x7d,
                           0xb9, 0x92, 0xe4, 0xfb, 0xd9, 0x9c, 0x5a, 0x61, 0x92, 0x81, 0xa2};
  uint8_t bytesprops2[] = {0x83, 0xad, 0x66, 0x18, 0xd2, 0x5f, 0x80, 0x2b, 0x83, 0xeb, 0xb4, 0xde, 0xda,
                           0x75, 0x37, 0x4b, 0xc7, 0x18, 0x18, 0xbe, 0xce, 0x9e, 0x98, 0xe8, 0xfa};
  uint8_t bytesprops3[] = {0x33, 0xbd, 0x35, 0x28, 0x7b, 0x50, 0x69, 0xaf, 0x38, 0x87, 0xb0, 0xc6,
                           0x2d, 0xa2, 0x9b, 0x18, 0xd1, 0x49, 0x15, 0x2a, 0x2f, 0x11, 0xba, 0x89};
  uint8_t bytesprops4[] = {0xdd, 0xc2, 0xdd, 0x91, 0x37, 0x95, 0x9c, 0xcc, 0xac, 0xfc,
                           0x9e, 0xa0, 0x4e, 0x2e, 0xb3, 0x94, 0x1c, 0xdc, 0xa7};
  uint8_t bytesprops5[] = {0xab, 0x0, 0xb, 0xf, 0x59, 0xd2, 0xae, 0x22, 0xb, 0x86, 0x9a, 0xa6, 0xc7, 0x83};
  uint8_t bytesprops6[] = {0x85, 0x77, 0xbb, 0xd8, 0x3c, 0xee, 0x77, 0x63, 0x57, 0x95};
  uint8_t bytesprops7[] = {0xc4, 0xdd, 0xfe, 0x28, 0xa0, 0x20, 0xe8, 0xb5, 0x15, 0x45};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28644}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops0}, .v = {25, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9667}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 80}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9314}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15880}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28303}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2186}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x4e, 0x2d, 0x12, 0xbd, 0xad, 0xf1, 0x17, 0xb1, 0x39, 0x20, 0x9f, 0xc,  0xc, 0x6a,
                                     0x7e, 0xd5, 0x21, 0x37, 0xeb, 0x1b, 0x78, 0xc2, 0x40, 0xd9, 0x1f, 0x5b, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x65, 0xbd, 0xee, 0xfb, 0xb1, 0xbd, 0xc3, 0x10, 0xc0, 0x22, 0x63, 0xa6,
                                     0x1a, 0x7f, 0x91, 0x85, 0x4c, 0x9a, 0x5e, 0x22, 0x57, 0x17, 0xd9, 0xd4};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9b};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x58, 0x8b, 0xf3, 0x7f};
  lwmqtt_string_t topic_filter_s4 = {4, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd1, 0xfd, 0xfd, 0x0,  0x39, 0x44, 0xb2, 0xfa, 0x9b,
                                     0x42, 0x48, 0x6f, 0x21, 0xe5, 0x3d, 0x87, 0x92};
  lwmqtt_string_t topic_filter_s5 = {17, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x19, 0xd9, 0xfb};
  lwmqtt_string_t topic_filter_s6 = {3, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc1, 0x53};
  lwmqtt_string_t topic_filter_s7 = {2, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xad, 0x4d, 0xe4, 0x59, 0xb};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x14, 0x3e, 0xfc, 0x57, 0x30, 0x59};
  lwmqtt_string_t topic_filter_s9 = {6, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8446, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 16062
// ["\DC4\200\182\217\165`\168\SUB\DLE7\161\153>`\251\222\164\236/\237\214y#\151\242.z","\139\214\221#G*U\227T\173Rn@x\190\128\&5y\194\247\195\175\253wE","\GS\251H\DC4\vJP\189\140\185\154\&6\ETB\ETX","\128","\164\134\216\194\&6\188\138H\199\EOT\183\NULcZ?\216\152\181\221Q\186\186(","N\153\169\195C0fs\136\178\185\191\163\GS\DLE\NUL\163\137\203\244\EM\134","%N\154_","\182\139\236\&1\DEL\208\223\&6&D\244\191\208\GS\155S\221","\133
// \226-gm\142m\195\143\ACK\187RL\224}\157S=\135\230j\143","\221A\DC405q\245^U\188\239\212","\141\201\141\157\242\ACKk\161\185\131\247\CAN\a\240L\180\218Wn\218%\f\247"]
// [PropRetainAvailable 126,PropCorrelationData "\196\225\180\173",PropMaximumPacketSize
// 15050,PropWildcardSubscriptionAvailable 132,PropTopicAlias 5379,PropServerReference
// "\254\250\184vZ\180,Vau\230p\128\ACKO\248B\194\&7B4\240}\218\&4!",PropTopicAlias 12587,PropContentType
// "uO\220\242\162\220Y\161\149\196\229\180=\213\v\FSXU\137:",PropResponseInformation
// "(\NUL\180\&4J\254\154\170",PropCorrelationData "",PropAuthenticationMethod "6\DLE",PropReceiveMaximum
// 21115,PropResponseInformation "y\158\152I\133\133\147?rj\186z\161\&0\143s",PropSharedSubscriptionAvailable
// 14,PropAuthenticationMethod "V\144z\151\156\241<\223\183\171{\200\211k_\210\&32E\215",PropReasonString
// "\222g2v#\247R\158Z\185\236\158",PropMessageExpiryInterval 15220,PropWildcardSubscriptionAvailable
// 112,PropResponseTopic "7",PropRetainAvailable 91,PropResponseInformation
// "\247l\174\144]l\237\134|\238w",PropMessageExpiryInterval 23113,PropSubscriptionIdentifierAvailable
// 9,PropResponseTopic "\184\228q\"\r\232",PropCorrelationData "3\140\192\224\ENQ\224\138\&0\228q
// \251\139\227\239}\135:\254\236\138\DEL\182L\139\SUB\210",PropPayloadFormatIndicator 216,PropServerReference
// "\r\135U\185B\ETBj\200\149\198\SYN\NAK\ACK*\188\r\216\&5\DEL.\SOH4\147",PropContentType
// "\131k\230\193BewT%\251\236",PropRequestResponseInformation 75,PropWillDelayInterval 26761]
TEST(Unsubscribe5QCTest, Encode11) {
  uint8_t pkt[] = {
      0xa2, 0xee, 0x3,  0x3e, 0xbe, 0x95, 0x2,  0x25, 0x7e, 0x9,  0x0,  0x4,  0xc4, 0xe1, 0xb4, 0xad, 0x27, 0x0,  0x0,
      0x3a, 0xca, 0x28, 0x84, 0x23, 0x15, 0x3,  0x1c, 0x0,  0x1a, 0xfe, 0xfa, 0xb8, 0x76, 0x5a, 0xb4, 0x2c, 0x56, 0x61,
      0x75, 0xe6, 0x70, 0x80, 0x6,  0x4f, 0xf8, 0x42, 0xc2, 0x37, 0x42, 0x34, 0xf0, 0x7d, 0xda, 0x34, 0x21, 0x23, 0x31,
      0x2b, 0x3,  0x0,  0x14, 0x75, 0x4f, 0xdc, 0xf2, 0xa2, 0xdc, 0x59, 0xa1, 0x95, 0xc4, 0xe5, 0xb4, 0x3d, 0xd5, 0xb,
      0x1c, 0x58, 0x55, 0x89, 0x3a, 0x1a, 0x0,  0x8,  0x28, 0x0,  0xb4, 0x34, 0x4a, 0xfe, 0x9a, 0xaa, 0x9,  0x0,  0x0,
      0x15, 0x0,  0x2,  0x36, 0x10, 0x21, 0x52, 0x7b, 0x1a, 0x0,  0x10, 0x79, 0x9e, 0x98, 0x49, 0x85, 0x85, 0x93, 0x3f,
      0x72, 0x6a, 0xba, 0x7a, 0xa1, 0x30, 0x8f, 0x73, 0x2a, 0xe,  0x15, 0x0,  0x14, 0x56, 0x90, 0x7a, 0x97, 0x9c, 0xf1,
      0x3c, 0xdf, 0xb7, 0xab, 0x7b, 0xc8, 0xd3, 0x6b, 0x5f, 0xd2, 0x33, 0x32, 0x45, 0xd7, 0x1f, 0x0,  0xc,  0xde, 0x67,
      0x32, 0x76, 0x23, 0xf7, 0x52, 0x9e, 0x5a, 0xb9, 0xec, 0x9e, 0x2,  0x0,  0x0,  0x3b, 0x74, 0x28, 0x70, 0x8,  0x0,
      0x1,  0x37, 0x25, 0x5b, 0x1a, 0x0,  0xb,  0xf7, 0x6c, 0xae, 0x90, 0x5d, 0x6c, 0xed, 0x86, 0x7c, 0xee, 0x77, 0x2,
      0x0,  0x0,  0x5a, 0x49, 0x29, 0x9,  0x8,  0x0,  0x6,  0xb8, 0xe4, 0x71, 0x22, 0xd,  0xe8, 0x9,  0x0,  0x1b, 0x33,
      0x8c, 0xc0, 0xe0, 0x5,  0xe0, 0x8a, 0x30, 0xe4, 0x71, 0x20, 0xfb, 0x8b, 0xe3, 0xef, 0x7d, 0x87, 0x3a, 0xfe, 0xec,
      0x8a, 0x7f, 0xb6, 0x4c, 0x8b, 0x1a, 0xd2, 0x1,  0xd8, 0x1c, 0x0,  0x17, 0xd,  0x87, 0x55, 0xb9, 0x42, 0x17, 0x6a,
      0xc8, 0x95, 0xc6, 0x16, 0x15, 0x6,  0x2a, 0xbc, 0xd,  0xd8, 0x35, 0x7f, 0x2e, 0x1,  0x34, 0x93, 0x3,  0x0,  0xb,
      0x83, 0x6b, 0xe6, 0xc1, 0x42, 0x65, 0x77, 0x54, 0x25, 0xfb, 0xec, 0x19, 0x4b, 0x18, 0x0,  0x0,  0x68, 0x89, 0x0,
      0x1b, 0x14, 0xc8, 0xb6, 0xd9, 0xa5, 0x60, 0xa8, 0x1a, 0x10, 0x37, 0xa1, 0x99, 0x3e, 0x60, 0xfb, 0xde, 0xa4, 0xec,
      0x2f, 0xed, 0xd6, 0x79, 0x23, 0x97, 0xf2, 0x2e, 0x7a, 0x0,  0x19, 0x8b, 0xd6, 0xdd, 0x23, 0x47, 0x2a, 0x55, 0xe3,
      0x54, 0xad, 0x52, 0x6e, 0x40, 0x78, 0xbe, 0x80, 0x35, 0x79, 0xc2, 0xf7, 0xc3, 0xaf, 0xfd, 0x77, 0x45, 0x0,  0xe,
      0x1d, 0xfb, 0x48, 0x14, 0xb,  0x4a, 0x50, 0xbd, 0x8c, 0xb9, 0x9a, 0x36, 0x17, 0x3,  0x0,  0x1,  0x80, 0x0,  0x17,
      0xa4, 0x86, 0xd8, 0xc2, 0x36, 0xbc, 0x8a, 0x48, 0xc7, 0x4,  0xb7, 0x0,  0x63, 0x5a, 0x3f, 0xd8, 0x98, 0xb5, 0xdd,
      0x51, 0xba, 0xba, 0x28, 0x0,  0x16, 0x4e, 0x99, 0xa9, 0xc3, 0x43, 0x30, 0x66, 0x73, 0x88, 0xb2, 0xb9, 0xbf, 0xa3,
      0x1d, 0x10, 0x0,  0xa3, 0x89, 0xcb, 0xf4, 0x19, 0x86, 0x0,  0x4,  0x25, 0x4e, 0x9a, 0x5f, 0x0,  0x11, 0xb6, 0x8b,
      0xec, 0x31, 0x7f, 0xd0, 0xdf, 0x36, 0x26, 0x44, 0xf4, 0xbf, 0xd0, 0x1d, 0x9b, 0x53, 0xdd, 0x0,  0x17, 0x85, 0x20,
      0xe2, 0x2d, 0x67, 0x6d, 0x8e, 0x6d, 0xc3, 0x8f, 0x6,  0xbb, 0x52, 0x4c, 0xe0, 0x7d, 0x9d, 0x53, 0x3d, 0x87, 0xe6,
      0x6a, 0x8f, 0x0,  0xc,  0xdd, 0x41, 0x14, 0x30, 0x35, 0x71, 0xf5, 0x5e, 0x55, 0xbc, 0xef, 0xd4, 0x0,  0x17, 0x8d,
      0xc9, 0x8d, 0x9d, 0xf2, 0x6,  0x6b, 0xa1, 0xb9, 0x83, 0xf7, 0x18, 0x7,  0xf0, 0x4c, 0xb4, 0xda, 0x57, 0x6e, 0xda,
      0x25, 0xc,  0xf7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc4, 0xe1, 0xb4, 0xad};
  uint8_t bytesprops1[] = {0xfe, 0xfa, 0xb8, 0x76, 0x5a, 0xb4, 0x2c, 0x56, 0x61, 0x75, 0xe6, 0x70, 0x80,
                           0x6,  0x4f, 0xf8, 0x42, 0xc2, 0x37, 0x42, 0x34, 0xf0, 0x7d, 0xda, 0x34, 0x21};
  uint8_t bytesprops2[] = {0x75, 0x4f, 0xdc, 0xf2, 0xa2, 0xdc, 0x59, 0xa1, 0x95, 0xc4,
                           0xe5, 0xb4, 0x3d, 0xd5, 0xb,  0x1c, 0x58, 0x55, 0x89, 0x3a};
  uint8_t bytesprops3[] = {0x28, 0x0, 0xb4, 0x34, 0x4a, 0xfe, 0x9a, 0xaa};
  uint8_t bytesprops4[] = {0};
  uint8_t bytesprops5[] = {0x36, 0x10};
  uint8_t bytesprops6[] = {0x79, 0x9e, 0x98, 0x49, 0x85, 0x85, 0x93, 0x3f,
                           0x72, 0x6a, 0xba, 0x7a, 0xa1, 0x30, 0x8f, 0x73};
  uint8_t bytesprops7[] = {0x56, 0x90, 0x7a, 0x97, 0x9c, 0xf1, 0x3c, 0xdf, 0xb7, 0xab,
                           0x7b, 0xc8, 0xd3, 0x6b, 0x5f, 0xd2, 0x33, 0x32, 0x45, 0xd7};
  uint8_t bytesprops8[] = {0xde, 0x67, 0x32, 0x76, 0x23, 0xf7, 0x52, 0x9e, 0x5a, 0xb9, 0xec, 0x9e};
  uint8_t bytesprops9[] = {0x37};
  uint8_t bytesprops10[] = {0xf7, 0x6c, 0xae, 0x90, 0x5d, 0x6c, 0xed, 0x86, 0x7c, 0xee, 0x77};
  uint8_t bytesprops11[] = {0xb8, 0xe4, 0x71, 0x22, 0xd, 0xe8};
  uint8_t bytesprops12[] = {0x33, 0x8c, 0xc0, 0xe0, 0x5,  0xe0, 0x8a, 0x30, 0xe4, 0x71, 0x20, 0xfb, 0x8b, 0xe3,
                            0xef, 0x7d, 0x87, 0x3a, 0xfe, 0xec, 0x8a, 0x7f, 0xb6, 0x4c, 0x8b, 0x1a, 0xd2};
  uint8_t bytesprops13[] = {0xd, 0x87, 0x55, 0xb9, 0x42, 0x17, 0x6a, 0xc8, 0x95, 0xc6, 0x16, 0x15,
                            0x6, 0x2a, 0xbc, 0xd,  0xd8, 0x35, 0x7f, 0x2e, 0x1,  0x34, 0x93};
  uint8_t bytesprops14[] = {0x83, 0x6b, 0xe6, 0xc1, 0x42, 0x65, 0x77, 0x54, 0x25, 0xfb, 0xec};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15050}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5379}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12587}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21115}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15220}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23113}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26761}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x14, 0xc8, 0xb6, 0xd9, 0xa5, 0x60, 0xa8, 0x1a, 0x10, 0x37, 0xa1, 0x99, 0x3e, 0x60,
                                     0xfb, 0xde, 0xa4, 0xec, 0x2f, 0xed, 0xd6, 0x79, 0x23, 0x97, 0xf2, 0x2e, 0x7a};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8b, 0xd6, 0xdd, 0x23, 0x47, 0x2a, 0x55, 0xe3, 0x54, 0xad, 0x52, 0x6e, 0x40,
                                     0x78, 0xbe, 0x80, 0x35, 0x79, 0xc2, 0xf7, 0xc3, 0xaf, 0xfd, 0x77, 0x45};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1d, 0xfb, 0x48, 0x14, 0xb, 0x4a, 0x50, 0xbd, 0x8c, 0xb9, 0x9a, 0x36, 0x17, 0x3};
  lwmqtt_string_t topic_filter_s2 = {14, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x80};
  lwmqtt_string_t topic_filter_s3 = {1, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa4, 0x86, 0xd8, 0xc2, 0x36, 0xbc, 0x8a, 0x48, 0xc7, 0x4,  0xb7, 0x0,
                                     0x63, 0x5a, 0x3f, 0xd8, 0x98, 0xb5, 0xdd, 0x51, 0xba, 0xba, 0x28};
  lwmqtt_string_t topic_filter_s4 = {23, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4e, 0x99, 0xa9, 0xc3, 0x43, 0x30, 0x66, 0x73, 0x88, 0xb2, 0xb9,
                                     0xbf, 0xa3, 0x1d, 0x10, 0x0,  0xa3, 0x89, 0xcb, 0xf4, 0x19, 0x86};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x25, 0x4e, 0x9a, 0x5f};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb6, 0x8b, 0xec, 0x31, 0x7f, 0xd0, 0xdf, 0x36, 0x26,
                                     0x44, 0xf4, 0xbf, 0xd0, 0x1d, 0x9b, 0x53, 0xdd};
  lwmqtt_string_t topic_filter_s7 = {17, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x85, 0x20, 0xe2, 0x2d, 0x67, 0x6d, 0x8e, 0x6d, 0xc3, 0x8f, 0x6, 0xbb,
                                     0x52, 0x4c, 0xe0, 0x7d, 0x9d, 0x53, 0x3d, 0x87, 0xe6, 0x6a, 0x8f};
  lwmqtt_string_t topic_filter_s8 = {23, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xdd, 0x41, 0x14, 0x30, 0x35, 0x71, 0xf5, 0x5e, 0x55, 0xbc, 0xef, 0xd4};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x8d, 0xc9, 0x8d, 0x9d, 0xf2, 0x6,  0x6b, 0xa1, 0xb9, 0x83, 0xf7, 0x18,
                                      0x7,  0xf0, 0x4c, 0xb4, 0xda, 0x57, 0x6e, 0xda, 0x25, 0xc,  0xf7};
  lwmqtt_string_t topic_filter_s10 = {23, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 16062, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 999
// ["kz8\"x_\167\&7\"\185\142\244:j\DC1","|","$\185\f4w\233","T\165\216\ETB\180p\NULe\ETX8\144\DLE4\DC4\GS\226\218\129\RS\SOHz","\172|>\168&\208\226\212\228lp\RSw\196\153\ESC\218\178l\207\rqgP\t\155$\145\ENQ","\EOT\244\t\200\GS\218\166\a\ETBL\218\191\198\183\130OR\ENQn\151\"|"]
// []
TEST(Unsubscribe5QCTest, Encode12) {
  uint8_t pkt[] = {0xa2, 0x6d, 0x3,  0xe7, 0x0,  0x0,  0xf,  0x6b, 0x7a, 0x38, 0x22, 0x78, 0x5f, 0xa7, 0x37, 0x22,
                   0xb9, 0x8e, 0xf4, 0x3a, 0x6a, 0x11, 0x0,  0x1,  0x7c, 0x0,  0x6,  0x24, 0xb9, 0xc,  0x34, 0x77,
                   0xe9, 0x0,  0x15, 0x54, 0xa5, 0xd8, 0x17, 0xb4, 0x70, 0x0,  0x65, 0x3,  0x38, 0x90, 0x10, 0x34,
                   0x14, 0x1d, 0xe2, 0xda, 0x81, 0x1e, 0x1,  0x7a, 0x0,  0x1d, 0xac, 0x7c, 0x3e, 0xa8, 0x26, 0xd0,
                   0xe2, 0xd4, 0xe4, 0x6c, 0x70, 0x1e, 0x77, 0xc4, 0x99, 0x1b, 0xda, 0xb2, 0x6c, 0xcf, 0xd,  0x71,
                   0x67, 0x50, 0x9,  0x9b, 0x24, 0x91, 0x5,  0x0,  0x16, 0x4,  0xf4, 0x9,  0xc8, 0x1d, 0xda, 0xa6,
                   0x7,  0x17, 0x4c, 0xda, 0xbf, 0xc6, 0xb7, 0x82, 0x4f, 0x52, 0x5,  0x6e, 0x97, 0x22, 0x7c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x6b, 0x7a, 0x38, 0x22, 0x78, 0x5f, 0xa7, 0x37,
                                     0x22, 0xb9, 0x8e, 0xf4, 0x3a, 0x6a, 0x11};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7c};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x24, 0xb9, 0xc, 0x34, 0x77, 0xe9};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x54, 0xa5, 0xd8, 0x17, 0xb4, 0x70, 0x0,  0x65, 0x3, 0x38, 0x90,
                                     0x10, 0x34, 0x14, 0x1d, 0xe2, 0xda, 0x81, 0x1e, 0x1, 0x7a};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xac, 0x7c, 0x3e, 0xa8, 0x26, 0xd0, 0xe2, 0xd4, 0xe4, 0x6c,
                                     0x70, 0x1e, 0x77, 0xc4, 0x99, 0x1b, 0xda, 0xb2, 0x6c, 0xcf,
                                     0xd,  0x71, 0x67, 0x50, 0x9,  0x9b, 0x24, 0x91, 0x5};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4,  0xf4, 0x9,  0xc8, 0x1d, 0xda, 0xa6, 0x7,  0x17, 0x4c, 0xda,
                                     0xbf, 0xc6, 0xb7, 0x82, 0x4f, 0x52, 0x5,  0x6e, 0x97, 0x22, 0x7c};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 999, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5737
// ["\216\200`8N","z\226\248\NULq\EOT\232\158\NUL\178\131\247\130\n\240\192\225^","?x\STX-5\217\158\213\253+\165\134\173`#\190\229\177\228\177\183\\\204V","[Q","\190\180u\222#\171\SUBik\221\246\227\164)\239\210\EOT4[-","f\SO\237iS\197T\247\250\167?\228\242\170\213_b\215\241\221\153\136\138\229\175","E}\SUB\221S\172
// \FS\189&}v\220"] [PropUserProperty "\178\171%\133\134\131\203x\200\180\&4C\236\173\133"
// "`\221\NAKfB\RST\195",PropMaximumPacketSize 15484,PropResponseTopic
// "\242tw\US\r\146\"G\146+\201\140\225\134|d\249\a\151^w\232",PropCorrelationData
// "T\204\188\141$\158)\139?S\ETX\SYNbS\185\DEL\249&\131~\233F\128E\245\201N",PropWildcardSubscriptionAvailable
// 118,PropAuthenticationMethod "\207\211\218\137\138\t\SO\EM",PropSubscriptionIdentifier 20,PropMaximumQoS
// 204,PropSharedSubscriptionAvailable 219,PropWildcardSubscriptionAvailable 204,PropReceiveMaximum
// 30300,PropSharedSubscriptionAvailable 43,PropSubscriptionIdentifierAvailable 32,PropCorrelationData
// "\139\135)\198\226\241\166\165\221\RS\144\166\247\128k@\251\213",PropContentType
// "5S(\134\136!#\202\\\175\a",PropContentType
// "\r\149\141\222\209\159k\133\&5U\157\ACK",PropWildcardSubscriptionAvailable 166,PropMessageExpiryInterval
// 32142,PropContentType "\239\215\172\152\182\206\205\163~ [\134\ETX\228A\185",PropPayloadFormatIndicator
// 241,PropTopicAliasMaximum 28855,PropSharedSubscriptionAvailable 18]
TEST(Unsubscribe5QCTest, Encode13) {
  uint8_t pkt[] = {
      0xa2, 0xc4, 0x2,  0x16, 0x69, 0xc7, 0x1,  0x26, 0x0,  0xf,  0xb2, 0xab, 0x25, 0x85, 0x86, 0x83, 0xcb, 0x78, 0xc8,
      0xb4, 0x34, 0x43, 0xec, 0xad, 0x85, 0x0,  0x8,  0x60, 0xdd, 0x15, 0x66, 0x42, 0x1e, 0x54, 0xc3, 0x27, 0x0,  0x0,
      0x3c, 0x7c, 0x8,  0x0,  0x16, 0xf2, 0x74, 0x77, 0x1f, 0xd,  0x92, 0x22, 0x47, 0x92, 0x2b, 0xc9, 0x8c, 0xe1, 0x86,
      0x7c, 0x64, 0xf9, 0x7,  0x97, 0x5e, 0x77, 0xe8, 0x9,  0x0,  0x1b, 0x54, 0xcc, 0xbc, 0x8d, 0x24, 0x9e, 0x29, 0x8b,
      0x3f, 0x53, 0x3,  0x16, 0x62, 0x53, 0xb9, 0x7f, 0xf9, 0x26, 0x83, 0x7e, 0xe9, 0x46, 0x80, 0x45, 0xf5, 0xc9, 0x4e,
      0x28, 0x76, 0x15, 0x0,  0x8,  0xcf, 0xd3, 0xda, 0x89, 0x8a, 0x9,  0xe,  0x19, 0xb,  0x14, 0x24, 0xcc, 0x2a, 0xdb,
      0x28, 0xcc, 0x21, 0x76, 0x5c, 0x2a, 0x2b, 0x29, 0x20, 0x9,  0x0,  0x12, 0x8b, 0x87, 0x29, 0xc6, 0xe2, 0xf1, 0xa6,
      0xa5, 0xdd, 0x1e, 0x90, 0xa6, 0xf7, 0x80, 0x6b, 0x40, 0xfb, 0xd5, 0x3,  0x0,  0xb,  0x35, 0x53, 0x28, 0x86, 0x88,
      0x21, 0x23, 0xca, 0x5c, 0xaf, 0x7,  0x3,  0x0,  0xc,  0xd,  0x95, 0x8d, 0xde, 0xd1, 0x9f, 0x6b, 0x85, 0x35, 0x55,
      0x9d, 0x6,  0x28, 0xa6, 0x2,  0x0,  0x0,  0x7d, 0x8e, 0x3,  0x0,  0x10, 0xef, 0xd7, 0xac, 0x98, 0xb6, 0xce, 0xcd,
      0xa3, 0x7e, 0x20, 0x5b, 0x86, 0x3,  0xe4, 0x41, 0xb9, 0x1,  0xf1, 0x22, 0x70, 0xb7, 0x2a, 0x12, 0x0,  0x5,  0xd8,
      0xc8, 0x60, 0x38, 0x4e, 0x0,  0x12, 0x7a, 0xe2, 0xf8, 0x0,  0x71, 0x4,  0xe8, 0x9e, 0x0,  0xb2, 0x83, 0xf7, 0x82,
      0xa,  0xf0, 0xc0, 0xe1, 0x5e, 0x0,  0x18, 0x3f, 0x78, 0x2,  0x2d, 0x35, 0xd9, 0x9e, 0xd5, 0xfd, 0x2b, 0xa5, 0x86,
      0xad, 0x60, 0x23, 0xbe, 0xe5, 0xb1, 0xe4, 0xb1, 0xb7, 0x5c, 0xcc, 0x56, 0x0,  0x2,  0x5b, 0x51, 0x0,  0x14, 0xbe,
      0xb4, 0x75, 0xde, 0x23, 0xab, 0x1a, 0x69, 0x6b, 0xdd, 0xf6, 0xe3, 0xa4, 0x29, 0xef, 0xd2, 0x4,  0x34, 0x5b, 0x2d,
      0x0,  0x19, 0x66, 0xe,  0xed, 0x69, 0x53, 0xc5, 0x54, 0xf7, 0xfa, 0xa7, 0x3f, 0xe4, 0xf2, 0xaa, 0xd5, 0x5f, 0x62,
      0xd7, 0xf1, 0xdd, 0x99, 0x88, 0x8a, 0xe5, 0xaf, 0x0,  0xd,  0x45, 0x7d, 0x1a, 0xdd, 0x53, 0xac, 0x20, 0x1c, 0xbd,
      0x26, 0x7d, 0x76, 0xdc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x60, 0xdd, 0x15, 0x66, 0x42, 0x1e, 0x54, 0xc3};
  uint8_t bytesprops0[] = {0xb2, 0xab, 0x25, 0x85, 0x86, 0x83, 0xcb, 0x78, 0xc8, 0xb4, 0x34, 0x43, 0xec, 0xad, 0x85};
  uint8_t bytesprops2[] = {0xf2, 0x74, 0x77, 0x1f, 0xd,  0x92, 0x22, 0x47, 0x92, 0x2b, 0xc9,
                           0x8c, 0xe1, 0x86, 0x7c, 0x64, 0xf9, 0x7,  0x97, 0x5e, 0x77, 0xe8};
  uint8_t bytesprops3[] = {0x54, 0xcc, 0xbc, 0x8d, 0x24, 0x9e, 0x29, 0x8b, 0x3f, 0x53, 0x3,  0x16, 0x62, 0x53,
                           0xb9, 0x7f, 0xf9, 0x26, 0x83, 0x7e, 0xe9, 0x46, 0x80, 0x45, 0xf5, 0xc9, 0x4e};
  uint8_t bytesprops4[] = {0xcf, 0xd3, 0xda, 0x89, 0x8a, 0x9, 0xe, 0x19};
  uint8_t bytesprops5[] = {0x8b, 0x87, 0x29, 0xc6, 0xe2, 0xf1, 0xa6, 0xa5, 0xdd,
                           0x1e, 0x90, 0xa6, 0xf7, 0x80, 0x6b, 0x40, 0xfb, 0xd5};
  uint8_t bytesprops6[] = {0x35, 0x53, 0x28, 0x86, 0x88, 0x21, 0x23, 0xca, 0x5c, 0xaf, 0x7};
  uint8_t bytesprops7[] = {0xd, 0x95, 0x8d, 0xde, 0xd1, 0x9f, 0x6b, 0x85, 0x35, 0x55, 0x9d, 0x6};
  uint8_t bytesprops8[] = {0xef, 0xd7, 0xac, 0x98, 0xb6, 0xce, 0xcd, 0xa3,
                           0x7e, 0x20, 0x5b, 0x86, 0x3,  0xe4, 0x41, 0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops0}, .v = {8, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15484}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30300}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32142}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28855}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 18}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xd8, 0xc8, 0x60, 0x38, 0x4e};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7a, 0xe2, 0xf8, 0x0,  0x71, 0x4,  0xe8, 0x9e, 0x0,
                                     0xb2, 0x83, 0xf7, 0x82, 0xa,  0xf0, 0xc0, 0xe1, 0x5e};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x3f, 0x78, 0x2,  0x2d, 0x35, 0xd9, 0x9e, 0xd5, 0xfd, 0x2b, 0xa5, 0x86,
                                     0xad, 0x60, 0x23, 0xbe, 0xe5, 0xb1, 0xe4, 0xb1, 0xb7, 0x5c, 0xcc, 0x56};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5b, 0x51};
  lwmqtt_string_t topic_filter_s3 = {2, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xbe, 0xb4, 0x75, 0xde, 0x23, 0xab, 0x1a, 0x69, 0x6b, 0xdd,
                                     0xf6, 0xe3, 0xa4, 0x29, 0xef, 0xd2, 0x4,  0x34, 0x5b, 0x2d};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x66, 0xe,  0xed, 0x69, 0x53, 0xc5, 0x54, 0xf7, 0xfa, 0xa7, 0x3f, 0xe4, 0xf2,
                                     0xaa, 0xd5, 0x5f, 0x62, 0xd7, 0xf1, 0xdd, 0x99, 0x88, 0x8a, 0xe5, 0xaf};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x45, 0x7d, 0x1a, 0xdd, 0x53, 0xac, 0x20, 0x1c, 0xbd, 0x26, 0x7d, 0x76, 0xdc};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5737, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 1255
// ["\153\GSI\185K\229\aE*T\235?5*(","9\225=)\198\150\245\192\130\194N\204d\137\162(\248\142n","\163\168\DEL\193\254\161\250\166\204\221\231\250\&9\228\202\163\162%\242c\223\217\250\182","\255\201\247\&9\DC4?\255\229\SI\EOT\228fc\ETB\177\225+b\159\&5O\218\ACK\132","\251\n\SYN~\RS\180\172y\RS\f\228\211*\214","Uq\215s\244Y",""]
// [PropTopicAlias 4162,PropPayloadFormatIndicator 254,PropUserProperty
// "5\180\&0\209`\241\DC3Q\153\174O\ETX\bc<<\162[\141\129P\220\216\148\220x"
// "\146S\252\226\\\149\181\202\US\145\b\182\223\234\173\224",PropUserProperty "t\185\147"
// "m\251\147\fY\178\145\135\209\199\248-s0",PropReasonString
// "\231\252\248\150I\STX\176\DLEz\222\201\SI\DC2\NUL\193Q\207* ",PropSubscriptionIdentifier 30,PropMaximumQoS
// 59,PropRetainAvailable 10,PropServerKeepAlive 9939]
TEST(Unsubscribe5QCTest, Encode14) {
  uint8_t pkt[] = {
      0xa2, 0xe0, 0x1,  0x4,  0xe7, 0x69, 0x23, 0x10, 0x42, 0x1,  0xfe, 0x26, 0x0,  0x1a, 0x35, 0xb4, 0x30, 0xd1, 0x60,
      0xf1, 0x13, 0x51, 0x99, 0xae, 0x4f, 0x3,  0x8,  0x63, 0x3c, 0x3c, 0xa2, 0x5b, 0x8d, 0x81, 0x50, 0xdc, 0xd8, 0x94,
      0xdc, 0x78, 0x0,  0x10, 0x92, 0x53, 0xfc, 0xe2, 0x5c, 0x95, 0xb5, 0xca, 0x1f, 0x91, 0x8,  0xb6, 0xdf, 0xea, 0xad,
      0xe0, 0x26, 0x0,  0x3,  0x74, 0xb9, 0x93, 0x0,  0xe,  0x6d, 0xfb, 0x93, 0xc,  0x59, 0xb2, 0x91, 0x87, 0xd1, 0xc7,
      0xf8, 0x2d, 0x73, 0x30, 0x1f, 0x0,  0x13, 0xe7, 0xfc, 0xf8, 0x96, 0x49, 0x2,  0xb0, 0x10, 0x7a, 0xde, 0xc9, 0xf,
      0x12, 0x0,  0xc1, 0x51, 0xcf, 0x2a, 0x20, 0xb,  0x1e, 0x24, 0x3b, 0x25, 0xa,  0x13, 0x26, 0xd3, 0x0,  0xf,  0x99,
      0x1d, 0x49, 0xb9, 0x4b, 0xe5, 0x7,  0x45, 0x2a, 0x54, 0xeb, 0x3f, 0x35, 0x2a, 0x28, 0x0,  0x13, 0x39, 0xe1, 0x3d,
      0x29, 0xc6, 0x96, 0xf5, 0xc0, 0x82, 0xc2, 0x4e, 0xcc, 0x64, 0x89, 0xa2, 0x28, 0xf8, 0x8e, 0x6e, 0x0,  0x18, 0xa3,
      0xa8, 0x7f, 0xc1, 0xfe, 0xa1, 0xfa, 0xa6, 0xcc, 0xdd, 0xe7, 0xfa, 0x39, 0xe4, 0xca, 0xa3, 0xa2, 0x25, 0xf2, 0x63,
      0xdf, 0xd9, 0xfa, 0xb6, 0x0,  0x18, 0xff, 0xc9, 0xf7, 0x39, 0x14, 0x3f, 0xff, 0xe5, 0xf,  0x4,  0xe4, 0x66, 0x63,
      0x17, 0xb1, 0xe1, 0x2b, 0x62, 0x9f, 0x35, 0x4f, 0xda, 0x6,  0x84, 0x0,  0xe,  0xfb, 0xa,  0x16, 0x7e, 0x1e, 0xb4,
      0xac, 0x79, 0x1e, 0xc,  0xe4, 0xd3, 0x2a, 0xd6, 0x0,  0x6,  0x55, 0x71, 0xd7, 0x73, 0xf4, 0x59, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x92, 0x53, 0xfc, 0xe2, 0x5c, 0x95, 0xb5, 0xca,
                           0x1f, 0x91, 0x8,  0xb6, 0xdf, 0xea, 0xad, 0xe0};
  uint8_t bytesprops0[] = {0x35, 0xb4, 0x30, 0xd1, 0x60, 0xf1, 0x13, 0x51, 0x99, 0xae, 0x4f, 0x3,  0x8,
                           0x63, 0x3c, 0x3c, 0xa2, 0x5b, 0x8d, 0x81, 0x50, 0xdc, 0xd8, 0x94, 0xdc, 0x78};
  uint8_t bytesprops3[] = {0x6d, 0xfb, 0x93, 0xc, 0x59, 0xb2, 0x91, 0x87, 0xd1, 0xc7, 0xf8, 0x2d, 0x73, 0x30};
  uint8_t bytesprops2[] = {0x74, 0xb9, 0x93};
  uint8_t bytesprops4[] = {0xe7, 0xfc, 0xf8, 0x96, 0x49, 0x2,  0xb0, 0x10, 0x7a, 0xde,
                           0xc9, 0xf,  0x12, 0x0,  0xc1, 0x51, 0xcf, 0x2a, 0x20};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4162}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops0}, .v = {16, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops2}, .v = {14, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9939}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x99, 0x1d, 0x49, 0xb9, 0x4b, 0xe5, 0x7, 0x45,
                                     0x2a, 0x54, 0xeb, 0x3f, 0x35, 0x2a, 0x28};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x39, 0xe1, 0x3d, 0x29, 0xc6, 0x96, 0xf5, 0xc0, 0x82, 0xc2,
                                     0x4e, 0xcc, 0x64, 0x89, 0xa2, 0x28, 0xf8, 0x8e, 0x6e};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa3, 0xa8, 0x7f, 0xc1, 0xfe, 0xa1, 0xfa, 0xa6, 0xcc, 0xdd, 0xe7, 0xfa,
                                     0x39, 0xe4, 0xca, 0xa3, 0xa2, 0x25, 0xf2, 0x63, 0xdf, 0xd9, 0xfa, 0xb6};
  lwmqtt_string_t topic_filter_s2 = {24, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xff, 0xc9, 0xf7, 0x39, 0x14, 0x3f, 0xff, 0xe5, 0xf,  0x4,  0xe4, 0x66,
                                     0x63, 0x17, 0xb1, 0xe1, 0x2b, 0x62, 0x9f, 0x35, 0x4f, 0xda, 0x6,  0x84};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xfb, 0xa, 0x16, 0x7e, 0x1e, 0xb4, 0xac, 0x79, 0x1e, 0xc, 0xe4, 0xd3, 0x2a, 0xd6};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x55, 0x71, 0xd7, 0x73, 0xf4, 0x59};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 1255, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22682
// ["\DEL\148\206K\136Hx\216\137\137*\209\248*\186\130\163\206@\US%\179s","\232\&0\131\241\219a\152\207V\185\213v\186[\165\191\DC4`K\144\228\194\ETBVgW","\195\211\171c\216\f\DC2\165`\183Pj\228\216~\238@","5\234\US\174\183$\196V\DLE\168\247\255","h7\224\134\254\229\GSn\131_1\200>e","H\ETB\172+\157d!VF\131\157!\EM\201","\179U.\225i\222\SYN\136b\NULw\SOH\187\&1M\135p:","Y\189?\174\nQyM\165.\"\ENQ\140__\192\254\187\228","\239\222\226\181\184\209\133\199\&7O\254\175","\EOT\229\DC4.X\129\129\&5\204;\230"]
// [PropTopicAliasMaximum 15955,PropSubscriptionIdentifierAvailable 218,PropAuthenticationData
// ",'\230\136\175\237L^S",PropMessageExpiryInterval 20146,PropSharedSubscriptionAvailable 119,PropMaximumPacketSize
// 717,PropMaximumQoS 165,PropUserProperty "e\\
// \193\USx\224\213ke\ESC\182\207\&5\145\169\&3\195\165\252\DELw\247l\205tT\147\DC4"
// "\CAN\243\223A\186\155\b\201\206\190m\138\131\252\213<\173\&6\131\184\&5Qc\206",PropAssignedClientIdentifier
// "&\195\165\134\165~UM\243\248\203\&9\ETB|\141*\234\129\149\212",PropServerKeepAlive 16880,PropMessageExpiryInterval
// 32380,PropMessageExpiryInterval 24349,PropTopicAliasMaximum 10485]
TEST(Unsubscribe5QCTest, Encode15) {
  uint8_t pkt[] = {
      0xa2, 0xbe, 0x2,  0x58, 0x9a, 0x80, 0x1,  0x22, 0x3e, 0x53, 0x29, 0xda, 0x16, 0x0,  0x9,  0x2c, 0x27, 0xe6, 0x88,
      0xaf, 0xed, 0x4c, 0x5e, 0x53, 0x2,  0x0,  0x0,  0x4e, 0xb2, 0x2a, 0x77, 0x27, 0x0,  0x0,  0x2,  0xcd, 0x24, 0xa5,
      0x26, 0x0,  0x1d, 0x65, 0x5c, 0x20, 0xc1, 0x1f, 0x78, 0xe0, 0xd5, 0x6b, 0x65, 0x1b, 0xb6, 0xcf, 0x35, 0x91, 0xa9,
      0x33, 0xc3, 0xa5, 0xfc, 0x7f, 0x77, 0xf7, 0x6c, 0xcd, 0x74, 0x54, 0x93, 0x14, 0x0,  0x18, 0x18, 0xf3, 0xdf, 0x41,
      0xba, 0x9b, 0x8,  0xc9, 0xce, 0xbe, 0x6d, 0x8a, 0x83, 0xfc, 0xd5, 0x3c, 0xad, 0x36, 0x83, 0xb8, 0x35, 0x51, 0x63,
      0xce, 0x12, 0x0,  0x14, 0x26, 0xc3, 0xa5, 0x86, 0xa5, 0x7e, 0x55, 0x4d, 0xf3, 0xf8, 0xcb, 0x39, 0x17, 0x7c, 0x8d,
      0x2a, 0xea, 0x81, 0x95, 0xd4, 0x13, 0x41, 0xf0, 0x2,  0x0,  0x0,  0x7e, 0x7c, 0x2,  0x0,  0x0,  0x5f, 0x1d, 0x22,
      0x28, 0xf5, 0x0,  0x17, 0x7f, 0x94, 0xce, 0x4b, 0x88, 0x48, 0x78, 0xd8, 0x89, 0x89, 0x2a, 0xd1, 0xf8, 0x2a, 0xba,
      0x82, 0xa3, 0xce, 0x40, 0x1f, 0x25, 0xb3, 0x73, 0x0,  0x1a, 0xe8, 0x30, 0x83, 0xf1, 0xdb, 0x61, 0x98, 0xcf, 0x56,
      0xb9, 0xd5, 0x76, 0xba, 0x5b, 0xa5, 0xbf, 0x14, 0x60, 0x4b, 0x90, 0xe4, 0xc2, 0x17, 0x56, 0x67, 0x57, 0x0,  0x11,
      0xc3, 0xd3, 0xab, 0x63, 0xd8, 0xc,  0x12, 0xa5, 0x60, 0xb7, 0x50, 0x6a, 0xe4, 0xd8, 0x7e, 0xee, 0x40, 0x0,  0xc,
      0x35, 0xea, 0x1f, 0xae, 0xb7, 0x24, 0xc4, 0x56, 0x10, 0xa8, 0xf7, 0xff, 0x0,  0xe,  0x68, 0x37, 0xe0, 0x86, 0xfe,
      0xe5, 0x1d, 0x6e, 0x83, 0x5f, 0x31, 0xc8, 0x3e, 0x65, 0x0,  0xe,  0x48, 0x17, 0xac, 0x2b, 0x9d, 0x64, 0x21, 0x56,
      0x46, 0x83, 0x9d, 0x21, 0x19, 0xc9, 0x0,  0x12, 0xb3, 0x55, 0x2e, 0xe1, 0x69, 0xde, 0x16, 0x88, 0x62, 0x0,  0x77,
      0x1,  0xbb, 0x31, 0x4d, 0x87, 0x70, 0x3a, 0x0,  0x13, 0x59, 0xbd, 0x3f, 0xae, 0xa,  0x51, 0x79, 0x4d, 0xa5, 0x2e,
      0x22, 0x5,  0x8c, 0x5f, 0x5f, 0xc0, 0xfe, 0xbb, 0xe4, 0x0,  0xc,  0xef, 0xde, 0xe2, 0xb5, 0xb8, 0xd1, 0x85, 0xc7,
      0x37, 0x4f, 0xfe, 0xaf, 0x0,  0xb,  0x4,  0xe5, 0x14, 0x2e, 0x58, 0x81, 0x81, 0x35, 0xcc, 0x3b, 0xe6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2c, 0x27, 0xe6, 0x88, 0xaf, 0xed, 0x4c, 0x5e, 0x53};
  uint8_t bytesprops2[] = {0x18, 0xf3, 0xdf, 0x41, 0xba, 0x9b, 0x8,  0xc9, 0xce, 0xbe, 0x6d, 0x8a,
                           0x83, 0xfc, 0xd5, 0x3c, 0xad, 0x36, 0x83, 0xb8, 0x35, 0x51, 0x63, 0xce};
  uint8_t bytesprops1[] = {0x65, 0x5c, 0x20, 0xc1, 0x1f, 0x78, 0xe0, 0xd5, 0x6b, 0x65, 0x1b, 0xb6, 0xcf, 0x35, 0x91,
                           0xa9, 0x33, 0xc3, 0xa5, 0xfc, 0x7f, 0x77, 0xf7, 0x6c, 0xcd, 0x74, 0x54, 0x93, 0x14};
  uint8_t bytesprops3[] = {0x26, 0xc3, 0xa5, 0x86, 0xa5, 0x7e, 0x55, 0x4d, 0xf3, 0xf8,
                           0xcb, 0x39, 0x17, 0x7c, 0x8d, 0x2a, 0xea, 0x81, 0x95, 0xd4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15955}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20146}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 717}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {24, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16880}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32380}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24349}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10485}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x7f, 0x94, 0xce, 0x4b, 0x88, 0x48, 0x78, 0xd8, 0x89, 0x89, 0x2a, 0xd1,
                                     0xf8, 0x2a, 0xba, 0x82, 0xa3, 0xce, 0x40, 0x1f, 0x25, 0xb3, 0x73};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe8, 0x30, 0x83, 0xf1, 0xdb, 0x61, 0x98, 0xcf, 0x56, 0xb9, 0xd5, 0x76, 0xba,
                                     0x5b, 0xa5, 0xbf, 0x14, 0x60, 0x4b, 0x90, 0xe4, 0xc2, 0x17, 0x56, 0x67, 0x57};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc3, 0xd3, 0xab, 0x63, 0xd8, 0xc,  0x12, 0xa5, 0x60,
                                     0xb7, 0x50, 0x6a, 0xe4, 0xd8, 0x7e, 0xee, 0x40};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x35, 0xea, 0x1f, 0xae, 0xb7, 0x24, 0xc4, 0x56, 0x10, 0xa8, 0xf7, 0xff};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x68, 0x37, 0xe0, 0x86, 0xfe, 0xe5, 0x1d,
                                     0x6e, 0x83, 0x5f, 0x31, 0xc8, 0x3e, 0x65};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x48, 0x17, 0xac, 0x2b, 0x9d, 0x64, 0x21,
                                     0x56, 0x46, 0x83, 0x9d, 0x21, 0x19, 0xc9};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb3, 0x55, 0x2e, 0xe1, 0x69, 0xde, 0x16, 0x88, 0x62,
                                     0x0,  0x77, 0x1,  0xbb, 0x31, 0x4d, 0x87, 0x70, 0x3a};
  lwmqtt_string_t topic_filter_s6 = {18, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x59, 0xbd, 0x3f, 0xae, 0xa,  0x51, 0x79, 0x4d, 0xa5, 0x2e,
                                     0x22, 0x5,  0x8c, 0x5f, 0x5f, 0xc0, 0xfe, 0xbb, 0xe4};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xef, 0xde, 0xe2, 0xb5, 0xb8, 0xd1, 0x85, 0xc7, 0x37, 0x4f, 0xfe, 0xaf};
  lwmqtt_string_t topic_filter_s8 = {12, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x4, 0xe5, 0x14, 0x2e, 0x58, 0x81, 0x81, 0x35, 0xcc, 0x3b, 0xe6};
  lwmqtt_string_t topic_filter_s9 = {11, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22682, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24213 ["\253g\ETX\138\DLEW\170\231\214\133H\RS\206+f|@C\175*,\178\EM"] [PropReasonString
// "\186\180\226c\131\202\223\151\STX`",PropServerReference "x\218\225\CAN\220\235E\DC3t",PropContentType
// "\238c\t\181\SOH\159y\196?\EM\228\241\150",PropPayloadFormatIndicator 49,PropReasonString
// "\177u\EOT\140y\182\SIP\159X",PropSessionExpiryInterval 22727,PropSharedSubscriptionAvailable
// 247,PropWillDelayInterval 17613,PropMaximumQoS 207,PropMaximumPacketSize 23689,PropServerKeepAlive
// 3885,PropContentType "\241,$\a\253H\233\190A\241g\"\184Z\171\233\203Q4\186d\"=\163%M\180",PropSessionExpiryInterval
// 24885,PropMaximumQoS 39,PropServerKeepAlive 2980]
TEST(Unsubscribe5QCTest, Encode16) {
  uint8_t pkt[] = {0xa2, 0x92, 0x1,  0x5e, 0x95, 0x76, 0x1f, 0x0,  0xa,  0xba, 0xb4, 0xe2, 0x63, 0x83, 0xca, 0xdf, 0x97,
                   0x2,  0x60, 0x1c, 0x0,  0x9,  0x78, 0xda, 0xe1, 0x18, 0xdc, 0xeb, 0x45, 0x13, 0x74, 0x3,  0x0,  0xd,
                   0xee, 0x63, 0x9,  0xb5, 0x1,  0x9f, 0x79, 0xc4, 0x3f, 0x19, 0xe4, 0xf1, 0x96, 0x1,  0x31, 0x1f, 0x0,
                   0xa,  0xb1, 0x75, 0x4,  0x8c, 0x79, 0xb6, 0xf,  0x50, 0x9f, 0x58, 0x11, 0x0,  0x0,  0x58, 0xc7, 0x2a,
                   0xf7, 0x18, 0x0,  0x0,  0x44, 0xcd, 0x24, 0xcf, 0x27, 0x0,  0x0,  0x5c, 0x89, 0x13, 0xf,  0x2d, 0x3,
                   0x0,  0x1b, 0xf1, 0x2c, 0x24, 0x7,  0xfd, 0x48, 0xe9, 0xbe, 0x41, 0xf1, 0x67, 0x22, 0xb8, 0x5a, 0xab,
                   0xe9, 0xcb, 0x51, 0x34, 0xba, 0x64, 0x22, 0x3d, 0xa3, 0x25, 0x4d, 0xb4, 0x11, 0x0,  0x0,  0x61, 0x35,
                   0x24, 0x27, 0x13, 0xb,  0xa4, 0x0,  0x17, 0xfd, 0x67, 0x3,  0x8a, 0x10, 0x57, 0xaa, 0xe7, 0xd6, 0x85,
                   0x48, 0x1e, 0xce, 0x2b, 0x66, 0x7c, 0x40, 0x43, 0xaf, 0x2a, 0x2c, 0xb2, 0x19};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xba, 0xb4, 0xe2, 0x63, 0x83, 0xca, 0xdf, 0x97, 0x2, 0x60};
  uint8_t bytesprops1[] = {0x78, 0xda, 0xe1, 0x18, 0xdc, 0xeb, 0x45, 0x13, 0x74};
  uint8_t bytesprops2[] = {0xee, 0x63, 0x9, 0xb5, 0x1, 0x9f, 0x79, 0xc4, 0x3f, 0x19, 0xe4, 0xf1, 0x96};
  uint8_t bytesprops3[] = {0xb1, 0x75, 0x4, 0x8c, 0x79, 0xb6, 0xf, 0x50, 0x9f, 0x58};
  uint8_t bytesprops4[] = {0xf1, 0x2c, 0x24, 0x7,  0xfd, 0x48, 0xe9, 0xbe, 0x41, 0xf1, 0x67, 0x22, 0xb8, 0x5a,
                           0xab, 0xe9, 0xcb, 0x51, 0x34, 0xba, 0x64, 0x22, 0x3d, 0xa3, 0x25, 0x4d, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22727}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17613}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 207}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23689}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3885}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24885}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 2980}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xfd, 0x67, 0x3,  0x8a, 0x10, 0x57, 0xaa, 0xe7, 0xd6, 0x85, 0x48, 0x1e,
                                     0xce, 0x2b, 0x66, 0x7c, 0x40, 0x43, 0xaf, 0x2a, 0x2c, 0xb2, 0x19};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24213, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26833 ["U\246\DEL\"\254\131\166\165\187}
// \200\GShm\235K\206G\207\253\148\237\168#\193","\250","\234\199f)*\128@\216\214'\215\213","\SO\NULF\227\255\SUBc\189X\168\213\213","\DC2Q\176m\\J","!f2>\204\138\CAN\NUL:\235\222"]
// [PropWildcardSubscriptionAvailable 200,PropSharedSubscriptionAvailable 227,PropMessageExpiryInterval
// 13811,PropSubscriptionIdentifier 14,PropServerKeepAlive 18124,PropRequestResponseInformation
// 22,PropAuthenticationData "3;\135\242nm2\175w\164\185\230 \240\194\209\137J,\SIk\129\235",PropAuthenticationData
// "W2",PropReasonString "",PropAuthenticationMethod
// "\141L\254\172y\221\160\177\162Q\253M\139a\175C\214>\SUB\DC1\144\&9'\188f7\195",PropAuthenticationData
// "\131K\255k\244\226\171\205\241"]
TEST(Unsubscribe5QCTest, Encode17) {
  uint8_t pkt[] = {0xa2, 0xaf, 0x1,  0x68, 0xd1, 0x5c, 0x28, 0xc8, 0x2a, 0xe3, 0x2,  0x0,  0x0,  0x35, 0xf3, 0xb,  0xe,
                   0x13, 0x46, 0xcc, 0x19, 0x16, 0x16, 0x0,  0x17, 0x33, 0x3b, 0x87, 0xf2, 0x6e, 0x6d, 0x32, 0xaf, 0x77,
                   0xa4, 0xb9, 0xe6, 0x20, 0xf0, 0xc2, 0xd1, 0x89, 0x4a, 0x2c, 0xf,  0x6b, 0x81, 0xeb, 0x16, 0x0,  0x2,
                   0x57, 0x32, 0x1f, 0x0,  0x0,  0x15, 0x0,  0x1b, 0x8d, 0x4c, 0xfe, 0xac, 0x79, 0xdd, 0xa0, 0xb1, 0xa2,
                   0x51, 0xfd, 0x4d, 0x8b, 0x61, 0xaf, 0x43, 0xd6, 0x3e, 0x1a, 0x11, 0x90, 0x39, 0x27, 0xbc, 0x66, 0x37,
                   0xc3, 0x16, 0x0,  0x9,  0x83, 0x4b, 0xff, 0x6b, 0xf4, 0xe2, 0xab, 0xcd, 0xf1, 0x0,  0x1a, 0x55, 0xf6,
                   0x7f, 0x22, 0xfe, 0x83, 0xa6, 0xa5, 0xbb, 0x7d, 0x20, 0xc8, 0x1d, 0x68, 0x6d, 0xeb, 0x4b, 0xce, 0x47,
                   0xcf, 0xfd, 0x94, 0xed, 0xa8, 0x23, 0xc1, 0x0,  0x1,  0xfa, 0x0,  0xc,  0xea, 0xc7, 0x66, 0x29, 0x2a,
                   0x80, 0x40, 0xd8, 0xd6, 0x27, 0xd7, 0xd5, 0x0,  0xc,  0xe,  0x0,  0x46, 0xe3, 0xff, 0x1a, 0x63, 0xbd,
                   0x58, 0xa8, 0xd5, 0xd5, 0x0,  0x6,  0x12, 0x51, 0xb0, 0x6d, 0x5c, 0x4a, 0x0,  0xb,  0x21, 0x66, 0x32,
                   0x3e, 0xcc, 0x8a, 0x18, 0x0,  0x3a, 0xeb, 0xde};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x33, 0x3b, 0x87, 0xf2, 0x6e, 0x6d, 0x32, 0xaf, 0x77, 0xa4, 0xb9, 0xe6,
                           0x20, 0xf0, 0xc2, 0xd1, 0x89, 0x4a, 0x2c, 0xf,  0x6b, 0x81, 0xeb};
  uint8_t bytesprops1[] = {0x57, 0x32};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops3[] = {0x8d, 0x4c, 0xfe, 0xac, 0x79, 0xdd, 0xa0, 0xb1, 0xa2, 0x51, 0xfd, 0x4d, 0x8b, 0x61,
                           0xaf, 0x43, 0xd6, 0x3e, 0x1a, 0x11, 0x90, 0x39, 0x27, 0xbc, 0x66, 0x37, 0xc3};
  uint8_t bytesprops4[] = {0x83, 0x4b, 0xff, 0x6b, 0xf4, 0xe2, 0xab, 0xcd, 0xf1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13811}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18124}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x55, 0xf6, 0x7f, 0x22, 0xfe, 0x83, 0xa6, 0xa5, 0xbb, 0x7d, 0x20, 0xc8, 0x1d,
                                     0x68, 0x6d, 0xeb, 0x4b, 0xce, 0x47, 0xcf, 0xfd, 0x94, 0xed, 0xa8, 0x23, 0xc1};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfa};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xea, 0xc7, 0x66, 0x29, 0x2a, 0x80, 0x40, 0xd8, 0xd6, 0x27, 0xd7, 0xd5};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe, 0x0, 0x46, 0xe3, 0xff, 0x1a, 0x63, 0xbd, 0x58, 0xa8, 0xd5, 0xd5};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0x51, 0xb0, 0x6d, 0x5c, 0x4a};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x21, 0x66, 0x32, 0x3e, 0xcc, 0x8a, 0x18, 0x0, 0x3a, 0xeb, 0xde};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26833, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24597 ["\t\134\178\219\159\249\235\250\187","\166)\230\184Y\252\r.B"] [PropContentType
// "\240\211\EOT\253M(\135",PropServerKeepAlive 6586,PropReceiveMaximum 11671,PropAssignedClientIdentifier
// ":\151\235;\153&/d'Y\183V\227\212\200\223\148\238\204o\238\230\235\183\189\DC4\DC1",PropAuthenticationMethod
// "\DC1\DC1\207\184\DC4K\159\227\217\DC2\255\150",PropResponseInformation "^:k\148\222z\132\220&^",PropReceiveMaximum
// 9190,PropAuthenticationData "\219\EM\n\186\192\134\DC2\206/w\164T\STX\SO3>",PropUserProperty
// "\141j\SYN\159\212O\254\a\213\142\161?\NAK\255_\190\146\149'\180\169\214\246K@\154\230X"
// "\184\US\175\158\160\&6\153\SUBRRN\199$\219E4\214",PropSharedSubscriptionAvailable 44,PropContentType
// "\142\136\178\137\180\&23t\185\243a\207nB\200;\162w\193n\vX\163`h",PropSubscriptionIdentifier
// 11,PropMaximumPacketSize 24049,PropReceiveMaximum 24721,PropAssignedClientIdentifier
// "\237\FSGN\132j3%\DC3\vb\222\222aN",PropWildcardSubscriptionAvailable 128,PropWildcardSubscriptionAvailable
// 186,PropResponseInformation "]a]\148$\147\209:\204\164\207\155\251\f\143\194+\241\RS\200",PropPayloadFormatIndicator
// 42,PropMessageExpiryInterval 27416,PropMaximumQoS 5,PropTopicAlias 2410,PropReasonString
// "n\189k\144\152\197`}C_\242\SO\ENQ\240\a\ETXV\145\232\198T"]
TEST(Unsubscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0xa2, 0xa5, 0x2,  0x60, 0x15, 0x8b, 0x2,  0x3,  0x0,  0x7,  0xf0, 0xd3, 0x4,  0xfd, 0x4d, 0x28, 0x87, 0x13, 0x19,
      0xba, 0x21, 0x2d, 0x97, 0x12, 0x0,  0x1b, 0x3a, 0x97, 0xeb, 0x3b, 0x99, 0x26, 0x2f, 0x64, 0x27, 0x59, 0xb7, 0x56,
      0xe3, 0xd4, 0xc8, 0xdf, 0x94, 0xee, 0xcc, 0x6f, 0xee, 0xe6, 0xeb, 0xb7, 0xbd, 0x14, 0x11, 0x15, 0x0,  0xc,  0x11,
      0x11, 0xcf, 0xb8, 0x14, 0x4b, 0x9f, 0xe3, 0xd9, 0x12, 0xff, 0x96, 0x1a, 0x0,  0xa,  0x5e, 0x3a, 0x6b, 0x94, 0xde,
      0x7a, 0x84, 0xdc, 0x26, 0x5e, 0x21, 0x23, 0xe6, 0x16, 0x0,  0x10, 0xdb, 0x19, 0xa,  0xba, 0xc0, 0x86, 0x12, 0xce,
      0x2f, 0x77, 0xa4, 0x54, 0x2,  0xe,  0x33, 0x3e, 0x26, 0x0,  0x1c, 0x8d, 0x6a, 0x16, 0x9f, 0xd4, 0x4f, 0xfe, 0x7,
      0xd5, 0x8e, 0xa1, 0x3f, 0x15, 0xff, 0x5f, 0xbe, 0x92, 0x95, 0x27, 0xb4, 0xa9, 0xd6, 0xf6, 0x4b, 0x40, 0x9a, 0xe6,
      0x58, 0x0,  0x11, 0xb8, 0x1f, 0xaf, 0x9e, 0xa0, 0x36, 0x99, 0x1a, 0x52, 0x52, 0x4e, 0xc7, 0x24, 0xdb, 0x45, 0x34,
      0xd6, 0x2a, 0x2c, 0x3,  0x0,  0x19, 0x8e, 0x88, 0xb2, 0x89, 0xb4, 0x32, 0x33, 0x74, 0xb9, 0xf3, 0x61, 0xcf, 0x6e,
      0x42, 0xc8, 0x3b, 0xa2, 0x77, 0xc1, 0x6e, 0xb,  0x58, 0xa3, 0x60, 0x68, 0xb,  0xb,  0x27, 0x0,  0x0,  0x5d, 0xf1,
      0x21, 0x60, 0x91, 0x12, 0x0,  0xf,  0xed, 0x1c, 0x47, 0x4e, 0x84, 0x6a, 0x33, 0x25, 0x13, 0xb,  0x62, 0xde, 0xde,
      0x61, 0x4e, 0x28, 0x80, 0x28, 0xba, 0x1a, 0x0,  0x14, 0x5d, 0x61, 0x5d, 0x94, 0x24, 0x93, 0xd1, 0x3a, 0xcc, 0xa4,
      0xcf, 0x9b, 0xfb, 0xc,  0x8f, 0xc2, 0x2b, 0xf1, 0x1e, 0xc8, 0x1,  0x2a, 0x2,  0x0,  0x0,  0x6b, 0x18, 0x24, 0x5,
      0x23, 0x9,  0x6a, 0x1f, 0x0,  0x15, 0x6e, 0xbd, 0x6b, 0x90, 0x98, 0xc5, 0x60, 0x7d, 0x43, 0x5f, 0xf2, 0xe,  0x5,
      0xf0, 0x7,  0x3,  0x56, 0x91, 0xe8, 0xc6, 0x54, 0x0,  0x9,  0x9,  0x86, 0xb2, 0xdb, 0x9f, 0xf9, 0xeb, 0xfa, 0xbb,
      0x0,  0x9,  0xa6, 0x29, 0xe6, 0xb8, 0x59, 0xfc, 0xd,  0x2e, 0x42};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf0, 0xd3, 0x4, 0xfd, 0x4d, 0x28, 0x87};
  uint8_t bytesprops1[] = {0x3a, 0x97, 0xeb, 0x3b, 0x99, 0x26, 0x2f, 0x64, 0x27, 0x59, 0xb7, 0x56, 0xe3, 0xd4,
                           0xc8, 0xdf, 0x94, 0xee, 0xcc, 0x6f, 0xee, 0xe6, 0xeb, 0xb7, 0xbd, 0x14, 0x11};
  uint8_t bytesprops2[] = {0x11, 0x11, 0xcf, 0xb8, 0x14, 0x4b, 0x9f, 0xe3, 0xd9, 0x12, 0xff, 0x96};
  uint8_t bytesprops3[] = {0x5e, 0x3a, 0x6b, 0x94, 0xde, 0x7a, 0x84, 0xdc, 0x26, 0x5e};
  uint8_t bytesprops4[] = {0xdb, 0x19, 0xa, 0xba, 0xc0, 0x86, 0x12, 0xce, 0x2f, 0x77, 0xa4, 0x54, 0x2, 0xe, 0x33, 0x3e};
  uint8_t bytesprops6[] = {0xb8, 0x1f, 0xaf, 0x9e, 0xa0, 0x36, 0x99, 0x1a, 0x52,
                           0x52, 0x4e, 0xc7, 0x24, 0xdb, 0x45, 0x34, 0xd6};
  uint8_t bytesprops5[] = {0x8d, 0x6a, 0x16, 0x9f, 0xd4, 0x4f, 0xfe, 0x7,  0xd5, 0x8e, 0xa1, 0x3f, 0x15, 0xff,
                           0x5f, 0xbe, 0x92, 0x95, 0x27, 0xb4, 0xa9, 0xd6, 0xf6, 0x4b, 0x40, 0x9a, 0xe6, 0x58};
  uint8_t bytesprops7[] = {0x8e, 0x88, 0xb2, 0x89, 0xb4, 0x32, 0x33, 0x74, 0xb9, 0xf3, 0x61, 0xcf, 0x6e,
                           0x42, 0xc8, 0x3b, 0xa2, 0x77, 0xc1, 0x6e, 0xb,  0x58, 0xa3, 0x60, 0x68};
  uint8_t bytesprops8[] = {0xed, 0x1c, 0x47, 0x4e, 0x84, 0x6a, 0x33, 0x25, 0x13, 0xb, 0x62, 0xde, 0xde, 0x61, 0x4e};
  uint8_t bytesprops9[] = {0x5d, 0x61, 0x5d, 0x94, 0x24, 0x93, 0xd1, 0x3a, 0xcc, 0xa4,
                           0xcf, 0x9b, 0xfb, 0xc,  0x8f, 0xc2, 0x2b, 0xf1, 0x1e, 0xc8};
  uint8_t bytesprops10[] = {0x6e, 0xbd, 0x6b, 0x90, 0x98, 0xc5, 0x60, 0x7d, 0x43, 0x5f, 0xf2,
                            0xe,  0x5,  0xf0, 0x7,  0x3,  0x56, 0x91, 0xe8, 0xc6, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6586}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11671}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9190}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops5}, .v = {17, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24049}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24721}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27416}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2410}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x9, 0x86, 0xb2, 0xdb, 0x9f, 0xf9, 0xeb, 0xfa, 0xbb};
  lwmqtt_string_t topic_filter_s0 = {9, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa6, 0x29, 0xe6, 0xb8, 0x59, 0xfc, 0xd, 0x2e, 0x42};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24597, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17778
// ["\136x\150\168\US\251\133\245\161\132","","\156","\b\158G{\v-Ms1\169\219\152\168\DC4\152\236\156\169\r
// L{\144]w<\161","^\n\242r\171T8\161Q\v\135\252\STX8r\191\232\164\NUL\USM\199\151|8G\166","y\b\179\128O\138\242\240@2\163\187~\137\EOT\212\&2\EOT\167\\}f\170:\169x\186~","\b4\215\223kA\248\252\v\173\218\f\217.\171O\210\199\&4\ETX\NULk\f7~\151\&5\142\USL","\223\248\DC3<\163N\164?\DC2%\ENQ\251\214\223\&4\239\&13_3\DEL\SYN*c\NUL\ETX","\215\DC1\218\DC1l\160\ESCV@L\v$\203\195","\221M\253c3\176\146Y\151\250\249^YYC\182n`\ENQg\203s\198\249\232"]
// [PropResponseTopic
// "\255\217W=\224\165\251\223b\157q\154l\236\208\160\211\157\155~\175\230\247x\213G\150",PropSessionExpiryInterval
// 21312,PropServerKeepAlive 11757]
TEST(Unsubscribe5QCTest, Encode19) {
  uint8_t pkt[] = {0xa2, 0xf9, 0x1,  0x45, 0x72, 0x26, 0x8,  0x0,  0x1b, 0xff, 0xd9, 0x57, 0x3d, 0xe0, 0xa5, 0xfb, 0xdf,
                   0x62, 0x9d, 0x71, 0x9a, 0x6c, 0xec, 0xd0, 0xa0, 0xd3, 0x9d, 0x9b, 0x7e, 0xaf, 0xe6, 0xf7, 0x78, 0xd5,
                   0x47, 0x96, 0x11, 0x0,  0x0,  0x53, 0x40, 0x13, 0x2d, 0xed, 0x0,  0xa,  0x88, 0x78, 0x96, 0xa8, 0x1f,
                   0xfb, 0x85, 0xf5, 0xa1, 0x84, 0x0,  0x0,  0x0,  0x1,  0x9c, 0x0,  0x1b, 0x8,  0x9e, 0x47, 0x7b, 0xb,
                   0x2d, 0x4d, 0x73, 0x31, 0xa9, 0xdb, 0x98, 0xa8, 0x14, 0x98, 0xec, 0x9c, 0xa9, 0xd,  0x20, 0x4c, 0x7b,
                   0x90, 0x5d, 0x77, 0x3c, 0xa1, 0x0,  0x1b, 0x5e, 0xa,  0xf2, 0x72, 0xab, 0x54, 0x38, 0xa1, 0x51, 0xb,
                   0x87, 0xfc, 0x2,  0x38, 0x72, 0xbf, 0xe8, 0xa4, 0x0,  0x1f, 0x4d, 0xc7, 0x97, 0x7c, 0x38, 0x47, 0xa6,
                   0x0,  0x1c, 0x79, 0x8,  0xb3, 0x80, 0x4f, 0x8a, 0xf2, 0xf0, 0x40, 0x32, 0xa3, 0xbb, 0x7e, 0x89, 0x4,
                   0xd4, 0x32, 0x4,  0xa7, 0x5c, 0x7d, 0x66, 0xaa, 0x3a, 0xa9, 0x78, 0xba, 0x7e, 0x0,  0x1e, 0x8,  0x34,
                   0xd7, 0xdf, 0x6b, 0x41, 0xf8, 0xfc, 0xb,  0xad, 0xda, 0xc,  0xd9, 0x2e, 0xab, 0x4f, 0xd2, 0xc7, 0x34,
                   0x3,  0x0,  0x6b, 0xc,  0x37, 0x7e, 0x97, 0x35, 0x8e, 0x1f, 0x4c, 0x0,  0x1a, 0xdf, 0xf8, 0x13, 0x3c,
                   0xa3, 0x4e, 0xa4, 0x3f, 0x12, 0x25, 0x5,  0xfb, 0xd6, 0xdf, 0x34, 0xef, 0x31, 0x33, 0x5f, 0x33, 0x7f,
                   0x16, 0x2a, 0x63, 0x0,  0x3,  0x0,  0xe,  0xd7, 0x11, 0xda, 0x11, 0x6c, 0xa0, 0x1b, 0x56, 0x40, 0x4c,
                   0xb,  0x24, 0xcb, 0xc3, 0x0,  0x19, 0xdd, 0x4d, 0xfd, 0x63, 0x33, 0xb0, 0x92, 0x59, 0x97, 0xfa, 0xf9,
                   0x5e, 0x59, 0x59, 0x43, 0xb6, 0x6e, 0x60, 0x5,  0x67, 0xcb, 0x73, 0xc6, 0xf9, 0xe8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xff, 0xd9, 0x57, 0x3d, 0xe0, 0xa5, 0xfb, 0xdf, 0x62, 0x9d, 0x71, 0x9a, 0x6c, 0xec,
                           0xd0, 0xa0, 0xd3, 0x9d, 0x9b, 0x7e, 0xaf, 0xe6, 0xf7, 0x78, 0xd5, 0x47, 0x96};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21312}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11757}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x88, 0x78, 0x96, 0xa8, 0x1f, 0xfb, 0x85, 0xf5, 0xa1, 0x84};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9c};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8,  0x9e, 0x47, 0x7b, 0xb, 0x2d, 0x4d, 0x73, 0x31, 0xa9, 0xdb, 0x98, 0xa8, 0x14,
                                     0x98, 0xec, 0x9c, 0xa9, 0xd, 0x20, 0x4c, 0x7b, 0x90, 0x5d, 0x77, 0x3c, 0xa1};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5e, 0xa,  0xf2, 0x72, 0xab, 0x54, 0x38, 0xa1, 0x51, 0xb,  0x87, 0xfc, 0x2, 0x38,
                                     0x72, 0xbf, 0xe8, 0xa4, 0x0,  0x1f, 0x4d, 0xc7, 0x97, 0x7c, 0x38, 0x47, 0xa6};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x79, 0x8,  0xb3, 0x80, 0x4f, 0x8a, 0xf2, 0xf0, 0x40, 0x32,
                                     0xa3, 0xbb, 0x7e, 0x89, 0x4,  0xd4, 0x32, 0x4,  0xa7, 0x5c,
                                     0x7d, 0x66, 0xaa, 0x3a, 0xa9, 0x78, 0xba, 0x7e};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x8,  0x34, 0xd7, 0xdf, 0x6b, 0x41, 0xf8, 0xfc, 0xb,  0xad,
                                     0xda, 0xc,  0xd9, 0x2e, 0xab, 0x4f, 0xd2, 0xc7, 0x34, 0x3,
                                     0x0,  0x6b, 0xc,  0x37, 0x7e, 0x97, 0x35, 0x8e, 0x1f, 0x4c};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xdf, 0xf8, 0x13, 0x3c, 0xa3, 0x4e, 0xa4, 0x3f, 0x12, 0x25, 0x5,  0xfb, 0xd6,
                                     0xdf, 0x34, 0xef, 0x31, 0x33, 0x5f, 0x33, 0x7f, 0x16, 0x2a, 0x63, 0x0,  0x3};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd7, 0x11, 0xda, 0x11, 0x6c, 0xa0, 0x1b, 0x56, 0x40, 0x4c, 0xb, 0x24, 0xcb, 0xc3};
  lwmqtt_string_t topic_filter_s8 = {14, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xdd, 0x4d, 0xfd, 0x63, 0x33, 0xb0, 0x92, 0x59, 0x97, 0xfa, 0xf9, 0x5e, 0x59,
                                     0x59, 0x43, 0xb6, 0x6e, 0x60, 0x5,  0x67, 0xcb, 0x73, 0xc6, 0xf9, 0xe8};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17778, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 4976
// ["_\190\245~5\207\156\SOHtV\FSY\253Gq\220\&8R\"\148","\CAN\141\210\134\ETBEiWm\158\t}\150O\175\CANHzh\157]q\173BuK\182p","\SUB\156\FS\ENQo#V\174\SYN\EM\150\161\a\231S\236\217\251\185\142\186\216\132\DC1I\"\172=5","\200d\202\182\185\147","\196\172'","kx\GS\134,&\222\152\&0\US\188\202zs\141g\170\174\164\SUB\246\184Wd\135\237","\254\207M\NAK\202g\EOT\135\186\213.\229\222\152","=\137\241~\EOTl","&\"","6\239R\208\161@\FS\US\250\170`\SUB\155{"]
// [PropWildcardSubscriptionAvailable 188,PropAssignedClientIdentifier
// ">\243{6\aL\141y\146\192Z\159\&1",PropCorrelationData
// "\223\153\146\190\DC1\155P\EOT\191\211\133+y\218\250\DC31Ah\181\&4",PropMaximumQoS 228,PropTopicAlias
// 31268,PropPayloadFormatIndicator 132,PropSessionExpiryInterval 6581,PropAuthenticationData "F",PropWillDelayInterval
// 5403,PropCorrelationData "\254j\232\SOHY{\251Wg\136r\NUL\193)`\223\241\252fs",PropAuthenticationMethod
// "w\EOT\202\ACK\152\\\US>\211#\ETBm\235\163\&1\233\169a\241)\253\173",PropMaximumPacketSize
// 26144,PropWildcardSubscriptionAvailable 252,PropContentType "\132\ETBvZM\164\195\191;\133\EMt\195\202[\213
// ",PropContentType
// "\242r\227f\210\SYN\NUL{\255\t\226k_z\161d\161\199\DC3\SI\221\DC2\137\ETB\238\DLE-\157\235X",PropMaximumPacketSize
// 9944,PropRetainAvailable 146]
TEST(Unsubscribe5QCTest, Encode20) {
  uint8_t pkt[] = {
      0xa2, 0xde, 0x2,  0x13, 0x70, 0xb2, 0x1,  0x28, 0xbc, 0x12, 0x0,  0xd,  0x3e, 0xf3, 0x7b, 0x36, 0x7,  0x4c, 0x8d,
      0x79, 0x92, 0xc0, 0x5a, 0x9f, 0x31, 0x9,  0x0,  0x15, 0xdf, 0x99, 0x92, 0xbe, 0x11, 0x9b, 0x50, 0x4,  0xbf, 0xd3,
      0x85, 0x2b, 0x79, 0xda, 0xfa, 0x13, 0x31, 0x41, 0x68, 0xb5, 0x34, 0x24, 0xe4, 0x23, 0x7a, 0x24, 0x1,  0x84, 0x11,
      0x0,  0x0,  0x19, 0xb5, 0x16, 0x0,  0x1,  0x46, 0x18, 0x0,  0x0,  0x15, 0x1b, 0x9,  0x0,  0x14, 0xfe, 0x6a, 0xe8,
      0x1,  0x59, 0x7b, 0xfb, 0x57, 0x67, 0x88, 0x72, 0x0,  0xc1, 0x29, 0x60, 0xdf, 0xf1, 0xfc, 0x66, 0x73, 0x15, 0x0,
      0x16, 0x77, 0x4,  0xca, 0x6,  0x98, 0x5c, 0x1f, 0x3e, 0xd3, 0x23, 0x17, 0x6d, 0xeb, 0xa3, 0x31, 0xe9, 0xa9, 0x61,
      0xf1, 0x29, 0xfd, 0xad, 0x27, 0x0,  0x0,  0x66, 0x20, 0x28, 0xfc, 0x3,  0x0,  0x11, 0x84, 0x17, 0x76, 0x5a, 0x4d,
      0xa4, 0xc3, 0xbf, 0x3b, 0x85, 0x19, 0x74, 0xc3, 0xca, 0x5b, 0xd5, 0x20, 0x3,  0x0,  0x1e, 0xf2, 0x72, 0xe3, 0x66,
      0xd2, 0x16, 0x0,  0x7b, 0xff, 0x9,  0xe2, 0x6b, 0x5f, 0x7a, 0xa1, 0x64, 0xa1, 0xc7, 0x13, 0xf,  0xdd, 0x12, 0x89,
      0x17, 0xee, 0x10, 0x2d, 0x9d, 0xeb, 0x58, 0x27, 0x0,  0x0,  0x26, 0xd8, 0x25, 0x92, 0x0,  0x14, 0x5f, 0xbe, 0xf5,
      0x7e, 0x35, 0xcf, 0x9c, 0x1,  0x74, 0x56, 0x1c, 0x59, 0xfd, 0x47, 0x71, 0xdc, 0x38, 0x52, 0x22, 0x94, 0x0,  0x1c,
      0x18, 0x8d, 0xd2, 0x86, 0x17, 0x45, 0x69, 0x57, 0x6d, 0x9e, 0x9,  0x7d, 0x96, 0x4f, 0xaf, 0x18, 0x48, 0x7a, 0x68,
      0x9d, 0x5d, 0x71, 0xad, 0x42, 0x75, 0x4b, 0xb6, 0x70, 0x0,  0x1d, 0x1a, 0x9c, 0x1c, 0x5,  0x6f, 0x23, 0x56, 0xae,
      0x16, 0x19, 0x96, 0xa1, 0x7,  0xe7, 0x53, 0xec, 0xd9, 0xfb, 0xb9, 0x8e, 0xba, 0xd8, 0x84, 0x11, 0x49, 0x22, 0xac,
      0x3d, 0x35, 0x0,  0x6,  0xc8, 0x64, 0xca, 0xb6, 0xb9, 0x93, 0x0,  0x3,  0xc4, 0xac, 0x27, 0x0,  0x1a, 0x6b, 0x78,
      0x1d, 0x86, 0x2c, 0x26, 0xde, 0x98, 0x30, 0x1f, 0xbc, 0xca, 0x7a, 0x73, 0x8d, 0x67, 0xaa, 0xae, 0xa4, 0x1a, 0xf6,
      0xb8, 0x57, 0x64, 0x87, 0xed, 0x0,  0xe,  0xfe, 0xcf, 0x4d, 0x15, 0xca, 0x67, 0x4,  0x87, 0xba, 0xd5, 0x2e, 0xe5,
      0xde, 0x98, 0x0,  0x6,  0x3d, 0x89, 0xf1, 0x7e, 0x4,  0x6c, 0x0,  0x2,  0x26, 0x22, 0x0,  0xe,  0x36, 0xef, 0x52,
      0xd0, 0xa1, 0x40, 0x1c, 0x1f, 0xfa, 0xaa, 0x60, 0x1a, 0x9b, 0x7b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3e, 0xf3, 0x7b, 0x36, 0x7, 0x4c, 0x8d, 0x79, 0x92, 0xc0, 0x5a, 0x9f, 0x31};
  uint8_t bytesprops1[] = {0xdf, 0x99, 0x92, 0xbe, 0x11, 0x9b, 0x50, 0x4,  0xbf, 0xd3, 0x85,
                           0x2b, 0x79, 0xda, 0xfa, 0x13, 0x31, 0x41, 0x68, 0xb5, 0x34};
  uint8_t bytesprops2[] = {0x46};
  uint8_t bytesprops3[] = {0xfe, 0x6a, 0xe8, 0x1,  0x59, 0x7b, 0xfb, 0x57, 0x67, 0x88,
                           0x72, 0x0,  0xc1, 0x29, 0x60, 0xdf, 0xf1, 0xfc, 0x66, 0x73};
  uint8_t bytesprops4[] = {0x77, 0x4,  0xca, 0x6,  0x98, 0x5c, 0x1f, 0x3e, 0xd3, 0x23, 0x17,
                           0x6d, 0xeb, 0xa3, 0x31, 0xe9, 0xa9, 0x61, 0xf1, 0x29, 0xfd, 0xad};
  uint8_t bytesprops5[] = {0x84, 0x17, 0x76, 0x5a, 0x4d, 0xa4, 0xc3, 0xbf, 0x3b,
                           0x85, 0x19, 0x74, 0xc3, 0xca, 0x5b, 0xd5, 0x20};
  uint8_t bytesprops6[] = {0xf2, 0x72, 0xe3, 0x66, 0xd2, 0x16, 0x0,  0x7b, 0xff, 0x9,  0xe2, 0x6b, 0x5f, 0x7a, 0xa1,
                           0x64, 0xa1, 0xc7, 0x13, 0xf,  0xdd, 0x12, 0x89, 0x17, 0xee, 0x10, 0x2d, 0x9d, 0xeb, 0x58};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31268}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6581}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5403}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26144}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9944}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 146}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x5f, 0xbe, 0xf5, 0x7e, 0x35, 0xcf, 0x9c, 0x1,  0x74, 0x56,
                                     0x1c, 0x59, 0xfd, 0x47, 0x71, 0xdc, 0x38, 0x52, 0x22, 0x94};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x18, 0x8d, 0xd2, 0x86, 0x17, 0x45, 0x69, 0x57, 0x6d, 0x9e,
                                     0x9,  0x7d, 0x96, 0x4f, 0xaf, 0x18, 0x48, 0x7a, 0x68, 0x9d,
                                     0x5d, 0x71, 0xad, 0x42, 0x75, 0x4b, 0xb6, 0x70};
  lwmqtt_string_t topic_filter_s1 = {28, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0x9c, 0x1c, 0x5,  0x6f, 0x23, 0x56, 0xae, 0x16, 0x19,
                                     0x96, 0xa1, 0x7,  0xe7, 0x53, 0xec, 0xd9, 0xfb, 0xb9, 0x8e,
                                     0xba, 0xd8, 0x84, 0x11, 0x49, 0x22, 0xac, 0x3d, 0x35};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc8, 0x64, 0xca, 0xb6, 0xb9, 0x93};
  lwmqtt_string_t topic_filter_s3 = {6, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc4, 0xac, 0x27};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6b, 0x78, 0x1d, 0x86, 0x2c, 0x26, 0xde, 0x98, 0x30, 0x1f, 0xbc, 0xca, 0x7a,
                                     0x73, 0x8d, 0x67, 0xaa, 0xae, 0xa4, 0x1a, 0xf6, 0xb8, 0x57, 0x64, 0x87, 0xed};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xfe, 0xcf, 0x4d, 0x15, 0xca, 0x67, 0x4, 0x87, 0xba, 0xd5, 0x2e, 0xe5, 0xde, 0x98};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x3d, 0x89, 0xf1, 0x7e, 0x4, 0x6c};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x26, 0x22};
  lwmqtt_string_t topic_filter_s8 = {2, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x36, 0xef, 0x52, 0xd0, 0xa1, 0x40, 0x1c,
                                     0x1f, 0xfa, 0xaa, 0x60, 0x1a, 0x9b, 0x7b};
  lwmqtt_string_t topic_filter_s9 = {14, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4976, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 12973
// ["\DC1As\216\DLE\214\246\194\220\178\DC3\NULON\198\226\147P\205\SO\129\&4\RS\DC3\206","\171\&0\204\160\CAN.\142\255
// \134\198\220\DEL@\163\216\&2\165\142\225\208","^\163\204\213TZ\"\SO","\136!\167=\170\214\"\232\ESC
// \216\174%\ENQ]\219\133}\226\235","J\182\bT\140Z","\188n\150\191L#\NAK\197\136\194[\192m\141\196\n\211\252","\195\157\173\ACKh\DEL\178\230\r","e(y\DC3\r|+\138\216\196*\227~\180\140DX\250\181\135#\214#;!\225\161\201","1\252\225\175\STX\172\236\SYN\176\&2\"\204\v\RS\b\189","\218\181\178\245x\187\245\167\&5\144\249L:\209\146"]
// [PropReasonString "\197\173\128\210\&6^E\180y\CAN\152\"\149",PropServerKeepAlive 31457,PropResponseTopic
// "\140\142;]\130\155\161\DEL\179\200\204D9\226\228\193\255\138M^\171\254\141\136v\181\199\135\GS",PropAuthenticationMethod
// "\EM\225\243\176\175?\247\201\ENQ\SOHF\244\NUL\239\&8b\208\220\DEL\240\255%",PropPayloadFormatIndicator
// 109,PropSubscriptionIdentifier 23,PropRequestResponseInformation 219,PropCorrelationData "\DC3\129\EMQ
// Y\DC3R\140\DC1/R\139",PropSubscriptionIdentifierAvailable 137,PropResponseTopic
// "\252{\129\169\EMr\214\&4\205\226O\156\198\GS;}\242_hnG\226\225\EM\219.\215\233\232",PropAssignedClientIdentifier
// "\STXA",PropWildcardSubscriptionAvailable 230,PropAssignedClientIdentifier
// "\238\192\187%a_\SOH\175/x\DEL\162\&4\SO\217\SO\213\242:\170\233O\158\EM[|",PropTopicAlias 26429,PropReasonString
// "\135\\h\193n\214-+2D\180\rg\177r\255`//\186]\206\157D"]
TEST(Unsubscribe5QCTest, Encode21) {
  uint8_t pkt[] = {
      0xa2, 0x84, 0x3,  0x32, 0xad, 0xc6, 0x1,  0x1f, 0x0,  0xd,  0xc5, 0xad, 0x80, 0xd2, 0x36, 0x5e, 0x45, 0xb4, 0x79,
      0x18, 0x98, 0x22, 0x95, 0x13, 0x7a, 0xe1, 0x8,  0x0,  0x1d, 0x8c, 0x8e, 0x3b, 0x5d, 0x82, 0x9b, 0xa1, 0x7f, 0xb3,
      0xc8, 0xcc, 0x44, 0x39, 0xe2, 0xe4, 0xc1, 0xff, 0x8a, 0x4d, 0x5e, 0xab, 0xfe, 0x8d, 0x88, 0x76, 0xb5, 0xc7, 0x87,
      0x1d, 0x15, 0x0,  0x16, 0x19, 0xe1, 0xf3, 0xb0, 0xaf, 0x3f, 0xf7, 0xc9, 0x5,  0x1,  0x46, 0xf4, 0x0,  0xef, 0x38,
      0x62, 0xd0, 0xdc, 0x7f, 0xf0, 0xff, 0x25, 0x1,  0x6d, 0xb,  0x17, 0x19, 0xdb, 0x9,  0x0,  0xd,  0x13, 0x81, 0x19,
      0x51, 0x20, 0x59, 0x13, 0x52, 0x8c, 0x11, 0x2f, 0x52, 0x8b, 0x29, 0x89, 0x8,  0x0,  0x1d, 0xfc, 0x7b, 0x81, 0xa9,
      0x19, 0x72, 0xd6, 0x34, 0xcd, 0xe2, 0x4f, 0x9c, 0xc6, 0x1d, 0x3b, 0x7d, 0xf2, 0x5f, 0x68, 0x6e, 0x47, 0xe2, 0xe1,
      0x19, 0xdb, 0x2e, 0xd7, 0xe9, 0xe8, 0x12, 0x0,  0x2,  0x2,  0x41, 0x28, 0xe6, 0x12, 0x0,  0x1a, 0xee, 0xc0, 0xbb,
      0x25, 0x61, 0x5f, 0x1,  0xaf, 0x2f, 0x78, 0x7f, 0xa2, 0x34, 0xe,  0xd9, 0xe,  0xd5, 0xf2, 0x3a, 0xaa, 0xe9, 0x4f,
      0x9e, 0x19, 0x5b, 0x7c, 0x23, 0x67, 0x3d, 0x1f, 0x0,  0x18, 0x87, 0x5c, 0x68, 0xc1, 0x6e, 0xd6, 0x2d, 0x2b, 0x32,
      0x44, 0xb4, 0xd,  0x67, 0xb1, 0x72, 0xff, 0x60, 0x2f, 0x2f, 0xba, 0x5d, 0xce, 0x9d, 0x44, 0x0,  0x19, 0x11, 0x41,
      0x73, 0xd8, 0x10, 0xd6, 0xf6, 0xc2, 0xdc, 0xb2, 0x13, 0x0,  0x4f, 0x4e, 0xc6, 0xe2, 0x93, 0x50, 0xcd, 0xe,  0x81,
      0x34, 0x1e, 0x13, 0xce, 0x0,  0x15, 0xab, 0x30, 0xcc, 0xa0, 0x18, 0x2e, 0x8e, 0xff, 0x20, 0x86, 0xc6, 0xdc, 0x7f,
      0x40, 0xa3, 0xd8, 0x32, 0xa5, 0x8e, 0xe1, 0xd0, 0x0,  0x8,  0x5e, 0xa3, 0xcc, 0xd5, 0x54, 0x5a, 0x22, 0xe,  0x0,
      0x14, 0x88, 0x21, 0xa7, 0x3d, 0xaa, 0xd6, 0x22, 0xe8, 0x1b, 0x20, 0xd8, 0xae, 0x25, 0x5,  0x5d, 0xdb, 0x85, 0x7d,
      0xe2, 0xeb, 0x0,  0x6,  0x4a, 0xb6, 0x8,  0x54, 0x8c, 0x5a, 0x0,  0x12, 0xbc, 0x6e, 0x96, 0xbf, 0x4c, 0x23, 0x15,
      0xc5, 0x88, 0xc2, 0x5b, 0xc0, 0x6d, 0x8d, 0xc4, 0xa,  0xd3, 0xfc, 0x0,  0x9,  0xc3, 0x9d, 0xad, 0x6,  0x68, 0x7f,
      0xb2, 0xe6, 0xd,  0x0,  0x1c, 0x65, 0x28, 0x79, 0x13, 0xd,  0x7c, 0x2b, 0x8a, 0xd8, 0xc4, 0x2a, 0xe3, 0x7e, 0xb4,
      0x8c, 0x44, 0x58, 0xfa, 0xb5, 0x87, 0x23, 0xd6, 0x23, 0x3b, 0x21, 0xe1, 0xa1, 0xc9, 0x0,  0x10, 0x31, 0xfc, 0xe1,
      0xaf, 0x2,  0xac, 0xec, 0x16, 0xb0, 0x32, 0x22, 0xcc, 0xb,  0x1e, 0x8,  0xbd, 0x0,  0xf,  0xda, 0xb5, 0xb2, 0xf5,
      0x78, 0xbb, 0xf5, 0xa7, 0x35, 0x90, 0xf9, 0x4c, 0x3a, 0xd1, 0x92};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc5, 0xad, 0x80, 0xd2, 0x36, 0x5e, 0x45, 0xb4, 0x79, 0x18, 0x98, 0x22, 0x95};
  uint8_t bytesprops1[] = {0x8c, 0x8e, 0x3b, 0x5d, 0x82, 0x9b, 0xa1, 0x7f, 0xb3, 0xc8, 0xcc, 0x44, 0x39, 0xe2, 0xe4,
                           0xc1, 0xff, 0x8a, 0x4d, 0x5e, 0xab, 0xfe, 0x8d, 0x88, 0x76, 0xb5, 0xc7, 0x87, 0x1d};
  uint8_t bytesprops2[] = {0x19, 0xe1, 0xf3, 0xb0, 0xaf, 0x3f, 0xf7, 0xc9, 0x5,  0x1,  0x46,
                           0xf4, 0x0,  0xef, 0x38, 0x62, 0xd0, 0xdc, 0x7f, 0xf0, 0xff, 0x25};
  uint8_t bytesprops3[] = {0x13, 0x81, 0x19, 0x51, 0x20, 0x59, 0x13, 0x52, 0x8c, 0x11, 0x2f, 0x52, 0x8b};
  uint8_t bytesprops4[] = {0xfc, 0x7b, 0x81, 0xa9, 0x19, 0x72, 0xd6, 0x34, 0xcd, 0xe2, 0x4f, 0x9c, 0xc6, 0x1d, 0x3b,
                           0x7d, 0xf2, 0x5f, 0x68, 0x6e, 0x47, 0xe2, 0xe1, 0x19, 0xdb, 0x2e, 0xd7, 0xe9, 0xe8};
  uint8_t bytesprops5[] = {0x2, 0x41};
  uint8_t bytesprops6[] = {0xee, 0xc0, 0xbb, 0x25, 0x61, 0x5f, 0x1,  0xaf, 0x2f, 0x78, 0x7f, 0xa2, 0x34,
                           0xe,  0xd9, 0xe,  0xd5, 0xf2, 0x3a, 0xaa, 0xe9, 0x4f, 0x9e, 0x19, 0x5b, 0x7c};
  uint8_t bytesprops7[] = {0x87, 0x5c, 0x68, 0xc1, 0x6e, 0xd6, 0x2d, 0x2b, 0x32, 0x44, 0xb4, 0xd,
                           0x67, 0xb1, 0x72, 0xff, 0x60, 0x2f, 0x2f, 0xba, 0x5d, 0xce, 0x9d, 0x44};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31457}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26429}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x11, 0x41, 0x73, 0xd8, 0x10, 0xd6, 0xf6, 0xc2, 0xdc, 0xb2, 0x13, 0x0, 0x4f,
                                     0x4e, 0xc6, 0xe2, 0x93, 0x50, 0xcd, 0xe,  0x81, 0x34, 0x1e, 0x13, 0xce};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xab, 0x30, 0xcc, 0xa0, 0x18, 0x2e, 0x8e, 0xff, 0x20, 0x86, 0xc6,
                                     0xdc, 0x7f, 0x40, 0xa3, 0xd8, 0x32, 0xa5, 0x8e, 0xe1, 0xd0};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5e, 0xa3, 0xcc, 0xd5, 0x54, 0x5a, 0x22, 0xe};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x88, 0x21, 0xa7, 0x3d, 0xaa, 0xd6, 0x22, 0xe8, 0x1b, 0x20,
                                     0xd8, 0xae, 0x25, 0x5,  0x5d, 0xdb, 0x85, 0x7d, 0xe2, 0xeb};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4a, 0xb6, 0x8, 0x54, 0x8c, 0x5a};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xbc, 0x6e, 0x96, 0xbf, 0x4c, 0x23, 0x15, 0xc5, 0x88,
                                     0xc2, 0x5b, 0xc0, 0x6d, 0x8d, 0xc4, 0xa,  0xd3, 0xfc};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xc3, 0x9d, 0xad, 0x6, 0x68, 0x7f, 0xb2, 0xe6, 0xd};
  lwmqtt_string_t topic_filter_s6 = {9, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x65, 0x28, 0x79, 0x13, 0xd,  0x7c, 0x2b, 0x8a, 0xd8, 0xc4,
                                     0x2a, 0xe3, 0x7e, 0xb4, 0x8c, 0x44, 0x58, 0xfa, 0xb5, 0x87,
                                     0x23, 0xd6, 0x23, 0x3b, 0x21, 0xe1, 0xa1, 0xc9};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x31, 0xfc, 0xe1, 0xaf, 0x2, 0xac, 0xec, 0x16,
                                     0xb0, 0x32, 0x22, 0xcc, 0xb, 0x1e, 0x8,  0xbd};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xda, 0xb5, 0xb2, 0xf5, 0x78, 0xbb, 0xf5, 0xa7,
                                     0x35, 0x90, 0xf9, 0x4c, 0x3a, 0xd1, 0x92};
  lwmqtt_string_t topic_filter_s9 = {15, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12973, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26764
// ["\228\129\194\154UZ\162#\ENQ\166y\194\131\134\146\CAN\249\179\195=\\H\131_\195\ACK","\157>\170,\252e\253\207?\202o\189\&8\149\170\251\138\173}\GS\224\ACK\181\156","\139O+\138\ESC$!\248\160\249K\171\161\214,l\r\191X\ETB*\160\246\a/","","\139\149j\246C\170\168\SI\n\151\SOH\219\243\RS\222\206k\199\ESC\SUB\DC2x(5:!D","\245x0\213\130\200\229\176\SUB$\SOH\ENQ\243\153\147\242\157\219\190","jv\130p\n\255\130\158\213\218O\SYN\194W\191\188","\210\132\229-R&\239\246\ESCe\194\US.\222\DC2&\135$\210YE\129","hM{7","\206N\242@%2\218\216\138\232\155\156\n\US\248z@\207\SYN\211\221\&8\164\239\155"]
// [PropRequestProblemInformation 159,PropTopicAlias 26553,PropMaximumPacketSize 21445,PropMessageExpiryInterval
// 30316,PropMessageExpiryInterval 1951,PropRequestResponseInformation 68,PropSharedSubscriptionAvailable
// 111,PropAuthenticationData "",PropMaximumPacketSize 24610,PropRequestResponseInformation 200,PropMaximumQoS
// 96,PropMessageExpiryInterval 27215,PropMaximumQoS 97,PropRequestProblemInformation
// 195,PropSubscriptionIdentifierAvailable 110,PropServerReference "Y\220n\133\153",PropResponseTopic
// "W\199\150\221",PropAssignedClientIdentifier
// "\SYN\227A%q\207\237\NUL\200\197:\157?\247\162\201\128\186",PropContentType
// "\168_\152\181\239\150\248^K\221\190\230"]
TEST(Unsubscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0xa2, 0xb5, 0x2,  0x68, 0x8c, 0x62, 0x17, 0x9f, 0x23, 0x67, 0xb9, 0x27, 0x0,  0x0,  0x53, 0xc5, 0x2,  0x0,  0x0,
      0x76, 0x6c, 0x2,  0x0,  0x0,  0x7,  0x9f, 0x19, 0x44, 0x2a, 0x6f, 0x16, 0x0,  0x0,  0x27, 0x0,  0x0,  0x60, 0x22,
      0x19, 0xc8, 0x24, 0x60, 0x2,  0x0,  0x0,  0x6a, 0x4f, 0x24, 0x61, 0x17, 0xc3, 0x29, 0x6e, 0x1c, 0x0,  0x5,  0x59,
      0xdc, 0x6e, 0x85, 0x99, 0x8,  0x0,  0x4,  0x57, 0xc7, 0x96, 0xdd, 0x12, 0x0,  0x12, 0x16, 0xe3, 0x41, 0x25, 0x71,
      0xcf, 0xed, 0x0,  0xc8, 0xc5, 0x3a, 0x9d, 0x3f, 0xf7, 0xa2, 0xc9, 0x80, 0xba, 0x3,  0x0,  0xc,  0xa8, 0x5f, 0x98,
      0xb5, 0xef, 0x96, 0xf8, 0x5e, 0x4b, 0xdd, 0xbe, 0xe6, 0x0,  0x1a, 0xe4, 0x81, 0xc2, 0x9a, 0x55, 0x5a, 0xa2, 0x23,
      0x5,  0xa6, 0x79, 0xc2, 0x83, 0x86, 0x92, 0x18, 0xf9, 0xb3, 0xc3, 0x3d, 0x5c, 0x48, 0x83, 0x5f, 0xc3, 0x6,  0x0,
      0x18, 0x9d, 0x3e, 0xaa, 0x2c, 0xfc, 0x65, 0xfd, 0xcf, 0x3f, 0xca, 0x6f, 0xbd, 0x38, 0x95, 0xaa, 0xfb, 0x8a, 0xad,
      0x7d, 0x1d, 0xe0, 0x6,  0xb5, 0x9c, 0x0,  0x19, 0x8b, 0x4f, 0x2b, 0x8a, 0x1b, 0x24, 0x21, 0xf8, 0xa0, 0xf9, 0x4b,
      0xab, 0xa1, 0xd6, 0x2c, 0x6c, 0xd,  0xbf, 0x58, 0x17, 0x2a, 0xa0, 0xf6, 0x7,  0x2f, 0x0,  0x0,  0x0,  0x1b, 0x8b,
      0x95, 0x6a, 0xf6, 0x43, 0xaa, 0xa8, 0xf,  0xa,  0x97, 0x1,  0xdb, 0xf3, 0x1e, 0xde, 0xce, 0x6b, 0xc7, 0x1b, 0x1a,
      0x12, 0x78, 0x28, 0x35, 0x3a, 0x21, 0x44, 0x0,  0x13, 0xf5, 0x78, 0x30, 0xd5, 0x82, 0xc8, 0xe5, 0xb0, 0x1a, 0x24,
      0x1,  0x5,  0xf3, 0x99, 0x93, 0xf2, 0x9d, 0xdb, 0xbe, 0x0,  0x10, 0x6a, 0x76, 0x82, 0x70, 0xa,  0xff, 0x82, 0x9e,
      0xd5, 0xda, 0x4f, 0x16, 0xc2, 0x57, 0xbf, 0xbc, 0x0,  0x16, 0xd2, 0x84, 0xe5, 0x2d, 0x52, 0x26, 0xef, 0xf6, 0x1b,
      0x65, 0xc2, 0x1f, 0x2e, 0xde, 0x12, 0x26, 0x87, 0x24, 0xd2, 0x59, 0x45, 0x81, 0x0,  0x4,  0x68, 0x4d, 0x7b, 0x37,
      0x0,  0x19, 0xce, 0x4e, 0xf2, 0x40, 0x25, 0x32, 0xda, 0xd8, 0x8a, 0xe8, 0x9b, 0x9c, 0xa,  0x1f, 0xf8, 0x7a, 0x40,
      0xcf, 0x16, 0xd3, 0xdd, 0x38, 0xa4, 0xef, 0x9b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x59, 0xdc, 0x6e, 0x85, 0x99};
  uint8_t bytesprops2[] = {0x57, 0xc7, 0x96, 0xdd};
  uint8_t bytesprops3[] = {0x16, 0xe3, 0x41, 0x25, 0x71, 0xcf, 0xed, 0x0,  0xc8,
                           0xc5, 0x3a, 0x9d, 0x3f, 0xf7, 0xa2, 0xc9, 0x80, 0xba};
  uint8_t bytesprops4[] = {0xa8, 0x5f, 0x98, 0xb5, 0xef, 0x96, 0xf8, 0x5e, 0x4b, 0xdd, 0xbe, 0xe6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26553}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21445}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30316}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1951}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24610}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27215}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xe4, 0x81, 0xc2, 0x9a, 0x55, 0x5a, 0xa2, 0x23, 0x5,  0xa6, 0x79, 0xc2, 0x83,
                                     0x86, 0x92, 0x18, 0xf9, 0xb3, 0xc3, 0x3d, 0x5c, 0x48, 0x83, 0x5f, 0xc3, 0x6};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9d, 0x3e, 0xaa, 0x2c, 0xfc, 0x65, 0xfd, 0xcf, 0x3f, 0xca, 0x6f, 0xbd,
                                     0x38, 0x95, 0xaa, 0xfb, 0x8a, 0xad, 0x7d, 0x1d, 0xe0, 0x6,  0xb5, 0x9c};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8b, 0x4f, 0x2b, 0x8a, 0x1b, 0x24, 0x21, 0xf8, 0xa0, 0xf9, 0x4b, 0xab, 0xa1,
                                     0xd6, 0x2c, 0x6c, 0xd,  0xbf, 0x58, 0x17, 0x2a, 0xa0, 0xf6, 0x7,  0x2f};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x8b, 0x95, 0x6a, 0xf6, 0x43, 0xaa, 0xa8, 0xf,  0xa,  0x97, 0x1,  0xdb, 0xf3, 0x1e,
                                     0xde, 0xce, 0x6b, 0xc7, 0x1b, 0x1a, 0x12, 0x78, 0x28, 0x35, 0x3a, 0x21, 0x44};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf5, 0x78, 0x30, 0xd5, 0x82, 0xc8, 0xe5, 0xb0, 0x1a, 0x24,
                                     0x1,  0x5,  0xf3, 0x99, 0x93, 0xf2, 0x9d, 0xdb, 0xbe};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6a, 0x76, 0x82, 0x70, 0xa,  0xff, 0x82, 0x9e,
                                     0xd5, 0xda, 0x4f, 0x16, 0xc2, 0x57, 0xbf, 0xbc};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xd2, 0x84, 0xe5, 0x2d, 0x52, 0x26, 0xef, 0xf6, 0x1b, 0x65, 0xc2,
                                     0x1f, 0x2e, 0xde, 0x12, 0x26, 0x87, 0x24, 0xd2, 0x59, 0x45, 0x81};
  lwmqtt_string_t topic_filter_s7 = {22, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x68, 0x4d, 0x7b, 0x37};
  lwmqtt_string_t topic_filter_s8 = {4, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xce, 0x4e, 0xf2, 0x40, 0x25, 0x32, 0xda, 0xd8, 0x8a, 0xe8, 0x9b, 0x9c, 0xa,
                                     0x1f, 0xf8, 0x7a, 0x40, 0xcf, 0x16, 0xd3, 0xdd, 0x38, 0xa4, 0xef, 0x9b};
  lwmqtt_string_t topic_filter_s9 = {25, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26764, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 25855
// ["*\148\DEL\172\179\158\a\ETX\SONJH`\204\245\213\178\t","","\132\212~\"a\157\185J\138:\200\142","\137\206\187\149\181\150l\210\253\178V\167\ESC\239@\GSD\231\139","\219\198\215\184]\249\ESC\146\186\ETB","K\140\254\EOT`\134\206\GS\195\219e\213\200\SIDy\239
// \164","\164\146\155I\172w\DC3b\DC4qa","1k\NAK\130\DLE\202\GS\191\239B\tL\162z\ETX\213l\194\143\&6\SYN\152/\154\219e\NAKi","\247k3\164\228?\NUL\158\201\136y\202\169\202"]
// [PropReceiveMaximum 4746,PropMaximumQoS 155,PropRequestResponseInformation 245,PropMessageExpiryInterval
// 30886,PropTopicAlias 26829,PropServerKeepAlive 27060,PropSubscriptionIdentifierAvailable
// 115,PropSubscriptionIdentifier 19,PropMessageExpiryInterval 15916,PropMaximumQoS 205,PropAuthenticationMethod
// "]\DC1hJ\193\nyLW",PropTopicAlias 1188,PropUserProperty "'EF\DC4\186\211\194W\174r\200\SItbt\148"
// "\\",PropTopicAliasMaximum 18803,PropRetainAvailable 193,PropSessionExpiryInterval
// 31962,PropSubscriptionIdentifierAvailable 70,PropRetainAvailable 34,PropSubscriptionIdentifierAvailable
// 227,PropMaximumPacketSize 19223,PropWildcardSubscriptionAvailable 7,PropWildcardSubscriptionAvailable
// 21,PropMaximumPacketSize 8858,PropMessageExpiryInterval 17787,PropRequestResponseInformation 91,PropServerReference
// "\NAK\166\156B=\185\ESC\205\&7Zh\205\202\255\192\&6\STX\n\179\136_\132\245\187\&7",PropAuthenticationData
// "\180\222X\251",PropRequestProblemInformation 202,PropRequestProblemInformation 194,PropReasonString
// "&\197]$\GS\225f\222\EM"]
TEST(Unsubscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0xa2, 0xb3, 0x2,  0x64, 0xff, 0x9a, 0x1,  0x21, 0x12, 0x8a, 0x24, 0x9b, 0x19, 0xf5, 0x2,  0x0,  0x0,  0x78, 0xa6,
      0x23, 0x68, 0xcd, 0x13, 0x69, 0xb4, 0x29, 0x73, 0xb,  0x13, 0x2,  0x0,  0x0,  0x3e, 0x2c, 0x24, 0xcd, 0x15, 0x0,
      0x9,  0x5d, 0x11, 0x68, 0x4a, 0xc1, 0xa,  0x79, 0x4c, 0x57, 0x23, 0x4,  0xa4, 0x26, 0x0,  0x10, 0x27, 0x45, 0x46,
      0x14, 0xba, 0xd3, 0xc2, 0x57, 0xae, 0x72, 0xc8, 0xf,  0x74, 0x62, 0x74, 0x94, 0x0,  0x1,  0x5c, 0x22, 0x49, 0x73,
      0x25, 0xc1, 0x11, 0x0,  0x0,  0x7c, 0xda, 0x29, 0x46, 0x25, 0x22, 0x29, 0xe3, 0x27, 0x0,  0x0,  0x4b, 0x17, 0x28,
      0x7,  0x28, 0x15, 0x27, 0x0,  0x0,  0x22, 0x9a, 0x2,  0x0,  0x0,  0x45, 0x7b, 0x19, 0x5b, 0x1c, 0x0,  0x19, 0x15,
      0xa6, 0x9c, 0x42, 0x3d, 0xb9, 0x1b, 0xcd, 0x37, 0x5a, 0x68, 0xcd, 0xca, 0xff, 0xc0, 0x36, 0x2,  0xa,  0xb3, 0x88,
      0x5f, 0x84, 0xf5, 0xbb, 0x37, 0x16, 0x0,  0x4,  0xb4, 0xde, 0x58, 0xfb, 0x17, 0xca, 0x17, 0xc2, 0x1f, 0x0,  0x9,
      0x26, 0xc5, 0x5d, 0x24, 0x1d, 0xe1, 0x66, 0xde, 0x19, 0x0,  0x12, 0x2a, 0x94, 0x7f, 0xac, 0xb3, 0x9e, 0x7,  0x3,
      0xe,  0x4e, 0x4a, 0x48, 0x60, 0xcc, 0xf5, 0xd5, 0xb2, 0x9,  0x0,  0x0,  0x0,  0xc,  0x84, 0xd4, 0x7e, 0x22, 0x61,
      0x9d, 0xb9, 0x4a, 0x8a, 0x3a, 0xc8, 0x8e, 0x0,  0x13, 0x89, 0xce, 0xbb, 0x95, 0xb5, 0x96, 0x6c, 0xd2, 0xfd, 0xb2,
      0x56, 0xa7, 0x1b, 0xef, 0x40, 0x1d, 0x44, 0xe7, 0x8b, 0x0,  0xa,  0xdb, 0xc6, 0xd7, 0xb8, 0x5d, 0xf9, 0x1b, 0x92,
      0xba, 0x17, 0x0,  0x13, 0x4b, 0x8c, 0xfe, 0x4,  0x60, 0x86, 0xce, 0x1d, 0xc3, 0xdb, 0x65, 0xd5, 0xc8, 0xf,  0x44,
      0x79, 0xef, 0x20, 0xa4, 0x0,  0xb,  0xa4, 0x92, 0x9b, 0x49, 0xac, 0x77, 0x13, 0x62, 0x14, 0x71, 0x61, 0x0,  0x1c,
      0x31, 0x6b, 0x15, 0x82, 0x10, 0xca, 0x1d, 0xbf, 0xef, 0x42, 0x9,  0x4c, 0xa2, 0x7a, 0x3,  0xd5, 0x6c, 0xc2, 0x8f,
      0x36, 0x16, 0x98, 0x2f, 0x9a, 0xdb, 0x65, 0x15, 0x69, 0x0,  0xe,  0xf7, 0x6b, 0x33, 0xa4, 0xe4, 0x3f, 0x0,  0x9e,
      0xc9, 0x88, 0x79, 0xca, 0xa9, 0xca};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5d, 0x11, 0x68, 0x4a, 0xc1, 0xa, 0x79, 0x4c, 0x57};
  uint8_t bytesprops2[] = {0x5c};
  uint8_t bytesprops1[] = {0x27, 0x45, 0x46, 0x14, 0xba, 0xd3, 0xc2, 0x57,
                           0xae, 0x72, 0xc8, 0xf,  0x74, 0x62, 0x74, 0x94};
  uint8_t bytesprops3[] = {0x15, 0xa6, 0x9c, 0x42, 0x3d, 0xb9, 0x1b, 0xcd, 0x37, 0x5a, 0x68, 0xcd, 0xca,
                           0xff, 0xc0, 0x36, 0x2,  0xa,  0xb3, 0x88, 0x5f, 0x84, 0xf5, 0xbb, 0x37};
  uint8_t bytesprops4[] = {0xb4, 0xde, 0x58, 0xfb};
  uint8_t bytesprops5[] = {0x26, 0xc5, 0x5d, 0x24, 0x1d, 0xe1, 0x66, 0xde, 0x19};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4746}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30886}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26829}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27060}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15916}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1188}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops1}, .v = {1, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18803}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31962}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19223}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 21}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8858}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17787}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x2a, 0x94, 0x7f, 0xac, 0xb3, 0x9e, 0x7,  0x3,  0xe,
                                     0x4e, 0x4a, 0x48, 0x60, 0xcc, 0xf5, 0xd5, 0xb2, 0x9};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x84, 0xd4, 0x7e, 0x22, 0x61, 0x9d, 0xb9, 0x4a, 0x8a, 0x3a, 0xc8, 0x8e};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x89, 0xce, 0xbb, 0x95, 0xb5, 0x96, 0x6c, 0xd2, 0xfd, 0xb2,
                                     0x56, 0xa7, 0x1b, 0xef, 0x40, 0x1d, 0x44, 0xe7, 0x8b};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xdb, 0xc6, 0xd7, 0xb8, 0x5d, 0xf9, 0x1b, 0x92, 0xba, 0x17};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4b, 0x8c, 0xfe, 0x4, 0x60, 0x86, 0xce, 0x1d, 0xc3, 0xdb,
                                     0x65, 0xd5, 0xc8, 0xf, 0x44, 0x79, 0xef, 0x20, 0xa4};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa4, 0x92, 0x9b, 0x49, 0xac, 0x77, 0x13, 0x62, 0x14, 0x71, 0x61};
  lwmqtt_string_t topic_filter_s6 = {11, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x31, 0x6b, 0x15, 0x82, 0x10, 0xca, 0x1d, 0xbf, 0xef, 0x42,
                                     0x9,  0x4c, 0xa2, 0x7a, 0x3,  0xd5, 0x6c, 0xc2, 0x8f, 0x36,
                                     0x16, 0x98, 0x2f, 0x9a, 0xdb, 0x65, 0x15, 0x69};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xf7, 0x6b, 0x33, 0xa4, 0xe4, 0x3f, 0x0, 0x9e, 0xc9, 0x88, 0x79, 0xca, 0xa9, 0xca};
  lwmqtt_string_t topic_filter_s8 = {14, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 25855, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 20087 ["","\223$\157\133\154\STXu\172d\221\239W\239\v\142#\151b"] [PropRequestResponseInformation
// 3,PropReasonString ")%\140\151\134E\255I\165\DC1\"\184]",PropSubscriptionIdentifierAvailable
// 226,PropResponseInformation
// "\152t\255\184Y[\128\217\FS\143\204S\186g\129W\137\239\224\171S\159\FS;",PropRetainAvailable
// 150,PropResponseInformation "R,\246g\249\&1y\136\219",PropSubscriptionIdentifier 0,PropTopicAlias
// 8160,PropAuthenticationMethod "\135\232\217w\144\SI\133@\128\&2S_d\137\183\140",PropUserProperty "\167\215\240"
// "\197\169\ETB\219\250",PropRetainAvailable 186]
TEST(Unsubscribe5QCTest, Encode24) {
  uint8_t pkt[] = {0xa2, 0x7d, 0x4e, 0x77, 0x64, 0x19, 0x3,  0x1f, 0x0,  0xd,  0x29, 0x25, 0x8c, 0x97, 0x86, 0x45,
                   0xff, 0x49, 0xa5, 0x11, 0x22, 0xb8, 0x5d, 0x29, 0xe2, 0x1a, 0x0,  0x18, 0x98, 0x74, 0xff, 0xb8,
                   0x59, 0x5b, 0x80, 0xd9, 0x1c, 0x8f, 0xcc, 0x53, 0xba, 0x67, 0x81, 0x57, 0x89, 0xef, 0xe0, 0xab,
                   0x53, 0x9f, 0x1c, 0x3b, 0x25, 0x96, 0x1a, 0x0,  0x9,  0x52, 0x2c, 0xf6, 0x67, 0xf9, 0x31, 0x79,
                   0x88, 0xdb, 0xb,  0x0,  0x23, 0x1f, 0xe0, 0x15, 0x0,  0x10, 0x87, 0xe8, 0xd9, 0x77, 0x90, 0xf,
                   0x85, 0x40, 0x80, 0x32, 0x53, 0x5f, 0x64, 0x89, 0xb7, 0x8c, 0x26, 0x0,  0x3,  0xa7, 0xd7, 0xf0,
                   0x0,  0x5,  0xc5, 0xa9, 0x17, 0xdb, 0xfa, 0x25, 0xba, 0x0,  0x0,  0x0,  0x12, 0xdf, 0x24, 0x9d,
                   0x85, 0x9a, 0x2,  0x75, 0xac, 0x64, 0xdd, 0xef, 0x57, 0xef, 0xb,  0x8e, 0x23, 0x97, 0x62};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x29, 0x25, 0x8c, 0x97, 0x86, 0x45, 0xff, 0x49, 0xa5, 0x11, 0x22, 0xb8, 0x5d};
  uint8_t bytesprops1[] = {0x98, 0x74, 0xff, 0xb8, 0x59, 0x5b, 0x80, 0xd9, 0x1c, 0x8f, 0xcc, 0x53,
                           0xba, 0x67, 0x81, 0x57, 0x89, 0xef, 0xe0, 0xab, 0x53, 0x9f, 0x1c, 0x3b};
  uint8_t bytesprops2[] = {0x52, 0x2c, 0xf6, 0x67, 0xf9, 0x31, 0x79, 0x88, 0xdb};
  uint8_t bytesprops3[] = {0x87, 0xe8, 0xd9, 0x77, 0x90, 0xf,  0x85, 0x40,
                           0x80, 0x32, 0x53, 0x5f, 0x64, 0x89, 0xb7, 0x8c};
  uint8_t bytesprops5[] = {0xc5, 0xa9, 0x17, 0xdb, 0xfa};
  uint8_t bytesprops4[] = {0xa7, 0xd7, 0xf0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8160}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops4}, .v = {5, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 186}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdf, 0x24, 0x9d, 0x85, 0x9a, 0x2,  0x75, 0xac, 0x64,
                                     0xdd, 0xef, 0x57, 0xef, 0xb,  0x8e, 0x23, 0x97, 0x62};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20087, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 23904
// ["\149\138G<\153B","\176\152\174\227C\212\140\237\176F\225\157","\250\193{\220\129\129\245u\242\229\214\GS\252\173y\184p\165*\244}\215","\ESCB3C\185\170*\235\146\140H11H\198\156\223\DEL\131\144\131\136\224s\209k\b\195\FS"]
// [PropRequestResponseInformation 126,PropMessageExpiryInterval 20576,PropResponseInformation
// "\GS\210\159\237\184\ETXZx",PropAssignedClientIdentifier
// "f\141?\139F\241<\223\DC2\\\201\166\153!\216\r\174\219\197X|y\251\206 \US\178",PropAuthenticationMethod
// "[)wR)\191\177\239",PropUserProperty "B\162\na(Jq\ETB\164%I\163\187\154s\181\244\&2\n;\166\185&9"
// "\225~\227\214{bd\204\152[)c\SOk\DC4,\156c;\189\169\&3\ACK\142\EOT7",PropSubscriptionIdentifierAvailable
// 121,PropRequestResponseInformation 136,PropSessionExpiryInterval 1977,PropCorrelationData
// "\DC1\158\198\247\f\DC2\164U{\a\172\244Ks\213T\SOH\178\NUL\219H\189&IS\191-\rR\254",PropSubscriptionIdentifier
// 22,PropWillDelayInterval 22819,PropReasonString
// "\r\200Y\248\191\228\153\196,\f\144\143\\\244\SI\145<\214\226\135\f\f\169",PropTopicAlias 25943,PropUserProperty
// "\153\NUL\233\&0\180\203\v" "\203"]
TEST(Unsubscribe5QCTest, Encode25) {
  uint8_t pkt[] = {
      0xa2, 0x9e, 0x2,  0x5d, 0x60, 0xcd, 0x1,  0x19, 0x7e, 0x2,  0x0,  0x0,  0x50, 0x60, 0x1a, 0x0,  0x8,  0x1d, 0xd2,
      0x9f, 0xed, 0xb8, 0x3,  0x5a, 0x78, 0x12, 0x0,  0x1b, 0x66, 0x8d, 0x3f, 0x8b, 0x46, 0xf1, 0x3c, 0xdf, 0x12, 0x5c,
      0xc9, 0xa6, 0x99, 0x21, 0xd8, 0xd,  0xae, 0xdb, 0xc5, 0x58, 0x7c, 0x79, 0xfb, 0xce, 0x20, 0x1f, 0xb2, 0x15, 0x0,
      0x8,  0x5b, 0x29, 0x77, 0x52, 0x29, 0xbf, 0xb1, 0xef, 0x26, 0x0,  0x18, 0x42, 0xa2, 0xa,  0x61, 0x28, 0x4a, 0x71,
      0x17, 0xa4, 0x25, 0x49, 0xa3, 0xbb, 0x9a, 0x73, 0xb5, 0xf4, 0x32, 0xa,  0x3b, 0xa6, 0xb9, 0x26, 0x39, 0x0,  0x1a,
      0xe1, 0x7e, 0xe3, 0xd6, 0x7b, 0x62, 0x64, 0xcc, 0x98, 0x5b, 0x29, 0x63, 0xe,  0x6b, 0x14, 0x2c, 0x9c, 0x63, 0x3b,
      0xbd, 0xa9, 0x33, 0x6,  0x8e, 0x4,  0x37, 0x29, 0x79, 0x19, 0x88, 0x11, 0x0,  0x0,  0x7,  0xb9, 0x9,  0x0,  0x1e,
      0x11, 0x9e, 0xc6, 0xf7, 0xc,  0x12, 0xa4, 0x55, 0x7b, 0x7,  0xac, 0xf4, 0x4b, 0x73, 0xd5, 0x54, 0x1,  0xb2, 0x0,
      0xdb, 0x48, 0xbd, 0x26, 0x49, 0x53, 0xbf, 0x2d, 0xd,  0x52, 0xfe, 0xb,  0x16, 0x18, 0x0,  0x0,  0x59, 0x23, 0x1f,
      0x0,  0x17, 0xd,  0xc8, 0x59, 0xf8, 0xbf, 0xe4, 0x99, 0xc4, 0x2c, 0xc,  0x90, 0x8f, 0x5c, 0xf4, 0xf,  0x91, 0x3c,
      0xd6, 0xe2, 0x87, 0xc,  0xc,  0xa9, 0x23, 0x65, 0x57, 0x26, 0x0,  0x7,  0x99, 0x0,  0xe9, 0x30, 0xb4, 0xcb, 0xb,
      0x0,  0x1,  0xcb, 0x0,  0x6,  0x95, 0x8a, 0x47, 0x3c, 0x99, 0x42, 0x0,  0xc,  0xb0, 0x98, 0xae, 0xe3, 0x43, 0xd4,
      0x8c, 0xed, 0xb0, 0x46, 0xe1, 0x9d, 0x0,  0x16, 0xfa, 0xc1, 0x7b, 0xdc, 0x81, 0x81, 0xf5, 0x75, 0xf2, 0xe5, 0xd6,
      0x1d, 0xfc, 0xad, 0x79, 0xb8, 0x70, 0xa5, 0x2a, 0xf4, 0x7d, 0xd7, 0x0,  0x1d, 0x1b, 0x42, 0x33, 0x43, 0xb9, 0xaa,
      0x2a, 0xeb, 0x92, 0x8c, 0x48, 0x31, 0x31, 0x48, 0xc6, 0x9c, 0xdf, 0x7f, 0x83, 0x90, 0x83, 0x88, 0xe0, 0x73, 0xd1,
      0x6b, 0x8,  0xc3, 0x1c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1d, 0xd2, 0x9f, 0xed, 0xb8, 0x3, 0x5a, 0x78};
  uint8_t bytesprops1[] = {0x66, 0x8d, 0x3f, 0x8b, 0x46, 0xf1, 0x3c, 0xdf, 0x12, 0x5c, 0xc9, 0xa6, 0x99, 0x21,
                           0xd8, 0xd,  0xae, 0xdb, 0xc5, 0x58, 0x7c, 0x79, 0xfb, 0xce, 0x20, 0x1f, 0xb2};
  uint8_t bytesprops2[] = {0x5b, 0x29, 0x77, 0x52, 0x29, 0xbf, 0xb1, 0xef};
  uint8_t bytesprops4[] = {0xe1, 0x7e, 0xe3, 0xd6, 0x7b, 0x62, 0x64, 0xcc, 0x98, 0x5b, 0x29, 0x63, 0xe,
                           0x6b, 0x14, 0x2c, 0x9c, 0x63, 0x3b, 0xbd, 0xa9, 0x33, 0x6,  0x8e, 0x4,  0x37};
  uint8_t bytesprops3[] = {0x42, 0xa2, 0xa,  0x61, 0x28, 0x4a, 0x71, 0x17, 0xa4, 0x25, 0x49, 0xa3,
                           0xbb, 0x9a, 0x73, 0xb5, 0xf4, 0x32, 0xa,  0x3b, 0xa6, 0xb9, 0x26, 0x39};
  uint8_t bytesprops5[] = {0x11, 0x9e, 0xc6, 0xf7, 0xc,  0x12, 0xa4, 0x55, 0x7b, 0x7,  0xac, 0xf4, 0x4b, 0x73, 0xd5,
                           0x54, 0x1,  0xb2, 0x0,  0xdb, 0x48, 0xbd, 0x26, 0x49, 0x53, 0xbf, 0x2d, 0xd,  0x52, 0xfe};
  uint8_t bytesprops6[] = {0xd,  0xc8, 0x59, 0xf8, 0xbf, 0xe4, 0x99, 0xc4, 0x2c, 0xc, 0x90, 0x8f,
                           0x5c, 0xf4, 0xf,  0x91, 0x3c, 0xd6, 0xe2, 0x87, 0xc,  0xc, 0xa9};
  uint8_t bytesprops8[] = {0xcb};
  uint8_t bytesprops7[] = {0x99, 0x0, 0xe9, 0x30, 0xb4, 0xcb, 0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20576}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops3}, .v = {26, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1977}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22819}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25943}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops7}, .v = {1, (char*)&bytesprops8}}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x95, 0x8a, 0x47, 0x3c, 0x99, 0x42};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb0, 0x98, 0xae, 0xe3, 0x43, 0xd4, 0x8c, 0xed, 0xb0, 0x46, 0xe1, 0x9d};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfa, 0xc1, 0x7b, 0xdc, 0x81, 0x81, 0xf5, 0x75, 0xf2, 0xe5, 0xd6,
                                     0x1d, 0xfc, 0xad, 0x79, 0xb8, 0x70, 0xa5, 0x2a, 0xf4, 0x7d, 0xd7};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1b, 0x42, 0x33, 0x43, 0xb9, 0xaa, 0x2a, 0xeb, 0x92, 0x8c,
                                     0x48, 0x31, 0x31, 0x48, 0xc6, 0x9c, 0xdf, 0x7f, 0x83, 0x90,
                                     0x83, 0x88, 0xe0, 0x73, 0xd1, 0x6b, 0x8,  0xc3, 0x1c};
  lwmqtt_string_t topic_filter_s3 = {29, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23904, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 18211 ["RU\203\SOH\227Nbl11R~\206d\203\245\&9b\205\253","`\149\SUB<\b\128\137\250\185\176\EM\204"]
// [PropResponseTopic "\228\226;\179\141\151C\192J\132\179M\156#\ENQ\151\ACK/_Vw\209\218\220 ",PropReceiveMaximum
// 9650,PropAuthenticationData "\179\202\rA\NAKH\170[",PropSubscriptionIdentifierAvailable 9,PropSubscriptionIdentifier
// 8,PropRequestResponseInformation 187,PropSubscriptionIdentifierAvailable 252,PropSubscriptionIdentifierAvailable
// 40,PropTopicAliasMaximum 31349,PropSharedSubscriptionAvailable 79,PropMaximumQoS 249,PropResponseInformation
// "\SUB\EOT\154\167",PropReasonString
// "\STX\173\152x\235-\233\166)\244\237$\162\ETB\231\190\147xsk\253\&4\145\193BV\ETB"]
TEST(Unsubscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0xa2, 0x87, 0x1,  0x47, 0x23, 0x60, 0x8,  0x0,  0x19, 0xe4, 0xe2, 0x3b, 0xb3, 0x8d, 0x97, 0x43,
                   0xc0, 0x4a, 0x84, 0xb3, 0x4d, 0x9c, 0x23, 0x5,  0x97, 0x6,  0x2f, 0x5f, 0x56, 0x77, 0xd1, 0xda,
                   0xdc, 0x20, 0x21, 0x25, 0xb2, 0x16, 0x0,  0x8,  0xb3, 0xca, 0xd,  0x41, 0x15, 0x48, 0xaa, 0x5b,
                   0x29, 0x9,  0xb,  0x8,  0x19, 0xbb, 0x29, 0xfc, 0x29, 0x28, 0x22, 0x7a, 0x75, 0x2a, 0x4f, 0x24,
                   0xf9, 0x1a, 0x0,  0x4,  0x1a, 0x4,  0x9a, 0xa7, 0x1f, 0x0,  0x1b, 0x2,  0xad, 0x98, 0x78, 0xeb,
                   0x2d, 0xe9, 0xa6, 0x29, 0xf4, 0xed, 0x24, 0xa2, 0x17, 0xe7, 0xbe, 0x93, 0x78, 0x73, 0x6b, 0xfd,
                   0x34, 0x91, 0xc1, 0x42, 0x56, 0x17, 0x0,  0x14, 0x52, 0x55, 0xcb, 0x1,  0xe3, 0x4e, 0x62, 0x6c,
                   0x31, 0x31, 0x52, 0x7e, 0xce, 0x64, 0xcb, 0xf5, 0x39, 0x62, 0xcd, 0xfd, 0x0,  0xc,  0x60, 0x95,
                   0x1a, 0x3c, 0x8,  0x80, 0x89, 0xfa, 0xb9, 0xb0, 0x19, 0xcc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe4, 0xe2, 0x3b, 0xb3, 0x8d, 0x97, 0x43, 0xc0, 0x4a, 0x84, 0xb3, 0x4d, 0x9c,
                           0x23, 0x5,  0x97, 0x6,  0x2f, 0x5f, 0x56, 0x77, 0xd1, 0xda, 0xdc, 0x20};
  uint8_t bytesprops1[] = {0xb3, 0xca, 0xd, 0x41, 0x15, 0x48, 0xaa, 0x5b};
  uint8_t bytesprops2[] = {0x1a, 0x4, 0x9a, 0xa7};
  uint8_t bytesprops3[] = {0x2,  0xad, 0x98, 0x78, 0xeb, 0x2d, 0xe9, 0xa6, 0x29, 0xf4, 0xed, 0x24, 0xa2, 0x17,
                           0xe7, 0xbe, 0x93, 0x78, 0x73, 0x6b, 0xfd, 0x34, 0x91, 0xc1, 0x42, 0x56, 0x17};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9650}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31349}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x52, 0x55, 0xcb, 0x1,  0xe3, 0x4e, 0x62, 0x6c, 0x31, 0x31,
                                     0x52, 0x7e, 0xce, 0x64, 0xcb, 0xf5, 0x39, 0x62, 0xcd, 0xfd};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x60, 0x95, 0x1a, 0x3c, 0x8, 0x80, 0x89, 0xfa, 0xb9, 0xb0, 0x19, 0xcc};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18211, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 14225
// ["w9A\n=\f\239P\248iomV\246\230\219\f\234i\245,\136e","\200\&0&V\131\EM%\176\170R\209\166^<\170\200\220f\222\a\FSD",".2^.\242\r\198","\r\229\166\187f\244\188%\151\213W\198\150\a\f\201\245yH\193\137&9\246\209Ka\148\140\RS","\RSCb/b\143\151\172\STXL\167\129\186\142\252\160\218\NAK\155\134\EOT\191\247w","\206A\231S\173\254M9R\DC3\177$O\225d\222\175+\207\138FN\249\225\231\251"]
// [PropMessageExpiryInterval 14571,PropSubscriptionIdentifier 13,PropAuthenticationMethod
// "3^D\214jp\215\148\138K6\253\238\EMsL\bZn[/\195\238\195uc\ETB",PropSubscriptionIdentifier 19,PropContentType
// "\187\246\195\252\139k\149\142\234\225+8!\167Tcm\130\241e\245&\aR\240\249",PropWildcardSubscriptionAvailable
// 182,PropResponseTopic
// "\231\219E\255\NAK#\225\a\NUL\248X(\159\250=8\234\236\249)\160\133\140\v\225\143",PropSharedSubscriptionAvailable
// 127,PropWillDelayInterval 12781,PropResponseTopic
// "\201\242\a\233\DEL\235\f\177\209\244^",PropSubscriptionIdentifierAvailable 83,PropSubscriptionIdentifierAvailable
// 134,PropRequestProblemInformation 131,PropSubscriptionIdentifierAvailable 134,PropUserProperty
// "\141\&4o\186\135\209\251\236\ENQ\179t\147\160y" "R\FS\NUL",PropWillDelayInterval
// 14661,PropRequestResponseInformation 172]
TEST(Unsubscribe5QCTest, Encode27) {
  uint8_t pkt[] = {
      0xa2, 0xb1, 0x2,  0x37, 0x91, 0x9d, 0x1,  0x2,  0x0,  0x0,  0x38, 0xeb, 0xb,  0xd,  0x15, 0x0,  0x1b, 0x33, 0x5e,
      0x44, 0xd6, 0x6a, 0x70, 0xd7, 0x94, 0x8a, 0x4b, 0x36, 0xfd, 0xee, 0x19, 0x73, 0x4c, 0x8,  0x5a, 0x6e, 0x5b, 0x2f,
      0xc3, 0xee, 0xc3, 0x75, 0x63, 0x17, 0xb,  0x13, 0x3,  0x0,  0x1a, 0xbb, 0xf6, 0xc3, 0xfc, 0x8b, 0x6b, 0x95, 0x8e,
      0xea, 0xe1, 0x2b, 0x38, 0x21, 0xa7, 0x54, 0x63, 0x6d, 0x82, 0xf1, 0x65, 0xf5, 0x26, 0x7,  0x52, 0xf0, 0xf9, 0x28,
      0xb6, 0x8,  0x0,  0x1a, 0xe7, 0xdb, 0x45, 0xff, 0x15, 0x23, 0xe1, 0x7,  0x0,  0xf8, 0x58, 0x28, 0x9f, 0xfa, 0x3d,
      0x38, 0xea, 0xec, 0xf9, 0x29, 0xa0, 0x85, 0x8c, 0xb,  0xe1, 0x8f, 0x2a, 0x7f, 0x18, 0x0,  0x0,  0x31, 0xed, 0x8,
      0x0,  0xb,  0xc9, 0xf2, 0x7,  0xe9, 0x7f, 0xeb, 0xc,  0xb1, 0xd1, 0xf4, 0x5e, 0x29, 0x53, 0x29, 0x86, 0x17, 0x83,
      0x29, 0x86, 0x26, 0x0,  0xe,  0x8d, 0x34, 0x6f, 0xba, 0x87, 0xd1, 0xfb, 0xec, 0x5,  0xb3, 0x74, 0x93, 0xa0, 0x79,
      0x0,  0x3,  0x52, 0x1c, 0x0,  0x18, 0x0,  0x0,  0x39, 0x45, 0x19, 0xac, 0x0,  0x17, 0x77, 0x39, 0x41, 0xa,  0x3d,
      0xc,  0xef, 0x50, 0xf8, 0x69, 0x6f, 0x6d, 0x56, 0xf6, 0xe6, 0xdb, 0xc,  0xea, 0x69, 0xf5, 0x2c, 0x88, 0x65, 0x0,
      0x16, 0xc8, 0x30, 0x26, 0x56, 0x83, 0x19, 0x25, 0xb0, 0xaa, 0x52, 0xd1, 0xa6, 0x5e, 0x3c, 0xaa, 0xc8, 0xdc, 0x66,
      0xde, 0x7,  0x1c, 0x44, 0x0,  0x7,  0x2e, 0x32, 0x5e, 0x2e, 0xf2, 0xd,  0xc6, 0x0,  0x1e, 0xd,  0xe5, 0xa6, 0xbb,
      0x66, 0xf4, 0xbc, 0x25, 0x97, 0xd5, 0x57, 0xc6, 0x96, 0x7,  0xc,  0xc9, 0xf5, 0x79, 0x48, 0xc1, 0x89, 0x26, 0x39,
      0xf6, 0xd1, 0x4b, 0x61, 0x94, 0x8c, 0x1e, 0x0,  0x18, 0x1e, 0x43, 0x62, 0x2f, 0x62, 0x8f, 0x97, 0xac, 0x2,  0x4c,
      0xa7, 0x81, 0xba, 0x8e, 0xfc, 0xa0, 0xda, 0x15, 0x9b, 0x86, 0x4,  0xbf, 0xf7, 0x77, 0x0,  0x1a, 0xce, 0x41, 0xe7,
      0x53, 0xad, 0xfe, 0x4d, 0x39, 0x52, 0x13, 0xb1, 0x24, 0x4f, 0xe1, 0x64, 0xde, 0xaf, 0x2b, 0xcf, 0x8a, 0x46, 0x4e,
      0xf9, 0xe1, 0xe7, 0xfb};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x33, 0x5e, 0x44, 0xd6, 0x6a, 0x70, 0xd7, 0x94, 0x8a, 0x4b, 0x36, 0xfd, 0xee, 0x19,
                           0x73, 0x4c, 0x8,  0x5a, 0x6e, 0x5b, 0x2f, 0xc3, 0xee, 0xc3, 0x75, 0x63, 0x17};
  uint8_t bytesprops1[] = {0xbb, 0xf6, 0xc3, 0xfc, 0x8b, 0x6b, 0x95, 0x8e, 0xea, 0xe1, 0x2b, 0x38, 0x21,
                           0xa7, 0x54, 0x63, 0x6d, 0x82, 0xf1, 0x65, 0xf5, 0x26, 0x7,  0x52, 0xf0, 0xf9};
  uint8_t bytesprops2[] = {0xe7, 0xdb, 0x45, 0xff, 0x15, 0x23, 0xe1, 0x7,  0x0,  0xf8, 0x58, 0x28, 0x9f,
                           0xfa, 0x3d, 0x38, 0xea, 0xec, 0xf9, 0x29, 0xa0, 0x85, 0x8c, 0xb,  0xe1, 0x8f};
  uint8_t bytesprops3[] = {0xc9, 0xf2, 0x7, 0xe9, 0x7f, 0xeb, 0xc, 0xb1, 0xd1, 0xf4, 0x5e};
  uint8_t bytesprops5[] = {0x52, 0x1c, 0x0};
  uint8_t bytesprops4[] = {0x8d, 0x34, 0x6f, 0xba, 0x87, 0xd1, 0xfb, 0xec, 0x5, 0xb3, 0x74, 0x93, 0xa0, 0x79};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14571}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12781}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops4}, .v = {3, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14661}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 172}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x77, 0x39, 0x41, 0xa,  0x3d, 0xc,  0xef, 0x50, 0xf8, 0x69, 0x6f, 0x6d,
                                     0x56, 0xf6, 0xe6, 0xdb, 0xc,  0xea, 0x69, 0xf5, 0x2c, 0x88, 0x65};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc8, 0x30, 0x26, 0x56, 0x83, 0x19, 0x25, 0xb0, 0xaa, 0x52, 0xd1,
                                     0xa6, 0x5e, 0x3c, 0xaa, 0xc8, 0xdc, 0x66, 0xde, 0x7,  0x1c, 0x44};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2e, 0x32, 0x5e, 0x2e, 0xf2, 0xd, 0xc6};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd,  0xe5, 0xa6, 0xbb, 0x66, 0xf4, 0xbc, 0x25, 0x97, 0xd5,
                                     0x57, 0xc6, 0x96, 0x7,  0xc,  0xc9, 0xf5, 0x79, 0x48, 0xc1,
                                     0x89, 0x26, 0x39, 0xf6, 0xd1, 0x4b, 0x61, 0x94, 0x8c, 0x1e};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1e, 0x43, 0x62, 0x2f, 0x62, 0x8f, 0x97, 0xac, 0x2, 0x4c, 0xa7, 0x81,
                                     0xba, 0x8e, 0xfc, 0xa0, 0xda, 0x15, 0x9b, 0x86, 0x4, 0xbf, 0xf7, 0x77};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xce, 0x41, 0xe7, 0x53, 0xad, 0xfe, 0x4d, 0x39, 0x52, 0x13, 0xb1, 0x24, 0x4f,
                                     0xe1, 0x64, 0xde, 0xaf, 0x2b, 0xcf, 0x8a, 0x46, 0x4e, 0xf9, 0xe1, 0xe7, 0xfb};
  lwmqtt_string_t topic_filter_s5 = {26, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14225, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 19016
// ["Jg\224\251\204?\245=","\241\203b\228\136\148R&\163\232S\US\233R","\202g\168\178\ENQ;\ETB\131\t!4\227\199.E\251","+\200\171{ZW\DC4\ACK\170
// n\253\171=\157'_\155\tW\163\242\a\223","\224_L\250\174\189\ETB\170\156\243\NUL","#V\247\220\&3\202\129\146s\GS\244\149\158xi\231\149\242\DEL\148\172\159\210]\226\EMN","R\ACK\SOH9\148\244/","\153%\252\231\&9\254\131\161\180\161\151\"\239P!_\141T\EMsz\"0"]
// [PropServerKeepAlive 23263]
TEST(Unsubscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0xa2, 0x98, 0x1,  0x4a, 0x48, 0x3,  0x13, 0x5a, 0xdf, 0x0,  0x8,  0x4a, 0x67, 0xe0, 0xfb, 0xcc,
                   0x3f, 0xf5, 0x3d, 0x0,  0xe,  0xf1, 0xcb, 0x62, 0xe4, 0x88, 0x94, 0x52, 0x26, 0xa3, 0xe8, 0x53,
                   0x1f, 0xe9, 0x52, 0x0,  0x10, 0xca, 0x67, 0xa8, 0xb2, 0x5,  0x3b, 0x17, 0x83, 0x9,  0x21, 0x34,
                   0xe3, 0xc7, 0x2e, 0x45, 0xfb, 0x0,  0x18, 0x2b, 0xc8, 0xab, 0x7b, 0x5a, 0x57, 0x14, 0x6,  0xaa,
                   0x20, 0x6e, 0xfd, 0xab, 0x3d, 0x9d, 0x27, 0x5f, 0x9b, 0x9,  0x57, 0xa3, 0xf2, 0x7,  0xdf, 0x0,
                   0xb,  0xe0, 0x5f, 0x4c, 0xfa, 0xae, 0xbd, 0x17, 0xaa, 0x9c, 0xf3, 0x0,  0x0,  0x1b, 0x23, 0x56,
                   0xf7, 0xdc, 0x33, 0xca, 0x81, 0x92, 0x73, 0x1d, 0xf4, 0x95, 0x9e, 0x78, 0x69, 0xe7, 0x95, 0xf2,
                   0x7f, 0x94, 0xac, 0x9f, 0xd2, 0x5d, 0xe2, 0x19, 0x4e, 0x0,  0x7,  0x52, 0x6,  0x1,  0x39, 0x94,
                   0xf4, 0x2f, 0x0,  0x17, 0x99, 0x25, 0xfc, 0xe7, 0x39, 0xfe, 0x83, 0xa1, 0xb4, 0xa1, 0x97, 0x22,
                   0xef, 0x50, 0x21, 0x5f, 0x8d, 0x54, 0x19, 0x73, 0x7a, 0x22, 0x30};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23263}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x4a, 0x67, 0xe0, 0xfb, 0xcc, 0x3f, 0xf5, 0x3d};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf1, 0xcb, 0x62, 0xe4, 0x88, 0x94, 0x52,
                                     0x26, 0xa3, 0xe8, 0x53, 0x1f, 0xe9, 0x52};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xca, 0x67, 0xa8, 0xb2, 0x5,  0x3b, 0x17, 0x83,
                                     0x9,  0x21, 0x34, 0xe3, 0xc7, 0x2e, 0x45, 0xfb};
  lwmqtt_string_t topic_filter_s2 = {16, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2b, 0xc8, 0xab, 0x7b, 0x5a, 0x57, 0x14, 0x6,  0xaa, 0x20, 0x6e, 0xfd,
                                     0xab, 0x3d, 0x9d, 0x27, 0x5f, 0x9b, 0x9,  0x57, 0xa3, 0xf2, 0x7,  0xdf};
  lwmqtt_string_t topic_filter_s3 = {24, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe0, 0x5f, 0x4c, 0xfa, 0xae, 0xbd, 0x17, 0xaa, 0x9c, 0xf3, 0x0};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x23, 0x56, 0xf7, 0xdc, 0x33, 0xca, 0x81, 0x92, 0x73, 0x1d, 0xf4, 0x95, 0x9e, 0x78,
                                     0x69, 0xe7, 0x95, 0xf2, 0x7f, 0x94, 0xac, 0x9f, 0xd2, 0x5d, 0xe2, 0x19, 0x4e};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x52, 0x6, 0x1, 0x39, 0x94, 0xf4, 0x2f};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x99, 0x25, 0xfc, 0xe7, 0x39, 0xfe, 0x83, 0xa1, 0xb4, 0xa1, 0x97, 0x22,
                                     0xef, 0x50, 0x21, 0x5f, 0x8d, 0x54, 0x19, 0x73, 0x7a, 0x22, 0x30};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19016, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24261
// ["/\168j\253\190Jy7\185~F\236J","S\225\251?H\DC1\249\DC3\ETX\182\155[\CAN","}\EOT\136\245\&6b\203\202","9\222\252{E\t\SYNK5\162El\EOTA\171\&4\152\ESC","w\157\&9N\nW\242K\NUL\150a\166~\196\168\226\187\DEL\tU\186\218f\168","l\194\247\SOB\246P/\139","?fa\190\246c\DC2|/\206\SO\149\246\149Ar\153\174\EM\168\SOH\150\163\175\&3\236\191\ENQ\f\158","R$\140\171\234d\136\145\221\151\US8|3\254","\DLE\SI_\219/\178\128k\149\188\203\130J%\245\200P","\186\237'\227\&6\220\179\227\170\228\SOH?=\GS\DC3\224\204\166\tj\ESC|-s;\179",""]
// [PropUserProperty "p\207\DC1\170\239\132" "\US\195VAb\210\\\RS\160x",PropServerKeepAlive
// 8037,PropSubscriptionIdentifier 4,PropRetainAvailable 158,PropContentType
// "p\210\149\156}\129\157\152'\EOT\255\184\217W\221\165\&9^\ACK\220C\SI\184v\146\ENQ\241\173\208\&4",PropMaximumQoS
// 193,PropTopicAlias 8090]
TEST(Unsubscribe5QCTest, Encode29) {
  uint8_t pkt[] = {0xa2, 0x88, 0x2,  0x5e, 0xc5, 0x42, 0x26, 0x0,  0x6,  0x70, 0xcf, 0x11, 0xaa, 0xef, 0x84, 0x0,  0xa,
                   0x1f, 0xc3, 0x56, 0x41, 0x62, 0xd2, 0x5c, 0x1e, 0xa0, 0x78, 0x13, 0x1f, 0x65, 0xb,  0x4,  0x25, 0x9e,
                   0x3,  0x0,  0x1e, 0x70, 0xd2, 0x95, 0x9c, 0x7d, 0x81, 0x9d, 0x98, 0x27, 0x4,  0xff, 0xb8, 0xd9, 0x57,
                   0xdd, 0xa5, 0x39, 0x5e, 0x6,  0xdc, 0x43, 0xf,  0xb8, 0x76, 0x92, 0x5,  0xf1, 0xad, 0xd0, 0x34, 0x24,
                   0xc1, 0x23, 0x1f, 0x9a, 0x0,  0xd,  0x2f, 0xa8, 0x6a, 0xfd, 0xbe, 0x4a, 0x79, 0x37, 0xb9, 0x7e, 0x46,
                   0xec, 0x4a, 0x0,  0xd,  0x53, 0xe1, 0xfb, 0x3f, 0x48, 0x11, 0xf9, 0x13, 0x3,  0xb6, 0x9b, 0x5b, 0x18,
                   0x0,  0x8,  0x7d, 0x4,  0x88, 0xf5, 0x36, 0x62, 0xcb, 0xca, 0x0,  0x12, 0x39, 0xde, 0xfc, 0x7b, 0x45,
                   0x9,  0x16, 0x4b, 0x35, 0xa2, 0x45, 0x6c, 0x4,  0x41, 0xab, 0x34, 0x98, 0x1b, 0x0,  0x18, 0x77, 0x9d,
                   0x39, 0x4e, 0xa,  0x57, 0xf2, 0x4b, 0x0,  0x96, 0x61, 0xa6, 0x7e, 0xc4, 0xa8, 0xe2, 0xbb, 0x7f, 0x9,
                   0x55, 0xba, 0xda, 0x66, 0xa8, 0x0,  0x9,  0x6c, 0xc2, 0xf7, 0xe,  0x42, 0xf6, 0x50, 0x2f, 0x8b, 0x0,
                   0x1e, 0x3f, 0x66, 0x61, 0xbe, 0xf6, 0x63, 0x12, 0x7c, 0x2f, 0xce, 0xe,  0x95, 0xf6, 0x95, 0x41, 0x72,
                   0x99, 0xae, 0x19, 0xa8, 0x1,  0x96, 0xa3, 0xaf, 0x33, 0xec, 0xbf, 0x5,  0xc,  0x9e, 0x0,  0xf,  0x52,
                   0x24, 0x8c, 0xab, 0xea, 0x64, 0x88, 0x91, 0xdd, 0x97, 0x1f, 0x38, 0x7c, 0x33, 0xfe, 0x0,  0x11, 0x10,
                   0xf,  0x5f, 0xdb, 0x2f, 0xb2, 0x80, 0x6b, 0x95, 0xbc, 0xcb, 0x82, 0x4a, 0x25, 0xf5, 0xc8, 0x50, 0x0,
                   0x1a, 0xba, 0xed, 0x27, 0xe3, 0x36, 0xdc, 0xb3, 0xe3, 0xaa, 0xe4, 0x1,  0x3f, 0x3d, 0x1d, 0x13, 0xe0,
                   0xcc, 0xa6, 0x9,  0x6a, 0x1b, 0x7c, 0x2d, 0x73, 0x3b, 0xb3, 0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x1f, 0xc3, 0x56, 0x41, 0x62, 0xd2, 0x5c, 0x1e, 0xa0, 0x78};
  uint8_t bytesprops0[] = {0x70, 0xcf, 0x11, 0xaa, 0xef, 0x84};
  uint8_t bytesprops2[] = {0x70, 0xd2, 0x95, 0x9c, 0x7d, 0x81, 0x9d, 0x98, 0x27, 0x4,  0xff, 0xb8, 0xd9, 0x57, 0xdd,
                           0xa5, 0x39, 0x5e, 0x6,  0xdc, 0x43, 0xf,  0xb8, 0x76, 0x92, 0x5,  0xf1, 0xad, 0xd0, 0x34};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops0}, .v = {10, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8037}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 193}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8090}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x2f, 0xa8, 0x6a, 0xfd, 0xbe, 0x4a, 0x79, 0x37, 0xb9, 0x7e, 0x46, 0xec, 0x4a};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x53, 0xe1, 0xfb, 0x3f, 0x48, 0x11, 0xf9, 0x13, 0x3, 0xb6, 0x9b, 0x5b, 0x18};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7d, 0x4, 0x88, 0xf5, 0x36, 0x62, 0xcb, 0xca};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x39, 0xde, 0xfc, 0x7b, 0x45, 0x9,  0x16, 0x4b, 0x35,
                                     0xa2, 0x45, 0x6c, 0x4,  0x41, 0xab, 0x34, 0x98, 0x1b};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x77, 0x9d, 0x39, 0x4e, 0xa,  0x57, 0xf2, 0x4b, 0x0,  0x96, 0x61, 0xa6,
                                     0x7e, 0xc4, 0xa8, 0xe2, 0xbb, 0x7f, 0x9,  0x55, 0xba, 0xda, 0x66, 0xa8};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x6c, 0xc2, 0xf7, 0xe, 0x42, 0xf6, 0x50, 0x2f, 0x8b};
  lwmqtt_string_t topic_filter_s5 = {9, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3f, 0x66, 0x61, 0xbe, 0xf6, 0x63, 0x12, 0x7c, 0x2f, 0xce,
                                     0xe,  0x95, 0xf6, 0x95, 0x41, 0x72, 0x99, 0xae, 0x19, 0xa8,
                                     0x1,  0x96, 0xa3, 0xaf, 0x33, 0xec, 0xbf, 0x5,  0xc,  0x9e};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x52, 0x24, 0x8c, 0xab, 0xea, 0x64, 0x88, 0x91,
                                     0xdd, 0x97, 0x1f, 0x38, 0x7c, 0x33, 0xfe};
  lwmqtt_string_t topic_filter_s7 = {15, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x10, 0xf,  0x5f, 0xdb, 0x2f, 0xb2, 0x80, 0x6b, 0x95,
                                     0xbc, 0xcb, 0x82, 0x4a, 0x25, 0xf5, 0xc8, 0x50};
  lwmqtt_string_t topic_filter_s8 = {17, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xba, 0xed, 0x27, 0xe3, 0x36, 0xdc, 0xb3, 0xe3, 0xaa, 0xe4, 0x1,  0x3f, 0x3d,
                                     0x1d, 0x13, 0xe0, 0xcc, 0xa6, 0x9,  0x6a, 0x1b, 0x7c, 0x2d, 0x73, 0x3b, 0xb3};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24261, 11, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28335
// ["\131\a\246\226.","-\229QI\184\222\GSz\140","D","","\162\135\151\128\210\134PrL7\213\215\215\238\242\140I\221\230\189b\149\SYN\136\145\&9.\204\r","{\242M\ESCHt\210\SUBS\192\165\128\&00$\247\150y`0\227\181\237\ENQ_\199\253\230","\129\196S\189\178*\221\152}\246\130z\235sE\131\216v\ESC\188prdC\249d"]
// [PropContentType "4\237\&0\v\177@\ACK\221\242\235q\158\180\155\f",PropSubscriptionIdentifier 3,PropResponseTopic
// "d#\166\203u\162q2\GS\197\168Y\229\201\229\228\DEL~\237\255\SYN\157\146/*\185",PropSessionExpiryInterval
// 9936,PropServerKeepAlive 1150,PropReasonString "\DLE\243y\SUB9I\NAK9\253",PropSharedSubscriptionAvailable
// 15,PropServerKeepAlive 6367,PropAuthenticationData
// "P]\253\202\GS=h\199\GS~\189\231\v\145\ETX\ENQ",PropMaximumPacketSize 19525,PropResponseTopic
// "\163\153H\152\&9gI\DLE\241\\u\vPH\136_",PropRetainAvailable 93,PropReasonString
// "\ESC\171Pi_\255v\132\128\183\208\206\233\&8n^%\140\154S\204\203\200<z\245",PropSharedSubscriptionAvailable
// 61,PropMaximumPacketSize 23463,PropPayloadFormatIndicator 77,PropPayloadFormatIndicator 77,PropMessageExpiryInterval
// 16907,PropResponseInformation "\203\154\162\233F_\141\b\SOH\171",PropMessageExpiryInterval 3775,PropRetainAvailable
// 22,PropWillDelayInterval 29494,PropResponseTopic "\230\187*x?\161s\DC1*\150\ACK\150\t",PropWillDelayInterval
// 6704,PropWillDelayInterval 12282,PropRequestProblemInformation 46,PropWillDelayInterval 32278,PropMaximumQoS 88]
TEST(Unsubscribe5QCTest, Encode30) {
  uint8_t pkt[] = {
      0xa2, 0xd4, 0x2,  0x6e, 0xaf, 0xe0, 0x1,  0x3,  0x0,  0xf,  0x34, 0xed, 0x30, 0xb,  0xb1, 0x40, 0x6,  0xdd, 0xf2,
      0xeb, 0x71, 0x9e, 0xb4, 0x9b, 0xc,  0xb,  0x3,  0x8,  0x0,  0x1a, 0x64, 0x23, 0xa6, 0xcb, 0x75, 0xa2, 0x71, 0x32,
      0x1d, 0xc5, 0xa8, 0x59, 0xe5, 0xc9, 0xe5, 0xe4, 0x7f, 0x7e, 0xed, 0xff, 0x16, 0x9d, 0x92, 0x2f, 0x2a, 0xb9, 0x11,
      0x0,  0x0,  0x26, 0xd0, 0x13, 0x4,  0x7e, 0x1f, 0x0,  0x9,  0x10, 0xf3, 0x79, 0x1a, 0x39, 0x49, 0x15, 0x39, 0xfd,
      0x2a, 0xf,  0x13, 0x18, 0xdf, 0x16, 0x0,  0x10, 0x50, 0x5d, 0xfd, 0xca, 0x1d, 0x3d, 0x68, 0xc7, 0x1d, 0x7e, 0xbd,
      0xe7, 0xb,  0x91, 0x3,  0x5,  0x27, 0x0,  0x0,  0x4c, 0x45, 0x8,  0x0,  0x10, 0xa3, 0x99, 0x48, 0x98, 0x39, 0x67,
      0x49, 0x10, 0xf1, 0x5c, 0x75, 0xb,  0x50, 0x48, 0x88, 0x5f, 0x25, 0x5d, 0x1f, 0x0,  0x1a, 0x1b, 0xab, 0x50, 0x69,
      0x5f, 0xff, 0x76, 0x84, 0x80, 0xb7, 0xd0, 0xce, 0xe9, 0x38, 0x6e, 0x5e, 0x25, 0x8c, 0x9a, 0x53, 0xcc, 0xcb, 0xc8,
      0x3c, 0x7a, 0xf5, 0x2a, 0x3d, 0x27, 0x0,  0x0,  0x5b, 0xa7, 0x1,  0x4d, 0x1,  0x4d, 0x2,  0x0,  0x0,  0x42, 0xb,
      0x1a, 0x0,  0xa,  0xcb, 0x9a, 0xa2, 0xe9, 0x46, 0x5f, 0x8d, 0x8,  0x1,  0xab, 0x2,  0x0,  0x0,  0xe,  0xbf, 0x25,
      0x16, 0x18, 0x0,  0x0,  0x73, 0x36, 0x8,  0x0,  0xd,  0xe6, 0xbb, 0x2a, 0x78, 0x3f, 0xa1, 0x73, 0x11, 0x2a, 0x96,
      0x6,  0x96, 0x9,  0x18, 0x0,  0x0,  0x1a, 0x30, 0x18, 0x0,  0x0,  0x2f, 0xfa, 0x17, 0x2e, 0x18, 0x0,  0x0,  0x7e,
      0x16, 0x24, 0x58, 0x0,  0x5,  0x83, 0x7,  0xf6, 0xe2, 0x2e, 0x0,  0x9,  0x2d, 0xe5, 0x51, 0x49, 0xb8, 0xde, 0x1d,
      0x7a, 0x8c, 0x0,  0x1,  0x44, 0x0,  0x0,  0x0,  0x1d, 0xa2, 0x87, 0x97, 0x80, 0xd2, 0x86, 0x50, 0x72, 0x4c, 0x37,
      0xd5, 0xd7, 0xd7, 0xee, 0xf2, 0x8c, 0x49, 0xdd, 0xe6, 0xbd, 0x62, 0x95, 0x16, 0x88, 0x91, 0x39, 0x2e, 0xcc, 0xd,
      0x0,  0x1c, 0x7b, 0xf2, 0x4d, 0x1b, 0x48, 0x74, 0xd2, 0x1a, 0x53, 0xc0, 0xa5, 0x80, 0x30, 0x30, 0x24, 0xf7, 0x96,
      0x79, 0x60, 0x30, 0xe3, 0xb5, 0xed, 0x5,  0x5f, 0xc7, 0xfd, 0xe6, 0x0,  0x1a, 0x81, 0xc4, 0x53, 0xbd, 0xb2, 0x2a,
      0xdd, 0x98, 0x7d, 0xf6, 0x82, 0x7a, 0xeb, 0x73, 0x45, 0x83, 0xd8, 0x76, 0x1b, 0xbc, 0x70, 0x72, 0x64, 0x43, 0xf9,
      0x64};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x34, 0xed, 0x30, 0xb, 0xb1, 0x40, 0x6, 0xdd, 0xf2, 0xeb, 0x71, 0x9e, 0xb4, 0x9b, 0xc};
  uint8_t bytesprops1[] = {0x64, 0x23, 0xa6, 0xcb, 0x75, 0xa2, 0x71, 0x32, 0x1d, 0xc5, 0xa8, 0x59, 0xe5,
                           0xc9, 0xe5, 0xe4, 0x7f, 0x7e, 0xed, 0xff, 0x16, 0x9d, 0x92, 0x2f, 0x2a, 0xb9};
  uint8_t bytesprops2[] = {0x10, 0xf3, 0x79, 0x1a, 0x39, 0x49, 0x15, 0x39, 0xfd};
  uint8_t bytesprops3[] = {0x50, 0x5d, 0xfd, 0xca, 0x1d, 0x3d, 0x68, 0xc7, 0x1d, 0x7e, 0xbd, 0xe7, 0xb, 0x91, 0x3, 0x5};
  uint8_t bytesprops4[] = {0xa3, 0x99, 0x48, 0x98, 0x39, 0x67, 0x49, 0x10,
                           0xf1, 0x5c, 0x75, 0xb,  0x50, 0x48, 0x88, 0x5f};
  uint8_t bytesprops5[] = {0x1b, 0xab, 0x50, 0x69, 0x5f, 0xff, 0x76, 0x84, 0x80, 0xb7, 0xd0, 0xce, 0xe9,
                           0x38, 0x6e, 0x5e, 0x25, 0x8c, 0x9a, 0x53, 0xcc, 0xcb, 0xc8, 0x3c, 0x7a, 0xf5};
  uint8_t bytesprops6[] = {0xcb, 0x9a, 0xa2, 0xe9, 0x46, 0x5f, 0x8d, 0x8, 0x1, 0xab};
  uint8_t bytesprops7[] = {0xe6, 0xbb, 0x2a, 0x78, 0x3f, 0xa1, 0x73, 0x11, 0x2a, 0x96, 0x6, 0x96, 0x9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9936}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1150}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6367}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19525}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23463}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16907}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3775}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29494}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6704}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12282}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32278}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 88}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x83, 0x7, 0xf6, 0xe2, 0x2e};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d, 0xe5, 0x51, 0x49, 0xb8, 0xde, 0x1d, 0x7a, 0x8c};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x44};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa2, 0x87, 0x97, 0x80, 0xd2, 0x86, 0x50, 0x72, 0x4c, 0x37,
                                     0xd5, 0xd7, 0xd7, 0xee, 0xf2, 0x8c, 0x49, 0xdd, 0xe6, 0xbd,
                                     0x62, 0x95, 0x16, 0x88, 0x91, 0x39, 0x2e, 0xcc, 0xd};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7b, 0xf2, 0x4d, 0x1b, 0x48, 0x74, 0xd2, 0x1a, 0x53, 0xc0,
                                     0xa5, 0x80, 0x30, 0x30, 0x24, 0xf7, 0x96, 0x79, 0x60, 0x30,
                                     0xe3, 0xb5, 0xed, 0x5,  0x5f, 0xc7, 0xfd, 0xe6};
  lwmqtt_string_t topic_filter_s5 = {28, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x81, 0xc4, 0x53, 0xbd, 0xb2, 0x2a, 0xdd, 0x98, 0x7d, 0xf6, 0x82, 0x7a, 0xeb,
                                     0x73, 0x45, 0x83, 0xd8, 0x76, 0x1b, 0xbc, 0x70, 0x72, 0x64, 0x43, 0xf9, 0x64};
  lwmqtt_string_t topic_filter_s6 = {26, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28335, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeResponse 5190 [] []
TEST(UnsubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0xb0, 0x2, 0x14, 0x46};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5190);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 10905 [] []
TEST(UnsubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0xb0, 0x2, 0x2a, 0x99};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10905);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 19692 [] []
TEST(UnsubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0xb0, 0x2, 0x4c, 0xec};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19692);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 16153 [] []
TEST(UnsubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0xb0, 0x2, 0x3f, 0x19};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16153);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 6562 [] []
TEST(UnsubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0xb0, 0x2, 0x19, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6562);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 32484 [] []
TEST(UnsubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0xb0, 0x2, 0x7e, 0xe4};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32484);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 31249 [] []
TEST(UnsubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0xb0, 0x2, 0x7a, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31249);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 18278 [] []
TEST(UnsubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0xb0, 0x2, 0x47, 0x66};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18278);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 8788 [] []
TEST(UnsubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0xb0, 0x2, 0x22, 0x54};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8788);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 27653 [] []
TEST(UnsubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0xb0, 0x2, 0x6c, 0x5};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27653);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 11848 [] []
TEST(UnsubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0xb0, 0x2, 0x2e, 0x48};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11848);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 10434 [] []
TEST(UnsubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0xb0, 0x2, 0x28, 0xc2};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10434);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 16799 [] []
TEST(UnsubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0xb0, 0x2, 0x41, 0x9f};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16799);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 19000 [] []
TEST(UnsubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0xb0, 0x2, 0x4a, 0x38};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19000);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 6514 [] []
TEST(UnsubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0xb0, 0x2, 0x19, 0x72};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6514);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 22153 [] []
TEST(UnsubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0xb0, 0x2, 0x56, 0x89};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22153);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 4883 [] []
TEST(UnsubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0xb0, 0x2, 0x13, 0x13};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4883);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 28726 [] []
TEST(UnsubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0xb0, 0x2, 0x70, 0x36};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28726);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 21422 [] []
TEST(UnsubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0xb0, 0x2, 0x53, 0xae};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21422);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 31508 [] []
TEST(UnsubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0xb0, 0x2, 0x7b, 0x14};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31508);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 6014 [] []
TEST(UnsubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0xb0, 0x2, 0x17, 0x7e};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6014);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 21904 [] []
TEST(UnsubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0xb0, 0x2, 0x55, 0x90};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21904);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 4583 [] []
TEST(UnsubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0xb0, 0x2, 0x11, 0xe7};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4583);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 32708 [] []
TEST(UnsubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0xb0, 0x2, 0x7f, 0xc4};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32708);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 21778 [] []
TEST(UnsubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0xb0, 0x2, 0x55, 0x12};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21778);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 6986 [] []
TEST(UnsubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0xb0, 0x2, 0x1b, 0x4a};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6986);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 24965 [] []
TEST(UnsubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0xb0, 0x2, 0x61, 0x85};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24965);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 17537 [] []
TEST(UnsubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0xb0, 0x2, 0x44, 0x81};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17537);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 11936 [] []
TEST(UnsubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0xb0, 0x2, 0x2e, 0xa0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11936);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 14068 [] []
TEST(UnsubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0xb0, 0x2, 0x36, 0xf4};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14068);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 5190 [PropSharedSubscriptionAvailable 237,PropSubscriptionIdentifierAvailable
// 80,PropResponseTopic "\142+\165\129\DEL)\170\209",PropReasonString "\226\191",PropWildcardSubscriptionAvailable
// 156,PropUserProperty "\n\"\ETB\US\207\SIq\142WA>KH\243\DC3\NAK\238`\253\&8gp"
// "\138\154\167\153\224\195\&01&",PropPayloadFormatIndicator 19,PropSessionExpiryInterval
// 13790,PropSubscriptionIdentifierAvailable 79,PropContentType "\240r\197",PropCorrelationData
// "@\193\190\203\DLE\rE",PropContentType
// "\218\140\t\226\219V\246$#\204e\142s\244\245^\222\173\178!-Wbb\187D",PropSubscriptionIdentifier
// 4,PropRequestResponseInformation 211,PropRequestProblemInformation 122]
// [UnsubPacketIdentifierInUse,UnsubSuccess,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode1) {
  uint8_t pkt[] = {0xb0, 0x8a, 0x1,  0x14, 0x46, 0x76, 0x2a, 0xed, 0x29, 0x50, 0x8,  0x0,  0x8,  0x8e, 0x2b, 0xa5,
                   0x81, 0x7f, 0x29, 0xaa, 0xd1, 0x1f, 0x0,  0x2,  0xe2, 0xbf, 0x28, 0x9c, 0x26, 0x0,  0x16, 0xa,
                   0x22, 0x17, 0x1f, 0xcf, 0xf,  0x71, 0x8e, 0x57, 0x41, 0x3e, 0x4b, 0x48, 0xf3, 0x13, 0x15, 0xee,
                   0x60, 0xfd, 0x38, 0x67, 0x70, 0x0,  0x9,  0x8a, 0x9a, 0xa7, 0x99, 0xe0, 0xc3, 0x30, 0x31, 0x26,
                   0x1,  0x13, 0x11, 0x0,  0x0,  0x35, 0xde, 0x29, 0x4f, 0x3,  0x0,  0x3,  0xf0, 0x72, 0xc5, 0x9,
                   0x0,  0x7,  0x40, 0xc1, 0xbe, 0xcb, 0x10, 0xd,  0x45, 0x3,  0x0,  0x1a, 0xda, 0x8c, 0x9,  0xe2,
                   0xdb, 0x56, 0xf6, 0x24, 0x23, 0xcc, 0x65, 0x8e, 0x73, 0xf4, 0xf5, 0x5e, 0xde, 0xad, 0xb2, 0x21,
                   0x2d, 0x57, 0x62, 0x62, 0xbb, 0x44, 0xb,  0x4,  0x19, 0xd3, 0x17, 0x7a, 0x91, 0x0,  0x8f, 0x91,
                   0x11, 0x80, 0x83, 0x80, 0x83, 0x80, 0x80, 0x11, 0x87, 0x8f, 0x80, 0x91, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[17];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 17, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 5190);
  EXPECT_EQ(count, 17);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 10905 [PropTopicAliasMaximum 27710,PropResponseInformation
// "\NUL$\160\192\EOT\141V\208\174\135\215\222c",PropSessionExpiryInterval 17495,PropMessageExpiryInterval
// 14281,PropSharedSubscriptionAvailable 37,PropAuthenticationMethod "ix\140",PropWillDelayInterval
// 1500,PropCorrelationData "m\152\227\182\STX\202l\201g\SO\134\187\216\209n%\DELP|\135\135",PropMessageExpiryInterval
// 3420,PropMaximumQoS 39,PropAuthenticationData
// "7\255:\182q\246\RS\248\&5\144\220\154/79\230T\174\ENQ|\222~\146+\223\214\DLE\252\159",PropServerKeepAlive
// 18407,PropUserProperty "\219M\177'_"
// "\228\212l/\211\250z\145\&1\231\224Y:l\129\201\n\208\DEL\133\205\128B5\147\SOp\239\DC3",PropContentType
// "\228]\218\225j\163/\138+^\DLEVsY*\220\202\163\176\191\141\176\&9\SO\155\252\r\177I\185",PropMessageExpiryInterval
// 24830,PropTopicAlias 22210,PropRetainAvailable 94,PropUserProperty
// "\229C9\222\223\156\&8\DC1\191\154\159\241)\ad\240\215\195" "\223\&3\250\240y\230\248@\136",PropAuthenticationMethod
// "\175\f\160\145\SOH<n\140\167\160\165\172potbS\174\162\166\ESC\225\137A\US\156\226\"\147J",PropWillDelayInterval
// 4706,PropSubscriptionIdentifierAvailable 106,PropReceiveMaximum 2171,PropPayloadFormatIndicator 236]
// [UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode2) {
  uint8_t pkt[] = {
      0xb0, 0x9f, 0x2,  0x2a, 0x99, 0x8b, 0x2,  0x22, 0x6c, 0x3e, 0x1a, 0x0,  0xd,  0x0,  0x24, 0xa0, 0xc0, 0x4,  0x8d,
      0x56, 0xd0, 0xae, 0x87, 0xd7, 0xde, 0x63, 0x11, 0x0,  0x0,  0x44, 0x57, 0x2,  0x0,  0x0,  0x37, 0xc9, 0x2a, 0x25,
      0x15, 0x0,  0x3,  0x69, 0x78, 0x8c, 0x18, 0x0,  0x0,  0x5,  0xdc, 0x9,  0x0,  0x15, 0x6d, 0x98, 0xe3, 0xb6, 0x2,
      0xca, 0x6c, 0xc9, 0x67, 0xe,  0x86, 0xbb, 0xd8, 0xd1, 0x6e, 0x25, 0x7f, 0x50, 0x7c, 0x87, 0x87, 0x2,  0x0,  0x0,
      0xd,  0x5c, 0x24, 0x27, 0x16, 0x0,  0x1d, 0x37, 0xff, 0x3a, 0xb6, 0x71, 0xf6, 0x1e, 0xf8, 0x35, 0x90, 0xdc, 0x9a,
      0x2f, 0x37, 0x39, 0xe6, 0x54, 0xae, 0x5,  0x7c, 0xde, 0x7e, 0x92, 0x2b, 0xdf, 0xd6, 0x10, 0xfc, 0x9f, 0x13, 0x47,
      0xe7, 0x26, 0x0,  0x5,  0xdb, 0x4d, 0xb1, 0x27, 0x5f, 0x0,  0x1d, 0xe4, 0xd4, 0x6c, 0x2f, 0xd3, 0xfa, 0x7a, 0x91,
      0x31, 0xe7, 0xe0, 0x59, 0x3a, 0x6c, 0x81, 0xc9, 0xa,  0xd0, 0x7f, 0x85, 0xcd, 0x80, 0x42, 0x35, 0x93, 0xe,  0x70,
      0xef, 0x13, 0x3,  0x0,  0x1e, 0xe4, 0x5d, 0xda, 0xe1, 0x6a, 0xa3, 0x2f, 0x8a, 0x2b, 0x5e, 0x10, 0x56, 0x73, 0x59,
      0x2a, 0xdc, 0xca, 0xa3, 0xb0, 0xbf, 0x8d, 0xb0, 0x39, 0xe,  0x9b, 0xfc, 0xd,  0xb1, 0x49, 0xb9, 0x2,  0x0,  0x0,
      0x60, 0xfe, 0x23, 0x56, 0xc2, 0x25, 0x5e, 0x26, 0x0,  0x12, 0xe5, 0x43, 0x39, 0xde, 0xdf, 0x9c, 0x38, 0x11, 0xbf,
      0x9a, 0x9f, 0xf1, 0x29, 0x7,  0x64, 0xf0, 0xd7, 0xc3, 0x0,  0x9,  0xdf, 0x33, 0xfa, 0xf0, 0x79, 0xe6, 0xf8, 0x40,
      0x88, 0x15, 0x0,  0x1e, 0xaf, 0xc,  0xa0, 0x91, 0x1,  0x3c, 0x6e, 0x8c, 0xa7, 0xa0, 0xa5, 0xac, 0x70, 0x6f, 0x74,
      0x62, 0x53, 0xae, 0xa2, 0xa6, 0x1b, 0xe1, 0x89, 0x41, 0x1f, 0x9c, 0xe2, 0x22, 0x93, 0x4a, 0x18, 0x0,  0x0,  0x12,
      0x62, 0x29, 0x6a, 0x21, 0x8,  0x7b, 0x1,  0xec, 0x8f, 0x8f, 0x11, 0x80, 0x80, 0x83, 0x91, 0x91, 0x8f, 0x91, 0x11,
      0x83, 0x11, 0x11, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[16];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 16, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10905);
  EXPECT_EQ(count, 16);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 19692 []
// [UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubImplementationSpecificError,UnsubSuccess,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0xb0, 0xf, 0x4c, 0xec, 0x0, 0x8f, 0x91, 0x11, 0x87, 0x87, 0x91, 0x80, 0x8f, 0x0, 0x83, 0x0, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[12];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 12, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19692);
  EXPECT_EQ(count, 12);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 16153 [PropMaximumQoS 141,PropResponseTopic
// "\194\FS\183\SI\245\167\181\185b\EOTn\160\195\202}\ESC\153\136\215\157Z`\183\242\RS0.\\\200\\",PropMaximumQoS
// 174,PropReceiveMaximum 10330,PropRetainAvailable 24,PropMaximumQoS 0,PropWillDelayInterval 19848,PropRetainAvailable
// 90,PropMessageExpiryInterval 95,PropTopicAliasMaximum 10955,PropMaximumPacketSize 22512,PropMessageExpiryInterval
// 4945,PropWillDelayInterval 5332,PropAssignedClientIdentifier
// "-\188\DC3\RSy\237\249\161t\213\133\171O\196\&8\132i\207",PropWillDelayInterval 8228,PropServerKeepAlive
// 21124,PropMaximumPacketSize 2428,PropRetainAvailable 209,PropContentType
// "\189\147N\132[2\SI\DC1\238\SOHc\n\220\156\SIa",PropSharedSubscriptionAvailable 108,PropMaximumQoS
// 241,PropAssignedClientIdentifier
// "\228N\196\145\188\167\&5\129h|1`f\208cM\199v\177ib91\177\191\170\255\224\172",PropResponseInformation
// "\SYN\128uv\228Kb\164d\132\FS\207!?\235\&2a\181\254\NUL\168\137\154\200\v\241\212w",PropRequestResponseInformation
// 69,PropMaximumQoS 175,PropTopicAlias 7798,PropMaximumQoS 1]
// [UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode4) {
  uint8_t pkt[] = {0xb0, 0xe4, 0x1,  0x3f, 0x19, 0xcd, 0x1,  0x24, 0x8d, 0x8,  0x0,  0x1e, 0xc2, 0x1c, 0xb7, 0xf,  0xf5,
                   0xa7, 0xb5, 0xb9, 0x62, 0x4,  0x6e, 0xa0, 0xc3, 0xca, 0x7d, 0x1b, 0x99, 0x88, 0xd7, 0x9d, 0x5a, 0x60,
                   0xb7, 0xf2, 0x1e, 0x30, 0x2e, 0x5c, 0xc8, 0x5c, 0x24, 0xae, 0x21, 0x28, 0x5a, 0x25, 0x18, 0x24, 0x0,
                   0x18, 0x0,  0x0,  0x4d, 0x88, 0x25, 0x5a, 0x2,  0x0,  0x0,  0x0,  0x5f, 0x22, 0x2a, 0xcb, 0x27, 0x0,
                   0x0,  0x57, 0xf0, 0x2,  0x0,  0x0,  0x13, 0x51, 0x18, 0x0,  0x0,  0x14, 0xd4, 0x12, 0x0,  0x12, 0x2d,
                   0xbc, 0x13, 0x1e, 0x79, 0xed, 0xf9, 0xa1, 0x74, 0xd5, 0x85, 0xab, 0x4f, 0xc4, 0x38, 0x84, 0x69, 0xcf,
                   0x18, 0x0,  0x0,  0x20, 0x24, 0x13, 0x52, 0x84, 0x27, 0x0,  0x0,  0x9,  0x7c, 0x25, 0xd1, 0x3,  0x0,
                   0x10, 0xbd, 0x93, 0x4e, 0x84, 0x5b, 0x32, 0xf,  0x11, 0xee, 0x1,  0x63, 0xa,  0xdc, 0x9c, 0xf,  0x61,
                   0x2a, 0x6c, 0x24, 0xf1, 0x12, 0x0,  0x1d, 0xe4, 0x4e, 0xc4, 0x91, 0xbc, 0xa7, 0x35, 0x81, 0x68, 0x7c,
                   0x31, 0x60, 0x66, 0xd0, 0x63, 0x4d, 0xc7, 0x76, 0xb1, 0x69, 0x62, 0x39, 0x31, 0xb1, 0xbf, 0xaa, 0xff,
                   0xe0, 0xac, 0x1a, 0x0,  0x1c, 0x16, 0x80, 0x75, 0x76, 0xe4, 0x4b, 0x62, 0xa4, 0x64, 0x84, 0x1c, 0xcf,
                   0x21, 0x3f, 0xeb, 0x32, 0x61, 0xb5, 0xfe, 0x0,  0xa8, 0x89, 0x9a, 0xc8, 0xb,  0xf1, 0xd4, 0x77, 0x19,
                   0x45, 0x24, 0xaf, 0x23, 0x1e, 0x76, 0x24, 0x1,  0x83, 0x80, 0x11, 0x91, 0x80, 0x11, 0x91, 0x80, 0x87,
                   0x83, 0x91, 0x11, 0x80, 0x11, 0x91, 0x87, 0x11, 0x83, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[19];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 19, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16153);
  EXPECT_EQ(count, 19);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 6562 [PropMaximumQoS 132,PropAssignedClientIdentifier
// "\164\229\241\213\138\215f{\231B\172\158\173\151\164J",PropMaximumQoS 240,PropWildcardSubscriptionAvailable
// 191,PropTopicAlias 16111,PropReceiveMaximum 1701,PropWildcardSubscriptionAvailable 86,PropAuthenticationData
// "-sB\229(\200;\229[\GS\155\233\&4\226\196\185\158\179\FS\169\241\177z|\160B\233=\165"]
// [UnsubNoSubscriptionExisted,UnsubSuccess,UnsubSuccess,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubTopicFilterInvalid]
TEST(UnsubACK5QCTest, Decode5) {
  uint8_t pkt[] = {0xb0, 0x51, 0x19, 0xa2, 0x41, 0x24, 0x84, 0x12, 0x0,  0x10, 0xa4, 0xe5, 0xf1, 0xd5, 0x8a, 0xd7, 0x66,
                   0x7b, 0xe7, 0x42, 0xac, 0x9e, 0xad, 0x97, 0xa4, 0x4a, 0x24, 0xf0, 0x28, 0xbf, 0x23, 0x3e, 0xef, 0x21,
                   0x6,  0xa5, 0x28, 0x56, 0x16, 0x0,  0x1d, 0x2d, 0x73, 0x42, 0xe5, 0x28, 0xc8, 0x3b, 0xe5, 0x5b, 0x1d,
                   0x9b, 0xe9, 0x34, 0xe2, 0xc4, 0xb9, 0x9e, 0xb3, 0x1c, 0xa9, 0xf1, 0xb1, 0x7a, 0x7c, 0xa0, 0x42, 0xe9,
                   0x3d, 0xa5, 0x11, 0x0,  0x0,  0x80, 0x87, 0x80, 0x87, 0x80, 0x91, 0x0,  0x11, 0x0,  0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[13];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 13, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6562);
  EXPECT_EQ(count, 13);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
}

// UnsubscribeResponse 32484 [PropMessageExpiryInterval 24715,PropSessionExpiryInterval 6744,PropSubscriptionIdentifier
// 7,PropAuthenticationData
// "`\252\187q\147\140\132\210\180\227b\201K\142\183\230\244![+\239-\226h\151\STX",PropSubscriptionIdentifierAvailable
// 20,PropTopicAlias 2199,PropServerReference "\246\&2a'\171",PropResponseTopic
// "<U\158\141\252\168\146\NUL_\216;\163",PropAuthenticationMethod "I\224\175\177\226\NUL",PropSessionExpiryInterval
// 7211,PropSessionExpiryInterval 1912,PropSubscriptionIdentifierAvailable 212,PropCorrelationData
// "\248F\SOH\SYN\147\194\236\205W\247\&6R",PropServerKeepAlive 14243,PropCorrelationData "(\234T\200\207i"]
// [UnsubSuccess,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode6) {
  uint8_t pkt[] = {0xb0, 0x81, 0x1,  0x7e, 0xe4, 0x75, 0x2,  0x0,  0x0,  0x60, 0x8b, 0x11, 0x0,  0x0,  0x1a, 0x58, 0xb,
                   0x7,  0x16, 0x0,  0x1a, 0x60, 0xfc, 0xbb, 0x71, 0x93, 0x8c, 0x84, 0xd2, 0xb4, 0xe3, 0x62, 0xc9, 0x4b,
                   0x8e, 0xb7, 0xe6, 0xf4, 0x21, 0x5b, 0x2b, 0xef, 0x2d, 0xe2, 0x68, 0x97, 0x2,  0x29, 0x14, 0x23, 0x8,
                   0x97, 0x1c, 0x0,  0x5,  0xf6, 0x32, 0x61, 0x27, 0xab, 0x8,  0x0,  0xc,  0x3c, 0x55, 0x9e, 0x8d, 0xfc,
                   0xa8, 0x92, 0x0,  0x5f, 0xd8, 0x3b, 0xa3, 0x15, 0x0,  0x6,  0x49, 0xe0, 0xaf, 0xb1, 0xe2, 0x0,  0x11,
                   0x0,  0x0,  0x1c, 0x2b, 0x11, 0x0,  0x0,  0x7,  0x78, 0x29, 0xd4, 0x9,  0x0,  0xc,  0xf8, 0x46, 0x1,
                   0x16, 0x93, 0xc2, 0xec, 0xcd, 0x57, 0xf7, 0x36, 0x52, 0x13, 0x37, 0xa3, 0x9,  0x0,  0x6,  0x28, 0xea,
                   0x54, 0xc8, 0xcf, 0x69, 0x0,  0x8f, 0x8f, 0x11, 0x11, 0x0,  0x8f, 0x80, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[9];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32484);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 31249 [PropReceiveMaximum 22699,PropMaximumPacketSize 11287,PropServerKeepAlive
// 13886,PropMaximumPacketSize 10767,PropResponseInformation
// "\135@(R\172\129\SUBs\\\STX\240\218j\214ik\167{\156O\185cWb\129RT\156\136\DC2",PropServerReference
// "\253",PropMessageExpiryInterval 22332,PropResponseTopic
// "6\163\240\253\143\\\SO\207\DEL\ESC\222b\242\142",PropReceiveMaximum 22623,PropWildcardSubscriptionAvailable
// 50,PropResponseTopic "\148\&3\245&\213IG9\211\189Hv\234\180c\233\164\SYN\181",PropWillDelayInterval
// 7429,PropSubscriptionIdentifierAvailable 17,PropAuthenticationMethod
// "\253w\t\151_\233\171'\242\208\140O\246\140\SO\DEL",PropServerReference "*\SO\242\228",PropContentType
// "\DLE\168|\131R\ENQu\145F\142\193\158B\t#\233Q\209I\228\228\213\201\155\160m\173\242%\212",PropWildcardSubscriptionAvailable
// 198,PropSubscriptionIdentifier 26,PropRetainAvailable 12,PropMessageExpiryInterval 15805,PropAuthenticationMethod
// "\141\169\228",PropSubscriptionIdentifierAvailable 10,PropRequestProblemInformation 254,PropReceiveMaximum
// 18509,PropRequestProblemInformation 199,PropMessageExpiryInterval 21016,PropResponseTopic
// "\175\&3\179\228\255\192\202\SYNi\222X<\EMBxE%\132\223\193\176\216\165\192\&8",PropAuthenticationData
// "<~@9\DC2lk\231u\243Z\235\202\160\199/aB",PropAssignedClientIdentifier
// "\229\ETB\192-\FS%\USo\252\250\r-",PropSessionExpiryInterval 12811]
// [UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubNotAuthorized,UnsubSuccess,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid]
TEST(UnsubACK5QCTest, Decode7) {
  uint8_t pkt[] = {
      0xb0, 0xa7, 0x2,  0x7a, 0x11, 0x8c, 0x2,  0x21, 0x58, 0xab, 0x27, 0x0,  0x0,  0x2c, 0x17, 0x13, 0x36, 0x3e, 0x27,
      0x0,  0x0,  0x2a, 0xf,  0x1a, 0x0,  0x1e, 0x87, 0x40, 0x28, 0x52, 0xac, 0x81, 0x1a, 0x73, 0x5c, 0x2,  0xf0, 0xda,
      0x6a, 0xd6, 0x69, 0x6b, 0xa7, 0x7b, 0x9c, 0x4f, 0xb9, 0x63, 0x57, 0x62, 0x81, 0x52, 0x54, 0x9c, 0x88, 0x12, 0x1c,
      0x0,  0x1,  0xfd, 0x2,  0x0,  0x0,  0x57, 0x3c, 0x8,  0x0,  0xe,  0x36, 0xa3, 0xf0, 0xfd, 0x8f, 0x5c, 0xe,  0xcf,
      0x7f, 0x1b, 0xde, 0x62, 0xf2, 0x8e, 0x21, 0x58, 0x5f, 0x28, 0x32, 0x8,  0x0,  0x13, 0x94, 0x33, 0xf5, 0x26, 0xd5,
      0x49, 0x47, 0x39, 0xd3, 0xbd, 0x48, 0x76, 0xea, 0xb4, 0x63, 0xe9, 0xa4, 0x16, 0xb5, 0x18, 0x0,  0x0,  0x1d, 0x5,
      0x29, 0x11, 0x15, 0x0,  0x10, 0xfd, 0x77, 0x9,  0x97, 0x5f, 0xe9, 0xab, 0x27, 0xf2, 0xd0, 0x8c, 0x4f, 0xf6, 0x8c,
      0xe,  0x7f, 0x1c, 0x0,  0x4,  0x2a, 0xe,  0xf2, 0xe4, 0x3,  0x0,  0x1e, 0x10, 0xa8, 0x7c, 0x83, 0x52, 0x5,  0x75,
      0x91, 0x46, 0x8e, 0xc1, 0x9e, 0x42, 0x9,  0x23, 0xe9, 0x51, 0xd1, 0x49, 0xe4, 0xe4, 0xd5, 0xc9, 0x9b, 0xa0, 0x6d,
      0xad, 0xf2, 0x25, 0xd4, 0x28, 0xc6, 0xb,  0x1a, 0x25, 0xc,  0x2,  0x0,  0x0,  0x3d, 0xbd, 0x15, 0x0,  0x3,  0x8d,
      0xa9, 0xe4, 0x29, 0xa,  0x17, 0xfe, 0x21, 0x48, 0x4d, 0x17, 0xc7, 0x2,  0x0,  0x0,  0x52, 0x18, 0x8,  0x0,  0x19,
      0xaf, 0x33, 0xb3, 0xe4, 0xff, 0xc0, 0xca, 0x16, 0x69, 0xde, 0x58, 0x3c, 0x19, 0x42, 0x78, 0x45, 0x25, 0x84, 0xdf,
      0xc1, 0xb0, 0xd8, 0xa5, 0xc0, 0x38, 0x16, 0x0,  0x12, 0x3c, 0x7e, 0x40, 0x39, 0x12, 0x6c, 0x6b, 0xe7, 0x75, 0xf3,
      0x5a, 0xeb, 0xca, 0xa0, 0xc7, 0x2f, 0x61, 0x42, 0x12, 0x0,  0xc,  0xe5, 0x17, 0xc0, 0x2d, 0x1c, 0x25, 0x1f, 0x6f,
      0xfc, 0xfa, 0xd,  0x2d, 0x11, 0x0,  0x0,  0x32, 0xb,  0x87, 0x11, 0x91, 0x11, 0x0,  0x87, 0x0,  0x8f, 0x0,  0x11,
      0x83, 0x8f, 0x0,  0x91, 0x91, 0x11, 0x83, 0x83, 0x8f, 0x8f, 0x83, 0x91, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[23];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 23, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31249);
  EXPECT_EQ(count, 23);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
}

// UnsubscribeResponse 18278 [PropTopicAliasMaximum 29170,PropTopicAliasMaximum 12797,PropSharedSubscriptionAvailable
// 147,PropMaximumPacketSize 27684,PropReasonString
// "\208\DLE\242\174\201\ETX[\170'\DELv\235f\219h\SI\169\228)%J\128\171\178G\208\171\131",PropRequestResponseInformation
// 215,PropSessionExpiryInterval 21356,PropWillDelayInterval 2475,PropAuthenticationData
// "\247\158\ff\177",PropPayloadFormatIndicator 122,PropRequestResponseInformation 195,PropRetainAvailable
// 117,PropResponseInformation
// "\DC1\206\222\194=QL\CAN\GS\133\192\&5:\RS\EM\161\254\n\133\v\211+\254\DC1b",PropReceiveMaximum
// 8036,PropSubscriptionIdentifier 13,PropAuthenticationMethod
// "\176\237-4\165f\DC3j[]4~\186\133\183\&7\150\142k\247{\t\233\DEL\161",PropTopicAlias 26886,PropTopicAlias
// 27587,PropTopicAliasMaximum 22088,PropContentType "\216'\231Y"]
// [UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubImplementationSpecificError]
TEST(UnsubACK5QCTest, Decode8) {
  uint8_t pkt[] = {
      0xb0, 0xa8, 0x1,  0x47, 0x66, 0x93, 0x1,  0x22, 0x71, 0xf2, 0x22, 0x31, 0xfd, 0x2a, 0x93, 0x27, 0x0,  0x0,  0x6c,
      0x24, 0x1f, 0x0,  0x1c, 0xd0, 0x10, 0xf2, 0xae, 0xc9, 0x3,  0x5b, 0xaa, 0x27, 0x7f, 0x76, 0xeb, 0x66, 0xdb, 0x68,
      0xf,  0xa9, 0xe4, 0x29, 0x25, 0x4a, 0x80, 0xab, 0xb2, 0x47, 0xd0, 0xab, 0x83, 0x19, 0xd7, 0x11, 0x0,  0x0,  0x53,
      0x6c, 0x18, 0x0,  0x0,  0x9,  0xab, 0x16, 0x0,  0x5,  0xf7, 0x9e, 0xc,  0x66, 0xb1, 0x1,  0x7a, 0x19, 0xc3, 0x25,
      0x75, 0x1a, 0x0,  0x19, 0x11, 0xce, 0xde, 0xc2, 0x3d, 0x51, 0x4c, 0x18, 0x1d, 0x85, 0xc0, 0x35, 0x3a, 0x1e, 0x19,
      0xa1, 0xfe, 0xa,  0x85, 0xb,  0xd3, 0x2b, 0xfe, 0x11, 0x62, 0x21, 0x1f, 0x64, 0xb,  0xd,  0x15, 0x0,  0x19, 0xb0,
      0xed, 0x2d, 0x34, 0xa5, 0x66, 0x13, 0x6a, 0x5b, 0x5d, 0x34, 0x7e, 0xba, 0x85, 0xb7, 0x37, 0x96, 0x8e, 0x6b, 0xf7,
      0x7b, 0x9,  0xe9, 0x7f, 0xa1, 0x23, 0x69, 0x6,  0x23, 0x6b, 0xc3, 0x22, 0x56, 0x48, 0x3,  0x0,  0x4,  0xd8, 0x27,
      0xe7, 0x59, 0x8f, 0x87, 0x91, 0x0,  0x0,  0x11, 0x91, 0x0,  0x11, 0x87, 0x87, 0x80, 0x0,  0x11, 0x91, 0x0,  0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[17];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 17, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 18278);
  EXPECT_EQ(count, 17);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
}

// UnsubscribeResponse 8788 [PropServerKeepAlive 26978,PropSessionExpiryInterval 7992,PropMessageExpiryInterval
// 32063,PropAssignedClientIdentifier "\219\202\EOT=1\221\ETX#\206\205\228r\254\230\194`|",PropMaximumPacketSize
// 17219,PropSubscriptionIdentifier 29,PropSubscriptionIdentifierAvailable 175,PropMessageExpiryInterval
// 12813,PropSubscriptionIdentifierAvailable 62,PropSubscriptionIdentifierAvailable 92,PropRequestResponseInformation
// 223,PropReasonString "\SUB\DC3\237\225\130O\142\n\f\232;\221\191\164-\242",PropServerReference
// "\162\245a\NUL0\186%\207&\"\222\238\220\238s\\X\184@k\144\"\229\&9\254\231#\169\228",PropServerKeepAlive
// 10678,PropMaximumQoS 213,PropMaximumQoS 255,PropServerReference "\156\220\&2",PropMaximumPacketSize
// 28763,PropRequestProblemInformation 144]
// [UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode9) {
  uint8_t pkt[] = {0xb0, 0x88, 0x1,  0x22, 0x54, 0x7c, 0x13, 0x69, 0x62, 0x11, 0x0,  0x0,  0x1f, 0x38, 0x2,  0x0,
                   0x0,  0x7d, 0x3f, 0x12, 0x0,  0x11, 0xdb, 0xca, 0x4,  0x3d, 0x31, 0xdd, 0x3,  0x23, 0xce, 0xcd,
                   0xe4, 0x72, 0xfe, 0xe6, 0xc2, 0x60, 0x7c, 0x27, 0x0,  0x0,  0x43, 0x43, 0xb,  0x1d, 0x29, 0xaf,
                   0x2,  0x0,  0x0,  0x32, 0xd,  0x29, 0x3e, 0x29, 0x5c, 0x19, 0xdf, 0x1f, 0x0,  0x10, 0x1a, 0x13,
                   0xed, 0xe1, 0x82, 0x4f, 0x8e, 0xa,  0xc,  0xe8, 0x3b, 0xdd, 0xbf, 0xa4, 0x2d, 0xf2, 0x1c, 0x0,
                   0x1d, 0xa2, 0xf5, 0x61, 0x0,  0x30, 0xba, 0x25, 0xcf, 0x26, 0x22, 0xde, 0xee, 0xdc, 0xee, 0x73,
                   0x5c, 0x58, 0xb8, 0x40, 0x6b, 0x90, 0x22, 0xe5, 0x39, 0xfe, 0xe7, 0x23, 0xa9, 0xe4, 0x13, 0x29,
                   0xb6, 0x24, 0xd5, 0x24, 0xff, 0x1c, 0x0,  0x3,  0x9c, 0xdc, 0x32, 0x27, 0x0,  0x0,  0x70, 0x5b,
                   0x17, 0x90, 0x87, 0x11, 0x80, 0x80, 0x80, 0x80, 0x91, 0x8f, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[9];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 9, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8788);
  EXPECT_EQ(count, 9);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 27653 [PropMessageExpiryInterval 27137,PropCorrelationData
// "\150\&3\172q:\231\135",PropReceiveMaximum 28977,PropMaximumPacketSize 8765,PropCorrelationData
// "u\213\140\152\&7o\181\DLE\145\US*\152\140\135\204,o\151\aO",PropReceiveMaximum 31861,PropMessageExpiryInterval
// 9228,PropSubscriptionIdentifier 21,PropReasonString "]ft\FS2\238\216\204\166\215_\227\142\157\188\179\135\229\146j"]
// [UnsubSuccess,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubSuccess,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode10) {
  uint8_t pkt[] = {0xb0, 0x5f, 0x6c, 0x5,  0x4f, 0x2,  0x0,  0x0,  0x6a, 0x1,  0x9,  0x0,  0x7,  0x96, 0x33, 0xac, 0x71,
                   0x3a, 0xe7, 0x87, 0x21, 0x71, 0x31, 0x27, 0x0,  0x0,  0x22, 0x3d, 0x9,  0x0,  0x14, 0x75, 0xd5, 0x8c,
                   0x98, 0x37, 0x6f, 0xb5, 0x10, 0x91, 0x1f, 0x2a, 0x98, 0x8c, 0x87, 0xcc, 0x2c, 0x6f, 0x97, 0x7,  0x4f,
                   0x21, 0x7c, 0x75, 0x2,  0x0,  0x0,  0x24, 0xc,  0xb,  0x15, 0x1f, 0x0,  0x14, 0x5d, 0x66, 0x74, 0x1c,
                   0x32, 0xee, 0xd8, 0xcc, 0xa6, 0xd7, 0x5f, 0xe3, 0x8e, 0x9d, 0xbc, 0xb3, 0x87, 0xe5, 0x92, 0x6a, 0x0,
                   0x91, 0x11, 0x80, 0x91, 0x0,  0x80, 0x91, 0x0,  0x87, 0x80, 0x0,  0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[13];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 13, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27653);
  EXPECT_EQ(count, 13);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 11848 [PropTopicAliasMaximum 14660,PropServerReference
// "\200\174\198\133a\207y\236\232J\192\206\SI2\231\209\NAK\v\205\&1",PropResponseTopic
// "H@(\153\SOua\135;!\170K\159",PropAssignedClientIdentifier ".j",PropRequestResponseInformation 196,PropReceiveMaximum
// 7860,PropCorrelationData
// "d\156\193\141\250\128\NUL\NAK\212>\EOT\239\133\143J\201\&2\216\144\"\STX\165",PropTopicAliasMaximum
// 8812,PropRetainAvailable 216]
// [UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubSuccess,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubImplementationSpecificError]
TEST(UnsubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0xb0, 0x66, 0x2e, 0x48, 0x52, 0x22, 0x39, 0x44, 0x1c, 0x0,  0x14, 0xc8, 0xae, 0xc6, 0x85,
                   0x61, 0xcf, 0x79, 0xec, 0xe8, 0x4a, 0xc0, 0xce, 0xf,  0x32, 0xe7, 0xd1, 0x15, 0xb,  0xcd,
                   0x31, 0x8,  0x0,  0xd,  0x48, 0x40, 0x28, 0x99, 0xe,  0x75, 0x61, 0x87, 0x3b, 0x21, 0xaa,
                   0x4b, 0x9f, 0x12, 0x0,  0x2,  0x2e, 0x6a, 0x19, 0xc4, 0x21, 0x1e, 0xb4, 0x9,  0x0,  0x16,
                   0x64, 0x9c, 0xc1, 0x8d, 0xfa, 0x80, 0x0,  0x15, 0xd4, 0x3e, 0x4,  0xef, 0x85, 0x8f, 0x4a,
                   0xc9, 0x32, 0xd8, 0x90, 0x22, 0x2,  0xa5, 0x22, 0x22, 0x6c, 0x25, 0xd8, 0x80, 0x11, 0x83,
                   0x0,  0x11, 0x8f, 0x11, 0x83, 0x0,  0x80, 0x91, 0x0,  0x83, 0x80, 0x91, 0x0,  0x83};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[17];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 17, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11848);
  EXPECT_EQ(count, 17);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
}

// UnsubscribeResponse 10434 [PropContentType "\231\153\188v`\178\CAN\142",PropServerReference
// "\STX\144\147\199l5\169=\236\&8\ENQ\218L\247\161\159\172",PropMessageExpiryInterval
// 26774,PropSharedSubscriptionAvailable 189,PropMessageExpiryInterval 150,PropServerReference
// "\141\160\207\&4PJ)\129\138\204\224KB\241\212I\199)s\180\182\FS\194\163\171j\200(^\206",PropAssignedClientIdentifier
// "\227",PropMessageExpiryInterval 627,PropCorrelationData
// "\192\146\252z\140\244&\249S\233\STX\229\DELm",PropContentType "\167\139\DC4\213L7",PropMessageExpiryInterval
// 26701,PropRequestProblemInformation 168,PropSubscriptionIdentifierAvailable 74,PropSubscriptionIdentifierAvailable
// 150,PropResponseInformation "zW\142u\213q\236G\211A\202\"\245\210,\DC4\239\233\245N'",PropMessageExpiryInterval
// 3303,PropUserProperty "\RS\129b\249H~\170ot\143\187I-\211J\199\167\181\212\160\&9\206\216\237\252f^"
// "\145\251|-\183\172\254",PropSessionExpiryInterval 13760,PropMaximumQoS 98]
// [UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubNotAuthorized,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0xb0, 0xd7, 0x1,  0x28, 0xc2, 0xc5, 0x1,  0x3,  0x0,  0x8,  0xe7, 0x99, 0xbc, 0x76, 0x60, 0xb2, 0x18,
                   0x8e, 0x1c, 0x0,  0x11, 0x2,  0x90, 0x93, 0xc7, 0x6c, 0x35, 0xa9, 0x3d, 0xec, 0x38, 0x5,  0xda, 0x4c,
                   0xf7, 0xa1, 0x9f, 0xac, 0x2,  0x0,  0x0,  0x68, 0x96, 0x2a, 0xbd, 0x2,  0x0,  0x0,  0x0,  0x96, 0x1c,
                   0x0,  0x1e, 0x8d, 0xa0, 0xcf, 0x34, 0x50, 0x4a, 0x29, 0x81, 0x8a, 0xcc, 0xe0, 0x4b, 0x42, 0xf1, 0xd4,
                   0x49, 0xc7, 0x29, 0x73, 0xb4, 0xb6, 0x1c, 0xc2, 0xa3, 0xab, 0x6a, 0xc8, 0x28, 0x5e, 0xce, 0x12, 0x0,
                   0x1,  0xe3, 0x2,  0x0,  0x0,  0x2,  0x73, 0x9,  0x0,  0xe,  0xc0, 0x92, 0xfc, 0x7a, 0x8c, 0xf4, 0x26,
                   0xf9, 0x53, 0xe9, 0x2,  0xe5, 0x7f, 0x6d, 0x3,  0x0,  0x6,  0xa7, 0x8b, 0x14, 0xd5, 0x4c, 0x37, 0x2,
                   0x0,  0x0,  0x68, 0x4d, 0x17, 0xa8, 0x29, 0x4a, 0x29, 0x96, 0x1a, 0x0,  0x15, 0x7a, 0x57, 0x8e, 0x75,
                   0xd5, 0x71, 0xec, 0x47, 0xd3, 0x41, 0xca, 0x22, 0xf5, 0xd2, 0x2c, 0x14, 0xef, 0xe9, 0xf5, 0x4e, 0x27,
                   0x2,  0x0,  0x0,  0xc,  0xe7, 0x26, 0x0,  0x1b, 0x1e, 0x81, 0x62, 0xf9, 0x48, 0x7e, 0xaa, 0x6f, 0x74,
                   0x8f, 0xbb, 0x49, 0x2d, 0xd3, 0x4a, 0xc7, 0xa7, 0xb5, 0xd4, 0xa0, 0x39, 0xce, 0xd8, 0xed, 0xfc, 0x66,
                   0x5e, 0x0,  0x7,  0x91, 0xfb, 0x7c, 0x2d, 0xb7, 0xac, 0xfe, 0x11, 0x0,  0x0,  0x35, 0xc0, 0x24, 0x62,
                   0x80, 0x80, 0x80, 0x80, 0x91, 0x83, 0x91, 0x87, 0x11, 0x87, 0x91, 0x87, 0x87, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[14];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 14, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10434);
  EXPECT_EQ(count, 14);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 16799 [PropAuthenticationMethod
// "\GSx\195\222)\194\238&\181]\238\162\198\144\209\217\185\149\144\225",PropResponseTopic
// "(",PropRequestProblemInformation 224,PropSubscriptionIdentifier 21,PropRequestResponseInformation
// 139,PropWillDelayInterval 6123,PropAuthenticationData
// "\206s\239W\141\227\145\235\131\217\242\RS\DC1E\157`\136\223",PropUserProperty
// "\DLE\153\236E\241\&8i\SUB\241\223\188\185\245Ch\178\n\199\194WT\145&y-=f_7"
// "\197\FSN>\236\237\CANA\193\161\163\&1\252\244\231\154\EMS",PropContentType
// "\168(f\173\199*\188\f\193=0J\157\161D\194\158'MY8\vw\214\199<\138\t\176\DLE",PropContentType
// "\220\249\206\142\STXt3\RS\149k\220\155(",PropWillDelayInterval 13682,PropAuthenticationData "b",PropContentType
// "\136=\217\249\234\251\255=@\138\168\217\248i\STX\249rX+\156\176",PropResponseTopic
// "\bh\EMW[\DC1l\178\FS\ENQ\185\143",PropAuthenticationMethod "\141\242\ENQ\233x=\210\166\&2!\191\166\133\CAN \ETB"]
// [UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubSuccess,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubSuccess,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode13) {
  uint8_t pkt[] = {0xb0, 0xf9, 0x1,  0x41, 0x9f, 0xe3, 0x1,  0x15, 0x0,  0x14, 0x1d, 0x78, 0xc3, 0xde, 0x29, 0xc2, 0xee,
                   0x26, 0xb5, 0x5d, 0xee, 0xa2, 0xc6, 0x90, 0xd1, 0xd9, 0xb9, 0x95, 0x90, 0xe1, 0x8,  0x0,  0x1,  0x28,
                   0x17, 0xe0, 0xb,  0x15, 0x19, 0x8b, 0x18, 0x0,  0x0,  0x17, 0xeb, 0x16, 0x0,  0x12, 0xce, 0x73, 0xef,
                   0x57, 0x8d, 0xe3, 0x91, 0xeb, 0x83, 0xd9, 0xf2, 0x1e, 0x11, 0x45, 0x9d, 0x60, 0x88, 0xdf, 0x26, 0x0,
                   0x1d, 0x10, 0x99, 0xec, 0x45, 0xf1, 0x38, 0x69, 0x1a, 0xf1, 0xdf, 0xbc, 0xb9, 0xf5, 0x43, 0x68, 0xb2,
                   0xa,  0xc7, 0xc2, 0x57, 0x54, 0x91, 0x26, 0x79, 0x2d, 0x3d, 0x66, 0x5f, 0x37, 0x0,  0x12, 0xc5, 0x1c,
                   0x4e, 0x3e, 0xec, 0xed, 0x18, 0x41, 0xc1, 0xa1, 0xa3, 0x31, 0xfc, 0xf4, 0xe7, 0x9a, 0x19, 0x53, 0x3,
                   0x0,  0x1e, 0xa8, 0x28, 0x66, 0xad, 0xc7, 0x2a, 0xbc, 0xc,  0xc1, 0x3d, 0x30, 0x4a, 0x9d, 0xa1, 0x44,
                   0xc2, 0x9e, 0x27, 0x4d, 0x59, 0x38, 0xb,  0x77, 0xd6, 0xc7, 0x3c, 0x8a, 0x9,  0xb0, 0x10, 0x3,  0x0,
                   0xd,  0xdc, 0xf9, 0xce, 0x8e, 0x2,  0x74, 0x33, 0x1e, 0x95, 0x6b, 0xdc, 0x9b, 0x28, 0x18, 0x0,  0x0,
                   0x35, 0x72, 0x16, 0x0,  0x1,  0x62, 0x3,  0x0,  0x15, 0x88, 0x3d, 0xd9, 0xf9, 0xea, 0xfb, 0xff, 0x3d,
                   0x40, 0x8a, 0xa8, 0xd9, 0xf8, 0x69, 0x2,  0xf9, 0x72, 0x58, 0x2b, 0x9c, 0xb0, 0x8,  0x0,  0xc,  0x8,
                   0x68, 0x19, 0x57, 0x5b, 0x11, 0x6c, 0xb2, 0x1c, 0x5,  0xb9, 0x8f, 0x15, 0x0,  0x10, 0x8d, 0xf2, 0x5,
                   0xe9, 0x78, 0x3d, 0xd2, 0xa6, 0x32, 0x21, 0xbf, 0xa6, 0x85, 0x18, 0x20, 0x17, 0x8f, 0x80, 0x83, 0x0,
                   0x83, 0x91, 0x80, 0x80, 0x0,  0x80, 0x83, 0x91, 0x91, 0x83, 0x91, 0x91, 0x91, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[18];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 18, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16799);
  EXPECT_EQ(count, 18);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 19000 [PropReceiveMaximum 20861]
// [UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubSuccess,UnsubNoSubscriptionExisted,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode14) {
  uint8_t pkt[] = {0xb0, 0x10, 0x4a, 0x38, 0x3,  0x21, 0x51, 0x7d, 0x91,
                   0x80, 0x0,  0x11, 0x87, 0x91, 0x83, 0x87, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[10];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19000);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 6514 [PropAuthenticationMethod "~\t&F\"m#\216\222",PropPayloadFormatIndicator 130,PropTopicAlias
// 7070,PropResponseInformation "\ACK\200q\188i\204\t\DEL",PropMaximumQoS 192,PropRetainAvailable 56,PropServerKeepAlive
// 16040,PropRetainAvailable 179,PropUserProperty "" "b\237\134(",PropContentType "\169\220\245",PropResponseInformation
// "\253\170\238\188\229\GS\169\&0\DC4\CAN\198\132\164}D\SOH\133\ESCr?x\DC2.\151",PropTopicAlias
// 30069,PropMaximumPacketSize 23905,PropCorrelationData
// "\230\167\244\&0\151n\178\148C\223\209\GS\161\&47\136",PropContentType "\211\140\165Q\218",PropAuthenticationMethod
// "\231\147Ps",PropServerReference "\205\250\248\&6H",PropSessionExpiryInterval 5830,PropSessionExpiryInterval
// 7230,PropSubscriptionIdentifierAvailable 36,PropAuthenticationMethod
// "\168\212\194\DC28\160\r\220.\223\&3\148\251\&5\251+\162\DC4O\160",PropReceiveMaximum
// 19852,PropSharedSubscriptionAvailable 158,PropResponseTopic
// "\211\170\194\209Y6\137NbU\DC3\247U)\152[!R\131\176",PropCorrelationData
// "\164\253\214\180]5\241\147\161\149\174\203n\173"]
// [UnsubUnspecifiedError,UnsubNotAuthorized,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubUnspecifiedError]
TEST(UnsubACK5QCTest, Decode15) {
  uint8_t pkt[] = {0xb0, 0xe4, 0x1,  0x19, 0x72, 0xd1, 0x1,  0x15, 0x0,  0x9,  0x7e, 0x9,  0x26, 0x46, 0x22, 0x6d, 0x23,
                   0xd8, 0xde, 0x1,  0x82, 0x23, 0x1b, 0x9e, 0x1a, 0x0,  0x8,  0x6,  0xc8, 0x71, 0xbc, 0x69, 0xcc, 0x9,
                   0x7f, 0x24, 0xc0, 0x25, 0x38, 0x13, 0x3e, 0xa8, 0x25, 0xb3, 0x26, 0x0,  0x0,  0x0,  0x4,  0x62, 0xed,
                   0x86, 0x28, 0x3,  0x0,  0x3,  0xa9, 0xdc, 0xf5, 0x1a, 0x0,  0x18, 0xfd, 0xaa, 0xee, 0xbc, 0xe5, 0x1d,
                   0xa9, 0x30, 0x14, 0x18, 0xc6, 0x84, 0xa4, 0x7d, 0x44, 0x1,  0x85, 0x1b, 0x72, 0x3f, 0x78, 0x12, 0x2e,
                   0x97, 0x23, 0x75, 0x75, 0x27, 0x0,  0x0,  0x5d, 0x61, 0x9,  0x0,  0x10, 0xe6, 0xa7, 0xf4, 0x30, 0x97,
                   0x6e, 0xb2, 0x94, 0x43, 0xdf, 0xd1, 0x1d, 0xa1, 0x34, 0x37, 0x88, 0x3,  0x0,  0x5,  0xd3, 0x8c, 0xa5,
                   0x51, 0xda, 0x15, 0x0,  0x4,  0xe7, 0x93, 0x50, 0x73, 0x1c, 0x0,  0x5,  0xcd, 0xfa, 0xf8, 0x36, 0x48,
                   0x11, 0x0,  0x0,  0x16, 0xc6, 0x11, 0x0,  0x0,  0x1c, 0x3e, 0x29, 0x24, 0x15, 0x0,  0x14, 0xa8, 0xd4,
                   0xc2, 0x12, 0x38, 0xa0, 0xd,  0xdc, 0x2e, 0xdf, 0x33, 0x94, 0xfb, 0x35, 0xfb, 0x2b, 0xa2, 0x14, 0x4f,
                   0xa0, 0x21, 0x4d, 0x8c, 0x2a, 0x9e, 0x8,  0x0,  0x14, 0xd3, 0xaa, 0xc2, 0xd1, 0x59, 0x36, 0x89, 0x4e,
                   0x62, 0x55, 0x13, 0xf7, 0x55, 0x29, 0x98, 0x5b, 0x21, 0x52, 0x83, 0xb0, 0x9,  0x0,  0xe,  0xa4, 0xfd,
                   0xd6, 0xb4, 0x5d, 0x35, 0xf1, 0x93, 0xa1, 0x95, 0xae, 0xcb, 0x6e, 0xad, 0x80, 0x87, 0x87, 0x83, 0x83,
                   0x0,  0x91, 0x8f, 0x11, 0x91, 0x11, 0x91, 0x11, 0x83, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[15];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 15, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6514);
  EXPECT_EQ(count, 15);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
}

// UnsubscribeResponse 22153 [PropRetainAvailable 112,PropAssignedClientIdentifier
// "\171\235%\188\254f8\164\200#\SUB\198\187\&8\212\173\181#\243\217i\221iC^\EM\203\185",PropWillDelayInterval
// 18288,PropRequestProblemInformation 22,PropRequestProblemInformation 21,PropMaximumQoS
// 53,PropRequestResponseInformation 49,PropCorrelationData
// "\192*,Z<}\r;v\ETB\196\&2\185z\199J\DC4\216\a\SOD\215pW\200",PropTopicAlias 22461,PropSessionExpiryInterval
// 12934,PropSharedSubscriptionAvailable 62,PropUserProperty "\185\t\130\EM\SYN\228k\218\221\163"
// "2}/\186\EOT:\t\128\&1\131\133\"<b\191\234i\181R\201:\179\223\188)u\199\136",PropSubscriptionIdentifierAvailable
// 65,PropMessageExpiryInterval 1269,PropUserProperty "\SUB\ACKp[\248\US\232\DC4\239h"
// "m\137d{\198\251\169\216\180\183\198|\201U<.\168\143",PropAssignedClientIdentifier
// "J\197\209u\DC3\177\160\148<\159g\208\179V\223\SO\255\159\241\203\238]\DC1\190",PropMessageExpiryInterval 12491]
// [UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubSuccess,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode16) {
  uint8_t pkt[] = {0xb0, 0xd1, 0x1,  0x56, 0x89, 0xc7, 0x1,  0x25, 0x70, 0x12, 0x0,  0x1c, 0xab, 0xeb, 0x25, 0xbc, 0xfe,
                   0x66, 0x38, 0xa4, 0xc8, 0x23, 0x1a, 0xc6, 0xbb, 0x38, 0xd4, 0xad, 0xb5, 0x23, 0xf3, 0xd9, 0x69, 0xdd,
                   0x69, 0x43, 0x5e, 0x19, 0xcb, 0xb9, 0x18, 0x0,  0x0,  0x47, 0x70, 0x17, 0x16, 0x17, 0x15, 0x24, 0x35,
                   0x19, 0x31, 0x9,  0x0,  0x19, 0xc0, 0x2a, 0x2c, 0x5a, 0x3c, 0x7d, 0xd,  0x3b, 0x76, 0x17, 0xc4, 0x32,
                   0xb9, 0x7a, 0xc7, 0x4a, 0x14, 0xd8, 0x7,  0xe,  0x44, 0xd7, 0x70, 0x57, 0xc8, 0x23, 0x57, 0xbd, 0x11,
                   0x0,  0x0,  0x32, 0x86, 0x2a, 0x3e, 0x26, 0x0,  0xa,  0xb9, 0x9,  0x82, 0x19, 0x16, 0xe4, 0x6b, 0xda,
                   0xdd, 0xa3, 0x0,  0x1c, 0x32, 0x7d, 0x2f, 0xba, 0x4,  0x3a, 0x9,  0x80, 0x31, 0x83, 0x85, 0x22, 0x3c,
                   0x62, 0xbf, 0xea, 0x69, 0xb5, 0x52, 0xc9, 0x3a, 0xb3, 0xdf, 0xbc, 0x29, 0x75, 0xc7, 0x88, 0x29, 0x41,
                   0x2,  0x0,  0x0,  0x4,  0xf5, 0x26, 0x0,  0xa,  0x1a, 0x6,  0x70, 0x5b, 0xf8, 0x1f, 0xe8, 0x14, 0xef,
                   0x68, 0x0,  0x12, 0x6d, 0x89, 0x64, 0x7b, 0xc6, 0xfb, 0xa9, 0xd8, 0xb4, 0xb7, 0xc6, 0x7c, 0xc9, 0x55,
                   0x3c, 0x2e, 0xa8, 0x8f, 0x12, 0x0,  0x18, 0x4a, 0xc5, 0xd1, 0x75, 0x13, 0xb1, 0xa0, 0x94, 0x3c, 0x9f,
                   0x67, 0xd0, 0xb3, 0x56, 0xdf, 0xe,  0xff, 0x9f, 0xf1, 0xcb, 0xee, 0x5d, 0x11, 0xbe, 0x2,  0x0,  0x0,
                   0x30, 0xcb, 0x8f, 0x87, 0x0,  0x83, 0x83, 0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[6];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 22153);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 4883 [PropMaximumQoS 239,PropAssignedClientIdentifier
// "\146\195\169\243\155{\223\NAK\175D\166\ESC(\ETB\160",PropMaximumQoS 17,PropSessionExpiryInterval
// 19927,PropRequestResponseInformation 6,PropContentType "1\157",PropReceiveMaximum 28707,PropRequestProblemInformation
// 214,PropTopicAliasMaximum 9033,PropMessageExpiryInterval 5269,PropTopicAliasMaximum 26955,PropCorrelationData
// "\244\134\SOHG\148~x\\z\254L\165\n\203\135\128",PropTopicAliasMaximum 26668,PropMessageExpiryInterval
// 5820,PropTopicAliasMaximum 20525,PropServerKeepAlive 21711,PropReceiveMaximum 19859,PropMaximumPacketSize
// 11051,PropMessageExpiryInterval 15162,PropMessageExpiryInterval 28425,PropAuthenticationMethod
// "fi\241\EOT\194\"\138\v\196^~\t\ETX\140\228\US\141\159\DC1\198/\t",PropAuthenticationData
// "H\201\146\209\NUL",PropContentType "\172]x\NAK%U\183\210t\161v;\228\139\t",PropPayloadFormatIndicator
// 197,PropServerReference "W\EOTgw\137\200l\235\178\221\164\216\159byr\150\a\\\148=h$\215\203",PropReceiveMaximum
// 22548,PropMaximumQoS 53,PropRetainAvailable 33,PropCorrelationData
// "\135\156\237\182\176S\220^CE\191\192\141\&1_\182\230\EOTk\218\157~\176\NUL_\247\167\176\248",PropAuthenticationData
// "\173\149\NAK\210\254u\152"]
// [UnsubUnspecifiedError,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode17) {
  uint8_t pkt[] = {0xb0, 0xf6, 0x1,  0x13, 0x13, 0xe7, 0x1,  0x24, 0xef, 0x12, 0x0,  0xf,  0x92, 0xc3, 0xa9, 0xf3, 0x9b,
                   0x7b, 0xdf, 0x15, 0xaf, 0x44, 0xa6, 0x1b, 0x28, 0x17, 0xa0, 0x24, 0x11, 0x11, 0x0,  0x0,  0x4d, 0xd7,
                   0x19, 0x6,  0x3,  0x0,  0x2,  0x31, 0x9d, 0x21, 0x70, 0x23, 0x17, 0xd6, 0x22, 0x23, 0x49, 0x2,  0x0,
                   0x0,  0x14, 0x95, 0x22, 0x69, 0x4b, 0x9,  0x0,  0x10, 0xf4, 0x86, 0x1,  0x47, 0x94, 0x7e, 0x78, 0x5c,
                   0x7a, 0xfe, 0x4c, 0xa5, 0xa,  0xcb, 0x87, 0x80, 0x22, 0x68, 0x2c, 0x2,  0x0,  0x0,  0x16, 0xbc, 0x22,
                   0x50, 0x2d, 0x13, 0x54, 0xcf, 0x21, 0x4d, 0x93, 0x27, 0x0,  0x0,  0x2b, 0x2b, 0x2,  0x0,  0x0,  0x3b,
                   0x3a, 0x2,  0x0,  0x0,  0x6f, 0x9,  0x15, 0x0,  0x16, 0x66, 0x69, 0xf1, 0x4,  0xc2, 0x22, 0x8a, 0xb,
                   0xc4, 0x5e, 0x7e, 0x9,  0x3,  0x8c, 0xe4, 0x1f, 0x8d, 0x9f, 0x11, 0xc6, 0x2f, 0x9,  0x16, 0x0,  0x5,
                   0x48, 0xc9, 0x92, 0xd1, 0x0,  0x3,  0x0,  0xf,  0xac, 0x5d, 0x78, 0x15, 0x25, 0x55, 0xb7, 0xd2, 0x74,
                   0xa1, 0x76, 0x3b, 0xe4, 0x8b, 0x9,  0x1,  0xc5, 0x1c, 0x0,  0x19, 0x57, 0x4,  0x67, 0x77, 0x89, 0xc8,
                   0x6c, 0xeb, 0xb2, 0xdd, 0xa4, 0xd8, 0x9f, 0x62, 0x79, 0x72, 0x96, 0x7,  0x5c, 0x94, 0x3d, 0x68, 0x24,
                   0xd7, 0xcb, 0x21, 0x58, 0x14, 0x24, 0x35, 0x25, 0x21, 0x9,  0x0,  0x1d, 0x87, 0x9c, 0xed, 0xb6, 0xb0,
                   0x53, 0xdc, 0x5e, 0x43, 0x45, 0xbf, 0xc0, 0x8d, 0x31, 0x5f, 0xb6, 0xe6, 0x4,  0x6b, 0xda, 0x9d, 0x7e,
                   0xb0, 0x0,  0x5f, 0xf7, 0xa7, 0xb0, 0xf8, 0x16, 0x0,  0x7,  0xad, 0x95, 0x15, 0xd2, 0xfe, 0x75, 0x98,
                   0x80, 0x0,  0x91, 0x91, 0x8f, 0x83, 0x80, 0x87, 0x83, 0x11, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[11];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4883);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 28726 [PropSubscriptionIdentifierAvailable 135,PropServerKeepAlive 13001,PropUserProperty
// "\132\146\RS\158\&0-n,\EOT\172\202\224\234\159"
// "\137\201@\SYN\150\144\188\r*\\:\196,L>vWO\151\188S\159jN\243\246\227c\197\175",PropReasonString
// "d@\234\165\143E\171\157",PropMaximumQoS 251,PropAuthenticationMethod
// "\SOH\135)\130\225u\NAK\230\166\231Y\242\239\136\254nO`{\238Q\247Y",PropCorrelationData
// "T\200l\142\252\221\182\SYN\241J{\216kdj\214\NAKl\203J\139\&5\223",PropRetainAvailable
// 81,PropSharedSubscriptionAvailable 193,PropServerKeepAlive 21372,PropContentType
// "\178\168G\183\185\254\236+e\238\SOH\STX\194\&2",PropAssignedClientIdentifier "u=J\225\128\233v3",PropReasonString
// ".\NUL\234"] []
TEST(UnsubACK5QCTest, Decode18) {
  uint8_t pkt[] = {0xb0, 0xa4, 0x1,  0x70, 0x36, 0xa0, 0x1,  0x29, 0x87, 0x13, 0x32, 0xc9, 0x26, 0x0,  0xe,  0x84, 0x92,
                   0x1e, 0x9e, 0x30, 0x2d, 0x6e, 0x2c, 0x4,  0xac, 0xca, 0xe0, 0xea, 0x9f, 0x0,  0x1e, 0x89, 0xc9, 0x40,
                   0x16, 0x96, 0x90, 0xbc, 0xd,  0x2a, 0x5c, 0x3a, 0xc4, 0x2c, 0x4c, 0x3e, 0x76, 0x57, 0x4f, 0x97, 0xbc,
                   0x53, 0x9f, 0x6a, 0x4e, 0xf3, 0xf6, 0xe3, 0x63, 0xc5, 0xaf, 0x1f, 0x0,  0x8,  0x64, 0x40, 0xea, 0xa5,
                   0x8f, 0x45, 0xab, 0x9d, 0x24, 0xfb, 0x15, 0x0,  0x17, 0x1,  0x87, 0x29, 0x82, 0xe1, 0x75, 0x15, 0xe6,
                   0xa6, 0xe7, 0x59, 0xf2, 0xef, 0x88, 0xfe, 0x6e, 0x4f, 0x60, 0x7b, 0xee, 0x51, 0xf7, 0x59, 0x9,  0x0,
                   0x17, 0x54, 0xc8, 0x6c, 0x8e, 0xfc, 0xdd, 0xb6, 0x16, 0xf1, 0x4a, 0x7b, 0xd8, 0x6b, 0x64, 0x6a, 0xd6,
                   0x15, 0x6c, 0xcb, 0x4a, 0x8b, 0x35, 0xdf, 0x25, 0x51, 0x2a, 0xc1, 0x13, 0x53, 0x7c, 0x3,  0x0,  0xe,
                   0xb2, 0xa8, 0x47, 0xb7, 0xb9, 0xfe, 0xec, 0x2b, 0x65, 0xee, 0x1,  0x2,  0xc2, 0x32, 0x12, 0x0,  0x8,
                   0x75, 0x3d, 0x4a, 0xe1, 0x80, 0xe9, 0x76, 0x33, 0x1f, 0x0,  0x3,  0x2e, 0x0,  0xea};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[0];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 0, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28726);
  EXPECT_EQ(count, 0);
}

// UnsubscribeResponse 21422 [PropWillDelayInterval 28679,PropMaximumQoS 184,PropMessageExpiryInterval
// 20839,PropWillDelayInterval 2905,PropUserProperty
// "\130\251I\242a\199\153\244\181\SUB\217\181}\ETX\184\NUL\188P,\214\212]@\DC4\226\242"
// "X\201\242\201\DC4\178\&0/\NAK\STX\157V\ENQw\STX`?~\SOc\138\232\155|t\200",PropSubscriptionIdentifierAvailable
// 43,PropSubscriptionIdentifier 7,PropAssignedClientIdentifier "\156\STX\133\189\212\STX>",PropMessageExpiryInterval
// 21485,PropAuthenticationData "\158\128\239\142\171\226\228N\251\188\a\147!\203b\193",PropSharedSubscriptionAvailable
// 130,PropAuthenticationData "?\245\193\182\249D$\EM\197\154\193\DLE(",PropResponseTopic
// "r\176\135)~<\ENQ\213\237nfqi\SOH\161\168\235\186\182n\156\146H\250\143\248\212\&8",PropWillDelayInterval
// 21449,PropAuthenticationMethod
// "H\217\134\187\136\GS\136\200\ESC\181\NAK\200+J\212\&6\138\219\173\b\ACK_y#",PropCorrelationData
// "\174f\205\184j*gH",PropRequestProblemInformation 119,PropAssignedClientIdentifier
// "\186\174Z]\144d\252ZHR\ESC\172\218I\137\181\NAK\252ij2\177\SOHq\EOT{8\RSM",PropServerReference
// "7\248)\155\156\FSb\225\&6",PropMaximumPacketSize 3876,PropMessageExpiryInterval 2379]
// [UnsubTopicFilterInvalid,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode19) {
  uint8_t pkt[] = {
      0xb0, 0x9f, 0x2,  0x53, 0xae, 0x84, 0x2,  0x18, 0x0,  0x0,  0x70, 0x7,  0x24, 0xb8, 0x2,  0x0,  0x0,  0x51, 0x67,
      0x18, 0x0,  0x0,  0xb,  0x59, 0x26, 0x0,  0x1a, 0x82, 0xfb, 0x49, 0xf2, 0x61, 0xc7, 0x99, 0xf4, 0xb5, 0x1a, 0xd9,
      0xb5, 0x7d, 0x3,  0xb8, 0x0,  0xbc, 0x50, 0x2c, 0xd6, 0xd4, 0x5d, 0x40, 0x14, 0xe2, 0xf2, 0x0,  0x1a, 0x58, 0xc9,
      0xf2, 0xc9, 0x14, 0xb2, 0x30, 0x2f, 0x15, 0x2,  0x9d, 0x56, 0x5,  0x77, 0x2,  0x60, 0x3f, 0x7e, 0xe,  0x63, 0x8a,
      0xe8, 0x9b, 0x7c, 0x74, 0xc8, 0x29, 0x2b, 0xb,  0x7,  0x12, 0x0,  0x7,  0x9c, 0x2,  0x85, 0xbd, 0xd4, 0x2,  0x3e,
      0x2,  0x0,  0x0,  0x53, 0xed, 0x16, 0x0,  0x10, 0x9e, 0x80, 0xef, 0x8e, 0xab, 0xe2, 0xe4, 0x4e, 0xfb, 0xbc, 0x7,
      0x93, 0x21, 0xcb, 0x62, 0xc1, 0x2a, 0x82, 0x16, 0x0,  0xd,  0x3f, 0xf5, 0xc1, 0xb6, 0xf9, 0x44, 0x24, 0x19, 0xc5,
      0x9a, 0xc1, 0x10, 0x28, 0x8,  0x0,  0x1c, 0x72, 0xb0, 0x87, 0x29, 0x7e, 0x3c, 0x5,  0xd5, 0xed, 0x6e, 0x66, 0x71,
      0x69, 0x1,  0xa1, 0xa8, 0xeb, 0xba, 0xb6, 0x6e, 0x9c, 0x92, 0x48, 0xfa, 0x8f, 0xf8, 0xd4, 0x38, 0x18, 0x0,  0x0,
      0x53, 0xc9, 0x15, 0x0,  0x18, 0x48, 0xd9, 0x86, 0xbb, 0x88, 0x1d, 0x88, 0xc8, 0x1b, 0xb5, 0x15, 0xc8, 0x2b, 0x4a,
      0xd4, 0x36, 0x8a, 0xdb, 0xad, 0x8,  0x6,  0x5f, 0x79, 0x23, 0x9,  0x0,  0x8,  0xae, 0x66, 0xcd, 0xb8, 0x6a, 0x2a,
      0x67, 0x48, 0x17, 0x77, 0x12, 0x0,  0x1d, 0xba, 0xae, 0x5a, 0x5d, 0x90, 0x64, 0xfc, 0x5a, 0x48, 0x52, 0x1b, 0xac,
      0xda, 0x49, 0x89, 0xb5, 0x15, 0xfc, 0x69, 0x6a, 0x32, 0xb1, 0x1,  0x71, 0x4,  0x7b, 0x38, 0x1e, 0x4d, 0x1c, 0x0,
      0x9,  0x37, 0xf8, 0x29, 0x9b, 0x9c, 0x1c, 0x62, 0xe1, 0x36, 0x27, 0x0,  0x0,  0xf,  0x24, 0x2,  0x0,  0x0,  0x9,
      0x4b, 0x8f, 0x0,  0x91, 0x80, 0x83, 0x8f, 0x83, 0x80, 0x11, 0x83, 0x11, 0x91, 0x80, 0x11, 0x80, 0x91, 0x87, 0x91,
      0x87, 0x0,  0x91, 0x11, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[23];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 23, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21422);
  EXPECT_EQ(count, 23);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 31508 [PropUserProperty "\247{\181C\171{h\188|84\204D\US\165\229#\173\r\230a"
// "0\146\157\236y\NUL\252\203\167_",PropServerReference
// "e\EM\150\222\196\166k\fj\250B\US\245I7\181\b\ETBa\128\239<05\b\163S\140u\\"]
// [UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubSuccess,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubNotAuthorized,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode20) {
  uint8_t pkt[] = {0xb0, 0x66, 0x7b, 0x14, 0x45, 0x26, 0x0,  0x15, 0xf7, 0x7b, 0xb5, 0x43, 0xab, 0x7b, 0x68,
                   0xbc, 0x7c, 0x38, 0x34, 0xcc, 0x44, 0x1f, 0xa5, 0xe5, 0x23, 0xad, 0xd,  0xe6, 0x61, 0x0,
                   0xa,  0x30, 0x92, 0x9d, 0xec, 0x79, 0x0,  0xfc, 0xcb, 0xa7, 0x5f, 0x1c, 0x0,  0x1e, 0x65,
                   0x19, 0x96, 0xde, 0xc4, 0xa6, 0x6b, 0xc,  0x6a, 0xfa, 0x42, 0x1f, 0xf5, 0x49, 0x37, 0xb5,
                   0x8,  0x17, 0x61, 0x80, 0xef, 0x3c, 0x30, 0x35, 0x8,  0xa3, 0x53, 0x8c, 0x75, 0x5c, 0x83,
                   0x83, 0x11, 0x91, 0x0,  0x8f, 0x8f, 0x83, 0x91, 0x0,  0x0,  0x87, 0x8f, 0x83, 0x11, 0x91,
                   0x87, 0x87, 0x87, 0x80, 0x80, 0x91, 0x0,  0x87, 0x91, 0x80, 0x0,  0x91, 0x8f, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[30];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 30, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31508);
  EXPECT_EQ(count, 30);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[27], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[28], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[29], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 6014 [PropRequestProblemInformation 137,PropMaximumQoS 229,PropAssignedClientIdentifier
// "\SO_\160%\201\225{\192",PropPayloadFormatIndicator 244,PropTopicAliasMaximum
// 11438,PropSubscriptionIdentifierAvailable 110,PropResponseTopic "\DLE\155A_\FSF\160\200%\212\212",PropReceiveMaximum
// 18556,PropResponseTopic "9\178\244\NUL\153\129\206\177\128:\253\195",PropRequestProblemInformation
// 31,PropSharedSubscriptionAvailable 65,PropMessageExpiryInterval 25908,PropSharedSubscriptionAvailable
// 157,PropSharedSubscriptionAvailable 160,PropSessionExpiryInterval 12195,PropTopicAliasMaximum
// 11688,PropTopicAliasMaximum 6895,PropWildcardSubscriptionAvailable 56,PropSubscriptionIdentifier 27]
// [UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNoSubscriptionExisted]
TEST(UnsubACK5QCTest, Decode21) {
  uint8_t pkt[] = {0xb0, 0x5b, 0x17, 0x7e, 0x52, 0x17, 0x89, 0x24, 0xe5, 0x12, 0x0,  0x8,  0xe,  0x5f, 0xa0, 0x25,
                   0xc9, 0xe1, 0x7b, 0xc0, 0x1,  0xf4, 0x22, 0x2c, 0xae, 0x29, 0x6e, 0x8,  0x0,  0xb,  0x10, 0x9b,
                   0x41, 0x5f, 0x1c, 0x46, 0xa0, 0xc8, 0x25, 0xd4, 0xd4, 0x21, 0x48, 0x7c, 0x8,  0x0,  0xc,  0x39,
                   0xb2, 0xf4, 0x0,  0x99, 0x81, 0xce, 0xb1, 0x80, 0x3a, 0xfd, 0xc3, 0x17, 0x1f, 0x2a, 0x41, 0x2,
                   0x0,  0x0,  0x65, 0x34, 0x2a, 0x9d, 0x2a, 0xa0, 0x11, 0x0,  0x0,  0x2f, 0xa3, 0x22, 0x2d, 0xa8,
                   0x22, 0x1a, 0xef, 0x28, 0x38, 0xb,  0x1b, 0x8f, 0x83, 0x11, 0x8f, 0x0,  0x11};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[6];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6014);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NO_SUB_EXISTED);
}

// UnsubscribeResponse 21904 [PropMaximumPacketSize 4466,PropMaximumQoS 44,PropWildcardSubscriptionAvailable
// 29,PropMaximumPacketSize 21462,PropSessionExpiryInterval 3915,PropSessionExpiryInterval
// 8258,PropSharedSubscriptionAvailable 173,PropAuthenticationMethod
// "6\230g\170\&4\RS\252}A\140\143\ETB\237O\CAN\158\&4\USO",PropCorrelationData
// "\253\DC3\ETB[\238\132\FSsh\130G\131L7\243Y\174C\170",PropTopicAlias 24650,PropPayloadFormatIndicator
// 80,PropAuthenticationMethod "\187\132\&8\139\US\ACKaBQ\230\179J",PropRetainAvailable
// 64,PropSubscriptionIdentifierAvailable 70,PropResponseTopic
// "\CAN\203B\t\210\238\228\194'\216\NAK\251}\176\205\196",PropResponseInformation
// "\188\245\188@\207\206\237O4\197",PropRetainAvailable 182,PropSubscriptionIdentifier
// 17,PropWildcardSubscriptionAvailable 32,PropWildcardSubscriptionAvailable 207,PropWillDelayInterval 30383]
// [UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubUnspecifiedError,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode22) {
  uint8_t pkt[] = {0xb0, 0x9a, 0x1,  0x55, 0x90, 0x8b, 0x1,  0x27, 0x0,  0x0,  0x11, 0x72, 0x24, 0x2c, 0x28, 0x1d,
                   0x27, 0x0,  0x0,  0x53, 0xd6, 0x11, 0x0,  0x0,  0xf,  0x4b, 0x11, 0x0,  0x0,  0x20, 0x42, 0x2a,
                   0xad, 0x15, 0x0,  0x13, 0x36, 0xe6, 0x67, 0xaa, 0x34, 0x1e, 0xfc, 0x7d, 0x41, 0x8c, 0x8f, 0x17,
                   0xed, 0x4f, 0x18, 0x9e, 0x34, 0x1f, 0x4f, 0x9,  0x0,  0x13, 0xfd, 0x13, 0x17, 0x5b, 0xee, 0x84,
                   0x1c, 0x73, 0x68, 0x82, 0x47, 0x83, 0x4c, 0x37, 0xf3, 0x59, 0xae, 0x43, 0xaa, 0x23, 0x60, 0x4a,
                   0x1,  0x50, 0x15, 0x0,  0xc,  0xbb, 0x84, 0x38, 0x8b, 0x1f, 0x6,  0x61, 0x42, 0x51, 0xe6, 0xb3,
                   0x4a, 0x25, 0x40, 0x29, 0x46, 0x8,  0x0,  0x10, 0x18, 0xcb, 0x42, 0x9,  0xd2, 0xee, 0xe4, 0xc2,
                   0x27, 0xd8, 0x15, 0xfb, 0x7d, 0xb0, 0xcd, 0xc4, 0x1a, 0x0,  0xa,  0xbc, 0xf5, 0xbc, 0x40, 0xcf,
                   0xce, 0xed, 0x4f, 0x34, 0xc5, 0x25, 0xb6, 0xb,  0x11, 0x28, 0x20, 0x28, 0xcf, 0x18, 0x0,  0x0,
                   0x76, 0xaf, 0x8f, 0x11, 0x8f, 0x91, 0x87, 0x83, 0x80, 0x11, 0x11, 0x91, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[11];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21904);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 4583 [PropSubscriptionIdentifierAvailable 111,PropResponseInformation
// "px\169\170\US\164\251j\US\152\EM\221T:/\ENQ ",PropContentType
// "Od\214%w\135\&3q\DEL\150",PropRequestProblemInformation 163,PropResponseInformation
// "*\222\200\142\244\236q\140X5\154'\251a.Vq\185\ETX\204=\178\178",PropReasonString
// "\200\151\ETB\201'\196&\220\SOH\149/\138vs\246\SUB\238\191c\EM",PropResponseTopic
// "<\168f\134\171S\FS\196X\161\254KiQN",PropRequestResponseInformation 187,PropWildcardSubscriptionAvailable
// 201,PropTopicAlias 546,PropMessageExpiryInterval 2620,PropSharedSubscriptionAvailable 194,PropTopicAliasMaximum
// 32444,PropResponseTopic "\128*\135\226\143\SYN\252",PropRetainAvailable 13,PropUserProperty "\f\137\155Q\DC4\a"
// "t\249\231r\"\142\158\253\195\159",PropReasonString "\233\175",PropSharedSubscriptionAvailable
// 164,PropMessageExpiryInterval 21618,PropMessageExpiryInterval 28659,PropRequestProblemInformation
// 160,PropSharedSubscriptionAvailable 111,PropRequestResponseInformation 254,PropRetainAvailable
// 103,PropMessageExpiryInterval 11371,PropMessageExpiryInterval 17128,PropReasonString
// "\tp\FS!A\188\230",PropMessageExpiryInterval 30871,PropSessionExpiryInterval 15784]
// [UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode23) {
  uint8_t pkt[] = {
      0xb0, 0xdc, 0x1,  0x11, 0xe7, 0xd1, 0x1,  0x29, 0x6f, 0x1a, 0x0,  0x11, 0x70, 0x78, 0xa9, 0xaa, 0x1f, 0xa4, 0xfb,
      0x6a, 0x1f, 0x98, 0x19, 0xdd, 0x54, 0x3a, 0x2f, 0x5,  0x20, 0x3,  0x0,  0xa,  0x4f, 0x64, 0xd6, 0x25, 0x77, 0x87,
      0x33, 0x71, 0x7f, 0x96, 0x17, 0xa3, 0x1a, 0x0,  0x17, 0x2a, 0xde, 0xc8, 0x8e, 0xf4, 0xec, 0x71, 0x8c, 0x58, 0x35,
      0x9a, 0x27, 0xfb, 0x61, 0x2e, 0x56, 0x71, 0xb9, 0x3,  0xcc, 0x3d, 0xb2, 0xb2, 0x1f, 0x0,  0x14, 0xc8, 0x97, 0x17,
      0xc9, 0x27, 0xc4, 0x26, 0xdc, 0x1,  0x95, 0x2f, 0x8a, 0x76, 0x73, 0xf6, 0x1a, 0xee, 0xbf, 0x63, 0x19, 0x8,  0x0,
      0xf,  0x3c, 0xa8, 0x66, 0x86, 0xab, 0x53, 0x1c, 0xc4, 0x58, 0xa1, 0xfe, 0x4b, 0x69, 0x51, 0x4e, 0x19, 0xbb, 0x28,
      0xc9, 0x23, 0x2,  0x22, 0x2,  0x0,  0x0,  0xa,  0x3c, 0x2a, 0xc2, 0x22, 0x7e, 0xbc, 0x8,  0x0,  0x7,  0x80, 0x2a,
      0x87, 0xe2, 0x8f, 0x16, 0xfc, 0x25, 0xd,  0x26, 0x0,  0x6,  0xc,  0x89, 0x9b, 0x51, 0x14, 0x7,  0x0,  0xa,  0x74,
      0xf9, 0xe7, 0x72, 0x22, 0x8e, 0x9e, 0xfd, 0xc3, 0x9f, 0x1f, 0x0,  0x2,  0xe9, 0xaf, 0x2a, 0xa4, 0x2,  0x0,  0x0,
      0x54, 0x72, 0x2,  0x0,  0x0,  0x6f, 0xf3, 0x17, 0xa0, 0x2a, 0x6f, 0x19, 0xfe, 0x25, 0x67, 0x2,  0x0,  0x0,  0x2c,
      0x6b, 0x2,  0x0,  0x0,  0x42, 0xe8, 0x1f, 0x0,  0x7,  0x9,  0x70, 0x1c, 0x21, 0x41, 0xbc, 0xe6, 0x2,  0x0,  0x0,
      0x78, 0x97, 0x11, 0x0,  0x0,  0x3d, 0xa8, 0x8f, 0x83, 0x8f, 0x80, 0x83, 0x8f, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[7];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4583);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 32708 [PropWildcardSubscriptionAvailable 111,PropUserProperty
// "\185\176\218\219]\209\190\&7\199\173\192\201\205\155\STX~\GS\149*\142\169\233\203\&8x"
// "\167F\201\189\159",PropAssignedClientIdentifier "\EM\251\155H\196|\152tN%\157h\CAN\FSC",PropMessageExpiryInterval
// 18180,PropCorrelationData "\206L\219\r\rrp\200:\SOH\153X\207\223\159\DC4\130",PropRequestProblemInformation
// 220,PropSubscriptionIdentifier 18,PropResponseInformation
// "wR\194\203\238\155\141\150Y\142\f\231\195\&5\186\234R&\132\ENQeh\186\253",PropResponseTopic
// "8e\180\131k",PropMessageExpiryInterval 20517,PropMessageExpiryInterval 7199,PropSubscriptionIdentifierAvailable
// 163,PropTopicAlias 15265,PropCorrelationData "2W\169ur\217IA\243\241\NULTW\188>\152\f",PropAssignedClientIdentifier
// ":\227\DC3\az\224\150R\200\157\232\251\189#\f\220r!\208\151Kl\165\f\226\202",PropServerKeepAlive
// 25586,PropContentType "",PropReceiveMaximum 26711,PropAuthenticationMethod
// "C+\205\245\&0,\214\188\&7\171\f02\137\174\255\NUL\169\196\bC",PropUserProperty
// "\238;\ESC\255\174=lTgYVu1\SYNb\171\235\202\140\&0" "\214g\134\187#@\150",PropResponseInformation
// "\233\211\208\156\FS0\FSlD",PropWillDelayInterval 29769,PropCorrelationData
// "\213\211`\tF\136\144\156/\251b\SYN\206\DEL\210\FS",PropTopicAliasMaximum 8182]
// [UnsubTopicFilterInvalid,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode24) {
  uint8_t pkt[] = {
      0xb0, 0xa5, 0x2,  0x7f, 0xc4, 0x9f, 0x2,  0x28, 0x6f, 0x26, 0x0,  0x19, 0xb9, 0xb0, 0xda, 0xdb, 0x5d, 0xd1, 0xbe,
      0x37, 0xc7, 0xad, 0xc0, 0xc9, 0xcd, 0x9b, 0x2,  0x7e, 0x1d, 0x95, 0x2a, 0x8e, 0xa9, 0xe9, 0xcb, 0x38, 0x78, 0x0,
      0x5,  0xa7, 0x46, 0xc9, 0xbd, 0x9f, 0x12, 0x0,  0xf,  0x19, 0xfb, 0x9b, 0x48, 0xc4, 0x7c, 0x98, 0x74, 0x4e, 0x25,
      0x9d, 0x68, 0x18, 0x1c, 0x43, 0x2,  0x0,  0x0,  0x47, 0x4,  0x9,  0x0,  0x11, 0xce, 0x4c, 0xdb, 0xd,  0xd,  0x72,
      0x70, 0xc8, 0x3a, 0x1,  0x99, 0x58, 0xcf, 0xdf, 0x9f, 0x14, 0x82, 0x17, 0xdc, 0xb,  0x12, 0x1a, 0x0,  0x18, 0x77,
      0x52, 0xc2, 0xcb, 0xee, 0x9b, 0x8d, 0x96, 0x59, 0x8e, 0xc,  0xe7, 0xc3, 0x35, 0xba, 0xea, 0x52, 0x26, 0x84, 0x5,
      0x65, 0x68, 0xba, 0xfd, 0x8,  0x0,  0x5,  0x38, 0x65, 0xb4, 0x83, 0x6b, 0x2,  0x0,  0x0,  0x50, 0x25, 0x2,  0x0,
      0x0,  0x1c, 0x1f, 0x29, 0xa3, 0x23, 0x3b, 0xa1, 0x9,  0x0,  0x11, 0x32, 0x57, 0xa9, 0x75, 0x72, 0xd9, 0x49, 0x41,
      0xf3, 0xf1, 0x0,  0x54, 0x57, 0xbc, 0x3e, 0x98, 0xc,  0x12, 0x0,  0x1a, 0x3a, 0xe3, 0x13, 0x7,  0x7a, 0xe0, 0x96,
      0x52, 0xc8, 0x9d, 0xe8, 0xfb, 0xbd, 0x23, 0xc,  0xdc, 0x72, 0x21, 0xd0, 0x97, 0x4b, 0x6c, 0xa5, 0xc,  0xe2, 0xca,
      0x13, 0x63, 0xf2, 0x3,  0x0,  0x0,  0x21, 0x68, 0x57, 0x15, 0x0,  0x15, 0x43, 0x2b, 0xcd, 0xf5, 0x30, 0x2c, 0xd6,
      0xbc, 0x37, 0xab, 0xc,  0x30, 0x32, 0x89, 0xae, 0xff, 0x0,  0xa9, 0xc4, 0x8,  0x43, 0x26, 0x0,  0x14, 0xee, 0x3b,
      0x1b, 0xff, 0xae, 0x3d, 0x6c, 0x54, 0x67, 0x59, 0x56, 0x75, 0x31, 0x16, 0x62, 0xab, 0xeb, 0xca, 0x8c, 0x30, 0x0,
      0x7,  0xd6, 0x67, 0x86, 0xbb, 0x23, 0x40, 0x96, 0x1a, 0x0,  0x9,  0xe9, 0xd3, 0xd0, 0x9c, 0x1c, 0x30, 0x1c, 0x6c,
      0x44, 0x18, 0x0,  0x0,  0x74, 0x49, 0x9,  0x0,  0x10, 0xd5, 0xd3, 0x60, 0x9,  0x46, 0x88, 0x90, 0x9c, 0x2f, 0xfb,
      0x62, 0x16, 0xce, 0x7f, 0xd2, 0x1c, 0x22, 0x1f, 0xf6, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[2];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 2, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32708);
  EXPECT_EQ(count, 2);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 21778 []
// [UnsubUnspecifiedError,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubSuccess,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode25) {
  uint8_t pkt[] = {0xb0, 0x16, 0x55, 0x12, 0x0,  0x80, 0x0,  0x91, 0x11, 0x80, 0x8f, 0x0,
                   0x91, 0x80, 0x80, 0x91, 0x8f, 0x11, 0x11, 0x91, 0x11, 0x91, 0x0,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[19];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 19, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21778);
  EXPECT_EQ(count, 19);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 6986 [PropRequestProblemInformation 189,PropReceiveMaximum 4564,PropReasonString
// "\200Q\147\252D\149\227\180Z(_\182\DC4\162\143\134\DC1\247\RS2\241\186",PropWildcardSubscriptionAvailable
// 197,PropTopicAlias 26196,PropMaximumPacketSize 29545,PropSessionExpiryInterval 12864,PropMaximumPacketSize
// 12547,PropRequestResponseInformation 3,PropRequestResponseInformation 79,PropSharedSubscriptionAvailable
// 120,PropSessionExpiryInterval 997,PropSubscriptionIdentifierAvailable 157,PropContentType
// "Y\164\237\162\134\242B\244I\189\130,@R"]
// [UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubNoSubscriptionExisted,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubSuccess,UnsubNotAuthorized,UnsubNotAuthorized,UnsubPacketIdentifierInUse]
TEST(UnsubACK5QCTest, Decode26) {
  uint8_t pkt[] = {0xb0, 0x6f, 0x1b, 0x4a, 0x50, 0x17, 0xbd, 0x21, 0x11, 0xd4, 0x1f, 0x0,  0x16, 0xc8, 0x51, 0x93, 0xfc,
                   0x44, 0x95, 0xe3, 0xb4, 0x5a, 0x28, 0x5f, 0xb6, 0x14, 0xa2, 0x8f, 0x86, 0x11, 0xf7, 0x1e, 0x32, 0xf1,
                   0xba, 0x28, 0xc5, 0x23, 0x66, 0x54, 0x27, 0x0,  0x0,  0x73, 0x69, 0x11, 0x0,  0x0,  0x32, 0x40, 0x27,
                   0x0,  0x0,  0x31, 0x3,  0x19, 0x3,  0x19, 0x4f, 0x2a, 0x78, 0x11, 0x0,  0x0,  0x3,  0xe5, 0x29, 0x9d,
                   0x3,  0x0,  0xe,  0x59, 0xa4, 0xed, 0xa2, 0x86, 0xf2, 0x42, 0xf4, 0x49, 0xbd, 0x82, 0x2c, 0x40, 0x52,
                   0x83, 0x87, 0x80, 0x91, 0x0,  0x80, 0x83, 0x8f, 0x83, 0x8f, 0x8f, 0x83, 0x11, 0x80, 0x80, 0x87, 0x80,
                   0x80, 0x8f, 0x11, 0x11, 0x80, 0x87, 0x83, 0x0,  0x87, 0x87, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[28];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 28, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6986);
  EXPECT_EQ(count, 28);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[26], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[27], LWMQTT_UNSUB_PACKET_ID_IN_USE);
}

// UnsubscribeResponse 24965 [PropMessageExpiryInterval 29871,PropSubscriptionIdentifierAvailable
// 194,PropCorrelationData
// "u\\\213F=\213\184\153\198\244?0\RSD!KqF\STX\234\FS\190\205\141\223\169\199\162",PropRetainAvailable
// 13,PropTopicAlias 15476,PropSubscriptionIdentifierAvailable 222,PropTopicAliasMaximum 1264,PropResponseTopic
// "\ETX\142l",PropMaximumQoS 47,PropAssignedClientIdentifier
// "\239\156\192\248\234\145B:,G4\159",PropMessageExpiryInterval 21251,PropRequestProblemInformation 48,PropReasonString
// "T\165\196\b\147\229K(\253\248\STX\178\STX\167n\ENQ(\148\253\246d\175&",PropAuthenticationData "",PropResponseTopic
// "}",PropContentType "\b\157\&4\213(P3\232g\253`\139Y\131\168 \168\149M\151\192x\DEL\236\185\191X",PropReceiveMaximum
// 20584,PropPayloadFormatIndicator 168,PropMaximumPacketSize 272,PropAssignedClientIdentifier
// "\218\235",PropAuthenticationData "\163\241\200L\232\184c\ESC\152\FS\DC4b\224\&78L\v8\152\166m\169\226C\210rT\223"]
// [UnsubNotAuthorized,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubNotAuthorized,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubNoSubscriptionExisted,UnsubSuccess,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubUnspecifiedError,UnsubUnspecifiedError,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubSuccess]
TEST(UnsubACK5QCTest, Decode27) {
  uint8_t pkt[] = {0xb0, 0xd8, 0x1,  0x61, 0x85, 0xbb, 0x1,  0x2,  0x0,  0x0,  0x74, 0xaf, 0x29, 0xc2, 0x9,  0x0,  0x1c,
                   0x75, 0x5c, 0xd5, 0x46, 0x3d, 0xd5, 0xb8, 0x99, 0xc6, 0xf4, 0x3f, 0x30, 0x1e, 0x44, 0x21, 0x4b, 0x71,
                   0x46, 0x2,  0xea, 0x1c, 0xbe, 0xcd, 0x8d, 0xdf, 0xa9, 0xc7, 0xa2, 0x25, 0xd,  0x23, 0x3c, 0x74, 0x29,
                   0xde, 0x22, 0x4,  0xf0, 0x8,  0x0,  0x3,  0x3,  0x8e, 0x6c, 0x24, 0x2f, 0x12, 0x0,  0xc,  0xef, 0x9c,
                   0xc0, 0xf8, 0xea, 0x91, 0x42, 0x3a, 0x2c, 0x47, 0x34, 0x9f, 0x2,  0x0,  0x0,  0x53, 0x3,  0x17, 0x30,
                   0x1f, 0x0,  0x17, 0x54, 0xa5, 0xc4, 0x8,  0x93, 0xe5, 0x4b, 0x28, 0xfd, 0xf8, 0x2,  0xb2, 0x2,  0xa7,
                   0x6e, 0x5,  0x28, 0x94, 0xfd, 0xf6, 0x64, 0xaf, 0x26, 0x16, 0x0,  0x0,  0x8,  0x0,  0x1,  0x7d, 0x3,
                   0x0,  0x1b, 0x8,  0x9d, 0x34, 0xd5, 0x28, 0x50, 0x33, 0xe8, 0x67, 0xfd, 0x60, 0x8b, 0x59, 0x83, 0xa8,
                   0x20, 0xa8, 0x95, 0x4d, 0x97, 0xc0, 0x78, 0x7f, 0xec, 0xb9, 0xbf, 0x58, 0x21, 0x50, 0x68, 0x1,  0xa8,
                   0x27, 0x0,  0x0,  0x1,  0x10, 0x12, 0x0,  0x2,  0xda, 0xeb, 0x16, 0x0,  0x1c, 0xa3, 0xf1, 0xc8, 0x4c,
                   0xe8, 0xb8, 0x63, 0x1b, 0x98, 0x1c, 0x14, 0x62, 0xe0, 0x37, 0x38, 0x4c, 0xb,  0x38, 0x98, 0xa6, 0x6d,
                   0xa9, 0xe2, 0x43, 0xd2, 0x72, 0x54, 0xdf, 0x87, 0x87, 0x8f, 0x91, 0x80, 0x87, 0x87, 0x80, 0x83, 0x83,
                   0x11, 0x0,  0x8f, 0x87, 0x8f, 0x8f, 0x80, 0x80, 0x8f, 0x87, 0x8f, 0x87, 0x91, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[25];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 25, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24965);
  EXPECT_EQ(count, 25);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_SUCCESS);
}

// UnsubscribeResponse 17537 [PropTopicAlias 14320,PropRequestProblemInformation 21,PropAuthenticationMethod
// "a6\250\141\195\&6\154\rU'\157",PropReasonString "Y\RS\140\133\254",PropSharedSubscriptionAvailable
// 2,PropAuthenticationData "z\204\US\204$'C\SOH\SOH\243J;\171\252\220v\EM\189c\204\129\212^c\131\134
// \SUB\137\SO",PropReceiveMaximum 30316,PropRequestResponseInformation 220,PropMaximumPacketSize
// 30012,PropServerReference
// "\150\&2\174\US\253\138\193\200\228\177\160\240\v\134\220^\179\215\164\217,\DC2\NAK\186\US",PropReceiveMaximum
// 9910,PropSubscriptionIdentifierAvailable 159,PropContentType
// "\219\DC4\199\137\170\191\255\188\245\RS6/0\254g/",PropRequestProblemInformation 175,PropMaximumQoS
// 45,PropResponseInformation
// "\145\195\&0\218\NAKgN\214\194P\149Z_\195\202\231vo2\161\221\200\223p",PropSubscriptionIdentifierAvailable
// 173,PropMaximumQoS 42,PropContentType
// "\168Q\230\245\220\ETX\177\136\211\209\175\156\248\240\245\151bV\137\\",PropPayloadFormatIndicator
// 83,PropSessionExpiryInterval 11017,PropUserProperty "\154\vvf\198\214DD\DEL"
// "\CANN\167\&1\241\247\203\196\174N3\145a(",PropSessionExpiryInterval 2353,PropReasonString "\200\DC1\t\148smt
// e9",PropCorrelationData "\DC2A",PropResponseInformation "\253\DEL;\160QD\234\DLE",PropUserProperty "\252P"
// "\206\179g\170)iw\DLE\219t\r\SUB\225\ACK"]
// [UnsubSuccess,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode28) {
  uint8_t pkt[] = {
      0xb0, 0x98, 0x2,  0x44, 0x81, 0x90, 0x2,  0x23, 0x37, 0xf0, 0x17, 0x15, 0x15, 0x0,  0xb,  0x61, 0x36, 0xfa, 0x8d,
      0xc3, 0x36, 0x9a, 0xd,  0x55, 0x27, 0x9d, 0x1f, 0x0,  0x5,  0x59, 0x1e, 0x8c, 0x85, 0xfe, 0x2a, 0x2,  0x16, 0x0,
      0x1e, 0x7a, 0xcc, 0x1f, 0xcc, 0x24, 0x27, 0x43, 0x1,  0x1,  0xf3, 0x4a, 0x3b, 0xab, 0xfc, 0xdc, 0x76, 0x19, 0xbd,
      0x63, 0xcc, 0x81, 0xd4, 0x5e, 0x63, 0x83, 0x86, 0x20, 0x1a, 0x89, 0xe,  0x21, 0x76, 0x6c, 0x19, 0xdc, 0x27, 0x0,
      0x0,  0x75, 0x3c, 0x1c, 0x0,  0x19, 0x96, 0x32, 0xae, 0x1f, 0xfd, 0x8a, 0xc1, 0xc8, 0xe4, 0xb1, 0xa0, 0xf0, 0xb,
      0x86, 0xdc, 0x5e, 0xb3, 0xd7, 0xa4, 0xd9, 0x2c, 0x12, 0x15, 0xba, 0x1f, 0x21, 0x26, 0xb6, 0x29, 0x9f, 0x3,  0x0,
      0x10, 0xdb, 0x14, 0xc7, 0x89, 0xaa, 0xbf, 0xff, 0xbc, 0xf5, 0x1e, 0x36, 0x2f, 0x30, 0xfe, 0x67, 0x2f, 0x17, 0xaf,
      0x24, 0x2d, 0x1a, 0x0,  0x18, 0x91, 0xc3, 0x30, 0xda, 0x15, 0x67, 0x4e, 0xd6, 0xc2, 0x50, 0x95, 0x5a, 0x5f, 0xc3,
      0xca, 0xe7, 0x76, 0x6f, 0x32, 0xa1, 0xdd, 0xc8, 0xdf, 0x70, 0x29, 0xad, 0x24, 0x2a, 0x3,  0x0,  0x14, 0xa8, 0x51,
      0xe6, 0xf5, 0xdc, 0x3,  0xb1, 0x88, 0xd3, 0xd1, 0xaf, 0x9c, 0xf8, 0xf0, 0xf5, 0x97, 0x62, 0x56, 0x89, 0x5c, 0x1,
      0x53, 0x11, 0x0,  0x0,  0x2b, 0x9,  0x26, 0x0,  0x9,  0x9a, 0xb,  0x76, 0x66, 0xc6, 0xd6, 0x44, 0x44, 0x7f, 0x0,
      0xe,  0x18, 0x4e, 0xa7, 0x31, 0xf1, 0xf7, 0xcb, 0xc4, 0xae, 0x4e, 0x33, 0x91, 0x61, 0x28, 0x11, 0x0,  0x0,  0x9,
      0x31, 0x1f, 0x0,  0xa,  0xc8, 0x11, 0x9,  0x94, 0x73, 0x6d, 0x74, 0x20, 0x65, 0x39, 0x9,  0x0,  0x2,  0x12, 0x41,
      0x1a, 0x0,  0x8,  0xfd, 0x7f, 0x3b, 0xa0, 0x51, 0x44, 0xea, 0x10, 0x26, 0x0,  0x2,  0xfc, 0x50, 0x0,  0xe,  0xce,
      0xb3, 0x67, 0xaa, 0x29, 0x69, 0x77, 0x10, 0xdb, 0x74, 0xd,  0x1a, 0xe1, 0x6,  0x0,  0x87, 0x8f, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[4];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17537);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 11936 [PropCorrelationData "B",PropSharedSubscriptionAvailable 187,PropServerKeepAlive
// 22544,PropMessageExpiryInterval 414,PropSessionExpiryInterval 2745,PropSharedSubscriptionAvailable
// 134,PropServerReference "u\145d\221D\224e\183\219\233\224\182\206k:J\FSb\CAN6\v5\153\163]&",PropReasonString
// "8\174\170",PropMaximumQoS 85,PropContentType "\202\202M$\212\218\241\r\224Z\169\b\130\233.",PropResponseInformation
// "#G\174\SUB\r\188\170\233\238\SUB4\218J|\244\250\208\USq",PropRequestProblemInformation
// 175,PropPayloadFormatIndicator 249,PropAuthenticationMethod
// "^\186\229\214\170\CANo\230v\FS\203\134e\239\130\217\141\SYN\186Mud",PropMessageExpiryInterval
// 24407,PropWildcardSubscriptionAvailable 241,PropServerReference "S7j%\153@",PropWildcardSubscriptionAvailable
// 213,PropWildcardSubscriptionAvailable 79,PropSharedSubscriptionAvailable 250,PropSubscriptionIdentifier
// 24,PropSubscriptionIdentifier 6,PropSubscriptionIdentifier 17]
// [UnsubPacketIdentifierInUse,UnsubSuccess,UnsubTopicFilterInvalid,UnsubSuccess,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubTopicFilterInvalid,UnsubNotAuthorized,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubUnspecifiedError,UnsubPacketIdentifierInUse,UnsubImplementationSpecificError,UnsubSuccess,UnsubNotAuthorized,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubTopicFilterInvalid,UnsubNoSubscriptionExisted,UnsubTopicFilterInvalid,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode29) {
  uint8_t pkt[] = {
      0xb0, 0xb9, 0x1,  0x2e, 0xa0, 0x9b, 0x1,  0x9,  0x0,  0x1,  0x42, 0x2a, 0xbb, 0x13, 0x58, 0x10, 0x2,  0x0,  0x0,
      0x1,  0x9e, 0x11, 0x0,  0x0,  0xa,  0xb9, 0x2a, 0x86, 0x1c, 0x0,  0x1a, 0x75, 0x91, 0x64, 0xdd, 0x44, 0xe0, 0x65,
      0xb7, 0xdb, 0xe9, 0xe0, 0xb6, 0xce, 0x6b, 0x3a, 0x4a, 0x1c, 0x62, 0x18, 0x36, 0xb,  0x35, 0x99, 0xa3, 0x5d, 0x26,
      0x1f, 0x0,  0x3,  0x38, 0xae, 0xaa, 0x24, 0x55, 0x3,  0x0,  0xf,  0xca, 0xca, 0x4d, 0x24, 0xd4, 0xda, 0xf1, 0xd,
      0xe0, 0x5a, 0xa9, 0x8,  0x82, 0xe9, 0x2e, 0x1a, 0x0,  0x13, 0x23, 0x47, 0xae, 0x1a, 0xd,  0xbc, 0xaa, 0xe9, 0xee,
      0x1a, 0x34, 0xda, 0x4a, 0x7c, 0xf4, 0xfa, 0xd0, 0x1f, 0x71, 0x17, 0xaf, 0x1,  0xf9, 0x15, 0x0,  0x16, 0x5e, 0xba,
      0xe5, 0xd6, 0xaa, 0x18, 0x6f, 0xe6, 0x76, 0x1c, 0xcb, 0x86, 0x65, 0xef, 0x82, 0xd9, 0x8d, 0x16, 0xba, 0x4d, 0x75,
      0x64, 0x2,  0x0,  0x0,  0x5f, 0x57, 0x28, 0xf1, 0x1c, 0x0,  0x6,  0x53, 0x37, 0x6a, 0x25, 0x99, 0x40, 0x28, 0xd5,
      0x28, 0x4f, 0x2a, 0xfa, 0xb,  0x18, 0xb,  0x6,  0xb,  0x11, 0x91, 0x0,  0x8f, 0x0,  0x87, 0x91, 0x8f, 0x87, 0x91,
      0x83, 0x83, 0x91, 0x80, 0x91, 0x87, 0x80, 0x91, 0x83, 0x0,  0x87, 0x8f, 0x8f, 0x8f, 0x11, 0x8f, 0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[26];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 26, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 11936);
  EXPECT_EQ(count, 26);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[16], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[17], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[18], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[19], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[20], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[21], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[22], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[23], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[24], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[25], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// UnsubscribeResponse 14068 [PropWildcardSubscriptionAvailable 58,PropUserProperty
// "\224\135\171x6\149\203\184f\174G\246\172b\ESC\232\225\215'\144\163\143n"
// "\DC4\186\238\ENQ\182\&3\SUB\235\167\137eb\140;\242",PropMessageExpiryInterval 472,PropWillDelayInterval
// 28858,PropSubscriptionIdentifierAvailable 233,PropUserProperty "\210\199Z\188;x\139\147" "1",PropAuthenticationMethod
// "\248\136\SUB\FS\aO-\165\253\ENQ",PropAuthenticationData
// "\147\149<_\232FZ\186\177\EM\226\144\252\196\222\\\160r\"\231",PropCorrelationData
// ")w\135)\167\154\205\246\DLE",PropRequestResponseInformation 18,PropSubscriptionIdentifierAvailable
// 203,PropRequestResponseInformation 160,PropAuthenticationMethod "^B\213,8\252\SI\217\236-'x",PropResponseTopic
// "\131\244",PropWildcardSubscriptionAvailable 245]
// [UnsubImplementationSpecificError,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubPacketIdentifierInUse,UnsubNoSubscriptionExisted,UnsubPacketIdentifierInUse,UnsubNotAuthorized,UnsubImplementationSpecificError,UnsubImplementationSpecificError,UnsubSuccess,UnsubUnspecifiedError,UnsubSuccess,UnsubTopicFilterInvalid,UnsubPacketIdentifierInUse,UnsubSuccess,UnsubNotAuthorized]
TEST(UnsubACK5QCTest, Decode30) {
  uint8_t pkt[] = {
      0xb0, 0xa7, 0x1,  0x36, 0xf4, 0x93, 0x1,  0x28, 0x3a, 0x26, 0x0,  0x17, 0xe0, 0x87, 0xab, 0x78, 0x36, 0x95, 0xcb,
      0xb8, 0x66, 0xae, 0x47, 0xf6, 0xac, 0x62, 0x1b, 0xe8, 0xe1, 0xd7, 0x27, 0x90, 0xa3, 0x8f, 0x6e, 0x0,  0xf,  0x14,
      0xba, 0xee, 0x5,  0xb6, 0x33, 0x1a, 0xeb, 0xa7, 0x89, 0x65, 0x62, 0x8c, 0x3b, 0xf2, 0x2,  0x0,  0x0,  0x1,  0xd8,
      0x18, 0x0,  0x0,  0x70, 0xba, 0x29, 0xe9, 0x26, 0x0,  0x8,  0xd2, 0xc7, 0x5a, 0xbc, 0x3b, 0x78, 0x8b, 0x93, 0x0,
      0x1,  0x31, 0x15, 0x0,  0xa,  0xf8, 0x88, 0x1a, 0x1c, 0x7,  0x4f, 0x2d, 0xa5, 0xfd, 0x5,  0x16, 0x0,  0x14, 0x93,
      0x95, 0x3c, 0x5f, 0xe8, 0x46, 0x5a, 0xba, 0xb1, 0x19, 0xe2, 0x90, 0xfc, 0xc4, 0xde, 0x5c, 0xa0, 0x72, 0x22, 0xe7,
      0x9,  0x0,  0x9,  0x29, 0x77, 0x87, 0x29, 0xa7, 0x9a, 0xcd, 0xf6, 0x10, 0x19, 0x12, 0x29, 0xcb, 0x19, 0xa0, 0x15,
      0x0,  0xc,  0x5e, 0x42, 0xd5, 0x2c, 0x38, 0xfc, 0xf,  0xd9, 0xec, 0x2d, 0x27, 0x78, 0x8,  0x0,  0x2,  0x83, 0xf4,
      0x28, 0xf5, 0x83, 0x87, 0x83, 0x91, 0x11, 0x91, 0x87, 0x83, 0x83, 0x0,  0x80, 0x0,  0x8f, 0x91, 0x0,  0x87};
  uint16_t packet_id;
  int count;
  lwmqtt_unsubscribe_status_t statuses[16];
  lwmqtt_err_t err = lwmqtt_decode_unsuback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 16, &count, statuses);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14068);
  EXPECT_EQ(count, 16);
  EXPECT_EQ(statuses[0], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[1], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[2], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[3], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[4], LWMQTT_UNSUB_NO_SUB_EXISTED);
  EXPECT_EQ(statuses[5], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[6], LWMQTT_UNSUB_NOT_AUTHORIZED);
  EXPECT_EQ(statuses[7], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[8], LWMQTT_UNSUB_IMPL_SPECIFIC_ERROR);
  EXPECT_EQ(statuses[9], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[10], LWMQTT_UNSUB_UNSPECIFIED_ERROR);
  EXPECT_EQ(statuses[11], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[12], LWMQTT_UNSUB_TOPIC_FILTER_INVALID);
  EXPECT_EQ(statuses[13], LWMQTT_UNSUB_PACKET_ID_IN_USE);
  EXPECT_EQ(statuses[14], LWMQTT_UNSUB_SUCCESS);
  EXPECT_EQ(statuses[15], LWMQTT_UNSUB_NOT_AUTHORIZED);
}

// DisconnectRequest DiscoNormalDisconnection []
TEST(Disco311QCTest, Encode1) {
  uint8_t pkt[] = {0xe0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT311, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection []
TEST(Disco311QCTest, Encode2) {
  uint8_t pkt[] = {0xe0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT311, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoKeepAliveTimeout [PropSessionExpiryInterval 25450,PropTopicAliasMaximum
// 12609,PropSubscriptionIdentifier 23,PropContentType
// "\198\242\215\161\&7sY#\181\SI\207\136\248c",PropMessageExpiryInterval 28547,PropSubscriptionIdentifier
// 12,PropRetainAvailable 94,PropRetainAvailable 188,PropServerReference
// "\208\230ml\213\243m\247-p\244\RS\217\134,\144\235\&8$\140",PropPayloadFormatIndicator 109,PropServerKeepAlive
// 19461,PropMessageExpiryInterval 4494,PropResponseTopic
// "x\211p4\229\230\139\238=\SOH@\rq",PropSharedSubscriptionAvailable 66,PropRetainAvailable
// 222,PropSessionExpiryInterval 27734,PropMaximumPacketSize 11253,PropRequestResponseInformation 40,PropServerKeepAlive
// 17832,PropResponseTopic ".\156\191\226z\161\227\"\211\197\150\231\243\239J\192\158\RS\137
// \DC3\175\&4",PropMessageExpiryInterval 1201,PropTopicAliasMaximum 15711,PropMaximumQoS 97,PropAuthenticationMethod
// "@\230tU\244\254\181\&3\128\DLEI\228\SUB\221\241\215uj\129"]
TEST(Disco5QCTest, Encode1) {
  uint8_t pkt[] = {
      0xe0, 0xa7, 0x1,  0x8d, 0xa4, 0x1,  0x11, 0x0,  0x0,  0x63, 0x6a, 0x22, 0x31, 0x41, 0xb,  0x17, 0x3,  0x0,  0xe,
      0xc6, 0xf2, 0xd7, 0xa1, 0x37, 0x73, 0x59, 0x23, 0xb5, 0xf,  0xcf, 0x88, 0xf8, 0x63, 0x2,  0x0,  0x0,  0x6f, 0x83,
      0xb,  0xc,  0x25, 0x5e, 0x25, 0xbc, 0x1c, 0x0,  0x14, 0xd0, 0xe6, 0x6d, 0x6c, 0xd5, 0xf3, 0x6d, 0xf7, 0x2d, 0x70,
      0xf4, 0x1e, 0xd9, 0x86, 0x2c, 0x90, 0xeb, 0x38, 0x24, 0x8c, 0x1,  0x6d, 0x13, 0x4c, 0x5,  0x2,  0x0,  0x0,  0x11,
      0x8e, 0x8,  0x0,  0xd,  0x78, 0xd3, 0x70, 0x34, 0xe5, 0xe6, 0x8b, 0xee, 0x3d, 0x1,  0x40, 0xd,  0x71, 0x2a, 0x42,
      0x25, 0xde, 0x11, 0x0,  0x0,  0x6c, 0x56, 0x27, 0x0,  0x0,  0x2b, 0xf5, 0x19, 0x28, 0x13, 0x45, 0xa8, 0x8,  0x0,
      0x17, 0x2e, 0x9c, 0xbf, 0xe2, 0x7a, 0xa1, 0xe3, 0x22, 0xd3, 0xc5, 0x96, 0xe7, 0xf3, 0xef, 0x4a, 0xc0, 0x9e, 0x1e,
      0x89, 0x20, 0x13, 0xaf, 0x34, 0x2,  0x0,  0x0,  0x4,  0xb1, 0x22, 0x3d, 0x5f, 0x24, 0x61, 0x15, 0x0,  0x13, 0x40,
      0xe6, 0x74, 0x55, 0xf4, 0xfe, 0xb5, 0x33, 0x80, 0x10, 0x49, 0xe4, 0x1a, 0xdd, 0xf1, 0xd7, 0x75, 0x6a, 0x81};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xc6, 0xf2, 0xd7, 0xa1, 0x37, 0x73, 0x59, 0x23, 0xb5, 0xf, 0xcf, 0x88, 0xf8, 0x63};
  uint8_t bytesprops1[] = {0xd0, 0xe6, 0x6d, 0x6c, 0xd5, 0xf3, 0x6d, 0xf7, 0x2d, 0x70,
                           0xf4, 0x1e, 0xd9, 0x86, 0x2c, 0x90, 0xeb, 0x38, 0x24, 0x8c};
  uint8_t bytesprops2[] = {0x78, 0xd3, 0x70, 0x34, 0xe5, 0xe6, 0x8b, 0xee, 0x3d, 0x1, 0x40, 0xd, 0x71};
  uint8_t bytesprops3[] = {0x2e, 0x9c, 0xbf, 0xe2, 0x7a, 0xa1, 0xe3, 0x22, 0xd3, 0xc5, 0x96, 0xe7,
                           0xf3, 0xef, 0x4a, 0xc0, 0x9e, 0x1e, 0x89, 0x20, 0x13, 0xaf, 0x34};
  uint8_t bytesprops4[] = {0x40, 0xe6, 0x74, 0x55, 0xf4, 0xfe, 0xb5, 0x33, 0x80, 0x10,
                           0x49, 0xe4, 0x1a, 0xdd, 0xf1, 0xd7, 0x75, 0x6a, 0x81};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25450}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12609}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28547}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 109}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19461}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4494}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27734}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11253}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17832}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1201}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15711}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 141, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoAdministrativeAction [PropRequestProblemInformation 156,PropMaximumPacketSize
// 21994,PropAssignedClientIdentifier
// "\251\180\215\162\193\163\165B\FSS\218\&6\223\US\ENQ[N\172",PropSubscriptionIdentifierAvailable
// 165,PropServerKeepAlive 18090,PropMessageExpiryInterval 7428,PropMessageExpiryInterval
// 20100,PropSubscriptionIdentifier 8,PropSessionExpiryInterval 8470,PropUserProperty
// "ho\217@\244\144\215\133b\173\224s\181\227\DC2S6\243\RS\SI"
// "{\134\220\163\r=\201U|.;",PropSubscriptionIdentifierAvailable 91,PropSubscriptionIdentifier
// 22,PropResponseInformation "99\242\155\176\169\DC3m\DC2\179Zv\240R\147\199",PropReasonString
// "\249\198U\242\141O\189\CAN\155x\226b\SIL\179\216-\SUB\150",PropAuthenticationData
// "\229@e\241\SO\EM@\223\239\234t>\137\182\147\209\215\216Z\\\199\209\n\DEL",PropServerKeepAlive
// 20200,PropPayloadFormatIndicator 73,PropAssignedClientIdentifier
// "D<H\163\159u\DLE\159S~\246r[\215P\170\212'\184\198Q=\fR\210\EMV",PropReasonString
// "\DC4e\139M\136KG\231\183\184",PropMaximumPacketSize 9999,PropUserProperty
// "\229\EM\DC1\fJG\197{\242\221t9oq\230\RS\ETB\r\DLE\SI\245\247\f\177\129"
// "\EOT\245&\195\128L\189%1\244\153\133`\175",PropReceiveMaximum 13861]
TEST(Disco5QCTest, Encode2) {
  uint8_t pkt[] = {
      0xe0, 0x85, 0x2,  0x98, 0x82, 0x2,  0x17, 0x9c, 0x27, 0x0,  0x0,  0x55, 0xea, 0x12, 0x0,  0x12, 0xfb, 0xb4, 0xd7,
      0xa2, 0xc1, 0xa3, 0xa5, 0x42, 0x1c, 0x53, 0xda, 0x36, 0xdf, 0x1f, 0x5,  0x5b, 0x4e, 0xac, 0x29, 0xa5, 0x13, 0x46,
      0xaa, 0x2,  0x0,  0x0,  0x1d, 0x4,  0x2,  0x0,  0x0,  0x4e, 0x84, 0xb,  0x8,  0x11, 0x0,  0x0,  0x21, 0x16, 0x26,
      0x0,  0x14, 0x68, 0x6f, 0xd9, 0x40, 0xf4, 0x90, 0xd7, 0x85, 0x62, 0xad, 0xe0, 0x73, 0xb5, 0xe3, 0x12, 0x53, 0x36,
      0xf3, 0x1e, 0xf,  0x0,  0xb,  0x7b, 0x86, 0xdc, 0xa3, 0xd,  0x3d, 0xc9, 0x55, 0x7c, 0x2e, 0x3b, 0x29, 0x5b, 0xb,
      0x16, 0x1a, 0x0,  0x10, 0x39, 0x39, 0xf2, 0x9b, 0xb0, 0xa9, 0x13, 0x6d, 0x12, 0xb3, 0x5a, 0x76, 0xf0, 0x52, 0x93,
      0xc7, 0x1f, 0x0,  0x13, 0xf9, 0xc6, 0x55, 0xf2, 0x8d, 0x4f, 0xbd, 0x18, 0x9b, 0x78, 0xe2, 0x62, 0xf,  0x4c, 0xb3,
      0xd8, 0x2d, 0x1a, 0x96, 0x16, 0x0,  0x18, 0xe5, 0x40, 0x65, 0xf1, 0xe,  0x19, 0x40, 0xdf, 0xef, 0xea, 0x74, 0x3e,
      0x89, 0xb6, 0x93, 0xd1, 0xd7, 0xd8, 0x5a, 0x5c, 0xc7, 0xd1, 0xa,  0x7f, 0x13, 0x4e, 0xe8, 0x1,  0x49, 0x12, 0x0,
      0x1b, 0x44, 0x3c, 0x48, 0xa3, 0x9f, 0x75, 0x10, 0x9f, 0x53, 0x7e, 0xf6, 0x72, 0x5b, 0xd7, 0x50, 0xaa, 0xd4, 0x27,
      0xb8, 0xc6, 0x51, 0x3d, 0xc,  0x52, 0xd2, 0x19, 0x56, 0x1f, 0x0,  0xa,  0x14, 0x65, 0x8b, 0x4d, 0x88, 0x4b, 0x47,
      0xe7, 0xb7, 0xb8, 0x27, 0x0,  0x0,  0x27, 0xf,  0x26, 0x0,  0x19, 0xe5, 0x19, 0x11, 0xc,  0x4a, 0x47, 0xc5, 0x7b,
      0xf2, 0xdd, 0x74, 0x39, 0x6f, 0x71, 0xe6, 0x1e, 0x17, 0xd,  0x10, 0xf,  0xf5, 0xf7, 0xc,  0xb1, 0x81, 0x0,  0xe,
      0x4,  0xf5, 0x26, 0xc3, 0x80, 0x4c, 0xbd, 0x25, 0x31, 0xf4, 0x99, 0x85, 0x60, 0xaf, 0x21, 0x36, 0x25};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xfb, 0xb4, 0xd7, 0xa2, 0xc1, 0xa3, 0xa5, 0x42, 0x1c,
                           0x53, 0xda, 0x36, 0xdf, 0x1f, 0x5,  0x5b, 0x4e, 0xac};
  uint8_t bytesprops2[] = {0x7b, 0x86, 0xdc, 0xa3, 0xd, 0x3d, 0xc9, 0x55, 0x7c, 0x2e, 0x3b};
  uint8_t bytesprops1[] = {0x68, 0x6f, 0xd9, 0x40, 0xf4, 0x90, 0xd7, 0x85, 0x62, 0xad,
                           0xe0, 0x73, 0xb5, 0xe3, 0x12, 0x53, 0x36, 0xf3, 0x1e, 0xf};
  uint8_t bytesprops3[] = {0x39, 0x39, 0xf2, 0x9b, 0xb0, 0xa9, 0x13, 0x6d,
                           0x12, 0xb3, 0x5a, 0x76, 0xf0, 0x52, 0x93, 0xc7};
  uint8_t bytesprops4[] = {0xf9, 0xc6, 0x55, 0xf2, 0x8d, 0x4f, 0xbd, 0x18, 0x9b, 0x78,
                           0xe2, 0x62, 0xf,  0x4c, 0xb3, 0xd8, 0x2d, 0x1a, 0x96};
  uint8_t bytesprops5[] = {0xe5, 0x40, 0x65, 0xf1, 0xe,  0x19, 0x40, 0xdf, 0xef, 0xea, 0x74, 0x3e,
                           0x89, 0xb6, 0x93, 0xd1, 0xd7, 0xd8, 0x5a, 0x5c, 0xc7, 0xd1, 0xa,  0x7f};
  uint8_t bytesprops6[] = {0x44, 0x3c, 0x48, 0xa3, 0x9f, 0x75, 0x10, 0x9f, 0x53, 0x7e, 0xf6, 0x72, 0x5b, 0xd7,
                           0x50, 0xaa, 0xd4, 0x27, 0xb8, 0xc6, 0x51, 0x3d, 0xc,  0x52, 0xd2, 0x19, 0x56};
  uint8_t bytesprops7[] = {0x14, 0x65, 0x8b, 0x4d, 0x88, 0x4b, 0x47, 0xe7, 0xb7, 0xb8};
  uint8_t bytesprops9[] = {0x4, 0xf5, 0x26, 0xc3, 0x80, 0x4c, 0xbd, 0x25, 0x31, 0xf4, 0x99, 0x85, 0x60, 0xaf};
  uint8_t bytesprops8[] = {0xe5, 0x19, 0x11, 0xc,  0x4a, 0x47, 0xc5, 0x7b, 0xf2, 0xdd, 0x74, 0x39, 0x6f,
                           0x71, 0xe6, 0x1e, 0x17, 0xd,  0x10, 0xf,  0xf5, 0xf7, 0xc,  0xb1, 0x81};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 156}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21994}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18090}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7428}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20100}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8470}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20200}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 9999}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops8}, .v = {14, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13861}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 152, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoWildcardSubscriptionsNotSupported [PropResponseTopic "\158\215 ",PropServerKeepAlive
// 4699,PropRetainAvailable 91,PropWildcardSubscriptionAvailable 255,PropSharedSubscriptionAvailable
// 50,PropSubscriptionIdentifier 18,PropTopicAliasMaximum 661,PropRetainAvailable 255,PropMessageExpiryInterval
// 13576,PropServerKeepAlive 22790,PropReceiveMaximum 29665,PropAuthenticationData
// "s\196\211\162P\160\213pz#\233\241\151",PropSharedSubscriptionAvailable 35,PropSessionExpiryInterval
// 14155,PropSharedSubscriptionAvailable 184,PropWildcardSubscriptionAvailable 98,PropResponseTopic
// "1\184\141\246",PropTopicAlias 31372,PropTopicAliasMaximum 7435,PropReasonString
// "I\253G\224\NULK\DLE7\209\240\&7\176\139H \136",PropResponseInformation "\160\&3\224u
// :\177\217\165JAW\251\ETB\168i\171\186M\199#",PropReceiveMaximum 21427,PropSubscriptionIdentifier
// 1,PropAssignedClientIdentifier "\CAN\183vi\167\228\ESCY\133\180a\164\200Qp\158"]
TEST(Disco5QCTest, Encode3) {
  uint8_t pkt[] = {0xe0, 0x8f, 0x1,  0xa2, 0x8c, 0x1,  0x8,  0x0,  0x3,  0x9e, 0xd7, 0x20, 0x13, 0x12, 0x5b, 0x25, 0x5b,
                   0x28, 0xff, 0x2a, 0x32, 0xb,  0x12, 0x22, 0x2,  0x95, 0x25, 0xff, 0x2,  0x0,  0x0,  0x35, 0x8,  0x13,
                   0x59, 0x6,  0x21, 0x73, 0xe1, 0x16, 0x0,  0xd,  0x73, 0xc4, 0xd3, 0xa2, 0x50, 0xa0, 0xd5, 0x70, 0x7a,
                   0x23, 0xe9, 0xf1, 0x97, 0x2a, 0x23, 0x11, 0x0,  0x0,  0x37, 0x4b, 0x2a, 0xb8, 0x28, 0x62, 0x8,  0x0,
                   0x4,  0x31, 0xb8, 0x8d, 0xf6, 0x23, 0x7a, 0x8c, 0x22, 0x1d, 0xb,  0x1f, 0x0,  0x10, 0x49, 0xfd, 0x47,
                   0xe0, 0x0,  0x4b, 0x10, 0x37, 0xd1, 0xf0, 0x37, 0xb0, 0x8b, 0x48, 0x20, 0x88, 0x1a, 0x0,  0x15, 0xa0,
                   0x33, 0xe0, 0x75, 0x20, 0x3a, 0xb1, 0xd9, 0xa5, 0x4a, 0x41, 0x57, 0xfb, 0x17, 0xa8, 0x69, 0xab, 0xba,
                   0x4d, 0xc7, 0x23, 0x21, 0x53, 0xb3, 0xb,  0x1,  0x12, 0x0,  0x10, 0x18, 0xb7, 0x76, 0x69, 0xa7, 0xe4,
                   0x1b, 0x59, 0x85, 0xb4, 0x61, 0xa4, 0xc8, 0x51, 0x70, 0x9e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9e, 0xd7, 0x20};
  uint8_t bytesprops1[] = {0x73, 0xc4, 0xd3, 0xa2, 0x50, 0xa0, 0xd5, 0x70, 0x7a, 0x23, 0xe9, 0xf1, 0x97};
  uint8_t bytesprops2[] = {0x31, 0xb8, 0x8d, 0xf6};
  uint8_t bytesprops3[] = {0x49, 0xfd, 0x47, 0xe0, 0x0,  0x4b, 0x10, 0x37,
                           0xd1, 0xf0, 0x37, 0xb0, 0x8b, 0x48, 0x20, 0x88};
  uint8_t bytesprops4[] = {0xa0, 0x33, 0xe0, 0x75, 0x20, 0x3a, 0xb1, 0xd9, 0xa5, 0x4a, 0x41,
                           0x57, 0xfb, 0x17, 0xa8, 0x69, 0xab, 0xba, 0x4d, 0xc7, 0x23};
  uint8_t bytesprops5[] = {0x18, 0xb7, 0x76, 0x69, 0xa7, 0xe4, 0x1b, 0x59,
                           0x85, 0xb4, 0x61, 0xa4, 0xc8, 0x51, 0x70, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4699}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 661}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13576}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22790}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29665}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14155}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31372}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7435}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21427}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 1}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 162, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoPacketTooLarge []
TEST(Disco5QCTest, Encode4) {
  uint8_t pkt[] = {0xe0, 0x2, 0x95, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 149, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNotAuthorized [PropMessageExpiryInterval 15490,PropTopicAliasMaximum
// 24696,PropMaximumPacketSize 14149,PropSubscriptionIdentifier 3]
TEST(Disco5QCTest, Encode5) {
  uint8_t pkt[] = {0xe0, 0x11, 0x87, 0xf, 0x2, 0x0,  0x0,  0x3c, 0x82, 0x22,
                   0x60, 0x78, 0x27, 0x0, 0x0, 0x37, 0x45, 0xb,  0x3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15490}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24696}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14149}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 135, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoConnectionRateExceeded [PropCorrelationData
// "7\203\NULi\150\131\177\SI\CAN\174\233|\a\216\t\162\242\"",PropResponseTopic
// "H#\"A\250\181\182",PropMessageExpiryInterval 25058,PropAuthenticationData
// "\211@\213E1\228\137\169y\"\f\227A\195\198uh\165\153",PropAuthenticationMethod
// "\RS\247z~U\187\178\r\a_eq\193\STX)",PropRetainAvailable 32,PropRequestResponseInformation 178,PropResponseTopic
// "/\201\253\219\180'\136=\220#\148\&9\128\247\206\SUB\215\131"]
TEST(Disco5QCTest, Encode6) {
  uint8_t pkt[] = {0xe0, 0x67, 0x9f, 0x65, 0x9,  0x0,  0x12, 0x37, 0xcb, 0x0,  0x69, 0x96, 0x83, 0xb1, 0xf,
                   0x18, 0xae, 0xe9, 0x7c, 0x7,  0xd8, 0x9,  0xa2, 0xf2, 0x22, 0x8,  0x0,  0x7,  0x48, 0x23,
                   0x22, 0x41, 0xfa, 0xb5, 0xb6, 0x2,  0x0,  0x0,  0x61, 0xe2, 0x16, 0x0,  0x13, 0xd3, 0x40,
                   0xd5, 0x45, 0x31, 0xe4, 0x89, 0xa9, 0x79, 0x22, 0xc,  0xe3, 0x41, 0xc3, 0xc6, 0x75, 0x68,
                   0xa5, 0x99, 0x15, 0x0,  0xf,  0x1e, 0xf7, 0x7a, 0x7e, 0x55, 0xbb, 0xb2, 0xd,  0x7,  0x5f,
                   0x65, 0x71, 0xc1, 0x2,  0x29, 0x25, 0x20, 0x19, 0xb2, 0x8,  0x0,  0x12, 0x2f, 0xc9, 0xfd,
                   0xdb, 0xb4, 0x27, 0x88, 0x3d, 0xdc, 0x23, 0x94, 0x39, 0x80, 0xf7, 0xce, 0x1a, 0xd7, 0x83};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x37, 0xcb, 0x0,  0x69, 0x96, 0x83, 0xb1, 0xf,  0x18,
                           0xae, 0xe9, 0x7c, 0x7,  0xd8, 0x9,  0xa2, 0xf2, 0x22};
  uint8_t bytesprops1[] = {0x48, 0x23, 0x22, 0x41, 0xfa, 0xb5, 0xb6};
  uint8_t bytesprops2[] = {0xd3, 0x40, 0xd5, 0x45, 0x31, 0xe4, 0x89, 0xa9, 0x79, 0x22,
                           0xc,  0xe3, 0x41, 0xc3, 0xc6, 0x75, 0x68, 0xa5, 0x99};
  uint8_t bytesprops3[] = {0x1e, 0xf7, 0x7a, 0x7e, 0x55, 0xbb, 0xb2, 0xd, 0x7, 0x5f, 0x65, 0x71, 0xc1, 0x2, 0x29};
  uint8_t bytesprops4[] = {0x2f, 0xc9, 0xfd, 0xdb, 0xb4, 0x27, 0x88, 0x3d, 0xdc,
                           0x23, 0x94, 0x39, 0x80, 0xf7, 0xce, 0x1a, 0xd7, 0x83};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25058}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 159, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoRetainNotSupported [PropContentType "{B\162\198\231\240jq\233n"]
TEST(Disco5QCTest, Encode7) {
  uint8_t pkt[] = {0xe0, 0xf, 0x9a, 0xd, 0x3, 0x0, 0xa, 0x7b, 0x42, 0xa2, 0xc6, 0xe7, 0xf0, 0x6a, 0x71, 0xe9, 0x6e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7b, 0x42, 0xa2, 0xc6, 0xe7, 0xf0, 0x6a, 0x71, 0xe9, 0x6e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 154, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoUseAnotherServer [PropPayloadFormatIndicator 31,PropSharedSubscriptionAvailable
// 161,PropSessionExpiryInterval 21301,PropAuthenticationData "\r\SI\218",PropUserProperty "O\227y\195T"
// "[K<\tn",PropSharedSubscriptionAvailable 182,PropResponseTopic
// "\145\"\245\253x\251[\131T\205\191\253\215\136/",PropResponseTopic "%\239\192\162e\160\aPn\234\186
// \244\217\137x\221{\GSQo\243\136",PropRetainAvailable 12,PropRetainAvailable 61,PropAuthenticationMethod
// "@d\147j\181\177\146\DC1Vw\152K\177,\DC1\251\142\"\179\176\194Z\196:\208\229",PropMaximumPacketSize
// 4523,PropMaximumQoS 28,PropSessionExpiryInterval 19888,PropRetainAvailable 232,PropAuthenticationMethod
// "\ESC_\199\188\159\182\NUL8C?v8",PropAuthenticationMethod "\170a!\215g\131\134S1\234\236",PropTopicAliasMaximum
// 31811,PropMaximumPacketSize 32664,PropAuthenticationData
// "#L\218\218@\228\200\208p\133\160\143t-\197\251J\146\&9\146\129x"]
TEST(Disco5QCTest, Encode8) {
  uint8_t pkt[] = {0xe0, 0xbc, 0x1,  0x9c, 0xb9, 0x1,  0x1,  0x1f, 0x2a, 0xa1, 0x11, 0x0,  0x0,  0x53, 0x35, 0x16,
                   0x0,  0x3,  0xd,  0xf,  0xda, 0x26, 0x0,  0x5,  0x4f, 0xe3, 0x79, 0xc3, 0x54, 0x0,  0x5,  0x5b,
                   0x4b, 0x3c, 0x9,  0x6e, 0x2a, 0xb6, 0x8,  0x0,  0xf,  0x91, 0x22, 0xf5, 0xfd, 0x78, 0xfb, 0x5b,
                   0x83, 0x54, 0xcd, 0xbf, 0xfd, 0xd7, 0x88, 0x2f, 0x8,  0x0,  0x17, 0x25, 0xef, 0xc0, 0xa2, 0x65,
                   0xa0, 0x7,  0x50, 0x6e, 0xea, 0xba, 0x20, 0xf4, 0xd9, 0x89, 0x78, 0xdd, 0x7b, 0x1d, 0x51, 0x6f,
                   0xf3, 0x88, 0x25, 0xc,  0x25, 0x3d, 0x15, 0x0,  0x1a, 0x40, 0x64, 0x93, 0x6a, 0xb5, 0xb1, 0x92,
                   0x11, 0x56, 0x77, 0x98, 0x4b, 0xb1, 0x2c, 0x11, 0xfb, 0x8e, 0x22, 0xb3, 0xb0, 0xc2, 0x5a, 0xc4,
                   0x3a, 0xd0, 0xe5, 0x27, 0x0,  0x0,  0x11, 0xab, 0x24, 0x1c, 0x11, 0x0,  0x0,  0x4d, 0xb0, 0x25,
                   0xe8, 0x15, 0x0,  0xc,  0x1b, 0x5f, 0xc7, 0xbc, 0x9f, 0xb6, 0x0,  0x38, 0x43, 0x3f, 0x76, 0x38,
                   0x15, 0x0,  0xb,  0xaa, 0x61, 0x21, 0xd7, 0x67, 0x83, 0x86, 0x53, 0x31, 0xea, 0xec, 0x22, 0x7c,
                   0x43, 0x27, 0x0,  0x0,  0x7f, 0x98, 0x16, 0x0,  0x16, 0x23, 0x4c, 0xda, 0xda, 0x40, 0xe4, 0xc8,
                   0xd0, 0x70, 0x85, 0xa0, 0x8f, 0x74, 0x2d, 0xc5, 0xfb, 0x4a, 0x92, 0x39, 0x92, 0x81, 0x78};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd, 0xf, 0xda};
  uint8_t bytesprops2[] = {0x5b, 0x4b, 0x3c, 0x9, 0x6e};
  uint8_t bytesprops1[] = {0x4f, 0xe3, 0x79, 0xc3, 0x54};
  uint8_t bytesprops3[] = {0x91, 0x22, 0xf5, 0xfd, 0x78, 0xfb, 0x5b, 0x83, 0x54, 0xcd, 0xbf, 0xfd, 0xd7, 0x88, 0x2f};
  uint8_t bytesprops4[] = {0x25, 0xef, 0xc0, 0xa2, 0x65, 0xa0, 0x7,  0x50, 0x6e, 0xea, 0xba, 0x20,
                           0xf4, 0xd9, 0x89, 0x78, 0xdd, 0x7b, 0x1d, 0x51, 0x6f, 0xf3, 0x88};
  uint8_t bytesprops5[] = {0x40, 0x64, 0x93, 0x6a, 0xb5, 0xb1, 0x92, 0x11, 0x56, 0x77, 0x98, 0x4b, 0xb1,
                           0x2c, 0x11, 0xfb, 0x8e, 0x22, 0xb3, 0xb0, 0xc2, 0x5a, 0xc4, 0x3a, 0xd0, 0xe5};
  uint8_t bytesprops6[] = {0x1b, 0x5f, 0xc7, 0xbc, 0x9f, 0xb6, 0x0, 0x38, 0x43, 0x3f, 0x76, 0x38};
  uint8_t bytesprops7[] = {0xaa, 0x61, 0x21, 0xd7, 0x67, 0x83, 0x86, 0x53, 0x31, 0xea, 0xec};
  uint8_t bytesprops8[] = {0x23, 0x4c, 0xda, 0xda, 0x40, 0xe4, 0xc8, 0xd0, 0x70, 0x85, 0xa0,
                           0x8f, 0x74, 0x2d, 0xc5, 0xfb, 0x4a, 0x92, 0x39, 0x92, 0x81, 0x78};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21301}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops1}, .v = {5, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 12}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4523}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19888}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31811}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32664}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 156, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoImplementationSpecificError [PropResponseTopic
// ")J3'\129_h\148\SUB\172\198\133mV\196\SYN|\ENQ\220\248\138\172\b1",PropMessageExpiryInterval 29415,PropUserProperty
// ";?\154\246\130\144\141\247\225\194~G\204\208\RS"
// "::\155\253\207\SI\185\&8$r\SUBm\v\SUBs\210*\ts\208^{\208",PropAssignedClientIdentifier
// "\ENQn\155\152XL0\207\182)\DEL\171\SOH\222\175\NUL\164q\243p;",PropTopicAliasMaximum 27865,PropReceiveMaximum
// 29170,PropMaximumQoS 196,PropResponseTopic
// "\214\DC4\CAN\131<\195#\SYN'\136)\151\159\ETB\141b\152\193\222",PropResponseTopic "\199\161\213V\EM*",PropTopicAlias
// 2273,PropRetainAvailable 132,PropAuthenticationData
// "\170g\GS\156\224\224\175\166\US\SOHB{-\233\SO:6\220n\242w\EM.21;qp\SI",PropReasonString "
// \153\NUL`\236\143\170\DC1\144\151\164"]
TEST(Disco5QCTest, Encode9) {
  uint8_t pkt[] = {0xe0, 0xc0, 0x1,  0x83, 0xbd, 0x1,  0x8,  0x0,  0x18, 0x29, 0x4a, 0x33, 0x27, 0x81, 0x5f, 0x68, 0x94,
                   0x1a, 0xac, 0xc6, 0x85, 0x6d, 0x56, 0xc4, 0x16, 0x7c, 0x5,  0xdc, 0xf8, 0x8a, 0xac, 0x8,  0x31, 0x2,
                   0x0,  0x0,  0x72, 0xe7, 0x26, 0x0,  0xf,  0x3b, 0x3f, 0x9a, 0xf6, 0x82, 0x90, 0x8d, 0xf7, 0xe1, 0xc2,
                   0x7e, 0x47, 0xcc, 0xd0, 0x1e, 0x0,  0x17, 0x3a, 0x3a, 0x9b, 0xfd, 0xcf, 0xf,  0xb9, 0x38, 0x24, 0x72,
                   0x1a, 0x6d, 0xb,  0x1a, 0x73, 0xd2, 0x2a, 0x9,  0x73, 0xd0, 0x5e, 0x7b, 0xd0, 0x12, 0x0,  0x15, 0x5,
                   0x6e, 0x9b, 0x98, 0x58, 0x4c, 0x30, 0xcf, 0xb6, 0x29, 0x7f, 0xab, 0x1,  0xde, 0xaf, 0x0,  0xa4, 0x71,
                   0xf3, 0x70, 0x3b, 0x22, 0x6c, 0xd9, 0x21, 0x71, 0xf2, 0x24, 0xc4, 0x8,  0x0,  0x13, 0xd6, 0x14, 0x18,
                   0x83, 0x3c, 0xc3, 0x23, 0x16, 0x27, 0x88, 0x29, 0x97, 0x9f, 0x17, 0x8d, 0x62, 0x98, 0xc1, 0xde, 0x8,
                   0x0,  0x6,  0xc7, 0xa1, 0xd5, 0x56, 0x19, 0x2a, 0x23, 0x8,  0xe1, 0x25, 0x84, 0x16, 0x0,  0x1d, 0xaa,
                   0x67, 0x1d, 0x9c, 0xe0, 0xe0, 0xaf, 0xa6, 0x1f, 0x1,  0x42, 0x7b, 0x2d, 0xe9, 0xe,  0x3a, 0x36, 0xdc,
                   0x6e, 0xf2, 0x77, 0x19, 0x2e, 0x32, 0x31, 0x3b, 0x71, 0x70, 0xf,  0x1f, 0x0,  0xb,  0x20, 0x99, 0x0,
                   0x60, 0xec, 0x8f, 0xaa, 0x11, 0x90, 0x97, 0xa4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x29, 0x4a, 0x33, 0x27, 0x81, 0x5f, 0x68, 0x94, 0x1a, 0xac, 0xc6, 0x85,
                           0x6d, 0x56, 0xc4, 0x16, 0x7c, 0x5,  0xdc, 0xf8, 0x8a, 0xac, 0x8,  0x31};
  uint8_t bytesprops2[] = {0x3a, 0x3a, 0x9b, 0xfd, 0xcf, 0xf, 0xb9, 0x38, 0x24, 0x72, 0x1a, 0x6d,
                           0xb,  0x1a, 0x73, 0xd2, 0x2a, 0x9, 0x73, 0xd0, 0x5e, 0x7b, 0xd0};
  uint8_t bytesprops1[] = {0x3b, 0x3f, 0x9a, 0xf6, 0x82, 0x90, 0x8d, 0xf7, 0xe1, 0xc2, 0x7e, 0x47, 0xcc, 0xd0, 0x1e};
  uint8_t bytesprops3[] = {0x5,  0x6e, 0x9b, 0x98, 0x58, 0x4c, 0x30, 0xcf, 0xb6, 0x29, 0x7f,
                           0xab, 0x1,  0xde, 0xaf, 0x0,  0xa4, 0x71, 0xf3, 0x70, 0x3b};
  uint8_t bytesprops4[] = {0xd6, 0x14, 0x18, 0x83, 0x3c, 0xc3, 0x23, 0x16, 0x27, 0x88,
                           0x29, 0x97, 0x9f, 0x17, 0x8d, 0x62, 0x98, 0xc1, 0xde};
  uint8_t bytesprops5[] = {0xc7, 0xa1, 0xd5, 0x56, 0x19, 0x2a};
  uint8_t bytesprops6[] = {0xaa, 0x67, 0x1d, 0x9c, 0xe0, 0xe0, 0xaf, 0xa6, 0x1f, 0x1,  0x42, 0x7b, 0x2d, 0xe9, 0xe,
                           0x3a, 0x36, 0xdc, 0x6e, 0xf2, 0x77, 0x19, 0x2e, 0x32, 0x31, 0x3b, 0x71, 0x70, 0xf};
  uint8_t bytesprops7[] = {0x20, 0x99, 0x0, 0x60, 0xec, 0x8f, 0xaa, 0x11, 0x90, 0x97, 0xa4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29415}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops1}, .v = {23, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27865}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29170}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2273}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 131, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoQuotaExceeded [PropMessageExpiryInterval 27676,PropResponseInformation
// "\177\DC4z5\242\162\244\"\SI\209\200",PropResponseInformation "?",PropAssignedClientIdentifier
// "_\155",PropMessageExpiryInterval 20188,PropReasonString
// "\a\145\132\132\180N\t\239j\EM\255\&4P\168\STXXk\130\DC1D\249o\155o%\b",PropMessageExpiryInterval
// 3992,PropAuthenticationMethod "\226\166\137W6\207G\235\193\148\223\166\157!\156\"\242",PropReceiveMaximum
// 15072,PropRequestResponseInformation 57,PropAuthenticationData "\196D\DELW",PropRequestProblemInformation
// 163,PropUserProperty "{\182m" "\141H\212)2I\160\n\139T\222\155\DC2d\231<\\1\190\ETX\189",PropMessageExpiryInterval
// 27932,PropUserProperty "\254\253"
// "\150\&3~\DC1\204\182\CAN\129\245\179\147$3\156?\234h^\233\182",PropSubscriptionIdentifierAvailable 84]
TEST(Disco5QCTest, Encode10) {
  uint8_t pkt[] = {
      0xe0, 0xa7, 0x1,  0x97, 0xa4, 0x1,  0x2,  0x0,  0x0,  0x6c, 0x1c, 0x1a, 0x0,  0xb,  0xb1, 0x14, 0x7a, 0x35, 0xf2,
      0xa2, 0xf4, 0x22, 0xf,  0xd1, 0xc8, 0x1a, 0x0,  0x1,  0x3f, 0x12, 0x0,  0x2,  0x5f, 0x9b, 0x2,  0x0,  0x0,  0x4e,
      0xdc, 0x1f, 0x0,  0x1a, 0x7,  0x91, 0x84, 0x84, 0xb4, 0x4e, 0x9,  0xef, 0x6a, 0x19, 0xff, 0x34, 0x50, 0xa8, 0x2,
      0x58, 0x6b, 0x82, 0x11, 0x44, 0xf9, 0x6f, 0x9b, 0x6f, 0x25, 0x8,  0x2,  0x0,  0x0,  0xf,  0x98, 0x15, 0x0,  0x11,
      0xe2, 0xa6, 0x89, 0x57, 0x36, 0xcf, 0x47, 0xeb, 0xc1, 0x94, 0xdf, 0xa6, 0x9d, 0x21, 0x9c, 0x22, 0xf2, 0x21, 0x3a,
      0xe0, 0x19, 0x39, 0x16, 0x0,  0x4,  0xc4, 0x44, 0x7f, 0x57, 0x17, 0xa3, 0x26, 0x0,  0x3,  0x7b, 0xb6, 0x6d, 0x0,
      0x15, 0x8d, 0x48, 0xd4, 0x29, 0x32, 0x49, 0xa0, 0xa,  0x8b, 0x54, 0xde, 0x9b, 0x12, 0x64, 0xe7, 0x3c, 0x5c, 0x31,
      0xbe, 0x3,  0xbd, 0x2,  0x0,  0x0,  0x6d, 0x1c, 0x26, 0x0,  0x2,  0xfe, 0xfd, 0x0,  0x14, 0x96, 0x33, 0x7e, 0x11,
      0xcc, 0xb6, 0x18, 0x81, 0xf5, 0xb3, 0x93, 0x24, 0x33, 0x9c, 0x3f, 0xea, 0x68, 0x5e, 0xe9, 0xb6, 0x29, 0x54};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb1, 0x14, 0x7a, 0x35, 0xf2, 0xa2, 0xf4, 0x22, 0xf, 0xd1, 0xc8};
  uint8_t bytesprops1[] = {0x3f};
  uint8_t bytesprops2[] = {0x5f, 0x9b};
  uint8_t bytesprops3[] = {0x7,  0x91, 0x84, 0x84, 0xb4, 0x4e, 0x9,  0xef, 0x6a, 0x19, 0xff, 0x34, 0x50,
                           0xa8, 0x2,  0x58, 0x6b, 0x82, 0x11, 0x44, 0xf9, 0x6f, 0x9b, 0x6f, 0x25, 0x8};
  uint8_t bytesprops4[] = {0xe2, 0xa6, 0x89, 0x57, 0x36, 0xcf, 0x47, 0xeb, 0xc1,
                           0x94, 0xdf, 0xa6, 0x9d, 0x21, 0x9c, 0x22, 0xf2};
  uint8_t bytesprops5[] = {0xc4, 0x44, 0x7f, 0x57};
  uint8_t bytesprops7[] = {0x8d, 0x48, 0xd4, 0x29, 0x32, 0x49, 0xa0, 0xa,  0x8b, 0x54, 0xde,
                           0x9b, 0x12, 0x64, 0xe7, 0x3c, 0x5c, 0x31, 0xbe, 0x3,  0xbd};
  uint8_t bytesprops6[] = {0x7b, 0xb6, 0x6d};
  uint8_t bytesprops9[] = {0x96, 0x33, 0x7e, 0x11, 0xcc, 0xb6, 0x18, 0x81, 0xf5, 0xb3,
                           0x93, 0x24, 0x33, 0x9c, 0x3f, 0xea, 0x68, 0x5e, 0xe9, 0xb6};
  uint8_t bytesprops8[] = {0xfe, 0xfd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27676}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20188}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3992}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15072}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops6}, .v = {21, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27932}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops8}, .v = {20, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 84}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 151, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoUseAnotherServer [PropAuthenticationData "@\207\129",PropMessageExpiryInterval 3939]
TEST(Disco5QCTest, Encode11) {
  uint8_t pkt[] = {0xe0, 0xd, 0x9c, 0xb, 0x16, 0x0, 0x3, 0x40, 0xcf, 0x81, 0x2, 0x0, 0x0, 0xf, 0x63};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x40, 0xcf, 0x81};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3939}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 156, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicAliasInvalid [PropAuthenticationData "\221o\133(\191",PropSessionExpiryInterval
// 14872,PropContentType "F\153\SUB+\SYN\208tH`R",PropCorrelationData
// "\DC2\170\148\189G\236\216e\143\SUB\240\239",PropCorrelationData
// "gv\183\238C\244L0I\184\137",PropSubscriptionIdentifier 15]
TEST(Disco5QCTest, Encode12) {
  uint8_t pkt[] = {0xe0, 0x3b, 0x94, 0x39, 0x16, 0x0,  0x5,  0xdd, 0x6f, 0x85, 0x28, 0xbf, 0x11, 0x0,  0x0, 0x3a,
                   0x18, 0x3,  0x0,  0xa,  0x46, 0x99, 0x1a, 0x2b, 0x16, 0xd0, 0x74, 0x48, 0x60, 0x52, 0x9, 0x0,
                   0xc,  0x12, 0xaa, 0x94, 0xbd, 0x47, 0xec, 0xd8, 0x65, 0x8f, 0x1a, 0xf0, 0xef, 0x9,  0x0, 0xb,
                   0x67, 0x76, 0xb7, 0xee, 0x43, 0xf4, 0x4c, 0x30, 0x49, 0xb8, 0x89, 0xb,  0xf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xdd, 0x6f, 0x85, 0x28, 0xbf};
  uint8_t bytesprops1[] = {0x46, 0x99, 0x1a, 0x2b, 0x16, 0xd0, 0x74, 0x48, 0x60, 0x52};
  uint8_t bytesprops2[] = {0x12, 0xaa, 0x94, 0xbd, 0x47, 0xec, 0xd8, 0x65, 0x8f, 0x1a, 0xf0, 0xef};
  uint8_t bytesprops3[] = {0x67, 0x76, 0xb7, 0xee, 0x43, 0xf4, 0x4c, 0x30, 0x49, 0xb8, 0x89};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14872}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 148, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoUnspecifiedError [PropAuthenticationData "\184\163\&9\198\156",PropTopicAliasMaximum
// 1230,PropSubscriptionIdentifier 13,PropRequestResponseInformation 253,PropUserProperty
// "J,\148\247\205_\163n\RS\142\f\SUBs1\164\193^0\162\136z]\ETB\167O+\f9\n" "\177",PropMaximumPacketSize 4426]
TEST(Disco5QCTest, Encode13) {
  uint8_t pkt[] = {0xe0, 0x39, 0x80, 0x37, 0x16, 0x0,  0x5,  0xb8, 0xa3, 0x39, 0xc6, 0x9c, 0x22, 0x4,  0xce,
                   0xb,  0xd,  0x19, 0xfd, 0x26, 0x0,  0x1d, 0x4a, 0x2c, 0x94, 0xf7, 0xcd, 0x5f, 0xa3, 0x6e,
                   0x1e, 0x8e, 0xc,  0x1a, 0x73, 0x31, 0xa4, 0xc1, 0x5e, 0x30, 0xa2, 0x88, 0x7a, 0x5d, 0x17,
                   0xa7, 0x4f, 0x2b, 0xc,  0x39, 0xa,  0x0,  0x1,  0xb1, 0x27, 0x0,  0x0,  0x11, 0x4a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb8, 0xa3, 0x39, 0xc6, 0x9c};
  uint8_t bytesprops2[] = {0xb1};
  uint8_t bytesprops1[] = {0x4a, 0x2c, 0x94, 0xf7, 0xcd, 0x5f, 0xa3, 0x6e, 0x1e, 0x8e, 0xc,  0x1a, 0x73, 0x31, 0xa4,
                           0xc1, 0x5e, 0x30, 0xa2, 0x88, 0x7a, 0x5d, 0x17, 0xa7, 0x4f, 0x2b, 0xc,  0x39, 0xa};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1230}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {1, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4426}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 128, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoQoSNotSupported [PropServerReference
// "/\157\185n\153\237+P\242\147\140\182N\230|\182\DC2\255\232|_",PropMaximumPacketSize 14512,PropRetainAvailable
// 230,PropSubscriptionIdentifierAvailable 22,PropTopicAliasMaximum 7486,PropAuthenticationData
// "dr\239h\137",PropPayloadFormatIndicator 144,PropRequestResponseInformation 202,PropWillDelayInterval 18416]
TEST(Disco5QCTest, Encode14) {
  uint8_t pkt[] = {0xe0, 0x37, 0x9b, 0x35, 0x1c, 0x0,  0x15, 0x2f, 0x9d, 0xb9, 0x6e, 0x99, 0xed, 0x2b, 0x50,
                   0xf2, 0x93, 0x8c, 0xb6, 0x4e, 0xe6, 0x7c, 0xb6, 0x12, 0xff, 0xe8, 0x7c, 0x5f, 0x27, 0x0,
                   0x0,  0x38, 0xb0, 0x25, 0xe6, 0x29, 0x16, 0x22, 0x1d, 0x3e, 0x16, 0x0,  0x5,  0x64, 0x72,
                   0xef, 0x68, 0x89, 0x1,  0x90, 0x19, 0xca, 0x18, 0x0,  0x0,  0x47, 0xf0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2f, 0x9d, 0xb9, 0x6e, 0x99, 0xed, 0x2b, 0x50, 0xf2, 0x93, 0x8c,
                           0xb6, 0x4e, 0xe6, 0x7c, 0xb6, 0x12, 0xff, 0xe8, 0x7c, 0x5f};
  uint8_t bytesprops1[] = {0x64, 0x72, 0xef, 0x68, 0x89};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14512}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7486}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18416}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 155, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSharedSubscriptionsNotSupported [PropAuthenticationData "|\157"]
TEST(Disco5QCTest, Encode15) {
  uint8_t pkt[] = {0xe0, 0x7, 0x9e, 0x5, 0x16, 0x0, 0x2, 0x7c, 0x9d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7c, 0x9d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 158, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoAdministrativeAction [PropRetainAvailable 93,PropTopicAliasMaximum
// 19459,PropSubscriptionIdentifier 1,PropReceiveMaximum 12710,PropAuthenticationMethod
// "\237\243F]\241",PropResponseTopic "\161\CAN\208\226w\182\253\159\&2n\135-\134",PropMessageExpiryInterval
// 13088,PropResponseTopic
// "\250\193\139\252\227$bm\SUB?\STX\ESC\254\237I\216w\213\DEL\241\244\195\US",PropWillDelayInterval
// 957,PropCorrelationData
// "\128\DC4M^\157\159\128'\129\251\253\217\226\255\198m\170z\NUL\222\165{\170^\r\229",PropSessionExpiryInterval
// 4548,PropMessageExpiryInterval 18197,PropTopicAlias 25384,PropSharedSubscriptionAvailable
// 239,PropAuthenticationMethod "+ad\r%\174\DEL\175|#\203\219\247\STX\ACK\ETB\224\139",PropSessionExpiryInterval
// 15062,PropSubscriptionIdentifierAvailable 89,PropTopicAlias 30222,PropAssignedClientIdentifier
// "3@\212\233\STX\244o\254\ETX\239\129",PropPayloadFormatIndicator 147,PropSubscriptionIdentifier
// 23,PropSubscriptionIdentifierAvailable 166,PropAssignedClientIdentifier
// "\179\205\229[\197IGa\220\146Fi\174C\180]ub\161\CANr\158\&7#\182\157Of"]
TEST(Disco5QCTest, Encode16) {
  uint8_t pkt[] = {0xe0, 0xc7, 0x1,  0x98, 0xc4, 0x1,  0x25, 0x5d, 0x22, 0x4c, 0x3,  0xb,  0x1,  0x21, 0x31, 0xa6, 0x15,
                   0x0,  0x5,  0xed, 0xf3, 0x46, 0x5d, 0xf1, 0x8,  0x0,  0xd,  0xa1, 0x18, 0xd0, 0xe2, 0x77, 0xb6, 0xfd,
                   0x9f, 0x32, 0x6e, 0x87, 0x2d, 0x86, 0x2,  0x0,  0x0,  0x33, 0x20, 0x8,  0x0,  0x17, 0xfa, 0xc1, 0x8b,
                   0xfc, 0xe3, 0x24, 0x62, 0x6d, 0x1a, 0x3f, 0x2,  0x1b, 0xfe, 0xed, 0x49, 0xd8, 0x77, 0xd5, 0x7f, 0xf1,
                   0xf4, 0xc3, 0x1f, 0x18, 0x0,  0x0,  0x3,  0xbd, 0x9,  0x0,  0x1a, 0x80, 0x14, 0x4d, 0x5e, 0x9d, 0x9f,
                   0x80, 0x27, 0x81, 0xfb, 0xfd, 0xd9, 0xe2, 0xff, 0xc6, 0x6d, 0xaa, 0x7a, 0x0,  0xde, 0xa5, 0x7b, 0xaa,
                   0x5e, 0xd,  0xe5, 0x11, 0x0,  0x0,  0x11, 0xc4, 0x2,  0x0,  0x0,  0x47, 0x15, 0x23, 0x63, 0x28, 0x2a,
                   0xef, 0x15, 0x0,  0x12, 0x2b, 0x61, 0x64, 0xd,  0x25, 0xae, 0x7f, 0xaf, 0x7c, 0x23, 0xcb, 0xdb, 0xf7,
                   0x2,  0x6,  0x17, 0xe0, 0x8b, 0x11, 0x0,  0x0,  0x3a, 0xd6, 0x29, 0x59, 0x23, 0x76, 0xe,  0x12, 0x0,
                   0xb,  0x33, 0x40, 0xd4, 0xe9, 0x2,  0xf4, 0x6f, 0xfe, 0x3,  0xef, 0x81, 0x1,  0x93, 0xb,  0x17, 0x29,
                   0xa6, 0x12, 0x0,  0x1c, 0xb3, 0xcd, 0xe5, 0x5b, 0xc5, 0x49, 0x47, 0x61, 0xdc, 0x92, 0x46, 0x69, 0xae,
                   0x43, 0xb4, 0x5d, 0x75, 0x62, 0xa1, 0x18, 0x72, 0x9e, 0x37, 0x23, 0xb6, 0x9d, 0x4f, 0x66};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xed, 0xf3, 0x46, 0x5d, 0xf1};
  uint8_t bytesprops1[] = {0xa1, 0x18, 0xd0, 0xe2, 0x77, 0xb6, 0xfd, 0x9f, 0x32, 0x6e, 0x87, 0x2d, 0x86};
  uint8_t bytesprops2[] = {0xfa, 0xc1, 0x8b, 0xfc, 0xe3, 0x24, 0x62, 0x6d, 0x1a, 0x3f, 0x2, 0x1b,
                           0xfe, 0xed, 0x49, 0xd8, 0x77, 0xd5, 0x7f, 0xf1, 0xf4, 0xc3, 0x1f};
  uint8_t bytesprops3[] = {0x80, 0x14, 0x4d, 0x5e, 0x9d, 0x9f, 0x80, 0x27, 0x81, 0xfb, 0xfd, 0xd9, 0xe2,
                           0xff, 0xc6, 0x6d, 0xaa, 0x7a, 0x0,  0xde, 0xa5, 0x7b, 0xaa, 0x5e, 0xd,  0xe5};
  uint8_t bytesprops4[] = {0x2b, 0x61, 0x64, 0xd,  0x25, 0xae, 0x7f, 0xaf, 0x7c,
                           0x23, 0xcb, 0xdb, 0xf7, 0x2,  0x6,  0x17, 0xe0, 0x8b};
  uint8_t bytesprops5[] = {0x33, 0x40, 0xd4, 0xe9, 0x2, 0xf4, 0x6f, 0xfe, 0x3, 0xef, 0x81};
  uint8_t bytesprops6[] = {0xb3, 0xcd, 0xe5, 0x5b, 0xc5, 0x49, 0x47, 0x61, 0xdc, 0x92, 0x46, 0x69, 0xae, 0x43,
                           0xb4, 0x5d, 0x75, 0x62, 0xa1, 0x18, 0x72, 0x9e, 0x37, 0x23, 0xb6, 0x9d, 0x4f, 0x66};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19459}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 1}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12710}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13088}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 957}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4548}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18197}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 25384}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15062}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30222}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 152, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoAdministrativeAction [PropWillDelayInterval 17096,PropUserProperty "\157\187\141L\EMf"
// ":\SO+0\131\DC3\STXxw\244\154\185\ETB^\202\218pn!\231\ENQd\250\130\&6\136\233/\155\SI",PropCorrelationData
// "\131\175\220\169\210R\SI\253W$\168\157\227V\241\146\249\174q \208\157\186\251",PropServerKeepAlive
// 13699,PropSubscriptionIdentifier 24,PropServerReference "\EMA\ETB",PropRequestProblemInformation
// 190,PropRequestResponseInformation 140,PropUserProperty "\221\246\207" "\176",PropSessionExpiryInterval
// 16599,PropSessionExpiryInterval 15959,PropAuthenticationMethod
// "\v\246\201\&3Q\213\154\a\221~sZje\177\\=W(\197\244%\243\&2\136F.",PropResponseInformation
// ".\202\ESC\228]\188\247\SUBA\NAK\165%*\ETB\227v\254\245\178\196",PropMessageExpiryInterval 6008,PropWillDelayInterval
// 31345,PropSubscriptionIdentifier 19,PropSubscriptionIdentifierAvailable 135,PropTopicAlias 26339,PropMaximumQoS
// 121,PropContentType "{\156N\224\FS\255u\DC1j\158\NUL\DC4\194\224",PropReceiveMaximum 7053,PropPayloadFormatIndicator
// 198,PropMessageExpiryInterval 17414,PropAuthenticationMethod "\250\235\143\192",PropContentType
// "\221;\146\&1\DC4\SOHP\189)\187\DC4 \t~\216gAf\DC1\147B| >~\210Y\167",PropWillDelayInterval 24883]
TEST(Disco5QCTest, Encode17) {
  uint8_t pkt[] = {
      0xe0, 0xfc, 0x1,  0x98, 0xf9, 0x1,  0x18, 0x0,  0x0,  0x42, 0xc8, 0x26, 0x0,  0x6,  0x9d, 0xbb, 0x8d, 0x4c, 0x19,
      0x66, 0x0,  0x1e, 0x3a, 0xe,  0x2b, 0x30, 0x83, 0x13, 0x2,  0x78, 0x77, 0xf4, 0x9a, 0xb9, 0x17, 0x5e, 0xca, 0xda,
      0x70, 0x6e, 0x21, 0xe7, 0x5,  0x64, 0xfa, 0x82, 0x36, 0x88, 0xe9, 0x2f, 0x9b, 0xf,  0x9,  0x0,  0x18, 0x83, 0xaf,
      0xdc, 0xa9, 0xd2, 0x52, 0xf,  0xfd, 0x57, 0x24, 0xa8, 0x9d, 0xe3, 0x56, 0xf1, 0x92, 0xf9, 0xae, 0x71, 0x20, 0xd0,
      0x9d, 0xba, 0xfb, 0x13, 0x35, 0x83, 0xb,  0x18, 0x1c, 0x0,  0x3,  0x19, 0x41, 0x17, 0x17, 0xbe, 0x19, 0x8c, 0x26,
      0x0,  0x3,  0xdd, 0xf6, 0xcf, 0x0,  0x1,  0xb0, 0x11, 0x0,  0x0,  0x40, 0xd7, 0x11, 0x0,  0x0,  0x3e, 0x57, 0x15,
      0x0,  0x1b, 0xb,  0xf6, 0xc9, 0x33, 0x51, 0xd5, 0x9a, 0x7,  0xdd, 0x7e, 0x73, 0x5a, 0x6a, 0x65, 0xb1, 0x5c, 0x3d,
      0x57, 0x28, 0xc5, 0xf4, 0x25, 0xf3, 0x32, 0x88, 0x46, 0x2e, 0x1a, 0x0,  0x14, 0x2e, 0xca, 0x1b, 0xe4, 0x5d, 0xbc,
      0xf7, 0x1a, 0x41, 0x15, 0xa5, 0x25, 0x2a, 0x17, 0xe3, 0x76, 0xfe, 0xf5, 0xb2, 0xc4, 0x2,  0x0,  0x0,  0x17, 0x78,
      0x18, 0x0,  0x0,  0x7a, 0x71, 0xb,  0x13, 0x29, 0x87, 0x23, 0x66, 0xe3, 0x24, 0x79, 0x3,  0x0,  0xe,  0x7b, 0x9c,
      0x4e, 0xe0, 0x1c, 0xff, 0x75, 0x11, 0x6a, 0x9e, 0x0,  0x14, 0xc2, 0xe0, 0x21, 0x1b, 0x8d, 0x1,  0xc6, 0x2,  0x0,
      0x0,  0x44, 0x6,  0x15, 0x0,  0x4,  0xfa, 0xeb, 0x8f, 0xc0, 0x3,  0x0,  0x1c, 0xdd, 0x3b, 0x92, 0x31, 0x14, 0x1,
      0x50, 0xbd, 0x29, 0xbb, 0x14, 0x20, 0x9,  0x7e, 0xd8, 0x67, 0x41, 0x66, 0x11, 0x93, 0x42, 0x7c, 0x20, 0x3e, 0x7e,
      0xd2, 0x59, 0xa7, 0x18, 0x0,  0x0,  0x61, 0x33};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x3a, 0xe,  0x2b, 0x30, 0x83, 0x13, 0x2,  0x78, 0x77, 0xf4, 0x9a, 0xb9, 0x17, 0x5e, 0xca,
                           0xda, 0x70, 0x6e, 0x21, 0xe7, 0x5,  0x64, 0xfa, 0x82, 0x36, 0x88, 0xe9, 0x2f, 0x9b, 0xf};
  uint8_t bytesprops0[] = {0x9d, 0xbb, 0x8d, 0x4c, 0x19, 0x66};
  uint8_t bytesprops2[] = {0x83, 0xaf, 0xdc, 0xa9, 0xd2, 0x52, 0xf,  0xfd, 0x57, 0x24, 0xa8, 0x9d,
                           0xe3, 0x56, 0xf1, 0x92, 0xf9, 0xae, 0x71, 0x20, 0xd0, 0x9d, 0xba, 0xfb};
  uint8_t bytesprops3[] = {0x19, 0x41, 0x17};
  uint8_t bytesprops5[] = {0xb0};
  uint8_t bytesprops4[] = {0xdd, 0xf6, 0xcf};
  uint8_t bytesprops6[] = {0xb,  0xf6, 0xc9, 0x33, 0x51, 0xd5, 0x9a, 0x7,  0xdd, 0x7e, 0x73, 0x5a, 0x6a, 0x65,
                           0xb1, 0x5c, 0x3d, 0x57, 0x28, 0xc5, 0xf4, 0x25, 0xf3, 0x32, 0x88, 0x46, 0x2e};
  uint8_t bytesprops7[] = {0x2e, 0xca, 0x1b, 0xe4, 0x5d, 0xbc, 0xf7, 0x1a, 0x41, 0x15,
                           0xa5, 0x25, 0x2a, 0x17, 0xe3, 0x76, 0xfe, 0xf5, 0xb2, 0xc4};
  uint8_t bytesprops8[] = {0x7b, 0x9c, 0x4e, 0xe0, 0x1c, 0xff, 0x75, 0x11, 0x6a, 0x9e, 0x0, 0x14, 0xc2, 0xe0};
  uint8_t bytesprops9[] = {0xfa, 0xeb, 0x8f, 0xc0};
  uint8_t bytesprops10[] = {0xdd, 0x3b, 0x92, 0x31, 0x14, 0x1,  0x50, 0xbd, 0x29, 0xbb, 0x14, 0x20, 0x9,  0x7e,
                            0xd8, 0x67, 0x41, 0x66, 0x11, 0x93, 0x42, 0x7c, 0x20, 0x3e, 0x7e, 0xd2, 0x59, 0xa7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17096}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops0}, .v = {30, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13699}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops4}, .v = {1, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16599}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15959}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6008}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31345}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 19}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26339}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7053}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17414}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 24883}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 152, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoPacketTooLarge [PropSharedSubscriptionAvailable 20]
TEST(Disco5QCTest, Encode18) {
  uint8_t pkt[] = {0xe0, 0x4, 0x95, 0x2, 0x2a, 0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 20}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 149, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoAdministrativeAction [PropReasonString
// "*%\v\STX\204\176\&7\DC1\197`^\235r\131q\134\n\185^\RS\154Bt?k\182",PropResponseInformation
// "@\186\132",PropSubscriptionIdentifier 15,PropReceiveMaximum 18394,PropRequestProblemInformation
// 41,PropServerReference ",\fk",PropRequestProblemInformation 18,PropTopicAlias 6053,PropAssignedClientIdentifier
// "\233\NAKu\136",PropMessageExpiryInterval 4488,PropRequestResponseInformation 96,PropSubscriptionIdentifier
// 11,PropSubscriptionIdentifierAvailable 115,PropAuthenticationData
// "\241\v-\215\166\183,\176\194\216\243\178\168=6e\221y\240Q\167\180\US\NAK\128\DEL\128\146\250\171",PropCorrelationData
// "#dC\CAN\STXC",PropMaximumPacketSize 6841,PropRequestResponseInformation 81,PropTopicAlias 4335,PropUserProperty
// "\161\197\v\212\228\253\173\249r\GSPP:" "8|\243\233V\247\162\203\DC3\161",PropUserProperty
// "\211\&7\200d#\218yQ\229\DEL$\n\209\233\ESC\220\v\191" "{5\241\195",PropRetainAvailable 139,PropServerKeepAlive
// 29153,PropResponseTopic "\241\v\198Z:\202\242\181UB\188\&46",PropTopicAlias 12740,PropAuthenticationData
// "\STX\191\ETB\223\190\SIC}\205\ESCzE"]
TEST(Disco5QCTest, Encode19) {
  uint8_t pkt[] = {
      0xe0, 0xdc, 0x1,  0x98, 0xd9, 0x1,  0x1f, 0x0,  0x1a, 0x2a, 0x25, 0xb,  0x2,  0xcc, 0xb0, 0x37, 0x11, 0xc5, 0x60,
      0x5e, 0xeb, 0x72, 0x83, 0x71, 0x86, 0xa,  0xb9, 0x5e, 0x1e, 0x9a, 0x42, 0x74, 0x3f, 0x6b, 0xb6, 0x1a, 0x0,  0x3,
      0x40, 0xba, 0x84, 0xb,  0xf,  0x21, 0x47, 0xda, 0x17, 0x29, 0x1c, 0x0,  0x3,  0x2c, 0xc,  0x6b, 0x17, 0x12, 0x23,
      0x17, 0xa5, 0x12, 0x0,  0x4,  0xe9, 0x15, 0x75, 0x88, 0x2,  0x0,  0x0,  0x11, 0x88, 0x19, 0x60, 0xb,  0xb,  0x29,
      0x73, 0x16, 0x0,  0x1e, 0xf1, 0xb,  0x2d, 0xd7, 0xa6, 0xb7, 0x2c, 0xb0, 0xc2, 0xd8, 0xf3, 0xb2, 0xa8, 0x3d, 0x36,
      0x65, 0xdd, 0x79, 0xf0, 0x51, 0xa7, 0xb4, 0x1f, 0x15, 0x80, 0x7f, 0x80, 0x92, 0xfa, 0xab, 0x9,  0x0,  0x6,  0x23,
      0x64, 0x43, 0x18, 0x2,  0x43, 0x27, 0x0,  0x0,  0x1a, 0xb9, 0x19, 0x51, 0x23, 0x10, 0xef, 0x26, 0x0,  0xd,  0xa1,
      0xc5, 0xb,  0xd4, 0xe4, 0xfd, 0xad, 0xf9, 0x72, 0x1d, 0x50, 0x50, 0x3a, 0x0,  0xa,  0x38, 0x7c, 0xf3, 0xe9, 0x56,
      0xf7, 0xa2, 0xcb, 0x13, 0xa1, 0x26, 0x0,  0x12, 0xd3, 0x37, 0xc8, 0x64, 0x23, 0xda, 0x79, 0x51, 0xe5, 0x7f, 0x24,
      0xa,  0xd1, 0xe9, 0x1b, 0xdc, 0xb,  0xbf, 0x0,  0x4,  0x7b, 0x35, 0xf1, 0xc3, 0x25, 0x8b, 0x13, 0x71, 0xe1, 0x8,
      0x0,  0xd,  0xf1, 0xb,  0xc6, 0x5a, 0x3a, 0xca, 0xf2, 0xb5, 0x55, 0x42, 0xbc, 0x34, 0x36, 0x23, 0x31, 0xc4, 0x16,
      0x0,  0xc,  0x2,  0xbf, 0x17, 0xdf, 0xbe, 0xf,  0x43, 0x7d, 0xcd, 0x1b, 0x7a, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2a, 0x25, 0xb,  0x2, 0xcc, 0xb0, 0x37, 0x11, 0xc5, 0x60, 0x5e, 0xeb, 0x72,
                           0x83, 0x71, 0x86, 0xa, 0xb9, 0x5e, 0x1e, 0x9a, 0x42, 0x74, 0x3f, 0x6b, 0xb6};
  uint8_t bytesprops1[] = {0x40, 0xba, 0x84};
  uint8_t bytesprops2[] = {0x2c, 0xc, 0x6b};
  uint8_t bytesprops3[] = {0xe9, 0x15, 0x75, 0x88};
  uint8_t bytesprops4[] = {0xf1, 0xb,  0x2d, 0xd7, 0xa6, 0xb7, 0x2c, 0xb0, 0xc2, 0xd8, 0xf3, 0xb2, 0xa8, 0x3d, 0x36,
                           0x65, 0xdd, 0x79, 0xf0, 0x51, 0xa7, 0xb4, 0x1f, 0x15, 0x80, 0x7f, 0x80, 0x92, 0xfa, 0xab};
  uint8_t bytesprops5[] = {0x23, 0x64, 0x43, 0x18, 0x2, 0x43};
  uint8_t bytesprops7[] = {0x38, 0x7c, 0xf3, 0xe9, 0x56, 0xf7, 0xa2, 0xcb, 0x13, 0xa1};
  uint8_t bytesprops6[] = {0xa1, 0xc5, 0xb, 0xd4, 0xe4, 0xfd, 0xad, 0xf9, 0x72, 0x1d, 0x50, 0x50, 0x3a};
  uint8_t bytesprops9[] = {0x7b, 0x35, 0xf1, 0xc3};
  uint8_t bytesprops8[] = {0xd3, 0x37, 0xc8, 0x64, 0x23, 0xda, 0x79, 0x51, 0xe5,
                           0x7f, 0x24, 0xa,  0xd1, 0xe9, 0x1b, 0xdc, 0xb,  0xbf};
  uint8_t bytesprops10[] = {0xf1, 0xb, 0xc6, 0x5a, 0x3a, 0xca, 0xf2, 0xb5, 0x55, 0x42, 0xbc, 0x34, 0x36};
  uint8_t bytesprops11[] = {0x2, 0xbf, 0x17, 0xdf, 0xbe, 0xf, 0x43, 0x7d, 0xcd, 0x1b, 0x7a, 0x45};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18394}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6053}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4488}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6841}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4335}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops6}, .v = {10, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops8}, .v = {4, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29153}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12740}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 152, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection [PropRetainAvailable 93,PropSubscriptionIdentifier
// 21,PropTopicAliasMaximum 19035,PropWildcardSubscriptionAvailable 184,PropServerReference
// "\133ig\197{\208\129\247\&9\244\&21jr\US:}V\229\188W\143\&7\129",PropRequestProblemInformation 68,PropContentType
// "\251\175\248\187jOr\173\187]\191\201\DLE-;\200v\212\196\224",PropCorrelationData
// "i\167\197\143\129\191\150\RS\r\DC3\223\141\&5\211W\135\132\&1%Y\221\220\215=B^\202rx",PropRequestResponseInformation
// 42,PropTopicAlias 797,PropReceiveMaximum 12309,PropRequestProblemInformation 35,PropServerKeepAlive
// 12065,PropResponseInformation "\153v\212w\132_\221\239\157\208\135",PropSessionExpiryInterval
// 8886,PropAuthenticationData
// "\129<\DELu\EM\207l\200h69B\181\229Z\143\191\191\130\140\238\241\EM",PropMaximumPacketSize 8070,PropWillDelayInterval
// 9412,PropReceiveMaximum 20391,PropResponseInformation
// "\ETB\139\193\223\v\v\177\204\214\252<g\138cyG\160\&0\239\166\GS\232\152\ETB'\171\254\190",PropResponseInformation
// "Qq\SI\ETX\246\152\202\139B\185\SOH>\r\163\157.\\\133",PropWillDelayInterval 19132]
TEST(Disco5QCTest, Encode20) {
  uint8_t pkt[] = {
      0xe0, 0xe0, 0x1,  0x0,  0xdd, 0x1,  0x25, 0x5d, 0xb,  0x15, 0x22, 0x4a, 0x5b, 0x28, 0xb8, 0x1c, 0x0,  0x18, 0x85,
      0x69, 0x67, 0xc5, 0x7b, 0xd0, 0x81, 0xf7, 0x39, 0xf4, 0x32, 0x31, 0x6a, 0x72, 0x1f, 0x3a, 0x7d, 0x56, 0xe5, 0xbc,
      0x57, 0x8f, 0x37, 0x81, 0x17, 0x44, 0x3,  0x0,  0x14, 0xfb, 0xaf, 0xf8, 0xbb, 0x6a, 0x4f, 0x72, 0xad, 0xbb, 0x5d,
      0xbf, 0xc9, 0x10, 0x2d, 0x3b, 0xc8, 0x76, 0xd4, 0xc4, 0xe0, 0x9,  0x0,  0x1d, 0x69, 0xa7, 0xc5, 0x8f, 0x81, 0xbf,
      0x96, 0x1e, 0xd,  0x13, 0xdf, 0x8d, 0x35, 0xd3, 0x57, 0x87, 0x84, 0x31, 0x25, 0x59, 0xdd, 0xdc, 0xd7, 0x3d, 0x42,
      0x5e, 0xca, 0x72, 0x78, 0x19, 0x2a, 0x23, 0x3,  0x1d, 0x21, 0x30, 0x15, 0x17, 0x23, 0x13, 0x2f, 0x21, 0x1a, 0x0,
      0xb,  0x99, 0x76, 0xd4, 0x77, 0x84, 0x5f, 0xdd, 0xef, 0x9d, 0xd0, 0x87, 0x11, 0x0,  0x0,  0x22, 0xb6, 0x16, 0x0,
      0x17, 0x81, 0x3c, 0x7f, 0x75, 0x19, 0xcf, 0x6c, 0xc8, 0x68, 0x36, 0x39, 0x42, 0xb5, 0xe5, 0x5a, 0x8f, 0xbf, 0xbf,
      0x82, 0x8c, 0xee, 0xf1, 0x19, 0x27, 0x0,  0x0,  0x1f, 0x86, 0x18, 0x0,  0x0,  0x24, 0xc4, 0x21, 0x4f, 0xa7, 0x1a,
      0x0,  0x1c, 0x17, 0x8b, 0xc1, 0xdf, 0xb,  0xb,  0xb1, 0xcc, 0xd6, 0xfc, 0x3c, 0x67, 0x8a, 0x63, 0x79, 0x47, 0xa0,
      0x30, 0xef, 0xa6, 0x1d, 0xe8, 0x98, 0x17, 0x27, 0xab, 0xfe, 0xbe, 0x1a, 0x0,  0x12, 0x51, 0x71, 0xf,  0x3,  0xf6,
      0x98, 0xca, 0x8b, 0x42, 0xb9, 0x1,  0x3e, 0xd,  0xa3, 0x9d, 0x2e, 0x5c, 0x85, 0x18, 0x0,  0x0,  0x4a, 0xbc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x85, 0x69, 0x67, 0xc5, 0x7b, 0xd0, 0x81, 0xf7, 0x39, 0xf4, 0x32, 0x31,
                           0x6a, 0x72, 0x1f, 0x3a, 0x7d, 0x56, 0xe5, 0xbc, 0x57, 0x8f, 0x37, 0x81};
  uint8_t bytesprops1[] = {0xfb, 0xaf, 0xf8, 0xbb, 0x6a, 0x4f, 0x72, 0xad, 0xbb, 0x5d,
                           0xbf, 0xc9, 0x10, 0x2d, 0x3b, 0xc8, 0x76, 0xd4, 0xc4, 0xe0};
  uint8_t bytesprops2[] = {0x69, 0xa7, 0xc5, 0x8f, 0x81, 0xbf, 0x96, 0x1e, 0xd,  0x13, 0xdf, 0x8d, 0x35, 0xd3, 0x57,
                           0x87, 0x84, 0x31, 0x25, 0x59, 0xdd, 0xdc, 0xd7, 0x3d, 0x42, 0x5e, 0xca, 0x72, 0x78};
  uint8_t bytesprops3[] = {0x99, 0x76, 0xd4, 0x77, 0x84, 0x5f, 0xdd, 0xef, 0x9d, 0xd0, 0x87};
  uint8_t bytesprops4[] = {0x81, 0x3c, 0x7f, 0x75, 0x19, 0xcf, 0x6c, 0xc8, 0x68, 0x36, 0x39, 0x42,
                           0xb5, 0xe5, 0x5a, 0x8f, 0xbf, 0xbf, 0x82, 0x8c, 0xee, 0xf1, 0x19};
  uint8_t bytesprops5[] = {0x17, 0x8b, 0xc1, 0xdf, 0xb,  0xb,  0xb1, 0xcc, 0xd6, 0xfc, 0x3c, 0x67, 0x8a, 0x63,
                           0x79, 0x47, 0xa0, 0x30, 0xef, 0xa6, 0x1d, 0xe8, 0x98, 0x17, 0x27, 0xab, 0xfe, 0xbe};
  uint8_t bytesprops6[] = {0x51, 0x71, 0xf,  0x3, 0xf6, 0x98, 0xca, 0x8b, 0x42,
                           0xb9, 0x1,  0x3e, 0xd, 0xa3, 0x9d, 0x2e, 0x5c, 0x85};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 21}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19035}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 42}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 797}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12309}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12065}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8886}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8070}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9412}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20391}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19132}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoUnspecifiedError [PropRequestProblemInformation 0,PropAssignedClientIdentifier
// "\DC4\250y/=U=e\252A\192\223\149\138\242",PropTopicAliasMaximum 15098,PropSubscriptionIdentifier
// 16,PropServerKeepAlive 28733,PropServerReference "\224\DC3\177\f\212\158\168\191\195",PropMaximumPacketSize
// 24280,PropRequestResponseInformation 23,PropContentType "\189@\216\247\SO\137\194\DC3\250\139JD\204
// \225P\\\234\&9a\203",PropSessionExpiryInterval 20827,PropResponseTopic "Pl;\169S\149",PropContentType
// "\180\251\132\248D\129\139\249z\134\174\154\229\214\215LW",PropUserProperty
// "4A?\231y\240Z\227#*\128\201\190\b\181\250\150\226\191\239\242m\157g\ESC" "z\251\DEL\182",PropServerKeepAlive
// 15182,PropContentType "",PropResponseTopic
// "\DC4g\173\223\151X\219\175*oAp3\139\233z\231\178P\128\215+\250\249\153\137\163\b",PropSharedSubscriptionAvailable
// 20,PropAuthenticationMethod "\163}%\178\155y\201\DC4\146."]
TEST(Disco5QCTest, Encode21) {
  uint8_t pkt[] = {0xe0, 0xc2, 0x1,  0x80, 0xbf, 0x1,  0x17, 0x0,  0x12, 0x0,  0xf,  0x14, 0xfa, 0x79, 0x2f, 0x3d, 0x55,
                   0x3d, 0x65, 0xfc, 0x41, 0xc0, 0xdf, 0x95, 0x8a, 0xf2, 0x22, 0x3a, 0xfa, 0xb,  0x10, 0x13, 0x70, 0x3d,
                   0x1c, 0x0,  0x9,  0xe0, 0x13, 0xb1, 0xc,  0xd4, 0x9e, 0xa8, 0xbf, 0xc3, 0x27, 0x0,  0x0,  0x5e, 0xd8,
                   0x19, 0x17, 0x3,  0x0,  0x15, 0xbd, 0x40, 0xd8, 0xf7, 0xe,  0x89, 0xc2, 0x13, 0xfa, 0x8b, 0x4a, 0x44,
                   0xcc, 0x20, 0xe1, 0x50, 0x5c, 0xea, 0x39, 0x61, 0xcb, 0x11, 0x0,  0x0,  0x51, 0x5b, 0x8,  0x0,  0x6,
                   0x50, 0x6c, 0x3b, 0xa9, 0x53, 0x95, 0x3,  0x0,  0x11, 0xb4, 0xfb, 0x84, 0xf8, 0x44, 0x81, 0x8b, 0xf9,
                   0x7a, 0x86, 0xae, 0x9a, 0xe5, 0xd6, 0xd7, 0x4c, 0x57, 0x26, 0x0,  0x19, 0x34, 0x41, 0x3f, 0xe7, 0x79,
                   0xf0, 0x5a, 0xe3, 0x23, 0x2a, 0x80, 0xc9, 0xbe, 0x8,  0xb5, 0xfa, 0x96, 0xe2, 0xbf, 0xef, 0xf2, 0x6d,
                   0x9d, 0x67, 0x1b, 0x0,  0x4,  0x7a, 0xfb, 0x7f, 0xb6, 0x13, 0x3b, 0x4e, 0x3,  0x0,  0x0,  0x8,  0x0,
                   0x1c, 0x14, 0x67, 0xad, 0xdf, 0x97, 0x58, 0xdb, 0xaf, 0x2a, 0x6f, 0x41, 0x70, 0x33, 0x8b, 0xe9, 0x7a,
                   0xe7, 0xb2, 0x50, 0x80, 0xd7, 0x2b, 0xfa, 0xf9, 0x99, 0x89, 0xa3, 0x8,  0x2a, 0x14, 0x15, 0x0,  0xa,
                   0xa3, 0x7d, 0x25, 0xb2, 0x9b, 0x79, 0xc9, 0x14, 0x92, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x14, 0xfa, 0x79, 0x2f, 0x3d, 0x55, 0x3d, 0x65, 0xfc, 0x41, 0xc0, 0xdf, 0x95, 0x8a, 0xf2};
  uint8_t bytesprops1[] = {0xe0, 0x13, 0xb1, 0xc, 0xd4, 0x9e, 0xa8, 0xbf, 0xc3};
  uint8_t bytesprops2[] = {0xbd, 0x40, 0xd8, 0xf7, 0xe,  0x89, 0xc2, 0x13, 0xfa, 0x8b, 0x4a,
                           0x44, 0xcc, 0x20, 0xe1, 0x50, 0x5c, 0xea, 0x39, 0x61, 0xcb};
  uint8_t bytesprops3[] = {0x50, 0x6c, 0x3b, 0xa9, 0x53, 0x95};
  uint8_t bytesprops4[] = {0xb4, 0xfb, 0x84, 0xf8, 0x44, 0x81, 0x8b, 0xf9, 0x7a,
                           0x86, 0xae, 0x9a, 0xe5, 0xd6, 0xd7, 0x4c, 0x57};
  uint8_t bytesprops6[] = {0x7a, 0xfb, 0x7f, 0xb6};
  uint8_t bytesprops5[] = {0x34, 0x41, 0x3f, 0xe7, 0x79, 0xf0, 0x5a, 0xe3, 0x23, 0x2a, 0x80, 0xc9, 0xbe,
                           0x8,  0xb5, 0xfa, 0x96, 0xe2, 0xbf, 0xef, 0xf2, 0x6d, 0x9d, 0x67, 0x1b};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0x14, 0x67, 0xad, 0xdf, 0x97, 0x58, 0xdb, 0xaf, 0x2a, 0x6f, 0x41, 0x70, 0x33, 0x8b,
                           0xe9, 0x7a, 0xe7, 0xb2, 0x50, 0x80, 0xd7, 0x2b, 0xfa, 0xf9, 0x99, 0x89, 0xa3, 0x8};
  uint8_t bytesprops9[] = {0xa3, 0x7d, 0x25, 0xb2, 0x9b, 0x79, 0xc9, 0x14, 0x92, 0x2e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15098}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28733}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24280}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20827}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops5}, .v = {4, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15182}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 128, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoDisconnectWithWill [PropSessionExpiryInterval 31061,PropSubscriptionIdentifier
// 5,PropMessageExpiryInterval 25869,PropPayloadFormatIndicator 125,PropTopicAlias 20089,PropContentType
// "\tnB",PropWildcardSubscriptionAvailable 185,PropRetainAvailable 120,PropServerReference
// "\GSU\n8?1^\150\231\169C\130\223\222\226\&1\171\149\158",PropAuthenticationMethod
// "\252\USj\163}\SO\185r$\156EE\229\178",PropRequestProblemInformation 135,PropSessionExpiryInterval
// 15470,PropRetainAvailable 5,PropAuthenticationData
// "&\r\242\176\&0\141SB\ESC\132\DEL\213.\a\EOTS\236\193P\DC4",PropReasonString
// "Z\ETB\144\216:\228\159\232\203\150\204R\157\231\253\NUL\133\134\150\237{\167\198\156\195\v\167\&2\SO",PropAuthenticationData
// "\SYNo\207_MF\139o\164W\185\DLE",PropMessageExpiryInterval 7386,PropMessageExpiryInterval
// 16514,PropMessageExpiryInterval 13233,PropSharedSubscriptionAvailable 4,PropSharedSubscriptionAvailable
// 218,PropCorrelationData "\199\&4",PropTopicAlias 1317,PropAuthenticationData
// "\222\ESC\244\229R\FS\255\183\193\GS\161\191\EOT|w\164\230Q",PropMessageExpiryInterval
// 30353,PropMessageExpiryInterval 13107,PropAssignedClientIdentifier "\170F\238",PropServerReference
// "\192\245\207\232\189Z\199\142\DC3\132\212J\217\223/j\b"]
TEST(Disco5QCTest, Encode22) {
  uint8_t pkt[] = {0xe0, 0xe8, 0x1,  0x4,  0xe5, 0x1,  0x11, 0x0,  0x0,  0x79, 0x55, 0xb,  0x5,  0x2,  0x0,  0x0,  0x65,
                   0xd,  0x1,  0x7d, 0x23, 0x4e, 0x79, 0x3,  0x0,  0x3,  0x9,  0x6e, 0x42, 0x28, 0xb9, 0x25, 0x78, 0x1c,
                   0x0,  0x13, 0x1d, 0x55, 0xa,  0x38, 0x3f, 0x31, 0x5e, 0x96, 0xe7, 0xa9, 0x43, 0x82, 0xdf, 0xde, 0xe2,
                   0x31, 0xab, 0x95, 0x9e, 0x15, 0x0,  0xe,  0xfc, 0x1f, 0x6a, 0xa3, 0x7d, 0xe,  0xb9, 0x72, 0x24, 0x9c,
                   0x45, 0x45, 0xe5, 0xb2, 0x17, 0x87, 0x11, 0x0,  0x0,  0x3c, 0x6e, 0x25, 0x5,  0x16, 0x0,  0x14, 0x26,
                   0xd,  0xf2, 0xb0, 0x30, 0x8d, 0x53, 0x42, 0x1b, 0x84, 0x7f, 0xd5, 0x2e, 0x7,  0x4,  0x53, 0xec, 0xc1,
                   0x50, 0x14, 0x1f, 0x0,  0x1d, 0x5a, 0x17, 0x90, 0xd8, 0x3a, 0xe4, 0x9f, 0xe8, 0xcb, 0x96, 0xcc, 0x52,
                   0x9d, 0xe7, 0xfd, 0x0,  0x85, 0x86, 0x96, 0xed, 0x7b, 0xa7, 0xc6, 0x9c, 0xc3, 0xb,  0xa7, 0x32, 0xe,
                   0x16, 0x0,  0xc,  0x16, 0x6f, 0xcf, 0x5f, 0x4d, 0x46, 0x8b, 0x6f, 0xa4, 0x57, 0xb9, 0x10, 0x2,  0x0,
                   0x0,  0x1c, 0xda, 0x2,  0x0,  0x0,  0x40, 0x82, 0x2,  0x0,  0x0,  0x33, 0xb1, 0x2a, 0x4,  0x2a, 0xda,
                   0x9,  0x0,  0x2,  0xc7, 0x34, 0x23, 0x5,  0x25, 0x16, 0x0,  0x12, 0xde, 0x1b, 0xf4, 0xe5, 0x52, 0x1c,
                   0xff, 0xb7, 0xc1, 0x1d, 0xa1, 0xbf, 0x4,  0x7c, 0x77, 0xa4, 0xe6, 0x51, 0x2,  0x0,  0x0,  0x76, 0x91,
                   0x2,  0x0,  0x0,  0x33, 0x33, 0x12, 0x0,  0x3,  0xaa, 0x46, 0xee, 0x1c, 0x0,  0x11, 0xc0, 0xf5, 0xcf,
                   0xe8, 0xbd, 0x5a, 0xc7, 0x8e, 0x13, 0x84, 0xd4, 0x4a, 0xd9, 0xdf, 0x2f, 0x6a, 0x8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9, 0x6e, 0x42};
  uint8_t bytesprops1[] = {0x1d, 0x55, 0xa,  0x38, 0x3f, 0x31, 0x5e, 0x96, 0xe7, 0xa9,
                           0x43, 0x82, 0xdf, 0xde, 0xe2, 0x31, 0xab, 0x95, 0x9e};
  uint8_t bytesprops2[] = {0xfc, 0x1f, 0x6a, 0xa3, 0x7d, 0xe, 0xb9, 0x72, 0x24, 0x9c, 0x45, 0x45, 0xe5, 0xb2};
  uint8_t bytesprops3[] = {0x26, 0xd,  0xf2, 0xb0, 0x30, 0x8d, 0x53, 0x42, 0x1b, 0x84,
                           0x7f, 0xd5, 0x2e, 0x7,  0x4,  0x53, 0xec, 0xc1, 0x50, 0x14};
  uint8_t bytesprops4[] = {0x5a, 0x17, 0x90, 0xd8, 0x3a, 0xe4, 0x9f, 0xe8, 0xcb, 0x96, 0xcc, 0x52, 0x9d, 0xe7, 0xfd,
                           0x0,  0x85, 0x86, 0x96, 0xed, 0x7b, 0xa7, 0xc6, 0x9c, 0xc3, 0xb,  0xa7, 0x32, 0xe};
  uint8_t bytesprops5[] = {0x16, 0x6f, 0xcf, 0x5f, 0x4d, 0x46, 0x8b, 0x6f, 0xa4, 0x57, 0xb9, 0x10};
  uint8_t bytesprops6[] = {0xc7, 0x34};
  uint8_t bytesprops7[] = {0xde, 0x1b, 0xf4, 0xe5, 0x52, 0x1c, 0xff, 0xb7, 0xc1,
                           0x1d, 0xa1, 0xbf, 0x4,  0x7c, 0x77, 0xa4, 0xe6, 0x51};
  uint8_t bytesprops8[] = {0xaa, 0x46, 0xee};
  uint8_t bytesprops9[] = {0xc0, 0xf5, 0xcf, 0xe8, 0xbd, 0x5a, 0xc7, 0x8e, 0x13,
                           0x84, 0xd4, 0x4a, 0xd9, 0xdf, 0x2f, 0x6a, 0x8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31061}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25869}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20089}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15470}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7386}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16514}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13233}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1317}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30353}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13107}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicAliasInvalid [PropTopicAliasMaximum 31305,PropMaximumPacketSize
// 19902,PropMessageExpiryInterval 13846,PropSubscriptionIdentifierAvailable 13,PropRequestProblemInformation
// 11,PropSubscriptionIdentifierAvailable 64,PropTopicAlias 5928,PropResponseTopic
// "{D\229\137\247\213\252S\150\169p\161\215\254\GS\DC4\USp&=\ETX\181<=+\ETB\217\152\&2!",PropReasonString
// "\SI4\128\208\198\169\168Ur\198@\148\238\161\177G\NAK\142\149\228\144;\254\135\183l\211",PropMessageExpiryInterval
// 21979,PropTopicAlias 7370,PropSessionExpiryInterval 11718,PropUserProperty
// "\193\181sq\EOT\244\139\246\139\251r\STX\\\221A\DC2\190S/" "\141\193\210\155"]
TEST(Disco5QCTest, Encode23) {
  uint8_t pkt[] = {0xe0, 0x80, 0x1,  0x94, 0x7e, 0x22, 0x7a, 0x49, 0x27, 0x0,  0x0,  0x4d, 0xbe, 0x2,  0x0,  0x0,  0x36,
                   0x16, 0x29, 0xd,  0x17, 0xb,  0x29, 0x40, 0x23, 0x17, 0x28, 0x8,  0x0,  0x1e, 0x7b, 0x44, 0xe5, 0x89,
                   0xf7, 0xd5, 0xfc, 0x53, 0x96, 0xa9, 0x70, 0xa1, 0xd7, 0xfe, 0x1d, 0x14, 0x1f, 0x70, 0x26, 0x3d, 0x3,
                   0xb5, 0x3c, 0x3d, 0x2b, 0x17, 0xd9, 0x98, 0x32, 0x21, 0x1f, 0x0,  0x1b, 0xf,  0x34, 0x80, 0xd0, 0xc6,
                   0xa9, 0xa8, 0x55, 0x72, 0xc6, 0x40, 0x94, 0xee, 0xa1, 0xb1, 0x47, 0x15, 0x8e, 0x95, 0xe4, 0x90, 0x3b,
                   0xfe, 0x87, 0xb7, 0x6c, 0xd3, 0x2,  0x0,  0x0,  0x55, 0xdb, 0x23, 0x1c, 0xca, 0x11, 0x0,  0x0,  0x2d,
                   0xc6, 0x26, 0x0,  0x13, 0xc1, 0xb5, 0x73, 0x71, 0x4,  0xf4, 0x8b, 0xf6, 0x8b, 0xfb, 0x72, 0x2,  0x5c,
                   0xdd, 0x41, 0x12, 0xbe, 0x53, 0x2f, 0x0,  0x4,  0x8d, 0xc1, 0xd2, 0x9b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7b, 0x44, 0xe5, 0x89, 0xf7, 0xd5, 0xfc, 0x53, 0x96, 0xa9, 0x70, 0xa1, 0xd7, 0xfe, 0x1d,
                           0x14, 0x1f, 0x70, 0x26, 0x3d, 0x3,  0xb5, 0x3c, 0x3d, 0x2b, 0x17, 0xd9, 0x98, 0x32, 0x21};
  uint8_t bytesprops1[] = {0xf,  0x34, 0x80, 0xd0, 0xc6, 0xa9, 0xa8, 0x55, 0x72, 0xc6, 0x40, 0x94, 0xee, 0xa1,
                           0xb1, 0x47, 0x15, 0x8e, 0x95, 0xe4, 0x90, 0x3b, 0xfe, 0x87, 0xb7, 0x6c, 0xd3};
  uint8_t bytesprops3[] = {0x8d, 0xc1, 0xd2, 0x9b};
  uint8_t bytesprops2[] = {0xc1, 0xb5, 0x73, 0x71, 0x4,  0xf4, 0x8b, 0xf6, 0x8b, 0xfb,
                           0x72, 0x2,  0x5c, 0xdd, 0x41, 0x12, 0xbe, 0x53, 0x2f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31305}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19902}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13846}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5928}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21979}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7370}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11718}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {19, (char*)&bytesprops2}, .v = {4, (char*)&bytesprops3}}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 148, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoConnectionRateExceeded [PropContentType
// "g\SYN5\222\184\174\217\155\181\204\230\138\177\SUBC\147",PropUserProperty "\178@\SI\222{\DC1\203\154\172\209\154&"
// "\NUL\217z\201\200\139\219O\177%G\208\131d\178f",PropTopicAliasMaximum 28053,PropRequestResponseInformation
// 144,PropAssignedClientIdentifier "D",PropServerReference
// "\155\207\241W\227}\208\174DJ\239",PropWildcardSubscriptionAvailable 36,PropResponseTopic
// "\ETX\207\RS`\180\182\171",PropMaximumPacketSize 10715,PropServerReference
// "\220\243Y\157\161\&2\229\ENQ\156\130\FSr(t",PropSubscriptionIdentifier 22,PropAuthenticationMethod
// "\f\155d&\SOT\t\183q\168\229\234i\172\161@\156",PropServerReference
// "b!\229\SUB\b\216\203w\254$\192\145\191\232w=i$\135\142\241\197O=\229Q4\131",PropReceiveMaximum
// 22291,PropSubscriptionIdentifierAvailable 250,PropContentType
// "\183J\171\207'X_d\135'o\250\&9\222\134\SOH\"\137$H\128\157i\139\211",PropRetainAvailable 151,PropMaximumPacketSize
// 26309,PropSubscriptionIdentifierAvailable 242,PropSubscriptionIdentifierAvailable
// 230,PropWildcardSubscriptionAvailable 194,PropResponseTopic "\131\195R\237",PropTopicAliasMaximum
// 15601,PropSubscriptionIdentifier 15,PropSubscriptionIdentifierAvailable 226,PropReasonString
// "\239\129\240\198a\US\NAK`\242\199a\166\251<\147%\r\SYN\174z",PropAuthenticationMethod
// "vu\DC3\140\FSk\205\226\183v\ETX+\RSY\135\141\CAN\212\148\243\220",PropSessionExpiryInterval 21456,PropUserProperty
// "\180\206" "\NAKs\132"]
TEST(Disco5QCTest, Encode24) {
  uint8_t pkt[] = {
      0xe0, 0x9f, 0x2,  0x9f, 0x9c, 0x2,  0x3,  0x0,  0x10, 0x67, 0x16, 0x35, 0xde, 0xb8, 0xae, 0xd9, 0x9b, 0xb5, 0xcc,
      0xe6, 0x8a, 0xb1, 0x1a, 0x43, 0x93, 0x26, 0x0,  0xc,  0xb2, 0x40, 0xf,  0xde, 0x7b, 0x11, 0xcb, 0x9a, 0xac, 0xd1,
      0x9a, 0x26, 0x0,  0x10, 0x0,  0xd9, 0x7a, 0xc9, 0xc8, 0x8b, 0xdb, 0x4f, 0xb1, 0x25, 0x47, 0xd0, 0x83, 0x64, 0xb2,
      0x66, 0x22, 0x6d, 0x95, 0x19, 0x90, 0x12, 0x0,  0x1,  0x44, 0x1c, 0x0,  0xb,  0x9b, 0xcf, 0xf1, 0x57, 0xe3, 0x7d,
      0xd0, 0xae, 0x44, 0x4a, 0xef, 0x28, 0x24, 0x8,  0x0,  0x7,  0x3,  0xcf, 0x1e, 0x60, 0xb4, 0xb6, 0xab, 0x27, 0x0,
      0x0,  0x29, 0xdb, 0x1c, 0x0,  0xe,  0xdc, 0xf3, 0x59, 0x9d, 0xa1, 0x32, 0xe5, 0x5,  0x9c, 0x82, 0x1c, 0x72, 0x28,
      0x74, 0xb,  0x16, 0x15, 0x0,  0x11, 0xc,  0x9b, 0x64, 0x26, 0xe,  0x54, 0x9,  0xb7, 0x71, 0xa8, 0xe5, 0xea, 0x69,
      0xac, 0xa1, 0x40, 0x9c, 0x1c, 0x0,  0x1c, 0x62, 0x21, 0xe5, 0x1a, 0x8,  0xd8, 0xcb, 0x77, 0xfe, 0x24, 0xc0, 0x91,
      0xbf, 0xe8, 0x77, 0x3d, 0x69, 0x24, 0x87, 0x8e, 0xf1, 0xc5, 0x4f, 0x3d, 0xe5, 0x51, 0x34, 0x83, 0x21, 0x57, 0x13,
      0x29, 0xfa, 0x3,  0x0,  0x19, 0xb7, 0x4a, 0xab, 0xcf, 0x27, 0x58, 0x5f, 0x64, 0x87, 0x27, 0x6f, 0xfa, 0x39, 0xde,
      0x86, 0x1,  0x22, 0x89, 0x24, 0x48, 0x80, 0x9d, 0x69, 0x8b, 0xd3, 0x25, 0x97, 0x27, 0x0,  0x0,  0x66, 0xc5, 0x29,
      0xf2, 0x29, 0xe6, 0x28, 0xc2, 0x8,  0x0,  0x4,  0x83, 0xc3, 0x52, 0xed, 0x22, 0x3c, 0xf1, 0xb,  0xf,  0x29, 0xe2,
      0x1f, 0x0,  0x14, 0xef, 0x81, 0xf0, 0xc6, 0x61, 0x1f, 0x15, 0x60, 0xf2, 0xc7, 0x61, 0xa6, 0xfb, 0x3c, 0x93, 0x25,
      0xd,  0x16, 0xae, 0x7a, 0x15, 0x0,  0x15, 0x76, 0x75, 0x13, 0x8c, 0x1c, 0x6b, 0xcd, 0xe2, 0xb7, 0x76, 0x3,  0x2b,
      0x1e, 0x59, 0x87, 0x8d, 0x18, 0xd4, 0x94, 0xf3, 0xdc, 0x11, 0x0,  0x0,  0x53, 0xd0, 0x26, 0x0,  0x2,  0xb4, 0xce,
      0x0,  0x3,  0x15, 0x73, 0x84};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x67, 0x16, 0x35, 0xde, 0xb8, 0xae, 0xd9, 0x9b,
                           0xb5, 0xcc, 0xe6, 0x8a, 0xb1, 0x1a, 0x43, 0x93};
  uint8_t bytesprops2[] = {0x0,  0xd9, 0x7a, 0xc9, 0xc8, 0x8b, 0xdb, 0x4f,
                           0xb1, 0x25, 0x47, 0xd0, 0x83, 0x64, 0xb2, 0x66};
  uint8_t bytesprops1[] = {0xb2, 0x40, 0xf, 0xde, 0x7b, 0x11, 0xcb, 0x9a, 0xac, 0xd1, 0x9a, 0x26};
  uint8_t bytesprops3[] = {0x44};
  uint8_t bytesprops4[] = {0x9b, 0xcf, 0xf1, 0x57, 0xe3, 0x7d, 0xd0, 0xae, 0x44, 0x4a, 0xef};
  uint8_t bytesprops5[] = {0x3, 0xcf, 0x1e, 0x60, 0xb4, 0xb6, 0xab};
  uint8_t bytesprops6[] = {0xdc, 0xf3, 0x59, 0x9d, 0xa1, 0x32, 0xe5, 0x5, 0x9c, 0x82, 0x1c, 0x72, 0x28, 0x74};
  uint8_t bytesprops7[] = {0xc,  0x9b, 0x64, 0x26, 0xe,  0x54, 0x9,  0xb7, 0x71,
                           0xa8, 0xe5, 0xea, 0x69, 0xac, 0xa1, 0x40, 0x9c};
  uint8_t bytesprops8[] = {0x62, 0x21, 0xe5, 0x1a, 0x8,  0xd8, 0xcb, 0x77, 0xfe, 0x24, 0xc0, 0x91, 0xbf, 0xe8,
                           0x77, 0x3d, 0x69, 0x24, 0x87, 0x8e, 0xf1, 0xc5, 0x4f, 0x3d, 0xe5, 0x51, 0x34, 0x83};
  uint8_t bytesprops9[] = {0xb7, 0x4a, 0xab, 0xcf, 0x27, 0x58, 0x5f, 0x64, 0x87, 0x27, 0x6f, 0xfa, 0x39,
                           0xde, 0x86, 0x1,  0x22, 0x89, 0x24, 0x48, 0x80, 0x9d, 0x69, 0x8b, 0xd3};
  uint8_t bytesprops10[] = {0x83, 0xc3, 0x52, 0xed};
  uint8_t bytesprops11[] = {0xef, 0x81, 0xf0, 0xc6, 0x61, 0x1f, 0x15, 0x60, 0xf2, 0xc7,
                            0x61, 0xa6, 0xfb, 0x3c, 0x93, 0x25, 0xd,  0x16, 0xae, 0x7a};
  uint8_t bytesprops12[] = {0x76, 0x75, 0x13, 0x8c, 0x1c, 0x6b, 0xcd, 0xe2, 0xb7, 0x76, 0x3,
                            0x2b, 0x1e, 0x59, 0x87, 0x8d, 0x18, 0xd4, 0x94, 0xf3, 0xdc};
  uint8_t bytesprops14[] = {0x15, 0x73, 0x84};
  uint8_t bytesprops13[] = {0xb4, 0xce};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops1}, .v = {16, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28053}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10715}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22291}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26309}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15601}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21456}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops13}, .v = {3, (char*)&bytesprops14}}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 159, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoRetainNotSupported [PropSubscriptionIdentifierAvailable 58,PropRequestProblemInformation
// 217,PropResponseInformation "\DC4\193J\155p\181\135\211[)L",PropSubscriptionIdentifierAvailable
// 58,PropSubscriptionIdentifier 3,PropWildcardSubscriptionAvailable 161,PropSubscriptionIdentifier
// 17,PropResponseInformation "\194\rO\216=dC\161\205|l)\ENQ@\181+E",PropTopicAlias 31601,PropContentType
// "h_\f)\EMG\248\v\221f\ETB!\248I\ETB\169l\129\252",PropAuthenticationMethod
// "S\211s\157\240\135\144;\206\244",PropSharedSubscriptionAvailable 122,PropUserProperty "D\151\249\136\DC4\250\DC4"
// "Y\224\243\EOTR,\157\153\228^",PropWildcardSubscriptionAvailable 247,PropSubscriptionIdentifierAvailable
// 18,PropWillDelayInterval 28646,PropMessageExpiryInterval 8402,PropMessageExpiryInterval 17681,PropMaximumQoS 12]
TEST(Disco5QCTest, Encode25) {
  uint8_t pkt[] = {0xe0, 0x84, 0x1,  0x9a, 0x81, 0x1,  0x29, 0x3a, 0x17, 0xd9, 0x1a, 0x0,  0xb,  0x14, 0xc1, 0x4a, 0x9b,
                   0x70, 0xb5, 0x87, 0xd3, 0x5b, 0x29, 0x4c, 0x29, 0x3a, 0xb,  0x3,  0x28, 0xa1, 0xb,  0x11, 0x1a, 0x0,
                   0x11, 0xc2, 0xd,  0x4f, 0xd8, 0x3d, 0x64, 0x43, 0xa1, 0xcd, 0x7c, 0x6c, 0x29, 0x5,  0x40, 0xb5, 0x2b,
                   0x45, 0x23, 0x7b, 0x71, 0x3,  0x0,  0x13, 0x68, 0x5f, 0xc,  0x29, 0x19, 0x47, 0xf8, 0xb,  0xdd, 0x66,
                   0x17, 0x21, 0xf8, 0x49, 0x17, 0xa9, 0x6c, 0x81, 0xfc, 0x15, 0x0,  0xa,  0x53, 0xd3, 0x73, 0x9d, 0xf0,
                   0x87, 0x90, 0x3b, 0xce, 0xf4, 0x2a, 0x7a, 0x26, 0x0,  0x7,  0x44, 0x97, 0xf9, 0x88, 0x14, 0xfa, 0x14,
                   0x0,  0xa,  0x59, 0xe0, 0xf3, 0x4,  0x52, 0x2c, 0x9d, 0x99, 0xe4, 0x5e, 0x28, 0xf7, 0x29, 0x12, 0x18,
                   0x0,  0x0,  0x6f, 0xe6, 0x2,  0x0,  0x0,  0x20, 0xd2, 0x2,  0x0,  0x0,  0x45, 0x11, 0x24, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x14, 0xc1, 0x4a, 0x9b, 0x70, 0xb5, 0x87, 0xd3, 0x5b, 0x29, 0x4c};
  uint8_t bytesprops1[] = {0xc2, 0xd,  0x4f, 0xd8, 0x3d, 0x64, 0x43, 0xa1, 0xcd,
                           0x7c, 0x6c, 0x29, 0x5,  0x40, 0xb5, 0x2b, 0x45};
  uint8_t bytesprops2[] = {0x68, 0x5f, 0xc,  0x29, 0x19, 0x47, 0xf8, 0xb,  0xdd, 0x66,
                           0x17, 0x21, 0xf8, 0x49, 0x17, 0xa9, 0x6c, 0x81, 0xfc};
  uint8_t bytesprops3[] = {0x53, 0xd3, 0x73, 0x9d, 0xf0, 0x87, 0x90, 0x3b, 0xce, 0xf4};
  uint8_t bytesprops5[] = {0x59, 0xe0, 0xf3, 0x4, 0x52, 0x2c, 0x9d, 0x99, 0xe4, 0x5e};
  uint8_t bytesprops4[] = {0x44, 0x97, 0xf9, 0x88, 0x14, 0xfa, 0x14};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31601}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 122}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops4}, .v = {10, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28646}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8402}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17681}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 12}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 154, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSubscriptionIdentifiersNotSupported [PropPayloadFormatIndicator
// 28,PropSharedSubscriptionAvailable 45,PropMessageExpiryInterval 13199,PropWillDelayInterval
// 5231,PropWillDelayInterval 19944,PropAuthenticationMethod
// "U\154\188R\198e\157k1&L\249\224c3\DC2pj",PropMessageExpiryInterval 8745,PropUserProperty
// "+\SOH\DLEJ\240\238\234j\188?I" "\DC1e\173\149K\DC4\193\225\194\207rT\131\145\153?9\SOH",PropRetainAvailable
// 173,PropRequestResponseInformation 24,PropUserProperty "\130@9\aQY\150" "\146\145
// y9\245\187\FS\244\178\138\ETB\206O1\142\166\254\NAK\165\FS\197\249\243\150u\200\176\USj",PropRetainAvailable
// 139,PropMaximumPacketSize 5314,PropTopicAliasMaximum 3496,PropResponseTopic
// "f\DC3\225\223\SI\220\201\218\DC2R\STX\198\NAKy\210",PropMaximumPacketSize 22692,PropReceiveMaximum
// 15527,PropServerKeepAlive 14795,PropMessageExpiryInterval 23340,PropResponseTopic
// "aE\220\a6\175K\204",PropWildcardSubscriptionAvailable 236,PropRequestProblemInformation
// 163,PropRequestResponseInformation 56,PropPayloadFormatIndicator 73,PropTopicAliasMaximum 21923,PropMaximumPacketSize
// 24460,PropContentType "*\136,",PropSubscriptionIdentifier 0]
TEST(Disco5QCTest, Encode26) {
  uint8_t pkt[] = {0xe0, 0xcf, 0x1,  0xa1, 0xcc, 0x1,  0x1,  0x1c, 0x2a, 0x2d, 0x2,  0x0,  0x0,  0x33, 0x8f, 0x18, 0x0,
                   0x0,  0x14, 0x6f, 0x18, 0x0,  0x0,  0x4d, 0xe8, 0x15, 0x0,  0x12, 0x55, 0x9a, 0xbc, 0x52, 0xc6, 0x65,
                   0x9d, 0x6b, 0x31, 0x26, 0x4c, 0xf9, 0xe0, 0x63, 0x33, 0x12, 0x70, 0x6a, 0x2,  0x0,  0x0,  0x22, 0x29,
                   0x26, 0x0,  0xb,  0x2b, 0x1,  0x10, 0x4a, 0xf0, 0xee, 0xea, 0x6a, 0xbc, 0x3f, 0x49, 0x0,  0x12, 0x11,
                   0x65, 0xad, 0x95, 0x4b, 0x14, 0xc1, 0xe1, 0xc2, 0xcf, 0x72, 0x54, 0x83, 0x91, 0x99, 0x3f, 0x39, 0x1,
                   0x25, 0xad, 0x19, 0x18, 0x26, 0x0,  0x7,  0x82, 0x40, 0x39, 0x7,  0x51, 0x59, 0x96, 0x0,  0x1e, 0x92,
                   0x91, 0x20, 0x79, 0x39, 0xf5, 0xbb, 0x1c, 0xf4, 0xb2, 0x8a, 0x17, 0xce, 0x4f, 0x31, 0x8e, 0xa6, 0xfe,
                   0x15, 0xa5, 0x1c, 0xc5, 0xf9, 0xf3, 0x96, 0x75, 0xc8, 0xb0, 0x1f, 0x6a, 0x25, 0x8b, 0x27, 0x0,  0x0,
                   0x14, 0xc2, 0x22, 0xd,  0xa8, 0x8,  0x0,  0xf,  0x66, 0x13, 0xe1, 0xdf, 0xf,  0xdc, 0xc9, 0xda, 0x12,
                   0x52, 0x2,  0xc6, 0x15, 0x79, 0xd2, 0x27, 0x0,  0x0,  0x58, 0xa4, 0x21, 0x3c, 0xa7, 0x13, 0x39, 0xcb,
                   0x2,  0x0,  0x0,  0x5b, 0x2c, 0x8,  0x0,  0x8,  0x61, 0x45, 0xdc, 0x7,  0x36, 0xaf, 0x4b, 0xcc, 0x28,
                   0xec, 0x17, 0xa3, 0x19, 0x38, 0x1,  0x49, 0x22, 0x55, 0xa3, 0x27, 0x0,  0x0,  0x5f, 0x8c, 0x3,  0x0,
                   0x3,  0x2a, 0x88, 0x2c, 0xb,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x55, 0x9a, 0xbc, 0x52, 0xc6, 0x65, 0x9d, 0x6b, 0x31,
                           0x26, 0x4c, 0xf9, 0xe0, 0x63, 0x33, 0x12, 0x70, 0x6a};
  uint8_t bytesprops2[] = {0x11, 0x65, 0xad, 0x95, 0x4b, 0x14, 0xc1, 0xe1, 0xc2,
                           0xcf, 0x72, 0x54, 0x83, 0x91, 0x99, 0x3f, 0x39, 0x1};
  uint8_t bytesprops1[] = {0x2b, 0x1, 0x10, 0x4a, 0xf0, 0xee, 0xea, 0x6a, 0xbc, 0x3f, 0x49};
  uint8_t bytesprops4[] = {0x92, 0x91, 0x20, 0x79, 0x39, 0xf5, 0xbb, 0x1c, 0xf4, 0xb2, 0x8a, 0x17, 0xce, 0x4f, 0x31,
                           0x8e, 0xa6, 0xfe, 0x15, 0xa5, 0x1c, 0xc5, 0xf9, 0xf3, 0x96, 0x75, 0xc8, 0xb0, 0x1f, 0x6a};
  uint8_t bytesprops3[] = {0x82, 0x40, 0x39, 0x7, 0x51, 0x59, 0x96};
  uint8_t bytesprops5[] = {0x66, 0x13, 0xe1, 0xdf, 0xf, 0xdc, 0xc9, 0xda, 0x12, 0x52, 0x2, 0xc6, 0x15, 0x79, 0xd2};
  uint8_t bytesprops6[] = {0x61, 0x45, 0xdc, 0x7, 0x36, 0xaf, 0x4b, 0xcc};
  uint8_t bytesprops7[] = {0x2a, 0x88, 0x2c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13199}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5231}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19944}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8745}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops3}, .v = {30, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5314}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3496}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22692}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15527}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14795}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23340}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21923}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24460}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 161, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMalformedPacket [PropUserProperty
// "\195\166\180u\189Z\179\181Ab\SIE\255\&1\252\203c\219\174\US\192\DC3\172"
// "R\190\v\227\205\214\"\131D[\128G\163\182\183\RS\228\140\161",PropServerKeepAlive 7736,PropSessionExpiryInterval
// 19120,PropCorrelationData "\251\192\&7=G",PropCorrelationData
// "\DC1\151\221\175k6\232\DC1\DC1\180\223",PropSessionExpiryInterval 18563,PropRequestProblemInformation
// 228,PropCorrelationData "\161\255\EM",PropReceiveMaximum 4326,PropAssignedClientIdentifier
// "yB\247\SO!\t\225\141\219P\215\244`\253",PropAuthenticationMethod "\f\212",PropRetainAvailable
// 154,PropMaximumPacketSize 23032,PropRequestResponseInformation 205,PropMessageExpiryInterval 9326,PropContentType
// "\t\132\144-\225\&3\140\RS\190\211Eb\220 \171\ETXW\254\245",PropReasonString
// "\DC3\162\170\180\STX\243<",PropResponseInformation "\161Z*\DC4\ESC\195\238\185\224\247)x\203\159",PropMaximumQoS
// 11,PropSubscriptionIdentifierAvailable 211,PropResponseTopic "\251",PropAssignedClientIdentifier
// "\228",PropRequestResponseInformation 56,PropUserProperty
// "\193\153\211\229\202\195R\228\214\176\204\234(\SOY\176\177\239\176\225\fB\247\249C\SOH" "-`\219o \SYN\b\247ud\ESC"]
TEST(Disco5QCTest, Encode27) {
  uint8_t pkt[] = {
      0xe0, 0xed, 0x1,  0x81, 0xea, 0x1,  0x26, 0x0,  0x17, 0xc3, 0xa6, 0xb4, 0x75, 0xbd, 0x5a, 0xb3, 0xb5, 0x41, 0x62,
      0xf,  0x45, 0xff, 0x31, 0xfc, 0xcb, 0x63, 0xdb, 0xae, 0x1f, 0xc0, 0x13, 0xac, 0x0,  0x13, 0x52, 0xbe, 0xb,  0xe3,
      0xcd, 0xd6, 0x22, 0x83, 0x44, 0x5b, 0x80, 0x47, 0xa3, 0xb6, 0xb7, 0x1e, 0xe4, 0x8c, 0xa1, 0x13, 0x1e, 0x38, 0x11,
      0x0,  0x0,  0x4a, 0xb0, 0x9,  0x0,  0x5,  0xfb, 0xc0, 0x37, 0x3d, 0x47, 0x9,  0x0,  0xb,  0x11, 0x97, 0xdd, 0xaf,
      0x6b, 0x36, 0xe8, 0x11, 0x11, 0xb4, 0xdf, 0x11, 0x0,  0x0,  0x48, 0x83, 0x17, 0xe4, 0x9,  0x0,  0x3,  0xa1, 0xff,
      0x19, 0x21, 0x10, 0xe6, 0x12, 0x0,  0xe,  0x79, 0x42, 0xf7, 0xe,  0x21, 0x9,  0xe1, 0x8d, 0xdb, 0x50, 0xd7, 0xf4,
      0x60, 0xfd, 0x15, 0x0,  0x2,  0xc,  0xd4, 0x25, 0x9a, 0x27, 0x0,  0x0,  0x59, 0xf8, 0x19, 0xcd, 0x2,  0x0,  0x0,
      0x24, 0x6e, 0x3,  0x0,  0x13, 0x9,  0x84, 0x90, 0x2d, 0xe1, 0x33, 0x8c, 0x1e, 0xbe, 0xd3, 0x45, 0x62, 0xdc, 0x20,
      0xab, 0x3,  0x57, 0xfe, 0xf5, 0x1f, 0x0,  0x7,  0x13, 0xa2, 0xaa, 0xb4, 0x2,  0xf3, 0x3c, 0x1a, 0x0,  0xe,  0xa1,
      0x5a, 0x2a, 0x14, 0x1b, 0xc3, 0xee, 0xb9, 0xe0, 0xf7, 0x29, 0x78, 0xcb, 0x9f, 0x24, 0xb,  0x29, 0xd3, 0x8,  0x0,
      0x1,  0xfb, 0x12, 0x0,  0x1,  0xe4, 0x19, 0x38, 0x26, 0x0,  0x1a, 0xc1, 0x99, 0xd3, 0xe5, 0xca, 0xc3, 0x52, 0xe4,
      0xd6, 0xb0, 0xcc, 0xea, 0x28, 0xe,  0x59, 0xb0, 0xb1, 0xef, 0xb0, 0xe1, 0xc,  0x42, 0xf7, 0xf9, 0x43, 0x1,  0x0,
      0xb,  0x2d, 0x60, 0xdb, 0x6f, 0x20, 0x16, 0x8,  0xf7, 0x75, 0x64, 0x1b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x52, 0xbe, 0xb,  0xe3, 0xcd, 0xd6, 0x22, 0x83, 0x44, 0x5b,
                           0x80, 0x47, 0xa3, 0xb6, 0xb7, 0x1e, 0xe4, 0x8c, 0xa1};
  uint8_t bytesprops0[] = {0xc3, 0xa6, 0xb4, 0x75, 0xbd, 0x5a, 0xb3, 0xb5, 0x41, 0x62, 0xf, 0x45,
                           0xff, 0x31, 0xfc, 0xcb, 0x63, 0xdb, 0xae, 0x1f, 0xc0, 0x13, 0xac};
  uint8_t bytesprops2[] = {0xfb, 0xc0, 0x37, 0x3d, 0x47};
  uint8_t bytesprops3[] = {0x11, 0x97, 0xdd, 0xaf, 0x6b, 0x36, 0xe8, 0x11, 0x11, 0xb4, 0xdf};
  uint8_t bytesprops4[] = {0xa1, 0xff, 0x19};
  uint8_t bytesprops5[] = {0x79, 0x42, 0xf7, 0xe, 0x21, 0x9, 0xe1, 0x8d, 0xdb, 0x50, 0xd7, 0xf4, 0x60, 0xfd};
  uint8_t bytesprops6[] = {0xc, 0xd4};
  uint8_t bytesprops7[] = {0x9,  0x84, 0x90, 0x2d, 0xe1, 0x33, 0x8c, 0x1e, 0xbe, 0xd3,
                           0x45, 0x62, 0xdc, 0x20, 0xab, 0x3,  0x57, 0xfe, 0xf5};
  uint8_t bytesprops8[] = {0x13, 0xa2, 0xaa, 0xb4, 0x2, 0xf3, 0x3c};
  uint8_t bytesprops9[] = {0xa1, 0x5a, 0x2a, 0x14, 0x1b, 0xc3, 0xee, 0xb9, 0xe0, 0xf7, 0x29, 0x78, 0xcb, 0x9f};
  uint8_t bytesprops10[] = {0xfb};
  uint8_t bytesprops11[] = {0xe4};
  uint8_t bytesprops13[] = {0x2d, 0x60, 0xdb, 0x6f, 0x20, 0x16, 0x8, 0xf7, 0x75, 0x64, 0x1b};
  uint8_t bytesprops12[] = {0xc1, 0x99, 0xd3, 0xe5, 0xca, 0xc3, 0x52, 0xe4, 0xd6, 0xb0, 0xcc, 0xea, 0x28,
                            0xe,  0x59, 0xb0, 0xb1, 0xef, 0xb0, 0xe1, 0xc,  0x42, 0xf7, 0xf9, 0x43, 0x1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops0}, .v = {19, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7736}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19120}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18563}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4326}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23032}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9326}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 211}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {26, (char*)&bytesprops12}, .v = {11, (char*)&bytesprops13}}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 129, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicAliasInvalid [PropServerReference "",PropTopicAlias 20930,PropTopicAlias
// 15670,PropAuthenticationMethod "'(\225\139rP~Eq\205umB\216K&\182",PropResponseInformation
// ".e",PropPayloadFormatIndicator 214,PropMaximumQoS 86,PropServerKeepAlive 17262,PropMessageExpiryInterval
// 30402,PropServerKeepAlive 13701,PropContentType
// "\187PR\192\250\&02y\159.\GS\184\ACK\154]\167\SO\132~\252\165wYl\149\216",PropTopicAlias 10414,PropAuthenticationData
// "\145I\206\142-f\159\238 =\167R\199\SOH\249B>:T\169\179\193\&4f\ENQ\248\250\169\SI",PropRequestResponseInformation
// 110,PropMaximumQoS 6,PropWildcardSubscriptionAvailable 104,PropRequestProblemInformation 132,PropContentType
// "\195\151W\\\171y\217\194\141\137\156k\165b>(\SOH\GSz]G\175\251",PropAuthenticationMethod
// "\146E\176\189\225m\128\149J6@1n\v\192\191\159M\t\SI\218\227\239x7\ETB\202=",PropTopicAlias
// 32393,PropWillDelayInterval 26126,PropServerReference "",PropAuthenticationData
// "[K\150\221\199\181}\212\&3A6\159\184\222\161\DC3%\170"]
TEST(Disco5QCTest, Encode28) {
  uint8_t pkt[] = {0xe0, 0xd5, 0x1,  0x94, 0xd2, 0x1,  0x1c, 0x0,  0x0,  0x23, 0x51, 0xc2, 0x23, 0x3d, 0x36, 0x15, 0x0,
                   0x11, 0x27, 0x28, 0xe1, 0x8b, 0x72, 0x50, 0x7e, 0x45, 0x71, 0xcd, 0x75, 0x6d, 0x42, 0xd8, 0x4b, 0x26,
                   0xb6, 0x1a, 0x0,  0x2,  0x2e, 0x65, 0x1,  0xd6, 0x24, 0x56, 0x13, 0x43, 0x6e, 0x2,  0x0,  0x0,  0x76,
                   0xc2, 0x13, 0x35, 0x85, 0x3,  0x0,  0x1a, 0xbb, 0x50, 0x52, 0xc0, 0xfa, 0x30, 0x32, 0x79, 0x9f, 0x2e,
                   0x1d, 0xb8, 0x6,  0x9a, 0x5d, 0xa7, 0xe,  0x84, 0x7e, 0xfc, 0xa5, 0x77, 0x59, 0x6c, 0x95, 0xd8, 0x23,
                   0x28, 0xae, 0x16, 0x0,  0x1d, 0x91, 0x49, 0xce, 0x8e, 0x2d, 0x66, 0x9f, 0xee, 0x20, 0x3d, 0xa7, 0x52,
                   0xc7, 0x1,  0xf9, 0x42, 0x3e, 0x3a, 0x54, 0xa9, 0xb3, 0xc1, 0x34, 0x66, 0x5,  0xf8, 0xfa, 0xa9, 0xf,
                   0x19, 0x6e, 0x24, 0x6,  0x28, 0x68, 0x17, 0x84, 0x3,  0x0,  0x17, 0xc3, 0x97, 0x57, 0x5c, 0xab, 0x79,
                   0xd9, 0xc2, 0x8d, 0x89, 0x9c, 0x6b, 0xa5, 0x62, 0x3e, 0x28, 0x1,  0x1d, 0x7a, 0x5d, 0x47, 0xaf, 0xfb,
                   0x15, 0x0,  0x1c, 0x92, 0x45, 0xb0, 0xbd, 0xe1, 0x6d, 0x80, 0x95, 0x4a, 0x36, 0x40, 0x31, 0x6e, 0xb,
                   0xc0, 0xbf, 0x9f, 0x4d, 0x9,  0xf,  0xda, 0xe3, 0xef, 0x78, 0x37, 0x17, 0xca, 0x3d, 0x23, 0x7e, 0x89,
                   0x18, 0x0,  0x0,  0x66, 0xe,  0x1c, 0x0,  0x0,  0x16, 0x0,  0x12, 0x5b, 0x4b, 0x96, 0xdd, 0xc7, 0xb5,
                   0x7d, 0xd4, 0x33, 0x41, 0x36, 0x9f, 0xb8, 0xde, 0xa1, 0x13, 0x25, 0xaa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x27, 0x28, 0xe1, 0x8b, 0x72, 0x50, 0x7e, 0x45, 0x71,
                           0xcd, 0x75, 0x6d, 0x42, 0xd8, 0x4b, 0x26, 0xb6};
  uint8_t bytesprops2[] = {0x2e, 0x65};
  uint8_t bytesprops3[] = {0xbb, 0x50, 0x52, 0xc0, 0xfa, 0x30, 0x32, 0x79, 0x9f, 0x2e, 0x1d, 0xb8, 0x6,
                           0x9a, 0x5d, 0xa7, 0xe,  0x84, 0x7e, 0xfc, 0xa5, 0x77, 0x59, 0x6c, 0x95, 0xd8};
  uint8_t bytesprops4[] = {0x91, 0x49, 0xce, 0x8e, 0x2d, 0x66, 0x9f, 0xee, 0x20, 0x3d, 0xa7, 0x52, 0xc7, 0x1, 0xf9,
                           0x42, 0x3e, 0x3a, 0x54, 0xa9, 0xb3, 0xc1, 0x34, 0x66, 0x5,  0xf8, 0xfa, 0xa9, 0xf};
  uint8_t bytesprops5[] = {0xc3, 0x97, 0x57, 0x5c, 0xab, 0x79, 0xd9, 0xc2, 0x8d, 0x89, 0x9c, 0x6b,
                           0xa5, 0x62, 0x3e, 0x28, 0x1,  0x1d, 0x7a, 0x5d, 0x47, 0xaf, 0xfb};
  uint8_t bytesprops6[] = {0x92, 0x45, 0xb0, 0xbd, 0xe1, 0x6d, 0x80, 0x95, 0x4a, 0x36, 0x40, 0x31, 0x6e, 0xb,
                           0xc0, 0xbf, 0x9f, 0x4d, 0x9,  0xf,  0xda, 0xe3, 0xef, 0x78, 0x37, 0x17, 0xca, 0x3d};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0x5b, 0x4b, 0x96, 0xdd, 0xc7, 0xb5, 0x7d, 0xd4, 0x33,
                           0x41, 0x36, 0x9f, 0xb8, 0xde, 0xa1, 0x13, 0x25, 0xaa};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20930}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15670}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17262}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30402}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13701}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10414}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32393}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26126}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 148, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNotAuthorized [PropServerKeepAlive 20971,PropRequestProblemInformation 82,PropCorrelationData
// "\t\194|9N\143vPU\237\162.\NAK\211\169\145_\203\225\241\179\133\174\215\212\n",PropMaximumQoS
// 178,PropRequestResponseInformation 217,PropRequestProblemInformation 4,PropTopicAlias 10045,PropResponseInformation
// "\219\EOT\220\152",PropMaximumQoS 87,PropSharedSubscriptionAvailable 145,PropSubscriptionIdentifier
// 23,PropCorrelationData "9\150\183\ESC\163\138\140\182\249\149\235",PropPayloadFormatIndicator 194,PropReasonString
// "i\231!t)nv\135\n\184\227~dJBW",PropResponseInformation "\136r\206\238\SO1\151\217\240F\241J",PropServerKeepAlive
// 27793,PropSharedSubscriptionAvailable 189,PropReasonString "t\170\&8.fZ\214\153(\SIU\199K`\DLE\166)\STX"]
TEST(Disco5QCTest, Encode29) {
  uint8_t pkt[] = {0xe0, 0x87, 0x1,  0x87, 0x84, 0x1,  0x13, 0x51, 0xeb, 0x17, 0x52, 0x9,  0x0,  0x1a, 0x9,  0xc2,
                   0x7c, 0x39, 0x4e, 0x8f, 0x76, 0x50, 0x55, 0xed, 0xa2, 0x2e, 0x15, 0xd3, 0xa9, 0x91, 0x5f, 0xcb,
                   0xe1, 0xf1, 0xb3, 0x85, 0xae, 0xd7, 0xd4, 0xa,  0x24, 0xb2, 0x19, 0xd9, 0x17, 0x4,  0x23, 0x27,
                   0x3d, 0x1a, 0x0,  0x4,  0xdb, 0x4,  0xdc, 0x98, 0x24, 0x57, 0x2a, 0x91, 0xb,  0x17, 0x9,  0x0,
                   0xb,  0x39, 0x96, 0xb7, 0x1b, 0xa3, 0x8a, 0x8c, 0xb6, 0xf9, 0x95, 0xeb, 0x1,  0xc2, 0x1f, 0x0,
                   0x10, 0x69, 0xe7, 0x21, 0x74, 0x29, 0x6e, 0x76, 0x87, 0xa,  0xb8, 0xe3, 0x7e, 0x64, 0x4a, 0x42,
                   0x57, 0x1a, 0x0,  0xc,  0x88, 0x72, 0xce, 0xee, 0xe,  0x31, 0x97, 0xd9, 0xf0, 0x46, 0xf1, 0x4a,
                   0x13, 0x6c, 0x91, 0x2a, 0xbd, 0x1f, 0x0,  0x12, 0x74, 0xaa, 0x38, 0x2e, 0x66, 0x5a, 0xd6, 0x99,
                   0x28, 0xf,  0x55, 0xc7, 0x4b, 0x60, 0x10, 0xa6, 0x29, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9,  0xc2, 0x7c, 0x39, 0x4e, 0x8f, 0x76, 0x50, 0x55, 0xed, 0xa2, 0x2e, 0x15,
                           0xd3, 0xa9, 0x91, 0x5f, 0xcb, 0xe1, 0xf1, 0xb3, 0x85, 0xae, 0xd7, 0xd4, 0xa};
  uint8_t bytesprops1[] = {0xdb, 0x4, 0xdc, 0x98};
  uint8_t bytesprops2[] = {0x39, 0x96, 0xb7, 0x1b, 0xa3, 0x8a, 0x8c, 0xb6, 0xf9, 0x95, 0xeb};
  uint8_t bytesprops3[] = {0x69, 0xe7, 0x21, 0x74, 0x29, 0x6e, 0x76, 0x87,
                           0xa,  0xb8, 0xe3, 0x7e, 0x64, 0x4a, 0x42, 0x57};
  uint8_t bytesprops4[] = {0x88, 0x72, 0xce, 0xee, 0xe, 0x31, 0x97, 0xd9, 0xf0, 0x46, 0xf1, 0x4a};
  uint8_t bytesprops5[] = {0x74, 0xaa, 0x38, 0x2e, 0x66, 0x5a, 0xd6, 0x99, 0x28,
                           0xf,  0x55, 0xc7, 0x4b, 0x60, 0x10, 0xa6, 0x29, 0x2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20971}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10045}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27793}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 135, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSessiontakenOver [PropResponseInformation
// "\b\255EV`\151k\n\140Q\154\251\143\\6\148\146\179\v",PropMessageExpiryInterval 29816,PropServerKeepAlive
// 23021,PropTopicAlias 15077,PropSharedSubscriptionAvailable 241,PropSubscriptionIdentifierAvailable 12]
TEST(Disco5QCTest, Encode30) {
  uint8_t pkt[] = {0xe0, 0x27, 0x8e, 0x25, 0x1a, 0x0,  0x13, 0x8,  0xff, 0x45, 0x56, 0x60, 0x97, 0x6b,
                   0xa,  0x8c, 0x51, 0x9a, 0xfb, 0x8f, 0x5c, 0x36, 0x94, 0x92, 0xb3, 0xb,  0x2,  0x0,
                   0x0,  0x74, 0x78, 0x13, 0x59, 0xed, 0x23, 0x3a, 0xe5, 0x2a, 0xf1, 0x29, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8,  0xff, 0x45, 0x56, 0x60, 0x97, 0x6b, 0xa,  0x8c, 0x51,
                           0x9a, 0xfb, 0x8f, 0x5c, 0x36, 0x94, 0x92, 0xb3, 0xb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29816}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23021}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15077}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 12}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 142, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
