#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\226\186&N9\161\169\214\183\fO\210\SYNC\190Hj\233\221\189\173D\191", _pubPktID = 1989, _pubBody =
// "P\197\196\209K[\SOH/\132\207R\165\&9\180D\DLE\250_G\130f\DC2)\140kR", _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x35, 0x35, 0x0,  0x17, 0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,
                   0x4f, 0xd2, 0x16, 0x43, 0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf, 0x7,
                   0xc5, 0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39,
                   0xb4, 0x44, 0x10, 0xfa, 0x5f, 0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};

  uint8_t buf[65] = {0};
  uint8_t topic_bytes[] = {0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,  0x4f, 0xd2,
                           0x16, 0x43, 0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39,
                         0xb4, 0x44, 0x10, 0xfa, 0x5f, 0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 1989, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\226\186&N9\161\169\214\183\fO\210\SYNC\190Hj\233\221\189\173D\191", _pubPktID = 1989, _pubBody =
// "P\197\196\209K[\SOH/\132\207R\165\&9\180D\DLE\250_G\130f\DC2)\140kR", _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x35, 0x35, 0x0,  0x17, 0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,
                   0x4f, 0xd2, 0x16, 0x43, 0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf, 0x7,
                   0xc5, 0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39,
                   0xb4, 0x44, 0x10, 0xfa, 0x5f, 0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,  0x4f, 0xd2,
                               0x16, 0x43, 0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39,
                              0xb4, 0x44, 0x10, 0xfa, 0x5f, 0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1989);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\222\145Cc\220\210\226\245x\246qst\249\156\SUB\226\132\137Ys\173<s\ESCj\153-\199", _pubPktID = 0, _pubBody =
// "\164\STXh", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x38, 0x22, 0x0,  0x1d, 0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5,
                   0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9, 0x9c, 0x1a, 0xe2, 0x84, 0x89, 0x59,
                   0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7, 0xa4, 0x2,  0x68};

  uint8_t buf[46] = {0};
  uint8_t topic_bytes[] = {0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5, 0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9, 0x9c,
                           0x1a, 0xe2, 0x84, 0x89, 0x59, 0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa4, 0x2, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\222\145Cc\220\210\226\245x\246qst\249\156\SUB\226\132\137Ys\173<s\ESCj\153-\199", _pubPktID = 0, _pubBody =
// "\164\STXh", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x38, 0x22, 0x0,  0x1d, 0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5,
                   0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9, 0x9c, 0x1a, 0xe2, 0x84, 0x89, 0x59,
                   0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7, 0xa4, 0x2,  0x68};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5, 0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9, 0x9c,
                               0x1a, 0xe2, 0x84, 0x89, 0x59, 0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa4, 0x2, 0x68};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = ",f", _pubPktID = 3323, _pubBody =
// "\130\170\152", _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x3a, 0x9, 0x0, 0x2, 0x2c, 0x66, 0xc, 0xfb, 0x82, 0xaa, 0x98};

  uint8_t buf[21] = {0};
  uint8_t topic_bytes[] = {0x2c, 0x66};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x82, 0xaa, 0x98};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 3323, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = ",f", _pubPktID = 3323, _pubBody =
// "\130\170\152", _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x3a, 0x9, 0x0, 0x2, 0x2c, 0x66, 0xc, 0xfb, 0x82, 0xaa, 0x98};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2c, 0x66};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x82, 0xaa, 0x98};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3323);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "e\226\145", _pubPktID = 0, _pubBody =
// "\225?\246P\197\165t\243\173C\134\185", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x39, 0x11, 0x0,  0x3,  0x65, 0xe2, 0x91, 0xe1, 0x3f, 0xf6,
                   0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};

  uint8_t buf[29] = {0};
  uint8_t topic_bytes[] = {0x65, 0xe2, 0x91};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe1, 0x3f, 0xf6, 0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "e\226\145", _pubPktID = 0, _pubBody =
// "\225?\246P\197\165t\243\173C\134\185", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x39, 0x11, 0x0,  0x3,  0x65, 0xe2, 0x91, 0xe1, 0x3f, 0xf6,
                   0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x65, 0xe2, 0x91};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe1, 0x3f, 0xf6, 0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\191", _pubPktID = 26120,
// _pubBody = "_e(\238\187\252\234\241\201<!\SOHg\220\DEL", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x3d, 0x15, 0x0,  0x2,  0xff, 0xbf, 0x66, 0x8, 0x5f, 0x65, 0x28, 0xee,
                   0xbb, 0xfc, 0xea, 0xf1, 0xc9, 0x3c, 0x21, 0x1, 0x67, 0xdc, 0x7f};

  uint8_t buf[33] = {0};
  uint8_t topic_bytes[] = {0xff, 0xbf};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5f, 0x65, 0x28, 0xee, 0xbb, 0xfc, 0xea, 0xf1, 0xc9, 0x3c, 0x21, 0x1, 0x67, 0xdc, 0x7f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 26120, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\191", _pubPktID = 26120,
// _pubBody = "_e(\238\187\252\234\241\201<!\SOHg\220\DEL", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x3d, 0x15, 0x0,  0x2,  0xff, 0xbf, 0x66, 0x8, 0x5f, 0x65, 0x28, 0xee,
                   0xbb, 0xfc, 0xea, 0xf1, 0xc9, 0x3c, 0x21, 0x1, 0x67, 0xdc, 0x7f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xff, 0xbf};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5f, 0x65, 0x28, 0xee, 0xbb, 0xfc, 0xea, 0xf1, 0xc9, 0x3c, 0x21, 0x1, 0x67, 0xdc, 0x7f};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 26120);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\tz\186\176\196\148\DC1", _pubPktID
// = 10274, _pubBody = "\199\149\244", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x3a, 0xe, 0x0, 0x7, 0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94, 0x11, 0x28, 0x22, 0xc7, 0x95, 0xf4};

  uint8_t buf[26] = {0};
  uint8_t topic_bytes[] = {0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94, 0x11};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc7, 0x95, 0xf4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 10274, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\tz\186\176\196\148\DC1", _pubPktID
// = 10274, _pubBody = "\199\149\244", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x3a, 0xe, 0x0, 0x7, 0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94, 0x11, 0x28, 0x22, 0xc7, 0x95, 0xf4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94, 0x11};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc7, 0x95, 0xf4};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10274);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "l\GS\SO\SI\176\NAKT\189\t0b\NUL\154#1", _pubPktID = 0, _pubBody =
// "\180v\132PX\145\222\160?9\205\204\241\168\&5<\235\222\160\\\190Tg\128", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x31, 0x29, 0x0,  0xf,  0x6c, 0x1d, 0xe,  0xf,  0xb0, 0x15, 0x54, 0xbd, 0x9,  0x30, 0x62,
                   0x0,  0x9a, 0x23, 0x31, 0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0, 0x3f, 0x39, 0xcd,
                   0xcc, 0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};

  uint8_t buf[53] = {0};
  uint8_t topic_bytes[] = {0x6c, 0x1d, 0xe, 0xf, 0xb0, 0x15, 0x54, 0xbd, 0x9, 0x30, 0x62, 0x0, 0x9a, 0x23, 0x31};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0, 0x3f, 0x39, 0xcd, 0xcc,
                         0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "l\GS\SO\SI\176\NAKT\189\t0b\NUL\154#1", _pubPktID = 0, _pubBody =
// "\180v\132PX\145\222\160?9\205\204\241\168\&5<\235\222\160\\\190Tg\128", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x31, 0x29, 0x0,  0xf,  0x6c, 0x1d, 0xe,  0xf,  0xb0, 0x15, 0x54, 0xbd, 0x9,  0x30, 0x62,
                   0x0,  0x9a, 0x23, 0x31, 0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0, 0x3f, 0x39, 0xcd,
                   0xcc, 0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6c, 0x1d, 0xe, 0xf, 0xb0, 0x15, 0x54, 0xbd, 0x9, 0x30, 0x62, 0x0, 0x9a, 0x23, 0x31};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0, 0x3f, 0x39, 0xcd, 0xcc,
                              0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\244_\249R\255\232t\194", _pubPktID
// = 4521, _pubBody = "\213\SOQ\252\167\179#\DEL\SIc\223\EOT\156\210\214\bp", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x35, 0x1d, 0x0,  0x8,  0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2, 0x11, 0xa9, 0xd5, 0xe,
                   0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,  0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};

  uint8_t buf[41] = {0};
  uint8_t topic_bytes[] = {0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd5, 0xe,  0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,
                         0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 4521, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\244_\249R\255\232t\194", _pubPktID
// = 4521, _pubBody = "\213\SOQ\252\167\179#\DEL\SIc\223\EOT\156\210\214\bp", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x35, 0x1d, 0x0,  0x8,  0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2, 0x11, 0xa9, 0xd5, 0xe,
                   0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,  0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd5, 0xe,  0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,
                              0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 4521);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "a\239\170\203|\"\t\198g\b\v[V\ETXkc\GS+\205\&5Q13M\196E", _pubPktID = 21638, _pubBody =
// "\NAK\153\221\DC3\250(2\DC2\166z\179\183Z\205>5\158\160\245", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x3d, 0x31, 0x0,  0x1a, 0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67,
                   0x8,  0xb,  0x5b, 0x56, 0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31,
                   0x33, 0x4d, 0xc4, 0x45, 0x54, 0x86, 0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32,
                   0x12, 0xa6, 0x7a, 0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};

  uint8_t buf[61] = {0};
  uint8_t topic_bytes[] = {0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67, 0x8,  0xb,  0x5b, 0x56,
                           0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31, 0x33, 0x4d, 0xc4, 0x45};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32, 0x12, 0xa6, 0x7a,
                         0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 21638, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "a\239\170\203|\"\t\198g\b\v[V\ETXkc\GS+\205\&5Q13M\196E", _pubPktID = 21638, _pubBody =
// "\NAK\153\221\DC3\250(2\DC2\166z\179\183Z\205>5\158\160\245", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x3d, 0x31, 0x0,  0x1a, 0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67,
                   0x8,  0xb,  0x5b, 0x56, 0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31,
                   0x33, 0x4d, 0xc4, 0x45, 0x54, 0x86, 0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32,
                   0x12, 0xa6, 0x7a, 0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67, 0x8,  0xb,  0x5b, 0x56,
                               0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31, 0x33, 0x4d, 0xc4, 0x45};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32, 0x12, 0xa6, 0x7a,
                              0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 21638);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "3\DC2\163\160\US\252\129\206\EMa\SYN\ESC\248J%\210\t0\224\159T\165\137&\153", _pubPktID = 14459, _pubBody =
// "\161;R\191\DC4\212,\ETB\168<\r}\244\250\&6\145_\153\241\218\175\133\NAK\SO\234\f", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x35, 0x37, 0x0,  0x19, 0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16,
                   0x1b, 0xf8, 0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99, 0x38,
                   0x7b, 0xa1, 0x3b, 0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd,  0x7d, 0xf4, 0xfa,
                   0x36, 0x91, 0x5f, 0x99, 0xf1, 0xda, 0xaf, 0x85, 0x15, 0xe,  0xea, 0xc};

  uint8_t buf[67] = {0};
  uint8_t topic_bytes[] = {0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16, 0x1b, 0xf8,
                           0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa1, 0x3b, 0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd, 0x7d, 0xf4,
                         0xfa, 0x36, 0x91, 0x5f, 0x99, 0xf1, 0xda, 0xaf, 0x85, 0x15, 0xe, 0xea, 0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 14459, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "3\DC2\163\160\US\252\129\206\EMa\SYN\ESC\248J%\210\t0\224\159T\165\137&\153", _pubPktID = 14459, _pubBody =
// "\161;R\191\DC4\212,\ETB\168<\r}\244\250\&6\145_\153\241\218\175\133\NAK\SO\234\f", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x35, 0x37, 0x0,  0x19, 0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16,
                   0x1b, 0xf8, 0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99, 0x38,
                   0x7b, 0xa1, 0x3b, 0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd,  0x7d, 0xf4, 0xfa,
                   0x36, 0x91, 0x5f, 0x99, 0xf1, 0xda, 0xaf, 0x85, 0x15, 0xe,  0xea, 0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16, 0x1b, 0xf8,
                               0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa1, 0x3b, 0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd, 0x7d, 0xf4,
                              0xfa, 0x36, 0x91, 0x5f, 0x99, 0xf1, 0xda, 0xaf, 0x85, 0x15, 0xe, 0xea, 0xc};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14459);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\226\186&N9\161\169\214\183\fO\210\SYNC\190Hj\233\221\189\173D\191", _pubPktID = 1989, _pubBody =
// "P\197\196\209K[\SOH/\132\207R\165\&9\180D\DLE\250_G\130f\DC2)\140kR", _pubProps = [PropResponseTopic
// "\225k\246\nM\143\253\170\FS\159\167\132G\185\152\160\223\196\218\223\217\252\137\223\157\DC2",PropRequestProblemInformation
// 123,PropTopicAlias 9167,PropReceiveMaximum 9103,PropRequestResponseInformation 66,PropMaximumQoS 202,PropUserProperty
// "\245\140L\167\136,6\243\248\200\229\211p'\139\t\CAN4\144\170\&5st\202\235\198o"
// "\159\133\232\&9\186?\GS9b\NAK\167\182\148\130\141\238=\152\217y\174\230\FSZi\235@\SI\129\198",PropSubscriptionIdentifier
// 15,PropUserProperty "\131\244\131Q\ENQ\ETB\170\172Ka\ENQU\r\DEL\bJ\181\DLE"
// "D\163z38\186\137\129\DC1\254\215\221\ETX\NUL9\183e\172\182\225\210 \239",PropMaximumPacketSize
// 2615,PropSessionExpiryInterval 1558,PropSessionExpiryInterval 31946,PropAssignedClientIdentifier
// ":}\236\160G\147\239n\209c\233d\133\230\188\196\&18\228\DLE/d\192|\222\NULMb\190",PropResponseInformation
// "hl]",PropMessageExpiryInterval 9713,PropWildcardSubscriptionAvailable 28,PropSessionExpiryInterval 14464]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x35, 0x8f, 0x2,  0x0,  0x17, 0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,  0x4f, 0xd2, 0x16, 0x43,
      0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf, 0x7,  0xc5, 0xd8, 0x1,  0x8,  0x0,  0x1a, 0xe1, 0x6b, 0xf6,
      0xa,  0x4d, 0x8f, 0xfd, 0xaa, 0x1c, 0x9f, 0xa7, 0x84, 0x47, 0xb9, 0x98, 0xa0, 0xdf, 0xc4, 0xda, 0xdf, 0xd9, 0xfc,
      0x89, 0xdf, 0x9d, 0x12, 0x17, 0x7b, 0x23, 0x23, 0xcf, 0x21, 0x23, 0x8f, 0x19, 0x42, 0x24, 0xca, 0x26, 0x0,  0x1b,
      0xf5, 0x8c, 0x4c, 0xa7, 0x88, 0x2c, 0x36, 0xf3, 0xf8, 0xc8, 0xe5, 0xd3, 0x70, 0x27, 0x8b, 0x9,  0x18, 0x34, 0x90,
      0xaa, 0x35, 0x73, 0x74, 0xca, 0xeb, 0xc6, 0x6f, 0x0,  0x1e, 0x9f, 0x85, 0xe8, 0x39, 0xba, 0x3f, 0x1d, 0x39, 0x62,
      0x15, 0xa7, 0xb6, 0x94, 0x82, 0x8d, 0xee, 0x3d, 0x98, 0xd9, 0x79, 0xae, 0xe6, 0x1c, 0x5a, 0x69, 0xeb, 0x40, 0xf,
      0x81, 0xc6, 0xb,  0xf,  0x26, 0x0,  0x12, 0x83, 0xf4, 0x83, 0x51, 0x5,  0x17, 0xaa, 0xac, 0x4b, 0x61, 0x5,  0x55,
      0xd,  0x7f, 0x8,  0x4a, 0xb5, 0x10, 0x0,  0x17, 0x44, 0xa3, 0x7a, 0x33, 0x38, 0xba, 0x89, 0x81, 0x11, 0xfe, 0xd7,
      0xdd, 0x3,  0x0,  0x39, 0xb7, 0x65, 0xac, 0xb6, 0xe1, 0xd2, 0x20, 0xef, 0x27, 0x0,  0x0,  0xa,  0x37, 0x11, 0x0,
      0x0,  0x6,  0x16, 0x11, 0x0,  0x0,  0x7c, 0xca, 0x12, 0x0,  0x1d, 0x3a, 0x7d, 0xec, 0xa0, 0x47, 0x93, 0xef, 0x6e,
      0xd1, 0x63, 0xe9, 0x64, 0x85, 0xe6, 0xbc, 0xc4, 0x31, 0x38, 0xe4, 0x10, 0x2f, 0x64, 0xc0, 0x7c, 0xde, 0x0,  0x4d,
      0x62, 0xbe, 0x1a, 0x0,  0x3,  0x68, 0x6c, 0x5d, 0x2,  0x0,  0x0,  0x25, 0xf1, 0x28, 0x1c, 0x11, 0x0,  0x0,  0x38,
      0x80, 0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39, 0xb4, 0x44, 0x10, 0xfa, 0x5f,
      0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};

  uint8_t buf[284] = {0};
  uint8_t topic_bytes[] = {0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,  0x4f, 0xd2,
                           0x16, 0x43, 0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf};
  lwmqtt_string_t topic = {23, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39,
                         0xb4, 0x44, 0x10, 0xfa, 0x5f, 0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0xe1, 0x6b, 0xf6, 0xa,  0x4d, 0x8f, 0xfd, 0xaa, 0x1c, 0x9f, 0xa7, 0x84, 0x47,
                           0xb9, 0x98, 0xa0, 0xdf, 0xc4, 0xda, 0xdf, 0xd9, 0xfc, 0x89, 0xdf, 0x9d, 0x12};
  uint8_t bytesprops2[] = {0x9f, 0x85, 0xe8, 0x39, 0xba, 0x3f, 0x1d, 0x39, 0x62, 0x15, 0xa7, 0xb6, 0x94, 0x82, 0x8d,
                           0xee, 0x3d, 0x98, 0xd9, 0x79, 0xae, 0xe6, 0x1c, 0x5a, 0x69, 0xeb, 0x40, 0xf,  0x81, 0xc6};
  uint8_t bytesprops1[] = {0xf5, 0x8c, 0x4c, 0xa7, 0x88, 0x2c, 0x36, 0xf3, 0xf8, 0xc8, 0xe5, 0xd3, 0x70, 0x27,
                           0x8b, 0x9,  0x18, 0x34, 0x90, 0xaa, 0x35, 0x73, 0x74, 0xca, 0xeb, 0xc6, 0x6f};
  uint8_t bytesprops4[] = {0x44, 0xa3, 0x7a, 0x33, 0x38, 0xba, 0x89, 0x81, 0x11, 0xfe, 0xd7, 0xdd,
                           0x3,  0x0,  0x39, 0xb7, 0x65, 0xac, 0xb6, 0xe1, 0xd2, 0x20, 0xef};
  uint8_t bytesprops3[] = {0x83, 0xf4, 0x83, 0x51, 0x5,  0x17, 0xaa, 0xac, 0x4b,
                           0x61, 0x5,  0x55, 0xd,  0x7f, 0x8,  0x4a, 0xb5, 0x10};
  uint8_t bytesprops5[] = {0x3a, 0x7d, 0xec, 0xa0, 0x47, 0x93, 0xef, 0x6e, 0xd1, 0x63, 0xe9, 0x64, 0x85, 0xe6, 0xbc,
                           0xc4, 0x31, 0x38, 0xe4, 0x10, 0x2f, 0x64, 0xc0, 0x7c, 0xde, 0x0,  0x4d, 0x62, 0xbe};
  uint8_t bytesprops6[] = {0x68, 0x6c, 0x5d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9167}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9103}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops1}, .v = {30, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 15}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops3}, .v = {23, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 2615}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1558}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31946}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9713}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14464}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 1989, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\226\186&N9\161\169\214\183\fO\210\SYNC\190Hj\233\221\189\173D\191", _pubPktID = 1989, _pubBody =
// "P\197\196\209K[\SOH/\132\207R\165\&9\180D\DLE\250_G\130f\DC2)\140kR", _pubProps = [PropResponseTopic
// "\225k\246\nM\143\253\170\FS\159\167\132G\185\152\160\223\196\218\223\217\252\137\223\157\DC2",PropRequestProblemInformation
// 123,PropTopicAlias 9167,PropReceiveMaximum 9103,PropRequestResponseInformation 66,PropMaximumQoS 202,PropUserProperty
// "\245\140L\167\136,6\243\248\200\229\211p'\139\t\CAN4\144\170\&5st\202\235\198o"
// "\159\133\232\&9\186?\GS9b\NAK\167\182\148\130\141\238=\152\217y\174\230\FSZi\235@\SI\129\198",PropSubscriptionIdentifier
// 15,PropUserProperty "\131\244\131Q\ENQ\ETB\170\172Ka\ENQU\r\DEL\bJ\181\DLE"
// "D\163z38\186\137\129\DC1\254\215\221\ETX\NUL9\183e\172\182\225\210 \239",PropMaximumPacketSize
// 2615,PropSessionExpiryInterval 1558,PropSessionExpiryInterval 31946,PropAssignedClientIdentifier
// ":}\236\160G\147\239n\209c\233d\133\230\188\196\&18\228\DLE/d\192|\222\NULMb\190",PropResponseInformation
// "hl]",PropMessageExpiryInterval 9713,PropWildcardSubscriptionAvailable 28,PropSessionExpiryInterval 14464]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {
      0x35, 0x8f, 0x2,  0x0,  0x17, 0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,  0x4f, 0xd2, 0x16, 0x43,
      0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf, 0x7,  0xc5, 0xd8, 0x1,  0x8,  0x0,  0x1a, 0xe1, 0x6b, 0xf6,
      0xa,  0x4d, 0x8f, 0xfd, 0xaa, 0x1c, 0x9f, 0xa7, 0x84, 0x47, 0xb9, 0x98, 0xa0, 0xdf, 0xc4, 0xda, 0xdf, 0xd9, 0xfc,
      0x89, 0xdf, 0x9d, 0x12, 0x17, 0x7b, 0x23, 0x23, 0xcf, 0x21, 0x23, 0x8f, 0x19, 0x42, 0x24, 0xca, 0x26, 0x0,  0x1b,
      0xf5, 0x8c, 0x4c, 0xa7, 0x88, 0x2c, 0x36, 0xf3, 0xf8, 0xc8, 0xe5, 0xd3, 0x70, 0x27, 0x8b, 0x9,  0x18, 0x34, 0x90,
      0xaa, 0x35, 0x73, 0x74, 0xca, 0xeb, 0xc6, 0x6f, 0x0,  0x1e, 0x9f, 0x85, 0xe8, 0x39, 0xba, 0x3f, 0x1d, 0x39, 0x62,
      0x15, 0xa7, 0xb6, 0x94, 0x82, 0x8d, 0xee, 0x3d, 0x98, 0xd9, 0x79, 0xae, 0xe6, 0x1c, 0x5a, 0x69, 0xeb, 0x40, 0xf,
      0x81, 0xc6, 0xb,  0xf,  0x26, 0x0,  0x12, 0x83, 0xf4, 0x83, 0x51, 0x5,  0x17, 0xaa, 0xac, 0x4b, 0x61, 0x5,  0x55,
      0xd,  0x7f, 0x8,  0x4a, 0xb5, 0x10, 0x0,  0x17, 0x44, 0xa3, 0x7a, 0x33, 0x38, 0xba, 0x89, 0x81, 0x11, 0xfe, 0xd7,
      0xdd, 0x3,  0x0,  0x39, 0xb7, 0x65, 0xac, 0xb6, 0xe1, 0xd2, 0x20, 0xef, 0x27, 0x0,  0x0,  0xa,  0x37, 0x11, 0x0,
      0x0,  0x6,  0x16, 0x11, 0x0,  0x0,  0x7c, 0xca, 0x12, 0x0,  0x1d, 0x3a, 0x7d, 0xec, 0xa0, 0x47, 0x93, 0xef, 0x6e,
      0xd1, 0x63, 0xe9, 0x64, 0x85, 0xe6, 0xbc, 0xc4, 0x31, 0x38, 0xe4, 0x10, 0x2f, 0x64, 0xc0, 0x7c, 0xde, 0x0,  0x4d,
      0x62, 0xbe, 0x1a, 0x0,  0x3,  0x68, 0x6c, 0x5d, 0x2,  0x0,  0x0,  0x25, 0xf1, 0x28, 0x1c, 0x11, 0x0,  0x0,  0x38,
      0x80, 0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39, 0xb4, 0x44, 0x10, 0xfa, 0x5f,
      0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe2, 0xba, 0x26, 0x4e, 0x39, 0xa1, 0xa9, 0xd6, 0xb7, 0xc,  0x4f, 0xd2,
                               0x16, 0x43, 0xbe, 0x48, 0x6a, 0xe9, 0xdd, 0xbd, 0xad, 0x44, 0xbf};
  lwmqtt_string_t exp_topic = {23, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x50, 0xc5, 0xc4, 0xd1, 0x4b, 0x5b, 0x1,  0x2f, 0x84, 0xcf, 0x52, 0xa5, 0x39,
                              0xb4, 0x44, 0x10, 0xfa, 0x5f, 0x47, 0x82, 0x66, 0x12, 0x29, 0x8c, 0x6b, 0x52};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 1989);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 23);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\222\145Cc\220\210\226\245x\246qst\249\156\SUB\226\132\137Ys\173<s\ESCj\153-\199", _pubPktID = 0, _pubBody =
// "\164\STXh", _pubProps = [PropRetainAvailable 232,PropSessionExpiryInterval 23490,PropServerKeepAlive
// 12380,PropReceiveMaximum 597,PropMaximumPacketSize 21211,PropWillDelayInterval 25170,PropMaximumPacketSize
// 22278,PropResponseInformation
// "\170_\160\158\236\205C.\176\130\200O*\212h\147#\ESC\192,_N\180WN\133\225",PropServerKeepAlive
// 28830,PropRequestProblemInformation 167,PropMessageExpiryInterval 1362,PropSessionExpiryInterval
// 14605,PropCorrelationData
// "(P\230\US\243\253c$R\203dT3\ETX\180'\DC4m\244r\254\SUB\165\EOT\NUL\250\140",PropAssignedClientIdentifier
// "\251O\203rdp\188\152\SO\CAN.\242|[\ETB",PropPayloadFormatIndicator 76,PropAssignedClientIdentifier
// "H\234\170\r\221S\142lE\132T]\227T5\181",PropTopicAliasMaximum 19280,PropServerKeepAlive
// 3796,PropAssignedClientIdentifier "T\DLE3/>\176\137-<X\RS\141Ay\195o{\213\DC4ve",PropUserProperty
// "\NAK\136\US0\SUB\NUL\136\DLE\RS\200T@\SI\143\155\215\155\NAKDNYJ\218\154c" "_\228\192\217",PropUserProperty
// "\154X\234\nR\143#\211\USK8\b\SO\SOX\225"
// "\254\DLEA\211\190\137y4\195g\STX{\ETB\214`\162\DC2bc\194'?\241\&3T\188\223r"]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x38, 0xa3, 0x2,  0x0,  0x1d, 0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5, 0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9,
      0x9c, 0x1a, 0xe2, 0x84, 0x89, 0x59, 0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7, 0xff, 0x1,  0x25, 0xe8,
      0x11, 0x0,  0x0,  0x5b, 0xc2, 0x13, 0x30, 0x5c, 0x21, 0x2,  0x55, 0x27, 0x0,  0x0,  0x52, 0xdb, 0x18, 0x0,  0x0,
      0x62, 0x52, 0x27, 0x0,  0x0,  0x57, 0x6,  0x1a, 0x0,  0x1b, 0xaa, 0x5f, 0xa0, 0x9e, 0xec, 0xcd, 0x43, 0x2e, 0xb0,
      0x82, 0xc8, 0x4f, 0x2a, 0xd4, 0x68, 0x93, 0x23, 0x1b, 0xc0, 0x2c, 0x5f, 0x4e, 0xb4, 0x57, 0x4e, 0x85, 0xe1, 0x13,
      0x70, 0x9e, 0x17, 0xa7, 0x2,  0x0,  0x0,  0x5,  0x52, 0x11, 0x0,  0x0,  0x39, 0xd,  0x9,  0x0,  0x1b, 0x28, 0x50,
      0xe6, 0x1f, 0xf3, 0xfd, 0x63, 0x24, 0x52, 0xcb, 0x64, 0x54, 0x33, 0x3,  0xb4, 0x27, 0x14, 0x6d, 0xf4, 0x72, 0xfe,
      0x1a, 0xa5, 0x4,  0x0,  0xfa, 0x8c, 0x12, 0x0,  0xf,  0xfb, 0x4f, 0xcb, 0x72, 0x64, 0x70, 0xbc, 0x98, 0xe,  0x18,
      0x2e, 0xf2, 0x7c, 0x5b, 0x17, 0x1,  0x4c, 0x12, 0x0,  0x10, 0x48, 0xea, 0xaa, 0xd,  0xdd, 0x53, 0x8e, 0x6c, 0x45,
      0x84, 0x54, 0x5d, 0xe3, 0x54, 0x35, 0xb5, 0x22, 0x4b, 0x50, 0x13, 0xe,  0xd4, 0x12, 0x0,  0x15, 0x54, 0x10, 0x33,
      0x2f, 0x3e, 0xb0, 0x89, 0x2d, 0x3c, 0x58, 0x1e, 0x8d, 0x41, 0x79, 0xc3, 0x6f, 0x7b, 0xd5, 0x14, 0x76, 0x65, 0x26,
      0x0,  0x19, 0x15, 0x88, 0x1f, 0x30, 0x1a, 0x0,  0x88, 0x10, 0x1e, 0xc8, 0x54, 0x40, 0xf,  0x8f, 0x9b, 0xd7, 0x9b,
      0x15, 0x44, 0x4e, 0x59, 0x4a, 0xda, 0x9a, 0x63, 0x0,  0x4,  0x5f, 0xe4, 0xc0, 0xd9, 0x26, 0x0,  0x10, 0x9a, 0x58,
      0xea, 0xa,  0x52, 0x8f, 0x23, 0xd3, 0x1f, 0x4b, 0x38, 0x8,  0xe,  0xe,  0x58, 0xe1, 0x0,  0x1c, 0xfe, 0x10, 0x41,
      0xd3, 0xbe, 0x89, 0x79, 0x34, 0xc3, 0x67, 0x2,  0x7b, 0x17, 0xd6, 0x60, 0xa2, 0x12, 0x62, 0x63, 0xc2, 0x27, 0x3f,
      0xf1, 0x33, 0x54, 0xbc, 0xdf, 0x72, 0xa4, 0x2,  0x68};

  uint8_t buf[304] = {0};
  uint8_t topic_bytes[] = {0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5, 0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9, 0x9c,
                           0x1a, 0xe2, 0x84, 0x89, 0x59, 0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xa4, 0x2, 0x68};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xaa, 0x5f, 0xa0, 0x9e, 0xec, 0xcd, 0x43, 0x2e, 0xb0, 0x82, 0xc8, 0x4f, 0x2a, 0xd4,
                           0x68, 0x93, 0x23, 0x1b, 0xc0, 0x2c, 0x5f, 0x4e, 0xb4, 0x57, 0x4e, 0x85, 0xe1};
  uint8_t bytesprops1[] = {0x28, 0x50, 0xe6, 0x1f, 0xf3, 0xfd, 0x63, 0x24, 0x52, 0xcb, 0x64, 0x54, 0x33, 0x3,
                           0xb4, 0x27, 0x14, 0x6d, 0xf4, 0x72, 0xfe, 0x1a, 0xa5, 0x4,  0x0,  0xfa, 0x8c};
  uint8_t bytesprops2[] = {0xfb, 0x4f, 0xcb, 0x72, 0x64, 0x70, 0xbc, 0x98, 0xe, 0x18, 0x2e, 0xf2, 0x7c, 0x5b, 0x17};
  uint8_t bytesprops3[] = {0x48, 0xea, 0xaa, 0xd,  0xdd, 0x53, 0x8e, 0x6c,
                           0x45, 0x84, 0x54, 0x5d, 0xe3, 0x54, 0x35, 0xb5};
  uint8_t bytesprops4[] = {0x54, 0x10, 0x33, 0x2f, 0x3e, 0xb0, 0x89, 0x2d, 0x3c, 0x58, 0x1e,
                           0x8d, 0x41, 0x79, 0xc3, 0x6f, 0x7b, 0xd5, 0x14, 0x76, 0x65};
  uint8_t bytesprops6[] = {0x5f, 0xe4, 0xc0, 0xd9};
  uint8_t bytesprops5[] = {0x15, 0x88, 0x1f, 0x30, 0x1a, 0x0,  0x88, 0x10, 0x1e, 0xc8, 0x54, 0x40, 0xf,
                           0x8f, 0x9b, 0xd7, 0x9b, 0x15, 0x44, 0x4e, 0x59, 0x4a, 0xda, 0x9a, 0x63};
  uint8_t bytesprops8[] = {0xfe, 0x10, 0x41, 0xd3, 0xbe, 0x89, 0x79, 0x34, 0xc3, 0x67, 0x2,  0x7b, 0x17, 0xd6,
                           0x60, 0xa2, 0x12, 0x62, 0x63, 0xc2, 0x27, 0x3f, 0xf1, 0x33, 0x54, 0xbc, 0xdf, 0x72};
  uint8_t bytesprops7[] = {0x9a, 0x58, 0xea, 0xa, 0x52, 0x8f, 0x23, 0xd3, 0x1f, 0x4b, 0x38, 0x8, 0xe, 0xe, 0x58, 0xe1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23490}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12380}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 597}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21211}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25170}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22278}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28830}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1362}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14605}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19280}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3796}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops5}, .v = {4, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops7}, .v = {28, (char*)&bytesprops8}}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "\222\145Cc\220\210\226\245x\246qst\249\156\SUB\226\132\137Ys\173<s\ESCj\153-\199", _pubPktID = 0, _pubBody =
// "\164\STXh", _pubProps = [PropRetainAvailable 232,PropSessionExpiryInterval 23490,PropServerKeepAlive
// 12380,PropReceiveMaximum 597,PropMaximumPacketSize 21211,PropWillDelayInterval 25170,PropMaximumPacketSize
// 22278,PropResponseInformation
// "\170_\160\158\236\205C.\176\130\200O*\212h\147#\ESC\192,_N\180WN\133\225",PropServerKeepAlive
// 28830,PropRequestProblemInformation 167,PropMessageExpiryInterval 1362,PropSessionExpiryInterval
// 14605,PropCorrelationData
// "(P\230\US\243\253c$R\203dT3\ETX\180'\DC4m\244r\254\SUB\165\EOT\NUL\250\140",PropAssignedClientIdentifier
// "\251O\203rdp\188\152\SO\CAN.\242|[\ETB",PropPayloadFormatIndicator 76,PropAssignedClientIdentifier
// "H\234\170\r\221S\142lE\132T]\227T5\181",PropTopicAliasMaximum 19280,PropServerKeepAlive
// 3796,PropAssignedClientIdentifier "T\DLE3/>\176\137-<X\RS\141Ay\195o{\213\DC4ve",PropUserProperty
// "\NAK\136\US0\SUB\NUL\136\DLE\RS\200T@\SI\143\155\215\155\NAKDNYJ\218\154c" "_\228\192\217",PropUserProperty
// "\154X\234\nR\143#\211\USK8\b\SO\SOX\225"
// "\254\DLEA\211\190\137y4\195g\STX{\ETB\214`\162\DC2bc\194'?\241\&3T\188\223r"]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {
      0x38, 0xa3, 0x2,  0x0,  0x1d, 0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5, 0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9,
      0x9c, 0x1a, 0xe2, 0x84, 0x89, 0x59, 0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7, 0xff, 0x1,  0x25, 0xe8,
      0x11, 0x0,  0x0,  0x5b, 0xc2, 0x13, 0x30, 0x5c, 0x21, 0x2,  0x55, 0x27, 0x0,  0x0,  0x52, 0xdb, 0x18, 0x0,  0x0,
      0x62, 0x52, 0x27, 0x0,  0x0,  0x57, 0x6,  0x1a, 0x0,  0x1b, 0xaa, 0x5f, 0xa0, 0x9e, 0xec, 0xcd, 0x43, 0x2e, 0xb0,
      0x82, 0xc8, 0x4f, 0x2a, 0xd4, 0x68, 0x93, 0x23, 0x1b, 0xc0, 0x2c, 0x5f, 0x4e, 0xb4, 0x57, 0x4e, 0x85, 0xe1, 0x13,
      0x70, 0x9e, 0x17, 0xa7, 0x2,  0x0,  0x0,  0x5,  0x52, 0x11, 0x0,  0x0,  0x39, 0xd,  0x9,  0x0,  0x1b, 0x28, 0x50,
      0xe6, 0x1f, 0xf3, 0xfd, 0x63, 0x24, 0x52, 0xcb, 0x64, 0x54, 0x33, 0x3,  0xb4, 0x27, 0x14, 0x6d, 0xf4, 0x72, 0xfe,
      0x1a, 0xa5, 0x4,  0x0,  0xfa, 0x8c, 0x12, 0x0,  0xf,  0xfb, 0x4f, 0xcb, 0x72, 0x64, 0x70, 0xbc, 0x98, 0xe,  0x18,
      0x2e, 0xf2, 0x7c, 0x5b, 0x17, 0x1,  0x4c, 0x12, 0x0,  0x10, 0x48, 0xea, 0xaa, 0xd,  0xdd, 0x53, 0x8e, 0x6c, 0x45,
      0x84, 0x54, 0x5d, 0xe3, 0x54, 0x35, 0xb5, 0x22, 0x4b, 0x50, 0x13, 0xe,  0xd4, 0x12, 0x0,  0x15, 0x54, 0x10, 0x33,
      0x2f, 0x3e, 0xb0, 0x89, 0x2d, 0x3c, 0x58, 0x1e, 0x8d, 0x41, 0x79, 0xc3, 0x6f, 0x7b, 0xd5, 0x14, 0x76, 0x65, 0x26,
      0x0,  0x19, 0x15, 0x88, 0x1f, 0x30, 0x1a, 0x0,  0x88, 0x10, 0x1e, 0xc8, 0x54, 0x40, 0xf,  0x8f, 0x9b, 0xd7, 0x9b,
      0x15, 0x44, 0x4e, 0x59, 0x4a, 0xda, 0x9a, 0x63, 0x0,  0x4,  0x5f, 0xe4, 0xc0, 0xd9, 0x26, 0x0,  0x10, 0x9a, 0x58,
      0xea, 0xa,  0x52, 0x8f, 0x23, 0xd3, 0x1f, 0x4b, 0x38, 0x8,  0xe,  0xe,  0x58, 0xe1, 0x0,  0x1c, 0xfe, 0x10, 0x41,
      0xd3, 0xbe, 0x89, 0x79, 0x34, 0xc3, 0x67, 0x2,  0x7b, 0x17, 0xd6, 0x60, 0xa2, 0x12, 0x62, 0x63, 0xc2, 0x27, 0x3f,
      0xf1, 0x33, 0x54, 0xbc, 0xdf, 0x72, 0xa4, 0x2,  0x68};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xde, 0x91, 0x43, 0x63, 0xdc, 0xd2, 0xe2, 0xf5, 0x78, 0xf6, 0x71, 0x73, 0x74, 0xf9, 0x9c,
                               0x1a, 0xe2, 0x84, 0x89, 0x59, 0x73, 0xad, 0x3c, 0x73, 0x1b, 0x6a, 0x99, 0x2d, 0xc7};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa4, 0x2, 0x68};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = ",f", _pubPktID = 3323, _pubBody =
// "\130\170\152", _pubProps = [PropRetainAvailable 140,PropServerKeepAlive 6795,PropReceiveMaximum
// 17419,PropReasonString "\149",PropUserProperty "\172WQ\136i\193\150\253\185z\190\187\231Z\fn\RS\161\147\165
// \186\&0\172\&7\164\228p\240\DC1" "/\SYN\163",PropServerReference "\149\ACKx\243_",PropAuthenticationData
// "\184\166\234,$\137\154Q",PropReceiveMaximum 29340,PropSessionExpiryInterval 4083,PropMaximumPacketSize
// 6103,PropServerReference
// "\233\214B\196'8\203\143=\215g\182\136\181\243K\218\ETB+\129\134v\SUBug}Dz^",PropResponseTopic
// "\SIg\r\141f\163J\DLEtR'\170\129\222\207\245\144\ETX\223=\227",PropTopicAliasMaximum 2774,PropUserProperty "\ETX"
// "\ETB\161\194\254\224\136\DEL\212\133\EOTif\249\234n\189\234\205h\EOT\196\134\&5\190\RS!O",PropSubscriptionIdentifierAvailable
// 229,PropTopicAliasMaximum 31358,PropMaximumQoS 169]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {0x3a, 0xc0, 0x1,  0x0,  0x2,  0x2c, 0x66, 0xc,  0xfb, 0xb5, 0x1,  0x25, 0x8c, 0x13, 0x1a, 0x8b, 0x21,
                   0x44, 0xb,  0x1f, 0x0,  0x1,  0x95, 0x26, 0x0,  0x1e, 0xac, 0x57, 0x51, 0x88, 0x69, 0xc1, 0x96, 0xfd,
                   0xb9, 0x7a, 0xbe, 0xbb, 0xe7, 0x5a, 0xc,  0x6e, 0x1e, 0xa1, 0x93, 0xa5, 0x20, 0xba, 0x30, 0xac, 0x37,
                   0xa4, 0xe4, 0x70, 0xf0, 0x11, 0x0,  0x3,  0x2f, 0x16, 0xa3, 0x1c, 0x0,  0x5,  0x95, 0x6,  0x78, 0xf3,
                   0x5f, 0x16, 0x0,  0x8,  0xb8, 0xa6, 0xea, 0x2c, 0x24, 0x89, 0x9a, 0x51, 0x21, 0x72, 0x9c, 0x11, 0x0,
                   0x0,  0xf,  0xf3, 0x27, 0x0,  0x0,  0x17, 0xd7, 0x1c, 0x0,  0x1d, 0xe9, 0xd6, 0x42, 0xc4, 0x27, 0x38,
                   0xcb, 0x8f, 0x3d, 0xd7, 0x67, 0xb6, 0x88, 0xb5, 0xf3, 0x4b, 0xda, 0x17, 0x2b, 0x81, 0x86, 0x76, 0x1a,
                   0x75, 0x67, 0x7d, 0x44, 0x7a, 0x5e, 0x8,  0x0,  0x15, 0xf,  0x67, 0xd,  0x8d, 0x66, 0xa3, 0x4a, 0x10,
                   0x74, 0x52, 0x27, 0xaa, 0x81, 0xde, 0xcf, 0xf5, 0x90, 0x3,  0xdf, 0x3d, 0xe3, 0x22, 0xa,  0xd6, 0x26,
                   0x0,  0x1,  0x3,  0x0,  0x1b, 0x17, 0xa1, 0xc2, 0xfe, 0xe0, 0x88, 0x7f, 0xd4, 0x85, 0x4,  0x69, 0x66,
                   0xf9, 0xea, 0x6e, 0xbd, 0xea, 0xcd, 0x68, 0x4,  0xc4, 0x86, 0x35, 0xbe, 0x1e, 0x21, 0x4f, 0x29, 0xe5,
                   0x22, 0x7a, 0x7e, 0x24, 0xa9, 0x82, 0xaa, 0x98};

  uint8_t buf[205] = {0};
  uint8_t topic_bytes[] = {0x2c, 0x66};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x82, 0xaa, 0x98};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0x95};
  uint8_t bytesprops2[] = {0x2f, 0x16, 0xa3};
  uint8_t bytesprops1[] = {0xac, 0x57, 0x51, 0x88, 0x69, 0xc1, 0x96, 0xfd, 0xb9, 0x7a, 0xbe, 0xbb, 0xe7, 0x5a, 0xc,
                           0x6e, 0x1e, 0xa1, 0x93, 0xa5, 0x20, 0xba, 0x30, 0xac, 0x37, 0xa4, 0xe4, 0x70, 0xf0, 0x11};
  uint8_t bytesprops3[] = {0x95, 0x6, 0x78, 0xf3, 0x5f};
  uint8_t bytesprops4[] = {0xb8, 0xa6, 0xea, 0x2c, 0x24, 0x89, 0x9a, 0x51};
  uint8_t bytesprops5[] = {0xe9, 0xd6, 0x42, 0xc4, 0x27, 0x38, 0xcb, 0x8f, 0x3d, 0xd7, 0x67, 0xb6, 0x88, 0xb5, 0xf3,
                           0x4b, 0xda, 0x17, 0x2b, 0x81, 0x86, 0x76, 0x1a, 0x75, 0x67, 0x7d, 0x44, 0x7a, 0x5e};
  uint8_t bytesprops6[] = {0xf,  0x67, 0xd,  0x8d, 0x66, 0xa3, 0x4a, 0x10, 0x74, 0x52, 0x27,
                           0xaa, 0x81, 0xde, 0xcf, 0xf5, 0x90, 0x3,  0xdf, 0x3d, 0xe3};
  uint8_t bytesprops8[] = {0x17, 0xa1, 0xc2, 0xfe, 0xe0, 0x88, 0x7f, 0xd4, 0x85, 0x4,  0x69, 0x66, 0xf9, 0xea,
                           0x6e, 0xbd, 0xea, 0xcd, 0x68, 0x4,  0xc4, 0x86, 0x35, 0xbe, 0x1e, 0x21, 0x4f};
  uint8_t bytesprops7[] = {0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6795}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17419}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops1}, .v = {3, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29340}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4083}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6103}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2774}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops7}, .v = {27, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31358}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 169}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 3323, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = ",f", _pubPktID = 3323, _pubBody =
// "\130\170\152", _pubProps = [PropRetainAvailable 140,PropServerKeepAlive 6795,PropReceiveMaximum
// 17419,PropReasonString "\149",PropUserProperty "\172WQ\136i\193\150\253\185z\190\187\231Z\fn\RS\161\147\165
// \186\&0\172\&7\164\228p\240\DC1" "/\SYN\163",PropServerReference "\149\ACKx\243_",PropAuthenticationData
// "\184\166\234,$\137\154Q",PropReceiveMaximum 29340,PropSessionExpiryInterval 4083,PropMaximumPacketSize
// 6103,PropServerReference
// "\233\214B\196'8\203\143=\215g\182\136\181\243K\218\ETB+\129\134v\SUBug}Dz^",PropResponseTopic
// "\SIg\r\141f\163J\DLEtR'\170\129\222\207\245\144\ETX\223=\227",PropTopicAliasMaximum 2774,PropUserProperty "\ETX"
// "\ETB\161\194\254\224\136\DEL\212\133\EOTif\249\234n\189\234\205h\EOT\196\134\&5\190\RS!O",PropSubscriptionIdentifierAvailable
// 229,PropTopicAliasMaximum 31358,PropMaximumQoS 169]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {0x3a, 0xc0, 0x1,  0x0,  0x2,  0x2c, 0x66, 0xc,  0xfb, 0xb5, 0x1,  0x25, 0x8c, 0x13, 0x1a, 0x8b, 0x21,
                   0x44, 0xb,  0x1f, 0x0,  0x1,  0x95, 0x26, 0x0,  0x1e, 0xac, 0x57, 0x51, 0x88, 0x69, 0xc1, 0x96, 0xfd,
                   0xb9, 0x7a, 0xbe, 0xbb, 0xe7, 0x5a, 0xc,  0x6e, 0x1e, 0xa1, 0x93, 0xa5, 0x20, 0xba, 0x30, 0xac, 0x37,
                   0xa4, 0xe4, 0x70, 0xf0, 0x11, 0x0,  0x3,  0x2f, 0x16, 0xa3, 0x1c, 0x0,  0x5,  0x95, 0x6,  0x78, 0xf3,
                   0x5f, 0x16, 0x0,  0x8,  0xb8, 0xa6, 0xea, 0x2c, 0x24, 0x89, 0x9a, 0x51, 0x21, 0x72, 0x9c, 0x11, 0x0,
                   0x0,  0xf,  0xf3, 0x27, 0x0,  0x0,  0x17, 0xd7, 0x1c, 0x0,  0x1d, 0xe9, 0xd6, 0x42, 0xc4, 0x27, 0x38,
                   0xcb, 0x8f, 0x3d, 0xd7, 0x67, 0xb6, 0x88, 0xb5, 0xf3, 0x4b, 0xda, 0x17, 0x2b, 0x81, 0x86, 0x76, 0x1a,
                   0x75, 0x67, 0x7d, 0x44, 0x7a, 0x5e, 0x8,  0x0,  0x15, 0xf,  0x67, 0xd,  0x8d, 0x66, 0xa3, 0x4a, 0x10,
                   0x74, 0x52, 0x27, 0xaa, 0x81, 0xde, 0xcf, 0xf5, 0x90, 0x3,  0xdf, 0x3d, 0xe3, 0x22, 0xa,  0xd6, 0x26,
                   0x0,  0x1,  0x3,  0x0,  0x1b, 0x17, 0xa1, 0xc2, 0xfe, 0xe0, 0x88, 0x7f, 0xd4, 0x85, 0x4,  0x69, 0x66,
                   0xf9, 0xea, 0x6e, 0xbd, 0xea, 0xcd, 0x68, 0x4,  0xc4, 0x86, 0x35, 0xbe, 0x1e, 0x21, 0x4f, 0x29, 0xe5,
                   0x22, 0x7a, 0x7e, 0x24, 0xa9, 0x82, 0xaa, 0x98};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2c, 0x66};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x82, 0xaa, 0x98};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 3323);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "e\226\145", _pubPktID = 0, _pubBody =
// "\225?\246P\197\165t\243\173C\134\185", _pubProps = [PropUserProperty
// "\DLE8;\201\154\212Cf\233\255=\204\229>\145\245\166\144\EM\DC2B\DC4v< \GSvl"
// "\191Gn\251\a\EOTYm\220\SI|\213b\164\&1P\180\251\191\130\239\SYNv?^\159\189\180\144",PropPayloadFormatIndicator
// 100,PropAssignedClientIdentifier "\SIOT\211\182\253;r\SO\203",PropServerKeepAlive 24019,PropContentType
// "\209!\230\188\166< >e\n\233n\218\FS\212\205K7K\\H]\148X)v",PropAuthenticationMethod
// "\210e-\150\131\DC3\237\144\251}\179\141\ETB\151\184\b\146\202O|T\ACKOk\167\130xU\DC1\134",PropRequestResponseInformation
// 124,PropSessionExpiryInterval 27494,PropServerKeepAlive 22183,PropMessageExpiryInterval 32728,PropServerKeepAlive
// 31098,PropAuthenticationMethod "\153\210\196\v\200\163[/\212\155d9\239",PropSessionExpiryInterval
// 32275,PropContentType "\193\163\FS\205\133\&2\191\249;\v",PropSubscriptionIdentifier 29,PropAssignedClientIdentifier
// "}\SOH\DC2(\ESC\227\175\a\174\185\165\186",PropCorrelationData
// "\ENQ\238\250\159\219\247og\162\198$\NAKV\SYN\n",PropReceiveMaximum 28998,PropWildcardSubscriptionAvailable
// 146,PropWildcardSubscriptionAvailable 213,PropMaximumPacketSize 7834,PropSharedSubscriptionAvailable
// 250,PropServerKeepAlive 10556,PropReceiveMaximum 19508,PropRequestProblemInformation 187,PropServerReference
// "\246\190\241%\135\228\&2\NAKC\158\187N'\149\235\FS\225\245t\216p\128\132\147\221\206\188",PropSubscriptionIdentifierAvailable
// 115]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {0x39, 0xae, 0x2,  0x0,  0x3,  0x65, 0xe2, 0x91, 0x9b, 0x2,  0x26, 0x0,  0x1c, 0x10, 0x38, 0x3b, 0xc9,
                   0x9a, 0xd4, 0x43, 0x66, 0xe9, 0xff, 0x3d, 0xcc, 0xe5, 0x3e, 0x91, 0xf5, 0xa6, 0x90, 0x19, 0x12, 0x42,
                   0x14, 0x76, 0x3c, 0x20, 0x1d, 0x76, 0x6c, 0x0,  0x1d, 0xbf, 0x47, 0x6e, 0xfb, 0x7,  0x4,  0x59, 0x6d,
                   0xdc, 0xf,  0x7c, 0xd5, 0x62, 0xa4, 0x31, 0x50, 0xb4, 0xfb, 0xbf, 0x82, 0xef, 0x16, 0x76, 0x3f, 0x5e,
                   0x9f, 0xbd, 0xb4, 0x90, 0x1,  0x64, 0x12, 0x0,  0xa,  0xf,  0x4f, 0x54, 0xd3, 0xb6, 0xfd, 0x3b, 0x72,
                   0xe,  0xcb, 0x13, 0x5d, 0xd3, 0x3,  0x0,  0x1a, 0xd1, 0x21, 0xe6, 0xbc, 0xa6, 0x3c, 0x20, 0x3e, 0x65,
                   0xa,  0xe9, 0x6e, 0xda, 0x1c, 0xd4, 0xcd, 0x4b, 0x37, 0x4b, 0x5c, 0x48, 0x5d, 0x94, 0x58, 0x29, 0x76,
                   0x15, 0x0,  0x1e, 0xd2, 0x65, 0x2d, 0x96, 0x83, 0x13, 0xed, 0x90, 0xfb, 0x7d, 0xb3, 0x8d, 0x17, 0x97,
                   0xb8, 0x8,  0x92, 0xca, 0x4f, 0x7c, 0x54, 0x6,  0x4f, 0x6b, 0xa7, 0x82, 0x78, 0x55, 0x11, 0x86, 0x19,
                   0x7c, 0x11, 0x0,  0x0,  0x6b, 0x66, 0x13, 0x56, 0xa7, 0x2,  0x0,  0x0,  0x7f, 0xd8, 0x13, 0x79, 0x7a,
                   0x15, 0x0,  0xd,  0x99, 0xd2, 0xc4, 0xb,  0xc8, 0xa3, 0x5b, 0x2f, 0xd4, 0x9b, 0x64, 0x39, 0xef, 0x11,
                   0x0,  0x0,  0x7e, 0x13, 0x3,  0x0,  0xa,  0xc1, 0xa3, 0x1c, 0xcd, 0x85, 0x32, 0xbf, 0xf9, 0x3b, 0xb,
                   0xb,  0x1d, 0x12, 0x0,  0xc,  0x7d, 0x1,  0x12, 0x28, 0x1b, 0xe3, 0xaf, 0x7,  0xae, 0xb9, 0xa5, 0xba,
                   0x9,  0x0,  0xf,  0x5,  0xee, 0xfa, 0x9f, 0xdb, 0xf7, 0x6f, 0x67, 0xa2, 0xc6, 0x24, 0x15, 0x56, 0x16,
                   0xa,  0x21, 0x71, 0x46, 0x28, 0x92, 0x28, 0xd5, 0x27, 0x0,  0x0,  0x1e, 0x9a, 0x2a, 0xfa, 0x13, 0x29,
                   0x3c, 0x21, 0x4c, 0x34, 0x17, 0xbb, 0x1c, 0x0,  0x1b, 0xf6, 0xbe, 0xf1, 0x25, 0x87, 0xe4, 0x32, 0x15,
                   0x43, 0x9e, 0xbb, 0x4e, 0x27, 0x95, 0xeb, 0x1c, 0xe1, 0xf5, 0x74, 0xd8, 0x70, 0x80, 0x84, 0x93, 0xdd,
                   0xce, 0xbc, 0x29, 0x73, 0xe1, 0x3f, 0xf6, 0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};

  uint8_t buf[315] = {0};
  uint8_t topic_bytes[] = {0x65, 0xe2, 0x91};
  lwmqtt_string_t topic = {3, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xe1, 0x3f, 0xf6, 0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops1[] = {0xbf, 0x47, 0x6e, 0xfb, 0x7,  0x4,  0x59, 0x6d, 0xdc, 0xf,  0x7c, 0xd5, 0x62, 0xa4, 0x31,
                           0x50, 0xb4, 0xfb, 0xbf, 0x82, 0xef, 0x16, 0x76, 0x3f, 0x5e, 0x9f, 0xbd, 0xb4, 0x90};
  uint8_t bytesprops0[] = {0x10, 0x38, 0x3b, 0xc9, 0x9a, 0xd4, 0x43, 0x66, 0xe9, 0xff, 0x3d, 0xcc, 0xe5, 0x3e,
                           0x91, 0xf5, 0xa6, 0x90, 0x19, 0x12, 0x42, 0x14, 0x76, 0x3c, 0x20, 0x1d, 0x76, 0x6c};
  uint8_t bytesprops2[] = {0xf, 0x4f, 0x54, 0xd3, 0xb6, 0xfd, 0x3b, 0x72, 0xe, 0xcb};
  uint8_t bytesprops3[] = {0xd1, 0x21, 0xe6, 0xbc, 0xa6, 0x3c, 0x20, 0x3e, 0x65, 0xa,  0xe9, 0x6e, 0xda,
                           0x1c, 0xd4, 0xcd, 0x4b, 0x37, 0x4b, 0x5c, 0x48, 0x5d, 0x94, 0x58, 0x29, 0x76};
  uint8_t bytesprops4[] = {0xd2, 0x65, 0x2d, 0x96, 0x83, 0x13, 0xed, 0x90, 0xfb, 0x7d, 0xb3, 0x8d, 0x17, 0x97, 0xb8,
                           0x8,  0x92, 0xca, 0x4f, 0x7c, 0x54, 0x6,  0x4f, 0x6b, 0xa7, 0x82, 0x78, 0x55, 0x11, 0x86};
  uint8_t bytesprops5[] = {0x99, 0xd2, 0xc4, 0xb, 0xc8, 0xa3, 0x5b, 0x2f, 0xd4, 0x9b, 0x64, 0x39, 0xef};
  uint8_t bytesprops6[] = {0xc1, 0xa3, 0x1c, 0xcd, 0x85, 0x32, 0xbf, 0xf9, 0x3b, 0xb};
  uint8_t bytesprops7[] = {0x7d, 0x1, 0x12, 0x28, 0x1b, 0xe3, 0xaf, 0x7, 0xae, 0xb9, 0xa5, 0xba};
  uint8_t bytesprops8[] = {0x5, 0xee, 0xfa, 0x9f, 0xdb, 0xf7, 0x6f, 0x67, 0xa2, 0xc6, 0x24, 0x15, 0x56, 0x16, 0xa};
  uint8_t bytesprops9[] = {0xf6, 0xbe, 0xf1, 0x25, 0x87, 0xe4, 0x32, 0x15, 0x43, 0x9e, 0xbb, 0x4e, 0x27, 0x95,
                           0xeb, 0x1c, 0xe1, 0xf5, 0x74, 0xd8, 0x70, 0x80, 0x84, 0x93, 0xdd, 0xce, 0xbc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {28, (char*)&bytesprops0}, .v = {29, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24019}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27494}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22183}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32728}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31098}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32275}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 29}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28998}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7834}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10556}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19508}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 115}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "e\226\145", _pubPktID = 0, _pubBody =
// "\225?\246P\197\165t\243\173C\134\185", _pubProps = [PropUserProperty
// "\DLE8;\201\154\212Cf\233\255=\204\229>\145\245\166\144\EM\DC2B\DC4v< \GSvl"
// "\191Gn\251\a\EOTYm\220\SI|\213b\164\&1P\180\251\191\130\239\SYNv?^\159\189\180\144",PropPayloadFormatIndicator
// 100,PropAssignedClientIdentifier "\SIOT\211\182\253;r\SO\203",PropServerKeepAlive 24019,PropContentType
// "\209!\230\188\166< >e\n\233n\218\FS\212\205K7K\\H]\148X)v",PropAuthenticationMethod
// "\210e-\150\131\DC3\237\144\251}\179\141\ETB\151\184\b\146\202O|T\ACKOk\167\130xU\DC1\134",PropRequestResponseInformation
// 124,PropSessionExpiryInterval 27494,PropServerKeepAlive 22183,PropMessageExpiryInterval 32728,PropServerKeepAlive
// 31098,PropAuthenticationMethod "\153\210\196\v\200\163[/\212\155d9\239",PropSessionExpiryInterval
// 32275,PropContentType "\193\163\FS\205\133\&2\191\249;\v",PropSubscriptionIdentifier 29,PropAssignedClientIdentifier
// "}\SOH\DC2(\ESC\227\175\a\174\185\165\186",PropCorrelationData
// "\ENQ\238\250\159\219\247og\162\198$\NAKV\SYN\n",PropReceiveMaximum 28998,PropWildcardSubscriptionAvailable
// 146,PropWildcardSubscriptionAvailable 213,PropMaximumPacketSize 7834,PropSharedSubscriptionAvailable
// 250,PropServerKeepAlive 10556,PropReceiveMaximum 19508,PropRequestProblemInformation 187,PropServerReference
// "\246\190\241%\135\228\&2\NAKC\158\187N'\149\235\FS\225\245t\216p\128\132\147\221\206\188",PropSubscriptionIdentifierAvailable
// 115]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {0x39, 0xae, 0x2,  0x0,  0x3,  0x65, 0xe2, 0x91, 0x9b, 0x2,  0x26, 0x0,  0x1c, 0x10, 0x38, 0x3b, 0xc9,
                   0x9a, 0xd4, 0x43, 0x66, 0xe9, 0xff, 0x3d, 0xcc, 0xe5, 0x3e, 0x91, 0xf5, 0xa6, 0x90, 0x19, 0x12, 0x42,
                   0x14, 0x76, 0x3c, 0x20, 0x1d, 0x76, 0x6c, 0x0,  0x1d, 0xbf, 0x47, 0x6e, 0xfb, 0x7,  0x4,  0x59, 0x6d,
                   0xdc, 0xf,  0x7c, 0xd5, 0x62, 0xa4, 0x31, 0x50, 0xb4, 0xfb, 0xbf, 0x82, 0xef, 0x16, 0x76, 0x3f, 0x5e,
                   0x9f, 0xbd, 0xb4, 0x90, 0x1,  0x64, 0x12, 0x0,  0xa,  0xf,  0x4f, 0x54, 0xd3, 0xb6, 0xfd, 0x3b, 0x72,
                   0xe,  0xcb, 0x13, 0x5d, 0xd3, 0x3,  0x0,  0x1a, 0xd1, 0x21, 0xe6, 0xbc, 0xa6, 0x3c, 0x20, 0x3e, 0x65,
                   0xa,  0xe9, 0x6e, 0xda, 0x1c, 0xd4, 0xcd, 0x4b, 0x37, 0x4b, 0x5c, 0x48, 0x5d, 0x94, 0x58, 0x29, 0x76,
                   0x15, 0x0,  0x1e, 0xd2, 0x65, 0x2d, 0x96, 0x83, 0x13, 0xed, 0x90, 0xfb, 0x7d, 0xb3, 0x8d, 0x17, 0x97,
                   0xb8, 0x8,  0x92, 0xca, 0x4f, 0x7c, 0x54, 0x6,  0x4f, 0x6b, 0xa7, 0x82, 0x78, 0x55, 0x11, 0x86, 0x19,
                   0x7c, 0x11, 0x0,  0x0,  0x6b, 0x66, 0x13, 0x56, 0xa7, 0x2,  0x0,  0x0,  0x7f, 0xd8, 0x13, 0x79, 0x7a,
                   0x15, 0x0,  0xd,  0x99, 0xd2, 0xc4, 0xb,  0xc8, 0xa3, 0x5b, 0x2f, 0xd4, 0x9b, 0x64, 0x39, 0xef, 0x11,
                   0x0,  0x0,  0x7e, 0x13, 0x3,  0x0,  0xa,  0xc1, 0xa3, 0x1c, 0xcd, 0x85, 0x32, 0xbf, 0xf9, 0x3b, 0xb,
                   0xb,  0x1d, 0x12, 0x0,  0xc,  0x7d, 0x1,  0x12, 0x28, 0x1b, 0xe3, 0xaf, 0x7,  0xae, 0xb9, 0xa5, 0xba,
                   0x9,  0x0,  0xf,  0x5,  0xee, 0xfa, 0x9f, 0xdb, 0xf7, 0x6f, 0x67, 0xa2, 0xc6, 0x24, 0x15, 0x56, 0x16,
                   0xa,  0x21, 0x71, 0x46, 0x28, 0x92, 0x28, 0xd5, 0x27, 0x0,  0x0,  0x1e, 0x9a, 0x2a, 0xfa, 0x13, 0x29,
                   0x3c, 0x21, 0x4c, 0x34, 0x17, 0xbb, 0x1c, 0x0,  0x1b, 0xf6, 0xbe, 0xf1, 0x25, 0x87, 0xe4, 0x32, 0x15,
                   0x43, 0x9e, 0xbb, 0x4e, 0x27, 0x95, 0xeb, 0x1c, 0xe1, 0xf5, 0x74, 0xd8, 0x70, 0x80, 0x84, 0x93, 0xdd,
                   0xce, 0xbc, 0x29, 0x73, 0xe1, 0x3f, 0xf6, 0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x65, 0xe2, 0x91};
  lwmqtt_string_t exp_topic = {3, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe1, 0x3f, 0xf6, 0x50, 0xc5, 0xa5, 0x74, 0xf3, 0xad, 0x43, 0x86, 0xb9};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 3);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\191", _pubPktID = 26120,
// _pubBody = "_e(\238\187\252\234\241\201<!\SOHg\220\DEL", _pubProps = [PropRequestProblemInformation
// 70,PropWildcardSubscriptionAvailable 150,PropTopicAlias 32023,PropReceiveMaximum 7287,PropRequestProblemInformation
// 82,PropAuthenticationMethod "=\220",PropSharedSubscriptionAvailable 245,PropReceiveMaximum
// 9495,PropAuthenticationData
// "\218\183\DC2\SOH\b\240\182\135\217\195_q.\199\242C\177\251\226\187\&0\148cCl\168\DC4\232\&6\185",PropRequestProblemInformation
// 30,PropPayloadFormatIndicator 137,PropMessageExpiryInterval 7872,PropSubscriptionIdentifier
// 26,PropSessionExpiryInterval 31493,PropResponseTopic
// "\179Y\173;m\SOH\199\242\SUB\222h\213\&9\249.\192\EOT5\159\&2\DC1\204#\158:\243\f\213",PropTopicAlias
// 32427,PropReceiveMaximum 28524,PropMaximumPacketSize 20758,PropSharedSubscriptionAvailable
// 78,PropRequestResponseInformation 141,PropMessageExpiryInterval 22385,PropMaximumQoS 36,PropAuthenticationMethod
// "x1pL<\138\134\STX\161\RS.fw\237\192\181Y\DC3_\247W[\ETBL ",PropMaximumPacketSize 29175,PropResponseTopic
// "\173\rF",PropReasonString "\199\161\&6\151\178Pj\128\248\&0\229\166\147/\137\159\\\SI\148\&7"]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x3d, 0xd1, 0x1,  0x0,  0x2,  0xff, 0xbf, 0x66, 0x8,  0xba, 0x1,  0x17, 0x46, 0x28, 0x96, 0x23, 0x7d,
                   0x17, 0x21, 0x1c, 0x77, 0x17, 0x52, 0x15, 0x0,  0x2,  0x3d, 0xdc, 0x2a, 0xf5, 0x21, 0x25, 0x17, 0x16,
                   0x0,  0x1e, 0xda, 0xb7, 0x12, 0x1,  0x8,  0xf0, 0xb6, 0x87, 0xd9, 0xc3, 0x5f, 0x71, 0x2e, 0xc7, 0xf2,
                   0x43, 0xb1, 0xfb, 0xe2, 0xbb, 0x30, 0x94, 0x63, 0x43, 0x6c, 0xa8, 0x14, 0xe8, 0x36, 0xb9, 0x17, 0x1e,
                   0x1,  0x89, 0x2,  0x0,  0x0,  0x1e, 0xc0, 0xb,  0x1a, 0x11, 0x0,  0x0,  0x7b, 0x5,  0x8,  0x0,  0x1c,
                   0xb3, 0x59, 0xad, 0x3b, 0x6d, 0x1,  0xc7, 0xf2, 0x1a, 0xde, 0x68, 0xd5, 0x39, 0xf9, 0x2e, 0xc0, 0x4,
                   0x35, 0x9f, 0x32, 0x11, 0xcc, 0x23, 0x9e, 0x3a, 0xf3, 0xc,  0xd5, 0x23, 0x7e, 0xab, 0x21, 0x6f, 0x6c,
                   0x27, 0x0,  0x0,  0x51, 0x16, 0x2a, 0x4e, 0x19, 0x8d, 0x2,  0x0,  0x0,  0x57, 0x71, 0x24, 0x24, 0x15,
                   0x0,  0x19, 0x78, 0x31, 0x70, 0x4c, 0x3c, 0x8a, 0x86, 0x2,  0xa1, 0x1e, 0x2e, 0x66, 0x77, 0xed, 0xc0,
                   0xb5, 0x59, 0x13, 0x5f, 0xf7, 0x57, 0x5b, 0x17, 0x4c, 0x20, 0x27, 0x0,  0x0,  0x71, 0xf7, 0x8,  0x0,
                   0x3,  0xad, 0xd,  0x46, 0x1f, 0x0,  0x14, 0xc7, 0xa1, 0x36, 0x97, 0xb2, 0x50, 0x6a, 0x80, 0xf8, 0x30,
                   0xe5, 0xa6, 0x93, 0x2f, 0x89, 0x9f, 0x5c, 0xf,  0x94, 0x37, 0x5f, 0x65, 0x28, 0xee, 0xbb, 0xfc, 0xea,
                   0xf1, 0xc9, 0x3c, 0x21, 0x1,  0x67, 0xdc, 0x7f};

  uint8_t buf[222] = {0};
  uint8_t topic_bytes[] = {0xff, 0xbf};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5f, 0x65, 0x28, 0xee, 0xbb, 0xfc, 0xea, 0xf1, 0xc9, 0x3c, 0x21, 0x1, 0x67, 0xdc, 0x7f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 15;

  uint8_t bytesprops0[] = {0x3d, 0xdc};
  uint8_t bytesprops1[] = {0xda, 0xb7, 0x12, 0x1,  0x8,  0xf0, 0xb6, 0x87, 0xd9, 0xc3, 0x5f, 0x71, 0x2e, 0xc7, 0xf2,
                           0x43, 0xb1, 0xfb, 0xe2, 0xbb, 0x30, 0x94, 0x63, 0x43, 0x6c, 0xa8, 0x14, 0xe8, 0x36, 0xb9};
  uint8_t bytesprops2[] = {0xb3, 0x59, 0xad, 0x3b, 0x6d, 0x1,  0xc7, 0xf2, 0x1a, 0xde, 0x68, 0xd5, 0x39, 0xf9,
                           0x2e, 0xc0, 0x4,  0x35, 0x9f, 0x32, 0x11, 0xcc, 0x23, 0x9e, 0x3a, 0xf3, 0xc,  0xd5};
  uint8_t bytesprops3[] = {0x78, 0x31, 0x70, 0x4c, 0x3c, 0x8a, 0x86, 0x2,  0xa1, 0x1e, 0x2e, 0x66, 0x77,
                           0xed, 0xc0, 0xb5, 0x59, 0x13, 0x5f, 0xf7, 0x57, 0x5b, 0x17, 0x4c, 0x20};
  uint8_t bytesprops4[] = {0xad, 0xd, 0x46};
  uint8_t bytesprops5[] = {0xc7, 0xa1, 0x36, 0x97, 0xb2, 0x50, 0x6a, 0x80, 0xf8, 0x30,
                           0xe5, 0xa6, 0x93, 0x2f, 0x89, 0x9f, 0x5c, 0xf,  0x94, 0x37};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32023}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7287}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9495}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7872}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 26}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31493}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32427}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28524}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20758}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22385}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29175}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 26120, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\255\191", _pubPktID = 26120,
// _pubBody = "_e(\238\187\252\234\241\201<!\SOHg\220\DEL", _pubProps = [PropRequestProblemInformation
// 70,PropWildcardSubscriptionAvailable 150,PropTopicAlias 32023,PropReceiveMaximum 7287,PropRequestProblemInformation
// 82,PropAuthenticationMethod "=\220",PropSharedSubscriptionAvailable 245,PropReceiveMaximum
// 9495,PropAuthenticationData
// "\218\183\DC2\SOH\b\240\182\135\217\195_q.\199\242C\177\251\226\187\&0\148cCl\168\DC4\232\&6\185",PropRequestProblemInformation
// 30,PropPayloadFormatIndicator 137,PropMessageExpiryInterval 7872,PropSubscriptionIdentifier
// 26,PropSessionExpiryInterval 31493,PropResponseTopic
// "\179Y\173;m\SOH\199\242\SUB\222h\213\&9\249.\192\EOT5\159\&2\DC1\204#\158:\243\f\213",PropTopicAlias
// 32427,PropReceiveMaximum 28524,PropMaximumPacketSize 20758,PropSharedSubscriptionAvailable
// 78,PropRequestResponseInformation 141,PropMessageExpiryInterval 22385,PropMaximumQoS 36,PropAuthenticationMethod
// "x1pL<\138\134\STX\161\RS.fw\237\192\181Y\DC3_\247W[\ETBL ",PropMaximumPacketSize 29175,PropResponseTopic
// "\173\rF",PropReasonString "\199\161\&6\151\178Pj\128\248\&0\229\166\147/\137\159\\\SI\148\&7"]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x3d, 0xd1, 0x1,  0x0,  0x2,  0xff, 0xbf, 0x66, 0x8,  0xba, 0x1,  0x17, 0x46, 0x28, 0x96, 0x23, 0x7d,
                   0x17, 0x21, 0x1c, 0x77, 0x17, 0x52, 0x15, 0x0,  0x2,  0x3d, 0xdc, 0x2a, 0xf5, 0x21, 0x25, 0x17, 0x16,
                   0x0,  0x1e, 0xda, 0xb7, 0x12, 0x1,  0x8,  0xf0, 0xb6, 0x87, 0xd9, 0xc3, 0x5f, 0x71, 0x2e, 0xc7, 0xf2,
                   0x43, 0xb1, 0xfb, 0xe2, 0xbb, 0x30, 0x94, 0x63, 0x43, 0x6c, 0xa8, 0x14, 0xe8, 0x36, 0xb9, 0x17, 0x1e,
                   0x1,  0x89, 0x2,  0x0,  0x0,  0x1e, 0xc0, 0xb,  0x1a, 0x11, 0x0,  0x0,  0x7b, 0x5,  0x8,  0x0,  0x1c,
                   0xb3, 0x59, 0xad, 0x3b, 0x6d, 0x1,  0xc7, 0xf2, 0x1a, 0xde, 0x68, 0xd5, 0x39, 0xf9, 0x2e, 0xc0, 0x4,
                   0x35, 0x9f, 0x32, 0x11, 0xcc, 0x23, 0x9e, 0x3a, 0xf3, 0xc,  0xd5, 0x23, 0x7e, 0xab, 0x21, 0x6f, 0x6c,
                   0x27, 0x0,  0x0,  0x51, 0x16, 0x2a, 0x4e, 0x19, 0x8d, 0x2,  0x0,  0x0,  0x57, 0x71, 0x24, 0x24, 0x15,
                   0x0,  0x19, 0x78, 0x31, 0x70, 0x4c, 0x3c, 0x8a, 0x86, 0x2,  0xa1, 0x1e, 0x2e, 0x66, 0x77, 0xed, 0xc0,
                   0xb5, 0x59, 0x13, 0x5f, 0xf7, 0x57, 0x5b, 0x17, 0x4c, 0x20, 0x27, 0x0,  0x0,  0x71, 0xf7, 0x8,  0x0,
                   0x3,  0xad, 0xd,  0x46, 0x1f, 0x0,  0x14, 0xc7, 0xa1, 0x36, 0x97, 0xb2, 0x50, 0x6a, 0x80, 0xf8, 0x30,
                   0xe5, 0xa6, 0x93, 0x2f, 0x89, 0x9f, 0x5c, 0xf,  0x94, 0x37, 0x5f, 0x65, 0x28, 0xee, 0xbb, 0xfc, 0xea,
                   0xf1, 0xc9, 0x3c, 0x21, 0x1,  0x67, 0xdc, 0x7f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xff, 0xbf};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5f, 0x65, 0x28, 0xee, 0xbb, 0xfc, 0xea, 0xf1, 0xc9, 0x3c, 0x21, 0x1, 0x67, 0xdc, 0x7f};
  lwmqtt_string_t exp_body = {15, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 26120);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 15);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 15);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\tz\186\176\196\148\DC1", _pubPktID
// = 10274, _pubBody = "\199\149\244", _pubProps = [PropPayloadFormatIndicator 131]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x3a, 0x11, 0x0,  0x7, 0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94,
                   0x11, 0x28, 0x22, 0x2, 0x1, 0x83, 0xc7, 0x95, 0xf4};

  uint8_t buf[29] = {0};
  uint8_t topic_bytes[] = {0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94, 0x11};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xc7, 0x95, 0xf4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 131}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 10274, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "\tz\186\176\196\148\DC1", _pubPktID
// = 10274, _pubBody = "\199\149\244", _pubProps = [PropPayloadFormatIndicator 131]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x3a, 0x11, 0x0,  0x7, 0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94,
                   0x11, 0x28, 0x22, 0x2, 0x1, 0x83, 0xc7, 0x95, 0xf4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x9, 0x7a, 0xba, 0xb0, 0xc4, 0x94, 0x11};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc7, 0x95, 0xf4};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 10274);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "l\GS\SO\SI\176\NAKT\189\t0b\NUL\154#1", _pubPktID = 0, _pubBody =
// "\180v\132PX\145\222\160?9\205\204\241\168\&5<\235\222\160\\\190Tg\128", _pubProps = [PropResponseTopic
// "A\229\&5\242\b\DC4m\212]6\178\178\210\136WX\n\CAN",PropResponseInformation
// "\132^\\\136\159s\165\140\151o\195\227\170XR\197\247\145\ESC>2F\172\&2\189\\",PropMaximumPacketSize
// 21600,PropMaximumPacketSize 13269,PropRequestProblemInformation 94,PropWillDelayInterval
// 18146,PropRequestResponseInformation 220,PropSubscriptionIdentifierAvailable 112,PropSessionExpiryInterval
// 24193,PropMaximumQoS 254,PropAuthenticationMethod "L\DLE}",PropWildcardSubscriptionAvailable 171,PropResponseTopic
// "\252]\250\240\179\228\t\172\144\226\226\151(\214\156\225\210A\241.\198\DC2o\228W\223o_",PropContentType
// "\160\197\161\150W\179\181\&0b\DLEn\RS(\148ET|G",PropContentType
// "<@M\204\204\166[\SI\182\143\251S5\156\151|\176",PropCorrelationData
// "\189\CAN\EMA\188l\SUB\190",PropResponseInformation "\234f\205j\184j\238\243u\130\238",PropMessageExpiryInterval
// 23833,PropMaximumPacketSize 12844,PropMaximumQoS 135,PropAssignedClientIdentifier
// "\190JnM\190I\187*\213\221\178\168,1\175a\SUB\244\254\192",PropUserProperty
// "\236\ETB\235R\182d\242\184\217\214[>h\210\204\209\f\146\183\185\153\184\"\ESC\234"
// "?\DC4\SOHl\129\&2?L\US\ETX",PropRequestResponseInformation 19,PropWildcardSubscriptionAvailable
// 22,PropAssignedClientIdentifier "\234!ZGR\254\RS\US\183\135\191",PropReasonString
// "\217\141\153!V\187\216\148r\211\ACK\EM\197\183\&6\221&\180\237",PropResponseTopic "en\252!",PropWillDelayInterval
// 6918,PropRequestProblemInformation 173]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x31, 0xe3, 0x2,  0x0,  0xf,  0x6c, 0x1d, 0xe,  0xf,  0xb0, 0x15, 0x54, 0xbd, 0x9,  0x30, 0x62, 0x0,  0x9a, 0x23,
      0x31, 0xb8, 0x2,  0x8,  0x0,  0x12, 0x41, 0xe5, 0x35, 0xf2, 0x8,  0x14, 0x6d, 0xd4, 0x5d, 0x36, 0xb2, 0xb2, 0xd2,
      0x88, 0x57, 0x58, 0xa,  0x18, 0x1a, 0x0,  0x1a, 0x84, 0x5e, 0x5c, 0x88, 0x9f, 0x73, 0xa5, 0x8c, 0x97, 0x6f, 0xc3,
      0xe3, 0xaa, 0x58, 0x52, 0xc5, 0xf7, 0x91, 0x1b, 0x3e, 0x32, 0x46, 0xac, 0x32, 0xbd, 0x5c, 0x27, 0x0,  0x0,  0x54,
      0x60, 0x27, 0x0,  0x0,  0x33, 0xd5, 0x17, 0x5e, 0x18, 0x0,  0x0,  0x46, 0xe2, 0x19, 0xdc, 0x29, 0x70, 0x11, 0x0,
      0x0,  0x5e, 0x81, 0x24, 0xfe, 0x15, 0x0,  0x3,  0x4c, 0x10, 0x7d, 0x28, 0xab, 0x8,  0x0,  0x1c, 0xfc, 0x5d, 0xfa,
      0xf0, 0xb3, 0xe4, 0x9,  0xac, 0x90, 0xe2, 0xe2, 0x97, 0x28, 0xd6, 0x9c, 0xe1, 0xd2, 0x41, 0xf1, 0x2e, 0xc6, 0x12,
      0x6f, 0xe4, 0x57, 0xdf, 0x6f, 0x5f, 0x3,  0x0,  0x12, 0xa0, 0xc5, 0xa1, 0x96, 0x57, 0xb3, 0xb5, 0x30, 0x62, 0x10,
      0x6e, 0x1e, 0x28, 0x94, 0x45, 0x54, 0x7c, 0x47, 0x3,  0x0,  0x11, 0x3c, 0x40, 0x4d, 0xcc, 0xcc, 0xa6, 0x5b, 0xf,
      0xb6, 0x8f, 0xfb, 0x53, 0x35, 0x9c, 0x97, 0x7c, 0xb0, 0x9,  0x0,  0x8,  0xbd, 0x18, 0x19, 0x41, 0xbc, 0x6c, 0x1a,
      0xbe, 0x1a, 0x0,  0xb,  0xea, 0x66, 0xcd, 0x6a, 0xb8, 0x6a, 0xee, 0xf3, 0x75, 0x82, 0xee, 0x2,  0x0,  0x0,  0x5d,
      0x19, 0x27, 0x0,  0x0,  0x32, 0x2c, 0x24, 0x87, 0x12, 0x0,  0x14, 0xbe, 0x4a, 0x6e, 0x4d, 0xbe, 0x49, 0xbb, 0x2a,
      0xd5, 0xdd, 0xb2, 0xa8, 0x2c, 0x31, 0xaf, 0x61, 0x1a, 0xf4, 0xfe, 0xc0, 0x26, 0x0,  0x19, 0xec, 0x17, 0xeb, 0x52,
      0xb6, 0x64, 0xf2, 0xb8, 0xd9, 0xd6, 0x5b, 0x3e, 0x68, 0xd2, 0xcc, 0xd1, 0xc,  0x92, 0xb7, 0xb9, 0x99, 0xb8, 0x22,
      0x1b, 0xea, 0x0,  0xa,  0x3f, 0x14, 0x1,  0x6c, 0x81, 0x32, 0x3f, 0x4c, 0x1f, 0x3,  0x19, 0x13, 0x28, 0x16, 0x12,
      0x0,  0xb,  0xea, 0x21, 0x5a, 0x47, 0x52, 0xfe, 0x1e, 0x1f, 0xb7, 0x87, 0xbf, 0x1f, 0x0,  0x13, 0xd9, 0x8d, 0x99,
      0x21, 0x56, 0xbb, 0xd8, 0x94, 0x72, 0xd3, 0x6,  0x19, 0xc5, 0xb7, 0x36, 0xdd, 0x26, 0xb4, 0xed, 0x8,  0x0,  0x4,
      0x65, 0x6e, 0xfc, 0x21, 0x18, 0x0,  0x0,  0x1b, 0x6,  0x17, 0xad, 0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0,
      0x3f, 0x39, 0xcd, 0xcc, 0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};

  uint8_t buf[368] = {0};
  uint8_t topic_bytes[] = {0x6c, 0x1d, 0xe, 0xf, 0xb0, 0x15, 0x54, 0xbd, 0x9, 0x30, 0x62, 0x0, 0x9a, 0x23, 0x31};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0, 0x3f, 0x39, 0xcd, 0xcc,
                         0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 24;

  uint8_t bytesprops0[] = {0x41, 0xe5, 0x35, 0xf2, 0x8,  0x14, 0x6d, 0xd4, 0x5d,
                           0x36, 0xb2, 0xb2, 0xd2, 0x88, 0x57, 0x58, 0xa,  0x18};
  uint8_t bytesprops1[] = {0x84, 0x5e, 0x5c, 0x88, 0x9f, 0x73, 0xa5, 0x8c, 0x97, 0x6f, 0xc3, 0xe3, 0xaa,
                           0x58, 0x52, 0xc5, 0xf7, 0x91, 0x1b, 0x3e, 0x32, 0x46, 0xac, 0x32, 0xbd, 0x5c};
  uint8_t bytesprops2[] = {0x4c, 0x10, 0x7d};
  uint8_t bytesprops3[] = {0xfc, 0x5d, 0xfa, 0xf0, 0xb3, 0xe4, 0x9,  0xac, 0x90, 0xe2, 0xe2, 0x97, 0x28, 0xd6,
                           0x9c, 0xe1, 0xd2, 0x41, 0xf1, 0x2e, 0xc6, 0x12, 0x6f, 0xe4, 0x57, 0xdf, 0x6f, 0x5f};
  uint8_t bytesprops4[] = {0xa0, 0xc5, 0xa1, 0x96, 0x57, 0xb3, 0xb5, 0x30, 0x62,
                           0x10, 0x6e, 0x1e, 0x28, 0x94, 0x45, 0x54, 0x7c, 0x47};
  uint8_t bytesprops5[] = {0x3c, 0x40, 0x4d, 0xcc, 0xcc, 0xa6, 0x5b, 0xf, 0xb6,
                           0x8f, 0xfb, 0x53, 0x35, 0x9c, 0x97, 0x7c, 0xb0};
  uint8_t bytesprops6[] = {0xbd, 0x18, 0x19, 0x41, 0xbc, 0x6c, 0x1a, 0xbe};
  uint8_t bytesprops7[] = {0xea, 0x66, 0xcd, 0x6a, 0xb8, 0x6a, 0xee, 0xf3, 0x75, 0x82, 0xee};
  uint8_t bytesprops8[] = {0xbe, 0x4a, 0x6e, 0x4d, 0xbe, 0x49, 0xbb, 0x2a, 0xd5, 0xdd,
                           0xb2, 0xa8, 0x2c, 0x31, 0xaf, 0x61, 0x1a, 0xf4, 0xfe, 0xc0};
  uint8_t bytesprops10[] = {0x3f, 0x14, 0x1, 0x6c, 0x81, 0x32, 0x3f, 0x4c, 0x1f, 0x3};
  uint8_t bytesprops9[] = {0xec, 0x17, 0xeb, 0x52, 0xb6, 0x64, 0xf2, 0xb8, 0xd9, 0xd6, 0x5b, 0x3e, 0x68,
                           0xd2, 0xcc, 0xd1, 0xc,  0x92, 0xb7, 0xb9, 0x99, 0xb8, 0x22, 0x1b, 0xea};
  uint8_t bytesprops11[] = {0xea, 0x21, 0x5a, 0x47, 0x52, 0xfe, 0x1e, 0x1f, 0xb7, 0x87, 0xbf};
  uint8_t bytesprops12[] = {0xd9, 0x8d, 0x99, 0x21, 0x56, 0xbb, 0xd8, 0x94, 0x72, 0xd3,
                            0x6,  0x19, 0xc5, 0xb7, 0x36, 0xdd, 0x26, 0xb4, 0xed};
  uint8_t bytesprops13[] = {0x65, 0x6e, 0xfc, 0x21};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21600}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13269}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18146}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24193}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23833}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12844}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops9}, .v = {10, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6918}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 173}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "l\GS\SO\SI\176\NAKT\189\t0b\NUL\154#1", _pubPktID = 0, _pubBody =
// "\180v\132PX\145\222\160?9\205\204\241\168\&5<\235\222\160\\\190Tg\128", _pubProps = [PropResponseTopic
// "A\229\&5\242\b\DC4m\212]6\178\178\210\136WX\n\CAN",PropResponseInformation
// "\132^\\\136\159s\165\140\151o\195\227\170XR\197\247\145\ESC>2F\172\&2\189\\",PropMaximumPacketSize
// 21600,PropMaximumPacketSize 13269,PropRequestProblemInformation 94,PropWillDelayInterval
// 18146,PropRequestResponseInformation 220,PropSubscriptionIdentifierAvailable 112,PropSessionExpiryInterval
// 24193,PropMaximumQoS 254,PropAuthenticationMethod "L\DLE}",PropWildcardSubscriptionAvailable 171,PropResponseTopic
// "\252]\250\240\179\228\t\172\144\226\226\151(\214\156\225\210A\241.\198\DC2o\228W\223o_",PropContentType
// "\160\197\161\150W\179\181\&0b\DLEn\RS(\148ET|G",PropContentType
// "<@M\204\204\166[\SI\182\143\251S5\156\151|\176",PropCorrelationData
// "\189\CAN\EMA\188l\SUB\190",PropResponseInformation "\234f\205j\184j\238\243u\130\238",PropMessageExpiryInterval
// 23833,PropMaximumPacketSize 12844,PropMaximumQoS 135,PropAssignedClientIdentifier
// "\190JnM\190I\187*\213\221\178\168,1\175a\SUB\244\254\192",PropUserProperty
// "\236\ETB\235R\182d\242\184\217\214[>h\210\204\209\f\146\183\185\153\184\"\ESC\234"
// "?\DC4\SOHl\129\&2?L\US\ETX",PropRequestResponseInformation 19,PropWildcardSubscriptionAvailable
// 22,PropAssignedClientIdentifier "\234!ZGR\254\RS\US\183\135\191",PropReasonString
// "\217\141\153!V\187\216\148r\211\ACK\EM\197\183\&6\221&\180\237",PropResponseTopic "en\252!",PropWillDelayInterval
// 6918,PropRequestProblemInformation 173]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {
      0x31, 0xe3, 0x2,  0x0,  0xf,  0x6c, 0x1d, 0xe,  0xf,  0xb0, 0x15, 0x54, 0xbd, 0x9,  0x30, 0x62, 0x0,  0x9a, 0x23,
      0x31, 0xb8, 0x2,  0x8,  0x0,  0x12, 0x41, 0xe5, 0x35, 0xf2, 0x8,  0x14, 0x6d, 0xd4, 0x5d, 0x36, 0xb2, 0xb2, 0xd2,
      0x88, 0x57, 0x58, 0xa,  0x18, 0x1a, 0x0,  0x1a, 0x84, 0x5e, 0x5c, 0x88, 0x9f, 0x73, 0xa5, 0x8c, 0x97, 0x6f, 0xc3,
      0xe3, 0xaa, 0x58, 0x52, 0xc5, 0xf7, 0x91, 0x1b, 0x3e, 0x32, 0x46, 0xac, 0x32, 0xbd, 0x5c, 0x27, 0x0,  0x0,  0x54,
      0x60, 0x27, 0x0,  0x0,  0x33, 0xd5, 0x17, 0x5e, 0x18, 0x0,  0x0,  0x46, 0xe2, 0x19, 0xdc, 0x29, 0x70, 0x11, 0x0,
      0x0,  0x5e, 0x81, 0x24, 0xfe, 0x15, 0x0,  0x3,  0x4c, 0x10, 0x7d, 0x28, 0xab, 0x8,  0x0,  0x1c, 0xfc, 0x5d, 0xfa,
      0xf0, 0xb3, 0xe4, 0x9,  0xac, 0x90, 0xe2, 0xe2, 0x97, 0x28, 0xd6, 0x9c, 0xe1, 0xd2, 0x41, 0xf1, 0x2e, 0xc6, 0x12,
      0x6f, 0xe4, 0x57, 0xdf, 0x6f, 0x5f, 0x3,  0x0,  0x12, 0xa0, 0xc5, 0xa1, 0x96, 0x57, 0xb3, 0xb5, 0x30, 0x62, 0x10,
      0x6e, 0x1e, 0x28, 0x94, 0x45, 0x54, 0x7c, 0x47, 0x3,  0x0,  0x11, 0x3c, 0x40, 0x4d, 0xcc, 0xcc, 0xa6, 0x5b, 0xf,
      0xb6, 0x8f, 0xfb, 0x53, 0x35, 0x9c, 0x97, 0x7c, 0xb0, 0x9,  0x0,  0x8,  0xbd, 0x18, 0x19, 0x41, 0xbc, 0x6c, 0x1a,
      0xbe, 0x1a, 0x0,  0xb,  0xea, 0x66, 0xcd, 0x6a, 0xb8, 0x6a, 0xee, 0xf3, 0x75, 0x82, 0xee, 0x2,  0x0,  0x0,  0x5d,
      0x19, 0x27, 0x0,  0x0,  0x32, 0x2c, 0x24, 0x87, 0x12, 0x0,  0x14, 0xbe, 0x4a, 0x6e, 0x4d, 0xbe, 0x49, 0xbb, 0x2a,
      0xd5, 0xdd, 0xb2, 0xa8, 0x2c, 0x31, 0xaf, 0x61, 0x1a, 0xf4, 0xfe, 0xc0, 0x26, 0x0,  0x19, 0xec, 0x17, 0xeb, 0x52,
      0xb6, 0x64, 0xf2, 0xb8, 0xd9, 0xd6, 0x5b, 0x3e, 0x68, 0xd2, 0xcc, 0xd1, 0xc,  0x92, 0xb7, 0xb9, 0x99, 0xb8, 0x22,
      0x1b, 0xea, 0x0,  0xa,  0x3f, 0x14, 0x1,  0x6c, 0x81, 0x32, 0x3f, 0x4c, 0x1f, 0x3,  0x19, 0x13, 0x28, 0x16, 0x12,
      0x0,  0xb,  0xea, 0x21, 0x5a, 0x47, 0x52, 0xfe, 0x1e, 0x1f, 0xb7, 0x87, 0xbf, 0x1f, 0x0,  0x13, 0xd9, 0x8d, 0x99,
      0x21, 0x56, 0xbb, 0xd8, 0x94, 0x72, 0xd3, 0x6,  0x19, 0xc5, 0xb7, 0x36, 0xdd, 0x26, 0xb4, 0xed, 0x8,  0x0,  0x4,
      0x65, 0x6e, 0xfc, 0x21, 0x18, 0x0,  0x0,  0x1b, 0x6,  0x17, 0xad, 0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0,
      0x3f, 0x39, 0xcd, 0xcc, 0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6c, 0x1d, 0xe, 0xf, 0xb0, 0x15, 0x54, 0xbd, 0x9, 0x30, 0x62, 0x0, 0x9a, 0x23, 0x31};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb4, 0x76, 0x84, 0x50, 0x58, 0x91, 0xde, 0xa0, 0x3f, 0x39, 0xcd, 0xcc,
                              0xf1, 0xa8, 0x35, 0x3c, 0xeb, 0xde, 0xa0, 0x5c, 0xbe, 0x54, 0x67, 0x80};
  lwmqtt_string_t exp_body = {24, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 24);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 24);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\244_\249R\255\232t\194", _pubPktID
// = 4521, _pubBody = "\213\SOQ\252\167\179#\DEL\SIc\223\EOT\156\210\214\bp", _pubProps = [PropRetainAvailable
// 141,PropAssignedClientIdentifier
// "\198\246L\228q\t\203\216\147\GS\"*\181\f\198\DELAn\SO\185\232\DC3\195\181\193",PropSessionExpiryInterval
// 28422,PropRetainAvailable 4,PropSharedSubscriptionAvailable 192,PropPayloadFormatIndicator 178,PropResponseTopic "
// \161\189",PropAssignedClientIdentifier "\142YT\144%\STX\bL\fK^\163\134^\212Z\199\234]"]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {0x35, 0x63, 0x0,  0x8,  0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2, 0x11, 0xa9, 0x45, 0x25, 0x8d,
                   0x12, 0x0,  0x19, 0xc6, 0xf6, 0x4c, 0xe4, 0x71, 0x9,  0xcb, 0xd8, 0x93, 0x1d, 0x22, 0x2a, 0xb5, 0xc,
                   0xc6, 0x7f, 0x41, 0x6e, 0xe,  0xb9, 0xe8, 0x13, 0xc3, 0xb5, 0xc1, 0x11, 0x0,  0x0,  0x6f, 0x6,  0x25,
                   0x4,  0x2a, 0xc0, 0x1,  0xb2, 0x8,  0x0,  0x3,  0x20, 0xa1, 0xbd, 0x12, 0x0,  0x13, 0x8e, 0x59, 0x54,
                   0x90, 0x25, 0x2,  0x8,  0x4c, 0xc,  0x4b, 0x5e, 0xa3, 0x86, 0x5e, 0xd4, 0x5a, 0xc7, 0xea, 0x5d, 0xd5,
                   0xe,  0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,  0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};

  uint8_t buf[111] = {0};
  uint8_t topic_bytes[] = {0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd5, 0xe,  0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,
                         0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0xc6, 0xf6, 0x4c, 0xe4, 0x71, 0x9, 0xcb, 0xd8, 0x93, 0x1d, 0x22, 0x2a, 0xb5,
                           0xc,  0xc6, 0x7f, 0x41, 0x6e, 0xe, 0xb9, 0xe8, 0x13, 0xc3, 0xb5, 0xc1};
  uint8_t bytesprops1[] = {0x20, 0xa1, 0xbd};
  uint8_t bytesprops2[] = {0x8e, 0x59, 0x54, 0x90, 0x25, 0x2,  0x8,  0x4c, 0xc, 0x4b,
                           0x5e, 0xa3, 0x86, 0x5e, 0xd4, 0x5a, 0xc7, 0xea, 0x5d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28422}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 4521, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\244_\249R\255\232t\194", _pubPktID
// = 4521, _pubBody = "\213\SOQ\252\167\179#\DEL\SIc\223\EOT\156\210\214\bp", _pubProps = [PropRetainAvailable
// 141,PropAssignedClientIdentifier
// "\198\246L\228q\t\203\216\147\GS\"*\181\f\198\DELAn\SO\185\232\DC3\195\181\193",PropSessionExpiryInterval
// 28422,PropRetainAvailable 4,PropSharedSubscriptionAvailable 192,PropPayloadFormatIndicator 178,PropResponseTopic "
// \161\189",PropAssignedClientIdentifier "\142YT\144%\STX\bL\fK^\163\134^\212Z\199\234]"]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {0x35, 0x63, 0x0,  0x8,  0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2, 0x11, 0xa9, 0x45, 0x25, 0x8d,
                   0x12, 0x0,  0x19, 0xc6, 0xf6, 0x4c, 0xe4, 0x71, 0x9,  0xcb, 0xd8, 0x93, 0x1d, 0x22, 0x2a, 0xb5, 0xc,
                   0xc6, 0x7f, 0x41, 0x6e, 0xe,  0xb9, 0xe8, 0x13, 0xc3, 0xb5, 0xc1, 0x11, 0x0,  0x0,  0x6f, 0x6,  0x25,
                   0x4,  0x2a, 0xc0, 0x1,  0xb2, 0x8,  0x0,  0x3,  0x20, 0xa1, 0xbd, 0x12, 0x0,  0x13, 0x8e, 0x59, 0x54,
                   0x90, 0x25, 0x2,  0x8,  0x4c, 0xc,  0x4b, 0x5e, 0xa3, 0x86, 0x5e, 0xd4, 0x5a, 0xc7, 0xea, 0x5d, 0xd5,
                   0xe,  0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,  0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf4, 0x5f, 0xf9, 0x52, 0xff, 0xe8, 0x74, 0xc2};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd5, 0xe,  0x51, 0xfc, 0xa7, 0xb3, 0x23, 0x7f, 0xf,
                              0x63, 0xdf, 0x4,  0x9c, 0xd2, 0xd6, 0x8,  0x70};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 4521);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "a\239\170\203|\"\t\198g\b\v[V\ETXkc\GS+\205\&5Q13M\196E", _pubPktID = 21638, _pubBody =
// "\NAK\153\221\DC3\250(2\DC2\166z\179\183Z\205>5\158\160\245", _pubProps = [PropContentType
// "\176\254u\222\148\197\221B \168",PropTopicAliasMaximum 19316,PropCorrelationData "R\222g",PropAuthenticationData
// "q\219\133G\216b,p\148\GS\132\181\185\224\131\146\145.\NUL\149\253\GSPn\147#\236k\ACKI",PropMaximumPacketSize
// 11778,PropResponseTopic
// "\228\239I\244hm\STX\SOz\244\156\192#8\197\194\a\201T\176\254.\237\201\GS\EOT`S\248\RS",PropRequestResponseInformation
// 101,PropAssignedClientIdentifier "\164@\128\131B\169\131#D<O"]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x3d, 0x9f, 0x1,  0x0,  0x1a, 0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67, 0x8,  0xb,  0x5b,
                   0x56, 0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31, 0x33, 0x4d, 0xc4, 0x45, 0x54, 0x86, 0x6d,
                   0x3,  0x0,  0xa,  0xb0, 0xfe, 0x75, 0xde, 0x94, 0xc5, 0xdd, 0x42, 0x20, 0xa8, 0x22, 0x4b, 0x74, 0x9,
                   0x0,  0x3,  0x52, 0xde, 0x67, 0x16, 0x0,  0x1e, 0x71, 0xdb, 0x85, 0x47, 0xd8, 0x62, 0x2c, 0x70, 0x94,
                   0x1d, 0x84, 0xb5, 0xb9, 0xe0, 0x83, 0x92, 0x91, 0x2e, 0x0,  0x95, 0xfd, 0x1d, 0x50, 0x6e, 0x93, 0x23,
                   0xec, 0x6b, 0x6,  0x49, 0x27, 0x0,  0x0,  0x2e, 0x2,  0x8,  0x0,  0x1e, 0xe4, 0xef, 0x49, 0xf4, 0x68,
                   0x6d, 0x2,  0xe,  0x7a, 0xf4, 0x9c, 0xc0, 0x23, 0x38, 0xc5, 0xc2, 0x7,  0xc9, 0x54, 0xb0, 0xfe, 0x2e,
                   0xed, 0xc9, 0x1d, 0x4,  0x60, 0x53, 0xf8, 0x1e, 0x19, 0x65, 0x12, 0x0,  0xb,  0xa4, 0x40, 0x80, 0x83,
                   0x42, 0xa9, 0x83, 0x23, 0x44, 0x3c, 0x4f, 0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32, 0x12, 0xa6, 0x7a,
                   0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};

  uint8_t buf[172] = {0};
  uint8_t topic_bytes[] = {0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67, 0x8,  0xb,  0x5b, 0x56,
                           0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31, 0x33, 0x4d, 0xc4, 0x45};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32, 0x12, 0xa6, 0x7a,
                         0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 19;

  uint8_t bytesprops0[] = {0xb0, 0xfe, 0x75, 0xde, 0x94, 0xc5, 0xdd, 0x42, 0x20, 0xa8};
  uint8_t bytesprops1[] = {0x52, 0xde, 0x67};
  uint8_t bytesprops2[] = {0x71, 0xdb, 0x85, 0x47, 0xd8, 0x62, 0x2c, 0x70, 0x94, 0x1d, 0x84, 0xb5, 0xb9, 0xe0, 0x83,
                           0x92, 0x91, 0x2e, 0x0,  0x95, 0xfd, 0x1d, 0x50, 0x6e, 0x93, 0x23, 0xec, 0x6b, 0x6,  0x49};
  uint8_t bytesprops3[] = {0xe4, 0xef, 0x49, 0xf4, 0x68, 0x6d, 0x2,  0xe,  0x7a, 0xf4, 0x9c, 0xc0, 0x23, 0x38, 0xc5,
                           0xc2, 0x7,  0xc9, 0x54, 0xb0, 0xfe, 0x2e, 0xed, 0xc9, 0x1d, 0x4,  0x60, 0x53, 0xf8, 0x1e};
  uint8_t bytesprops4[] = {0xa4, 0x40, 0x80, 0x83, 0x42, 0xa9, 0x83, 0x23, 0x44, 0x3c, 0x4f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19316}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11778}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 21638, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "a\239\170\203|\"\t\198g\b\v[V\ETXkc\GS+\205\&5Q13M\196E", _pubPktID = 21638, _pubBody =
// "\NAK\153\221\DC3\250(2\DC2\166z\179\183Z\205>5\158\160\245", _pubProps = [PropContentType
// "\176\254u\222\148\197\221B \168",PropTopicAliasMaximum 19316,PropCorrelationData "R\222g",PropAuthenticationData
// "q\219\133G\216b,p\148\GS\132\181\185\224\131\146\145.\NUL\149\253\GSPn\147#\236k\ACKI",PropMaximumPacketSize
// 11778,PropResponseTopic
// "\228\239I\244hm\STX\SOz\244\156\192#8\197\194\a\201T\176\254.\237\201\GS\EOT`S\248\RS",PropRequestResponseInformation
// 101,PropAssignedClientIdentifier "\164@\128\131B\169\131#D<O"]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x3d, 0x9f, 0x1,  0x0,  0x1a, 0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67, 0x8,  0xb,  0x5b,
                   0x56, 0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31, 0x33, 0x4d, 0xc4, 0x45, 0x54, 0x86, 0x6d,
                   0x3,  0x0,  0xa,  0xb0, 0xfe, 0x75, 0xde, 0x94, 0xc5, 0xdd, 0x42, 0x20, 0xa8, 0x22, 0x4b, 0x74, 0x9,
                   0x0,  0x3,  0x52, 0xde, 0x67, 0x16, 0x0,  0x1e, 0x71, 0xdb, 0x85, 0x47, 0xd8, 0x62, 0x2c, 0x70, 0x94,
                   0x1d, 0x84, 0xb5, 0xb9, 0xe0, 0x83, 0x92, 0x91, 0x2e, 0x0,  0x95, 0xfd, 0x1d, 0x50, 0x6e, 0x93, 0x23,
                   0xec, 0x6b, 0x6,  0x49, 0x27, 0x0,  0x0,  0x2e, 0x2,  0x8,  0x0,  0x1e, 0xe4, 0xef, 0x49, 0xf4, 0x68,
                   0x6d, 0x2,  0xe,  0x7a, 0xf4, 0x9c, 0xc0, 0x23, 0x38, 0xc5, 0xc2, 0x7,  0xc9, 0x54, 0xb0, 0xfe, 0x2e,
                   0xed, 0xc9, 0x1d, 0x4,  0x60, 0x53, 0xf8, 0x1e, 0x19, 0x65, 0x12, 0x0,  0xb,  0xa4, 0x40, 0x80, 0x83,
                   0x42, 0xa9, 0x83, 0x23, 0x44, 0x3c, 0x4f, 0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32, 0x12, 0xa6, 0x7a,
                   0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x61, 0xef, 0xaa, 0xcb, 0x7c, 0x22, 0x9,  0xc6, 0x67, 0x8,  0xb,  0x5b, 0x56,
                               0x3,  0x6b, 0x63, 0x1d, 0x2b, 0xcd, 0x35, 0x51, 0x31, 0x33, 0x4d, 0xc4, 0x45};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x15, 0x99, 0xdd, 0x13, 0xfa, 0x28, 0x32, 0x12, 0xa6, 0x7a,
                              0xb3, 0xb7, 0x5a, 0xcd, 0x3e, 0x35, 0x9e, 0xa0, 0xf5};
  lwmqtt_string_t exp_body = {19, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 21638);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 19);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 19);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "3\DC2\163\160\US\252\129\206\EMa\SYN\ESC\248J%\210\t0\224\159T\165\137&\153", _pubPktID = 14459, _pubBody =
// "\161;R\191\DC4\212,\ETB\168<\r}\244\250\&6\145_\153\241\218\175\133\NAK\SO\234\f", _pubProps =
// [PropWillDelayInterval 19833,PropContentType "'f\225\ETB\202",PropServerKeepAlive 17420,PropPayloadFormatIndicator
// 155,PropServerKeepAlive 11561,PropTopicAliasMaximum 5638,PropResponseInformation
// "\FS\EM\145\217\SUB\GS_R\f\175",PropResponseTopic
// "k\ETB\180g\156\223\215\CAN[\207\188mH\200\ETB\230\203\220\177\173\158\149\178@",PropReasonString
// "\149\180\194\131T\234&\237\143\170\166",PropMaximumQoS 239,PropAssignedClientIdentifier
// "Z\233,B\231\vH\143\DC1d\SO\233\163\202\213",PropResponseInformation
// "\r\226jm\227\213A>N/\157\185F\164",PropTopicAliasMaximum 13496]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x35, 0xae, 0x1,  0x0,  0x19, 0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16, 0x1b,
                   0xf8, 0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99, 0x38, 0x7b, 0x76, 0x18,
                   0x0,  0x0,  0x4d, 0x79, 0x3,  0x0,  0x5,  0x27, 0x66, 0xe1, 0x17, 0xca, 0x13, 0x44, 0xc,  0x1,  0x9b,
                   0x13, 0x2d, 0x29, 0x22, 0x16, 0x6,  0x1a, 0x0,  0xa,  0x1c, 0x19, 0x91, 0xd9, 0x1a, 0x1d, 0x5f, 0x52,
                   0xc,  0xaf, 0x8,  0x0,  0x18, 0x6b, 0x17, 0xb4, 0x67, 0x9c, 0xdf, 0xd7, 0x18, 0x5b, 0xcf, 0xbc, 0x6d,
                   0x48, 0xc8, 0x17, 0xe6, 0xcb, 0xdc, 0xb1, 0xad, 0x9e, 0x95, 0xb2, 0x40, 0x1f, 0x0,  0xb,  0x95, 0xb4,
                   0xc2, 0x83, 0x54, 0xea, 0x26, 0xed, 0x8f, 0xaa, 0xa6, 0x24, 0xef, 0x12, 0x0,  0xf,  0x5a, 0xe9, 0x2c,
                   0x42, 0xe7, 0xb,  0x48, 0x8f, 0x11, 0x64, 0xe,  0xe9, 0xa3, 0xca, 0xd5, 0x1a, 0x0,  0xe,  0xd,  0xe2,
                   0x6a, 0x6d, 0xe3, 0xd5, 0x41, 0x3e, 0x4e, 0x2f, 0x9d, 0xb9, 0x46, 0xa4, 0x22, 0x34, 0xb8, 0xa1, 0x3b,
                   0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd,  0x7d, 0xf4, 0xfa, 0x36, 0x91, 0x5f, 0x99, 0xf1,
                   0xda, 0xaf, 0x85, 0x15, 0xe,  0xea, 0xc};

  uint8_t buf[187] = {0};
  uint8_t topic_bytes[] = {0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16, 0x1b, 0xf8,
                           0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99};
  lwmqtt_string_t topic = {25, (char*)&topic_bytes};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa1, 0x3b, 0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd, 0x7d, 0xf4,
                         0xfa, 0x36, 0x91, 0x5f, 0x99, 0xf1, 0xda, 0xaf, 0x85, 0x15, 0xe, 0xea, 0xc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0x27, 0x66, 0xe1, 0x17, 0xca};
  uint8_t bytesprops1[] = {0x1c, 0x19, 0x91, 0xd9, 0x1a, 0x1d, 0x5f, 0x52, 0xc, 0xaf};
  uint8_t bytesprops2[] = {0x6b, 0x17, 0xb4, 0x67, 0x9c, 0xdf, 0xd7, 0x18, 0x5b, 0xcf, 0xbc, 0x6d,
                           0x48, 0xc8, 0x17, 0xe6, 0xcb, 0xdc, 0xb1, 0xad, 0x9e, 0x95, 0xb2, 0x40};
  uint8_t bytesprops3[] = {0x95, 0xb4, 0xc2, 0x83, 0x54, 0xea, 0x26, 0xed, 0x8f, 0xaa, 0xa6};
  uint8_t bytesprops4[] = {0x5a, 0xe9, 0x2c, 0x42, 0xe7, 0xb, 0x48, 0x8f, 0x11, 0x64, 0xe, 0xe9, 0xa3, 0xca, 0xd5};
  uint8_t bytesprops5[] = {0xd, 0xe2, 0x6a, 0x6d, 0xe3, 0xd5, 0x41, 0x3e, 0x4e, 0x2f, 0x9d, 0xb9, 0x46, 0xa4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19833}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17420}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11561}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5638}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13496}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 14459, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "3\DC2\163\160\US\252\129\206\EMa\SYN\ESC\248J%\210\t0\224\159T\165\137&\153", _pubPktID = 14459, _pubBody =
// "\161;R\191\DC4\212,\ETB\168<\r}\244\250\&6\145_\153\241\218\175\133\NAK\SO\234\f", _pubProps =
// [PropWillDelayInterval 19833,PropContentType "'f\225\ETB\202",PropServerKeepAlive 17420,PropPayloadFormatIndicator
// 155,PropServerKeepAlive 11561,PropTopicAliasMaximum 5638,PropResponseInformation
// "\FS\EM\145\217\SUB\GS_R\f\175",PropResponseTopic
// "k\ETB\180g\156\223\215\CAN[\207\188mH\200\ETB\230\203\220\177\173\158\149\178@",PropReasonString
// "\149\180\194\131T\234&\237\143\170\166",PropMaximumQoS 239,PropAssignedClientIdentifier
// "Z\233,B\231\vH\143\DC1d\SO\233\163\202\213",PropResponseInformation
// "\r\226jm\227\213A>N/\157\185F\164",PropTopicAliasMaximum 13496]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x35, 0xae, 0x1,  0x0,  0x19, 0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16, 0x1b,
                   0xf8, 0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99, 0x38, 0x7b, 0x76, 0x18,
                   0x0,  0x0,  0x4d, 0x79, 0x3,  0x0,  0x5,  0x27, 0x66, 0xe1, 0x17, 0xca, 0x13, 0x44, 0xc,  0x1,  0x9b,
                   0x13, 0x2d, 0x29, 0x22, 0x16, 0x6,  0x1a, 0x0,  0xa,  0x1c, 0x19, 0x91, 0xd9, 0x1a, 0x1d, 0x5f, 0x52,
                   0xc,  0xaf, 0x8,  0x0,  0x18, 0x6b, 0x17, 0xb4, 0x67, 0x9c, 0xdf, 0xd7, 0x18, 0x5b, 0xcf, 0xbc, 0x6d,
                   0x48, 0xc8, 0x17, 0xe6, 0xcb, 0xdc, 0xb1, 0xad, 0x9e, 0x95, 0xb2, 0x40, 0x1f, 0x0,  0xb,  0x95, 0xb4,
                   0xc2, 0x83, 0x54, 0xea, 0x26, 0xed, 0x8f, 0xaa, 0xa6, 0x24, 0xef, 0x12, 0x0,  0xf,  0x5a, 0xe9, 0x2c,
                   0x42, 0xe7, 0xb,  0x48, 0x8f, 0x11, 0x64, 0xe,  0xe9, 0xa3, 0xca, 0xd5, 0x1a, 0x0,  0xe,  0xd,  0xe2,
                   0x6a, 0x6d, 0xe3, 0xd5, 0x41, 0x3e, 0x4e, 0x2f, 0x9d, 0xb9, 0x46, 0xa4, 0x22, 0x34, 0xb8, 0xa1, 0x3b,
                   0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd,  0x7d, 0xf4, 0xfa, 0x36, 0x91, 0x5f, 0x99, 0xf1,
                   0xda, 0xaf, 0x85, 0x15, 0xe,  0xea, 0xc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x33, 0x12, 0xa3, 0xa0, 0x1f, 0xfc, 0x81, 0xce, 0x19, 0x61, 0x16, 0x1b, 0xf8,
                               0x4a, 0x25, 0xd2, 0x9,  0x30, 0xe0, 0x9f, 0x54, 0xa5, 0x89, 0x26, 0x99};
  lwmqtt_string_t exp_topic = {25, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa1, 0x3b, 0x52, 0xbf, 0x14, 0xd4, 0x2c, 0x17, 0xa8, 0x3c, 0xd, 0x7d, 0xf4,
                              0xfa, 0x36, 0x91, 0x5f, 0x99, 0xf1, 0xda, 0xaf, 0x85, 0x15, 0xe, 0xea, 0xc};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 14459);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 25);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Just "\\$\245\DELg\180\&6\136n\177S\153", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\187\152\148yT\196\161\178\207\&7:s\148\144\169n\217\222n=u\190\f\147", _willMsg =
// "r\244\252S\171\236L\225\159\&2\192\246\223\255o)`\238\SOn\DC3", _willProps = []}), _cleanSession = False, _keepAlive
// = 12967, _connID = "\SI\255\178<\ETBPC\254\194 f:\152s}\165&\SO M`\251\NULx\STXiB", _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x66, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8c, 0x32, 0xa7, 0x0,  0x1b, 0xf,
                   0xff, 0xb2, 0x3c, 0x17, 0x50, 0x43, 0xfe, 0xc2, 0x20, 0x66, 0x3a, 0x98, 0x73, 0x7d, 0xa5,
                   0x26, 0xe,  0x20, 0x4d, 0x60, 0xfb, 0x0,  0x78, 0x2,  0x69, 0x42, 0x0,  0x18, 0xbb, 0x98,
                   0x94, 0x79, 0x54, 0xc4, 0xa1, 0xb2, 0xcf, 0x37, 0x3a, 0x73, 0x94, 0x90, 0xa9, 0x6e, 0xd9,
                   0xde, 0x6e, 0x3d, 0x75, 0xbe, 0xc,  0x93, 0x0,  0x15, 0x72, 0xf4, 0xfc, 0x53, 0xab, 0xec,
                   0x4c, 0xe1, 0x9f, 0x32, 0xc0, 0xf6, 0xdf, 0xff, 0x6f, 0x29, 0x60, 0xee, 0xe,  0x6e, 0x13,
                   0x0,  0xc,  0x5c, 0x24, 0xf5, 0x7f, 0x67, 0xb4, 0x36, 0x88, 0x6e, 0xb1, 0x53, 0x99};

  uint8_t buf[114] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbb, 0x98, 0x94, 0x79, 0x54, 0xc4, 0xa1, 0xb2, 0xcf, 0x37, 0x3a, 0x73,
                                0x94, 0x90, 0xa9, 0x6e, 0xd9, 0xde, 0x6e, 0x3d, 0x75, 0xbe, 0xc,  0x93};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x72, 0xf4, 0xfc, 0x53, 0xab, 0xec, 0x4c, 0xe1, 0x9f, 0x32, 0xc0,
                                  0xf6, 0xdf, 0xff, 0x6f, 0x29, 0x60, 0xee, 0xe,  0x6e, 0x13};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12967;
  uint8_t client_id_bytes[] = {0xf,  0xff, 0xb2, 0x3c, 0x17, 0x50, 0x43, 0xfe, 0xc2, 0x20, 0x66, 0x3a, 0x98, 0x73,
                               0x7d, 0xa5, 0x26, 0xe,  0x20, 0x4d, 0x60, 0xfb, 0x0,  0x78, 0x2,  0x69, 0x42};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5c, 0x24, 0xf5, 0x7f, 0x67, 0xb4, 0x36, 0x88, 0x6e, 0xb1, 0x53, 0x99};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "b\178\DC3\167\181\244O`\DLE\131\239\236)\NAK*\179`\210\203-\213\144\135\193\157\221\244\182", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "5m\FS[\176f\152", _willMsg =
// "y\STX\EM\232\172\190s\130\201\153\199L\132n\189", _willProps = []}), _cleanSession = True, _keepAlive = 11130,
// _connID = "\DELq\DLE\242s\179\EM\158\193\158\ACKPz", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x33, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x26, 0x2b, 0x7a, 0x0,  0xd,
                   0x7f, 0x71, 0x10, 0xf2, 0x73, 0xb3, 0x19, 0x9e, 0xc1, 0x9e, 0x6,  0x50, 0x7a, 0x0,
                   0x7,  0x35, 0x6d, 0x1c, 0x5b, 0xb0, 0x66, 0x98, 0x0,  0xf,  0x79, 0x2,  0x19, 0xe8,
                   0xac, 0xbe, 0x73, 0x82, 0xc9, 0x99, 0xc7, 0x4c, 0x84, 0x6e, 0xbd};

  uint8_t buf[63] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x35, 0x6d, 0x1c, 0x5b, 0xb0, 0x66, 0x98};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x79, 0x2,  0x19, 0xe8, 0xac, 0xbe, 0x73, 0x82,
                                  0xc9, 0x99, 0xc7, 0x4c, 0x84, 0x6e, 0xbd};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11130;
  uint8_t client_id_bytes[] = {0x7f, 0x71, 0x10, 0xf2, 0x73, 0xb3, 0x19, 0x9e, 0xc1, 0x9e, 0x6, 0x50, 0x7a};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x62, 0xb2, 0x13, 0xa7, 0xb5, 0xf4, 0x4f, 0x60, 0x10, 0x83, 0xef, 0xec, 0x29, 0x15,
                              0x2a, 0xb3, 0x60, 0xd2, 0xcb, 0x2d, 0xd5, 0x90, 0x87, 0xc1, 0x9d, 0xdd, 0xf4, 0xb6};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "$J\t\NUL\130\250\238\188R\250\153\177\ETB\216wo\RS9%X\251e#\SO\201\147", _password
// = Just "\\\218\240\185\155\162\192\252t\131\184HV\192\235", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS2, _willTopic = "\157\174", _willMsg = "\147\218", _willProps = []}), _cleanSession = False, _keepAlive = 6678,
// _connID = "\179\rO`Y", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x46, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf4, 0x1a, 0x16, 0x0,  0x5,  0xb3,
                   0xd,  0x4f, 0x60, 0x59, 0x0,  0x2,  0x9d, 0xae, 0x0,  0x2,  0x93, 0xda, 0x0,  0x1a, 0x24,
                   0x4a, 0x9,  0x0,  0x82, 0xfa, 0xee, 0xbc, 0x52, 0xfa, 0x99, 0xb1, 0x17, 0xd8, 0x77, 0x6f,
                   0x1e, 0x39, 0x25, 0x58, 0xfb, 0x65, 0x23, 0xe,  0xc9, 0x93, 0x0,  0xf,  0x5c, 0xda, 0xf0,
                   0xb9, 0x9b, 0xa2, 0xc0, 0xfc, 0x74, 0x83, 0xb8, 0x48, 0x56, 0xc0, 0xeb};

  uint8_t buf[82] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9d, 0xae};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x93, 0xda};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6678;
  uint8_t client_id_bytes[] = {0xb3, 0xd, 0x4f, 0x60, 0x59};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x24, 0x4a, 0x9,  0x0,  0x82, 0xfa, 0xee, 0xbc, 0x52, 0xfa, 0x99, 0xb1, 0x17,
                              0xd8, 0x77, 0x6f, 0x1e, 0x39, 0x25, 0x58, 0xfb, 0x65, 0x23, 0xe,  0xc9, 0x93};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5c, 0xda, 0xf0, 0xb9, 0x9b, 0xa2, 0xc0, 0xfc, 0x74, 0x83, 0xb8, 0x48, 0x56, 0xc0, 0xeb};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETX\162\182\251\&5\254\129A\181!!/
// \229\172\171\204\210R\201\DC1\250\190\&4_\"X\154", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\130\DEL/\236|]", _willMsg = "\161\186\166\161\248x\189;\ETX\167", _willProps =
// []}), _cleanSession = False, _keepAlive = 31398, _connID = "\165=K\CAN\208~\SYN\241*\f6#\208H\198\177p.", _properties
// = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x50, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x94, 0x7a, 0xa6, 0x0,  0x12, 0xa5, 0x3d, 0x4b,
                   0x18, 0xd0, 0x7e, 0x16, 0xf1, 0x2a, 0xc,  0x36, 0x23, 0xd0, 0x48, 0xc6, 0xb1, 0x70, 0x2e, 0x0,  0x6,
                   0x82, 0x7f, 0x2f, 0xec, 0x7c, 0x5d, 0x0,  0xa,  0xa1, 0xba, 0xa6, 0xa1, 0xf8, 0x78, 0xbd, 0x3b, 0x3,
                   0xa7, 0x0,  0x1c, 0x3,  0xa2, 0xb6, 0xfb, 0x35, 0xfe, 0x81, 0x41, 0xb5, 0x21, 0x21, 0x2f, 0x20, 0xe5,
                   0xac, 0xab, 0xcc, 0xd2, 0x52, 0xc9, 0x11, 0xfa, 0xbe, 0x34, 0x5f, 0x22, 0x58, 0x9a};

  uint8_t buf[92] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x82, 0x7f, 0x2f, 0xec, 0x7c, 0x5d};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa1, 0xba, 0xa6, 0xa1, 0xf8, 0x78, 0xbd, 0x3b, 0x3, 0xa7};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 31398;
  uint8_t client_id_bytes[] = {0xa5, 0x3d, 0x4b, 0x18, 0xd0, 0x7e, 0x16, 0xf1, 0x2a,
                               0xc,  0x36, 0x23, 0xd0, 0x48, 0xc6, 0xb1, 0x70, 0x2e};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3,  0xa2, 0xb6, 0xfb, 0x35, 0xfe, 0x81, 0x41, 0xb5, 0x21, 0x21, 0x2f, 0x20, 0xe5,
                              0xac, 0xab, 0xcc, 0xd2, 0x52, 0xc9, 0x11, 0xfa, 0xbe, 0x34, 0x5f, 0x22, 0x58, 0x9a};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "GM0)\182\157\&9s", _password = Just
// "nBK\142m\DEL\248~\175W\169oW\173\176\EM7\245\222c%\177", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "<\166\216{\222\a\STX\238\153\rd\166Zm\206JH\vO\242\143\&7\163\173\233\EOT&Q", _willMsg =
// "\243x\161_\SUB\249f\DC3", _willProps = []}), _cleanSession = True, _keepAlive = 11821, _connID = "\EOT", _properties
// = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x57, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc6, 0x2e, 0x2d, 0x0,  0x1,  0x4,
                   0x0,  0x1c, 0x3c, 0xa6, 0xd8, 0x7b, 0xde, 0x7,  0x2,  0xee, 0x99, 0xd,  0x64, 0xa6, 0x5a,
                   0x6d, 0xce, 0x4a, 0x48, 0xb,  0x4f, 0xf2, 0x8f, 0x37, 0xa3, 0xad, 0xe9, 0x4,  0x26, 0x51,
                   0x0,  0x8,  0xf3, 0x78, 0xa1, 0x5f, 0x1a, 0xf9, 0x66, 0x13, 0x0,  0x8,  0x47, 0x4d, 0x30,
                   0x29, 0xb6, 0x9d, 0x39, 0x73, 0x0,  0x16, 0x6e, 0x42, 0x4b, 0x8e, 0x6d, 0x7f, 0xf8, 0x7e,
                   0xaf, 0x57, 0xa9, 0x6f, 0x57, 0xad, 0xb0, 0x19, 0x37, 0xf5, 0xde, 0x63, 0x25, 0xb1};

  uint8_t buf[99] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3c, 0xa6, 0xd8, 0x7b, 0xde, 0x7,  0x2,  0xee, 0x99, 0xd,  0x64, 0xa6, 0x5a, 0x6d,
                                0xce, 0x4a, 0x48, 0xb,  0x4f, 0xf2, 0x8f, 0x37, 0xa3, 0xad, 0xe9, 0x4,  0x26, 0x51};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf3, 0x78, 0xa1, 0x5f, 0x1a, 0xf9, 0x66, 0x13};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11821;
  uint8_t client_id_bytes[] = {0x4};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x47, 0x4d, 0x30, 0x29, 0xb6, 0x9d, 0x39, 0x73};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6e, 0x42, 0x4b, 0x8e, 0x6d, 0x7f, 0xf8, 0x7e, 0xaf, 0x57, 0xa9,
                              0x6f, 0x57, 0xad, 0xb0, 0x19, 0x37, 0xf5, 0xde, 0x63, 0x25, 0xb1};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\213\218\180\190MN\136\210\233\DC2\224\201\191:0\161RI\197\210\192\GSV<in",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "5M\238\&7I\242\235`\tf_\249\133\177cq\DEL\233", _willMsg = "\249\202\250\150]\158(|\248\DEL;;yp*\165\193",
// _willProps = []}), _cleanSession = True, _keepAlive = 20646, _connID = "i\186X\GSy-\255<", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x57, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x86, 0x50, 0xa6, 0x0,  0x8,  0x69,
                   0xba, 0x58, 0x1d, 0x79, 0x2d, 0xff, 0x3c, 0x0,  0x12, 0x35, 0x4d, 0xee, 0x37, 0x49, 0xf2,
                   0xeb, 0x60, 0x9,  0x66, 0x5f, 0xf9, 0x85, 0xb1, 0x63, 0x71, 0x7f, 0xe9, 0x0,  0x11, 0xf9,
                   0xca, 0xfa, 0x96, 0x5d, 0x9e, 0x28, 0x7c, 0xf8, 0x7f, 0x3b, 0x3b, 0x79, 0x70, 0x2a, 0xa5,
                   0xc1, 0x0,  0x1a, 0xd5, 0xda, 0xb4, 0xbe, 0x4d, 0x4e, 0x88, 0xd2, 0xe9, 0x12, 0xe0, 0xc9,
                   0xbf, 0x3a, 0x30, 0xa1, 0x52, 0x49, 0xc5, 0xd2, 0xc0, 0x1d, 0x56, 0x3c, 0x69, 0x6e};

  uint8_t buf[99] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x35, 0x4d, 0xee, 0x37, 0x49, 0xf2, 0xeb, 0x60, 0x9,
                                0x66, 0x5f, 0xf9, 0x85, 0xb1, 0x63, 0x71, 0x7f, 0xe9};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf9, 0xca, 0xfa, 0x96, 0x5d, 0x9e, 0x28, 0x7c, 0xf8,
                                  0x7f, 0x3b, 0x3b, 0x79, 0x70, 0x2a, 0xa5, 0xc1};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20646;
  uint8_t client_id_bytes[] = {0x69, 0xba, 0x58, 0x1d, 0x79, 0x2d, 0xff, 0x3c};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd5, 0xda, 0xb4, 0xbe, 0x4d, 0x4e, 0x88, 0xd2, 0xe9, 0x12, 0xe0, 0xc9, 0xbf,
                              0x3a, 0x30, 0xa1, 0x52, 0x49, 0xc5, 0xd2, 0xc0, 0x1d, 0x56, 0x3c, 0x69, 0x6e};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\181\225\241%KX\185'\148", _password = Just "\CAN(\"\ACKI\133\239\&64\253\241/>=",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\r|\168fB\231\&1h<y\t\FS\197\SI\NULz32\162\239s&\f\219\169\SIG\137\168", _willMsg = "\201\191\175\131M", _willProps
// = []}), _cleanSession = True, _keepAlive = 14170, _connID = "f\STX\217X\205pp\131\144\216u\131\222\211\161",
// _properties = []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x5c, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xee, 0x37, 0x5a, 0x0,  0xf,  0x66, 0x2,
                   0xd9, 0x58, 0xcd, 0x70, 0x70, 0x83, 0x90, 0xd8, 0x75, 0x83, 0xde, 0xd3, 0xa1, 0x0,  0x1d, 0xd,
                   0x7c, 0xa8, 0x66, 0x42, 0xe7, 0x31, 0x68, 0x3c, 0x79, 0x9,  0x1c, 0xc5, 0xf,  0x0,  0x7a, 0x33,
                   0x32, 0xa2, 0xef, 0x73, 0x26, 0xc,  0xdb, 0xa9, 0xf,  0x47, 0x89, 0xa8, 0x0,  0x5,  0xc9, 0xbf,
                   0xaf, 0x83, 0x4d, 0x0,  0x9,  0xb5, 0xe1, 0xf1, 0x25, 0x4b, 0x58, 0xb9, 0x27, 0x94, 0x0,  0xe,
                   0x18, 0x28, 0x22, 0x6,  0x49, 0x85, 0xef, 0x36, 0x34, 0xfd, 0xf1, 0x2f, 0x3e, 0x3d};

  uint8_t buf[104] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd,  0x7c, 0xa8, 0x66, 0x42, 0xe7, 0x31, 0x68, 0x3c, 0x79, 0x9, 0x1c, 0xc5, 0xf, 0x0,
                                0x7a, 0x33, 0x32, 0xa2, 0xef, 0x73, 0x26, 0xc,  0xdb, 0xa9, 0xf, 0x47, 0x89, 0xa8};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc9, 0xbf, 0xaf, 0x83, 0x4d};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14170;
  uint8_t client_id_bytes[] = {0x66, 0x2, 0xd9, 0x58, 0xcd, 0x70, 0x70, 0x83, 0x90, 0xd8, 0x75, 0x83, 0xde, 0xd3, 0xa1};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb5, 0xe1, 0xf1, 0x25, 0x4b, 0x58, 0xb9, 0x27, 0x94};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x28, 0x22, 0x6, 0x49, 0x85, 0xef, 0x36, 0x34, 0xfd, 0xf1, 0x2f, 0x3e, 0x3d};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\166\ETX\"\234D\249J8\176\230-", _password = Just "\181\"\ENQ\157\137L\US,",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "t\163\228", _willMsg =
// "\FS\227\151\f\191 \NUL\145\166!\154\157\205=\147|oE\SO\163\DC3\221\139\156\234\241\\(", _willProps = []}),
// _cleanSession = False, _keepAlive = 26482, _connID = "\203|M\250r7f|5\177\239", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x51, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x67, 0x72, 0x0,  0xb,  0xcb, 0x7c, 0x4d,
                   0xfa, 0x72, 0x37, 0x66, 0x7c, 0x35, 0xb1, 0xef, 0x0,  0x3,  0x74, 0xa3, 0xe4, 0x0,  0x1c, 0x1c, 0xe3,
                   0x97, 0xc,  0xbf, 0x20, 0x0,  0x91, 0xa6, 0x21, 0x9a, 0x9d, 0xcd, 0x3d, 0x93, 0x7c, 0x6f, 0x45, 0xe,
                   0xa3, 0x13, 0xdd, 0x8b, 0x9c, 0xea, 0xf1, 0x5c, 0x28, 0x0,  0xb,  0xa6, 0x3,  0x22, 0xea, 0x44, 0xf9,
                   0x4a, 0x38, 0xb0, 0xe6, 0x2d, 0x0,  0x8,  0xb5, 0x22, 0x5,  0x9d, 0x89, 0x4c, 0x1f, 0x2c};

  uint8_t buf[93] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x74, 0xa3, 0xe4};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1c, 0xe3, 0x97, 0xc,  0xbf, 0x20, 0x0,  0x91, 0xa6, 0x21, 0x9a, 0x9d, 0xcd, 0x3d,
                                  0x93, 0x7c, 0x6f, 0x45, 0xe,  0xa3, 0x13, 0xdd, 0x8b, 0x9c, 0xea, 0xf1, 0x5c, 0x28};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26482;
  uint8_t client_id_bytes[] = {0xcb, 0x7c, 0x4d, 0xfa, 0x72, 0x37, 0x66, 0x7c, 0x35, 0xb1, 0xef};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa6, 0x3, 0x22, 0xea, 0x44, 0xf9, 0x4a, 0x38, 0xb0, 0xe6, 0x2d};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb5, 0x22, 0x5, 0x9d, 0x89, 0x4c, 0x1f, 0x2c};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\RSYG\vm5p\188\128\155\248\238J;\221\217B\211\170%\241\&9*R ",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\207\240\217\DLE\243\157", _willMsg =
// "\v\143\189\245\140\200_\255\201%\EOTa\240\ESC\170\&4\160\216\CAN\193O\ACK\245\EOT8vEam&", _willProps = []}),
// _cleanSession = False, _keepAlive = 4261, _connID = "T\208\249\166\143\DC3\200/\202", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x3d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x10, 0xa5, 0x0,  0x9,  0x54, 0xd0,
                   0xf9, 0xa6, 0x8f, 0x13, 0xc8, 0x2f, 0xca, 0x0,  0x6,  0xcf, 0xf0, 0xd9, 0x10, 0xf3, 0x9d, 0x0,
                   0x1e, 0xb,  0x8f, 0xbd, 0xf5, 0x8c, 0xc8, 0x5f, 0xff, 0xc9, 0x25, 0x4,  0x61, 0xf0, 0x1b, 0xaa,
                   0x34, 0xa0, 0xd8, 0x18, 0xc1, 0x4f, 0x6,  0xf5, 0x4,  0x38, 0x76, 0x45, 0x61, 0x6d, 0x26};

  uint8_t buf[73] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcf, 0xf0, 0xd9, 0x10, 0xf3, 0x9d};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb,  0x8f, 0xbd, 0xf5, 0x8c, 0xc8, 0x5f, 0xff, 0xc9, 0x25,
                                  0x4,  0x61, 0xf0, 0x1b, 0xaa, 0x34, 0xa0, 0xd8, 0x18, 0xc1,
                                  0x4f, 0x6,  0xf5, 0x4,  0x38, 0x76, 0x45, 0x61, 0x6d, 0x26};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4261;
  uint8_t client_id_bytes[] = {0x54, 0xd0, 0xf9, 0xa6, 0x8f, 0x13, 0xc8, 0x2f, 0xca};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x1e, 0x59, 0x47, 0xb,  0x6d, 0x35, 0x70, 0xbc, 0x80, 0x9b, 0xf8, 0xee, 0x4a,
                              0x3b, 0xdd, 0xd9, 0x42, 0xd3, 0xaa, 0x25, 0xf1, 0x39, 0x2a, 0x52, 0x20};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\241\185^\SOH4\186U}I\208\137\131M\161C\190\134\174(B\181", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "8\\s\tW\213@\b\174\150", _willMsg =
// "\245\248\244q)\133\&9%\158\ESC\a\252]Rco'^\200;", _willProps = []}), _cleanSession = True, _keepAlive = 15075,
// _connID = "~g'\172", _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x8e, 0x3a, 0xe3, 0x0,  0x4,  0x7e,
                   0x67, 0x27, 0xac, 0x0,  0xa,  0x38, 0x5c, 0x73, 0x9,  0x57, 0xd5, 0x40, 0x8,  0xae, 0x96,
                   0x0,  0x14, 0xf5, 0xf8, 0xf4, 0x71, 0x29, 0x85, 0x39, 0x25, 0x9e, 0x1b, 0x7,  0xfc, 0x5d,
                   0x52, 0x63, 0x6f, 0x27, 0x5e, 0xc8, 0x3b, 0x0,  0x15, 0xf1, 0xb9, 0x5e, 0x1,  0x34, 0xba,
                   0x55, 0x7d, 0x49, 0xd0, 0x89, 0x83, 0x4d, 0xa1, 0x43, 0xbe, 0x86, 0xae, 0x28, 0x42, 0xb5};

  uint8_t buf[85] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x38, 0x5c, 0x73, 0x9, 0x57, 0xd5, 0x40, 0x8, 0xae, 0x96};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf5, 0xf8, 0xf4, 0x71, 0x29, 0x85, 0x39, 0x25, 0x9e, 0x1b,
                                  0x7,  0xfc, 0x5d, 0x52, 0x63, 0x6f, 0x27, 0x5e, 0xc8, 0x3b};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 15075;
  uint8_t client_id_bytes[] = {0x7e, 0x67, 0x27, 0xac};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf1, 0xb9, 0x5e, 0x1,  0x34, 0xba, 0x55, 0x7d, 0x49, 0xd0, 0x89,
                              0x83, 0x4d, 0xa1, 0x43, 0xbe, 0x86, 0xae, 0x28, 0x42, 0xb5};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\\$\245\DELg\180\&6\136n\177S\153", _password = Nothing, _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\187\152\148yT\196\161\178\207\&7:s\148\144\169n\217\222n=u\190\f\147", _willMsg =
// "r\244\252S\171\236L\225\159\&2\192\246\223\255o)`\238\SOn\DC3", _willProps = [PropUserProperty "\"\202\175\250\f1P"
// "#\146\&6\222V{\147\145o\145",PropSubscriptionIdentifier 12,PropMaximumQoS 242,PropSubscriptionIdentifierAvailable
// 227,PropPayloadFormatIndicator 225,PropServerKeepAlive 634,PropMessageExpiryInterval 17255,PropTopicAlias
// 6501,PropSubscriptionIdentifierAvailable 163,PropServerReference
// "\156\210\219\147|C-U\164\164\195^!$s\163\136O\162\b\164\177\177\a\ENQ\SI\176",PropSessionExpiryInterval
// 8407,PropReceiveMaximum 6195,PropAuthenticationMethod "'x\180\132\203\&7",PropMessageExpiryInterval
// 17356,PropTopicAlias 15658,PropPayloadFormatIndicator 33,PropAuthenticationData
// "\206z\211G\253\206\EOT\215\&8\145g\197",PropServerKeepAlive 15035,PropMaximumQoS 20,PropCorrelationData
// "2V:]\177\SOH\FSU\"#1p\v1\214\164\147\185\221p\176\186",PropRetainAvailable 125]}), _cleanSession = False, _keepAlive
// = 12967, _connID = "\SI\255\178<\ETBPC\254\194 f:\152s}\165&\SO M`\251\NULx\STXiB", _properties = [PropReceiveMaximum
// 20333,PropSubscriptionIdentifierAvailable 181,PropRequestProblemInformation 241,PropTopicAliasMaximum
// 19826,PropAssignedClientIdentifier "\STX&",PropWildcardSubscriptionAvailable 16,PropMessageExpiryInterval
// 2481,PropSubscriptionIdentifier 3,PropMessageExpiryInterval 29790,PropRetainAvailable 51,PropMaximumQoS
// 175,PropMessageExpiryInterval 25868,PropSubscriptionIdentifierAvailable 209,PropMessageExpiryInterval
// 4206,PropPayloadFormatIndicator 43,PropPayloadFormatIndicator 55,PropTopicAliasMaximum 10371,PropServerKeepAlive
// 14124,PropWillDelayInterval 5820]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x10, 0xb8, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8c, 0x32, 0xa7, 0x3c, 0x21, 0x4f, 0x6d, 0x29, 0xb5,
      0x17, 0xf1, 0x22, 0x4d, 0x72, 0x12, 0x0,  0x2,  0x2,  0x26, 0x28, 0x10, 0x2,  0x0,  0x0,  0x9,  0xb1, 0xb,  0x3,
      0x2,  0x0,  0x0,  0x74, 0x5e, 0x25, 0x33, 0x24, 0xaf, 0x2,  0x0,  0x0,  0x65, 0xc,  0x29, 0xd1, 0x2,  0x0,  0x0,
      0x10, 0x6e, 0x1,  0x2b, 0x1,  0x37, 0x22, 0x28, 0x83, 0x13, 0x37, 0x2c, 0x18, 0x0,  0x0,  0x16, 0xbc, 0x0,  0x1b,
      0xf,  0xff, 0xb2, 0x3c, 0x17, 0x50, 0x43, 0xfe, 0xc2, 0x20, 0x66, 0x3a, 0x98, 0x73, 0x7d, 0xa5, 0x26, 0xe,  0x20,
      0x4d, 0x60, 0xfb, 0x0,  0x78, 0x2,  0x69, 0x42, 0x93, 0x1,  0x26, 0x0,  0x7,  0x22, 0xca, 0xaf, 0xfa, 0xc,  0x31,
      0x50, 0x0,  0xa,  0x23, 0x92, 0x36, 0xde, 0x56, 0x7b, 0x93, 0x91, 0x6f, 0x91, 0xb,  0xc,  0x24, 0xf2, 0x29, 0xe3,
      0x1,  0xe1, 0x13, 0x2,  0x7a, 0x2,  0x0,  0x0,  0x43, 0x67, 0x23, 0x19, 0x65, 0x29, 0xa3, 0x1c, 0x0,  0x1b, 0x9c,
      0xd2, 0xdb, 0x93, 0x7c, 0x43, 0x2d, 0x55, 0xa4, 0xa4, 0xc3, 0x5e, 0x21, 0x24, 0x73, 0xa3, 0x88, 0x4f, 0xa2, 0x8,
      0xa4, 0xb1, 0xb1, 0x7,  0x5,  0xf,  0xb0, 0x11, 0x0,  0x0,  0x20, 0xd7, 0x21, 0x18, 0x33, 0x15, 0x0,  0x6,  0x27,
      0x78, 0xb4, 0x84, 0xcb, 0x37, 0x2,  0x0,  0x0,  0x43, 0xcc, 0x23, 0x3d, 0x2a, 0x1,  0x21, 0x16, 0x0,  0xc,  0xce,
      0x7a, 0xd3, 0x47, 0xfd, 0xce, 0x4,  0xd7, 0x38, 0x91, 0x67, 0xc5, 0x13, 0x3a, 0xbb, 0x24, 0x14, 0x9,  0x0,  0x16,
      0x32, 0x56, 0x3a, 0x5d, 0xb1, 0x1,  0x1c, 0x55, 0x22, 0x23, 0x31, 0x70, 0xb,  0x31, 0xd6, 0xa4, 0x93, 0xb9, 0xdd,
      0x70, 0xb0, 0xba, 0x25, 0x7d, 0x0,  0x18, 0xbb, 0x98, 0x94, 0x79, 0x54, 0xc4, 0xa1, 0xb2, 0xcf, 0x37, 0x3a, 0x73,
      0x94, 0x90, 0xa9, 0x6e, 0xd9, 0xde, 0x6e, 0x3d, 0x75, 0xbe, 0xc,  0x93, 0x0,  0x15, 0x72, 0xf4, 0xfc, 0x53, 0xab,
      0xec, 0x4c, 0xe1, 0x9f, 0x32, 0xc0, 0xf6, 0xdf, 0xff, 0x6f, 0x29, 0x60, 0xee, 0xe,  0x6e, 0x13, 0x0,  0xc,  0x5c,
      0x24, 0xf5, 0x7f, 0x67, 0xb4, 0x36, 0x88, 0x6e, 0xb1, 0x53, 0x99};

  uint8_t buf[325] = {0};
  uint8_t bytesprops0[] = {0x2, 0x26};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20333}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19826}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2481}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 3}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29790}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25868}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4206}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10371}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14124}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5820}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x23, 0x92, 0x36, 0xde, 0x56, 0x7b, 0x93, 0x91, 0x6f, 0x91};
  uint8_t byteswillprops0[] = {0x22, 0xca, 0xaf, 0xfa, 0xc, 0x31, 0x50};
  uint8_t byteswillprops2[] = {0x9c, 0xd2, 0xdb, 0x93, 0x7c, 0x43, 0x2d, 0x55, 0xa4, 0xa4, 0xc3, 0x5e, 0x21, 0x24,
                               0x73, 0xa3, 0x88, 0x4f, 0xa2, 0x8,  0xa4, 0xb1, 0xb1, 0x7,  0x5,  0xf,  0xb0};
  uint8_t byteswillprops3[] = {0x27, 0x78, 0xb4, 0x84, 0xcb, 0x37};
  uint8_t byteswillprops4[] = {0xce, 0x7a, 0xd3, 0x47, 0xfd, 0xce, 0x4, 0xd7, 0x38, 0x91, 0x67, 0xc5};
  uint8_t byteswillprops5[] = {0x32, 0x56, 0x3a, 0x5d, 0xb1, 0x1,  0x1c, 0x55, 0x22, 0x23, 0x31,
                               0x70, 0xb,  0x31, 0xd6, 0xa4, 0x93, 0xb9, 0xdd, 0x70, 0xb0, 0xba};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {7, (char*)&byteswillprops0}, .v = {10, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 12}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 634}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17255}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6501}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8407}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6195}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17356}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15658}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15035}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 125}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbb, 0x98, 0x94, 0x79, 0x54, 0xc4, 0xa1, 0xb2, 0xcf, 0x37, 0x3a, 0x73,
                                0x94, 0x90, 0xa9, 0x6e, 0xd9, 0xde, 0x6e, 0x3d, 0x75, 0xbe, 0xc,  0x93};
  lwmqtt_string_t will_topic = {24, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x72, 0xf4, 0xfc, 0x53, 0xab, 0xec, 0x4c, 0xe1, 0x9f, 0x32, 0xc0,
                                  0xf6, 0xdf, 0xff, 0x6f, 0x29, 0x60, 0xee, 0xe,  0x6e, 0x13};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 12967;
  uint8_t client_id_bytes[] = {0xf,  0xff, 0xb2, 0x3c, 0x17, 0x50, 0x43, 0xfe, 0xc2, 0x20, 0x66, 0x3a, 0x98, 0x73,
                               0x7d, 0xa5, 0x26, 0xe,  0x20, 0x4d, 0x60, 0xfb, 0x0,  0x78, 0x2,  0x69, 0x42};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x5c, 0x24, 0xf5, 0x7f, 0x67, 0xb4, 0x36, 0x88, 0x6e, 0xb1, 0x53, 0x99};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "b\178\DC3\167\181\244O`\DLE\131\239\236)\NAK*\179`\210\203-\213\144\135\193\157\221\244\182", _lastWill = Just
// (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "5m\FS[\176f\152", _willMsg =
// "y\STX\EM\232\172\190s\130\201\153\199L\132n\189", _willProps = [PropUserProperty "\219\190\FS" ""]}), _cleanSession
// = True, _keepAlive = 11130, _connID = "\DELq\DLE\242s\179\EM\158\193\158\ACKPz", _properties =
// [PropResponseInformation "\150Z",PropAuthenticationData "\\\157",PropResponseTopic
// "=C\DC2\252\157P\DC1\FS\143\SUB\183\212%[s\221\242\150\246\170\159\180\221\ACK>4",PropRequestResponseInformation
// 187,PropSubscriptionIdentifier 14,PropUserProperty "\b3\241\"\155?\146\204+\204\236\203\ESCV"
// "n\193r\ESCA4\146\ESC\CAN\226\"\204\221\163c\224?\219]\229PD,\249\b\138",PropMaximumQoS
// 58,PropRequestProblemInformation 16,PropReceiveMaximum 8160,PropTopicAlias 23979]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x9f, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x26, 0x2b, 0x7a, 0x62, 0x1a, 0x0,  0x2,
                   0x96, 0x5a, 0x16, 0x0,  0x2,  0x5c, 0x9d, 0x8,  0x0,  0x1a, 0x3d, 0x43, 0x12, 0xfc, 0x9d, 0x50, 0x11,
                   0x1c, 0x8f, 0x1a, 0xb7, 0xd4, 0x25, 0x5b, 0x73, 0xdd, 0xf2, 0x96, 0xf6, 0xaa, 0x9f, 0xb4, 0xdd, 0x6,
                   0x3e, 0x34, 0x19, 0xbb, 0xb,  0xe,  0x26, 0x0,  0xe,  0x8,  0x33, 0xf1, 0x22, 0x9b, 0x3f, 0x92, 0xcc,
                   0x2b, 0xcc, 0xec, 0xcb, 0x1b, 0x56, 0x0,  0x1a, 0x6e, 0xc1, 0x72, 0x1b, 0x41, 0x34, 0x92, 0x1b, 0x18,
                   0xe2, 0x22, 0xcc, 0xdd, 0xa3, 0x63, 0xe0, 0x3f, 0xdb, 0x5d, 0xe5, 0x50, 0x44, 0x2c, 0xf9, 0x8,  0x8a,
                   0x24, 0x3a, 0x17, 0x10, 0x21, 0x1f, 0xe0, 0x23, 0x5d, 0xab, 0x0,  0xd,  0x7f, 0x71, 0x10, 0xf2, 0x73,
                   0xb3, 0x19, 0x9e, 0xc1, 0x9e, 0x6,  0x50, 0x7a, 0x8,  0x26, 0x0,  0x3,  0xdb, 0xbe, 0x1c, 0x0,  0x0,
                   0x0,  0x7,  0x35, 0x6d, 0x1c, 0x5b, 0xb0, 0x66, 0x98, 0x0,  0xf,  0x79, 0x2,  0x19, 0xe8, 0xac, 0xbe,
                   0x73, 0x82, 0xc9, 0x99, 0xc7, 0x4c, 0x84, 0x6e, 0xbd};

  uint8_t buf[172] = {0};
  uint8_t bytesprops0[] = {0x96, 0x5a};
  uint8_t bytesprops1[] = {0x5c, 0x9d};
  uint8_t bytesprops2[] = {0x3d, 0x43, 0x12, 0xfc, 0x9d, 0x50, 0x11, 0x1c, 0x8f, 0x1a, 0xb7, 0xd4, 0x25,
                           0x5b, 0x73, 0xdd, 0xf2, 0x96, 0xf6, 0xaa, 0x9f, 0xb4, 0xdd, 0x6,  0x3e, 0x34};
  uint8_t bytesprops4[] = {0x6e, 0xc1, 0x72, 0x1b, 0x41, 0x34, 0x92, 0x1b, 0x18, 0xe2, 0x22, 0xcc, 0xdd,
                           0xa3, 0x63, 0xe0, 0x3f, 0xdb, 0x5d, 0xe5, 0x50, 0x44, 0x2c, 0xf9, 0x8,  0x8a};
  uint8_t bytesprops3[] = {0x8, 0x33, 0xf1, 0x22, 0x9b, 0x3f, 0x92, 0xcc, 0x2b, 0xcc, 0xec, 0xcb, 0x1b, 0x56};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 14}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops3}, .v = {26, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8160}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23979}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0};
  uint8_t byteswillprops0[] = {0xdb, 0xbe, 0x1c};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {3, (char*)&byteswillprops0}, .v = {0, (char*)&byteswillprops1}}}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x35, 0x6d, 0x1c, 0x5b, 0xb0, 0x66, 0x98};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x79, 0x2,  0x19, 0xe8, 0xac, 0xbe, 0x73, 0x82,
                                  0xc9, 0x99, 0xc7, 0x4c, 0x84, 0x6e, 0xbd};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11130;
  uint8_t client_id_bytes[] = {0x7f, 0x71, 0x10, 0xf2, 0x73, 0xb3, 0x19, 0x9e, 0xc1, 0x9e, 0x6, 0x50, 0x7a};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x62, 0xb2, 0x13, 0xa7, 0xb5, 0xf4, 0x4f, 0x60, 0x10, 0x83, 0xef, 0xec, 0x29, 0x15,
                              0x2a, 0xb3, 0x60, 0xd2, 0xcb, 0x2d, 0xd5, 0x90, 0x87, 0xc1, 0x9d, 0xdd, 0xf4, 0xb6};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "$J\t\NUL\130\250\238\188R\250\153\177\ETB\216wo\RS9%X\251e#\SO\201\147", _password
// = Just "\\\218\240\185\155\162\192\252t\131\184HV\192\235", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS2, _willTopic = "\157\174", _willMsg = "\147\218", _willProps = [PropSubscriptionIdentifier
// 16,PropRequestProblemInformation 60,PropSharedSubscriptionAvailable 100,PropTopicAlias 27717,PropResponseInformation
// "A\\\245\160\210\f\181_\213mor\SO'h\213\182\187\172+9\183\214L",PropSessionExpiryInterval
// 1861,PropMessageExpiryInterval 9152,PropMaximumPacketSize 13235,PropWillDelayInterval 27953,PropWillDelayInterval
// 22815,PropSessionExpiryInterval 3149,PropServerKeepAlive 22221]}), _cleanSession = False, _keepAlive = 6678, _connID
// = "\179\rO`Y", _properties = [PropContentType "\186\149\132\SI\235\143\182\&8`\ENQ\146\150",PropMaximumQoS
// 120,PropMessageExpiryInterval 30,PropMaximumPacketSize 32305,PropAuthenticationData "\208\182e\180=a\205c\f\182Z)\DC3
// Aw\208w\209",PropAuthenticationData "\173\169\231\202z\249\GS\221\139F\181\242\185\146o>\225\139",PropContentType
// "\SO\t\SOH\229z\220p9\184\f\242\RSw\185(u\f\175\146\240",PropPayloadFormatIndicator 198,PropContentType
// "\186\234c\225\&9h\194\175\188.8At`u\189\240\240\144\139\237\149T\154(\196\243",PropContentType
// "|`\150\246\\\DC1\163F ]\187S\198\139:\176\230\251\&6\199\131r\198\192",PropMaximumQoS 91,PropMaximumQoS
// 204,PropMaximumQoS 189,PropCorrelationData "\249\227",PropAssignedClientIdentifier
// "\151Bz*\131j\231\233\234\192\230g\191\245\207\237\217I[\217",PropRequestProblemInformation
// 174,PropResponseInformation "\218\187\242\230\225\164b",PropSessionExpiryInterval
// 6339,PropSubscriptionIdentifierAvailable 124,PropTopicAliasMaximum 968,PropSharedSubscriptionAvailable
// 75,PropSubscriptionIdentifierAvailable 75,PropMaximumQoS 227,PropReasonString "$\235
// \255\DC4\151\179\FS_\181IR\152\183\218\204\&07\134\NAK\237s\131\252\&67\EM\169TC",PropMessageExpiryInterval 1337]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0x8a, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf4, 0x1a, 0x16, 0xfc, 0x1,  0x3,  0x0,  0xc,  0xba,
      0x95, 0x84, 0xf,  0xeb, 0x8f, 0xb6, 0x38, 0x60, 0x5,  0x92, 0x96, 0x24, 0x78, 0x2,  0x0,  0x0,  0x0,  0x1e, 0x27,
      0x0,  0x0,  0x7e, 0x31, 0x16, 0x0,  0x13, 0xd0, 0xb6, 0x65, 0xb4, 0x3d, 0x61, 0xcd, 0x63, 0xc,  0xb6, 0x5a, 0x29,
      0x13, 0x20, 0x41, 0x77, 0xd0, 0x77, 0xd1, 0x16, 0x0,  0x12, 0xad, 0xa9, 0xe7, 0xca, 0x7a, 0xf9, 0x1d, 0xdd, 0x8b,
      0x46, 0xb5, 0xf2, 0xb9, 0x92, 0x6f, 0x3e, 0xe1, 0x8b, 0x3,  0x0,  0x14, 0xe,  0x9,  0x1,  0xe5, 0x7a, 0xdc, 0x70,
      0x39, 0xb8, 0xc,  0xf2, 0x1e, 0x77, 0xb9, 0x28, 0x75, 0xc,  0xaf, 0x92, 0xf0, 0x1,  0xc6, 0x3,  0x0,  0x1b, 0xba,
      0xea, 0x63, 0xe1, 0x39, 0x68, 0xc2, 0xaf, 0xbc, 0x2e, 0x38, 0x41, 0x74, 0x60, 0x75, 0xbd, 0xf0, 0xf0, 0x90, 0x8b,
      0xed, 0x95, 0x54, 0x9a, 0x28, 0xc4, 0xf3, 0x3,  0x0,  0x18, 0x7c, 0x60, 0x96, 0xf6, 0x5c, 0x11, 0xa3, 0x46, 0x20,
      0x5d, 0xbb, 0x53, 0xc6, 0x8b, 0x3a, 0xb0, 0xe6, 0xfb, 0x36, 0xc7, 0x83, 0x72, 0xc6, 0xc0, 0x24, 0x5b, 0x24, 0xcc,
      0x24, 0xbd, 0x9,  0x0,  0x2,  0xf9, 0xe3, 0x12, 0x0,  0x14, 0x97, 0x42, 0x7a, 0x2a, 0x83, 0x6a, 0xe7, 0xe9, 0xea,
      0xc0, 0xe6, 0x67, 0xbf, 0xf5, 0xcf, 0xed, 0xd9, 0x49, 0x5b, 0xd9, 0x17, 0xae, 0x1a, 0x0,  0x7,  0xda, 0xbb, 0xf2,
      0xe6, 0xe1, 0xa4, 0x62, 0x11, 0x0,  0x0,  0x18, 0xc3, 0x29, 0x7c, 0x22, 0x3,  0xc8, 0x2a, 0x4b, 0x29, 0x4b, 0x24,
      0xe3, 0x1f, 0x0,  0x1e, 0x24, 0xeb, 0x20, 0xff, 0x14, 0x97, 0xb3, 0x1c, 0x5f, 0xb5, 0x49, 0x52, 0x98, 0xb7, 0xda,
      0xcc, 0x30, 0x37, 0x86, 0x15, 0xed, 0x73, 0x83, 0xfc, 0x36, 0x37, 0x19, 0xa9, 0x54, 0x43, 0x2,  0x0,  0x0,  0x5,
      0x39, 0x0,  0x5,  0xb3, 0xd,  0x4f, 0x60, 0x59, 0x45, 0xb,  0x10, 0x17, 0x3c, 0x2a, 0x64, 0x23, 0x6c, 0x45, 0x1a,
      0x0,  0x18, 0x41, 0x5c, 0xf5, 0xa0, 0xd2, 0xc,  0xb5, 0x5f, 0xd5, 0x6d, 0x6f, 0x72, 0xe,  0x27, 0x68, 0xd5, 0xb6,
      0xbb, 0xac, 0x2b, 0x39, 0xb7, 0xd6, 0x4c, 0x11, 0x0,  0x0,  0x7,  0x45, 0x2,  0x0,  0x0,  0x23, 0xc0, 0x27, 0x0,
      0x0,  0x33, 0xb3, 0x18, 0x0,  0x0,  0x6d, 0x31, 0x18, 0x0,  0x0,  0x59, 0x1f, 0x11, 0x0,  0x0,  0xc,  0x4d, 0x13,
      0x56, 0xcd, 0x0,  0x2,  0x9d, 0xae, 0x0,  0x2,  0x93, 0xda, 0x0,  0x1a, 0x24, 0x4a, 0x9,  0x0,  0x82, 0xfa, 0xee,
      0xbc, 0x52, 0xfa, 0x99, 0xb1, 0x17, 0xd8, 0x77, 0x6f, 0x1e, 0x39, 0x25, 0x58, 0xfb, 0x65, 0x23, 0xe,  0xc9, 0x93,
      0x0,  0xf,  0x5c, 0xda, 0xf0, 0xb9, 0x9b, 0xa2, 0xc0, 0xfc, 0x74, 0x83, 0xb8, 0x48, 0x56, 0xc0, 0xeb};

  uint8_t buf[407] = {0};
  uint8_t bytesprops0[] = {0xba, 0x95, 0x84, 0xf, 0xeb, 0x8f, 0xb6, 0x38, 0x60, 0x5, 0x92, 0x96};
  uint8_t bytesprops1[] = {0xd0, 0xb6, 0x65, 0xb4, 0x3d, 0x61, 0xcd, 0x63, 0xc, 0xb6,
                           0x5a, 0x29, 0x13, 0x20, 0x41, 0x77, 0xd0, 0x77, 0xd1};
  uint8_t bytesprops2[] = {0xad, 0xa9, 0xe7, 0xca, 0x7a, 0xf9, 0x1d, 0xdd, 0x8b,
                           0x46, 0xb5, 0xf2, 0xb9, 0x92, 0x6f, 0x3e, 0xe1, 0x8b};
  uint8_t bytesprops3[] = {0xe,  0x9,  0x1,  0xe5, 0x7a, 0xdc, 0x70, 0x39, 0xb8, 0xc,
                           0xf2, 0x1e, 0x77, 0xb9, 0x28, 0x75, 0xc,  0xaf, 0x92, 0xf0};
  uint8_t bytesprops4[] = {0xba, 0xea, 0x63, 0xe1, 0x39, 0x68, 0xc2, 0xaf, 0xbc, 0x2e, 0x38, 0x41, 0x74, 0x60,
                           0x75, 0xbd, 0xf0, 0xf0, 0x90, 0x8b, 0xed, 0x95, 0x54, 0x9a, 0x28, 0xc4, 0xf3};
  uint8_t bytesprops5[] = {0x7c, 0x60, 0x96, 0xf6, 0x5c, 0x11, 0xa3, 0x46, 0x20, 0x5d, 0xbb, 0x53,
                           0xc6, 0x8b, 0x3a, 0xb0, 0xe6, 0xfb, 0x36, 0xc7, 0x83, 0x72, 0xc6, 0xc0};
  uint8_t bytesprops6[] = {0xf9, 0xe3};
  uint8_t bytesprops7[] = {0x97, 0x42, 0x7a, 0x2a, 0x83, 0x6a, 0xe7, 0xe9, 0xea, 0xc0,
                           0xe6, 0x67, 0xbf, 0xf5, 0xcf, 0xed, 0xd9, 0x49, 0x5b, 0xd9};
  uint8_t bytesprops8[] = {0xda, 0xbb, 0xf2, 0xe6, 0xe1, 0xa4, 0x62};
  uint8_t bytesprops9[] = {0x24, 0xeb, 0x20, 0xff, 0x14, 0x97, 0xb3, 0x1c, 0x5f, 0xb5, 0x49, 0x52, 0x98, 0xb7, 0xda,
                           0xcc, 0x30, 0x37, 0x86, 0x15, 0xed, 0x73, 0x83, 0xfc, 0x36, 0x37, 0x19, 0xa9, 0x54, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32305}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6339}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 968}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1337}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x41, 0x5c, 0xf5, 0xa0, 0xd2, 0xc,  0xb5, 0x5f, 0xd5, 0x6d, 0x6f, 0x72,
                               0xe,  0x27, 0x68, 0xd5, 0xb6, 0xbb, 0xac, 0x2b, 0x39, 0xb7, 0xd6, 0x4c};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 16}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27717}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1861}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9152}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13235}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27953}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22815}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3149}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22221}},
  };

  lwmqtt_properties_t willprops = {12, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x9d, 0xae};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x93, 0xda};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 6678;
  uint8_t client_id_bytes[] = {0xb3, 0xd, 0x4f, 0x60, 0x59};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x24, 0x4a, 0x9,  0x0,  0x82, 0xfa, 0xee, 0xbc, 0x52, 0xfa, 0x99, 0xb1, 0x17,
                              0xd8, 0x77, 0x6f, 0x1e, 0x39, 0x25, 0x58, 0xfb, 0x65, 0x23, 0xe,  0xc9, 0x93};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x5c, 0xda, 0xf0, 0xb9, 0x9b, 0xa2, 0xc0, 0xfc, 0x74, 0x83, 0xb8, 0x48, 0x56, 0xc0, 0xeb};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\ETX\162\182\251\&5\254\129A\181!!/
// \229\172\171\204\210R\201\DC1\250\190\&4_\"X\154", _password = Nothing, _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\130\DEL/\236|]", _willMsg = "\161\186\166\161\248x\189;\ETX\167", _willProps =
// [PropRequestResponseInformation 130,PropServerReference
// "4\222\196\&3\DC3d]\170|P\DC4\202\227\155\132\186l\157\199\235\140y\SUB\240\&5\174i\200/",PropContentType
// "\153\136&9\RS\230dLF%MsS\174{\148",PropMessageExpiryInterval 1267,PropWillDelayInterval 6184,PropMaximumPacketSize
// 271,PropReceiveMaximum 8643,PropSessionExpiryInterval 24954,PropResponseTopic
// "+\170.#lf\189\RS);6\240\&7\158]\DC4g\DLE\219>\242\DC3\235",PropWildcardSubscriptionAvailable
// 62,PropSharedSubscriptionAvailable 46,PropUserProperty "s\196\SOH"
// "\128\168\193o\150\214\142\139p\130\181\147c\254w",PropRequestProblemInformation 181,PropMessageExpiryInterval
// 28708,PropResponseInformation "^@{g\166by\ENQ\250\196Y\141\164\161ft\161\190$M"]}), _cleanSession = False, _keepAlive
// = 31398, _connID = "\165=K\CAN\208~\SYN\241*\f6#\208H\198\177p.", _properties = [PropReceiveMaximum
// 30115,PropUserProperty "\ETX\163\192\tV\NUL:9\174\227\135\255\152p\234M\DC1\238%x9+\200\162?"
// "\145\175",PropContentType "h\187\229G\240gt\253\&1",PropAssignedClientIdentifier
// "b\200\188Y\152\218\153\228f\217",PropResponseTopic "\r^]\176\204\197\t\200m.@8s"]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xbe, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x94, 0x7a, 0xa6, 0x4c, 0x21, 0x75, 0xa3, 0x26, 0x0,
      0x19, 0x3,  0xa3, 0xc0, 0x9,  0x56, 0x0,  0x3a, 0x39, 0xae, 0xe3, 0x87, 0xff, 0x98, 0x70, 0xea, 0x4d, 0x11, 0xee,
      0x25, 0x78, 0x39, 0x2b, 0xc8, 0xa2, 0x3f, 0x0,  0x2,  0x91, 0xaf, 0x3,  0x0,  0x9,  0x68, 0xbb, 0xe5, 0x47, 0xf0,
      0x67, 0x74, 0xfd, 0x31, 0x12, 0x0,  0xa,  0x62, 0xc8, 0xbc, 0x59, 0x98, 0xda, 0x99, 0xe4, 0x66, 0xd9, 0x8,  0x0,
      0xd,  0xd,  0x5e, 0x5d, 0xb0, 0xcc, 0xc5, 0x9,  0xc8, 0x6d, 0x2e, 0x40, 0x38, 0x73, 0x0,  0x12, 0xa5, 0x3d, 0x4b,
      0x18, 0xd0, 0x7e, 0x16, 0xf1, 0x2a, 0xc,  0x36, 0x23, 0xd0, 0x48, 0xc6, 0xb1, 0x70, 0x2e, 0x9f, 0x1,  0x19, 0x82,
      0x1c, 0x0,  0x1d, 0x34, 0xde, 0xc4, 0x33, 0x13, 0x64, 0x5d, 0xaa, 0x7c, 0x50, 0x14, 0xca, 0xe3, 0x9b, 0x84, 0xba,
      0x6c, 0x9d, 0xc7, 0xeb, 0x8c, 0x79, 0x1a, 0xf0, 0x35, 0xae, 0x69, 0xc8, 0x2f, 0x3,  0x0,  0x10, 0x99, 0x88, 0x26,
      0x39, 0x1e, 0xe6, 0x64, 0x4c, 0x46, 0x25, 0x4d, 0x73, 0x53, 0xae, 0x7b, 0x94, 0x2,  0x0,  0x0,  0x4,  0xf3, 0x18,
      0x0,  0x0,  0x18, 0x28, 0x27, 0x0,  0x0,  0x1,  0xf,  0x21, 0x21, 0xc3, 0x11, 0x0,  0x0,  0x61, 0x7a, 0x8,  0x0,
      0x17, 0x2b, 0xaa, 0x2e, 0x23, 0x6c, 0x66, 0xbd, 0x1e, 0x29, 0x3b, 0x36, 0xf0, 0x37, 0x9e, 0x5d, 0x14, 0x67, 0x10,
      0xdb, 0x3e, 0xf2, 0x13, 0xeb, 0x28, 0x3e, 0x2a, 0x2e, 0x26, 0x0,  0x3,  0x73, 0xc4, 0x1,  0x0,  0xf,  0x80, 0xa8,
      0xc1, 0x6f, 0x96, 0xd6, 0x8e, 0x8b, 0x70, 0x82, 0xb5, 0x93, 0x63, 0xfe, 0x77, 0x17, 0xb5, 0x2,  0x0,  0x0,  0x70,
      0x24, 0x1a, 0x0,  0x14, 0x5e, 0x40, 0x7b, 0x67, 0xa6, 0x62, 0x79, 0x5,  0xfa, 0xc4, 0x59, 0x8d, 0xa4, 0xa1, 0x66,
      0x74, 0xa1, 0xbe, 0x24, 0x4d, 0x0,  0x6,  0x82, 0x7f, 0x2f, 0xec, 0x7c, 0x5d, 0x0,  0xa,  0xa1, 0xba, 0xa6, 0xa1,
      0xf8, 0x78, 0xbd, 0x3b, 0x3,  0xa7, 0x0,  0x1c, 0x3,  0xa2, 0xb6, 0xfb, 0x35, 0xfe, 0x81, 0x41, 0xb5, 0x21, 0x21,
      0x2f, 0x20, 0xe5, 0xac, 0xab, 0xcc, 0xd2, 0x52, 0xc9, 0x11, 0xfa, 0xbe, 0x34, 0x5f, 0x22, 0x58, 0x9a};

  uint8_t buf[331] = {0};
  uint8_t bytesprops1[] = {0x91, 0xaf};
  uint8_t bytesprops0[] = {0x3,  0xa3, 0xc0, 0x9,  0x56, 0x0,  0x3a, 0x39, 0xae, 0xe3, 0x87, 0xff, 0x98,
                           0x70, 0xea, 0x4d, 0x11, 0xee, 0x25, 0x78, 0x39, 0x2b, 0xc8, 0xa2, 0x3f};
  uint8_t bytesprops2[] = {0x68, 0xbb, 0xe5, 0x47, 0xf0, 0x67, 0x74, 0xfd, 0x31};
  uint8_t bytesprops3[] = {0x62, 0xc8, 0xbc, 0x59, 0x98, 0xda, 0x99, 0xe4, 0x66, 0xd9};
  uint8_t bytesprops4[] = {0xd, 0x5e, 0x5d, 0xb0, 0xcc, 0xc5, 0x9, 0xc8, 0x6d, 0x2e, 0x40, 0x38, 0x73};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30115}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops0}, .v = {2, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x34, 0xde, 0xc4, 0x33, 0x13, 0x64, 0x5d, 0xaa, 0x7c, 0x50, 0x14, 0xca, 0xe3, 0x9b, 0x84,
                               0xba, 0x6c, 0x9d, 0xc7, 0xeb, 0x8c, 0x79, 0x1a, 0xf0, 0x35, 0xae, 0x69, 0xc8, 0x2f};
  uint8_t byteswillprops1[] = {0x99, 0x88, 0x26, 0x39, 0x1e, 0xe6, 0x64, 0x4c,
                               0x46, 0x25, 0x4d, 0x73, 0x53, 0xae, 0x7b, 0x94};
  uint8_t byteswillprops2[] = {0x2b, 0xaa, 0x2e, 0x23, 0x6c, 0x66, 0xbd, 0x1e, 0x29, 0x3b, 0x36, 0xf0,
                               0x37, 0x9e, 0x5d, 0x14, 0x67, 0x10, 0xdb, 0x3e, 0xf2, 0x13, 0xeb};
  uint8_t byteswillprops4[] = {0x80, 0xa8, 0xc1, 0x6f, 0x96, 0xd6, 0x8e, 0x8b,
                               0x70, 0x82, 0xb5, 0x93, 0x63, 0xfe, 0x77};
  uint8_t byteswillprops3[] = {0x73, 0xc4, 0x1};
  uint8_t byteswillprops5[] = {0x5e, 0x40, 0x7b, 0x67, 0xa6, 0x62, 0x79, 0x5,  0xfa, 0xc4,
                               0x59, 0x8d, 0xa4, 0xa1, 0x66, 0x74, 0xa1, 0xbe, 0x24, 0x4d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1267}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6184}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 271}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8643}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24954}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {3, (char*)&byteswillprops3}, .v = {15, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28708}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x82, 0x7f, 0x2f, 0xec, 0x7c, 0x5d};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa1, 0xba, 0xa6, 0xa1, 0xf8, 0x78, 0xbd, 0x3b, 0x3, 0xa7};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 31398;
  uint8_t client_id_bytes[] = {0xa5, 0x3d, 0x4b, 0x18, 0xd0, 0x7e, 0x16, 0xf1, 0x2a,
                               0xc,  0x36, 0x23, 0xd0, 0x48, 0xc6, 0xb1, 0x70, 0x2e};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3,  0xa2, 0xb6, 0xfb, 0x35, 0xfe, 0x81, 0x41, 0xb5, 0x21, 0x21, 0x2f, 0x20, 0xe5,
                              0xac, 0xab, 0xcc, 0xd2, 0x52, 0xc9, 0x11, 0xfa, 0xbe, 0x34, 0x5f, 0x22, 0x58, 0x9a};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "GM0)\182\157\&9s", _password = Just
// "nBK\142m\DEL\248~\175W\169oW\173\176\EM7\245\222c%\177", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS0, _willTopic = "<\166\216{\222\a\STX\238\153\rd\166Zm\206JH\vO\242\143\&7\163\173\233\EOT&Q", _willMsg =
// "\243x\161_\SUB\249f\DC3", _willProps = [PropTopicAlias 10344,PropResponseTopic "\155\GSe\SOH",PropServerKeepAlive
// 30085,PropSubscriptionIdentifierAvailable 184,PropContentType "nd\196\144",PropMaximumQoS 106,PropResponseInformation
// "\160\227\209\224CJR\217\216o\223\254\245m\156\216\207c",PropTopicAliasMaximum 22542,PropRetainAvailable
// 48,PropRequestResponseInformation 118,PropMessageExpiryInterval 7982,PropWillDelayInterval 11886]}), _cleanSession =
// True, _keepAlive = 11821, _connID = "\EOT", _properties = [PropReasonString
// "NIX$\246\251\&3\135\187#\132\212G\174\SUB\RS\246\201\157\DC2\155v\138\176=r\192\149\246",PropTopicAlias
// 8083,PropUserProperty "\129\205[0\239\164\254'x\139\197\216\161,\NUL\241<"
// "\140\SI\SO\197\&8\232\243h@\142\163,i\209\244\226B\STXk\255 ",PropAuthenticationMethod
// "\202\&6\ETB\DC4Q\137\197\195\v?\162\224\&5\152\130\217\195"]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0xf9, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc6, 0x2e, 0x2d, 0x62, 0x1f, 0x0,  0x1d,
                   0x4e, 0x49, 0x58, 0x24, 0xf6, 0xfb, 0x33, 0x87, 0xbb, 0x23, 0x84, 0xd4, 0x47, 0xae, 0x1a, 0x1e, 0xf6,
                   0xc9, 0x9d, 0x12, 0x9b, 0x76, 0x8a, 0xb0, 0x3d, 0x72, 0xc0, 0x95, 0xf6, 0x23, 0x1f, 0x93, 0x26, 0x0,
                   0x11, 0x81, 0xcd, 0x5b, 0x30, 0xef, 0xa4, 0xfe, 0x27, 0x78, 0x8b, 0xc5, 0xd8, 0xa1, 0x2c, 0x0,  0xf1,
                   0x3c, 0x0,  0x15, 0x8c, 0xf,  0xe,  0xc5, 0x38, 0xe8, 0xf3, 0x68, 0x40, 0x8e, 0xa3, 0x2c, 0x69, 0xd1,
                   0xf4, 0xe2, 0x42, 0x2,  0x6b, 0xff, 0x20, 0x15, 0x0,  0x11, 0xca, 0x36, 0x17, 0x14, 0x51, 0x89, 0xc5,
                   0xc3, 0xb,  0x3f, 0xa2, 0xe0, 0x35, 0x98, 0x82, 0xd9, 0xc3, 0x0,  0x1,  0x4,  0x3e, 0x23, 0x28, 0x68,
                   0x8,  0x0,  0x4,  0x9b, 0x1d, 0x65, 0x1,  0x13, 0x75, 0x85, 0x29, 0xb8, 0x3,  0x0,  0x4,  0x6e, 0x64,
                   0xc4, 0x90, 0x24, 0x6a, 0x1a, 0x0,  0x12, 0xa0, 0xe3, 0xd1, 0xe0, 0x43, 0x4a, 0x52, 0xd9, 0xd8, 0x6f,
                   0xdf, 0xfe, 0xf5, 0x6d, 0x9c, 0xd8, 0xcf, 0x63, 0x22, 0x58, 0xe,  0x25, 0x30, 0x19, 0x76, 0x2,  0x0,
                   0x0,  0x1f, 0x2e, 0x18, 0x0,  0x0,  0x2e, 0x6e, 0x0,  0x1c, 0x3c, 0xa6, 0xd8, 0x7b, 0xde, 0x7,  0x2,
                   0xee, 0x99, 0xd,  0x64, 0xa6, 0x5a, 0x6d, 0xce, 0x4a, 0x48, 0xb,  0x4f, 0xf2, 0x8f, 0x37, 0xa3, 0xad,
                   0xe9, 0x4,  0x26, 0x51, 0x0,  0x8,  0xf3, 0x78, 0xa1, 0x5f, 0x1a, 0xf9, 0x66, 0x13, 0x0,  0x8,  0x47,
                   0x4d, 0x30, 0x29, 0xb6, 0x9d, 0x39, 0x73, 0x0,  0x16, 0x6e, 0x42, 0x4b, 0x8e, 0x6d, 0x7f, 0xf8, 0x7e,
                   0xaf, 0x57, 0xa9, 0x6f, 0x57, 0xad, 0xb0, 0x19, 0x37, 0xf5, 0xde, 0x63, 0x25, 0xb1};

  uint8_t buf[262] = {0};
  uint8_t bytesprops0[] = {0x4e, 0x49, 0x58, 0x24, 0xf6, 0xfb, 0x33, 0x87, 0xbb, 0x23, 0x84, 0xd4, 0x47, 0xae, 0x1a,
                           0x1e, 0xf6, 0xc9, 0x9d, 0x12, 0x9b, 0x76, 0x8a, 0xb0, 0x3d, 0x72, 0xc0, 0x95, 0xf6};
  uint8_t bytesprops2[] = {0x8c, 0xf,  0xe,  0xc5, 0x38, 0xe8, 0xf3, 0x68, 0x40, 0x8e, 0xa3,
                           0x2c, 0x69, 0xd1, 0xf4, 0xe2, 0x42, 0x2,  0x6b, 0xff, 0x20};
  uint8_t bytesprops1[] = {0x81, 0xcd, 0x5b, 0x30, 0xef, 0xa4, 0xfe, 0x27, 0x78,
                           0x8b, 0xc5, 0xd8, 0xa1, 0x2c, 0x0,  0xf1, 0x3c};
  uint8_t bytesprops3[] = {0xca, 0x36, 0x17, 0x14, 0x51, 0x89, 0xc5, 0xc3, 0xb,
                           0x3f, 0xa2, 0xe0, 0x35, 0x98, 0x82, 0xd9, 0xc3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8083}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops1}, .v = {21, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x9b, 0x1d, 0x65, 0x1};
  uint8_t byteswillprops1[] = {0x6e, 0x64, 0xc4, 0x90};
  uint8_t byteswillprops2[] = {0xa0, 0xe3, 0xd1, 0xe0, 0x43, 0x4a, 0x52, 0xd9, 0xd8,
                               0x6f, 0xdf, 0xfe, 0xf5, 0x6d, 0x9c, 0xd8, 0xcf, 0x63};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10344}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30085}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22542}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7982}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11886}},
  };

  lwmqtt_properties_t willprops = {12, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3c, 0xa6, 0xd8, 0x7b, 0xde, 0x7,  0x2,  0xee, 0x99, 0xd,  0x64, 0xa6, 0x5a, 0x6d,
                                0xce, 0x4a, 0x48, 0xb,  0x4f, 0xf2, 0x8f, 0x37, 0xa3, 0xad, 0xe9, 0x4,  0x26, 0x51};
  lwmqtt_string_t will_topic = {28, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf3, 0x78, 0xa1, 0x5f, 0x1a, 0xf9, 0x66, 0x13};
  lwmqtt_string_t will_payload = {8, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 11821;
  uint8_t client_id_bytes[] = {0x4};
  lwmqtt_string_t client_id = {1, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x47, 0x4d, 0x30, 0x29, 0xb6, 0x9d, 0x39, 0x73};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x6e, 0x42, 0x4b, 0x8e, 0x6d, 0x7f, 0xf8, 0x7e, 0xaf, 0x57, 0xa9,
                              0x6f, 0x57, 0xad, 0xb0, 0x19, 0x37, 0xf5, 0xde, 0x63, 0x25, 0xb1};
  lwmqtt_string_t password = {22, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\213\218\180\190MN\136\210\233\DC2\224\201\191:0\161RI\197\210\192\GSV<in",
// _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic =
// "5M\238\&7I\242\235`\tf_\249\133\177cq\DEL\233", _willMsg = "\249\202\250\150]\158(|\248\DEL;;yp*\165\193",
// _willProps = [PropRequestResponseInformation 126,PropContentType
// "\228\186\&1@\233\202\199\245\167\149\242\132\221\ETB\214a\CAN\220\DC4vD",PropMessageExpiryInterval
// 4692,PropRequestResponseInformation 6,PropTopicAlias 4459,PropSubscriptionIdentifier
// 20,PropRequestResponseInformation 58,PropTopicAlias 13618,PropServerReference
// "'\222\143\240#\242\180L\SYN\241\230\DC3\ESC\154\223\237Rw\FS",PropAuthenticationData "\206\200\v"]}), _cleanSession
// = True, _keepAlive = 20646, _connID = "i\186X\GSy-\255<", _properties = [PropServerReference
// "m\132\&9\254\217/\SI\158"]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0xab, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x86, 0x50, 0xa6, 0xb,  0x1c, 0x0,
                   0x8,  0x6d, 0x84, 0x39, 0xfe, 0xd9, 0x2f, 0xf,  0x9e, 0x0,  0x8,  0x69, 0xba, 0x58, 0x1d, 0x79,
                   0x2d, 0xff, 0x3c, 0x47, 0x19, 0x7e, 0x3,  0x0,  0x15, 0xe4, 0xba, 0x31, 0x40, 0xe9, 0xca, 0xc7,
                   0xf5, 0xa7, 0x95, 0xf2, 0x84, 0xdd, 0x17, 0xd6, 0x61, 0x18, 0xdc, 0x14, 0x76, 0x44, 0x2,  0x0,
                   0x0,  0x12, 0x54, 0x19, 0x6,  0x23, 0x11, 0x6b, 0xb,  0x14, 0x19, 0x3a, 0x23, 0x35, 0x32, 0x1c,
                   0x0,  0x13, 0x27, 0xde, 0x8f, 0xf0, 0x23, 0xf2, 0xb4, 0x4c, 0x16, 0xf1, 0xe6, 0x13, 0x1b, 0x9a,
                   0xdf, 0xed, 0x52, 0x77, 0x1c, 0x16, 0x0,  0x3,  0xce, 0xc8, 0xb,  0x0,  0x12, 0x35, 0x4d, 0xee,
                   0x37, 0x49, 0xf2, 0xeb, 0x60, 0x9,  0x66, 0x5f, 0xf9, 0x85, 0xb1, 0x63, 0x71, 0x7f, 0xe9, 0x0,
                   0x11, 0xf9, 0xca, 0xfa, 0x96, 0x5d, 0x9e, 0x28, 0x7c, 0xf8, 0x7f, 0x3b, 0x3b, 0x79, 0x70, 0x2a,
                   0xa5, 0xc1, 0x0,  0x1a, 0xd5, 0xda, 0xb4, 0xbe, 0x4d, 0x4e, 0x88, 0xd2, 0xe9, 0x12, 0xe0, 0xc9,
                   0xbf, 0x3a, 0x30, 0xa1, 0x52, 0x49, 0xc5, 0xd2, 0xc0, 0x1d, 0x56, 0x3c, 0x69, 0x6e};

  uint8_t buf[184] = {0};
  uint8_t bytesprops0[] = {0x6d, 0x84, 0x39, 0xfe, 0xd9, 0x2f, 0xf, 0x9e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xe4, 0xba, 0x31, 0x40, 0xe9, 0xca, 0xc7, 0xf5, 0xa7, 0x95, 0xf2,
                               0x84, 0xdd, 0x17, 0xd6, 0x61, 0x18, 0xdc, 0x14, 0x76, 0x44};
  uint8_t byteswillprops1[] = {0x27, 0xde, 0x8f, 0xf0, 0x23, 0xf2, 0xb4, 0x4c, 0x16, 0xf1,
                               0xe6, 0x13, 0x1b, 0x9a, 0xdf, 0xed, 0x52, 0x77, 0x1c};
  uint8_t byteswillprops2[] = {0xce, 0xc8, 0xb};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4692}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4459}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13618}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&byteswillprops2}}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x35, 0x4d, 0xee, 0x37, 0x49, 0xf2, 0xeb, 0x60, 0x9,
                                0x66, 0x5f, 0xf9, 0x85, 0xb1, 0x63, 0x71, 0x7f, 0xe9};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf9, 0xca, 0xfa, 0x96, 0x5d, 0x9e, 0x28, 0x7c, 0xf8,
                                  0x7f, 0x3b, 0x3b, 0x79, 0x70, 0x2a, 0xa5, 0xc1};
  lwmqtt_string_t will_payload = {17, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 20646;
  uint8_t client_id_bytes[] = {0x69, 0xba, 0x58, 0x1d, 0x79, 0x2d, 0xff, 0x3c};
  lwmqtt_string_t client_id = {8, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xd5, 0xda, 0xb4, 0xbe, 0x4d, 0x4e, 0x88, 0xd2, 0xe9, 0x12, 0xe0, 0xc9, 0xbf,
                              0x3a, 0x30, 0xa1, 0x52, 0x49, 0xc5, 0xd2, 0xc0, 0x1d, 0x56, 0x3c, 0x69, 0x6e};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\181\225\241%KX\185'\148", _password = Just "\CAN(\"\ACKI\133\239\&64\253\241/>=",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\r|\168fB\231\&1h<y\t\FS\197\SI\NULz32\162\239s&\f\219\169\SIG\137\168", _willMsg = "\201\191\175\131M", _willProps
// = [PropRetainAvailable 173,PropReasonString "\248\223);;C\135",PropRequestResponseInformation 111,PropContentType
// "\239a:+\141\a}\149\237$o\241oi\178\164",PropUserProperty "#\137H}\234\245"
// "\NUL,\206]\167O\DC2\213\135\DC4U\144\162\163\212\SI0_\214{\147\196\143\174\186R64",PropMaximumQoS
// 97,PropCorrelationData "ZS\244o&a\140Tw\192\&1\210*:\159\201;\239,G\246\230\187\tZ\245C\RS",PropServerKeepAlive
// 11895,PropContentType "\151T\234\DEL\194\231\DC1\133\154^a5j2\ETX\237{\176%&_9BF\193!5\255",PropMessageExpiryInterval
// 29891,PropSubscriptionIdentifier 23,PropMaximumQoS 252,PropTopicAliasMaximum 5689,PropServerKeepAlive 11084]}),
// _cleanSession = True, _keepAlive = 14170, _connID = "f\STX\217X\205pp\131\144\216u\131\222\211\161", _properties =
// [PropRetainAvailable 66,PropRequestProblemInformation 153,PropMaximumQoS 251,PropSubscriptionIdentifier
// 2,PropResponseInformation "/\146\&7\ETXF\227\224\200\DLE@\135p\ETXA\STXDK\ENQ\216?\\\135!\156\179",PropContentType
// "\195\f\238\194\164[\GS\DLE' \DC3d\210H\152\US\b\DEL\192\152\197&\175\US",PropMaximumPacketSize
// 18461,PropServerReference "6\249\167",PropSessionExpiryInterval 22381,PropAuthenticationMethod
// "\223\204'\140\159[\133",PropAuthenticationMethod
// "k\160\135\219V-\164\166\150\165Pb*\138,\a\DLE\SO\134\191&\ACK\251BV\179\190\173f",PropSubscriptionIdentifierAvailable
// 11,PropRetainAvailable 234,PropPayloadFormatIndicator 34,PropRequestProblemInformation
// 31,PropSharedSubscriptionAvailable 144,PropReceiveMaximum 12566,PropTopicAliasMaximum 23429,PropAuthenticationData
// "\178W\199\&9\137M<-\ETX<\252)\174\223a",PropReceiveMaximum 2632,PropMessageExpiryInterval
// 31391,PropAuthenticationData "\238+\219D\153\229\151\STX\r\146\ETBFi\217\EOT\218\200z\185\150\188\154]\STXo"]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0xb9, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xee, 0x37, 0x5a, 0xbf, 0x1,  0x25, 0x42, 0x17, 0x99,
      0x24, 0xfb, 0xb,  0x2,  0x1a, 0x0,  0x19, 0x2f, 0x92, 0x37, 0x3,  0x46, 0xe3, 0xe0, 0xc8, 0x10, 0x40, 0x87, 0x70,
      0x3,  0x41, 0x2,  0x44, 0x4b, 0x5,  0xd8, 0x3f, 0x5c, 0x87, 0x21, 0x9c, 0xb3, 0x3,  0x0,  0x18, 0xc3, 0xc,  0xee,
      0xc2, 0xa4, 0x5b, 0x1d, 0x10, 0x27, 0x20, 0x13, 0x64, 0xd2, 0x48, 0x98, 0x1f, 0x8,  0x7f, 0xc0, 0x98, 0xc5, 0x26,
      0xaf, 0x1f, 0x27, 0x0,  0x0,  0x48, 0x1d, 0x1c, 0x0,  0x3,  0x36, 0xf9, 0xa7, 0x11, 0x0,  0x0,  0x57, 0x6d, 0x15,
      0x0,  0x7,  0xdf, 0xcc, 0x27, 0x8c, 0x9f, 0x5b, 0x85, 0x15, 0x0,  0x1d, 0x6b, 0xa0, 0x87, 0xdb, 0x56, 0x2d, 0xa4,
      0xa6, 0x96, 0xa5, 0x50, 0x62, 0x2a, 0x8a, 0x2c, 0x7,  0x10, 0xe,  0x86, 0xbf, 0x26, 0x6,  0xfb, 0x42, 0x56, 0xb3,
      0xbe, 0xad, 0x66, 0x29, 0xb,  0x25, 0xea, 0x1,  0x22, 0x17, 0x1f, 0x2a, 0x90, 0x21, 0x31, 0x16, 0x22, 0x5b, 0x85,
      0x16, 0x0,  0xf,  0xb2, 0x57, 0xc7, 0x39, 0x89, 0x4d, 0x3c, 0x2d, 0x3,  0x3c, 0xfc, 0x29, 0xae, 0xdf, 0x61, 0x21,
      0xa,  0x48, 0x2,  0x0,  0x0,  0x7a, 0x9f, 0x16, 0x0,  0x19, 0xee, 0x2b, 0xdb, 0x44, 0x99, 0xe5, 0x97, 0x2,  0xd,
      0x92, 0x17, 0x46, 0x69, 0xd9, 0x4,  0xda, 0xc8, 0x7a, 0xb9, 0x96, 0xbc, 0x9a, 0x5d, 0x2,  0x6f, 0x0,  0xf,  0x66,
      0x2,  0xd9, 0x58, 0xcd, 0x70, 0x70, 0x83, 0x90, 0xd8, 0x75, 0x83, 0xde, 0xd3, 0xa1, 0x9a, 0x1,  0x25, 0xad, 0x1f,
      0x0,  0x7,  0xf8, 0xdf, 0x29, 0x3b, 0x3b, 0x43, 0x87, 0x19, 0x6f, 0x3,  0x0,  0x10, 0xef, 0x61, 0x3a, 0x2b, 0x8d,
      0x7,  0x7d, 0x95, 0xed, 0x24, 0x6f, 0xf1, 0x6f, 0x69, 0xb2, 0xa4, 0x26, 0x0,  0x6,  0x23, 0x89, 0x48, 0x7d, 0xea,
      0xf5, 0x0,  0x1c, 0x0,  0x2c, 0xce, 0x5d, 0xa7, 0x4f, 0x12, 0xd5, 0x87, 0x14, 0x55, 0x90, 0xa2, 0xa3, 0xd4, 0xf,
      0x30, 0x5f, 0xd6, 0x7b, 0x93, 0xc4, 0x8f, 0xae, 0xba, 0x52, 0x36, 0x34, 0x24, 0x61, 0x9,  0x0,  0x1c, 0x5a, 0x53,
      0xf4, 0x6f, 0x26, 0x61, 0x8c, 0x54, 0x77, 0xc0, 0x31, 0xd2, 0x2a, 0x3a, 0x9f, 0xc9, 0x3b, 0xef, 0x2c, 0x47, 0xf6,
      0xe6, 0xbb, 0x9,  0x5a, 0xf5, 0x43, 0x1e, 0x13, 0x2e, 0x77, 0x3,  0x0,  0x1c, 0x97, 0x54, 0xea, 0x7f, 0xc2, 0xe7,
      0x11, 0x85, 0x9a, 0x5e, 0x61, 0x35, 0x6a, 0x32, 0x3,  0xed, 0x7b, 0xb0, 0x25, 0x26, 0x5f, 0x39, 0x42, 0x46, 0xc1,
      0x21, 0x35, 0xff, 0x2,  0x0,  0x0,  0x74, 0xc3, 0xb,  0x17, 0x24, 0xfc, 0x22, 0x16, 0x39, 0x13, 0x2b, 0x4c, 0x0,
      0x1d, 0xd,  0x7c, 0xa8, 0x66, 0x42, 0xe7, 0x31, 0x68, 0x3c, 0x79, 0x9,  0x1c, 0xc5, 0xf,  0x0,  0x7a, 0x33, 0x32,
      0xa2, 0xef, 0x73, 0x26, 0xc,  0xdb, 0xa9, 0xf,  0x47, 0x89, 0xa8, 0x0,  0x5,  0xc9, 0xbf, 0xaf, 0x83, 0x4d, 0x0,
      0x9,  0xb5, 0xe1, 0xf1, 0x25, 0x4b, 0x58, 0xb9, 0x27, 0x94, 0x0,  0xe,  0x18, 0x28, 0x22, 0x6,  0x49, 0x85, 0xef,
      0x36, 0x34, 0xfd, 0xf1, 0x2f, 0x3e, 0x3d};

  uint8_t buf[454] = {0};
  uint8_t bytesprops0[] = {0x2f, 0x92, 0x37, 0x3,  0x46, 0xe3, 0xe0, 0xc8, 0x10, 0x40, 0x87, 0x70, 0x3,
                           0x41, 0x2,  0x44, 0x4b, 0x5,  0xd8, 0x3f, 0x5c, 0x87, 0x21, 0x9c, 0xb3};
  uint8_t bytesprops1[] = {0xc3, 0xc,  0xee, 0xc2, 0xa4, 0x5b, 0x1d, 0x10, 0x27, 0x20, 0x13, 0x64,
                           0xd2, 0x48, 0x98, 0x1f, 0x8,  0x7f, 0xc0, 0x98, 0xc5, 0x26, 0xaf, 0x1f};
  uint8_t bytesprops2[] = {0x36, 0xf9, 0xa7};
  uint8_t bytesprops3[] = {0xdf, 0xcc, 0x27, 0x8c, 0x9f, 0x5b, 0x85};
  uint8_t bytesprops4[] = {0x6b, 0xa0, 0x87, 0xdb, 0x56, 0x2d, 0xa4, 0xa6, 0x96, 0xa5, 0x50, 0x62, 0x2a, 0x8a, 0x2c,
                           0x7,  0x10, 0xe,  0x86, 0xbf, 0x26, 0x6,  0xfb, 0x42, 0x56, 0xb3, 0xbe, 0xad, 0x66};
  uint8_t bytesprops5[] = {0xb2, 0x57, 0xc7, 0x39, 0x89, 0x4d, 0x3c, 0x2d, 0x3, 0x3c, 0xfc, 0x29, 0xae, 0xdf, 0x61};
  uint8_t bytesprops6[] = {0xee, 0x2b, 0xdb, 0x44, 0x99, 0xe5, 0x97, 0x2,  0xd,  0x92, 0x17, 0x46, 0x69,
                           0xd9, 0x4,  0xda, 0xc8, 0x7a, 0xb9, 0x96, 0xbc, 0x9a, 0x5d, 0x2,  0x6f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 2}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 18461}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22381}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12566}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23429}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2632}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31391}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf8, 0xdf, 0x29, 0x3b, 0x3b, 0x43, 0x87};
  uint8_t byteswillprops1[] = {0xef, 0x61, 0x3a, 0x2b, 0x8d, 0x7,  0x7d, 0x95,
                               0xed, 0x24, 0x6f, 0xf1, 0x6f, 0x69, 0xb2, 0xa4};
  uint8_t byteswillprops3[] = {0x0,  0x2c, 0xce, 0x5d, 0xa7, 0x4f, 0x12, 0xd5, 0x87, 0x14, 0x55, 0x90, 0xa2, 0xa3,
                               0xd4, 0xf,  0x30, 0x5f, 0xd6, 0x7b, 0x93, 0xc4, 0x8f, 0xae, 0xba, 0x52, 0x36, 0x34};
  uint8_t byteswillprops2[] = {0x23, 0x89, 0x48, 0x7d, 0xea, 0xf5};
  uint8_t byteswillprops4[] = {0x5a, 0x53, 0xf4, 0x6f, 0x26, 0x61, 0x8c, 0x54, 0x77, 0xc0, 0x31, 0xd2, 0x2a, 0x3a,
                               0x9f, 0xc9, 0x3b, 0xef, 0x2c, 0x47, 0xf6, 0xe6, 0xbb, 0x9,  0x5a, 0xf5, 0x43, 0x1e};
  uint8_t byteswillprops5[] = {0x97, 0x54, 0xea, 0x7f, 0xc2, 0xe7, 0x11, 0x85, 0x9a, 0x5e, 0x61, 0x35, 0x6a, 0x32,
                               0x3,  0xed, 0x7b, 0xb0, 0x25, 0x26, 0x5f, 0x39, 0x42, 0x46, 0xc1, 0x21, 0x35, 0xff};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 173}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {6, (char*)&byteswillprops2}, .v = {28, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11895}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29891}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 23}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5689}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11084}},
  };

  lwmqtt_properties_t willprops = {14, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd,  0x7c, 0xa8, 0x66, 0x42, 0xe7, 0x31, 0x68, 0x3c, 0x79, 0x9, 0x1c, 0xc5, 0xf, 0x0,
                                0x7a, 0x33, 0x32, 0xa2, 0xef, 0x73, 0x26, 0xc,  0xdb, 0xa9, 0xf, 0x47, 0x89, 0xa8};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xc9, 0xbf, 0xaf, 0x83, 0x4d};
  lwmqtt_string_t will_payload = {5, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14170;
  uint8_t client_id_bytes[] = {0x66, 0x2, 0xd9, 0x58, 0xcd, 0x70, 0x70, 0x83, 0x90, 0xd8, 0x75, 0x83, 0xde, 0xd3, 0xa1};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xb5, 0xe1, 0xf1, 0x25, 0x4b, 0x58, 0xb9, 0x27, 0x94};
  lwmqtt_string_t username = {9, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x28, 0x22, 0x6, 0x49, 0x85, 0xef, 0x36, 0x34, 0xfd, 0xf1, 0x2f, 0x3e, 0x3d};
  lwmqtt_string_t password = {14, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\166\ETX\"\234D\249J8\176\230-", _password = Just "\181\"\ENQ\157\137L\US,",
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "t\163\228", _willMsg =
// "\FS\227\151\f\191 \NUL\145\166!\154\157\205=\147|oE\SO\163\DC3\221\139\156\234\241\\(", _willProps =
// [PropRequestProblemInformation 81,PropWillDelayInterval 3835,PropSubscriptionIdentifier
// 22,PropRequestProblemInformation 167,PropTopicAlias 28029,PropSubscriptionIdentifierAvailable
// 141,PropMessageExpiryInterval 14497,PropServerKeepAlive 9066,PropServerReference
// "\197\&0t\155\179\ETXa\137\&9\135\238\&7\222(\131Og",PropWillDelayInterval 2997]}), _cleanSession = False, _keepAlive
// = 26482, _connID = "\203|M\250r7f|5\177\239", _properties = [PropTopicAliasMaximum 28466,PropReceiveMaximum
// 20117,PropSubscriptionIdentifier 20,PropRequestProblemInformation 82,PropAuthenticationData
// "\EMj]\240&oI\138!\238\155\&1\DLE1\159\b\154|{\143",PropRequestResponseInformation
// 168,PropSubscriptionIdentifierAvailable 144,PropMaximumQoS 220,PropUserProperty
// "\vU\150\212\156\174\207w\DC2`\a\158\161\US\189A\158 \223\&6\146\182" "\231\180\226\180\238\210{D"]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0xce, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x67, 0x72, 0x4a, 0x22, 0x6f, 0x32, 0x21, 0x4e,
      0x95, 0xb,  0x14, 0x17, 0x52, 0x16, 0x0,  0x14, 0x19, 0x6a, 0x5d, 0xf0, 0x26, 0x6f, 0x49, 0x8a, 0x21, 0xee, 0x9b,
      0x31, 0x10, 0x31, 0x9f, 0x8,  0x9a, 0x7c, 0x7b, 0x8f, 0x19, 0xa8, 0x29, 0x90, 0x24, 0xdc, 0x26, 0x0,  0x16, 0xb,
      0x55, 0x96, 0xd4, 0x9c, 0xae, 0xcf, 0x77, 0x12, 0x60, 0x7,  0x9e, 0xa1, 0x1f, 0xbd, 0x41, 0x9e, 0x20, 0xdf, 0x36,
      0x92, 0xb6, 0x0,  0x8,  0xe7, 0xb4, 0xe2, 0xb4, 0xee, 0xd2, 0x7b, 0x44, 0x0,  0xb,  0xcb, 0x7c, 0x4d, 0xfa, 0x72,
      0x37, 0x66, 0x7c, 0x35, 0xb1, 0xef, 0x31, 0x17, 0x51, 0x18, 0x0,  0x0,  0xe,  0xfb, 0xb,  0x16, 0x17, 0xa7, 0x23,
      0x6d, 0x7d, 0x29, 0x8d, 0x2,  0x0,  0x0,  0x38, 0xa1, 0x13, 0x23, 0x6a, 0x1c, 0x0,  0x11, 0xc5, 0x30, 0x74, 0x9b,
      0xb3, 0x3,  0x61, 0x89, 0x39, 0x87, 0xee, 0x37, 0xde, 0x28, 0x83, 0x4f, 0x67, 0x18, 0x0,  0x0,  0xb,  0xb5, 0x0,
      0x3,  0x74, 0xa3, 0xe4, 0x0,  0x1c, 0x1c, 0xe3, 0x97, 0xc,  0xbf, 0x20, 0x0,  0x91, 0xa6, 0x21, 0x9a, 0x9d, 0xcd,
      0x3d, 0x93, 0x7c, 0x6f, 0x45, 0xe,  0xa3, 0x13, 0xdd, 0x8b, 0x9c, 0xea, 0xf1, 0x5c, 0x28, 0x0,  0xb,  0xa6, 0x3,
      0x22, 0xea, 0x44, 0xf9, 0x4a, 0x38, 0xb0, 0xe6, 0x2d, 0x0,  0x8,  0xb5, 0x22, 0x5,  0x9d, 0x89, 0x4c, 0x1f, 0x2c};

  uint8_t buf[219] = {0};
  uint8_t bytesprops0[] = {0x19, 0x6a, 0x5d, 0xf0, 0x26, 0x6f, 0x49, 0x8a, 0x21, 0xee,
                           0x9b, 0x31, 0x10, 0x31, 0x9f, 0x8,  0x9a, 0x7c, 0x7b, 0x8f};
  uint8_t bytesprops2[] = {0xe7, 0xb4, 0xe2, 0xb4, 0xee, 0xd2, 0x7b, 0x44};
  uint8_t bytesprops1[] = {0xb,  0x55, 0x96, 0xd4, 0x9c, 0xae, 0xcf, 0x77, 0x12, 0x60, 0x7,
                           0x9e, 0xa1, 0x1f, 0xbd, 0x41, 0x9e, 0x20, 0xdf, 0x36, 0x92, 0xb6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28466}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20117}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 20}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc5, 0x30, 0x74, 0x9b, 0xb3, 0x3,  0x61, 0x89, 0x39,
                               0x87, 0xee, 0x37, 0xde, 0x28, 0x83, 0x4f, 0x67};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3835}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 22}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28029}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14497}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9066}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2997}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x74, 0xa3, 0xe4};
  lwmqtt_string_t will_topic = {3, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1c, 0xe3, 0x97, 0xc,  0xbf, 0x20, 0x0,  0x91, 0xa6, 0x21, 0x9a, 0x9d, 0xcd, 0x3d,
                                  0x93, 0x7c, 0x6f, 0x45, 0xe,  0xa3, 0x13, 0xdd, 0x8b, 0x9c, 0xea, 0xf1, 0x5c, 0x28};
  lwmqtt_string_t will_payload = {28, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26482;
  uint8_t client_id_bytes[] = {0xcb, 0x7c, 0x4d, 0xfa, 0x72, 0x37, 0x66, 0x7c, 0x35, 0xb1, 0xef};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa6, 0x3, 0x22, 0xea, 0x44, 0xf9, 0x4a, 0x38, 0xb0, 0xe6, 0x2d};
  lwmqtt_string_t username = {11, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb5, 0x22, 0x5, 0x9d, 0x89, 0x4c, 0x1f, 0x2c};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\RSYG\vm5p\188\128\155\248\238J;\221\217B\211\170%\241\&9*R ",
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS2, _willTopic = "\207\240\217\DLE\243\157", _willMsg =
// "\v\143\189\245\140\200_\255\201%\EOTa\240\ESC\170\&4\160\216\CAN\193O\ACK\245\EOT8vEam&", _willProps =
// [PropResponseTopic "%\172'\197`)\200\251\178\&0=X=\220\153\&9\204",PropServerReference
// ";\184B\132\243F\154R\201\172\128\224\207&U\151\172W\244+\ACKB\208\&2\191$\233\&5r",PropMaximumQoS
// 201,PropPayloadFormatIndicator 25,PropContentType "m\188\FS",PropSubscriptionIdentifierAvailable
// 143,PropTopicAliasMaximum 28176,PropContentType
// "6\154\153r_\138\159\207Z\b\143\SOH\245\168\th\190\216\NAK\195r9\ETX\195H\249/l\180\236",PropWillDelayInterval
// 20471,PropWillDelayInterval 26856,PropCorrelationData "\153\217\175\RSX\246\189",PropUserProperty
// "w\250\170L?\229(~MM\STX\223\b\163A\rt\f"
// "\175\226\206\165\172F-cT\157\240\FS\254^$\218\202{\EOT\219c\252\GS\190o",PropRetainAvailable
// 118,PropAssignedClientIdentifier "\231<^R[\132\&2=\154v",PropAssignedClientIdentifier
// "\150\173\182\139&\179\178s\226\217\198\240\131\207\139",PropReasonString
// "\131\&7x\SOH\202=\233\175\209\171o\143w\136\200\253\153\200':\254\187\RS#nO\204\213",PropReceiveMaximum 17699]}),
// _cleanSession = False, _keepAlive = 4261, _connID = "T\208\249\166\143\DC3\200/\202", _properties =
// [PropServerKeepAlive 21864,PropCorrelationData "\217\235\188\190\FSl\172\ENQ\231\146",PropMaximumPacketSize
// 5914,PropUserProperty "h\146\NUL\227UV\EOT\151\196\FS\171 \138\224\SIq\SYN"
// "Oi\213\n\192i\158",PropMessageExpiryInterval 5162,PropRequestProblemInformation 164,PropAssignedClientIdentifier
// "V\255\179\DC1\188\213\208\131\&5\235\SYND\174`\225\SOH\r\142\169#\RS\152W5\190",PropMaximumPacketSize
// 32764,PropRequestProblemInformation 216,PropReceiveMaximum 2749,PropContentType "\243",PropResponseTopic
// "\245\169t\215p\180?\ACK\139gJV\FSQ \182?\215N\242\147v\221u1R\212\USh\216",PropServerReference
// "\133\195b\217\133\224\&8\ENQo\140\223\156\155\&4\178\217\195",PropWildcardSubscriptionAvailable
// 75,PropTopicAliasMaximum 10186,PropMaximumPacketSize 24607,PropTopicAlias 21250,PropTopicAliasMaximum
// 23940,PropMessageExpiryInterval 31128,PropWildcardSubscriptionAvailable 87,PropMessageExpiryInterval 11982]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {
      0x10, 0xe0, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x34, 0x10, 0xa5, 0xb4, 0x1,  0x13, 0x55, 0x68, 0x9,
      0x0,  0xa,  0xd9, 0xeb, 0xbc, 0xbe, 0x1c, 0x6c, 0xac, 0x5,  0xe7, 0x92, 0x27, 0x0,  0x0,  0x17, 0x1a, 0x26, 0x0,
      0x11, 0x68, 0x92, 0x0,  0xe3, 0x55, 0x56, 0x4,  0x97, 0xc4, 0x1c, 0xab, 0x20, 0x8a, 0xe0, 0xf,  0x71, 0x16, 0x0,
      0x7,  0x4f, 0x69, 0xd5, 0xa,  0xc0, 0x69, 0x9e, 0x2,  0x0,  0x0,  0x14, 0x2a, 0x17, 0xa4, 0x12, 0x0,  0x19, 0x56,
      0xff, 0xb3, 0x11, 0xbc, 0xd5, 0xd0, 0x83, 0x35, 0xeb, 0x16, 0x44, 0xae, 0x60, 0xe1, 0x1,  0xd,  0x8e, 0xa9, 0x23,
      0x1e, 0x98, 0x57, 0x35, 0xbe, 0x27, 0x0,  0x0,  0x7f, 0xfc, 0x17, 0xd8, 0x21, 0xa,  0xbd, 0x3,  0x0,  0x1,  0xf3,
      0x8,  0x0,  0x1e, 0xf5, 0xa9, 0x74, 0xd7, 0x70, 0xb4, 0x3f, 0x6,  0x8b, 0x67, 0x4a, 0x56, 0x1c, 0x51, 0x20, 0xb6,
      0x3f, 0xd7, 0x4e, 0xf2, 0x93, 0x76, 0xdd, 0x75, 0x31, 0x52, 0xd4, 0x1f, 0x68, 0xd8, 0x1c, 0x0,  0x11, 0x85, 0xc3,
      0x62, 0xd9, 0x85, 0xe0, 0x38, 0x5,  0x6f, 0x8c, 0xdf, 0x9c, 0x9b, 0x34, 0xb2, 0xd9, 0xc3, 0x28, 0x4b, 0x22, 0x27,
      0xca, 0x27, 0x0,  0x0,  0x60, 0x1f, 0x23, 0x53, 0x2,  0x22, 0x5d, 0x84, 0x2,  0x0,  0x0,  0x79, 0x98, 0x28, 0x57,
      0x2,  0x0,  0x0,  0x2e, 0xce, 0x0,  0x9,  0x54, 0xd0, 0xf9, 0xa6, 0x8f, 0x13, 0xc8, 0x2f, 0xca, 0xeb, 0x1,  0x8,
      0x0,  0x11, 0x25, 0xac, 0x27, 0xc5, 0x60, 0x29, 0xc8, 0xfb, 0xb2, 0x30, 0x3d, 0x58, 0x3d, 0xdc, 0x99, 0x39, 0xcc,
      0x1c, 0x0,  0x1d, 0x3b, 0xb8, 0x42, 0x84, 0xf3, 0x46, 0x9a, 0x52, 0xc9, 0xac, 0x80, 0xe0, 0xcf, 0x26, 0x55, 0x97,
      0xac, 0x57, 0xf4, 0x2b, 0x6,  0x42, 0xd0, 0x32, 0xbf, 0x24, 0xe9, 0x35, 0x72, 0x24, 0xc9, 0x1,  0x19, 0x3,  0x0,
      0x3,  0x6d, 0xbc, 0x1c, 0x29, 0x8f, 0x22, 0x6e, 0x10, 0x3,  0x0,  0x1e, 0x36, 0x9a, 0x99, 0x72, 0x5f, 0x8a, 0x9f,
      0xcf, 0x5a, 0x8,  0x8f, 0x1,  0xf5, 0xa8, 0x9,  0x68, 0xbe, 0xd8, 0x15, 0xc3, 0x72, 0x39, 0x3,  0xc3, 0x48, 0xf9,
      0x2f, 0x6c, 0xb4, 0xec, 0x18, 0x0,  0x0,  0x4f, 0xf7, 0x18, 0x0,  0x0,  0x68, 0xe8, 0x9,  0x0,  0x7,  0x99, 0xd9,
      0xaf, 0x1e, 0x58, 0xf6, 0xbd, 0x26, 0x0,  0x12, 0x77, 0xfa, 0xaa, 0x4c, 0x3f, 0xe5, 0x28, 0x7e, 0x4d, 0x4d, 0x2,
      0xdf, 0x8,  0xa3, 0x41, 0xd,  0x74, 0xc,  0x0,  0x19, 0xaf, 0xe2, 0xce, 0xa5, 0xac, 0x46, 0x2d, 0x63, 0x54, 0x9d,
      0xf0, 0x1c, 0xfe, 0x5e, 0x24, 0xda, 0xca, 0x7b, 0x4,  0xdb, 0x63, 0xfc, 0x1d, 0xbe, 0x6f, 0x25, 0x76, 0x12, 0x0,
      0xa,  0xe7, 0x3c, 0x5e, 0x52, 0x5b, 0x84, 0x32, 0x3d, 0x9a, 0x76, 0x12, 0x0,  0xf,  0x96, 0xad, 0xb6, 0x8b, 0x26,
      0xb3, 0xb2, 0x73, 0xe2, 0xd9, 0xc6, 0xf0, 0x83, 0xcf, 0x8b, 0x1f, 0x0,  0x1c, 0x83, 0x37, 0x78, 0x1,  0xca, 0x3d,
      0xe9, 0xaf, 0xd1, 0xab, 0x6f, 0x8f, 0x77, 0x88, 0xc8, 0xfd, 0x99, 0xc8, 0x27, 0x3a, 0xfe, 0xbb, 0x1e, 0x23, 0x6e,
      0x4f, 0xcc, 0xd5, 0x21, 0x45, 0x23, 0x0,  0x6,  0xcf, 0xf0, 0xd9, 0x10, 0xf3, 0x9d, 0x0,  0x1e, 0xb,  0x8f, 0xbd,
      0xf5, 0x8c, 0xc8, 0x5f, 0xff, 0xc9, 0x25, 0x4,  0x61, 0xf0, 0x1b, 0xaa, 0x34, 0xa0, 0xd8, 0x18, 0xc1, 0x4f, 0x6,
      0xf5, 0x4,  0x38, 0x76, 0x45, 0x61, 0x6d, 0x26};

  uint8_t buf[493] = {0};
  uint8_t bytesprops0[] = {0xd9, 0xeb, 0xbc, 0xbe, 0x1c, 0x6c, 0xac, 0x5, 0xe7, 0x92};
  uint8_t bytesprops2[] = {0x4f, 0x69, 0xd5, 0xa, 0xc0, 0x69, 0x9e};
  uint8_t bytesprops1[] = {0x68, 0x92, 0x0,  0xe3, 0x55, 0x56, 0x4,  0x97, 0xc4,
                           0x1c, 0xab, 0x20, 0x8a, 0xe0, 0xf,  0x71, 0x16};
  uint8_t bytesprops3[] = {0x56, 0xff, 0xb3, 0x11, 0xbc, 0xd5, 0xd0, 0x83, 0x35, 0xeb, 0x16, 0x44, 0xae,
                           0x60, 0xe1, 0x1,  0xd,  0x8e, 0xa9, 0x23, 0x1e, 0x98, 0x57, 0x35, 0xbe};
  uint8_t bytesprops4[] = {0xf3};
  uint8_t bytesprops5[] = {0xf5, 0xa9, 0x74, 0xd7, 0x70, 0xb4, 0x3f, 0x6,  0x8b, 0x67, 0x4a, 0x56, 0x1c, 0x51, 0x20,
                           0xb6, 0x3f, 0xd7, 0x4e, 0xf2, 0x93, 0x76, 0xdd, 0x75, 0x31, 0x52, 0xd4, 0x1f, 0x68, 0xd8};
  uint8_t bytesprops6[] = {0x85, 0xc3, 0x62, 0xd9, 0x85, 0xe0, 0x38, 0x5, 0x6f,
                           0x8c, 0xdf, 0x9c, 0x9b, 0x34, 0xb2, 0xd9, 0xc3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21864}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5914}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops1}, .v = {7, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5162}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32764}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2749}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10186}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24607}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21250}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23940}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31128}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11982}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x25, 0xac, 0x27, 0xc5, 0x60, 0x29, 0xc8, 0xfb, 0xb2,
                               0x30, 0x3d, 0x58, 0x3d, 0xdc, 0x99, 0x39, 0xcc};
  uint8_t byteswillprops1[] = {0x3b, 0xb8, 0x42, 0x84, 0xf3, 0x46, 0x9a, 0x52, 0xc9, 0xac, 0x80, 0xe0, 0xcf, 0x26, 0x55,
                               0x97, 0xac, 0x57, 0xf4, 0x2b, 0x6,  0x42, 0xd0, 0x32, 0xbf, 0x24, 0xe9, 0x35, 0x72};
  uint8_t byteswillprops2[] = {0x6d, 0xbc, 0x1c};
  uint8_t byteswillprops3[] = {0x36, 0x9a, 0x99, 0x72, 0x5f, 0x8a, 0x9f, 0xcf, 0x5a, 0x8,
                               0x8f, 0x1,  0xf5, 0xa8, 0x9,  0x68, 0xbe, 0xd8, 0x15, 0xc3,
                               0x72, 0x39, 0x3,  0xc3, 0x48, 0xf9, 0x2f, 0x6c, 0xb4, 0xec};
  uint8_t byteswillprops4[] = {0x99, 0xd9, 0xaf, 0x1e, 0x58, 0xf6, 0xbd};
  uint8_t byteswillprops6[] = {0xaf, 0xe2, 0xce, 0xa5, 0xac, 0x46, 0x2d, 0x63, 0x54, 0x9d, 0xf0, 0x1c, 0xfe,
                               0x5e, 0x24, 0xda, 0xca, 0x7b, 0x4,  0xdb, 0x63, 0xfc, 0x1d, 0xbe, 0x6f};
  uint8_t byteswillprops5[] = {0x77, 0xfa, 0xaa, 0x4c, 0x3f, 0xe5, 0x28, 0x7e, 0x4d,
                               0x4d, 0x2,  0xdf, 0x8,  0xa3, 0x41, 0xd,  0x74, 0xc};
  uint8_t byteswillprops7[] = {0xe7, 0x3c, 0x5e, 0x52, 0x5b, 0x84, 0x32, 0x3d, 0x9a, 0x76};
  uint8_t byteswillprops8[] = {0x96, 0xad, 0xb6, 0x8b, 0x26, 0xb3, 0xb2, 0x73,
                               0xe2, 0xd9, 0xc6, 0xf0, 0x83, 0xcf, 0x8b};
  uint8_t byteswillprops9[] = {0x83, 0x37, 0x78, 0x1,  0xca, 0x3d, 0xe9, 0xaf, 0xd1, 0xab, 0x6f, 0x8f, 0x77, 0x88,
                               0xc8, 0xfd, 0x99, 0xc8, 0x27, 0x3a, 0xfe, 0xbb, 0x1e, 0x23, 0x6e, 0x4f, 0xcc, 0xd5};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28176}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20471}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26856}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&byteswillprops5}, .v = {25, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17699}},
  };

  lwmqtt_properties_t willprops = {17, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcf, 0xf0, 0xd9, 0x10, 0xf3, 0x9d};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb,  0x8f, 0xbd, 0xf5, 0x8c, 0xc8, 0x5f, 0xff, 0xc9, 0x25,
                                  0x4,  0x61, 0xf0, 0x1b, 0xaa, 0x34, 0xa0, 0xd8, 0x18, 0xc1,
                                  0x4f, 0x6,  0xf5, 0x4,  0x38, 0x76, 0x45, 0x61, 0x6d, 0x26};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 4261;
  uint8_t client_id_bytes[] = {0x54, 0xd0, 0xf9, 0xa6, 0x8f, 0x13, 0xc8, 0x2f, 0xca};
  lwmqtt_string_t client_id = {9, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x1e, 0x59, 0x47, 0xb,  0x6d, 0x35, 0x70, 0xbc, 0x80, 0x9b, 0xf8, 0xee, 0x4a,
                              0x3b, 0xdd, 0xd9, 0x42, 0xd3, 0xaa, 0x25, 0xf1, 0x39, 0x2a, 0x52, 0x20};
  lwmqtt_string_t password = {25, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\241\185^\SOH4\186U}I\208\137\131M\161C\190\134\174(B\181", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "8\\s\tW\213@\b\174\150", _willMsg =
// "\245\248\244q)\133\&9%\158\ESC\a\252]Rco'^\200;", _willProps = [PropRequestProblemInformation
// 112,PropRequestProblemInformation 179,PropWildcardSubscriptionAvailable 61,PropAuthenticationData
// "\213L\153\173\148Z\254\177\155\231\153F32\235'\176\195",PropServerKeepAlive 1358,PropSharedSubscriptionAvailable
// 250,PropResponseInformation "\b4\222\STXQ\253\188\252\140\ra\b\176\GSs",PropSessionExpiryInterval 5859]}),
// _cleanSession = True, _keepAlive = 15075, _connID = "~g'\172", _properties = [PropTopicAliasMaximum
// 13675,PropSubscriptionIdentifierAvailable 45,PropSubscriptionIdentifierAvailable 160,PropAuthenticationData
// "D\184\161\ETX\189\196W\233\EOT\DEL|\168\&7\232",PropAuthenticationMethod
// "e\225\186\240p\147\227U\188v\132\192\251s\SO!~?\154\246\203\237\241\145",PropWildcardSubscriptionAvailable
// 210,PropReceiveMaximum 19490,PropMessageExpiryInterval 17696,PropResponseInformation
// "\SI\237.3\208",PropServerReference
// "\228f&\209!\147\165\215W\149\128\172\174\240\177o\207\156\128#\184\&8+\219\210\173-\196C",PropTopicAliasMaximum
// 10620,PropRequestResponseInformation 178,PropServerKeepAlive 17815,PropSessionExpiryInterval
// 31669,PropSubscriptionIdentifierAvailable 37,PropSharedSubscriptionAvailable 196,PropSessionExpiryInterval
// 9649,PropRetainAvailable 115,PropAssignedClientIdentifier "k\NAKr\222\138\154U\249\&4
// \ESC^o]\230",PropMaximumPacketSize 31762,PropSessionExpiryInterval 10448,PropServerReference
// "v\211F\243=3\195",PropRetainAvailable 125,PropRequestProblemInformation 76,PropSubscriptionIdentifier
// 0,PropAuthenticationData "\236YG\200IK\ESC2h\141w\186\191f\250p\165\232#\153\183\209yB\206\152\&8\230"]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xcb, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x8e, 0x3a, 0xe3, 0xc8, 0x1,  0x22, 0x35, 0x6b, 0x29,
      0x2d, 0x29, 0xa0, 0x16, 0x0,  0xe,  0x44, 0xb8, 0xa1, 0x3,  0xbd, 0xc4, 0x57, 0xe9, 0x4,  0x7f, 0x7c, 0xa8, 0x37,
      0xe8, 0x15, 0x0,  0x18, 0x65, 0xe1, 0xba, 0xf0, 0x70, 0x93, 0xe3, 0x55, 0xbc, 0x76, 0x84, 0xc0, 0xfb, 0x73, 0xe,
      0x21, 0x7e, 0x3f, 0x9a, 0xf6, 0xcb, 0xed, 0xf1, 0x91, 0x28, 0xd2, 0x21, 0x4c, 0x22, 0x2,  0x0,  0x0,  0x45, 0x20,
      0x1a, 0x0,  0x5,  0xf,  0xed, 0x2e, 0x33, 0xd0, 0x1c, 0x0,  0x1d, 0xe4, 0x66, 0x26, 0xd1, 0x21, 0x93, 0xa5, 0xd7,
      0x57, 0x95, 0x80, 0xac, 0xae, 0xf0, 0xb1, 0x6f, 0xcf, 0x9c, 0x80, 0x23, 0xb8, 0x38, 0x2b, 0xdb, 0xd2, 0xad, 0x2d,
      0xc4, 0x43, 0x22, 0x29, 0x7c, 0x19, 0xb2, 0x13, 0x45, 0x97, 0x11, 0x0,  0x0,  0x7b, 0xb5, 0x29, 0x25, 0x2a, 0xc4,
      0x11, 0x0,  0x0,  0x25, 0xb1, 0x25, 0x73, 0x12, 0x0,  0xf,  0x6b, 0x15, 0x72, 0xde, 0x8a, 0x9a, 0x55, 0xf9, 0x34,
      0x20, 0x1b, 0x5e, 0x6f, 0x5d, 0xe6, 0x27, 0x0,  0x0,  0x7c, 0x12, 0x11, 0x0,  0x0,  0x28, 0xd0, 0x1c, 0x0,  0x7,
      0x76, 0xd3, 0x46, 0xf3, 0x3d, 0x33, 0xc3, 0x25, 0x7d, 0x17, 0x4c, 0xb,  0x0,  0x16, 0x0,  0x1c, 0xec, 0x59, 0x47,
      0xc8, 0x49, 0x4b, 0x1b, 0x32, 0x68, 0x8d, 0x77, 0xba, 0xbf, 0x66, 0xfa, 0x70, 0xa5, 0xe8, 0x23, 0x99, 0xb7, 0xd1,
      0x79, 0x42, 0xce, 0x98, 0x38, 0xe6, 0x0,  0x4,  0x7e, 0x67, 0x27, 0xac, 0x37, 0x17, 0x70, 0x17, 0xb3, 0x28, 0x3d,
      0x16, 0x0,  0x12, 0xd5, 0x4c, 0x99, 0xad, 0x94, 0x5a, 0xfe, 0xb1, 0x9b, 0xe7, 0x99, 0x46, 0x33, 0x32, 0xeb, 0x27,
      0xb0, 0xc3, 0x13, 0x5,  0x4e, 0x2a, 0xfa, 0x1a, 0x0,  0xf,  0x8,  0x34, 0xde, 0x2,  0x51, 0xfd, 0xbc, 0xfc, 0x8c,
      0xd,  0x61, 0x8,  0xb0, 0x1d, 0x73, 0x11, 0x0,  0x0,  0x16, 0xe3, 0x0,  0xa,  0x38, 0x5c, 0x73, 0x9,  0x57, 0xd5,
      0x40, 0x8,  0xae, 0x96, 0x0,  0x14, 0xf5, 0xf8, 0xf4, 0x71, 0x29, 0x85, 0x39, 0x25, 0x9e, 0x1b, 0x7,  0xfc, 0x5d,
      0x52, 0x63, 0x6f, 0x27, 0x5e, 0xc8, 0x3b, 0x0,  0x15, 0xf1, 0xb9, 0x5e, 0x1,  0x34, 0xba, 0x55, 0x7d, 0x49, 0xd0,
      0x89, 0x83, 0x4d, 0xa1, 0x43, 0xbe, 0x86, 0xae, 0x28, 0x42, 0xb5};

  uint8_t buf[344] = {0};
  uint8_t bytesprops0[] = {0x44, 0xb8, 0xa1, 0x3, 0xbd, 0xc4, 0x57, 0xe9, 0x4, 0x7f, 0x7c, 0xa8, 0x37, 0xe8};
  uint8_t bytesprops1[] = {0x65, 0xe1, 0xba, 0xf0, 0x70, 0x93, 0xe3, 0x55, 0xbc, 0x76, 0x84, 0xc0,
                           0xfb, 0x73, 0xe,  0x21, 0x7e, 0x3f, 0x9a, 0xf6, 0xcb, 0xed, 0xf1, 0x91};
  uint8_t bytesprops2[] = {0xf, 0xed, 0x2e, 0x33, 0xd0};
  uint8_t bytesprops3[] = {0xe4, 0x66, 0x26, 0xd1, 0x21, 0x93, 0xa5, 0xd7, 0x57, 0x95, 0x80, 0xac, 0xae, 0xf0, 0xb1,
                           0x6f, 0xcf, 0x9c, 0x80, 0x23, 0xb8, 0x38, 0x2b, 0xdb, 0xd2, 0xad, 0x2d, 0xc4, 0x43};
  uint8_t bytesprops4[] = {0x6b, 0x15, 0x72, 0xde, 0x8a, 0x9a, 0x55, 0xf9, 0x34, 0x20, 0x1b, 0x5e, 0x6f, 0x5d, 0xe6};
  uint8_t bytesprops5[] = {0x76, 0xd3, 0x46, 0xf3, 0x3d, 0x33, 0xc3};
  uint8_t bytesprops6[] = {0xec, 0x59, 0x47, 0xc8, 0x49, 0x4b, 0x1b, 0x32, 0x68, 0x8d, 0x77, 0xba, 0xbf, 0x66,
                           0xfa, 0x70, 0xa5, 0xe8, 0x23, 0x99, 0xb7, 0xd1, 0x79, 0x42, 0xce, 0x98, 0x38, 0xe6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13675}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 19490}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17696}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10620}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17815}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31669}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9649}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31762}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10448}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)11, .value = {.varint = 0}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd5, 0x4c, 0x99, 0xad, 0x94, 0x5a, 0xfe, 0xb1, 0x9b,
                               0xe7, 0x99, 0x46, 0x33, 0x32, 0xeb, 0x27, 0xb0, 0xc3};
  uint8_t byteswillprops1[] = {0x8, 0x34, 0xde, 0x2, 0x51, 0xfd, 0xbc, 0xfc, 0x8c, 0xd, 0x61, 0x8, 0xb0, 0x1d, 0x73};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1358}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5859}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x38, 0x5c, 0x73, 0x9, 0x57, 0xd5, 0x40, 0x8, 0xae, 0x96};
  lwmqtt_string_t will_topic = {10, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf5, 0xf8, 0xf4, 0x71, 0x29, 0x85, 0x39, 0x25, 0x9e, 0x1b,
                                  0x7,  0xfc, 0x5d, 0x52, 0x63, 0x6f, 0x27, 0x5e, 0xc8, 0x3b};
  lwmqtt_string_t will_payload = {20, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 15075;
  uint8_t client_id_bytes[] = {0x7e, 0x67, 0x27, 0xac};
  lwmqtt_string_t client_id = {4, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf1, 0xb9, 0x5e, 0x1,  0x34, 0xba, 0x55, 0x7d, 0x49, 0xd0, 0x89,
                              0x83, 0x4d, 0xa1, 0x43, 0xbe, 0x86, 0xae, 0x28, 0x42, 0xb5};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30493 [("\214C\211\153\&6\151\166\198\180w\131_\236",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\173\182\235`z\189",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\142J\163\SUB<\166\240y\176r\192",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("_\255]*t\ETB\162j\206\132\141\&3\169\148\170\217$H\SYN\255\187\131\233\244\159'\165\229M",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\CANY\SI2\187\199D\227G\253\202\CAN\208h\154h`\254\236\133/\200\173\163\158\208\238u>",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\237\ETB1\149\ETX\245\172\173\ETB\135\SOI",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS0}),("\245\157c\165h\181Ss\238\217\ESC\ENQ\206\225\171l\SUB\160A$\239\146pa\170\138",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\142\210",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0xa0, 0x1,  0x77, 0x1d, 0x0,  0xd,  0xd6, 0x43, 0xd3, 0x99, 0x36, 0x97, 0xa6, 0xc6, 0xb4, 0x77,
                   0x83, 0x5f, 0xec, 0x2,  0x0,  0x0,  0x1,  0x0,  0x6,  0xad, 0xb6, 0xeb, 0x60, 0x7a, 0xbd, 0x0,  0x0,
                   0xb,  0x8e, 0x4a, 0xa3, 0x1a, 0x3c, 0xa6, 0xf0, 0x79, 0xb0, 0x72, 0xc0, 0x1,  0x0,  0x1d, 0x5f, 0xff,
                   0x5d, 0x2a, 0x74, 0x17, 0xa2, 0x6a, 0xce, 0x84, 0x8d, 0x33, 0xa9, 0x94, 0xaa, 0xd9, 0x24, 0x48, 0x16,
                   0xff, 0xbb, 0x83, 0xe9, 0xf4, 0x9f, 0x27, 0xa5, 0xe5, 0x4d, 0x1,  0x0,  0x1d, 0x18, 0x59, 0xf,  0x32,
                   0xbb, 0xc7, 0x44, 0xe3, 0x47, 0xfd, 0xca, 0x18, 0xd0, 0x68, 0x9a, 0x68, 0x60, 0xfe, 0xec, 0x85, 0x2f,
                   0xc8, 0xad, 0xa3, 0x9e, 0xd0, 0xee, 0x75, 0x3e, 0x0,  0x0,  0xc,  0xed, 0x17, 0x31, 0x95, 0x3,  0xf5,
                   0xac, 0xad, 0x17, 0x87, 0xe,  0x49, 0x0,  0x0,  0x1a, 0xf5, 0x9d, 0x63, 0xa5, 0x68, 0xb5, 0x53, 0x73,
                   0xee, 0xd9, 0x1b, 0x5,  0xce, 0xe1, 0xab, 0x6c, 0x1a, 0xa0, 0x41, 0x24, 0xef, 0x92, 0x70, 0x61, 0xaa,
                   0x8a, 0x2,  0x0,  0x0,  0x0,  0x0,  0x2,  0x8e, 0xd2, 0x0};

  uint8_t buf[173] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd6, 0x43, 0xd3, 0x99, 0x36, 0x97, 0xa6, 0xc6, 0xb4, 0x77, 0x83, 0x5f, 0xec};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xad, 0xb6, 0xeb, 0x60, 0x7a, 0xbd};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8e, 0x4a, 0xa3, 0x1a, 0x3c, 0xa6, 0xf0, 0x79, 0xb0, 0x72, 0xc0};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5f, 0xff, 0x5d, 0x2a, 0x74, 0x17, 0xa2, 0x6a, 0xce, 0x84,
                                     0x8d, 0x33, 0xa9, 0x94, 0xaa, 0xd9, 0x24, 0x48, 0x16, 0xff,
                                     0xbb, 0x83, 0xe9, 0xf4, 0x9f, 0x27, 0xa5, 0xe5, 0x4d};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x18, 0x59, 0xf,  0x32, 0xbb, 0xc7, 0x44, 0xe3, 0x47, 0xfd,
                                     0xca, 0x18, 0xd0, 0x68, 0x9a, 0x68, 0x60, 0xfe, 0xec, 0x85,
                                     0x2f, 0xc8, 0xad, 0xa3, 0x9e, 0xd0, 0xee, 0x75, 0x3e};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xed, 0x17, 0x31, 0x95, 0x3, 0xf5, 0xac, 0xad, 0x17, 0x87, 0xe, 0x49};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf5, 0x9d, 0x63, 0xa5, 0x68, 0xb5, 0x53, 0x73, 0xee, 0xd9, 0x1b, 0x5,  0xce,
                                     0xe1, 0xab, 0x6c, 0x1a, 0xa0, 0x41, 0x24, 0xef, 0x92, 0x70, 0x61, 0xaa, 0x8a};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0};
  lwmqtt_string_t topic_filter_s8 = {0, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x8e, 0xd2};
  lwmqtt_string_t topic_filter_s9 = {2, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30493, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20478 [("\184}2\DC2\bp#\148\f\DC1\208}\194",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\181\209\150\255\240\&5\243\DC2\SO\208ji\180\129&P\178\ENQ?\229W?\192\GS\185\211\166\213\&4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\248\196L\195\ESC\ETX\DC3N\135\&3",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\198\170\141\229\221[\227KN\143Fw\153\t\163\203\n\181\151\147\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\160\253\207yPZ\a\211\172o\148",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\164s\134^.\223\218\240\197J\148\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\240\\\189j\185\226\139}",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("x\172\224\142\143\226\196Z\SYN0\229l\218\175u`\190\250.m\227\222\240\ACK\255\DC2\211W",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\197U\154\166\243\218<\211^f\176\170Y\DC3\162;9^\159\232\181\239\161D\179\&2",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {
      0x82, 0xbb, 0x1,  0x4f, 0xfe, 0x0,  0xd,  0xb8, 0x7d, 0x32, 0x12, 0x8,  0x70, 0x23, 0x94, 0xc,  0x11, 0xd0, 0x7d,
      0xc2, 0x1,  0x0,  0x1d, 0xb5, 0xd1, 0x96, 0xff, 0xf0, 0x35, 0xf3, 0x12, 0xe,  0xd0, 0x6a, 0x69, 0xb4, 0x81, 0x26,
      0x50, 0xb2, 0x5,  0x3f, 0xe5, 0x57, 0x3f, 0xc0, 0x1d, 0xb9, 0xd3, 0xa6, 0xd5, 0x34, 0x2,  0x0,  0xa,  0xf8, 0xc4,
      0x4c, 0xc3, 0x1b, 0x3,  0x13, 0x4e, 0x87, 0x33, 0x0,  0x0,  0x15, 0xc6, 0xaa, 0x8d, 0xe5, 0xdd, 0x5b, 0xe3, 0x4b,
      0x4e, 0x8f, 0x46, 0x77, 0x99, 0x9,  0xa3, 0xcb, 0xa,  0xb5, 0x97, 0x93, 0xaa, 0x1,  0x0,  0xb,  0xa0, 0xfd, 0xcf,
      0x79, 0x50, 0x5a, 0x7,  0xd3, 0xac, 0x6f, 0x94, 0x0,  0x0,  0xc,  0xa4, 0x73, 0x86, 0x5e, 0x2e, 0xdf, 0xda, 0xf0,
      0xc5, 0x4a, 0x94, 0xd4, 0x2,  0x0,  0x8,  0xf0, 0x5c, 0xbd, 0x6a, 0xb9, 0xe2, 0x8b, 0x7d, 0x2,  0x0,  0x1c, 0x78,
      0xac, 0xe0, 0x8e, 0x8f, 0xe2, 0xc4, 0x5a, 0x16, 0x30, 0xe5, 0x6c, 0xda, 0xaf, 0x75, 0x60, 0xbe, 0xfa, 0x2e, 0x6d,
      0xe3, 0xde, 0xf0, 0x6,  0xff, 0x12, 0xd3, 0x57, 0x0,  0x0,  0x1a, 0xc5, 0x55, 0x9a, 0xa6, 0xf3, 0xda, 0x3c, 0xd3,
      0x5e, 0x66, 0xb0, 0xaa, 0x59, 0x13, 0xa2, 0x3b, 0x39, 0x5e, 0x9f, 0xe8, 0xb5, 0xef, 0xa1, 0x44, 0xb3, 0x32, 0x2};

  uint8_t buf[200] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xb8, 0x7d, 0x32, 0x12, 0x8, 0x70, 0x23, 0x94, 0xc, 0x11, 0xd0, 0x7d, 0xc2};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb5, 0xd1, 0x96, 0xff, 0xf0, 0x35, 0xf3, 0x12, 0xe,  0xd0,
                                     0x6a, 0x69, 0xb4, 0x81, 0x26, 0x50, 0xb2, 0x5,  0x3f, 0xe5,
                                     0x57, 0x3f, 0xc0, 0x1d, 0xb9, 0xd3, 0xa6, 0xd5, 0x34};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf8, 0xc4, 0x4c, 0xc3, 0x1b, 0x3, 0x13, 0x4e, 0x87, 0x33};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc6, 0xaa, 0x8d, 0xe5, 0xdd, 0x5b, 0xe3, 0x4b, 0x4e, 0x8f, 0x46,
                                     0x77, 0x99, 0x9,  0xa3, 0xcb, 0xa,  0xb5, 0x97, 0x93, 0xaa};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0xfd, 0xcf, 0x79, 0x50, 0x5a, 0x7, 0xd3, 0xac, 0x6f, 0x94};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa4, 0x73, 0x86, 0x5e, 0x2e, 0xdf, 0xda, 0xf0, 0xc5, 0x4a, 0x94, 0xd4};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf0, 0x5c, 0xbd, 0x6a, 0xb9, 0xe2, 0x8b, 0x7d};
  lwmqtt_string_t topic_filter_s6 = {8, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x78, 0xac, 0xe0, 0x8e, 0x8f, 0xe2, 0xc4, 0x5a, 0x16, 0x30,
                                     0xe5, 0x6c, 0xda, 0xaf, 0x75, 0x60, 0xbe, 0xfa, 0x2e, 0x6d,
                                     0xe3, 0xde, 0xf0, 0x6,  0xff, 0x12, 0xd3, 0x57};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc5, 0x55, 0x9a, 0xa6, 0xf3, 0xda, 0x3c, 0xd3, 0x5e, 0x66, 0xb0, 0xaa, 0x59,
                                     0x13, 0xa2, 0x3b, 0x39, 0x5e, 0x9f, 0xe8, 0xb5, 0xef, 0xa1, 0x44, 0xb3, 0x32};
  lwmqtt_string_t topic_filter_s8 = {26, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20478, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17981
// [("\236?\165\226{<y%\223.\GS4g\150\199\&1\148\241\DLER\138\158\208\133\246\f8\242\US\232",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\169\137\248\156\152\SUB&\a\132#\150\143\245`{\169!a\202\166O!\rn\\\213\195-AU",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("[\a\229\206\223\DC3\\\131\&3\193'\CAN\240\149\GS\141I+\130\221\229\228A",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\183\235\132\&4+Z\241\247",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\175-\132N\226\179\199Mk\RSwk\188\148",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\DC3\229tZw\198\&3!d+\198U\133\162",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\US3\US\235\188\171\225\155\214\155\232\141q\136~",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\EM[\188\159\244x\222\170\NAK#\DLEdl:\218\253\139\196\GS\168",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\SIia\255\137=\235\f",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SI'\239\214\183\175\n\244P\ENQ\DEL\145\ETX\180",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0xd0, 0x1,  0x46, 0x3d, 0x0,  0x1e, 0xec, 0x3f, 0xa5, 0xe2, 0x7b, 0x3c, 0x79, 0x25, 0xdf, 0x2e,
                   0x1d, 0x34, 0x67, 0x96, 0xc7, 0x31, 0x94, 0xf1, 0x10, 0x52, 0x8a, 0x9e, 0xd0, 0x85, 0xf6, 0xc,  0x38,
                   0xf2, 0x1f, 0xe8, 0x1,  0x0,  0x1e, 0xa9, 0x89, 0xf8, 0x9c, 0x98, 0x1a, 0x26, 0x7,  0x84, 0x23, 0x96,
                   0x8f, 0xf5, 0x60, 0x7b, 0xa9, 0x21, 0x61, 0xca, 0xa6, 0x4f, 0x21, 0xd,  0x6e, 0x5c, 0xd5, 0xc3, 0x2d,
                   0x41, 0x55, 0x2,  0x0,  0x17, 0x5b, 0x7,  0xe5, 0xce, 0xdf, 0x13, 0x5c, 0x83, 0x33, 0xc1, 0x27, 0x18,
                   0xf0, 0x95, 0x1d, 0x8d, 0x49, 0x2b, 0x82, 0xdd, 0xe5, 0xe4, 0x41, 0x1,  0x0,  0x8,  0xb7, 0xeb, 0x84,
                   0x34, 0x2b, 0x5a, 0xf1, 0xf7, 0x2,  0x0,  0xe,  0xaf, 0x2d, 0x84, 0x4e, 0xe2, 0xb3, 0xc7, 0x4d, 0x6b,
                   0x1e, 0x77, 0x6b, 0xbc, 0x94, 0x2,  0x0,  0xe,  0x13, 0xe5, 0x74, 0x5a, 0x77, 0xc6, 0x33, 0x21, 0x64,
                   0x2b, 0xc6, 0x55, 0x85, 0xa2, 0x2,  0x0,  0xf,  0x1f, 0x33, 0x1f, 0xeb, 0xbc, 0xab, 0xe1, 0x9b, 0xd6,
                   0x9b, 0xe8, 0x8d, 0x71, 0x88, 0x7e, 0x0,  0x0,  0x14, 0x19, 0x5b, 0xbc, 0x9f, 0xf4, 0x78, 0xde, 0xaa,
                   0x15, 0x23, 0x10, 0x64, 0x6c, 0x3a, 0xda, 0xfd, 0x8b, 0xc4, 0x1d, 0xa8, 0x2,  0x0,  0x8,  0xf,  0x69,
                   0x61, 0xff, 0x89, 0x3d, 0xeb, 0xc,  0x2,  0x0,  0xe,  0xf,  0x27, 0xef, 0xd6, 0xb7, 0xaf, 0xa,  0xf4,
                   0x50, 0x5,  0x7f, 0x91, 0x3,  0xb4, 0x2};

  uint8_t buf[221] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xec, 0x3f, 0xa5, 0xe2, 0x7b, 0x3c, 0x79, 0x25, 0xdf, 0x2e,
                                     0x1d, 0x34, 0x67, 0x96, 0xc7, 0x31, 0x94, 0xf1, 0x10, 0x52,
                                     0x8a, 0x9e, 0xd0, 0x85, 0xf6, 0xc,  0x38, 0xf2, 0x1f, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa9, 0x89, 0xf8, 0x9c, 0x98, 0x1a, 0x26, 0x7,  0x84, 0x23,
                                     0x96, 0x8f, 0xf5, 0x60, 0x7b, 0xa9, 0x21, 0x61, 0xca, 0xa6,
                                     0x4f, 0x21, 0xd,  0x6e, 0x5c, 0xd5, 0xc3, 0x2d, 0x41, 0x55};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5b, 0x7,  0xe5, 0xce, 0xdf, 0x13, 0x5c, 0x83, 0x33, 0xc1, 0x27, 0x18,
                                     0xf0, 0x95, 0x1d, 0x8d, 0x49, 0x2b, 0x82, 0xdd, 0xe5, 0xe4, 0x41};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb7, 0xeb, 0x84, 0x34, 0x2b, 0x5a, 0xf1, 0xf7};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xaf, 0x2d, 0x84, 0x4e, 0xe2, 0xb3, 0xc7,
                                     0x4d, 0x6b, 0x1e, 0x77, 0x6b, 0xbc, 0x94};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x13, 0xe5, 0x74, 0x5a, 0x77, 0xc6, 0x33,
                                     0x21, 0x64, 0x2b, 0xc6, 0x55, 0x85, 0xa2};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1f, 0x33, 0x1f, 0xeb, 0xbc, 0xab, 0xe1, 0x9b,
                                     0xd6, 0x9b, 0xe8, 0x8d, 0x71, 0x88, 0x7e};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x19, 0x5b, 0xbc, 0x9f, 0xf4, 0x78, 0xde, 0xaa, 0x15, 0x23,
                                     0x10, 0x64, 0x6c, 0x3a, 0xda, 0xfd, 0x8b, 0xc4, 0x1d, 0xa8};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xf, 0x69, 0x61, 0xff, 0x89, 0x3d, 0xeb, 0xc};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xf, 0x27, 0xef, 0xd6, 0xb7, 0xaf, 0xa, 0xf4, 0x50, 0x5, 0x7f, 0x91, 0x3, 0xb4};
  lwmqtt_string_t topic_filter_s9 = {14, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17981, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19276 [(";'D\231\163t\131\134\DC1\172\GS\EOT",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("G\167C\245\138\221v\SI",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\ESC\250\186Jm\250\238\180\199w\132\166",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("4+\184\&93\225GY\193:\184\143%\155\SOH",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x3d, 0x4b, 0x4c, 0x0,  0xc,  0x3b, 0x27, 0x44, 0xe7, 0xa3, 0x74, 0x83, 0x86, 0x11, 0xac,
                   0x1d, 0x4,  0x2,  0x0,  0x8,  0x47, 0xa7, 0x43, 0xf5, 0x8a, 0xdd, 0x76, 0xf,  0x1,  0x0,  0xc,
                   0x1b, 0xfa, 0xba, 0x4a, 0x6d, 0xfa, 0xee, 0xb4, 0xc7, 0x77, 0x84, 0xa6, 0x1,  0x0,  0xf,  0x34,
                   0x2b, 0xb8, 0x39, 0x33, 0xe1, 0x47, 0x59, 0xc1, 0x3a, 0xb8, 0x8f, 0x25, 0x9b, 0x1,  0x2};

  uint8_t buf[73] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0x27, 0x44, 0xe7, 0xa3, 0x74, 0x83, 0x86, 0x11, 0xac, 0x1d, 0x4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x47, 0xa7, 0x43, 0xf5, 0x8a, 0xdd, 0x76, 0xf};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1b, 0xfa, 0xba, 0x4a, 0x6d, 0xfa, 0xee, 0xb4, 0xc7, 0x77, 0x84, 0xa6};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x34, 0x2b, 0xb8, 0x39, 0x33, 0xe1, 0x47, 0x59,
                                     0xc1, 0x3a, 0xb8, 0x8f, 0x25, 0x9b, 0x1};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19276, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2713 [("\v\149\153&\227@\158",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\137\178V\240lc\224\b\175']\235\NUL$\243G\224_*\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("9\210TgR\152e\221\141\200\213\141\198U\DC3V5\226\221\190M\169",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x3c, 0xa,  0x99, 0x0,  0x7,  0xb,  0x95, 0x99, 0x26, 0xe3, 0x40, 0x9e, 0x2,  0x0,  0x14,
                   0x89, 0xb2, 0x56, 0xf0, 0x6c, 0x63, 0xe0, 0x8,  0xaf, 0x27, 0x5d, 0xeb, 0x0,  0x24, 0xf3, 0x47,
                   0xe0, 0x5f, 0x2a, 0xfe, 0x0,  0x0,  0x16, 0x39, 0xd2, 0x54, 0x67, 0x52, 0x98, 0x65, 0xdd, 0x8d,
                   0xc8, 0xd5, 0x8d, 0xc6, 0x55, 0x13, 0x56, 0x35, 0xe2, 0xdd, 0xbe, 0x4d, 0xa9, 0x1};

  uint8_t buf[72] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xb, 0x95, 0x99, 0x26, 0xe3, 0x40, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x89, 0xb2, 0x56, 0xf0, 0x6c, 0x63, 0xe0, 0x8,  0xaf, 0x27,
                                     0x5d, 0xeb, 0x0,  0x24, 0xf3, 0x47, 0xe0, 0x5f, 0x2a, 0xfe};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x39, 0xd2, 0x54, 0x67, 0x52, 0x98, 0x65, 0xdd, 0x8d, 0xc8, 0xd5,
                                     0x8d, 0xc6, 0x55, 0x13, 0x56, 0x35, 0xe2, 0xdd, 0xbe, 0x4d, 0xa9};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2713, 3, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7741 [("7\233y\244\229-\244\179\172\&6\164H",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),(")\139\210\DC4\162\189qQ\DC4\141\253\&8",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x20, 0x1e, 0x3d, 0x0,  0xc,  0x37, 0xe9, 0x79, 0xf4, 0xe5, 0x2d, 0xf4, 0xb3, 0xac, 0x36, 0xa4,
                   0x48, 0x1,  0x0,  0xc,  0x29, 0x8b, 0xd2, 0x14, 0xa2, 0xbd, 0x71, 0x51, 0x14, 0x8d, 0xfd, 0x38, 0x1};

  uint8_t buf[44] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x37, 0xe9, 0x79, 0xf4, 0xe5, 0x2d, 0xf4, 0xb3, 0xac, 0x36, 0xa4, 0x48};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x29, 0x8b, 0xd2, 0x14, 0xa2, 0xbd, 0x71, 0x51, 0x14, 0x8d, 0xfd, 0x38};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7741, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11149
// [("^\226\251\181\&2\156|t\151S\169\252\146\ETX\GS\172S\169\EOT\142\201\173\164=\170a",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\225W3k!\151\245\228>\205\198\132\168,\142",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\FS\245\145\RS\166*\SOH\163\232\246[\204\144\192O\181\160",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\236\214\206\181\DC2\167\181k\255c\150C&X`R\250\150\SI\184G\241x\151\196\143R\144\210w",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0x66, 0x2b, 0x8d, 0x0,  0x1a, 0x5e, 0xe2, 0xfb, 0xb5, 0x32, 0x9c, 0x7c, 0x74, 0x97,
                   0x53, 0xa9, 0xfc, 0x92, 0x3,  0x1d, 0xac, 0x53, 0xa9, 0x4,  0x8e, 0xc9, 0xad, 0xa4, 0x3d,
                   0xaa, 0x61, 0x1,  0x0,  0xf,  0xe1, 0x57, 0x33, 0x6b, 0x21, 0x97, 0xf5, 0xe4, 0x3e, 0xcd,
                   0xc6, 0x84, 0xa8, 0x2c, 0x8e, 0x0,  0x0,  0x11, 0x1c, 0xf5, 0x91, 0x1e, 0xa6, 0x2a, 0x1,
                   0xa3, 0xe8, 0xf6, 0x5b, 0xcc, 0x90, 0xc0, 0x4f, 0xb5, 0xa0, 0x0,  0x0,  0x1e, 0xec, 0xd6,
                   0xce, 0xb5, 0x12, 0xa7, 0xb5, 0x6b, 0xff, 0x63, 0x96, 0x43, 0x26, 0x58, 0x60, 0x52, 0xfa,
                   0x96, 0xf,  0xb8, 0x47, 0xf1, 0x78, 0x97, 0xc4, 0x8f, 0x52, 0x90, 0xd2, 0x77, 0x0};

  uint8_t buf[114] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x5e, 0xe2, 0xfb, 0xb5, 0x32, 0x9c, 0x7c, 0x74, 0x97, 0x53, 0xa9, 0xfc, 0x92,
                                     0x3,  0x1d, 0xac, 0x53, 0xa9, 0x4,  0x8e, 0xc9, 0xad, 0xa4, 0x3d, 0xaa, 0x61};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe1, 0x57, 0x33, 0x6b, 0x21, 0x97, 0xf5, 0xe4,
                                     0x3e, 0xcd, 0xc6, 0x84, 0xa8, 0x2c, 0x8e};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1c, 0xf5, 0x91, 0x1e, 0xa6, 0x2a, 0x1,  0xa3, 0xe8,
                                     0xf6, 0x5b, 0xcc, 0x90, 0xc0, 0x4f, 0xb5, 0xa0};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xec, 0xd6, 0xce, 0xb5, 0x12, 0xa7, 0xb5, 0x6b, 0xff, 0x63,
                                     0x96, 0x43, 0x26, 0x58, 0x60, 0x52, 0xfa, 0x96, 0xf,  0xb8,
                                     0x47, 0xf1, 0x78, 0x97, 0xc4, 0x8f, 0x52, 0x90, 0xd2, 0x77};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11149, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2269 [("\DC2\238\205\167\203qt\199%Vl\129\160y\134\175U^\144K\SYN\ENQ\155+\GSdIr",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\208\157\230h\219\215$\215\133\STXrRf\214m\159\156\229\196\139\223EF>1\n'",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\195S:\237\&8\249\f\223\SOH\EOTZ?\209RD1\128I\133\205\137\135c",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\252\&2\240JZ\198a\161y\244\135\130Ki\174\129\150\137H\142\184\151\167",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("%m\230\152\&3B\177\207",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\SO\US\NUL\133[",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\SO|\177\228\ETB\214C\165`\152*\SOM\180y9\233\&3`",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\160\&8\129\v\DC4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\\z\220\157\147\201\254\SUB\195\158\139\t\158\140\173\133\r\233\175q\212\152\175B\181d\FS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0xc5, 0x1,  0x8,  0xdd, 0x0,  0x1c, 0x12, 0xee, 0xcd, 0xa7, 0xcb, 0x71, 0x74, 0xc7, 0x25, 0x56,
                   0x6c, 0x81, 0xa0, 0x79, 0x86, 0xaf, 0x55, 0x5e, 0x90, 0x4b, 0x16, 0x5,  0x9b, 0x2b, 0x1d, 0x64, 0x49,
                   0x72, 0x2,  0x0,  0x1b, 0xd0, 0x9d, 0xe6, 0x68, 0xdb, 0xd7, 0x24, 0xd7, 0x85, 0x2,  0x72, 0x52, 0x66,
                   0xd6, 0x6d, 0x9f, 0x9c, 0xe5, 0xc4, 0x8b, 0xdf, 0x45, 0x46, 0x3e, 0x31, 0xa,  0x27, 0x0,  0x0,  0x17,
                   0xc3, 0x53, 0x3a, 0xed, 0x38, 0xf9, 0xc,  0xdf, 0x1,  0x4,  0x5a, 0x3f, 0xd1, 0x52, 0x44, 0x31, 0x80,
                   0x49, 0x85, 0xcd, 0x89, 0x87, 0x63, 0x1,  0x0,  0x17, 0xfc, 0x32, 0xf0, 0x4a, 0x5a, 0xc6, 0x61, 0xa1,
                   0x79, 0xf4, 0x87, 0x82, 0x4b, 0x69, 0xae, 0x81, 0x96, 0x89, 0x48, 0x8e, 0xb8, 0x97, 0xa7, 0x0,  0x0,
                   0x8,  0x25, 0x6d, 0xe6, 0x98, 0x33, 0x42, 0xb1, 0xcf, 0x0,  0x0,  0x5,  0xe,  0x1f, 0x0,  0x85, 0x5b,
                   0x0,  0x0,  0x0,  0x0,  0x0,  0x13, 0xe,  0x7c, 0xb1, 0xe4, 0x17, 0xd6, 0x43, 0xa5, 0x60, 0x98, 0x2a,
                   0xe,  0x4d, 0xb4, 0x79, 0x39, 0xe9, 0x33, 0x60, 0x2,  0x0,  0x5,  0xa0, 0x38, 0x81, 0xb,  0x14, 0x2,
                   0x0,  0x1b, 0x5c, 0x7a, 0xdc, 0x9d, 0x93, 0xc9, 0xfe, 0x1a, 0xc3, 0x9e, 0x8b, 0x9,  0x9e, 0x8c, 0xad,
                   0x85, 0xd,  0xe9, 0xaf, 0x71, 0xd4, 0x98, 0xaf, 0x42, 0xb5, 0x64, 0x1c, 0x0};

  uint8_t buf[210] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x12, 0xee, 0xcd, 0xa7, 0xcb, 0x71, 0x74, 0xc7, 0x25, 0x56,
                                     0x6c, 0x81, 0xa0, 0x79, 0x86, 0xaf, 0x55, 0x5e, 0x90, 0x4b,
                                     0x16, 0x5,  0x9b, 0x2b, 0x1d, 0x64, 0x49, 0x72};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x9d, 0xe6, 0x68, 0xdb, 0xd7, 0x24, 0xd7, 0x85, 0x2,  0x72, 0x52, 0x66, 0xd6,
                                     0x6d, 0x9f, 0x9c, 0xe5, 0xc4, 0x8b, 0xdf, 0x45, 0x46, 0x3e, 0x31, 0xa,  0x27};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc3, 0x53, 0x3a, 0xed, 0x38, 0xf9, 0xc,  0xdf, 0x1,  0x4,  0x5a, 0x3f,
                                     0xd1, 0x52, 0x44, 0x31, 0x80, 0x49, 0x85, 0xcd, 0x89, 0x87, 0x63};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfc, 0x32, 0xf0, 0x4a, 0x5a, 0xc6, 0x61, 0xa1, 0x79, 0xf4, 0x87, 0x82,
                                     0x4b, 0x69, 0xae, 0x81, 0x96, 0x89, 0x48, 0x8e, 0xb8, 0x97, 0xa7};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x25, 0x6d, 0xe6, 0x98, 0x33, 0x42, 0xb1, 0xcf};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe, 0x1f, 0x0, 0x85, 0x5b};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe,  0x7c, 0xb1, 0xe4, 0x17, 0xd6, 0x43, 0xa5, 0x60, 0x98,
                                     0x2a, 0xe,  0x4d, 0xb4, 0x79, 0x39, 0xe9, 0x33, 0x60};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa0, 0x38, 0x81, 0xb, 0x14};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5c, 0x7a, 0xdc, 0x9d, 0x93, 0xc9, 0xfe, 0x1a, 0xc3, 0x9e, 0x8b, 0x9,  0x9e, 0x8c,
                                     0xad, 0x85, 0xd,  0xe9, 0xaf, 0x71, 0xd4, 0x98, 0xaf, 0x42, 0xb5, 0x64, 0x1c};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 2269, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9248 [("\233\154\252\129\230\&9\142\177.,%\202H\EM",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("s\ETB\220\154j\DC1\149e\235\252\163\CANis@",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\SOHz\161\174&\ESC;\181-\130",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\204l}DdML\130\250\STX",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x3f, 0x24, 0x20, 0x0,  0xe,  0xe9, 0x9a, 0xfc, 0x81, 0xe6, 0x39, 0x8e, 0xb1, 0x2e, 0x2c, 0x25,
                   0xca, 0x48, 0x19, 0x2,  0x0,  0xf,  0x73, 0x17, 0xdc, 0x9a, 0x6a, 0x11, 0x95, 0x65, 0xeb, 0xfc, 0xa3,
                   0x18, 0x69, 0x73, 0x40, 0x0,  0x0,  0xa,  0x1,  0x7a, 0xa1, 0xae, 0x26, 0x1b, 0x3b, 0xb5, 0x2d, 0x82,
                   0x1,  0x0,  0xa,  0xcc, 0x6c, 0x7d, 0x44, 0x64, 0x4d, 0x4c, 0x82, 0xfa, 0x2,  0x2};

  uint8_t buf[75] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xe9, 0x9a, 0xfc, 0x81, 0xe6, 0x39, 0x8e,
                                     0xb1, 0x2e, 0x2c, 0x25, 0xca, 0x48, 0x19};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x73, 0x17, 0xdc, 0x9a, 0x6a, 0x11, 0x95, 0x65,
                                     0xeb, 0xfc, 0xa3, 0x18, 0x69, 0x73, 0x40};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1, 0x7a, 0xa1, 0xae, 0x26, 0x1b, 0x3b, 0xb5, 0x2d, 0x82};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xcc, 0x6c, 0x7d, 0x44, 0x64, 0x4d, 0x4c, 0x82, 0xfa, 0x2};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9248, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22320 [("U\\Dd9",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS =
// QoS2}),("w\225r\ETB\229\148t\144\141\ETB\DC3\141\216\DEL\SYN7r^\157\169\201\222\240{\CAN\162",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\144%\189P}R&]F\140hw\FS\134Pm\201\240\130#\185",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("6\155R=&\211a\DC3v\192\rP~\175",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\228\161\STXal\230\192\ETB\213\134\a\178a4",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\223\209\242\169\SO\193\&9\248\172\170\181\153\222E!\208\167mA\140\206\170\\\189-A\155",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x7f, 0x57, 0x30, 0x0,  0x5,  0x55, 0x5c, 0x44, 0x64, 0x39, 0x2,  0x0,  0x1a, 0x77, 0xe1, 0x72,
                   0x17, 0xe5, 0x94, 0x74, 0x90, 0x8d, 0x17, 0x13, 0x8d, 0xd8, 0x7f, 0x16, 0x37, 0x72, 0x5e, 0x9d, 0xa9,
                   0xc9, 0xde, 0xf0, 0x7b, 0x18, 0xa2, 0x1,  0x0,  0x15, 0x90, 0x25, 0xbd, 0x50, 0x7d, 0x52, 0x26, 0x5d,
                   0x46, 0x8c, 0x68, 0x77, 0x1c, 0x86, 0x50, 0x6d, 0xc9, 0xf0, 0x82, 0x23, 0xb9, 0x1,  0x0,  0xe,  0x36,
                   0x9b, 0x52, 0x3d, 0x26, 0xd3, 0x61, 0x13, 0x76, 0xc0, 0xd,  0x50, 0x7e, 0xaf, 0x0,  0x0,  0xe,  0xe4,
                   0xa1, 0x2,  0x61, 0x6c, 0xe6, 0xc0, 0x17, 0xd5, 0x86, 0x7,  0xb2, 0x61, 0x34, 0x1,  0x0,  0x1b, 0xdf,
                   0xd1, 0xf2, 0xa9, 0xe,  0xc1, 0x39, 0xf8, 0xac, 0xaa, 0xb5, 0x99, 0xde, 0x45, 0x21, 0xd0, 0xa7, 0x6d,
                   0x41, 0x8c, 0xce, 0xaa, 0x5c, 0xbd, 0x2d, 0x41, 0x9b, 0x2};

  uint8_t buf[139] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x55, 0x5c, 0x44, 0x64, 0x39};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x77, 0xe1, 0x72, 0x17, 0xe5, 0x94, 0x74, 0x90, 0x8d, 0x17, 0x13, 0x8d, 0xd8,
                                     0x7f, 0x16, 0x37, 0x72, 0x5e, 0x9d, 0xa9, 0xc9, 0xde, 0xf0, 0x7b, 0x18, 0xa2};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x90, 0x25, 0xbd, 0x50, 0x7d, 0x52, 0x26, 0x5d, 0x46, 0x8c, 0x68,
                                     0x77, 0x1c, 0x86, 0x50, 0x6d, 0xc9, 0xf0, 0x82, 0x23, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x36, 0x9b, 0x52, 0x3d, 0x26, 0xd3, 0x61, 0x13, 0x76, 0xc0, 0xd, 0x50, 0x7e, 0xaf};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe4, 0xa1, 0x2, 0x61, 0x6c, 0xe6, 0xc0, 0x17, 0xd5, 0x86, 0x7, 0xb2, 0x61, 0x34};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xdf, 0xd1, 0xf2, 0xa9, 0xe,  0xc1, 0x39, 0xf8, 0xac, 0xaa, 0xb5, 0x99, 0xde, 0x45,
                                     0x21, 0xd0, 0xa7, 0x6d, 0x41, 0x8c, 0xce, 0xaa, 0x5c, 0xbd, 0x2d, 0x41, 0x9b};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22320, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 30493 [("\214C\211\153\&6\151\166\198\180w\131_\236",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\173\182\235`z\189",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\142J\163\SUB<\166\240y\176r\192",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("_\255]*t\ETB\162j\206\132\141\&3\169\148\170\217$H\SYN\255\187\131\233\244\159'\165\229M",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\CANY\SI2\187\199D\227G\253\202\CAN\208h\154h`\254\236\133/\200\173\163\158\208\238u>",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\237\ETB1\149\ETX\245\172\173\ETB\135\SOI",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS0}),("\245\157c\165h\181Ss\238\217\ESC\ENQ\206\225\171l\SUB\160A$\239\146pa\170\138",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\142\210",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropRetainAvailable 254,PropContentType "a$\140\162\133`\134\\G\US\DLE\191",PropWildcardSubscriptionAvailable
// 25,PropMaximumPacketSize 16917,PropRequestResponseInformation 230,PropAssignedClientIdentifier
// "0d\171\242]\161B\161\213\166W\202v\128\147\240}aGG\161A\253\181\182\156"]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0xd8, 0x1,  0x77, 0x1d, 0x37, 0x25, 0xfe, 0x3,  0x0,  0xc,  0x61, 0x24, 0x8c, 0xa2, 0x85, 0x60,
                   0x86, 0x5c, 0x47, 0x1f, 0x10, 0xbf, 0x28, 0x19, 0x27, 0x0,  0x0,  0x42, 0x15, 0x19, 0xe6, 0x12, 0x0,
                   0x1a, 0x30, 0x64, 0xab, 0xf2, 0x5d, 0xa1, 0x42, 0xa1, 0xd5, 0xa6, 0x57, 0xca, 0x76, 0x80, 0x93, 0xf0,
                   0x7d, 0x61, 0x47, 0x47, 0xa1, 0x41, 0xfd, 0xb5, 0xb6, 0x9c, 0x0,  0xd,  0xd6, 0x43, 0xd3, 0x99, 0x36,
                   0x97, 0xa6, 0xc6, 0xb4, 0x77, 0x83, 0x5f, 0xec, 0x2,  0x0,  0x0,  0x1,  0x0,  0x6,  0xad, 0xb6, 0xeb,
                   0x60, 0x7a, 0xbd, 0x0,  0x0,  0xb,  0x8e, 0x4a, 0xa3, 0x1a, 0x3c, 0xa6, 0xf0, 0x79, 0xb0, 0x72, 0xc0,
                   0x1,  0x0,  0x1d, 0x5f, 0xff, 0x5d, 0x2a, 0x74, 0x17, 0xa2, 0x6a, 0xce, 0x84, 0x8d, 0x33, 0xa9, 0x94,
                   0xaa, 0xd9, 0x24, 0x48, 0x16, 0xff, 0xbb, 0x83, 0xe9, 0xf4, 0x9f, 0x27, 0xa5, 0xe5, 0x4d, 0x1,  0x0,
                   0x1d, 0x18, 0x59, 0xf,  0x32, 0xbb, 0xc7, 0x44, 0xe3, 0x47, 0xfd, 0xca, 0x18, 0xd0, 0x68, 0x9a, 0x68,
                   0x60, 0xfe, 0xec, 0x85, 0x2f, 0xc8, 0xad, 0xa3, 0x9e, 0xd0, 0xee, 0x75, 0x3e, 0x0,  0x0,  0xc,  0xed,
                   0x17, 0x31, 0x95, 0x3,  0xf5, 0xac, 0xad, 0x17, 0x87, 0xe,  0x49, 0x0,  0x0,  0x1a, 0xf5, 0x9d, 0x63,
                   0xa5, 0x68, 0xb5, 0x53, 0x73, 0xee, 0xd9, 0x1b, 0x5,  0xce, 0xe1, 0xab, 0x6c, 0x1a, 0xa0, 0x41, 0x24,
                   0xef, 0x92, 0x70, 0x61, 0xaa, 0x8a, 0x2,  0x0,  0x0,  0x0,  0x0,  0x2,  0x8e, 0xd2, 0x0};

  uint8_t buf[229] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd6, 0x43, 0xd3, 0x99, 0x36, 0x97, 0xa6, 0xc6, 0xb4, 0x77, 0x83, 0x5f, 0xec};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0};
  lwmqtt_string_t topic_filter_s1 = {0, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xad, 0xb6, 0xeb, 0x60, 0x7a, 0xbd};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8e, 0x4a, 0xa3, 0x1a, 0x3c, 0xa6, 0xf0, 0x79, 0xb0, 0x72, 0xc0};
  lwmqtt_string_t topic_filter_s3 = {11, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5f, 0xff, 0x5d, 0x2a, 0x74, 0x17, 0xa2, 0x6a, 0xce, 0x84,
                                     0x8d, 0x33, 0xa9, 0x94, 0xaa, 0xd9, 0x24, 0x48, 0x16, 0xff,
                                     0xbb, 0x83, 0xe9, 0xf4, 0x9f, 0x27, 0xa5, 0xe5, 0x4d};
  lwmqtt_string_t topic_filter_s4 = {29, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x18, 0x59, 0xf,  0x32, 0xbb, 0xc7, 0x44, 0xe3, 0x47, 0xfd,
                                     0xca, 0x18, 0xd0, 0x68, 0x9a, 0x68, 0x60, 0xfe, 0xec, 0x85,
                                     0x2f, 0xc8, 0xad, 0xa3, 0x9e, 0xd0, 0xee, 0x75, 0x3e};
  lwmqtt_string_t topic_filter_s5 = {29, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xed, 0x17, 0x31, 0x95, 0x3, 0xf5, 0xac, 0xad, 0x17, 0x87, 0xe, 0x49};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xf5, 0x9d, 0x63, 0xa5, 0x68, 0xb5, 0x53, 0x73, 0xee, 0xd9, 0x1b, 0x5,  0xce,
                                     0xe1, 0xab, 0x6c, 0x1a, 0xa0, 0x41, 0x24, 0xef, 0x92, 0x70, 0x61, 0xaa, 0x8a};
  lwmqtt_string_t topic_filter_s7 = {26, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0};
  lwmqtt_string_t topic_filter_s8 = {0, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x8e, 0xd2};
  lwmqtt_string_t topic_filter_s9 = {2, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS1,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0x61, 0x24, 0x8c, 0xa2, 0x85, 0x60, 0x86, 0x5c, 0x47, 0x1f, 0x10, 0xbf};
  uint8_t bytesprops1[] = {0x30, 0x64, 0xab, 0xf2, 0x5d, 0xa1, 0x42, 0xa1, 0xd5, 0xa6, 0x57, 0xca, 0x76,
                           0x80, 0x93, 0xf0, 0x7d, 0x61, 0x47, 0x47, 0xa1, 0x41, 0xfd, 0xb5, 0xb6, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 254}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16917}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30493, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20478 [("\184}2\DC2\bp#\148\f\DC1\208}\194",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\181\209\150\255\240\&5\243\DC2\SO\208ji\180\129&P\178\ENQ?\229W?\192\GS\185\211\166\213\&4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\248\196L\195\ESC\ETX\DC3N\135\&3",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\198\170\141\229\221[\227KN\143Fw\153\t\163\203\n\181\151\147\170",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\160\253\207yPZ\a\211\172o\148",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\164s\134^.\223\218\240\197J\148\212",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\240\\\189j\185\226\139}",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("x\172\224\142\143\226\196Z\SYN0\229l\218\175u`\190\250.m\227\222\240\ACK\255\DC2\211W",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\197U\154\166\243\218<\211^f\176\170Y\DC3\162;9^\159\232\181\239\161D\179\&2",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropReasonString
// "3\GS\220\243\DC3\147\SI\142r\SUBo\198\137\235\137t\217\223n\190m",PropTopicAlias 15148]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0xd7, 0x1,  0x4f, 0xfe, 0x1b, 0x1f, 0x0,  0x15, 0x33, 0x1d, 0xdc, 0xf3, 0x13, 0x93, 0xf,  0x8e,
                   0x72, 0x1a, 0x6f, 0xc6, 0x89, 0xeb, 0x89, 0x74, 0xd9, 0xdf, 0x6e, 0xbe, 0x6d, 0x23, 0x3b, 0x2c, 0x0,
                   0xd,  0xb8, 0x7d, 0x32, 0x12, 0x8,  0x70, 0x23, 0x94, 0xc,  0x11, 0xd0, 0x7d, 0xc2, 0x1,  0x0,  0x1d,
                   0xb5, 0xd1, 0x96, 0xff, 0xf0, 0x35, 0xf3, 0x12, 0xe,  0xd0, 0x6a, 0x69, 0xb4, 0x81, 0x26, 0x50, 0xb2,
                   0x5,  0x3f, 0xe5, 0x57, 0x3f, 0xc0, 0x1d, 0xb9, 0xd3, 0xa6, 0xd5, 0x34, 0x2,  0x0,  0xa,  0xf8, 0xc4,
                   0x4c, 0xc3, 0x1b, 0x3,  0x13, 0x4e, 0x87, 0x33, 0x0,  0x0,  0x15, 0xc6, 0xaa, 0x8d, 0xe5, 0xdd, 0x5b,
                   0xe3, 0x4b, 0x4e, 0x8f, 0x46, 0x77, 0x99, 0x9,  0xa3, 0xcb, 0xa,  0xb5, 0x97, 0x93, 0xaa, 0x1,  0x0,
                   0xb,  0xa0, 0xfd, 0xcf, 0x79, 0x50, 0x5a, 0x7,  0xd3, 0xac, 0x6f, 0x94, 0x0,  0x0,  0xc,  0xa4, 0x73,
                   0x86, 0x5e, 0x2e, 0xdf, 0xda, 0xf0, 0xc5, 0x4a, 0x94, 0xd4, 0x2,  0x0,  0x8,  0xf0, 0x5c, 0xbd, 0x6a,
                   0xb9, 0xe2, 0x8b, 0x7d, 0x2,  0x0,  0x1c, 0x78, 0xac, 0xe0, 0x8e, 0x8f, 0xe2, 0xc4, 0x5a, 0x16, 0x30,
                   0xe5, 0x6c, 0xda, 0xaf, 0x75, 0x60, 0xbe, 0xfa, 0x2e, 0x6d, 0xe3, 0xde, 0xf0, 0x6,  0xff, 0x12, 0xd3,
                   0x57, 0x0,  0x0,  0x1a, 0xc5, 0x55, 0x9a, 0xa6, 0xf3, 0xda, 0x3c, 0xd3, 0x5e, 0x66, 0xb0, 0xaa, 0x59,
                   0x13, 0xa2, 0x3b, 0x39, 0x5e, 0x9f, 0xe8, 0xb5, 0xef, 0xa1, 0x44, 0xb3, 0x32, 0x2};

  uint8_t buf[228] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0xb8, 0x7d, 0x32, 0x12, 0x8, 0x70, 0x23, 0x94, 0xc, 0x11, 0xd0, 0x7d, 0xc2};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb5, 0xd1, 0x96, 0xff, 0xf0, 0x35, 0xf3, 0x12, 0xe,  0xd0,
                                     0x6a, 0x69, 0xb4, 0x81, 0x26, 0x50, 0xb2, 0x5,  0x3f, 0xe5,
                                     0x57, 0x3f, 0xc0, 0x1d, 0xb9, 0xd3, 0xa6, 0xd5, 0x34};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf8, 0xc4, 0x4c, 0xc3, 0x1b, 0x3, 0x13, 0x4e, 0x87, 0x33};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xc6, 0xaa, 0x8d, 0xe5, 0xdd, 0x5b, 0xe3, 0x4b, 0x4e, 0x8f, 0x46,
                                     0x77, 0x99, 0x9,  0xa3, 0xcb, 0xa,  0xb5, 0x97, 0x93, 0xaa};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0xfd, 0xcf, 0x79, 0x50, 0x5a, 0x7, 0xd3, 0xac, 0x6f, 0x94};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa4, 0x73, 0x86, 0x5e, 0x2e, 0xdf, 0xda, 0xf0, 0xc5, 0x4a, 0x94, 0xd4};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf0, 0x5c, 0xbd, 0x6a, 0xb9, 0xe2, 0x8b, 0x7d};
  lwmqtt_string_t topic_filter_s6 = {8, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x78, 0xac, 0xe0, 0x8e, 0x8f, 0xe2, 0xc4, 0x5a, 0x16, 0x30,
                                     0xe5, 0x6c, 0xda, 0xaf, 0x75, 0x60, 0xbe, 0xfa, 0x2e, 0x6d,
                                     0xe3, 0xde, 0xf0, 0x6,  0xff, 0x12, 0xd3, 0x57};
  lwmqtt_string_t topic_filter_s7 = {28, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc5, 0x55, 0x9a, 0xa6, 0xf3, 0xda, 0x3c, 0xd3, 0x5e, 0x66, 0xb0, 0xaa, 0x59,
                                     0x13, 0xa2, 0x3b, 0x39, 0x5e, 0x9f, 0xe8, 0xb5, 0xef, 0xa1, 0x44, 0xb3, 0x32};
  lwmqtt_string_t topic_filter_s8 = {26, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0,
                               LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x33, 0x1d, 0xdc, 0xf3, 0x13, 0x93, 0xf,  0x8e, 0x72, 0x1a, 0x6f,
                           0xc6, 0x89, 0xeb, 0x89, 0x74, 0xd9, 0xdf, 0x6e, 0xbe, 0x6d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15148}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20478, 9, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 17981
// [("\236?\165\226{<y%\223.\GS4g\150\199\&1\148\241\DLER\138\158\208\133\246\f8\242\US\232",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\169\137\248\156\152\SUB&\a\132#\150\143\245`{\169!a\202\166O!\rn\\\213\195-AU",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("[\a\229\206\223\DC3\\\131\&3\193'\CAN\240\149\GS\141I+\130\221\229\228A",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\183\235\132\&4+Z\241\247",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\175-\132N\226\179\199Mk\RSwk\188\148",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\DC3\229tZw\198\&3!d+\198U\133\162",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\US3\US\235\188\171\225\155\214\155\232\141q\136~",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\EM[\188\159\244x\222\170\NAK#\DLEdl:\218\253\139\196\GS\168",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\SIia\255\137=\235\f",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SI'\239\214\183\175\n\244P\ENQ\DEL\145\ETX\180",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropRequestProblemInformation 98,PropRetainAvailable
// 137,PropMessageExpiryInterval 10326,PropReasonString "\197",PropUserProperty "\199\171"
// "fN@2\210\&7X_\132]\191\189e",PropUserProperty "\144\252\ACK\253\192"
// "\146\251\227\240\&0\176\&3M\181\233n\246v\137\156>!\241\176\148uM",PropMaximumQoS 1,PropTopicAlias
// 9863,PropResponseTopic "\249O\221\134\STX*\131\148\136\ETB\220\238\213a'\174!\SUB.p",PropServerReference
// "\251){E?}\238y\USJ\132\193D\r\186\173p\174\r\244b\144",PropAssignedClientIdentifier
// "vD\148\RS`\189\228\247]%\236,\186W\NAK\203\198\250mx\172\230H\137\252T\222"]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x82, 0xe6, 0x2,  0x46, 0x3d, 0x94, 0x1,  0x17, 0x62, 0x25, 0x89, 0x2,  0x0,  0x0,  0x28, 0x56, 0x1f, 0x0,  0x1,
      0xc5, 0x26, 0x0,  0x2,  0xc7, 0xab, 0x0,  0xd,  0x66, 0x4e, 0x40, 0x32, 0xd2, 0x37, 0x58, 0x5f, 0x84, 0x5d, 0xbf,
      0xbd, 0x65, 0x26, 0x0,  0x5,  0x90, 0xfc, 0x6,  0xfd, 0xc0, 0x0,  0x16, 0x92, 0xfb, 0xe3, 0xf0, 0x30, 0xb0, 0x33,
      0x4d, 0xb5, 0xe9, 0x6e, 0xf6, 0x76, 0x89, 0x9c, 0x3e, 0x21, 0xf1, 0xb0, 0x94, 0x75, 0x4d, 0x24, 0x1,  0x23, 0x26,
      0x87, 0x8,  0x0,  0x14, 0xf9, 0x4f, 0xdd, 0x86, 0x2,  0x2a, 0x83, 0x94, 0x88, 0x17, 0xdc, 0xee, 0xd5, 0x61, 0x27,
      0xae, 0x21, 0x1a, 0x2e, 0x70, 0x1c, 0x0,  0x16, 0xfb, 0x29, 0x7b, 0x45, 0x3f, 0x7d, 0xee, 0x79, 0x1f, 0x4a, 0x84,
      0xc1, 0x44, 0xd,  0xba, 0xad, 0x70, 0xae, 0xd,  0xf4, 0x62, 0x90, 0x12, 0x0,  0x1b, 0x76, 0x44, 0x94, 0x1e, 0x60,
      0xbd, 0xe4, 0xf7, 0x5d, 0x25, 0xec, 0x2c, 0xba, 0x57, 0x15, 0xcb, 0xc6, 0xfa, 0x6d, 0x78, 0xac, 0xe6, 0x48, 0x89,
      0xfc, 0x54, 0xde, 0x0,  0x1e, 0xec, 0x3f, 0xa5, 0xe2, 0x7b, 0x3c, 0x79, 0x25, 0xdf, 0x2e, 0x1d, 0x34, 0x67, 0x96,
      0xc7, 0x31, 0x94, 0xf1, 0x10, 0x52, 0x8a, 0x9e, 0xd0, 0x85, 0xf6, 0xc,  0x38, 0xf2, 0x1f, 0xe8, 0x1,  0x0,  0x1e,
      0xa9, 0x89, 0xf8, 0x9c, 0x98, 0x1a, 0x26, 0x7,  0x84, 0x23, 0x96, 0x8f, 0xf5, 0x60, 0x7b, 0xa9, 0x21, 0x61, 0xca,
      0xa6, 0x4f, 0x21, 0xd,  0x6e, 0x5c, 0xd5, 0xc3, 0x2d, 0x41, 0x55, 0x2,  0x0,  0x17, 0x5b, 0x7,  0xe5, 0xce, 0xdf,
      0x13, 0x5c, 0x83, 0x33, 0xc1, 0x27, 0x18, 0xf0, 0x95, 0x1d, 0x8d, 0x49, 0x2b, 0x82, 0xdd, 0xe5, 0xe4, 0x41, 0x1,
      0x0,  0x8,  0xb7, 0xeb, 0x84, 0x34, 0x2b, 0x5a, 0xf1, 0xf7, 0x2,  0x0,  0xe,  0xaf, 0x2d, 0x84, 0x4e, 0xe2, 0xb3,
      0xc7, 0x4d, 0x6b, 0x1e, 0x77, 0x6b, 0xbc, 0x94, 0x2,  0x0,  0xe,  0x13, 0xe5, 0x74, 0x5a, 0x77, 0xc6, 0x33, 0x21,
      0x64, 0x2b, 0xc6, 0x55, 0x85, 0xa2, 0x2,  0x0,  0xf,  0x1f, 0x33, 0x1f, 0xeb, 0xbc, 0xab, 0xe1, 0x9b, 0xd6, 0x9b,
      0xe8, 0x8d, 0x71, 0x88, 0x7e, 0x0,  0x0,  0x14, 0x19, 0x5b, 0xbc, 0x9f, 0xf4, 0x78, 0xde, 0xaa, 0x15, 0x23, 0x10,
      0x64, 0x6c, 0x3a, 0xda, 0xfd, 0x8b, 0xc4, 0x1d, 0xa8, 0x2,  0x0,  0x8,  0xf,  0x69, 0x61, 0xff, 0x89, 0x3d, 0xeb,
      0xc,  0x2,  0x0,  0xe,  0xf,  0x27, 0xef, 0xd6, 0xb7, 0xaf, 0xa,  0xf4, 0x50, 0x5,  0x7f, 0x91, 0x3,  0xb4, 0x2};

  uint8_t buf[371] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xec, 0x3f, 0xa5, 0xe2, 0x7b, 0x3c, 0x79, 0x25, 0xdf, 0x2e,
                                     0x1d, 0x34, 0x67, 0x96, 0xc7, 0x31, 0x94, 0xf1, 0x10, 0x52,
                                     0x8a, 0x9e, 0xd0, 0x85, 0xf6, 0xc,  0x38, 0xf2, 0x1f, 0xe8};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa9, 0x89, 0xf8, 0x9c, 0x98, 0x1a, 0x26, 0x7,  0x84, 0x23,
                                     0x96, 0x8f, 0xf5, 0x60, 0x7b, 0xa9, 0x21, 0x61, 0xca, 0xa6,
                                     0x4f, 0x21, 0xd,  0x6e, 0x5c, 0xd5, 0xc3, 0x2d, 0x41, 0x55};
  lwmqtt_string_t topic_filter_s1 = {30, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5b, 0x7,  0xe5, 0xce, 0xdf, 0x13, 0x5c, 0x83, 0x33, 0xc1, 0x27, 0x18,
                                     0xf0, 0x95, 0x1d, 0x8d, 0x49, 0x2b, 0x82, 0xdd, 0xe5, 0xe4, 0x41};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb7, 0xeb, 0x84, 0x34, 0x2b, 0x5a, 0xf1, 0xf7};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xaf, 0x2d, 0x84, 0x4e, 0xe2, 0xb3, 0xc7,
                                     0x4d, 0x6b, 0x1e, 0x77, 0x6b, 0xbc, 0x94};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x13, 0xe5, 0x74, 0x5a, 0x77, 0xc6, 0x33,
                                     0x21, 0x64, 0x2b, 0xc6, 0x55, 0x85, 0xa2};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1f, 0x33, 0x1f, 0xeb, 0xbc, 0xab, 0xe1, 0x9b,
                                     0xd6, 0x9b, 0xe8, 0x8d, 0x71, 0x88, 0x7e};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x19, 0x5b, 0xbc, 0x9f, 0xf4, 0x78, 0xde, 0xaa, 0x15, 0x23,
                                     0x10, 0x64, 0x6c, 0x3a, 0xda, 0xfd, 0x8b, 0xc4, 0x1d, 0xa8};
  lwmqtt_string_t topic_filter_s7 = {20, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xf, 0x69, 0x61, 0xff, 0x89, 0x3d, 0xeb, 0xc};
  lwmqtt_string_t topic_filter_s8 = {8, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xf, 0x27, 0xef, 0xd6, 0xb7, 0xaf, 0xa, 0xf4, 0x50, 0x5, 0x7f, 0x91, 0x3, 0xb4};
  lwmqtt_string_t topic_filter_s9 = {14, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS2, LWMQTT_QOS2,
                               LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0xc5};
  uint8_t bytesprops2[] = {0x66, 0x4e, 0x40, 0x32, 0xd2, 0x37, 0x58, 0x5f, 0x84, 0x5d, 0xbf, 0xbd, 0x65};
  uint8_t bytesprops1[] = {0xc7, 0xab};
  uint8_t bytesprops4[] = {0x92, 0xfb, 0xe3, 0xf0, 0x30, 0xb0, 0x33, 0x4d, 0xb5, 0xe9, 0x6e,
                           0xf6, 0x76, 0x89, 0x9c, 0x3e, 0x21, 0xf1, 0xb0, 0x94, 0x75, 0x4d};
  uint8_t bytesprops3[] = {0x90, 0xfc, 0x6, 0xfd, 0xc0};
  uint8_t bytesprops5[] = {0xf9, 0x4f, 0xdd, 0x86, 0x2,  0x2a, 0x83, 0x94, 0x88, 0x17,
                           0xdc, 0xee, 0xd5, 0x61, 0x27, 0xae, 0x21, 0x1a, 0x2e, 0x70};
  uint8_t bytesprops6[] = {0xfb, 0x29, 0x7b, 0x45, 0x3f, 0x7d, 0xee, 0x79, 0x1f, 0x4a, 0x84,
                           0xc1, 0x44, 0xd,  0xba, 0xad, 0x70, 0xae, 0xd,  0xf4, 0x62, 0x90};
  uint8_t bytesprops7[] = {0x76, 0x44, 0x94, 0x1e, 0x60, 0xbd, 0xe4, 0xf7, 0x5d, 0x25, 0xec, 0x2c, 0xba, 0x57,
                           0x15, 0xcb, 0xc6, 0xfa, 0x6d, 0x78, 0xac, 0xe6, 0x48, 0x89, 0xfc, 0x54, 0xde};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10326}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops1}, .v = {13, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops3}, .v = {22, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 1}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9863}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17981, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19276 [(";'D\231\163t\131\134\DC1\172\GS\EOT",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("G\167C\245\138\221v\SI",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\ESC\250\186Jm\250\238\180\199w\132\166",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("4+\184\&93\225GY\193:\184\143%\155\SOH",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropResponseTopic
// "7wH\235\154",PropMessageExpiryInterval 9779,PropTopicAliasMaximum 9795,PropRequestProblemInformation 193]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0x50, 0x4b, 0x4c, 0x12, 0x8,  0x0,  0x5,  0x37, 0x77, 0x48, 0xeb, 0x9a, 0x2,  0x0,  0x0,  0x26,
                   0x33, 0x22, 0x26, 0x43, 0x17, 0xc1, 0x0,  0xc,  0x3b, 0x27, 0x44, 0xe7, 0xa3, 0x74, 0x83, 0x86, 0x11,
                   0xac, 0x1d, 0x4,  0x2,  0x0,  0x8,  0x47, 0xa7, 0x43, 0xf5, 0x8a, 0xdd, 0x76, 0xf,  0x1,  0x0,  0xc,
                   0x1b, 0xfa, 0xba, 0x4a, 0x6d, 0xfa, 0xee, 0xb4, 0xc7, 0x77, 0x84, 0xa6, 0x1,  0x0,  0xf,  0x34, 0x2b,
                   0xb8, 0x39, 0x33, 0xe1, 0x47, 0x59, 0xc1, 0x3a, 0xb8, 0x8f, 0x25, 0x9b, 0x1,  0x2};

  uint8_t buf[92] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x3b, 0x27, 0x44, 0xe7, 0xa3, 0x74, 0x83, 0x86, 0x11, 0xac, 0x1d, 0x4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x47, 0xa7, 0x43, 0xf5, 0x8a, 0xdd, 0x76, 0xf};
  lwmqtt_string_t topic_filter_s1 = {8, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1b, 0xfa, 0xba, 0x4a, 0x6d, 0xfa, 0xee, 0xb4, 0xc7, 0x77, 0x84, 0xa6};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x34, 0x2b, 0xb8, 0x39, 0x33, 0xe1, 0x47, 0x59,
                                     0xc1, 0x3a, 0xb8, 0x8f, 0x25, 0x9b, 0x1};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x37, 0x77, 0x48, 0xeb, 0x9a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9779}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9795}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 193}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19276, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2713 [("\v\149\153&\227@\158",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\137\178V\240lc\224\b\175']\235\NUL$\243G\224_*\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("9\210TgR\152e\221\141\200\213\141\198U\DC3V5\226\221\190M\169",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropAuthenticationData
// "\132\&6vF\NUL\217\DEL^\246\DC3m5!\212\238\ESC\239[f",PropMaximumQoS 92,PropRequestResponseInformation
// 33,PropRequestProblemInformation 243,PropTopicAlias 1722,PropAssignedClientIdentifier
// "Q%\151\&1\226Z\147\153\247b",PropCorrelationData "\163",PropRequestProblemInformation 24,PropResponseInformation
// "\213\215\151\SOH",PropAuthenticationMethod "6\254t\b\241\&3\208"]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0x80, 0x1,  0xa,  0x99, 0x43, 0x16, 0x0,  0x13, 0x84, 0x36, 0x76, 0x46, 0x0,  0xd9, 0x7f, 0x5e,
                   0xf6, 0x13, 0x6d, 0x35, 0x21, 0xd4, 0xee, 0x1b, 0xef, 0x5b, 0x66, 0x24, 0x5c, 0x19, 0x21, 0x17, 0xf3,
                   0x23, 0x6,  0xba, 0x12, 0x0,  0xa,  0x51, 0x25, 0x97, 0x31, 0xe2, 0x5a, 0x93, 0x99, 0xf7, 0x62, 0x9,
                   0x0,  0x1,  0xa3, 0x17, 0x18, 0x1a, 0x0,  0x4,  0xd5, 0xd7, 0x97, 0x1,  0x15, 0x0,  0x7,  0x36, 0xfe,
                   0x74, 0x8,  0xf1, 0x33, 0xd0, 0x0,  0x7,  0xb,  0x95, 0x99, 0x26, 0xe3, 0x40, 0x9e, 0x2,  0x0,  0x14,
                   0x89, 0xb2, 0x56, 0xf0, 0x6c, 0x63, 0xe0, 0x8,  0xaf, 0x27, 0x5d, 0xeb, 0x0,  0x24, 0xf3, 0x47, 0xe0,
                   0x5f, 0x2a, 0xfe, 0x0,  0x0,  0x16, 0x39, 0xd2, 0x54, 0x67, 0x52, 0x98, 0x65, 0xdd, 0x8d, 0xc8, 0xd5,
                   0x8d, 0xc6, 0x55, 0x13, 0x56, 0x35, 0xe2, 0xdd, 0xbe, 0x4d, 0xa9, 0x1};

  uint8_t buf[141] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0xb, 0x95, 0x99, 0x26, 0xe3, 0x40, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {7, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x89, 0xb2, 0x56, 0xf0, 0x6c, 0x63, 0xe0, 0x8,  0xaf, 0x27,
                                     0x5d, 0xeb, 0x0,  0x24, 0xf3, 0x47, 0xe0, 0x5f, 0x2a, 0xfe};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x39, 0xd2, 0x54, 0x67, 0x52, 0x98, 0x65, 0xdd, 0x8d, 0xc8, 0xd5,
                                     0x8d, 0xc6, 0x55, 0x13, 0x56, 0x35, 0xe2, 0xdd, 0xbe, 0x4d, 0xa9};
  lwmqtt_string_t topic_filter_s2 = {22, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0x84, 0x36, 0x76, 0x46, 0x0,  0xd9, 0x7f, 0x5e, 0xf6, 0x13,
                           0x6d, 0x35, 0x21, 0xd4, 0xee, 0x1b, 0xef, 0x5b, 0x66};
  uint8_t bytesprops1[] = {0x51, 0x25, 0x97, 0x31, 0xe2, 0x5a, 0x93, 0x99, 0xf7, 0x62};
  uint8_t bytesprops2[] = {0xa3};
  uint8_t bytesprops3[] = {0xd5, 0xd7, 0x97, 0x1};
  uint8_t bytesprops4[] = {0x36, 0xfe, 0x74, 0x8, 0xf1, 0x33, 0xd0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1722}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {7, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2713, 3, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7741 [("7\233y\244\229-\244\179\172\&6\164H",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),(")\139\210\DC4\162\189qQ\DC4\141\253\&8",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})]
// [PropAuthenticationMethod "\227\ACK\144\181\222",PropTopicAliasMaximum 7962,PropResponseInformation
// "\137\132",PropMessageExpiryInterval 26117,PropMessageExpiryInterval 22772,PropResponseTopic
// "\166\249/hZ\139\DC4",PropUserProperty "i\a\140}\167\249k"
// "\196H\133j\236\STXd)\ESC\201{\207",PropAssignedClientIdentifier "H\196\239",PropReasonString "\NUL\DEL\176\252
// \177\231@u-\144\NAK\220TiQ\128\144",PropSubscriptionIdentifierAvailable 188,PropAssignedClientIdentifier
// "\DC3ht\222\180\182\154\240\186J\135t\188=\SYN\212'\US:S\193h\ETX",PropServerKeepAlive
// 12221,PropMessageExpiryInterval 1211]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x9c, 0x1,  0x1e, 0x3d, 0x7b, 0x15, 0x0,  0x5,  0xe3, 0x6,  0x90, 0xb5, 0xde, 0x22, 0x1f,
                   0x1a, 0x1a, 0x0,  0x2,  0x89, 0x84, 0x2,  0x0,  0x0,  0x66, 0x5,  0x2,  0x0,  0x0,  0x58, 0xf4,
                   0x8,  0x0,  0x7,  0xa6, 0xf9, 0x2f, 0x68, 0x5a, 0x8b, 0x14, 0x26, 0x0,  0x7,  0x69, 0x7,  0x8c,
                   0x7d, 0xa7, 0xf9, 0x6b, 0x0,  0xc,  0xc4, 0x48, 0x85, 0x6a, 0xec, 0x2,  0x64, 0x29, 0x1b, 0xc9,
                   0x7b, 0xcf, 0x12, 0x0,  0x3,  0x48, 0xc4, 0xef, 0x1f, 0x0,  0x12, 0x0,  0x7f, 0xb0, 0xfc, 0x20,
                   0xb1, 0xe7, 0x40, 0x75, 0x2d, 0x90, 0x15, 0xdc, 0x54, 0x69, 0x51, 0x80, 0x90, 0x29, 0xbc, 0x12,
                   0x0,  0x17, 0x13, 0x68, 0x74, 0xde, 0xb4, 0xb6, 0x9a, 0xf0, 0xba, 0x4a, 0x87, 0x74, 0xbc, 0x3d,
                   0x16, 0xd4, 0x27, 0x1f, 0x3a, 0x53, 0xc1, 0x68, 0x3,  0x13, 0x2f, 0xbd, 0x2,  0x0,  0x0,  0x4,
                   0xbb, 0x0,  0xc,  0x37, 0xe9, 0x79, 0xf4, 0xe5, 0x2d, 0xf4, 0xb3, 0xac, 0x36, 0xa4, 0x48, 0x1,
                   0x0,  0xc,  0x29, 0x8b, 0xd2, 0x14, 0xa2, 0xbd, 0x71, 0x51, 0x14, 0x8d, 0xfd, 0x38, 0x1};

  uint8_t buf[169] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x37, 0xe9, 0x79, 0xf4, 0xe5, 0x2d, 0xf4, 0xb3, 0xac, 0x36, 0xa4, 0x48};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x29, 0x8b, 0xd2, 0x14, 0xa2, 0xbd, 0x71, 0x51, 0x14, 0x8d, 0xfd, 0x38};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS1};
  uint8_t bytesprops0[] = {0xe3, 0x6, 0x90, 0xb5, 0xde};
  uint8_t bytesprops1[] = {0x89, 0x84};
  uint8_t bytesprops2[] = {0xa6, 0xf9, 0x2f, 0x68, 0x5a, 0x8b, 0x14};
  uint8_t bytesprops4[] = {0xc4, 0x48, 0x85, 0x6a, 0xec, 0x2, 0x64, 0x29, 0x1b, 0xc9, 0x7b, 0xcf};
  uint8_t bytesprops3[] = {0x69, 0x7, 0x8c, 0x7d, 0xa7, 0xf9, 0x6b};
  uint8_t bytesprops5[] = {0x48, 0xc4, 0xef};
  uint8_t bytesprops6[] = {0x0,  0x7f, 0xb0, 0xfc, 0x20, 0xb1, 0xe7, 0x40, 0x75,
                           0x2d, 0x90, 0x15, 0xdc, 0x54, 0x69, 0x51, 0x80, 0x90};
  uint8_t bytesprops7[] = {0x13, 0x68, 0x74, 0xde, 0xb4, 0xb6, 0x9a, 0xf0, 0xba, 0x4a, 0x87, 0x74,
                           0xbc, 0x3d, 0x16, 0xd4, 0x27, 0x1f, 0x3a, 0x53, 0xc1, 0x68, 0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7962}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26117}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22772}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops3}, .v = {12, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12221}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1211}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7741, 2, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 11149
// [("^\226\251\181\&2\156|t\151S\169\252\146\ETX\GS\172S\169\EOT\142\201\173\164=\170a",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\225W3k!\151\245\228>\205\198\132\168,\142",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\FS\245\145\RS\166*\SOH\163\232\246[\204\144\192O\181\160",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\236\214\206\181\DC2\167\181k\255c\150C&X`R\250\150\SI\184G\241x\151\196\143R\144\210w",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropAuthenticationData "^-u\FS\NAK\ACKO\170z\169\219\182\154\238\DC2\NAKB\134\158\v/\DC123\242t",PropServerReference
// "\DEL]\197\217\158)\RSC50\154\255\214E]\NAK\190\b\187f\217_\237\ACK\152*",PropSubscriptionIdentifierAvailable
// 78,PropTopicAlias 20242,PropReasonString "$\153K)mq\t\173>\194\168!\177=\GS\CAN",PropContentType
// "\184\217\179)7\168$~K\176'\205\159!\247\229\ACK\167F\ESC\223s\160",PropPayloadFormatIndicator
// 199,PropServerReference "\164",PropCorrelationData "+\229w^\235\r\172\245q\202\202\219b\151\155M\176?\224"]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xf0, 0x1,  0x2b, 0x8d, 0x88, 0x1,  0x16, 0x0,  0x1a, 0x5e, 0x2d, 0x75, 0x1c, 0x15, 0x6,  0x4f, 0xaa, 0x7a,
      0xa9, 0xdb, 0xb6, 0x9a, 0xee, 0x12, 0x15, 0x42, 0x86, 0x9e, 0xb,  0x2f, 0x11, 0x32, 0x33, 0xf2, 0x74, 0x1c, 0x0,
      0x1a, 0x7f, 0x5d, 0xc5, 0xd9, 0x9e, 0x29, 0x1e, 0x43, 0x35, 0x30, 0x9a, 0xff, 0xd6, 0x45, 0x5d, 0x15, 0xbe, 0x8,
      0xbb, 0x66, 0xd9, 0x5f, 0xed, 0x6,  0x98, 0x2a, 0x29, 0x4e, 0x23, 0x4f, 0x12, 0x1f, 0x0,  0x10, 0x24, 0x99, 0x4b,
      0x29, 0x6d, 0x71, 0x9,  0xad, 0x3e, 0xc2, 0xa8, 0x21, 0xb1, 0x3d, 0x1d, 0x18, 0x3,  0x0,  0x17, 0xb8, 0xd9, 0xb3,
      0x29, 0x37, 0xa8, 0x24, 0x7e, 0x4b, 0xb0, 0x27, 0xcd, 0x9f, 0x21, 0xf7, 0xe5, 0x6,  0xa7, 0x46, 0x1b, 0xdf, 0x73,
      0xa0, 0x1,  0xc7, 0x1c, 0x0,  0x1,  0xa4, 0x9,  0x0,  0x13, 0x2b, 0xe5, 0x77, 0x5e, 0xeb, 0xd,  0xac, 0xf5, 0x71,
      0xca, 0xca, 0xdb, 0x62, 0x97, 0x9b, 0x4d, 0xb0, 0x3f, 0xe0, 0x0,  0x1a, 0x5e, 0xe2, 0xfb, 0xb5, 0x32, 0x9c, 0x7c,
      0x74, 0x97, 0x53, 0xa9, 0xfc, 0x92, 0x3,  0x1d, 0xac, 0x53, 0xa9, 0x4,  0x8e, 0xc9, 0xad, 0xa4, 0x3d, 0xaa, 0x61,
      0x1,  0x0,  0xf,  0xe1, 0x57, 0x33, 0x6b, 0x21, 0x97, 0xf5, 0xe4, 0x3e, 0xcd, 0xc6, 0x84, 0xa8, 0x2c, 0x8e, 0x0,
      0x0,  0x11, 0x1c, 0xf5, 0x91, 0x1e, 0xa6, 0x2a, 0x1,  0xa3, 0xe8, 0xf6, 0x5b, 0xcc, 0x90, 0xc0, 0x4f, 0xb5, 0xa0,
      0x0,  0x0,  0x1e, 0xec, 0xd6, 0xce, 0xb5, 0x12, 0xa7, 0xb5, 0x6b, 0xff, 0x63, 0x96, 0x43, 0x26, 0x58, 0x60, 0x52,
      0xfa, 0x96, 0xf,  0xb8, 0x47, 0xf1, 0x78, 0x97, 0xc4, 0x8f, 0x52, 0x90, 0xd2, 0x77, 0x0};

  uint8_t buf[253] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x5e, 0xe2, 0xfb, 0xb5, 0x32, 0x9c, 0x7c, 0x74, 0x97, 0x53, 0xa9, 0xfc, 0x92,
                                     0x3,  0x1d, 0xac, 0x53, 0xa9, 0x4,  0x8e, 0xc9, 0xad, 0xa4, 0x3d, 0xaa, 0x61};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe1, 0x57, 0x33, 0x6b, 0x21, 0x97, 0xf5, 0xe4,
                                     0x3e, 0xcd, 0xc6, 0x84, 0xa8, 0x2c, 0x8e};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1c, 0xf5, 0x91, 0x1e, 0xa6, 0x2a, 0x1,  0xa3, 0xe8,
                                     0xf6, 0x5b, 0xcc, 0x90, 0xc0, 0x4f, 0xb5, 0xa0};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xec, 0xd6, 0xce, 0xb5, 0x12, 0xa7, 0xb5, 0x6b, 0xff, 0x63,
                                     0x96, 0x43, 0x26, 0x58, 0x60, 0x52, 0xfa, 0x96, 0xf,  0xb8,
                                     0x47, 0xf1, 0x78, 0x97, 0xc4, 0x8f, 0x52, 0x90, 0xd2, 0x77};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0x5e, 0x2d, 0x75, 0x1c, 0x15, 0x6,  0x4f, 0xaa, 0x7a, 0xa9, 0xdb, 0xb6, 0x9a,
                           0xee, 0x12, 0x15, 0x42, 0x86, 0x9e, 0xb,  0x2f, 0x11, 0x32, 0x33, 0xf2, 0x74};
  uint8_t bytesprops1[] = {0x7f, 0x5d, 0xc5, 0xd9, 0x9e, 0x29, 0x1e, 0x43, 0x35, 0x30, 0x9a, 0xff, 0xd6,
                           0x45, 0x5d, 0x15, 0xbe, 0x8,  0xbb, 0x66, 0xd9, 0x5f, 0xed, 0x6,  0x98, 0x2a};
  uint8_t bytesprops2[] = {0x24, 0x99, 0x4b, 0x29, 0x6d, 0x71, 0x9,  0xad,
                           0x3e, 0xc2, 0xa8, 0x21, 0xb1, 0x3d, 0x1d, 0x18};
  uint8_t bytesprops3[] = {0xb8, 0xd9, 0xb3, 0x29, 0x37, 0xa8, 0x24, 0x7e, 0x4b, 0xb0, 0x27, 0xcd,
                           0x9f, 0x21, 0xf7, 0xe5, 0x6,  0xa7, 0x46, 0x1b, 0xdf, 0x73, 0xa0};
  uint8_t bytesprops4[] = {0xa4};
  uint8_t bytesprops5[] = {0x2b, 0xe5, 0x77, 0x5e, 0xeb, 0xd,  0xac, 0xf5, 0x71, 0xca,
                           0xca, 0xdb, 0x62, 0x97, 0x9b, 0x4d, 0xb0, 0x3f, 0xe0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20242}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11149, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 2269 [("\DC2\238\205\167\203qt\199%Vl\129\160y\134\175U^\144K\SYN\ENQ\155+\GSdIr",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\208\157\230h\219\215$\215\133\STXrRf\214m\159\156\229\196\139\223EF>1\n'",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\195S:\237\&8\249\f\223\SOH\EOTZ?\209RD1\128I\133\205\137\135c",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\252\&2\240JZ\198a\161y\244\135\130Ki\174\129\150\137H\142\184\151\167",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("%m\230\152\&3B\177\207",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\SO\US\NUL\133[",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\SO|\177\228\ETB\214C\165`\152*\SOM\180y9\233\&3`",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\160\&8\129\v\DC4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\\z\220\157\147\201\254\SUB\195\158\139\t\158\140\173\133\r\233\175q\212\152\175B\181d\FS",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropAuthenticationData "\184\223\189Z\137\FS\218\128\216\&5\192\198Iw\207y4\232",PropRequestProblemInformation
// 197,PropMessageExpiryInterval 11093,PropRequestResponseInformation 99,PropTopicAliasMaximum 22661,PropUserProperty
// "K1\STX6Q\132\129}\t>G\233\&3KkU[\v\STXS"
// "\143g\145_\170\203\159\142\197\140\144{\ETB\STX\ETX<\"))\251G\GS\132\158K",PropMessageExpiryInterval
// 11179,PropResponseTopic "\NULk&8:\238H\174",PropMessageExpiryInterval 3353,PropReceiveMaximum
// 4866,PropWildcardSubscriptionAvailable 41,PropAssignedClientIdentifier
// "\194\201\&1\222\247\SYN\191T$@\155C\DEL\255\b\202g\194\240\148\167\&2",PropRetainAvailable
// 136,PropAssignedClientIdentifier "^\229\129!\196\185",PropRetainAvailable 99,PropWillDelayInterval
// 14562,PropSubscriptionIdentifierAvailable 215]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x82, 0xe1, 0x2,  0x8,  0xdd, 0x9a, 0x1,  0x16, 0x0,  0x12, 0xb8, 0xdf, 0xbd, 0x5a, 0x89, 0x1c, 0xda, 0x80, 0xd8,
      0x35, 0xc0, 0xc6, 0x49, 0x77, 0xcf, 0x79, 0x34, 0xe8, 0x17, 0xc5, 0x2,  0x0,  0x0,  0x2b, 0x55, 0x19, 0x63, 0x22,
      0x58, 0x85, 0x26, 0x0,  0x14, 0x4b, 0x31, 0x2,  0x36, 0x51, 0x84, 0x81, 0x7d, 0x9,  0x3e, 0x47, 0xe9, 0x33, 0x4b,
      0x6b, 0x55, 0x5b, 0xb,  0x2,  0x53, 0x0,  0x19, 0x8f, 0x67, 0x91, 0x5f, 0xaa, 0xcb, 0x9f, 0x8e, 0xc5, 0x8c, 0x90,
      0x7b, 0x17, 0x2,  0x3,  0x3c, 0x22, 0x29, 0x29, 0xfb, 0x47, 0x1d, 0x84, 0x9e, 0x4b, 0x2,  0x0,  0x0,  0x2b, 0xab,
      0x8,  0x0,  0x8,  0x0,  0x6b, 0x26, 0x38, 0x3a, 0xee, 0x48, 0xae, 0x2,  0x0,  0x0,  0xd,  0x19, 0x21, 0x13, 0x2,
      0x28, 0x29, 0x12, 0x0,  0x16, 0xc2, 0xc9, 0x31, 0xde, 0xf7, 0x16, 0xbf, 0x54, 0x24, 0x40, 0x9b, 0x43, 0x7f, 0xff,
      0x8,  0xca, 0x67, 0xc2, 0xf0, 0x94, 0xa7, 0x32, 0x25, 0x88, 0x12, 0x0,  0x6,  0x5e, 0xe5, 0x81, 0x21, 0xc4, 0xb9,
      0x25, 0x63, 0x18, 0x0,  0x0,  0x38, 0xe2, 0x29, 0xd7, 0x0,  0x1c, 0x12, 0xee, 0xcd, 0xa7, 0xcb, 0x71, 0x74, 0xc7,
      0x25, 0x56, 0x6c, 0x81, 0xa0, 0x79, 0x86, 0xaf, 0x55, 0x5e, 0x90, 0x4b, 0x16, 0x5,  0x9b, 0x2b, 0x1d, 0x64, 0x49,
      0x72, 0x2,  0x0,  0x1b, 0xd0, 0x9d, 0xe6, 0x68, 0xdb, 0xd7, 0x24, 0xd7, 0x85, 0x2,  0x72, 0x52, 0x66, 0xd6, 0x6d,
      0x9f, 0x9c, 0xe5, 0xc4, 0x8b, 0xdf, 0x45, 0x46, 0x3e, 0x31, 0xa,  0x27, 0x0,  0x0,  0x17, 0xc3, 0x53, 0x3a, 0xed,
      0x38, 0xf9, 0xc,  0xdf, 0x1,  0x4,  0x5a, 0x3f, 0xd1, 0x52, 0x44, 0x31, 0x80, 0x49, 0x85, 0xcd, 0x89, 0x87, 0x63,
      0x1,  0x0,  0x17, 0xfc, 0x32, 0xf0, 0x4a, 0x5a, 0xc6, 0x61, 0xa1, 0x79, 0xf4, 0x87, 0x82, 0x4b, 0x69, 0xae, 0x81,
      0x96, 0x89, 0x48, 0x8e, 0xb8, 0x97, 0xa7, 0x0,  0x0,  0x8,  0x25, 0x6d, 0xe6, 0x98, 0x33, 0x42, 0xb1, 0xcf, 0x0,
      0x0,  0x5,  0xe,  0x1f, 0x0,  0x85, 0x5b, 0x0,  0x0,  0x0,  0x0,  0x0,  0x13, 0xe,  0x7c, 0xb1, 0xe4, 0x17, 0xd6,
      0x43, 0xa5, 0x60, 0x98, 0x2a, 0xe,  0x4d, 0xb4, 0x79, 0x39, 0xe9, 0x33, 0x60, 0x2,  0x0,  0x5,  0xa0, 0x38, 0x81,
      0xb,  0x14, 0x2,  0x0,  0x1b, 0x5c, 0x7a, 0xdc, 0x9d, 0x93, 0xc9, 0xfe, 0x1a, 0xc3, 0x9e, 0x8b, 0x9,  0x9e, 0x8c,
      0xad, 0x85, 0xd,  0xe9, 0xaf, 0x71, 0xd4, 0x98, 0xaf, 0x42, 0xb5, 0x64, 0x1c, 0x0};

  uint8_t buf[366] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x12, 0xee, 0xcd, 0xa7, 0xcb, 0x71, 0x74, 0xc7, 0x25, 0x56,
                                     0x6c, 0x81, 0xa0, 0x79, 0x86, 0xaf, 0x55, 0x5e, 0x90, 0x4b,
                                     0x16, 0x5,  0x9b, 0x2b, 0x1d, 0x64, 0x49, 0x72};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd0, 0x9d, 0xe6, 0x68, 0xdb, 0xd7, 0x24, 0xd7, 0x85, 0x2,  0x72, 0x52, 0x66, 0xd6,
                                     0x6d, 0x9f, 0x9c, 0xe5, 0xc4, 0x8b, 0xdf, 0x45, 0x46, 0x3e, 0x31, 0xa,  0x27};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc3, 0x53, 0x3a, 0xed, 0x38, 0xf9, 0xc,  0xdf, 0x1,  0x4,  0x5a, 0x3f,
                                     0xd1, 0x52, 0x44, 0x31, 0x80, 0x49, 0x85, 0xcd, 0x89, 0x87, 0x63};
  lwmqtt_string_t topic_filter_s2 = {23, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xfc, 0x32, 0xf0, 0x4a, 0x5a, 0xc6, 0x61, 0xa1, 0x79, 0xf4, 0x87, 0x82,
                                     0x4b, 0x69, 0xae, 0x81, 0x96, 0x89, 0x48, 0x8e, 0xb8, 0x97, 0xa7};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x25, 0x6d, 0xe6, 0x98, 0x33, 0x42, 0xb1, 0xcf};
  lwmqtt_string_t topic_filter_s4 = {8, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xe, 0x1f, 0x0, 0x85, 0x5b};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0};
  lwmqtt_string_t topic_filter_s6 = {0, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe,  0x7c, 0xb1, 0xe4, 0x17, 0xd6, 0x43, 0xa5, 0x60, 0x98,
                                     0x2a, 0xe,  0x4d, 0xb4, 0x79, 0x39, 0xe9, 0x33, 0x60};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa0, 0x38, 0x81, 0xb, 0x14};
  lwmqtt_string_t topic_filter_s8 = {5, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5c, 0x7a, 0xdc, 0x9d, 0x93, 0xc9, 0xfe, 0x1a, 0xc3, 0x9e, 0x8b, 0x9,  0x9e, 0x8c,
                                     0xad, 0x85, 0xd,  0xe9, 0xaf, 0x71, 0xd4, 0x98, 0xaf, 0x42, 0xb5, 0x64, 0x1c};
  lwmqtt_string_t topic_filter_s9 = {27, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS0,
                               LWMQTT_QOS0, LWMQTT_QOS0, LWMQTT_QOS2, LWMQTT_QOS2, LWMQTT_QOS0};
  uint8_t bytesprops0[] = {0xb8, 0xdf, 0xbd, 0x5a, 0x89, 0x1c, 0xda, 0x80, 0xd8,
                           0x35, 0xc0, 0xc6, 0x49, 0x77, 0xcf, 0x79, 0x34, 0xe8};
  uint8_t bytesprops2[] = {0x8f, 0x67, 0x91, 0x5f, 0xaa, 0xcb, 0x9f, 0x8e, 0xc5, 0x8c, 0x90, 0x7b, 0x17,
                           0x2,  0x3,  0x3c, 0x22, 0x29, 0x29, 0xfb, 0x47, 0x1d, 0x84, 0x9e, 0x4b};
  uint8_t bytesprops1[] = {0x4b, 0x31, 0x2,  0x36, 0x51, 0x84, 0x81, 0x7d, 0x9, 0x3e,
                           0x47, 0xe9, 0x33, 0x4b, 0x6b, 0x55, 0x5b, 0xb,  0x2, 0x53};
  uint8_t bytesprops3[] = {0x0, 0x6b, 0x26, 0x38, 0x3a, 0xee, 0x48, 0xae};
  uint8_t bytesprops4[] = {0xc2, 0xc9, 0x31, 0xde, 0xf7, 0x16, 0xbf, 0x54, 0x24, 0x40, 0x9b,
                           0x43, 0x7f, 0xff, 0x8,  0xca, 0x67, 0xc2, 0xf0, 0x94, 0xa7, 0x32};
  uint8_t bytesprops5[] = {0x5e, 0xe5, 0x81, 0x21, 0xc4, 0xb9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11093}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22661}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {25, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11179}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3353}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 4866}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14562}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 2269, 10, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9248 [("\233\154\252\129\230\&9\142\177.,%\202H\EM",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("s\ETB\220\154j\DC1\149e\235\252\163\CANis@",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\SOHz\161\174&\ESC;\181-\130",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\204l}DdML\130\250\STX",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS2})] [PropSubscriptionIdentifierAvailable 250,PropSessionExpiryInterval
// 30222,PropAssignedClientIdentifier "\143\US",PropPayloadFormatIndicator 66,PropUserProperty
// "\128\&8W!S;\202E\206]\220\147\228\227\178\233\252i\140:+\207\148\&1\242>\192\243\160"
// "\202\181\197",PropCorrelationData
// "\150\219\ETX\v\147\STX\205\228*\217\175\203S\170\196P\223\202\204\180f",PropPayloadFormatIndicator 80]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x8d, 0x1,  0x24, 0x20, 0x4d, 0x29, 0xfa, 0x11, 0x0,  0x0,  0x76, 0xe,  0x12, 0x0,  0x2,
                   0x8f, 0x1f, 0x1,  0x42, 0x26, 0x0,  0x1d, 0x80, 0x38, 0x57, 0x21, 0x53, 0x3b, 0xca, 0x45, 0xce,
                   0x5d, 0xdc, 0x93, 0xe4, 0xe3, 0xb2, 0xe9, 0xfc, 0x69, 0x8c, 0x3a, 0x2b, 0xcf, 0x94, 0x31, 0xf2,
                   0x3e, 0xc0, 0xf3, 0xa0, 0x0,  0x3,  0xca, 0xb5, 0xc5, 0x9,  0x0,  0x15, 0x96, 0xdb, 0x3,  0xb,
                   0x93, 0x2,  0xcd, 0xe4, 0x2a, 0xd9, 0xaf, 0xcb, 0x53, 0xaa, 0xc4, 0x50, 0xdf, 0xca, 0xcc, 0xb4,
                   0x66, 0x1,  0x50, 0x0,  0xe,  0xe9, 0x9a, 0xfc, 0x81, 0xe6, 0x39, 0x8e, 0xb1, 0x2e, 0x2c, 0x25,
                   0xca, 0x48, 0x19, 0x2,  0x0,  0xf,  0x73, 0x17, 0xdc, 0x9a, 0x6a, 0x11, 0x95, 0x65, 0xeb, 0xfc,
                   0xa3, 0x18, 0x69, 0x73, 0x40, 0x0,  0x0,  0xa,  0x1,  0x7a, 0xa1, 0xae, 0x26, 0x1b, 0x3b, 0xb5,
                   0x2d, 0x82, 0x1,  0x0,  0xa,  0xcc, 0x6c, 0x7d, 0x44, 0x64, 0x4d, 0x4c, 0x82, 0xfa, 0x2,  0x2};

  uint8_t buf[154] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xe9, 0x9a, 0xfc, 0x81, 0xe6, 0x39, 0x8e,
                                     0xb1, 0x2e, 0x2c, 0x25, 0xca, 0x48, 0x19};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x73, 0x17, 0xdc, 0x9a, 0x6a, 0x11, 0x95, 0x65,
                                     0xeb, 0xfc, 0xa3, 0x18, 0x69, 0x73, 0x40};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1, 0x7a, 0xa1, 0xae, 0x26, 0x1b, 0x3b, 0xb5, 0x2d, 0x82};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xcc, 0x6c, 0x7d, 0x44, 0x64, 0x4d, 0x4c, 0x82, 0xfa, 0x2};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x8f, 0x1f};
  uint8_t bytesprops2[] = {0xca, 0xb5, 0xc5};
  uint8_t bytesprops1[] = {0x80, 0x38, 0x57, 0x21, 0x53, 0x3b, 0xca, 0x45, 0xce, 0x5d, 0xdc, 0x93, 0xe4, 0xe3, 0xb2,
                           0xe9, 0xfc, 0x69, 0x8c, 0x3a, 0x2b, 0xcf, 0x94, 0x31, 0xf2, 0x3e, 0xc0, 0xf3, 0xa0};
  uint8_t bytesprops3[] = {0x96, 0xdb, 0x3,  0xb,  0x93, 0x2,  0xcd, 0xe4, 0x2a, 0xd9, 0xaf,
                           0xcb, 0x53, 0xaa, 0xc4, 0x50, 0xdf, 0xca, 0xcc, 0xb4, 0x66};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30222}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops1}, .v = {3, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 80}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9248, 4, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22320 [("U\\Dd9",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS =
// QoS2}),("w\225r\ETB\229\148t\144\141\ETB\DC3\141\216\DEL\SYN7r^\157\169\201\222\240{\CAN\162",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\144%\189P}R&]F\140hw\FS\134Pm\201\240\130#\185",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("6\155R=&\211a\DC3v\192\rP~\175",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\228\161\STXal\230\192\ETB\213\134\a\178a4",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\223\209\242\169\SO\193\&9\248\172\170\181\153\222E!\208\167mA\140\206\170\\\189-A\155",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropServerKeepAlive 312,PropAuthenticationMethod
// "T\235\205N\209*\217\253V\240W\162a;\134\180\147\n\153\228\226\DC1\171\201\fes\240\133",PropReasonString
// "C\SI\194\223i/\"\DC3hz+G\USq\147\&7\147\154\212\bf\206BBr@B",PropTopicAliasMaximum 14013,PropRetainAvailable
// 158,PropMaximumQoS 145,PropMaximumPacketSize 32295,PropResponseInformation
// "\187\182\174\136\132D\207\152\CAN\STX\193;\tGP\198\SOHi\205\181\232^\240\226D\137e\164",PropWildcardSubscriptionAvailable
// 44]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0xee, 0x1,  0x57, 0x30, 0x6e, 0x13, 0x1,  0x38, 0x15, 0x0,  0x1d, 0x54, 0xeb, 0xcd, 0x4e, 0xd1, 0x2a, 0xd9,
      0xfd, 0x56, 0xf0, 0x57, 0xa2, 0x61, 0x3b, 0x86, 0xb4, 0x93, 0xa,  0x99, 0xe4, 0xe2, 0x11, 0xab, 0xc9, 0xc,  0x65,
      0x73, 0xf0, 0x85, 0x1f, 0x0,  0x1b, 0x43, 0xf,  0xc2, 0xdf, 0x69, 0x2f, 0x22, 0x13, 0x68, 0x7a, 0x2b, 0x47, 0x1f,
      0x71, 0x93, 0x37, 0x93, 0x9a, 0xd4, 0x8,  0x66, 0xce, 0x42, 0x42, 0x72, 0x40, 0x42, 0x22, 0x36, 0xbd, 0x25, 0x9e,
      0x24, 0x91, 0x27, 0x0,  0x0,  0x7e, 0x27, 0x1a, 0x0,  0x1c, 0xbb, 0xb6, 0xae, 0x88, 0x84, 0x44, 0xcf, 0x98, 0x18,
      0x2,  0xc1, 0x3b, 0x9,  0x47, 0x50, 0xc6, 0x1,  0x69, 0xcd, 0xb5, 0xe8, 0x5e, 0xf0, 0xe2, 0x44, 0x89, 0x65, 0xa4,
      0x28, 0x2c, 0x0,  0x5,  0x55, 0x5c, 0x44, 0x64, 0x39, 0x2,  0x0,  0x1a, 0x77, 0xe1, 0x72, 0x17, 0xe5, 0x94, 0x74,
      0x90, 0x8d, 0x17, 0x13, 0x8d, 0xd8, 0x7f, 0x16, 0x37, 0x72, 0x5e, 0x9d, 0xa9, 0xc9, 0xde, 0xf0, 0x7b, 0x18, 0xa2,
      0x1,  0x0,  0x15, 0x90, 0x25, 0xbd, 0x50, 0x7d, 0x52, 0x26, 0x5d, 0x46, 0x8c, 0x68, 0x77, 0x1c, 0x86, 0x50, 0x6d,
      0xc9, 0xf0, 0x82, 0x23, 0xb9, 0x1,  0x0,  0xe,  0x36, 0x9b, 0x52, 0x3d, 0x26, 0xd3, 0x61, 0x13, 0x76, 0xc0, 0xd,
      0x50, 0x7e, 0xaf, 0x0,  0x0,  0xe,  0xe4, 0xa1, 0x2,  0x61, 0x6c, 0xe6, 0xc0, 0x17, 0xd5, 0x86, 0x7,  0xb2, 0x61,
      0x34, 0x1,  0x0,  0x1b, 0xdf, 0xd1, 0xf2, 0xa9, 0xe,  0xc1, 0x39, 0xf8, 0xac, 0xaa, 0xb5, 0x99, 0xde, 0x45, 0x21,
      0xd0, 0xa7, 0x6d, 0x41, 0x8c, 0xce, 0xaa, 0x5c, 0xbd, 0x2d, 0x41, 0x9b, 0x2};

  uint8_t buf[251] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x55, 0x5c, 0x44, 0x64, 0x39};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x77, 0xe1, 0x72, 0x17, 0xe5, 0x94, 0x74, 0x90, 0x8d, 0x17, 0x13, 0x8d, 0xd8,
                                     0x7f, 0x16, 0x37, 0x72, 0x5e, 0x9d, 0xa9, 0xc9, 0xde, 0xf0, 0x7b, 0x18, 0xa2};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x90, 0x25, 0xbd, 0x50, 0x7d, 0x52, 0x26, 0x5d, 0x46, 0x8c, 0x68,
                                     0x77, 0x1c, 0x86, 0x50, 0x6d, 0xc9, 0xf0, 0x82, 0x23, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x36, 0x9b, 0x52, 0x3d, 0x26, 0xd3, 0x61, 0x13, 0x76, 0xc0, 0xd, 0x50, 0x7e, 0xaf};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xe4, 0xa1, 0x2, 0x61, 0x6c, 0xe6, 0xc0, 0x17, 0xd5, 0x86, 0x7, 0xb2, 0x61, 0x34};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xdf, 0xd1, 0xf2, 0xa9, 0xe,  0xc1, 0x39, 0xf8, 0xac, 0xaa, 0xb5, 0x99, 0xde, 0x45,
                                     0x21, 0xd0, 0xa7, 0x6d, 0x41, 0x8c, 0xce, 0xaa, 0x5c, 0xbd, 0x2d, 0x41, 0x9b};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_qos_t qos_levels[] = {LWMQTT_QOS2, LWMQTT_QOS1, LWMQTT_QOS1, LWMQTT_QOS0, LWMQTT_QOS1, LWMQTT_QOS2};
  uint8_t bytesprops0[] = {0x54, 0xeb, 0xcd, 0x4e, 0xd1, 0x2a, 0xd9, 0xfd, 0x56, 0xf0, 0x57, 0xa2, 0x61, 0x3b, 0x86,
                           0xb4, 0x93, 0xa,  0x99, 0xe4, 0xe2, 0x11, 0xab, 0xc9, 0xc,  0x65, 0x73, 0xf0, 0x85};
  uint8_t bytesprops1[] = {0x43, 0xf,  0xc2, 0xdf, 0x69, 0x2f, 0x22, 0x13, 0x68, 0x7a, 0x2b, 0x47, 0x1f, 0x71,
                           0x93, 0x37, 0x93, 0x9a, 0xd4, 0x8,  0x66, 0xce, 0x42, 0x42, 0x72, 0x40, 0x42};
  uint8_t bytesprops2[] = {0xbb, 0xb6, 0xae, 0x88, 0x84, 0x44, 0xcf, 0x98, 0x18, 0x2,  0xc1, 0x3b, 0x9,  0x47,
                           0x50, 0xc6, 0x1,  0x69, 0xcd, 0xb5, 0xe8, 0x5e, 0xf0, 0xe2, 0x44, 0x89, 0x65, 0xa4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 312}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14013}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32295}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 44}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22320, 6, topic_filters, qos_levels, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
