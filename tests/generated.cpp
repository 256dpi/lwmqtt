#include <gtest/gtest.h>

extern "C" {
#include <lwmqtt.h>
#include "../src/packet.h"
}

#ifdef __GNUC__
#pragma GCC diagnostic push
#ifdef __clang__
#pragma GCC diagnostic ignored "-Wc99-extensions"
#else
#pragma GCC diagnostic ignored "-Wpedantic"
#endif
#endif

#define EXPECT_ARRAY_EQ(reference, actual, element_count)                 \
  {                                                                       \
    for (size_t cmp_i = 0; cmp_i < element_count; cmp_i++) {              \
      EXPECT_EQ(reference[cmp_i], actual[cmp_i]) << "At byte: " << cmp_i; \
    }                                                                     \
  }

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\137\189\213\133\214H\EM\161\170\241\136", _pubPktID = 0, _pubBody = "\217\146\229\195\163\175\196\174y0d\141b\146",
// _pubProps = []}
TEST(Publish311QCTest, Encode1) {
  uint8_t pkt[] = {0x31, 0x1b, 0x0,  0xb,  0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88,
                   0xd9, 0x92, 0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  uint8_t topic_bytes[] = {0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd9, 0x92, 0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\137\189\213\133\214H\EM\161\170\241\136", _pubPktID = 0, _pubBody = "\217\146\229\195\163\175\196\174y0d\141b\146",
// _pubProps = []}
TEST(Publish311QCTest, Decode1) {
  uint8_t pkt[] = {0x31, 0x1b, 0x0,  0xb,  0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88,
                   0xd9, 0x92, 0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd9, 0x92, 0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\183\249", _pubPktID = 0, _pubBody
// = "M\EOTga\US?`w\167\&6\152\SI\NAKC\168>\173<\149\213m,5\235\133\r\180\190\195", _pubProps = []}
TEST(Publish311QCTest, Encode2) {
  uint8_t pkt[] = {0x30, 0x21, 0x0,  0x2,  0xb7, 0xf9, 0x4d, 0x4,  0x67, 0x61, 0x1f, 0x3f,
                   0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8, 0x3e, 0xad, 0x3c,
                   0x95, 0xd5, 0x6d, 0x2c, 0x35, 0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  uint8_t topic_bytes[] = {0xb7, 0xf9};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4d, 0x4,  0x67, 0x61, 0x1f, 0x3f, 0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8,
                         0x3e, 0xad, 0x3c, 0x95, 0xd5, 0x6d, 0x2c, 0x35, 0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\183\249", _pubPktID = 0, _pubBody
// = "M\EOTga\US?`w\167\&6\152\SI\NAKC\168>\173<\149\213m,5\235\133\r\180\190\195", _pubProps = []}
TEST(Publish311QCTest, Decode2) {
  uint8_t pkt[] = {0x30, 0x21, 0x0,  0x2,  0xb7, 0xf9, 0x4d, 0x4,  0x67, 0x61, 0x1f, 0x3f,
                   0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8, 0x3e, 0xad, 0x3c,
                   0x95, 0xd5, 0x6d, 0x2c, 0x35, 0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb7, 0xf9};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4d, 0x4,  0x67, 0x61, 0x1f, 0x3f, 0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8,
                              0x3e, 0xad, 0x3c, 0x95, 0xd5, 0x6d, 0x2c, 0x35, 0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\DC1\157\ns\ETX0?\130,\153\&5(\EM\NAK\235tg/\223cz\215\188l", _pubPktID = 23951, _pubBody = "\252\STX\212\139",
// _pubProps = []}
TEST(Publish311QCTest, Encode3) {
  uint8_t pkt[] = {0x3a, 0x20, 0x0,  0x18, 0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82,
                   0x2c, 0x99, 0x35, 0x28, 0x19, 0x15, 0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63,
                   0x7a, 0xd7, 0xbc, 0x6c, 0x5d, 0x8f, 0xfc, 0x2,  0xd4, 0x8b};
  uint8_t topic_bytes[] = {0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82, 0x2c, 0x99, 0x35, 0x28,
                           0x19, 0x15, 0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63, 0x7a, 0xd7, 0xbc, 0x6c};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfc, 0x2, 0xd4, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 23951, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\DC1\157\ns\ETX0?\130,\153\&5(\EM\NAK\235tg/\223cz\215\188l", _pubPktID = 23951, _pubBody = "\252\STX\212\139",
// _pubProps = []}
TEST(Publish311QCTest, Decode3) {
  uint8_t pkt[] = {0x3a, 0x20, 0x0,  0x18, 0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82,
                   0x2c, 0x99, 0x35, 0x28, 0x19, 0x15, 0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63,
                   0x7a, 0xd7, 0xbc, 0x6c, 0x5d, 0x8f, 0xfc, 0x2,  0xd4, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82, 0x2c, 0x99, 0x35, 0x28,
                               0x19, 0x15, 0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63, 0x7a, 0xd7, 0xbc, 0x6c};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfc, 0x2, 0xd4, 0x8b};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 23951);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "2]\237\233\224\238", _pubPktID =
// 32430, _pubBody = "\\7\a}d\f\191)\250N\n\r\240\169\178\184]", _pubProps = []}
TEST(Publish311QCTest, Encode4) {
  uint8_t pkt[] = {0x35, 0x1b, 0x0, 0x6,  0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee, 0x7e, 0xae, 0x5c, 0x37, 0x7,
                   0x7d, 0x64, 0xc, 0xbf, 0x29, 0xfa, 0x4e, 0xa,  0xd,  0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  uint8_t topic_bytes[] = {0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5c, 0x37, 0x7, 0x7d, 0x64, 0xc,  0xbf, 0x29, 0xfa,
                         0x4e, 0xa,  0xd, 0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 32430, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "2]\237\233\224\238", _pubPktID =
// 32430, _pubBody = "\\7\a}d\f\191)\250N\n\r\240\169\178\184]", _pubProps = []}
TEST(Publish311QCTest, Decode4) {
  uint8_t pkt[] = {0x35, 0x1b, 0x0, 0x6,  0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee, 0x7e, 0xae, 0x5c, 0x37, 0x7,
                   0x7d, 0x64, 0xc, 0xbf, 0x29, 0xfa, 0x4e, 0xa,  0xd,  0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5c, 0x37, 0x7, 0x7d, 0x64, 0xc,  0xbf, 0x29, 0xfa,
                              0x4e, 0xa,  0xd, 0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 32430);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "V\156\142\176", _pubPktID = 29213,
// _pubBody = "\EM\FSK\190t\254o\168\200\&9\131(\254Z\138g\243jL|\137\220", _pubProps = []}
TEST(Publish311QCTest, Encode5) {
  uint8_t pkt[] = {0x35, 0x1e, 0x0,  0x4,  0x56, 0x9c, 0x8e, 0xb0, 0x72, 0x1d, 0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe,
                   0x6f, 0xa8, 0xc8, 0x39, 0x83, 0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  uint8_t topic_bytes[] = {0x56, 0x9c, 0x8e, 0xb0};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe, 0x6f, 0xa8, 0xc8, 0x39, 0x83,
                         0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 29213, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "V\156\142\176", _pubPktID = 29213,
// _pubBody = "\EM\FSK\190t\254o\168\200\&9\131(\254Z\138g\243jL|\137\220", _pubProps = []}
TEST(Publish311QCTest, Decode5) {
  uint8_t pkt[] = {0x35, 0x1e, 0x0,  0x4,  0x56, 0x9c, 0x8e, 0xb0, 0x72, 0x1d, 0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe,
                   0x6f, 0xa8, 0xc8, 0x39, 0x83, 0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0x9c, 0x8e, 0xb0};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe, 0x6f, 0xa8, 0xc8, 0x39, 0x83,
                              0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29213);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "j-w\135im\135", _pubPktID = 15185,
// _pubBody = "\178\183W\163D\179", _pubProps = []}
TEST(Publish311QCTest, Encode6) {
  uint8_t pkt[] = {0x35, 0x11, 0x0,  0x7,  0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d,
                   0x87, 0x3b, 0x51, 0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  uint8_t topic_bytes[] = {0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d, 0x87};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 15185, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "j-w\135im\135", _pubPktID = 15185,
// _pubBody = "\178\183W\163D\179", _pubProps = []}
TEST(Publish311QCTest, Decode6) {
  uint8_t pkt[] = {0x35, 0x11, 0x0,  0x7,  0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d,
                   0x87, 0x3b, 0x51, 0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d, 0x87};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 15185);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\129\166\ACK\241", _pubPktID = 26446,
// _pubBody = "h'uL\n\225\221gp\182{\140\DC4\136\151c\170\191\r|\214\197\&7", _pubProps = []}
TEST(Publish311QCTest, Encode7) {
  uint8_t pkt[] = {0x3d, 0x1f, 0x0,  0x4,  0x81, 0xa6, 0x6,  0xf1, 0x67, 0x4e, 0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd,
                   0x67, 0x70, 0xb6, 0x7b, 0x8c, 0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  uint8_t topic_bytes[] = {0x81, 0xa6, 0x6, 0xf1};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd, 0x67, 0x70, 0xb6, 0x7b, 0x8c,
                         0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 26446, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\129\166\ACK\241", _pubPktID = 26446,
// _pubBody = "h'uL\n\225\221gp\182{\140\DC4\136\151c\170\191\r|\214\197\&7", _pubProps = []}
TEST(Publish311QCTest, Decode7) {
  uint8_t pkt[] = {0x3d, 0x1f, 0x0,  0x4,  0x81, 0xa6, 0x6,  0xf1, 0x67, 0x4e, 0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd,
                   0x67, 0x70, 0xb6, 0x7b, 0x8c, 0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x81, 0xa6, 0x6, 0xf1};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd, 0x67, 0x70, 0xb6, 0x7b, 0x8c,
                              0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 26446);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}\250\132\234S\200EV\164\175\218\237D", _pubPktID = 25658, _pubBody =
// "\DLE\DC3\242\235C\134\216h\196\ETB\255\169\164\222", _pubProps = []}
TEST(Publish311QCTest, Encode8) {
  uint8_t pkt[] = {0x3d, 0x1f, 0x0,  0xd,  0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed, 0x44,
                   0x64, 0x3a, 0x10, 0x13, 0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  uint8_t topic_bytes[] = {0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed, 0x44};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x10, 0x13, 0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 25658, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}\250\132\234S\200EV\164\175\218\237D", _pubPktID = 25658, _pubBody =
// "\DLE\DC3\242\235C\134\216h\196\ETB\255\169\164\222", _pubProps = []}
TEST(Publish311QCTest, Decode8) {
  uint8_t pkt[] = {0x3d, 0x1f, 0x0,  0xd,  0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed, 0x44,
                   0x64, 0x3a, 0x10, 0x13, 0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed, 0x44};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x10, 0x13, 0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25658);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB\EM\FSn\\^\219_\249\191\CAN\146\196\142\252x\187\173 \r\244[B\136h\210\180", _pubPktID = 12697, _pubBody =
// "\208\EOT\241", _pubProps = []}
TEST(Publish311QCTest, Encode9) {
  uint8_t pkt[] = {0x3c, 0x22, 0x0,  0x1b, 0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f,
                   0xf9, 0xbf, 0x18, 0x92, 0xc4, 0x8e, 0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,
                   0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4, 0x31, 0x99, 0xd0, 0x4,  0xf1};
  uint8_t topic_bytes[] = {0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f, 0xf9, 0xbf, 0x18, 0x92, 0xc4, 0x8e,
                           0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,  0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd0, 0x4, 0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 12697, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB\EM\FSn\\^\219_\249\191\CAN\146\196\142\252x\187\173 \r\244[B\136h\210\180", _pubPktID = 12697, _pubBody =
// "\208\EOT\241", _pubProps = []}
TEST(Publish311QCTest, Decode9) {
  uint8_t pkt[] = {0x3c, 0x22, 0x0,  0x1b, 0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f,
                   0xf9, 0xbf, 0x18, 0x92, 0xc4, 0x8e, 0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,
                   0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4, 0x31, 0x99, 0xd0, 0x4,  0xf1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f, 0xf9, 0xbf, 0x18, 0x92, 0xc4, 0x8e,
                               0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,  0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd0, 0x4, 0xf1};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 12697);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\207\219\241<a\196b\r", _pubPktID =
// 0, _pubBody = "\248\255\209\128s\169\179\245\203.\FS(\179o\ETXk\r'x\239\ETB=\189>q", _pubProps = []}
TEST(Publish311QCTest, Encode10) {
  uint8_t pkt[] = {0x39, 0x23, 0x0,  0x8,  0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd,  0xf8,
                   0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3, 0x6f,
                   0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  uint8_t topic_bytes[] = {0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf8, 0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3,
                         0x6f, 0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\207\219\241<a\196b\r", _pubPktID =
// 0, _pubBody = "\248\255\209\128s\169\179\245\203.\FS(\179o\ETXk\r'x\239\ETB=\189>q", _pubProps = []}
TEST(Publish311QCTest, Decode10) {
  uint8_t pkt[] = {0x39, 0x23, 0x0,  0x8,  0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd,  0xf8,
                   0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3, 0x6f,
                   0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf8, 0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3,
                              0x6f, 0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\230\US\223|\136nz\184\f)s\246ht", _pubPktID = 0, _pubBody = "\209", _pubProps = []}
TEST(Publish311QCTest, Encode11) {
  uint8_t pkt[] = {0x39, 0x12, 0x0,  0xf, 0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88,
                   0x6e, 0x7a, 0xb8, 0xc, 0x29, 0x73, 0xf6, 0x68, 0x74, 0xd1};
  uint8_t topic_bytes[] = {0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88, 0x6e, 0x7a, 0xb8, 0xc, 0x29, 0x73, 0xf6, 0x68, 0x74};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\230\US\223|\136nz\184\f)s\246ht", _pubPktID = 0, _pubBody = "\209", _pubProps = []}
TEST(Publish311QCTest, Decode11) {
  uint8_t pkt[] = {0x39, 0x12, 0x0,  0xf, 0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88,
                   0x6e, 0x7a, 0xb8, 0xc, 0x29, 0x73, 0xf6, 0x68, 0x74, 0xd1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88, 0x6e, 0x7a, 0xb8, 0xc, 0x29, 0x73, 0xf6, 0x68, 0x74};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd1};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\185\207+s\131Y\252\238R\EOT\183\224\v\195'\154V\SUB\214", _pubPktID = 0, _pubBody =
// "n\190=U\SI\224\255\fT\157I\150?Z\SI\215\177\163\143\SUB", _pubProps = []}
TEST(Publish311QCTest, Encode12) {
  uint8_t pkt[] = {0x31, 0x29, 0x0,  0x13, 0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,  0xb7,
                   0xe0, 0xb,  0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6, 0x6e, 0xbe, 0x3d, 0x55, 0xf,  0xe0, 0xff,
                   0xc,  0x54, 0x9d, 0x49, 0x96, 0x3f, 0x5a, 0xf,  0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  uint8_t topic_bytes[] = {0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,
                           0xb7, 0xe0, 0xb,  0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6e, 0xbe, 0x3d, 0x55, 0xf, 0xe0, 0xff, 0xc,  0x54, 0x9d,
                         0x49, 0x96, 0x3f, 0x5a, 0xf, 0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\185\207+s\131Y\252\238R\EOT\183\224\v\195'\154V\SUB\214", _pubPktID = 0, _pubBody =
// "n\190=U\SI\224\255\fT\157I\150?Z\SI\215\177\163\143\SUB", _pubProps = []}
TEST(Publish311QCTest, Decode12) {
  uint8_t pkt[] = {0x31, 0x29, 0x0,  0x13, 0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,  0xb7,
                   0xe0, 0xb,  0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6, 0x6e, 0xbe, 0x3d, 0x55, 0xf,  0xe0, 0xff,
                   0xc,  0x54, 0x9d, 0x49, 0x96, 0x3f, 0x5a, 0xf,  0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,
                               0xb7, 0xe0, 0xb,  0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6};
  lwmqtt_string_t exp_topic = {19, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x6e, 0xbe, 0x3d, 0x55, 0xf, 0xe0, 0xff, 0xc,  0x54, 0x9d,
                              0x49, 0x96, 0x3f, 0x5a, 0xf, 0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 19);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "-\224\164\222\163\DLE\224\218\229\CAN!n\rZ\193Y\DC3r\129\219T\172\139\252\&2~", _pubPktID = 8532, _pubBody =
// "\145b$\DEL\237\176\245E\250\186\STX\US|\163\f\221\190&\238\vu\US", _pubProps = []}
TEST(Publish311QCTest, Encode13) {
  uint8_t pkt[] = {0x3d, 0x34, 0x0,  0x1a, 0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18,
                   0x21, 0x6e, 0xd,  0x5a, 0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc,
                   0x32, 0x7e, 0x21, 0x54, 0x91, 0x62, 0x24, 0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba,
                   0x2,  0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  uint8_t topic_bytes[] = {0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18, 0x21, 0x6e, 0xd,
                           0x5a, 0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc, 0x32, 0x7e};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x91, 0x62, 0x24, 0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba, 0x2,
                         0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 8532, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "-\224\164\222\163\DLE\224\218\229\CAN!n\rZ\193Y\DC3r\129\219T\172\139\252\&2~", _pubPktID = 8532, _pubBody =
// "\145b$\DEL\237\176\245E\250\186\STX\US|\163\f\221\190&\238\vu\US", _pubProps = []}
TEST(Publish311QCTest, Decode13) {
  uint8_t pkt[] = {0x3d, 0x34, 0x0,  0x1a, 0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18,
                   0x21, 0x6e, 0xd,  0x5a, 0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc,
                   0x32, 0x7e, 0x21, 0x54, 0x91, 0x62, 0x24, 0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba,
                   0x2,  0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18, 0x21, 0x6e, 0xd,
                               0x5a, 0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc, 0x32, 0x7e};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x91, 0x62, 0x24, 0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba, 0x2,
                              0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8532);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "8(\GS\144\187\237\&8\196sz",
// _pubPktID = 0, _pubBody = "0zBlyt\159", _pubProps = []}
TEST(Publish311QCTest, Encode14) {
  uint8_t pkt[] = {0x39, 0x13, 0x0,  0xa,  0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38,
                   0xc4, 0x73, 0x7a, 0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  uint8_t topic_bytes[] = {0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38, 0xc4, 0x73, 0x7a};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "8(\GS\144\187\237\&8\196sz",
// _pubPktID = 0, _pubBody = "0zBlyt\159", _pubProps = []}
TEST(Publish311QCTest, Decode14) {
  uint8_t pkt[] = {0x39, 0x13, 0x0,  0xa,  0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38,
                   0xc4, 0x73, 0x7a, 0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38, 0xc4, 0x73, 0x7a};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ")F\t\CAN\159&z\212\EOT\210y\239\190\EOT\131b\161\153I\235\162", _pubPktID = 2063, _pubBody =
// "\SUB\236\&0\ENQ\ACK1\246q@\SUB\224\&3{\175\RS\142k\"", _pubProps = []}
TEST(Publish311QCTest, Encode15) {
  uint8_t pkt[] = {0x34, 0x2b, 0x0,  0x15, 0x29, 0x46, 0x9,  0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79,
                   0xef, 0xbe, 0x4,  0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2, 0x8,  0xf,  0x1a, 0xec, 0x30,
                   0x5,  0x6,  0x31, 0xf6, 0x71, 0x40, 0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  uint8_t topic_bytes[] = {0x29, 0x46, 0x9, 0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79,
                           0xef, 0xbe, 0x4, 0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1a, 0xec, 0x30, 0x5,  0x6,  0x31, 0xf6, 0x71, 0x40,
                         0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 2063, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ")F\t\CAN\159&z\212\EOT\210y\239\190\EOT\131b\161\153I\235\162", _pubPktID = 2063, _pubBody =
// "\SUB\236\&0\ENQ\ACK1\246q@\SUB\224\&3{\175\RS\142k\"", _pubProps = []}
TEST(Publish311QCTest, Decode15) {
  uint8_t pkt[] = {0x34, 0x2b, 0x0,  0x15, 0x29, 0x46, 0x9,  0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79,
                   0xef, 0xbe, 0x4,  0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2, 0x8,  0xf,  0x1a, 0xec, 0x30,
                   0x5,  0x6,  0x31, 0xf6, 0x71, 0x40, 0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x29, 0x46, 0x9, 0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79,
                               0xef, 0xbe, 0x4, 0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1a, 0xec, 0x30, 0x5,  0x6,  0x31, 0xf6, 0x71, 0x40,
                              0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2063);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\\Z\DLE\\x\DC3\192\DLE", _pubPktID =
// 15081, _pubBody = "\213\141\182\137f\134\150z.K\232\224o\177\FS\156\198\158\CAN\ESC", _pubProps = []}
TEST(Publish311QCTest, Encode16) {
  uint8_t pkt[] = {0x35, 0x20, 0x0,  0x8,  0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10,
                   0x3a, 0xe9, 0xd5, 0x8d, 0xb6, 0x89, 0x66, 0x86, 0x96, 0x7a, 0x2e, 0x4b,
                   0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  uint8_t topic_bytes[] = {0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd5, 0x8d, 0xb6, 0x89, 0x66, 0x86, 0x96, 0x7a, 0x2e, 0x4b,
                         0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 15081, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\\Z\DLE\\x\DC3\192\DLE", _pubPktID =
// 15081, _pubBody = "\213\141\182\137f\134\150z.K\232\224o\177\FS\156\198\158\CAN\ESC", _pubProps = []}
TEST(Publish311QCTest, Decode16) {
  uint8_t pkt[] = {0x35, 0x20, 0x0,  0x8,  0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10,
                   0x3a, 0xe9, 0xd5, 0x8d, 0xb6, 0x89, 0x66, 0x86, 0x96, 0x7a, 0x2e, 0x4b,
                   0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd5, 0x8d, 0xb6, 0x89, 0x66, 0x86, 0x96, 0x7a, 0x2e, 0x4b,
                              0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 15081);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "~2\242\136\211*\DEL", _pubPktID =
// 30428, _pubBody = "\253ET\175\214\175\205\211w\196\ETX\f-\214\144\194", _pubProps = []}
TEST(Publish311QCTest, Encode17) {
  uint8_t pkt[] = {0x3b, 0x1b, 0x0,  0x7,  0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f, 0x76, 0xdc, 0xfd, 0x45,
                   0x54, 0xaf, 0xd6, 0xaf, 0xcd, 0xd3, 0x77, 0xc4, 0x3,  0xc,  0x2d, 0xd6, 0x90, 0xc2};
  uint8_t topic_bytes[] = {0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfd, 0x45, 0x54, 0xaf, 0xd6, 0xaf, 0xcd, 0xd3, 0x77, 0xc4, 0x3, 0xc, 0x2d, 0xd6, 0x90, 0xc2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 30428, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "~2\242\136\211*\DEL", _pubPktID =
// 30428, _pubBody = "\253ET\175\214\175\205\211w\196\ETX\f-\214\144\194", _pubProps = []}
TEST(Publish311QCTest, Decode17) {
  uint8_t pkt[] = {0x3b, 0x1b, 0x0,  0x7,  0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f, 0x76, 0xdc, 0xfd, 0x45,
                   0x54, 0xaf, 0xd6, 0xaf, 0xcd, 0xd3, 0x77, 0xc4, 0x3,  0xc,  0x2d, 0xd6, 0x90, 0xc2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfd, 0x45, 0x54, 0xaf, 0xd6, 0xaf, 0xcd, 0xd3,
                              0x77, 0xc4, 0x3,  0xc,  0x2d, 0xd6, 0x90, 0xc2};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 30428);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "dG\194+K1e\237n\253\EM\US\222\156\216K\173\158+\228\&9E\185\CAN\147`\203un\n", _pubPktID = 16078, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Encode18) {
  uint8_t pkt[] = {0x32, 0x22, 0x0,  0x1e, 0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed,
                   0x6e, 0xfd, 0x19, 0x1f, 0xde, 0x9c, 0xd8, 0x4b, 0xad, 0x9e, 0x2b, 0xe4,
                   0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa,  0x3e, 0xce};
  uint8_t topic_bytes[] = {0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed, 0x6e, 0xfd, 0x19, 0x1f, 0xde, 0x9c, 0xd8,
                           0x4b, 0xad, 0x9e, 0x2b, 0xe4, 0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 16078, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "dG\194+K1e\237n\253\EM\US\222\156\216K\173\158+\228\&9E\185\CAN\147`\203un\n", _pubPktID = 16078, _pubBody = "",
// _pubProps = []}
TEST(Publish311QCTest, Decode18) {
  uint8_t pkt[] = {0x32, 0x22, 0x0,  0x1e, 0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed,
                   0x6e, 0xfd, 0x19, 0x1f, 0xde, 0x9c, 0xd8, 0x4b, 0xad, 0x9e, 0x2b, 0xe4,
                   0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa,  0x3e, 0xce};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed, 0x6e, 0xfd, 0x19, 0x1f, 0xde, 0x9c, 0xd8,
                               0x4b, 0xad, 0x9e, 0x2b, 0xe4, 0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa};
  lwmqtt_string_t exp_topic = {30, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16078);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 30);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "?\DC1;Y\196\211\145n\198\234\233\176_,\224\194\182X\250J\NUL_\198\186\&5\173\224W", _pubPktID = 0, _pubBody =
// "\189?\ag\226\204+\195v\STX4\147\165\167h\131}n\149j\208", _pubProps = []}
TEST(Publish311QCTest, Encode19) {
  uint8_t pkt[] = {0x30, 0x33, 0x0,  0x1c, 0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea,
                   0xe9, 0xb0, 0x5f, 0x2c, 0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba,
                   0x35, 0xad, 0xe0, 0x57, 0xbd, 0x3f, 0x7,  0x67, 0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2,
                   0x34, 0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  uint8_t topic_bytes[] = {0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea, 0xe9, 0xb0, 0x5f, 0x2c,
                           0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba, 0x35, 0xad, 0xe0, 0x57};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbd, 0x3f, 0x7,  0x67, 0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2, 0x34,
                         0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "?\DC1;Y\196\211\145n\198\234\233\176_,\224\194\182X\250J\NUL_\198\186\&5\173\224W", _pubPktID = 0, _pubBody =
// "\189?\ag\226\204+\195v\STX4\147\165\167h\131}n\149j\208", _pubProps = []}
TEST(Publish311QCTest, Decode19) {
  uint8_t pkt[] = {0x30, 0x33, 0x0,  0x1c, 0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea,
                   0xe9, 0xb0, 0x5f, 0x2c, 0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba,
                   0x35, 0xad, 0xe0, 0x57, 0xbd, 0x3f, 0x7,  0x67, 0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2,
                   0x34, 0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea, 0xe9, 0xb0, 0x5f, 0x2c,
                               0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba, 0x35, 0xad, 0xe0, 0x57};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbd, 0x3f, 0x7,  0x67, 0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2, 0x34,
                              0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "D\SUBc\224\DC3\202\&3\187\&84T\240", _pubPktID = 22665, _pubBody =
// "EV\174.\183\&1Q\DC1\216V\203p>q=x\132\163(\239\143\135b\236\137\&6", _pubProps = []}
TEST(Publish311QCTest, Encode20) {
  uint8_t pkt[] = {0x32, 0x2a, 0x0,  0xc,  0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54,
                   0xf0, 0x58, 0x89, 0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70,
                   0x3e, 0x71, 0x3d, 0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  uint8_t topic_bytes[] = {0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54, 0xf0};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70, 0x3e,
                         0x71, 0x3d, 0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 22665, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "D\SUBc\224\DC3\202\&3\187\&84T\240", _pubPktID = 22665, _pubBody =
// "EV\174.\183\&1Q\DC1\216V\203p>q=x\132\163(\239\143\135b\236\137\&6", _pubProps = []}
TEST(Publish311QCTest, Decode20) {
  uint8_t pkt[] = {0x32, 0x2a, 0x0,  0xc,  0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54,
                   0xf0, 0x58, 0x89, 0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70,
                   0x3e, 0x71, 0x3d, 0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54, 0xf0};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70, 0x3e,
                              0x71, 0x3d, 0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 22665);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\230\f\162\233\EOT\DC3\171\130\175!\217\131n\254\197\128m$;\254w\217O\ETX0\241c\223", _pubPktID = 0, _pubBody =
// ";]t:N\225`\ETX\239\239R\FS\135\144", _pubProps = []}
TEST(Publish311QCTest, Encode21) {
  uint8_t pkt[] = {0x39, 0x2c, 0x0,  0x1c, 0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83,
                   0x6e, 0xfe, 0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf,
                   0x3b, 0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3,  0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  uint8_t topic_bytes[] = {0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83, 0x6e, 0xfe,
                           0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3b, 0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3, 0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\230\f\162\233\EOT\DC3\171\130\175!\217\131n\254\197\128m$;\254w\217O\ETX0\241c\223", _pubPktID = 0, _pubBody =
// ";]t:N\225`\ETX\239\239R\FS\135\144", _pubProps = []}
TEST(Publish311QCTest, Decode21) {
  uint8_t pkt[] = {0x39, 0x2c, 0x0,  0x1c, 0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83,
                   0x6e, 0xfe, 0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf,
                   0x3b, 0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3,  0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83, 0x6e, 0xfe,
                               0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3b, 0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3, 0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\DEL\ETX\153\229\248dS\153`\SOH\167\230\142f\DC1\233\135#<\250\245dX!\172\177\&9,\148", _pubPktID = 23552, _pubBody
// = "\165\207\195k*4\RS", _pubProps = []}
TEST(Publish311QCTest, Encode22) {
  uint8_t pkt[] = {0x3d, 0x28, 0x0,  0x1d, 0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,
                   0xa7, 0xe6, 0x8e, 0x66, 0x11, 0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21,
                   0xac, 0xb1, 0x39, 0x2c, 0x94, 0x5c, 0x0,  0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  uint8_t topic_bytes[] = {0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,  0xa7, 0xe6, 0x8e, 0x66, 0x11,
                           0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21, 0xac, 0xb1, 0x39, 0x2c, 0x94};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 23552, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\DEL\ETX\153\229\248dS\153`\SOH\167\230\142f\DC1\233\135#<\250\245dX!\172\177\&9,\148", _pubPktID = 23552, _pubBody
// = "\165\207\195k*4\RS", _pubProps = []}
TEST(Publish311QCTest, Decode22) {
  uint8_t pkt[] = {0x3d, 0x28, 0x0,  0x1d, 0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,
                   0xa7, 0xe6, 0x8e, 0x66, 0x11, 0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21,
                   0xac, 0xb1, 0x39, 0x2c, 0x94, 0x5c, 0x0,  0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,  0xa7, 0xe6, 0x8e, 0x66, 0x11,
                               0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21, 0xac, 0xb1, 0x39, 0x2c, 0x94};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 23552);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\163\132d\157\149", _pubPktID =
// 24502, _pubBody = "\224h\ACK", _pubProps = []}
TEST(Publish311QCTest, Encode23) {
  uint8_t pkt[] = {0x34, 0xc, 0x0, 0x5, 0xa3, 0x84, 0x64, 0x9d, 0x95, 0x5f, 0xb6, 0xe0, 0x68, 0x6};
  uint8_t topic_bytes[] = {0xa3, 0x84, 0x64, 0x9d, 0x95};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe0, 0x68, 0x6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 24502, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\163\132d\157\149", _pubPktID =
// 24502, _pubBody = "\224h\ACK", _pubProps = []}
TEST(Publish311QCTest, Decode23) {
  uint8_t pkt[] = {0x34, 0xc, 0x0, 0x5, 0xa3, 0x84, 0x64, 0x9d, 0x95, 0x5f, 0xb6, 0xe0, 0x68, 0x6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa3, 0x84, 0x64, 0x9d, 0x95};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe0, 0x68, 0x6};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 24502);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\153\164\218\195=\160\170\223\157
// b%X\222\199hG0\198K3y\207\128J\188\176\225", _pubPktID = 0, _pubBody = "\SOH\191\156", _pubProps = []}
TEST(Publish311QCTest, Encode24) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0x1c, 0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf,
                   0x9d, 0x20, 0x62, 0x25, 0x58, 0xde, 0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b,
                   0x33, 0x79, 0xcf, 0x80, 0x4a, 0xbc, 0xb0, 0xe1, 0x1,  0xbf, 0x9c};
  uint8_t topic_bytes[] = {0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf, 0x9d, 0x20, 0x62, 0x25, 0x58, 0xde,
                           0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b, 0x33, 0x79, 0xcf, 0x80, 0x4a, 0xbc, 0xb0, 0xe1};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1, 0xbf, 0x9c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\153\164\218\195=\160\170\223\157
// b%X\222\199hG0\198K3y\207\128J\188\176\225", _pubPktID = 0, _pubBody = "\SOH\191\156", _pubProps = []}
TEST(Publish311QCTest, Decode24) {
  uint8_t pkt[] = {0x38, 0x21, 0x0,  0x1c, 0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf,
                   0x9d, 0x20, 0x62, 0x25, 0x58, 0xde, 0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b,
                   0x33, 0x79, 0xcf, 0x80, 0x4a, 0xbc, 0xb0, 0xe1, 0x1,  0xbf, 0x9c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf, 0x9d, 0x20, 0x62, 0x25, 0x58, 0xde,
                               0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b, 0x33, 0x79, 0xcf, 0x80, 0x4a, 0xbc, 0xb0, 0xe1};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1, 0xbf, 0x9c};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "Z\162]m\132\183R\SUBWRu", _pubPktID
// = 13838, _pubBody =
// "{&\208\GS\139\141\&9\162*\207\153\136\148\172\STX\190\162e\RS\\\163\194\141\DC1\SYN\156\204\236", _pubProps = []}
TEST(Publish311QCTest, Encode25) {
  uint8_t pkt[] = {0x3a, 0x2b, 0x0,  0xb,  0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75,
                   0x36, 0xe,  0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94,
                   0xac, 0x2,  0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  uint8_t topic_bytes[] = {0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94, 0xac,
                         0x2,  0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 13838, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "Z\162]m\132\183R\SUBWRu", _pubPktID
// = 13838, _pubBody =
// "{&\208\GS\139\141\&9\162*\207\153\136\148\172\STX\190\162e\RS\\\163\194\141\DC1\SYN\156\204\236", _pubProps = []}
TEST(Publish311QCTest, Decode25) {
  uint8_t pkt[] = {0x3a, 0x2b, 0x0,  0xb,  0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75,
                   0x36, 0xe,  0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94,
                   0xac, 0x2,  0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94, 0xac,
                              0x2,  0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 13838);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\245\STX\252\CAN\215\187\FS^!\141\191\250|\190\164I\153\169,U`", _pubPktID = 10215, _pubBody =
// "\199r\153\234\&0UY.\201J\198\SO", _pubProps = []}
TEST(Publish311QCTest, Encode26) {
  uint8_t pkt[] = {0x33, 0x25, 0x0,  0x15, 0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21,
                   0x8d, 0xbf, 0xfa, 0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60, 0x27,
                   0xe7, 0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  uint8_t topic_bytes[] = {0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21, 0x8d, 0xbf,
                           0xfa, 0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 10215, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\245\STX\252\CAN\215\187\FS^!\141\191\250|\190\164I\153\169,U`", _pubPktID = 10215, _pubBody =
// "\199r\153\234\&0UY.\201J\198\SO", _pubProps = []}
TEST(Publish311QCTest, Decode26) {
  uint8_t pkt[] = {0x33, 0x25, 0x0,  0x15, 0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21,
                   0x8d, 0xbf, 0xfa, 0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60, 0x27,
                   0xe7, 0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21, 0x8d, 0xbf,
                               0xfa, 0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10215);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\187\192\216\&6]J\244\v\252\&6\149\EOT\128\ETX", _pubPktID = 11476, _pubBody =
// "\254&\138\150\179\238u\252\176\246'\140\196", _pubProps = []}
TEST(Publish311QCTest, Encode27) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0xe,  0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb,  0xfc, 0x36, 0x95, 0x4, 0x80,
                   0x3,  0x2c, 0xd4, 0xfe, 0x26, 0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  uint8_t topic_bytes[] = {0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb, 0xfc, 0x36, 0x95, 0x4, 0x80, 0x3};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfe, 0x26, 0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, true, 11476, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\187\192\216\&6]J\244\v\252\&6\149\EOT\128\ETX", _pubPktID = 11476, _pubBody =
// "\254&\138\150\179\238u\252\176\246'\140\196", _pubProps = []}
TEST(Publish311QCTest, Decode27) {
  uint8_t pkt[] = {0x3a, 0x1f, 0x0,  0xe,  0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb,  0xfc, 0x36, 0x95, 0x4, 0x80,
                   0x3,  0x2c, 0xd4, 0xfe, 0x26, 0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb, 0xfc, 0x36, 0x95, 0x4, 0x80, 0x3};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfe, 0x26, 0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11476);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "/\USs\188\193\156\202\143\244\215\159fj\184\STX\DC3\217", _pubPktID = 0, _pubBody = "\213T\157\156*`\174Ad\219\206",
// _pubProps = []}
TEST(Publish311QCTest, Encode28) {
  uint8_t pkt[] = {0x31, 0x1e, 0x0, 0x11, 0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4, 0xd7, 0x9f, 0x66,
                   0x6a, 0xb8, 0x2, 0x13, 0xd9, 0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  uint8_t topic_bytes[] = {0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4,
                           0xd7, 0x9f, 0x66, 0x6a, 0xb8, 0x2,  0x13, 0xd9};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "/\USs\188\193\156\202\143\244\215\159fj\184\STX\DC3\217", _pubPktID = 0, _pubBody = "\213T\157\156*`\174Ad\219\206",
// _pubProps = []}
TEST(Publish311QCTest, Decode28) {
  uint8_t pkt[] = {0x31, 0x1e, 0x0, 0x11, 0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4, 0xd7, 0x9f, 0x66,
                   0x6a, 0xb8, 0x2, 0x13, 0xd9, 0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4,
                               0xd7, 0x9f, 0x66, 0x6a, 0xb8, 0x2,  0x13, 0xd9};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\ETXJ\240r\220\200\DLE=\219m\152\EM\205\US\144", _pubPktID = 32504, _pubBody =
// "C\158&\185\DLE\NUL\239\237\184+\SO<\134\"R\EM\232\230\222\ENQ", _pubProps = []}
TEST(Publish311QCTest, Encode29) {
  uint8_t pkt[] = {0x35, 0x27, 0x0,  0xf,  0x3,  0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d,
                   0x98, 0x19, 0xcd, 0x1f, 0x90, 0x7e, 0xf8, 0x43, 0x9e, 0x26, 0xb9, 0x10, 0x0,  0xef,
                   0xed, 0xb8, 0x2b, 0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  uint8_t topic_bytes[] = {0x3, 0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d, 0x98, 0x19, 0xcd, 0x1f, 0x90};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x43, 0x9e, 0x26, 0xb9, 0x10, 0x0,  0xef, 0xed, 0xb8, 0x2b,
                         0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 32504, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\ETXJ\240r\220\200\DLE=\219m\152\EM\205\US\144", _pubPktID = 32504, _pubBody =
// "C\158&\185\DLE\NUL\239\237\184+\SO<\134\"R\EM\232\230\222\ENQ", _pubProps = []}
TEST(Publish311QCTest, Decode29) {
  uint8_t pkt[] = {0x35, 0x27, 0x0,  0xf,  0x3,  0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d,
                   0x98, 0x19, 0xcd, 0x1f, 0x90, 0x7e, 0xf8, 0x43, 0x9e, 0x26, 0xb9, 0x10, 0x0,  0xef,
                   0xed, 0xb8, 0x2b, 0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3, 0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d, 0x98, 0x19, 0xcd, 0x1f, 0x90};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x43, 0x9e, 0x26, 0xb9, 0x10, 0x0,  0xef, 0xed, 0xb8, 0x2b,
                              0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 32504);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\CAN\n\131L\223F1\229", _pubPktID =
// 0, _pubBody = "\138\228\212\203", _pubProps = []}
TEST(Publish311QCTest, Encode30) {
  uint8_t pkt[] = {0x30, 0xe, 0x0, 0x8, 0x18, 0xa, 0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5, 0x8a, 0xe4, 0xd4, 0xcb};
  uint8_t topic_bytes[] = {0x18, 0xa, 0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8a, 0xe4, 0xd4, 0xcb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT311, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\CAN\n\131L\223F1\229", _pubPktID =
// 0, _pubBody = "\138\228\212\203", _pubProps = []}
TEST(Publish311QCTest, Decode30) {
  uint8_t pkt[] = {0x30, 0xe, 0x0, 0x8, 0x18, 0xa, 0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5, 0x8a, 0xe4, 0xd4, 0xcb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT311, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x18, 0xa, 0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8a, 0xe4, 0xd4, 0xcb};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\137\189\213\133\214H\EM\161\170\241\136", _pubPktID = 0, _pubBody = "\217\146\229\195\163\175\196\174y0d\141b\146",
// _pubProps = [PropWildcardSubscriptionAvailable 153,PropTopicAliasMaximum 3171,PropContentType
// "\EOT6\189\bp\217'\191\164\GS:\157\177o\254",PropAuthenticationData
// "E]\238\185\207#\n\145\&2\233\253\140\&0",PropTopicAliasMaximum 14538,PropSubscriptionIdentifierAvailable
// 92,PropSubscriptionIdentifier 5,PropRetainAvailable 55,PropReasonString
// "{\167_\GS\209\244\179\245",PropMessageExpiryInterval 27769,PropReasonString
// "\188l\201\168\179\&5\231\253\230\157\226\161\149{\173\DLE\177\222!\146\b.@",PropMaximumQoS 165,PropServerKeepAlive
// 1411,PropMessageExpiryInterval 19809]}
TEST(Publish5QCTest, Encode1) {
  uint8_t pkt[] = {0x31, 0x80, 0x1,  0x0,  0xb,  0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88, 0x64,
                   0x28, 0x99, 0x22, 0xc,  0x63, 0x3,  0x0,  0xf,  0x4,  0x36, 0xbd, 0x8,  0x70, 0xd9, 0x27, 0xbf, 0xa4,
                   0x1d, 0x3a, 0x9d, 0xb1, 0x6f, 0xfe, 0x16, 0x0,  0xd,  0x45, 0x5d, 0xee, 0xb9, 0xcf, 0x23, 0xa,  0x91,
                   0x32, 0xe9, 0xfd, 0x8c, 0x30, 0x22, 0x38, 0xca, 0x29, 0x5c, 0xb,  0x5,  0x25, 0x37, 0x1f, 0x0,  0x8,
                   0x7b, 0xa7, 0x5f, 0x1d, 0xd1, 0xf4, 0xb3, 0xf5, 0x2,  0x0,  0x0,  0x6c, 0x79, 0x1f, 0x0,  0x17, 0xbc,
                   0x6c, 0xc9, 0xa8, 0xb3, 0x35, 0xe7, 0xfd, 0xe6, 0x9d, 0xe2, 0xa1, 0x95, 0x7b, 0xad, 0x10, 0xb1, 0xde,
                   0x21, 0x92, 0x8,  0x2e, 0x40, 0x24, 0xa5, 0x13, 0x5,  0x83, 0x2,  0x0,  0x0,  0x4d, 0x61, 0xd9, 0x92,
                   0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  uint8_t topic_bytes[] = {0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd9, 0x92, 0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0x4, 0x36, 0xbd, 0x8, 0x70, 0xd9, 0x27, 0xbf, 0xa4, 0x1d, 0x3a, 0x9d, 0xb1, 0x6f, 0xfe};
  uint8_t bytesprops1[] = {0x45, 0x5d, 0xee, 0xb9, 0xcf, 0x23, 0xa, 0x91, 0x32, 0xe9, 0xfd, 0x8c, 0x30};
  uint8_t bytesprops2[] = {0x7b, 0xa7, 0x5f, 0x1d, 0xd1, 0xf4, 0xb3, 0xf5};
  uint8_t bytesprops3[] = {0xbc, 0x6c, 0xc9, 0xa8, 0xb3, 0x35, 0xe7, 0xfd, 0xe6, 0x9d, 0xe2, 0xa1,
                           0x95, 0x7b, 0xad, 0x10, 0xb1, 0xde, 0x21, 0x92, 0x8,  0x2e, 0x40};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3171}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14538}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27769}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1411}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19809}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\137\189\213\133\214H\EM\161\170\241\136", _pubPktID = 0, _pubBody = "\217\146\229\195\163\175\196\174y0d\141b\146",
// _pubProps = [PropWildcardSubscriptionAvailable 153,PropTopicAliasMaximum 3171,PropContentType
// "\EOT6\189\bp\217'\191\164\GS:\157\177o\254",PropAuthenticationData
// "E]\238\185\207#\n\145\&2\233\253\140\&0",PropTopicAliasMaximum 14538,PropSubscriptionIdentifierAvailable
// 92,PropSubscriptionIdentifier 5,PropRetainAvailable 55,PropReasonString
// "{\167_\GS\209\244\179\245",PropMessageExpiryInterval 27769,PropReasonString
// "\188l\201\168\179\&5\231\253\230\157\226\161\149{\173\DLE\177\222!\146\b.@",PropMaximumQoS 165,PropServerKeepAlive
// 1411,PropMessageExpiryInterval 19809]}
TEST(Publish5QCTest, Decode1) {
  uint8_t pkt[] = {0x31, 0x80, 0x1,  0x0,  0xb,  0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88, 0x64,
                   0x28, 0x99, 0x22, 0xc,  0x63, 0x3,  0x0,  0xf,  0x4,  0x36, 0xbd, 0x8,  0x70, 0xd9, 0x27, 0xbf, 0xa4,
                   0x1d, 0x3a, 0x9d, 0xb1, 0x6f, 0xfe, 0x16, 0x0,  0xd,  0x45, 0x5d, 0xee, 0xb9, 0xcf, 0x23, 0xa,  0x91,
                   0x32, 0xe9, 0xfd, 0x8c, 0x30, 0x22, 0x38, 0xca, 0x29, 0x5c, 0xb,  0x5,  0x25, 0x37, 0x1f, 0x0,  0x8,
                   0x7b, 0xa7, 0x5f, 0x1d, 0xd1, 0xf4, 0xb3, 0xf5, 0x2,  0x0,  0x0,  0x6c, 0x79, 0x1f, 0x0,  0x17, 0xbc,
                   0x6c, 0xc9, 0xa8, 0xb3, 0x35, 0xe7, 0xfd, 0xe6, 0x9d, 0xe2, 0xa1, 0x95, 0x7b, 0xad, 0x10, 0xb1, 0xde,
                   0x21, 0x92, 0x8,  0x2e, 0x40, 0x24, 0xa5, 0x13, 0x5,  0x83, 0x2,  0x0,  0x0,  0x4d, 0x61, 0xd9, 0x92,
                   0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x89, 0xbd, 0xd5, 0x85, 0xd6, 0x48, 0x19, 0xa1, 0xaa, 0xf1, 0x88};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd9, 0x92, 0xe5, 0xc3, 0xa3, 0xaf, 0xc4, 0xae, 0x79, 0x30, 0x64, 0x8d, 0x62, 0x92};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\183\249", _pubPktID = 0, _pubBody
// = "M\EOTga\US?`w\167\&6\152\SI\NAKC\168>\173<\149\213m,5\235\133\r\180\190\195", _pubProps =
// [PropMessageExpiryInterval 32152,PropCorrelationData "};Zy2w\196\SO\158\155\212\US\145[\216\208&",PropResponseTopic
// "P\154\n\168\222q\EM\191\&7\247\208",PropResponseTopic
// "r\164\175\171\SUB=\160D'v\154\167",PropSharedSubscriptionAvailable 114,PropAssignedClientIdentifier
// "\179\247$\SYN\214\231\223\235+=SuY\244g\138\&4\198\158o\155\209\187\159v\153\230\203",PropMessageExpiryInterval
// 7971,PropReasonString "\167\SI\144j\r\230\207Q\139\&7\ETX\248[\154",PropMessageExpiryInterval
// 10952,PropRequestResponseInformation 148,PropReasonString "\139[\171\224!~\164\210",PropAssignedClientIdentifier
// "\138\169\SIV\231",PropAuthenticationData "\188\155\136o\243O\194",PropResponseInformation
// "[<\225\130\225\223\&4\134\CAN{0\188\209Bt\128\152A\133\a\n",PropSessionExpiryInterval
// 24494,PropSharedSubscriptionAvailable 202,PropResponseInformation
// "B\173n\FSD1\197\a\211v\144\152\184\188B",PropAuthenticationData
// "C2\202\128H\DC3\136\188\194v3\235\231\198\149\251zc",PropMaximumPacketSize 32261,PropRequestProblemInformation
// 61,PropSubscriptionIdentifierAvailable 184,PropResponseTopic
// "L\EM\147\234\201\193\t\EM\245*p\205\138\182O",PropUserProperty "o\US\ESC\155\160\221f\176\141\NAK\159"
// "\ETX\222o\DC4\169\130O\132\SYN\141\DC3",PropContentType
// "\DC1\195\185v\167\r\175N.\207\128\USM\147?*\nA\248\161\133\244\186{\251+\STX",PropContentType
// "\138n[`C$",PropRetainAvailable 205]}
TEST(Publish5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x30, 0xd9, 0x2,  0x0,  0x2,  0xb7, 0xf9, 0xb6, 0x2,  0x2,  0x0,  0x0,  0x7d, 0x98, 0x9,  0x0,  0x11, 0x7d, 0x3b,
      0x5a, 0x79, 0x32, 0x77, 0xc4, 0xe,  0x9e, 0x9b, 0xd4, 0x1f, 0x91, 0x5b, 0xd8, 0xd0, 0x26, 0x8,  0x0,  0xb,  0x50,
      0x9a, 0xa,  0xa8, 0xde, 0x71, 0x19, 0xbf, 0x37, 0xf7, 0xd0, 0x8,  0x0,  0xc,  0x72, 0xa4, 0xaf, 0xab, 0x1a, 0x3d,
      0xa0, 0x44, 0x27, 0x76, 0x9a, 0xa7, 0x2a, 0x72, 0x12, 0x0,  0x1c, 0xb3, 0xf7, 0x24, 0x16, 0xd6, 0xe7, 0xdf, 0xeb,
      0x2b, 0x3d, 0x53, 0x75, 0x59, 0xf4, 0x67, 0x8a, 0x34, 0xc6, 0x9e, 0x6f, 0x9b, 0xd1, 0xbb, 0x9f, 0x76, 0x99, 0xe6,
      0xcb, 0x2,  0x0,  0x0,  0x1f, 0x23, 0x1f, 0x0,  0xe,  0xa7, 0xf,  0x90, 0x6a, 0xd,  0xe6, 0xcf, 0x51, 0x8b, 0x37,
      0x3,  0xf8, 0x5b, 0x9a, 0x2,  0x0,  0x0,  0x2a, 0xc8, 0x19, 0x94, 0x1f, 0x0,  0x8,  0x8b, 0x5b, 0xab, 0xe0, 0x21,
      0x7e, 0xa4, 0xd2, 0x12, 0x0,  0x5,  0x8a, 0xa9, 0xf,  0x56, 0xe7, 0x16, 0x0,  0x7,  0xbc, 0x9b, 0x88, 0x6f, 0xf3,
      0x4f, 0xc2, 0x1a, 0x0,  0x15, 0x5b, 0x3c, 0xe1, 0x82, 0xe1, 0xdf, 0x34, 0x86, 0x18, 0x7b, 0x30, 0xbc, 0xd1, 0x42,
      0x74, 0x80, 0x98, 0x41, 0x85, 0x7,  0xa,  0x11, 0x0,  0x0,  0x5f, 0xae, 0x2a, 0xca, 0x1a, 0x0,  0xf,  0x42, 0xad,
      0x6e, 0x1c, 0x44, 0x31, 0xc5, 0x7,  0xd3, 0x76, 0x90, 0x98, 0xb8, 0xbc, 0x42, 0x16, 0x0,  0x12, 0x43, 0x32, 0xca,
      0x80, 0x48, 0x13, 0x88, 0xbc, 0xc2, 0x76, 0x33, 0xeb, 0xe7, 0xc6, 0x95, 0xfb, 0x7a, 0x63, 0x27, 0x0,  0x0,  0x7e,
      0x5,  0x17, 0x3d, 0x29, 0xb8, 0x8,  0x0,  0xf,  0x4c, 0x19, 0x93, 0xea, 0xc9, 0xc1, 0x9,  0x19, 0xf5, 0x2a, 0x70,
      0xcd, 0x8a, 0xb6, 0x4f, 0x26, 0x0,  0xb,  0x6f, 0x1f, 0x1b, 0x9b, 0xa0, 0xdd, 0x66, 0xb0, 0x8d, 0x15, 0x9f, 0x0,
      0xb,  0x3,  0xde, 0x6f, 0x14, 0xa9, 0x82, 0x4f, 0x84, 0x16, 0x8d, 0x13, 0x3,  0x0,  0x1b, 0x11, 0xc3, 0xb9, 0x76,
      0xa7, 0xd,  0xaf, 0x4e, 0x2e, 0xcf, 0x80, 0x1f, 0x4d, 0x93, 0x3f, 0x2a, 0xa,  0x41, 0xf8, 0xa1, 0x85, 0xf4, 0xba,
      0x7b, 0xfb, 0x2b, 0x2,  0x3,  0x0,  0x6,  0x8a, 0x6e, 0x5b, 0x60, 0x43, 0x24, 0x25, 0xcd, 0x4d, 0x4,  0x67, 0x61,
      0x1f, 0x3f, 0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8, 0x3e, 0xad, 0x3c, 0x95, 0xd5, 0x6d, 0x2c, 0x35,
      0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  uint8_t topic_bytes[] = {0xb7, 0xf9};
  lwmqtt_string_t topic = {2, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x4d, 0x4,  0x67, 0x61, 0x1f, 0x3f, 0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8,
                         0x3e, 0xad, 0x3c, 0x95, 0xd5, 0x6d, 0x2c, 0x35, 0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 29;

  uint8_t bytesprops0[] = {0x7d, 0x3b, 0x5a, 0x79, 0x32, 0x77, 0xc4, 0xe, 0x9e,
                           0x9b, 0xd4, 0x1f, 0x91, 0x5b, 0xd8, 0xd0, 0x26};
  uint8_t bytesprops1[] = {0x50, 0x9a, 0xa, 0xa8, 0xde, 0x71, 0x19, 0xbf, 0x37, 0xf7, 0xd0};
  uint8_t bytesprops2[] = {0x72, 0xa4, 0xaf, 0xab, 0x1a, 0x3d, 0xa0, 0x44, 0x27, 0x76, 0x9a, 0xa7};
  uint8_t bytesprops3[] = {0xb3, 0xf7, 0x24, 0x16, 0xd6, 0xe7, 0xdf, 0xeb, 0x2b, 0x3d, 0x53, 0x75, 0x59, 0xf4,
                           0x67, 0x8a, 0x34, 0xc6, 0x9e, 0x6f, 0x9b, 0xd1, 0xbb, 0x9f, 0x76, 0x99, 0xe6, 0xcb};
  uint8_t bytesprops4[] = {0xa7, 0xf, 0x90, 0x6a, 0xd, 0xe6, 0xcf, 0x51, 0x8b, 0x37, 0x3, 0xf8, 0x5b, 0x9a};
  uint8_t bytesprops5[] = {0x8b, 0x5b, 0xab, 0xe0, 0x21, 0x7e, 0xa4, 0xd2};
  uint8_t bytesprops6[] = {0x8a, 0xa9, 0xf, 0x56, 0xe7};
  uint8_t bytesprops7[] = {0xbc, 0x9b, 0x88, 0x6f, 0xf3, 0x4f, 0xc2};
  uint8_t bytesprops8[] = {0x5b, 0x3c, 0xe1, 0x82, 0xe1, 0xdf, 0x34, 0x86, 0x18, 0x7b, 0x30,
                           0xbc, 0xd1, 0x42, 0x74, 0x80, 0x98, 0x41, 0x85, 0x7,  0xa};
  uint8_t bytesprops9[] = {0x42, 0xad, 0x6e, 0x1c, 0x44, 0x31, 0xc5, 0x7, 0xd3, 0x76, 0x90, 0x98, 0xb8, 0xbc, 0x42};
  uint8_t bytesprops10[] = {0x43, 0x32, 0xca, 0x80, 0x48, 0x13, 0x88, 0xbc, 0xc2,
                            0x76, 0x33, 0xeb, 0xe7, 0xc6, 0x95, 0xfb, 0x7a, 0x63};
  uint8_t bytesprops11[] = {0x4c, 0x19, 0x93, 0xea, 0xc9, 0xc1, 0x9, 0x19, 0xf5, 0x2a, 0x70, 0xcd, 0x8a, 0xb6, 0x4f};
  uint8_t bytesprops13[] = {0x3, 0xde, 0x6f, 0x14, 0xa9, 0x82, 0x4f, 0x84, 0x16, 0x8d, 0x13};
  uint8_t bytesprops12[] = {0x6f, 0x1f, 0x1b, 0x9b, 0xa0, 0xdd, 0x66, 0xb0, 0x8d, 0x15, 0x9f};
  uint8_t bytesprops14[] = {0x11, 0xc3, 0xb9, 0x76, 0xa7, 0xd,  0xaf, 0x4e, 0x2e, 0xcf, 0x80, 0x1f, 0x4d, 0x93,
                            0x3f, 0x2a, 0xa,  0x41, 0xf8, 0xa1, 0x85, 0xf4, 0xba, 0x7b, 0xfb, 0x2b, 0x2};
  uint8_t bytesprops15[] = {0x8a, 0x6e, 0x5b, 0x60, 0x43, 0x24};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32152}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7971}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10952}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24494}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32261}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {11, (char*)&bytesprops12}, .v = {11, (char*)&bytesprops13}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 205}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\183\249", _pubPktID = 0, _pubBody
// = "M\EOTga\US?`w\167\&6\152\SI\NAKC\168>\173<\149\213m,5\235\133\r\180\190\195", _pubProps =
// [PropMessageExpiryInterval 32152,PropCorrelationData "};Zy2w\196\SO\158\155\212\US\145[\216\208&",PropResponseTopic
// "P\154\n\168\222q\EM\191\&7\247\208",PropResponseTopic
// "r\164\175\171\SUB=\160D'v\154\167",PropSharedSubscriptionAvailable 114,PropAssignedClientIdentifier
// "\179\247$\SYN\214\231\223\235+=SuY\244g\138\&4\198\158o\155\209\187\159v\153\230\203",PropMessageExpiryInterval
// 7971,PropReasonString "\167\SI\144j\r\230\207Q\139\&7\ETX\248[\154",PropMessageExpiryInterval
// 10952,PropRequestResponseInformation 148,PropReasonString "\139[\171\224!~\164\210",PropAssignedClientIdentifier
// "\138\169\SIV\231",PropAuthenticationData "\188\155\136o\243O\194",PropResponseInformation
// "[<\225\130\225\223\&4\134\CAN{0\188\209Bt\128\152A\133\a\n",PropSessionExpiryInterval
// 24494,PropSharedSubscriptionAvailable 202,PropResponseInformation
// "B\173n\FSD1\197\a\211v\144\152\184\188B",PropAuthenticationData
// "C2\202\128H\DC3\136\188\194v3\235\231\198\149\251zc",PropMaximumPacketSize 32261,PropRequestProblemInformation
// 61,PropSubscriptionIdentifierAvailable 184,PropResponseTopic
// "L\EM\147\234\201\193\t\EM\245*p\205\138\182O",PropUserProperty "o\US\ESC\155\160\221f\176\141\NAK\159"
// "\ETX\222o\DC4\169\130O\132\SYN\141\DC3",PropContentType
// "\DC1\195\185v\167\r\175N.\207\128\USM\147?*\nA\248\161\133\244\186{\251+\STX",PropContentType
// "\138n[`C$",PropRetainAvailable 205]}
TEST(Publish5QCTest, Decode2) {
  uint8_t pkt[] = {
      0x30, 0xd9, 0x2,  0x0,  0x2,  0xb7, 0xf9, 0xb6, 0x2,  0x2,  0x0,  0x0,  0x7d, 0x98, 0x9,  0x0,  0x11, 0x7d, 0x3b,
      0x5a, 0x79, 0x32, 0x77, 0xc4, 0xe,  0x9e, 0x9b, 0xd4, 0x1f, 0x91, 0x5b, 0xd8, 0xd0, 0x26, 0x8,  0x0,  0xb,  0x50,
      0x9a, 0xa,  0xa8, 0xde, 0x71, 0x19, 0xbf, 0x37, 0xf7, 0xd0, 0x8,  0x0,  0xc,  0x72, 0xa4, 0xaf, 0xab, 0x1a, 0x3d,
      0xa0, 0x44, 0x27, 0x76, 0x9a, 0xa7, 0x2a, 0x72, 0x12, 0x0,  0x1c, 0xb3, 0xf7, 0x24, 0x16, 0xd6, 0xe7, 0xdf, 0xeb,
      0x2b, 0x3d, 0x53, 0x75, 0x59, 0xf4, 0x67, 0x8a, 0x34, 0xc6, 0x9e, 0x6f, 0x9b, 0xd1, 0xbb, 0x9f, 0x76, 0x99, 0xe6,
      0xcb, 0x2,  0x0,  0x0,  0x1f, 0x23, 0x1f, 0x0,  0xe,  0xa7, 0xf,  0x90, 0x6a, 0xd,  0xe6, 0xcf, 0x51, 0x8b, 0x37,
      0x3,  0xf8, 0x5b, 0x9a, 0x2,  0x0,  0x0,  0x2a, 0xc8, 0x19, 0x94, 0x1f, 0x0,  0x8,  0x8b, 0x5b, 0xab, 0xe0, 0x21,
      0x7e, 0xa4, 0xd2, 0x12, 0x0,  0x5,  0x8a, 0xa9, 0xf,  0x56, 0xe7, 0x16, 0x0,  0x7,  0xbc, 0x9b, 0x88, 0x6f, 0xf3,
      0x4f, 0xc2, 0x1a, 0x0,  0x15, 0x5b, 0x3c, 0xe1, 0x82, 0xe1, 0xdf, 0x34, 0x86, 0x18, 0x7b, 0x30, 0xbc, 0xd1, 0x42,
      0x74, 0x80, 0x98, 0x41, 0x85, 0x7,  0xa,  0x11, 0x0,  0x0,  0x5f, 0xae, 0x2a, 0xca, 0x1a, 0x0,  0xf,  0x42, 0xad,
      0x6e, 0x1c, 0x44, 0x31, 0xc5, 0x7,  0xd3, 0x76, 0x90, 0x98, 0xb8, 0xbc, 0x42, 0x16, 0x0,  0x12, 0x43, 0x32, 0xca,
      0x80, 0x48, 0x13, 0x88, 0xbc, 0xc2, 0x76, 0x33, 0xeb, 0xe7, 0xc6, 0x95, 0xfb, 0x7a, 0x63, 0x27, 0x0,  0x0,  0x7e,
      0x5,  0x17, 0x3d, 0x29, 0xb8, 0x8,  0x0,  0xf,  0x4c, 0x19, 0x93, 0xea, 0xc9, 0xc1, 0x9,  0x19, 0xf5, 0x2a, 0x70,
      0xcd, 0x8a, 0xb6, 0x4f, 0x26, 0x0,  0xb,  0x6f, 0x1f, 0x1b, 0x9b, 0xa0, 0xdd, 0x66, 0xb0, 0x8d, 0x15, 0x9f, 0x0,
      0xb,  0x3,  0xde, 0x6f, 0x14, 0xa9, 0x82, 0x4f, 0x84, 0x16, 0x8d, 0x13, 0x3,  0x0,  0x1b, 0x11, 0xc3, 0xb9, 0x76,
      0xa7, 0xd,  0xaf, 0x4e, 0x2e, 0xcf, 0x80, 0x1f, 0x4d, 0x93, 0x3f, 0x2a, 0xa,  0x41, 0xf8, 0xa1, 0x85, 0xf4, 0xba,
      0x7b, 0xfb, 0x2b, 0x2,  0x3,  0x0,  0x6,  0x8a, 0x6e, 0x5b, 0x60, 0x43, 0x24, 0x25, 0xcd, 0x4d, 0x4,  0x67, 0x61,
      0x1f, 0x3f, 0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8, 0x3e, 0xad, 0x3c, 0x95, 0xd5, 0x6d, 0x2c, 0x35,
      0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb7, 0xf9};
  lwmqtt_string_t exp_topic = {2, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x4d, 0x4,  0x67, 0x61, 0x1f, 0x3f, 0x60, 0x77, 0xa7, 0x36, 0x98, 0xf,  0x15, 0x43, 0xa8,
                              0x3e, 0xad, 0x3c, 0x95, 0xd5, 0x6d, 0x2c, 0x35, 0xeb, 0x85, 0xd,  0xb4, 0xbe, 0xc3};
  lwmqtt_string_t exp_body = {29, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 2);
  EXPECT_EQ(msg.payload_len, 29);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 29);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\DC1\157\ns\ETX0?\130,\153\&5(\EM\NAK\235tg/\223cz\215\188l", _pubPktID = 23951, _pubBody = "\252\STX\212\139",
// _pubProps = [PropReceiveMaximum 2885,PropSubscriptionIdentifierAvailable 134,PropCorrelationData
// "4\178\DEL\235\196_\225<\219\177\197\GS\ENQ\167I\213\168N\155\163",PropMessageExpiryInterval
// 30572,PropSubscriptionIdentifierAvailable 249,PropTopicAliasMaximum 2600,PropRetainAvailable
// 111,PropResponseInformation "\235\188\191\218\&7\232t\203P\218%\190\184\209s\173\NAK\rY",PropMaximumPacketSize
// 27511,PropAuthenticationMethod
// "d$6\228\131\179\242\218\235\EM8\169\141HK\146\177\167)\253\133\137\172",PropMaximumPacketSize
// 13586,PropServerReference "\249X\232\RS\228\225\207(3\vn\153\170\200Ds\157\201\ENQ1\234W\167",PropServerReference
// "uMy\144F\248<\231\215\221\184z\132Wm}\ETX",PropTopicAlias 14062,PropResponseTopic
// "\195\172\153\209|\153\DC2K\138\230y\250\NUL\189\ACKV\NAKn!",PropAuthenticationData
// "Q5\182q\140\DLEu\153\164a\149\157?>]D\195\142\DC1",PropResponseInformation
// "9\139\232\228\EM",PropAssignedClientIdentifier "3\189w=\ESC",PropSubscriptionIdentifierAvailable
// 19,PropAuthenticationMethod
// "\174\235B\200\147\145\192\156B\SOHV\228`\182\245\217\233\165\138c\190\GS\DC1u\157K\187\234\207",PropSessionExpiryInterval
// 16713,PropResponseInformation "M\194\151d\163\182\EOT.\208\ACK\183\&9\159]3:\187",PropSharedSubscriptionAvailable
// 144,PropTopicAliasMaximum 11118,PropAuthenticationData "\f\EM\DEL\155\167\236;-J^~n_\162"]}
TEST(Publish5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x3a, 0xc2, 0x2,  0x0,  0x18, 0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82, 0x2c, 0x99, 0x35, 0x28, 0x19, 0x15,
      0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63, 0x7a, 0xd7, 0xbc, 0x6c, 0x5d, 0x8f, 0xa0, 0x2,  0x21, 0xb,  0x45, 0x29, 0x86,
      0x9,  0x0,  0x14, 0x34, 0xb2, 0x7f, 0xeb, 0xc4, 0x5f, 0xe1, 0x3c, 0xdb, 0xb1, 0xc5, 0x1d, 0x5,  0xa7, 0x49, 0xd5,
      0xa8, 0x4e, 0x9b, 0xa3, 0x2,  0x0,  0x0,  0x77, 0x6c, 0x29, 0xf9, 0x22, 0xa,  0x28, 0x25, 0x6f, 0x1a, 0x0,  0x13,
      0xeb, 0xbc, 0xbf, 0xda, 0x37, 0xe8, 0x74, 0xcb, 0x50, 0xda, 0x25, 0xbe, 0xb8, 0xd1, 0x73, 0xad, 0x15, 0xd,  0x59,
      0x27, 0x0,  0x0,  0x6b, 0x77, 0x15, 0x0,  0x17, 0x64, 0x24, 0x36, 0xe4, 0x83, 0xb3, 0xf2, 0xda, 0xeb, 0x19, 0x38,
      0xa9, 0x8d, 0x48, 0x4b, 0x92, 0xb1, 0xa7, 0x29, 0xfd, 0x85, 0x89, 0xac, 0x27, 0x0,  0x0,  0x35, 0x12, 0x1c, 0x0,
      0x17, 0xf9, 0x58, 0xe8, 0x1e, 0xe4, 0xe1, 0xcf, 0x28, 0x33, 0xb,  0x6e, 0x99, 0xaa, 0xc8, 0x44, 0x73, 0x9d, 0xc9,
      0x5,  0x31, 0xea, 0x57, 0xa7, 0x1c, 0x0,  0x11, 0x75, 0x4d, 0x79, 0x90, 0x46, 0xf8, 0x3c, 0xe7, 0xd7, 0xdd, 0xb8,
      0x7a, 0x84, 0x57, 0x6d, 0x7d, 0x3,  0x23, 0x36, 0xee, 0x8,  0x0,  0x13, 0xc3, 0xac, 0x99, 0xd1, 0x7c, 0x99, 0x12,
      0x4b, 0x8a, 0xe6, 0x79, 0xfa, 0x0,  0xbd, 0x6,  0x56, 0x15, 0x6e, 0x21, 0x16, 0x0,  0x13, 0x51, 0x35, 0xb6, 0x71,
      0x8c, 0x10, 0x75, 0x99, 0xa4, 0x61, 0x95, 0x9d, 0x3f, 0x3e, 0x5d, 0x44, 0xc3, 0x8e, 0x11, 0x1a, 0x0,  0x5,  0x39,
      0x8b, 0xe8, 0xe4, 0x19, 0x12, 0x0,  0x5,  0x33, 0xbd, 0x77, 0x3d, 0x1b, 0x29, 0x13, 0x15, 0x0,  0x1d, 0xae, 0xeb,
      0x42, 0xc8, 0x93, 0x91, 0xc0, 0x9c, 0x42, 0x1,  0x56, 0xe4, 0x60, 0xb6, 0xf5, 0xd9, 0xe9, 0xa5, 0x8a, 0x63, 0xbe,
      0x1d, 0x11, 0x75, 0x9d, 0x4b, 0xbb, 0xea, 0xcf, 0x11, 0x0,  0x0,  0x41, 0x49, 0x1a, 0x0,  0x11, 0x4d, 0xc2, 0x97,
      0x64, 0xa3, 0xb6, 0x4,  0x2e, 0xd0, 0x6,  0xb7, 0x39, 0x9f, 0x5d, 0x33, 0x3a, 0xbb, 0x2a, 0x90, 0x22, 0x2b, 0x6e,
      0x16, 0x0,  0xe,  0xc,  0x19, 0x7f, 0x9b, 0xa7, 0xec, 0x3b, 0x2d, 0x4a, 0x5e, 0x7e, 0x6e, 0x5f, 0xa2, 0xfc, 0x2,
      0xd4, 0x8b};
  uint8_t topic_bytes[] = {0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82, 0x2c, 0x99, 0x35, 0x28,
                           0x19, 0x15, 0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63, 0x7a, 0xd7, 0xbc, 0x6c};
  lwmqtt_string_t topic = {24, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfc, 0x2, 0xd4, 0x8b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytesprops0[] = {0x34, 0xb2, 0x7f, 0xeb, 0xc4, 0x5f, 0xe1, 0x3c, 0xdb, 0xb1,
                           0xc5, 0x1d, 0x5,  0xa7, 0x49, 0xd5, 0xa8, 0x4e, 0x9b, 0xa3};
  uint8_t bytesprops1[] = {0xeb, 0xbc, 0xbf, 0xda, 0x37, 0xe8, 0x74, 0xcb, 0x50, 0xda,
                           0x25, 0xbe, 0xb8, 0xd1, 0x73, 0xad, 0x15, 0xd,  0x59};
  uint8_t bytesprops2[] = {0x64, 0x24, 0x36, 0xe4, 0x83, 0xb3, 0xf2, 0xda, 0xeb, 0x19, 0x38, 0xa9,
                           0x8d, 0x48, 0x4b, 0x92, 0xb1, 0xa7, 0x29, 0xfd, 0x85, 0x89, 0xac};
  uint8_t bytesprops3[] = {0xf9, 0x58, 0xe8, 0x1e, 0xe4, 0xe1, 0xcf, 0x28, 0x33, 0xb,  0x6e, 0x99,
                           0xaa, 0xc8, 0x44, 0x73, 0x9d, 0xc9, 0x5,  0x31, 0xea, 0x57, 0xa7};
  uint8_t bytesprops4[] = {0x75, 0x4d, 0x79, 0x90, 0x46, 0xf8, 0x3c, 0xe7, 0xd7,
                           0xdd, 0xb8, 0x7a, 0x84, 0x57, 0x6d, 0x7d, 0x3};
  uint8_t bytesprops5[] = {0xc3, 0xac, 0x99, 0xd1, 0x7c, 0x99, 0x12, 0x4b, 0x8a, 0xe6,
                           0x79, 0xfa, 0x0,  0xbd, 0x6,  0x56, 0x15, 0x6e, 0x21};
  uint8_t bytesprops6[] = {0x51, 0x35, 0xb6, 0x71, 0x8c, 0x10, 0x75, 0x99, 0xa4, 0x61,
                           0x95, 0x9d, 0x3f, 0x3e, 0x5d, 0x44, 0xc3, 0x8e, 0x11};
  uint8_t bytesprops7[] = {0x39, 0x8b, 0xe8, 0xe4, 0x19};
  uint8_t bytesprops8[] = {0x33, 0xbd, 0x77, 0x3d, 0x1b};
  uint8_t bytesprops9[] = {0xae, 0xeb, 0x42, 0xc8, 0x93, 0x91, 0xc0, 0x9c, 0x42, 0x1,  0x56, 0xe4, 0x60, 0xb6, 0xf5,
                           0xd9, 0xe9, 0xa5, 0x8a, 0x63, 0xbe, 0x1d, 0x11, 0x75, 0x9d, 0x4b, 0xbb, 0xea, 0xcf};
  uint8_t bytesprops10[] = {0x4d, 0xc2, 0x97, 0x64, 0xa3, 0xb6, 0x4,  0x2e, 0xd0,
                            0x6,  0xb7, 0x39, 0x9f, 0x5d, 0x33, 0x3a, 0xbb};
  uint8_t bytesprops11[] = {0xc, 0x19, 0x7f, 0x9b, 0xa7, 0xec, 0x3b, 0x2d, 0x4a, 0x5e, 0x7e, 0x6e, 0x5f, 0xa2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2885}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30572}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2600}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27511}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13586}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14062}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16713}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11118}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 23951, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\DC1\157\ns\ETX0?\130,\153\&5(\EM\NAK\235tg/\223cz\215\188l", _pubPktID = 23951, _pubBody = "\252\STX\212\139",
// _pubProps = [PropReceiveMaximum 2885,PropSubscriptionIdentifierAvailable 134,PropCorrelationData
// "4\178\DEL\235\196_\225<\219\177\197\GS\ENQ\167I\213\168N\155\163",PropMessageExpiryInterval
// 30572,PropSubscriptionIdentifierAvailable 249,PropTopicAliasMaximum 2600,PropRetainAvailable
// 111,PropResponseInformation "\235\188\191\218\&7\232t\203P\218%\190\184\209s\173\NAK\rY",PropMaximumPacketSize
// 27511,PropAuthenticationMethod
// "d$6\228\131\179\242\218\235\EM8\169\141HK\146\177\167)\253\133\137\172",PropMaximumPacketSize
// 13586,PropServerReference "\249X\232\RS\228\225\207(3\vn\153\170\200Ds\157\201\ENQ1\234W\167",PropServerReference
// "uMy\144F\248<\231\215\221\184z\132Wm}\ETX",PropTopicAlias 14062,PropResponseTopic
// "\195\172\153\209|\153\DC2K\138\230y\250\NUL\189\ACKV\NAKn!",PropAuthenticationData
// "Q5\182q\140\DLEu\153\164a\149\157?>]D\195\142\DC1",PropResponseInformation
// "9\139\232\228\EM",PropAssignedClientIdentifier "3\189w=\ESC",PropSubscriptionIdentifierAvailable
// 19,PropAuthenticationMethod
// "\174\235B\200\147\145\192\156B\SOHV\228`\182\245\217\233\165\138c\190\GS\DC1u\157K\187\234\207",PropSessionExpiryInterval
// 16713,PropResponseInformation "M\194\151d\163\182\EOT.\208\ACK\183\&9\159]3:\187",PropSharedSubscriptionAvailable
// 144,PropTopicAliasMaximum 11118,PropAuthenticationData "\f\EM\DEL\155\167\236;-J^~n_\162"]}
TEST(Publish5QCTest, Decode3) {
  uint8_t pkt[] = {
      0x3a, 0xc2, 0x2,  0x0,  0x18, 0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82, 0x2c, 0x99, 0x35, 0x28, 0x19, 0x15,
      0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63, 0x7a, 0xd7, 0xbc, 0x6c, 0x5d, 0x8f, 0xa0, 0x2,  0x21, 0xb,  0x45, 0x29, 0x86,
      0x9,  0x0,  0x14, 0x34, 0xb2, 0x7f, 0xeb, 0xc4, 0x5f, 0xe1, 0x3c, 0xdb, 0xb1, 0xc5, 0x1d, 0x5,  0xa7, 0x49, 0xd5,
      0xa8, 0x4e, 0x9b, 0xa3, 0x2,  0x0,  0x0,  0x77, 0x6c, 0x29, 0xf9, 0x22, 0xa,  0x28, 0x25, 0x6f, 0x1a, 0x0,  0x13,
      0xeb, 0xbc, 0xbf, 0xda, 0x37, 0xe8, 0x74, 0xcb, 0x50, 0xda, 0x25, 0xbe, 0xb8, 0xd1, 0x73, 0xad, 0x15, 0xd,  0x59,
      0x27, 0x0,  0x0,  0x6b, 0x77, 0x15, 0x0,  0x17, 0x64, 0x24, 0x36, 0xe4, 0x83, 0xb3, 0xf2, 0xda, 0xeb, 0x19, 0x38,
      0xa9, 0x8d, 0x48, 0x4b, 0x92, 0xb1, 0xa7, 0x29, 0xfd, 0x85, 0x89, 0xac, 0x27, 0x0,  0x0,  0x35, 0x12, 0x1c, 0x0,
      0x17, 0xf9, 0x58, 0xe8, 0x1e, 0xe4, 0xe1, 0xcf, 0x28, 0x33, 0xb,  0x6e, 0x99, 0xaa, 0xc8, 0x44, 0x73, 0x9d, 0xc9,
      0x5,  0x31, 0xea, 0x57, 0xa7, 0x1c, 0x0,  0x11, 0x75, 0x4d, 0x79, 0x90, 0x46, 0xf8, 0x3c, 0xe7, 0xd7, 0xdd, 0xb8,
      0x7a, 0x84, 0x57, 0x6d, 0x7d, 0x3,  0x23, 0x36, 0xee, 0x8,  0x0,  0x13, 0xc3, 0xac, 0x99, 0xd1, 0x7c, 0x99, 0x12,
      0x4b, 0x8a, 0xe6, 0x79, 0xfa, 0x0,  0xbd, 0x6,  0x56, 0x15, 0x6e, 0x21, 0x16, 0x0,  0x13, 0x51, 0x35, 0xb6, 0x71,
      0x8c, 0x10, 0x75, 0x99, 0xa4, 0x61, 0x95, 0x9d, 0x3f, 0x3e, 0x5d, 0x44, 0xc3, 0x8e, 0x11, 0x1a, 0x0,  0x5,  0x39,
      0x8b, 0xe8, 0xe4, 0x19, 0x12, 0x0,  0x5,  0x33, 0xbd, 0x77, 0x3d, 0x1b, 0x29, 0x13, 0x15, 0x0,  0x1d, 0xae, 0xeb,
      0x42, 0xc8, 0x93, 0x91, 0xc0, 0x9c, 0x42, 0x1,  0x56, 0xe4, 0x60, 0xb6, 0xf5, 0xd9, 0xe9, 0xa5, 0x8a, 0x63, 0xbe,
      0x1d, 0x11, 0x75, 0x9d, 0x4b, 0xbb, 0xea, 0xcf, 0x11, 0x0,  0x0,  0x41, 0x49, 0x1a, 0x0,  0x11, 0x4d, 0xc2, 0x97,
      0x64, 0xa3, 0xb6, 0x4,  0x2e, 0xd0, 0x6,  0xb7, 0x39, 0x9f, 0x5d, 0x33, 0x3a, 0xbb, 0x2a, 0x90, 0x22, 0x2b, 0x6e,
      0x16, 0x0,  0xe,  0xc,  0x19, 0x7f, 0x9b, 0xa7, 0xec, 0x3b, 0x2d, 0x4a, 0x5e, 0x7e, 0x6e, 0x5f, 0xa2, 0xfc, 0x2,
      0xd4, 0x8b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x11, 0x9d, 0xa,  0x73, 0x3,  0x30, 0x3f, 0x82, 0x2c, 0x99, 0x35, 0x28,
                               0x19, 0x15, 0xeb, 0x74, 0x67, 0x2f, 0xdf, 0x63, 0x7a, 0xd7, 0xbc, 0x6c};
  lwmqtt_string_t exp_topic = {24, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfc, 0x2, 0xd4, 0x8b};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 23951);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 24);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "2]\237\233\224\238", _pubPktID =
// 32430, _pubBody = "\\7\a}d\f\191)\250N\n\r\240\169\178\184]", _pubProps = [PropResponseInformation
// "",PropMessageExpiryInterval 21151,PropMessageExpiryInterval 151,PropReasonString
// "\230\215Z\157U\190\241f\174\150{\183\NAK\239\204\n\150\183\128AV\144\n",PropMaximumPacketSize
// 11185,PropMaximumPacketSize 25334,PropSubscriptionIdentifierAvailable 124,PropReceiveMaximum
// 12433,PropCorrelationData "G\192\206\131\145\SOH\255>\211&\136\161$!`^G",PropServerKeepAlive
// 19132,PropServerReference "q\RS\RSB\\\204\182\165",PropRetainAvailable 93,PropServerKeepAlive 1218,PropMaximumQoS
// 66,PropPayloadFormatIndicator 228,PropResponseInformation
// "\138[\247\246\166\GS\CANx\RS\188",PropAssignedClientIdentifier
// "\229\203\GS\146I\202t\182\230%\238O\DC1\237\222\219\175\213VT\186\154\DC3d\251\138A\SI",PropMaximumQoS
// 44,PropMessageExpiryInterval 8113,PropMaximumQoS 61,PropRequestResponseInformation
// 120,PropSubscriptionIdentifierAvailable 168,PropReceiveMaximum 6126,PropResponseInformation
// "?g%\180\ETB0\226\191W\198!K\175\f\240\159\186W\210\166L\188\SYN\136\EM\199\229\&9",PropPayloadFormatIndicator
// 19,PropMaximumQoS 97]}
TEST(Publish5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x35, 0xdd, 0x1,  0x0,  0x6,  0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee, 0x7e, 0xae, 0xc0, 0x1,  0x1a, 0x0,  0x0,  0x2,
      0x0,  0x0,  0x52, 0x9f, 0x2,  0x0,  0x0,  0x0,  0x97, 0x1f, 0x0,  0x17, 0xe6, 0xd7, 0x5a, 0x9d, 0x55, 0xbe, 0xf1,
      0x66, 0xae, 0x96, 0x7b, 0xb7, 0x15, 0xef, 0xcc, 0xa,  0x96, 0xb7, 0x80, 0x41, 0x56, 0x90, 0xa,  0x27, 0x0,  0x0,
      0x2b, 0xb1, 0x27, 0x0,  0x0,  0x62, 0xf6, 0x29, 0x7c, 0x21, 0x30, 0x91, 0x9,  0x0,  0x11, 0x47, 0xc0, 0xce, 0x83,
      0x91, 0x1,  0xff, 0x3e, 0xd3, 0x26, 0x88, 0xa1, 0x24, 0x21, 0x60, 0x5e, 0x47, 0x13, 0x4a, 0xbc, 0x1c, 0x0,  0x8,
      0x71, 0x1e, 0x1e, 0x42, 0x5c, 0xcc, 0xb6, 0xa5, 0x25, 0x5d, 0x13, 0x4,  0xc2, 0x24, 0x42, 0x1,  0xe4, 0x1a, 0x0,
      0xa,  0x8a, 0x5b, 0xf7, 0xf6, 0xa6, 0x1d, 0x18, 0x78, 0x1e, 0xbc, 0x12, 0x0,  0x1c, 0xe5, 0xcb, 0x1d, 0x92, 0x49,
      0xca, 0x74, 0xb6, 0xe6, 0x25, 0xee, 0x4f, 0x11, 0xed, 0xde, 0xdb, 0xaf, 0xd5, 0x56, 0x54, 0xba, 0x9a, 0x13, 0x64,
      0xfb, 0x8a, 0x41, 0xf,  0x24, 0x2c, 0x2,  0x0,  0x0,  0x1f, 0xb1, 0x24, 0x3d, 0x19, 0x78, 0x29, 0xa8, 0x21, 0x17,
      0xee, 0x1a, 0x0,  0x1c, 0x3f, 0x67, 0x25, 0xb4, 0x17, 0x30, 0xe2, 0xbf, 0x57, 0xc6, 0x21, 0x4b, 0xaf, 0xc,  0xf0,
      0x9f, 0xba, 0x57, 0xd2, 0xa6, 0x4c, 0xbc, 0x16, 0x88, 0x19, 0xc7, 0xe5, 0x39, 0x1,  0x13, 0x24, 0x61, 0x5c, 0x37,
      0x7,  0x7d, 0x64, 0xc,  0xbf, 0x29, 0xfa, 0x4e, 0xa,  0xd,  0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  uint8_t topic_bytes[] = {0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee};
  lwmqtt_string_t topic = {6, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x5c, 0x37, 0x7, 0x7d, 0x64, 0xc,  0xbf, 0x29, 0xfa,
                         0x4e, 0xa,  0xd, 0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 17;

  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0xe6, 0xd7, 0x5a, 0x9d, 0x55, 0xbe, 0xf1, 0x66, 0xae, 0x96, 0x7b, 0xb7,
                           0x15, 0xef, 0xcc, 0xa,  0x96, 0xb7, 0x80, 0x41, 0x56, 0x90, 0xa};
  uint8_t bytesprops2[] = {0x47, 0xc0, 0xce, 0x83, 0x91, 0x1,  0xff, 0x3e, 0xd3,
                           0x26, 0x88, 0xa1, 0x24, 0x21, 0x60, 0x5e, 0x47};
  uint8_t bytesprops3[] = {0x71, 0x1e, 0x1e, 0x42, 0x5c, 0xcc, 0xb6, 0xa5};
  uint8_t bytesprops4[] = {0x8a, 0x5b, 0xf7, 0xf6, 0xa6, 0x1d, 0x18, 0x78, 0x1e, 0xbc};
  uint8_t bytesprops5[] = {0xe5, 0xcb, 0x1d, 0x92, 0x49, 0xca, 0x74, 0xb6, 0xe6, 0x25, 0xee, 0x4f, 0x11, 0xed,
                           0xde, 0xdb, 0xaf, 0xd5, 0x56, 0x54, 0xba, 0x9a, 0x13, 0x64, 0xfb, 0x8a, 0x41, 0xf};
  uint8_t bytesprops6[] = {0x3f, 0x67, 0x25, 0xb4, 0x17, 0x30, 0xe2, 0xbf, 0x57, 0xc6, 0x21, 0x4b, 0xaf, 0xc,
                           0xf0, 0x9f, 0xba, 0x57, 0xd2, 0xa6, 0x4c, 0xbc, 0x16, 0x88, 0x19, 0xc7, 0xe5, 0x39};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21151}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 151}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11185}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25334}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12433}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19132}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1218}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 228}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8113}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6126}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 97}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 32430, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "2]\237\233\224\238", _pubPktID =
// 32430, _pubBody = "\\7\a}d\f\191)\250N\n\r\240\169\178\184]", _pubProps = [PropResponseInformation
// "",PropMessageExpiryInterval 21151,PropMessageExpiryInterval 151,PropReasonString
// "\230\215Z\157U\190\241f\174\150{\183\NAK\239\204\n\150\183\128AV\144\n",PropMaximumPacketSize
// 11185,PropMaximumPacketSize 25334,PropSubscriptionIdentifierAvailable 124,PropReceiveMaximum
// 12433,PropCorrelationData "G\192\206\131\145\SOH\255>\211&\136\161$!`^G",PropServerKeepAlive
// 19132,PropServerReference "q\RS\RSB\\\204\182\165",PropRetainAvailable 93,PropServerKeepAlive 1218,PropMaximumQoS
// 66,PropPayloadFormatIndicator 228,PropResponseInformation
// "\138[\247\246\166\GS\CANx\RS\188",PropAssignedClientIdentifier
// "\229\203\GS\146I\202t\182\230%\238O\DC1\237\222\219\175\213VT\186\154\DC3d\251\138A\SI",PropMaximumQoS
// 44,PropMessageExpiryInterval 8113,PropMaximumQoS 61,PropRequestResponseInformation
// 120,PropSubscriptionIdentifierAvailable 168,PropReceiveMaximum 6126,PropResponseInformation
// "?g%\180\ETB0\226\191W\198!K\175\f\240\159\186W\210\166L\188\SYN\136\EM\199\229\&9",PropPayloadFormatIndicator
// 19,PropMaximumQoS 97]}
TEST(Publish5QCTest, Decode4) {
  uint8_t pkt[] = {
      0x35, 0xdd, 0x1,  0x0,  0x6,  0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee, 0x7e, 0xae, 0xc0, 0x1,  0x1a, 0x0,  0x0,  0x2,
      0x0,  0x0,  0x52, 0x9f, 0x2,  0x0,  0x0,  0x0,  0x97, 0x1f, 0x0,  0x17, 0xe6, 0xd7, 0x5a, 0x9d, 0x55, 0xbe, 0xf1,
      0x66, 0xae, 0x96, 0x7b, 0xb7, 0x15, 0xef, 0xcc, 0xa,  0x96, 0xb7, 0x80, 0x41, 0x56, 0x90, 0xa,  0x27, 0x0,  0x0,
      0x2b, 0xb1, 0x27, 0x0,  0x0,  0x62, 0xf6, 0x29, 0x7c, 0x21, 0x30, 0x91, 0x9,  0x0,  0x11, 0x47, 0xc0, 0xce, 0x83,
      0x91, 0x1,  0xff, 0x3e, 0xd3, 0x26, 0x88, 0xa1, 0x24, 0x21, 0x60, 0x5e, 0x47, 0x13, 0x4a, 0xbc, 0x1c, 0x0,  0x8,
      0x71, 0x1e, 0x1e, 0x42, 0x5c, 0xcc, 0xb6, 0xa5, 0x25, 0x5d, 0x13, 0x4,  0xc2, 0x24, 0x42, 0x1,  0xe4, 0x1a, 0x0,
      0xa,  0x8a, 0x5b, 0xf7, 0xf6, 0xa6, 0x1d, 0x18, 0x78, 0x1e, 0xbc, 0x12, 0x0,  0x1c, 0xe5, 0xcb, 0x1d, 0x92, 0x49,
      0xca, 0x74, 0xb6, 0xe6, 0x25, 0xee, 0x4f, 0x11, 0xed, 0xde, 0xdb, 0xaf, 0xd5, 0x56, 0x54, 0xba, 0x9a, 0x13, 0x64,
      0xfb, 0x8a, 0x41, 0xf,  0x24, 0x2c, 0x2,  0x0,  0x0,  0x1f, 0xb1, 0x24, 0x3d, 0x19, 0x78, 0x29, 0xa8, 0x21, 0x17,
      0xee, 0x1a, 0x0,  0x1c, 0x3f, 0x67, 0x25, 0xb4, 0x17, 0x30, 0xe2, 0xbf, 0x57, 0xc6, 0x21, 0x4b, 0xaf, 0xc,  0xf0,
      0x9f, 0xba, 0x57, 0xd2, 0xa6, 0x4c, 0xbc, 0x16, 0x88, 0x19, 0xc7, 0xe5, 0x39, 0x1,  0x13, 0x24, 0x61, 0x5c, 0x37,
      0x7,  0x7d, 0x64, 0xc,  0xbf, 0x29, 0xfa, 0x4e, 0xa,  0xd,  0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x32, 0x5d, 0xed, 0xe9, 0xe0, 0xee};
  lwmqtt_string_t exp_topic = {6, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x5c, 0x37, 0x7, 0x7d, 0x64, 0xc,  0xbf, 0x29, 0xfa,
                              0x4e, 0xa,  0xd, 0xf0, 0xa9, 0xb2, 0xb8, 0x5d};
  lwmqtt_string_t exp_body = {17, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 32430);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 6);
  EXPECT_EQ(msg.payload_len, 17);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 17);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "V\156\142\176", _pubPktID = 29213,
// _pubBody = "\EM\FSK\190t\254o\168\200\&9\131(\254Z\138g\243jL|\137\220", _pubProps = [PropMaximumPacketSize
// 3871,PropMaximumQoS 160,PropMessageExpiryInterval 10386,PropRequestResponseInformation
// 71,PropRequestProblemInformation 55,PropRetainAvailable 35,PropReceiveMaximum 27736,PropMessageExpiryInterval
// 15681,PropMaximumQoS 67,PropAuthenticationData "{jG\fFZ\241\EM\239G\254",PropResponseInformation
// "TW\FS{r\"\SI\182\168\b\182X\154\207@\195\192\248\&92\185>\DC3`\243\SYN",PropReasonString
// "\139\171\245\232",PropMessageExpiryInterval 15064,PropPayloadFormatIndicator 3,PropRequestProblemInformation
// 14,PropSubscriptionIdentifierAvailable 35,PropWillDelayInterval 5426,PropRequestProblemInformation
// 178,PropContentType "\136\206\198#c\DEL\219",PropResponseInformation "3\n",PropRetainAvailable 192,PropTopicAlias
// 19843,PropMaximumPacketSize 12373,PropRetainAvailable 239,PropContentType
// "!\164\212\179e\SO$\195nqq\153a\252\246\234\194\245\188",PropResponseTopic "\152",PropWillDelayInterval
// 22627,PropRequestResponseInformation 4]}
TEST(Publish5QCTest, Encode5) {
  uint8_t pkt[] = {0x35, 0xbc, 0x1,  0x0,  0x4,  0x56, 0x9c, 0x8e, 0xb0, 0x72, 0x1d, 0x9c, 0x1,  0x27, 0x0,  0x0,
                   0xf,  0x1f, 0x24, 0xa0, 0x2,  0x0,  0x0,  0x28, 0x92, 0x19, 0x47, 0x17, 0x37, 0x25, 0x23, 0x21,
                   0x6c, 0x58, 0x2,  0x0,  0x0,  0x3d, 0x41, 0x24, 0x43, 0x16, 0x0,  0xb,  0x7b, 0x6a, 0x47, 0xc,
                   0x46, 0x5a, 0xf1, 0x19, 0xef, 0x47, 0xfe, 0x1a, 0x0,  0x1a, 0x54, 0x57, 0x1c, 0x7b, 0x72, 0x22,
                   0xf,  0xb6, 0xa8, 0x8,  0xb6, 0x58, 0x9a, 0xcf, 0x40, 0xc3, 0xc0, 0xf8, 0x39, 0x32, 0xb9, 0x3e,
                   0x13, 0x60, 0xf3, 0x16, 0x1f, 0x0,  0x4,  0x8b, 0xab, 0xf5, 0xe8, 0x2,  0x0,  0x0,  0x3a, 0xd8,
                   0x1,  0x3,  0x17, 0xe,  0x29, 0x23, 0x18, 0x0,  0x0,  0x15, 0x32, 0x17, 0xb2, 0x3,  0x0,  0x7,
                   0x88, 0xce, 0xc6, 0x23, 0x63, 0x7f, 0xdb, 0x1a, 0x0,  0x2,  0x33, 0xa,  0x25, 0xc0, 0x23, 0x4d,
                   0x83, 0x27, 0x0,  0x0,  0x30, 0x55, 0x25, 0xef, 0x3,  0x0,  0x13, 0x21, 0xa4, 0xd4, 0xb3, 0x65,
                   0xe,  0x24, 0xc3, 0x6e, 0x71, 0x71, 0x99, 0x61, 0xfc, 0xf6, 0xea, 0xc2, 0xf5, 0xbc, 0x8,  0x0,
                   0x1,  0x98, 0x18, 0x0,  0x0,  0x58, 0x63, 0x19, 0x4,  0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe, 0x6f,
                   0xa8, 0xc8, 0x39, 0x83, 0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  uint8_t topic_bytes[] = {0x56, 0x9c, 0x8e, 0xb0};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe, 0x6f, 0xa8, 0xc8, 0x39, 0x83,
                         0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0x7b, 0x6a, 0x47, 0xc, 0x46, 0x5a, 0xf1, 0x19, 0xef, 0x47, 0xfe};
  uint8_t bytesprops1[] = {0x54, 0x57, 0x1c, 0x7b, 0x72, 0x22, 0xf,  0xb6, 0xa8, 0x8,  0xb6, 0x58, 0x9a,
                           0xcf, 0x40, 0xc3, 0xc0, 0xf8, 0x39, 0x32, 0xb9, 0x3e, 0x13, 0x60, 0xf3, 0x16};
  uint8_t bytesprops2[] = {0x8b, 0xab, 0xf5, 0xe8};
  uint8_t bytesprops3[] = {0x88, 0xce, 0xc6, 0x23, 0x63, 0x7f, 0xdb};
  uint8_t bytesprops4[] = {0x33, 0xa};
  uint8_t bytesprops5[] = {0x21, 0xa4, 0xd4, 0xb3, 0x65, 0xe,  0x24, 0xc3, 0x6e, 0x71,
                           0x71, 0x99, 0x61, 0xfc, 0xf6, 0xea, 0xc2, 0xf5, 0xbc};
  uint8_t bytesprops6[] = {0x98};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3871}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10386}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27736}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15681}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15064}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5426}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19843}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 12373}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22627}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 4}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 29213, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "V\156\142\176", _pubPktID = 29213,
// _pubBody = "\EM\FSK\190t\254o\168\200\&9\131(\254Z\138g\243jL|\137\220", _pubProps = [PropMaximumPacketSize
// 3871,PropMaximumQoS 160,PropMessageExpiryInterval 10386,PropRequestResponseInformation
// 71,PropRequestProblemInformation 55,PropRetainAvailable 35,PropReceiveMaximum 27736,PropMessageExpiryInterval
// 15681,PropMaximumQoS 67,PropAuthenticationData "{jG\fFZ\241\EM\239G\254",PropResponseInformation
// "TW\FS{r\"\SI\182\168\b\182X\154\207@\195\192\248\&92\185>\DC3`\243\SYN",PropReasonString
// "\139\171\245\232",PropMessageExpiryInterval 15064,PropPayloadFormatIndicator 3,PropRequestProblemInformation
// 14,PropSubscriptionIdentifierAvailable 35,PropWillDelayInterval 5426,PropRequestProblemInformation
// 178,PropContentType "\136\206\198#c\DEL\219",PropResponseInformation "3\n",PropRetainAvailable 192,PropTopicAlias
// 19843,PropMaximumPacketSize 12373,PropRetainAvailable 239,PropContentType
// "!\164\212\179e\SO$\195nqq\153a\252\246\234\194\245\188",PropResponseTopic "\152",PropWillDelayInterval
// 22627,PropRequestResponseInformation 4]}
TEST(Publish5QCTest, Decode5) {
  uint8_t pkt[] = {0x35, 0xbc, 0x1,  0x0,  0x4,  0x56, 0x9c, 0x8e, 0xb0, 0x72, 0x1d, 0x9c, 0x1,  0x27, 0x0,  0x0,
                   0xf,  0x1f, 0x24, 0xa0, 0x2,  0x0,  0x0,  0x28, 0x92, 0x19, 0x47, 0x17, 0x37, 0x25, 0x23, 0x21,
                   0x6c, 0x58, 0x2,  0x0,  0x0,  0x3d, 0x41, 0x24, 0x43, 0x16, 0x0,  0xb,  0x7b, 0x6a, 0x47, 0xc,
                   0x46, 0x5a, 0xf1, 0x19, 0xef, 0x47, 0xfe, 0x1a, 0x0,  0x1a, 0x54, 0x57, 0x1c, 0x7b, 0x72, 0x22,
                   0xf,  0xb6, 0xa8, 0x8,  0xb6, 0x58, 0x9a, 0xcf, 0x40, 0xc3, 0xc0, 0xf8, 0x39, 0x32, 0xb9, 0x3e,
                   0x13, 0x60, 0xf3, 0x16, 0x1f, 0x0,  0x4,  0x8b, 0xab, 0xf5, 0xe8, 0x2,  0x0,  0x0,  0x3a, 0xd8,
                   0x1,  0x3,  0x17, 0xe,  0x29, 0x23, 0x18, 0x0,  0x0,  0x15, 0x32, 0x17, 0xb2, 0x3,  0x0,  0x7,
                   0x88, 0xce, 0xc6, 0x23, 0x63, 0x7f, 0xdb, 0x1a, 0x0,  0x2,  0x33, 0xa,  0x25, 0xc0, 0x23, 0x4d,
                   0x83, 0x27, 0x0,  0x0,  0x30, 0x55, 0x25, 0xef, 0x3,  0x0,  0x13, 0x21, 0xa4, 0xd4, 0xb3, 0x65,
                   0xe,  0x24, 0xc3, 0x6e, 0x71, 0x71, 0x99, 0x61, 0xfc, 0xf6, 0xea, 0xc2, 0xf5, 0xbc, 0x8,  0x0,
                   0x1,  0x98, 0x18, 0x0,  0x0,  0x58, 0x63, 0x19, 0x4,  0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe, 0x6f,
                   0xa8, 0xc8, 0x39, 0x83, 0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x56, 0x9c, 0x8e, 0xb0};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x19, 0x1c, 0x4b, 0xbe, 0x74, 0xfe, 0x6f, 0xa8, 0xc8, 0x39, 0x83,
                              0x28, 0xfe, 0x5a, 0x8a, 0x67, 0xf3, 0x6a, 0x4c, 0x7c, 0x89, 0xdc};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 29213);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "j-w\135im\135", _pubPktID = 15185,
// _pubBody = "\178\183W\163D\179", _pubProps = [PropResponseTopic
// "\FS\n\NULY#r\132\&4\DEL%\206{/7V=\ETB\195W\192,\229\135\162\ETB\250\175\194\170",PropServerKeepAlive
// 4458,PropSharedSubscriptionAvailable 33,PropSessionExpiryInterval 14022,PropSubscriptionIdentifierAvailable
// 239,PropServerReference "\164\228\204[\165\224\229)\SYN66\195{\211\227u\EM\249",PropMessageExpiryInterval 808]}
TEST(Publish5QCTest, Encode6) {
  uint8_t pkt[] = {0x35, 0x58, 0x0,  0x7,  0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d, 0x87, 0x3b, 0x51, 0x46, 0x8,
                   0x0,  0x1d, 0x1c, 0xa,  0x0,  0x59, 0x23, 0x72, 0x84, 0x34, 0x7f, 0x25, 0xce, 0x7b, 0x2f,
                   0x37, 0x56, 0x3d, 0x17, 0xc3, 0x57, 0xc0, 0x2c, 0xe5, 0x87, 0xa2, 0x17, 0xfa, 0xaf, 0xc2,
                   0xaa, 0x13, 0x11, 0x6a, 0x2a, 0x21, 0x11, 0x0,  0x0,  0x36, 0xc6, 0x29, 0xef, 0x1c, 0x0,
                   0x12, 0xa4, 0xe4, 0xcc, 0x5b, 0xa5, 0xe0, 0xe5, 0x29, 0x16, 0x36, 0x36, 0xc3, 0x7b, 0xd3,
                   0xe3, 0x75, 0x19, 0xf9, 0x2,  0x0,  0x0,  0x3,  0x28, 0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  uint8_t topic_bytes[] = {0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d, 0x87};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 6;

  uint8_t bytesprops0[] = {0x1c, 0xa,  0x0,  0x59, 0x23, 0x72, 0x84, 0x34, 0x7f, 0x25, 0xce, 0x7b, 0x2f, 0x37, 0x56,
                           0x3d, 0x17, 0xc3, 0x57, 0xc0, 0x2c, 0xe5, 0x87, 0xa2, 0x17, 0xfa, 0xaf, 0xc2, 0xaa};
  uint8_t bytesprops1[] = {0xa4, 0xe4, 0xcc, 0x5b, 0xa5, 0xe0, 0xe5, 0x29, 0x16,
                           0x36, 0x36, 0xc3, 0x7b, 0xd3, 0xe3, 0x75, 0x19, 0xf9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4458}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 33}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14022}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 808}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 15185, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "j-w\135im\135", _pubPktID = 15185,
// _pubBody = "\178\183W\163D\179", _pubProps = [PropResponseTopic
// "\FS\n\NULY#r\132\&4\DEL%\206{/7V=\ETB\195W\192,\229\135\162\ETB\250\175\194\170",PropServerKeepAlive
// 4458,PropSharedSubscriptionAvailable 33,PropSessionExpiryInterval 14022,PropSubscriptionIdentifierAvailable
// 239,PropServerReference "\164\228\204[\165\224\229)\SYN66\195{\211\227u\EM\249",PropMessageExpiryInterval 808]}
TEST(Publish5QCTest, Decode6) {
  uint8_t pkt[] = {0x35, 0x58, 0x0,  0x7,  0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d, 0x87, 0x3b, 0x51, 0x46, 0x8,
                   0x0,  0x1d, 0x1c, 0xa,  0x0,  0x59, 0x23, 0x72, 0x84, 0x34, 0x7f, 0x25, 0xce, 0x7b, 0x2f,
                   0x37, 0x56, 0x3d, 0x17, 0xc3, 0x57, 0xc0, 0x2c, 0xe5, 0x87, 0xa2, 0x17, 0xfa, 0xaf, 0xc2,
                   0xaa, 0x13, 0x11, 0x6a, 0x2a, 0x21, 0x11, 0x0,  0x0,  0x36, 0xc6, 0x29, 0xef, 0x1c, 0x0,
                   0x12, 0xa4, 0xe4, 0xcc, 0x5b, 0xa5, 0xe0, 0xe5, 0x29, 0x16, 0x36, 0x36, 0xc3, 0x7b, 0xd3,
                   0xe3, 0x75, 0x19, 0xf9, 0x2,  0x0,  0x0,  0x3,  0x28, 0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x6a, 0x2d, 0x77, 0x87, 0x69, 0x6d, 0x87};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xb2, 0xb7, 0x57, 0xa3, 0x44, 0xb3};
  lwmqtt_string_t exp_body = {6, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 15185);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 6);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 6);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\129\166\ACK\241", _pubPktID = 26446,
// _pubBody = "h'uL\n\225\221gp\182{\140\DC4\136\151c\170\191\r|\214\197\&7", _pubProps = [PropPayloadFormatIndicator
// 170,PropCorrelationData "&Gz\228\136\t\SUBx!V_@\228",PropAuthenticationMethod "\161e",PropRetainAvailable
// 105,PropMessageExpiryInterval 22688]}
TEST(Publish5QCTest, Encode7) {
  uint8_t pkt[] = {0x3d, 0x3e, 0x0,  0x4,  0x81, 0xa6, 0x6,  0xf1, 0x67, 0x4e, 0x1e, 0x1,  0xaa, 0x9,  0x0,  0xd,
                   0x26, 0x47, 0x7a, 0xe4, 0x88, 0x9,  0x1a, 0x78, 0x21, 0x56, 0x5f, 0x40, 0xe4, 0x15, 0x0,  0x2,
                   0xa1, 0x65, 0x25, 0x69, 0x2,  0x0,  0x0,  0x58, 0xa0, 0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd,
                   0x67, 0x70, 0xb6, 0x7b, 0x8c, 0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  uint8_t topic_bytes[] = {0x81, 0xa6, 0x6, 0xf1};
  lwmqtt_string_t topic = {4, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd, 0x67, 0x70, 0xb6, 0x7b, 0x8c,
                         0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 23;

  uint8_t bytesprops0[] = {0x26, 0x47, 0x7a, 0xe4, 0x88, 0x9, 0x1a, 0x78, 0x21, 0x56, 0x5f, 0x40, 0xe4};
  uint8_t bytesprops1[] = {0xa1, 0x65};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22688}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 26446, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\129\166\ACK\241", _pubPktID = 26446,
// _pubBody = "h'uL\n\225\221gp\182{\140\DC4\136\151c\170\191\r|\214\197\&7", _pubProps = [PropPayloadFormatIndicator
// 170,PropCorrelationData "&Gz\228\136\t\SUBx!V_@\228",PropAuthenticationMethod "\161e",PropRetainAvailable
// 105,PropMessageExpiryInterval 22688]}
TEST(Publish5QCTest, Decode7) {
  uint8_t pkt[] = {0x3d, 0x3e, 0x0,  0x4,  0x81, 0xa6, 0x6,  0xf1, 0x67, 0x4e, 0x1e, 0x1,  0xaa, 0x9,  0x0,  0xd,
                   0x26, 0x47, 0x7a, 0xe4, 0x88, 0x9,  0x1a, 0x78, 0x21, 0x56, 0x5f, 0x40, 0xe4, 0x15, 0x0,  0x2,
                   0xa1, 0x65, 0x25, 0x69, 0x2,  0x0,  0x0,  0x58, 0xa0, 0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd,
                   0x67, 0x70, 0xb6, 0x7b, 0x8c, 0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x81, 0xa6, 0x6, 0xf1};
  lwmqtt_string_t exp_topic = {4, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x68, 0x27, 0x75, 0x4c, 0xa,  0xe1, 0xdd, 0x67, 0x70, 0xb6, 0x7b, 0x8c,
                              0x14, 0x88, 0x97, 0x63, 0xaa, 0xbf, 0xd,  0x7c, 0xd6, 0xc5, 0x37};
  lwmqtt_string_t exp_body = {23, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 26446);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 4);
  EXPECT_EQ(msg.payload_len, 23);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 23);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}\250\132\234S\200EV\164\175\218\237D", _pubPktID = 25658, _pubBody =
// "\DLE\DC3\242\235C\134\216h\196\ETB\255\169\164\222", _pubProps = [PropResponseTopic
// "\164\ETX\255\SYN\169a\EM\237\135\219?\183(\DLE2i\254\191?s\217\SI\229\243&\130",PropMessageExpiryInterval
// 16431,PropReasonString "\218\232\&8_\216\202'@\227\ACK|\252\NUL\ACK\235",PropRetainAvailable
// 227,PropSessionExpiryInterval 1125,PropCorrelationData
// "\188\180-\146\252\250Y\134|\255\169\224\228\226\&8\169\195\229o",PropServerKeepAlive 31922,PropReceiveMaximum
// 13953,PropResponseTopic "*}",PropReceiveMaximum 10205,PropRequestProblemInformation
// 46,PropWildcardSubscriptionAvailable 199,PropServerKeepAlive 17597,PropMaximumQoS 236,PropServerReference
// "\ENQI\177\187%LN\EM,\168d\215\245\220\170\203\247\DC2~E\SI\139\ACK\RS\189d\183;9",PropRetainAvailable
// 170,PropPayloadFormatIndicator 164,PropServerKeepAlive 13334,PropServerKeepAlive 20469,PropRequestResponseInformation
// 170,PropServerKeepAlive 964,PropSharedSubscriptionAvailable 117,PropAssignedClientIdentifier
// "\244=\"\141i\204\DC1\ENQ\r\DLE\ESC\rqV\251\DC1\188\213i\148q",PropTopicAliasMaximum 28761]}
TEST(Publish5QCTest, Encode8) {
  uint8_t pkt[] = {0x3d, 0xd5, 0x1,  0x0,  0xd,  0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed,
                   0x44, 0x64, 0x3a, 0xb4, 0x1,  0x8,  0x0,  0x1a, 0xa4, 0x3,  0xff, 0x16, 0xa9, 0x61, 0x19, 0xed, 0x87,
                   0xdb, 0x3f, 0xb7, 0x28, 0x10, 0x32, 0x69, 0xfe, 0xbf, 0x3f, 0x73, 0xd9, 0xf,  0xe5, 0xf3, 0x26, 0x82,
                   0x2,  0x0,  0x0,  0x40, 0x2f, 0x1f, 0x0,  0xf,  0xda, 0xe8, 0x38, 0x5f, 0xd8, 0xca, 0x27, 0x40, 0xe3,
                   0x6,  0x7c, 0xfc, 0x0,  0x6,  0xeb, 0x25, 0xe3, 0x11, 0x0,  0x0,  0x4,  0x65, 0x9,  0x0,  0x13, 0xbc,
                   0xb4, 0x2d, 0x92, 0xfc, 0xfa, 0x59, 0x86, 0x7c, 0xff, 0xa9, 0xe0, 0xe4, 0xe2, 0x38, 0xa9, 0xc3, 0xe5,
                   0x6f, 0x13, 0x7c, 0xb2, 0x21, 0x36, 0x81, 0x8,  0x0,  0x2,  0x2a, 0x7d, 0x21, 0x27, 0xdd, 0x17, 0x2e,
                   0x28, 0xc7, 0x13, 0x44, 0xbd, 0x24, 0xec, 0x1c, 0x0,  0x1d, 0x5,  0x49, 0xb1, 0xbb, 0x25, 0x4c, 0x4e,
                   0x19, 0x2c, 0xa8, 0x64, 0xd7, 0xf5, 0xdc, 0xaa, 0xcb, 0xf7, 0x12, 0x7e, 0x45, 0xf,  0x8b, 0x6,  0x1e,
                   0xbd, 0x64, 0xb7, 0x3b, 0x39, 0x25, 0xaa, 0x1,  0xa4, 0x13, 0x34, 0x16, 0x13, 0x4f, 0xf5, 0x19, 0xaa,
                   0x13, 0x3,  0xc4, 0x2a, 0x75, 0x12, 0x0,  0x15, 0xf4, 0x3d, 0x22, 0x8d, 0x69, 0xcc, 0x11, 0x5,  0xd,
                   0x10, 0x1b, 0xd,  0x71, 0x56, 0xfb, 0x11, 0xbc, 0xd5, 0x69, 0x94, 0x71, 0x22, 0x70, 0x59, 0x10, 0x13,
                   0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  uint8_t topic_bytes[] = {0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed, 0x44};
  lwmqtt_string_t topic = {13, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x10, 0x13, 0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops0[] = {0xa4, 0x3,  0xff, 0x16, 0xa9, 0x61, 0x19, 0xed, 0x87, 0xdb, 0x3f, 0xb7, 0x28,
                           0x10, 0x32, 0x69, 0xfe, 0xbf, 0x3f, 0x73, 0xd9, 0xf,  0xe5, 0xf3, 0x26, 0x82};
  uint8_t bytesprops1[] = {0xda, 0xe8, 0x38, 0x5f, 0xd8, 0xca, 0x27, 0x40, 0xe3, 0x6, 0x7c, 0xfc, 0x0, 0x6, 0xeb};
  uint8_t bytesprops2[] = {0xbc, 0xb4, 0x2d, 0x92, 0xfc, 0xfa, 0x59, 0x86, 0x7c, 0xff,
                           0xa9, 0xe0, 0xe4, 0xe2, 0x38, 0xa9, 0xc3, 0xe5, 0x6f};
  uint8_t bytesprops3[] = {0x2a, 0x7d};
  uint8_t bytesprops4[] = {0x5,  0x49, 0xb1, 0xbb, 0x25, 0x4c, 0x4e, 0x19, 0x2c, 0xa8, 0x64, 0xd7, 0xf5, 0xdc, 0xaa,
                           0xcb, 0xf7, 0x12, 0x7e, 0x45, 0xf,  0x8b, 0x6,  0x1e, 0xbd, 0x64, 0xb7, 0x3b, 0x39};
  uint8_t bytesprops5[] = {0xf4, 0x3d, 0x22, 0x8d, 0x69, 0xcc, 0x11, 0x5,  0xd,  0x10, 0x1b,
                           0xd,  0x71, 0x56, 0xfb, 0x11, 0xbc, 0xd5, 0x69, 0x94, 0x71};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {26, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16431}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1125}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 31922}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 13953}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10205}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17597}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13334}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20469}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 170}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 964}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28761}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 25658, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "}\250\132\234S\200EV\164\175\218\237D", _pubPktID = 25658, _pubBody =
// "\DLE\DC3\242\235C\134\216h\196\ETB\255\169\164\222", _pubProps = [PropResponseTopic
// "\164\ETX\255\SYN\169a\EM\237\135\219?\183(\DLE2i\254\191?s\217\SI\229\243&\130",PropMessageExpiryInterval
// 16431,PropReasonString "\218\232\&8_\216\202'@\227\ACK|\252\NUL\ACK\235",PropRetainAvailable
// 227,PropSessionExpiryInterval 1125,PropCorrelationData
// "\188\180-\146\252\250Y\134|\255\169\224\228\226\&8\169\195\229o",PropServerKeepAlive 31922,PropReceiveMaximum
// 13953,PropResponseTopic "*}",PropReceiveMaximum 10205,PropRequestProblemInformation
// 46,PropWildcardSubscriptionAvailable 199,PropServerKeepAlive 17597,PropMaximumQoS 236,PropServerReference
// "\ENQI\177\187%LN\EM,\168d\215\245\220\170\203\247\DC2~E\SI\139\ACK\RS\189d\183;9",PropRetainAvailable
// 170,PropPayloadFormatIndicator 164,PropServerKeepAlive 13334,PropServerKeepAlive 20469,PropRequestResponseInformation
// 170,PropServerKeepAlive 964,PropSharedSubscriptionAvailable 117,PropAssignedClientIdentifier
// "\244=\"\141i\204\DC1\ENQ\r\DLE\ESC\rqV\251\DC1\188\213i\148q",PropTopicAliasMaximum 28761]}
TEST(Publish5QCTest, Decode8) {
  uint8_t pkt[] = {0x3d, 0xd5, 0x1,  0x0,  0xd,  0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed,
                   0x44, 0x64, 0x3a, 0xb4, 0x1,  0x8,  0x0,  0x1a, 0xa4, 0x3,  0xff, 0x16, 0xa9, 0x61, 0x19, 0xed, 0x87,
                   0xdb, 0x3f, 0xb7, 0x28, 0x10, 0x32, 0x69, 0xfe, 0xbf, 0x3f, 0x73, 0xd9, 0xf,  0xe5, 0xf3, 0x26, 0x82,
                   0x2,  0x0,  0x0,  0x40, 0x2f, 0x1f, 0x0,  0xf,  0xda, 0xe8, 0x38, 0x5f, 0xd8, 0xca, 0x27, 0x40, 0xe3,
                   0x6,  0x7c, 0xfc, 0x0,  0x6,  0xeb, 0x25, 0xe3, 0x11, 0x0,  0x0,  0x4,  0x65, 0x9,  0x0,  0x13, 0xbc,
                   0xb4, 0x2d, 0x92, 0xfc, 0xfa, 0x59, 0x86, 0x7c, 0xff, 0xa9, 0xe0, 0xe4, 0xe2, 0x38, 0xa9, 0xc3, 0xe5,
                   0x6f, 0x13, 0x7c, 0xb2, 0x21, 0x36, 0x81, 0x8,  0x0,  0x2,  0x2a, 0x7d, 0x21, 0x27, 0xdd, 0x17, 0x2e,
                   0x28, 0xc7, 0x13, 0x44, 0xbd, 0x24, 0xec, 0x1c, 0x0,  0x1d, 0x5,  0x49, 0xb1, 0xbb, 0x25, 0x4c, 0x4e,
                   0x19, 0x2c, 0xa8, 0x64, 0xd7, 0xf5, 0xdc, 0xaa, 0xcb, 0xf7, 0x12, 0x7e, 0x45, 0xf,  0x8b, 0x6,  0x1e,
                   0xbd, 0x64, 0xb7, 0x3b, 0x39, 0x25, 0xaa, 0x1,  0xa4, 0x13, 0x34, 0x16, 0x13, 0x4f, 0xf5, 0x19, 0xaa,
                   0x13, 0x3,  0xc4, 0x2a, 0x75, 0x12, 0x0,  0x15, 0xf4, 0x3d, 0x22, 0x8d, 0x69, 0xcc, 0x11, 0x5,  0xd,
                   0x10, 0x1b, 0xd,  0x71, 0x56, 0xfb, 0x11, 0xbc, 0xd5, 0x69, 0x94, 0x71, 0x22, 0x70, 0x59, 0x10, 0x13,
                   0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7d, 0xfa, 0x84, 0xea, 0x53, 0xc8, 0x45, 0x56, 0xa4, 0xaf, 0xda, 0xed, 0x44};
  lwmqtt_string_t exp_topic = {13, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x10, 0x13, 0xf2, 0xeb, 0x43, 0x86, 0xd8, 0x68, 0xc4, 0x17, 0xff, 0xa9, 0xa4, 0xde};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 25658);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 13);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB\EM\FSn\\^\219_\249\191\CAN\146\196\142\252x\187\173 \r\244[B\136h\210\180", _pubPktID = 12697, _pubBody =
// "\208\EOT\241", _pubProps = [PropResponseTopic "\195\162",PropResponseInformation "\184\204f\153",PropTopicAlias
// 10643,PropMaximumQoS 120,PropMessageExpiryInterval 15357,PropMessageExpiryInterval 24217,PropSubscriptionIdentifier
// 4,PropServerKeepAlive 10759,PropResponseTopic "N\153\&4\249$\156\145\144\176\&1}\r\254\202\227",PropRetainAvailable
// 246,PropAuthenticationData "\179w\r\235\190+",PropMessageExpiryInterval 27852,PropTopicAliasMaximum
// 11775,PropRetainAvailable 87,PropAssignedClientIdentifier "\233\211e6\244",PropSharedSubscriptionAvailable
// 174,PropResponseInformation "\140\216\225W\195\218\136;\SYN\CANX?\DC3\192",PropSessionExpiryInterval
// 27739,PropServerReference "\134\235\135P\n0d0\223^\163\253",PropSubscriptionIdentifierAvailable
// 158,PropServerReference "\251C",PropSessionExpiryInterval 4686,PropTopicAlias 31565,PropServerReference
// "l\133\fk\169\243\159",PropServerReference
// "u6\224\199\176\250\&3\US\213\215#\\K?\226A\249\&54\160",PropWillDelayInterval 196,PropTopicAlias 23560]}
TEST(Publish5QCTest, Encode9) {
  uint8_t pkt[] = {0x3c, 0xd2, 0x1,  0x0,  0x1b, 0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f, 0xf9, 0xbf, 0x18, 0x92,
                   0xc4, 0x8e, 0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,  0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4, 0x31, 0x99,
                   0xae, 0x1,  0x8,  0x0,  0x2,  0xc3, 0xa2, 0x1a, 0x0,  0x4,  0xb8, 0xcc, 0x66, 0x99, 0x23, 0x29, 0x93,
                   0x24, 0x78, 0x2,  0x0,  0x0,  0x3b, 0xfd, 0x2,  0x0,  0x0,  0x5e, 0x99, 0xb,  0x4,  0x13, 0x2a, 0x7,
                   0x8,  0x0,  0xf,  0x4e, 0x99, 0x34, 0xf9, 0x24, 0x9c, 0x91, 0x90, 0xb0, 0x31, 0x7d, 0xd,  0xfe, 0xca,
                   0xe3, 0x25, 0xf6, 0x16, 0x0,  0x6,  0xb3, 0x77, 0xd,  0xeb, 0xbe, 0x2b, 0x2,  0x0,  0x0,  0x6c, 0xcc,
                   0x22, 0x2d, 0xff, 0x25, 0x57, 0x12, 0x0,  0x5,  0xe9, 0xd3, 0x65, 0x36, 0xf4, 0x2a, 0xae, 0x1a, 0x0,
                   0xe,  0x8c, 0xd8, 0xe1, 0x57, 0xc3, 0xda, 0x88, 0x3b, 0x16, 0x18, 0x58, 0x3f, 0x13, 0xc0, 0x11, 0x0,
                   0x0,  0x6c, 0x5b, 0x1c, 0x0,  0xc,  0x86, 0xeb, 0x87, 0x50, 0xa,  0x30, 0x64, 0x30, 0xdf, 0x5e, 0xa3,
                   0xfd, 0x29, 0x9e, 0x1c, 0x0,  0x2,  0xfb, 0x43, 0x11, 0x0,  0x0,  0x12, 0x4e, 0x23, 0x7b, 0x4d, 0x1c,
                   0x0,  0x7,  0x6c, 0x85, 0xc,  0x6b, 0xa9, 0xf3, 0x9f, 0x1c, 0x0,  0x14, 0x75, 0x36, 0xe0, 0xc7, 0xb0,
                   0xfa, 0x33, 0x1f, 0xd5, 0xd7, 0x23, 0x5c, 0x4b, 0x3f, 0xe2, 0x41, 0xf9, 0x35, 0x34, 0xa0, 0x18, 0x0,
                   0x0,  0x0,  0xc4, 0x23, 0x5c, 0x8,  0xd0, 0x4,  0xf1};
  uint8_t topic_bytes[] = {0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f, 0xf9, 0xbf, 0x18, 0x92, 0xc4, 0x8e,
                           0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,  0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4};
  lwmqtt_string_t topic = {27, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xd0, 0x4, 0xf1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xc3, 0xa2};
  uint8_t bytesprops1[] = {0xb8, 0xcc, 0x66, 0x99};
  uint8_t bytesprops2[] = {0x4e, 0x99, 0x34, 0xf9, 0x24, 0x9c, 0x91, 0x90, 0xb0, 0x31, 0x7d, 0xd, 0xfe, 0xca, 0xe3};
  uint8_t bytesprops3[] = {0xb3, 0x77, 0xd, 0xeb, 0xbe, 0x2b};
  uint8_t bytesprops4[] = {0xe9, 0xd3, 0x65, 0x36, 0xf4};
  uint8_t bytesprops5[] = {0x8c, 0xd8, 0xe1, 0x57, 0xc3, 0xda, 0x88, 0x3b, 0x16, 0x18, 0x58, 0x3f, 0x13, 0xc0};
  uint8_t bytesprops6[] = {0x86, 0xeb, 0x87, 0x50, 0xa, 0x30, 0x64, 0x30, 0xdf, 0x5e, 0xa3, 0xfd};
  uint8_t bytesprops7[] = {0xfb, 0x43};
  uint8_t bytesprops8[] = {0x6c, 0x85, 0xc, 0x6b, 0xa9, 0xf3, 0x9f};
  uint8_t bytesprops9[] = {0x75, 0x36, 0xe0, 0xc7, 0xb0, 0xfa, 0x33, 0x1f, 0xd5, 0xd7,
                           0x23, 0x5c, 0x4b, 0x3f, 0xe2, 0x41, 0xf9, 0x35, 0x34, 0xa0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10643}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15357}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24217}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10759}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27852}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11775}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27739}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4686}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31565}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 196}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23560}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 12697, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// "\ETB\EM\FSn\\^\219_\249\191\CAN\146\196\142\252x\187\173 \r\244[B\136h\210\180", _pubPktID = 12697, _pubBody =
// "\208\EOT\241", _pubProps = [PropResponseTopic "\195\162",PropResponseInformation "\184\204f\153",PropTopicAlias
// 10643,PropMaximumQoS 120,PropMessageExpiryInterval 15357,PropMessageExpiryInterval 24217,PropSubscriptionIdentifier
// 4,PropServerKeepAlive 10759,PropResponseTopic "N\153\&4\249$\156\145\144\176\&1}\r\254\202\227",PropRetainAvailable
// 246,PropAuthenticationData "\179w\r\235\190+",PropMessageExpiryInterval 27852,PropTopicAliasMaximum
// 11775,PropRetainAvailable 87,PropAssignedClientIdentifier "\233\211e6\244",PropSharedSubscriptionAvailable
// 174,PropResponseInformation "\140\216\225W\195\218\136;\SYN\CANX?\DC3\192",PropSessionExpiryInterval
// 27739,PropServerReference "\134\235\135P\n0d0\223^\163\253",PropSubscriptionIdentifierAvailable
// 158,PropServerReference "\251C",PropSessionExpiryInterval 4686,PropTopicAlias 31565,PropServerReference
// "l\133\fk\169\243\159",PropServerReference
// "u6\224\199\176\250\&3\US\213\215#\\K?\226A\249\&54\160",PropWillDelayInterval 196,PropTopicAlias 23560]}
TEST(Publish5QCTest, Decode9) {
  uint8_t pkt[] = {0x3c, 0xd2, 0x1,  0x0,  0x1b, 0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f, 0xf9, 0xbf, 0x18, 0x92,
                   0xc4, 0x8e, 0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,  0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4, 0x31, 0x99,
                   0xae, 0x1,  0x8,  0x0,  0x2,  0xc3, 0xa2, 0x1a, 0x0,  0x4,  0xb8, 0xcc, 0x66, 0x99, 0x23, 0x29, 0x93,
                   0x24, 0x78, 0x2,  0x0,  0x0,  0x3b, 0xfd, 0x2,  0x0,  0x0,  0x5e, 0x99, 0xb,  0x4,  0x13, 0x2a, 0x7,
                   0x8,  0x0,  0xf,  0x4e, 0x99, 0x34, 0xf9, 0x24, 0x9c, 0x91, 0x90, 0xb0, 0x31, 0x7d, 0xd,  0xfe, 0xca,
                   0xe3, 0x25, 0xf6, 0x16, 0x0,  0x6,  0xb3, 0x77, 0xd,  0xeb, 0xbe, 0x2b, 0x2,  0x0,  0x0,  0x6c, 0xcc,
                   0x22, 0x2d, 0xff, 0x25, 0x57, 0x12, 0x0,  0x5,  0xe9, 0xd3, 0x65, 0x36, 0xf4, 0x2a, 0xae, 0x1a, 0x0,
                   0xe,  0x8c, 0xd8, 0xe1, 0x57, 0xc3, 0xda, 0x88, 0x3b, 0x16, 0x18, 0x58, 0x3f, 0x13, 0xc0, 0x11, 0x0,
                   0x0,  0x6c, 0x5b, 0x1c, 0x0,  0xc,  0x86, 0xeb, 0x87, 0x50, 0xa,  0x30, 0x64, 0x30, 0xdf, 0x5e, 0xa3,
                   0xfd, 0x29, 0x9e, 0x1c, 0x0,  0x2,  0xfb, 0x43, 0x11, 0x0,  0x0,  0x12, 0x4e, 0x23, 0x7b, 0x4d, 0x1c,
                   0x0,  0x7,  0x6c, 0x85, 0xc,  0x6b, 0xa9, 0xf3, 0x9f, 0x1c, 0x0,  0x14, 0x75, 0x36, 0xe0, 0xc7, 0xb0,
                   0xfa, 0x33, 0x1f, 0xd5, 0xd7, 0x23, 0x5c, 0x4b, 0x3f, 0xe2, 0x41, 0xf9, 0x35, 0x34, 0xa0, 0x18, 0x0,
                   0x0,  0x0,  0xc4, 0x23, 0x5c, 0x8,  0xd0, 0x4,  0xf1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x17, 0x19, 0x1c, 0x6e, 0x5c, 0x5e, 0xdb, 0x5f, 0xf9, 0xbf, 0x18, 0x92, 0xc4, 0x8e,
                               0xfc, 0x78, 0xbb, 0xad, 0x20, 0xd,  0xf4, 0x5b, 0x42, 0x88, 0x68, 0xd2, 0xb4};
  lwmqtt_string_t exp_topic = {27, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd0, 0x4, 0xf1};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 12697);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 27);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\207\219\241<a\196b\r", _pubPktID =
// 0, _pubBody = "\248\255\209\128s\169\179\245\203.\FS(\179o\ETXk\r'x\239\ETB=\189>q", _pubProps =
// [PropSubscriptionIdentifierAvailable 113,PropWildcardSubscriptionAvailable 183,PropMessageExpiryInterval
// 24354,PropUserProperty "_" "\161\176\217j4p\153b\n|g\167\240\158\212]#\248?R\143!g+",PropWillDelayInterval
// 5224,PropResponseTopic "\255\202\251-\151",PropSessionExpiryInterval 4220,PropResponseInformation
// "\DLE\FSh\SYN\155t\141!o\171\179V\CAN",PropResponseInformation
// "\239!Ny\178\DC1\219\198\tzKF<",PropSubscriptionIdentifierAvailable 135,PropTopicAlias 8349,PropMessageExpiryInterval
// 4033,PropRequestProblemInformation 65,PropWillDelayInterval 18806,PropAuthenticationMethod
// "\187\189\154i\169\SYN\128|\DC4X%\a\242v\204",PropWildcardSubscriptionAvailable 113]}
TEST(Publish5QCTest, Encode10) {
  uint8_t pkt[] = {0x39, 0xa2, 0x1,  0x0,  0x8,  0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd,  0x7e, 0x29, 0x71, 0x28,
                   0xb7, 0x2,  0x0,  0x0,  0x5f, 0x22, 0x26, 0x0,  0x1,  0x5f, 0x0,  0x18, 0xa1, 0xb0, 0xd9, 0x6a, 0x34,
                   0x70, 0x99, 0x62, 0xa,  0x7c, 0x67, 0xa7, 0xf0, 0x9e, 0xd4, 0x5d, 0x23, 0xf8, 0x3f, 0x52, 0x8f, 0x21,
                   0x67, 0x2b, 0x18, 0x0,  0x0,  0x14, 0x68, 0x8,  0x0,  0x5,  0xff, 0xca, 0xfb, 0x2d, 0x97, 0x11, 0x0,
                   0x0,  0x10, 0x7c, 0x1a, 0x0,  0xd,  0x10, 0x1c, 0x68, 0x16, 0x9b, 0x74, 0x8d, 0x21, 0x6f, 0xab, 0xb3,
                   0x56, 0x18, 0x1a, 0x0,  0xd,  0xef, 0x21, 0x4e, 0x79, 0xb2, 0x11, 0xdb, 0xc6, 0x9,  0x7a, 0x4b, 0x46,
                   0x3c, 0x29, 0x87, 0x23, 0x20, 0x9d, 0x2,  0x0,  0x0,  0xf,  0xc1, 0x17, 0x41, 0x18, 0x0,  0x0,  0x49,
                   0x76, 0x15, 0x0,  0xf,  0xbb, 0xbd, 0x9a, 0x69, 0xa9, 0x16, 0x80, 0x7c, 0x14, 0x58, 0x25, 0x7,  0xf2,
                   0x76, 0xcc, 0x28, 0x71, 0xf8, 0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3,
                   0x6f, 0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  uint8_t topic_bytes[] = {0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xf8, 0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3,
                         0x6f, 0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 25;

  uint8_t bytesprops1[] = {0xa1, 0xb0, 0xd9, 0x6a, 0x34, 0x70, 0x99, 0x62, 0xa,  0x7c, 0x67, 0xa7,
                           0xf0, 0x9e, 0xd4, 0x5d, 0x23, 0xf8, 0x3f, 0x52, 0x8f, 0x21, 0x67, 0x2b};
  uint8_t bytesprops0[] = {0x5f};
  uint8_t bytesprops2[] = {0xff, 0xca, 0xfb, 0x2d, 0x97};
  uint8_t bytesprops3[] = {0x10, 0x1c, 0x68, 0x16, 0x9b, 0x74, 0x8d, 0x21, 0x6f, 0xab, 0xb3, 0x56, 0x18};
  uint8_t bytesprops4[] = {0xef, 0x21, 0x4e, 0x79, 0xb2, 0x11, 0xdb, 0xc6, 0x9, 0x7a, 0x4b, 0x46, 0x3c};
  uint8_t bytesprops5[] = {0xbb, 0xbd, 0x9a, 0x69, 0xa9, 0x16, 0x80, 0x7c, 0x14, 0x58, 0x25, 0x7, 0xf2, 0x76, 0xcc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24354}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops0}, .v = {24, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5224}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4220}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8349}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4033}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 18806}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 113}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "\207\219\241<a\196b\r", _pubPktID =
// 0, _pubBody = "\248\255\209\128s\169\179\245\203.\FS(\179o\ETXk\r'x\239\ETB=\189>q", _pubProps =
// [PropSubscriptionIdentifierAvailable 113,PropWildcardSubscriptionAvailable 183,PropMessageExpiryInterval
// 24354,PropUserProperty "_" "\161\176\217j4p\153b\n|g\167\240\158\212]#\248?R\143!g+",PropWillDelayInterval
// 5224,PropResponseTopic "\255\202\251-\151",PropSessionExpiryInterval 4220,PropResponseInformation
// "\DLE\FSh\SYN\155t\141!o\171\179V\CAN",PropResponseInformation
// "\239!Ny\178\DC1\219\198\tzKF<",PropSubscriptionIdentifierAvailable 135,PropTopicAlias 8349,PropMessageExpiryInterval
// 4033,PropRequestProblemInformation 65,PropWillDelayInterval 18806,PropAuthenticationMethod
// "\187\189\154i\169\SYN\128|\DC4X%\a\242v\204",PropWildcardSubscriptionAvailable 113]}
TEST(Publish5QCTest, Decode10) {
  uint8_t pkt[] = {0x39, 0xa2, 0x1,  0x0,  0x8,  0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd,  0x7e, 0x29, 0x71, 0x28,
                   0xb7, 0x2,  0x0,  0x0,  0x5f, 0x22, 0x26, 0x0,  0x1,  0x5f, 0x0,  0x18, 0xa1, 0xb0, 0xd9, 0x6a, 0x34,
                   0x70, 0x99, 0x62, 0xa,  0x7c, 0x67, 0xa7, 0xf0, 0x9e, 0xd4, 0x5d, 0x23, 0xf8, 0x3f, 0x52, 0x8f, 0x21,
                   0x67, 0x2b, 0x18, 0x0,  0x0,  0x14, 0x68, 0x8,  0x0,  0x5,  0xff, 0xca, 0xfb, 0x2d, 0x97, 0x11, 0x0,
                   0x0,  0x10, 0x7c, 0x1a, 0x0,  0xd,  0x10, 0x1c, 0x68, 0x16, 0x9b, 0x74, 0x8d, 0x21, 0x6f, 0xab, 0xb3,
                   0x56, 0x18, 0x1a, 0x0,  0xd,  0xef, 0x21, 0x4e, 0x79, 0xb2, 0x11, 0xdb, 0xc6, 0x9,  0x7a, 0x4b, 0x46,
                   0x3c, 0x29, 0x87, 0x23, 0x20, 0x9d, 0x2,  0x0,  0x0,  0xf,  0xc1, 0x17, 0x41, 0x18, 0x0,  0x0,  0x49,
                   0x76, 0x15, 0x0,  0xf,  0xbb, 0xbd, 0x9a, 0x69, 0xa9, 0x16, 0x80, 0x7c, 0x14, 0x58, 0x25, 0x7,  0xf2,
                   0x76, 0xcc, 0x28, 0x71, 0xf8, 0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3,
                   0x6f, 0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xcf, 0xdb, 0xf1, 0x3c, 0x61, 0xc4, 0x62, 0xd};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xf8, 0xff, 0xd1, 0x80, 0x73, 0xa9, 0xb3, 0xf5, 0xcb, 0x2e, 0x1c, 0x28, 0xb3,
                              0x6f, 0x3,  0x6b, 0xd,  0x27, 0x78, 0xef, 0x17, 0x3d, 0xbd, 0x3e, 0x71};
  lwmqtt_string_t exp_body = {25, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 25);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 25);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\230\US\223|\136nz\184\f)s\246ht", _pubPktID = 0, _pubBody = "\209", _pubProps = [PropRequestResponseInformation
// 63,PropTopicAliasMaximum 25586,PropWildcardSubscriptionAvailable 35,PropSubscriptionIdentifier
// 0,PropPayloadFormatIndicator 212,PropMaximumPacketSize 7906,PropMessageExpiryInterval 15199,PropResponseInformation
// "{\254\252\147e\184hx-\250\171\SYN\158\133\252\194\176\219\140:m",PropUserProperty
// "\166i\GS\b\231\ENQ\190\NUL\229\174\182\""
// "V\193g\167\200\186\&5\246P\159d\225\&5\209\219sS",PropSubscriptionIdentifierAvailable 136,PropWillDelayInterval
// 32300,PropMaximumPacketSize 22829,PropAuthenticationData
// "\184\221\227|\240\152\182\167\DC1\DELY\143x-",PropRequestProblemInformation 233,PropAuthenticationMethod
// "x\139\214\b\199\&3\175j\245W\160M\200\220\194\212\148:\184",PropRequestProblemInformation
// 146,PropSubscriptionIdentifier 28,PropSubscriptionIdentifierAvailable 116,PropServerReference
// "g\140\&0%\146(\175\165\141`\254\204\170\132",PropTopicAliasMaximum 25801]}
TEST(Publish5QCTest, Encode11) {
  uint8_t pkt[] = {0x39, 0xb2, 0x1,  0x0,  0xf,  0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88, 0x6e, 0x7a, 0xb8, 0xc,  0x29, 0x73,
                   0xf6, 0x68, 0x74, 0x9e, 0x1,  0x19, 0x3f, 0x22, 0x63, 0xf2, 0x28, 0x23, 0xb,  0x0,  0x1,  0xd4, 0x27,
                   0x0,  0x0,  0x1e, 0xe2, 0x2,  0x0,  0x0,  0x3b, 0x5f, 0x1a, 0x0,  0x15, 0x7b, 0xfe, 0xfc, 0x93, 0x65,
                   0xb8, 0x68, 0x78, 0x2d, 0xfa, 0xab, 0x16, 0x9e, 0x85, 0xfc, 0xc2, 0xb0, 0xdb, 0x8c, 0x3a, 0x6d, 0x26,
                   0x0,  0xc,  0xa6, 0x69, 0x1d, 0x8,  0xe7, 0x5,  0xbe, 0x0,  0xe5, 0xae, 0xb6, 0x22, 0x0,  0x11, 0x56,
                   0xc1, 0x67, 0xa7, 0xc8, 0xba, 0x35, 0xf6, 0x50, 0x9f, 0x64, 0xe1, 0x35, 0xd1, 0xdb, 0x73, 0x53, 0x29,
                   0x88, 0x18, 0x0,  0x0,  0x7e, 0x2c, 0x27, 0x0,  0x0,  0x59, 0x2d, 0x16, 0x0,  0xe,  0xb8, 0xdd, 0xe3,
                   0x7c, 0xf0, 0x98, 0xb6, 0xa7, 0x11, 0x7f, 0x59, 0x8f, 0x78, 0x2d, 0x17, 0xe9, 0x15, 0x0,  0x13, 0x78,
                   0x8b, 0xd6, 0x8,  0xc7, 0x33, 0xaf, 0x6a, 0xf5, 0x57, 0xa0, 0x4d, 0xc8, 0xdc, 0xc2, 0xd4, 0x94, 0x3a,
                   0xb8, 0x17, 0x92, 0xb,  0x1c, 0x29, 0x74, 0x1c, 0x0,  0xe,  0x67, 0x8c, 0x30, 0x25, 0x92, 0x28, 0xaf,
                   0xa5, 0x8d, 0x60, 0xfe, 0xcc, 0xaa, 0x84, 0x22, 0x64, 0xc9, 0xd1};
  uint8_t topic_bytes[] = {0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88, 0x6e, 0x7a, 0xb8, 0xc, 0x29, 0x73, 0xf6, 0x68, 0x74};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd1};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 1;

  uint8_t bytesprops0[] = {0x7b, 0xfe, 0xfc, 0x93, 0x65, 0xb8, 0x68, 0x78, 0x2d, 0xfa, 0xab,
                           0x16, 0x9e, 0x85, 0xfc, 0xc2, 0xb0, 0xdb, 0x8c, 0x3a, 0x6d};
  uint8_t bytesprops2[] = {0x56, 0xc1, 0x67, 0xa7, 0xc8, 0xba, 0x35, 0xf6, 0x50,
                           0x9f, 0x64, 0xe1, 0x35, 0xd1, 0xdb, 0x73, 0x53};
  uint8_t bytesprops1[] = {0xa6, 0x69, 0x1d, 0x8, 0xe7, 0x5, 0xbe, 0x0, 0xe5, 0xae, 0xb6, 0x22};
  uint8_t bytesprops3[] = {0xb8, 0xdd, 0xe3, 0x7c, 0xf0, 0x98, 0xb6, 0xa7, 0x11, 0x7f, 0x59, 0x8f, 0x78, 0x2d};
  uint8_t bytesprops4[] = {0x78, 0x8b, 0xd6, 0x8,  0xc7, 0x33, 0xaf, 0x6a, 0xf5, 0x57,
                           0xa0, 0x4d, 0xc8, 0xdc, 0xc2, 0xd4, 0x94, 0x3a, 0xb8};
  uint8_t bytesprops5[] = {0x67, 0x8c, 0x30, 0x25, 0x92, 0x28, 0xaf, 0xa5, 0x8d, 0x60, 0xfe, 0xcc, 0xaa, 0x84};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25586}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7906}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15199}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops1}, .v = {17, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32300}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22829}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25801}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\218\230\US\223|\136nz\184\f)s\246ht", _pubPktID = 0, _pubBody = "\209", _pubProps = [PropRequestResponseInformation
// 63,PropTopicAliasMaximum 25586,PropWildcardSubscriptionAvailable 35,PropSubscriptionIdentifier
// 0,PropPayloadFormatIndicator 212,PropMaximumPacketSize 7906,PropMessageExpiryInterval 15199,PropResponseInformation
// "{\254\252\147e\184hx-\250\171\SYN\158\133\252\194\176\219\140:m",PropUserProperty
// "\166i\GS\b\231\ENQ\190\NUL\229\174\182\""
// "V\193g\167\200\186\&5\246P\159d\225\&5\209\219sS",PropSubscriptionIdentifierAvailable 136,PropWillDelayInterval
// 32300,PropMaximumPacketSize 22829,PropAuthenticationData
// "\184\221\227|\240\152\182\167\DC1\DELY\143x-",PropRequestProblemInformation 233,PropAuthenticationMethod
// "x\139\214\b\199\&3\175j\245W\160M\200\220\194\212\148:\184",PropRequestProblemInformation
// 146,PropSubscriptionIdentifier 28,PropSubscriptionIdentifierAvailable 116,PropServerReference
// "g\140\&0%\146(\175\165\141`\254\204\170\132",PropTopicAliasMaximum 25801]}
TEST(Publish5QCTest, Decode11) {
  uint8_t pkt[] = {0x39, 0xb2, 0x1,  0x0,  0xf,  0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88, 0x6e, 0x7a, 0xb8, 0xc,  0x29, 0x73,
                   0xf6, 0x68, 0x74, 0x9e, 0x1,  0x19, 0x3f, 0x22, 0x63, 0xf2, 0x28, 0x23, 0xb,  0x0,  0x1,  0xd4, 0x27,
                   0x0,  0x0,  0x1e, 0xe2, 0x2,  0x0,  0x0,  0x3b, 0x5f, 0x1a, 0x0,  0x15, 0x7b, 0xfe, 0xfc, 0x93, 0x65,
                   0xb8, 0x68, 0x78, 0x2d, 0xfa, 0xab, 0x16, 0x9e, 0x85, 0xfc, 0xc2, 0xb0, 0xdb, 0x8c, 0x3a, 0x6d, 0x26,
                   0x0,  0xc,  0xa6, 0x69, 0x1d, 0x8,  0xe7, 0x5,  0xbe, 0x0,  0xe5, 0xae, 0xb6, 0x22, 0x0,  0x11, 0x56,
                   0xc1, 0x67, 0xa7, 0xc8, 0xba, 0x35, 0xf6, 0x50, 0x9f, 0x64, 0xe1, 0x35, 0xd1, 0xdb, 0x73, 0x53, 0x29,
                   0x88, 0x18, 0x0,  0x0,  0x7e, 0x2c, 0x27, 0x0,  0x0,  0x59, 0x2d, 0x16, 0x0,  0xe,  0xb8, 0xdd, 0xe3,
                   0x7c, 0xf0, 0x98, 0xb6, 0xa7, 0x11, 0x7f, 0x59, 0x8f, 0x78, 0x2d, 0x17, 0xe9, 0x15, 0x0,  0x13, 0x78,
                   0x8b, 0xd6, 0x8,  0xc7, 0x33, 0xaf, 0x6a, 0xf5, 0x57, 0xa0, 0x4d, 0xc8, 0xdc, 0xc2, 0xd4, 0x94, 0x3a,
                   0xb8, 0x17, 0x92, 0xb,  0x1c, 0x29, 0x74, 0x1c, 0x0,  0xe,  0x67, 0x8c, 0x30, 0x25, 0x92, 0x28, 0xaf,
                   0xa5, 0x8d, 0x60, 0xfe, 0xcc, 0xaa, 0x84, 0x22, 0x64, 0xc9, 0xd1};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xda, 0xe6, 0x1f, 0xdf, 0x7c, 0x88, 0x6e, 0x7a, 0xb8, 0xc, 0x29, 0x73, 0xf6, 0x68, 0x74};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd1};
  lwmqtt_string_t exp_body = {1, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 1);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 1);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\185\207+s\131Y\252\238R\EOT\183\224\v\195'\154V\SUB\214", _pubPktID = 0, _pubBody =
// "n\190=U\SI\224\255\fT\157I\150?Z\SI\215\177\163\143\SUB", _pubProps = [PropUserProperty
// "\144.\193YAI\228\215\n(3\DEL\226\244y\234V\196"
// "\194\246d\nv\220\222\238\190\CAN\198vx\170\137",PropSharedSubscriptionAvailable 143]}
TEST(Publish5QCTest, Encode12) {
  uint8_t pkt[] = {0x31, 0x52, 0x0,  0x13, 0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,  0xb7, 0xe0, 0xb,
                   0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6, 0x28, 0x26, 0x0,  0x12, 0x90, 0x2e, 0xc1, 0x59, 0x41, 0x49, 0xe4,
                   0xd7, 0xa,  0x28, 0x33, 0x7f, 0xe2, 0xf4, 0x79, 0xea, 0x56, 0xc4, 0x0,  0xf,  0xc2, 0xf6, 0x64, 0xa,
                   0x76, 0xdc, 0xde, 0xee, 0xbe, 0x18, 0xc6, 0x76, 0x78, 0xaa, 0x89, 0x2a, 0x8f, 0x6e, 0xbe, 0x3d, 0x55,
                   0xf,  0xe0, 0xff, 0xc,  0x54, 0x9d, 0x49, 0x96, 0x3f, 0x5a, 0xf,  0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  uint8_t topic_bytes[] = {0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,
                           0xb7, 0xe0, 0xb,  0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6};
  lwmqtt_string_t topic = {19, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x6e, 0xbe, 0x3d, 0x55, 0xf, 0xe0, 0xff, 0xc,  0x54, 0x9d,
                         0x49, 0x96, 0x3f, 0x5a, 0xf, 0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops1[] = {0xc2, 0xf6, 0x64, 0xa, 0x76, 0xdc, 0xde, 0xee, 0xbe, 0x18, 0xc6, 0x76, 0x78, 0xaa, 0x89};
  uint8_t bytesprops0[] = {0x90, 0x2e, 0xc1, 0x59, 0x41, 0x49, 0xe4, 0xd7, 0xa,
                           0x28, 0x33, 0x7f, 0xe2, 0xf4, 0x79, 0xea, 0x56, 0xc4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {18, (char*)&bytesprops0}, .v = {15, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 143}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\185\207+s\131Y\252\238R\EOT\183\224\v\195'\154V\SUB\214", _pubPktID = 0, _pubBody =
// "n\190=U\SI\224\255\fT\157I\150?Z\SI\215\177\163\143\SUB", _pubProps = [PropUserProperty
// "\144.\193YAI\228\215\n(3\DEL\226\244y\234V\196"
// "\194\246d\nv\220\222\238\190\CAN\198vx\170\137",PropSharedSubscriptionAvailable 143]}
TEST(Publish5QCTest, Decode12) {
  uint8_t pkt[] = {0x31, 0x52, 0x0,  0x13, 0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,  0xb7, 0xe0, 0xb,
                   0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6, 0x28, 0x26, 0x0,  0x12, 0x90, 0x2e, 0xc1, 0x59, 0x41, 0x49, 0xe4,
                   0xd7, 0xa,  0x28, 0x33, 0x7f, 0xe2, 0xf4, 0x79, 0xea, 0x56, 0xc4, 0x0,  0xf,  0xc2, 0xf6, 0x64, 0xa,
                   0x76, 0xdc, 0xde, 0xee, 0xbe, 0x18, 0xc6, 0x76, 0x78, 0xaa, 0x89, 0x2a, 0x8f, 0x6e, 0xbe, 0x3d, 0x55,
                   0xf,  0xe0, 0xff, 0xc,  0x54, 0x9d, 0x49, 0x96, 0x3f, 0x5a, 0xf,  0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xb9, 0xcf, 0x2b, 0x73, 0x83, 0x59, 0xfc, 0xee, 0x52, 0x4,
                               0xb7, 0xe0, 0xb,  0xc3, 0x27, 0x9a, 0x56, 0x1a, 0xd6};
  lwmqtt_string_t exp_topic = {19, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x6e, 0xbe, 0x3d, 0x55, 0xf, 0xe0, 0xff, 0xc,  0x54, 0x9d,
                              0x49, 0x96, 0x3f, 0x5a, 0xf, 0xd7, 0xb1, 0xa3, 0x8f, 0x1a};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 19);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "-\224\164\222\163\DLE\224\218\229\CAN!n\rZ\193Y\DC3r\129\219T\172\139\252\&2~", _pubPktID = 8532, _pubBody =
// "\145b$\DEL\237\176\245E\250\186\STX\US|\163\f\221\190&\238\vu\US", _pubProps = [PropSubscriptionIdentifierAvailable
// 34,PropMessageExpiryInterval 11891,PropResponseInformation
// "-\225]\247aFq\176\244g[\SYN\129\131\161\164\154-\f\129\147*\154M\225\242\169\237\ENQZ",PropSubscriptionIdentifierAvailable
// 249,PropContentType
// "\164KI\192\b\GSW\"\143O\137\197\ETBhML8\223\145\RS\US\181\129\STXHc<\243\165\225",PropAuthenticationMethod
// "\136\&0\244\233\166=Bk%69\245\211|",PropResponseInformation "J\233\157\144<",PropWildcardSubscriptionAvailable
// 58,PropMessageExpiryInterval 16260,PropRetainAvailable 130,PropAuthenticationMethod
// "\"\187\183\218\237\174\186\161K\CAN\236V\153\227",PropMaximumQoS 17,PropAuthenticationData
// "\190\140\f",PropPayloadFormatIndicator 52,PropRequestProblemInformation 200,PropSessionExpiryInterval
// 11292,PropPayloadFormatIndicator 217,PropAssignedClientIdentifier
// "\153\159m+\233\f/,qrA\217\151%<@\253\170\134>I\137",PropMaximumQoS 157,PropServerKeepAlive
// 21812,PropRequestProblemInformation 111,PropResponseInformation "hw\171",PropAuthenticationData
// "\214",PropReceiveMaximum 30617]}
TEST(Publish5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x3d, 0xf4, 0x1,  0x0,  0x1a, 0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18, 0x21, 0x6e, 0xd,  0x5a,
      0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc, 0x32, 0x7e, 0x21, 0x54, 0xbe, 0x1,  0x29, 0x22, 0x2,
      0x0,  0x0,  0x2e, 0x73, 0x1a, 0x0,  0x1e, 0x2d, 0xe1, 0x5d, 0xf7, 0x61, 0x46, 0x71, 0xb0, 0xf4, 0x67, 0x5b, 0x16,
      0x81, 0x83, 0xa1, 0xa4, 0x9a, 0x2d, 0xc,  0x81, 0x93, 0x2a, 0x9a, 0x4d, 0xe1, 0xf2, 0xa9, 0xed, 0x5,  0x5a, 0x29,
      0xf9, 0x3,  0x0,  0x1e, 0xa4, 0x4b, 0x49, 0xc0, 0x8,  0x1d, 0x57, 0x22, 0x8f, 0x4f, 0x89, 0xc5, 0x17, 0x68, 0x4d,
      0x4c, 0x38, 0xdf, 0x91, 0x1e, 0x1f, 0xb5, 0x81, 0x2,  0x48, 0x63, 0x3c, 0xf3, 0xa5, 0xe1, 0x15, 0x0,  0xe,  0x88,
      0x30, 0xf4, 0xe9, 0xa6, 0x3d, 0x42, 0x6b, 0x25, 0x36, 0x39, 0xf5, 0xd3, 0x7c, 0x1a, 0x0,  0x5,  0x4a, 0xe9, 0x9d,
      0x90, 0x3c, 0x28, 0x3a, 0x2,  0x0,  0x0,  0x3f, 0x84, 0x25, 0x82, 0x15, 0x0,  0xe,  0x22, 0xbb, 0xb7, 0xda, 0xed,
      0xae, 0xba, 0xa1, 0x4b, 0x18, 0xec, 0x56, 0x99, 0xe3, 0x24, 0x11, 0x16, 0x0,  0x3,  0xbe, 0x8c, 0xc,  0x1,  0x34,
      0x17, 0xc8, 0x11, 0x0,  0x0,  0x2c, 0x1c, 0x1,  0xd9, 0x12, 0x0,  0x16, 0x99, 0x9f, 0x6d, 0x2b, 0xe9, 0xc,  0x2f,
      0x2c, 0x71, 0x72, 0x41, 0xd9, 0x97, 0x25, 0x3c, 0x40, 0xfd, 0xaa, 0x86, 0x3e, 0x49, 0x89, 0x24, 0x9d, 0x13, 0x55,
      0x34, 0x17, 0x6f, 0x1a, 0x0,  0x3,  0x68, 0x77, 0xab, 0x16, 0x0,  0x1,  0xd6, 0x21, 0x77, 0x99, 0x91, 0x62, 0x24,
      0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba, 0x2,  0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  uint8_t topic_bytes[] = {0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18, 0x21, 0x6e, 0xd,
                           0x5a, 0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc, 0x32, 0x7e};
  lwmqtt_string_t topic = {26, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x91, 0x62, 0x24, 0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba, 0x2,
                         0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 22;

  uint8_t bytesprops0[] = {0x2d, 0xe1, 0x5d, 0xf7, 0x61, 0x46, 0x71, 0xb0, 0xf4, 0x67, 0x5b, 0x16, 0x81, 0x83, 0xa1,
                           0xa4, 0x9a, 0x2d, 0xc,  0x81, 0x93, 0x2a, 0x9a, 0x4d, 0xe1, 0xf2, 0xa9, 0xed, 0x5,  0x5a};
  uint8_t bytesprops1[] = {0xa4, 0x4b, 0x49, 0xc0, 0x8,  0x1d, 0x57, 0x22, 0x8f, 0x4f, 0x89, 0xc5, 0x17, 0x68, 0x4d,
                           0x4c, 0x38, 0xdf, 0x91, 0x1e, 0x1f, 0xb5, 0x81, 0x2,  0x48, 0x63, 0x3c, 0xf3, 0xa5, 0xe1};
  uint8_t bytesprops2[] = {0x88, 0x30, 0xf4, 0xe9, 0xa6, 0x3d, 0x42, 0x6b, 0x25, 0x36, 0x39, 0xf5, 0xd3, 0x7c};
  uint8_t bytesprops3[] = {0x4a, 0xe9, 0x9d, 0x90, 0x3c};
  uint8_t bytesprops4[] = {0x22, 0xbb, 0xb7, 0xda, 0xed, 0xae, 0xba, 0xa1, 0x4b, 0x18, 0xec, 0x56, 0x99, 0xe3};
  uint8_t bytesprops5[] = {0xbe, 0x8c, 0xc};
  uint8_t bytesprops6[] = {0x99, 0x9f, 0x6d, 0x2b, 0xe9, 0xc,  0x2f, 0x2c, 0x71, 0x72, 0x41,
                           0xd9, 0x97, 0x25, 0x3c, 0x40, 0xfd, 0xaa, 0x86, 0x3e, 0x49, 0x89};
  uint8_t bytesprops7[] = {0x68, 0x77, 0xab};
  uint8_t bytesprops8[] = {0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11891}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16260}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11292}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21812}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 30617}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 8532, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "-\224\164\222\163\DLE\224\218\229\CAN!n\rZ\193Y\DC3r\129\219T\172\139\252\&2~", _pubPktID = 8532, _pubBody =
// "\145b$\DEL\237\176\245E\250\186\STX\US|\163\f\221\190&\238\vu\US", _pubProps = [PropSubscriptionIdentifierAvailable
// 34,PropMessageExpiryInterval 11891,PropResponseInformation
// "-\225]\247aFq\176\244g[\SYN\129\131\161\164\154-\f\129\147*\154M\225\242\169\237\ENQZ",PropSubscriptionIdentifierAvailable
// 249,PropContentType
// "\164KI\192\b\GSW\"\143O\137\197\ETBhML8\223\145\RS\US\181\129\STXHc<\243\165\225",PropAuthenticationMethod
// "\136\&0\244\233\166=Bk%69\245\211|",PropResponseInformation "J\233\157\144<",PropWildcardSubscriptionAvailable
// 58,PropMessageExpiryInterval 16260,PropRetainAvailable 130,PropAuthenticationMethod
// "\"\187\183\218\237\174\186\161K\CAN\236V\153\227",PropMaximumQoS 17,PropAuthenticationData
// "\190\140\f",PropPayloadFormatIndicator 52,PropRequestProblemInformation 200,PropSessionExpiryInterval
// 11292,PropPayloadFormatIndicator 217,PropAssignedClientIdentifier
// "\153\159m+\233\f/,qrA\217\151%<@\253\170\134>I\137",PropMaximumQoS 157,PropServerKeepAlive
// 21812,PropRequestProblemInformation 111,PropResponseInformation "hw\171",PropAuthenticationData
// "\214",PropReceiveMaximum 30617]}
TEST(Publish5QCTest, Decode13) {
  uint8_t pkt[] = {
      0x3d, 0xf4, 0x1,  0x0,  0x1a, 0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18, 0x21, 0x6e, 0xd,  0x5a,
      0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc, 0x32, 0x7e, 0x21, 0x54, 0xbe, 0x1,  0x29, 0x22, 0x2,
      0x0,  0x0,  0x2e, 0x73, 0x1a, 0x0,  0x1e, 0x2d, 0xe1, 0x5d, 0xf7, 0x61, 0x46, 0x71, 0xb0, 0xf4, 0x67, 0x5b, 0x16,
      0x81, 0x83, 0xa1, 0xa4, 0x9a, 0x2d, 0xc,  0x81, 0x93, 0x2a, 0x9a, 0x4d, 0xe1, 0xf2, 0xa9, 0xed, 0x5,  0x5a, 0x29,
      0xf9, 0x3,  0x0,  0x1e, 0xa4, 0x4b, 0x49, 0xc0, 0x8,  0x1d, 0x57, 0x22, 0x8f, 0x4f, 0x89, 0xc5, 0x17, 0x68, 0x4d,
      0x4c, 0x38, 0xdf, 0x91, 0x1e, 0x1f, 0xb5, 0x81, 0x2,  0x48, 0x63, 0x3c, 0xf3, 0xa5, 0xe1, 0x15, 0x0,  0xe,  0x88,
      0x30, 0xf4, 0xe9, 0xa6, 0x3d, 0x42, 0x6b, 0x25, 0x36, 0x39, 0xf5, 0xd3, 0x7c, 0x1a, 0x0,  0x5,  0x4a, 0xe9, 0x9d,
      0x90, 0x3c, 0x28, 0x3a, 0x2,  0x0,  0x0,  0x3f, 0x84, 0x25, 0x82, 0x15, 0x0,  0xe,  0x22, 0xbb, 0xb7, 0xda, 0xed,
      0xae, 0xba, 0xa1, 0x4b, 0x18, 0xec, 0x56, 0x99, 0xe3, 0x24, 0x11, 0x16, 0x0,  0x3,  0xbe, 0x8c, 0xc,  0x1,  0x34,
      0x17, 0xc8, 0x11, 0x0,  0x0,  0x2c, 0x1c, 0x1,  0xd9, 0x12, 0x0,  0x16, 0x99, 0x9f, 0x6d, 0x2b, 0xe9, 0xc,  0x2f,
      0x2c, 0x71, 0x72, 0x41, 0xd9, 0x97, 0x25, 0x3c, 0x40, 0xfd, 0xaa, 0x86, 0x3e, 0x49, 0x89, 0x24, 0x9d, 0x13, 0x55,
      0x34, 0x17, 0x6f, 0x1a, 0x0,  0x3,  0x68, 0x77, 0xab, 0x16, 0x0,  0x1,  0xd6, 0x21, 0x77, 0x99, 0x91, 0x62, 0x24,
      0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba, 0x2,  0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2d, 0xe0, 0xa4, 0xde, 0xa3, 0x10, 0xe0, 0xda, 0xe5, 0x18, 0x21, 0x6e, 0xd,
                               0x5a, 0xc1, 0x59, 0x13, 0x72, 0x81, 0xdb, 0x54, 0xac, 0x8b, 0xfc, 0x32, 0x7e};
  lwmqtt_string_t exp_topic = {26, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x91, 0x62, 0x24, 0x7f, 0xed, 0xb0, 0xf5, 0x45, 0xfa, 0xba, 0x2,
                              0x1f, 0x7c, 0xa3, 0xc,  0xdd, 0xbe, 0x26, 0xee, 0xb,  0x75, 0x1f};
  lwmqtt_string_t exp_body = {22, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 8532);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 26);
  EXPECT_EQ(msg.payload_len, 22);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 22);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "8(\GS\144\187\237\&8\196sz",
// _pubPktID = 0, _pubBody = "0zBlyt\159", _pubProps = [PropPayloadFormatIndicator 91,PropRequestProblemInformation
// 77,PropContentType
// "\DC24\251\ETB\ETXn\ENQ\ACK\193\242\131\218\t5\168\152\182\138\170\fJ",PropRequestProblemInformation
// 91,PropMaximumQoS 160,PropTopicAliasMaximum 30380,PropServerReference "",PropReceiveMaximum 26494,PropReceiveMaximum
// 31778,PropResponseInformation "\154\139\156\128?",PropSubscriptionIdentifier 28,PropRetainAvailable
// 93,PropAuthenticationData "\173?",PropReceiveMaximum 10352,PropTopicAlias 27723,PropMessageExpiryInterval
// 1735,PropMessageExpiryInterval 5242,PropTopicAliasMaximum 13186,PropCorrelationData
// "5\217\230;g)\247\203)\151",PropAuthenticationData
// "\144\144c\202x(\237O\236\177\201\166?\230\233\&3\152\146x\144\184",PropSharedSubscriptionAvailable
// 48,PropRetainAvailable 107,PropUserProperty "\ACK<\227\130\129%\141" "1\203\190\US",PropRetainAvailable 90]}
TEST(Publish5QCTest, Encode14) {
  uint8_t pkt[] = {0x39, 0xa0, 0x1,  0x0,  0xa,  0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38, 0xc4, 0x73, 0x7a, 0x8b, 0x1,
                   0x1,  0x5b, 0x17, 0x4d, 0x3,  0x0,  0x15, 0x12, 0x34, 0xfb, 0x17, 0x3,  0x6e, 0x5,  0x6,  0xc1, 0xf2,
                   0x83, 0xda, 0x9,  0x35, 0xa8, 0x98, 0xb6, 0x8a, 0xaa, 0xc,  0x4a, 0x17, 0x5b, 0x24, 0xa0, 0x22, 0x76,
                   0xac, 0x1c, 0x0,  0x0,  0x21, 0x67, 0x7e, 0x21, 0x7c, 0x22, 0x1a, 0x0,  0x5,  0x9a, 0x8b, 0x9c, 0x80,
                   0x3f, 0xb,  0x1c, 0x25, 0x5d, 0x16, 0x0,  0x2,  0xad, 0x3f, 0x21, 0x28, 0x70, 0x23, 0x6c, 0x4b, 0x2,
                   0x0,  0x0,  0x6,  0xc7, 0x2,  0x0,  0x0,  0x14, 0x7a, 0x22, 0x33, 0x82, 0x9,  0x0,  0xa,  0x35, 0xd9,
                   0xe6, 0x3b, 0x67, 0x29, 0xf7, 0xcb, 0x29, 0x97, 0x16, 0x0,  0x15, 0x90, 0x90, 0x63, 0xca, 0x78, 0x28,
                   0xed, 0x4f, 0xec, 0xb1, 0xc9, 0xa6, 0x3f, 0xe6, 0xe9, 0x33, 0x98, 0x92, 0x78, 0x90, 0xb8, 0x2a, 0x30,
                   0x25, 0x6b, 0x26, 0x0,  0x7,  0x6,  0x3c, 0xe3, 0x82, 0x81, 0x25, 0x8d, 0x0,  0x4,  0x31, 0xcb, 0xbe,
                   0x1f, 0x25, 0x5a, 0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  uint8_t topic_bytes[] = {0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38, 0xc4, 0x73, 0x7a};
  lwmqtt_string_t topic = {10, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  uint8_t bytesprops0[] = {0x12, 0x34, 0xfb, 0x17, 0x3,  0x6e, 0x5,  0x6,  0xc1, 0xf2, 0x83,
                           0xda, 0x9,  0x35, 0xa8, 0x98, 0xb6, 0x8a, 0xaa, 0xc,  0x4a};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x9a, 0x8b, 0x9c, 0x80, 0x3f};
  uint8_t bytesprops3[] = {0xad, 0x3f};
  uint8_t bytesprops4[] = {0x35, 0xd9, 0xe6, 0x3b, 0x67, 0x29, 0xf7, 0xcb, 0x29, 0x97};
  uint8_t bytesprops5[] = {0x90, 0x90, 0x63, 0xca, 0x78, 0x28, 0xed, 0x4f, 0xec, 0xb1, 0xc9,
                           0xa6, 0x3f, 0xe6, 0xe9, 0x33, 0x98, 0x92, 0x78, 0x90, 0xb8};
  uint8_t bytesprops7[] = {0x31, 0xcb, 0xbe, 0x1f};
  uint8_t bytesprops6[] = {0x6, 0x3c, 0xe3, 0x82, 0x81, 0x25, 0x8d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30380}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26494}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31778}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10352}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27723}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1735}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5242}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13186}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops6}, .v = {4, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 90}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic = "8(\GS\144\187\237\&8\196sz",
// _pubPktID = 0, _pubBody = "0zBlyt\159", _pubProps = [PropPayloadFormatIndicator 91,PropRequestProblemInformation
// 77,PropContentType
// "\DC24\251\ETB\ETXn\ENQ\ACK\193\242\131\218\t5\168\152\182\138\170\fJ",PropRequestProblemInformation
// 91,PropMaximumQoS 160,PropTopicAliasMaximum 30380,PropServerReference "",PropReceiveMaximum 26494,PropReceiveMaximum
// 31778,PropResponseInformation "\154\139\156\128?",PropSubscriptionIdentifier 28,PropRetainAvailable
// 93,PropAuthenticationData "\173?",PropReceiveMaximum 10352,PropTopicAlias 27723,PropMessageExpiryInterval
// 1735,PropMessageExpiryInterval 5242,PropTopicAliasMaximum 13186,PropCorrelationData
// "5\217\230;g)\247\203)\151",PropAuthenticationData
// "\144\144c\202x(\237O\236\177\201\166?\230\233\&3\152\146x\144\184",PropSharedSubscriptionAvailable
// 48,PropRetainAvailable 107,PropUserProperty "\ACK<\227\130\129%\141" "1\203\190\US",PropRetainAvailable 90]}
TEST(Publish5QCTest, Decode14) {
  uint8_t pkt[] = {0x39, 0xa0, 0x1,  0x0,  0xa,  0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38, 0xc4, 0x73, 0x7a, 0x8b, 0x1,
                   0x1,  0x5b, 0x17, 0x4d, 0x3,  0x0,  0x15, 0x12, 0x34, 0xfb, 0x17, 0x3,  0x6e, 0x5,  0x6,  0xc1, 0xf2,
                   0x83, 0xda, 0x9,  0x35, 0xa8, 0x98, 0xb6, 0x8a, 0xaa, 0xc,  0x4a, 0x17, 0x5b, 0x24, 0xa0, 0x22, 0x76,
                   0xac, 0x1c, 0x0,  0x0,  0x21, 0x67, 0x7e, 0x21, 0x7c, 0x22, 0x1a, 0x0,  0x5,  0x9a, 0x8b, 0x9c, 0x80,
                   0x3f, 0xb,  0x1c, 0x25, 0x5d, 0x16, 0x0,  0x2,  0xad, 0x3f, 0x21, 0x28, 0x70, 0x23, 0x6c, 0x4b, 0x2,
                   0x0,  0x0,  0x6,  0xc7, 0x2,  0x0,  0x0,  0x14, 0x7a, 0x22, 0x33, 0x82, 0x9,  0x0,  0xa,  0x35, 0xd9,
                   0xe6, 0x3b, 0x67, 0x29, 0xf7, 0xcb, 0x29, 0x97, 0x16, 0x0,  0x15, 0x90, 0x90, 0x63, 0xca, 0x78, 0x28,
                   0xed, 0x4f, 0xec, 0xb1, 0xc9, 0xa6, 0x3f, 0xe6, 0xe9, 0x33, 0x98, 0x92, 0x78, 0x90, 0xb8, 0x2a, 0x30,
                   0x25, 0x6b, 0x26, 0x0,  0x7,  0x6,  0x3c, 0xe3, 0x82, 0x81, 0x25, 0x8d, 0x0,  0x4,  0x31, 0xcb, 0xbe,
                   0x1f, 0x25, 0x5a, 0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x38, 0x28, 0x1d, 0x90, 0xbb, 0xed, 0x38, 0xc4, 0x73, 0x7a};
  lwmqtt_string_t exp_topic = {10, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x30, 0x7a, 0x42, 0x6c, 0x79, 0x74, 0x9f};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 10);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ")F\t\CAN\159&z\212\EOT\210y\239\190\EOT\131b\161\153I\235\162", _pubPktID = 2063, _pubBody =
// "\SUB\236\&0\ENQ\ACK1\246q@\SUB\224\&3{\175\RS\142k\"", _pubProps = [PropServerReference
// "\179\230jv\218d=N\245\220i\172\188\168mEau\252\DC1E\192\159\253?\150\167w",PropResponseTopic
// "^mt\fM\ESC\224\240\251c\240",PropTopicAliasMaximum 4110,PropAssignedClientIdentifier "\vP"]}
TEST(Publish5QCTest, Encode15) {
  uint8_t pkt[] = {0x34, 0x61, 0x0,  0x15, 0x29, 0x46, 0x9,  0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79, 0xef, 0xbe,
                   0x4,  0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2, 0x8,  0xf,  0x35, 0x1c, 0x0,  0x1c, 0xb3, 0xe6, 0x6a,
                   0x76, 0xda, 0x64, 0x3d, 0x4e, 0xf5, 0xdc, 0x69, 0xac, 0xbc, 0xa8, 0x6d, 0x45, 0x61, 0x75, 0xfc, 0x11,
                   0x45, 0xc0, 0x9f, 0xfd, 0x3f, 0x96, 0xa7, 0x77, 0x8,  0x0,  0xb,  0x5e, 0x6d, 0x74, 0xc,  0x4d, 0x1b,
                   0xe0, 0xf0, 0xfb, 0x63, 0xf0, 0x22, 0x10, 0xe,  0x12, 0x0,  0x2,  0xb,  0x50, 0x1a, 0xec, 0x30, 0x5,
                   0x6,  0x31, 0xf6, 0x71, 0x40, 0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  uint8_t topic_bytes[] = {0x29, 0x46, 0x9, 0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79,
                           0xef, 0xbe, 0x4, 0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1a, 0xec, 0x30, 0x5,  0x6,  0x31, 0xf6, 0x71, 0x40,
                         0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 18;

  uint8_t bytesprops0[] = {0xb3, 0xe6, 0x6a, 0x76, 0xda, 0x64, 0x3d, 0x4e, 0xf5, 0xdc, 0x69, 0xac, 0xbc, 0xa8,
                           0x6d, 0x45, 0x61, 0x75, 0xfc, 0x11, 0x45, 0xc0, 0x9f, 0xfd, 0x3f, 0x96, 0xa7, 0x77};
  uint8_t bytesprops1[] = {0x5e, 0x6d, 0x74, 0xc, 0x4d, 0x1b, 0xe0, 0xf0, 0xfb, 0x63, 0xf0};
  uint8_t bytesprops2[] = {0xb, 0x50};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 4110}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 2063, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic =
// ")F\t\CAN\159&z\212\EOT\210y\239\190\EOT\131b\161\153I\235\162", _pubPktID = 2063, _pubBody =
// "\SUB\236\&0\ENQ\ACK1\246q@\SUB\224\&3{\175\RS\142k\"", _pubProps = [PropServerReference
// "\179\230jv\218d=N\245\220i\172\188\168mEau\252\DC1E\192\159\253?\150\167w",PropResponseTopic
// "^mt\fM\ESC\224\240\251c\240",PropTopicAliasMaximum 4110,PropAssignedClientIdentifier "\vP"]}
TEST(Publish5QCTest, Decode15) {
  uint8_t pkt[] = {0x34, 0x61, 0x0,  0x15, 0x29, 0x46, 0x9,  0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79, 0xef, 0xbe,
                   0x4,  0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2, 0x8,  0xf,  0x35, 0x1c, 0x0,  0x1c, 0xb3, 0xe6, 0x6a,
                   0x76, 0xda, 0x64, 0x3d, 0x4e, 0xf5, 0xdc, 0x69, 0xac, 0xbc, 0xa8, 0x6d, 0x45, 0x61, 0x75, 0xfc, 0x11,
                   0x45, 0xc0, 0x9f, 0xfd, 0x3f, 0x96, 0xa7, 0x77, 0x8,  0x0,  0xb,  0x5e, 0x6d, 0x74, 0xc,  0x4d, 0x1b,
                   0xe0, 0xf0, 0xfb, 0x63, 0xf0, 0x22, 0x10, 0xe,  0x12, 0x0,  0x2,  0xb,  0x50, 0x1a, 0xec, 0x30, 0x5,
                   0x6,  0x31, 0xf6, 0x71, 0x40, 0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x29, 0x46, 0x9, 0x18, 0x9f, 0x26, 0x7a, 0xd4, 0x4,  0xd2, 0x79,
                               0xef, 0xbe, 0x4, 0x83, 0x62, 0xa1, 0x99, 0x49, 0xeb, 0xa2};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1a, 0xec, 0x30, 0x5,  0x6,  0x31, 0xf6, 0x71, 0x40,
                              0x1a, 0xe0, 0x33, 0x7b, 0xaf, 0x1e, 0x8e, 0x6b, 0x22};
  lwmqtt_string_t exp_body = {18, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 2063);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 18);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 18);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\\Z\DLE\\x\DC3\192\DLE", _pubPktID =
// 15081, _pubBody = "\213\141\182\137f\134\150z.K\232\224o\177\FS\156\198\158\CAN\ESC", _pubProps = [PropReceiveMaximum
// 14518,PropRequestResponseInformation 171,PropReceiveMaximum 527,PropAssignedClientIdentifier "\RSn",PropMaximumQoS
// 222,PropPayloadFormatIndicator 176,PropAuthenticationData "-\214\204Mp)\167\137
// \168\158\STX\STX\214\SO*\241\SOH\190",PropSessionExpiryInterval 10088,PropMessageExpiryInterval
// 28009,PropPayloadFormatIndicator 206,PropTopicAlias 15441,PropWillDelayInterval 23877,PropContentType
// "\251\US\200b",PropSharedSubscriptionAvailable 0,PropSubscriptionIdentifier 12,PropCorrelationData
// "r\132n\170X\196\194\207U\167\ENQ\249\161\t\128\253\204",PropSharedSubscriptionAvailable 71]}
TEST(Publish5QCTest, Encode16) {
  uint8_t pkt[] = {0x35, 0x7d, 0x0,  0x8,  0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10, 0x3a, 0xe9, 0x5c, 0x21,
                   0x38, 0xb6, 0x19, 0xab, 0x21, 0x2,  0xf,  0x12, 0x0,  0x2,  0x1e, 0x6e, 0x24, 0xde, 0x1,  0xb0,
                   0x16, 0x0,  0x13, 0x2d, 0xd6, 0xcc, 0x4d, 0x70, 0x29, 0xa7, 0x89, 0x20, 0xa8, 0x9e, 0x2,  0x2,
                   0xd6, 0xe,  0x2a, 0xf1, 0x1,  0xbe, 0x11, 0x0,  0x0,  0x27, 0x68, 0x2,  0x0,  0x0,  0x6d, 0x69,
                   0x1,  0xce, 0x23, 0x3c, 0x51, 0x18, 0x0,  0x0,  0x5d, 0x45, 0x3,  0x0,  0x4,  0xfb, 0x1f, 0xc8,
                   0x62, 0x2a, 0x0,  0xb,  0xc,  0x9,  0x0,  0x11, 0x72, 0x84, 0x6e, 0xaa, 0x58, 0xc4, 0xc2, 0xcf,
                   0x55, 0xa7, 0x5,  0xf9, 0xa1, 0x9,  0x80, 0xfd, 0xcc, 0x2a, 0x47, 0xd5, 0x8d, 0xb6, 0x89, 0x66,
                   0x86, 0x96, 0x7a, 0x2e, 0x4b, 0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  uint8_t topic_bytes[] = {0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd5, 0x8d, 0xb6, 0x89, 0x66, 0x86, 0x96, 0x7a, 0x2e, 0x4b,
                         0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0x1e, 0x6e};
  uint8_t bytesprops1[] = {0x2d, 0xd6, 0xcc, 0x4d, 0x70, 0x29, 0xa7, 0x89, 0x20, 0xa8,
                           0x9e, 0x2,  0x2,  0xd6, 0xe,  0x2a, 0xf1, 0x1,  0xbe};
  uint8_t bytesprops2[] = {0xfb, 0x1f, 0xc8, 0x62};
  uint8_t bytesprops3[] = {0x72, 0x84, 0x6e, 0xaa, 0x58, 0xc4, 0xc2, 0xcf, 0x55,
                           0xa7, 0x5,  0xf9, 0xa1, 0x9,  0x80, 0xfd, 0xcc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14518}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 527}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10088}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28009}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15441}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23877}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 71}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 15081, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic = "\\Z\DLE\\x\DC3\192\DLE", _pubPktID =
// 15081, _pubBody = "\213\141\182\137f\134\150z.K\232\224o\177\FS\156\198\158\CAN\ESC", _pubProps = [PropReceiveMaximum
// 14518,PropRequestResponseInformation 171,PropReceiveMaximum 527,PropAssignedClientIdentifier "\RSn",PropMaximumQoS
// 222,PropPayloadFormatIndicator 176,PropAuthenticationData "-\214\204Mp)\167\137
// \168\158\STX\STX\214\SO*\241\SOH\190",PropSessionExpiryInterval 10088,PropMessageExpiryInterval
// 28009,PropPayloadFormatIndicator 206,PropTopicAlias 15441,PropWillDelayInterval 23877,PropContentType
// "\251\US\200b",PropSharedSubscriptionAvailable 0,PropSubscriptionIdentifier 12,PropCorrelationData
// "r\132n\170X\196\194\207U\167\ENQ\249\161\t\128\253\204",PropSharedSubscriptionAvailable 71]}
TEST(Publish5QCTest, Decode16) {
  uint8_t pkt[] = {0x35, 0x7d, 0x0,  0x8,  0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10, 0x3a, 0xe9, 0x5c, 0x21,
                   0x38, 0xb6, 0x19, 0xab, 0x21, 0x2,  0xf,  0x12, 0x0,  0x2,  0x1e, 0x6e, 0x24, 0xde, 0x1,  0xb0,
                   0x16, 0x0,  0x13, 0x2d, 0xd6, 0xcc, 0x4d, 0x70, 0x29, 0xa7, 0x89, 0x20, 0xa8, 0x9e, 0x2,  0x2,
                   0xd6, 0xe,  0x2a, 0xf1, 0x1,  0xbe, 0x11, 0x0,  0x0,  0x27, 0x68, 0x2,  0x0,  0x0,  0x6d, 0x69,
                   0x1,  0xce, 0x23, 0x3c, 0x51, 0x18, 0x0,  0x0,  0x5d, 0x45, 0x3,  0x0,  0x4,  0xfb, 0x1f, 0xc8,
                   0x62, 0x2a, 0x0,  0xb,  0xc,  0x9,  0x0,  0x11, 0x72, 0x84, 0x6e, 0xaa, 0x58, 0xc4, 0xc2, 0xcf,
                   0x55, 0xa7, 0x5,  0xf9, 0xa1, 0x9,  0x80, 0xfd, 0xcc, 0x2a, 0x47, 0xd5, 0x8d, 0xb6, 0x89, 0x66,
                   0x86, 0x96, 0x7a, 0x2e, 0x4b, 0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5c, 0x5a, 0x10, 0x5c, 0x78, 0x13, 0xc0, 0x10};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd5, 0x8d, 0xb6, 0x89, 0x66, 0x86, 0x96, 0x7a, 0x2e, 0x4b,
                              0xe8, 0xe0, 0x6f, 0xb1, 0x1c, 0x9c, 0xc6, 0x9e, 0x18, 0x1b};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 15081);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "~2\242\136\211*\DEL", _pubPktID =
// 30428, _pubBody = "\253ET\175\214\175\205\211w\196\ETX\f-\214\144\194", _pubProps = [PropServerKeepAlive
// 4003,PropMessageExpiryInterval 15782,PropRetainAvailable 134]}
TEST(Publish5QCTest, Encode17) {
  uint8_t pkt[] = {0x3b, 0x26, 0x0,  0x7,  0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f, 0x76, 0xdc, 0xa,
                   0x13, 0xf,  0xa3, 0x2,  0x0,  0x0,  0x3d, 0xa6, 0x25, 0x86, 0xfd, 0x45, 0x54, 0xaf,
                   0xd6, 0xaf, 0xcd, 0xd3, 0x77, 0xc4, 0x3,  0xc,  0x2d, 0xd6, 0x90, 0xc2};
  uint8_t topic_bytes[] = {0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f};
  lwmqtt_string_t topic = {7, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xfd, 0x45, 0x54, 0xaf, 0xd6, 0xaf, 0xcd, 0xd3, 0x77, 0xc4, 0x3, 0xc, 0x2d, 0xd6, 0x90, 0xc2};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 16;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4003}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15782}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 134}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 30428, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = True, _pubTopic = "~2\242\136\211*\DEL", _pubPktID =
// 30428, _pubBody = "\253ET\175\214\175\205\211w\196\ETX\f-\214\144\194", _pubProps = [PropServerKeepAlive
// 4003,PropMessageExpiryInterval 15782,PropRetainAvailable 134]}
TEST(Publish5QCTest, Decode17) {
  uint8_t pkt[] = {0x3b, 0x26, 0x0,  0x7,  0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f, 0x76, 0xdc, 0xa,
                   0x13, 0xf,  0xa3, 0x2,  0x0,  0x0,  0x3d, 0xa6, 0x25, 0x86, 0xfd, 0x45, 0x54, 0xaf,
                   0xd6, 0xaf, 0xcd, 0xd3, 0x77, 0xc4, 0x3,  0xc,  0x2d, 0xd6, 0x90, 0xc2};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7e, 0x32, 0xf2, 0x88, 0xd3, 0x2a, 0x7f};
  lwmqtt_string_t exp_topic = {7, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfd, 0x45, 0x54, 0xaf, 0xd6, 0xaf, 0xcd, 0xd3,
                              0x77, 0xc4, 0x3,  0xc,  0x2d, 0xd6, 0x90, 0xc2};
  lwmqtt_string_t exp_body = {16, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 30428);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 7);
  EXPECT_EQ(msg.payload_len, 16);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 16);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "dG\194+K1e\237n\253\EM\US\222\156\216K\173\158+\228\&9E\185\CAN\147`\203un\n", _pubPktID = 16078, _pubBody = "",
// _pubProps = [PropResponseTopic
// "\166\242\248\192\207\220\249z\141t\a`\222\EM\183Op(5\226QK'\245\150\nI\SOHR3",PropTopicAliasMaximum
// 26890,PropMaximumQoS 179,PropMessageExpiryInterval 8868,PropSubscriptionIdentifierAvailable 112,PropReasonString
// "\229\ENQ\190m\206\t\130\134\b\131\134\235+\166bi\138\163\172\186\NAKJ\a\SYN\138C\184K",PropRequestResponseInformation
// 172]}
TEST(Publish5QCTest, Encode18) {
  uint8_t pkt[] = {0x32, 0x71, 0x0,  0x1e, 0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed, 0x6e, 0xfd, 0x19, 0x1f, 0xde,
                   0x9c, 0xd8, 0x4b, 0xad, 0x9e, 0x2b, 0xe4, 0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa,
                   0x3e, 0xce, 0x4e, 0x8,  0x0,  0x1e, 0xa6, 0xf2, 0xf8, 0xc0, 0xcf, 0xdc, 0xf9, 0x7a, 0x8d, 0x74, 0x7,
                   0x60, 0xde, 0x19, 0xb7, 0x4f, 0x70, 0x28, 0x35, 0xe2, 0x51, 0x4b, 0x27, 0xf5, 0x96, 0xa,  0x49, 0x1,
                   0x52, 0x33, 0x22, 0x69, 0xa,  0x24, 0xb3, 0x2,  0x0,  0x0,  0x22, 0xa4, 0x29, 0x70, 0x1f, 0x0,  0x1c,
                   0xe5, 0x5,  0xbe, 0x6d, 0xce, 0x9,  0x82, 0x86, 0x8,  0x83, 0x86, 0xeb, 0x2b, 0xa6, 0x62, 0x69, 0x8a,
                   0xa3, 0xac, 0xba, 0x15, 0x4a, 0x7,  0x16, 0x8a, 0x43, 0xb8, 0x4b, 0x19, 0xac};
  uint8_t topic_bytes[] = {0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed, 0x6e, 0xfd, 0x19, 0x1f, 0xde, 0x9c, 0xd8,
                           0x4b, 0xad, 0x9e, 0x2b, 0xe4, 0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa};
  lwmqtt_string_t topic = {30, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 0;

  uint8_t bytesprops0[] = {0xa6, 0xf2, 0xf8, 0xc0, 0xcf, 0xdc, 0xf9, 0x7a, 0x8d, 0x74, 0x7, 0x60, 0xde, 0x19, 0xb7,
                           0x4f, 0x70, 0x28, 0x35, 0xe2, 0x51, 0x4b, 0x27, 0xf5, 0x96, 0xa, 0x49, 0x1,  0x52, 0x33};
  uint8_t bytesprops1[] = {0xe5, 0x5,  0xbe, 0x6d, 0xce, 0x9,  0x82, 0x86, 0x8, 0x83, 0x86, 0xeb, 0x2b, 0xa6,
                           0x62, 0x69, 0x8a, 0xa3, 0xac, 0xba, 0x15, 0x4a, 0x7, 0x16, 0x8a, 0x43, 0xb8, 0x4b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26890}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8868}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 172}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 16078, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "dG\194+K1e\237n\253\EM\US\222\156\216K\173\158+\228\&9E\185\CAN\147`\203un\n", _pubPktID = 16078, _pubBody = "",
// _pubProps = [PropResponseTopic
// "\166\242\248\192\207\220\249z\141t\a`\222\EM\183Op(5\226QK'\245\150\nI\SOHR3",PropTopicAliasMaximum
// 26890,PropMaximumQoS 179,PropMessageExpiryInterval 8868,PropSubscriptionIdentifierAvailable 112,PropReasonString
// "\229\ENQ\190m\206\t\130\134\b\131\134\235+\166bi\138\163\172\186\NAKJ\a\SYN\138C\184K",PropRequestResponseInformation
// 172]}
TEST(Publish5QCTest, Decode18) {
  uint8_t pkt[] = {0x32, 0x71, 0x0,  0x1e, 0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed, 0x6e, 0xfd, 0x19, 0x1f, 0xde,
                   0x9c, 0xd8, 0x4b, 0xad, 0x9e, 0x2b, 0xe4, 0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa,
                   0x3e, 0xce, 0x4e, 0x8,  0x0,  0x1e, 0xa6, 0xf2, 0xf8, 0xc0, 0xcf, 0xdc, 0xf9, 0x7a, 0x8d, 0x74, 0x7,
                   0x60, 0xde, 0x19, 0xb7, 0x4f, 0x70, 0x28, 0x35, 0xe2, 0x51, 0x4b, 0x27, 0xf5, 0x96, 0xa,  0x49, 0x1,
                   0x52, 0x33, 0x22, 0x69, 0xa,  0x24, 0xb3, 0x2,  0x0,  0x0,  0x22, 0xa4, 0x29, 0x70, 0x1f, 0x0,  0x1c,
                   0xe5, 0x5,  0xbe, 0x6d, 0xce, 0x9,  0x82, 0x86, 0x8,  0x83, 0x86, 0xeb, 0x2b, 0xa6, 0x62, 0x69, 0x8a,
                   0xa3, 0xac, 0xba, 0x15, 0x4a, 0x7,  0x16, 0x8a, 0x43, 0xb8, 0x4b, 0x19, 0xac};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x64, 0x47, 0xc2, 0x2b, 0x4b, 0x31, 0x65, 0xed, 0x6e, 0xfd, 0x19, 0x1f, 0xde, 0x9c, 0xd8,
                               0x4b, 0xad, 0x9e, 0x2b, 0xe4, 0x39, 0x45, 0xb9, 0x18, 0x93, 0x60, 0xcb, 0x75, 0x6e, 0xa};
  lwmqtt_string_t exp_topic = {30, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0};
  lwmqtt_string_t exp_body = {0, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 16078);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 30);
  EXPECT_EQ(msg.payload_len, 0);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 0);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "?\DC1;Y\196\211\145n\198\234\233\176_,\224\194\182X\250J\NUL_\198\186\&5\173\224W", _pubPktID = 0, _pubBody =
// "\189?\ag\226\204+\195v\STX4\147\165\167h\131}n\149j\208", _pubProps = [PropWildcardSubscriptionAvailable
// 0,PropCorrelationData
// "\192\253\172\134\180\240\188A\202\151\153^\148\&0\153\251|\227\151\207))\207U`",PropRetainAvailable
// 202,PropUserProperty "\151\180#\EOT1\US\252.\STX\224\214\210\\\192\242\213^\193\SUB\149\175\165\193!V"
// "\145\&0\189\&0\253\&5\165\SUB\140\140g`c\SOH",PropSubscriptionIdentifier 3,PropSubscriptionIdentifierAvailable
// 175,PropContentType "",PropServerKeepAlive 10995,PropWillDelayInterval 29838,PropTopicAliasMaximum
// 12765,PropUserProperty "\249\223\142_B\DELAQ\NAKr\155]\254'h\178Q\140\212\ETX\230\240\151td\213g"
// "E",PropAssignedClientIdentifier "\SOH\EMJd|\185_6\232",PropMaximumQoS 36,PropSubscriptionIdentifierAvailable
// 226,PropResponseInformation "\250?\140\DC1\211\RS\238rpe\EM\253[8\147y",PropReasonString
// "\221\166\174\SI",PropResponseInformation "t4\SYNQ\140W'_i\v6",PropServerReference
// "\210\245\151\236",PropTopicAliasMaximum 8057,PropAssignedClientIdentifier "\159RG\156",PropCorrelationData
// "~\249\195\160\166Y2\154L\150i \ACKr\242\181\DLE8d\221\175\215\176\202\248\216\163",PropReceiveMaximum
// 3286,PropSubscriptionIdentifierAvailable 245,PropTopicAliasMaximum 5386,PropReceiveMaximum
// 8489,PropRequestResponseInformation 31,PropPayloadFormatIndicator 106,PropWillDelayInterval
// 8799,PropResponseInformation
// "Z\216\187\SOH\169\207\180vs\177\&8\216\150\v\174\195\245\187\250vq(X\SYN\197Z",PropMessageExpiryInterval 22785]}
TEST(Publish5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x30, 0xd1, 0x2,  0x0,  0x1c, 0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea, 0xe9, 0xb0, 0x5f, 0x2c,
      0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba, 0x35, 0xad, 0xe0, 0x57, 0x9c, 0x2,  0x28, 0x0,  0x9,
      0x0,  0x19, 0xc0, 0xfd, 0xac, 0x86, 0xb4, 0xf0, 0xbc, 0x41, 0xca, 0x97, 0x99, 0x5e, 0x94, 0x30, 0x99, 0xfb, 0x7c,
      0xe3, 0x97, 0xcf, 0x29, 0x29, 0xcf, 0x55, 0x60, 0x25, 0xca, 0x26, 0x0,  0x19, 0x97, 0xb4, 0x23, 0x4,  0x31, 0x1f,
      0xfc, 0x2e, 0x2,  0xe0, 0xd6, 0xd2, 0x5c, 0xc0, 0xf2, 0xd5, 0x5e, 0xc1, 0x1a, 0x95, 0xaf, 0xa5, 0xc1, 0x21, 0x56,
      0x0,  0xe,  0x91, 0x30, 0xbd, 0x30, 0xfd, 0x35, 0xa5, 0x1a, 0x8c, 0x8c, 0x67, 0x60, 0x63, 0x1,  0xb,  0x3,  0x29,
      0xaf, 0x3,  0x0,  0x0,  0x13, 0x2a, 0xf3, 0x18, 0x0,  0x0,  0x74, 0x8e, 0x22, 0x31, 0xdd, 0x26, 0x0,  0x1b, 0xf9,
      0xdf, 0x8e, 0x5f, 0x42, 0x7f, 0x41, 0x51, 0x15, 0x72, 0x9b, 0x5d, 0xfe, 0x27, 0x68, 0xb2, 0x51, 0x8c, 0xd4, 0x3,
      0xe6, 0xf0, 0x97, 0x74, 0x64, 0xd5, 0x67, 0x0,  0x1,  0x45, 0x12, 0x0,  0x9,  0x1,  0x19, 0x4a, 0x64, 0x7c, 0xb9,
      0x5f, 0x36, 0xe8, 0x24, 0x24, 0x29, 0xe2, 0x1a, 0x0,  0x10, 0xfa, 0x3f, 0x8c, 0x11, 0xd3, 0x1e, 0xee, 0x72, 0x70,
      0x65, 0x19, 0xfd, 0x5b, 0x38, 0x93, 0x79, 0x1f, 0x0,  0x4,  0xdd, 0xa6, 0xae, 0xf,  0x1a, 0x0,  0xb,  0x74, 0x34,
      0x16, 0x51, 0x8c, 0x57, 0x27, 0x5f, 0x69, 0xb,  0x36, 0x1c, 0x0,  0x4,  0xd2, 0xf5, 0x97, 0xec, 0x22, 0x1f, 0x79,
      0x12, 0x0,  0x4,  0x9f, 0x52, 0x47, 0x9c, 0x9,  0x0,  0x1b, 0x7e, 0xf9, 0xc3, 0xa0, 0xa6, 0x59, 0x32, 0x9a, 0x4c,
      0x96, 0x69, 0x20, 0x6,  0x72, 0xf2, 0xb5, 0x10, 0x38, 0x64, 0xdd, 0xaf, 0xd7, 0xb0, 0xca, 0xf8, 0xd8, 0xa3, 0x21,
      0xc,  0xd6, 0x29, 0xf5, 0x22, 0x15, 0xa,  0x21, 0x21, 0x29, 0x19, 0x1f, 0x1,  0x6a, 0x18, 0x0,  0x0,  0x22, 0x5f,
      0x1a, 0x0,  0x1a, 0x5a, 0xd8, 0xbb, 0x1,  0xa9, 0xcf, 0xb4, 0x76, 0x73, 0xb1, 0x38, 0xd8, 0x96, 0xb,  0xae, 0xc3,
      0xf5, 0xbb, 0xfa, 0x76, 0x71, 0x28, 0x58, 0x16, 0xc5, 0x5a, 0x2,  0x0,  0x0,  0x59, 0x1,  0xbd, 0x3f, 0x7,  0x67,
      0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2,  0x34, 0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  uint8_t topic_bytes[] = {0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea, 0xe9, 0xb0, 0x5f, 0x2c,
                           0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba, 0x35, 0xad, 0xe0, 0x57};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xbd, 0x3f, 0x7,  0x67, 0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2, 0x34,
                         0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 21;

  uint8_t bytesprops0[] = {0xc0, 0xfd, 0xac, 0x86, 0xb4, 0xf0, 0xbc, 0x41, 0xca, 0x97, 0x99, 0x5e, 0x94,
                           0x30, 0x99, 0xfb, 0x7c, 0xe3, 0x97, 0xcf, 0x29, 0x29, 0xcf, 0x55, 0x60};
  uint8_t bytesprops2[] = {0x91, 0x30, 0xbd, 0x30, 0xfd, 0x35, 0xa5, 0x1a, 0x8c, 0x8c, 0x67, 0x60, 0x63, 0x1};
  uint8_t bytesprops1[] = {0x97, 0xb4, 0x23, 0x4,  0x31, 0x1f, 0xfc, 0x2e, 0x2,  0xe0, 0xd6, 0xd2, 0x5c,
                           0xc0, 0xf2, 0xd5, 0x5e, 0xc1, 0x1a, 0x95, 0xaf, 0xa5, 0xc1, 0x21, 0x56};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops5[] = {0x45};
  uint8_t bytesprops4[] = {0xf9, 0xdf, 0x8e, 0x5f, 0x42, 0x7f, 0x41, 0x51, 0x15, 0x72, 0x9b, 0x5d, 0xfe, 0x27,
                           0x68, 0xb2, 0x51, 0x8c, 0xd4, 0x3,  0xe6, 0xf0, 0x97, 0x74, 0x64, 0xd5, 0x67};
  uint8_t bytesprops6[] = {0x1, 0x19, 0x4a, 0x64, 0x7c, 0xb9, 0x5f, 0x36, 0xe8};
  uint8_t bytesprops7[] = {0xfa, 0x3f, 0x8c, 0x11, 0xd3, 0x1e, 0xee, 0x72,
                           0x70, 0x65, 0x19, 0xfd, 0x5b, 0x38, 0x93, 0x79};
  uint8_t bytesprops8[] = {0xdd, 0xa6, 0xae, 0xf};
  uint8_t bytesprops9[] = {0x74, 0x34, 0x16, 0x51, 0x8c, 0x57, 0x27, 0x5f, 0x69, 0xb, 0x36};
  uint8_t bytesprops10[] = {0xd2, 0xf5, 0x97, 0xec};
  uint8_t bytesprops11[] = {0x9f, 0x52, 0x47, 0x9c};
  uint8_t bytesprops12[] = {0x7e, 0xf9, 0xc3, 0xa0, 0xa6, 0x59, 0x32, 0x9a, 0x4c, 0x96, 0x69, 0x20, 0x6, 0x72,
                            0xf2, 0xb5, 0x10, 0x38, 0x64, 0xdd, 0xaf, 0xd7, 0xb0, 0xca, 0xf8, 0xd8, 0xa3};
  uint8_t bytesprops13[] = {0x5a, 0xd8, 0xbb, 0x1,  0xa9, 0xcf, 0xb4, 0x76, 0x73, 0xb1, 0x38, 0xd8, 0x96,
                            0xb,  0xae, 0xc3, 0xf5, 0xbb, 0xfa, 0x76, 0x71, 0x28, 0x58, 0x16, 0xc5, 0x5a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 0}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops1}, .v = {14, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 10995}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29838}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12765}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops4}, .v = {1, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 36}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {16, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8057}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3286}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5386}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8489}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8799}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 22785}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic =
// "?\DC1;Y\196\211\145n\198\234\233\176_,\224\194\182X\250J\NUL_\198\186\&5\173\224W", _pubPktID = 0, _pubBody =
// "\189?\ag\226\204+\195v\STX4\147\165\167h\131}n\149j\208", _pubProps = [PropWildcardSubscriptionAvailable
// 0,PropCorrelationData
// "\192\253\172\134\180\240\188A\202\151\153^\148\&0\153\251|\227\151\207))\207U`",PropRetainAvailable
// 202,PropUserProperty "\151\180#\EOT1\US\252.\STX\224\214\210\\\192\242\213^\193\SUB\149\175\165\193!V"
// "\145\&0\189\&0\253\&5\165\SUB\140\140g`c\SOH",PropSubscriptionIdentifier 3,PropSubscriptionIdentifierAvailable
// 175,PropContentType "",PropServerKeepAlive 10995,PropWillDelayInterval 29838,PropTopicAliasMaximum
// 12765,PropUserProperty "\249\223\142_B\DELAQ\NAKr\155]\254'h\178Q\140\212\ETX\230\240\151td\213g"
// "E",PropAssignedClientIdentifier "\SOH\EMJd|\185_6\232",PropMaximumQoS 36,PropSubscriptionIdentifierAvailable
// 226,PropResponseInformation "\250?\140\DC1\211\RS\238rpe\EM\253[8\147y",PropReasonString
// "\221\166\174\SI",PropResponseInformation "t4\SYNQ\140W'_i\v6",PropServerReference
// "\210\245\151\236",PropTopicAliasMaximum 8057,PropAssignedClientIdentifier "\159RG\156",PropCorrelationData
// "~\249\195\160\166Y2\154L\150i \ACKr\242\181\DLE8d\221\175\215\176\202\248\216\163",PropReceiveMaximum
// 3286,PropSubscriptionIdentifierAvailable 245,PropTopicAliasMaximum 5386,PropReceiveMaximum
// 8489,PropRequestResponseInformation 31,PropPayloadFormatIndicator 106,PropWillDelayInterval
// 8799,PropResponseInformation
// "Z\216\187\SOH\169\207\180vs\177\&8\216\150\v\174\195\245\187\250vq(X\SYN\197Z",PropMessageExpiryInterval 22785]}
TEST(Publish5QCTest, Decode19) {
  uint8_t pkt[] = {
      0x30, 0xd1, 0x2,  0x0,  0x1c, 0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea, 0xe9, 0xb0, 0x5f, 0x2c,
      0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba, 0x35, 0xad, 0xe0, 0x57, 0x9c, 0x2,  0x28, 0x0,  0x9,
      0x0,  0x19, 0xc0, 0xfd, 0xac, 0x86, 0xb4, 0xf0, 0xbc, 0x41, 0xca, 0x97, 0x99, 0x5e, 0x94, 0x30, 0x99, 0xfb, 0x7c,
      0xe3, 0x97, 0xcf, 0x29, 0x29, 0xcf, 0x55, 0x60, 0x25, 0xca, 0x26, 0x0,  0x19, 0x97, 0xb4, 0x23, 0x4,  0x31, 0x1f,
      0xfc, 0x2e, 0x2,  0xe0, 0xd6, 0xd2, 0x5c, 0xc0, 0xf2, 0xd5, 0x5e, 0xc1, 0x1a, 0x95, 0xaf, 0xa5, 0xc1, 0x21, 0x56,
      0x0,  0xe,  0x91, 0x30, 0xbd, 0x30, 0xfd, 0x35, 0xa5, 0x1a, 0x8c, 0x8c, 0x67, 0x60, 0x63, 0x1,  0xb,  0x3,  0x29,
      0xaf, 0x3,  0x0,  0x0,  0x13, 0x2a, 0xf3, 0x18, 0x0,  0x0,  0x74, 0x8e, 0x22, 0x31, 0xdd, 0x26, 0x0,  0x1b, 0xf9,
      0xdf, 0x8e, 0x5f, 0x42, 0x7f, 0x41, 0x51, 0x15, 0x72, 0x9b, 0x5d, 0xfe, 0x27, 0x68, 0xb2, 0x51, 0x8c, 0xd4, 0x3,
      0xe6, 0xf0, 0x97, 0x74, 0x64, 0xd5, 0x67, 0x0,  0x1,  0x45, 0x12, 0x0,  0x9,  0x1,  0x19, 0x4a, 0x64, 0x7c, 0xb9,
      0x5f, 0x36, 0xe8, 0x24, 0x24, 0x29, 0xe2, 0x1a, 0x0,  0x10, 0xfa, 0x3f, 0x8c, 0x11, 0xd3, 0x1e, 0xee, 0x72, 0x70,
      0x65, 0x19, 0xfd, 0x5b, 0x38, 0x93, 0x79, 0x1f, 0x0,  0x4,  0xdd, 0xa6, 0xae, 0xf,  0x1a, 0x0,  0xb,  0x74, 0x34,
      0x16, 0x51, 0x8c, 0x57, 0x27, 0x5f, 0x69, 0xb,  0x36, 0x1c, 0x0,  0x4,  0xd2, 0xf5, 0x97, 0xec, 0x22, 0x1f, 0x79,
      0x12, 0x0,  0x4,  0x9f, 0x52, 0x47, 0x9c, 0x9,  0x0,  0x1b, 0x7e, 0xf9, 0xc3, 0xa0, 0xa6, 0x59, 0x32, 0x9a, 0x4c,
      0x96, 0x69, 0x20, 0x6,  0x72, 0xf2, 0xb5, 0x10, 0x38, 0x64, 0xdd, 0xaf, 0xd7, 0xb0, 0xca, 0xf8, 0xd8, 0xa3, 0x21,
      0xc,  0xd6, 0x29, 0xf5, 0x22, 0x15, 0xa,  0x21, 0x21, 0x29, 0x19, 0x1f, 0x1,  0x6a, 0x18, 0x0,  0x0,  0x22, 0x5f,
      0x1a, 0x0,  0x1a, 0x5a, 0xd8, 0xbb, 0x1,  0xa9, 0xcf, 0xb4, 0x76, 0x73, 0xb1, 0x38, 0xd8, 0x96, 0xb,  0xae, 0xc3,
      0xf5, 0xbb, 0xfa, 0x76, 0x71, 0x28, 0x58, 0x16, 0xc5, 0x5a, 0x2,  0x0,  0x0,  0x59, 0x1,  0xbd, 0x3f, 0x7,  0x67,
      0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2,  0x34, 0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3f, 0x11, 0x3b, 0x59, 0xc4, 0xd3, 0x91, 0x6e, 0xc6, 0xea, 0xe9, 0xb0, 0x5f, 0x2c,
                               0xe0, 0xc2, 0xb6, 0x58, 0xfa, 0x4a, 0x0,  0x5f, 0xc6, 0xba, 0x35, 0xad, 0xe0, 0x57};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xbd, 0x3f, 0x7,  0x67, 0xe2, 0xcc, 0x2b, 0xc3, 0x76, 0x2, 0x34,
                              0x93, 0xa5, 0xa7, 0x68, 0x83, 0x7d, 0x6e, 0x95, 0x6a, 0xd0};
  lwmqtt_string_t exp_body = {21, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 21);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 21);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "D\SUBc\224\DC3\202\&3\187\&84T\240", _pubPktID = 22665, _pubBody =
// "EV\174.\183\&1Q\DC1\216V\203p>q=x\132\163(\239\143\135b\236\137\&6", _pubProps = [PropTopicAlias
// 1081,PropContentType "3\205\199\242_=",PropWildcardSubscriptionAvailable 83,PropUserProperty "F\217%]\244\163G\239"
// "\156\129",PropPayloadFormatIndicator 159,PropServerReference
// "\226\"\247\195\163\GSS%\184\r\215t\186\211",PropResponseInformation
// "\174\249z\CAN\248\219\SI\138}\152",PropAssignedClientIdentifier
// "!j\154E\128o\220\EOT\251=\135\221i\180\RS",PropMaximumPacketSize 30968,PropReasonString
// "\157\&3U\GS\139\&1-\250\SOH\177\245\128\STX",PropCorrelationData
// "\EOT\189\NULoWjA\177\237\168\215-\225",PropWildcardSubscriptionAvailable 11]}
TEST(Publish5QCTest, Encode20) {
  uint8_t pkt[] = {0x32, 0xa1, 0x1,  0x0,  0xc,  0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54, 0xf0,
                   0x58, 0x89, 0x76, 0x23, 0x4,  0x39, 0x3,  0x0,  0x6,  0x33, 0xcd, 0xc7, 0xf2, 0x5f, 0x3d, 0x28, 0x53,
                   0x26, 0x0,  0x8,  0x46, 0xd9, 0x25, 0x5d, 0xf4, 0xa3, 0x47, 0xef, 0x0,  0x2,  0x9c, 0x81, 0x1,  0x9f,
                   0x1c, 0x0,  0xe,  0xe2, 0x22, 0xf7, 0xc3, 0xa3, 0x1d, 0x53, 0x25, 0xb8, 0xd,  0xd7, 0x74, 0xba, 0xd3,
                   0x1a, 0x0,  0xa,  0xae, 0xf9, 0x7a, 0x18, 0xf8, 0xdb, 0xf,  0x8a, 0x7d, 0x98, 0x12, 0x0,  0xf,  0x21,
                   0x6a, 0x9a, 0x45, 0x80, 0x6f, 0xdc, 0x4,  0xfb, 0x3d, 0x87, 0xdd, 0x69, 0xb4, 0x1e, 0x27, 0x0,  0x0,
                   0x78, 0xf8, 0x1f, 0x0,  0xd,  0x9d, 0x33, 0x55, 0x1d, 0x8b, 0x31, 0x2d, 0xfa, 0x1,  0xb1, 0xf5, 0x80,
                   0x2,  0x9,  0x0,  0xd,  0x4,  0xbd, 0x0,  0x6f, 0x57, 0x6a, 0x41, 0xb1, 0xed, 0xa8, 0xd7, 0x2d, 0xe1,
                   0x28, 0xb,  0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70, 0x3e, 0x71, 0x3d,
                   0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  uint8_t topic_bytes[] = {0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54, 0xf0};
  lwmqtt_string_t topic = {12, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70, 0x3e,
                         0x71, 0x3d, 0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 26;

  uint8_t bytesprops0[] = {0x33, 0xcd, 0xc7, 0xf2, 0x5f, 0x3d};
  uint8_t bytesprops2[] = {0x9c, 0x81};
  uint8_t bytesprops1[] = {0x46, 0xd9, 0x25, 0x5d, 0xf4, 0xa3, 0x47, 0xef};
  uint8_t bytesprops3[] = {0xe2, 0x22, 0xf7, 0xc3, 0xa3, 0x1d, 0x53, 0x25, 0xb8, 0xd, 0xd7, 0x74, 0xba, 0xd3};
  uint8_t bytesprops4[] = {0xae, 0xf9, 0x7a, 0x18, 0xf8, 0xdb, 0xf, 0x8a, 0x7d, 0x98};
  uint8_t bytesprops5[] = {0x21, 0x6a, 0x9a, 0x45, 0x80, 0x6f, 0xdc, 0x4, 0xfb, 0x3d, 0x87, 0xdd, 0x69, 0xb4, 0x1e};
  uint8_t bytesprops6[] = {0x9d, 0x33, 0x55, 0x1d, 0x8b, 0x31, 0x2d, 0xfa, 0x1, 0xb1, 0xf5, 0x80, 0x2};
  uint8_t bytesprops7[] = {0x4, 0xbd, 0x0, 0x6f, 0x57, 0x6a, 0x41, 0xb1, 0xed, 0xa8, 0xd7, 0x2d, 0xe1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1081}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops1}, .v = {2, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30968}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 11}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 22665, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "D\SUBc\224\DC3\202\&3\187\&84T\240", _pubPktID = 22665, _pubBody =
// "EV\174.\183\&1Q\DC1\216V\203p>q=x\132\163(\239\143\135b\236\137\&6", _pubProps = [PropTopicAlias
// 1081,PropContentType "3\205\199\242_=",PropWildcardSubscriptionAvailable 83,PropUserProperty "F\217%]\244\163G\239"
// "\156\129",PropPayloadFormatIndicator 159,PropServerReference
// "\226\"\247\195\163\GSS%\184\r\215t\186\211",PropResponseInformation
// "\174\249z\CAN\248\219\SI\138}\152",PropAssignedClientIdentifier
// "!j\154E\128o\220\EOT\251=\135\221i\180\RS",PropMaximumPacketSize 30968,PropReasonString
// "\157\&3U\GS\139\&1-\250\SOH\177\245\128\STX",PropCorrelationData
// "\EOT\189\NULoWjA\177\237\168\215-\225",PropWildcardSubscriptionAvailable 11]}
TEST(Publish5QCTest, Decode20) {
  uint8_t pkt[] = {0x32, 0xa1, 0x1,  0x0,  0xc,  0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54, 0xf0,
                   0x58, 0x89, 0x76, 0x23, 0x4,  0x39, 0x3,  0x0,  0x6,  0x33, 0xcd, 0xc7, 0xf2, 0x5f, 0x3d, 0x28, 0x53,
                   0x26, 0x0,  0x8,  0x46, 0xd9, 0x25, 0x5d, 0xf4, 0xa3, 0x47, 0xef, 0x0,  0x2,  0x9c, 0x81, 0x1,  0x9f,
                   0x1c, 0x0,  0xe,  0xe2, 0x22, 0xf7, 0xc3, 0xa3, 0x1d, 0x53, 0x25, 0xb8, 0xd,  0xd7, 0x74, 0xba, 0xd3,
                   0x1a, 0x0,  0xa,  0xae, 0xf9, 0x7a, 0x18, 0xf8, 0xdb, 0xf,  0x8a, 0x7d, 0x98, 0x12, 0x0,  0xf,  0x21,
                   0x6a, 0x9a, 0x45, 0x80, 0x6f, 0xdc, 0x4,  0xfb, 0x3d, 0x87, 0xdd, 0x69, 0xb4, 0x1e, 0x27, 0x0,  0x0,
                   0x78, 0xf8, 0x1f, 0x0,  0xd,  0x9d, 0x33, 0x55, 0x1d, 0x8b, 0x31, 0x2d, 0xfa, 0x1,  0xb1, 0xf5, 0x80,
                   0x2,  0x9,  0x0,  0xd,  0x4,  0xbd, 0x0,  0x6f, 0x57, 0x6a, 0x41, 0xb1, 0xed, 0xa8, 0xd7, 0x2d, 0xe1,
                   0x28, 0xb,  0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70, 0x3e, 0x71, 0x3d,
                   0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x44, 0x1a, 0x63, 0xe0, 0x13, 0xca, 0x33, 0xbb, 0x38, 0x34, 0x54, 0xf0};
  lwmqtt_string_t exp_topic = {12, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x45, 0x56, 0xae, 0x2e, 0xb7, 0x31, 0x51, 0x11, 0xd8, 0x56, 0xcb, 0x70, 0x3e,
                              0x71, 0x3d, 0x78, 0x84, 0xa3, 0x28, 0xef, 0x8f, 0x87, 0x62, 0xec, 0x89, 0x36};
  lwmqtt_string_t exp_body = {26, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 22665);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 12);
  EXPECT_EQ(msg.payload_len, 26);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 26);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\230\f\162\233\EOT\DC3\171\130\175!\217\131n\254\197\128m$;\254w\217O\ETX0\241c\223", _pubPktID = 0, _pubBody =
// ";]t:N\225`\ETX\239\239R\FS\135\144", _pubProps = [PropRequestProblemInformation
// 94,PropSubscriptionIdentifierAvailable 215,PropUserProperty "\229"
// "\246\173\&5\184\&1\a)\174\169p\228Rz\241\n}9j\215\&1\220~\187\SYN\168\149\DELe(\215",PropSubscriptionIdentifier
// 28,PropResponseTopic "Y\213\SOHf;a\135\217",PropContentType
// "\v\135\236su\221\217\202\247\152\&1?\227ycg",PropUserProperty "\DEL\200L\174_\175\242\200" "\199",PropMaximumQoS
// 242,PropReceiveMaximum 3177,PropAuthenticationMethod "\135\238",PropMessageExpiryInterval 25546]}
TEST(Publish5QCTest, Encode21) {
  uint8_t pkt[] = {0x39, 0x92, 0x1,  0x0,  0x1c, 0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83,
                   0x6e, 0xfe, 0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf, 0x65,
                   0x17, 0x5e, 0x29, 0xd7, 0x26, 0x0,  0x1,  0xe5, 0x0,  0x1e, 0xf6, 0xad, 0x35, 0xb8, 0x31, 0x7,  0x29,
                   0xae, 0xa9, 0x70, 0xe4, 0x52, 0x7a, 0xf1, 0xa,  0x7d, 0x39, 0x6a, 0xd7, 0x31, 0xdc, 0x7e, 0xbb, 0x16,
                   0xa8, 0x95, 0x7f, 0x65, 0x28, 0xd7, 0xb,  0x1c, 0x8,  0x0,  0x8,  0x59, 0xd5, 0x1,  0x66, 0x3b, 0x61,
                   0x87, 0xd9, 0x3,  0x0,  0x10, 0xb,  0x87, 0xec, 0x73, 0x75, 0xdd, 0xd9, 0xca, 0xf7, 0x98, 0x31, 0x3f,
                   0xe3, 0x79, 0x63, 0x67, 0x26, 0x0,  0x8,  0x7f, 0xc8, 0x4c, 0xae, 0x5f, 0xaf, 0xf2, 0xc8, 0x0,  0x1,
                   0xc7, 0x24, 0xf2, 0x21, 0xc,  0x69, 0x15, 0x0,  0x2,  0x87, 0xee, 0x2,  0x0,  0x0,  0x63, 0xca, 0x3b,
                   0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3,  0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  uint8_t topic_bytes[] = {0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83, 0x6e, 0xfe,
                           0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x3b, 0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3, 0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 14;

  uint8_t bytesprops1[] = {0xf6, 0xad, 0x35, 0xb8, 0x31, 0x7,  0x29, 0xae, 0xa9, 0x70, 0xe4, 0x52, 0x7a, 0xf1, 0xa,
                           0x7d, 0x39, 0x6a, 0xd7, 0x31, 0xdc, 0x7e, 0xbb, 0x16, 0xa8, 0x95, 0x7f, 0x65, 0x28, 0xd7};
  uint8_t bytesprops0[] = {0xe5};
  uint8_t bytesprops2[] = {0x59, 0xd5, 0x1, 0x66, 0x3b, 0x61, 0x87, 0xd9};
  uint8_t bytesprops3[] = {0xb,  0x87, 0xec, 0x73, 0x75, 0xdd, 0xd9, 0xca,
                           0xf7, 0x98, 0x31, 0x3f, 0xe3, 0x79, 0x63, 0x67};
  uint8_t bytesprops5[] = {0xc7};
  uint8_t bytesprops4[] = {0x7f, 0xc8, 0x4c, 0xae, 0x5f, 0xaf, 0xf2, 0xc8};
  uint8_t bytesprops6[] = {0x87, 0xee};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops0}, .v = {30, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops4}, .v = {1, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3177}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25546}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "\230\f\162\233\EOT\DC3\171\130\175!\217\131n\254\197\128m$;\254w\217O\ETX0\241c\223", _pubPktID = 0, _pubBody =
// ";]t:N\225`\ETX\239\239R\FS\135\144", _pubProps = [PropRequestProblemInformation
// 94,PropSubscriptionIdentifierAvailable 215,PropUserProperty "\229"
// "\246\173\&5\184\&1\a)\174\169p\228Rz\241\n}9j\215\&1\220~\187\SYN\168\149\DELe(\215",PropSubscriptionIdentifier
// 28,PropResponseTopic "Y\213\SOHf;a\135\217",PropContentType
// "\v\135\236su\221\217\202\247\152\&1?\227ycg",PropUserProperty "\DEL\200L\174_\175\242\200" "\199",PropMaximumQoS
// 242,PropReceiveMaximum 3177,PropAuthenticationMethod "\135\238",PropMessageExpiryInterval 25546]}
TEST(Publish5QCTest, Decode21) {
  uint8_t pkt[] = {0x39, 0x92, 0x1,  0x0,  0x1c, 0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83,
                   0x6e, 0xfe, 0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf, 0x65,
                   0x17, 0x5e, 0x29, 0xd7, 0x26, 0x0,  0x1,  0xe5, 0x0,  0x1e, 0xf6, 0xad, 0x35, 0xb8, 0x31, 0x7,  0x29,
                   0xae, 0xa9, 0x70, 0xe4, 0x52, 0x7a, 0xf1, 0xa,  0x7d, 0x39, 0x6a, 0xd7, 0x31, 0xdc, 0x7e, 0xbb, 0x16,
                   0xa8, 0x95, 0x7f, 0x65, 0x28, 0xd7, 0xb,  0x1c, 0x8,  0x0,  0x8,  0x59, 0xd5, 0x1,  0x66, 0x3b, 0x61,
                   0x87, 0xd9, 0x3,  0x0,  0x10, 0xb,  0x87, 0xec, 0x73, 0x75, 0xdd, 0xd9, 0xca, 0xf7, 0x98, 0x31, 0x3f,
                   0xe3, 0x79, 0x63, 0x67, 0x26, 0x0,  0x8,  0x7f, 0xc8, 0x4c, 0xae, 0x5f, 0xaf, 0xf2, 0xc8, 0x0,  0x1,
                   0xc7, 0x24, 0xf2, 0x21, 0xc,  0x69, 0x15, 0x0,  0x2,  0x87, 0xee, 0x2,  0x0,  0x0,  0x63, 0xca, 0x3b,
                   0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3,  0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xe6, 0xc,  0xa2, 0xe9, 0x4,  0x13, 0xab, 0x82, 0xaf, 0x21, 0xd9, 0x83, 0x6e, 0xfe,
                               0xc5, 0x80, 0x6d, 0x24, 0x3b, 0xfe, 0x77, 0xd9, 0x4f, 0x3,  0x30, 0xf1, 0x63, 0xdf};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x3b, 0x5d, 0x74, 0x3a, 0x4e, 0xe1, 0x60, 0x3, 0xef, 0xef, 0x52, 0x1c, 0x87, 0x90};
  lwmqtt_string_t exp_body = {14, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 14);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 14);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\DEL\ETX\153\229\248dS\153`\SOH\167\230\142f\DC1\233\135#<\250\245dX!\172\177\&9,\148", _pubPktID = 23552, _pubBody
// = "\165\207\195k*4\RS", _pubProps = [PropTopicAliasMaximum 20288,PropMaximumQoS 217]}
TEST(Publish5QCTest, Encode22) {
  uint8_t pkt[] = {0x3d, 0x2e, 0x0,  0x1d, 0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,  0xa7, 0xe6,
                   0x8e, 0x66, 0x11, 0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21, 0xac, 0xb1, 0x39, 0x2c,
                   0x94, 0x5c, 0x0,  0x5,  0x22, 0x4f, 0x40, 0x24, 0xd9, 0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  uint8_t topic_bytes[] = {0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,  0xa7, 0xe6, 0x8e, 0x66, 0x11,
                           0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21, 0xac, 0xb1, 0x39, 0x2c, 0x94};
  lwmqtt_string_t topic = {29, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 7;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20288}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 217}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 23552, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\DEL\ETX\153\229\248dS\153`\SOH\167\230\142f\DC1\233\135#<\250\245dX!\172\177\&9,\148", _pubPktID = 23552, _pubBody
// = "\165\207\195k*4\RS", _pubProps = [PropTopicAliasMaximum 20288,PropMaximumQoS 217]}
TEST(Publish5QCTest, Decode22) {
  uint8_t pkt[] = {0x3d, 0x2e, 0x0,  0x1d, 0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,  0xa7, 0xe6,
                   0x8e, 0x66, 0x11, 0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21, 0xac, 0xb1, 0x39, 0x2c,
                   0x94, 0x5c, 0x0,  0x5,  0x22, 0x4f, 0x40, 0x24, 0xd9, 0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x7f, 0x3,  0x99, 0xe5, 0xf8, 0x64, 0x53, 0x99, 0x60, 0x1,  0xa7, 0xe6, 0x8e, 0x66, 0x11,
                               0xe9, 0x87, 0x23, 0x3c, 0xfa, 0xf5, 0x64, 0x58, 0x21, 0xac, 0xb1, 0x39, 0x2c, 0x94};
  lwmqtt_string_t exp_topic = {29, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xa5, 0xcf, 0xc3, 0x6b, 0x2a, 0x34, 0x1e};
  lwmqtt_string_t exp_body = {7, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 23552);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 29);
  EXPECT_EQ(msg.payload_len, 7);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 7);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\163\132d\157\149", _pubPktID =
// 24502, _pubBody = "\224h\ACK", _pubProps = [PropPayloadFormatIndicator 187,PropResponseInformation
// ".*R\129t\184\132\SUB\242\DLE2\NAK,\143\210\228c\205\161\215\190\237\179?\132\234[y",PropSubscriptionIdentifierAvailable
// 240,PropAssignedClientIdentifier "o",PropWillDelayInterval 26051,PropMaximumQoS 161,PropResponseInformation
// "\190\DC3\DC2|G\249q\226\RS\234\&7\157\ETX",PropAuthenticationMethod "z\249i\131&\198\228K",PropMessageExpiryInterval
// 6283,PropResponseTopic
// "\NAK\134\DEL\151qC\134\ESC;\247\184Dviu=\191\170\145\140\248\DC1\130\191F(z\SUB",PropAuthenticationMethod "Y\\N-
// \156\253\226\133}\147",PropSubscriptionIdentifierAvailable 116,PropAuthenticationData
// "\219n\154\210\157J\152\FSy\147`\CANN\245\197#C\190\128z\239\197",PropServerKeepAlive 1560,PropPayloadFormatIndicator
// 234,PropSharedSubscriptionAvailable 60,PropUserProperty
// "\224\184V\SYN\204\172\&4p\194\161\179,\220\&2$Y\129\DC2\233X\136\&3\233"
// "\253L\236\\\187Y\242FO-7d\145",PropPayloadFormatIndicator 5,PropServerReference
// "\250\DC1MA,\252\243\147\209^[\252\249\r",PropAuthenticationData
// "{V\255|\170\183%i\135\166a\254w\169\185xh$",PropMaximumQoS 99,PropServerReference
// "\137_\191\221\195;\207.",PropReceiveMaximum 1647]}
TEST(Publish5QCTest, Encode23) {
  uint8_t pkt[] = {0x34, 0x8c, 0x2,  0x0,  0x5,  0xa3, 0x84, 0x64, 0x9d, 0x95, 0x5f, 0xb6, 0xfe, 0x1,  0x1,  0xbb, 0x1a,
                   0x0,  0x1c, 0x2e, 0x2a, 0x52, 0x81, 0x74, 0xb8, 0x84, 0x1a, 0xf2, 0x10, 0x32, 0x15, 0x2c, 0x8f, 0xd2,
                   0xe4, 0x63, 0xcd, 0xa1, 0xd7, 0xbe, 0xed, 0xb3, 0x3f, 0x84, 0xea, 0x5b, 0x79, 0x29, 0xf0, 0x12, 0x0,
                   0x1,  0x6f, 0x18, 0x0,  0x0,  0x65, 0xc3, 0x24, 0xa1, 0x1a, 0x0,  0xd,  0xbe, 0x13, 0x12, 0x7c, 0x47,
                   0xf9, 0x71, 0xe2, 0x1e, 0xea, 0x37, 0x9d, 0x3,  0x15, 0x0,  0x8,  0x7a, 0xf9, 0x69, 0x83, 0x26, 0xc6,
                   0xe4, 0x4b, 0x2,  0x0,  0x0,  0x18, 0x8b, 0x8,  0x0,  0x1c, 0x15, 0x86, 0x7f, 0x97, 0x71, 0x43, 0x86,
                   0x1b, 0x3b, 0xf7, 0xb8, 0x44, 0x76, 0x69, 0x75, 0x3d, 0xbf, 0xaa, 0x91, 0x8c, 0xf8, 0x11, 0x82, 0xbf,
                   0x46, 0x28, 0x7a, 0x1a, 0x15, 0x0,  0xb,  0x59, 0x5c, 0x4e, 0x2d, 0x20, 0x9c, 0xfd, 0xe2, 0x85, 0x7d,
                   0x93, 0x29, 0x74, 0x16, 0x0,  0x16, 0xdb, 0x6e, 0x9a, 0xd2, 0x9d, 0x4a, 0x98, 0x1c, 0x79, 0x93, 0x60,
                   0x18, 0x4e, 0xf5, 0xc5, 0x23, 0x43, 0xbe, 0x80, 0x7a, 0xef, 0xc5, 0x13, 0x6,  0x18, 0x1,  0xea, 0x2a,
                   0x3c, 0x26, 0x0,  0x17, 0xe0, 0xb8, 0x56, 0x16, 0xcc, 0xac, 0x34, 0x70, 0xc2, 0xa1, 0xb3, 0x2c, 0xdc,
                   0x32, 0x24, 0x59, 0x81, 0x12, 0xe9, 0x58, 0x88, 0x33, 0xe9, 0x0,  0xd,  0xfd, 0x4c, 0xec, 0x5c, 0xbb,
                   0x59, 0xf2, 0x46, 0x4f, 0x2d, 0x37, 0x64, 0x91, 0x1,  0x5,  0x1c, 0x0,  0xe,  0xfa, 0x11, 0x4d, 0x41,
                   0x2c, 0xfc, 0xf3, 0x93, 0xd1, 0x5e, 0x5b, 0xfc, 0xf9, 0xd,  0x16, 0x0,  0x12, 0x7b, 0x56, 0xff, 0x7c,
                   0xaa, 0xb7, 0x25, 0x69, 0x87, 0xa6, 0x61, 0xfe, 0x77, 0xa9, 0xb9, 0x78, 0x68, 0x24, 0x24, 0x63, 0x1c,
                   0x0,  0x8,  0x89, 0x5f, 0xbf, 0xdd, 0xc3, 0x3b, 0xcf, 0x2e, 0x21, 0x6,  0x6f, 0xe0, 0x68, 0x6};
  uint8_t topic_bytes[] = {0xa3, 0x84, 0x64, 0x9d, 0x95};
  lwmqtt_string_t topic = {5, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xe0, 0x68, 0x6};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0x2e, 0x2a, 0x52, 0x81, 0x74, 0xb8, 0x84, 0x1a, 0xf2, 0x10, 0x32, 0x15, 0x2c, 0x8f,
                           0xd2, 0xe4, 0x63, 0xcd, 0xa1, 0xd7, 0xbe, 0xed, 0xb3, 0x3f, 0x84, 0xea, 0x5b, 0x79};
  uint8_t bytesprops1[] = {0x6f};
  uint8_t bytesprops2[] = {0xbe, 0x13, 0x12, 0x7c, 0x47, 0xf9, 0x71, 0xe2, 0x1e, 0xea, 0x37, 0x9d, 0x3};
  uint8_t bytesprops3[] = {0x7a, 0xf9, 0x69, 0x83, 0x26, 0xc6, 0xe4, 0x4b};
  uint8_t bytesprops4[] = {0x15, 0x86, 0x7f, 0x97, 0x71, 0x43, 0x86, 0x1b, 0x3b, 0xf7, 0xb8, 0x44, 0x76, 0x69,
                           0x75, 0x3d, 0xbf, 0xaa, 0x91, 0x8c, 0xf8, 0x11, 0x82, 0xbf, 0x46, 0x28, 0x7a, 0x1a};
  uint8_t bytesprops5[] = {0x59, 0x5c, 0x4e, 0x2d, 0x20, 0x9c, 0xfd, 0xe2, 0x85, 0x7d, 0x93};
  uint8_t bytesprops6[] = {0xdb, 0x6e, 0x9a, 0xd2, 0x9d, 0x4a, 0x98, 0x1c, 0x79, 0x93, 0x60,
                           0x18, 0x4e, 0xf5, 0xc5, 0x23, 0x43, 0xbe, 0x80, 0x7a, 0xef, 0xc5};
  uint8_t bytesprops8[] = {0xfd, 0x4c, 0xec, 0x5c, 0xbb, 0x59, 0xf2, 0x46, 0x4f, 0x2d, 0x37, 0x64, 0x91};
  uint8_t bytesprops7[] = {0xe0, 0xb8, 0x56, 0x16, 0xcc, 0xac, 0x34, 0x70, 0xc2, 0xa1, 0xb3, 0x2c,
                           0xdc, 0x32, 0x24, 0x59, 0x81, 0x12, 0xe9, 0x58, 0x88, 0x33, 0xe9};
  uint8_t bytesprops9[] = {0xfa, 0x11, 0x4d, 0x41, 0x2c, 0xfc, 0xf3, 0x93, 0xd1, 0x5e, 0x5b, 0xfc, 0xf9, 0xd};
  uint8_t bytesprops10[] = {0x7b, 0x56, 0xff, 0x7c, 0xaa, 0xb7, 0x25, 0x69, 0x87,
                            0xa6, 0x61, 0xfe, 0x77, 0xa9, 0xb9, 0x78, 0x68, 0x24};
  uint8_t bytesprops11[] = {0x89, 0x5f, 0xbf, 0xdd, 0xc3, 0x3b, 0xcf, 0x2e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26051}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6283}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1560}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops7}, .v = {13, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {18, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1647}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 24502, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = False, _pubTopic = "\163\132d\157\149", _pubPktID =
// 24502, _pubBody = "\224h\ACK", _pubProps = [PropPayloadFormatIndicator 187,PropResponseInformation
// ".*R\129t\184\132\SUB\242\DLE2\NAK,\143\210\228c\205\161\215\190\237\179?\132\234[y",PropSubscriptionIdentifierAvailable
// 240,PropAssignedClientIdentifier "o",PropWillDelayInterval 26051,PropMaximumQoS 161,PropResponseInformation
// "\190\DC3\DC2|G\249q\226\RS\234\&7\157\ETX",PropAuthenticationMethod "z\249i\131&\198\228K",PropMessageExpiryInterval
// 6283,PropResponseTopic
// "\NAK\134\DEL\151qC\134\ESC;\247\184Dviu=\191\170\145\140\248\DC1\130\191F(z\SUB",PropAuthenticationMethod "Y\\N-
// \156\253\226\133}\147",PropSubscriptionIdentifierAvailable 116,PropAuthenticationData
// "\219n\154\210\157J\152\FSy\147`\CANN\245\197#C\190\128z\239\197",PropServerKeepAlive 1560,PropPayloadFormatIndicator
// 234,PropSharedSubscriptionAvailable 60,PropUserProperty
// "\224\184V\SYN\204\172\&4p\194\161\179,\220\&2$Y\129\DC2\233X\136\&3\233"
// "\253L\236\\\187Y\242FO-7d\145",PropPayloadFormatIndicator 5,PropServerReference
// "\250\DC1MA,\252\243\147\209^[\252\249\r",PropAuthenticationData
// "{V\255|\170\183%i\135\166a\254w\169\185xh$",PropMaximumQoS 99,PropServerReference
// "\137_\191\221\195;\207.",PropReceiveMaximum 1647]}
TEST(Publish5QCTest, Decode23) {
  uint8_t pkt[] = {0x34, 0x8c, 0x2,  0x0,  0x5,  0xa3, 0x84, 0x64, 0x9d, 0x95, 0x5f, 0xb6, 0xfe, 0x1,  0x1,  0xbb, 0x1a,
                   0x0,  0x1c, 0x2e, 0x2a, 0x52, 0x81, 0x74, 0xb8, 0x84, 0x1a, 0xf2, 0x10, 0x32, 0x15, 0x2c, 0x8f, 0xd2,
                   0xe4, 0x63, 0xcd, 0xa1, 0xd7, 0xbe, 0xed, 0xb3, 0x3f, 0x84, 0xea, 0x5b, 0x79, 0x29, 0xf0, 0x12, 0x0,
                   0x1,  0x6f, 0x18, 0x0,  0x0,  0x65, 0xc3, 0x24, 0xa1, 0x1a, 0x0,  0xd,  0xbe, 0x13, 0x12, 0x7c, 0x47,
                   0xf9, 0x71, 0xe2, 0x1e, 0xea, 0x37, 0x9d, 0x3,  0x15, 0x0,  0x8,  0x7a, 0xf9, 0x69, 0x83, 0x26, 0xc6,
                   0xe4, 0x4b, 0x2,  0x0,  0x0,  0x18, 0x8b, 0x8,  0x0,  0x1c, 0x15, 0x86, 0x7f, 0x97, 0x71, 0x43, 0x86,
                   0x1b, 0x3b, 0xf7, 0xb8, 0x44, 0x76, 0x69, 0x75, 0x3d, 0xbf, 0xaa, 0x91, 0x8c, 0xf8, 0x11, 0x82, 0xbf,
                   0x46, 0x28, 0x7a, 0x1a, 0x15, 0x0,  0xb,  0x59, 0x5c, 0x4e, 0x2d, 0x20, 0x9c, 0xfd, 0xe2, 0x85, 0x7d,
                   0x93, 0x29, 0x74, 0x16, 0x0,  0x16, 0xdb, 0x6e, 0x9a, 0xd2, 0x9d, 0x4a, 0x98, 0x1c, 0x79, 0x93, 0x60,
                   0x18, 0x4e, 0xf5, 0xc5, 0x23, 0x43, 0xbe, 0x80, 0x7a, 0xef, 0xc5, 0x13, 0x6,  0x18, 0x1,  0xea, 0x2a,
                   0x3c, 0x26, 0x0,  0x17, 0xe0, 0xb8, 0x56, 0x16, 0xcc, 0xac, 0x34, 0x70, 0xc2, 0xa1, 0xb3, 0x2c, 0xdc,
                   0x32, 0x24, 0x59, 0x81, 0x12, 0xe9, 0x58, 0x88, 0x33, 0xe9, 0x0,  0xd,  0xfd, 0x4c, 0xec, 0x5c, 0xbb,
                   0x59, 0xf2, 0x46, 0x4f, 0x2d, 0x37, 0x64, 0x91, 0x1,  0x5,  0x1c, 0x0,  0xe,  0xfa, 0x11, 0x4d, 0x41,
                   0x2c, 0xfc, 0xf3, 0x93, 0xd1, 0x5e, 0x5b, 0xfc, 0xf9, 0xd,  0x16, 0x0,  0x12, 0x7b, 0x56, 0xff, 0x7c,
                   0xaa, 0xb7, 0x25, 0x69, 0x87, 0xa6, 0x61, 0xfe, 0x77, 0xa9, 0xb9, 0x78, 0x68, 0x24, 0x24, 0x63, 0x1c,
                   0x0,  0x8,  0x89, 0x5f, 0xbf, 0xdd, 0xc3, 0x3b, 0xcf, 0x2e, 0x21, 0x6,  0x6f, 0xe0, 0x68, 0x6};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xa3, 0x84, 0x64, 0x9d, 0x95};
  lwmqtt_string_t exp_topic = {5, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xe0, 0x68, 0x6};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 24502);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 5);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\153\164\218\195=\160\170\223\157
// b%X\222\199hG0\198K3y\207\128J\188\176\225", _pubPktID = 0, _pubBody = "\SOH\191\156", _pubProps =
// [PropServerKeepAlive 29860,PropAuthenticationMethod
// "\246\EOT\240\184\137\197\234\173b<\139\208",PropSubscriptionIdentifierAvailable 117]}
TEST(Publish5QCTest, Encode24) {
  uint8_t pkt[] = {0x38, 0x36, 0x0,  0x1c, 0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf, 0x9d, 0x20,
                   0x62, 0x25, 0x58, 0xde, 0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b, 0x33, 0x79, 0xcf, 0x80,
                   0x4a, 0xbc, 0xb0, 0xe1, 0x14, 0x13, 0x74, 0xa4, 0x15, 0x0,  0xc,  0xf6, 0x4,  0xf0,
                   0xb8, 0x89, 0xc5, 0xea, 0xad, 0x62, 0x3c, 0x8b, 0xd0, 0x29, 0x75, 0x1,  0xbf, 0x9c};
  uint8_t topic_bytes[] = {0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf, 0x9d, 0x20, 0x62, 0x25, 0x58, 0xde,
                           0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b, 0x33, 0x79, 0xcf, 0x80, 0x4a, 0xbc, 0xb0, 0xe1};
  lwmqtt_string_t topic = {28, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x1, 0xbf, 0x9c};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 3;

  uint8_t bytesprops0[] = {0xf6, 0x4, 0xf0, 0xb8, 0x89, 0xc5, 0xea, 0xad, 0x62, 0x3c, 0x8b, 0xd0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29860}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 117}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\153\164\218\195=\160\170\223\157
// b%X\222\199hG0\198K3y\207\128J\188\176\225", _pubPktID = 0, _pubBody = "\SOH\191\156", _pubProps =
// [PropServerKeepAlive 29860,PropAuthenticationMethod
// "\246\EOT\240\184\137\197\234\173b<\139\208",PropSubscriptionIdentifierAvailable 117]}
TEST(Publish5QCTest, Decode24) {
  uint8_t pkt[] = {0x38, 0x36, 0x0,  0x1c, 0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf, 0x9d, 0x20,
                   0x62, 0x25, 0x58, 0xde, 0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b, 0x33, 0x79, 0xcf, 0x80,
                   0x4a, 0xbc, 0xb0, 0xe1, 0x14, 0x13, 0x74, 0xa4, 0x15, 0x0,  0xc,  0xf6, 0x4,  0xf0,
                   0xb8, 0x89, 0xc5, 0xea, 0xad, 0x62, 0x3c, 0x8b, 0xd0, 0x29, 0x75, 0x1,  0xbf, 0x9c};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x99, 0xa4, 0xda, 0xc3, 0x3d, 0xa0, 0xaa, 0xdf, 0x9d, 0x20, 0x62, 0x25, 0x58, 0xde,
                               0xc7, 0x68, 0x47, 0x30, 0xc6, 0x4b, 0x33, 0x79, 0xcf, 0x80, 0x4a, 0xbc, 0xb0, 0xe1};
  lwmqtt_string_t exp_topic = {28, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x1, 0xbf, 0x9c};
  lwmqtt_string_t exp_body = {3, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 28);
  EXPECT_EQ(msg.payload_len, 3);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 3);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "Z\162]m\132\183R\SUBWRu", _pubPktID
// = 13838, _pubBody =
// "{&\208\GS\139\141\&9\162*\207\153\136\148\172\STX\190\162e\RS\\\163\194\141\DC1\SYN\156\204\236", _pubProps =
// [PropMaximumQoS 172,PropCorrelationData "(",PropMessageExpiryInterval 4898,PropPayloadFormatIndicator
// 242,PropSubscriptionIdentifierAvailable 76,PropResponseInformation
// "S\154\150\166\EOT\224\208\&9\NUL\190\210]6\179\219\166\173x*",PropAuthenticationData
// "\146X\192<|\200\215\DC1\204\206\a\205,\164\ETB\SI\226;c\ETB4",PropWildcardSubscriptionAvailable 121]}
TEST(Publish5QCTest, Encode25) {
  uint8_t pkt[] = {0x3a, 0x6b, 0x0,  0xb,  0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75, 0x36,
                   0xe,  0x3f, 0x24, 0xac, 0x9,  0x0,  0x1,  0x28, 0x2,  0x0,  0x0,  0x13, 0x22, 0x1,  0xf2, 0x29,
                   0x4c, 0x1a, 0x0,  0x13, 0x53, 0x9a, 0x96, 0xa6, 0x4,  0xe0, 0xd0, 0x39, 0x0,  0xbe, 0xd2, 0x5d,
                   0x36, 0xb3, 0xdb, 0xa6, 0xad, 0x78, 0x2a, 0x16, 0x0,  0x15, 0x92, 0x58, 0xc0, 0x3c, 0x7c, 0xc8,
                   0xd7, 0x11, 0xcc, 0xce, 0x7,  0xcd, 0x2c, 0xa4, 0x17, 0xf,  0xe2, 0x3b, 0x63, 0x17, 0x34, 0x28,
                   0x79, 0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94, 0xac, 0x2,
                   0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  uint8_t topic_bytes[] = {0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75};
  lwmqtt_string_t topic = {11, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94, 0xac,
                         0x2,  0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 28;

  uint8_t bytesprops0[] = {0x28};
  uint8_t bytesprops1[] = {0x53, 0x9a, 0x96, 0xa6, 0x4,  0xe0, 0xd0, 0x39, 0x0, 0xbe,
                           0xd2, 0x5d, 0x36, 0xb3, 0xdb, 0xa6, 0xad, 0x78, 0x2a};
  uint8_t bytesprops2[] = {0x92, 0x58, 0xc0, 0x3c, 0x7c, 0xc8, 0xd7, 0x11, 0xcc, 0xce, 0x7,
                           0xcd, 0x2c, 0xa4, 0x17, 0xf,  0xe2, 0x3b, 0x63, 0x17, 0x34};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4898}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 121}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 13838, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic = "Z\162]m\132\183R\SUBWRu", _pubPktID
// = 13838, _pubBody =
// "{&\208\GS\139\141\&9\162*\207\153\136\148\172\STX\190\162e\RS\\\163\194\141\DC1\SYN\156\204\236", _pubProps =
// [PropMaximumQoS 172,PropCorrelationData "(",PropMessageExpiryInterval 4898,PropPayloadFormatIndicator
// 242,PropSubscriptionIdentifierAvailable 76,PropResponseInformation
// "S\154\150\166\EOT\224\208\&9\NUL\190\210]6\179\219\166\173x*",PropAuthenticationData
// "\146X\192<|\200\215\DC1\204\206\a\205,\164\ETB\SI\226;c\ETB4",PropWildcardSubscriptionAvailable 121]}
TEST(Publish5QCTest, Decode25) {
  uint8_t pkt[] = {0x3a, 0x6b, 0x0,  0xb,  0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75, 0x36,
                   0xe,  0x3f, 0x24, 0xac, 0x9,  0x0,  0x1,  0x28, 0x2,  0x0,  0x0,  0x13, 0x22, 0x1,  0xf2, 0x29,
                   0x4c, 0x1a, 0x0,  0x13, 0x53, 0x9a, 0x96, 0xa6, 0x4,  0xe0, 0xd0, 0x39, 0x0,  0xbe, 0xd2, 0x5d,
                   0x36, 0xb3, 0xdb, 0xa6, 0xad, 0x78, 0x2a, 0x16, 0x0,  0x15, 0x92, 0x58, 0xc0, 0x3c, 0x7c, 0xc8,
                   0xd7, 0x11, 0xcc, 0xce, 0x7,  0xcd, 0x2c, 0xa4, 0x17, 0xf,  0xe2, 0x3b, 0x63, 0x17, 0x34, 0x28,
                   0x79, 0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94, 0xac, 0x2,
                   0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x5a, 0xa2, 0x5d, 0x6d, 0x84, 0xb7, 0x52, 0x1a, 0x57, 0x52, 0x75};
  lwmqtt_string_t exp_topic = {11, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x7b, 0x26, 0xd0, 0x1d, 0x8b, 0x8d, 0x39, 0xa2, 0x2a, 0xcf, 0x99, 0x88, 0x94, 0xac,
                              0x2,  0xbe, 0xa2, 0x65, 0x1e, 0x5c, 0xa3, 0xc2, 0x8d, 0x11, 0x16, 0x9c, 0xcc, 0xec};
  lwmqtt_string_t exp_body = {28, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 13838);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 11);
  EXPECT_EQ(msg.payload_len, 28);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 28);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\245\STX\252\CAN\215\187\FS^!\141\191\250|\190\164I\153\169,U`", _pubPktID = 10215, _pubBody =
// "\199r\153\234\&0UY.\201J\198\SO", _pubProps = [PropWildcardSubscriptionAvailable 107,PropMaximumPacketSize
// 1844,PropContentType "\US\202C\131\167o",PropResponseTopic "",PropSubscriptionIdentifierAvailable
// 105,PropSubscriptionIdentifierAvailable 186,PropReasonString "Ry\SUB\\",PropTopicAlias 32557,PropMaximumQoS
// 23,PropRequestProblemInformation 72,PropSessionExpiryInterval 30830,PropTopicAlias 29267,PropTopicAlias
// 1624,PropReceiveMaximum 23007,PropRetainAvailable 148]}
TEST(Publish5QCTest, Encode26) {
  uint8_t pkt[] = {0x33, 0x5b, 0x0,  0x15, 0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21, 0x8d, 0xbf, 0xfa,
                   0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60, 0x27, 0xe7, 0x35, 0x28, 0x6b, 0x27, 0x0,
                   0x0,  0x7,  0x34, 0x3,  0x0,  0x6,  0x1f, 0xca, 0x43, 0x83, 0xa7, 0x6f, 0x8,  0x0,  0x0,  0x29,
                   0x69, 0x29, 0xba, 0x1f, 0x0,  0x4,  0x52, 0x79, 0x1a, 0x5c, 0x23, 0x7f, 0x2d, 0x24, 0x17, 0x17,
                   0x48, 0x11, 0x0,  0x0,  0x78, 0x6e, 0x23, 0x72, 0x53, 0x23, 0x6,  0x58, 0x21, 0x59, 0xdf, 0x25,
                   0x94, 0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  uint8_t topic_bytes[] = {0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21, 0x8d, 0xbf,
                           0xfa, 0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60};
  lwmqtt_string_t topic = {21, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 12;

  uint8_t bytesprops0[] = {0x1f, 0xca, 0x43, 0x83, 0xa7, 0x6f};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x52, 0x79, 0x1a, 0x5c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1844}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 186}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32557}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30830}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29267}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 1624}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23007}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 148}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 10215, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS1, _pubRetain = True, _pubTopic =
// "\245\STX\252\CAN\215\187\FS^!\141\191\250|\190\164I\153\169,U`", _pubPktID = 10215, _pubBody =
// "\199r\153\234\&0UY.\201J\198\SO", _pubProps = [PropWildcardSubscriptionAvailable 107,PropMaximumPacketSize
// 1844,PropContentType "\US\202C\131\167o",PropResponseTopic "",PropSubscriptionIdentifierAvailable
// 105,PropSubscriptionIdentifierAvailable 186,PropReasonString "Ry\SUB\\",PropTopicAlias 32557,PropMaximumQoS
// 23,PropRequestProblemInformation 72,PropSessionExpiryInterval 30830,PropTopicAlias 29267,PropTopicAlias
// 1624,PropReceiveMaximum 23007,PropRetainAvailable 148]}
TEST(Publish5QCTest, Decode26) {
  uint8_t pkt[] = {0x33, 0x5b, 0x0,  0x15, 0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21, 0x8d, 0xbf, 0xfa,
                   0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60, 0x27, 0xe7, 0x35, 0x28, 0x6b, 0x27, 0x0,
                   0x0,  0x7,  0x34, 0x3,  0x0,  0x6,  0x1f, 0xca, 0x43, 0x83, 0xa7, 0x6f, 0x8,  0x0,  0x0,  0x29,
                   0x69, 0x29, 0xba, 0x1f, 0x0,  0x4,  0x52, 0x79, 0x1a, 0x5c, 0x23, 0x7f, 0x2d, 0x24, 0x17, 0x17,
                   0x48, 0x11, 0x0,  0x0,  0x78, 0x6e, 0x23, 0x72, 0x53, 0x23, 0x6,  0x58, 0x21, 0x59, 0xdf, 0x25,
                   0x94, 0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xf5, 0x2,  0xfc, 0x18, 0xd7, 0xbb, 0x1c, 0x5e, 0x21, 0x8d, 0xbf,
                               0xfa, 0x7c, 0xbe, 0xa4, 0x49, 0x99, 0xa9, 0x2c, 0x55, 0x60};
  lwmqtt_string_t exp_topic = {21, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xc7, 0x72, 0x99, 0xea, 0x30, 0x55, 0x59, 0x2e, 0xc9, 0x4a, 0xc6, 0xe};
  lwmqtt_string_t exp_body = {12, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 10215);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 21);
  EXPECT_EQ(msg.payload_len, 12);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 12);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\187\192\216\&6]J\244\v\252\&6\149\EOT\128\ETX", _pubPktID = 11476, _pubBody =
// "\254&\138\150\179\238u\252\176\246'\140\196", _pubProps = [PropServerReference
// "\158s\136m\193\205\148G\247g\SI\GS\NAK\188\135\r"]}
TEST(Publish5QCTest, Encode27) {
  uint8_t pkt[] = {0x3a, 0x33, 0x0,  0xe,  0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb,  0xfc, 0x36,
                   0x95, 0x4,  0x80, 0x3,  0x2c, 0xd4, 0x13, 0x1c, 0x0,  0x10, 0x9e, 0x73, 0x88, 0x6d,
                   0xc1, 0xcd, 0x94, 0x47, 0xf7, 0x67, 0xf,  0x1d, 0x15, 0xbc, 0x87, 0xd,  0xfe, 0x26,
                   0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  uint8_t topic_bytes[] = {0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb, 0xfc, 0x36, 0x95, 0x4, 0x80, 0x3};
  lwmqtt_string_t topic = {14, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS1;
  msg.retained = false;
  uint8_t msg_bytes[] = {0xfe, 0x26, 0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 13;

  uint8_t bytesprops0[] = {0x9e, 0x73, 0x88, 0x6d, 0xc1, 0xcd, 0x94, 0x47,
                           0xf7, 0x67, 0xf,  0x1d, 0x15, 0xbc, 0x87, 0xd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, true, 11476, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = True, _pubQoS = QoS1, _pubRetain = False, _pubTopic =
// "\187\192\216\&6]J\244\v\252\&6\149\EOT\128\ETX", _pubPktID = 11476, _pubBody =
// "\254&\138\150\179\238u\252\176\246'\140\196", _pubProps = [PropServerReference
// "\158s\136m\193\205\148G\247g\SI\GS\NAK\188\135\r"]}
TEST(Publish5QCTest, Decode27) {
  uint8_t pkt[] = {0x3a, 0x33, 0x0,  0xe,  0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb,  0xfc, 0x36,
                   0x95, 0x4,  0x80, 0x3,  0x2c, 0xd4, 0x13, 0x1c, 0x0,  0x10, 0x9e, 0x73, 0x88, 0x6d,
                   0xc1, 0xcd, 0x94, 0x47, 0xf7, 0x67, 0xf,  0x1d, 0x15, 0xbc, 0x87, 0xd,  0xfe, 0x26,
                   0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0xbb, 0xc0, 0xd8, 0x36, 0x5d, 0x4a, 0xf4, 0xb, 0xfc, 0x36, 0x95, 0x4, 0x80, 0x3};
  lwmqtt_string_t exp_topic = {14, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xfe, 0x26, 0x8a, 0x96, 0xb3, 0xee, 0x75, 0xfc, 0xb0, 0xf6, 0x27, 0x8c, 0xc4};
  lwmqtt_string_t exp_body = {13, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, true);
  EXPECT_EQ(msg.qos, LWMQTT_QOS1);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 11476);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 14);
  EXPECT_EQ(msg.payload_len, 13);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 13);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "/\USs\188\193\156\202\143\244\215\159fj\184\STX\DC3\217", _pubPktID = 0, _pubBody = "\213T\157\156*`\174Ad\219\206",
// _pubProps = [PropServerKeepAlive 4269,PropRequestProblemInformation 153,PropServerKeepAlive
// 27842,PropMessageExpiryInterval 1195,PropMaximumQoS 247,PropMessageExpiryInterval 16305,PropReasonString
// "\223\146\n\193=EP\214\252+\245",PropTopicAliasMaximum 5510,PropServerReference
// "i\250S\ETB\179\t4Af$\255\173\188\204\STX\236\165",PropServerKeepAlive 9985,PropResponseTopic
// ":\219f\210",PropServerKeepAlive 3868,PropMaximumPacketSize 7322,PropContentType
// "\213\128\229\164F$\188\238L\161\STX\143",PropSubscriptionIdentifierAvailable 38,PropUserProperty
// "\198\NAK\NAKY<\165\a\220\161\US\207\SYN\227\&3\194\179\137lp ww,\FS\ETB\ETB\DC2\132\195"
// "D\181\230\136\&8@\STX\212\EM/3R\186\167\&4\157\145\187\227\ENQ\250\151\&0\225\174",PropSharedSubscriptionAvailable
// 204,PropRetainAvailable 215,PropWillDelayInterval 7511,PropServerKeepAlive 30724,PropWildcardSubscriptionAvailable
// 219,PropMaximumQoS 149,PropMessageExpiryInterval 21863,PropUserProperty ""
// "\218\186\SO\DC2\143\139\242\136_\129P\EM\144\243up\144\231\DC2",PropMaximumQoS 53,PropServerReference
// "\DLEG\146=}|\NUL\131\228#Y0\EM\129~\139$\136T\STX\225\194\158]\DC4\"",PropMaximumPacketSize 3760]}
TEST(Publish5QCTest, Encode28) {
  uint8_t pkt[] = {0x31, 0x88, 0x2,  0x0,  0x11, 0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4, 0xd7, 0x9f, 0x66,
                   0x6a, 0xb8, 0x2,  0x13, 0xd9, 0xe8, 0x1,  0x13, 0x10, 0xad, 0x17, 0x99, 0x13, 0x6c, 0xc2, 0x2,  0x0,
                   0x0,  0x4,  0xab, 0x24, 0xf7, 0x2,  0x0,  0x0,  0x3f, 0xb1, 0x1f, 0x0,  0xb,  0xdf, 0x92, 0xa,  0xc1,
                   0x3d, 0x45, 0x50, 0xd6, 0xfc, 0x2b, 0xf5, 0x22, 0x15, 0x86, 0x1c, 0x0,  0x11, 0x69, 0xfa, 0x53, 0x17,
                   0xb3, 0x9,  0x34, 0x41, 0x66, 0x24, 0xff, 0xad, 0xbc, 0xcc, 0x2,  0xec, 0xa5, 0x13, 0x27, 0x1,  0x8,
                   0x0,  0x4,  0x3a, 0xdb, 0x66, 0xd2, 0x13, 0xf,  0x1c, 0x27, 0x0,  0x0,  0x1c, 0x9a, 0x3,  0x0,  0xc,
                   0xd5, 0x80, 0xe5, 0xa4, 0x46, 0x24, 0xbc, 0xee, 0x4c, 0xa1, 0x2,  0x8f, 0x29, 0x26, 0x26, 0x0,  0x1d,
                   0xc6, 0x15, 0x15, 0x59, 0x3c, 0xa5, 0x7,  0xdc, 0xa1, 0x1f, 0xcf, 0x16, 0xe3, 0x33, 0xc2, 0xb3, 0x89,
                   0x6c, 0x70, 0x20, 0x77, 0x77, 0x2c, 0x1c, 0x17, 0x17, 0x12, 0x84, 0xc3, 0x0,  0x19, 0x44, 0xb5, 0xe6,
                   0x88, 0x38, 0x40, 0x2,  0xd4, 0x19, 0x2f, 0x33, 0x52, 0xba, 0xa7, 0x34, 0x9d, 0x91, 0xbb, 0xe3, 0x5,
                   0xfa, 0x97, 0x30, 0xe1, 0xae, 0x2a, 0xcc, 0x25, 0xd7, 0x18, 0x0,  0x0,  0x1d, 0x57, 0x13, 0x78, 0x4,
                   0x28, 0xdb, 0x24, 0x95, 0x2,  0x0,  0x0,  0x55, 0x67, 0x26, 0x0,  0x0,  0x0,  0x13, 0xda, 0xba, 0xe,
                   0x12, 0x8f, 0x8b, 0xf2, 0x88, 0x5f, 0x81, 0x50, 0x19, 0x90, 0xf3, 0x75, 0x70, 0x90, 0xe7, 0x12, 0x24,
                   0x35, 0x1c, 0x0,  0x1a, 0x10, 0x47, 0x92, 0x3d, 0x7d, 0x7c, 0x0,  0x83, 0xe4, 0x23, 0x59, 0x30, 0x19,
                   0x81, 0x7e, 0x8b, 0x24, 0x88, 0x54, 0x2,  0xe1, 0xc2, 0x9e, 0x5d, 0x14, 0x22, 0x27, 0x0,  0x0,  0xe,
                   0xb0, 0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  uint8_t topic_bytes[] = {0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4,
                           0xd7, 0x9f, 0x66, 0x6a, 0xb8, 0x2,  0x13, 0xd9};
  lwmqtt_string_t topic = {17, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = true;
  uint8_t msg_bytes[] = {0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 11;

  uint8_t bytesprops0[] = {0xdf, 0x92, 0xa, 0xc1, 0x3d, 0x45, 0x50, 0xd6, 0xfc, 0x2b, 0xf5};
  uint8_t bytesprops1[] = {0x69, 0xfa, 0x53, 0x17, 0xb3, 0x9, 0x34, 0x41, 0x66,
                           0x24, 0xff, 0xad, 0xbc, 0xcc, 0x2, 0xec, 0xa5};
  uint8_t bytesprops2[] = {0x3a, 0xdb, 0x66, 0xd2};
  uint8_t bytesprops3[] = {0xd5, 0x80, 0xe5, 0xa4, 0x46, 0x24, 0xbc, 0xee, 0x4c, 0xa1, 0x2, 0x8f};
  uint8_t bytesprops5[] = {0x44, 0xb5, 0xe6, 0x88, 0x38, 0x40, 0x2, 0xd4, 0x19, 0x2f, 0x33, 0x52, 0xba,
                           0xa7, 0x34, 0x9d, 0x91, 0xbb, 0xe3, 0x5, 0xfa, 0x97, 0x30, 0xe1, 0xae};
  uint8_t bytesprops4[] = {0xc6, 0x15, 0x15, 0x59, 0x3c, 0xa5, 0x7,  0xdc, 0xa1, 0x1f, 0xcf, 0x16, 0xe3, 0x33, 0xc2,
                           0xb3, 0x89, 0x6c, 0x70, 0x20, 0x77, 0x77, 0x2c, 0x1c, 0x17, 0x17, 0x12, 0x84, 0xc3};
  uint8_t bytesprops7[] = {0xda, 0xba, 0xe,  0x12, 0x8f, 0x8b, 0xf2, 0x88, 0x5f, 0x81,
                           0x50, 0x19, 0x90, 0xf3, 0x75, 0x70, 0x90, 0xe7, 0x12};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops8[] = {0x10, 0x47, 0x92, 0x3d, 0x7d, 0x7c, 0x0, 0x83, 0xe4, 0x23, 0x59, 0x30, 0x19,
                           0x81, 0x7e, 0x8b, 0x24, 0x88, 0x54, 0x2, 0xe1, 0xc2, 0x9e, 0x5d, 0x14, 0x22};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4269}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27842}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1195}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16305}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5510}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9985}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3868}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7322}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops4}, .v = {25, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 204}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7511}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 30724}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21863}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops6}, .v = {19, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3760}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = True, _pubTopic =
// "/\USs\188\193\156\202\143\244\215\159fj\184\STX\DC3\217", _pubPktID = 0, _pubBody = "\213T\157\156*`\174Ad\219\206",
// _pubProps = [PropServerKeepAlive 4269,PropRequestProblemInformation 153,PropServerKeepAlive
// 27842,PropMessageExpiryInterval 1195,PropMaximumQoS 247,PropMessageExpiryInterval 16305,PropReasonString
// "\223\146\n\193=EP\214\252+\245",PropTopicAliasMaximum 5510,PropServerReference
// "i\250S\ETB\179\t4Af$\255\173\188\204\STX\236\165",PropServerKeepAlive 9985,PropResponseTopic
// ":\219f\210",PropServerKeepAlive 3868,PropMaximumPacketSize 7322,PropContentType
// "\213\128\229\164F$\188\238L\161\STX\143",PropSubscriptionIdentifierAvailable 38,PropUserProperty
// "\198\NAK\NAKY<\165\a\220\161\US\207\SYN\227\&3\194\179\137lp ww,\FS\ETB\ETB\DC2\132\195"
// "D\181\230\136\&8@\STX\212\EM/3R\186\167\&4\157\145\187\227\ENQ\250\151\&0\225\174",PropSharedSubscriptionAvailable
// 204,PropRetainAvailable 215,PropWillDelayInterval 7511,PropServerKeepAlive 30724,PropWildcardSubscriptionAvailable
// 219,PropMaximumQoS 149,PropMessageExpiryInterval 21863,PropUserProperty ""
// "\218\186\SO\DC2\143\139\242\136_\129P\EM\144\243up\144\231\DC2",PropMaximumQoS 53,PropServerReference
// "\DLEG\146=}|\NUL\131\228#Y0\EM\129~\139$\136T\STX\225\194\158]\DC4\"",PropMaximumPacketSize 3760]}
TEST(Publish5QCTest, Decode28) {
  uint8_t pkt[] = {0x31, 0x88, 0x2,  0x0,  0x11, 0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4, 0xd7, 0x9f, 0x66,
                   0x6a, 0xb8, 0x2,  0x13, 0xd9, 0xe8, 0x1,  0x13, 0x10, 0xad, 0x17, 0x99, 0x13, 0x6c, 0xc2, 0x2,  0x0,
                   0x0,  0x4,  0xab, 0x24, 0xf7, 0x2,  0x0,  0x0,  0x3f, 0xb1, 0x1f, 0x0,  0xb,  0xdf, 0x92, 0xa,  0xc1,
                   0x3d, 0x45, 0x50, 0xd6, 0xfc, 0x2b, 0xf5, 0x22, 0x15, 0x86, 0x1c, 0x0,  0x11, 0x69, 0xfa, 0x53, 0x17,
                   0xb3, 0x9,  0x34, 0x41, 0x66, 0x24, 0xff, 0xad, 0xbc, 0xcc, 0x2,  0xec, 0xa5, 0x13, 0x27, 0x1,  0x8,
                   0x0,  0x4,  0x3a, 0xdb, 0x66, 0xd2, 0x13, 0xf,  0x1c, 0x27, 0x0,  0x0,  0x1c, 0x9a, 0x3,  0x0,  0xc,
                   0xd5, 0x80, 0xe5, 0xa4, 0x46, 0x24, 0xbc, 0xee, 0x4c, 0xa1, 0x2,  0x8f, 0x29, 0x26, 0x26, 0x0,  0x1d,
                   0xc6, 0x15, 0x15, 0x59, 0x3c, 0xa5, 0x7,  0xdc, 0xa1, 0x1f, 0xcf, 0x16, 0xe3, 0x33, 0xc2, 0xb3, 0x89,
                   0x6c, 0x70, 0x20, 0x77, 0x77, 0x2c, 0x1c, 0x17, 0x17, 0x12, 0x84, 0xc3, 0x0,  0x19, 0x44, 0xb5, 0xe6,
                   0x88, 0x38, 0x40, 0x2,  0xd4, 0x19, 0x2f, 0x33, 0x52, 0xba, 0xa7, 0x34, 0x9d, 0x91, 0xbb, 0xe3, 0x5,
                   0xfa, 0x97, 0x30, 0xe1, 0xae, 0x2a, 0xcc, 0x25, 0xd7, 0x18, 0x0,  0x0,  0x1d, 0x57, 0x13, 0x78, 0x4,
                   0x28, 0xdb, 0x24, 0x95, 0x2,  0x0,  0x0,  0x55, 0x67, 0x26, 0x0,  0x0,  0x0,  0x13, 0xda, 0xba, 0xe,
                   0x12, 0x8f, 0x8b, 0xf2, 0x88, 0x5f, 0x81, 0x50, 0x19, 0x90, 0xf3, 0x75, 0x70, 0x90, 0xe7, 0x12, 0x24,
                   0x35, 0x1c, 0x0,  0x1a, 0x10, 0x47, 0x92, 0x3d, 0x7d, 0x7c, 0x0,  0x83, 0xe4, 0x23, 0x59, 0x30, 0x19,
                   0x81, 0x7e, 0x8b, 0x24, 0x88, 0x54, 0x2,  0xe1, 0xc2, 0x9e, 0x5d, 0x14, 0x22, 0x27, 0x0,  0x0,  0xe,
                   0xb0, 0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x2f, 0x1f, 0x73, 0xbc, 0xc1, 0x9c, 0xca, 0x8f, 0xf4,
                               0xd7, 0x9f, 0x66, 0x6a, 0xb8, 0x2,  0x13, 0xd9};
  lwmqtt_string_t exp_topic = {17, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0xd5, 0x54, 0x9d, 0x9c, 0x2a, 0x60, 0xae, 0x41, 0x64, 0xdb, 0xce};
  lwmqtt_string_t exp_body = {11, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 17);
  EXPECT_EQ(msg.payload_len, 11);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 11);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\ETXJ\240r\220\200\DLE=\219m\152\EM\205\US\144", _pubPktID = 32504, _pubBody =
// "C\158&\185\DLE\NUL\239\237\184+\SO<\134\"R\EM\232\230\222\ENQ", _pubProps = [PropTopicAliasMaximum
// 16938,PropReasonString "j\226\ESC\188$J\155(i\223\251\150#\b\151\SOH",PropPayloadFormatIndicator
// 58,PropWildcardSubscriptionAvailable 104,PropAssignedClientIdentifier "`e",PropAssignedClientIdentifier
// "#[\181+\157\182\245\229\145\255\205zB\245x\140o\205\197P\143s\168f\146\154\221\224\221}",PropContentType
// "\132\162)q\NUL\239\140\&2\SOH\165W\174\162\203\246\159\230f\DELF%",PropRetainAvailable 62,PropContentType
// "/*%Z@",PropReasonString
// "\219\239\161\255rX\129\250qmI\184\159v5\199\238\147<\252xx\\\164\&09\253",PropRequestProblemInformation
// 30,PropSharedSubscriptionAvailable 155,PropMessageExpiryInterval 14356,PropWildcardSubscriptionAvailable
// 212,PropContentType "\202\182",PropResponseTopic
// "\180mv\t-\239\239\142\252_\214!\129\192%\218\230\147\&7\211L\ENQ\153\180",PropServerKeepAlive
// 26081,PropRetainAvailable 68]}
TEST(Publish5QCTest, Encode29) {
  uint8_t pkt[] = {0x35, 0xd9, 0x1,  0x0,  0xf,  0x3,  0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d, 0x98, 0x19,
                   0xcd, 0x1f, 0x90, 0x7e, 0xf8, 0xb0, 0x1,  0x22, 0x42, 0x2a, 0x1f, 0x0,  0x10, 0x6a, 0xe2, 0x1b, 0xbc,
                   0x24, 0x4a, 0x9b, 0x28, 0x69, 0xdf, 0xfb, 0x96, 0x23, 0x8,  0x97, 0x1,  0x1,  0x3a, 0x28, 0x68, 0x12,
                   0x0,  0x2,  0x60, 0x65, 0x12, 0x0,  0x1e, 0x23, 0x5b, 0xb5, 0x2b, 0x9d, 0xb6, 0xf5, 0xe5, 0x91, 0xff,
                   0xcd, 0x7a, 0x42, 0xf5, 0x78, 0x8c, 0x6f, 0xcd, 0xc5, 0x50, 0x8f, 0x73, 0xa8, 0x66, 0x92, 0x9a, 0xdd,
                   0xe0, 0xdd, 0x7d, 0x3,  0x0,  0x15, 0x84, 0xa2, 0x29, 0x71, 0x0,  0xef, 0x8c, 0x32, 0x1,  0xa5, 0x57,
                   0xae, 0xa2, 0xcb, 0xf6, 0x9f, 0xe6, 0x66, 0x7f, 0x46, 0x25, 0x25, 0x3e, 0x3,  0x0,  0x5,  0x2f, 0x2a,
                   0x25, 0x5a, 0x40, 0x1f, 0x0,  0x1b, 0xdb, 0xef, 0xa1, 0xff, 0x72, 0x58, 0x81, 0xfa, 0x71, 0x6d, 0x49,
                   0xb8, 0x9f, 0x76, 0x35, 0xc7, 0xee, 0x93, 0x3c, 0xfc, 0x78, 0x78, 0x5c, 0xa4, 0x30, 0x39, 0xfd, 0x17,
                   0x1e, 0x2a, 0x9b, 0x2,  0x0,  0x0,  0x38, 0x14, 0x28, 0xd4, 0x3,  0x0,  0x2,  0xca, 0xb6, 0x8,  0x0,
                   0x18, 0xb4, 0x6d, 0x76, 0x9,  0x2d, 0xef, 0xef, 0x8e, 0xfc, 0x5f, 0xd6, 0x21, 0x81, 0xc0, 0x25, 0xda,
                   0xe6, 0x93, 0x37, 0xd3, 0x4c, 0x5,  0x99, 0xb4, 0x13, 0x65, 0xe1, 0x25, 0x44, 0x43, 0x9e, 0x26, 0xb9,
                   0x10, 0x0,  0xef, 0xed, 0xb8, 0x2b, 0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  uint8_t topic_bytes[] = {0x3, 0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d, 0x98, 0x19, 0xcd, 0x1f, 0x90};
  lwmqtt_string_t topic = {15, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS2;
  msg.retained = true;
  uint8_t msg_bytes[] = {0x43, 0x9e, 0x26, 0xb9, 0x10, 0x0,  0xef, 0xed, 0xb8, 0x2b,
                         0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 20;

  uint8_t bytesprops0[] = {0x6a, 0xe2, 0x1b, 0xbc, 0x24, 0x4a, 0x9b, 0x28,
                           0x69, 0xdf, 0xfb, 0x96, 0x23, 0x8,  0x97, 0x1};
  uint8_t bytesprops1[] = {0x60, 0x65};
  uint8_t bytesprops2[] = {0x23, 0x5b, 0xb5, 0x2b, 0x9d, 0xb6, 0xf5, 0xe5, 0x91, 0xff, 0xcd, 0x7a, 0x42, 0xf5, 0x78,
                           0x8c, 0x6f, 0xcd, 0xc5, 0x50, 0x8f, 0x73, 0xa8, 0x66, 0x92, 0x9a, 0xdd, 0xe0, 0xdd, 0x7d};
  uint8_t bytesprops3[] = {0x84, 0xa2, 0x29, 0x71, 0x0,  0xef, 0x8c, 0x32, 0x1,  0xa5, 0x57,
                           0xae, 0xa2, 0xcb, 0xf6, 0x9f, 0xe6, 0x66, 0x7f, 0x46, 0x25};
  uint8_t bytesprops4[] = {0x2f, 0x2a, 0x25, 0x5a, 0x40};
  uint8_t bytesprops5[] = {0xdb, 0xef, 0xa1, 0xff, 0x72, 0x58, 0x81, 0xfa, 0x71, 0x6d, 0x49, 0xb8, 0x9f, 0x76,
                           0x35, 0xc7, 0xee, 0x93, 0x3c, 0xfc, 0x78, 0x78, 0x5c, 0xa4, 0x30, 0x39, 0xfd};
  uint8_t bytesprops6[] = {0xca, 0xb6};
  uint8_t bytesprops7[] = {0xb4, 0x6d, 0x76, 0x9,  0x2d, 0xef, 0xef, 0x8e, 0xfc, 0x5f, 0xd6, 0x21,
                           0x81, 0xc0, 0x25, 0xda, 0xe6, 0x93, 0x37, 0xd3, 0x4c, 0x5,  0x99, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 16938}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14356}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {24, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26081}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 68}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 32504, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS2, _pubRetain = True, _pubTopic =
// "\ETXJ\240r\220\200\DLE=\219m\152\EM\205\US\144", _pubPktID = 32504, _pubBody =
// "C\158&\185\DLE\NUL\239\237\184+\SO<\134\"R\EM\232\230\222\ENQ", _pubProps = [PropTopicAliasMaximum
// 16938,PropReasonString "j\226\ESC\188$J\155(i\223\251\150#\b\151\SOH",PropPayloadFormatIndicator
// 58,PropWildcardSubscriptionAvailable 104,PropAssignedClientIdentifier "`e",PropAssignedClientIdentifier
// "#[\181+\157\182\245\229\145\255\205zB\245x\140o\205\197P\143s\168f\146\154\221\224\221}",PropContentType
// "\132\162)q\NUL\239\140\&2\SOH\165W\174\162\203\246\159\230f\DELF%",PropRetainAvailable 62,PropContentType
// "/*%Z@",PropReasonString
// "\219\239\161\255rX\129\250qmI\184\159v5\199\238\147<\252xx\\\164\&09\253",PropRequestProblemInformation
// 30,PropSharedSubscriptionAvailable 155,PropMessageExpiryInterval 14356,PropWildcardSubscriptionAvailable
// 212,PropContentType "\202\182",PropResponseTopic
// "\180mv\t-\239\239\142\252_\214!\129\192%\218\230\147\&7\211L\ENQ\153\180",PropServerKeepAlive
// 26081,PropRetainAvailable 68]}
TEST(Publish5QCTest, Decode29) {
  uint8_t pkt[] = {0x35, 0xd9, 0x1,  0x0,  0xf,  0x3,  0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d, 0x98, 0x19,
                   0xcd, 0x1f, 0x90, 0x7e, 0xf8, 0xb0, 0x1,  0x22, 0x42, 0x2a, 0x1f, 0x0,  0x10, 0x6a, 0xe2, 0x1b, 0xbc,
                   0x24, 0x4a, 0x9b, 0x28, 0x69, 0xdf, 0xfb, 0x96, 0x23, 0x8,  0x97, 0x1,  0x1,  0x3a, 0x28, 0x68, 0x12,
                   0x0,  0x2,  0x60, 0x65, 0x12, 0x0,  0x1e, 0x23, 0x5b, 0xb5, 0x2b, 0x9d, 0xb6, 0xf5, 0xe5, 0x91, 0xff,
                   0xcd, 0x7a, 0x42, 0xf5, 0x78, 0x8c, 0x6f, 0xcd, 0xc5, 0x50, 0x8f, 0x73, 0xa8, 0x66, 0x92, 0x9a, 0xdd,
                   0xe0, 0xdd, 0x7d, 0x3,  0x0,  0x15, 0x84, 0xa2, 0x29, 0x71, 0x0,  0xef, 0x8c, 0x32, 0x1,  0xa5, 0x57,
                   0xae, 0xa2, 0xcb, 0xf6, 0x9f, 0xe6, 0x66, 0x7f, 0x46, 0x25, 0x25, 0x3e, 0x3,  0x0,  0x5,  0x2f, 0x2a,
                   0x25, 0x5a, 0x40, 0x1f, 0x0,  0x1b, 0xdb, 0xef, 0xa1, 0xff, 0x72, 0x58, 0x81, 0xfa, 0x71, 0x6d, 0x49,
                   0xb8, 0x9f, 0x76, 0x35, 0xc7, 0xee, 0x93, 0x3c, 0xfc, 0x78, 0x78, 0x5c, 0xa4, 0x30, 0x39, 0xfd, 0x17,
                   0x1e, 0x2a, 0x9b, 0x2,  0x0,  0x0,  0x38, 0x14, 0x28, 0xd4, 0x3,  0x0,  0x2,  0xca, 0xb6, 0x8,  0x0,
                   0x18, 0xb4, 0x6d, 0x76, 0x9,  0x2d, 0xef, 0xef, 0x8e, 0xfc, 0x5f, 0xd6, 0x21, 0x81, 0xc0, 0x25, 0xda,
                   0xe6, 0x93, 0x37, 0xd3, 0x4c, 0x5,  0x99, 0xb4, 0x13, 0x65, 0xe1, 0x25, 0x44, 0x43, 0x9e, 0x26, 0xb9,
                   0x10, 0x0,  0xef, 0xed, 0xb8, 0x2b, 0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x3, 0x4a, 0xf0, 0x72, 0xdc, 0xc8, 0x10, 0x3d, 0xdb, 0x6d, 0x98, 0x19, 0xcd, 0x1f, 0x90};
  lwmqtt_string_t exp_topic = {15, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x43, 0x9e, 0x26, 0xb9, 0x10, 0x0,  0xef, 0xed, 0xb8, 0x2b,
                              0xe,  0x3c, 0x86, 0x22, 0x52, 0x19, 0xe8, 0xe6, 0xde, 0x5};
  lwmqtt_string_t exp_body = {20, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS2);
  EXPECT_EQ(msg.retained, true);
  EXPECT_EQ(packet_id, 32504);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 15);
  EXPECT_EQ(msg.payload_len, 20);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 20);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\CAN\n\131L\223F1\229", _pubPktID =
// 0, _pubBody = "\138\228\212\203", _pubProps = [PropWildcardSubscriptionAvailable 206,PropReasonString
// "\149N\204\172\138N\250[\183\171"]}
TEST(Publish5QCTest, Encode30) {
  uint8_t pkt[] = {0x30, 0x1e, 0x0,  0x8,  0x18, 0xa,  0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5, 0xf,  0x28, 0xce, 0x1f,
                   0x0,  0xa,  0x95, 0x4e, 0xcc, 0xac, 0x8a, 0x4e, 0xfa, 0x5b, 0xb7, 0xab, 0x8a, 0xe4, 0xd4, 0xcb};
  uint8_t topic_bytes[] = {0x18, 0xa, 0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5};
  lwmqtt_string_t topic = {8, (char*)&topic_bytes};

  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_message_t msg = lwmqtt_default_message;
  msg.qos = LWMQTT_QOS0;
  msg.retained = false;
  uint8_t msg_bytes[] = {0x8a, 0xe4, 0xd4, 0xcb};
  msg.payload = (unsigned char*)&msg_bytes;
  msg.payload_len = 4;

  uint8_t bytesprops0[] = {0x95, 0x4e, 0xcc, 0xac, 0x8a, 0x4e, 0xfa, 0x5b, 0xb7, 0xab};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_publish(buf, sizeof(buf), &len, LWMQTT_MQTT5, false, 0, topic, msg, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// PublishRequest {_pubDup = False, _pubQoS = QoS0, _pubRetain = False, _pubTopic = "\CAN\n\131L\223F1\229", _pubPktID =
// 0, _pubBody = "\138\228\212\203", _pubProps = [PropWildcardSubscriptionAvailable 206,PropReasonString
// "\149N\204\172\138N\250[\183\171"]}
TEST(Publish5QCTest, Decode30) {
  uint8_t pkt[] = {0x30, 0x1e, 0x0,  0x8,  0x18, 0xa,  0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5, 0xf,  0x28, 0xce, 0x1f,
                   0x0,  0xa,  0x95, 0x4e, 0xcc, 0xac, 0x8a, 0x4e, 0xfa, 0x5b, 0xb7, 0xab, 0x8a, 0xe4, 0xd4, 0xcb};
  bool dup;
  uint16_t packet_id;
  lwmqtt_string_t topic;
  lwmqtt_message_t msg;
  lwmqtt_serialized_properties_t props;
  lwmqtt_err_t err = lwmqtt_decode_publish(pkt, sizeof(pkt), LWMQTT_MQTT5, &dup, &packet_id, &topic, &msg, &props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  uint8_t exp_topic_bytes[] = {0x18, 0xa, 0x83, 0x4c, 0xdf, 0x46, 0x31, 0xe5};
  lwmqtt_string_t exp_topic = {8, (char*)&exp_topic_bytes};
  uint8_t exp_body_bytes[] = {0x8a, 0xe4, 0xd4, 0xcb};
  lwmqtt_string_t exp_body = {4, (char*)&exp_body_bytes};
  EXPECT_EQ(dup, false);
  EXPECT_EQ(msg.qos, LWMQTT_QOS0);
  EXPECT_EQ(msg.retained, false);
  EXPECT_EQ(packet_id, 0);
  EXPECT_ARRAY_EQ(exp_topic_bytes, reinterpret_cast<uint8_t*>(topic.data), 8);
  EXPECT_EQ(msg.payload_len, 4);
  EXPECT_ARRAY_EQ(exp_body_bytes, msg.payload, 4);
  lwmqtt_string_t x = exp_topic;
  x = exp_body;
}

// ConnectRequest {_username = Just "su\219", _password = Just "\245\218", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\200\218\ENQ\194\150u=", _willMsg = "18\181\155\177B\144\135#\186\ESC",
// _willProps = []}), _cleanSession = True, _keepAlive = 23341, _connID = "\167\130W\226#\FSJ:\239#\154)\178i",
// _properties = []}
TEST(Connect311QCTest, Encode1) {
  uint8_t pkt[] = {0x10, 0x39, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xf6, 0x5b, 0x2d, 0x0,  0xe,  0xa7,
                   0x82, 0x57, 0xe2, 0x23, 0x1c, 0x4a, 0x3a, 0xef, 0x23, 0x9a, 0x29, 0xb2, 0x69, 0x0,  0x7,
                   0xc8, 0xda, 0x5,  0xc2, 0x96, 0x75, 0x3d, 0x0,  0xb,  0x31, 0x38, 0xb5, 0x9b, 0xb1, 0x42,
                   0x90, 0x87, 0x23, 0xba, 0x1b, 0x0,  0x3,  0x73, 0x75, 0xdb, 0x0,  0x2,  0xf5, 0xda};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc8, 0xda, 0x5, 0xc2, 0x96, 0x75, 0x3d};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x31, 0x38, 0xb5, 0x9b, 0xb1, 0x42, 0x90, 0x87, 0x23, 0xba, 0x1b};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23341;
  uint8_t client_id_bytes[] = {0xa7, 0x82, 0x57, 0xe2, 0x23, 0x1c, 0x4a, 0x3a, 0xef, 0x23, 0x9a, 0x29, 0xb2, 0x69};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x73, 0x75, 0xdb};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf5, 0xda};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "P\166UwM\219C\247)G\246N\221{\180_\252\165e\v\208q\130c\RS\211C<", _password = Just
// "\130\CAN3\224\145\232]\239\145\186\165\178v\169N=\a+\t -", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS0, _willTopic = "\\\179", _willMsg = "\165\154\226\EOTH\244,\148\217\b|", _willProps = []}), _cleanSession =
// False, _keepAlive = 18048, _connID =
// "J\190\236\SO\209A\240R\155\STX:\190\166-\217C\169\EM\134\160\170\226\251I\v\238\&6\208\149", _properties = []}
TEST(Connect311QCTest, Encode2) {
  uint8_t pkt[] = {0x10, 0x6f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x46, 0x80, 0x0,  0x1d, 0x4a, 0xbe, 0xec,
                   0xe,  0xd1, 0x41, 0xf0, 0x52, 0x9b, 0x2,  0x3a, 0xbe, 0xa6, 0x2d, 0xd9, 0x43, 0xa9, 0x19, 0x86, 0xa0,
                   0xaa, 0xe2, 0xfb, 0x49, 0xb,  0xee, 0x36, 0xd0, 0x95, 0x0,  0x2,  0x5c, 0xb3, 0x0,  0xb,  0xa5, 0x9a,
                   0xe2, 0x4,  0x48, 0xf4, 0x2c, 0x94, 0xd9, 0x8,  0x7c, 0x0,  0x1c, 0x50, 0xa6, 0x55, 0x77, 0x4d, 0xdb,
                   0x43, 0xf7, 0x29, 0x47, 0xf6, 0x4e, 0xdd, 0x7b, 0xb4, 0x5f, 0xfc, 0xa5, 0x65, 0xb,  0xd0, 0x71, 0x82,
                   0x63, 0x1e, 0xd3, 0x43, 0x3c, 0x0,  0x15, 0x82, 0x18, 0x33, 0xe0, 0x91, 0xe8, 0x5d, 0xef, 0x91, 0xba,
                   0xa5, 0xb2, 0x76, 0xa9, 0x4e, 0x3d, 0x7,  0x2b, 0x9,  0x20, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5c, 0xb3};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa5, 0x9a, 0xe2, 0x4, 0x48, 0xf4, 0x2c, 0x94, 0xd9, 0x8, 0x7c};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18048;
  uint8_t client_id_bytes[] = {0x4a, 0xbe, 0xec, 0xe,  0xd1, 0x41, 0xf0, 0x52, 0x9b, 0x2, 0x3a, 0xbe, 0xa6, 0x2d, 0xd9,
                               0x43, 0xa9, 0x19, 0x86, 0xa0, 0xaa, 0xe2, 0xfb, 0x49, 0xb, 0xee, 0x36, 0xd0, 0x95};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x50, 0xa6, 0x55, 0x77, 0x4d, 0xdb, 0x43, 0xf7, 0x29, 0x47, 0xf6, 0x4e, 0xdd, 0x7b,
                              0xb4, 0x5f, 0xfc, 0xa5, 0x65, 0xb,  0xd0, 0x71, 0x82, 0x63, 0x1e, 0xd3, 0x43, 0x3c};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x82, 0x18, 0x33, 0xe0, 0x91, 0xe8, 0x5d, 0xef, 0x91, 0xba, 0xa5,
                              0xb2, 0x76, 0xa9, 0x4e, 0x3d, 0x7,  0x2b, 0x9,  0x20, 0x2d};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "2\SYN9\139\255u\201\DEL\234\DEL\164@W\249\SUB\225B\154\170*\\H\246:b\164",
// _password = Just "+ZTUH\240]\158$\252\179\130\182\154hK", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\248\227\198;\219P\186\DC1\SO\130\166<\193j\180\&3\199\231BD@\235", _willMsg = "\231", _willProps
// = []}), _cleanSession = True, _keepAlive = 16330, _connID = "\v\176\184\NULR", _properties = []}
TEST(Connect311QCTest, Encode3) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x3f, 0xca, 0x0,  0x5,  0xb,  0xb0,
                   0xb8, 0x0,  0x52, 0x0,  0x16, 0xf8, 0xe3, 0xc6, 0x3b, 0xdb, 0x50, 0xba, 0x11, 0xe,  0x82, 0xa6,
                   0x3c, 0xc1, 0x6a, 0xb4, 0x33, 0xc7, 0xe7, 0x42, 0x44, 0x40, 0xeb, 0x0,  0x1,  0xe7, 0x0,  0x1a,
                   0x32, 0x16, 0x39, 0x8b, 0xff, 0x75, 0xc9, 0x7f, 0xea, 0x7f, 0xa4, 0x40, 0x57, 0xf9, 0x1a, 0xe1,
                   0x42, 0x9a, 0xaa, 0x2a, 0x5c, 0x48, 0xf6, 0x3a, 0x62, 0xa4, 0x0,  0x10, 0x2b, 0x5a, 0x54, 0x55,
                   0x48, 0xf0, 0x5d, 0x9e, 0x24, 0xfc, 0xb3, 0x82, 0xb6, 0x9a, 0x68, 0x4b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf8, 0xe3, 0xc6, 0x3b, 0xdb, 0x50, 0xba, 0x11, 0xe,  0x82, 0xa6,
                                0x3c, 0xc1, 0x6a, 0xb4, 0x33, 0xc7, 0xe7, 0x42, 0x44, 0x40, 0xeb};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe7};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16330;
  uint8_t client_id_bytes[] = {0xb, 0xb0, 0xb8, 0x0, 0x52};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x32, 0x16, 0x39, 0x8b, 0xff, 0x75, 0xc9, 0x7f, 0xea, 0x7f, 0xa4, 0x40, 0x57,
                              0xf9, 0x1a, 0xe1, 0x42, 0x9a, 0xaa, 0x2a, 0x5c, 0x48, 0xf6, 0x3a, 0x62, 0xa4};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2b, 0x5a, 0x54, 0x55, 0x48, 0xf0, 0x5d, 0x9e,
                              0x24, 0xfc, 0xb3, 0x82, 0xb6, 0x9a, 0x68, 0x4b};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SOH\222\148y4W7\221\234\219\249G\176i\153\&7C\174\DC3\201\168", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "\182\DC2\202\175'\175",
// _willMsg = "FT\180\227 ,\DLEhU\147g\249\210sn\150=>P\234h4\234\150\&6T\137\149\192\216", _willProps = []}),
// _cleanSession = True, _keepAlive = 30046, _connID = "A'\216\131\251\208\218\DC4\152\230\198\239\a", _properties = []}
TEST(Connect311QCTest, Encode4) {
  uint8_t pkt[] = {0x10, 0x58, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xa6, 0x75, 0x5e, 0x0,  0xd,  0x41,
                   0x27, 0xd8, 0x83, 0xfb, 0xd0, 0xda, 0x14, 0x98, 0xe6, 0xc6, 0xef, 0x7,  0x0,  0x6,  0xb6,
                   0x12, 0xca, 0xaf, 0x27, 0xaf, 0x0,  0x1e, 0x46, 0x54, 0xb4, 0xe3, 0x20, 0x2c, 0x10, 0x68,
                   0x55, 0x93, 0x67, 0xf9, 0xd2, 0x73, 0x6e, 0x96, 0x3d, 0x3e, 0x50, 0xea, 0x68, 0x34, 0xea,
                   0x96, 0x36, 0x54, 0x89, 0x95, 0xc0, 0xd8, 0x0,  0x15, 0x1,  0xde, 0x94, 0x79, 0x34, 0x57,
                   0x37, 0xdd, 0xea, 0xdb, 0xf9, 0x47, 0xb0, 0x69, 0x99, 0x37, 0x43, 0xae, 0x13, 0xc9, 0xa8};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb6, 0x12, 0xca, 0xaf, 0x27, 0xaf};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x46, 0x54, 0xb4, 0xe3, 0x20, 0x2c, 0x10, 0x68, 0x55, 0x93,
                                  0x67, 0xf9, 0xd2, 0x73, 0x6e, 0x96, 0x3d, 0x3e, 0x50, 0xea,
                                  0x68, 0x34, 0xea, 0x96, 0x36, 0x54, 0x89, 0x95, 0xc0, 0xd8};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30046;
  uint8_t client_id_bytes[] = {0x41, 0x27, 0xd8, 0x83, 0xfb, 0xd0, 0xda, 0x14, 0x98, 0xe6, 0xc6, 0xef, 0x7};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1,  0xde, 0x94, 0x79, 0x34, 0x57, 0x37, 0xdd, 0xea, 0xdb, 0xf9,
                              0x47, 0xb0, 0x69, 0x99, 0x37, 0x43, 0xae, 0x13, 0xc9, 0xa8};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "~\247\167\ACK\232\156\SYN\185\229`S\252", _password = Just
// "\f\149\174\193\181\&4\229ys\252zT\227\DC2\247\&2\216\183\132)\183\"#-\226\142", _lastWill = Nothing, _cleanSession =
// True, _keepAlive = 2932, _connID = "\199h5A</\202z\186@;\DLEQ\194\213\ACK\233\132\137\221v! \EOT", _properties = []}
TEST(Connect311QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x4e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc2, 0xb,  0x74, 0x0,  0x18, 0xc7, 0x68,
                   0x35, 0x41, 0x3c, 0x2f, 0xca, 0x7a, 0xba, 0x40, 0x3b, 0x10, 0x51, 0xc2, 0xd5, 0x6,  0xe9, 0x84,
                   0x89, 0xdd, 0x76, 0x21, 0x20, 0x4,  0x0,  0xc,  0x7e, 0xf7, 0xa7, 0x6,  0xe8, 0x9c, 0x16, 0xb9,
                   0xe5, 0x60, 0x53, 0xfc, 0x0,  0x1a, 0xc,  0x95, 0xae, 0xc1, 0xb5, 0x34, 0xe5, 0x79, 0x73, 0xfc,
                   0x7a, 0x54, 0xe3, 0x12, 0xf7, 0x32, 0xd8, 0xb7, 0x84, 0x29, 0xb7, 0x22, 0x23, 0x2d, 0xe2, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2932;
  uint8_t client_id_bytes[] = {0xc7, 0x68, 0x35, 0x41, 0x3c, 0x2f, 0xca, 0x7a, 0xba, 0x40, 0x3b, 0x10,
                               0x51, 0xc2, 0xd5, 0x6,  0xe9, 0x84, 0x89, 0xdd, 0x76, 0x21, 0x20, 0x4};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7e, 0xf7, 0xa7, 0x6, 0xe8, 0x9c, 0x16, 0xb9, 0xe5, 0x60, 0x53, 0xfc};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc,  0x95, 0xae, 0xc1, 0xb5, 0x34, 0xe5, 0x79, 0x73, 0xfc, 0x7a, 0x54, 0xe3,
                              0x12, 0xf7, 0x32, 0xd8, 0xb7, 0x84, 0x29, 0xb7, 0x22, 0x23, 0x2d, 0xe2, 0x8e};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "", _willMsg = "\USm", _willProps = []}), _cleanSession = False, _keepAlive = 16105, _connID =
// "\233#\162\&4\221v1'\194j\182\178J\225\247nx\168\166\148\147M\199\156\229Cz\134\EOT", _properties = []}
TEST(Connect311QCTest, Encode6) {
  uint8_t pkt[] = {0x10, 0x2f, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc,  0x3e, 0xe9, 0x0,  0x1d, 0xe9, 0x23, 0xa2,
                   0x34, 0xdd, 0x76, 0x31, 0x27, 0xc2, 0x6a, 0xb6, 0xb2, 0x4a, 0xe1, 0xf7, 0x6e, 0x78, 0xa8, 0xa6, 0x94,
                   0x93, 0x4d, 0xc7, 0x9c, 0xe5, 0x43, 0x7a, 0x86, 0x4,  0x0,  0x0,  0x0,  0x2,  0x1f, 0x6d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1f, 0x6d};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 16105;
  uint8_t client_id_bytes[] = {0xe9, 0x23, 0xa2, 0x34, 0xdd, 0x76, 0x31, 0x27, 0xc2, 0x6a, 0xb6, 0xb2, 0x4a, 0xe1, 0xf7,
                               0x6e, 0x78, 0xa8, 0xa6, 0x94, 0x93, 0x4d, 0xc7, 0x9c, 0xe5, 0x43, 0x7a, 0x86, 0x4};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\EM\145", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "\251\200\&6\199\206\206\220pH\v\151\196\129A_\134\141\215\229\SO\189\198l\249=\202",
// _willMsg = "\179%l\240\143\191>o\222\152\ETXd\178q\161", _willProps = []}), _cleanSession = False, _keepAlive =
// 20495, _connID = "\199\170\&0\213\199\&6Tz4k\247\fs;\188l\241\227L\185\128\149\160\143\227\150c7\220", _properties =
// []}
TEST(Connect311QCTest, Encode7) {
  uint8_t pkt[] = {0x10, 0x5a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xac, 0x50, 0xf,  0x0,  0x1d, 0xc7, 0xaa,
                   0x30, 0xd5, 0xc7, 0x36, 0x54, 0x7a, 0x34, 0x6b, 0xf7, 0xc,  0x73, 0x3b, 0xbc, 0x6c, 0xf1, 0xe3,
                   0x4c, 0xb9, 0x80, 0x95, 0xa0, 0x8f, 0xe3, 0x96, 0x63, 0x37, 0xdc, 0x0,  0x1a, 0xfb, 0xc8, 0x36,
                   0xc7, 0xce, 0xce, 0xdc, 0x70, 0x48, 0xb,  0x97, 0xc4, 0x81, 0x41, 0x5f, 0x86, 0x8d, 0xd7, 0xe5,
                   0xe,  0xbd, 0xc6, 0x6c, 0xf9, 0x3d, 0xca, 0x0,  0xf,  0xb3, 0x25, 0x6c, 0xf0, 0x8f, 0xbf, 0x3e,
                   0x6f, 0xde, 0x98, 0x3,  0x64, 0xb2, 0x71, 0xa1, 0x0,  0x2,  0x19, 0x91};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfb, 0xc8, 0x36, 0xc7, 0xce, 0xce, 0xdc, 0x70, 0x48, 0xb,  0x97, 0xc4, 0x81,
                                0x41, 0x5f, 0x86, 0x8d, 0xd7, 0xe5, 0xe,  0xbd, 0xc6, 0x6c, 0xf9, 0x3d, 0xca};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb3, 0x25, 0x6c, 0xf0, 0x8f, 0xbf, 0x3e, 0x6f,
                                  0xde, 0x98, 0x3,  0x64, 0xb2, 0x71, 0xa1};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20495;
  uint8_t client_id_bytes[] = {0xc7, 0xaa, 0x30, 0xd5, 0xc7, 0x36, 0x54, 0x7a, 0x34, 0x6b, 0xf7, 0xc,  0x73, 0x3b, 0xbc,
                               0x6c, 0xf1, 0xe3, 0x4c, 0xb9, 0x80, 0x95, 0xa0, 0x8f, 0xe3, 0x96, 0x63, 0x37, 0xdc};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x19, 0x91};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\181\166\207", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\140\199\a\SOH\ETX\168\245v\148k\214\201\144\139n\ENQ\170\252Z\142\205", _willMsg =
// ":*\192m\246\&0\144M\255\232<\210\138\STX\142h!j\205\162\158\"\140\190", _willProps = []}), _cleanSession = False,
// _keepAlive = 19119, _connID = "\ETBB\213\133\216\235\t0\138\222\&2", _properties = []}
TEST(Connect311QCTest, Encode8) {
  uint8_t pkt[] = {0x10, 0x48, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x34, 0x4a, 0xaf, 0x0,  0xb,  0x17,
                   0x42, 0xd5, 0x85, 0xd8, 0xeb, 0x9,  0x30, 0x8a, 0xde, 0x32, 0x0,  0x15, 0x8c, 0xc7, 0x7,
                   0x1,  0x3,  0xa8, 0xf5, 0x76, 0x94, 0x6b, 0xd6, 0xc9, 0x90, 0x8b, 0x6e, 0x5,  0xaa, 0xfc,
                   0x5a, 0x8e, 0xcd, 0x0,  0x18, 0x3a, 0x2a, 0xc0, 0x6d, 0xf6, 0x30, 0x90, 0x4d, 0xff, 0xe8,
                   0x3c, 0xd2, 0x8a, 0x2,  0x8e, 0x68, 0x21, 0x6a, 0xcd, 0xa2, 0x9e, 0x22, 0x8c, 0xbe};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8c, 0xc7, 0x7,  0x1,  0x3, 0xa8, 0xf5, 0x76, 0x94, 0x6b, 0xd6,
                                0xc9, 0x90, 0x8b, 0x6e, 0x5, 0xaa, 0xfc, 0x5a, 0x8e, 0xcd};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3a, 0x2a, 0xc0, 0x6d, 0xf6, 0x30, 0x90, 0x4d, 0xff, 0xe8, 0x3c, 0xd2,
                                  0x8a, 0x2,  0x8e, 0x68, 0x21, 0x6a, 0xcd, 0xa2, 0x9e, 0x22, 0x8c, 0xbe};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19119;
  uint8_t client_id_bytes[] = {0x17, 0x42, 0xd5, 0x85, 0xd8, 0xeb, 0x9, 0x30, 0x8a, 0xde, 0x32};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb5, 0xa6, 0xcf};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 26405, _connID = "", _properties = []}
TEST(Connect311QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0xc, 0x0, 0x4, 0x4d, 0x51, 0x54, 0x54, 0x4, 0x2, 0x67, 0x25, 0x0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26405;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\244\160\221\&0\230\206m\172", _password = Just
// "\165\183%\251X.>\250\DC2jTpG*a)\199u\169\200c\ETB\200\246\180\&5\171\157S\185", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\189>\247Z\247\130\236\149k\150\218\181\\-Za%\"\153\153\249\154\229\155\174\154", _willMsg =
// "1\183yF.\202\190\&0\172\233\196\243\200;e\233\133N\232/T\223\157-)\ESC\144\SYN9", _willProps = []}), _cleanSession =
// True, _keepAlive = 26688, _connID = "\246\249\133]\247\EOTD,\146\246\247\159\145\&1O\239Y\129\183+\237\ACK\b",
// _properties = []}
TEST(Connect311QCTest, Encode10) {
  uint8_t pkt[] = {0x10, 0x88, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x68, 0x40, 0x0,  0x17, 0xf6,
                   0xf9, 0x85, 0x5d, 0xf7, 0x4,  0x44, 0x2c, 0x92, 0xf6, 0xf7, 0x9f, 0x91, 0x31, 0x4f, 0xef, 0x59,
                   0x81, 0xb7, 0x2b, 0xed, 0x6,  0x8,  0x0,  0x1a, 0xbd, 0x3e, 0xf7, 0x5a, 0xf7, 0x82, 0xec, 0x95,
                   0x6b, 0x96, 0xda, 0xb5, 0x5c, 0x2d, 0x5a, 0x61, 0x25, 0x22, 0x99, 0x99, 0xf9, 0x9a, 0xe5, 0x9b,
                   0xae, 0x9a, 0x0,  0x1d, 0x31, 0xb7, 0x79, 0x46, 0x2e, 0xca, 0xbe, 0x30, 0xac, 0xe9, 0xc4, 0xf3,
                   0xc8, 0x3b, 0x65, 0xe9, 0x85, 0x4e, 0xe8, 0x2f, 0x54, 0xdf, 0x9d, 0x2d, 0x29, 0x1b, 0x90, 0x16,
                   0x39, 0x0,  0x8,  0xf4, 0xa0, 0xdd, 0x30, 0xe6, 0xce, 0x6d, 0xac, 0x0,  0x1e, 0xa5, 0xb7, 0x25,
                   0xfb, 0x58, 0x2e, 0x3e, 0xfa, 0x12, 0x6a, 0x54, 0x70, 0x47, 0x2a, 0x61, 0x29, 0xc7, 0x75, 0xa9,
                   0xc8, 0x63, 0x17, 0xc8, 0xf6, 0xb4, 0x35, 0xab, 0x9d, 0x53, 0xb9};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbd, 0x3e, 0xf7, 0x5a, 0xf7, 0x82, 0xec, 0x95, 0x6b, 0x96, 0xda, 0xb5, 0x5c,
                                0x2d, 0x5a, 0x61, 0x25, 0x22, 0x99, 0x99, 0xf9, 0x9a, 0xe5, 0x9b, 0xae, 0x9a};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x31, 0xb7, 0x79, 0x46, 0x2e, 0xca, 0xbe, 0x30, 0xac, 0xe9,
                                  0xc4, 0xf3, 0xc8, 0x3b, 0x65, 0xe9, 0x85, 0x4e, 0xe8, 0x2f,
                                  0x54, 0xdf, 0x9d, 0x2d, 0x29, 0x1b, 0x90, 0x16, 0x39};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26688;
  uint8_t client_id_bytes[] = {0xf6, 0xf9, 0x85, 0x5d, 0xf7, 0x4,  0x44, 0x2c, 0x92, 0xf6, 0xf7, 0x9f,
                               0x91, 0x31, 0x4f, 0xef, 0x59, 0x81, 0xb7, 0x2b, 0xed, 0x6,  0x8};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf4, 0xa0, 0xdd, 0x30, 0xe6, 0xce, 0x6d, 0xac};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa5, 0xb7, 0x25, 0xfb, 0x58, 0x2e, 0x3e, 0xfa, 0x12, 0x6a, 0x54, 0x70, 0x47, 0x2a, 0x61,
                              0x29, 0xc7, 0x75, 0xa9, 0xc8, 0x63, 0x17, 0xc8, 0xf6, 0xb4, 0x35, 0xab, 0x9d, 0x53, 0xb9};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\169\&9\US\187\DC1", _password = Just
// "\184\193\180:Dky-1\229\177\RS\US\181{h{\187\237\157K\222kRL\242Z\NAK\214", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "", _willMsg =
// "\251Q\218\169\218\207sq\185c\DC2s\f\\\246'R\RS%\242v\DEL\204f\195I\159`&", _willProps = []}), _cleanSession = False,
// _keepAlive = 13305, _connID = "\207\241K\128\152Q\EMw\238\135PC\202L\142.\156)~\213\212\205", _properties = []}
TEST(Connect311QCTest, Encode11) {
  uint8_t pkt[] = {0x10, 0x69, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0x33, 0xf9, 0x0,  0x16, 0xcf, 0xf1,
                   0x4b, 0x80, 0x98, 0x51, 0x19, 0x77, 0xee, 0x87, 0x50, 0x43, 0xca, 0x4c, 0x8e, 0x2e, 0x9c, 0x29,
                   0x7e, 0xd5, 0xd4, 0xcd, 0x0,  0x0,  0x0,  0x1d, 0xfb, 0x51, 0xda, 0xa9, 0xda, 0xcf, 0x73, 0x71,
                   0xb9, 0x63, 0x12, 0x73, 0xc,  0x5c, 0xf6, 0x27, 0x52, 0x1e, 0x25, 0xf2, 0x76, 0x7f, 0xcc, 0x66,
                   0xc3, 0x49, 0x9f, 0x60, 0x26, 0x0,  0x5,  0xa9, 0x39, 0x1f, 0xbb, 0x11, 0x0,  0x1d, 0xb8, 0xc1,
                   0xb4, 0x3a, 0x44, 0x6b, 0x79, 0x2d, 0x31, 0xe5, 0xb1, 0x1e, 0x1f, 0xb5, 0x7b, 0x68, 0x7b, 0xbb,
                   0xed, 0x9d, 0x4b, 0xde, 0x6b, 0x52, 0x4c, 0xf2, 0x5a, 0x15, 0xd6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb, 0x51, 0xda, 0xa9, 0xda, 0xcf, 0x73, 0x71, 0xb9, 0x63,
                                  0x12, 0x73, 0xc,  0x5c, 0xf6, 0x27, 0x52, 0x1e, 0x25, 0xf2,
                                  0x76, 0x7f, 0xcc, 0x66, 0xc3, 0x49, 0x9f, 0x60, 0x26};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13305;
  uint8_t client_id_bytes[] = {0xcf, 0xf1, 0x4b, 0x80, 0x98, 0x51, 0x19, 0x77, 0xee, 0x87, 0x50,
                               0x43, 0xca, 0x4c, 0x8e, 0x2e, 0x9c, 0x29, 0x7e, 0xd5, 0xd4, 0xcd};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa9, 0x39, 0x1f, 0xbb, 0x11};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb8, 0xc1, 0xb4, 0x3a, 0x44, 0x6b, 0x79, 0x2d, 0x31, 0xe5, 0xb1, 0x1e, 0x1f, 0xb5, 0x7b,
                              0x68, 0x7b, 0xbb, 0xed, 0x9d, 0x4b, 0xde, 0x6b, 0x52, 0x4c, 0xf2, 0x5a, 0x15, 0xd6};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\245\186\233\209\154JNY{\148\171\215\226hh\DELD\236\162\206", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "J}|\FS", _willMsg =
// "\230\222{\SO\US\159a\182$\177", _willProps = []}), _cleanSession = False, _keepAlive = 17990, _connID =
// "\164\DC3\215\130\131\167\153>\200\244\244\GS\132\139\&8", _properties = []}
TEST(Connect311QCTest, Encode12) {
  uint8_t pkt[] = {0x10, 0x43, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xac, 0x46, 0x46, 0x0,  0xf,
                   0xa4, 0x13, 0xd7, 0x82, 0x83, 0xa7, 0x99, 0x3e, 0xc8, 0xf4, 0xf4, 0x1d, 0x84, 0x8b,
                   0x38, 0x0,  0x4,  0x4a, 0x7d, 0x7c, 0x1c, 0x0,  0xa,  0xe6, 0xde, 0x7b, 0xe,  0x1f,
                   0x9f, 0x61, 0xb6, 0x24, 0xb1, 0x0,  0x14, 0xf5, 0xba, 0xe9, 0xd1, 0x9a, 0x4a, 0x4e,
                   0x59, 0x7b, 0x94, 0xab, 0xd7, 0xe2, 0x68, 0x68, 0x7f, 0x44, 0xec, 0xa2, 0xce};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4a, 0x7d, 0x7c, 0x1c};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe6, 0xde, 0x7b, 0xe, 0x1f, 0x9f, 0x61, 0xb6, 0x24, 0xb1};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17990;
  uint8_t client_id_bytes[] = {0xa4, 0x13, 0xd7, 0x82, 0x83, 0xa7, 0x99, 0x3e,
                               0xc8, 0xf4, 0xf4, 0x1d, 0x84, 0x8b, 0x38};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf5, 0xba, 0xe9, 0xd1, 0x9a, 0x4a, 0x4e, 0x59, 0x7b, 0x94,
                              0xab, 0xd7, 0xe2, 0x68, 0x68, 0x7f, 0x44, 0xec, 0xa2, 0xce};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\250\200\162\134OF\FS\CAN\131=\SI\ESC", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\205\193\146C\176\DC1{T\189hD\173\188\SOH\198h\252<R",
// _willMsg = "\238\181\ESC\ENQ\DLE\159\186\170s\EOTn\248\n{\165\&8", _willProps = []}), _cleanSession = False,
// _keepAlive = 26535, _connID = "\191|\197\171z\240\&6a\\\153\222\216L", _properties = []}
TEST(Connect311QCTest, Encode13) {
  uint8_t pkt[] = {0x10, 0x40, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc,  0x67, 0xa7, 0x0,  0xd,  0xbf, 0x7c, 0xc5,
                   0xab, 0x7a, 0xf0, 0x36, 0x61, 0x5c, 0x99, 0xde, 0xd8, 0x4c, 0x0,  0x13, 0xcd, 0xc1, 0x92, 0x43, 0xb0,
                   0x11, 0x7b, 0x54, 0xbd, 0x68, 0x44, 0xad, 0xbc, 0x1,  0xc6, 0x68, 0xfc, 0x3c, 0x52, 0x0,  0x10, 0xee,
                   0xb5, 0x1b, 0x5,  0x10, 0x9f, 0xba, 0xaa, 0x73, 0x4,  0x6e, 0xf8, 0xa,  0x7b, 0xa5, 0x38};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcd, 0xc1, 0x92, 0x43, 0xb0, 0x11, 0x7b, 0x54, 0xbd, 0x68,
                                0x44, 0xad, 0xbc, 0x1,  0xc6, 0x68, 0xfc, 0x3c, 0x52};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xee, 0xb5, 0x1b, 0x5,  0x10, 0x9f, 0xba, 0xaa,
                                  0x73, 0x4,  0x6e, 0xf8, 0xa,  0x7b, 0xa5, 0x38};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26535;
  uint8_t client_id_bytes[] = {0xbf, 0x7c, 0xc5, 0xab, 0x7a, 0xf0, 0x36, 0x61, 0x5c, 0x99, 0xde, 0xd8, 0x4c};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xfa, 0xc8, 0xa2, 0x86, 0x4f, 0x46, 0x1c, 0x18, 0x83, 0x3d, 0xf, 0x1b};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\166\249\a\219\249u\EOTu\143\251", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "\NAK\217-e}|k\a\212M<2\SOH\135", _willMsg =
// "\234\243\SI\181\224\fx\DC2j?\196[\150@\140:\DEL#\USkOE", _willProps = []}), _cleanSession = True, _keepAlive =
// 25650, _connID = "\US\179p\223Y8\251\250}|\146\DC10", _properties = []}
TEST(Connect311QCTest, Encode14) {
  uint8_t pkt[] = {0x10, 0x41, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2e, 0x64, 0x32, 0x0,  0xd,  0x1f, 0xb3, 0x70,
                   0xdf, 0x59, 0x38, 0xfb, 0xfa, 0x7d, 0x7c, 0x92, 0x11, 0x30, 0x0,  0xe,  0x15, 0xd9, 0x2d, 0x65, 0x7d,
                   0x7c, 0x6b, 0x7,  0xd4, 0x4d, 0x3c, 0x32, 0x1,  0x87, 0x0,  0x16, 0xea, 0xf3, 0xf,  0xb5, 0xe0, 0xc,
                   0x78, 0x12, 0x6a, 0x3f, 0xc4, 0x5b, 0x96, 0x40, 0x8c, 0x3a, 0x7f, 0x23, 0x1f, 0x6b, 0x4f, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x15, 0xd9, 0x2d, 0x65, 0x7d, 0x7c, 0x6b, 0x7, 0xd4, 0x4d, 0x3c, 0x32, 0x1, 0x87};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xea, 0xf3, 0xf,  0xb5, 0xe0, 0xc,  0x78, 0x12, 0x6a, 0x3f, 0xc4,
                                  0x5b, 0x96, 0x40, 0x8c, 0x3a, 0x7f, 0x23, 0x1f, 0x6b, 0x4f, 0x45};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25650;
  uint8_t client_id_bytes[] = {0x1f, 0xb3, 0x70, 0xdf, 0x59, 0x38, 0xfb, 0xfa, 0x7d, 0x7c, 0x92, 0x11, 0x30};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa6, 0xf9, 0x7, 0xdb, 0xf9, 0x75, 0x4, 0x75, 0x8f, 0xfb};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\194\DC3\201\173i\234P)\159\241N\208l\133G", _willMsg = "\208\250\192\160", _willProps = []}),
// _cleanSession = False, _keepAlive = 737, _connID = "\204r\138\210\153>\161K\EMw\NAK\r\DC4\188\158Z\ACK6", _properties
// = []}
TEST(Connect311QCTest, Encode15) {
  uint8_t pkt[] = {0x10, 0x35, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x14, 0x2,  0xe1, 0x0,  0x12,
                   0xcc, 0x72, 0x8a, 0xd2, 0x99, 0x3e, 0xa1, 0x4b, 0x19, 0x77, 0x15, 0xd,  0x14, 0xbc,
                   0x9e, 0x5a, 0x6,  0x36, 0x0,  0xf,  0xc2, 0x13, 0xc9, 0xad, 0x69, 0xea, 0x50, 0x29,
                   0x9f, 0xf1, 0x4e, 0xd0, 0x6c, 0x85, 0x47, 0x0,  0x4,  0xd0, 0xfa, 0xc0, 0xa0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc2, 0x13, 0xc9, 0xad, 0x69, 0xea, 0x50, 0x29,
                                0x9f, 0xf1, 0x4e, 0xd0, 0x6c, 0x85, 0x47};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd0, 0xfa, 0xc0, 0xa0};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 737;
  uint8_t client_id_bytes[] = {0xcc, 0x72, 0x8a, 0xd2, 0x99, 0x3e, 0xa1, 0x4b, 0x19,
                               0x77, 0x15, 0xd,  0x14, 0xbc, 0x9e, 0x5a, 0x6,  0x36};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "=\244\ESCz\EM\205Q\216 \211\&62\EM\238\244\239O D\136", _password = Just
// "\CANj\v\180\161\237\198h\184_NXO\223\DC1p$\175\183/*\178\186v2Z\USe\145", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = ":\229v?<fE\199\246\182\174\141~\DC1`y\215\172L%\158\f\216\198:", _willMsg =
// "\249-\184\234\146\167\238\177\251\167V", _willProps = []}), _cleanSession = True, _keepAlive = 13449, _connID =
// "\160\224\209~y/wD\182\&6\143\210\244\&6D\190", _properties = []}
TEST(Connect311QCTest, Encode16) {
  uint8_t pkt[] = {0x10, 0x79, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd6, 0x34, 0x89, 0x0,  0x10, 0xa0, 0xe0,
                   0xd1, 0x7e, 0x79, 0x2f, 0x77, 0x44, 0xb6, 0x36, 0x8f, 0xd2, 0xf4, 0x36, 0x44, 0xbe, 0x0,  0x19,
                   0x3a, 0xe5, 0x76, 0x3f, 0x3c, 0x66, 0x45, 0xc7, 0xf6, 0xb6, 0xae, 0x8d, 0x7e, 0x11, 0x60, 0x79,
                   0xd7, 0xac, 0x4c, 0x25, 0x9e, 0xc,  0xd8, 0xc6, 0x3a, 0x0,  0xb,  0xf9, 0x2d, 0xb8, 0xea, 0x92,
                   0xa7, 0xee, 0xb1, 0xfb, 0xa7, 0x56, 0x0,  0x14, 0x3d, 0xf4, 0x1b, 0x7a, 0x19, 0xcd, 0x51, 0xd8,
                   0x20, 0xd3, 0x36, 0x32, 0x19, 0xee, 0xf4, 0xef, 0x4f, 0x20, 0x44, 0x88, 0x0,  0x1d, 0x18, 0x6a,
                   0xb,  0xb4, 0xa1, 0xed, 0xc6, 0x68, 0xb8, 0x5f, 0x4e, 0x58, 0x4f, 0xdf, 0x11, 0x70, 0x24, 0xaf,
                   0xb7, 0x2f, 0x2a, 0xb2, 0xba, 0x76, 0x32, 0x5a, 0x1f, 0x65, 0x91};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3a, 0xe5, 0x76, 0x3f, 0x3c, 0x66, 0x45, 0xc7, 0xf6, 0xb6, 0xae, 0x8d, 0x7e,
                                0x11, 0x60, 0x79, 0xd7, 0xac, 0x4c, 0x25, 0x9e, 0xc,  0xd8, 0xc6, 0x3a};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf9, 0x2d, 0xb8, 0xea, 0x92, 0xa7, 0xee, 0xb1, 0xfb, 0xa7, 0x56};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13449;
  uint8_t client_id_bytes[] = {0xa0, 0xe0, 0xd1, 0x7e, 0x79, 0x2f, 0x77, 0x44,
                               0xb6, 0x36, 0x8f, 0xd2, 0xf4, 0x36, 0x44, 0xbe};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3d, 0xf4, 0x1b, 0x7a, 0x19, 0xcd, 0x51, 0xd8, 0x20, 0xd3,
                              0x36, 0x32, 0x19, 0xee, 0xf4, 0xef, 0x4f, 0x20, 0x44, 0x88};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x6a, 0xb,  0xb4, 0xa1, 0xed, 0xc6, 0x68, 0xb8, 0x5f, 0x4e, 0x58, 0x4f, 0xdf, 0x11,
                              0x70, 0x24, 0xaf, 0xb7, 0x2f, 0x2a, 0xb2, 0xba, 0x76, 0x32, 0x5a, 0x1f, 0x65, 0x91};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\EM~\132\178\GS\169&\143*J\FS\223", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "@li\185SS", _willMsg =
// "\225\&9L\215\ENQ\CAN\158w\142P\EOT\219\157\227\160", _willProps = []}), _cleanSession = False, _keepAlive = 7971,
// _connID = "T\NAK\150\156\144\224\213\148P\161D\216\239ZE\171\185\169c\STX\173", _properties = []}
TEST(Connect311QCTest, Encode17) {
  uint8_t pkt[] = {0x10, 0x3a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x4,  0x1f, 0x23, 0x0,  0x15, 0x54,
                   0x15, 0x96, 0x9c, 0x90, 0xe0, 0xd5, 0x94, 0x50, 0xa1, 0x44, 0xd8, 0xef, 0x5a, 0x45, 0xab,
                   0xb9, 0xa9, 0x63, 0x2,  0xad, 0x0,  0x6,  0x40, 0x6c, 0x69, 0xb9, 0x53, 0x53, 0x0,  0xf,
                   0xe1, 0x39, 0x4c, 0xd7, 0x5,  0x18, 0x9e, 0x77, 0x8e, 0x50, 0x4,  0xdb, 0x9d, 0xe3, 0xa0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x40, 0x6c, 0x69, 0xb9, 0x53, 0x53};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe1, 0x39, 0x4c, 0xd7, 0x5,  0x18, 0x9e, 0x77,
                                  0x8e, 0x50, 0x4,  0xdb, 0x9d, 0xe3, 0xa0};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 7971;
  uint8_t client_id_bytes[] = {0x54, 0x15, 0x96, 0x9c, 0x90, 0xe0, 0xd5, 0x94, 0x50, 0xa1, 0x44,
                               0xd8, 0xef, 0x5a, 0x45, 0xab, 0xb9, 0xa9, 0x63, 0x2,  0xad};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x19, 0x7e, 0x84, 0xb2, 0x1d, 0xa9, 0x26, 0x8f, 0x2a, 0x4a, 0x1c, 0xdf};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\231\"\140\184\150\129\176\136", _password = Just "<", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\228\186\150\165\217\210\189", _willMsg =
// "\240\DC2\156\154E\165|\209S\189p\140", _willProps = []}), _cleanSession = True, _keepAlive = 14805, _connID =
// "\224\153\138 P\CAN\176\DLEz2\177\169\171\247\192rU\190\&9\189\196\149o?t", _properties = []}
TEST(Connect311QCTest, Encode18) {
  uint8_t pkt[] = {0x10, 0x49, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xce, 0x39, 0xd5, 0x0,  0x19, 0xe0,
                   0x99, 0x8a, 0x20, 0x50, 0x18, 0xb0, 0x10, 0x7a, 0x32, 0xb1, 0xa9, 0xab, 0xf7, 0xc0, 0x72,
                   0x55, 0xbe, 0x39, 0xbd, 0xc4, 0x95, 0x6f, 0x3f, 0x74, 0x0,  0x7,  0xe4, 0xba, 0x96, 0xa5,
                   0xd9, 0xd2, 0xbd, 0x0,  0xc,  0xf0, 0x12, 0x9c, 0x9a, 0x45, 0xa5, 0x7c, 0xd1, 0x53, 0xbd,
                   0x70, 0x8c, 0x0,  0x8,  0xe7, 0x22, 0x8c, 0xb8, 0x96, 0x81, 0xb0, 0x88, 0x0,  0x1,  0x3c};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe4, 0xba, 0x96, 0xa5, 0xd9, 0xd2, 0xbd};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf0, 0x12, 0x9c, 0x9a, 0x45, 0xa5, 0x7c, 0xd1, 0x53, 0xbd, 0x70, 0x8c};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14805;
  uint8_t client_id_bytes[] = {0xe0, 0x99, 0x8a, 0x20, 0x50, 0x18, 0xb0, 0x10, 0x7a, 0x32, 0xb1, 0xa9, 0xab,
                               0xf7, 0xc0, 0x72, 0x55, 0xbe, 0x39, 0xbd, 0xc4, 0x95, 0x6f, 0x3f, 0x74};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe7, 0x22, 0x8c, 0xb8, 0x96, 0x81, 0xb0, 0x88};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3c};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "I\DC1a\EOT\217\152\&5\206\145\132\232z\157", _password = Just
// "\215\235\149i\140u\SUB\DELp\137\141q?\246[g\200\149e", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "Gn\r k\174]\212!nN\176\217\185h\211*\166\t\160\169\v\168q\174>z", _willMsg = "\NUL\247",
// _willProps = []}), _cleanSession = False, _keepAlive = 487, _connID = "\r\196\187Nr\226\142\198\223\237\224\191",
// _properties = []}
TEST(Connect311QCTest, Encode19) {
  uint8_t pkt[] = {0x10, 0x5d, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x1,  0xe7, 0x0,  0xc,  0xd,  0xc4,
                   0xbb, 0x4e, 0x72, 0xe2, 0x8e, 0xc6, 0xdf, 0xed, 0xe0, 0xbf, 0x0,  0x1b, 0x47, 0x6e, 0xd,  0x20,
                   0x6b, 0xae, 0x5d, 0xd4, 0x21, 0x6e, 0x4e, 0xb0, 0xd9, 0xb9, 0x68, 0xd3, 0x2a, 0xa6, 0x9,  0xa0,
                   0xa9, 0xb,  0xa8, 0x71, 0xae, 0x3e, 0x7a, 0x0,  0x2,  0x0,  0xf7, 0x0,  0xd,  0x49, 0x11, 0x61,
                   0x4,  0xd9, 0x98, 0x35, 0xce, 0x91, 0x84, 0xe8, 0x7a, 0x9d, 0x0,  0x13, 0xd7, 0xeb, 0x95, 0x69,
                   0x8c, 0x75, 0x1a, 0x7f, 0x70, 0x89, 0x8d, 0x71, 0x3f, 0xf6, 0x5b, 0x67, 0xc8, 0x95, 0x65};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x47, 0x6e, 0xd,  0x20, 0x6b, 0xae, 0x5d, 0xd4, 0x21, 0x6e, 0x4e, 0xb0, 0xd9, 0xb9,
                                0x68, 0xd3, 0x2a, 0xa6, 0x9,  0xa0, 0xa9, 0xb,  0xa8, 0x71, 0xae, 0x3e, 0x7a};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x0, 0xf7};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 487;
  uint8_t client_id_bytes[] = {0xd, 0xc4, 0xbb, 0x4e, 0x72, 0xe2, 0x8e, 0xc6, 0xdf, 0xed, 0xe0, 0xbf};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x49, 0x11, 0x61, 0x4, 0xd9, 0x98, 0x35, 0xce, 0x91, 0x84, 0xe8, 0x7a, 0x9d};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd7, 0xeb, 0x95, 0x69, 0x8c, 0x75, 0x1a, 0x7f, 0x70, 0x89,
                              0x8d, 0x71, 0x3f, 0xf6, 0x5b, 0x67, 0xc8, 0x95, 0x65};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\167Vv", _password = Just "\USefMcY\245s", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS2, _willTopic =
// "\134q\161\236\217\\\238\&3z\146\f\186\198\211u\250_\r\194\141t~\168w\225t\171\135i\229", _willMsg =
// "\164\252\EOT\203\197\166\171B\177\145\DC4\190\DC3\205\NAK\143\157\SUB\177\248\NAK\129\222\DEL>0H", _willProps =
// []}), _cleanSession = False, _keepAlive = 176, _connID =
// "\164\181\166\128r\129\SUB\184rUbzJ\177WIU+\158\DEL\SOH\NAK\164\169", _properties = []}
TEST(Connect311QCTest, Encode20) {
  uint8_t pkt[] = {0x10, 0x70, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x0,  0xb0, 0x0,  0x18, 0xa4, 0xb5, 0xa6,
                   0x80, 0x72, 0x81, 0x1a, 0xb8, 0x72, 0x55, 0x62, 0x7a, 0x4a, 0xb1, 0x57, 0x49, 0x55, 0x2b, 0x9e, 0x7f,
                   0x1,  0x15, 0xa4, 0xa9, 0x0,  0x1e, 0x86, 0x71, 0xa1, 0xec, 0xd9, 0x5c, 0xee, 0x33, 0x7a, 0x92, 0xc,
                   0xba, 0xc6, 0xd3, 0x75, 0xfa, 0x5f, 0xd,  0xc2, 0x8d, 0x74, 0x7e, 0xa8, 0x77, 0xe1, 0x74, 0xab, 0x87,
                   0x69, 0xe5, 0x0,  0x1b, 0xa4, 0xfc, 0x4,  0xcb, 0xc5, 0xa6, 0xab, 0x42, 0xb1, 0x91, 0x14, 0xbe, 0x13,
                   0xcd, 0x15, 0x8f, 0x9d, 0x1a, 0xb1, 0xf8, 0x15, 0x81, 0xde, 0x7f, 0x3e, 0x30, 0x48, 0x0,  0x3,  0xa7,
                   0x56, 0x76, 0x0,  0x8,  0x1f, 0x65, 0x66, 0x4d, 0x63, 0x59, 0xf5, 0x73};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x86, 0x71, 0xa1, 0xec, 0xd9, 0x5c, 0xee, 0x33, 0x7a, 0x92,
                                0xc,  0xba, 0xc6, 0xd3, 0x75, 0xfa, 0x5f, 0xd,  0xc2, 0x8d,
                                0x74, 0x7e, 0xa8, 0x77, 0xe1, 0x74, 0xab, 0x87, 0x69, 0xe5};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0xfc, 0x4,  0xcb, 0xc5, 0xa6, 0xab, 0x42, 0xb1, 0x91, 0x14, 0xbe, 0x13, 0xcd,
                                  0x15, 0x8f, 0x9d, 0x1a, 0xb1, 0xf8, 0x15, 0x81, 0xde, 0x7f, 0x3e, 0x30, 0x48};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 176;
  uint8_t client_id_bytes[] = {0xa4, 0xb5, 0xa6, 0x80, 0x72, 0x81, 0x1a, 0xb8, 0x72, 0x55, 0x62, 0x7a,
                               0x4a, 0xb1, 0x57, 0x49, 0x55, 0x2b, 0x9e, 0x7f, 0x1,  0x15, 0xa4, 0xa9};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa7, 0x56, 0x76};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1f, 0x65, 0x66, 0x4d, 0x63, 0x59, 0xf5, 0x73};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "g\164\GS\251\214\154t\217\140l\213\150&{\211\130", _password = Just
// "\187\ESC\201\164\156\195h\241\250v8\t\179\193\251[*\142", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 20540, _connID = "\255k\192]Rmr[\146o,\129", _properties = []}
TEST(Connect311QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x3e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc0, 0x50, 0x3c, 0x0,  0xc,  0xff, 0x6b,
                   0xc0, 0x5d, 0x52, 0x6d, 0x72, 0x5b, 0x92, 0x6f, 0x2c, 0x81, 0x0,  0x10, 0x67, 0xa4, 0x1d, 0xfb,
                   0xd6, 0x9a, 0x74, 0xd9, 0x8c, 0x6c, 0xd5, 0x96, 0x26, 0x7b, 0xd3, 0x82, 0x0,  0x12, 0xbb, 0x1b,
                   0xc9, 0xa4, 0x9c, 0xc3, 0x68, 0xf1, 0xfa, 0x76, 0x38, 0x9,  0xb3, 0xc1, 0xfb, 0x5b, 0x2a, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20540;
  uint8_t client_id_bytes[] = {0xff, 0x6b, 0xc0, 0x5d, 0x52, 0x6d, 0x72, 0x5b, 0x92, 0x6f, 0x2c, 0x81};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x67, 0xa4, 0x1d, 0xfb, 0xd6, 0x9a, 0x74, 0xd9,
                              0x8c, 0x6c, 0xd5, 0x96, 0x26, 0x7b, 0xd3, 0x82};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbb, 0x1b, 0xc9, 0xa4, 0x9c, 0xc3, 0x68, 0xf1, 0xfa,
                              0x76, 0x38, 0x9,  0xb3, 0xc1, 0xfb, 0x5b, 0x2a, 0x8e};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\130\153\246\DLEX\252\184\254\209\234/\229\190\&1k\ENQ\DC1\DEL\186", _password =
// Just "\152\245\222\230\235\f!z\243\&9\224P\250\231\236#\205V", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS1, _willTopic = "\199\149\CAND\190\238\210\161\204\&8C\192\168'\162\198\250\r\142\&0\250", _willMsg =
// "OUI", _willProps = []}), _cleanSession = False, _keepAlive = 63, _connID =
// "\FS\196\a\216\236\229ts[;\209\141\182\141\154#\226\&7H.\199\195\f-\159\183\252c\235", _properties = []}
TEST(Connect311QCTest, Encode22) {
  uint8_t pkt[] = {0x10, 0x6e, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xcc, 0x0,  0x3f, 0x0,  0x1d, 0x1c, 0xc4,
                   0x7,  0xd8, 0xec, 0xe5, 0x74, 0x73, 0x5b, 0x3b, 0xd1, 0x8d, 0xb6, 0x8d, 0x9a, 0x23, 0xe2, 0x37,
                   0x48, 0x2e, 0xc7, 0xc3, 0xc,  0x2d, 0x9f, 0xb7, 0xfc, 0x63, 0xeb, 0x0,  0x15, 0xc7, 0x95, 0x18,
                   0x44, 0xbe, 0xee, 0xd2, 0xa1, 0xcc, 0x38, 0x43, 0xc0, 0xa8, 0x27, 0xa2, 0xc6, 0xfa, 0xd,  0x8e,
                   0x30, 0xfa, 0x0,  0x3,  0x4f, 0x55, 0x49, 0x0,  0x13, 0x82, 0x99, 0xf6, 0x10, 0x58, 0xfc, 0xb8,
                   0xfe, 0xd1, 0xea, 0x2f, 0xe5, 0xbe, 0x31, 0x6b, 0x5,  0x11, 0x7f, 0xba, 0x0,  0x12, 0x98, 0xf5,
                   0xde, 0xe6, 0xeb, 0xc,  0x21, 0x7a, 0xf3, 0x39, 0xe0, 0x50, 0xfa, 0xe7, 0xec, 0x23, 0xcd, 0x56};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc7, 0x95, 0x18, 0x44, 0xbe, 0xee, 0xd2, 0xa1, 0xcc, 0x38, 0x43,
                                0xc0, 0xa8, 0x27, 0xa2, 0xc6, 0xfa, 0xd,  0x8e, 0x30, 0xfa};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4f, 0x55, 0x49};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 63;
  uint8_t client_id_bytes[] = {0x1c, 0xc4, 0x7,  0xd8, 0xec, 0xe5, 0x74, 0x73, 0x5b, 0x3b, 0xd1, 0x8d, 0xb6, 0x8d, 0x9a,
                               0x23, 0xe2, 0x37, 0x48, 0x2e, 0xc7, 0xc3, 0xc,  0x2d, 0x9f, 0xb7, 0xfc, 0x63, 0xeb};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x82, 0x99, 0xf6, 0x10, 0x58, 0xfc, 0xb8, 0xfe, 0xd1, 0xea,
                              0x2f, 0xe5, 0xbe, 0x31, 0x6b, 0x5,  0x11, 0x7f, 0xba};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x98, 0xf5, 0xde, 0xe6, 0xeb, 0xc,  0x21, 0x7a, 0xf3,
                              0x39, 0xe0, 0x50, 0xfa, 0xe7, 0xec, 0x23, 0xcd, 0x56};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\RS\167\162\&6\154\242\173\187\159\228M\149\143\133]\FS%\242\219\239\232\172\&7\STX\236\&3\229", _password = Just
// "\223\143\v\237\t/\227\FS\210\243\130\206\v\180\r", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0,
// _willTopic = " \SI\153\ACK\213(Df\150\253\194\171\158r\205\203cW", _willMsg =
// "\221\140d\205\238w\156m\218w\195\&4\189\&2\208\177", _willProps = []}), _cleanSession = False, _keepAlive = 32455,
// _connID = "\199f\232=\172\DEL\148R>\167\\X;\235 \DC1\189\173\203WE\245", _properties = []}
TEST(Connect311QCTest, Encode23) {
  uint8_t pkt[] = {0x10, 0x76, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x7e, 0xc7, 0x0,  0x16, 0xc7,
                   0x66, 0xe8, 0x3d, 0xac, 0x7f, 0x94, 0x52, 0x3e, 0xa7, 0x5c, 0x58, 0x3b, 0xeb, 0x20, 0x11,
                   0xbd, 0xad, 0xcb, 0x57, 0x45, 0xf5, 0x0,  0x12, 0x20, 0xf,  0x99, 0x6,  0xd5, 0x28, 0x44,
                   0x66, 0x96, 0xfd, 0xc2, 0xab, 0x9e, 0x72, 0xcd, 0xcb, 0x63, 0x57, 0x0,  0x10, 0xdd, 0x8c,
                   0x64, 0xcd, 0xee, 0x77, 0x9c, 0x6d, 0xda, 0x77, 0xc3, 0x34, 0xbd, 0x32, 0xd0, 0xb1, 0x0,
                   0x1b, 0x1e, 0xa7, 0xa2, 0x36, 0x9a, 0xf2, 0xad, 0xbb, 0x9f, 0xe4, 0x4d, 0x95, 0x8f, 0x85,
                   0x5d, 0x1c, 0x25, 0xf2, 0xdb, 0xef, 0xe8, 0xac, 0x37, 0x2,  0xec, 0x33, 0xe5, 0x0,  0xf,
                   0xdf, 0x8f, 0xb,  0xed, 0x9,  0x2f, 0xe3, 0x1c, 0xd2, 0xf3, 0x82, 0xce, 0xb,  0xb4, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x20, 0xf,  0x99, 0x6,  0xd5, 0x28, 0x44, 0x66, 0x96,
                                0xfd, 0xc2, 0xab, 0x9e, 0x72, 0xcd, 0xcb, 0x63, 0x57};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdd, 0x8c, 0x64, 0xcd, 0xee, 0x77, 0x9c, 0x6d,
                                  0xda, 0x77, 0xc3, 0x34, 0xbd, 0x32, 0xd0, 0xb1};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32455;
  uint8_t client_id_bytes[] = {0xc7, 0x66, 0xe8, 0x3d, 0xac, 0x7f, 0x94, 0x52, 0x3e, 0xa7, 0x5c,
                               0x58, 0x3b, 0xeb, 0x20, 0x11, 0xbd, 0xad, 0xcb, 0x57, 0x45, 0xf5};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1e, 0xa7, 0xa2, 0x36, 0x9a, 0xf2, 0xad, 0xbb, 0x9f, 0xe4, 0x4d, 0x95, 0x8f, 0x85,
                              0x5d, 0x1c, 0x25, 0xf2, 0xdb, 0xef, 0xe8, 0xac, 0x37, 0x2,  0xec, 0x33, 0xe5};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdf, 0x8f, 0xb, 0xed, 0x9, 0x2f, 0xe3, 0x1c, 0xd2, 0xf3, 0x82, 0xce, 0xb, 0xb4, 0xd};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 14647, _connID = "\173\255n}\129\NAK", _properties = []}
TEST(Connect311QCTest, Encode24) {
  uint8_t pkt[] = {0x10, 0x12, 0x0, 0x4, 0x4d, 0x51, 0x54, 0x54, 0x4,  0x2,
                   0x39, 0x37, 0x0, 0x6, 0xad, 0xff, 0x6e, 0x7d, 0x81, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14647;
  uint8_t client_id_bytes[] = {0xad, 0xff, 0x6e, 0x7d, 0x81, 0x15};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "/&", _password = Just
// "8\SUB\143\t\ESC\220%\187\ESC1\163\&9\253\207\185F\t\213N\NUL\"", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\209Ho\130\233\&6\203E\189\STX\204\202LG\160\188C[\GS&\169w\NUL\208\161", _willMsg =
// "C", _willProps = []}), _cleanSession = False, _keepAlive = 17899, _connID = ".hc\n\135\206/\236\&0\221\216\155\236",
// _properties = []}
TEST(Connect311QCTest, Encode25) {
  uint8_t pkt[] = {0x10, 0x52, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xe4, 0x45, 0xeb, 0x0,  0xd,  0x2e, 0x68, 0x63,
                   0xa,  0x87, 0xce, 0x2f, 0xec, 0x30, 0xdd, 0xd8, 0x9b, 0xec, 0x0,  0x19, 0xd1, 0x48, 0x6f, 0x82, 0xe9,
                   0x36, 0xcb, 0x45, 0xbd, 0x2,  0xcc, 0xca, 0x4c, 0x47, 0xa0, 0xbc, 0x43, 0x5b, 0x1d, 0x26, 0xa9, 0x77,
                   0x0,  0xd0, 0xa1, 0x0,  0x1,  0x43, 0x0,  0x2,  0x2f, 0x26, 0x0,  0x15, 0x38, 0x1a, 0x8f, 0x9,  0x1b,
                   0xdc, 0x25, 0xbb, 0x1b, 0x31, 0xa3, 0x39, 0xfd, 0xcf, 0xb9, 0x46, 0x9,  0xd5, 0x4e, 0x0,  0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd1, 0x48, 0x6f, 0x82, 0xe9, 0x36, 0xcb, 0x45, 0xbd, 0x2, 0xcc, 0xca, 0x4c,
                                0x47, 0xa0, 0xbc, 0x43, 0x5b, 0x1d, 0x26, 0xa9, 0x77, 0x0, 0xd0, 0xa1};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x43};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17899;
  uint8_t client_id_bytes[] = {0x2e, 0x68, 0x63, 0xa, 0x87, 0xce, 0x2f, 0xec, 0x30, 0xdd, 0xd8, 0x9b, 0xec};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2f, 0x26};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x38, 0x1a, 0x8f, 0x9,  0x1b, 0xdc, 0x25, 0xbb, 0x1b, 0x31, 0xa3,
                              0x39, 0xfd, 0xcf, 0xb9, 0x46, 0x9,  0xd5, 0x4e, 0x0,  0x22};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "N\203\159\210\235ac\RS\168\231\220r'\253\200\162\192\166\149\231\221", _password =
// Just "\174,\168L\134y\NUL\129\t\237\152\134\184\222\US\168\208\"|\246\140=\236\196~\b\150\246\216\164", _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\218I\179[\161\209\ESC}h\205FPB@K\133", _willMsg
// = "2\215\135\225\197N", _willProps = []}), _cleanSession = False, _keepAlive = 30481, _connID =
// "\132\129b\222=>\197\164\SO\236\234\204O\202\240\150\&0\186\167", _properties = []}
TEST(Connect311QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0x70, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xc4, 0x77, 0x11, 0x0,  0x13, 0x84, 0x81, 0x62,
                   0xde, 0x3d, 0x3e, 0xc5, 0xa4, 0xe,  0xec, 0xea, 0xcc, 0x4f, 0xca, 0xf0, 0x96, 0x30, 0xba, 0xa7, 0x0,
                   0x10, 0xda, 0x49, 0xb3, 0x5b, 0xa1, 0xd1, 0x1b, 0x7d, 0x68, 0xcd, 0x46, 0x50, 0x42, 0x40, 0x4b, 0x85,
                   0x0,  0x6,  0x32, 0xd7, 0x87, 0xe1, 0xc5, 0x4e, 0x0,  0x15, 0x4e, 0xcb, 0x9f, 0xd2, 0xeb, 0x61, 0x63,
                   0x1e, 0xa8, 0xe7, 0xdc, 0x72, 0x27, 0xfd, 0xc8, 0xa2, 0xc0, 0xa6, 0x95, 0xe7, 0xdd, 0x0,  0x1e, 0xae,
                   0x2c, 0xa8, 0x4c, 0x86, 0x79, 0x0,  0x81, 0x9,  0xed, 0x98, 0x86, 0xb8, 0xde, 0x1f, 0xa8, 0xd0, 0x22,
                   0x7c, 0xf6, 0x8c, 0x3d, 0xec, 0xc4, 0x7e, 0x8,  0x96, 0xf6, 0xd8, 0xa4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xda, 0x49, 0xb3, 0x5b, 0xa1, 0xd1, 0x1b, 0x7d,
                                0x68, 0xcd, 0x46, 0x50, 0x42, 0x40, 0x4b, 0x85};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x32, 0xd7, 0x87, 0xe1, 0xc5, 0x4e};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30481;
  uint8_t client_id_bytes[] = {0x84, 0x81, 0x62, 0xde, 0x3d, 0x3e, 0xc5, 0xa4, 0xe, 0xec,
                               0xea, 0xcc, 0x4f, 0xca, 0xf0, 0x96, 0x30, 0xba, 0xa7};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4e, 0xcb, 0x9f, 0xd2, 0xeb, 0x61, 0x63, 0x1e, 0xa8, 0xe7, 0xdc,
                              0x72, 0x27, 0xfd, 0xc8, 0xa2, 0xc0, 0xa6, 0x95, 0xe7, 0xdd};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xae, 0x2c, 0xa8, 0x4c, 0x86, 0x79, 0x0,  0x81, 0x9,  0xed, 0x98, 0x86, 0xb8, 0xde, 0x1f,
                              0xa8, 0xd0, 0x22, 0x7c, 0xf6, 0x8c, 0x3d, 0xec, 0xc4, 0x7e, 0x8,  0x96, 0xf6, 0xd8, 0xa4};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "eBV0^b\231\GS\250\n\203\224", _password = Just
// "\240\177\187\244\250c\"\200Pw\189\163m|\131\&5*\177\169]", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS1, _willTopic = "\b,([w\253\205\CAN\167\199\238\&0\171\SOHj\206\NUL\245\243\144\169\b\226\180\134\154}\214\194",
// _willMsg = "\181aO\128(\188\ETB", _willProps = []}), _cleanSession = False, _keepAlive = 3521, _connID =
// "\205A\247\ACK\129\&6\196\202\192<\208z\234>\ETB\DC2\195\208\221\STX\DC1L\146s", _properties = []}
TEST(Connect311QCTest, Encode27) {
  uint8_t pkt[] = {0x10, 0x70, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xec, 0xd,  0xc1, 0x0,  0x18, 0xcd, 0x41, 0xf7,
                   0x6,  0x81, 0x36, 0xc4, 0xca, 0xc0, 0x3c, 0xd0, 0x7a, 0xea, 0x3e, 0x17, 0x12, 0xc3, 0xd0, 0xdd, 0x2,
                   0x11, 0x4c, 0x92, 0x73, 0x0,  0x1d, 0x8,  0x2c, 0x28, 0x5b, 0x77, 0xfd, 0xcd, 0x18, 0xa7, 0xc7, 0xee,
                   0x30, 0xab, 0x1,  0x6a, 0xce, 0x0,  0xf5, 0xf3, 0x90, 0xa9, 0x8,  0xe2, 0xb4, 0x86, 0x9a, 0x7d, 0xd6,
                   0xc2, 0x0,  0x7,  0xb5, 0x61, 0x4f, 0x80, 0x28, 0xbc, 0x17, 0x0,  0xc,  0x65, 0x42, 0x56, 0x30, 0x5e,
                   0x62, 0xe7, 0x1d, 0xfa, 0xa,  0xcb, 0xe0, 0x0,  0x14, 0xf0, 0xb1, 0xbb, 0xf4, 0xfa, 0x63, 0x22, 0xc8,
                   0x50, 0x77, 0xbd, 0xa3, 0x6d, 0x7c, 0x83, 0x35, 0x2a, 0xb1, 0xa9, 0x5d};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8,  0x2c, 0x28, 0x5b, 0x77, 0xfd, 0xcd, 0x18, 0xa7, 0xc7, 0xee, 0x30, 0xab, 0x1, 0x6a,
                                0xce, 0x0,  0xf5, 0xf3, 0x90, 0xa9, 0x8,  0xe2, 0xb4, 0x86, 0x9a, 0x7d, 0xd6, 0xc2};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb5, 0x61, 0x4f, 0x80, 0x28, 0xbc, 0x17};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3521;
  uint8_t client_id_bytes[] = {0xcd, 0x41, 0xf7, 0x6,  0x81, 0x36, 0xc4, 0xca, 0xc0, 0x3c, 0xd0, 0x7a,
                               0xea, 0x3e, 0x17, 0x12, 0xc3, 0xd0, 0xdd, 0x2,  0x11, 0x4c, 0x92, 0x73};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x65, 0x42, 0x56, 0x30, 0x5e, 0x62, 0xe7, 0x1d, 0xfa, 0xa, 0xcb, 0xe0};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf0, 0xb1, 0xbb, 0xf4, 0xfa, 0x63, 0x22, 0xc8, 0x50, 0x77,
                              0xbd, 0xa3, 0x6d, 0x7c, 0x83, 0x35, 0x2a, 0xb1, 0xa9, 0x5d};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\v\169[\202\FS\206\145\142I\167&I\169k\b\160XudF\138\227\147V\252\193\134\197", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\223\&5$\DELC3\210\149\FS\188b\147\NUL\203\&8\177\&6\141S\"\236\215C", _willMsg =
// "\137Fydy\130\218\t\246Eu\206\188[\241P\186\235\236", _willProps = []}), _cleanSession = True, _keepAlive = 17383,
// _connID = "\146\157\196~\185Q\216\228Q\237\164K\154M\STX\226\133\244\158\188\177 \245\198\168", _properties = []}
TEST(Connect311QCTest, Encode28) {
  uint8_t pkt[] = {0x10, 0x53, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x2e, 0x43, 0xe7, 0x0,  0x19, 0x92,
                   0x9d, 0xc4, 0x7e, 0xb9, 0x51, 0xd8, 0xe4, 0x51, 0xed, 0xa4, 0x4b, 0x9a, 0x4d, 0x2,  0xe2,
                   0x85, 0xf4, 0x9e, 0xbc, 0xb1, 0x20, 0xf5, 0xc6, 0xa8, 0x0,  0x17, 0xdf, 0x35, 0x24, 0x7f,
                   0x43, 0x33, 0xd2, 0x95, 0x1c, 0xbc, 0x62, 0x93, 0x0,  0xcb, 0x38, 0xb1, 0x36, 0x8d, 0x53,
                   0x22, 0xec, 0xd7, 0x43, 0x0,  0x13, 0x89, 0x46, 0x79, 0x64, 0x79, 0x82, 0xda, 0x9,  0xf6,
                   0x45, 0x75, 0xce, 0xbc, 0x5b, 0xf1, 0x50, 0xba, 0xeb, 0xec};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdf, 0x35, 0x24, 0x7f, 0x43, 0x33, 0xd2, 0x95, 0x1c, 0xbc, 0x62, 0x93,
                                0x0,  0xcb, 0x38, 0xb1, 0x36, 0x8d, 0x53, 0x22, 0xec, 0xd7, 0x43};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x89, 0x46, 0x79, 0x64, 0x79, 0x82, 0xda, 0x9,  0xf6, 0x45,
                                  0x75, 0xce, 0xbc, 0x5b, 0xf1, 0x50, 0xba, 0xeb, 0xec};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17383;
  uint8_t client_id_bytes[] = {0x92, 0x9d, 0xc4, 0x7e, 0xb9, 0x51, 0xd8, 0xe4, 0x51, 0xed, 0xa4, 0x4b, 0x9a,
                               0x4d, 0x2,  0xe2, 0x85, 0xf4, 0x9e, 0xbc, 0xb1, 0x20, 0xf5, 0xc6, 0xa8};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb, 0xa9, 0x5b, 0xca, 0x1c, 0xce, 0x91, 0x8e, 0x49, 0xa7, 0x26, 0x49, 0xa9, 0x6b,
                              0x8, 0xa0, 0x58, 0x75, 0x64, 0x46, 0x8a, 0xe3, 0x93, 0x56, 0xfc, 0xc1, 0x86, 0xc5};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\167\237\156Mq\176\&7F\133;p\STX\164\219,\196,U\NUL\171\ETB\144M", _password = Just
// "\150'c\159\ETX\DC2\144\212TY\230:\SOHvc'\218\154\US2#1\183\&7", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS2, _willTopic = "\STX\r\249A\250?#\SI\142\224\207\203C3\203\129\232\238\f>C\SUB\149\221\198\\1",
// _willMsg = "u}g.\134\182\153", _willProps = []}), _cleanSession = False, _keepAlive = 2013, _connID =
// "\255\RST!?\165@\128+YC\181-\250\193\183\233\&7\RS\197x\SUB[?\f\227t", _properties = []}
TEST(Connect311QCTest, Encode29) {
  uint8_t pkt[] = {0x10, 0x80, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0xd4, 0x7,  0xdd, 0x0,  0x1b, 0xff, 0x1e,
                   0x54, 0x21, 0x3f, 0xa5, 0x40, 0x80, 0x2b, 0x59, 0x43, 0xb5, 0x2d, 0xfa, 0xc1, 0xb7, 0xe9, 0x37, 0x1e,
                   0xc5, 0x78, 0x1a, 0x5b, 0x3f, 0xc,  0xe3, 0x74, 0x0,  0x1b, 0x2,  0xd,  0xf9, 0x41, 0xfa, 0x3f, 0x23,
                   0xf,  0x8e, 0xe0, 0xcf, 0xcb, 0x43, 0x33, 0xcb, 0x81, 0xe8, 0xee, 0xc,  0x3e, 0x43, 0x1a, 0x95, 0xdd,
                   0xc6, 0x5c, 0x31, 0x0,  0x7,  0x75, 0x7d, 0x67, 0x2e, 0x86, 0xb6, 0x99, 0x0,  0x17, 0xa7, 0xed, 0x9c,
                   0x4d, 0x71, 0xb0, 0x37, 0x46, 0x85, 0x3b, 0x70, 0x2,  0xa4, 0xdb, 0x2c, 0xc4, 0x2c, 0x55, 0x0,  0xab,
                   0x17, 0x90, 0x4d, 0x0,  0x18, 0x96, 0x27, 0x63, 0x9f, 0x3,  0x12, 0x90, 0xd4, 0x54, 0x59, 0xe6, 0x3a,
                   0x1,  0x76, 0x63, 0x27, 0xda, 0x9a, 0x1f, 0x32, 0x23, 0x31, 0xb7, 0x37};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2,  0xd,  0xf9, 0x41, 0xfa, 0x3f, 0x23, 0xf,  0x8e, 0xe0, 0xcf, 0xcb, 0x43, 0x33,
                                0xcb, 0x81, 0xe8, 0xee, 0xc,  0x3e, 0x43, 0x1a, 0x95, 0xdd, 0xc6, 0x5c, 0x31};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x75, 0x7d, 0x67, 0x2e, 0x86, 0xb6, 0x99};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2013;
  uint8_t client_id_bytes[] = {0xff, 0x1e, 0x54, 0x21, 0x3f, 0xa5, 0x40, 0x80, 0x2b, 0x59, 0x43, 0xb5, 0x2d, 0xfa,
                               0xc1, 0xb7, 0xe9, 0x37, 0x1e, 0xc5, 0x78, 0x1a, 0x5b, 0x3f, 0xc,  0xe3, 0x74};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa7, 0xed, 0x9c, 0x4d, 0x71, 0xb0, 0x37, 0x46, 0x85, 0x3b, 0x70, 0x2,
                              0xa4, 0xdb, 0x2c, 0xc4, 0x2c, 0x55, 0x0,  0xab, 0x17, 0x90, 0x4d};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0x27, 0x63, 0x9f, 0x3,  0x12, 0x90, 0xd4, 0x54, 0x59, 0xe6, 0x3a,
                              0x1,  0x76, 0x63, 0x27, 0xda, 0x9a, 0x1f, 0x32, 0x23, 0x31, 0xb7, 0x37};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\182\240\189\t", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\187M\164\160l,v\190\218\204Q\220\172R\151\151>", _willMsg =
// "B\157i\190\132.u\233\158\DC3\242]\255\133\181\186\255Z\240\188\227", _willProps = []}), _cleanSession = False,
// _keepAlive = 1282, _connID = "(\191\136\201\182\228\133S\r\250\189X", _properties = []}
TEST(Connect311QCTest, Encode30) {
  uint8_t pkt[] = {0x10, 0x42, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x4,  0x14, 0x5,  0x2,  0x0,  0xc,
                   0x28, 0xbf, 0x88, 0xc9, 0xb6, 0xe4, 0x85, 0x53, 0xd,  0xfa, 0xbd, 0x58, 0x0,  0x11,
                   0xbb, 0x4d, 0xa4, 0xa0, 0x6c, 0x2c, 0x76, 0xbe, 0xda, 0xcc, 0x51, 0xdc, 0xac, 0x52,
                   0x97, 0x97, 0x3e, 0x0,  0x15, 0x42, 0x9d, 0x69, 0xbe, 0x84, 0x2e, 0x75, 0xe9, 0x9e,
                   0x13, 0xf2, 0x5d, 0xff, 0x85, 0xb5, 0xba, 0xff, 0x5a, 0xf0, 0xbc, 0xe3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {};

  lwmqtt_properties_t willprops = {0, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbb, 0x4d, 0xa4, 0xa0, 0x6c, 0x2c, 0x76, 0xbe, 0xda,
                                0xcc, 0x51, 0xdc, 0xac, 0x52, 0x97, 0x97, 0x3e};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x42, 0x9d, 0x69, 0xbe, 0x84, 0x2e, 0x75, 0xe9, 0x9e, 0x13, 0xf2,
                                  0x5d, 0xff, 0x85, 0xb5, 0xba, 0xff, 0x5a, 0xf0, 0xbc, 0xe3};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1282;
  uint8_t client_id_bytes[] = {0x28, 0xbf, 0x88, 0xc9, 0xb6, 0xe4, 0x85, 0x53, 0xd, 0xfa, 0xbd, 0x58};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb6, 0xf0, 0xbd, 0x9};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT311, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "su\219", _password = Just "\245\218", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS2, _willTopic = "\200\218\ENQ\194\150u=", _willMsg = "18\181\155\177B\144\135#\186\ESC",
// _willProps = [PropSessionExpiryInterval 16907,PropAssignedClientIdentifier
// "\164\251\183\146\189\248\f",PropUserProperty "\\\139\180" "\167",PropMessageExpiryInterval
// 20439,PropSharedSubscriptionAvailable 246,PropUserProperty
// "\DC1\128\246\210l\192\248BjzSY\197\NUL\157Hg^\156\132\139" "&H\FSo \156'\216!",PropResponseInformation
// "\165\203\195\162I\140\153\179\147\&3\DC2\242\178L9\177UI\130U\147\RS\234%\231",PropPayloadFormatIndicator
// 212,PropUserProperty "GM\163\t\158T\226\SYN\243\160\235a\176" "`",PropContentType
// "\134\160\vZT\ACK\149\220`",PropSessionExpiryInterval 4579,PropTopicAliasMaximum 22244,PropServerKeepAlive
// 14992,PropMaximumQoS 181,PropServerReference
// "\247\231\181\b\148\177\DEL\240\196\157v?e\f\243\STX\DC2\173\205\205D\152P\239\135 0o",PropAuthenticationMethod
// "3\ETB\218\156/y\239S\RS8\232@m\221|)\200\&7\SI\">:6\185z^\174\220\237n",PropSubscriptionIdentifier
// 27,PropSubscriptionIdentifierAvailable 58,PropMessageExpiryInterval 15968,PropSubscriptionIdentifierAvailable
// 192,PropRetainAvailable 143]}), _cleanSession = True, _keepAlive = 23341, _connID =
// "\167\130W\226#\FSJ:\239#\154)\178i", _properties = [PropAuthenticationData
// "\157\176%_\142\166jk\138\199\158\226\b\197\181J\142\196\218",PropSubscriptionIdentifierAvailable
// 241,PropTopicAliasMaximum 30873,PropSessionExpiryInterval 8383,PropServerKeepAlive 20280,PropResponseTopic
// "\164\FSf?\227\250d\224",PropAuthenticationData
// "\222\STX\SI\169\158\193\143\207\141",PropSubscriptionIdentifierAvailable 189,PropAssignedClientIdentifier
// "",PropCorrelationData "6\140\253\228\176L\DC4K\181M1\179^\"\157do\250",PropTopicAlias 2954,PropTopicAlias
// 9070,PropWildcardSubscriptionAvailable 163,PropRequestProblemInformation 192,PropReasonString
// "KN\219Q\US\SOH\202h\213\NUL\a\166JF\231\ESC\250\249\136\203\SYN\a\249\DLE\242",PropMessageExpiryInterval
// 5860,PropRequestResponseInformation 76,PropSharedSubscriptionAvailable 184]}
TEST(Connect5QCTest, Encode1) {
  uint8_t pkt[] = {
      0x10, 0x99, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xf6, 0x5b, 0x2d, 0x83, 0x1,  0x16, 0x0,  0x13, 0x9d,
      0xb0, 0x25, 0x5f, 0x8e, 0xa6, 0x6a, 0x6b, 0x8a, 0xc7, 0x9e, 0xe2, 0x8,  0xc5, 0xb5, 0x4a, 0x8e, 0xc4, 0xda, 0x29,
      0xf1, 0x22, 0x78, 0x99, 0x11, 0x0,  0x0,  0x20, 0xbf, 0x13, 0x4f, 0x38, 0x8,  0x0,  0x8,  0xa4, 0x1c, 0x66, 0x3f,
      0xe3, 0xfa, 0x64, 0xe0, 0x16, 0x0,  0x9,  0xde, 0x2,  0xf,  0xa9, 0x9e, 0xc1, 0x8f, 0xcf, 0x8d, 0x29, 0xbd, 0x12,
      0x0,  0x0,  0x9,  0x0,  0x12, 0x36, 0x8c, 0xfd, 0xe4, 0xb0, 0x4c, 0x14, 0x4b, 0xb5, 0x4d, 0x31, 0xb3, 0x5e, 0x22,
      0x9d, 0x64, 0x6f, 0xfa, 0x23, 0xb,  0x8a, 0x23, 0x23, 0x6e, 0x28, 0xa3, 0x17, 0xc0, 0x1f, 0x0,  0x19, 0x4b, 0x4e,
      0xdb, 0x51, 0x1f, 0x1,  0xca, 0x68, 0xd5, 0x0,  0x7,  0xa6, 0x4a, 0x46, 0xe7, 0x1b, 0xfa, 0xf9, 0x88, 0xcb, 0x16,
      0x7,  0xf9, 0x10, 0xf2, 0x2,  0x0,  0x0,  0x16, 0xe4, 0x19, 0x4c, 0x2a, 0xb8, 0x0,  0xe,  0xa7, 0x82, 0x57, 0xe2,
      0x23, 0x1c, 0x4a, 0x3a, 0xef, 0x23, 0x9a, 0x29, 0xb2, 0x69, 0xd9, 0x1,  0x11, 0x0,  0x0,  0x42, 0xb,  0x12, 0x0,
      0x7,  0xa4, 0xfb, 0xb7, 0x92, 0xbd, 0xf8, 0xc,  0x26, 0x0,  0x3,  0x5c, 0x8b, 0xb4, 0x0,  0x1,  0xa7, 0x2,  0x0,
      0x0,  0x4f, 0xd7, 0x2a, 0xf6, 0x26, 0x0,  0x15, 0x11, 0x80, 0xf6, 0xd2, 0x6c, 0xc0, 0xf8, 0x42, 0x6a, 0x7a, 0x53,
      0x59, 0xc5, 0x0,  0x9d, 0x48, 0x67, 0x5e, 0x9c, 0x84, 0x8b, 0x0,  0x9,  0x26, 0x48, 0x1c, 0x6f, 0x20, 0x9c, 0x27,
      0xd8, 0x21, 0x1a, 0x0,  0x19, 0xa5, 0xcb, 0xc3, 0xa2, 0x49, 0x8c, 0x99, 0xb3, 0x93, 0x33, 0x12, 0xf2, 0xb2, 0x4c,
      0x39, 0xb1, 0x55, 0x49, 0x82, 0x55, 0x93, 0x1e, 0xea, 0x25, 0xe7, 0x1,  0xd4, 0x26, 0x0,  0xd,  0x47, 0x4d, 0xa3,
      0x9,  0x9e, 0x54, 0xe2, 0x16, 0xf3, 0xa0, 0xeb, 0x61, 0xb0, 0x0,  0x1,  0x60, 0x3,  0x0,  0x9,  0x86, 0xa0, 0xb,
      0x5a, 0x54, 0x6,  0x95, 0xdc, 0x60, 0x11, 0x0,  0x0,  0x11, 0xe3, 0x22, 0x56, 0xe4, 0x13, 0x3a, 0x90, 0x24, 0xb5,
      0x1c, 0x0,  0x1c, 0xf7, 0xe7, 0xb5, 0x8,  0x94, 0xb1, 0x7f, 0xf0, 0xc4, 0x9d, 0x76, 0x3f, 0x65, 0xc,  0xf3, 0x2,
      0x12, 0xad, 0xcd, 0xcd, 0x44, 0x98, 0x50, 0xef, 0x87, 0x20, 0x30, 0x6f, 0x15, 0x0,  0x1e, 0x33, 0x17, 0xda, 0x9c,
      0x2f, 0x79, 0xef, 0x53, 0x1e, 0x38, 0xe8, 0x40, 0x6d, 0xdd, 0x7c, 0x29, 0xc8, 0x37, 0xf,  0x22, 0x3e, 0x3a, 0x36,
      0xb9, 0x7a, 0x5e, 0xae, 0xdc, 0xed, 0x6e, 0xb,  0x1b, 0x29, 0x3a, 0x2,  0x0,  0x0,  0x3e, 0x60, 0x29, 0xc0, 0x25,
      0x8f, 0x0,  0x7,  0xc8, 0xda, 0x5,  0xc2, 0x96, 0x75, 0x3d, 0x0,  0xb,  0x31, 0x38, 0xb5, 0x9b, 0xb1, 0x42, 0x90,
      0x87, 0x23, 0xba, 0x1b, 0x0,  0x3,  0x73, 0x75, 0xdb, 0x0,  0x2,  0xf5, 0xda};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9d, 0xb0, 0x25, 0x5f, 0x8e, 0xa6, 0x6a, 0x6b, 0x8a, 0xc7,
                           0x9e, 0xe2, 0x8,  0xc5, 0xb5, 0x4a, 0x8e, 0xc4, 0xda};
  uint8_t bytesprops1[] = {0xa4, 0x1c, 0x66, 0x3f, 0xe3, 0xfa, 0x64, 0xe0};
  uint8_t bytesprops2[] = {0xde, 0x2, 0xf, 0xa9, 0x9e, 0xc1, 0x8f, 0xcf, 0x8d};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x36, 0x8c, 0xfd, 0xe4, 0xb0, 0x4c, 0x14, 0x4b, 0xb5,
                           0x4d, 0x31, 0xb3, 0x5e, 0x22, 0x9d, 0x64, 0x6f, 0xfa};
  uint8_t bytesprops5[] = {0x4b, 0x4e, 0xdb, 0x51, 0x1f, 0x1,  0xca, 0x68, 0xd5, 0x0,  0x7,  0xa6, 0x4a,
                           0x46, 0xe7, 0x1b, 0xfa, 0xf9, 0x88, 0xcb, 0x16, 0x7,  0xf9, 0x10, 0xf2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30873}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8383}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20280}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2954}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9070}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 163}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5860}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 76}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 184}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xa4, 0xfb, 0xb7, 0x92, 0xbd, 0xf8, 0xc};
  uint8_t byteswillprops2[] = {0xa7};
  uint8_t byteswillprops1[] = {0x5c, 0x8b, 0xb4};
  uint8_t byteswillprops4[] = {0x26, 0x48, 0x1c, 0x6f, 0x20, 0x9c, 0x27, 0xd8, 0x21};
  uint8_t byteswillprops3[] = {0x11, 0x80, 0xf6, 0xd2, 0x6c, 0xc0, 0xf8, 0x42, 0x6a, 0x7a, 0x53,
                               0x59, 0xc5, 0x0,  0x9d, 0x48, 0x67, 0x5e, 0x9c, 0x84, 0x8b};
  uint8_t byteswillprops5[] = {0xa5, 0xcb, 0xc3, 0xa2, 0x49, 0x8c, 0x99, 0xb3, 0x93, 0x33, 0x12, 0xf2, 0xb2,
                               0x4c, 0x39, 0xb1, 0x55, 0x49, 0x82, 0x55, 0x93, 0x1e, 0xea, 0x25, 0xe7};
  uint8_t byteswillprops7[] = {0x60};
  uint8_t byteswillprops6[] = {0x47, 0x4d, 0xa3, 0x9, 0x9e, 0x54, 0xe2, 0x16, 0xf3, 0xa0, 0xeb, 0x61, 0xb0};
  uint8_t byteswillprops8[] = {0x86, 0xa0, 0xb, 0x5a, 0x54, 0x6, 0x95, 0xdc, 0x60};
  uint8_t byteswillprops9[] = {0xf7, 0xe7, 0xb5, 0x8,  0x94, 0xb1, 0x7f, 0xf0, 0xc4, 0x9d, 0x76, 0x3f, 0x65, 0xc,
                               0xf3, 0x2,  0x12, 0xad, 0xcd, 0xcd, 0x44, 0x98, 0x50, 0xef, 0x87, 0x20, 0x30, 0x6f};
  uint8_t byteswillprops10[] = {0x33, 0x17, 0xda, 0x9c, 0x2f, 0x79, 0xef, 0x53, 0x1e, 0x38,
                                0xe8, 0x40, 0x6d, 0xdd, 0x7c, 0x29, 0xc8, 0x37, 0xf,  0x22,
                                0x3e, 0x3a, 0x36, 0xb9, 0x7a, 0x5e, 0xae, 0xdc, 0xed, 0x6e};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16907}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {3, (char*)&byteswillprops1}, .v = {1, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20439}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {21, (char*)&byteswillprops3}, .v = {9, (char*)&byteswillprops4}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {13, (char*)&byteswillprops6}, .v = {1, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4579}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22244}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14992}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15968}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 192}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 143}},
  };

  lwmqtt_properties_t willprops = {21, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc8, 0xda, 0x5, 0xc2, 0x96, 0x75, 0x3d};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x31, 0x38, 0xb5, 0x9b, 0xb1, 0x42, 0x90, 0x87, 0x23, 0xba, 0x1b};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 23341;
  uint8_t client_id_bytes[] = {0xa7, 0x82, 0x57, 0xe2, 0x23, 0x1c, 0x4a, 0x3a, 0xef, 0x23, 0x9a, 0x29, 0xb2, 0x69};
  lwmqtt_string_t client_id = {14, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x73, 0x75, 0xdb};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf5, 0xda};
  lwmqtt_string_t password = {2, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "P\166UwM\219C\247)G\246N\221{\180_\252\165e\v\208q\130c\RS\211C<", _password = Just
// "\130\CAN3\224\145\232]\239\145\186\165\178v\169N=\a+\t -", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS0, _willTopic = "\\\179", _willMsg = "\165\154\226\EOTH\244,\148\217\b|", _willProps = [PropResponseInformation
// "\205P3r\166<\147\167\NULn\165\251\136"]}), _cleanSession = False, _keepAlive = 18048, _connID =
// "J\190\236\SO\209A\240R\155\STX:\190\166-\217C\169\EM\134\160\170\226\251I\v\238\&6\208\149", _properties =
// [PropResponseTopic "c\255^XR\248\&9 \183\213\251\&8W\FSr\\fJ\186\145q]\DEL\211sK\196\STX",PropMessageExpiryInterval
// 5918,PropRetainAvailable 159,PropUserProperty "\DC3\219\232\138\178\245\178\169\DC3"
// "\GS\188\&9\151\191M\236|\162",PropServerReference "\199,s\205\185yN8\170\132\144\138",PropReceiveMaximum
// 23323,PropAuthenticationData "v_\138\&4F E\219\SO\210d\213\138\166o\133t<\179\153\158",PropUserProperty
// "\CAN\194\CAN\191\171f;\a\238\222}\211\133\170>\DC2\212\DC3*\159\140\231\201\231V\DEL\158\206R\NUL" "f\229\a\160"]}
TEST(Connect5QCTest, Encode2) {
  uint8_t pkt[] = {
      0x10, 0x90, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x46, 0x80, 0x8e, 0x1,  0x8,  0x0,  0x1c, 0x63,
      0xff, 0x5e, 0x58, 0x52, 0xf8, 0x39, 0x20, 0xb7, 0xd5, 0xfb, 0x38, 0x57, 0x1c, 0x72, 0x5c, 0x66, 0x4a, 0xba, 0x91,
      0x71, 0x5d, 0x7f, 0xd3, 0x73, 0x4b, 0xc4, 0x2,  0x2,  0x0,  0x0,  0x17, 0x1e, 0x25, 0x9f, 0x26, 0x0,  0x9,  0x13,
      0xdb, 0xe8, 0x8a, 0xb2, 0xf5, 0xb2, 0xa9, 0x13, 0x0,  0x9,  0x1d, 0xbc, 0x39, 0x97, 0xbf, 0x4d, 0xec, 0x7c, 0xa2,
      0x1c, 0x0,  0xc,  0xc7, 0x2c, 0x73, 0xcd, 0xb9, 0x79, 0x4e, 0x38, 0xaa, 0x84, 0x90, 0x8a, 0x21, 0x5b, 0x1b, 0x16,
      0x0,  0x15, 0x76, 0x5f, 0x8a, 0x34, 0x46, 0x20, 0x45, 0xdb, 0xe,  0xd2, 0x64, 0xd5, 0x8a, 0xa6, 0x6f, 0x85, 0x74,
      0x3c, 0xb3, 0x99, 0x9e, 0x26, 0x0,  0x1e, 0x18, 0xc2, 0x18, 0xbf, 0xab, 0x66, 0x3b, 0x7,  0xee, 0xde, 0x7d, 0xd3,
      0x85, 0xaa, 0x3e, 0x12, 0xd4, 0x13, 0x2a, 0x9f, 0x8c, 0xe7, 0xc9, 0xe7, 0x56, 0x7f, 0x9e, 0xce, 0x52, 0x0,  0x0,
      0x4,  0x66, 0xe5, 0x7,  0xa0, 0x0,  0x1d, 0x4a, 0xbe, 0xec, 0xe,  0xd1, 0x41, 0xf0, 0x52, 0x9b, 0x2,  0x3a, 0xbe,
      0xa6, 0x2d, 0xd9, 0x43, 0xa9, 0x19, 0x86, 0xa0, 0xaa, 0xe2, 0xfb, 0x49, 0xb,  0xee, 0x36, 0xd0, 0x95, 0x10, 0x1a,
      0x0,  0xd,  0xcd, 0x50, 0x33, 0x72, 0xa6, 0x3c, 0x93, 0xa7, 0x0,  0x6e, 0xa5, 0xfb, 0x88, 0x0,  0x2,  0x5c, 0xb3,
      0x0,  0xb,  0xa5, 0x9a, 0xe2, 0x4,  0x48, 0xf4, 0x2c, 0x94, 0xd9, 0x8,  0x7c, 0x0,  0x1c, 0x50, 0xa6, 0x55, 0x77,
      0x4d, 0xdb, 0x43, 0xf7, 0x29, 0x47, 0xf6, 0x4e, 0xdd, 0x7b, 0xb4, 0x5f, 0xfc, 0xa5, 0x65, 0xb,  0xd0, 0x71, 0x82,
      0x63, 0x1e, 0xd3, 0x43, 0x3c, 0x0,  0x15, 0x82, 0x18, 0x33, 0xe0, 0x91, 0xe8, 0x5d, 0xef, 0x91, 0xba, 0xa5, 0xb2,
      0x76, 0xa9, 0x4e, 0x3d, 0x7,  0x2b, 0x9,  0x20, 0x2d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x63, 0xff, 0x5e, 0x58, 0x52, 0xf8, 0x39, 0x20, 0xb7, 0xd5, 0xfb, 0x38, 0x57, 0x1c,
                           0x72, 0x5c, 0x66, 0x4a, 0xba, 0x91, 0x71, 0x5d, 0x7f, 0xd3, 0x73, 0x4b, 0xc4, 0x2};
  uint8_t bytesprops2[] = {0x1d, 0xbc, 0x39, 0x97, 0xbf, 0x4d, 0xec, 0x7c, 0xa2};
  uint8_t bytesprops1[] = {0x13, 0xdb, 0xe8, 0x8a, 0xb2, 0xf5, 0xb2, 0xa9, 0x13};
  uint8_t bytesprops3[] = {0xc7, 0x2c, 0x73, 0xcd, 0xb9, 0x79, 0x4e, 0x38, 0xaa, 0x84, 0x90, 0x8a};
  uint8_t bytesprops4[] = {0x76, 0x5f, 0x8a, 0x34, 0x46, 0x20, 0x45, 0xdb, 0xe,  0xd2, 0x64,
                           0xd5, 0x8a, 0xa6, 0x6f, 0x85, 0x74, 0x3c, 0xb3, 0x99, 0x9e};
  uint8_t bytesprops6[] = {0x66, 0xe5, 0x7, 0xa0};
  uint8_t bytesprops5[] = {0x18, 0xc2, 0x18, 0xbf, 0xab, 0x66, 0x3b, 0x7,  0xee, 0xde, 0x7d, 0xd3, 0x85, 0xaa, 0x3e,
                           0x12, 0xd4, 0x13, 0x2a, 0x9f, 0x8c, 0xe7, 0xc9, 0xe7, 0x56, 0x7f, 0x9e, 0xce, 0x52, 0x0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5918}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 159}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops1}, .v = {9, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23323}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops5}, .v = {4, (char*)&bytesprops6}}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xcd, 0x50, 0x33, 0x72, 0xa6, 0x3c, 0x93, 0xa7, 0x0, 0x6e, 0xa5, 0xfb, 0x88};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&byteswillprops0}}},
  };

  lwmqtt_properties_t willprops = {1, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x5c, 0xb3};
  lwmqtt_string_t will_topic = {2, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa5, 0x9a, 0xe2, 0x4, 0x48, 0xf4, 0x2c, 0x94, 0xd9, 0x8, 0x7c};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 18048;
  uint8_t client_id_bytes[] = {0x4a, 0xbe, 0xec, 0xe,  0xd1, 0x41, 0xf0, 0x52, 0x9b, 0x2, 0x3a, 0xbe, 0xa6, 0x2d, 0xd9,
                               0x43, 0xa9, 0x19, 0x86, 0xa0, 0xaa, 0xe2, 0xfb, 0x49, 0xb, 0xee, 0x36, 0xd0, 0x95};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x50, 0xa6, 0x55, 0x77, 0x4d, 0xdb, 0x43, 0xf7, 0x29, 0x47, 0xf6, 0x4e, 0xdd, 0x7b,
                              0xb4, 0x5f, 0xfc, 0xa5, 0x65, 0xb,  0xd0, 0x71, 0x82, 0x63, 0x1e, 0xd3, 0x43, 0x3c};
  lwmqtt_string_t username = {28, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x82, 0x18, 0x33, 0xe0, 0x91, 0xe8, 0x5d, 0xef, 0x91, 0xba, 0xa5,
                              0xb2, 0x76, 0xa9, 0x4e, 0x3d, 0x7,  0x2b, 0x9,  0x20, 0x2d};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "2\SYN9\139\255u\201\DEL\234\DEL\164@W\249\SUB\225B\154\170*\\H\246:b\164",
// _password = Just "+ZTUH\240]\158$\252\179\130\182\154hK", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\248\227\198;\219P\186\DC1\SO\130\166<\193j\180\&3\199\231BD@\235", _willMsg = "\231", _willProps
// = [PropResponseInformation "\188",PropMaximumQoS 180,PropPayloadFormatIndicator 242,PropRequestResponseInformation
// 85,PropUserProperty "p\151\153Fo\162\&4\DC2\140\236\179\186\248Q\247\200\228F?\135Z"
// "\DEL\134\&2\190]\200A(6B",PropAssignedClientIdentifier
// "i0\232\188\215\215Q\168\f\184\146\208\147M\165`\223\254\183\245\ESC=\135\151\228\SOH\173",PropSubscriptionIdentifierAvailable
// 175,PropMessageExpiryInterval 31995,PropSubscriptionIdentifier 4,PropSharedSubscriptionAvailable 43]}), _cleanSession
// = True, _keepAlive = 16330, _connID = "\v\176\184\NULR", _properties = [PropSubscriptionIdentifier
// 8,PropRetainAvailable 107,PropSubscriptionIdentifierAvailable 148,PropResponseInformation
// ")\ESC\231\233\US\140\254\254Q[\180\DC3\STX[\136\191O]\161\208=\207\222Ar\NUL\235w",PropRetainAvailable
// 4,PropMessageExpiryInterval 7551,PropReasonString "Q\177\223\156\161%\220",PropRetainAvailable 208]}
TEST(Connect5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x10, 0xeb, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x3f, 0xca, 0x38, 0xb,  0x8,  0x25, 0x6b, 0x29,
      0x94, 0x1a, 0x0,  0x1c, 0x29, 0x1b, 0xe7, 0xe9, 0x1f, 0x8c, 0xfe, 0xfe, 0x51, 0x5b, 0xb4, 0x13, 0x2,  0x5b, 0x88,
      0xbf, 0x4f, 0x5d, 0xa1, 0xd0, 0x3d, 0xcf, 0xde, 0x41, 0x72, 0x0,  0xeb, 0x77, 0x25, 0x4,  0x2,  0x0,  0x0,  0x1d,
      0x7f, 0x1f, 0x0,  0x7,  0x51, 0xb1, 0xdf, 0x9c, 0xa1, 0x25, 0xdc, 0x25, 0xd0, 0x0,  0x5,  0xb,  0xb0, 0xb8, 0x0,
      0x52, 0x57, 0x1a, 0x0,  0x1,  0xbc, 0x24, 0xb4, 0x1,  0xf2, 0x19, 0x55, 0x26, 0x0,  0x15, 0x70, 0x97, 0x99, 0x46,
      0x6f, 0xa2, 0x34, 0x12, 0x8c, 0xec, 0xb3, 0xba, 0xf8, 0x51, 0xf7, 0xc8, 0xe4, 0x46, 0x3f, 0x87, 0x5a, 0x0,  0xa,
      0x7f, 0x86, 0x32, 0xbe, 0x5d, 0xc8, 0x41, 0x28, 0x36, 0x42, 0x12, 0x0,  0x1b, 0x69, 0x30, 0xe8, 0xbc, 0xd7, 0xd7,
      0x51, 0xa8, 0xc,  0xb8, 0x92, 0xd0, 0x93, 0x4d, 0xa5, 0x60, 0xdf, 0xfe, 0xb7, 0xf5, 0x1b, 0x3d, 0x87, 0x97, 0xe4,
      0x1,  0xad, 0x29, 0xaf, 0x2,  0x0,  0x0,  0x7c, 0xfb, 0xb,  0x4,  0x2a, 0x2b, 0x0,  0x16, 0xf8, 0xe3, 0xc6, 0x3b,
      0xdb, 0x50, 0xba, 0x11, 0xe,  0x82, 0xa6, 0x3c, 0xc1, 0x6a, 0xb4, 0x33, 0xc7, 0xe7, 0x42, 0x44, 0x40, 0xeb, 0x0,
      0x1,  0xe7, 0x0,  0x1a, 0x32, 0x16, 0x39, 0x8b, 0xff, 0x75, 0xc9, 0x7f, 0xea, 0x7f, 0xa4, 0x40, 0x57, 0xf9, 0x1a,
      0xe1, 0x42, 0x9a, 0xaa, 0x2a, 0x5c, 0x48, 0xf6, 0x3a, 0x62, 0xa4, 0x0,  0x10, 0x2b, 0x5a, 0x54, 0x55, 0x48, 0xf0,
      0x5d, 0x9e, 0x24, 0xfc, 0xb3, 0x82, 0xb6, 0x9a, 0x68, 0x4b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x29, 0x1b, 0xe7, 0xe9, 0x1f, 0x8c, 0xfe, 0xfe, 0x51, 0x5b, 0xb4, 0x13, 0x2,  0x5b,
                           0x88, 0xbf, 0x4f, 0x5d, 0xa1, 0xd0, 0x3d, 0xcf, 0xde, 0x41, 0x72, 0x0,  0xeb, 0x77};
  uint8_t bytesprops1[] = {0x51, 0xb1, 0xdf, 0x9c, 0xa1, 0x25, 0xdc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7551}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 208}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xbc};
  uint8_t byteswillprops2[] = {0x7f, 0x86, 0x32, 0xbe, 0x5d, 0xc8, 0x41, 0x28, 0x36, 0x42};
  uint8_t byteswillprops1[] = {0x70, 0x97, 0x99, 0x46, 0x6f, 0xa2, 0x34, 0x12, 0x8c, 0xec, 0xb3,
                               0xba, 0xf8, 0x51, 0xf7, 0xc8, 0xe4, 0x46, 0x3f, 0x87, 0x5a};
  uint8_t byteswillprops3[] = {0x69, 0x30, 0xe8, 0xbc, 0xd7, 0xd7, 0x51, 0xa8, 0xc,  0xb8, 0x92, 0xd0, 0x93, 0x4d,
                               0xa5, 0x60, 0xdf, 0xfe, 0xb7, 0xf5, 0x1b, 0x3d, 0x87, 0x97, 0xe4, 0x1,  0xad};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 242}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 85}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {21, (char*)&byteswillprops1}, .v = {10, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31995}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 43}},
  };

  lwmqtt_properties_t willprops = {10, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xf8, 0xe3, 0xc6, 0x3b, 0xdb, 0x50, 0xba, 0x11, 0xe,  0x82, 0xa6,
                                0x3c, 0xc1, 0x6a, 0xb4, 0x33, 0xc7, 0xe7, 0x42, 0x44, 0x40, 0xeb};
  lwmqtt_string_t will_topic = {22, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe7};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 16330;
  uint8_t client_id_bytes[] = {0xb, 0xb0, 0xb8, 0x0, 0x52};
  lwmqtt_string_t client_id = {5, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x32, 0x16, 0x39, 0x8b, 0xff, 0x75, 0xc9, 0x7f, 0xea, 0x7f, 0xa4, 0x40, 0x57,
                              0xf9, 0x1a, 0xe1, 0x42, 0x9a, 0xaa, 0x2a, 0x5c, 0x48, 0xf6, 0x3a, 0x62, 0xa4};
  lwmqtt_string_t username = {26, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x2b, 0x5a, 0x54, 0x55, 0x48, 0xf0, 0x5d, 0x9e,
                              0x24, 0xfc, 0xb3, 0x82, 0xb6, 0x9a, 0x68, 0x4b};
  lwmqtt_string_t password = {16, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\SOH\222\148y4W7\221\234\219\249G\176i\153\&7C\174\DC3\201\168", _password =
// Nothing, _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0, _willTopic = "\182\DC2\202\175'\175",
// _willMsg = "FT\180\227 ,\DLEhU\147g\249\210sn\150=>P\234h4\234\150\&6T\137\149\192\216", _willProps =
// [PropWildcardSubscriptionAvailable 106,PropRetainAvailable 244,PropRequestProblemInformation
// 51,PropSharedSubscriptionAvailable 219,PropMaximumQoS 11,PropSubscriptionIdentifier 16,PropSubscriptionIdentifier
// 26,PropCorrelationData "\r\243~\154\NUL\248\252y)\252\144\214\SOH\249\186\&1",PropSubscriptionIdentifierAvailable
// 202,PropMaximumPacketSize 19589,PropResponseInformation
// "\173\208\ACK\n\200\251\198<=\DC2\246b\207\211\216\165.",PropServerReference "\ENQ",PropWillDelayInterval
// 25985,PropSharedSubscriptionAvailable 114,PropResponseInformation "7\246\&2",PropMessageExpiryInterval
// 909,PropServerKeepAlive 24831,PropSubscriptionIdentifier 8,PropUserProperty "G\130\229"
// "\241z\186g\224\158R\130C\246\140\ENQ^s/\236\199\ENQU\GSl\US\r`\246",PropPayloadFormatIndicator
// 231,PropWillDelayInterval 29690,PropRequestResponseInformation 152,PropAssignedClientIdentifier
// "Y\253\201\&1\226\&0\250Ql\188\153\224C\231\DC4\225\229\238I>\141]\184e\236\201\165",PropTopicAlias
// 132,PropReceiveMaximum 7672,PropReasonString "#\nH\t\192\223\223>R\179q\144\ETB",PropSharedSubscriptionAvailable
// 4,PropMaximumPacketSize 4671,PropTopicAlias 22943,PropMessageExpiryInterval 29025]}), _cleanSession = True,
// _keepAlive = 30046, _connID = "A'\216\131\251\208\218\DC4\152\230\198\239\a", _properties =
// [PropMessageExpiryInterval 23903,PropSubscriptionIdentifier 0,PropUserProperty "v\235"
// "\b4\NAK\ACK,\141\US\230T\228[\EOT0vu\ENQ?",PropServerReference
// "\216TZ\165/>\146\146\160\237)\208o\EOT\234",PropServerReference ";\173U1|\DLE\197M\147\241\178Y
// Q[\STX\243R\233\150o\172zb\130",PropPayloadFormatIndicator 196,PropCorrelationData
// "\234\DC1\243\ESC\233\vH\202",PropRequestResponseInformation 37,PropContentType ""]}
TEST(Connect5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x10, 0xfe, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xa6, 0x75, 0x5e, 0x5f, 0x2,  0x0,  0x0,  0x5d, 0x5f,
      0xb,  0x0,  0x26, 0x0,  0x2,  0x76, 0xeb, 0x0,  0x11, 0x8,  0x34, 0x15, 0x6,  0x2c, 0x8d, 0x1f, 0xe6, 0x54, 0xe4,
      0x5b, 0x4,  0x30, 0x76, 0x75, 0x5,  0x3f, 0x1c, 0x0,  0xf,  0xd8, 0x54, 0x5a, 0xa5, 0x2f, 0x3e, 0x92, 0x92, 0xa0,
      0xed, 0x29, 0xd0, 0x6f, 0x4,  0xea, 0x1c, 0x0,  0x19, 0x3b, 0xad, 0x55, 0x31, 0x7c, 0x10, 0xc5, 0x4d, 0x93, 0xf1,
      0xb2, 0x59, 0x20, 0x51, 0x5b, 0x2,  0xf3, 0x52, 0xe9, 0x96, 0x6f, 0xac, 0x7a, 0x62, 0x82, 0x1,  0xc4, 0x9,  0x0,
      0x8,  0xea, 0x11, 0xf3, 0x1b, 0xe9, 0xb,  0x48, 0xca, 0x19, 0x25, 0x3,  0x0,  0x0,  0x0,  0xd,  0x41, 0x27, 0xd8,
      0x83, 0xfb, 0xd0, 0xda, 0x14, 0x98, 0xe6, 0xc6, 0xef, 0x7,  0xc4, 0x1,  0x28, 0x6a, 0x25, 0xf4, 0x17, 0x33, 0x2a,
      0xdb, 0x24, 0xb,  0xb,  0x10, 0xb,  0x1a, 0x9,  0x0,  0x10, 0xd,  0xf3, 0x7e, 0x9a, 0x0,  0xf8, 0xfc, 0x79, 0x29,
      0xfc, 0x90, 0xd6, 0x1,  0xf9, 0xba, 0x31, 0x29, 0xca, 0x27, 0x0,  0x0,  0x4c, 0x85, 0x1a, 0x0,  0x11, 0xad, 0xd0,
      0x6,  0xa,  0xc8, 0xfb, 0xc6, 0x3c, 0x3d, 0x12, 0xf6, 0x62, 0xcf, 0xd3, 0xd8, 0xa5, 0x2e, 0x1c, 0x0,  0x1,  0x5,
      0x18, 0x0,  0x0,  0x65, 0x81, 0x2a, 0x72, 0x1a, 0x0,  0x3,  0x37, 0xf6, 0x32, 0x2,  0x0,  0x0,  0x3,  0x8d, 0x13,
      0x60, 0xff, 0xb,  0x8,  0x26, 0x0,  0x3,  0x47, 0x82, 0xe5, 0x0,  0x19, 0xf1, 0x7a, 0xba, 0x67, 0xe0, 0x9e, 0x52,
      0x82, 0x43, 0xf6, 0x8c, 0x5,  0x5e, 0x73, 0x2f, 0xec, 0xc7, 0x5,  0x55, 0x1d, 0x6c, 0x1f, 0xd,  0x60, 0xf6, 0x1,
      0xe7, 0x18, 0x0,  0x0,  0x73, 0xfa, 0x19, 0x98, 0x12, 0x0,  0x1b, 0x59, 0xfd, 0xc9, 0x31, 0xe2, 0x30, 0xfa, 0x51,
      0x6c, 0xbc, 0x99, 0xe0, 0x43, 0xe7, 0x14, 0xe1, 0xe5, 0xee, 0x49, 0x3e, 0x8d, 0x5d, 0xb8, 0x65, 0xec, 0xc9, 0xa5,
      0x23, 0x0,  0x84, 0x21, 0x1d, 0xf8, 0x1f, 0x0,  0xd,  0x23, 0xa,  0x48, 0x9,  0xc0, 0xdf, 0xdf, 0x3e, 0x52, 0xb3,
      0x71, 0x90, 0x17, 0x2a, 0x4,  0x27, 0x0,  0x0,  0x12, 0x3f, 0x23, 0x59, 0x9f, 0x2,  0x0,  0x0,  0x71, 0x61, 0x0,
      0x6,  0xb6, 0x12, 0xca, 0xaf, 0x27, 0xaf, 0x0,  0x1e, 0x46, 0x54, 0xb4, 0xe3, 0x20, 0x2c, 0x10, 0x68, 0x55, 0x93,
      0x67, 0xf9, 0xd2, 0x73, 0x6e, 0x96, 0x3d, 0x3e, 0x50, 0xea, 0x68, 0x34, 0xea, 0x96, 0x36, 0x54, 0x89, 0x95, 0xc0,
      0xd8, 0x0,  0x15, 0x1,  0xde, 0x94, 0x79, 0x34, 0x57, 0x37, 0xdd, 0xea, 0xdb, 0xf9, 0x47, 0xb0, 0x69, 0x99, 0x37,
      0x43, 0xae, 0x13, 0xc9, 0xa8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x8,  0x34, 0x15, 0x6,  0x2c, 0x8d, 0x1f, 0xe6, 0x54,
                           0xe4, 0x5b, 0x4,  0x30, 0x76, 0x75, 0x5,  0x3f};
  uint8_t bytesprops0[] = {0x76, 0xeb};
  uint8_t bytesprops2[] = {0xd8, 0x54, 0x5a, 0xa5, 0x2f, 0x3e, 0x92, 0x92, 0xa0, 0xed, 0x29, 0xd0, 0x6f, 0x4, 0xea};
  uint8_t bytesprops3[] = {0x3b, 0xad, 0x55, 0x31, 0x7c, 0x10, 0xc5, 0x4d, 0x93, 0xf1, 0xb2, 0x59, 0x20,
                           0x51, 0x5b, 0x2,  0xf3, 0x52, 0xe9, 0x96, 0x6f, 0xac, 0x7a, 0x62, 0x82};
  uint8_t bytesprops4[] = {0xea, 0x11, 0xf3, 0x1b, 0xe9, 0xb, 0x48, 0xca};
  uint8_t bytesprops5[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23903}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {2, (char*)&bytesprops0}, .v = {17, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 196}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xd,  0xf3, 0x7e, 0x9a, 0x0, 0xf8, 0xfc, 0x79,
                               0x29, 0xfc, 0x90, 0xd6, 0x1, 0xf9, 0xba, 0x31};
  uint8_t byteswillprops1[] = {0xad, 0xd0, 0x6,  0xa,  0xc8, 0xfb, 0xc6, 0x3c, 0x3d,
                               0x12, 0xf6, 0x62, 0xcf, 0xd3, 0xd8, 0xa5, 0x2e};
  uint8_t byteswillprops2[] = {0x5};
  uint8_t byteswillprops3[] = {0x37, 0xf6, 0x32};
  uint8_t byteswillprops5[] = {0xf1, 0x7a, 0xba, 0x67, 0xe0, 0x9e, 0x52, 0x82, 0x43, 0xf6, 0x8c, 0x5, 0x5e,
                               0x73, 0x2f, 0xec, 0xc7, 0x5,  0x55, 0x1d, 0x6c, 0x1f, 0xd,  0x60, 0xf6};
  uint8_t byteswillprops4[] = {0x47, 0x82, 0xe5};
  uint8_t byteswillprops6[] = {0x59, 0xfd, 0xc9, 0x31, 0xe2, 0x30, 0xfa, 0x51, 0x6c, 0xbc, 0x99, 0xe0, 0x43, 0xe7,
                               0x14, 0xe1, 0xe5, 0xee, 0x49, 0x3e, 0x8d, 0x5d, 0xb8, 0x65, 0xec, 0xc9, 0xa5};
  uint8_t byteswillprops7[] = {0x23, 0xa, 0x48, 0x9, 0xc0, 0xdf, 0xdf, 0x3e, 0x52, 0xb3, 0x71, 0x90, 0x17};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19589}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {1, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25985}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 909}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24831}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 8}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {3, (char*)&byteswillprops4}, .v = {25, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29690}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 132}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7672}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4671}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 22943}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29025}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xb6, 0x12, 0xca, 0xaf, 0x27, 0xaf};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x46, 0x54, 0xb4, 0xe3, 0x20, 0x2c, 0x10, 0x68, 0x55, 0x93,
                                  0x67, 0xf9, 0xd2, 0x73, 0x6e, 0x96, 0x3d, 0x3e, 0x50, 0xea,
                                  0x68, 0x34, 0xea, 0x96, 0x36, 0x54, 0x89, 0x95, 0xc0, 0xd8};
  lwmqtt_string_t will_payload = {30, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 30046;
  uint8_t client_id_bytes[] = {0x41, 0x27, 0xd8, 0x83, 0xfb, 0xd0, 0xda, 0x14, 0x98, 0xe6, 0xc6, 0xef, 0x7};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1,  0xde, 0x94, 0x79, 0x34, 0x57, 0x37, 0xdd, 0xea, 0xdb, 0xf9,
                              0x47, 0xb0, 0x69, 0x99, 0x37, 0x43, 0xae, 0x13, 0xc9, 0xa8};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "~\247\167\ACK\232\156\SYN\185\229`S\252", _password = Just
// "\f\149\174\193\181\&4\229ys\252zT\227\DC2\247\&2\216\183\132)\183\"#-\226\142", _lastWill = Nothing, _cleanSession =
// True, _keepAlive = 2932, _connID = "\199h5A</\202z\186@;\DLEQ\194\213\ACK\233\132\137\221v! \EOT", _properties =
// [PropUserProperty ",\153\148\212\138\rR\187\233Y\214%f" "\237\DC1\196\204\221\"n\158\210"]}
TEST(Connect5QCTest, Encode5) {
  uint8_t pkt[] = {0x10, 0x6a, 0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc2, 0xb,  0x74, 0x1b, 0x26, 0x0,  0xd,
                   0x2c, 0x99, 0x94, 0xd4, 0x8a, 0xd,  0x52, 0xbb, 0xe9, 0x59, 0xd6, 0x25, 0x66, 0x0,  0x9,  0xed,
                   0x11, 0xc4, 0xcc, 0xdd, 0x22, 0x6e, 0x9e, 0xd2, 0x0,  0x18, 0xc7, 0x68, 0x35, 0x41, 0x3c, 0x2f,
                   0xca, 0x7a, 0xba, 0x40, 0x3b, 0x10, 0x51, 0xc2, 0xd5, 0x6,  0xe9, 0x84, 0x89, 0xdd, 0x76, 0x21,
                   0x20, 0x4,  0x0,  0xc,  0x7e, 0xf7, 0xa7, 0x6,  0xe8, 0x9c, 0x16, 0xb9, 0xe5, 0x60, 0x53, 0xfc,
                   0x0,  0x1a, 0xc,  0x95, 0xae, 0xc1, 0xb5, 0x34, 0xe5, 0x79, 0x73, 0xfc, 0x7a, 0x54, 0xe3, 0x12,
                   0xf7, 0x32, 0xd8, 0xb7, 0x84, 0x29, 0xb7, 0x22, 0x23, 0x2d, 0xe2, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0xed, 0x11, 0xc4, 0xcc, 0xdd, 0x22, 0x6e, 0x9e, 0xd2};
  uint8_t bytesprops0[] = {0x2c, 0x99, 0x94, 0xd4, 0x8a, 0xd, 0x52, 0xbb, 0xe9, 0x59, 0xd6, 0x25, 0x66};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops0}, .v = {9, (char*)&bytesprops1}}}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 2932;
  uint8_t client_id_bytes[] = {0xc7, 0x68, 0x35, 0x41, 0x3c, 0x2f, 0xca, 0x7a, 0xba, 0x40, 0x3b, 0x10,
                               0x51, 0xc2, 0xd5, 0x6,  0xe9, 0x84, 0x89, 0xdd, 0x76, 0x21, 0x20, 0x4};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x7e, 0xf7, 0xa7, 0x6, 0xe8, 0x9c, 0x16, 0xb9, 0xe5, 0x60, 0x53, 0xfc};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xc,  0x95, 0xae, 0xc1, 0xb5, 0x34, 0xe5, 0x79, 0x73, 0xfc, 0x7a, 0x54, 0xe3,
                              0x12, 0xf7, 0x32, 0xd8, 0xb7, 0x84, 0x29, 0xb7, 0x22, 0x23, 0x2d, 0xe2, 0x8e};
  lwmqtt_string_t password = {26, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS1, _willTopic = "", _willMsg = "\USm", _willProps = [PropServerKeepAlive 5999,PropMaximumQoS
// 219,PropServerReference
// "\ESC\169>\DC2\179`\178Q\DLE\ACK\182\ENQ\248Do\214\145o\SOi7\155\164\232G\239\ENQ\r",PropTopicAliasMaximum
// 23410,PropMessageExpiryInterval 27313,PropSessionExpiryInterval 25863,PropAuthenticationMethod
// "\218\246\&4\t\220C\199\193\ETXrtR\ACK\142.\NAK\149\139\156\192\133\163)\206\142",PropTopicAliasMaximum
// 31669,PropMessageExpiryInterval 2051,PropResponseInformation "",PropTopicAlias 288,PropPayloadFormatIndicator
// 69,PropServerKeepAlive 11992,PropAssignedClientIdentifier
// "\233\SYN\180\160\178\135\162\199RFI\204&d\239\184\168\237ey\ETX\214\CAN",PropPayloadFormatIndicator
// 209,PropAuthenticationData "",PropPayloadFormatIndicator 240,PropAssignedClientIdentifier
// "\NUL\r\223\128\168_\249\211\192e\a\246\251\SII/"]}), _cleanSession = False, _keepAlive = 16105, _connID =
// "\233#\162\&4\221v1'\194j\182\178J\225\247nx\168\166\148\147M\199\156\229Cz\134\EOT", _properties = [PropTopicAlias
// 27063,PropRequestResponseInformation 177,PropReasonString "",PropSharedSubscriptionAvailable
// 46,PropSubscriptionIdentifier 15,PropServerReference ":\216\237",PropMessageExpiryInterval 11345,PropServerKeepAlive
// 24364,PropResponseTopic "\168\199\129\177\157\193N/*8~W:",PropAuthenticationMethod
// "\162i\210\r\205\225\139\195\SYN\129\163\164\160Zc\173",PropSharedSubscriptionAvailable 93,PropServerKeepAlive
// 19517,PropWildcardSubscriptionAvailable 52,PropWillDelayInterval 7303,PropRequestProblemInformation
// 7,PropRequestProblemInformation 233,PropTopicAlias 3877,PropMessageExpiryInterval 11804,PropWillDelayInterval
// 5288,PropSessionExpiryInterval 19779,PropResponseTopic "\\Z\225\n\212'\202#\250",PropTopicAliasMaximum
// 5401,PropTopicAlias 7665,PropSubscriptionIdentifier 20,PropMaximumQoS 18,PropSubscriptionIdentifier 5]}
TEST(Connect5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x10, 0xbd, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc,  0x3e, 0xe9, 0x77, 0x23, 0x69, 0xb7, 0x19, 0xb1,
      0x1f, 0x0,  0x0,  0x2a, 0x2e, 0xb,  0xf,  0x1c, 0x0,  0x3,  0x3a, 0xd8, 0xed, 0x2,  0x0,  0x0,  0x2c, 0x51, 0x13,
      0x5f, 0x2c, 0x8,  0x0,  0xd,  0xa8, 0xc7, 0x81, 0xb1, 0x9d, 0xc1, 0x4e, 0x2f, 0x2a, 0x38, 0x7e, 0x57, 0x3a, 0x15,
      0x0,  0x10, 0xa2, 0x69, 0xd2, 0xd,  0xcd, 0xe1, 0x8b, 0xc3, 0x16, 0x81, 0xa3, 0xa4, 0xa0, 0x5a, 0x63, 0xad, 0x2a,
      0x5d, 0x13, 0x4c, 0x3d, 0x28, 0x34, 0x18, 0x0,  0x0,  0x1c, 0x87, 0x17, 0x7,  0x17, 0xe9, 0x23, 0xf,  0x25, 0x2,
      0x0,  0x0,  0x2e, 0x1c, 0x18, 0x0,  0x0,  0x14, 0xa8, 0x11, 0x0,  0x0,  0x4d, 0x43, 0x8,  0x0,  0x9,  0x5c, 0x5a,
      0xe1, 0xa,  0xd4, 0x27, 0xca, 0x23, 0xfa, 0x22, 0x15, 0x19, 0x23, 0x1d, 0xf1, 0xb,  0x14, 0x24, 0x12, 0xb,  0x5,
      0x0,  0x1d, 0xe9, 0x23, 0xa2, 0x34, 0xdd, 0x76, 0x31, 0x27, 0xc2, 0x6a, 0xb6, 0xb2, 0x4a, 0xe1, 0xf7, 0x6e, 0x78,
      0xa8, 0xa6, 0x94, 0x93, 0x4d, 0xc7, 0x9c, 0xe5, 0x43, 0x7a, 0x86, 0x4,  0x94, 0x1,  0x13, 0x17, 0x6f, 0x24, 0xdb,
      0x1c, 0x0,  0x1c, 0x1b, 0xa9, 0x3e, 0x12, 0xb3, 0x60, 0xb2, 0x51, 0x10, 0x6,  0xb6, 0x5,  0xf8, 0x44, 0x6f, 0xd6,
      0x91, 0x6f, 0xe,  0x69, 0x37, 0x9b, 0xa4, 0xe8, 0x47, 0xef, 0x5,  0xd,  0x22, 0x5b, 0x72, 0x2,  0x0,  0x0,  0x6a,
      0xb1, 0x11, 0x0,  0x0,  0x65, 0x7,  0x15, 0x0,  0x19, 0xda, 0xf6, 0x34, 0x9,  0xdc, 0x43, 0xc7, 0xc1, 0x3,  0x72,
      0x74, 0x52, 0x6,  0x8e, 0x2e, 0x15, 0x95, 0x8b, 0x9c, 0xc0, 0x85, 0xa3, 0x29, 0xce, 0x8e, 0x22, 0x7b, 0xb5, 0x2,
      0x0,  0x0,  0x8,  0x3,  0x1a, 0x0,  0x0,  0x23, 0x1,  0x20, 0x1,  0x45, 0x13, 0x2e, 0xd8, 0x12, 0x0,  0x17, 0xe9,
      0x16, 0xb4, 0xa0, 0xb2, 0x87, 0xa2, 0xc7, 0x52, 0x46, 0x49, 0xcc, 0x26, 0x64, 0xef, 0xb8, 0xa8, 0xed, 0x65, 0x79,
      0x3,  0xd6, 0x18, 0x1,  0xd1, 0x16, 0x0,  0x0,  0x1,  0xf0, 0x12, 0x0,  0x10, 0x0,  0xd,  0xdf, 0x80, 0xa8, 0x5f,
      0xf9, 0xd3, 0xc0, 0x65, 0x7,  0xf6, 0xfb, 0xf,  0x49, 0x2f, 0x0,  0x0,  0x0,  0x2,  0x1f, 0x6d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x3a, 0xd8, 0xed};
  uint8_t bytesprops2[] = {0xa8, 0xc7, 0x81, 0xb1, 0x9d, 0xc1, 0x4e, 0x2f, 0x2a, 0x38, 0x7e, 0x57, 0x3a};
  uint8_t bytesprops3[] = {0xa2, 0x69, 0xd2, 0xd,  0xcd, 0xe1, 0x8b, 0xc3,
                           0x16, 0x81, 0xa3, 0xa4, 0xa0, 0x5a, 0x63, 0xad};
  uint8_t bytesprops4[] = {0x5c, 0x5a, 0xe1, 0xa, 0xd4, 0x27, 0xca, 0x23, 0xfa};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27063}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 177}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11345}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24364}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 93}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19517}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7303}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3877}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11804}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5288}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19779}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5401}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7665}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x1b, 0xa9, 0x3e, 0x12, 0xb3, 0x60, 0xb2, 0x51, 0x10, 0x6,  0xb6, 0x5,  0xf8, 0x44,
                               0x6f, 0xd6, 0x91, 0x6f, 0xe,  0x69, 0x37, 0x9b, 0xa4, 0xe8, 0x47, 0xef, 0x5,  0xd};
  uint8_t byteswillprops1[] = {0xda, 0xf6, 0x34, 0x9,  0xdc, 0x43, 0xc7, 0xc1, 0x3,  0x72, 0x74, 0x52, 0x6,
                               0x8e, 0x2e, 0x15, 0x95, 0x8b, 0x9c, 0xc0, 0x85, 0xa3, 0x29, 0xce, 0x8e};
  uint8_t byteswillprops2[] = {0};
  uint8_t byteswillprops3[] = {0xe9, 0x16, 0xb4, 0xa0, 0xb2, 0x87, 0xa2, 0xc7, 0x52, 0x46, 0x49, 0xcc,
                               0x26, 0x64, 0xef, 0xb8, 0xa8, 0xed, 0x65, 0x79, 0x3,  0xd6, 0x18};
  uint8_t byteswillprops4[] = {0};
  uint8_t byteswillprops5[] = {0x0,  0xd,  0xdf, 0x80, 0xa8, 0x5f, 0xf9, 0xd3,
                               0xc0, 0x65, 0x7,  0xf6, 0xfb, 0xf,  0x49, 0x2f};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5999}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 219}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 23410}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27313}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25863}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31669}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2051}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 288}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 69}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 11992}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&byteswillprops5}}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x1f, 0x6d};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 16105;
  uint8_t client_id_bytes[] = {0xe9, 0x23, 0xa2, 0x34, 0xdd, 0x76, 0x31, 0x27, 0xc2, 0x6a, 0xb6, 0xb2, 0x4a, 0xe1, 0xf7,
                               0x6e, 0x78, 0xa8, 0xa6, 0x94, 0x93, 0x4d, 0xc7, 0x9c, 0xe5, 0x43, 0x7a, 0x86, 0x4};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\EM\145", _password = Nothing, _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS1, _willTopic = "\251\200\&6\199\206\206\220pH\v\151\196\129A_\134\141\215\229\SO\189\198l\249=\202",
// _willMsg = "\179%l\240\143\191>o\222\152\ETXd\178q\161", _willProps = [PropContentType
// "M\n\153\155\EM\221s9|9B\131\223\&2&\201q\ty\DC3",PropServerReference
// "@\154\225\138\225\223\196",PropAuthenticationData
// "\214\243\166\172\205\134zvP\131p\161",PropAssignedClientIdentifier "{\255\229\189\130{h(\238\172",PropResponseTopic
// "\209
// \198\a~\236z\253\DLE\134\226\&3\233\170\235\212\147\215\223\217\DC3\247\165\164\rc\177\156\181\240",PropUserProperty
// "k\191\216\&8E\249\f]\233\140f-\214Bf7t\147\150\168\243\196\184\222W\239\248N\STX\164"
// "\133\f\203\154u\221\&5V\231\US\EOT\229\168\SO\240;\213K\142"]}), _cleanSession = False, _keepAlive = 20495, _connID
// = "\199\170\&0\213\199\&6Tz4k\247\fs;\188l\241\227L\185\128\149\160\143\227\150c7\220", _properties =
// [PropSubscriptionIdentifier 14,PropSessionExpiryInterval 23537,PropAssignedClientIdentifier
// "\DC1\144\250j~\248\184\137,\DC4\168j_\f\172Ja\155\226\141\176Yr\ENQ\200?gl",PropResponseTopic
// "\241\138\194",PropSessionExpiryInterval 9638,PropSubscriptionIdentifierAvailable 169,PropRequestProblemInformation
// 253,PropUserProperty "\144\SI\216\EOT\138[A\144\r\143\172\161\171\171$\174\133\181^\184<:\149"
// "\186\&5\240\143\192\161",PropSubscriptionIdentifier 13,PropAssignedClientIdentifier
// "\220\218\211W-lS\206",PropCorrelationData "\179\DC4h\149\b\CAN#\176",PropUserProperty
// "\218\230\178s\191\NAK\143\&1\243f\174u" ")\229\150jQ\178\255",PropServerReference
// "\190\SUB<\198\SUBSy'\157",PropResponseInformation "$\250\&4^\240L\157\SUB",PropServerReference
// "\226\US\227\231{\166\&7"]}
TEST(Connect5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x10, 0x9a, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xac, 0x50, 0xf,  0xa8, 0x1,  0xb,  0xe,  0x11, 0x0,
      0x0,  0x5b, 0xf1, 0x12, 0x0,  0x1c, 0x11, 0x90, 0xfa, 0x6a, 0x7e, 0xf8, 0xb8, 0x89, 0x2c, 0x14, 0xa8, 0x6a, 0x5f,
      0xc,  0xac, 0x4a, 0x61, 0x9b, 0xe2, 0x8d, 0xb0, 0x59, 0x72, 0x5,  0xc8, 0x3f, 0x67, 0x6c, 0x8,  0x0,  0x3,  0xf1,
      0x8a, 0xc2, 0x11, 0x0,  0x0,  0x25, 0xa6, 0x29, 0xa9, 0x17, 0xfd, 0x26, 0x0,  0x17, 0x90, 0xf,  0xd8, 0x4,  0x8a,
      0x5b, 0x41, 0x90, 0xd,  0x8f, 0xac, 0xa1, 0xab, 0xab, 0x24, 0xae, 0x85, 0xb5, 0x5e, 0xb8, 0x3c, 0x3a, 0x95, 0x0,
      0x6,  0xba, 0x35, 0xf0, 0x8f, 0xc0, 0xa1, 0xb,  0xd,  0x12, 0x0,  0x8,  0xdc, 0xda, 0xd3, 0x57, 0x2d, 0x6c, 0x53,
      0xce, 0x9,  0x0,  0x8,  0xb3, 0x14, 0x68, 0x95, 0x8,  0x18, 0x23, 0xb0, 0x26, 0x0,  0xc,  0xda, 0xe6, 0xb2, 0x73,
      0xbf, 0x15, 0x8f, 0x31, 0xf3, 0x66, 0xae, 0x75, 0x0,  0x7,  0x29, 0xe5, 0x96, 0x6a, 0x51, 0xb2, 0xff, 0x1c, 0x0,
      0x9,  0xbe, 0x1a, 0x3c, 0xc6, 0x1a, 0x53, 0x79, 0x27, 0x9d, 0x1a, 0x0,  0x8,  0x24, 0xfa, 0x34, 0x5e, 0xf0, 0x4c,
      0x9d, 0x1a, 0x1c, 0x0,  0x7,  0xe2, 0x1f, 0xe3, 0xe7, 0x7b, 0xa6, 0x37, 0x0,  0x1d, 0xc7, 0xaa, 0x30, 0xd5, 0xc7,
      0x36, 0x54, 0x7a, 0x34, 0x6b, 0xf7, 0xc,  0x73, 0x3b, 0xbc, 0x6c, 0xf1, 0xe3, 0x4c, 0xb9, 0x80, 0x95, 0xa0, 0x8f,
      0xe3, 0x96, 0x63, 0x37, 0xdc, 0x94, 0x1,  0x3,  0x0,  0x14, 0x4d, 0xa,  0x99, 0x9b, 0x19, 0xdd, 0x73, 0x39, 0x7c,
      0x39, 0x42, 0x83, 0xdf, 0x32, 0x26, 0xc9, 0x71, 0x9,  0x79, 0x13, 0x1c, 0x0,  0x7,  0x40, 0x9a, 0xe1, 0x8a, 0xe1,
      0xdf, 0xc4, 0x16, 0x0,  0xc,  0xd6, 0xf3, 0xa6, 0xac, 0xcd, 0x86, 0x7a, 0x76, 0x50, 0x83, 0x70, 0xa1, 0x12, 0x0,
      0xa,  0x7b, 0xff, 0xe5, 0xbd, 0x82, 0x7b, 0x68, 0x28, 0xee, 0xac, 0x8,  0x0,  0x1e, 0xd1, 0x20, 0xc6, 0x7,  0x7e,
      0xec, 0x7a, 0xfd, 0x10, 0x86, 0xe2, 0x33, 0xe9, 0xaa, 0xeb, 0xd4, 0x93, 0xd7, 0xdf, 0xd9, 0x13, 0xf7, 0xa5, 0xa4,
      0xd,  0x63, 0xb1, 0x9c, 0xb5, 0xf0, 0x26, 0x0,  0x1e, 0x6b, 0xbf, 0xd8, 0x38, 0x45, 0xf9, 0xc,  0x5d, 0xe9, 0x8c,
      0x66, 0x2d, 0xd6, 0x42, 0x66, 0x37, 0x74, 0x93, 0x96, 0xa8, 0xf3, 0xc4, 0xb8, 0xde, 0x57, 0xef, 0xf8, 0x4e, 0x2,
      0xa4, 0x0,  0x13, 0x85, 0xc,  0xcb, 0x9a, 0x75, 0xdd, 0x35, 0x56, 0xe7, 0x1f, 0x4,  0xe5, 0xa8, 0xe,  0xf0, 0x3b,
      0xd5, 0x4b, 0x8e, 0x0,  0x1a, 0xfb, 0xc8, 0x36, 0xc7, 0xce, 0xce, 0xdc, 0x70, 0x48, 0xb,  0x97, 0xc4, 0x81, 0x41,
      0x5f, 0x86, 0x8d, 0xd7, 0xe5, 0xe,  0xbd, 0xc6, 0x6c, 0xf9, 0x3d, 0xca, 0x0,  0xf,  0xb3, 0x25, 0x6c, 0xf0, 0x8f,
      0xbf, 0x3e, 0x6f, 0xde, 0x98, 0x3,  0x64, 0xb2, 0x71, 0xa1, 0x0,  0x2,  0x19, 0x91};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x11, 0x90, 0xfa, 0x6a, 0x7e, 0xf8, 0xb8, 0x89, 0x2c, 0x14, 0xa8, 0x6a, 0x5f, 0xc,
                           0xac, 0x4a, 0x61, 0x9b, 0xe2, 0x8d, 0xb0, 0x59, 0x72, 0x5,  0xc8, 0x3f, 0x67, 0x6c};
  uint8_t bytesprops1[] = {0xf1, 0x8a, 0xc2};
  uint8_t bytesprops3[] = {0xba, 0x35, 0xf0, 0x8f, 0xc0, 0xa1};
  uint8_t bytesprops2[] = {0x90, 0xf,  0xd8, 0x4,  0x8a, 0x5b, 0x41, 0x90, 0xd,  0x8f, 0xac, 0xa1,
                           0xab, 0xab, 0x24, 0xae, 0x85, 0xb5, 0x5e, 0xb8, 0x3c, 0x3a, 0x95};
  uint8_t bytesprops4[] = {0xdc, 0xda, 0xd3, 0x57, 0x2d, 0x6c, 0x53, 0xce};
  uint8_t bytesprops5[] = {0xb3, 0x14, 0x68, 0x95, 0x8, 0x18, 0x23, 0xb0};
  uint8_t bytesprops7[] = {0x29, 0xe5, 0x96, 0x6a, 0x51, 0xb2, 0xff};
  uint8_t bytesprops6[] = {0xda, 0xe6, 0xb2, 0x73, 0xbf, 0x15, 0x8f, 0x31, 0xf3, 0x66, 0xae, 0x75};
  uint8_t bytesprops8[] = {0xbe, 0x1a, 0x3c, 0xc6, 0x1a, 0x53, 0x79, 0x27, 0x9d};
  uint8_t bytesprops9[] = {0x24, 0xfa, 0x34, 0x5e, 0xf0, 0x4c, 0x9d, 0x1a};
  uint8_t bytesprops10[] = {0xe2, 0x1f, 0xe3, 0xe7, 0x7b, 0xa6, 0x37};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23537}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9638}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {23, (char*)&bytesprops2}, .v = {6, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops6}, .v = {7, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {8, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x4d, 0xa,  0x99, 0x9b, 0x19, 0xdd, 0x73, 0x39, 0x7c, 0x39,
                               0x42, 0x83, 0xdf, 0x32, 0x26, 0xc9, 0x71, 0x9,  0x79, 0x13};
  uint8_t byteswillprops1[] = {0x40, 0x9a, 0xe1, 0x8a, 0xe1, 0xdf, 0xc4};
  uint8_t byteswillprops2[] = {0xd6, 0xf3, 0xa6, 0xac, 0xcd, 0x86, 0x7a, 0x76, 0x50, 0x83, 0x70, 0xa1};
  uint8_t byteswillprops3[] = {0x7b, 0xff, 0xe5, 0xbd, 0x82, 0x7b, 0x68, 0x28, 0xee, 0xac};
  uint8_t byteswillprops4[] = {0xd1, 0x20, 0xc6, 0x7,  0x7e, 0xec, 0x7a, 0xfd, 0x10, 0x86,
                               0xe2, 0x33, 0xe9, 0xaa, 0xeb, 0xd4, 0x93, 0xd7, 0xdf, 0xd9,
                               0x13, 0xf7, 0xa5, 0xa4, 0xd,  0x63, 0xb1, 0x9c, 0xb5, 0xf0};
  uint8_t byteswillprops6[] = {0x85, 0xc,  0xcb, 0x9a, 0x75, 0xdd, 0x35, 0x56, 0xe7, 0x1f,
                               0x4,  0xe5, 0xa8, 0xe,  0xf0, 0x3b, 0xd5, 0x4b, 0x8e};
  uint8_t byteswillprops5[] = {0x6b, 0xbf, 0xd8, 0x38, 0x45, 0xf9, 0xc,  0x5d, 0xe9, 0x8c,
                               0x66, 0x2d, 0xd6, 0x42, 0x66, 0x37, 0x74, 0x93, 0x96, 0xa8,
                               0xf3, 0xc4, 0xb8, 0xde, 0x57, 0xef, 0xf8, 0x4e, 0x2,  0xa4};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {12, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops5}, .v = {19, (char*)&byteswillprops6}}}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xfb, 0xc8, 0x36, 0xc7, 0xce, 0xce, 0xdc, 0x70, 0x48, 0xb,  0x97, 0xc4, 0x81,
                                0x41, 0x5f, 0x86, 0x8d, 0xd7, 0xe5, 0xe,  0xbd, 0xc6, 0x6c, 0xf9, 0x3d, 0xca};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb3, 0x25, 0x6c, 0xf0, 0x8f, 0xbf, 0x3e, 0x6f,
                                  0xde, 0x98, 0x3,  0x64, 0xb2, 0x71, 0xa1};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20495;
  uint8_t client_id_bytes[] = {0xc7, 0xaa, 0x30, 0xd5, 0xc7, 0x36, 0x54, 0x7a, 0x34, 0x6b, 0xf7, 0xc,  0x73, 0x3b, 0xbc,
                               0x6c, 0xf1, 0xe3, 0x4c, 0xb9, 0x80, 0x95, 0xa0, 0x8f, 0xe3, 0x96, 0x63, 0x37, 0xdc};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x19, 0x91};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\181\166\207", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS2, _willTopic = "\140\199\a\SOH\ETX\168\245v\148k\214\201\144\139n\ENQ\170\252Z\142\205", _willMsg =
// ":*\192m\246\&0\144M\255\232<\210\138\STX\142h!j\205\162\158\"\140\190", _willProps = [PropServerKeepAlive
// 13448,PropMaximumQoS 150,PropAuthenticationData
// "&\239u#C\SOH2\160\177\198\133^8\GS\149jF,\192\228\227A\n\GST\140\247",PropReasonString
// "o",PropRequestProblemInformation 226,PropMaximumQoS 224,PropSubscriptionIdentifier 24,PropWillDelayInterval
// 2921,PropSubscriptionIdentifierAvailable 82,PropSessionExpiryInterval 24845,PropServerReference
// "\210)\GS\DLE\192O\242o\EM\186\196\208F",PropReasonString
// "\249\172a\232\229\230D\237\238\135\223\ETB%\aM\211Q\144O",PropSubscriptionIdentifier 29,PropSubscriptionIdentifier
// 5,PropMaximumQoS 213,PropAuthenticationMethod ".\143z\221\151\153\201:",PropRetainAvailable 49,PropMaximumPacketSize
// 30334]}), _cleanSession = False, _keepAlive = 19119, _connID = "\ETBB\213\133\216\235\t0\138\222\&2", _properties =
// [PropSubscriptionIdentifierAvailable 48,PropMessageExpiryInterval 25674,PropSessionExpiryInterval
// 5403,PropRequestResponseInformation 153,PropUserProperty "li\224\&3\162\fE\bD\230"
// "H#\DC1\239\218W\155\239m\198T\157eF\219\249<\251\152b",PropSessionExpiryInterval 15951,PropMessageExpiryInterval
// 16481,PropResponseTopic "\135N\252\207\135\158\250\158\185G\134:",PropSubscriptionIdentifier
// 24,PropSubscriptionIdentifier 7,PropSubscriptionIdentifier 10,PropSubscriptionIdentifierAvailable 206,PropTopicAlias
// 7630,PropWildcardSubscriptionAvailable 115,PropServerReference "4\185\SI",PropAuthenticationMethod
// "\206\ENQ\243k4Ow\153\222x\235]\203\195L\t\193y\205\155f8\ENQ\145\178\196\ENQ j",PropUserProperty
// "\135Mh\rJ\205\147\&5\191\DC3\169\208\CAN\234!\146R\ETB\214-"
// "\EOT\203M{\SOH\232=\254;\225kN2>\SOH\227",PropPayloadFormatIndicator 44,PropMessageExpiryInterval
// 3989,PropResponseTopic "d",PropContentType "M\184\DELvUAX\190\160\150\STXl\"\214\a:z\229\NUL\213"]}
TEST(Connect5QCTest, Encode8) {
  uint8_t pkt[] = {
      0x10, 0x8f, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x74, 0x4a, 0xaf, 0xc8, 0x1,  0x29, 0x30, 0x2,  0x0,
      0x0,  0x64, 0x4a, 0x11, 0x0,  0x0,  0x15, 0x1b, 0x19, 0x99, 0x26, 0x0,  0xa,  0x6c, 0x69, 0xe0, 0x33, 0xa2, 0xc,
      0x45, 0x8,  0x44, 0xe6, 0x0,  0x14, 0x48, 0x23, 0x11, 0xef, 0xda, 0x57, 0x9b, 0xef, 0x6d, 0xc6, 0x54, 0x9d, 0x65,
      0x46, 0xdb, 0xf9, 0x3c, 0xfb, 0x98, 0x62, 0x11, 0x0,  0x0,  0x3e, 0x4f, 0x2,  0x0,  0x0,  0x40, 0x61, 0x8,  0x0,
      0xc,  0x87, 0x4e, 0xfc, 0xcf, 0x87, 0x9e, 0xfa, 0x9e, 0xb9, 0x47, 0x86, 0x3a, 0xb,  0x18, 0xb,  0x7,  0xb,  0xa,
      0x29, 0xce, 0x23, 0x1d, 0xce, 0x28, 0x73, 0x1c, 0x0,  0x3,  0x34, 0xb9, 0xf,  0x15, 0x0,  0x1d, 0xce, 0x5,  0xf3,
      0x6b, 0x34, 0x4f, 0x77, 0x99, 0xde, 0x78, 0xeb, 0x5d, 0xcb, 0xc3, 0x4c, 0x9,  0xc1, 0x79, 0xcd, 0x9b, 0x66, 0x38,
      0x5,  0x91, 0xb2, 0xc4, 0x5,  0x20, 0x6a, 0x26, 0x0,  0x14, 0x87, 0x4d, 0x68, 0xd,  0x4a, 0xcd, 0x93, 0x35, 0xbf,
      0x13, 0xa9, 0xd0, 0x18, 0xea, 0x21, 0x92, 0x52, 0x17, 0xd6, 0x2d, 0x0,  0x10, 0x4,  0xcb, 0x4d, 0x7b, 0x1,  0xe8,
      0x3d, 0xfe, 0x3b, 0xe1, 0x6b, 0x4e, 0x32, 0x3e, 0x1,  0xe3, 0x1,  0x2c, 0x2,  0x0,  0x0,  0xf,  0x95, 0x8,  0x0,
      0x1,  0x64, 0x3,  0x0,  0x14, 0x4d, 0xb8, 0x7f, 0x76, 0x55, 0x41, 0x58, 0xbe, 0xa0, 0x96, 0x2,  0x6c, 0x22, 0xd6,
      0x7,  0x3a, 0x7a, 0xe5, 0x0,  0xd5, 0x0,  0xb,  0x17, 0x42, 0xd5, 0x85, 0xd8, 0xeb, 0x9,  0x30, 0x8a, 0xde, 0x32,
      0x77, 0x13, 0x34, 0x88, 0x24, 0x96, 0x16, 0x0,  0x1b, 0x26, 0xef, 0x75, 0x23, 0x43, 0x1,  0x32, 0xa0, 0xb1, 0xc6,
      0x85, 0x5e, 0x38, 0x1d, 0x95, 0x6a, 0x46, 0x2c, 0xc0, 0xe4, 0xe3, 0x41, 0xa,  0x1d, 0x54, 0x8c, 0xf7, 0x1f, 0x0,
      0x1,  0x6f, 0x17, 0xe2, 0x24, 0xe0, 0xb,  0x18, 0x18, 0x0,  0x0,  0xb,  0x69, 0x29, 0x52, 0x11, 0x0,  0x0,  0x61,
      0xd,  0x1c, 0x0,  0xd,  0xd2, 0x29, 0x1d, 0x10, 0xc0, 0x4f, 0xf2, 0x6f, 0x19, 0xba, 0xc4, 0xd0, 0x46, 0x1f, 0x0,
      0x13, 0xf9, 0xac, 0x61, 0xe8, 0xe5, 0xe6, 0x44, 0xed, 0xee, 0x87, 0xdf, 0x17, 0x25, 0x7,  0x4d, 0xd3, 0x51, 0x90,
      0x4f, 0xb,  0x1d, 0xb,  0x5,  0x24, 0xd5, 0x15, 0x0,  0x8,  0x2e, 0x8f, 0x7a, 0xdd, 0x97, 0x99, 0xc9, 0x3a, 0x25,
      0x31, 0x27, 0x0,  0x0,  0x76, 0x7e, 0x0,  0x15, 0x8c, 0xc7, 0x7,  0x1,  0x3,  0xa8, 0xf5, 0x76, 0x94, 0x6b, 0xd6,
      0xc9, 0x90, 0x8b, 0x6e, 0x5,  0xaa, 0xfc, 0x5a, 0x8e, 0xcd, 0x0,  0x18, 0x3a, 0x2a, 0xc0, 0x6d, 0xf6, 0x30, 0x90,
      0x4d, 0xff, 0xe8, 0x3c, 0xd2, 0x8a, 0x2,  0x8e, 0x68, 0x21, 0x6a, 0xcd, 0xa2, 0x9e, 0x22, 0x8c, 0xbe, 0x0,  0x3,
      0xb5, 0xa6, 0xcf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x48, 0x23, 0x11, 0xef, 0xda, 0x57, 0x9b, 0xef, 0x6d, 0xc6,
                           0x54, 0x9d, 0x65, 0x46, 0xdb, 0xf9, 0x3c, 0xfb, 0x98, 0x62};
  uint8_t bytesprops0[] = {0x6c, 0x69, 0xe0, 0x33, 0xa2, 0xc, 0x45, 0x8, 0x44, 0xe6};
  uint8_t bytesprops2[] = {0x87, 0x4e, 0xfc, 0xcf, 0x87, 0x9e, 0xfa, 0x9e, 0xb9, 0x47, 0x86, 0x3a};
  uint8_t bytesprops3[] = {0x34, 0xb9, 0xf};
  uint8_t bytesprops4[] = {0xce, 0x5,  0xf3, 0x6b, 0x34, 0x4f, 0x77, 0x99, 0xde, 0x78, 0xeb, 0x5d, 0xcb, 0xc3, 0x4c,
                           0x9,  0xc1, 0x79, 0xcd, 0x9b, 0x66, 0x38, 0x5,  0x91, 0xb2, 0xc4, 0x5,  0x20, 0x6a};
  uint8_t bytesprops6[] = {0x4, 0xcb, 0x4d, 0x7b, 0x1, 0xe8, 0x3d, 0xfe, 0x3b, 0xe1, 0x6b, 0x4e, 0x32, 0x3e, 0x1, 0xe3};
  uint8_t bytesprops5[] = {0x87, 0x4d, 0x68, 0xd,  0x4a, 0xcd, 0x93, 0x35, 0xbf, 0x13,
                           0xa9, 0xd0, 0x18, 0xea, 0x21, 0x92, 0x52, 0x17, 0xd6, 0x2d};
  uint8_t bytesprops7[] = {0x64};
  uint8_t bytesprops8[] = {0x4d, 0xb8, 0x7f, 0x76, 0x55, 0x41, 0x58, 0xbe, 0xa0, 0x96,
                           0x2,  0x6c, 0x22, 0xd6, 0x7,  0x3a, 0x7a, 0xe5, 0x0,  0xd5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25674}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 5403}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15951}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16481}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7630}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops5}, .v = {16, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3989}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x26, 0xef, 0x75, 0x23, 0x43, 0x1,  0x32, 0xa0, 0xb1, 0xc6, 0x85, 0x5e, 0x38, 0x1d,
                               0x95, 0x6a, 0x46, 0x2c, 0xc0, 0xe4, 0xe3, 0x41, 0xa,  0x1d, 0x54, 0x8c, 0xf7};
  uint8_t byteswillprops1[] = {0x6f};
  uint8_t byteswillprops2[] = {0xd2, 0x29, 0x1d, 0x10, 0xc0, 0x4f, 0xf2, 0x6f, 0x19, 0xba, 0xc4, 0xd0, 0x46};
  uint8_t byteswillprops3[] = {0xf9, 0xac, 0x61, 0xe8, 0xe5, 0xe6, 0x44, 0xed, 0xee, 0x87,
                               0xdf, 0x17, 0x25, 0x7,  0x4d, 0xd3, 0x51, 0x90, 0x4f};
  uint8_t byteswillprops4[] = {0x2e, 0x8f, 0x7a, 0xdd, 0x97, 0x99, 0xc9, 0x3a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 13448}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 224}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2921}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 82}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 24845}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30334}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8c, 0xc7, 0x7,  0x1,  0x3, 0xa8, 0xf5, 0x76, 0x94, 0x6b, 0xd6,
                                0xc9, 0x90, 0x8b, 0x6e, 0x5, 0xaa, 0xfc, 0x5a, 0x8e, 0xcd};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x3a, 0x2a, 0xc0, 0x6d, 0xf6, 0x30, 0x90, 0x4d, 0xff, 0xe8, 0x3c, 0xd2,
                                  0x8a, 0x2,  0x8e, 0x68, 0x21, 0x6a, 0xcd, 0xa2, 0x9e, 0x22, 0x8c, 0xbe};
  lwmqtt_string_t will_payload = {24, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 19119;
  uint8_t client_id_bytes[] = {0x17, 0x42, 0xd5, 0x85, 0xd8, 0xeb, 0x9, 0x30, 0x8a, 0xde, 0x32};
  lwmqtt_string_t client_id = {11, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb5, 0xa6, 0xcf};
  lwmqtt_string_t password = {3, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 26405, _connID = "", _properties = [PropPayloadFormatIndicator 152,PropSessionExpiryInterval 23746]}
TEST(Connect5QCTest, Encode9) {
  uint8_t pkt[] = {0x10, 0x14, 0x0, 0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2, 0x67,
                   0x25, 0x7,  0x1, 0x98, 0x11, 0x0,  0x0,  0x5c, 0xc2, 0x0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23746}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26405;
  uint8_t client_id_bytes[] = {0};
  lwmqtt_string_t client_id = {0, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\244\160\221\&0\230\206m\172", _password = Just
// "\165\183%\251X.>\250\DC2jTpG*a)\199u\169\200c\ETB\200\246\180\&5\171\157S\185", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic =
// "\189>\247Z\247\130\236\149k\150\218\181\\-Za%\"\153\153\249\154\229\155\174\154", _willMsg =
// "1\183yF.\202\190\&0\172\233\196\243\200;e\233\133N\232/T\223\157-)\ESC\144\SYN9", _willProps =
// [PropTopicAliasMaximum 21011,PropPayloadFormatIndicator 123,PropRequestProblemInformation
// 20,PropRequestProblemInformation 143,PropReasonString
// "\141#\208\DC2HkV<\234\254$3\170",PropRequestResponseInformation 83,PropRequestResponseInformation
// 118,PropUserProperty "4\199{\243" "d\176\165\FSn\GSU\190\172\207\167\223\EOT\198i\NAK\NAKu\SI\",",PropReceiveMaximum
// 20984,PropServerReference "qEm\240\141",PropMaximumPacketSize 19400,PropReasonString
// "\v\162\ACKi*\187\143<v\193I\DLE\147y\147\243\214#gr]L\203\&8g",PropSessionExpiryInterval 7054,PropCorrelationData
// "\128D!I\221\NAKS\162\157\148\206X:\210>\166l\ENQ&e\255\185C\DEL\169",PropSharedSubscriptionAvailable
// 161,PropAuthenticationData "\156\202~\SUB\159P\241\&2X\182\144\170\227{",PropSharedSubscriptionAvailable
// 175,PropTopicAliasMaximum 18891]}), _cleanSession = True, _keepAlive = 26688, _connID =
// "\246\249\133]\247\EOTD,\146\246\247\159\145\&1O\239Y\129\183+\237\ACK\b", _properties = [PropCorrelationData
// "\241s\SUB\SOH\185",PropRetainAvailable 188,PropSessionExpiryInterval 18205,PropResponseInformation
// "\236\DC2\207\159j\181\SIF\129\EMvRdc\241\240}_ e\199\252\133X\135",PropRequestResponseInformation
// 20,PropWildcardSubscriptionAvailable 141,PropRequestProblemInformation 245]}
TEST(Connect5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x10, 0xdc, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x68, 0x40, 0x31, 0x9,  0x0,  0x5,  0xf1, 0x73,
      0x1a, 0x1,  0xb9, 0x25, 0xbc, 0x11, 0x0,  0x0,  0x47, 0x1d, 0x1a, 0x0,  0x19, 0xec, 0x12, 0xcf, 0x9f, 0x6a, 0xb5,
      0xf,  0x46, 0x81, 0x19, 0x76, 0x52, 0x64, 0x63, 0xf1, 0xf0, 0x7d, 0x5f, 0x20, 0x65, 0xc7, 0xfc, 0x85, 0x58, 0x87,
      0x19, 0x14, 0x28, 0x8d, 0x17, 0xf5, 0x0,  0x17, 0xf6, 0xf9, 0x85, 0x5d, 0xf7, 0x4,  0x44, 0x2c, 0x92, 0xf6, 0xf7,
      0x9f, 0x91, 0x31, 0x4f, 0xef, 0x59, 0x81, 0xb7, 0x2b, 0xed, 0x6,  0x8,  0xa0, 0x1,  0x22, 0x52, 0x13, 0x1,  0x7b,
      0x17, 0x14, 0x17, 0x8f, 0x1f, 0x0,  0xd,  0x8d, 0x23, 0xd0, 0x12, 0x48, 0x6b, 0x56, 0x3c, 0xea, 0xfe, 0x24, 0x33,
      0xaa, 0x19, 0x53, 0x19, 0x76, 0x26, 0x0,  0x4,  0x34, 0xc7, 0x7b, 0xf3, 0x0,  0x15, 0x64, 0xb0, 0xa5, 0x1c, 0x6e,
      0x1d, 0x55, 0xbe, 0xac, 0xcf, 0xa7, 0xdf, 0x4,  0xc6, 0x69, 0x15, 0x15, 0x75, 0xf,  0x22, 0x2c, 0x21, 0x51, 0xf8,
      0x1c, 0x0,  0x5,  0x71, 0x45, 0x6d, 0xf0, 0x8d, 0x27, 0x0,  0x0,  0x4b, 0xc8, 0x1f, 0x0,  0x19, 0xb,  0xa2, 0x6,
      0x69, 0x2a, 0xbb, 0x8f, 0x3c, 0x76, 0xc1, 0x49, 0x10, 0x93, 0x79, 0x93, 0xf3, 0xd6, 0x23, 0x67, 0x72, 0x5d, 0x4c,
      0xcb, 0x38, 0x67, 0x11, 0x0,  0x0,  0x1b, 0x8e, 0x9,  0x0,  0x19, 0x80, 0x44, 0x21, 0x49, 0xdd, 0x15, 0x53, 0xa2,
      0x9d, 0x94, 0xce, 0x58, 0x3a, 0xd2, 0x3e, 0xa6, 0x6c, 0x5,  0x26, 0x65, 0xff, 0xb9, 0x43, 0x7f, 0xa9, 0x2a, 0xa1,
      0x16, 0x0,  0xe,  0x9c, 0xca, 0x7e, 0x1a, 0x9f, 0x50, 0xf1, 0x32, 0x58, 0xb6, 0x90, 0xaa, 0xe3, 0x7b, 0x2a, 0xaf,
      0x22, 0x49, 0xcb, 0x0,  0x1a, 0xbd, 0x3e, 0xf7, 0x5a, 0xf7, 0x82, 0xec, 0x95, 0x6b, 0x96, 0xda, 0xb5, 0x5c, 0x2d,
      0x5a, 0x61, 0x25, 0x22, 0x99, 0x99, 0xf9, 0x9a, 0xe5, 0x9b, 0xae, 0x9a, 0x0,  0x1d, 0x31, 0xb7, 0x79, 0x46, 0x2e,
      0xca, 0xbe, 0x30, 0xac, 0xe9, 0xc4, 0xf3, 0xc8, 0x3b, 0x65, 0xe9, 0x85, 0x4e, 0xe8, 0x2f, 0x54, 0xdf, 0x9d, 0x2d,
      0x29, 0x1b, 0x90, 0x16, 0x39, 0x0,  0x8,  0xf4, 0xa0, 0xdd, 0x30, 0xe6, 0xce, 0x6d, 0xac, 0x0,  0x1e, 0xa5, 0xb7,
      0x25, 0xfb, 0x58, 0x2e, 0x3e, 0xfa, 0x12, 0x6a, 0x54, 0x70, 0x47, 0x2a, 0x61, 0x29, 0xc7, 0x75, 0xa9, 0xc8, 0x63,
      0x17, 0xc8, 0xf6, 0xb4, 0x35, 0xab, 0x9d, 0x53, 0xb9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf1, 0x73, 0x1a, 0x1, 0xb9};
  uint8_t bytesprops1[] = {0xec, 0x12, 0xcf, 0x9f, 0x6a, 0xb5, 0xf,  0x46, 0x81, 0x19, 0x76, 0x52, 0x64,
                           0x63, 0xf1, 0xf0, 0x7d, 0x5f, 0x20, 0x65, 0xc7, 0xfc, 0x85, 0x58, 0x87};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18205}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 141}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 245}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x8d, 0x23, 0xd0, 0x12, 0x48, 0x6b, 0x56, 0x3c, 0xea, 0xfe, 0x24, 0x33, 0xaa};
  uint8_t byteswillprops2[] = {0x64, 0xb0, 0xa5, 0x1c, 0x6e, 0x1d, 0x55, 0xbe, 0xac, 0xcf, 0xa7,
                               0xdf, 0x4,  0xc6, 0x69, 0x15, 0x15, 0x75, 0xf,  0x22, 0x2c};
  uint8_t byteswillprops1[] = {0x34, 0xc7, 0x7b, 0xf3};
  uint8_t byteswillprops3[] = {0x71, 0x45, 0x6d, 0xf0, 0x8d};
  uint8_t byteswillprops4[] = {0xb,  0xa2, 0x6,  0x69, 0x2a, 0xbb, 0x8f, 0x3c, 0x76, 0xc1, 0x49, 0x10, 0x93,
                               0x79, 0x93, 0xf3, 0xd6, 0x23, 0x67, 0x72, 0x5d, 0x4c, 0xcb, 0x38, 0x67};
  uint8_t byteswillprops5[] = {0x80, 0x44, 0x21, 0x49, 0xdd, 0x15, 0x53, 0xa2, 0x9d, 0x94, 0xce, 0x58, 0x3a,
                               0xd2, 0x3e, 0xa6, 0x6c, 0x5,  0x26, 0x65, 0xff, 0xb9, 0x43, 0x7f, 0xa9};
  uint8_t byteswillprops6[] = {0x9c, 0xca, 0x7e, 0x1a, 0x9f, 0x50, 0xf1, 0x32, 0x58, 0xb6, 0x90, 0xaa, 0xe3, 0x7b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21011}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 123}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 143}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops1}, .v = {21, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20984}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19400}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7054}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18891}},
  };

  lwmqtt_properties_t willprops = {18, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbd, 0x3e, 0xf7, 0x5a, 0xf7, 0x82, 0xec, 0x95, 0x6b, 0x96, 0xda, 0xb5, 0x5c,
                                0x2d, 0x5a, 0x61, 0x25, 0x22, 0x99, 0x99, 0xf9, 0x9a, 0xe5, 0x9b, 0xae, 0x9a};
  lwmqtt_string_t will_topic = {26, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x31, 0xb7, 0x79, 0x46, 0x2e, 0xca, 0xbe, 0x30, 0xac, 0xe9,
                                  0xc4, 0xf3, 0xc8, 0x3b, 0x65, 0xe9, 0x85, 0x4e, 0xe8, 0x2f,
                                  0x54, 0xdf, 0x9d, 0x2d, 0x29, 0x1b, 0x90, 0x16, 0x39};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 26688;
  uint8_t client_id_bytes[] = {0xf6, 0xf9, 0x85, 0x5d, 0xf7, 0x4,  0x44, 0x2c, 0x92, 0xf6, 0xf7, 0x9f,
                               0x91, 0x31, 0x4f, 0xef, 0x59, 0x81, 0xb7, 0x2b, 0xed, 0x6,  0x8};
  lwmqtt_string_t client_id = {23, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf4, 0xa0, 0xdd, 0x30, 0xe6, 0xce, 0x6d, 0xac};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xa5, 0xb7, 0x25, 0xfb, 0x58, 0x2e, 0x3e, 0xfa, 0x12, 0x6a, 0x54, 0x70, 0x47, 0x2a, 0x61,
                              0x29, 0xc7, 0x75, 0xa9, 0xc8, 0x63, 0x17, 0xc8, 0xf6, 0xb4, 0x35, 0xab, 0x9d, 0x53, 0xb9};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\169\&9\US\187\DC1", _password = Just
// "\184\193\180:Dky-1\229\177\RS\US\181{h{\187\237\157K\222kRL\242Z\NAK\214", _lastWill = Just (LastWill {_willRetain =
// True, _willQoS = QoS1, _willTopic = "", _willMsg =
// "\251Q\218\169\218\207sq\185c\DC2s\f\\\246'R\RS%\242v\DEL\204f\195I\159`&", _willProps = [PropTopicAliasMaximum
// 15405,PropContentType "P\SYN\DC1\138#\160",PropContentType
// "\143\201\248\243\nw\199\239K\222\220\212*\214",PropRetainAvailable 216,PropCorrelationData
// "\191'y\249\165",PropRetainAvailable 244,PropRetainAvailable 188,PropRequestProblemInformation
// 147,PropAssignedClientIdentifier "\201\144\247\SUB\202\157\134\253"]}), _cleanSession = False, _keepAlive = 13305,
// _connID = "\207\241K\128\152Q\EMw\238\135PC\202L\142.\156)~\213\212\205", _properties = [PropResponseInformation
// "N=n$B",PropAuthenticationMethod "\148\253\&3\234lDj\215H\221%f\163",PropTopicAlias 28755,PropResponseInformation
// "\151A+\DC3l\128",PropSharedSubscriptionAvailable 222,PropTopicAliasMaximum 5186,PropTopicAliasMaximum
// 24871,PropTopicAliasMaximum 3490,PropPayloadFormatIndicator 220,PropCorrelationData
// "\166s\142\137\&4;\237\202J\213J\158\204\163\152\177!5\234}\143\SUB\DC4\142"]}
TEST(Connect5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x10, 0xef, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0x33, 0xf9, 0x4c, 0x1a, 0x0,  0x5,  0x4e, 0x3d,
      0x6e, 0x24, 0x42, 0x15, 0x0,  0xd,  0x94, 0xfd, 0x33, 0xea, 0x6c, 0x44, 0x6a, 0xd7, 0x48, 0xdd, 0x25, 0x66, 0xa3,
      0x23, 0x70, 0x53, 0x1a, 0x0,  0x6,  0x97, 0x41, 0x2b, 0x13, 0x6c, 0x80, 0x2a, 0xde, 0x22, 0x14, 0x42, 0x22, 0x61,
      0x27, 0x22, 0xd,  0xa2, 0x1,  0xdc, 0x9,  0x0,  0x18, 0xa6, 0x73, 0x8e, 0x89, 0x34, 0x3b, 0xed, 0xca, 0x4a, 0xd5,
      0x4a, 0x9e, 0xcc, 0xa3, 0x98, 0xb1, 0x21, 0x35, 0xea, 0x7d, 0x8f, 0x1a, 0x14, 0x8e, 0x0,  0x16, 0xcf, 0xf1, 0x4b,
      0x80, 0x98, 0x51, 0x19, 0x77, 0xee, 0x87, 0x50, 0x43, 0xca, 0x4c, 0x8e, 0x2e, 0x9c, 0x29, 0x7e, 0xd5, 0xd4, 0xcd,
      0x38, 0x22, 0x3c, 0x2d, 0x3,  0x0,  0x6,  0x50, 0x16, 0x11, 0x8a, 0x23, 0xa0, 0x3,  0x0,  0xe,  0x8f, 0xc9, 0xf8,
      0xf3, 0xa,  0x77, 0xc7, 0xef, 0x4b, 0xde, 0xdc, 0xd4, 0x2a, 0xd6, 0x25, 0xd8, 0x9,  0x0,  0x5,  0xbf, 0x27, 0x79,
      0xf9, 0xa5, 0x25, 0xf4, 0x25, 0xbc, 0x17, 0x93, 0x12, 0x0,  0x8,  0xc9, 0x90, 0xf7, 0x1a, 0xca, 0x9d, 0x86, 0xfd,
      0x0,  0x0,  0x0,  0x1d, 0xfb, 0x51, 0xda, 0xa9, 0xda, 0xcf, 0x73, 0x71, 0xb9, 0x63, 0x12, 0x73, 0xc,  0x5c, 0xf6,
      0x27, 0x52, 0x1e, 0x25, 0xf2, 0x76, 0x7f, 0xcc, 0x66, 0xc3, 0x49, 0x9f, 0x60, 0x26, 0x0,  0x5,  0xa9, 0x39, 0x1f,
      0xbb, 0x11, 0x0,  0x1d, 0xb8, 0xc1, 0xb4, 0x3a, 0x44, 0x6b, 0x79, 0x2d, 0x31, 0xe5, 0xb1, 0x1e, 0x1f, 0xb5, 0x7b,
      0x68, 0x7b, 0xbb, 0xed, 0x9d, 0x4b, 0xde, 0x6b, 0x52, 0x4c, 0xf2, 0x5a, 0x15, 0xd6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4e, 0x3d, 0x6e, 0x24, 0x42};
  uint8_t bytesprops1[] = {0x94, 0xfd, 0x33, 0xea, 0x6c, 0x44, 0x6a, 0xd7, 0x48, 0xdd, 0x25, 0x66, 0xa3};
  uint8_t bytesprops2[] = {0x97, 0x41, 0x2b, 0x13, 0x6c, 0x80};
  uint8_t bytesprops3[] = {0xa6, 0x73, 0x8e, 0x89, 0x34, 0x3b, 0xed, 0xca, 0x4a, 0xd5, 0x4a, 0x9e,
                           0xcc, 0xa3, 0x98, 0xb1, 0x21, 0x35, 0xea, 0x7d, 0x8f, 0x1a, 0x14, 0x8e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 28755}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5186}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24871}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3490}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x50, 0x16, 0x11, 0x8a, 0x23, 0xa0};
  uint8_t byteswillprops1[] = {0x8f, 0xc9, 0xf8, 0xf3, 0xa, 0x77, 0xc7, 0xef, 0x4b, 0xde, 0xdc, 0xd4, 0x2a, 0xd6};
  uint8_t byteswillprops2[] = {0xbf, 0x27, 0x79, 0xf9, 0xa5};
  uint8_t byteswillprops3[] = {0xc9, 0x90, 0xf7, 0x1a, 0xca, 0x9d, 0x86, 0xfd};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15405}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 216}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 244}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&byteswillprops3}}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0};
  lwmqtt_string_t will_topic = {0, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xfb, 0x51, 0xda, 0xa9, 0xda, 0xcf, 0x73, 0x71, 0xb9, 0x63,
                                  0x12, 0x73, 0xc,  0x5c, 0xf6, 0x27, 0x52, 0x1e, 0x25, 0xf2,
                                  0x76, 0x7f, 0xcc, 0x66, 0xc3, 0x49, 0x9f, 0x60, 0x26};
  lwmqtt_string_t will_payload = {29, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 13305;
  uint8_t client_id_bytes[] = {0xcf, 0xf1, 0x4b, 0x80, 0x98, 0x51, 0x19, 0x77, 0xee, 0x87, 0x50,
                               0x43, 0xca, 0x4c, 0x8e, 0x2e, 0x9c, 0x29, 0x7e, 0xd5, 0xd4, 0xcd};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa9, 0x39, 0x1f, 0xbb, 0x11};
  lwmqtt_string_t username = {5, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xb8, 0xc1, 0xb4, 0x3a, 0x44, 0x6b, 0x79, 0x2d, 0x31, 0xe5, 0xb1, 0x1e, 0x1f, 0xb5, 0x7b,
                              0x68, 0x7b, 0xbb, 0xed, 0x9d, 0x4b, 0xde, 0x6b, 0x52, 0x4c, 0xf2, 0x5a, 0x15, 0xd6};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\245\186\233\209\154JNY{\148\171\215\226hh\DELD\236\162\206", _password = Nothing,
// _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS1, _willTopic = "J}|\FS", _willMsg =
// "\230\222{\SO\US\159a\182$\177", _willProps = [PropMessageExpiryInterval 4088,PropRequestProblemInformation
// 130,PropUserProperty ""
// "\206\181\146H\171\228*)\DC4_\149mx\186p\250\139\a\247\&5\211<@\158\201\173\237\189\NAK\211",PropServerReference
// "o\249\169C,\204\240I\226y7\171w\220\134\166\251\n\151\n\f\181\GS\USj\STXl",PropAuthenticationMethod
// "OgTi\139\173*|\228\227^\134F9j\DC3\144s",PropResponseTopic "\206",PropTopicAliasMaximum
// 21517,PropSessionExpiryInterval 25122,PropAuthenticationMethod "\176\176\160\155",PropCorrelationData
// "\ENQU=\165t",PropPayloadFormatIndicator 146,PropAuthenticationData "\176\192\DC4a\v!\176\171
// \"(\150\151`\228\ENQ\246\193(",PropSessionExpiryInterval 9859,PropWillDelayInterval 11824,PropTopicAliasMaximum
// 7159,PropTopicAlias 15943,PropReasonString
// "k\253`-\141\224\153\SYN\215\158\&5\198{\170\USc)\STX\136\f\161\231,D\249)6\190F\233",PropTopicAliasMaximum
// 12331,PropContentType "^\DC2\182\242\220\248\138\173!\n&\251]8\146\226\214\129.\DC4hD",PropResponseInformation
// "\136(\136\165\189WO:P\143\191\248\&6.\143w\178",PropRequestResponseInformation 160,PropRetainAvailable
// 205,PropContentType "\243\150\&4\251\&2-\140\136\134VF\201\146\224\GS&\159",PropPayloadFormatIndicator
// 166,PropSessionExpiryInterval 31689,PropAuthenticationData
// "X\154\182\229\146\253;t\DC3\195~@\b<_",PropMessageExpiryInterval 32000,PropUserProperty "\US1\v8\225\204$"
// "\184\160\210\221\161\&6\205[\200\182V\232~\208\153M\201(\178b"]}), _cleanSession = False, _keepAlive = 17990,
// _connID = "\164\DC3\215\130\131\167\153>\200\244\244\GS\132\139\&8", _properties = [PropRequestResponseInformation
// 229,PropRetainAvailable 133,PropMessageExpiryInterval 27253,PropContentType
// "\179\241UJ\240\223\SI\168}\246:2u\134Vgh\236"]}
TEST(Connect5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x10, 0xab, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xac, 0x46, 0x46, 0x1e, 0x19, 0xe5, 0x25, 0x85, 0x2,
      0x0,  0x0,  0x6a, 0x75, 0x3,  0x0,  0x12, 0xb3, 0xf1, 0x55, 0x4a, 0xf0, 0xdf, 0xf,  0xa8, 0x7d, 0xf6, 0x3a, 0x32,
      0x75, 0x86, 0x56, 0x67, 0x68, 0xec, 0x0,  0xf,  0xa4, 0x13, 0xd7, 0x82, 0x83, 0xa7, 0x99, 0x3e, 0xc8, 0xf4, 0xf4,
      0x1d, 0x84, 0x8b, 0x38, 0xc7, 0x2,  0x2,  0x0,  0x0,  0xf,  0xf8, 0x17, 0x82, 0x26, 0x0,  0x0,  0x0,  0x1e, 0xce,
      0xb5, 0x92, 0x48, 0xab, 0xe4, 0x2a, 0x29, 0x14, 0x5f, 0x95, 0x6d, 0x78, 0xba, 0x70, 0xfa, 0x8b, 0x7,  0xf7, 0x35,
      0xd3, 0x3c, 0x40, 0x9e, 0xc9, 0xad, 0xed, 0xbd, 0x15, 0xd3, 0x1c, 0x0,  0x1b, 0x6f, 0xf9, 0xa9, 0x43, 0x2c, 0xcc,
      0xf0, 0x49, 0xe2, 0x79, 0x37, 0xab, 0x77, 0xdc, 0x86, 0xa6, 0xfb, 0xa,  0x97, 0xa,  0xc,  0xb5, 0x1d, 0x1f, 0x6a,
      0x2,  0x6c, 0x15, 0x0,  0x12, 0x4f, 0x67, 0x54, 0x69, 0x8b, 0xad, 0x2a, 0x7c, 0xe4, 0xe3, 0x5e, 0x86, 0x46, 0x39,
      0x6a, 0x13, 0x90, 0x73, 0x8,  0x0,  0x1,  0xce, 0x22, 0x54, 0xd,  0x11, 0x0,  0x0,  0x62, 0x22, 0x15, 0x0,  0x4,
      0xb0, 0xb0, 0xa0, 0x9b, 0x9,  0x0,  0x5,  0x5,  0x55, 0x3d, 0xa5, 0x74, 0x1,  0x92, 0x16, 0x0,  0x13, 0xb0, 0xc0,
      0x14, 0x61, 0xb,  0x21, 0xb0, 0xab, 0x20, 0x22, 0x28, 0x96, 0x97, 0x60, 0xe4, 0x5,  0xf6, 0xc1, 0x28, 0x11, 0x0,
      0x0,  0x26, 0x83, 0x18, 0x0,  0x0,  0x2e, 0x30, 0x22, 0x1b, 0xf7, 0x23, 0x3e, 0x47, 0x1f, 0x0,  0x1e, 0x6b, 0xfd,
      0x60, 0x2d, 0x8d, 0xe0, 0x99, 0x16, 0xd7, 0x9e, 0x35, 0xc6, 0x7b, 0xaa, 0x1f, 0x63, 0x29, 0x2,  0x88, 0xc,  0xa1,
      0xe7, 0x2c, 0x44, 0xf9, 0x29, 0x36, 0xbe, 0x46, 0xe9, 0x22, 0x30, 0x2b, 0x3,  0x0,  0x16, 0x5e, 0x12, 0xb6, 0xf2,
      0xdc, 0xf8, 0x8a, 0xad, 0x21, 0xa,  0x26, 0xfb, 0x5d, 0x38, 0x92, 0xe2, 0xd6, 0x81, 0x2e, 0x14, 0x68, 0x44, 0x1a,
      0x0,  0x11, 0x88, 0x28, 0x88, 0xa5, 0xbd, 0x57, 0x4f, 0x3a, 0x50, 0x8f, 0xbf, 0xf8, 0x36, 0x2e, 0x8f, 0x77, 0xb2,
      0x19, 0xa0, 0x25, 0xcd, 0x3,  0x0,  0x11, 0xf3, 0x96, 0x34, 0xfb, 0x32, 0x2d, 0x8c, 0x88, 0x86, 0x56, 0x46, 0xc9,
      0x92, 0xe0, 0x1d, 0x26, 0x9f, 0x1,  0xa6, 0x11, 0x0,  0x0,  0x7b, 0xc9, 0x16, 0x0,  0xf,  0x58, 0x9a, 0xb6, 0xe5,
      0x92, 0xfd, 0x3b, 0x74, 0x13, 0xc3, 0x7e, 0x40, 0x8,  0x3c, 0x5f, 0x2,  0x0,  0x0,  0x7d, 0x0,  0x26, 0x0,  0x7,
      0x1f, 0x31, 0xb,  0x38, 0xe1, 0xcc, 0x24, 0x0,  0x14, 0xb8, 0xa0, 0xd2, 0xdd, 0xa1, 0x36, 0xcd, 0x5b, 0xc8, 0xb6,
      0x56, 0xe8, 0x7e, 0xd0, 0x99, 0x4d, 0xc9, 0x28, 0xb2, 0x62, 0x0,  0x4,  0x4a, 0x7d, 0x7c, 0x1c, 0x0,  0xa,  0xe6,
      0xde, 0x7b, 0xe,  0x1f, 0x9f, 0x61, 0xb6, 0x24, 0xb1, 0x0,  0x14, 0xf5, 0xba, 0xe9, 0xd1, 0x9a, 0x4a, 0x4e, 0x59,
      0x7b, 0x94, 0xab, 0xd7, 0xe2, 0x68, 0x68, 0x7f, 0x44, 0xec, 0xa2, 0xce};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb3, 0xf1, 0x55, 0x4a, 0xf0, 0xdf, 0xf,  0xa8, 0x7d,
                           0xf6, 0x3a, 0x32, 0x75, 0x86, 0x56, 0x67, 0x68, 0xec};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 229}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27253}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0xce, 0xb5, 0x92, 0x48, 0xab, 0xe4, 0x2a, 0x29, 0x14, 0x5f,
                               0x95, 0x6d, 0x78, 0xba, 0x70, 0xfa, 0x8b, 0x7,  0xf7, 0x35,
                               0xd3, 0x3c, 0x40, 0x9e, 0xc9, 0xad, 0xed, 0xbd, 0x15, 0xd3};
  uint8_t byteswillprops0[] = {0};
  uint8_t byteswillprops2[] = {0x6f, 0xf9, 0xa9, 0x43, 0x2c, 0xcc, 0xf0, 0x49, 0xe2, 0x79, 0x37, 0xab, 0x77, 0xdc,
                               0x86, 0xa6, 0xfb, 0xa,  0x97, 0xa,  0xc,  0xb5, 0x1d, 0x1f, 0x6a, 0x2,  0x6c};
  uint8_t byteswillprops3[] = {0x4f, 0x67, 0x54, 0x69, 0x8b, 0xad, 0x2a, 0x7c, 0xe4,
                               0xe3, 0x5e, 0x86, 0x46, 0x39, 0x6a, 0x13, 0x90, 0x73};
  uint8_t byteswillprops4[] = {0xce};
  uint8_t byteswillprops5[] = {0xb0, 0xb0, 0xa0, 0x9b};
  uint8_t byteswillprops6[] = {0x5, 0x55, 0x3d, 0xa5, 0x74};
  uint8_t byteswillprops7[] = {0xb0, 0xc0, 0x14, 0x61, 0xb,  0x21, 0xb0, 0xab, 0x20, 0x22,
                               0x28, 0x96, 0x97, 0x60, 0xe4, 0x5,  0xf6, 0xc1, 0x28};
  uint8_t byteswillprops8[] = {0x6b, 0xfd, 0x60, 0x2d, 0x8d, 0xe0, 0x99, 0x16, 0xd7, 0x9e,
                               0x35, 0xc6, 0x7b, 0xaa, 0x1f, 0x63, 0x29, 0x2,  0x88, 0xc,
                               0xa1, 0xe7, 0x2c, 0x44, 0xf9, 0x29, 0x36, 0xbe, 0x46, 0xe9};
  uint8_t byteswillprops9[] = {0x5e, 0x12, 0xb6, 0xf2, 0xdc, 0xf8, 0x8a, 0xad, 0x21, 0xa,  0x26,
                               0xfb, 0x5d, 0x38, 0x92, 0xe2, 0xd6, 0x81, 0x2e, 0x14, 0x68, 0x44};
  uint8_t byteswillprops10[] = {0x88, 0x28, 0x88, 0xa5, 0xbd, 0x57, 0x4f, 0x3a, 0x50,
                                0x8f, 0xbf, 0xf8, 0x36, 0x2e, 0x8f, 0x77, 0xb2};
  uint8_t byteswillprops11[] = {0xf3, 0x96, 0x34, 0xfb, 0x32, 0x2d, 0x8c, 0x88, 0x86,
                                0x56, 0x46, 0xc9, 0x92, 0xe0, 0x1d, 0x26, 0x9f};
  uint8_t byteswillprops12[] = {0x58, 0x9a, 0xb6, 0xe5, 0x92, 0xfd, 0x3b, 0x74,
                                0x13, 0xc3, 0x7e, 0x40, 0x8,  0x3c, 0x5f};
  uint8_t byteswillprops14[] = {0xb8, 0xa0, 0xd2, 0xdd, 0xa1, 0x36, 0xcd, 0x5b, 0xc8, 0xb6,
                                0x56, 0xe8, 0x7e, 0xd0, 0x99, 0x4d, 0xc9, 0x28, 0xb2, 0x62};
  uint8_t byteswillprops13[] = {0x1f, 0x31, 0xb, 0x38, 0xe1, 0xcc, 0x24};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4088}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {0, (char*)&byteswillprops0}, .v = {30, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 21517}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 25122}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {5, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9859}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11824}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7159}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15943}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12331}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 166}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31689}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32000}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {7, (char*)&byteswillprops13}, .v = {20, (char*)&byteswillprops14}}}},
  };

  lwmqtt_properties_t willprops = {28, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x4a, 0x7d, 0x7c, 0x1c};
  lwmqtt_string_t will_topic = {4, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe6, 0xde, 0x7b, 0xe, 0x1f, 0x9f, 0x61, 0xb6, 0x24, 0xb1};
  lwmqtt_string_t will_payload = {10, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17990;
  uint8_t client_id_bytes[] = {0xa4, 0x13, 0xd7, 0x82, 0x83, 0xa7, 0x99, 0x3e,
                               0xc8, 0xf4, 0xf4, 0x1d, 0x84, 0x8b, 0x38};
  lwmqtt_string_t client_id = {15, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xf5, 0xba, 0xe9, 0xd1, 0x9a, 0x4a, 0x4e, 0x59, 0x7b, 0x94,
                              0xab, 0xd7, 0xe2, 0x68, 0x68, 0x7f, 0x44, 0xec, 0xa2, 0xce};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\250\200\162\134OF\FS\CAN\131=\SI\ESC", _lastWill = Just
// (LastWill {_willRetain = False, _willQoS = QoS1, _willTopic = "\205\193\146C\176\DC1{T\189hD\173\188\SOH\198h\252<R",
// _willMsg = "\238\181\ESC\ENQ\DLE\159\186\170s\EOTn\248\n{\165\&8", _willProps = [PropSharedSubscriptionAvailable
// 215,PropAuthenticationMethod
// "s\140\202\139:X\178\241\232\186\252}\220H\200\146V\202\178\v\165\182",PropWildcardSubscriptionAvailable
// 70,PropAuthenticationData "\fW\NAKbl\166\197\193z\165\\V\251\186}p",PropMessageExpiryInterval 25536,PropContentType
// "X\175_\208\177\201\FS\136\SUB\b\241b\USU)\128\178\b\a\b\EMUC*\143#4",PropAuthenticationMethod
// "\189\US\RS\FS\245\200\166\237z\182\165a&\215\SYNq7\252\246\DC3;\208\234/",PropWildcardSubscriptionAvailable
// 7,PropUserProperty "\219\DC22\155eh\187\175!\220\nd\vS\163\195\243\&3Q\155\148"
// "B}\152\153a\220\ACK+eI\188\166\DELA\232\&2\134iCo{\185\229\179\168",PropSessionExpiryInterval
// 14073,PropAuthenticationMethod "\241$}\186\204",PropRetainAvailable 49,PropRetainAvailable 235,PropUserProperty
// "(\180\&0\162N5\199\174\129\158\219\EOT\135\254\DC3j\230\"\207\193\143J\NAK\182\177"
// "rL\132Z{k",PropMessageExpiryInterval 23398,PropWillDelayInterval 4588,PropAuthenticationData
// "B<\DLE\250]\206\154>\236\180\255_\196\229\207\241{\149P\212\233\157#\149u\132\157l",PropServerReference
// "(\148\200\145\173\166\157\243q",PropAuthenticationData "\SOI&\ng\141%",PropTopicAliasMaximum
// 1937,PropSessionExpiryInterval 16722,PropMaximumQoS 71,PropAssignedClientIdentifier
// "\196#\a{\234\157\ENQja\237\228d\234^c\193_~\180\170\209\145<",PropAssignedClientIdentifier
// "\234\GS\151\EOTY\222@j\128\195\ACKK;*\240\231\245\248R\130\159<gpX\223",PropResponseTopic
// "\174W",PropSharedSubscriptionAvailable 147]}), _cleanSession = False, _keepAlive = 26535, _connID =
// "\191|\197\171z\240\&6a\\\153\222\216L", _properties = [PropMaximumPacketSize 25315,PropResponseInformation
// "\233\\\250\SUB\NAKkK\132\225\203J\143+\184\165",PropWillDelayInterval 10460,PropMaximumPacketSize
// 30945,PropMessageExpiryInterval 17366,PropMessageExpiryInterval 19287,PropResponseInformation
// "\128f[\205c\254\165D\245\219\216d\248.\183\194\&8U|.\SIu\167",PropMaximumPacketSize 22133,PropRetainAvailable
// 138,PropAuthenticationData "\EM\ENQ\190r\247;\131I\176\218i^\SUB\255c\143",PropMaximumQoS
// 118,PropSharedSubscriptionAvailable 4,PropMaximumPacketSize 28666,PropMaximumQoS 210,PropAssignedClientIdentifier
// "\a\rC\185Eo\SUB\ETBT\139\212\ETX\129dy O\223\158c\fa]\214\139\SYN\221",PropAssignedClientIdentifier
// "\207\199\185",PropMaximumQoS 227,PropAuthenticationData "\176Kp\244\177G\135a\a",PropRequestProblemInformation
// 111,PropReasonString "",PropSubscriptionIdentifier 25,PropMaximumQoS 8,PropSubscriptionIdentifierAvailable 56]}
TEST(Connect5QCTest, Encode13) {
  uint8_t pkt[] = {
      0x10, 0xd8, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x4c, 0x67, 0xa7, 0xa7, 0x1,  0x27, 0x0,  0x0,  0x62,
      0xe3, 0x1a, 0x0,  0xf,  0xe9, 0x5c, 0xfa, 0x1a, 0x15, 0x6b, 0x4b, 0x84, 0xe1, 0xcb, 0x4a, 0x8f, 0x2b, 0xb8, 0xa5,
      0x18, 0x0,  0x0,  0x28, 0xdc, 0x27, 0x0,  0x0,  0x78, 0xe1, 0x2,  0x0,  0x0,  0x43, 0xd6, 0x2,  0x0,  0x0,  0x4b,
      0x57, 0x1a, 0x0,  0x17, 0x80, 0x66, 0x5b, 0xcd, 0x63, 0xfe, 0xa5, 0x44, 0xf5, 0xdb, 0xd8, 0x64, 0xf8, 0x2e, 0xb7,
      0xc2, 0x38, 0x55, 0x7c, 0x2e, 0xf,  0x75, 0xa7, 0x27, 0x0,  0x0,  0x56, 0x75, 0x25, 0x8a, 0x16, 0x0,  0x10, 0x19,
      0x5,  0xbe, 0x72, 0xf7, 0x3b, 0x83, 0x49, 0xb0, 0xda, 0x69, 0x5e, 0x1a, 0xff, 0x63, 0x8f, 0x24, 0x76, 0x2a, 0x4,
      0x27, 0x0,  0x0,  0x6f, 0xfa, 0x24, 0xd2, 0x12, 0x0,  0x1b, 0x7,  0xd,  0x43, 0xb9, 0x45, 0x6f, 0x1a, 0x17, 0x54,
      0x8b, 0xd4, 0x3,  0x81, 0x64, 0x79, 0x20, 0x4f, 0xdf, 0x9e, 0x63, 0xc,  0x61, 0x5d, 0xd6, 0x8b, 0x16, 0xdd, 0x12,
      0x0,  0x3,  0xcf, 0xc7, 0xb9, 0x24, 0xe3, 0x16, 0x0,  0x9,  0xb0, 0x4b, 0x70, 0xf4, 0xb1, 0x47, 0x87, 0x61, 0x7,
      0x17, 0x6f, 0x1f, 0x0,  0x0,  0xb,  0x19, 0x24, 0x8,  0x29, 0x38, 0x0,  0xd,  0xbf, 0x7c, 0xc5, 0xab, 0x7a, 0xf0,
      0x36, 0x61, 0x5c, 0x99, 0xde, 0xd8, 0x4c, 0xdf, 0x2,  0x2a, 0xd7, 0x15, 0x0,  0x16, 0x73, 0x8c, 0xca, 0x8b, 0x3a,
      0x58, 0xb2, 0xf1, 0xe8, 0xba, 0xfc, 0x7d, 0xdc, 0x48, 0xc8, 0x92, 0x56, 0xca, 0xb2, 0xb,  0xa5, 0xb6, 0x28, 0x46,
      0x16, 0x0,  0x10, 0xc,  0x57, 0x15, 0x62, 0x6c, 0xa6, 0xc5, 0xc1, 0x7a, 0xa5, 0x5c, 0x56, 0xfb, 0xba, 0x7d, 0x70,
      0x2,  0x0,  0x0,  0x63, 0xc0, 0x3,  0x0,  0x1b, 0x58, 0xaf, 0x5f, 0xd0, 0xb1, 0xc9, 0x1c, 0x88, 0x1a, 0x8,  0xf1,
      0x62, 0x1f, 0x55, 0x29, 0x80, 0xb2, 0x8,  0x7,  0x8,  0x19, 0x55, 0x43, 0x2a, 0x8f, 0x23, 0x34, 0x15, 0x0,  0x18,
      0xbd, 0x1f, 0x1e, 0x1c, 0xf5, 0xc8, 0xa6, 0xed, 0x7a, 0xb6, 0xa5, 0x61, 0x26, 0xd7, 0x16, 0x71, 0x37, 0xfc, 0xf6,
      0x13, 0x3b, 0xd0, 0xea, 0x2f, 0x28, 0x7,  0x26, 0x0,  0x15, 0xdb, 0x12, 0x32, 0x9b, 0x65, 0x68, 0xbb, 0xaf, 0x21,
      0xdc, 0xa,  0x64, 0xb,  0x53, 0xa3, 0xc3, 0xf3, 0x33, 0x51, 0x9b, 0x94, 0x0,  0x19, 0x42, 0x7d, 0x98, 0x99, 0x61,
      0xdc, 0x6,  0x2b, 0x65, 0x49, 0xbc, 0xa6, 0x7f, 0x41, 0xe8, 0x32, 0x86, 0x69, 0x43, 0x6f, 0x7b, 0xb9, 0xe5, 0xb3,
      0xa8, 0x11, 0x0,  0x0,  0x36, 0xf9, 0x15, 0x0,  0x5,  0xf1, 0x24, 0x7d, 0xba, 0xcc, 0x25, 0x31, 0x25, 0xeb, 0x26,
      0x0,  0x19, 0x28, 0xb4, 0x30, 0xa2, 0x4e, 0x35, 0xc7, 0xae, 0x81, 0x9e, 0xdb, 0x4,  0x87, 0xfe, 0x13, 0x6a, 0xe6,
      0x22, 0xcf, 0xc1, 0x8f, 0x4a, 0x15, 0xb6, 0xb1, 0x0,  0x6,  0x72, 0x4c, 0x84, 0x5a, 0x7b, 0x6b, 0x2,  0x0,  0x0,
      0x5b, 0x66, 0x18, 0x0,  0x0,  0x11, 0xec, 0x16, 0x0,  0x1c, 0x42, 0x3c, 0x10, 0xfa, 0x5d, 0xce, 0x9a, 0x3e, 0xec,
      0xb4, 0xff, 0x5f, 0xc4, 0xe5, 0xcf, 0xf1, 0x7b, 0x95, 0x50, 0xd4, 0xe9, 0x9d, 0x23, 0x95, 0x75, 0x84, 0x9d, 0x6c,
      0x1c, 0x0,  0x9,  0x28, 0x94, 0xc8, 0x91, 0xad, 0xa6, 0x9d, 0xf3, 0x71, 0x16, 0x0,  0x7,  0xe,  0x49, 0x26, 0xa,
      0x67, 0x8d, 0x25, 0x22, 0x7,  0x91, 0x11, 0x0,  0x0,  0x41, 0x52, 0x24, 0x47, 0x12, 0x0,  0x17, 0xc4, 0x23, 0x7,
      0x7b, 0xea, 0x9d, 0x5,  0x6a, 0x61, 0xed, 0xe4, 0x64, 0xea, 0x5e, 0x63, 0xc1, 0x5f, 0x7e, 0xb4, 0xaa, 0xd1, 0x91,
      0x3c, 0x12, 0x0,  0x1a, 0xea, 0x1d, 0x97, 0x4,  0x59, 0xde, 0x40, 0x6a, 0x80, 0xc3, 0x6,  0x4b, 0x3b, 0x2a, 0xf0,
      0xe7, 0xf5, 0xf8, 0x52, 0x82, 0x9f, 0x3c, 0x67, 0x70, 0x58, 0xdf, 0x8,  0x0,  0x2,  0xae, 0x57, 0x2a, 0x93, 0x0,
      0x13, 0xcd, 0xc1, 0x92, 0x43, 0xb0, 0x11, 0x7b, 0x54, 0xbd, 0x68, 0x44, 0xad, 0xbc, 0x1,  0xc6, 0x68, 0xfc, 0x3c,
      0x52, 0x0,  0x10, 0xee, 0xb5, 0x1b, 0x5,  0x10, 0x9f, 0xba, 0xaa, 0x73, 0x4,  0x6e, 0xf8, 0xa,  0x7b, 0xa5, 0x38,
      0x0,  0xc,  0xfa, 0xc8, 0xa2, 0x86, 0x4f, 0x46, 0x1c, 0x18, 0x83, 0x3d, 0xf,  0x1b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe9, 0x5c, 0xfa, 0x1a, 0x15, 0x6b, 0x4b, 0x84, 0xe1, 0xcb, 0x4a, 0x8f, 0x2b, 0xb8, 0xa5};
  uint8_t bytesprops1[] = {0x80, 0x66, 0x5b, 0xcd, 0x63, 0xfe, 0xa5, 0x44, 0xf5, 0xdb, 0xd8, 0x64,
                           0xf8, 0x2e, 0xb7, 0xc2, 0x38, 0x55, 0x7c, 0x2e, 0xf,  0x75, 0xa7};
  uint8_t bytesprops2[] = {0x19, 0x5,  0xbe, 0x72, 0xf7, 0x3b, 0x83, 0x49,
                           0xb0, 0xda, 0x69, 0x5e, 0x1a, 0xff, 0x63, 0x8f};
  uint8_t bytesprops3[] = {0x7,  0xd,  0x43, 0xb9, 0x45, 0x6f, 0x1a, 0x17, 0x54, 0x8b, 0xd4, 0x3,  0x81, 0x64,
                           0x79, 0x20, 0x4f, 0xdf, 0x9e, 0x63, 0xc,  0x61, 0x5d, 0xd6, 0x8b, 0x16, 0xdd};
  uint8_t bytesprops4[] = {0xcf, 0xc7, 0xb9};
  uint8_t bytesprops5[] = {0xb0, 0x4b, 0x70, 0xf4, 0xb1, 0x47, 0x87, 0x61, 0x7};
  uint8_t bytesprops6[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25315}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 10460}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30945}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17366}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19287}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22133}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28666}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 25}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 56}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x73, 0x8c, 0xca, 0x8b, 0x3a, 0x58, 0xb2, 0xf1, 0xe8, 0xba, 0xfc,
                               0x7d, 0xdc, 0x48, 0xc8, 0x92, 0x56, 0xca, 0xb2, 0xb,  0xa5, 0xb6};
  uint8_t byteswillprops1[] = {0xc,  0x57, 0x15, 0x62, 0x6c, 0xa6, 0xc5, 0xc1,
                               0x7a, 0xa5, 0x5c, 0x56, 0xfb, 0xba, 0x7d, 0x70};
  uint8_t byteswillprops2[] = {0x58, 0xaf, 0x5f, 0xd0, 0xb1, 0xc9, 0x1c, 0x88, 0x1a, 0x8,  0xf1, 0x62, 0x1f, 0x55,
                               0x29, 0x80, 0xb2, 0x8,  0x7,  0x8,  0x19, 0x55, 0x43, 0x2a, 0x8f, 0x23, 0x34};
  uint8_t byteswillprops3[] = {0xbd, 0x1f, 0x1e, 0x1c, 0xf5, 0xc8, 0xa6, 0xed, 0x7a, 0xb6, 0xa5, 0x61,
                               0x26, 0xd7, 0x16, 0x71, 0x37, 0xfc, 0xf6, 0x13, 0x3b, 0xd0, 0xea, 0x2f};
  uint8_t byteswillprops5[] = {0x42, 0x7d, 0x98, 0x99, 0x61, 0xdc, 0x6,  0x2b, 0x65, 0x49, 0xbc, 0xa6, 0x7f,
                               0x41, 0xe8, 0x32, 0x86, 0x69, 0x43, 0x6f, 0x7b, 0xb9, 0xe5, 0xb3, 0xa8};
  uint8_t byteswillprops4[] = {0xdb, 0x12, 0x32, 0x9b, 0x65, 0x68, 0xbb, 0xaf, 0x21, 0xdc, 0xa,
                               0x64, 0xb,  0x53, 0xa3, 0xc3, 0xf3, 0x33, 0x51, 0x9b, 0x94};
  uint8_t byteswillprops6[] = {0xf1, 0x24, 0x7d, 0xba, 0xcc};
  uint8_t byteswillprops8[] = {0x72, 0x4c, 0x84, 0x5a, 0x7b, 0x6b};
  uint8_t byteswillprops7[] = {0x28, 0xb4, 0x30, 0xa2, 0x4e, 0x35, 0xc7, 0xae, 0x81, 0x9e, 0xdb, 0x4, 0x87,
                               0xfe, 0x13, 0x6a, 0xe6, 0x22, 0xcf, 0xc1, 0x8f, 0x4a, 0x15, 0xb6, 0xb1};
  uint8_t byteswillprops9[] = {0x42, 0x3c, 0x10, 0xfa, 0x5d, 0xce, 0x9a, 0x3e, 0xec, 0xb4, 0xff, 0x5f, 0xc4, 0xe5,
                               0xcf, 0xf1, 0x7b, 0x95, 0x50, 0xd4, 0xe9, 0x9d, 0x23, 0x95, 0x75, 0x84, 0x9d, 0x6c};
  uint8_t byteswillprops10[] = {0x28, 0x94, 0xc8, 0x91, 0xad, 0xa6, 0x9d, 0xf3, 0x71};
  uint8_t byteswillprops11[] = {0xe, 0x49, 0x26, 0xa, 0x67, 0x8d, 0x25};
  uint8_t byteswillprops12[] = {0xc4, 0x23, 0x7,  0x7b, 0xea, 0x9d, 0x5,  0x6a, 0x61, 0xed, 0xe4, 0x64,
                                0xea, 0x5e, 0x63, 0xc1, 0x5f, 0x7e, 0xb4, 0xaa, 0xd1, 0x91, 0x3c};
  uint8_t byteswillprops13[] = {0xea, 0x1d, 0x97, 0x4,  0x59, 0xde, 0x40, 0x6a, 0x80, 0xc3, 0x6,  0x4b, 0x3b,
                                0x2a, 0xf0, 0xe7, 0xf5, 0xf8, 0x52, 0x82, 0x9f, 0x3c, 0x67, 0x70, 0x58, 0xdf};
  uint8_t byteswillprops14[] = {0xae, 0x57};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25536}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {21, (char*)&byteswillprops4}, .v = {25, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14073}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {25, (char*)&byteswillprops7}, .v = {6, (char*)&byteswillprops8}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23398}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4588}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {7, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1937}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16722}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&byteswillprops12}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&byteswillprops13}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&byteswillprops14}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 147}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xcd, 0xc1, 0x92, 0x43, 0xb0, 0x11, 0x7b, 0x54, 0xbd, 0x68,
                                0x44, 0xad, 0xbc, 0x1,  0xc6, 0x68, 0xfc, 0x3c, 0x52};
  lwmqtt_string_t will_topic = {19, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xee, 0xb5, 0x1b, 0x5,  0x10, 0x9f, 0xba, 0xaa,
                                  0x73, 0x4,  0x6e, 0xf8, 0xa,  0x7b, 0xa5, 0x38};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 26535;
  uint8_t client_id_bytes[] = {0xbf, 0x7c, 0xc5, 0xab, 0x7a, 0xf0, 0x36, 0x61, 0x5c, 0x99, 0xde, 0xd8, 0x4c};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xfa, 0xc8, 0xa2, 0x86, 0x4f, 0x46, 0x1c, 0x18, 0x83, 0x3d, 0xf, 0x1b};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\166\249\a\219\249u\EOTu\143\251", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic = "\NAK\217-e}|k\a\212M<2\SOH\135", _willMsg =
// "\234\243\SI\181\224\fx\DC2j?\196[\150@\140:\DEL#\USkOE", _willProps = [PropMaximumPacketSize
// 22163,PropCorrelationData "\STXC\SUB3\RSl\231\n",PropWillDelayInterval 2212,PropTopicAlias
// 3721,PropSessionExpiryInterval 22751,PropAuthenticationMethod
// "=\n\235\129|\201\151\232\191\147\DC3\222\129z\199l\SO\147\175\232r\217\171"]}), _cleanSession = True, _keepAlive =
// 25650, _connID = "\US\179p\223Y8\251\250}|\146\DC10", _properties = [PropSubscriptionIdentifier
// 26,PropRequestResponseInformation 101,PropMaximumPacketSize 26563,PropContentType
// "\ACK\RS2`\130\&4\148G\222\158-K\ESC\213\DC2\130\129I$\SOH\210",PropUserProperty "5\222\192h"
// "\130\225tF\192\211\182\GS"]}
TEST(Connect5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x10, 0xb8, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6e, 0x64, 0x32, 0x32, 0xb,  0x1a, 0x19, 0x65, 0x27,
      0x0,  0x0,  0x67, 0xc3, 0x3,  0x0,  0x15, 0x6,  0x1e, 0x32, 0x60, 0x82, 0x34, 0x94, 0x47, 0xde, 0x9e, 0x2d, 0x4b,
      0x1b, 0xd5, 0x12, 0x82, 0x81, 0x49, 0x24, 0x1,  0xd2, 0x26, 0x0,  0x4,  0x35, 0xde, 0xc0, 0x68, 0x0,  0x8,  0x82,
      0xe1, 0x74, 0x46, 0xc0, 0xd3, 0xb6, 0x1d, 0x0,  0xd,  0x1f, 0xb3, 0x70, 0xdf, 0x59, 0x38, 0xfb, 0xfa, 0x7d, 0x7c,
      0x92, 0x11, 0x30, 0x37, 0x27, 0x0,  0x0,  0x56, 0x93, 0x9,  0x0,  0x8,  0x2,  0x43, 0x1a, 0x33, 0x1e, 0x6c, 0xe7,
      0xa,  0x18, 0x0,  0x0,  0x8,  0xa4, 0x23, 0xe,  0x89, 0x11, 0x0,  0x0,  0x58, 0xdf, 0x15, 0x0,  0x17, 0x3d, 0xa,
      0xeb, 0x81, 0x7c, 0xc9, 0x97, 0xe8, 0xbf, 0x93, 0x13, 0xde, 0x81, 0x7a, 0xc7, 0x6c, 0xe,  0x93, 0xaf, 0xe8, 0x72,
      0xd9, 0xab, 0x0,  0xe,  0x15, 0xd9, 0x2d, 0x65, 0x7d, 0x7c, 0x6b, 0x7,  0xd4, 0x4d, 0x3c, 0x32, 0x1,  0x87, 0x0,
      0x16, 0xea, 0xf3, 0xf,  0xb5, 0xe0, 0xc,  0x78, 0x12, 0x6a, 0x3f, 0xc4, 0x5b, 0x96, 0x40, 0x8c, 0x3a, 0x7f, 0x23,
      0x1f, 0x6b, 0x4f, 0x45, 0x0,  0xa,  0xa6, 0xf9, 0x7,  0xdb, 0xf9, 0x75, 0x4,  0x75, 0x8f, 0xfb};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6,  0x1e, 0x32, 0x60, 0x82, 0x34, 0x94, 0x47, 0xde, 0x9e, 0x2d,
                           0x4b, 0x1b, 0xd5, 0x12, 0x82, 0x81, 0x49, 0x24, 0x1,  0xd2};
  uint8_t bytesprops2[] = {0x82, 0xe1, 0x74, 0x46, 0xc0, 0xd3, 0xb6, 0x1d};
  uint8_t bytesprops1[] = {0x35, 0xde, 0xc0, 0x68};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26563}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {5, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x2, 0x43, 0x1a, 0x33, 0x1e, 0x6c, 0xe7, 0xa};
  uint8_t byteswillprops1[] = {0x3d, 0xa,  0xeb, 0x81, 0x7c, 0xc9, 0x97, 0xe8, 0xbf, 0x93, 0x13, 0xde,
                               0x81, 0x7a, 0xc7, 0x6c, 0xe,  0x93, 0xaf, 0xe8, 0x72, 0xd9, 0xab};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22163}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {8, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2212}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 3721}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22751}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&byteswillprops1}}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x15, 0xd9, 0x2d, 0x65, 0x7d, 0x7c, 0x6b, 0x7, 0xd4, 0x4d, 0x3c, 0x32, 0x1, 0x87};
  lwmqtt_string_t will_topic = {14, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xea, 0xf3, 0xf,  0xb5, 0xe0, 0xc,  0x78, 0x12, 0x6a, 0x3f, 0xc4,
                                  0x5b, 0x96, 0x40, 0x8c, 0x3a, 0x7f, 0x23, 0x1f, 0x6b, 0x4f, 0x45};
  lwmqtt_string_t will_payload = {22, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 25650;
  uint8_t client_id_bytes[] = {0x1f, 0xb3, 0x70, 0xdf, 0x59, 0x38, 0xfb, 0xfa, 0x7d, 0x7c, 0x92, 0x11, 0x30};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xa6, 0xf9, 0x7, 0xdb, 0xf9, 0x75, 0x4, 0x75, 0x8f, 0xfb};
  lwmqtt_string_t password = {10, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "\194\DC3\201\173i\234P)\159\241N\208l\133G", _willMsg = "\208\250\192\160", _willProps =
// [PropAuthenticationData "h<y!\ETXj.kp\ESC\228\153\&8\n\140",PropResponseTopic
// "\177\215\254\US\170\156\255\161\230\174I.\137pV
// ]\160K!\179\162\184\226\136_z+\154\201",PropRequestResponseInformation 172,PropResponseTopic
// "W\236O[k\219\157\181\NUL;\222p\137\206\128\145\254",PropServerKeepAlive 21832,PropResponseInformation
// "q\138\208\153x\217X\DC2\210\157\187\237\197\vu\180GG;Xta\183\NUL\206\216WZqG",PropUserProperty
// "\175(\159\141\&1\182\&5y\237KaUh\187\226kfK4\DC1\193I%#l\179\US\199\&6)"
// "\193\182\243\EM\181\DC1\231=R\163\193\199\&7\217p\240Nl\DEL[C",PropServerReference
// "\252\144\150\154\ETX\221\184\180\RS\195\220\b\208"]}), _cleanSession = False, _keepAlive = 737, _connID =
// "\204r\138\210\153>\161K\EMw\NAK\r\DC4\188\158Z\ACK6", _properties = [PropSubscriptionIdentifier
// 30,PropAuthenticationMethod
// "}\188E\134\175\141h\217\DC40_Y[\NUL\212]\NUL\203\198\213}\DC2S\SO\214\&8\v\218",PropWillDelayInterval
// 13946,PropPayloadFormatIndicator 67,PropRequestProblemInformation 96,PropContentType
// "/\253C.d,,zl\167G\b",PropServerReference "{'sWS?'\201\183\220\EOT\STX",PropCorrelationData "\167\140Z\160,S\DC1\137
// /\192\199\236V\220\150\156\219\193'\207\DLE\221\EM#",PropMaximumPacketSize 7792,PropSubscriptionIdentifierAvailable
// 74,PropUserProperty "@\134Y\217(\218hi\152\CAN\216\172\181" "*-\207cGd@?\232
// \158\202Y\158\ACK\202$\249\139\129~[",PropAuthenticationMethod
// "\178(v\221\243R\r\246\195\226\ETX\EM\247\252\206\162\180F{\138"]}
TEST(Connect5QCTest, Encode15) {
  uint8_t pkt[] = {
      0x10, 0x98, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x14, 0x2,  0xe1, 0xaa, 0x1,  0xb,  0x1e, 0x15, 0x0,
      0x1c, 0x7d, 0xbc, 0x45, 0x86, 0xaf, 0x8d, 0x68, 0xd9, 0x14, 0x30, 0x5f, 0x59, 0x5b, 0x0,  0xd4, 0x5d, 0x0,  0xcb,
      0xc6, 0xd5, 0x7d, 0x12, 0x53, 0xe,  0xd6, 0x38, 0xb,  0xda, 0x18, 0x0,  0x0,  0x36, 0x7a, 0x1,  0x43, 0x17, 0x60,
      0x3,  0x0,  0xc,  0x2f, 0xfd, 0x43, 0x2e, 0x64, 0x2c, 0x2c, 0x7a, 0x6c, 0xa7, 0x47, 0x8,  0x1c, 0x0,  0xc,  0x7b,
      0x27, 0x73, 0x57, 0x53, 0x3f, 0x27, 0xc9, 0xb7, 0xdc, 0x4,  0x2,  0x9,  0x0,  0x19, 0xa7, 0x8c, 0x5a, 0xa0, 0x2c,
      0x53, 0x11, 0x89, 0x20, 0x2f, 0xc0, 0xc7, 0xec, 0x56, 0xdc, 0x96, 0x9c, 0xdb, 0xc1, 0x27, 0xcf, 0x10, 0xdd, 0x19,
      0x23, 0x27, 0x0,  0x0,  0x1e, 0x70, 0x29, 0x4a, 0x26, 0x0,  0xd,  0x40, 0x86, 0x59, 0xd9, 0x28, 0xda, 0x68, 0x69,
      0x98, 0x18, 0xd8, 0xac, 0xb5, 0x0,  0x16, 0x2a, 0x2d, 0xcf, 0x63, 0x47, 0x64, 0x40, 0x3f, 0xe8, 0x20, 0x9e, 0xca,
      0x59, 0x9e, 0x6,  0xca, 0x24, 0xf9, 0x8b, 0x81, 0x7e, 0x5b, 0x15, 0x0,  0x14, 0xb2, 0x28, 0x76, 0xdd, 0xf3, 0x52,
      0xd,  0xf6, 0xc3, 0xe2, 0x3,  0x19, 0xf7, 0xfc, 0xce, 0xa2, 0xb4, 0x46, 0x7b, 0x8a, 0x0,  0x12, 0xcc, 0x72, 0x8a,
      0xd2, 0x99, 0x3e, 0xa1, 0x4b, 0x19, 0x77, 0x15, 0xd,  0x14, 0xbc, 0x9e, 0x5a, 0x6,  0x36, 0xb5, 0x1,  0x16, 0x0,
      0xf,  0x68, 0x3c, 0x79, 0x21, 0x3,  0x6a, 0x2e, 0x6b, 0x70, 0x1b, 0xe4, 0x99, 0x38, 0xa,  0x8c, 0x8,  0x0,  0x1e,
      0xb1, 0xd7, 0xfe, 0x1f, 0xaa, 0x9c, 0xff, 0xa1, 0xe6, 0xae, 0x49, 0x2e, 0x89, 0x70, 0x56, 0x20, 0x5d, 0xa0, 0x4b,
      0x21, 0xb3, 0xa2, 0xb8, 0xe2, 0x88, 0x5f, 0x7a, 0x2b, 0x9a, 0xc9, 0x19, 0xac, 0x8,  0x0,  0x11, 0x57, 0xec, 0x4f,
      0x5b, 0x6b, 0xdb, 0x9d, 0xb5, 0x0,  0x3b, 0xde, 0x70, 0x89, 0xce, 0x80, 0x91, 0xfe, 0x13, 0x55, 0x48, 0x1a, 0x0,
      0x1e, 0x71, 0x8a, 0xd0, 0x99, 0x78, 0xd9, 0x58, 0x12, 0xd2, 0x9d, 0xbb, 0xed, 0xc5, 0xb,  0x75, 0xb4, 0x47, 0x47,
      0x3b, 0x58, 0x74, 0x61, 0xb7, 0x0,  0xce, 0xd8, 0x57, 0x5a, 0x71, 0x47, 0x26, 0x0,  0x1e, 0xaf, 0x28, 0x9f, 0x8d,
      0x31, 0xb6, 0x35, 0x79, 0xed, 0x4b, 0x61, 0x55, 0x68, 0xbb, 0xe2, 0x6b, 0x66, 0x4b, 0x34, 0x11, 0xc1, 0x49, 0x25,
      0x23, 0x6c, 0xb3, 0x1f, 0xc7, 0x36, 0x29, 0x0,  0x15, 0xc1, 0xb6, 0xf3, 0x19, 0xb5, 0x11, 0xe7, 0x3d, 0x52, 0xa3,
      0xc1, 0xc7, 0x37, 0xd9, 0x70, 0xf0, 0x4e, 0x6c, 0x7f, 0x5b, 0x43, 0x1c, 0x0,  0xd,  0xfc, 0x90, 0x96, 0x9a, 0x3,
      0xdd, 0xb8, 0xb4, 0x1e, 0xc3, 0xdc, 0x8,  0xd0, 0x0,  0xf,  0xc2, 0x13, 0xc9, 0xad, 0x69, 0xea, 0x50, 0x29, 0x9f,
      0xf1, 0x4e, 0xd0, 0x6c, 0x85, 0x47, 0x0,  0x4,  0xd0, 0xfa, 0xc0, 0xa0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7d, 0xbc, 0x45, 0x86, 0xaf, 0x8d, 0x68, 0xd9, 0x14, 0x30, 0x5f, 0x59, 0x5b, 0x0,
                           0xd4, 0x5d, 0x0,  0xcb, 0xc6, 0xd5, 0x7d, 0x12, 0x53, 0xe,  0xd6, 0x38, 0xb,  0xda};
  uint8_t bytesprops1[] = {0x2f, 0xfd, 0x43, 0x2e, 0x64, 0x2c, 0x2c, 0x7a, 0x6c, 0xa7, 0x47, 0x8};
  uint8_t bytesprops2[] = {0x7b, 0x27, 0x73, 0x57, 0x53, 0x3f, 0x27, 0xc9, 0xb7, 0xdc, 0x4, 0x2};
  uint8_t bytesprops3[] = {0xa7, 0x8c, 0x5a, 0xa0, 0x2c, 0x53, 0x11, 0x89, 0x20, 0x2f, 0xc0, 0xc7, 0xec,
                           0x56, 0xdc, 0x96, 0x9c, 0xdb, 0xc1, 0x27, 0xcf, 0x10, 0xdd, 0x19, 0x23};
  uint8_t bytesprops5[] = {0x2a, 0x2d, 0xcf, 0x63, 0x47, 0x64, 0x40, 0x3f, 0xe8, 0x20, 0x9e,
                           0xca, 0x59, 0x9e, 0x6,  0xca, 0x24, 0xf9, 0x8b, 0x81, 0x7e, 0x5b};
  uint8_t bytesprops4[] = {0x40, 0x86, 0x59, 0xd9, 0x28, 0xda, 0x68, 0x69, 0x98, 0x18, 0xd8, 0xac, 0xb5};
  uint8_t bytesprops6[] = {0xb2, 0x28, 0x76, 0xdd, 0xf3, 0x52, 0xd,  0xf6, 0xc3, 0xe2,
                           0x3,  0x19, 0xf7, 0xfc, 0xce, 0xa2, 0xb4, 0x46, 0x7b, 0x8a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13946}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7792}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops4}, .v = {22, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x68, 0x3c, 0x79, 0x21, 0x3, 0x6a, 0x2e, 0x6b, 0x70, 0x1b, 0xe4, 0x99, 0x38, 0xa, 0x8c};
  uint8_t byteswillprops1[] = {0xb1, 0xd7, 0xfe, 0x1f, 0xaa, 0x9c, 0xff, 0xa1, 0xe6, 0xae,
                               0x49, 0x2e, 0x89, 0x70, 0x56, 0x20, 0x5d, 0xa0, 0x4b, 0x21,
                               0xb3, 0xa2, 0xb8, 0xe2, 0x88, 0x5f, 0x7a, 0x2b, 0x9a, 0xc9};
  uint8_t byteswillprops2[] = {0x57, 0xec, 0x4f, 0x5b, 0x6b, 0xdb, 0x9d, 0xb5, 0x0,
                               0x3b, 0xde, 0x70, 0x89, 0xce, 0x80, 0x91, 0xfe};
  uint8_t byteswillprops3[] = {0x71, 0x8a, 0xd0, 0x99, 0x78, 0xd9, 0x58, 0x12, 0xd2, 0x9d,
                               0xbb, 0xed, 0xc5, 0xb,  0x75, 0xb4, 0x47, 0x47, 0x3b, 0x58,
                               0x74, 0x61, 0xb7, 0x0,  0xce, 0xd8, 0x57, 0x5a, 0x71, 0x47};
  uint8_t byteswillprops5[] = {0xc1, 0xb6, 0xf3, 0x19, 0xb5, 0x11, 0xe7, 0x3d, 0x52, 0xa3, 0xc1,
                               0xc7, 0x37, 0xd9, 0x70, 0xf0, 0x4e, 0x6c, 0x7f, 0x5b, 0x43};
  uint8_t byteswillprops4[] = {0xaf, 0x28, 0x9f, 0x8d, 0x31, 0xb6, 0x35, 0x79, 0xed, 0x4b,
                               0x61, 0x55, 0x68, 0xbb, 0xe2, 0x6b, 0x66, 0x4b, 0x34, 0x11,
                               0xc1, 0x49, 0x25, 0x23, 0x6c, 0xb3, 0x1f, 0xc7, 0x36, 0x29};
  uint8_t byteswillprops6[] = {0xfc, 0x90, 0x96, 0x9a, 0x3, 0xdd, 0xb8, 0xb4, 0x1e, 0xc3, 0xdc, 0x8, 0xd0};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 172}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21832}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops4}, .v = {21, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&byteswillprops6}}},
  };

  lwmqtt_properties_t willprops = {8, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc2, 0x13, 0xc9, 0xad, 0x69, 0xea, 0x50, 0x29,
                                0x9f, 0xf1, 0x4e, 0xd0, 0x6c, 0x85, 0x47};
  lwmqtt_string_t will_topic = {15, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xd0, 0xfa, 0xc0, 0xa0};
  lwmqtt_string_t will_payload = {4, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 737;
  uint8_t client_id_bytes[] = {0xcc, 0x72, 0x8a, 0xd2, 0x99, 0x3e, 0xa1, 0x4b, 0x19,
                               0x77, 0x15, 0xd,  0x14, 0xbc, 0x9e, 0x5a, 0x6,  0x36};
  lwmqtt_string_t client_id = {18, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "=\244\ESCz\EM\205Q\216 \211\&62\EM\238\244\239O D\136", _password = Just
// "\CANj\v\180\161\237\198h\184_NXO\223\DC1p$\175\183/*\178\186v2Z\USe\145", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = ":\229v?<fE\199\246\182\174\141~\DC1`y\215\172L%\158\f\216\198:", _willMsg =
// "\249-\184\234\146\167\238\177\251\167V", _willProps = [PropReasonString
// "\240\130M*\253v>G\137\&4\DC4\206\151\169\DC2\SO\230\143RYg\149\228Q\SYN\220\176\201\157",PropTopicAliasMaximum
// 25134,PropSessionExpiryInterval 21348,PropSubscriptionIdentifierAvailable 19,PropPayloadFormatIndicator
// 250,PropMaximumPacketSize 28204,PropRetainAvailable 37,PropAssignedClientIdentifier
// "p\134\DC3\185\192\140\178&{1P\188\198",PropMessageExpiryInterval 15366,PropMaximumPacketSize
// 7017,PropWillDelayInterval 7756,PropRetainAvailable 121,PropSharedSubscriptionAvailable 51,PropUserProperty
// "\203\191\129(l\243[\173\210{=\185$\146\180\163\206\161\221\142\174\227\196\EM\237\214?y\156g"
// "\194S\132\191\191o\210\&5Sv\138\191M",PropWildcardSubscriptionAvailable 4,PropWillDelayInterval
// 9468,PropCorrelationData "\253\158\148A\245lZ\254\133\GS$\219H\181\226\208\238\EM",PropWildcardSubscriptionAvailable
// 142,PropServerKeepAlive 7563,PropAuthenticationMethod "3K\145\\",PropAssignedClientIdentifier
// "\167\169\248\n\239\183\251~+Z\186\158\232\ESCF\227,$",PropMaximumQoS 231,PropMessageExpiryInterval
// 2465,PropPayloadFormatIndicator 252,PropResponseTopic
// "\159\205I\251\142\aMs\191\136\ETX\STX\237\CANS9!U\GS\208\ENQrMR\CAN\bzD"]}), _cleanSession = True, _keepAlive =
// 13449, _connID = "\160\224\209~y/wD\182\&6\143\210\244\&6D\190", _properties = [PropAssignedClientIdentifier
// "R\RSI\189\206\210v",PropReasonString "\144\t\"\DEL\176\150\214\245_\203\190\176",PropAuthenticationData
// "\202\&4\n\171\157*\ETX\212{^\186\215x\EOT\229C\157\&2m_}:",PropReasonString
// "\203\&3W\227\217n\231q\a~\204\195M\237k\160.\248\SOH\207\171c\234\217Ad\241_f\203",PropCorrelationData
// "\ESC\216-\244\173\222\165\187\&8m\a~g*I\159\DC1z\141Gg\203w",PropAssignedClientIdentifier
// "",PropRequestResponseInformation 124,PropWildcardSubscriptionAvailable 213,PropReasonString
// "\165\240\217",PropResponseInformation "\155\NUL\246\217Nw\v!\215\ETX\159\163w\DLE\196",PropMessageExpiryInterval
// 26429,PropWildcardSubscriptionAvailable 28,PropServerReference
// "\165\185\&5\239k\DC1\198\213\164",PropRequestProblemInformation 160]}
TEST(Connect5QCTest, Encode16) {
  uint8_t pkt[] = {
      0x10, 0x89, 0x4,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd6, 0x34, 0x89, 0xa1, 0x1,  0x12, 0x0,  0x7,  0x52,
      0x1e, 0x49, 0xbd, 0xce, 0xd2, 0x76, 0x1f, 0x0,  0xc,  0x90, 0x9,  0x22, 0x7f, 0xb0, 0x96, 0xd6, 0xf5, 0x5f, 0xcb,
      0xbe, 0xb0, 0x16, 0x0,  0x16, 0xca, 0x34, 0xa,  0xab, 0x9d, 0x2a, 0x3,  0xd4, 0x7b, 0x5e, 0xba, 0xd7, 0x78, 0x4,
      0xe5, 0x43, 0x9d, 0x32, 0x6d, 0x5f, 0x7d, 0x3a, 0x1f, 0x0,  0x1e, 0xcb, 0x33, 0x57, 0xe3, 0xd9, 0x6e, 0xe7, 0x71,
      0x7,  0x7e, 0xcc, 0xc3, 0x4d, 0xed, 0x6b, 0xa0, 0x2e, 0xf8, 0x1,  0xcf, 0xab, 0x63, 0xea, 0xd9, 0x41, 0x64, 0xf1,
      0x5f, 0x66, 0xcb, 0x9,  0x0,  0x17, 0x1b, 0xd8, 0x2d, 0xf4, 0xad, 0xde, 0xa5, 0xbb, 0x38, 0x6d, 0x7,  0x7e, 0x67,
      0x2a, 0x49, 0x9f, 0x11, 0x7a, 0x8d, 0x47, 0x67, 0xcb, 0x77, 0x12, 0x0,  0x0,  0x19, 0x7c, 0x28, 0xd5, 0x1f, 0x0,
      0x3,  0xa5, 0xf0, 0xd9, 0x1a, 0x0,  0xf,  0x9b, 0x0,  0xf6, 0xd9, 0x4e, 0x77, 0xb,  0x21, 0xd7, 0x3,  0x9f, 0xa3,
      0x77, 0x10, 0xc4, 0x2,  0x0,  0x0,  0x67, 0x3d, 0x28, 0x1c, 0x1c, 0x0,  0x9,  0xa5, 0xb9, 0x35, 0xef, 0x6b, 0x11,
      0xc6, 0xd5, 0xa4, 0x17, 0xa0, 0x0,  0x10, 0xa0, 0xe0, 0xd1, 0x7e, 0x79, 0x2f, 0x77, 0x44, 0xb6, 0x36, 0x8f, 0xd2,
      0xf4, 0x36, 0x44, 0xbe, 0xeb, 0x1,  0x1f, 0x0,  0x1d, 0xf0, 0x82, 0x4d, 0x2a, 0xfd, 0x76, 0x3e, 0x47, 0x89, 0x34,
      0x14, 0xce, 0x97, 0xa9, 0x12, 0xe,  0xe6, 0x8f, 0x52, 0x59, 0x67, 0x95, 0xe4, 0x51, 0x16, 0xdc, 0xb0, 0xc9, 0x9d,
      0x22, 0x62, 0x2e, 0x11, 0x0,  0x0,  0x53, 0x64, 0x29, 0x13, 0x1,  0xfa, 0x27, 0x0,  0x0,  0x6e, 0x2c, 0x25, 0x25,
      0x12, 0x0,  0xd,  0x70, 0x86, 0x13, 0xb9, 0xc0, 0x8c, 0xb2, 0x26, 0x7b, 0x31, 0x50, 0xbc, 0xc6, 0x2,  0x0,  0x0,
      0x3c, 0x6,  0x27, 0x0,  0x0,  0x1b, 0x69, 0x18, 0x0,  0x0,  0x1e, 0x4c, 0x25, 0x79, 0x2a, 0x33, 0x26, 0x0,  0x1e,
      0xcb, 0xbf, 0x81, 0x28, 0x6c, 0xf3, 0x5b, 0xad, 0xd2, 0x7b, 0x3d, 0xb9, 0x24, 0x92, 0xb4, 0xa3, 0xce, 0xa1, 0xdd,
      0x8e, 0xae, 0xe3, 0xc4, 0x19, 0xed, 0xd6, 0x3f, 0x79, 0x9c, 0x67, 0x0,  0xd,  0xc2, 0x53, 0x84, 0xbf, 0xbf, 0x6f,
      0xd2, 0x35, 0x53, 0x76, 0x8a, 0xbf, 0x4d, 0x28, 0x4,  0x18, 0x0,  0x0,  0x24, 0xfc, 0x9,  0x0,  0x12, 0xfd, 0x9e,
      0x94, 0x41, 0xf5, 0x6c, 0x5a, 0xfe, 0x85, 0x1d, 0x24, 0xdb, 0x48, 0xb5, 0xe2, 0xd0, 0xee, 0x19, 0x28, 0x8e, 0x13,
      0x1d, 0x8b, 0x15, 0x0,  0x4,  0x33, 0x4b, 0x91, 0x5c, 0x12, 0x0,  0x12, 0xa7, 0xa9, 0xf8, 0xa,  0xef, 0xb7, 0xfb,
      0x7e, 0x2b, 0x5a, 0xba, 0x9e, 0xe8, 0x1b, 0x46, 0xe3, 0x2c, 0x24, 0x24, 0xe7, 0x2,  0x0,  0x0,  0x9,  0xa1, 0x1,
      0xfc, 0x8,  0x0,  0x1c, 0x9f, 0xcd, 0x49, 0xfb, 0x8e, 0x7,  0x4d, 0x73, 0xbf, 0x88, 0x3,  0x2,  0xed, 0x18, 0x53,
      0x39, 0x21, 0x55, 0x1d, 0xd0, 0x5,  0x72, 0x4d, 0x52, 0x18, 0x8,  0x7a, 0x44, 0x0,  0x19, 0x3a, 0xe5, 0x76, 0x3f,
      0x3c, 0x66, 0x45, 0xc7, 0xf6, 0xb6, 0xae, 0x8d, 0x7e, 0x11, 0x60, 0x79, 0xd7, 0xac, 0x4c, 0x25, 0x9e, 0xc,  0xd8,
      0xc6, 0x3a, 0x0,  0xb,  0xf9, 0x2d, 0xb8, 0xea, 0x92, 0xa7, 0xee, 0xb1, 0xfb, 0xa7, 0x56, 0x0,  0x14, 0x3d, 0xf4,
      0x1b, 0x7a, 0x19, 0xcd, 0x51, 0xd8, 0x20, 0xd3, 0x36, 0x32, 0x19, 0xee, 0xf4, 0xef, 0x4f, 0x20, 0x44, 0x88, 0x0,
      0x1d, 0x18, 0x6a, 0xb,  0xb4, 0xa1, 0xed, 0xc6, 0x68, 0xb8, 0x5f, 0x4e, 0x58, 0x4f, 0xdf, 0x11, 0x70, 0x24, 0xaf,
      0xb7, 0x2f, 0x2a, 0xb2, 0xba, 0x76, 0x32, 0x5a, 0x1f, 0x65, 0x91};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x52, 0x1e, 0x49, 0xbd, 0xce, 0xd2, 0x76};
  uint8_t bytesprops1[] = {0x90, 0x9, 0x22, 0x7f, 0xb0, 0x96, 0xd6, 0xf5, 0x5f, 0xcb, 0xbe, 0xb0};
  uint8_t bytesprops2[] = {0xca, 0x34, 0xa, 0xab, 0x9d, 0x2a, 0x3,  0xd4, 0x7b, 0x5e, 0xba,
                           0xd7, 0x78, 0x4, 0xe5, 0x43, 0x9d, 0x32, 0x6d, 0x5f, 0x7d, 0x3a};
  uint8_t bytesprops3[] = {0xcb, 0x33, 0x57, 0xe3, 0xd9, 0x6e, 0xe7, 0x71, 0x7,  0x7e, 0xcc, 0xc3, 0x4d, 0xed, 0x6b,
                           0xa0, 0x2e, 0xf8, 0x1,  0xcf, 0xab, 0x63, 0xea, 0xd9, 0x41, 0x64, 0xf1, 0x5f, 0x66, 0xcb};
  uint8_t bytesprops4[] = {0x1b, 0xd8, 0x2d, 0xf4, 0xad, 0xde, 0xa5, 0xbb, 0x38, 0x6d, 0x7, 0x7e,
                           0x67, 0x2a, 0x49, 0x9f, 0x11, 0x7a, 0x8d, 0x47, 0x67, 0xcb, 0x77};
  uint8_t bytesprops5[] = {0};
  uint8_t bytesprops6[] = {0xa5, 0xf0, 0xd9};
  uint8_t bytesprops7[] = {0x9b, 0x0, 0xf6, 0xd9, 0x4e, 0x77, 0xb, 0x21, 0xd7, 0x3, 0x9f, 0xa3, 0x77, 0x10, 0xc4};
  uint8_t bytesprops8[] = {0xa5, 0xb9, 0x35, 0xef, 0x6b, 0x11, 0xc6, 0xd5, 0xa4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26429}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 160}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf0, 0x82, 0x4d, 0x2a, 0xfd, 0x76, 0x3e, 0x47, 0x89, 0x34, 0x14, 0xce, 0x97, 0xa9, 0x12,
                               0xe,  0xe6, 0x8f, 0x52, 0x59, 0x67, 0x95, 0xe4, 0x51, 0x16, 0xdc, 0xb0, 0xc9, 0x9d};
  uint8_t byteswillprops1[] = {0x70, 0x86, 0x13, 0xb9, 0xc0, 0x8c, 0xb2, 0x26, 0x7b, 0x31, 0x50, 0xbc, 0xc6};
  uint8_t byteswillprops3[] = {0xc2, 0x53, 0x84, 0xbf, 0xbf, 0x6f, 0xd2, 0x35, 0x53, 0x76, 0x8a, 0xbf, 0x4d};
  uint8_t byteswillprops2[] = {0xcb, 0xbf, 0x81, 0x28, 0x6c, 0xf3, 0x5b, 0xad, 0xd2, 0x7b,
                               0x3d, 0xb9, 0x24, 0x92, 0xb4, 0xa3, 0xce, 0xa1, 0xdd, 0x8e,
                               0xae, 0xe3, 0xc4, 0x19, 0xed, 0xd6, 0x3f, 0x79, 0x9c, 0x67};
  uint8_t byteswillprops4[] = {0xfd, 0x9e, 0x94, 0x41, 0xf5, 0x6c, 0x5a, 0xfe, 0x85,
                               0x1d, 0x24, 0xdb, 0x48, 0xb5, 0xe2, 0xd0, 0xee, 0x19};
  uint8_t byteswillprops5[] = {0x33, 0x4b, 0x91, 0x5c};
  uint8_t byteswillprops6[] = {0xa7, 0xa9, 0xf8, 0xa,  0xef, 0xb7, 0xfb, 0x7e, 0x2b,
                               0x5a, 0xba, 0x9e, 0xe8, 0x1b, 0x46, 0xe3, 0x2c, 0x24};
  uint8_t byteswillprops7[] = {0x9f, 0xcd, 0x49, 0xfb, 0x8e, 0x7,  0x4d, 0x73, 0xbf, 0x88, 0x3,  0x2, 0xed, 0x18,
                               0x53, 0x39, 0x21, 0x55, 0x1d, 0xd0, 0x5,  0x72, 0x4d, 0x52, 0x18, 0x8, 0x7a, 0x44};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25134}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21348}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28204}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15366}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7017}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7756}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {30, (char*)&byteswillprops2}, .v = {13, (char*)&byteswillprops3}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 4}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9468}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {18, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7563}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {18, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2465}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&byteswillprops7}}},
  };

  lwmqtt_properties_t willprops = {25, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x3a, 0xe5, 0x76, 0x3f, 0x3c, 0x66, 0x45, 0xc7, 0xf6, 0xb6, 0xae, 0x8d, 0x7e,
                                0x11, 0x60, 0x79, 0xd7, 0xac, 0x4c, 0x25, 0x9e, 0xc,  0xd8, 0xc6, 0x3a};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf9, 0x2d, 0xb8, 0xea, 0x92, 0xa7, 0xee, 0xb1, 0xfb, 0xa7, 0x56};
  lwmqtt_string_t will_payload = {11, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 13449;
  uint8_t client_id_bytes[] = {0xa0, 0xe0, 0xd1, 0x7e, 0x79, 0x2f, 0x77, 0x44,
                               0xb6, 0x36, 0x8f, 0xd2, 0xf4, 0x36, 0x44, 0xbe};
  lwmqtt_string_t client_id = {16, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x3d, 0xf4, 0x1b, 0x7a, 0x19, 0xcd, 0x51, 0xd8, 0x20, 0xd3,
                              0x36, 0x32, 0x19, 0xee, 0xf4, 0xef, 0x4f, 0x20, 0x44, 0x88};
  lwmqtt_string_t username = {20, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x18, 0x6a, 0xb,  0xb4, 0xa1, 0xed, 0xc6, 0x68, 0xb8, 0x5f, 0x4e, 0x58, 0x4f, 0xdf, 0x11,
                              0x70, 0x24, 0xaf, 0xb7, 0x2f, 0x2a, 0xb2, 0xba, 0x76, 0x32, 0x5a, 0x1f, 0x65, 0x91};
  lwmqtt_string_t password = {29, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\EM~\132\178\GS\169&\143*J\FS\223", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS0, _willTopic = "@li\185SS", _willMsg =
// "\225\&9L\215\ENQ\CAN\158w\142P\EOT\219\157\227\160", _willProps = [PropTopicAlias 18028,PropRetainAvailable
// 185,PropSubscriptionIdentifier 20]}), _cleanSession = False, _keepAlive = 7971, _connID =
// "T\NAK\150\156\144\224\213\148P\161D\216\239ZE\171\185\169c\STX\173", _properties = [PropContentType
// "\DEL\223b\237\148\186\245",PropAuthenticationMethod
// "\158\DC3\214LI\160\253\195\164}t\182\ACK\192\191g",PropWillDelayInterval 25298,PropMessageExpiryInterval
// 27525,PropSubscriptionIdentifierAvailable 249,PropAuthenticationMethod
// "\247\178,+\SOH\236X\156\170\179F",PropMaximumQoS 90,PropResponseInformation
// "W!\154\169\DC2|\EM\158\DLE#5\157\246\&6\235\238\192'\f_\221\149\129\144\189\STX\144\242\141\DLE",PropResponseInformation
// "\165\DC1\136\239}' \131\184\&2\253I\217\142Ut|\225\&6/\178",PropTopicAlias 20976,PropMaximumQoS
// 135,PropMessageExpiryInterval 30112,PropAssignedClientIdentifier "{\133\251\144\SUB\252>\138,",PropContentType
// "\f\193\219\191! HJ\251\242\208",PropMaximumQoS 252,PropSessionExpiryInterval 9433,PropWillDelayInterval
// 7916,PropSubscriptionIdentifier 16,PropRequestResponseInformation 251,PropPayloadFormatIndicator 189,PropMaximumQoS
// 87,PropServerKeepAlive 28237,PropMaximumPacketSize 32319,PropTopicAlias 24039,PropRetainAvailable
// 214,PropAssignedClientIdentifier "\167\206\161K\DC4\134\DC4\165\146\\\221\ETX[\185\t\DC4N)\133\&1",PropMaximumQoS
// 195,PropAuthenticationData "\ETX"]}
TEST(Connect5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x10, 0xa6, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x44, 0x1f, 0x23, 0xd4, 0x1,  0x3,  0x0,  0x7,  0x7f,
      0xdf, 0x62, 0xed, 0x94, 0xba, 0xf5, 0x15, 0x0,  0x10, 0x9e, 0x13, 0xd6, 0x4c, 0x49, 0xa0, 0xfd, 0xc3, 0xa4, 0x7d,
      0x74, 0xb6, 0x6,  0xc0, 0xbf, 0x67, 0x18, 0x0,  0x0,  0x62, 0xd2, 0x2,  0x0,  0x0,  0x6b, 0x85, 0x29, 0xf9, 0x15,
      0x0,  0xb,  0xf7, 0xb2, 0x2c, 0x2b, 0x1,  0xec, 0x58, 0x9c, 0xaa, 0xb3, 0x46, 0x24, 0x5a, 0x1a, 0x0,  0x1e, 0x57,
      0x21, 0x9a, 0xa9, 0x12, 0x7c, 0x19, 0x9e, 0x10, 0x23, 0x35, 0x9d, 0xf6, 0x36, 0xeb, 0xee, 0xc0, 0x27, 0xc,  0x5f,
      0xdd, 0x95, 0x81, 0x90, 0xbd, 0x2,  0x90, 0xf2, 0x8d, 0x10, 0x1a, 0x0,  0x15, 0xa5, 0x11, 0x88, 0xef, 0x7d, 0x27,
      0x20, 0x83, 0xb8, 0x32, 0xfd, 0x49, 0xd9, 0x8e, 0x55, 0x74, 0x7c, 0xe1, 0x36, 0x2f, 0xb2, 0x23, 0x51, 0xf0, 0x24,
      0x87, 0x2,  0x0,  0x0,  0x75, 0xa0, 0x12, 0x0,  0x9,  0x7b, 0x85, 0xfb, 0x90, 0x1a, 0xfc, 0x3e, 0x8a, 0x2c, 0x3,
      0x0,  0xb,  0xc,  0xc1, 0xdb, 0xbf, 0x21, 0x20, 0x48, 0x4a, 0xfb, 0xf2, 0xd0, 0x24, 0xfc, 0x11, 0x0,  0x0,  0x24,
      0xd9, 0x18, 0x0,  0x0,  0x1e, 0xec, 0xb,  0x10, 0x19, 0xfb, 0x1,  0xbd, 0x24, 0x57, 0x13, 0x6e, 0x4d, 0x27, 0x0,
      0x0,  0x7e, 0x3f, 0x23, 0x5d, 0xe7, 0x25, 0xd6, 0x12, 0x0,  0x14, 0xa7, 0xce, 0xa1, 0x4b, 0x14, 0x86, 0x14, 0xa5,
      0x92, 0x5c, 0xdd, 0x3,  0x5b, 0xb9, 0x9,  0x14, 0x4e, 0x29, 0x85, 0x31, 0x24, 0xc3, 0x16, 0x0,  0x1,  0x3,  0x0,
      0x15, 0x54, 0x15, 0x96, 0x9c, 0x90, 0xe0, 0xd5, 0x94, 0x50, 0xa1, 0x44, 0xd8, 0xef, 0x5a, 0x45, 0xab, 0xb9, 0xa9,
      0x63, 0x2,  0xad, 0x7,  0x23, 0x46, 0x6c, 0x25, 0xb9, 0xb,  0x14, 0x0,  0x6,  0x40, 0x6c, 0x69, 0xb9, 0x53, 0x53,
      0x0,  0xf,  0xe1, 0x39, 0x4c, 0xd7, 0x5,  0x18, 0x9e, 0x77, 0x8e, 0x50, 0x4,  0xdb, 0x9d, 0xe3, 0xa0, 0x0,  0xc,
      0x19, 0x7e, 0x84, 0xb2, 0x1d, 0xa9, 0x26, 0x8f, 0x2a, 0x4a, 0x1c, 0xdf};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7f, 0xdf, 0x62, 0xed, 0x94, 0xba, 0xf5};
  uint8_t bytesprops1[] = {0x9e, 0x13, 0xd6, 0x4c, 0x49, 0xa0, 0xfd, 0xc3,
                           0xa4, 0x7d, 0x74, 0xb6, 0x6,  0xc0, 0xbf, 0x67};
  uint8_t bytesprops2[] = {0xf7, 0xb2, 0x2c, 0x2b, 0x1, 0xec, 0x58, 0x9c, 0xaa, 0xb3, 0x46};
  uint8_t bytesprops3[] = {0x57, 0x21, 0x9a, 0xa9, 0x12, 0x7c, 0x19, 0x9e, 0x10, 0x23, 0x35, 0x9d, 0xf6, 0x36, 0xeb,
                           0xee, 0xc0, 0x27, 0xc,  0x5f, 0xdd, 0x95, 0x81, 0x90, 0xbd, 0x2,  0x90, 0xf2, 0x8d, 0x10};
  uint8_t bytesprops4[] = {0xa5, 0x11, 0x88, 0xef, 0x7d, 0x27, 0x20, 0x83, 0xb8, 0x32, 0xfd,
                           0x49, 0xd9, 0x8e, 0x55, 0x74, 0x7c, 0xe1, 0x36, 0x2f, 0xb2};
  uint8_t bytesprops5[] = {0x7b, 0x85, 0xfb, 0x90, 0x1a, 0xfc, 0x3e, 0x8a, 0x2c};
  uint8_t bytesprops6[] = {0xc, 0xc1, 0xdb, 0xbf, 0x21, 0x20, 0x48, 0x4a, 0xfb, 0xf2, 0xd0};
  uint8_t bytesprops7[] = {0xa7, 0xce, 0xa1, 0x4b, 0x14, 0x86, 0x14, 0xa5, 0x92, 0x5c,
                           0xdd, 0x3,  0x5b, 0xb9, 0x9,  0x14, 0x4e, 0x29, 0x85, 0x31};
  uint8_t bytesprops8[] = {0x3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {16, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25298}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 27525}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 249}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20976}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30112}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {9, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 252}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9433}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7916}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 251}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 28237}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 32319}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24039}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18028}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 185}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x40, 0x6c, 0x69, 0xb9, 0x53, 0x53};
  lwmqtt_string_t will_topic = {6, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xe1, 0x39, 0x4c, 0xd7, 0x5,  0x18, 0x9e, 0x77,
                                  0x8e, 0x50, 0x4,  0xdb, 0x9d, 0xe3, 0xa0};
  lwmqtt_string_t will_payload = {15, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 7971;
  uint8_t client_id_bytes[] = {0x54, 0x15, 0x96, 0x9c, 0x90, 0xe0, 0xd5, 0x94, 0x50, 0xa1, 0x44,
                               0xd8, 0xef, 0x5a, 0x45, 0xab, 0xb9, 0xa9, 0x63, 0x2,  0xad};
  lwmqtt_string_t client_id = {21, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0x19, 0x7e, 0x84, 0xb2, 0x1d, 0xa9, 0x26, 0x8f, 0x2a, 0x4a, 0x1c, 0xdf};
  lwmqtt_string_t password = {12, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\231\"\140\184\150\129\176\136", _password = Just "<", _lastWill = Just (LastWill
// {_willRetain = False, _willQoS = QoS1, _willTopic = "\228\186\150\165\217\210\189", _willMsg =
// "\240\DC2\156\154E\165|\209S\189p\140", _willProps = [PropMaximumPacketSize 21557,PropTopicAlias
// 29303,PropUserProperty "`\DC2\163\247*\242>\239"
// "``(\241\182\199\228\185\150\184\231=\248A\NAK\179\a\151F\249",PropSubscriptionIdentifier 18]}), _cleanSession =
// True, _keepAlive = 14805, _connID = "\224\153\138 P\CAN\176\DLEz2\177\169\171\247\192rU\190\&9\189\196\149o?t",
// _properties = [PropMessageExpiryInterval 19004,PropSubscriptionIdentifierAvailable 55,PropTopicAliasMaximum
// 26303,PropTopicAlias 17188,PropResponseTopic "\ty}\232\212\t\DC2",PropSessionExpiryInterval
// 15240,PropResponseInformation
// "\157\NULA\206\252\149\US>:\220\132Yq\255\DC1\207\&8\243\SOH\EM\US\186\206\244R",PropServerKeepAlive
// 29200,PropMaximumQoS 169,PropTopicAlias 7816,PropMaximumPacketSize 17164,PropResponseInformation
// ":\SYN\208\206\EOT",PropPayloadFormatIndicator 5,PropMessageExpiryInterval 19457,PropReasonString
// "\SONXs\180Ob!\146\155\178~\137",PropCorrelationData "\EMjP\179,+,\144\241\161zl\244",PropTopicAliasMaximum
// 3531,PropRetainAvailable 31,PropWildcardSubscriptionAvailable 118,PropRetainAvailable 181,PropAuthenticationData
// "eSSMz\235J\186\NAKE8>;\241",PropResponseInformation
// "f[\201\SO\DLEvP\181\236\142\&5%\b\201\255^'\136q{",PropContentType "",PropReasonString
// "\ACK\150A\215\157\218\133",PropRequestResponseInformation 2,PropCorrelationData "=\184\178",PropServerKeepAlive
// 22022,PropPayloadFormatIndicator 214,PropAssignedClientIdentifier "5#\201\SUB"]}
TEST(Connect5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x10, 0xbd, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xce, 0x39, 0xd5, 0xc6, 0x1,  0x2,  0x0,  0x0,  0x4a,
      0x3c, 0x29, 0x37, 0x22, 0x66, 0xbf, 0x23, 0x43, 0x24, 0x8,  0x0,  0x7,  0x9,  0x79, 0x7d, 0xe8, 0xd4, 0x9,  0x12,
      0x11, 0x0,  0x0,  0x3b, 0x88, 0x1a, 0x0,  0x19, 0x9d, 0x0,  0x41, 0xce, 0xfc, 0x95, 0x1f, 0x3e, 0x3a, 0xdc, 0x84,
      0x59, 0x71, 0xff, 0x11, 0xcf, 0x38, 0xf3, 0x1,  0x19, 0x1f, 0xba, 0xce, 0xf4, 0x52, 0x13, 0x72, 0x10, 0x24, 0xa9,
      0x23, 0x1e, 0x88, 0x27, 0x0,  0x0,  0x43, 0xc,  0x1a, 0x0,  0x5,  0x3a, 0x16, 0xd0, 0xce, 0x4,  0x1,  0x5,  0x2,
      0x0,  0x0,  0x4c, 0x1,  0x1f, 0x0,  0xd,  0xe,  0x4e, 0x58, 0x73, 0xb4, 0x4f, 0x62, 0x21, 0x92, 0x9b, 0xb2, 0x7e,
      0x89, 0x9,  0x0,  0xd,  0x19, 0x6a, 0x50, 0xb3, 0x2c, 0x2b, 0x2c, 0x90, 0xf1, 0xa1, 0x7a, 0x6c, 0xf4, 0x22, 0xd,
      0xcb, 0x25, 0x1f, 0x28, 0x76, 0x25, 0xb5, 0x16, 0x0,  0xe,  0x65, 0x53, 0x53, 0x4d, 0x7a, 0xeb, 0x4a, 0xba, 0x15,
      0x45, 0x38, 0x3e, 0x3b, 0xf1, 0x1a, 0x0,  0x14, 0x66, 0x5b, 0xc9, 0xe,  0x10, 0x76, 0x50, 0xb5, 0xec, 0x8e, 0x35,
      0x25, 0x8,  0xc9, 0xff, 0x5e, 0x27, 0x88, 0x71, 0x7b, 0x3,  0x0,  0x0,  0x1f, 0x0,  0x7,  0x6,  0x96, 0x41, 0xd7,
      0x9d, 0xda, 0x85, 0x19, 0x2,  0x9,  0x0,  0x3,  0x3d, 0xb8, 0xb2, 0x13, 0x56, 0x6,  0x1,  0xd6, 0x12, 0x0,  0x4,
      0x35, 0x23, 0xc9, 0x1a, 0x0,  0x19, 0xe0, 0x99, 0x8a, 0x20, 0x50, 0x18, 0xb0, 0x10, 0x7a, 0x32, 0xb1, 0xa9, 0xab,
      0xf7, 0xc0, 0x72, 0x55, 0xbe, 0x39, 0xbd, 0xc4, 0x95, 0x6f, 0x3f, 0x74, 0x2b, 0x27, 0x0,  0x0,  0x54, 0x35, 0x23,
      0x72, 0x77, 0x26, 0x0,  0x8,  0x60, 0x12, 0xa3, 0xf7, 0x2a, 0xf2, 0x3e, 0xef, 0x0,  0x14, 0x60, 0x60, 0x28, 0xf1,
      0xb6, 0xc7, 0xe4, 0xb9, 0x96, 0xb8, 0xe7, 0x3d, 0xf8, 0x41, 0x15, 0xb3, 0x7,  0x97, 0x46, 0xf9, 0xb,  0x12, 0x0,
      0x7,  0xe4, 0xba, 0x96, 0xa5, 0xd9, 0xd2, 0xbd, 0x0,  0xc,  0xf0, 0x12, 0x9c, 0x9a, 0x45, 0xa5, 0x7c, 0xd1, 0x53,
      0xbd, 0x70, 0x8c, 0x0,  0x8,  0xe7, 0x22, 0x8c, 0xb8, 0x96, 0x81, 0xb0, 0x88, 0x0,  0x1,  0x3c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9, 0x79, 0x7d, 0xe8, 0xd4, 0x9, 0x12};
  uint8_t bytesprops1[] = {0x9d, 0x0,  0x41, 0xce, 0xfc, 0x95, 0x1f, 0x3e, 0x3a, 0xdc, 0x84, 0x59, 0x71,
                           0xff, 0x11, 0xcf, 0x38, 0xf3, 0x1,  0x19, 0x1f, 0xba, 0xce, 0xf4, 0x52};
  uint8_t bytesprops2[] = {0x3a, 0x16, 0xd0, 0xce, 0x4};
  uint8_t bytesprops3[] = {0xe, 0x4e, 0x58, 0x73, 0xb4, 0x4f, 0x62, 0x21, 0x92, 0x9b, 0xb2, 0x7e, 0x89};
  uint8_t bytesprops4[] = {0x19, 0x6a, 0x50, 0xb3, 0x2c, 0x2b, 0x2c, 0x90, 0xf1, 0xa1, 0x7a, 0x6c, 0xf4};
  uint8_t bytesprops5[] = {0x65, 0x53, 0x53, 0x4d, 0x7a, 0xeb, 0x4a, 0xba, 0x15, 0x45, 0x38, 0x3e, 0x3b, 0xf1};
  uint8_t bytesprops6[] = {0x66, 0x5b, 0xc9, 0xe,  0x10, 0x76, 0x50, 0xb5, 0xec, 0x8e,
                           0x35, 0x25, 0x8,  0xc9, 0xff, 0x5e, 0x27, 0x88, 0x71, 0x7b};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops8[] = {0x6, 0x96, 0x41, 0xd7, 0x9d, 0xda, 0x85};
  uint8_t bytesprops9[] = {0x3d, 0xb8, 0xb2};
  uint8_t bytesprops10[] = {0x35, 0x23, 0xc9, 0x1a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19004}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26303}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17188}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15240}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29200}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7816}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17164}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19457}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {13, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3531}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 118}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 181}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22022}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops1[] = {0x60, 0x60, 0x28, 0xf1, 0xb6, 0xc7, 0xe4, 0xb9, 0x96, 0xb8,
                               0xe7, 0x3d, 0xf8, 0x41, 0x15, 0xb3, 0x7,  0x97, 0x46, 0xf9};
  uint8_t byteswillprops0[] = {0x60, 0x12, 0xa3, 0xf7, 0x2a, 0xf2, 0x3e, 0xef};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21557}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29303}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {8, (char*)&byteswillprops0}, .v = {20, (char*)&byteswillprops1}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
  };

  lwmqtt_properties_t willprops = {4, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xe4, 0xba, 0x96, 0xa5, 0xd9, 0xd2, 0xbd};
  lwmqtt_string_t will_topic = {7, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xf0, 0x12, 0x9c, 0x9a, 0x45, 0xa5, 0x7c, 0xd1, 0x53, 0xbd, 0x70, 0x8c};
  lwmqtt_string_t will_payload = {12, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14805;
  uint8_t client_id_bytes[] = {0xe0, 0x99, 0x8a, 0x20, 0x50, 0x18, 0xb0, 0x10, 0x7a, 0x32, 0xb1, 0xa9, 0xab,
                               0xf7, 0xc0, 0x72, 0x55, 0xbe, 0x39, 0xbd, 0xc4, 0x95, 0x6f, 0x3f, 0x74};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xe7, 0x22, 0x8c, 0xb8, 0x96, 0x81, 0xb0, 0x88};
  lwmqtt_string_t username = {8, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x3c};
  lwmqtt_string_t password = {1, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "I\DC1a\EOT\217\152\&5\206\145\132\232z\157", _password = Just
// "\215\235\149i\140u\SUB\DELp\137\141q?\246[g\200\149e", _lastWill = Just (LastWill {_willRetain = False, _willQoS =
// QoS2, _willTopic = "Gn\r k\174]\212!nN\176\217\185h\211*\166\t\160\169\v\168q\174>z", _willMsg = "\NUL\247",
// _willProps = [PropAuthenticationData
// "\234-\ACKE\174\EM\246\&2H\248\243M\184\246d\185lH\172>\r",PropSharedSubscriptionAvailable 77,PropReasonString
// "\236c\164K\EOT.\172\212\ETB\SI=;\a\182\\\DC4S@[\DLE\249\199"]}), _cleanSession = False, _keepAlive = 487, _connID =
// "\r\196\187Nr\226\142\198\223\237\224\191", _properties = [PropWillDelayInterval 15241,PropResponseTopic
// "",PropRetainAvailable 19,PropRequestResponseInformation 209,PropMessageExpiryInterval
// 20291,PropRequestProblemInformation 234,PropAuthenticationData
// "h\194b\194/\EOTt\222\132:\184P\129(\n\ETB\204\153=\227\199",PropCorrelationData
// "\166&\246r\226\165W",PropRequestResponseInformation 23,PropSubscriptionIdentifierAvailable 8,PropReasonString
// "",PropSharedSubscriptionAvailable 201,PropContentType
// "qE^\SYNX\217\210\221V\213o\139B\GS\154'k\247\197\224P_&\249D\177[",PropTopicAlias 31279,PropRetainAvailable
// 96,PropAuthenticationMethod "m\189\149\&0\137\208",PropMessageExpiryInterval 587,PropUserProperty
// "7\248O\161+\b\132\138qy\134\163\190+\136\210\166\211\\)or\175\128/>)"
// "\158@\161\145\186\180\NAK\170\233X}\161}\r\DLE\232fW1\250t\170H",PropContentType "\141\179\ESC\210@\216<\220c[t
// \145m\178`T[Y\t\147+O\249\196\139\ESC\138",PropAuthenticationMethod "\249\253|\205H"]}
TEST(Connect5QCTest, Encode19) {
  uint8_t pkt[] = {
      0x10, 0xe0, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x1,  0xe7, 0xcd, 0x1,  0x18, 0x0,  0x0,  0x3b,
      0x89, 0x8,  0x0,  0x0,  0x25, 0x13, 0x19, 0xd1, 0x2,  0x0,  0x0,  0x4f, 0x43, 0x17, 0xea, 0x16, 0x0,  0x15, 0x68,
      0xc2, 0x62, 0xc2, 0x2f, 0x4,  0x74, 0xde, 0x84, 0x3a, 0xb8, 0x50, 0x81, 0x28, 0xa,  0x17, 0xcc, 0x99, 0x3d, 0xe3,
      0xc7, 0x9,  0x0,  0x7,  0xa6, 0x26, 0xf6, 0x72, 0xe2, 0xa5, 0x57, 0x19, 0x17, 0x29, 0x8,  0x1f, 0x0,  0x0,  0x2a,
      0xc9, 0x3,  0x0,  0x1b, 0x71, 0x45, 0x5e, 0x16, 0x58, 0xd9, 0xd2, 0xdd, 0x56, 0xd5, 0x6f, 0x8b, 0x42, 0x1d, 0x9a,
      0x27, 0x6b, 0xf7, 0xc5, 0xe0, 0x50, 0x5f, 0x26, 0xf9, 0x44, 0xb1, 0x5b, 0x23, 0x7a, 0x2f, 0x25, 0x60, 0x15, 0x0,
      0x6,  0x6d, 0xbd, 0x95, 0x30, 0x89, 0xd0, 0x2,  0x0,  0x0,  0x2,  0x4b, 0x26, 0x0,  0x1b, 0x37, 0xf8, 0x4f, 0xa1,
      0x2b, 0x8,  0x84, 0x8a, 0x71, 0x79, 0x86, 0xa3, 0xbe, 0x2b, 0x88, 0xd2, 0xa6, 0xd3, 0x5c, 0x29, 0x6f, 0x72, 0xaf,
      0x80, 0x2f, 0x3e, 0x29, 0x0,  0x17, 0x9e, 0x40, 0xa1, 0x91, 0xba, 0xb4, 0x15, 0xaa, 0xe9, 0x58, 0x7d, 0xa1, 0x7d,
      0xd,  0x10, 0xe8, 0x66, 0x57, 0x31, 0xfa, 0x74, 0xaa, 0x48, 0x3,  0x0,  0x1c, 0x8d, 0xb3, 0x1b, 0xd2, 0x40, 0xd8,
      0x3c, 0xdc, 0x63, 0x5b, 0x74, 0x20, 0x91, 0x6d, 0xb2, 0x60, 0x54, 0x5b, 0x59, 0x9,  0x93, 0x2b, 0x4f, 0xf9, 0xc4,
      0x8b, 0x1b, 0x8a, 0x15, 0x0,  0x5,  0xf9, 0xfd, 0x7c, 0xcd, 0x48, 0x0,  0xc,  0xd,  0xc4, 0xbb, 0x4e, 0x72, 0xe2,
      0x8e, 0xc6, 0xdf, 0xed, 0xe0, 0xbf, 0x33, 0x16, 0x0,  0x15, 0xea, 0x2d, 0x6,  0x45, 0xae, 0x19, 0xf6, 0x32, 0x48,
      0xf8, 0xf3, 0x4d, 0xb8, 0xf6, 0x64, 0xb9, 0x6c, 0x48, 0xac, 0x3e, 0xd,  0x2a, 0x4d, 0x1f, 0x0,  0x16, 0xec, 0x63,
      0xa4, 0x4b, 0x4,  0x2e, 0xac, 0xd4, 0x17, 0xf,  0x3d, 0x3b, 0x7,  0xb6, 0x5c, 0x14, 0x53, 0x40, 0x5b, 0x10, 0xf9,
      0xc7, 0x0,  0x1b, 0x47, 0x6e, 0xd,  0x20, 0x6b, 0xae, 0x5d, 0xd4, 0x21, 0x6e, 0x4e, 0xb0, 0xd9, 0xb9, 0x68, 0xd3,
      0x2a, 0xa6, 0x9,  0xa0, 0xa9, 0xb,  0xa8, 0x71, 0xae, 0x3e, 0x7a, 0x0,  0x2,  0x0,  0xf7, 0x0,  0xd,  0x49, 0x11,
      0x61, 0x4,  0xd9, 0x98, 0x35, 0xce, 0x91, 0x84, 0xe8, 0x7a, 0x9d, 0x0,  0x13, 0xd7, 0xeb, 0x95, 0x69, 0x8c, 0x75,
      0x1a, 0x7f, 0x70, 0x89, 0x8d, 0x71, 0x3f, 0xf6, 0x5b, 0x67, 0xc8, 0x95, 0x65};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x68, 0xc2, 0x62, 0xc2, 0x2f, 0x4,  0x74, 0xde, 0x84, 0x3a, 0xb8,
                           0x50, 0x81, 0x28, 0xa,  0x17, 0xcc, 0x99, 0x3d, 0xe3, 0xc7};
  uint8_t bytesprops2[] = {0xa6, 0x26, 0xf6, 0x72, 0xe2, 0xa5, 0x57};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x71, 0x45, 0x5e, 0x16, 0x58, 0xd9, 0xd2, 0xdd, 0x56, 0xd5, 0x6f, 0x8b, 0x42, 0x1d,
                           0x9a, 0x27, 0x6b, 0xf7, 0xc5, 0xe0, 0x50, 0x5f, 0x26, 0xf9, 0x44, 0xb1, 0x5b};
  uint8_t bytesprops5[] = {0x6d, 0xbd, 0x95, 0x30, 0x89, 0xd0};
  uint8_t bytesprops7[] = {0x9e, 0x40, 0xa1, 0x91, 0xba, 0xb4, 0x15, 0xaa, 0xe9, 0x58, 0x7d, 0xa1,
                           0x7d, 0xd,  0x10, 0xe8, 0x66, 0x57, 0x31, 0xfa, 0x74, 0xaa, 0x48};
  uint8_t bytesprops6[] = {0x37, 0xf8, 0x4f, 0xa1, 0x2b, 0x8,  0x84, 0x8a, 0x71, 0x79, 0x86, 0xa3, 0xbe, 0x2b,
                           0x88, 0xd2, 0xa6, 0xd3, 0x5c, 0x29, 0x6f, 0x72, 0xaf, 0x80, 0x2f, 0x3e, 0x29};
  uint8_t bytesprops8[] = {0x8d, 0xb3, 0x1b, 0xd2, 0x40, 0xd8, 0x3c, 0xdc, 0x63, 0x5b, 0x74, 0x20, 0x91, 0x6d,
                           0xb2, 0x60, 0x54, 0x5b, 0x59, 0x9,  0x93, 0x2b, 0x4f, 0xf9, 0xc4, 0x8b, 0x1b, 0x8a};
  uint8_t bytesprops9[] = {0xf9, 0xfd, 0x7c, 0xcd, 0x48};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 15241}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20291}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 234}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31279}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 587}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops6}, .v = {23, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xea, 0x2d, 0x6,  0x45, 0xae, 0x19, 0xf6, 0x32, 0x48, 0xf8, 0xf3,
                               0x4d, 0xb8, 0xf6, 0x64, 0xb9, 0x6c, 0x48, 0xac, 0x3e, 0xd};
  uint8_t byteswillprops1[] = {0xec, 0x63, 0xa4, 0x4b, 0x4,  0x2e, 0xac, 0xd4, 0x17, 0xf,  0x3d,
                               0x3b, 0x7,  0xb6, 0x5c, 0x14, 0x53, 0x40, 0x5b, 0x10, 0xf9, 0xc7};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 77}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&byteswillprops1}}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x47, 0x6e, 0xd,  0x20, 0x6b, 0xae, 0x5d, 0xd4, 0x21, 0x6e, 0x4e, 0xb0, 0xd9, 0xb9,
                                0x68, 0xd3, 0x2a, 0xa6, 0x9,  0xa0, 0xa9, 0xb,  0xa8, 0x71, 0xae, 0x3e, 0x7a};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x0, 0xf7};
  lwmqtt_string_t will_payload = {2, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 487;
  uint8_t client_id_bytes[] = {0xd, 0xc4, 0xbb, 0x4e, 0x72, 0xe2, 0x8e, 0xc6, 0xdf, 0xed, 0xe0, 0xbf};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x49, 0x11, 0x61, 0x4, 0xd9, 0x98, 0x35, 0xce, 0x91, 0x84, 0xe8, 0x7a, 0x9d};
  lwmqtt_string_t username = {13, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xd7, 0xeb, 0x95, 0x69, 0x8c, 0x75, 0x1a, 0x7f, 0x70, 0x89,
                              0x8d, 0x71, 0x3f, 0xf6, 0x5b, 0x67, 0xc8, 0x95, 0x65};
  lwmqtt_string_t password = {19, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\167Vv", _password = Just "\USefMcY\245s", _lastWill = Just (LastWill {_willRetain
// = False, _willQoS = QoS2, _willTopic =
// "\134q\161\236\217\\\238\&3z\146\f\186\198\211u\250_\r\194\141t~\168w\225t\171\135i\229", _willMsg =
// "\164\252\EOT\203\197\166\171B\177\145\DC4\190\DC3\205\NAK\143\157\SUB\177\248\NAK\129\222\DEL>0H", _willProps =
// [PropServerReference "d\144,t\129\FS",PropSubscriptionIdentifierAvailable 129,PropAuthenticationMethod
// "\199\150\255u",PropMessageExpiryInterval 3290,PropRetainAvailable 208,PropUserProperty
// "\192\236\249h\132\EOTN\164\247\240Q\SOj\SYN{\\\220\&7f\176\246\ETX [^\149i" "_\208\140\255 EQ\153P"]}),
// _cleanSession = False, _keepAlive = 176, _connID =
// "\164\181\166\128r\129\SUB\184rUbzJ\177WIU+\158\DEL\SOH\NAK\164\169", _properties = [PropPayloadFormatIndicator
// 25,PropRequestProblemInformation 231,PropServerKeepAlive 16912,PropWillDelayInterval 27960,PropAuthenticationData
// "\187\206F\f\203\233\146\&1\ACK E\190\232$?\203$\176\206\148",PropAuthenticationData
// "s\128\138\228\251",PropCorrelationData "Bg\160\212q\248:uy\139+-\159{\252\251",PropServerReference
// "k\241\194cF\177\SI\222\EOT\233\241\134\138\142Ql\DC3\223\169\FS@\247\239\226\196\200\RSm",PropMaximumPacketSize
// 28292,PropSharedSubscriptionAvailable 111,PropWildcardSubscriptionAvailable 255,PropSubscriptionIdentifier
// 23,PropAuthenticationData "NH\"\134r\181{.\DC2\205\SI\SI\GS\v\t;\233\146\EM\180\193\DC4X\SI\NULg",PropTopicAlias
// 21077]}
TEST(Connect5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x10, 0xbd, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x0,  0xb0, 0x88, 0x1,  0x1,  0x19, 0x17, 0xe7,
      0x13, 0x42, 0x10, 0x18, 0x0,  0x0,  0x6d, 0x38, 0x16, 0x0,  0x14, 0xbb, 0xce, 0x46, 0xc,  0xcb, 0xe9, 0x92, 0x31,
      0x6,  0x20, 0x45, 0xbe, 0xe8, 0x24, 0x3f, 0xcb, 0x24, 0xb0, 0xce, 0x94, 0x16, 0x0,  0x5,  0x73, 0x80, 0x8a, 0xe4,
      0xfb, 0x9,  0x0,  0x10, 0x42, 0x67, 0xa0, 0xd4, 0x71, 0xf8, 0x3a, 0x75, 0x79, 0x8b, 0x2b, 0x2d, 0x9f, 0x7b, 0xfc,
      0xfb, 0x1c, 0x0,  0x1c, 0x6b, 0xf1, 0xc2, 0x63, 0x46, 0xb1, 0xf,  0xde, 0x4,  0xe9, 0xf1, 0x86, 0x8a, 0x8e, 0x51,
      0x6c, 0x13, 0xdf, 0xa9, 0x1c, 0x40, 0xf7, 0xef, 0xe2, 0xc4, 0xc8, 0x1e, 0x6d, 0x27, 0x0,  0x0,  0x6e, 0x84, 0x2a,
      0x6f, 0x28, 0xff, 0xb,  0x17, 0x16, 0x0,  0x1a, 0x4e, 0x48, 0x22, 0x86, 0x72, 0xb5, 0x7b, 0x2e, 0x12, 0xcd, 0xf,
      0xf,  0x1d, 0xb,  0x9,  0x3b, 0xe9, 0x92, 0x19, 0xb4, 0xc1, 0x14, 0x58, 0xf,  0x0,  0x67, 0x23, 0x52, 0x55, 0x0,
      0x18, 0xa4, 0xb5, 0xa6, 0x80, 0x72, 0x81, 0x1a, 0xb8, 0x72, 0x55, 0x62, 0x7a, 0x4a, 0xb1, 0x57, 0x49, 0x55, 0x2b,
      0x9e, 0x7f, 0x1,  0x15, 0xa4, 0xa9, 0x42, 0x1c, 0x0,  0x6,  0x64, 0x90, 0x2c, 0x74, 0x81, 0x1c, 0x29, 0x81, 0x15,
      0x0,  0x4,  0xc7, 0x96, 0xff, 0x75, 0x2,  0x0,  0x0,  0xc,  0xda, 0x25, 0xd0, 0x26, 0x0,  0x1b, 0xc0, 0xec, 0xf9,
      0x68, 0x84, 0x4,  0x4e, 0xa4, 0xf7, 0xf0, 0x51, 0xe,  0x6a, 0x16, 0x7b, 0x5c, 0xdc, 0x37, 0x66, 0xb0, 0xf6, 0x3,
      0x20, 0x5b, 0x5e, 0x95, 0x69, 0x0,  0x9,  0x5f, 0xd0, 0x8c, 0xff, 0x20, 0x45, 0x51, 0x99, 0x50, 0x0,  0x1e, 0x86,
      0x71, 0xa1, 0xec, 0xd9, 0x5c, 0xee, 0x33, 0x7a, 0x92, 0xc,  0xba, 0xc6, 0xd3, 0x75, 0xfa, 0x5f, 0xd,  0xc2, 0x8d,
      0x74, 0x7e, 0xa8, 0x77, 0xe1, 0x74, 0xab, 0x87, 0x69, 0xe5, 0x0,  0x1b, 0xa4, 0xfc, 0x4,  0xcb, 0xc5, 0xa6, 0xab,
      0x42, 0xb1, 0x91, 0x14, 0xbe, 0x13, 0xcd, 0x15, 0x8f, 0x9d, 0x1a, 0xb1, 0xf8, 0x15, 0x81, 0xde, 0x7f, 0x3e, 0x30,
      0x48, 0x0,  0x3,  0xa7, 0x56, 0x76, 0x0,  0x8,  0x1f, 0x65, 0x66, 0x4d, 0x63, 0x59, 0xf5, 0x73};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbb, 0xce, 0x46, 0xc,  0xcb, 0xe9, 0x92, 0x31, 0x6,  0x20,
                           0x45, 0xbe, 0xe8, 0x24, 0x3f, 0xcb, 0x24, 0xb0, 0xce, 0x94};
  uint8_t bytesprops1[] = {0x73, 0x80, 0x8a, 0xe4, 0xfb};
  uint8_t bytesprops2[] = {0x42, 0x67, 0xa0, 0xd4, 0x71, 0xf8, 0x3a, 0x75,
                           0x79, 0x8b, 0x2b, 0x2d, 0x9f, 0x7b, 0xfc, 0xfb};
  uint8_t bytesprops3[] = {0x6b, 0xf1, 0xc2, 0x63, 0x46, 0xb1, 0xf,  0xde, 0x4,  0xe9, 0xf1, 0x86, 0x8a, 0x8e,
                           0x51, 0x6c, 0x13, 0xdf, 0xa9, 0x1c, 0x40, 0xf7, 0xef, 0xe2, 0xc4, 0xc8, 0x1e, 0x6d};
  uint8_t bytesprops4[] = {0x4e, 0x48, 0x22, 0x86, 0x72, 0xb5, 0x7b, 0x2e, 0x12, 0xcd, 0xf, 0xf, 0x1d,
                           0xb,  0x9,  0x3b, 0xe9, 0x92, 0x19, 0xb4, 0xc1, 0x14, 0x58, 0xf, 0x0, 0x67};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16912}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27960}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28292}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 111}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 255}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21077}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x64, 0x90, 0x2c, 0x74, 0x81, 0x1c};
  uint8_t byteswillprops1[] = {0xc7, 0x96, 0xff, 0x75};
  uint8_t byteswillprops3[] = {0x5f, 0xd0, 0x8c, 0xff, 0x20, 0x45, 0x51, 0x99, 0x50};
  uint8_t byteswillprops2[] = {0xc0, 0xec, 0xf9, 0x68, 0x84, 0x4,  0x4e, 0xa4, 0xf7, 0xf0, 0x51, 0xe,  0x6a, 0x16,
                               0x7b, 0x5c, 0xdc, 0x37, 0x66, 0xb0, 0xf6, 0x3,  0x20, 0x5b, 0x5e, 0x95, 0x69};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3290}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {27, (char*)&byteswillprops2}, .v = {9, (char*)&byteswillprops3}}}},
  };

  lwmqtt_properties_t willprops = {6, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x86, 0x71, 0xa1, 0xec, 0xd9, 0x5c, 0xee, 0x33, 0x7a, 0x92,
                                0xc,  0xba, 0xc6, 0xd3, 0x75, 0xfa, 0x5f, 0xd,  0xc2, 0x8d,
                                0x74, 0x7e, 0xa8, 0x77, 0xe1, 0x74, 0xab, 0x87, 0x69, 0xe5};
  lwmqtt_string_t will_topic = {30, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xa4, 0xfc, 0x4,  0xcb, 0xc5, 0xa6, 0xab, 0x42, 0xb1, 0x91, 0x14, 0xbe, 0x13, 0xcd,
                                  0x15, 0x8f, 0x9d, 0x1a, 0xb1, 0xf8, 0x15, 0x81, 0xde, 0x7f, 0x3e, 0x30, 0x48};
  lwmqtt_string_t will_payload = {27, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 176;
  uint8_t client_id_bytes[] = {0xa4, 0xb5, 0xa6, 0x80, 0x72, 0x81, 0x1a, 0xb8, 0x72, 0x55, 0x62, 0x7a,
                               0x4a, 0xb1, 0x57, 0x49, 0x55, 0x2b, 0x9e, 0x7f, 0x1,  0x15, 0xa4, 0xa9};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa7, 0x56, 0x76};
  lwmqtt_string_t username = {3, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x1f, 0x65, 0x66, 0x4d, 0x63, 0x59, 0xf5, 0x73};
  lwmqtt_string_t password = {8, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "g\164\GS\251\214\154t\217\140l\213\150&{\211\130", _password = Just
// "\187\ESC\201\164\156\195h\241\250v8\t\179\193\251[*\142", _lastWill = Nothing, _cleanSession = False, _keepAlive =
// 20540, _connID = "\255k\192]Rmr[\146o,\129", _properties = [PropRequestProblemInformation 43,PropServerReference
// "I\202\f=7\140\141\248\174\184G\141",PropTopicAliasMaximum 20363,PropUserProperty
// "c\182\241\t\ETXAs&\RS2\186\242\&3\STXQ\188\133/\a\138" "!\CAN\SUB\197h\176\168U",PropPayloadFormatIndicator
// 13,PropTopicAlias 10596,PropRetainAvailable 45,PropMessageExpiryInterval 2779,PropReceiveMaximum
// 32036,PropAuthenticationMethod "{",PropSessionExpiryInterval 22898,PropWillDelayInterval
// 3617,PropPayloadFormatIndicator 103]}
TEST(Connect5QCTest, Encode21) {
  uint8_t pkt[] = {0x10, 0x93, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc0, 0x50, 0x3c, 0x54, 0x17, 0x2b, 0x1c,
                   0x0,  0xc,  0x49, 0xca, 0xc,  0x3d, 0x37, 0x8c, 0x8d, 0xf8, 0xae, 0xb8, 0x47, 0x8d, 0x22, 0x4f, 0x8b,
                   0x26, 0x0,  0x14, 0x63, 0xb6, 0xf1, 0x9,  0x3,  0x41, 0x73, 0x26, 0x1e, 0x32, 0xba, 0xf2, 0x33, 0x2,
                   0x51, 0xbc, 0x85, 0x2f, 0x7,  0x8a, 0x0,  0x8,  0x21, 0x18, 0x1a, 0xc5, 0x68, 0xb0, 0xa8, 0x55, 0x1,
                   0xd,  0x23, 0x29, 0x64, 0x25, 0x2d, 0x2,  0x0,  0x0,  0xa,  0xdb, 0x21, 0x7d, 0x24, 0x15, 0x0,  0x1,
                   0x7b, 0x11, 0x0,  0x0,  0x59, 0x72, 0x18, 0x0,  0x0,  0xe,  0x21, 0x1,  0x67, 0x0,  0xc,  0xff, 0x6b,
                   0xc0, 0x5d, 0x52, 0x6d, 0x72, 0x5b, 0x92, 0x6f, 0x2c, 0x81, 0x0,  0x10, 0x67, 0xa4, 0x1d, 0xfb, 0xd6,
                   0x9a, 0x74, 0xd9, 0x8c, 0x6c, 0xd5, 0x96, 0x26, 0x7b, 0xd3, 0x82, 0x0,  0x12, 0xbb, 0x1b, 0xc9, 0xa4,
                   0x9c, 0xc3, 0x68, 0xf1, 0xfa, 0x76, 0x38, 0x9,  0xb3, 0xc1, 0xfb, 0x5b, 0x2a, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x49, 0xca, 0xc, 0x3d, 0x37, 0x8c, 0x8d, 0xf8, 0xae, 0xb8, 0x47, 0x8d};
  uint8_t bytesprops2[] = {0x21, 0x18, 0x1a, 0xc5, 0x68, 0xb0, 0xa8, 0x55};
  uint8_t bytesprops1[] = {0x63, 0xb6, 0xf1, 0x9, 0x3,  0x41, 0x73, 0x26, 0x1e, 0x32,
                           0xba, 0xf2, 0x33, 0x2, 0x51, 0xbc, 0x85, 0x2f, 0x7,  0x8a};
  uint8_t bytesprops3[] = {0x7b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20363}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {20, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10596}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 45}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2779}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32036}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22898}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3617}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 103}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 20540;
  uint8_t client_id_bytes[] = {0xff, 0x6b, 0xc0, 0x5d, 0x52, 0x6d, 0x72, 0x5b, 0x92, 0x6f, 0x2c, 0x81};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x67, 0xa4, 0x1d, 0xfb, 0xd6, 0x9a, 0x74, 0xd9,
                              0x8c, 0x6c, 0xd5, 0x96, 0x26, 0x7b, 0xd3, 0x82};
  lwmqtt_string_t username = {16, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xbb, 0x1b, 0xc9, 0xa4, 0x9c, 0xc3, 0x68, 0xf1, 0xfa,
                              0x76, 0x38, 0x9,  0xb3, 0xc1, 0xfb, 0x5b, 0x2a, 0x8e};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\130\153\246\DLEX\252\184\254\209\234/\229\190\&1k\ENQ\DC1\DEL\186", _password =
// Just "\152\245\222\230\235\f!z\243\&9\224P\250\231\236#\205V", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS1, _willTopic = "\199\149\CAND\190\238\210\161\204\&8C\192\168'\162\198\250\r\142\&0\250", _willMsg =
// "OUI", _willProps = [PropSessionExpiryInterval 8278,PropAssignedClientIdentifier
// "@\190",PropWildcardSubscriptionAvailable 168,PropContentType
// "W/\174\153\144}\206<\184}\ENQ\ETX\ESC@\226\141",PropMessageExpiryInterval 9621,PropMaximumQoS
// 66,PropPayloadFormatIndicator 142,PropReceiveMaximum 25445,PropReceiveMaximum 6056]}), _cleanSession = False,
// _keepAlive = 63, _connID = "\FS\196\a\216\236\229ts[;\209\141\182\141\154#\226\&7H.\199\195\f-\159\183\252c\235",
// _properties = [PropCorrelationData
// "\163\162\179\168\DC1\147\221t\164)z*+\155\135\217\199\STX\DLE\178=\\Q\227\252",PropReasonString
// "b\239\ESC\144",PropTopicAliasMaximum 10076,PropTopicAlias 11906,PropWillDelayInterval
// 20739,PropRequestResponseInformation 233,PropResponseTopic "E\210k\223\184\ETX\ESC",PropServerKeepAlive
// 22113,PropPayloadFormatIndicator 2,PropServerReference "\192`\251\133\252'C^N\f7%"]}
TEST(Connect5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x10, 0xec, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xcc, 0x0,  0x3f, 0x4e, 0x9,  0x0,  0x19, 0xa3, 0xa2,
      0xb3, 0xa8, 0x11, 0x93, 0xdd, 0x74, 0xa4, 0x29, 0x7a, 0x2a, 0x2b, 0x9b, 0x87, 0xd9, 0xc7, 0x2,  0x10, 0xb2, 0x3d,
      0x5c, 0x51, 0xe3, 0xfc, 0x1f, 0x0,  0x4,  0x62, 0xef, 0x1b, 0x90, 0x22, 0x27, 0x5c, 0x23, 0x2e, 0x82, 0x18, 0x0,
      0x0,  0x51, 0x3,  0x19, 0xe9, 0x8,  0x0,  0x7,  0x45, 0xd2, 0x6b, 0xdf, 0xb8, 0x3,  0x1b, 0x13, 0x56, 0x61, 0x1,
      0x2,  0x1c, 0x0,  0xc,  0xc0, 0x60, 0xfb, 0x85, 0xfc, 0x27, 0x43, 0x5e, 0x4e, 0xc,  0x37, 0x25, 0x0,  0x1d, 0x1c,
      0xc4, 0x7,  0xd8, 0xec, 0xe5, 0x74, 0x73, 0x5b, 0x3b, 0xd1, 0x8d, 0xb6, 0x8d, 0x9a, 0x23, 0xe2, 0x37, 0x48, 0x2e,
      0xc7, 0xc3, 0xc,  0x2d, 0x9f, 0xb7, 0xfc, 0x63, 0xeb, 0x2e, 0x11, 0x0,  0x0,  0x20, 0x56, 0x12, 0x0,  0x2,  0x40,
      0xbe, 0x28, 0xa8, 0x3,  0x0,  0x10, 0x57, 0x2f, 0xae, 0x99, 0x90, 0x7d, 0xce, 0x3c, 0xb8, 0x7d, 0x5,  0x3,  0x1b,
      0x40, 0xe2, 0x8d, 0x2,  0x0,  0x0,  0x25, 0x95, 0x24, 0x42, 0x1,  0x8e, 0x21, 0x63, 0x65, 0x21, 0x17, 0xa8, 0x0,
      0x15, 0xc7, 0x95, 0x18, 0x44, 0xbe, 0xee, 0xd2, 0xa1, 0xcc, 0x38, 0x43, 0xc0, 0xa8, 0x27, 0xa2, 0xc6, 0xfa, 0xd,
      0x8e, 0x30, 0xfa, 0x0,  0x3,  0x4f, 0x55, 0x49, 0x0,  0x13, 0x82, 0x99, 0xf6, 0x10, 0x58, 0xfc, 0xb8, 0xfe, 0xd1,
      0xea, 0x2f, 0xe5, 0xbe, 0x31, 0x6b, 0x5,  0x11, 0x7f, 0xba, 0x0,  0x12, 0x98, 0xf5, 0xde, 0xe6, 0xeb, 0xc,  0x21,
      0x7a, 0xf3, 0x39, 0xe0, 0x50, 0xfa, 0xe7, 0xec, 0x23, 0xcd, 0x56};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xa3, 0xa2, 0xb3, 0xa8, 0x11, 0x93, 0xdd, 0x74, 0xa4, 0x29, 0x7a, 0x2a, 0x2b,
                           0x9b, 0x87, 0xd9, 0xc7, 0x2,  0x10, 0xb2, 0x3d, 0x5c, 0x51, 0xe3, 0xfc};
  uint8_t bytesprops1[] = {0x62, 0xef, 0x1b, 0x90};
  uint8_t bytesprops2[] = {0x45, 0xd2, 0x6b, 0xdf, 0xb8, 0x3, 0x1b};
  uint8_t bytesprops3[] = {0xc0, 0x60, 0xfb, 0x85, 0xfc, 0x27, 0x43, 0x5e, 0x4e, 0xc, 0x37, 0x25};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10076}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 11906}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20739}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 233}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22113}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x40, 0xbe};
  uint8_t byteswillprops1[] = {0x57, 0x2f, 0xae, 0x99, 0x90, 0x7d, 0xce, 0x3c,
                               0xb8, 0x7d, 0x5,  0x3,  0x1b, 0x40, 0xe2, 0x8d};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8278}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {2, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9621}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 66}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25445}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6056}},
  };

  lwmqtt_properties_t willprops = {9, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xc7, 0x95, 0x18, 0x44, 0xbe, 0xee, 0xd2, 0xa1, 0xcc, 0x38, 0x43,
                                0xc0, 0xa8, 0x27, 0xa2, 0xc6, 0xfa, 0xd,  0x8e, 0x30, 0xfa};
  lwmqtt_string_t will_topic = {21, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x4f, 0x55, 0x49};
  lwmqtt_string_t will_payload = {3, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 63;
  uint8_t client_id_bytes[] = {0x1c, 0xc4, 0x7,  0xd8, 0xec, 0xe5, 0x74, 0x73, 0x5b, 0x3b, 0xd1, 0x8d, 0xb6, 0x8d, 0x9a,
                               0x23, 0xe2, 0x37, 0x48, 0x2e, 0xc7, 0xc3, 0xc,  0x2d, 0x9f, 0xb7, 0xfc, 0x63, 0xeb};
  lwmqtt_string_t client_id = {29, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x82, 0x99, 0xf6, 0x10, 0x58, 0xfc, 0xb8, 0xfe, 0xd1, 0xea,
                              0x2f, 0xe5, 0xbe, 0x31, 0x6b, 0x5,  0x11, 0x7f, 0xba};
  lwmqtt_string_t username = {19, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x98, 0xf5, 0xde, 0xe6, 0xeb, 0xc,  0x21, 0x7a, 0xf3,
                              0x39, 0xe0, 0x50, 0xfa, 0xe7, 0xec, 0x23, 0xcd, 0x56};
  lwmqtt_string_t password = {18, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just
// "\RS\167\162\&6\154\242\173\187\159\228M\149\143\133]\FS%\242\219\239\232\172\&7\STX\236\&3\229", _password = Just
// "\223\143\v\237\t/\227\FS\210\243\130\206\v\180\r", _lastWill = Just (LastWill {_willRetain = True, _willQoS = QoS0,
// _willTopic = " \SI\153\ACK\213(Df\150\253\194\171\158r\205\203cW", _willMsg =
// "\221\140d\205\238w\156m\218w\195\&4\189\&2\208\177", _willProps = [PropWillDelayInterval 7312,PropReceiveMaximum
// 683,PropMessageExpiryInterval 21868,PropSubscriptionIdentifierAvailable 164,PropSubscriptionIdentifierAvailable
// 180,PropSessionExpiryInterval 19875,PropSessionExpiryInterval 327,PropSubscriptionIdentifierAvailable
// 94,PropAuthenticationData
// "\196\NAK\154z\173\129\&9\236\149\223\221<\245}\EOT\n\253\241u\207i2\219",PropReceiveMaximum
// 22731,PropPayloadFormatIndicator 106,PropResponseInformation "x\181\225\ETB\251\221\201",PropTopicAlias 29475]}),
// _cleanSession = False, _keepAlive = 32455, _connID = "\199f\232=\172\DEL\148R>\167\\X;\235 \DC1\189\173\203WE\245",
// _properties = [PropContentType "\SO8\239\215\140\202\DC2\140?\NUL\234HpZ\219\194l7.",PropUserProperty
// "\224\179\143\232\132\227\SUB\ACKh\ETX\253a" "\208\237\&1\193\209g\194L$\236s\250V",PropMaximumQoS
// 18,PropResponseInformation
// "\186M\202\135\&2\195\246\247\156\146\223E\137\160\200t\DLE+m\168\STX;\SI",PropSessionExpiryInterval
// 2421,PropSessionExpiryInterval 4930,PropSubscriptionIdentifier 3,PropResponseTopic "\STX",PropRetainAvailable
// 150,PropPayloadFormatIndicator 121,PropAssignedClientIdentifier
// "\206\&3\146\188\170\207\&2Z\f\148\193\SUB\236",PropRequestProblemInformation 183,PropReceiveMaximum
// 31082,PropContentType "\217\190\177\228\166\r%(c\137\165\&2u]\218\189 s_\132\a\GS",PropResponseInformation
// "s\153\167\SOAm\231\&1\128\234\SYN\246",PropReasonString "iC\\\EM6",PropMessageExpiryInterval
// 16797,PropMaximumPacketSize 28375,PropAuthenticationData
// "A\201\DC2\204q\197\SUBfA\219\211U\174\242\rX\254\218D\ETX\188\153\198\228\ETB",PropSubscriptionIdentifier
// 11,PropRequestResponseInformation 189,PropReasonString
// "~q\175\135\223\\A\251\248\172\174\&5Z\EOTa\r(\160\253\239\NAK\226\149vnr\141",PropRequestProblemInformation
// 139,PropSubscriptionIdentifierAvailable 124,PropSubscriptionIdentifierAvailable 38,PropMaximumPacketSize
// 30907,PropWillDelayInterval 3971,PropSubscriptionIdentifier 3,PropReasonString "\163\205"]}
TEST(Connect5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x10, 0xca, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x7e, 0xc7, 0x88, 0x2,  0x3,  0x0,  0x13, 0xe,
      0x38, 0xef, 0xd7, 0x8c, 0xca, 0x12, 0x8c, 0x3f, 0x0,  0xea, 0x48, 0x70, 0x5a, 0xdb, 0xc2, 0x6c, 0x37, 0x2e, 0x26,
      0x0,  0xc,  0xe0, 0xb3, 0x8f, 0xe8, 0x84, 0xe3, 0x1a, 0x6,  0x68, 0x3,  0xfd, 0x61, 0x0,  0xd,  0xd0, 0xed, 0x31,
      0xc1, 0xd1, 0x67, 0xc2, 0x4c, 0x24, 0xec, 0x73, 0xfa, 0x56, 0x24, 0x12, 0x1a, 0x0,  0x17, 0xba, 0x4d, 0xca, 0x87,
      0x32, 0xc3, 0xf6, 0xf7, 0x9c, 0x92, 0xdf, 0x45, 0x89, 0xa0, 0xc8, 0x74, 0x10, 0x2b, 0x6d, 0xa8, 0x2,  0x3b, 0xf,
      0x11, 0x0,  0x0,  0x9,  0x75, 0x11, 0x0,  0x0,  0x13, 0x42, 0xb,  0x3,  0x8,  0x0,  0x1,  0x2,  0x25, 0x96, 0x1,
      0x79, 0x12, 0x0,  0xd,  0xce, 0x33, 0x92, 0xbc, 0xaa, 0xcf, 0x32, 0x5a, 0xc,  0x94, 0xc1, 0x1a, 0xec, 0x17, 0xb7,
      0x21, 0x79, 0x6a, 0x3,  0x0,  0x16, 0xd9, 0xbe, 0xb1, 0xe4, 0xa6, 0xd,  0x25, 0x28, 0x63, 0x89, 0xa5, 0x32, 0x75,
      0x5d, 0xda, 0xbd, 0x20, 0x73, 0x5f, 0x84, 0x7,  0x1d, 0x1a, 0x0,  0xc,  0x73, 0x99, 0xa7, 0xe,  0x41, 0x6d, 0xe7,
      0x31, 0x80, 0xea, 0x16, 0xf6, 0x1f, 0x0,  0x5,  0x69, 0x43, 0x5c, 0x19, 0x36, 0x2,  0x0,  0x0,  0x41, 0x9d, 0x27,
      0x0,  0x0,  0x6e, 0xd7, 0x16, 0x0,  0x19, 0x41, 0xc9, 0x12, 0xcc, 0x71, 0xc5, 0x1a, 0x66, 0x41, 0xdb, 0xd3, 0x55,
      0xae, 0xf2, 0xd,  0x58, 0xfe, 0xda, 0x44, 0x3,  0xbc, 0x99, 0xc6, 0xe4, 0x17, 0xb,  0xb,  0x19, 0xbd, 0x1f, 0x0,
      0x1b, 0x7e, 0x71, 0xaf, 0x87, 0xdf, 0x5c, 0x41, 0xfb, 0xf8, 0xac, 0xae, 0x35, 0x5a, 0x4,  0x61, 0xd,  0x28, 0xa0,
      0xfd, 0xef, 0x15, 0xe2, 0x95, 0x76, 0x6e, 0x72, 0x8d, 0x17, 0x8b, 0x29, 0x7c, 0x29, 0x26, 0x27, 0x0,  0x0,  0x78,
      0xbb, 0x18, 0x0,  0x0,  0xf,  0x83, 0xb,  0x3,  0x1f, 0x0,  0x2,  0xa3, 0xcd, 0x0,  0x16, 0xc7, 0x66, 0xe8, 0x3d,
      0xac, 0x7f, 0x94, 0x52, 0x3e, 0xa7, 0x5c, 0x58, 0x3b, 0xeb, 0x20, 0x11, 0xbd, 0xad, 0xcb, 0x57, 0x45, 0xf5, 0x49,
      0x18, 0x0,  0x0,  0x1c, 0x90, 0x21, 0x2,  0xab, 0x2,  0x0,  0x0,  0x55, 0x6c, 0x29, 0xa4, 0x29, 0xb4, 0x11, 0x0,
      0x0,  0x4d, 0xa3, 0x11, 0x0,  0x0,  0x1,  0x47, 0x29, 0x5e, 0x16, 0x0,  0x17, 0xc4, 0x15, 0x9a, 0x7a, 0xad, 0x81,
      0x39, 0xec, 0x95, 0xdf, 0xdd, 0x3c, 0xf5, 0x7d, 0x4,  0xa,  0xfd, 0xf1, 0x75, 0xcf, 0x69, 0x32, 0xdb, 0x21, 0x58,
      0xcb, 0x1,  0x6a, 0x1a, 0x0,  0x7,  0x78, 0xb5, 0xe1, 0x17, 0xfb, 0xdd, 0xc9, 0x23, 0x73, 0x23, 0x0,  0x12, 0x20,
      0xf,  0x99, 0x6,  0xd5, 0x28, 0x44, 0x66, 0x96, 0xfd, 0xc2, 0xab, 0x9e, 0x72, 0xcd, 0xcb, 0x63, 0x57, 0x0,  0x10,
      0xdd, 0x8c, 0x64, 0xcd, 0xee, 0x77, 0x9c, 0x6d, 0xda, 0x77, 0xc3, 0x34, 0xbd, 0x32, 0xd0, 0xb1, 0x0,  0x1b, 0x1e,
      0xa7, 0xa2, 0x36, 0x9a, 0xf2, 0xad, 0xbb, 0x9f, 0xe4, 0x4d, 0x95, 0x8f, 0x85, 0x5d, 0x1c, 0x25, 0xf2, 0xdb, 0xef,
      0xe8, 0xac, 0x37, 0x2,  0xec, 0x33, 0xe5, 0x0,  0xf,  0xdf, 0x8f, 0xb,  0xed, 0x9,  0x2f, 0xe3, 0x1c, 0xd2, 0xf3,
      0x82, 0xce, 0xb,  0xb4, 0xd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe,  0x38, 0xef, 0xd7, 0x8c, 0xca, 0x12, 0x8c, 0x3f, 0x0,
                           0xea, 0x48, 0x70, 0x5a, 0xdb, 0xc2, 0x6c, 0x37, 0x2e};
  uint8_t bytesprops2[] = {0xd0, 0xed, 0x31, 0xc1, 0xd1, 0x67, 0xc2, 0x4c, 0x24, 0xec, 0x73, 0xfa, 0x56};
  uint8_t bytesprops1[] = {0xe0, 0xb3, 0x8f, 0xe8, 0x84, 0xe3, 0x1a, 0x6, 0x68, 0x3, 0xfd, 0x61};
  uint8_t bytesprops3[] = {0xba, 0x4d, 0xca, 0x87, 0x32, 0xc3, 0xf6, 0xf7, 0x9c, 0x92, 0xdf, 0x45,
                           0x89, 0xa0, 0xc8, 0x74, 0x10, 0x2b, 0x6d, 0xa8, 0x2,  0x3b, 0xf};
  uint8_t bytesprops4[] = {0x2};
  uint8_t bytesprops5[] = {0xce, 0x33, 0x92, 0xbc, 0xaa, 0xcf, 0x32, 0x5a, 0xc, 0x94, 0xc1, 0x1a, 0xec};
  uint8_t bytesprops6[] = {0xd9, 0xbe, 0xb1, 0xe4, 0xa6, 0xd,  0x25, 0x28, 0x63, 0x89, 0xa5,
                           0x32, 0x75, 0x5d, 0xda, 0xbd, 0x20, 0x73, 0x5f, 0x84, 0x7,  0x1d};
  uint8_t bytesprops7[] = {0x73, 0x99, 0xa7, 0xe, 0x41, 0x6d, 0xe7, 0x31, 0x80, 0xea, 0x16, 0xf6};
  uint8_t bytesprops8[] = {0x69, 0x43, 0x5c, 0x19, 0x36};
  uint8_t bytesprops9[] = {0x41, 0xc9, 0x12, 0xcc, 0x71, 0xc5, 0x1a, 0x66, 0x41, 0xdb, 0xd3, 0x55, 0xae,
                           0xf2, 0xd,  0x58, 0xfe, 0xda, 0x44, 0x3,  0xbc, 0x99, 0xc6, 0xe4, 0x17};
  uint8_t bytesprops10[] = {0x7e, 0x71, 0xaf, 0x87, 0xdf, 0x5c, 0x41, 0xfb, 0xf8, 0xac, 0xae, 0x35, 0x5a, 0x4,
                            0x61, 0xd,  0x28, 0xa0, 0xfd, 0xef, 0x15, 0xe2, 0x95, 0x76, 0x6e, 0x72, 0x8d};
  uint8_t bytesprops11[] = {0xa3, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops1}, .v = {13, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2421}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4930}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 121}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31082}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16797}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28375}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 189}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {27, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 38}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 30907}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3971}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xc4, 0x15, 0x9a, 0x7a, 0xad, 0x81, 0x39, 0xec, 0x95, 0xdf, 0xdd, 0x3c,
                               0xf5, 0x7d, 0x4,  0xa,  0xfd, 0xf1, 0x75, 0xcf, 0x69, 0x32, 0xdb};
  uint8_t byteswillprops1[] = {0x78, 0xb5, 0xe1, 0x17, 0xfb, 0xdd, 0xc9};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7312}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 683}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21868}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 164}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19875}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 327}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 94}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22731}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29475}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x20, 0xf,  0x99, 0x6,  0xd5, 0x28, 0x44, 0x66, 0x96,
                                0xfd, 0xc2, 0xab, 0x9e, 0x72, 0xcd, 0xcb, 0x63, 0x57};
  lwmqtt_string_t will_topic = {18, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xdd, 0x8c, 0x64, 0xcd, 0xee, 0x77, 0x9c, 0x6d,
                                  0xda, 0x77, 0xc3, 0x34, 0xbd, 0x32, 0xd0, 0xb1};
  lwmqtt_string_t will_payload = {16, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 32455;
  uint8_t client_id_bytes[] = {0xc7, 0x66, 0xe8, 0x3d, 0xac, 0x7f, 0x94, 0x52, 0x3e, 0xa7, 0x5c,
                               0x58, 0x3b, 0xeb, 0x20, 0x11, 0xbd, 0xad, 0xcb, 0x57, 0x45, 0xf5};
  lwmqtt_string_t client_id = {22, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x1e, 0xa7, 0xa2, 0x36, 0x9a, 0xf2, 0xad, 0xbb, 0x9f, 0xe4, 0x4d, 0x95, 0x8f, 0x85,
                              0x5d, 0x1c, 0x25, 0xf2, 0xdb, 0xef, 0xe8, 0xac, 0x37, 0x2,  0xec, 0x33, 0xe5};
  lwmqtt_string_t username = {27, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xdf, 0x8f, 0xb, 0xed, 0x9, 0x2f, 0xe3, 0x1c, 0xd2, 0xf3, 0x82, 0xce, 0xb, 0xb4, 0xd};
  lwmqtt_string_t password = {15, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Nothing, _lastWill = Nothing, _cleanSession = True, _keepAlive =
// 14647, _connID = "\173\255n}\129\NAK", _properties = [PropContentType "V\175t<Y\251\186\216\147",PropServerReference
// "&C\193\&3",PropPayloadFormatIndicator 190,PropTopicAliasMaximum 9512,PropCorrelationData
// "\165r\229n\ETB\174\142\128\DC4+\255_\208\199\&9\243b\187\226Vy",PropSharedSubscriptionAvailable 73,PropContentType
// "\156\156\162x",PropUserProperty "\148\213\247\140\136\139\182\241\177"
// "\142E\216c\ENQE\203\166wt&\185\ACKV\174-\238\189i\226",PropResponseInformation
// "\248Y\GS\DC3\190\STX\133\ETX\243p\132\204\247\229\243\223A\218#6",PropAuthenticationData
// "jZ\217\249\SYN\198",PropTopicAliasMaximum 6905,PropContentType
// "\\\165\229\SO\138\DC4s\STX\232\n\218\217\255`-\225\&4\199w\219)",PropTopicAlias 9853,PropRequestProblemInformation
// 145,PropRetainAvailable 154,PropMessageExpiryInterval 32158,PropAuthenticationData "",PropUserProperty
// "*\158\143\192bc" "JR\184:\ENQ\DC1\195",PropAssignedClientIdentifier
// "&U#\237R\156dWH3\ETB\149Q{\192\157A\159\156",PropPayloadFormatIndicator 106,PropReceiveMaximum
// 6212,PropServerKeepAlive 23028,PropAuthenticationData "\195\138\216\240b"]}
TEST(Connect5QCTest, Encode24) {
  uint8_t pkt[] = {
      0x10, 0xf1, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x2,  0x39, 0x37, 0xdd, 0x1,  0x3,  0x0,  0x9,  0x56,
      0xaf, 0x74, 0x3c, 0x59, 0xfb, 0xba, 0xd8, 0x93, 0x1c, 0x0,  0x4,  0x26, 0x43, 0xc1, 0x33, 0x1,  0xbe, 0x22, 0x25,
      0x28, 0x9,  0x0,  0x15, 0xa5, 0x72, 0xe5, 0x6e, 0x17, 0xae, 0x8e, 0x80, 0x14, 0x2b, 0xff, 0x5f, 0xd0, 0xc7, 0x39,
      0xf3, 0x62, 0xbb, 0xe2, 0x56, 0x79, 0x2a, 0x49, 0x3,  0x0,  0x4,  0x9c, 0x9c, 0xa2, 0x78, 0x26, 0x0,  0x9,  0x94,
      0xd5, 0xf7, 0x8c, 0x88, 0x8b, 0xb6, 0xf1, 0xb1, 0x0,  0x14, 0x8e, 0x45, 0xd8, 0x63, 0x5,  0x45, 0xcb, 0xa6, 0x77,
      0x74, 0x26, 0xb9, 0x6,  0x56, 0xae, 0x2d, 0xee, 0xbd, 0x69, 0xe2, 0x1a, 0x0,  0x14, 0xf8, 0x59, 0x1d, 0x13, 0xbe,
      0x2,  0x85, 0x3,  0xf3, 0x70, 0x84, 0xcc, 0xf7, 0xe5, 0xf3, 0xdf, 0x41, 0xda, 0x23, 0x36, 0x16, 0x0,  0x6,  0x6a,
      0x5a, 0xd9, 0xf9, 0x16, 0xc6, 0x22, 0x1a, 0xf9, 0x3,  0x0,  0x15, 0x5c, 0xa5, 0xe5, 0xe,  0x8a, 0x14, 0x73, 0x2,
      0xe8, 0xa,  0xda, 0xd9, 0xff, 0x60, 0x2d, 0xe1, 0x34, 0xc7, 0x77, 0xdb, 0x29, 0x23, 0x26, 0x7d, 0x17, 0x91, 0x25,
      0x9a, 0x2,  0x0,  0x0,  0x7d, 0x9e, 0x16, 0x0,  0x0,  0x26, 0x0,  0x6,  0x2a, 0x9e, 0x8f, 0xc0, 0x62, 0x63, 0x0,
      0x7,  0x4a, 0x52, 0xb8, 0x3a, 0x5,  0x11, 0xc3, 0x12, 0x0,  0x13, 0x26, 0x55, 0x23, 0xed, 0x52, 0x9c, 0x64, 0x57,
      0x48, 0x33, 0x17, 0x95, 0x51, 0x7b, 0xc0, 0x9d, 0x41, 0x9f, 0x9c, 0x1,  0x6a, 0x21, 0x18, 0x44, 0x13, 0x59, 0xf4,
      0x16, 0x0,  0x5,  0xc3, 0x8a, 0xd8, 0xf0, 0x62, 0x0,  0x6,  0xad, 0xff, 0x6e, 0x7d, 0x81, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x56, 0xaf, 0x74, 0x3c, 0x59, 0xfb, 0xba, 0xd8, 0x93};
  uint8_t bytesprops1[] = {0x26, 0x43, 0xc1, 0x33};
  uint8_t bytesprops2[] = {0xa5, 0x72, 0xe5, 0x6e, 0x17, 0xae, 0x8e, 0x80, 0x14, 0x2b, 0xff,
                           0x5f, 0xd0, 0xc7, 0x39, 0xf3, 0x62, 0xbb, 0xe2, 0x56, 0x79};
  uint8_t bytesprops3[] = {0x9c, 0x9c, 0xa2, 0x78};
  uint8_t bytesprops5[] = {0x8e, 0x45, 0xd8, 0x63, 0x5,  0x45, 0xcb, 0xa6, 0x77, 0x74,
                           0x26, 0xb9, 0x6,  0x56, 0xae, 0x2d, 0xee, 0xbd, 0x69, 0xe2};
  uint8_t bytesprops4[] = {0x94, 0xd5, 0xf7, 0x8c, 0x88, 0x8b, 0xb6, 0xf1, 0xb1};
  uint8_t bytesprops6[] = {0xf8, 0x59, 0x1d, 0x13, 0xbe, 0x2,  0x85, 0x3,  0xf3, 0x70,
                           0x84, 0xcc, 0xf7, 0xe5, 0xf3, 0xdf, 0x41, 0xda, 0x23, 0x36};
  uint8_t bytesprops7[] = {0x6a, 0x5a, 0xd9, 0xf9, 0x16, 0xc6};
  uint8_t bytesprops8[] = {0x5c, 0xa5, 0xe5, 0xe,  0x8a, 0x14, 0x73, 0x2,  0xe8, 0xa, 0xda,
                           0xd9, 0xff, 0x60, 0x2d, 0xe1, 0x34, 0xc7, 0x77, 0xdb, 0x29};
  uint8_t bytesprops9[] = {0};
  uint8_t bytesprops11[] = {0x4a, 0x52, 0xb8, 0x3a, 0x5, 0x11, 0xc3};
  uint8_t bytesprops10[] = {0x2a, 0x9e, 0x8f, 0xc0, 0x62, 0x63};
  uint8_t bytesprops12[] = {0x26, 0x55, 0x23, 0xed, 0x52, 0x9c, 0x64, 0x57, 0x48, 0x33,
                            0x17, 0x95, 0x51, 0x7b, 0xc0, 0x9d, 0x41, 0x9f, 0x9c};
  uint8_t bytesprops13[] = {0xc3, 0x8a, 0xd8, 0xf0, 0x62};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 190}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9512}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops4}, .v = {20, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 6905}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9853}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 32158}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops10}, .v = {7, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {19, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6212}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23028}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 14647;
  uint8_t client_id_bytes[] = {0xad, 0xff, 0x6e, 0x7d, 0x81, 0x15};
  lwmqtt_string_t client_id = {6, (char*)&client_id_bytes};
  opts.client_id = client_id;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, NULL);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "/&", _password = Just
// "8\SUB\143\t\ESC\220%\187\ESC1\163\&9\253\207\185F\t\213N\NUL\"", _lastWill = Just (LastWill {_willRetain = True,
// _willQoS = QoS0, _willTopic = "\209Ho\130\233\&6\203E\189\STX\204\202LG\160\188C[\GS&\169w\NUL\208\161", _willMsg =
// "C", _willProps = [PropSessionExpiryInterval 1870,PropSharedSubscriptionAvailable 232,PropMessageExpiryInterval
// 5518,PropTopicAlias 6427,PropSubscriptionIdentifierAvailable 131,PropSubscriptionIdentifier 25,PropReasonString
// "o\135'Tn4\199\FS \SO*|\a\174\SO;\229\t\225>\192N",PropResponseInformation
// "\136\188\243\EM:\173\236Y\t}%\212\229\138\SI9R\141I\206\192\139\217\249IC\150eo\170",PropServerReference
// "(\147\138\190\ESCb\239\183\\\252\&1\189bc\171\189\209",PropReceiveMaximum 3357,PropRequestProblemInformation
// 243,PropMessageExpiryInterval 5627,PropServerKeepAlive 22171,PropRetainAvailable 24,PropTopicAliasMaximum
// 18180,PropRequestResponseInformation 20,PropRetainAvailable 70,PropCorrelationData
// "8\131\255G\143\NAKhw3@t\EOT",PropResponseInformation
// "\135\ETX|\197\DEL\146f9L\197$t\SO0j\ENQ\137\138\178\138\245\210",PropSessionExpiryInterval
// 20657,PropSessionExpiryInterval 27920,PropRequestResponseInformation 8,PropUserProperty
// "\EOT\DC2p{\170.i\EOT\166\CANm" "r!\155\EOT6x\216s\SI\177\230Q\142\249\141\DLE\178\v\252\168",PropReceiveMaximum
// 8439,PropAuthenticationMethod "\221\DLE\133\205\&7\240\167\154",PropWillDelayInterval 9107]}), _cleanSession = False,
// _keepAlive = 17899, _connID = ".hc\n\135\206/\236\&0\221\216\155\236", _properties = [PropReceiveMaximum
// 26537,PropTopicAlias 10462,PropContentType
// "\133\DC4#\245\227&\ETX\217\r\DC1\216\210\234k\ACK\197\146\220\ACK\230\227\219/",PropReceiveMaximum
// 18891,PropWillDelayInterval 29782,PropSubscriptionIdentifier 7,PropWildcardSubscriptionAvailable 223,PropUserProperty
// "-\ETXU!\244N\169" "%9\254\194\US-\236\224\170;\244{u\180\198\243\&3\224\DC1\SO\203\t\193g",PropReceiveMaximum
// 29189]}
TEST(Connect5QCTest, Encode25) {
  uint8_t pkt[] = {
      0x10, 0x8a, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xe4, 0x45, 0xeb, 0x53, 0x21, 0x67, 0xa9, 0x23, 0x28,
      0xde, 0x3,  0x0,  0x17, 0x85, 0x14, 0x23, 0xf5, 0xe3, 0x26, 0x3,  0xd9, 0xd,  0x11, 0xd8, 0xd2, 0xea, 0x6b, 0x6,
      0xc5, 0x92, 0xdc, 0x6,  0xe6, 0xe3, 0xdb, 0x2f, 0x21, 0x49, 0xcb, 0x18, 0x0,  0x0,  0x74, 0x56, 0xb,  0x7,  0x28,
      0xdf, 0x26, 0x0,  0x7,  0x2d, 0x3,  0x55, 0x21, 0xf4, 0x4e, 0xa9, 0x0,  0x18, 0x25, 0x39, 0xfe, 0xc2, 0x1f, 0x2d,
      0xec, 0xe0, 0xaa, 0x3b, 0xf4, 0x7b, 0x75, 0xb4, 0xc6, 0xf3, 0x33, 0xe0, 0x11, 0xe,  0xcb, 0x9,  0xc1, 0x67, 0x21,
      0x72, 0x5,  0x0,  0xd,  0x2e, 0x68, 0x63, 0xa,  0x87, 0xce, 0x2f, 0xec, 0x30, 0xdd, 0xd8, 0x9b, 0xec, 0xe2, 0x1,
      0x11, 0x0,  0x0,  0x7,  0x4e, 0x2a, 0xe8, 0x2,  0x0,  0x0,  0x15, 0x8e, 0x23, 0x19, 0x1b, 0x29, 0x83, 0xb,  0x19,
      0x1f, 0x0,  0x16, 0x6f, 0x87, 0x27, 0x54, 0x6e, 0x34, 0xc7, 0x1c, 0x20, 0xe,  0x2a, 0x7c, 0x7,  0xae, 0xe,  0x3b,
      0xe5, 0x9,  0xe1, 0x3e, 0xc0, 0x4e, 0x1a, 0x0,  0x1e, 0x88, 0xbc, 0xf3, 0x19, 0x3a, 0xad, 0xec, 0x59, 0x9,  0x7d,
      0x25, 0xd4, 0xe5, 0x8a, 0xf,  0x39, 0x52, 0x8d, 0x49, 0xce, 0xc0, 0x8b, 0xd9, 0xf9, 0x49, 0x43, 0x96, 0x65, 0x6f,
      0xaa, 0x1c, 0x0,  0x11, 0x28, 0x93, 0x8a, 0xbe, 0x1b, 0x62, 0xef, 0xb7, 0x5c, 0xfc, 0x31, 0xbd, 0x62, 0x63, 0xab,
      0xbd, 0xd1, 0x21, 0xd,  0x1d, 0x17, 0xf3, 0x2,  0x0,  0x0,  0x15, 0xfb, 0x13, 0x56, 0x9b, 0x25, 0x18, 0x22, 0x47,
      0x4,  0x19, 0x14, 0x25, 0x46, 0x9,  0x0,  0xc,  0x38, 0x83, 0xff, 0x47, 0x8f, 0x15, 0x68, 0x77, 0x33, 0x40, 0x74,
      0x4,  0x1a, 0x0,  0x16, 0x87, 0x3,  0x7c, 0xc5, 0x7f, 0x92, 0x66, 0x39, 0x4c, 0xc5, 0x24, 0x74, 0xe,  0x30, 0x6a,
      0x5,  0x89, 0x8a, 0xb2, 0x8a, 0xf5, 0xd2, 0x11, 0x0,  0x0,  0x50, 0xb1, 0x11, 0x0,  0x0,  0x6d, 0x10, 0x19, 0x8,
      0x26, 0x0,  0xb,  0x4,  0x12, 0x70, 0x7b, 0xaa, 0x2e, 0x69, 0x4,  0xa6, 0x18, 0x6d, 0x0,  0x14, 0x72, 0x21, 0x9b,
      0x4,  0x36, 0x78, 0xd8, 0x73, 0xf,  0xb1, 0xe6, 0x51, 0x8e, 0xf9, 0x8d, 0x10, 0xb2, 0xb,  0xfc, 0xa8, 0x21, 0x20,
      0xf7, 0x15, 0x0,  0x8,  0xdd, 0x10, 0x85, 0xcd, 0x37, 0xf0, 0xa7, 0x9a, 0x18, 0x0,  0x0,  0x23, 0x93, 0x0,  0x19,
      0xd1, 0x48, 0x6f, 0x82, 0xe9, 0x36, 0xcb, 0x45, 0xbd, 0x2,  0xcc, 0xca, 0x4c, 0x47, 0xa0, 0xbc, 0x43, 0x5b, 0x1d,
      0x26, 0xa9, 0x77, 0x0,  0xd0, 0xa1, 0x0,  0x1,  0x43, 0x0,  0x2,  0x2f, 0x26, 0x0,  0x15, 0x38, 0x1a, 0x8f, 0x9,
      0x1b, 0xdc, 0x25, 0xbb, 0x1b, 0x31, 0xa3, 0x39, 0xfd, 0xcf, 0xb9, 0x46, 0x9,  0xd5, 0x4e, 0x0,  0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x85, 0x14, 0x23, 0xf5, 0xe3, 0x26, 0x3, 0xd9, 0xd,  0x11, 0xd8, 0xd2,
                           0xea, 0x6b, 0x6,  0xc5, 0x92, 0xdc, 0x6, 0xe6, 0xe3, 0xdb, 0x2f};
  uint8_t bytesprops2[] = {0x25, 0x39, 0xfe, 0xc2, 0x1f, 0x2d, 0xec, 0xe0, 0xaa, 0x3b, 0xf4, 0x7b,
                           0x75, 0xb4, 0xc6, 0xf3, 0x33, 0xe0, 0x11, 0xe,  0xcb, 0x9,  0xc1, 0x67};
  uint8_t bytesprops1[] = {0x2d, 0x3, 0x55, 0x21, 0xf4, 0x4e, 0xa9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26537}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 10462}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18891}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 29782}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 223}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops1}, .v = {24, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29189}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x6f, 0x87, 0x27, 0x54, 0x6e, 0x34, 0xc7, 0x1c, 0x20, 0xe,  0x2a,
                               0x7c, 0x7,  0xae, 0xe,  0x3b, 0xe5, 0x9,  0xe1, 0x3e, 0xc0, 0x4e};
  uint8_t byteswillprops1[] = {0x88, 0xbc, 0xf3, 0x19, 0x3a, 0xad, 0xec, 0x59, 0x9,  0x7d,
                               0x25, 0xd4, 0xe5, 0x8a, 0xf,  0x39, 0x52, 0x8d, 0x49, 0xce,
                               0xc0, 0x8b, 0xd9, 0xf9, 0x49, 0x43, 0x96, 0x65, 0x6f, 0xaa};
  uint8_t byteswillprops2[] = {0x28, 0x93, 0x8a, 0xbe, 0x1b, 0x62, 0xef, 0xb7, 0x5c,
                               0xfc, 0x31, 0xbd, 0x62, 0x63, 0xab, 0xbd, 0xd1};
  uint8_t byteswillprops3[] = {0x38, 0x83, 0xff, 0x47, 0x8f, 0x15, 0x68, 0x77, 0x33, 0x40, 0x74, 0x4};
  uint8_t byteswillprops4[] = {0x87, 0x3, 0x7c, 0xc5, 0x7f, 0x92, 0x66, 0x39, 0x4c, 0xc5, 0x24,
                               0x74, 0xe, 0x30, 0x6a, 0x5,  0x89, 0x8a, 0xb2, 0x8a, 0xf5, 0xd2};
  uint8_t byteswillprops6[] = {0x72, 0x21, 0x9b, 0x4,  0x36, 0x78, 0xd8, 0x73, 0xf,  0xb1,
                               0xe6, 0x51, 0x8e, 0xf9, 0x8d, 0x10, 0xb2, 0xb,  0xfc, 0xa8};
  uint8_t byteswillprops5[] = {0x4, 0x12, 0x70, 0x7b, 0xaa, 0x2e, 0x69, 0x4, 0xa6, 0x18, 0x6d};
  uint8_t byteswillprops7[] = {0xdd, 0x10, 0x85, 0xcd, 0x37, 0xf0, 0xa7, 0x9a};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 1870}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5518}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6427}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 25}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3357}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5627}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22171}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18180}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {12, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20657}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27920}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {11, (char*)&byteswillprops5}, .v = {20, (char*)&byteswillprops6}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8439}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {8, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 9107}},
  };

  lwmqtt_properties_t willprops = {26, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xd1, 0x48, 0x6f, 0x82, 0xe9, 0x36, 0xcb, 0x45, 0xbd, 0x2, 0xcc, 0xca, 0x4c,
                                0x47, 0xa0, 0xbc, 0x43, 0x5b, 0x1d, 0x26, 0xa9, 0x77, 0x0, 0xd0, 0xa1};
  lwmqtt_string_t will_topic = {25, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x43};
  lwmqtt_string_t will_payload = {1, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 17899;
  uint8_t client_id_bytes[] = {0x2e, 0x68, 0x63, 0xa, 0x87, 0xce, 0x2f, 0xec, 0x30, 0xdd, 0xd8, 0x9b, 0xec};
  lwmqtt_string_t client_id = {13, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x2f, 0x26};
  lwmqtt_string_t username = {2, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x38, 0x1a, 0x8f, 0x9,  0x1b, 0xdc, 0x25, 0xbb, 0x1b, 0x31, 0xa3,
                              0x39, 0xfd, 0xcf, 0xb9, 0x46, 0x9,  0xd5, 0x4e, 0x0,  0x22};
  lwmqtt_string_t password = {21, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "N\203\159\210\235ac\RS\168\231\220r'\253\200\162\192\166\149\231\221", _password =
// Just "\174,\168L\134y\NUL\129\t\237\152\134\184\222\US\168\208\"|\246\140=\236\196~\b\150\246\216\164", _lastWill =
// Just (LastWill {_willRetain = False, _willQoS = QoS0, _willTopic = "\218I\179[\161\209\ESC}h\205FPB@K\133", _willMsg
// = "2\215\135\225\197N", _willProps = [PropCorrelationData
// "@\153\210\152\129\138\129[k\165\228\205\201~\149\188",PropWildcardSubscriptionAvailable
// 161,PropWildcardSubscriptionAvailable 133,PropServerReference "\135Y\218\139.D/\173W\167j",PropAuthenticationMethod "
// \199/E\233\150;c/"]}), _cleanSession = False, _keepAlive = 30481, _connID =
// "\132\129b\222=>\197\164\SO\236\234\204O\202\240\150\&0\186\167", _properties = [PropSharedSubscriptionAvailable
// 2,PropPayloadFormatIndicator 142,PropMaximumPacketSize 7898,PropServerReference
// "\185\137\&6\172\245\241\241\246",PropRequestProblemInformation 20,PropUserProperty "[J\203\217\SO\&H\204\208M:\t"
// "%\NAK\208x\208$p\192x\247"]}
TEST(Connect5QCTest, Encode26) {
  uint8_t pkt[] = {0x10, 0xd3, 0x1,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xc4, 0x77, 0x11, 0x30, 0x2a, 0x2,  0x1,
                   0x8e, 0x27, 0x0,  0x0,  0x1e, 0xda, 0x1c, 0x0,  0x8,  0xb9, 0x89, 0x36, 0xac, 0xf5, 0xf1, 0xf1, 0xf6,
                   0x17, 0x14, 0x26, 0x0,  0xb,  0x5b, 0x4a, 0xcb, 0xd9, 0xe,  0x48, 0xcc, 0xd0, 0x4d, 0x3a, 0x9,  0x0,
                   0xa,  0x25, 0x15, 0xd0, 0x78, 0xd0, 0x24, 0x70, 0xc0, 0x78, 0xf7, 0x0,  0x13, 0x84, 0x81, 0x62, 0xde,
                   0x3d, 0x3e, 0xc5, 0xa4, 0xe,  0xec, 0xea, 0xcc, 0x4f, 0xca, 0xf0, 0x96, 0x30, 0xba, 0xa7, 0x31, 0x9,
                   0x0,  0x10, 0x40, 0x99, 0xd2, 0x98, 0x81, 0x8a, 0x81, 0x5b, 0x6b, 0xa5, 0xe4, 0xcd, 0xc9, 0x7e, 0x95,
                   0xbc, 0x28, 0xa1, 0x28, 0x85, 0x1c, 0x0,  0xb,  0x87, 0x59, 0xda, 0x8b, 0x2e, 0x44, 0x2f, 0xad, 0x57,
                   0xa7, 0x6a, 0x15, 0x0,  0x9,  0x20, 0xc7, 0x2f, 0x45, 0xe9, 0x96, 0x3b, 0x63, 0x2f, 0x0,  0x10, 0xda,
                   0x49, 0xb3, 0x5b, 0xa1, 0xd1, 0x1b, 0x7d, 0x68, 0xcd, 0x46, 0x50, 0x42, 0x40, 0x4b, 0x85, 0x0,  0x6,
                   0x32, 0xd7, 0x87, 0xe1, 0xc5, 0x4e, 0x0,  0x15, 0x4e, 0xcb, 0x9f, 0xd2, 0xeb, 0x61, 0x63, 0x1e, 0xa8,
                   0xe7, 0xdc, 0x72, 0x27, 0xfd, 0xc8, 0xa2, 0xc0, 0xa6, 0x95, 0xe7, 0xdd, 0x0,  0x1e, 0xae, 0x2c, 0xa8,
                   0x4c, 0x86, 0x79, 0x0,  0x81, 0x9,  0xed, 0x98, 0x86, 0xb8, 0xde, 0x1f, 0xa8, 0xd0, 0x22, 0x7c, 0xf6,
                   0x8c, 0x3d, 0xec, 0xc4, 0x7e, 0x8,  0x96, 0xf6, 0xd8, 0xa4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb9, 0x89, 0x36, 0xac, 0xf5, 0xf1, 0xf1, 0xf6};
  uint8_t bytesprops2[] = {0x25, 0x15, 0xd0, 0x78, 0xd0, 0x24, 0x70, 0xc0, 0x78, 0xf7};
  uint8_t bytesprops1[] = {0x5b, 0x4a, 0xcb, 0xd9, 0xe, 0x48, 0xcc, 0xd0, 0x4d, 0x3a, 0x9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7898}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {10, (char*)&bytesprops2}}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x40, 0x99, 0xd2, 0x98, 0x81, 0x8a, 0x81, 0x5b,
                               0x6b, 0xa5, 0xe4, 0xcd, 0xc9, 0x7e, 0x95, 0xbc};
  uint8_t byteswillprops1[] = {0x87, 0x59, 0xda, 0x8b, 0x2e, 0x44, 0x2f, 0xad, 0x57, 0xa7, 0x6a};
  uint8_t byteswillprops2[] = {0x20, 0xc7, 0x2f, 0x45, 0xe9, 0x96, 0x3b, 0x63, 0x2f};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {16, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 161}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&byteswillprops2}}},
  };

  lwmqtt_properties_t willprops = {5, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xda, 0x49, 0xb3, 0x5b, 0xa1, 0xd1, 0x1b, 0x7d,
                                0x68, 0xcd, 0x46, 0x50, 0x42, 0x40, 0x4b, 0x85};
  lwmqtt_string_t will_topic = {16, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x32, 0xd7, 0x87, 0xe1, 0xc5, 0x4e};
  lwmqtt_string_t will_payload = {6, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS0;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 30481;
  uint8_t client_id_bytes[] = {0x84, 0x81, 0x62, 0xde, 0x3d, 0x3e, 0xc5, 0xa4, 0xe, 0xec,
                               0xea, 0xcc, 0x4f, 0xca, 0xf0, 0x96, 0x30, 0xba, 0xa7};
  lwmqtt_string_t client_id = {19, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x4e, 0xcb, 0x9f, 0xd2, 0xeb, 0x61, 0x63, 0x1e, 0xa8, 0xe7, 0xdc,
                              0x72, 0x27, 0xfd, 0xc8, 0xa2, 0xc0, 0xa6, 0x95, 0xe7, 0xdd};
  lwmqtt_string_t username = {21, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xae, 0x2c, 0xa8, 0x4c, 0x86, 0x79, 0x0,  0x81, 0x9,  0xed, 0x98, 0x86, 0xb8, 0xde, 0x1f,
                              0xa8, 0xd0, 0x22, 0x7c, 0xf6, 0x8c, 0x3d, 0xec, 0xc4, 0x7e, 0x8,  0x96, 0xf6, 0xd8, 0xa4};
  lwmqtt_string_t password = {30, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "eBV0^b\231\GS\250\n\203\224", _password = Just
// "\240\177\187\244\250c\"\200Pw\189\163m|\131\&5*\177\169]", _lastWill = Just (LastWill {_willRetain = True, _willQoS
// = QoS1, _willTopic = "\b,([w\253\205\CAN\167\199\238\&0\171\SOHj\206\NUL\245\243\144\169\b\226\180\134\154}\214\194",
// _willMsg = "\181aO\128(\188\ETB", _willProps = [PropResponseTopic
// "\240\191\190;\151\150\128\232\230\189\223\208\149d_\241i\168",PropSubscriptionIdentifier 3,PropUserProperty
// "\255\n<?" "av\231>\170w\146\254\227\225>\147\136x\146\STX=@\192)_s3",PropTopicAliasMaximum
// 26779,PropWildcardSubscriptionAvailable 149,PropWillDelayInterval 6431,PropContentType
// "\208f\163\NAK~k\r\192%\199Mc\185\181\194 \193\ETB\169\"\255\144=\CAN\NAK\168$\t",PropRetainAvailable
// 106,PropUserProperty "\161]\219U\133\146\219\141_\197\NUL\ACKa\224\192L\196p"
// "Z\172\213\215\148\f#,",PropUserProperty "\245"
// "\227\199V\169\251\141\252r\148\167\134s\a\152\DC1\167\223\253^\213VV\128\193\ACKu\132\183\232r",PropTopicAlias
// 14287,PropTopicAliasMaximum 30203,PropRetainAvailable 218,PropResponseInformation
// "\142\&6\172J\DC4\v\v\239Q\139\203!&\180",PropServerReference "ML\165\210\154\253\&4\141hB"]}), _cleanSession =
// False, _keepAlive = 3521, _connID = "\205A\247\ACK\129\&6\196\202\192<\208z\234>\ETB\DC2\195\208\221\STX\DC1L\146s",
// _properties = [PropAuthenticationData "\130\248\ETX\197\202\166]\180\SI\154\188y\132",PropResponseTopic
// "\190\200l\241\&5\245p\171\183\255Qd\DC4\149\227",PropTopicAlias 17354,PropTopicAliasMaximum
// 205,PropAssignedClientIdentifier "Hz\157\DEL\150\144Bw\194=\203A&t\255\ENQH\184$\225\140",PropUserProperty
// "\DC2&\172\&5_<\146,\162\&3^\135\149:\b\191\170\250VJs\SUB\224f\186\236L"
// "$\141a/\214\195\229(\242\146\214",PropUserProperty "\250\&1\236D\152\145\137\&1\170"
// "SvF3\146TM\223\NAK\STX\191;\NUL\NUL#/\159\253\b\129\&0.\EM\209\247",PropMessageExpiryInterval
// 28259,PropPayloadFormatIndicator 81,PropSharedSubscriptionAvailable 202,PropUserProperty
// "@\253^\230\180\181$\245\219\245\162\224\NAK\204\231\244\175\212\174f\NUL\225\186\179kv\ETB"
// "\147R\167\155k",PropContentType "\200\171|\227\159\202\208\RSa\199",PropRequestProblemInformation
// 19,PropRequestProblemInformation 133,PropMaximumPacketSize 1040,PropSubscriptionIdentifier
// 18,PropAssignedClientIdentifier "\212*\158A\154\249\DEL\209<\191\r\n",PropTopicAliasMaximum 9595,PropReasonString
// "\SYN\191\223\SI_\234\241\163+\175W\187\184\&3\194\FS",PropUserProperty "V\238\150=fw\218\&9\200\EOT"
// "\229-",PropAuthenticationMethod "#m",PropResponseInformation
// "\r\174\170X\206g\186\255\153<\220\DC4kq\EOT\227W\129",PropAuthenticationMethod
// "\224\253^\184\248x\248\DC1\180\237\193_}\155 ?\212A\175",PropPayloadFormatIndicator 97,PropUserProperty
// "b\143\DC28\220a\148\198\145\145\&6\n\243\180\SOH `N\149\187\172\246\253\&9\139L:)"
// "\SUB\247V\243\153\ESCe\\\213>\219\SOH\EM\244X\154\251\172\254Y\238\&9R\243\SYN\DC3\206"]}
TEST(Connect5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x10, 0xbb, 0x5,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xec, 0xd,  0xc1, 0xfc, 0x2,  0x16, 0x0,  0xd,  0x82,
      0xf8, 0x3,  0xc5, 0xca, 0xa6, 0x5d, 0xb4, 0xf,  0x9a, 0xbc, 0x79, 0x84, 0x8,  0x0,  0xf,  0xbe, 0xc8, 0x6c, 0xf1,
      0x35, 0xf5, 0x70, 0xab, 0xb7, 0xff, 0x51, 0x64, 0x14, 0x95, 0xe3, 0x23, 0x43, 0xca, 0x22, 0x0,  0xcd, 0x12, 0x0,
      0x15, 0x48, 0x7a, 0x9d, 0x7f, 0x96, 0x90, 0x42, 0x77, 0xc2, 0x3d, 0xcb, 0x41, 0x26, 0x74, 0xff, 0x5,  0x48, 0xb8,
      0x24, 0xe1, 0x8c, 0x26, 0x0,  0x1b, 0x12, 0x26, 0xac, 0x35, 0x5f, 0x3c, 0x92, 0x2c, 0xa2, 0x33, 0x5e, 0x87, 0x95,
      0x3a, 0x8,  0xbf, 0xaa, 0xfa, 0x56, 0x4a, 0x73, 0x1a, 0xe0, 0x66, 0xba, 0xec, 0x4c, 0x0,  0xb,  0x24, 0x8d, 0x61,
      0x2f, 0xd6, 0xc3, 0xe5, 0x28, 0xf2, 0x92, 0xd6, 0x26, 0x0,  0x9,  0xfa, 0x31, 0xec, 0x44, 0x98, 0x91, 0x89, 0x31,
      0xaa, 0x0,  0x19, 0x53, 0x76, 0x46, 0x33, 0x92, 0x54, 0x4d, 0xdf, 0x15, 0x2,  0xbf, 0x3b, 0x0,  0x0,  0x23, 0x2f,
      0x9f, 0xfd, 0x8,  0x81, 0x30, 0x2e, 0x19, 0xd1, 0xf7, 0x2,  0x0,  0x0,  0x6e, 0x63, 0x1,  0x51, 0x2a, 0xca, 0x26,
      0x0,  0x1b, 0x40, 0xfd, 0x5e, 0xe6, 0xb4, 0xb5, 0x24, 0xf5, 0xdb, 0xf5, 0xa2, 0xe0, 0x15, 0xcc, 0xe7, 0xf4, 0xaf,
      0xd4, 0xae, 0x66, 0x0,  0xe1, 0xba, 0xb3, 0x6b, 0x76, 0x17, 0x0,  0x5,  0x93, 0x52, 0xa7, 0x9b, 0x6b, 0x3,  0x0,
      0xa,  0xc8, 0xab, 0x7c, 0xe3, 0x9f, 0xca, 0xd0, 0x1e, 0x61, 0xc7, 0x17, 0x13, 0x17, 0x85, 0x27, 0x0,  0x0,  0x4,
      0x10, 0xb,  0x12, 0x12, 0x0,  0xc,  0xd4, 0x2a, 0x9e, 0x41, 0x9a, 0xf9, 0x7f, 0xd1, 0x3c, 0xbf, 0xd,  0xa,  0x22,
      0x25, 0x7b, 0x1f, 0x0,  0x10, 0x16, 0xbf, 0xdf, 0xf,  0x5f, 0xea, 0xf1, 0xa3, 0x2b, 0xaf, 0x57, 0xbb, 0xb8, 0x33,
      0xc2, 0x1c, 0x26, 0x0,  0xa,  0x56, 0xee, 0x96, 0x3d, 0x66, 0x77, 0xda, 0x39, 0xc8, 0x4,  0x0,  0x2,  0xe5, 0x2d,
      0x15, 0x0,  0x2,  0x23, 0x6d, 0x1a, 0x0,  0x12, 0xd,  0xae, 0xaa, 0x58, 0xce, 0x67, 0xba, 0xff, 0x99, 0x3c, 0xdc,
      0x14, 0x6b, 0x71, 0x4,  0xe3, 0x57, 0x81, 0x15, 0x0,  0x13, 0xe0, 0xfd, 0x5e, 0xb8, 0xf8, 0x78, 0xf8, 0x11, 0xb4,
      0xed, 0xc1, 0x5f, 0x7d, 0x9b, 0x20, 0x3f, 0xd4, 0x41, 0xaf, 0x1,  0x61, 0x26, 0x0,  0x1c, 0x62, 0x8f, 0x12, 0x38,
      0xdc, 0x61, 0x94, 0xc6, 0x91, 0x91, 0x36, 0xa,  0xf3, 0xb4, 0x1,  0x20, 0x60, 0x4e, 0x95, 0xbb, 0xac, 0xf6, 0xfd,
      0x39, 0x8b, 0x4c, 0x3a, 0x29, 0x0,  0x1b, 0x1a, 0xf7, 0x56, 0xf3, 0x99, 0x1b, 0x65, 0x5c, 0xd5, 0x3e, 0xdb, 0x1,
      0x19, 0xf4, 0x58, 0x9a, 0xfb, 0xac, 0xfe, 0x59, 0xee, 0x39, 0x52, 0xf3, 0x16, 0x13, 0xce, 0x0,  0x18, 0xcd, 0x41,
      0xf7, 0x6,  0x81, 0x36, 0xc4, 0xca, 0xc0, 0x3c, 0xd0, 0x7a, 0xea, 0x3e, 0x17, 0x12, 0xc3, 0xd0, 0xdd, 0x2,  0x11,
      0x4c, 0x92, 0x73, 0xcb, 0x1,  0x8,  0x0,  0x12, 0xf0, 0xbf, 0xbe, 0x3b, 0x97, 0x96, 0x80, 0xe8, 0xe6, 0xbd, 0xdf,
      0xd0, 0x95, 0x64, 0x5f, 0xf1, 0x69, 0xa8, 0xb,  0x3,  0x26, 0x0,  0x4,  0xff, 0xa,  0x3c, 0x3f, 0x0,  0x17, 0x61,
      0x76, 0xe7, 0x3e, 0xaa, 0x77, 0x92, 0xfe, 0xe3, 0xe1, 0x3e, 0x93, 0x88, 0x78, 0x92, 0x2,  0x3d, 0x40, 0xc0, 0x29,
      0x5f, 0x73, 0x33, 0x22, 0x68, 0x9b, 0x28, 0x95, 0x18, 0x0,  0x0,  0x19, 0x1f, 0x3,  0x0,  0x1c, 0xd0, 0x66, 0xa3,
      0x15, 0x7e, 0x6b, 0xd,  0xc0, 0x25, 0xc7, 0x4d, 0x63, 0xb9, 0xb5, 0xc2, 0x20, 0xc1, 0x17, 0xa9, 0x22, 0xff, 0x90,
      0x3d, 0x18, 0x15, 0xa8, 0x24, 0x9,  0x25, 0x6a, 0x26, 0x0,  0x12, 0xa1, 0x5d, 0xdb, 0x55, 0x85, 0x92, 0xdb, 0x8d,
      0x5f, 0xc5, 0x0,  0x6,  0x61, 0xe0, 0xc0, 0x4c, 0xc4, 0x70, 0x0,  0x8,  0x5a, 0xac, 0xd5, 0xd7, 0x94, 0xc,  0x23,
      0x2c, 0x26, 0x0,  0x1,  0xf5, 0x0,  0x1e, 0xe3, 0xc7, 0x56, 0xa9, 0xfb, 0x8d, 0xfc, 0x72, 0x94, 0xa7, 0x86, 0x73,
      0x7,  0x98, 0x11, 0xa7, 0xdf, 0xfd, 0x5e, 0xd5, 0x56, 0x56, 0x80, 0xc1, 0x6,  0x75, 0x84, 0xb7, 0xe8, 0x72, 0x23,
      0x37, 0xcf, 0x22, 0x75, 0xfb, 0x25, 0xda, 0x1a, 0x0,  0xe,  0x8e, 0x36, 0xac, 0x4a, 0x14, 0xb,  0xb,  0xef, 0x51,
      0x8b, 0xcb, 0x21, 0x26, 0xb4, 0x1c, 0x0,  0xa,  0x4d, 0x4c, 0xa5, 0xd2, 0x9a, 0xfd, 0x34, 0x8d, 0x68, 0x42, 0x0,
      0x1d, 0x8,  0x2c, 0x28, 0x5b, 0x77, 0xfd, 0xcd, 0x18, 0xa7, 0xc7, 0xee, 0x30, 0xab, 0x1,  0x6a, 0xce, 0x0,  0xf5,
      0xf3, 0x90, 0xa9, 0x8,  0xe2, 0xb4, 0x86, 0x9a, 0x7d, 0xd6, 0xc2, 0x0,  0x7,  0xb5, 0x61, 0x4f, 0x80, 0x28, 0xbc,
      0x17, 0x0,  0xc,  0x65, 0x42, 0x56, 0x30, 0x5e, 0x62, 0xe7, 0x1d, 0xfa, 0xa,  0xcb, 0xe0, 0x0,  0x14, 0xf0, 0xb1,
      0xbb, 0xf4, 0xfa, 0x63, 0x22, 0xc8, 0x50, 0x77, 0xbd, 0xa3, 0x6d, 0x7c, 0x83, 0x35, 0x2a, 0xb1, 0xa9, 0x5d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x82, 0xf8, 0x3, 0xc5, 0xca, 0xa6, 0x5d, 0xb4, 0xf, 0x9a, 0xbc, 0x79, 0x84};
  uint8_t bytesprops1[] = {0xbe, 0xc8, 0x6c, 0xf1, 0x35, 0xf5, 0x70, 0xab, 0xb7, 0xff, 0x51, 0x64, 0x14, 0x95, 0xe3};
  uint8_t bytesprops2[] = {0x48, 0x7a, 0x9d, 0x7f, 0x96, 0x90, 0x42, 0x77, 0xc2, 0x3d, 0xcb,
                           0x41, 0x26, 0x74, 0xff, 0x5,  0x48, 0xb8, 0x24, 0xe1, 0x8c};
  uint8_t bytesprops4[] = {0x24, 0x8d, 0x61, 0x2f, 0xd6, 0xc3, 0xe5, 0x28, 0xf2, 0x92, 0xd6};
  uint8_t bytesprops3[] = {0x12, 0x26, 0xac, 0x35, 0x5f, 0x3c, 0x92, 0x2c, 0xa2, 0x33, 0x5e, 0x87, 0x95, 0x3a,
                           0x8,  0xbf, 0xaa, 0xfa, 0x56, 0x4a, 0x73, 0x1a, 0xe0, 0x66, 0xba, 0xec, 0x4c};
  uint8_t bytesprops6[] = {0x53, 0x76, 0x46, 0x33, 0x92, 0x54, 0x4d, 0xdf, 0x15, 0x2,  0xbf, 0x3b, 0x0,
                           0x0,  0x23, 0x2f, 0x9f, 0xfd, 0x8,  0x81, 0x30, 0x2e, 0x19, 0xd1, 0xf7};
  uint8_t bytesprops5[] = {0xfa, 0x31, 0xec, 0x44, 0x98, 0x91, 0x89, 0x31, 0xaa};
  uint8_t bytesprops8[] = {0x93, 0x52, 0xa7, 0x9b, 0x6b};
  uint8_t bytesprops7[] = {0x40, 0xfd, 0x5e, 0xe6, 0xb4, 0xb5, 0x24, 0xf5, 0xdb, 0xf5, 0xa2, 0xe0, 0x15, 0xcc,
                           0xe7, 0xf4, 0xaf, 0xd4, 0xae, 0x66, 0x0,  0xe1, 0xba, 0xb3, 0x6b, 0x76, 0x17};
  uint8_t bytesprops9[] = {0xc8, 0xab, 0x7c, 0xe3, 0x9f, 0xca, 0xd0, 0x1e, 0x61, 0xc7};
  uint8_t bytesprops10[] = {0xd4, 0x2a, 0x9e, 0x41, 0x9a, 0xf9, 0x7f, 0xd1, 0x3c, 0xbf, 0xd, 0xa};
  uint8_t bytesprops11[] = {0x16, 0xbf, 0xdf, 0xf,  0x5f, 0xea, 0xf1, 0xa3,
                            0x2b, 0xaf, 0x57, 0xbb, 0xb8, 0x33, 0xc2, 0x1c};
  uint8_t bytesprops13[] = {0xe5, 0x2d};
  uint8_t bytesprops12[] = {0x56, 0xee, 0x96, 0x3d, 0x66, 0x77, 0xda, 0x39, 0xc8, 0x4};
  uint8_t bytesprops14[] = {0x23, 0x6d};
  uint8_t bytesprops15[] = {0xd,  0xae, 0xaa, 0x58, 0xce, 0x67, 0xba, 0xff, 0x99,
                            0x3c, 0xdc, 0x14, 0x6b, 0x71, 0x4,  0xe3, 0x57, 0x81};
  uint8_t bytesprops16[] = {0xe0, 0xfd, 0x5e, 0xb8, 0xf8, 0x78, 0xf8, 0x11, 0xb4, 0xed,
                            0xc1, 0x5f, 0x7d, 0x9b, 0x20, 0x3f, 0xd4, 0x41, 0xaf};
  uint8_t bytesprops18[] = {0x1a, 0xf7, 0x56, 0xf3, 0x99, 0x1b, 0x65, 0x5c, 0xd5, 0x3e, 0xdb, 0x1,  0x19, 0xf4,
                            0x58, 0x9a, 0xfb, 0xac, 0xfe, 0x59, 0xee, 0x39, 0x52, 0xf3, 0x16, 0x13, 0xce};
  uint8_t bytesprops17[] = {0x62, 0x8f, 0x12, 0x38, 0xdc, 0x61, 0x94, 0xc6, 0x91, 0x91, 0x36, 0xa,  0xf3, 0xb4,
                            0x1,  0x20, 0x60, 0x4e, 0x95, 0xbb, 0xac, 0xf6, 0xfd, 0x39, 0x8b, 0x4c, 0x3a, 0x29};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17354}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 205}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops3}, .v = {11, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops5}, .v = {25, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28259}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 81}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops7}, .v = {5, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 1040}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9595}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops12}, .v = {2, (char*)&bytesprops13}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {28, (char*)&bytesprops17}, .v = {27, (char*)&bytesprops18}}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0xf0, 0xbf, 0xbe, 0x3b, 0x97, 0x96, 0x80, 0xe8, 0xe6,
                               0xbd, 0xdf, 0xd0, 0x95, 0x64, 0x5f, 0xf1, 0x69, 0xa8};
  uint8_t byteswillprops2[] = {0x61, 0x76, 0xe7, 0x3e, 0xaa, 0x77, 0x92, 0xfe, 0xe3, 0xe1, 0x3e, 0x93,
                               0x88, 0x78, 0x92, 0x2,  0x3d, 0x40, 0xc0, 0x29, 0x5f, 0x73, 0x33};
  uint8_t byteswillprops1[] = {0xff, 0xa, 0x3c, 0x3f};
  uint8_t byteswillprops3[] = {0xd0, 0x66, 0xa3, 0x15, 0x7e, 0x6b, 0xd,  0xc0, 0x25, 0xc7, 0x4d, 0x63, 0xb9, 0xb5,
                               0xc2, 0x20, 0xc1, 0x17, 0xa9, 0x22, 0xff, 0x90, 0x3d, 0x18, 0x15, 0xa8, 0x24, 0x9};
  uint8_t byteswillprops5[] = {0x5a, 0xac, 0xd5, 0xd7, 0x94, 0xc, 0x23, 0x2c};
  uint8_t byteswillprops4[] = {0xa1, 0x5d, 0xdb, 0x55, 0x85, 0x92, 0xdb, 0x8d, 0x5f,
                               0xc5, 0x0,  0x6,  0x61, 0xe0, 0xc0, 0x4c, 0xc4, 0x70};
  uint8_t byteswillprops7[] = {0xe3, 0xc7, 0x56, 0xa9, 0xfb, 0x8d, 0xfc, 0x72, 0x94, 0xa7,
                               0x86, 0x73, 0x7,  0x98, 0x11, 0xa7, 0xdf, 0xfd, 0x5e, 0xd5,
                               0x56, 0x56, 0x80, 0xc1, 0x6,  0x75, 0x84, 0xb7, 0xe8, 0x72};
  uint8_t byteswillprops6[] = {0xf5};
  uint8_t byteswillprops8[] = {0x8e, 0x36, 0xac, 0x4a, 0x14, 0xb, 0xb, 0xef, 0x51, 0x8b, 0xcb, 0x21, 0x26, 0xb4};
  uint8_t byteswillprops9[] = {0x4d, 0x4c, 0xa5, 0xd2, 0x9a, 0xfd, 0x34, 0x8d, 0x68, 0x42};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {4, (char*)&byteswillprops1}, .v = {23, (char*)&byteswillprops2}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26779}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6431}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {18, (char*)&byteswillprops4}, .v = {8, (char*)&byteswillprops5}}}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {1, (char*)&byteswillprops6}, .v = {30, (char*)&byteswillprops7}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14287}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30203}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {14, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&byteswillprops9}}},
  };

  lwmqtt_properties_t willprops = {15, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x8,  0x2c, 0x28, 0x5b, 0x77, 0xfd, 0xcd, 0x18, 0xa7, 0xc7, 0xee, 0x30, 0xab, 0x1, 0x6a,
                                0xce, 0x0,  0xf5, 0xf3, 0x90, 0xa9, 0x8,  0xe2, 0xb4, 0x86, 0x9a, 0x7d, 0xd6, 0xc2};
  lwmqtt_string_t will_topic = {29, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0xb5, 0x61, 0x4f, 0x80, 0x28, 0xbc, 0x17};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 3521;
  uint8_t client_id_bytes[] = {0xcd, 0x41, 0xf7, 0x6,  0x81, 0x36, 0xc4, 0xca, 0xc0, 0x3c, 0xd0, 0x7a,
                               0xea, 0x3e, 0x17, 0x12, 0xc3, 0xd0, 0xdd, 0x2,  0x11, 0x4c, 0x92, 0x73};
  lwmqtt_string_t client_id = {24, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0x65, 0x42, 0x56, 0x30, 0x5e, 0x62, 0xe7, 0x1d, 0xfa, 0xa, 0xcb, 0xe0};
  lwmqtt_string_t username = {12, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0xf0, 0xb1, 0xbb, 0xf4, 0xfa, 0x63, 0x22, 0xc8, 0x50, 0x77,
                              0xbd, 0xa3, 0x6d, 0x7c, 0x83, 0x35, 0x2a, 0xb1, 0xa9, 0x5d};
  lwmqtt_string_t password = {20, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just
// "\v\169[\202\FS\206\145\142I\167&I\169k\b\160XudF\138\227\147V\252\193\134\197", _lastWill = Just (LastWill
// {_willRetain = True, _willQoS = QoS1, _willTopic =
// "\223\&5$\DELC3\210\149\FS\188b\147\NUL\203\&8\177\&6\141S\"\236\215C", _willMsg =
// "\137Fydy\130\218\t\246Eu\206\188[\241P\186\235\236", _willProps = [PropMessageExpiryInterval
// 2990,PropResponseInformation
// "\140\ACK\209r\251\156}\215\214\175%\201\144D\131\SOs455\STX[S\214",PropAuthenticationData
// "\206L\217Y\245FH\186@DM\249\203,c"]}), _cleanSession = True, _keepAlive = 17383, _connID =
// "\146\157\196~\185Q\216\228Q\237\164K\154M\STX\226\133\244\158\188\177 \245\198\168", _properties =
// [PropSubscriptionIdentifierAvailable 68,PropServerReference "\152)\135'\252C@\162
// Y\170ur\138\163C@:u\182r\234!\226j",PropTopicAlias 5481,PropAssignedClientIdentifier
// "\208\221\139\172\&9",PropSessionExpiryInterval 16158,PropReasonString
// "A\251\164\150K\ETB\138~\FSq[[\SI\188\252`\153\ESC{\189<",PropAuthenticationMethod
// "\168U\146\SO\224\ETB\EM\168\219\SUB\142dC\161?.\RS@\"h \\\130\179",PropMaximumQoS 213,PropServerKeepAlive
// 9294,PropTopicAlias 6235,PropContentType
// "\163\213Y\220\202@\186M\137\222\199\152\212\192wm\136\202Y\202\RS8\203p\185\aX\163\226m",PropSharedSubscriptionAvailable
// 140,PropCorrelationData "Q\182Q",PropReceiveMaximum 8023,PropSubscriptionIdentifier 4,PropRequestResponseInformation
// 133,PropRetainAvailable 18,PropResponseTopic "\191\169ND\b\142\194\215\160",PropRetainAvailable
// 116,PropServerKeepAlive 8260,PropSessionExpiryInterval 2573,PropSessionExpiryInterval 31411,PropMessageExpiryInterval
// 6846,PropReasonString "\174<\155\139\169\234r\239",PropReasonString
// "j\GS\SOH\234\252\176\160'd\137at\ACKX<\205_",PropUserProperty "\NULM\130\137Ic\162\176\141\135N:+\229\163"
// "\185Xv\184\247-\147\225\132x\171",PropContentType
// "\218\206\139C\144v\SO\248\CAN\DC1{\GSD\146\b\142\v,\235\202\210\&0\255\175:",PropAuthenticationData
// "BYW\198P\203\129&\b\186 )m\207z\189\131\ENQ\180\140\141\201\151\174\167\NAK\199",PropPayloadFormatIndicator
// 131,PropResponseTopic "O3\bd\236^\SUB\148\EOT\DC4\159b#\NAK\210"]}
TEST(Connect5QCTest, Encode28) {
  uint8_t pkt[] = {
      0x10, 0xed, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x6e, 0x43, 0xe7, 0xc7, 0x2,  0x29, 0x44, 0x1c, 0x0,
      0x19, 0x98, 0x29, 0x87, 0x27, 0xfc, 0x43, 0x40, 0xa2, 0x20, 0x59, 0xaa, 0x75, 0x72, 0x8a, 0xa3, 0x43, 0x40, 0x3a,
      0x75, 0xb6, 0x72, 0xea, 0x21, 0xe2, 0x6a, 0x23, 0x15, 0x69, 0x12, 0x0,  0x5,  0xd0, 0xdd, 0x8b, 0xac, 0x39, 0x11,
      0x0,  0x0,  0x3f, 0x1e, 0x1f, 0x0,  0x15, 0x41, 0xfb, 0xa4, 0x96, 0x4b, 0x17, 0x8a, 0x7e, 0x1c, 0x71, 0x5b, 0x5b,
      0xf,  0xbc, 0xfc, 0x60, 0x99, 0x1b, 0x7b, 0xbd, 0x3c, 0x15, 0x0,  0x18, 0xa8, 0x55, 0x92, 0xe,  0xe0, 0x17, 0x19,
      0xa8, 0xdb, 0x1a, 0x8e, 0x64, 0x43, 0xa1, 0x3f, 0x2e, 0x1e, 0x40, 0x22, 0x68, 0x20, 0x5c, 0x82, 0xb3, 0x24, 0xd5,
      0x13, 0x24, 0x4e, 0x23, 0x18, 0x5b, 0x3,  0x0,  0x1e, 0xa3, 0xd5, 0x59, 0xdc, 0xca, 0x40, 0xba, 0x4d, 0x89, 0xde,
      0xc7, 0x98, 0xd4, 0xc0, 0x77, 0x6d, 0x88, 0xca, 0x59, 0xca, 0x1e, 0x38, 0xcb, 0x70, 0xb9, 0x7,  0x58, 0xa3, 0xe2,
      0x6d, 0x2a, 0x8c, 0x9,  0x0,  0x3,  0x51, 0xb6, 0x51, 0x21, 0x1f, 0x57, 0xb,  0x4,  0x19, 0x85, 0x25, 0x12, 0x8,
      0x0,  0x9,  0xbf, 0xa9, 0x4e, 0x44, 0x8,  0x8e, 0xc2, 0xd7, 0xa0, 0x25, 0x74, 0x13, 0x20, 0x44, 0x11, 0x0,  0x0,
      0xa,  0xd,  0x11, 0x0,  0x0,  0x7a, 0xb3, 0x2,  0x0,  0x0,  0x1a, 0xbe, 0x1f, 0x0,  0x8,  0xae, 0x3c, 0x9b, 0x8b,
      0xa9, 0xea, 0x72, 0xef, 0x1f, 0x0,  0x11, 0x6a, 0x1d, 0x1,  0xea, 0xfc, 0xb0, 0xa0, 0x27, 0x64, 0x89, 0x61, 0x74,
      0x6,  0x58, 0x3c, 0xcd, 0x5f, 0x26, 0x0,  0xf,  0x0,  0x4d, 0x82, 0x89, 0x49, 0x63, 0xa2, 0xb0, 0x8d, 0x87, 0x4e,
      0x3a, 0x2b, 0xe5, 0xa3, 0x0,  0xb,  0xb9, 0x58, 0x76, 0xb8, 0xf7, 0x2d, 0x93, 0xe1, 0x84, 0x78, 0xab, 0x3,  0x0,
      0x19, 0xda, 0xce, 0x8b, 0x43, 0x90, 0x76, 0xe,  0xf8, 0x18, 0x11, 0x7b, 0x1d, 0x44, 0x92, 0x8,  0x8e, 0xb,  0x2c,
      0xeb, 0xca, 0xd2, 0x30, 0xff, 0xaf, 0x3a, 0x16, 0x0,  0x1b, 0x42, 0x59, 0x57, 0xc6, 0x50, 0xcb, 0x81, 0x26, 0x8,
      0xba, 0x20, 0x29, 0x6d, 0xcf, 0x7a, 0xbd, 0x83, 0x5,  0xb4, 0x8c, 0x8d, 0xc9, 0x97, 0xae, 0xa7, 0x15, 0xc7, 0x1,
      0x83, 0x8,  0x0,  0xf,  0x4f, 0x33, 0x8,  0x64, 0xec, 0x5e, 0x1a, 0x94, 0x4,  0x14, 0x9f, 0x62, 0x23, 0x15, 0xd2,
      0x0,  0x19, 0x92, 0x9d, 0xc4, 0x7e, 0xb9, 0x51, 0xd8, 0xe4, 0x51, 0xed, 0xa4, 0x4b, 0x9a, 0x4d, 0x2,  0xe2, 0x85,
      0xf4, 0x9e, 0xbc, 0xb1, 0x20, 0xf5, 0xc6, 0xa8, 0x32, 0x2,  0x0,  0x0,  0xb,  0xae, 0x1a, 0x0,  0x18, 0x8c, 0x6,
      0xd1, 0x72, 0xfb, 0x9c, 0x7d, 0xd7, 0xd6, 0xaf, 0x25, 0xc9, 0x90, 0x44, 0x83, 0xe,  0x73, 0x34, 0x35, 0x35, 0x2,
      0x5b, 0x53, 0xd6, 0x16, 0x0,  0xf,  0xce, 0x4c, 0xd9, 0x59, 0xf5, 0x46, 0x48, 0xba, 0x40, 0x44, 0x4d, 0xf9, 0xcb,
      0x2c, 0x63, 0x0,  0x17, 0xdf, 0x35, 0x24, 0x7f, 0x43, 0x33, 0xd2, 0x95, 0x1c, 0xbc, 0x62, 0x93, 0x0,  0xcb, 0x38,
      0xb1, 0x36, 0x8d, 0x53, 0x22, 0xec, 0xd7, 0x43, 0x0,  0x13, 0x89, 0x46, 0x79, 0x64, 0x79, 0x82, 0xda, 0x9,  0xf6,
      0x45, 0x75, 0xce, 0xbc, 0x5b, 0xf1, 0x50, 0xba, 0xeb, 0xec, 0x0,  0x1c, 0xb,  0xa9, 0x5b, 0xca, 0x1c, 0xce, 0x91,
      0x8e, 0x49, 0xa7, 0x26, 0x49, 0xa9, 0x6b, 0x8,  0xa0, 0x58, 0x75, 0x64, 0x46, 0x8a, 0xe3, 0x93, 0x56, 0xfc, 0xc1,
      0x86, 0xc5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x98, 0x29, 0x87, 0x27, 0xfc, 0x43, 0x40, 0xa2, 0x20, 0x59, 0xaa, 0x75, 0x72,
                           0x8a, 0xa3, 0x43, 0x40, 0x3a, 0x75, 0xb6, 0x72, 0xea, 0x21, 0xe2, 0x6a};
  uint8_t bytesprops1[] = {0xd0, 0xdd, 0x8b, 0xac, 0x39};
  uint8_t bytesprops2[] = {0x41, 0xfb, 0xa4, 0x96, 0x4b, 0x17, 0x8a, 0x7e, 0x1c, 0x71, 0x5b,
                           0x5b, 0xf,  0xbc, 0xfc, 0x60, 0x99, 0x1b, 0x7b, 0xbd, 0x3c};
  uint8_t bytesprops3[] = {0xa8, 0x55, 0x92, 0xe,  0xe0, 0x17, 0x19, 0xa8, 0xdb, 0x1a, 0x8e, 0x64,
                           0x43, 0xa1, 0x3f, 0x2e, 0x1e, 0x40, 0x22, 0x68, 0x20, 0x5c, 0x82, 0xb3};
  uint8_t bytesprops4[] = {0xa3, 0xd5, 0x59, 0xdc, 0xca, 0x40, 0xba, 0x4d, 0x89, 0xde, 0xc7, 0x98, 0xd4, 0xc0, 0x77,
                           0x6d, 0x88, 0xca, 0x59, 0xca, 0x1e, 0x38, 0xcb, 0x70, 0xb9, 0x7,  0x58, 0xa3, 0xe2, 0x6d};
  uint8_t bytesprops5[] = {0x51, 0xb6, 0x51};
  uint8_t bytesprops6[] = {0xbf, 0xa9, 0x4e, 0x44, 0x8, 0x8e, 0xc2, 0xd7, 0xa0};
  uint8_t bytesprops7[] = {0xae, 0x3c, 0x9b, 0x8b, 0xa9, 0xea, 0x72, 0xef};
  uint8_t bytesprops8[] = {0x6a, 0x1d, 0x1,  0xea, 0xfc, 0xb0, 0xa0, 0x27, 0x64,
                           0x89, 0x61, 0x74, 0x6,  0x58, 0x3c, 0xcd, 0x5f};
  uint8_t bytesprops10[] = {0xb9, 0x58, 0x76, 0xb8, 0xf7, 0x2d, 0x93, 0xe1, 0x84, 0x78, 0xab};
  uint8_t bytesprops9[] = {0x0, 0x4d, 0x82, 0x89, 0x49, 0x63, 0xa2, 0xb0, 0x8d, 0x87, 0x4e, 0x3a, 0x2b, 0xe5, 0xa3};
  uint8_t bytesprops11[] = {0xda, 0xce, 0x8b, 0x43, 0x90, 0x76, 0xe,  0xf8, 0x18, 0x11, 0x7b, 0x1d, 0x44,
                            0x92, 0x8,  0x8e, 0xb,  0x2c, 0xeb, 0xca, 0xd2, 0x30, 0xff, 0xaf, 0x3a};
  uint8_t bytesprops12[] = {0x42, 0x59, 0x57, 0xc6, 0x50, 0xcb, 0x81, 0x26, 0x8,  0xba, 0x20, 0x29, 0x6d, 0xcf,
                            0x7a, 0xbd, 0x83, 0x5,  0xb4, 0x8c, 0x8d, 0xc9, 0x97, 0xae, 0xa7, 0x15, 0xc7};
  uint8_t bytesprops13[] = {0x4f, 0x33, 0x8, 0x64, 0xec, 0x5e, 0x1a, 0x94, 0x4, 0x14, 0x9f, 0x62, 0x23, 0x15, 0xd2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5481}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16158}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9294}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6235}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8023}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8260}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2573}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31411}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6846}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops9}, .v = {11, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {27, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x8c, 0x6,  0xd1, 0x72, 0xfb, 0x9c, 0x7d, 0xd7, 0xd6, 0xaf, 0x25, 0xc9,
                               0x90, 0x44, 0x83, 0xe,  0x73, 0x34, 0x35, 0x35, 0x2,  0x5b, 0x53, 0xd6};
  uint8_t byteswillprops1[] = {0xce, 0x4c, 0xd9, 0x59, 0xf5, 0x46, 0x48, 0xba,
                               0x40, 0x44, 0x4d, 0xf9, 0xcb, 0x2c, 0x63};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2990}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&byteswillprops1}}},
  };

  lwmqtt_properties_t willprops = {3, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xdf, 0x35, 0x24, 0x7f, 0x43, 0x33, 0xd2, 0x95, 0x1c, 0xbc, 0x62, 0x93,
                                0x0,  0xcb, 0x38, 0xb1, 0x36, 0x8d, 0x53, 0x22, 0xec, 0xd7, 0x43};
  lwmqtt_string_t will_topic = {23, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x89, 0x46, 0x79, 0x64, 0x79, 0x82, 0xda, 0x9,  0xf6, 0x45,
                                  0x75, 0xce, 0xbc, 0x5b, 0xf1, 0x50, 0xba, 0xeb, 0xec};
  lwmqtt_string_t will_payload = {19, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS1;
  will.retained = true;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = true;
  opts.keep_alive = 17383;
  uint8_t client_id_bytes[] = {0x92, 0x9d, 0xc4, 0x7e, 0xb9, 0x51, 0xd8, 0xe4, 0x51, 0xed, 0xa4, 0x4b, 0x9a,
                               0x4d, 0x2,  0xe2, 0x85, 0xf4, 0x9e, 0xbc, 0xb1, 0x20, 0xf5, 0xc6, 0xa8};
  lwmqtt_string_t client_id = {25, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb, 0xa9, 0x5b, 0xca, 0x1c, 0xce, 0x91, 0x8e, 0x49, 0xa7, 0x26, 0x49, 0xa9, 0x6b,
                              0x8, 0xa0, 0x58, 0x75, 0x64, 0x46, 0x8a, 0xe3, 0x93, 0x56, 0xfc, 0xc1, 0x86, 0xc5};
  lwmqtt_string_t password = {28, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Just "\167\237\156Mq\176\&7F\133;p\STX\164\219,\196,U\NUL\171\ETB\144M", _password = Just
// "\150'c\159\ETX\DC2\144\212TY\230:\SOHvc'\218\154\US2#1\183\&7", _lastWill = Just (LastWill {_willRetain = False,
// _willQoS = QoS2, _willTopic = "\STX\r\249A\250?#\SI\142\224\207\203C3\203\129\232\238\f>C\SUB\149\221\198\\1",
// _willMsg = "u}g.\134\182\153", _willProps = [PropMessageExpiryInterval 24813,PropTopicAlias
// 20635,PropWillDelayInterval 25175,PropAssignedClientIdentifier
// "U^\SOH\199\132\254\SYN\190\&9H\161\243\150/\206\176\205\148\187\186",PropAuthenticationData
// "\142\254Y]\DEL\217",PropRetainAvailable 125,PropRetainAvailable 237,PropServerReference
// "\aaL\251\227\&9\137\196A\133\&6`\132$ \247+\193\219z\164",PropResponseInformation
// "\136\&4\161",PropMaximumPacketSize 22005,PropRequestResponseInformation 98,PropAuthenticationData
// "@Q\v",PropServerReference "r\184\240\247\239='>\192\172-\b\v\195\227\160\130\178\191\252\DC4\140\138\179\a
// \181\145",PropSharedSubscriptionAvailable 24,PropAuthenticationMethod
// "q\244\237\162m\ESCa\221P\220\135\a*\232\205\226\207Z",PropAssignedClientIdentifier
// "H\177c\SYN\167\251\229S\245\EOTt\156\200\191\ENQ\a\t%\211}V\157\239@\DC4",PropSubscriptionIdentifier
// 26,PropRequestResponseInformation 104,PropRequestProblemInformation 220,PropSubscriptionIdentifierAvailable
// 19,PropAuthenticationData ">\179",PropAuthenticationMethod "\130\&3d\\\139c",PropSharedSubscriptionAvailable
// 91,PropReceiveMaximum 22548,PropRequestProblemInformation 26,PropReasonString
// "\216H\217k\DC4\183\191\180\143\165\224!\141\186\n\135e\155",PropAuthenticationData
// "\186\180\ACK\SOh\157\160\RSK\170p\132\197\&10n4>\189\GS\200\ESC",PropReceiveMaximum 12897,PropMaximumQoS
// 194,PropMessageExpiryInterval 18926]}), _cleanSession = False, _keepAlive = 2013, _connID =
// "\255\RST!?\165@\128+YC\181-\250\193\183\233\&7\RS\197x\SUB[?\f\227t", _properties = [PropServerReference
// "Ae\SO\241\196\223r\ETX\160%\209g\155\255'#\182\n\RS",PropReasonString
// "f\161\155\145<a\ETX\162;0\ENQ\246\161\251\157\134\228\172r",PropSessionExpiryInterval 10790,PropResponseTopic
// "9N,3\211",PropResponseInformation "",PropContentType "\215\211\208\168f6\171\130",PropMaximumQoS 208]}
TEST(Connect5QCTest, Encode29) {
  uint8_t pkt[] = {
      0x10, 0xcf, 0x3,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0xd4, 0x7,  0xdd, 0x49, 0x1c, 0x0,  0x13, 0x41, 0x65,
      0xe,  0xf1, 0xc4, 0xdf, 0x72, 0x3,  0xa0, 0x25, 0xd1, 0x67, 0x9b, 0xff, 0x27, 0x23, 0xb6, 0xa,  0x1e, 0x1f, 0x0,
      0x13, 0x66, 0xa1, 0x9b, 0x91, 0x3c, 0x61, 0x3,  0xa2, 0x3b, 0x30, 0x5,  0xf6, 0xa1, 0xfb, 0x9d, 0x86, 0xe4, 0xac,
      0x72, 0x11, 0x0,  0x0,  0x2a, 0x26, 0x8,  0x0,  0x5,  0x39, 0x4e, 0x2c, 0x33, 0xd3, 0x1a, 0x0,  0x0,  0x3,  0x0,
      0x8,  0xd7, 0xd3, 0xd0, 0xa8, 0x66, 0x36, 0xab, 0x82, 0x24, 0xd0, 0x0,  0x1b, 0xff, 0x1e, 0x54, 0x21, 0x3f, 0xa5,
      0x40, 0x80, 0x2b, 0x59, 0x43, 0xb5, 0x2d, 0xfa, 0xc1, 0xb7, 0xe9, 0x37, 0x1e, 0xc5, 0x78, 0x1a, 0x5b, 0x3f, 0xc,
      0xe3, 0x74, 0x83, 0x2,  0x2,  0x0,  0x0,  0x60, 0xed, 0x23, 0x50, 0x9b, 0x18, 0x0,  0x0,  0x62, 0x57, 0x12, 0x0,
      0x14, 0x55, 0x5e, 0x1,  0xc7, 0x84, 0xfe, 0x16, 0xbe, 0x39, 0x48, 0xa1, 0xf3, 0x96, 0x2f, 0xce, 0xb0, 0xcd, 0x94,
      0xbb, 0xba, 0x16, 0x0,  0x6,  0x8e, 0xfe, 0x59, 0x5d, 0x7f, 0xd9, 0x25, 0x7d, 0x25, 0xed, 0x1c, 0x0,  0x15, 0x7,
      0x61, 0x4c, 0xfb, 0xe3, 0x39, 0x89, 0xc4, 0x41, 0x85, 0x36, 0x60, 0x84, 0x24, 0x20, 0xf7, 0x2b, 0xc1, 0xdb, 0x7a,
      0xa4, 0x1a, 0x0,  0x3,  0x88, 0x34, 0xa1, 0x27, 0x0,  0x0,  0x55, 0xf5, 0x19, 0x62, 0x16, 0x0,  0x3,  0x40, 0x51,
      0xb,  0x1c, 0x0,  0x1c, 0x72, 0xb8, 0xf0, 0xf7, 0xef, 0x3d, 0x27, 0x3e, 0xc0, 0xac, 0x2d, 0x8,  0xb,  0xc3, 0xe3,
      0xa0, 0x82, 0xb2, 0xbf, 0xfc, 0x14, 0x8c, 0x8a, 0xb3, 0x7,  0x20, 0xb5, 0x91, 0x2a, 0x18, 0x15, 0x0,  0x12, 0x71,
      0xf4, 0xed, 0xa2, 0x6d, 0x1b, 0x61, 0xdd, 0x50, 0xdc, 0x87, 0x7,  0x2a, 0xe8, 0xcd, 0xe2, 0xcf, 0x5a, 0x12, 0x0,
      0x19, 0x48, 0xb1, 0x63, 0x16, 0xa7, 0xfb, 0xe5, 0x53, 0xf5, 0x4,  0x74, 0x9c, 0xc8, 0xbf, 0x5,  0x7,  0x9,  0x25,
      0xd3, 0x7d, 0x56, 0x9d, 0xef, 0x40, 0x14, 0xb,  0x1a, 0x19, 0x68, 0x17, 0xdc, 0x29, 0x13, 0x16, 0x0,  0x2,  0x3e,
      0xb3, 0x15, 0x0,  0x6,  0x82, 0x33, 0x64, 0x5c, 0x8b, 0x63, 0x2a, 0x5b, 0x21, 0x58, 0x14, 0x17, 0x1a, 0x1f, 0x0,
      0x12, 0xd8, 0x48, 0xd9, 0x6b, 0x14, 0xb7, 0xbf, 0xb4, 0x8f, 0xa5, 0xe0, 0x21, 0x8d, 0xba, 0xa,  0x87, 0x65, 0x9b,
      0x16, 0x0,  0x16, 0xba, 0xb4, 0x6,  0xe,  0x68, 0x9d, 0xa0, 0x1e, 0x4b, 0xaa, 0x70, 0x84, 0xc5, 0x31, 0x30, 0x6e,
      0x34, 0x3e, 0xbd, 0x1d, 0xc8, 0x1b, 0x21, 0x32, 0x61, 0x24, 0xc2, 0x2,  0x0,  0x0,  0x49, 0xee, 0x0,  0x1b, 0x2,
      0xd,  0xf9, 0x41, 0xfa, 0x3f, 0x23, 0xf,  0x8e, 0xe0, 0xcf, 0xcb, 0x43, 0x33, 0xcb, 0x81, 0xe8, 0xee, 0xc,  0x3e,
      0x43, 0x1a, 0x95, 0xdd, 0xc6, 0x5c, 0x31, 0x0,  0x7,  0x75, 0x7d, 0x67, 0x2e, 0x86, 0xb6, 0x99, 0x0,  0x17, 0xa7,
      0xed, 0x9c, 0x4d, 0x71, 0xb0, 0x37, 0x46, 0x85, 0x3b, 0x70, 0x2,  0xa4, 0xdb, 0x2c, 0xc4, 0x2c, 0x55, 0x0,  0xab,
      0x17, 0x90, 0x4d, 0x0,  0x18, 0x96, 0x27, 0x63, 0x9f, 0x3,  0x12, 0x90, 0xd4, 0x54, 0x59, 0xe6, 0x3a, 0x1,  0x76,
      0x63, 0x27, 0xda, 0x9a, 0x1f, 0x32, 0x23, 0x31, 0xb7, 0x37};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x41, 0x65, 0xe,  0xf1, 0xc4, 0xdf, 0x72, 0x3, 0xa0, 0x25,
                           0xd1, 0x67, 0x9b, 0xff, 0x27, 0x23, 0xb6, 0xa, 0x1e};
  uint8_t bytesprops1[] = {0x66, 0xa1, 0x9b, 0x91, 0x3c, 0x61, 0x3,  0xa2, 0x3b, 0x30,
                           0x5,  0xf6, 0xa1, 0xfb, 0x9d, 0x86, 0xe4, 0xac, 0x72};
  uint8_t bytesprops2[] = {0x39, 0x4e, 0x2c, 0x33, 0xd3};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xd7, 0xd3, 0xd0, 0xa8, 0x66, 0x36, 0xab, 0x82};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10790}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 208}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x55, 0x5e, 0x1,  0xc7, 0x84, 0xfe, 0x16, 0xbe, 0x39, 0x48,
                               0xa1, 0xf3, 0x96, 0x2f, 0xce, 0xb0, 0xcd, 0x94, 0xbb, 0xba};
  uint8_t byteswillprops1[] = {0x8e, 0xfe, 0x59, 0x5d, 0x7f, 0xd9};
  uint8_t byteswillprops2[] = {0x7,  0x61, 0x4c, 0xfb, 0xe3, 0x39, 0x89, 0xc4, 0x41, 0x85, 0x36,
                               0x60, 0x84, 0x24, 0x20, 0xf7, 0x2b, 0xc1, 0xdb, 0x7a, 0xa4};
  uint8_t byteswillprops3[] = {0x88, 0x34, 0xa1};
  uint8_t byteswillprops4[] = {0x40, 0x51, 0xb};
  uint8_t byteswillprops5[] = {0x72, 0xb8, 0xf0, 0xf7, 0xef, 0x3d, 0x27, 0x3e, 0xc0, 0xac, 0x2d, 0x8,  0xb,  0xc3,
                               0xe3, 0xa0, 0x82, 0xb2, 0xbf, 0xfc, 0x14, 0x8c, 0x8a, 0xb3, 0x7,  0x20, 0xb5, 0x91};
  uint8_t byteswillprops6[] = {0x71, 0xf4, 0xed, 0xa2, 0x6d, 0x1b, 0x61, 0xdd, 0x50,
                               0xdc, 0x87, 0x7,  0x2a, 0xe8, 0xcd, 0xe2, 0xcf, 0x5a};
  uint8_t byteswillprops7[] = {0x48, 0xb1, 0x63, 0x16, 0xa7, 0xfb, 0xe5, 0x53, 0xf5, 0x4,  0x74, 0x9c, 0xc8,
                               0xbf, 0x5,  0x7,  0x9,  0x25, 0xd3, 0x7d, 0x56, 0x9d, 0xef, 0x40, 0x14};
  uint8_t byteswillprops8[] = {0x3e, 0xb3};
  uint8_t byteswillprops9[] = {0x82, 0x33, 0x64, 0x5c, 0x8b, 0x63};
  uint8_t byteswillprops10[] = {0xd8, 0x48, 0xd9, 0x6b, 0x14, 0xb7, 0xbf, 0xb4, 0x8f,
                                0xa5, 0xe0, 0x21, 0x8d, 0xba, 0xa,  0x87, 0x65, 0x9b};
  uint8_t byteswillprops11[] = {0xba, 0xb4, 0x6,  0xe,  0x68, 0x9d, 0xa0, 0x1e, 0x4b, 0xaa, 0x70,
                                0x84, 0xc5, 0x31, 0x30, 0x6e, 0x34, 0x3e, 0xbd, 0x1d, 0xc8, 0x1b};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24813}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20635}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25175}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&byteswillprops3}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22005}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 98}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&byteswillprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&byteswillprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&byteswillprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&byteswillprops7}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 220}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&byteswillprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {6, (char*)&byteswillprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 91}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 22548}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&byteswillprops10}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&byteswillprops11}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12897}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18926}},
  };

  lwmqtt_properties_t willprops = {30, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0x2,  0xd,  0xf9, 0x41, 0xfa, 0x3f, 0x23, 0xf,  0x8e, 0xe0, 0xcf, 0xcb, 0x43, 0x33,
                                0xcb, 0x81, 0xe8, 0xee, 0xc,  0x3e, 0x43, 0x1a, 0x95, 0xdd, 0xc6, 0x5c, 0x31};
  lwmqtt_string_t will_topic = {27, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x75, 0x7d, 0x67, 0x2e, 0x86, 0xb6, 0x99};
  lwmqtt_string_t will_payload = {7, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 2013;
  uint8_t client_id_bytes[] = {0xff, 0x1e, 0x54, 0x21, 0x3f, 0xa5, 0x40, 0x80, 0x2b, 0x59, 0x43, 0xb5, 0x2d, 0xfa,
                               0xc1, 0xb7, 0xe9, 0x37, 0x1e, 0xc5, 0x78, 0x1a, 0x5b, 0x3f, 0xc,  0xe3, 0x74};
  lwmqtt_string_t client_id = {27, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t username_bytes[] = {0xa7, 0xed, 0x9c, 0x4d, 0x71, 0xb0, 0x37, 0x46, 0x85, 0x3b, 0x70, 0x2,
                              0xa4, 0xdb, 0x2c, 0xc4, 0x2c, 0x55, 0x0,  0xab, 0x17, 0x90, 0x4d};
  lwmqtt_string_t username = {23, (char*)&username_bytes};
  opts.username = username;
  uint8_t password_bytes[] = {0x96, 0x27, 0x63, 0x9f, 0x3,  0x12, 0x90, 0xd4, 0x54, 0x59, 0xe6, 0x3a,
                              0x1,  0x76, 0x63, 0x27, 0xda, 0x9a, 0x1f, 0x32, 0x23, 0x31, 0xb7, 0x37};
  lwmqtt_string_t password = {24, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// ConnectRequest {_username = Nothing, _password = Just "\182\240\189\t", _lastWill = Just (LastWill {_willRetain =
// False, _willQoS = QoS2, _willTopic = "\187M\164\160l,v\190\218\204Q\220\172R\151\151>", _willMsg =
// "B\157i\190\132.u\233\158\DC3\242]\255\133\181\186\255Z\240\188\227", _willProps = [PropAuthenticationMethod
// "\EOT\171\240\148",PropServerKeepAlive 18994,PropRetainAvailable 198,PropServerReference
// ".:\205\237\187\NUL\129@\167\158F\223I\252\239\&9\155\STX\STXUQ",PropMaximumQoS 182,PropRequestProblemInformation
// 92,PropTopicAliasMaximum 7274,PropSubscriptionIdentifier 29,PropWillDelayInterval 752,PropReasonString
// "\146\135\&0.\224\t@",PropWillDelayInterval 5328,PropSharedSubscriptionAvailable 117,PropUserProperty
// "\232\232\166\143\226\176R\250w\176\ACKM\ETX\157\tQ"
// "\219O\163\EM\179\152\179'\182(\133\210\SOm\207E\150`\215\&0\245\189"]}), _cleanSession = False, _keepAlive = 1282,
// _connID = "(\191\136\201\182\228\133S\r\250\189X", _properties = [PropPayloadFormatIndicator
// 103,PropAssignedClientIdentifier "",PropSharedSubscriptionAvailable 126,PropMessageExpiryInterval
// 21203,PropWillDelayInterval 6069,PropTopicAlias 24514,PropSubscriptionIdentifierAvailable
// 165,PropSubscriptionIdentifier 15,PropResponseInformation
// "\CAN\212\SYNL\206\253\211\192\224f\242\249D:H;\228\221",PropMessageExpiryInterval 435,PropTopicAliasMaximum
// 85,PropSubscriptionIdentifier 10,PropSessionExpiryInterval 15646,PropMessageExpiryInterval
// 11202,PropSharedSubscriptionAvailable 62,PropCorrelationData
// "o\236:+\144R\r\154\NAK\\\138\219\145\192\&7\204\170\&4B\DC1\134o0CJ\ETB",PropResponseInformation
// "%w[\185\DLE\177\155\SOH0\130\STX)\211\153\SOH\131\213\US\181\DC1\144",PropRequestResponseInformation
// 138,PropAuthenticationMethod
// "@\194x\155\&0N\NULG0n\186\GS\161~@\240\209\159\142\\\b\142\r|9\152`:Iu",PropUserProperty
// "D\171\198\148\177/\164\167\203"
// "\216f\220\163\141\SYN\184\v\NAK\237\&9P^\129\135\SUBY.",PropWildcardSubscriptionAvailable 20]}
TEST(Connect5QCTest, Encode30) {
  uint8_t pkt[] = {
      0x10, 0xf6, 0x2,  0x0,  0x4,  0x4d, 0x51, 0x54, 0x54, 0x5,  0x54, 0x5,  0x2,  0xbd, 0x1,  0x1,  0x67, 0x12, 0x0,
      0x0,  0x2a, 0x7e, 0x2,  0x0,  0x0,  0x52, 0xd3, 0x18, 0x0,  0x0,  0x17, 0xb5, 0x23, 0x5f, 0xc2, 0x29, 0xa5, 0xb,
      0xf,  0x1a, 0x0,  0x12, 0x18, 0xd4, 0x16, 0x4c, 0xce, 0xfd, 0xd3, 0xc0, 0xe0, 0x66, 0xf2, 0xf9, 0x44, 0x3a, 0x48,
      0x3b, 0xe4, 0xdd, 0x2,  0x0,  0x0,  0x1,  0xb3, 0x22, 0x0,  0x55, 0xb,  0xa,  0x11, 0x0,  0x0,  0x3d, 0x1e, 0x2,
      0x0,  0x0,  0x2b, 0xc2, 0x2a, 0x3e, 0x9,  0x0,  0x1a, 0x6f, 0xec, 0x3a, 0x2b, 0x90, 0x52, 0xd,  0x9a, 0x15, 0x5c,
      0x8a, 0xdb, 0x91, 0xc0, 0x37, 0xcc, 0xaa, 0x34, 0x42, 0x11, 0x86, 0x6f, 0x30, 0x43, 0x4a, 0x17, 0x1a, 0x0,  0x15,
      0x25, 0x77, 0x5b, 0xb9, 0x10, 0xb1, 0x9b, 0x1,  0x30, 0x82, 0x2,  0x29, 0xd3, 0x99, 0x1,  0x83, 0xd5, 0x1f, 0xb5,
      0x11, 0x90, 0x19, 0x8a, 0x15, 0x0,  0x1e, 0x40, 0xc2, 0x78, 0x9b, 0x30, 0x4e, 0x0,  0x47, 0x30, 0x6e, 0xba, 0x1d,
      0xa1, 0x7e, 0x40, 0xf0, 0xd1, 0x9f, 0x8e, 0x5c, 0x8,  0x8e, 0xd,  0x7c, 0x39, 0x98, 0x60, 0x3a, 0x49, 0x75, 0x26,
      0x0,  0x9,  0x44, 0xab, 0xc6, 0x94, 0xb1, 0x2f, 0xa4, 0xa7, 0xcb, 0x0,  0x12, 0xd8, 0x66, 0xdc, 0xa3, 0x8d, 0x16,
      0xb8, 0xb,  0x15, 0xed, 0x39, 0x50, 0x5e, 0x81, 0x87, 0x1a, 0x59, 0x2e, 0x28, 0x14, 0x0,  0xc,  0x28, 0xbf, 0x88,
      0xc9, 0xb6, 0xe4, 0x85, 0x53, 0xd,  0xfa, 0xbd, 0x58, 0x6e, 0x15, 0x0,  0x4,  0x4,  0xab, 0xf0, 0x94, 0x13, 0x4a,
      0x32, 0x25, 0xc6, 0x1c, 0x0,  0x15, 0x2e, 0x3a, 0xcd, 0xed, 0xbb, 0x0,  0x81, 0x40, 0xa7, 0x9e, 0x46, 0xdf, 0x49,
      0xfc, 0xef, 0x39, 0x9b, 0x2,  0x2,  0x55, 0x51, 0x24, 0xb6, 0x17, 0x5c, 0x22, 0x1c, 0x6a, 0xb,  0x1d, 0x18, 0x0,
      0x0,  0x2,  0xf0, 0x1f, 0x0,  0x7,  0x92, 0x87, 0x30, 0x2e, 0xe0, 0x9,  0x40, 0x18, 0x0,  0x0,  0x14, 0xd0, 0x2a,
      0x75, 0x26, 0x0,  0x10, 0xe8, 0xe8, 0xa6, 0x8f, 0xe2, 0xb0, 0x52, 0xfa, 0x77, 0xb0, 0x6,  0x4d, 0x3,  0x9d, 0x9,
      0x51, 0x0,  0x16, 0xdb, 0x4f, 0xa3, 0x19, 0xb3, 0x98, 0xb3, 0x27, 0xb6, 0x28, 0x85, 0xd2, 0xe,  0x6d, 0xcf, 0x45,
      0x96, 0x60, 0xd7, 0x30, 0xf5, 0xbd, 0x0,  0x11, 0xbb, 0x4d, 0xa4, 0xa0, 0x6c, 0x2c, 0x76, 0xbe, 0xda, 0xcc, 0x51,
      0xdc, 0xac, 0x52, 0x97, 0x97, 0x3e, 0x0,  0x15, 0x42, 0x9d, 0x69, 0xbe, 0x84, 0x2e, 0x75, 0xe9, 0x9e, 0x13, 0xf2,
      0x5d, 0xff, 0x85, 0xb5, 0xba, 0xff, 0x5a, 0xf0, 0xbc, 0xe3, 0x0,  0x4,  0xb6, 0xf0, 0xbd, 0x9};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops1[] = {0x18, 0xd4, 0x16, 0x4c, 0xce, 0xfd, 0xd3, 0xc0, 0xe0,
                           0x66, 0xf2, 0xf9, 0x44, 0x3a, 0x48, 0x3b, 0xe4, 0xdd};
  uint8_t bytesprops2[] = {0x6f, 0xec, 0x3a, 0x2b, 0x90, 0x52, 0xd,  0x9a, 0x15, 0x5c, 0x8a, 0xdb, 0x91,
                           0xc0, 0x37, 0xcc, 0xaa, 0x34, 0x42, 0x11, 0x86, 0x6f, 0x30, 0x43, 0x4a, 0x17};
  uint8_t bytesprops3[] = {0x25, 0x77, 0x5b, 0xb9, 0x10, 0xb1, 0x9b, 0x1,  0x30, 0x82, 0x2,
                           0x29, 0xd3, 0x99, 0x1,  0x83, 0xd5, 0x1f, 0xb5, 0x11, 0x90};
  uint8_t bytesprops4[] = {0x40, 0xc2, 0x78, 0x9b, 0x30, 0x4e, 0x0,  0x47, 0x30, 0x6e, 0xba, 0x1d, 0xa1, 0x7e, 0x40,
                           0xf0, 0xd1, 0x9f, 0x8e, 0x5c, 0x8,  0x8e, 0xd,  0x7c, 0x39, 0x98, 0x60, 0x3a, 0x49, 0x75};
  uint8_t bytesprops6[] = {0xd8, 0x66, 0xdc, 0xa3, 0x8d, 0x16, 0xb8, 0xb,  0x15,
                           0xed, 0x39, 0x50, 0x5e, 0x81, 0x87, 0x1a, 0x59, 0x2e};
  uint8_t bytesprops5[] = {0x44, 0xab, 0xc6, 0x94, 0xb1, 0x2f, 0xa4, 0xa7, 0xcb};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21203}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6069}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24514}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 435}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 85}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15646}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11202}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 62}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops5}, .v = {18, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  lwmqtt_will_t will = lwmqtt_default_will;
  uint8_t byteswillprops0[] = {0x4, 0xab, 0xf0, 0x94};
  uint8_t byteswillprops1[] = {0x2e, 0x3a, 0xcd, 0xed, 0xbb, 0x0,  0x81, 0x40, 0xa7, 0x9e, 0x46,
                               0xdf, 0x49, 0xfc, 0xef, 0x39, 0x9b, 0x2,  0x2,  0x55, 0x51};
  uint8_t byteswillprops2[] = {0x92, 0x87, 0x30, 0x2e, 0xe0, 0x9, 0x40};
  uint8_t byteswillprops4[] = {0xdb, 0x4f, 0xa3, 0x19, 0xb3, 0x98, 0xb3, 0x27, 0xb6, 0x28, 0x85,
                               0xd2, 0xe,  0x6d, 0xcf, 0x45, 0x96, 0x60, 0xd7, 0x30, 0xf5, 0xbd};
  uint8_t byteswillprops3[] = {0xe8, 0xe8, 0xa6, 0x8f, 0xe2, 0xb0, 0x52, 0xfa,
                               0x77, 0xb0, 0x6,  0x4d, 0x3,  0x9d, 0x9,  0x51};

  lwmqtt_property_t willpropslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {4, (char*)&byteswillprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18994}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&byteswillprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7274}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 752}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {7, (char*)&byteswillprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5328}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {16, (char*)&byteswillprops3}, .v = {22, (char*)&byteswillprops4}}}},
  };

  lwmqtt_properties_t willprops = {13, (lwmqtt_property_t*)&willpropslist};
  uint8_t will_topic_bytes[] = {0xbb, 0x4d, 0xa4, 0xa0, 0x6c, 0x2c, 0x76, 0xbe, 0xda,
                                0xcc, 0x51, 0xdc, 0xac, 0x52, 0x97, 0x97, 0x3e};
  lwmqtt_string_t will_topic = {17, (char*)&will_topic_bytes};
  uint8_t will_payload_bytes[] = {0x42, 0x9d, 0x69, 0xbe, 0x84, 0x2e, 0x75, 0xe9, 0x9e, 0x13, 0xf2,
                                  0x5d, 0xff, 0x85, 0xb5, 0xba, 0xff, 0x5a, 0xf0, 0xbc, 0xe3};
  lwmqtt_string_t will_payload = {21, (char*)&will_payload_bytes};
  will.topic = will_topic;
  will.payload = will_payload;
  will.qos = LWMQTT_QOS2;
  will.retained = false;
  will.properties = willprops;
  lwmqtt_options_t opts = lwmqtt_default_options;
  opts.properties = props;
  opts.clean_session = false;
  opts.keep_alive = 1282;
  uint8_t client_id_bytes[] = {0x28, 0xbf, 0x88, 0xc9, 0xb6, 0xe4, 0x85, 0x53, 0xd, 0xfa, 0xbd, 0x58};
  lwmqtt_string_t client_id = {12, (char*)&client_id_bytes};
  opts.client_id = client_id;
  uint8_t password_bytes[] = {0xb6, 0xf0, 0xbd, 0x9};
  lwmqtt_string_t password = {4, (char*)&password_bytes};
  opts.password = password;
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_connect(buf, sizeof(buf), &len, LWMQTT_MQTT5, opts, &will);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28306 [("^VR\US\DELZ\SYN\186#\147D\230\US:\188\210\186\165}\145tM\224\&4\158",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\146\&4\203\145\SUB\209\235\223`.\147\&8\250Q\187\223\244\210b\235p\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\205\151*/E\ETXy",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("m\136\t\NUL\228\154\166\199TU&2\143",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x51, 0x6e, 0x92, 0x0,  0x19, 0x5e, 0x56, 0x52, 0x1f, 0x7f, 0x5a, 0x16, 0xba, 0x23, 0x93, 0x44,
                   0xe6, 0x1f, 0x3a, 0xbc, 0xd2, 0xba, 0xa5, 0x7d, 0x91, 0x74, 0x4d, 0xe0, 0x34, 0x9e, 0x2,  0x0,  0x16,
                   0x92, 0x34, 0xcb, 0x91, 0x1a, 0xd1, 0xeb, 0xdf, 0x60, 0x2e, 0x93, 0x38, 0xfa, 0x51, 0xbb, 0xdf, 0xf4,
                   0xd2, 0x62, 0xeb, 0x70, 0x1e, 0x0,  0x0,  0x7,  0xcd, 0x97, 0x2a, 0x2f, 0x45, 0x3,  0x79, 0x2,  0x0,
                   0xd,  0x6d, 0x88, 0x9,  0x0,  0xe4, 0x9a, 0xa6, 0xc7, 0x54, 0x55, 0x26, 0x32, 0x8f, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x5e, 0x56, 0x52, 0x1f, 0x7f, 0x5a, 0x16, 0xba, 0x23, 0x93, 0x44, 0xe6, 0x1f,
                                     0x3a, 0xbc, 0xd2, 0xba, 0xa5, 0x7d, 0x91, 0x74, 0x4d, 0xe0, 0x34, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x92, 0x34, 0xcb, 0x91, 0x1a, 0xd1, 0xeb, 0xdf, 0x60, 0x2e, 0x93,
                                     0x38, 0xfa, 0x51, 0xbb, 0xdf, 0xf4, 0xd2, 0x62, 0xeb, 0x70, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xcd, 0x97, 0x2a, 0x2f, 0x45, 0x3, 0x79};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6d, 0x88, 0x9, 0x0, 0xe4, 0x9a, 0xa6, 0xc7, 0x54, 0x55, 0x26, 0x32, 0x8f};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28306, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13416 [("\r\166\147\EM\SI{\SOH\234l\226\237]\132$!)Y%\182 \DC3\174-C\164D\FS\145@",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",\156\&5\239\239:@",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("#\138\nSgRd\ACKU\180\186\145R\159\249/\EM\142 \146X\228I33\178#",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(";\130\229\172!\203|",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("R\183\NUL\247G\201\192\NAKw\152.p\230\DEL\208\197!\243e\167\203",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x6c, 0x34, 0x68, 0x0,  0x1d, 0xd,  0xa6, 0x93, 0x19, 0xf,  0x7b, 0x1,  0xea, 0x6c, 0xe2,
                   0xed, 0x5d, 0x84, 0x24, 0x21, 0x29, 0x59, 0x25, 0xb6, 0x20, 0x13, 0xae, 0x2d, 0x43, 0xa4, 0x44,
                   0x1c, 0x91, 0x40, 0x0,  0x0,  0x7,  0x2c, 0x9c, 0x35, 0xef, 0xef, 0x3a, 0x40, 0x2,  0x0,  0x1b,
                   0x23, 0x8a, 0xa,  0x53, 0x67, 0x52, 0x64, 0x6,  0x55, 0xb4, 0xba, 0x91, 0x52, 0x9f, 0xf9, 0x2f,
                   0x19, 0x8e, 0x20, 0x92, 0x58, 0xe4, 0x49, 0x33, 0x33, 0xb2, 0x23, 0x0,  0x0,  0x7,  0x3b, 0x82,
                   0xe5, 0xac, 0x21, 0xcb, 0x7c, 0x2,  0x0,  0x15, 0x52, 0xb7, 0x0,  0xf7, 0x47, 0xc9, 0xc0, 0x15,
                   0x77, 0x98, 0x2e, 0x70, 0xe6, 0x7f, 0xd0, 0xc5, 0x21, 0xf3, 0x65, 0xa7, 0xcb, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xd,  0xa6, 0x93, 0x19, 0xf,  0x7b, 0x1,  0xea, 0x6c, 0xe2,
                                     0xed, 0x5d, 0x84, 0x24, 0x21, 0x29, 0x59, 0x25, 0xb6, 0x20,
                                     0x13, 0xae, 0x2d, 0x43, 0xa4, 0x44, 0x1c, 0x91, 0x40};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2c, 0x9c, 0x35, 0xef, 0xef, 0x3a, 0x40};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x23, 0x8a, 0xa,  0x53, 0x67, 0x52, 0x64, 0x6,  0x55, 0xb4, 0xba, 0x91, 0x52, 0x9f,
                                     0xf9, 0x2f, 0x19, 0x8e, 0x20, 0x92, 0x58, 0xe4, 0x49, 0x33, 0x33, 0xb2, 0x23};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3b, 0x82, 0xe5, 0xac, 0x21, 0xcb, 0x7c};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x52, 0xb7, 0x0,  0xf7, 0x47, 0xc9, 0xc0, 0x15, 0x77, 0x98, 0x2e,
                                     0x70, 0xe6, 0x7f, 0xd0, 0xc5, 0x21, 0xf3, 0x65, 0xa7, 0xcb};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 13416, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19505 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("\193~\153\213\236\138\165\192;P\209\245\207",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\154\DC41*\134\182g\t'\129\&1\ETX\186_\STX\SYNks\SI\235P",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1f,]@\243\146\195\138U\CAN\153B\215M8\229X?",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("k\241\"\130\130\f=\CANf\154\172\152E",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("W\235/\243\DLE",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS1}),("\168\164\163wJ",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS2}),("\229\237\196\180\216\NAK\196\157'\221z\153\239-\EOT\202X\ENQK\177YOB+",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("RLl\155O\151\a\202]\163\201\221\153L+]\180\223\205\130\DC2h\NUL)\250\252\213\DC4",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0x82, 0x9d, 0x1,  0x4c, 0x31, 0x0,  0x0,  0x0,  0x0,  0xd,  0xc1, 0x7e, 0x99, 0xd5, 0xec, 0x8a,
                   0xa5, 0xc0, 0x3b, 0x50, 0xd1, 0xf5, 0xcf, 0x1,  0x0,  0x15, 0x9a, 0x14, 0x31, 0x2a, 0x86, 0xb6,
                   0x67, 0x9,  0x27, 0x81, 0x31, 0x3,  0xba, 0x5f, 0x2,  0x16, 0x6b, 0x73, 0xf,  0xeb, 0x50, 0x0,
                   0x0,  0x13, 0x31, 0x66, 0x2c, 0x5d, 0x40, 0xf3, 0x92, 0xc3, 0x8a, 0x55, 0x18, 0x99, 0x42, 0xd7,
                   0x4d, 0x38, 0xe5, 0x58, 0x3f, 0x1,  0x0,  0xd,  0x6b, 0xf1, 0x22, 0x82, 0x82, 0xc,  0x3d, 0x18,
                   0x66, 0x9a, 0xac, 0x98, 0x45, 0x0,  0x0,  0x5,  0x57, 0xeb, 0x2f, 0xf3, 0x10, 0x1,  0x0,  0x5,
                   0xa8, 0xa4, 0xa3, 0x77, 0x4a, 0x2,  0x0,  0x18, 0xe5, 0xed, 0xc4, 0xb4, 0xd8, 0x15, 0xc4, 0x9d,
                   0x27, 0xdd, 0x7a, 0x99, 0xef, 0x2d, 0x4,  0xca, 0x58, 0x5,  0x4b, 0xb1, 0x59, 0x4f, 0x42, 0x2b,
                   0x1,  0x0,  0x1c, 0x52, 0x4c, 0x6c, 0x9b, 0x4f, 0x97, 0x7,  0xca, 0x5d, 0xa3, 0xc9, 0xdd, 0x99,
                   0x4c, 0x2b, 0x5d, 0xb4, 0xdf, 0xcd, 0x82, 0x12, 0x68, 0x0,  0x29, 0xfa, 0xfc, 0xd5, 0x14, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc1, 0x7e, 0x99, 0xd5, 0xec, 0x8a, 0xa5, 0xc0, 0x3b, 0x50, 0xd1, 0xf5, 0xcf};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9a, 0x14, 0x31, 0x2a, 0x86, 0xb6, 0x67, 0x9, 0x27, 0x81, 0x31,
                                     0x3,  0xba, 0x5f, 0x2,  0x16, 0x6b, 0x73, 0xf, 0xeb, 0x50};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x31, 0x66, 0x2c, 0x5d, 0x40, 0xf3, 0x92, 0xc3, 0x8a, 0x55,
                                     0x18, 0x99, 0x42, 0xd7, 0x4d, 0x38, 0xe5, 0x58, 0x3f};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x6b, 0xf1, 0x22, 0x82, 0x82, 0xc, 0x3d, 0x18, 0x66, 0x9a, 0xac, 0x98, 0x45};
  lwmqtt_string_t topic_filter_s4 = {13, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x57, 0xeb, 0x2f, 0xf3, 0x10};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa8, 0xa4, 0xa3, 0x77, 0x4a};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe5, 0xed, 0xc4, 0xb4, 0xd8, 0x15, 0xc4, 0x9d, 0x27, 0xdd, 0x7a, 0x99,
                                     0xef, 0x2d, 0x4,  0xca, 0x58, 0x5,  0x4b, 0xb1, 0x59, 0x4f, 0x42, 0x2b};
  lwmqtt_string_t topic_filter_s7 = {24, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x52, 0x4c, 0x6c, 0x9b, 0x4f, 0x97, 0x7,  0xca, 0x5d, 0xa3,
                                     0xc9, 0xdd, 0x99, 0x4c, 0x2b, 0x5d, 0xb4, 0xdf, 0xcd, 0x82,
                                     0x12, 0x68, 0x0,  0x29, 0xfa, 0xfc, 0xd5, 0x14};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19505, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22696 [("i\\\ETB]\223\172\230\167S\161\b\f\181\140\230\235\211\199\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\167",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\167E\206\237eq!\244c\192\133\243\244",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\150\245e",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\156\133~]\132@\193",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\RS\145\206)
// \b\156\205\226\161RF\ETX\DC3\144q\211\212pm]%6\185\228\189p",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\188*F\240k\177\DEL\179Z\238a\160$\225\245*\135(\DC2q",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\197\168cf\214e\153\EM_T\211\151;\179\163\164
// \135\158\193\SOH",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("C\133\193\&1\150FS\ESC\227S;\138I\ETX\SUB",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\148\241Hb\144[\206)\160\178w",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("HG\190\249\226\171Bd;n\226\240\138\157R\188\178\139",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0x82, 0xbe, 0x1,  0x58, 0xa8, 0x0,  0x13, 0x69, 0x5c, 0x17, 0x5d, 0xdf, 0xac, 0xe6, 0xa7, 0x53, 0xa1,
                   0x8,  0xc,  0xb5, 0x8c, 0xe6, 0xeb, 0xd3, 0xc7, 0x1e, 0x0,  0x0,  0x1,  0xa7, 0x0,  0x0,  0xd,  0xa7,
                   0x45, 0xce, 0xed, 0x65, 0x71, 0x21, 0xf4, 0x63, 0xc0, 0x85, 0xf3, 0xf4, 0x2,  0x0,  0x3,  0x96, 0xf5,
                   0x65, 0x2,  0x0,  0x7,  0x9c, 0x85, 0x7e, 0x5d, 0x84, 0x40, 0xc1, 0x2,  0x0,  0x1b, 0x1e, 0x91, 0xce,
                   0x29, 0x20, 0x8,  0x9c, 0xcd, 0xe2, 0xa1, 0x52, 0x46, 0x3,  0x13, 0x90, 0x71, 0xd3, 0xd4, 0x70, 0x6d,
                   0x5d, 0x25, 0x36, 0xb9, 0xe4, 0xbd, 0x70, 0x0,  0x0,  0x14, 0xbc, 0x2a, 0x46, 0xf0, 0x6b, 0xb1, 0x7f,
                   0xb3, 0x5a, 0xee, 0x61, 0xa0, 0x24, 0xe1, 0xf5, 0x2a, 0x87, 0x28, 0x12, 0x71, 0x0,  0x0,  0x15, 0xc5,
                   0xa8, 0x63, 0x66, 0xd6, 0x65, 0x99, 0x19, 0x5f, 0x54, 0xd3, 0x97, 0x3b, 0xb3, 0xa3, 0xa4, 0x20, 0x87,
                   0x9e, 0xc1, 0x1,  0x0,  0x0,  0xf,  0x43, 0x85, 0xc1, 0x31, 0x96, 0x46, 0x53, 0x1b, 0xe3, 0x53, 0x3b,
                   0x8a, 0x49, 0x3,  0x1a, 0x0,  0x0,  0xb,  0x94, 0xf1, 0x48, 0x62, 0x90, 0x5b, 0xce, 0x29, 0xa0, 0xb2,
                   0x77, 0x1,  0x0,  0x12, 0x48, 0x47, 0xbe, 0xf9, 0xe2, 0xab, 0x42, 0x64, 0x3b, 0x6e, 0xe2, 0xf0, 0x8a,
                   0x9d, 0x52, 0xbc, 0xb2, 0x8b, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x69, 0x5c, 0x17, 0x5d, 0xdf, 0xac, 0xe6, 0xa7, 0x53, 0xa1,
                                     0x8,  0xc,  0xb5, 0x8c, 0xe6, 0xeb, 0xd3, 0xc7, 0x1e};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa7};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa7, 0x45, 0xce, 0xed, 0x65, 0x71, 0x21, 0xf4, 0x63, 0xc0, 0x85, 0xf3, 0xf4};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x96, 0xf5, 0x65};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9c, 0x85, 0x7e, 0x5d, 0x84, 0x40, 0xc1};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1e, 0x91, 0xce, 0x29, 0x20, 0x8,  0x9c, 0xcd, 0xe2, 0xa1, 0x52, 0x46, 0x3, 0x13,
                                     0x90, 0x71, 0xd3, 0xd4, 0x70, 0x6d, 0x5d, 0x25, 0x36, 0xb9, 0xe4, 0xbd, 0x70};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbc, 0x2a, 0x46, 0xf0, 0x6b, 0xb1, 0x7f, 0xb3, 0x5a, 0xee,
                                     0x61, 0xa0, 0x24, 0xe1, 0xf5, 0x2a, 0x87, 0x28, 0x12, 0x71};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc5, 0xa8, 0x63, 0x66, 0xd6, 0x65, 0x99, 0x19, 0x5f, 0x54, 0xd3,
                                     0x97, 0x3b, 0xb3, 0xa3, 0xa4, 0x20, 0x87, 0x9e, 0xc1, 0x1};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x43, 0x85, 0xc1, 0x31, 0x96, 0x46, 0x53, 0x1b,
                                     0xe3, 0x53, 0x3b, 0x8a, 0x49, 0x3,  0x1a};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x94, 0xf1, 0x48, 0x62, 0x90, 0x5b, 0xce, 0x29, 0xa0, 0xb2, 0x77};
  lwmqtt_string_t topic_filter_s9 = {11, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x48, 0x47, 0xbe, 0xf9, 0xe2, 0xab, 0x42, 0x64, 0x3b,
                                      0x6e, 0xe2, 0xf0, 0x8a, 0x9d, 0x52, 0xbc, 0xb2, 0x8b};
  lwmqtt_string_t topic_filter_s10 = {18, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22696, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14047 [("\r\253\211]\t\130|\206\&1\231\131\EOT\SI\129\229\140",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\245\193h\190\138\168\227j\SUB\DC2\232\129A\197",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\152>\249\ACK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\184\209\128O=(Q\229",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("2E\213\230\200\236\143\235\&0\NUL\CAN\ESC#Y\224Bf\FS-z\133 \192'C",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\177\212\217\238\249\r\208\171n\214\145HAI\FSG\NUL>\198\212y\RS\217\148\225\CANQ",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1\152:S",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("\180n\153T\208\214\157",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\168eem\240p\168\224\244\EOT\131/;\201\179\224",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(")ZK[\221\236\"r\197\144\180\255,\159\143\229\160\189\242",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0x82, 0xac, 0x1,  0x36, 0xdf, 0x0,  0x10, 0xd,  0xfd, 0xd3, 0x5d, 0x9,  0x82, 0x7c, 0xce, 0x31,
                   0xe7, 0x83, 0x4,  0xf,  0x81, 0xe5, 0x8c, 0x2,  0x0,  0xe,  0xf5, 0xc1, 0x68, 0xbe, 0x8a, 0xa8,
                   0xe3, 0x6a, 0x1a, 0x12, 0xe8, 0x81, 0x41, 0xc5, 0x0,  0x0,  0x4,  0x98, 0x3e, 0xf9, 0x6,  0x0,
                   0x0,  0x8,  0xb8, 0xd1, 0x80, 0x4f, 0x3d, 0x28, 0x51, 0xe5, 0x0,  0x0,  0x19, 0x32, 0x45, 0xd5,
                   0xe6, 0xc8, 0xec, 0x8f, 0xeb, 0x30, 0x0,  0x18, 0x1b, 0x23, 0x59, 0xe0, 0x42, 0x66, 0x1c, 0x2d,
                   0x7a, 0x85, 0x20, 0xc0, 0x27, 0x43, 0x2,  0x0,  0x1b, 0xb1, 0xd4, 0xd9, 0xee, 0xf9, 0xd,  0xd0,
                   0xab, 0x6e, 0xd6, 0x91, 0x48, 0x41, 0x49, 0x1c, 0x47, 0x0,  0x3e, 0xc6, 0xd4, 0x79, 0x1e, 0xd9,
                   0x94, 0xe1, 0x18, 0x51, 0x0,  0x0,  0x4,  0x31, 0x98, 0x3a, 0x53, 0x0,  0x0,  0x7,  0xb4, 0x6e,
                   0x99, 0x54, 0xd0, 0xd6, 0x9d, 0x0,  0x0,  0x10, 0xa8, 0x65, 0x65, 0x6d, 0xf0, 0x70, 0xa8, 0xe0,
                   0xf4, 0x4,  0x83, 0x2f, 0x3b, 0xc9, 0xb3, 0xe0, 0x2,  0x0,  0x13, 0x29, 0x5a, 0x4b, 0x5b, 0xdd,
                   0xec, 0x22, 0x72, 0xc5, 0x90, 0xb4, 0xff, 0x2c, 0x9f, 0x8f, 0xe5, 0xa0, 0xbd, 0xf2, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd,  0xfd, 0xd3, 0x5d, 0x9, 0x82, 0x7c, 0xce,
                                     0x31, 0xe7, 0x83, 0x4,  0xf, 0x81, 0xe5, 0x8c};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf5, 0xc1, 0x68, 0xbe, 0x8a, 0xa8, 0xe3,
                                     0x6a, 0x1a, 0x12, 0xe8, 0x81, 0x41, 0xc5};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x98, 0x3e, 0xf9, 0x6};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb8, 0xd1, 0x80, 0x4f, 0x3d, 0x28, 0x51, 0xe5};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x32, 0x45, 0xd5, 0xe6, 0xc8, 0xec, 0x8f, 0xeb, 0x30, 0x0,  0x18, 0x1b, 0x23,
                                     0x59, 0xe0, 0x42, 0x66, 0x1c, 0x2d, 0x7a, 0x85, 0x20, 0xc0, 0x27, 0x43};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb1, 0xd4, 0xd9, 0xee, 0xf9, 0xd,  0xd0, 0xab, 0x6e, 0xd6, 0x91, 0x48, 0x41, 0x49,
                                     0x1c, 0x47, 0x0,  0x3e, 0xc6, 0xd4, 0x79, 0x1e, 0xd9, 0x94, 0xe1, 0x18, 0x51};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x31, 0x98, 0x3a, 0x53};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb4, 0x6e, 0x99, 0x54, 0xd0, 0xd6, 0x9d};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa8, 0x65, 0x65, 0x6d, 0xf0, 0x70, 0xa8, 0xe0,
                                     0xf4, 0x4,  0x83, 0x2f, 0x3b, 0xc9, 0xb3, 0xe0};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x29, 0x5a, 0x4b, 0x5b, 0xdd, 0xec, 0x22, 0x72, 0xc5, 0x90,
                                     0xb4, 0xff, 0x2c, 0x9f, 0x8f, 0xe5, 0xa0, 0xbd, 0xf2};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14047, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 502 [("\ESC\USm\212\ETB\238\&9\252\153\189\163S\234=+",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("{\221\\\229
// :\162\183\177\157\208\253\FS\144bS\217\ETB\180",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("U,\243\&4\ETB\241\&1\142\221\ACK#\tm\137\153\131F\200\147\&1\153\242\176\192\241\132>\192\174",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\SI\SI\DC39\233\224\EMM\128L5\235\156\157o\239N7\172:d\247",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0x82, 0x63, 0x1,  0xf6, 0x0,  0xf,  0x1b, 0x1f, 0x6d, 0xd4, 0x17, 0xee, 0x39, 0xfc, 0x99, 0xbd, 0xa3,
                   0x53, 0xea, 0x3d, 0x2b, 0x2,  0x0,  0x13, 0x7b, 0xdd, 0x5c, 0xe5, 0x20, 0x3a, 0xa2, 0xb7, 0xb1, 0x9d,
                   0xd0, 0xfd, 0x1c, 0x90, 0x62, 0x53, 0xd9, 0x17, 0xb4, 0x0,  0x0,  0x1d, 0x55, 0x2c, 0xf3, 0x34, 0x17,
                   0xf1, 0x31, 0x8e, 0xdd, 0x6,  0x23, 0x9,  0x6d, 0x89, 0x99, 0x83, 0x46, 0xc8, 0x93, 0x31, 0x99, 0xf2,
                   0xb0, 0xc0, 0xf1, 0x84, 0x3e, 0xc0, 0xae, 0x2,  0x0,  0x16, 0xf,  0xf,  0x13, 0x39, 0xe9, 0xe0, 0x19,
                   0x4d, 0x80, 0x4c, 0x35, 0xeb, 0x9c, 0x9d, 0x6f, 0xef, 0x4e, 0x37, 0xac, 0x3a, 0x64, 0xf7, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x1b, 0x1f, 0x6d, 0xd4, 0x17, 0xee, 0x39, 0xfc,
                                     0x99, 0xbd, 0xa3, 0x53, 0xea, 0x3d, 0x2b};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7b, 0xdd, 0x5c, 0xe5, 0x20, 0x3a, 0xa2, 0xb7, 0xb1, 0x9d,
                                     0xd0, 0xfd, 0x1c, 0x90, 0x62, 0x53, 0xd9, 0x17, 0xb4};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x55, 0x2c, 0xf3, 0x34, 0x17, 0xf1, 0x31, 0x8e, 0xdd, 0x6,
                                     0x23, 0x9,  0x6d, 0x89, 0x99, 0x83, 0x46, 0xc8, 0x93, 0x31,
                                     0x99, 0xf2, 0xb0, 0xc0, 0xf1, 0x84, 0x3e, 0xc0, 0xae};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf,  0xf,  0x13, 0x39, 0xe9, 0xe0, 0x19, 0x4d, 0x80, 0x4c, 0x35,
                                     0xeb, 0x9c, 0x9d, 0x6f, 0xef, 0x4e, 0x37, 0xac, 0x3a, 0x64, 0xf7};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 502, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27247
// [("\137\230\141\ACK\169\178P\242\SUB\143Ml]\220\&1<\251\195\206\187\139$\167\174\\zW",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("<\235\&2\233\188SY\DC2}N",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\169\156\DC4\199\SUBt\235!\GS\198\SUB\142i\208\aj\\\NAKG\a",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("h\252u[I\131\&8\238i\235/\165{\147\159\226/G\208\207npWu\ACKc\150@",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\132*T\ETB!\169\180\173\239t=",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\184\198;\ETX\221\STX\202\227[\197q;6\189\n\169",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("x30\199\163\193",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("s\226\229\185N]\173-\176\199\183\201\219",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS0}),("\228\134\195\198\239\232\245\153\ACKd.\130%$9D\237\231\158\SOH\160\242\151\170\\I",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0x82, 0xc0, 0x1,  0x6a, 0x6f, 0x0,  0x1b, 0x89, 0xe6, 0x8d, 0x6,  0xa9, 0xb2, 0x50, 0xf2, 0x1a, 0x8f,
                   0x4d, 0x6c, 0x5d, 0xdc, 0x31, 0x3c, 0xfb, 0xc3, 0xce, 0xbb, 0x8b, 0x24, 0xa7, 0xae, 0x5c, 0x7a, 0x57,
                   0x2,  0x0,  0xa,  0x3c, 0xeb, 0x32, 0xe9, 0xbc, 0x53, 0x59, 0x12, 0x7d, 0x4e, 0x0,  0x0,  0x14, 0xa9,
                   0x9c, 0x14, 0xc7, 0x1a, 0x74, 0xeb, 0x21, 0x1d, 0xc6, 0x1a, 0x8e, 0x69, 0xd0, 0x7,  0x6a, 0x5c, 0x15,
                   0x47, 0x7,  0x2,  0x0,  0x1c, 0x68, 0xfc, 0x75, 0x5b, 0x49, 0x83, 0x38, 0xee, 0x69, 0xeb, 0x2f, 0xa5,
                   0x7b, 0x93, 0x9f, 0xe2, 0x2f, 0x47, 0xd0, 0xcf, 0x6e, 0x70, 0x57, 0x75, 0x6,  0x63, 0x96, 0x40, 0x0,
                   0x0,  0x0,  0x2,  0x0,  0xb,  0x84, 0x2a, 0x54, 0x17, 0x21, 0xa9, 0xb4, 0xad, 0xef, 0x74, 0x3d, 0x2,
                   0x0,  0x10, 0xb8, 0xc6, 0x3b, 0x3,  0xdd, 0x2,  0xca, 0xe3, 0x5b, 0xc5, 0x71, 0x3b, 0x36, 0xbd, 0xa,
                   0xa9, 0x0,  0x0,  0x6,  0x78, 0x33, 0x30, 0xc7, 0xa3, 0xc1, 0x2,  0x0,  0xd,  0x73, 0xe2, 0xe5, 0xb9,
                   0x4e, 0x5d, 0xad, 0x2d, 0xb0, 0xc7, 0xb7, 0xc9, 0xdb, 0x0,  0x0,  0x1a, 0xe4, 0x86, 0xc3, 0xc6, 0xef,
                   0xe8, 0xf5, 0x99, 0x6,  0x64, 0x2e, 0x82, 0x25, 0x24, 0x39, 0x44, 0xed, 0xe7, 0x9e, 0x1,  0xa0, 0xf2,
                   0x97, 0xaa, 0x5c, 0x49, 0x1,  0x0,  0x0,  0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x89, 0xe6, 0x8d, 0x6,  0xa9, 0xb2, 0x50, 0xf2, 0x1a, 0x8f, 0x4d, 0x6c, 0x5d, 0xdc,
                                     0x31, 0x3c, 0xfb, 0xc3, 0xce, 0xbb, 0x8b, 0x24, 0xa7, 0xae, 0x5c, 0x7a, 0x57};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3c, 0xeb, 0x32, 0xe9, 0xbc, 0x53, 0x59, 0x12, 0x7d, 0x4e};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x9c, 0x14, 0xc7, 0x1a, 0x74, 0xeb, 0x21, 0x1d, 0xc6,
                                     0x1a, 0x8e, 0x69, 0xd0, 0x7,  0x6a, 0x5c, 0x15, 0x47, 0x7};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x68, 0xfc, 0x75, 0x5b, 0x49, 0x83, 0x38, 0xee, 0x69, 0xeb,
                                     0x2f, 0xa5, 0x7b, 0x93, 0x9f, 0xe2, 0x2f, 0x47, 0xd0, 0xcf,
                                     0x6e, 0x70, 0x57, 0x75, 0x6,  0x63, 0x96, 0x40};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x84, 0x2a, 0x54, 0x17, 0x21, 0xa9, 0xb4, 0xad, 0xef, 0x74, 0x3d};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb8, 0xc6, 0x3b, 0x3,  0xdd, 0x2,  0xca, 0xe3,
                                     0x5b, 0xc5, 0x71, 0x3b, 0x36, 0xbd, 0xa,  0xa9};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x78, 0x33, 0x30, 0xc7, 0xa3, 0xc1};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x73, 0xe2, 0xe5, 0xb9, 0x4e, 0x5d, 0xad, 0x2d, 0xb0, 0xc7, 0xb7, 0xc9, 0xdb};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe4, 0x86, 0xc3, 0xc6, 0xef, 0xe8, 0xf5, 0x99, 0x6,  0x64, 0x2e, 0x82, 0x25,
                                     0x24, 0x39, 0x44, 0xed, 0xe7, 0x9e, 0x1,  0xa0, 0xf2, 0x97, 0xaa, 0x5c, 0x49};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27247, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15611 [("\NUL\212p\201h\br'2ko\162\SYN\242U\173Sp\182\184",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x19, 0x3c, 0xfb, 0x0,  0x14, 0x0,  0xd4, 0x70, 0xc9, 0x68, 0x8,  0x72, 0x27,
                   0x32, 0x6b, 0x6f, 0xa2, 0x16, 0xf2, 0x55, 0xad, 0x53, 0x70, 0xb6, 0xb8, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x0,  0xd4, 0x70, 0xc9, 0x68, 0x8,  0x72, 0x27, 0x32, 0x6b,
                                     0x6f, 0xa2, 0x16, 0xf2, 0x55, 0xad, 0x53, 0x70, 0xb6, 0xb8};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15611, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16791 [("\\\ACK\129B1\149Y/2\178vx\RSo",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\157\170\249\222\&8\248\181\190\212q\151\133\186\245\171\223g1)U\206\a\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("y\245\244\225K\177[\153B\179@\161\193",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\146\247\211\182H z\bK\191\RS\194V\134\&8$\221;8",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\167\159W\185-u;",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("X\246\247\218G\162mZ(\DEL\EM\172",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\152X9\166\177\RS\226\222\212\128",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\236\NAK\169\245",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("@I\210\CAN\210\EM\200\RS\186\ETB\235\180$\182\167\155\138\135>'\246",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0x98, 0x1,  0x41, 0x97, 0x0,  0xe,  0x5c, 0x6,  0x81, 0x42, 0x31, 0x95, 0x59, 0x2f, 0x32,
                   0xb2, 0x76, 0x78, 0x1e, 0x6f, 0x2,  0x0,  0x17, 0x9d, 0xaa, 0xf9, 0xde, 0x38, 0xf8, 0xb5, 0xbe,
                   0xd4, 0x71, 0x97, 0x85, 0xba, 0xf5, 0xab, 0xdf, 0x67, 0x31, 0x29, 0x55, 0xce, 0x7,  0x87, 0x2,
                   0x0,  0xd,  0x79, 0xf5, 0xf4, 0xe1, 0x4b, 0xb1, 0x5b, 0x99, 0x42, 0xb3, 0x40, 0xa1, 0xc1, 0x2,
                   0x0,  0x13, 0x92, 0xf7, 0xd3, 0xb6, 0x48, 0x20, 0x7a, 0x8,  0x4b, 0xbf, 0x1e, 0xc2, 0x56, 0x86,
                   0x38, 0x24, 0xdd, 0x3b, 0x38, 0x2,  0x0,  0x7,  0xa7, 0x9f, 0x57, 0xb9, 0x2d, 0x75, 0x3b, 0x0,
                   0x0,  0xc,  0x58, 0xf6, 0xf7, 0xda, 0x47, 0xa2, 0x6d, 0x5a, 0x28, 0x7f, 0x19, 0xac, 0x1,  0x0,
                   0xa,  0x98, 0x58, 0x39, 0xa6, 0xb1, 0x1e, 0xe2, 0xde, 0xd4, 0x80, 0x2,  0x0,  0x4,  0xec, 0x15,
                   0xa9, 0xf5, 0x0,  0x0,  0x15, 0x40, 0x49, 0xd2, 0x18, 0xd2, 0x19, 0xc8, 0x1e, 0xba, 0x17, 0xeb,
                   0xb4, 0x24, 0xb6, 0xa7, 0x9b, 0x8a, 0x87, 0x3e, 0x27, 0xf6, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x5c, 0x6, 0x81, 0x42, 0x31, 0x95, 0x59, 0x2f, 0x32, 0xb2, 0x76, 0x78, 0x1e, 0x6f};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9d, 0xaa, 0xf9, 0xde, 0x38, 0xf8, 0xb5, 0xbe, 0xd4, 0x71, 0x97, 0x85,
                                     0xba, 0xf5, 0xab, 0xdf, 0x67, 0x31, 0x29, 0x55, 0xce, 0x7,  0x87};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x79, 0xf5, 0xf4, 0xe1, 0x4b, 0xb1, 0x5b, 0x99, 0x42, 0xb3, 0x40, 0xa1, 0xc1};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x92, 0xf7, 0xd3, 0xb6, 0x48, 0x20, 0x7a, 0x8,  0x4b, 0xbf,
                                     0x1e, 0xc2, 0x56, 0x86, 0x38, 0x24, 0xdd, 0x3b, 0x38};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7, 0x9f, 0x57, 0xb9, 0x2d, 0x75, 0x3b};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x58, 0xf6, 0xf7, 0xda, 0x47, 0xa2, 0x6d, 0x5a, 0x28, 0x7f, 0x19, 0xac};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x98, 0x58, 0x39, 0xa6, 0xb1, 0x1e, 0xe2, 0xde, 0xd4, 0x80};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xec, 0x15, 0xa9, 0xf5};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x40, 0x49, 0xd2, 0x18, 0xd2, 0x19, 0xc8, 0x1e, 0xba, 0x17, 0xeb,
                                     0xb4, 0x24, 0xb6, 0xa7, 0x9b, 0x8a, 0x87, 0x3e, 0x27, 0xf6};
  lwmqtt_string_t topic_filter_s8 = {21, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 16791, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26959 [("O\ESCB(\149\146o\177\249\238&\152\222\148\225\208k<",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\163\ACK\208\ETX}\235\ESC\230\193\202s",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS2}),("\140>8\177\CAN\US\187w\173\n~\"",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("AdT[\254[\152\249\SUBhe%e\185",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\201\230\EM\GS4\DC4\233BO]\165",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\245\148@\246iy\SUB<E\191\SObr",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0x82, 0x63, 0x69, 0x4f, 0x0,  0x12, 0x4f, 0x1b, 0x42, 0x28, 0x95, 0x92, 0x6f, 0xb1, 0xf9, 0xee, 0x26,
                   0x98, 0xde, 0x94, 0xe1, 0xd0, 0x6b, 0x3c, 0x2,  0x0,  0xb,  0xa3, 0x6,  0xd0, 0x3,  0x7d, 0xeb, 0x1b,
                   0xe6, 0xc1, 0xca, 0x73, 0x2,  0x0,  0xc,  0x8c, 0x3e, 0x38, 0xb1, 0x18, 0x1f, 0xbb, 0x77, 0xad, 0xa,
                   0x7e, 0x22, 0x2,  0x0,  0xe,  0x41, 0x64, 0x54, 0x5b, 0xfe, 0x5b, 0x98, 0xf9, 0x1a, 0x68, 0x65, 0x25,
                   0x65, 0xb9, 0x2,  0x0,  0xb,  0xc9, 0xe6, 0x19, 0x1d, 0x34, 0x14, 0xe9, 0x42, 0x4f, 0x5d, 0xa5, 0x2,
                   0x0,  0xd,  0xf5, 0x94, 0x40, 0xf6, 0x69, 0x79, 0x1a, 0x3c, 0x45, 0xbf, 0xe,  0x62, 0x72, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x4f, 0x1b, 0x42, 0x28, 0x95, 0x92, 0x6f, 0xb1, 0xf9,
                                     0xee, 0x26, 0x98, 0xde, 0x94, 0xe1, 0xd0, 0x6b, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa3, 0x6, 0xd0, 0x3, 0x7d, 0xeb, 0x1b, 0xe6, 0xc1, 0xca, 0x73};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8c, 0x3e, 0x38, 0xb1, 0x18, 0x1f, 0xbb, 0x77, 0xad, 0xa, 0x7e, 0x22};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x41, 0x64, 0x54, 0x5b, 0xfe, 0x5b, 0x98,
                                     0xf9, 0x1a, 0x68, 0x65, 0x25, 0x65, 0xb9};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc9, 0xe6, 0x19, 0x1d, 0x34, 0x14, 0xe9, 0x42, 0x4f, 0x5d, 0xa5};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf5, 0x94, 0x40, 0xf6, 0x69, 0x79, 0x1a, 0x3c, 0x45, 0xbf, 0xe, 0x62, 0x72};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26959, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24469 [("\ESC#\199)\130R\223\244K\131C[",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\251\177\205",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\SIM7\199/\GSb\150\n\210
// m\147\134\136B$\140[\181G",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("x\229\129*\DC4h3\238\156\215|k\147=\203I\207t\230\131\199E\154\&6-\159\254B\b_",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\GS\179I\154\174\202\188f\228\141\231\152\165U\184H\238\&5a",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("e\242xX?l\240\&0p[V\STX\221%\132\152\STX\NAK7\204\231\202\SI\167\182\137bd\170\224",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Au\237\142}\ENQ/1\187\&3fw@\229\243\188\SYN;\189\186\t\159\222\SI\r",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("@
// \v5\RS\192\164\205\192\128\149\176Yt\SUB\229K\216\195\"\251",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode11) {
  uint8_t pkt[] = {
      0x82, 0xbb, 0x1,  0x5f, 0x95, 0x0,  0xc,  0x1b, 0x23, 0xc7, 0x29, 0x82, 0x52, 0xdf, 0xf4, 0x4b, 0x83, 0x43, 0x5b,
      0x1,  0x0,  0x3,  0xfb, 0xb1, 0xcd, 0x0,  0x0,  0x15, 0xf,  0x4d, 0x37, 0xc7, 0x2f, 0x1d, 0x62, 0x96, 0xa,  0xd2,
      0x20, 0x6d, 0x93, 0x86, 0x88, 0x42, 0x24, 0x8c, 0x5b, 0xb5, 0x47, 0x2,  0x0,  0x1e, 0x78, 0xe5, 0x81, 0x2a, 0x14,
      0x68, 0x33, 0xee, 0x9c, 0xd7, 0x7c, 0x6b, 0x93, 0x3d, 0xcb, 0x49, 0xcf, 0x74, 0xe6, 0x83, 0xc7, 0x45, 0x9a, 0x36,
      0x2d, 0x9f, 0xfe, 0x42, 0x8,  0x5f, 0x1,  0x0,  0x13, 0x1d, 0xb3, 0x49, 0x9a, 0xae, 0xca, 0xbc, 0x66, 0xe4, 0x8d,
      0xe7, 0x98, 0xa5, 0x55, 0xb8, 0x48, 0xee, 0x35, 0x61, 0x1,  0x0,  0x1e, 0x65, 0xf2, 0x78, 0x58, 0x3f, 0x6c, 0xf0,
      0x30, 0x70, 0x5b, 0x56, 0x2,  0xdd, 0x25, 0x84, 0x98, 0x2,  0x15, 0x37, 0xcc, 0xe7, 0xca, 0xf,  0xa7, 0xb6, 0x89,
      0x62, 0x64, 0xaa, 0xe0, 0x1,  0x0,  0x19, 0x41, 0x75, 0xed, 0x8e, 0x7d, 0x5,  0x2f, 0x31, 0xbb, 0x33, 0x66, 0x77,
      0x40, 0xe5, 0xf3, 0xbc, 0x16, 0x3b, 0xbd, 0xba, 0x9,  0x9f, 0xde, 0xf,  0xd,  0x1,  0x0,  0x15, 0x40, 0x20, 0xb,
      0x35, 0x1e, 0xc0, 0xa4, 0xcd, 0xc0, 0x80, 0x95, 0xb0, 0x59, 0x74, 0x1a, 0xe5, 0x4b, 0xd8, 0xc3, 0x22, 0xfb, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x1b, 0x23, 0xc7, 0x29, 0x82, 0x52, 0xdf, 0xf4, 0x4b, 0x83, 0x43, 0x5b};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfb, 0xb1, 0xcd};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf,  0x4d, 0x37, 0xc7, 0x2f, 0x1d, 0x62, 0x96, 0xa,  0xd2, 0x20,
                                     0x6d, 0x93, 0x86, 0x88, 0x42, 0x24, 0x8c, 0x5b, 0xb5, 0x47};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x78, 0xe5, 0x81, 0x2a, 0x14, 0x68, 0x33, 0xee, 0x9c, 0xd7,
                                     0x7c, 0x6b, 0x93, 0x3d, 0xcb, 0x49, 0xcf, 0x74, 0xe6, 0x83,
                                     0xc7, 0x45, 0x9a, 0x36, 0x2d, 0x9f, 0xfe, 0x42, 0x8,  0x5f};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1d, 0xb3, 0x49, 0x9a, 0xae, 0xca, 0xbc, 0x66, 0xe4, 0x8d,
                                     0xe7, 0x98, 0xa5, 0x55, 0xb8, 0x48, 0xee, 0x35, 0x61};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x65, 0xf2, 0x78, 0x58, 0x3f, 0x6c, 0xf0, 0x30, 0x70, 0x5b,
                                     0x56, 0x2,  0xdd, 0x25, 0x84, 0x98, 0x2,  0x15, 0x37, 0xcc,
                                     0xe7, 0xca, 0xf,  0xa7, 0xb6, 0x89, 0x62, 0x64, 0xaa, 0xe0};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x41, 0x75, 0xed, 0x8e, 0x7d, 0x5,  0x2f, 0x31, 0xbb, 0x33, 0x66, 0x77, 0x40,
                                     0xe5, 0xf3, 0xbc, 0x16, 0x3b, 0xbd, 0xba, 0x9,  0x9f, 0xde, 0xf,  0xd};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x40, 0x20, 0xb,  0x35, 0x1e, 0xc0, 0xa4, 0xcd, 0xc0, 0x80, 0x95,
                                     0xb0, 0x59, 0x74, 0x1a, 0xe5, 0x4b, 0xd8, 0xc3, 0x22, 0xfb};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24469, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12270 [("7\235R8?\\\200\&7^jN\237\DC2\229\&6O7",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\154\223\186^\201\164\207\230\160\GSi\205\210\204=(\196\CAN\191H\169D`",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\254\248p\NUL5\\\140j\"\ETX\185\251\223\242+'\214\223z\229\247\219\225Y\ETB\FS\ESC\ESC\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\213\190
// \178\176o\172\166\217\173E\167`)\b\EM\EM\249\204_\DLE\152`\179P",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("w\ESCURkJ\215\186\129\131\NAK\"\139d\\\246\228\ESC\SOHA\EM\218D\215\211*",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\186H[`\183\255",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\170+\DEL:4\218\131z(#\199^O}\a\193\&0\181\231\231\187\187P\239",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0x82, 0xad, 0x1,  0x2f, 0xee, 0x0,  0x11, 0x37, 0xeb, 0x52, 0x38, 0x3f, 0x5c, 0xc8, 0x37, 0x5e,
                   0x6a, 0x4e, 0xed, 0x12, 0xe5, 0x36, 0x4f, 0x37, 0x2,  0x0,  0x17, 0x9a, 0xdf, 0xba, 0x5e, 0xc9,
                   0xa4, 0xcf, 0xe6, 0xa0, 0x1d, 0x69, 0xcd, 0xd2, 0xcc, 0x3d, 0x28, 0xc4, 0x18, 0xbf, 0x48, 0xa9,
                   0x44, 0x60, 0x0,  0x0,  0x1d, 0xfe, 0xf8, 0x70, 0x0,  0x35, 0x5c, 0x8c, 0x6a, 0x22, 0x3,  0xb9,
                   0xfb, 0xdf, 0xf2, 0x2b, 0x27, 0xd6, 0xdf, 0x7a, 0xe5, 0xf7, 0xdb, 0xe1, 0x59, 0x17, 0x1c, 0x1b,
                   0x1b, 0xfe, 0x2,  0x0,  0x19, 0xd5, 0xbe, 0x20, 0xb2, 0xb0, 0x6f, 0xac, 0xa6, 0xd9, 0xad, 0x45,
                   0xa7, 0x60, 0x29, 0x8,  0x19, 0x19, 0xf9, 0xcc, 0x5f, 0x10, 0x98, 0x60, 0xb3, 0x50, 0x1,  0x0,
                   0x1a, 0x77, 0x1b, 0x55, 0x52, 0x6b, 0x4a, 0xd7, 0xba, 0x81, 0x83, 0x15, 0x22, 0x8b, 0x64, 0x5c,
                   0xf6, 0xe4, 0x1b, 0x1,  0x41, 0x19, 0xda, 0x44, 0xd7, 0xd3, 0x2a, 0x2,  0x0,  0x6,  0xba, 0x48,
                   0x5b, 0x60, 0xb7, 0xff, 0x1,  0x0,  0x18, 0xaa, 0x2b, 0x7f, 0x3a, 0x34, 0xda, 0x83, 0x7a, 0x28,
                   0x23, 0xc7, 0x5e, 0x4f, 0x7d, 0x7,  0xc1, 0x30, 0xb5, 0xe7, 0xe7, 0xbb, 0xbb, 0x50, 0xef, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x37, 0xeb, 0x52, 0x38, 0x3f, 0x5c, 0xc8, 0x37, 0x5e,
                                     0x6a, 0x4e, 0xed, 0x12, 0xe5, 0x36, 0x4f, 0x37};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9a, 0xdf, 0xba, 0x5e, 0xc9, 0xa4, 0xcf, 0xe6, 0xa0, 0x1d, 0x69, 0xcd,
                                     0xd2, 0xcc, 0x3d, 0x28, 0xc4, 0x18, 0xbf, 0x48, 0xa9, 0x44, 0x60};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfe, 0xf8, 0x70, 0x0,  0x35, 0x5c, 0x8c, 0x6a, 0x22, 0x3,
                                     0xb9, 0xfb, 0xdf, 0xf2, 0x2b, 0x27, 0xd6, 0xdf, 0x7a, 0xe5,
                                     0xf7, 0xdb, 0xe1, 0x59, 0x17, 0x1c, 0x1b, 0x1b, 0xfe};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd5, 0xbe, 0x20, 0xb2, 0xb0, 0x6f, 0xac, 0xa6, 0xd9, 0xad, 0x45, 0xa7, 0x60,
                                     0x29, 0x8,  0x19, 0x19, 0xf9, 0xcc, 0x5f, 0x10, 0x98, 0x60, 0xb3, 0x50};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x77, 0x1b, 0x55, 0x52, 0x6b, 0x4a, 0xd7, 0xba, 0x81, 0x83, 0x15, 0x22, 0x8b,
                                     0x64, 0x5c, 0xf6, 0xe4, 0x1b, 0x1,  0x41, 0x19, 0xda, 0x44, 0xd7, 0xd3, 0x2a};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xba, 0x48, 0x5b, 0x60, 0xb7, 0xff};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xaa, 0x2b, 0x7f, 0x3a, 0x34, 0xda, 0x83, 0x7a, 0x28, 0x23, 0xc7, 0x5e,
                                     0x4f, 0x7d, 0x7,  0xc1, 0x30, 0xb5, 0xe7, 0xe7, 0xbb, 0xbb, 0x50, 0xef};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 12270, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18547 [("\189J\145\DC3y\183\216\164\150\129\238l\168;Q\211/\253\211\135%\144\153\\\160",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\b@\172f,>\129\206D\233\DEL\225\131B}\239\133\177\140\196\193j\DC1\237",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\152\130\187",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\143\DC1\220\180\147#-\155\181y",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\235.\t\SOH\DC2\EM/vM\205b",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0x5a, 0x48, 0x73, 0x0,  0x19, 0xbd, 0x4a, 0x91, 0x13, 0x79, 0xb7, 0xd8, 0xa4, 0x96, 0x81,
                   0xee, 0x6c, 0xa8, 0x3b, 0x51, 0xd3, 0x2f, 0xfd, 0xd3, 0x87, 0x25, 0x90, 0x99, 0x5c, 0xa0, 0x2,
                   0x0,  0x18, 0x8,  0x40, 0xac, 0x66, 0x2c, 0x3e, 0x81, 0xce, 0x44, 0xe9, 0x7f, 0xe1, 0x83, 0x42,
                   0x7d, 0xef, 0x85, 0xb1, 0x8c, 0xc4, 0xc1, 0x6a, 0x11, 0xed, 0x0,  0x0,  0x3,  0x98, 0x82, 0xbb,
                   0x0,  0x0,  0xa,  0x8f, 0x11, 0xdc, 0xb4, 0x93, 0x23, 0x2d, 0x9b, 0xb5, 0x79, 0x2,  0x0,  0xb,
                   0xeb, 0x2e, 0x9,  0x1,  0x12, 0x19, 0x2f, 0x76, 0x4d, 0xcd, 0x62, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xbd, 0x4a, 0x91, 0x13, 0x79, 0xb7, 0xd8, 0xa4, 0x96, 0x81, 0xee, 0x6c, 0xa8,
                                     0x3b, 0x51, 0xd3, 0x2f, 0xfd, 0xd3, 0x87, 0x25, 0x90, 0x99, 0x5c, 0xa0};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8,  0x40, 0xac, 0x66, 0x2c, 0x3e, 0x81, 0xce, 0x44, 0xe9, 0x7f, 0xe1,
                                     0x83, 0x42, 0x7d, 0xef, 0x85, 0xb1, 0x8c, 0xc4, 0xc1, 0x6a, 0x11, 0xed};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x98, 0x82, 0xbb};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8f, 0x11, 0xdc, 0xb4, 0x93, 0x23, 0x2d, 0x9b, 0xb5, 0x79};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xeb, 0x2e, 0x9, 0x1, 0x12, 0x19, 0x2f, 0x76, 0x4d, 0xcd, 0x62};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 18547, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10474 [(",+{\129\233\223\145\247o8\195\202\SIEVN\152\206m\181$\172\204\250HR\169",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\170[\206)\DC4\217gT\220\238",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\194y\219\180",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1})] []
TEST(Subscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0x82, 0x34, 0x28, 0xea, 0x0,  0x1b, 0x2c, 0x2b, 0x7b, 0x81, 0xe9, 0xdf, 0x91, 0xf7,
                   0x6f, 0x38, 0xc3, 0xca, 0xf,  0x45, 0x56, 0x4e, 0x98, 0xce, 0x6d, 0xb5, 0x24, 0xac,
                   0xcc, 0xfa, 0x48, 0x52, 0xa9, 0x0,  0x0,  0xa,  0xaa, 0x5b, 0xce, 0x29, 0x14, 0xd9,
                   0x67, 0x54, 0xdc, 0xee, 0x2,  0x0,  0x4,  0xc2, 0x79, 0xdb, 0xb4, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x2c, 0x2b, 0x7b, 0x81, 0xe9, 0xdf, 0x91, 0xf7, 0x6f, 0x38, 0xc3, 0xca, 0xf, 0x45,
                                     0x56, 0x4e, 0x98, 0xce, 0x6d, 0xb5, 0x24, 0xac, 0xcc, 0xfa, 0x48, 0x52, 0xa9};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaa, 0x5b, 0xce, 0x29, 0x14, 0xd9, 0x67, 0x54, 0xdc, 0xee};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc2, 0x79, 0xdb, 0xb4};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10474, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20401 [("\210n-\209\154iPp\201\217l\192\SOHlY\242\n$\144@t",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("@T\180Z\153\"\b\RS8\223%\224\&5z\DC2`\170\NAK\179\224!\SI\153}\149O\252\199\182",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("P\EM \252RA1y\233=Q
// \206U\161\SUB\NULSCcv\153\&1n\132\135T\138N",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS0}),("\233\&2\236\152@\229Z\RS\247\249\142\241\147\181\234\al}\228\167\157",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("G\193\ETB\152\&84H\fg2\215\f\DC26\209\t\216xr\172\225>\246Es/_\201",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\SUB\164q\168\180\218\223\190\207RU\153\250\238+E\247\244\183\231\225",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\221\149A\211\195",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0xb1, 0x1,  0x4f, 0xb1, 0x0,  0x15, 0xd2, 0x6e, 0x2d, 0xd1, 0x9a, 0x69, 0x50, 0x70, 0xc9, 0xd9,
                   0x6c, 0xc0, 0x1,  0x6c, 0x59, 0xf2, 0xa,  0x24, 0x90, 0x40, 0x74, 0x1,  0x0,  0x1d, 0x40, 0x54, 0xb4,
                   0x5a, 0x99, 0x22, 0x8,  0x1e, 0x38, 0xdf, 0x25, 0xe0, 0x35, 0x7a, 0x12, 0x60, 0xaa, 0x15, 0xb3, 0xe0,
                   0x21, 0xf,  0x99, 0x7d, 0x95, 0x4f, 0xfc, 0xc7, 0xb6, 0x1,  0x0,  0x1d, 0x50, 0x19, 0x20, 0xfc, 0x52,
                   0x41, 0x31, 0x79, 0xe9, 0x3d, 0x51, 0x20, 0xce, 0x55, 0xa1, 0x1a, 0x0,  0x53, 0x43, 0x63, 0x76, 0x99,
                   0x31, 0x6e, 0x84, 0x87, 0x54, 0x8a, 0x4e, 0x0,  0x0,  0x15, 0xe9, 0x32, 0xec, 0x98, 0x40, 0xe5, 0x5a,
                   0x1e, 0xf7, 0xf9, 0x8e, 0xf1, 0x93, 0xb5, 0xea, 0x7,  0x6c, 0x7d, 0xe4, 0xa7, 0x9d, 0x0,  0x0,  0x1c,
                   0x47, 0xc1, 0x17, 0x98, 0x38, 0x34, 0x48, 0xc,  0x67, 0x32, 0xd7, 0xc,  0x12, 0x36, 0xd1, 0x9,  0xd8,
                   0x78, 0x72, 0xac, 0xe1, 0x3e, 0xf6, 0x45, 0x73, 0x2f, 0x5f, 0xc9, 0x0,  0x0,  0x15, 0x1a, 0xa4, 0x71,
                   0xa8, 0xb4, 0xda, 0xdf, 0xbe, 0xcf, 0x52, 0x55, 0x99, 0xfa, 0xee, 0x2b, 0x45, 0xf7, 0xf4, 0xb7, 0xe7,
                   0xe1, 0x2,  0x0,  0x5,  0xdd, 0x95, 0x41, 0xd3, 0xc3, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xd2, 0x6e, 0x2d, 0xd1, 0x9a, 0x69, 0x50, 0x70, 0xc9, 0xd9, 0x6c,
                                     0xc0, 0x1,  0x6c, 0x59, 0xf2, 0xa,  0x24, 0x90, 0x40, 0x74};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x40, 0x54, 0xb4, 0x5a, 0x99, 0x22, 0x8,  0x1e, 0x38, 0xdf,
                                     0x25, 0xe0, 0x35, 0x7a, 0x12, 0x60, 0xaa, 0x15, 0xb3, 0xe0,
                                     0x21, 0xf,  0x99, 0x7d, 0x95, 0x4f, 0xfc, 0xc7, 0xb6};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x50, 0x19, 0x20, 0xfc, 0x52, 0x41, 0x31, 0x79, 0xe9, 0x3d,
                                     0x51, 0x20, 0xce, 0x55, 0xa1, 0x1a, 0x0,  0x53, 0x43, 0x63,
                                     0x76, 0x99, 0x31, 0x6e, 0x84, 0x87, 0x54, 0x8a, 0x4e};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe9, 0x32, 0xec, 0x98, 0x40, 0xe5, 0x5a, 0x1e, 0xf7, 0xf9, 0x8e,
                                     0xf1, 0x93, 0xb5, 0xea, 0x7,  0x6c, 0x7d, 0xe4, 0xa7, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x47, 0xc1, 0x17, 0x98, 0x38, 0x34, 0x48, 0xc,  0x67, 0x32,
                                     0xd7, 0xc,  0x12, 0x36, 0xd1, 0x9,  0xd8, 0x78, 0x72, 0xac,
                                     0xe1, 0x3e, 0xf6, 0x45, 0x73, 0x2f, 0x5f, 0xc9};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1a, 0xa4, 0x71, 0xa8, 0xb4, 0xda, 0xdf, 0xbe, 0xcf, 0x52, 0x55,
                                     0x99, 0xfa, 0xee, 0x2b, 0x45, 0xf7, 0xf4, 0xb7, 0xe7, 0xe1};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xdd, 0x95, 0x41, 0xd3, 0xc3};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20401, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8563 [("\143\195\RS\DEL-\129\b/n _",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\152K\195\r\158\128&X\SUB\FSI\163y\128\203\171\SO\227\231K\213\SI&Y\211\EM",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0x2d, 0x21, 0x73, 0x0,  0xb,  0x8f, 0xc3, 0x1e, 0x7f, 0x2d, 0x81, 0x8,  0x2f, 0x6e, 0x20,
                   0x5f, 0x1,  0x0,  0x1a, 0x98, 0x4b, 0xc3, 0xd,  0x9e, 0x80, 0x26, 0x58, 0x1a, 0x1c, 0x49, 0xa3,
                   0x79, 0x80, 0xcb, 0xab, 0xe,  0xe3, 0xe7, 0x4b, 0xd5, 0xf,  0x26, 0x59, 0xd3, 0x19, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x8f, 0xc3, 0x1e, 0x7f, 0x2d, 0x81, 0x8, 0x2f, 0x6e, 0x20, 0x5f};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x98, 0x4b, 0xc3, 0xd, 0x9e, 0x80, 0x26, 0x58, 0x1a, 0x1c, 0x49, 0xa3, 0x79,
                                     0x80, 0xcb, 0xab, 0xe, 0xe3, 0xe7, 0x4b, 0xd5, 0xf,  0x26, 0x59, 0xd3, 0x19};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 8563, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7682 [("\RS `P\209\153\210\225\236\187\202\241L\148\241X",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\ENQM\221\168\223",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\138\SYN\nG\DC3\GS\189\169\136\188\248~1A\160\133\254\212)\197\\",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("X\218\142\219\222C\214\142\ETX\209]-\202k\ESC\146h\161m\207",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\165\153\b\146/\NUL\131\v\215\&9=O\238-\235\DLEg\161@\SYN\ENQ\bZ\163\223\185z",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\201'\162\130h\150\158/\184\FS\131\156\251",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0x82, 0x7a, 0x1e, 0x2,  0x0,  0x10, 0x1e, 0x20, 0x60, 0x50, 0xd1, 0x99, 0xd2, 0xe1, 0xec, 0xbb,
                   0xca, 0xf1, 0x4c, 0x94, 0xf1, 0x58, 0x2,  0x0,  0x5,  0x5,  0x4d, 0xdd, 0xa8, 0xdf, 0x0,  0x0,
                   0x15, 0x8a, 0x16, 0xa,  0x47, 0x13, 0x1d, 0xbd, 0xa9, 0x88, 0xbc, 0xf8, 0x7e, 0x31, 0x41, 0xa0,
                   0x85, 0xfe, 0xd4, 0x29, 0xc5, 0x5c, 0x0,  0x0,  0x14, 0x58, 0xda, 0x8e, 0xdb, 0xde, 0x43, 0xd6,
                   0x8e, 0x3,  0xd1, 0x5d, 0x2d, 0xca, 0x6b, 0x1b, 0x92, 0x68, 0xa1, 0x6d, 0xcf, 0x2,  0x0,  0x1b,
                   0xa5, 0x99, 0x8,  0x92, 0x2f, 0x0,  0x83, 0xb,  0xd7, 0x39, 0x3d, 0x4f, 0xee, 0x2d, 0xeb, 0x10,
                   0x67, 0xa1, 0x40, 0x16, 0x5,  0x8,  0x5a, 0xa3, 0xdf, 0xb9, 0x7a, 0x0,  0x0,  0xd,  0xc9, 0x27,
                   0xa2, 0x82, 0x68, 0x96, 0x9e, 0x2f, 0xb8, 0x1c, 0x83, 0x9c, 0xfb, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x1e, 0x20, 0x60, 0x50, 0xd1, 0x99, 0xd2, 0xe1,
                                     0xec, 0xbb, 0xca, 0xf1, 0x4c, 0x94, 0xf1, 0x58};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5, 0x4d, 0xdd, 0xa8, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8a, 0x16, 0xa,  0x47, 0x13, 0x1d, 0xbd, 0xa9, 0x88, 0xbc, 0xf8,
                                     0x7e, 0x31, 0x41, 0xa0, 0x85, 0xfe, 0xd4, 0x29, 0xc5, 0x5c};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58, 0xda, 0x8e, 0xdb, 0xde, 0x43, 0xd6, 0x8e, 0x3,  0xd1,
                                     0x5d, 0x2d, 0xca, 0x6b, 0x1b, 0x92, 0x68, 0xa1, 0x6d, 0xcf};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa5, 0x99, 0x8,  0x92, 0x2f, 0x0,  0x83, 0xb, 0xd7, 0x39, 0x3d, 0x4f, 0xee, 0x2d,
                                     0xeb, 0x10, 0x67, 0xa1, 0x40, 0x16, 0x5,  0x8, 0x5a, 0xa3, 0xdf, 0xb9, 0x7a};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc9, 0x27, 0xa2, 0x82, 0x68, 0x96, 0x9e, 0x2f, 0xb8, 0x1c, 0x83, 0x9c, 0xfb};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7682, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9224 [("\199\229\146\190\EOT\224",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS =
// QoS0}),("\238\163\ETB\179[\253\146N.\169\223$\202\251\ENQ\183\191\183`\165\135\152f-qP\201\189\SUB",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("f\133\252\176\189\165",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("ai\ETX\141\131P\247\191\147\143",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0x82, 0x41, 0x24, 0x8,  0x0,  0x6,  0xc7, 0xe5, 0x92, 0xbe, 0x4,  0xe0, 0x0,  0x0,  0x1d, 0xee, 0xa3,
                   0x17, 0xb3, 0x5b, 0xfd, 0x92, 0x4e, 0x2e, 0xa9, 0xdf, 0x24, 0xca, 0xfb, 0x5,  0xb7, 0xbf, 0xb7, 0x60,
                   0xa5, 0x87, 0x98, 0x66, 0x2d, 0x71, 0x50, 0xc9, 0xbd, 0x1a, 0x1,  0x0,  0x6,  0x66, 0x85, 0xfc, 0xb0,
                   0xbd, 0xa5, 0x0,  0x0,  0xa,  0x61, 0x69, 0x3,  0x8d, 0x83, 0x50, 0xf7, 0xbf, 0x93, 0x8f, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xc7, 0xe5, 0x92, 0xbe, 0x4, 0xe0};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xee, 0xa3, 0x17, 0xb3, 0x5b, 0xfd, 0x92, 0x4e, 0x2e, 0xa9,
                                     0xdf, 0x24, 0xca, 0xfb, 0x5,  0xb7, 0xbf, 0xb7, 0x60, 0xa5,
                                     0x87, 0x98, 0x66, 0x2d, 0x71, 0x50, 0xc9, 0xbd, 0x1a};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x66, 0x85, 0xfc, 0xb0, 0xbd, 0xa5};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x61, 0x69, 0x3, 0x8d, 0x83, 0x50, 0xf7, 0xbf, 0x93, 0x8f};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 9224, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14508 [("R\USc\174\228\248\201\SYN\DC3\248\&2<h@3\163Jo\255\ETB4\159\159\EOTr\244`",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("kDT\132\249\207\190\139\253\141.o\143\143\250z\240\136}\212o\DC3S\151?\164\147",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\160\147#\236\207[\200:`c",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\152\v\231pTA\206\241\SO\ENQF\176\150\170\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0x5d, 0x38, 0xac, 0x0,  0x1b, 0x52, 0x1f, 0x63, 0xae, 0xe4, 0xf8, 0xc9, 0x16, 0x13, 0xf8,
                   0x32, 0x3c, 0x68, 0x40, 0x33, 0xa3, 0x4a, 0x6f, 0xff, 0x17, 0x34, 0x9f, 0x9f, 0x4,  0x72, 0xf4,
                   0x60, 0x2,  0x0,  0x1b, 0x6b, 0x44, 0x54, 0x84, 0xf9, 0xcf, 0xbe, 0x8b, 0xfd, 0x8d, 0x2e, 0x6f,
                   0x8f, 0x8f, 0xfa, 0x7a, 0xf0, 0x88, 0x7d, 0xd4, 0x6f, 0x13, 0x53, 0x97, 0x3f, 0xa4, 0x93, 0x2,
                   0x0,  0xa,  0xa0, 0x93, 0x23, 0xec, 0xcf, 0x5b, 0xc8, 0x3a, 0x60, 0x63, 0x2,  0x0,  0xf,  0x98,
                   0xb,  0xe7, 0x70, 0x54, 0x41, 0xce, 0xf1, 0xe,  0x5,  0x46, 0xb0, 0x96, 0xaa, 0x87, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x52, 0x1f, 0x63, 0xae, 0xe4, 0xf8, 0xc9, 0x16, 0x13, 0xf8, 0x32, 0x3c, 0x68, 0x40,
                                     0x33, 0xa3, 0x4a, 0x6f, 0xff, 0x17, 0x34, 0x9f, 0x9f, 0x4,  0x72, 0xf4, 0x60};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6b, 0x44, 0x54, 0x84, 0xf9, 0xcf, 0xbe, 0x8b, 0xfd, 0x8d, 0x2e, 0x6f, 0x8f, 0x8f,
                                     0xfa, 0x7a, 0xf0, 0x88, 0x7d, 0xd4, 0x6f, 0x13, 0x53, 0x97, 0x3f, 0xa4, 0x93};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa0, 0x93, 0x23, 0xec, 0xcf, 0x5b, 0xc8, 0x3a, 0x60, 0x63};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x98, 0xb, 0xe7, 0x70, 0x54, 0x41, 0xce, 0xf1,
                                     0xe,  0x5, 0x46, 0xb0, 0x96, 0xaa, 0x87};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14508, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24389 [("\255L)[J\CAN\t\240\&1\138\n",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\230\203\206\212\216\253-\EOT\b\248<",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0x82, 0x1e, 0x5f, 0x45, 0x0,  0xb,  0xff, 0x4c, 0x29, 0x5b, 0x4a, 0x18, 0x9, 0xf0, 0x31, 0x8a,
                   0xa,  0x0,  0x0,  0xb,  0xe6, 0xcb, 0xce, 0xd4, 0xd8, 0xfd, 0x2d, 0x4,  0x8, 0xf8, 0x3c, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xff, 0x4c, 0x29, 0x5b, 0x4a, 0x18, 0x9, 0xf0, 0x31, 0x8a, 0xa};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe6, 0xcb, 0xce, 0xd4, 0xd8, 0xfd, 0x2d, 0x4, 0x8, 0xf8, 0x3c};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24389, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10907 [("A\162\160\180\204w=\RSRuY\179\226\193\241M\SI_\205\144\150\163\229E\232\a\173",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("I?\215\128q+\210",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\156\203A\181",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS =
// QoS1}),("f,u\248\196\253Ec\136\146a\182D\192\SO\206\128\EMS\198~\227\179\225\&5\190\200",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\160\250\NAK\133R\172\224\SUB*\176\204\145",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0x82, 0x5e, 0x2a, 0x9b, 0x0,  0x1b, 0x41, 0xa2, 0xa0, 0xb4, 0xcc, 0x77, 0x3d, 0x1e, 0x52, 0x75,
                   0x59, 0xb3, 0xe2, 0xc1, 0xf1, 0x4d, 0xf,  0x5f, 0xcd, 0x90, 0x96, 0xa3, 0xe5, 0x45, 0xe8, 0x7,
                   0xad, 0x2,  0x0,  0x7,  0x49, 0x3f, 0xd7, 0x80, 0x71, 0x2b, 0xd2, 0x1,  0x0,  0x4,  0x9c, 0xcb,
                   0x41, 0xb5, 0x1,  0x0,  0x1b, 0x66, 0x2c, 0x75, 0xf8, 0xc4, 0xfd, 0x45, 0x63, 0x88, 0x92, 0x61,
                   0xb6, 0x44, 0xc0, 0xe,  0xce, 0x80, 0x19, 0x53, 0xc6, 0x7e, 0xe3, 0xb3, 0xe1, 0x35, 0xbe, 0xc8,
                   0x0,  0x0,  0xc,  0xa0, 0xfa, 0x15, 0x85, 0x52, 0xac, 0xe0, 0x1a, 0x2a, 0xb0, 0xcc, 0x91, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x41, 0xa2, 0xa0, 0xb4, 0xcc, 0x77, 0x3d, 0x1e, 0x52, 0x75, 0x59, 0xb3, 0xe2, 0xc1,
                                     0xf1, 0x4d, 0xf,  0x5f, 0xcd, 0x90, 0x96, 0xa3, 0xe5, 0x45, 0xe8, 0x7,  0xad};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x49, 0x3f, 0xd7, 0x80, 0x71, 0x2b, 0xd2};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9c, 0xcb, 0x41, 0xb5};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x66, 0x2c, 0x75, 0xf8, 0xc4, 0xfd, 0x45, 0x63, 0x88, 0x92, 0x61, 0xb6, 0x44, 0xc0,
                                     0xe,  0xce, 0x80, 0x19, 0x53, 0xc6, 0x7e, 0xe3, 0xb3, 0xe1, 0x35, 0xbe, 0xc8};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0xfa, 0x15, 0x85, 0x52, 0xac, 0xe0, 0x1a, 0x2a, 0xb0, 0xcc, 0x91};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10907, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19202 [("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\233$]\137\\\203f\234\199\ESC1+\152\242\NULM",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1\194\146\170\EM\r|!\171\192\142\CAN\203<\165p\EMg\236\CAN\174x:\235\165\US\196,\129",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\170\170\208h\229\130\bc\245#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS1}),("0\218\159\251\186A\250w\ETX\DC4Ni\223Dpd\238-\139\t\134x\DC2\148v",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\180\201\201.\222",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0x82, 0x69, 0x4b, 0x2,  0x0,  0x0,  0x1,  0x0,  0x10, 0xe9, 0x24, 0x5d, 0x89, 0x5c, 0xcb, 0x66,
                   0xea, 0xc7, 0x1b, 0x31, 0x2b, 0x98, 0xf2, 0x0,  0x4d, 0x0,  0x0,  0x1d, 0x31, 0xc2, 0x92, 0xaa,
                   0x19, 0xd,  0x7c, 0x21, 0xab, 0xc0, 0x8e, 0x18, 0xcb, 0x3c, 0xa5, 0x70, 0x19, 0x67, 0xec, 0x18,
                   0xae, 0x78, 0x3a, 0xeb, 0xa5, 0x1f, 0xc4, 0x2c, 0x81, 0x0,  0x0,  0xa,  0xaa, 0xaa, 0xd0, 0x68,
                   0xe5, 0x82, 0x8,  0x63, 0xf5, 0x23, 0x1,  0x0,  0x19, 0x30, 0xda, 0x9f, 0xfb, 0xba, 0x41, 0xfa,
                   0x77, 0x3,  0x14, 0x4e, 0x69, 0xdf, 0x44, 0x70, 0x64, 0xee, 0x2d, 0x8b, 0x9,  0x86, 0x78, 0x12,
                   0x94, 0x76, 0x1,  0x0,  0x5,  0xb4, 0xc9, 0xc9, 0x2e, 0xde, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe9, 0x24, 0x5d, 0x89, 0x5c, 0xcb, 0x66, 0xea,
                                     0xc7, 0x1b, 0x31, 0x2b, 0x98, 0xf2, 0x0,  0x4d};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x31, 0xc2, 0x92, 0xaa, 0x19, 0xd,  0x7c, 0x21, 0xab, 0xc0,
                                     0x8e, 0x18, 0xcb, 0x3c, 0xa5, 0x70, 0x19, 0x67, 0xec, 0x18,
                                     0xae, 0x78, 0x3a, 0xeb, 0xa5, 0x1f, 0xc4, 0x2c, 0x81};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xaa, 0xaa, 0xd0, 0x68, 0xe5, 0x82, 0x8, 0x63, 0xf5, 0x23};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x30, 0xda, 0x9f, 0xfb, 0xba, 0x41, 0xfa, 0x77, 0x3,  0x14, 0x4e, 0x69, 0xdf,
                                     0x44, 0x70, 0x64, 0xee, 0x2d, 0x8b, 0x9,  0x86, 0x78, 0x12, 0x94, 0x76};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb4, 0xc9, 0xc9, 0x2e, 0xde};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 19202, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1190 [("\177\230\158.\f",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("\220\251\RSJYw#\216\245\224",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\212g\230=\168k\211O",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("]\US@\f\210",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("+\161\199",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0x82, 0x30, 0x4,  0xa6, 0x0,  0x5,  0xb1, 0xe6, 0x9e, 0x2e, 0xc,  0x2,  0x0,  0xa,  0xdc, 0xfb, 0x1e,
                   0x4a, 0x59, 0x77, 0x23, 0xd8, 0xf5, 0xe0, 0x2,  0x0,  0x8,  0xd4, 0x67, 0xe6, 0x3d, 0xa8, 0x6b, 0xd3,
                   0x4f, 0x1,  0x0,  0x5,  0x5d, 0x1f, 0x40, 0xc,  0xd2, 0x2,  0x0,  0x3,  0x2b, 0xa1, 0xc7, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xb1, 0xe6, 0x9e, 0x2e, 0xc};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdc, 0xfb, 0x1e, 0x4a, 0x59, 0x77, 0x23, 0xd8, 0xf5, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd4, 0x67, 0xe6, 0x3d, 0xa8, 0x6b, 0xd3, 0x4f};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5d, 0x1f, 0x40, 0xc, 0xd2};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2b, 0xa1, 0xc7};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 1190, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4671 [("osy",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("\210HT\163\DC2\139\243O\224\246\242h\152\192\152y\186",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("\180Q\187",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("'\191s\156\EM\188\210\SOH\148\186\141\154{\206\STXwV\233\188+",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\149\r:\181V\203\NAK0\179\229",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("Re\176\RS\251\223S\255\200\190\180+\217!p",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("w\n\174\187\236vy\169\166\185\&1\149\SOH\250\131\152\204\US\128U\144\DC2\174",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\200\193\194\&8\241p\166",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0x82, 0x7f, 0x12, 0x3f, 0x0,  0x3,  0x6f, 0x73, 0x79, 0x2,  0x0,  0x11, 0xd2, 0x48, 0x54, 0xa3, 0x12,
                   0x8b, 0xf3, 0x4f, 0xe0, 0xf6, 0xf2, 0x68, 0x98, 0xc0, 0x98, 0x79, 0xba, 0x1,  0x0,  0x3,  0xb4, 0x51,
                   0xbb, 0x2,  0x0,  0x0,  0x2,  0x0,  0x14, 0x27, 0xbf, 0x73, 0x9c, 0x19, 0xbc, 0xd2, 0x1,  0x94, 0xba,
                   0x8d, 0x9a, 0x7b, 0xce, 0x2,  0x77, 0x56, 0xe9, 0xbc, 0x2b, 0x0,  0x0,  0xa,  0x95, 0xd,  0x3a, 0xb5,
                   0x56, 0xcb, 0x15, 0x30, 0xb3, 0xe5, 0x2,  0x0,  0xf,  0x52, 0x65, 0xb0, 0x1e, 0xfb, 0xdf, 0x53, 0xff,
                   0xc8, 0xbe, 0xb4, 0x2b, 0xd9, 0x21, 0x70, 0x2,  0x0,  0x17, 0x77, 0xa,  0xae, 0xbb, 0xec, 0x76, 0x79,
                   0xa9, 0xa6, 0xb9, 0x31, 0x95, 0x1,  0xfa, 0x83, 0x98, 0xcc, 0x1f, 0x80, 0x55, 0x90, 0x12, 0xae, 0x2,
                   0x0,  0x7,  0xc8, 0xc1, 0xc2, 0x38, 0xf1, 0x70, 0xa6, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x6f, 0x73, 0x79};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd2, 0x48, 0x54, 0xa3, 0x12, 0x8b, 0xf3, 0x4f, 0xe0,
                                     0xf6, 0xf2, 0x68, 0x98, 0xc0, 0x98, 0x79, 0xba};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb4, 0x51, 0xbb};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x27, 0xbf, 0x73, 0x9c, 0x19, 0xbc, 0xd2, 0x1,  0x94, 0xba,
                                     0x8d, 0x9a, 0x7b, 0xce, 0x2,  0x77, 0x56, 0xe9, 0xbc, 0x2b};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x95, 0xd, 0x3a, 0xb5, 0x56, 0xcb, 0x15, 0x30, 0xb3, 0xe5};
  lwmqtt_string_t topic_filter_s5 = {10, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x52, 0x65, 0xb0, 0x1e, 0xfb, 0xdf, 0x53, 0xff,
                                     0xc8, 0xbe, 0xb4, 0x2b, 0xd9, 0x21, 0x70};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x77, 0xa,  0xae, 0xbb, 0xec, 0x76, 0x79, 0xa9, 0xa6, 0xb9, 0x31, 0x95,
                                     0x1,  0xfa, 0x83, 0x98, 0xcc, 0x1f, 0x80, 0x55, 0x90, 0x12, 0xae};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc8, 0xc1, 0xc2, 0x38, 0xf1, 0x70, 0xa6};
  lwmqtt_string_t topic_filter_s8 = {7, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 4671, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22250 [("\186\185\130\168\166",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS =
// QoS1}),("\155\157\SYN\229\227\209\&4\SOH|\242\168\253\129xF\166\\\"BG\191\246\215",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\182\&7\250\251\141.\181\185",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\134&\251\172\216\150}\237\b\142\246",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\197\235",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("K\195})\202\&1'\218\169\SOH\200g\252\235R\225\201\b&@\v Y~\144x\232",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\163\249Y`\207\ETB\EOTf\n\159!l\SUB2hs\162\149\186\250?\a\220\237\200",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\177\128;f\163y\182\222\185\r\SYN\US-y#\168\SO\190Cu\SO\r\143~y\254\vi\163X",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\236Fm\234\247v&5\249\208\&0\FS",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS2}),("b",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0xb3, 0x1,  0x56, 0xea, 0x0,  0x5,  0xba, 0xb9, 0x82, 0xa8, 0xa6, 0x1,  0x0,  0x17, 0x9b, 0x9d,
                   0x16, 0xe5, 0xe3, 0xd1, 0x34, 0x1,  0x7c, 0xf2, 0xa8, 0xfd, 0x81, 0x78, 0x46, 0xa6, 0x5c, 0x22, 0x42,
                   0x47, 0xbf, 0xf6, 0xd7, 0x0,  0x0,  0x8,  0xb6, 0x37, 0xfa, 0xfb, 0x8d, 0x2e, 0xb5, 0xb9, 0x2,  0x0,
                   0x0,  0x0,  0x0,  0xb,  0x86, 0x26, 0xfb, 0xac, 0xd8, 0x96, 0x7d, 0xed, 0x8,  0x8e, 0xf6, 0x2,  0x0,
                   0x2,  0xc5, 0xeb, 0x2,  0x0,  0x1b, 0x4b, 0xc3, 0x7d, 0x29, 0xca, 0x31, 0x27, 0xda, 0xa9, 0x1,  0xc8,
                   0x67, 0xfc, 0xeb, 0x52, 0xe1, 0xc9, 0x8,  0x26, 0x40, 0xb,  0x20, 0x59, 0x7e, 0x90, 0x78, 0xe8, 0x2,
                   0x0,  0x19, 0xa3, 0xf9, 0x59, 0x60, 0xcf, 0x17, 0x4,  0x66, 0xa,  0x9f, 0x21, 0x6c, 0x1a, 0x32, 0x68,
                   0x73, 0xa2, 0x95, 0xba, 0xfa, 0x3f, 0x7,  0xdc, 0xed, 0xc8, 0x1,  0x0,  0x1e, 0xb1, 0x80, 0x3b, 0x66,
                   0xa3, 0x79, 0xb6, 0xde, 0xb9, 0xd,  0x16, 0x1f, 0x2d, 0x79, 0x23, 0xa8, 0xe,  0xbe, 0x43, 0x75, 0xe,
                   0xd,  0x8f, 0x7e, 0x79, 0xfe, 0xb,  0x69, 0xa3, 0x58, 0x2,  0x0,  0xc,  0xec, 0x46, 0x6d, 0xea, 0xf7,
                   0x76, 0x26, 0x35, 0xf9, 0xd0, 0x30, 0x1c, 0x2,  0x0,  0x1,  0x62, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xba, 0xb9, 0x82, 0xa8, 0xa6};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9b, 0x9d, 0x16, 0xe5, 0xe3, 0xd1, 0x34, 0x1,  0x7c, 0xf2, 0xa8, 0xfd,
                                     0x81, 0x78, 0x46, 0xa6, 0x5c, 0x22, 0x42, 0x47, 0xbf, 0xf6, 0xd7};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb6, 0x37, 0xfa, 0xfb, 0x8d, 0x2e, 0xb5, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x86, 0x26, 0xfb, 0xac, 0xd8, 0x96, 0x7d, 0xed, 0x8, 0x8e, 0xf6};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc5, 0xeb};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4b, 0xc3, 0x7d, 0x29, 0xca, 0x31, 0x27, 0xda, 0xa9, 0x1,  0xc8, 0x67, 0xfc, 0xeb,
                                     0x52, 0xe1, 0xc9, 0x8,  0x26, 0x40, 0xb,  0x20, 0x59, 0x7e, 0x90, 0x78, 0xe8};
  lwmqtt_string_t topic_filter_s6 = {27, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa3, 0xf9, 0x59, 0x60, 0xcf, 0x17, 0x4,  0x66, 0xa, 0x9f, 0x21, 0x6c, 0x1a,
                                     0x32, 0x68, 0x73, 0xa2, 0x95, 0xba, 0xfa, 0x3f, 0x7, 0xdc, 0xed, 0xc8};
  lwmqtt_string_t topic_filter_s7 = {25, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xb1, 0x80, 0x3b, 0x66, 0xa3, 0x79, 0xb6, 0xde, 0xb9, 0xd,
                                     0x16, 0x1f, 0x2d, 0x79, 0x23, 0xa8, 0xe,  0xbe, 0x43, 0x75,
                                     0xe,  0xd,  0x8f, 0x7e, 0x79, 0xfe, 0xb,  0x69, 0xa3, 0x58};
  lwmqtt_string_t topic_filter_s8 = {30, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xec, 0x46, 0x6d, 0xea, 0xf7, 0x76, 0x26, 0x35, 0xf9, 0xd0, 0x30, 0x1c};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x62};
  lwmqtt_string_t topic_filter_s10 = {1, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22250, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22609 [("9\162A\164\214x2\135U|)\230\201t\GS\197\189",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\SYN!\148\165\145\182dN\241\238@\176\144\v\210`\247d!u\206\133\167\190\&8",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\SUB\209\216\248:\200\215\CAN\234\STX\238\216\159Q\183\221\SYN\173<\182\128\142\n,\f",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\129?\164a4\230\147\232\177\225\226\247\131\222\205\ENQ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\DC2a\186H\140\172N<\153M\252\171\252Ji'\DC3\f36\GS\236\DC4t\200",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("{\204\244O\162>\CAN9\152\209\137,[\171\227\225\131%",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),(")eM\218\&6\152 \202\231\152J\139",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\200[\DC1O\176\181\136",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal
// = False, _subQoS = QoS0}),("\209f\ENQ!\195\251$^7\130\148_\DC4\189\167\202s\172\210\149\254\181=",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("2a\216\&2\185\140i=\199\224\250\&3\230r\DC4\161\146\130G",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\136\ETX\176~\130\DC1\"\241\SIp\253\190\162\219\183`\234",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode26) {
  uint8_t pkt[] = {
      0x82, 0xef, 0x1,  0x58, 0x51, 0x0,  0x11, 0x39, 0xa2, 0x41, 0xa4, 0xd6, 0x78, 0x32, 0x87, 0x55, 0x7c, 0x29, 0xe6,
      0xc9, 0x74, 0x1d, 0xc5, 0xbd, 0x0,  0x0,  0x19, 0x16, 0x21, 0x94, 0xa5, 0x91, 0xb6, 0x64, 0x4e, 0xf1, 0xee, 0x40,
      0xb0, 0x90, 0xb,  0xd2, 0x60, 0xf7, 0x64, 0x21, 0x75, 0xce, 0x85, 0xa7, 0xbe, 0x38, 0x0,  0x0,  0x19, 0x1a, 0xd1,
      0xd8, 0xf8, 0x3a, 0xc8, 0xd7, 0x18, 0xea, 0x2,  0xee, 0xd8, 0x9f, 0x51, 0xb7, 0xdd, 0x16, 0xad, 0x3c, 0xb6, 0x80,
      0x8e, 0xa,  0x2c, 0xc,  0x1,  0x0,  0x10, 0x81, 0x3f, 0xa4, 0x61, 0x34, 0xe6, 0x93, 0xe8, 0xb1, 0xe1, 0xe2, 0xf7,
      0x83, 0xde, 0xcd, 0x5,  0x1,  0x0,  0x19, 0x12, 0x61, 0xba, 0x48, 0x8c, 0xac, 0x4e, 0x3c, 0x99, 0x4d, 0xfc, 0xab,
      0xfc, 0x4a, 0x69, 0x27, 0x13, 0xc,  0x33, 0x36, 0x1d, 0xec, 0x14, 0x74, 0xc8, 0x2,  0x0,  0x12, 0x7b, 0xcc, 0xf4,
      0x4f, 0xa2, 0x3e, 0x18, 0x39, 0x98, 0xd1, 0x89, 0x2c, 0x5b, 0xab, 0xe3, 0xe1, 0x83, 0x25, 0x0,  0x0,  0xc,  0x29,
      0x65, 0x4d, 0xda, 0x36, 0x98, 0x20, 0xca, 0xe7, 0x98, 0x4a, 0x8b, 0x2,  0x0,  0x7,  0xc8, 0x5b, 0x11, 0x4f, 0xb0,
      0xb5, 0x88, 0x0,  0x0,  0x17, 0xd1, 0x66, 0x5,  0x21, 0xc3, 0xfb, 0x24, 0x5e, 0x37, 0x82, 0x94, 0x5f, 0x14, 0xbd,
      0xa7, 0xca, 0x73, 0xac, 0xd2, 0x95, 0xfe, 0xb5, 0x3d, 0x2,  0x0,  0x13, 0x32, 0x61, 0xd8, 0x32, 0xb9, 0x8c, 0x69,
      0x3d, 0xc7, 0xe0, 0xfa, 0x33, 0xe6, 0x72, 0x14, 0xa1, 0x92, 0x82, 0x47, 0x1,  0x0,  0x11, 0x88, 0x3,  0xb0, 0x7e,
      0x82, 0x11, 0x22, 0xf1, 0xf,  0x70, 0xfd, 0xbe, 0xa2, 0xdb, 0xb7, 0x60, 0xea, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x39, 0xa2, 0x41, 0xa4, 0xd6, 0x78, 0x32, 0x87, 0x55,
                                     0x7c, 0x29, 0xe6, 0xc9, 0x74, 0x1d, 0xc5, 0xbd};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x16, 0x21, 0x94, 0xa5, 0x91, 0xb6, 0x64, 0x4e, 0xf1, 0xee, 0x40, 0xb0, 0x90,
                                     0xb,  0xd2, 0x60, 0xf7, 0x64, 0x21, 0x75, 0xce, 0x85, 0xa7, 0xbe, 0x38};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0xd1, 0xd8, 0xf8, 0x3a, 0xc8, 0xd7, 0x18, 0xea, 0x2, 0xee, 0xd8, 0x9f,
                                     0x51, 0xb7, 0xdd, 0x16, 0xad, 0x3c, 0xb6, 0x80, 0x8e, 0xa, 0x2c, 0xc};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x81, 0x3f, 0xa4, 0x61, 0x34, 0xe6, 0x93, 0xe8,
                                     0xb1, 0xe1, 0xe2, 0xf7, 0x83, 0xde, 0xcd, 0x5};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0x61, 0xba, 0x48, 0x8c, 0xac, 0x4e, 0x3c, 0x99, 0x4d, 0xfc, 0xab, 0xfc,
                                     0x4a, 0x69, 0x27, 0x13, 0xc,  0x33, 0x36, 0x1d, 0xec, 0x14, 0x74, 0xc8};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7b, 0xcc, 0xf4, 0x4f, 0xa2, 0x3e, 0x18, 0x39, 0x98,
                                     0xd1, 0x89, 0x2c, 0x5b, 0xab, 0xe3, 0xe1, 0x83, 0x25};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x29, 0x65, 0x4d, 0xda, 0x36, 0x98, 0x20, 0xca, 0xe7, 0x98, 0x4a, 0x8b};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc8, 0x5b, 0x11, 0x4f, 0xb0, 0xb5, 0x88};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd1, 0x66, 0x5,  0x21, 0xc3, 0xfb, 0x24, 0x5e, 0x37, 0x82, 0x94, 0x5f,
                                     0x14, 0xbd, 0xa7, 0xca, 0x73, 0xac, 0xd2, 0x95, 0xfe, 0xb5, 0x3d};
  lwmqtt_string_t topic_filter_s8 = {23, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x32, 0x61, 0xd8, 0x32, 0xb9, 0x8c, 0x69, 0x3d, 0xc7, 0xe0,
                                     0xfa, 0x33, 0xe6, 0x72, 0x14, 0xa1, 0x92, 0x82, 0x47};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x88, 0x3,  0xb0, 0x7e, 0x82, 0x11, 0x22, 0xf1, 0xf,
                                      0x70, 0xfd, 0xbe, 0xa2, 0xdb, 0xb7, 0x60, 0xea};
  lwmqtt_string_t topic_filter_s10 = {17, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22609, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5459 [("\167\&9\128\201\254\251f\154)\222\SYN\n\182w",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\v\244",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\NULV?\231o\214\r\141\181\DC4\236\139\166f\RS?B_",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\134\198\224\203\182\223E\204\128l\208\172\156\"\246",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\170b\195j\211}D\139\ESC\192\ACK9!\244F\140&1\143W\DC1Qy\211",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("p\NULm,\228\200\DLE\134\191V\174\192\SOHm\145H\RS\US\177\SIt\\",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\SOH\251cC\207\239\246\&5\202\158\vi\196\&1",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0x82, 0x84, 0x1,  0x15, 0x53, 0x0,  0xe,  0xa7, 0x39, 0x80, 0xc9, 0xfe, 0xfb, 0x66, 0x9a, 0x29, 0xde,
                   0x16, 0xa,  0xb6, 0x77, 0x2,  0x0,  0x2,  0xb,  0xf4, 0x0,  0x0,  0x12, 0x0,  0x56, 0x3f, 0xe7, 0x6f,
                   0xd6, 0xd,  0x8d, 0xb5, 0x14, 0xec, 0x8b, 0xa6, 0x66, 0x1e, 0x3f, 0x42, 0x5f, 0x2,  0x0,  0xf,  0x86,
                   0xc6, 0xe0, 0xcb, 0xb6, 0xdf, 0x45, 0xcc, 0x80, 0x6c, 0xd0, 0xac, 0x9c, 0x22, 0xf6, 0x0,  0x0,  0x18,
                   0xaa, 0x62, 0xc3, 0x6a, 0xd3, 0x7d, 0x44, 0x8b, 0x1b, 0xc0, 0x6,  0x39, 0x21, 0xf4, 0x46, 0x8c, 0x26,
                   0x31, 0x8f, 0x57, 0x11, 0x51, 0x79, 0xd3, 0x2,  0x0,  0x16, 0x70, 0x0,  0x6d, 0x2c, 0xe4, 0xc8, 0x10,
                   0x86, 0xbf, 0x56, 0xae, 0xc0, 0x1,  0x6d, 0x91, 0x48, 0x1e, 0x1f, 0xb1, 0xf,  0x74, 0x5c, 0x1,  0x0,
                   0xe,  0x1,  0xfb, 0x63, 0x43, 0xcf, 0xef, 0xf6, 0x35, 0xca, 0x9e, 0xb,  0x69, 0xc4, 0x31, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xa7, 0x39, 0x80, 0xc9, 0xfe, 0xfb, 0x66, 0x9a, 0x29, 0xde, 0x16, 0xa, 0xb6, 0x77};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb, 0xf4};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x0,  0x56, 0x3f, 0xe7, 0x6f, 0xd6, 0xd,  0x8d, 0xb5,
                                     0x14, 0xec, 0x8b, 0xa6, 0x66, 0x1e, 0x3f, 0x42, 0x5f};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x86, 0xc6, 0xe0, 0xcb, 0xb6, 0xdf, 0x45, 0xcc,
                                     0x80, 0x6c, 0xd0, 0xac, 0x9c, 0x22, 0xf6};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xaa, 0x62, 0xc3, 0x6a, 0xd3, 0x7d, 0x44, 0x8b, 0x1b, 0xc0, 0x6,  0x39,
                                     0x21, 0xf4, 0x46, 0x8c, 0x26, 0x31, 0x8f, 0x57, 0x11, 0x51, 0x79, 0xd3};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x70, 0x0, 0x6d, 0x2c, 0xe4, 0xc8, 0x10, 0x86, 0xbf, 0x56, 0xae,
                                     0xc0, 0x1, 0x6d, 0x91, 0x48, 0x1e, 0x1f, 0xb1, 0xf,  0x74, 0x5c};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1, 0xfb, 0x63, 0x43, 0xcf, 0xef, 0xf6, 0x35, 0xca, 0x9e, 0xb, 0x69, 0xc4, 0x31};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5459, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21650
// [("\144\143\250\181?\222c\242\195\194iT\235\216\230\207\176(\169\205\175g\RS\221}V\US\206\228\167",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("r\242Fl\STX\222\224\199\213\254?\253\b\n\241\ESC\137f\252\ETX",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\188\213\&9\219v$\165F\194\195\157\155\193\DC2y\EM",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("Yk\181r6Q\f\148l\155\151\149\206I\133\&8\SOH\SOH\148\SUBaQ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("D\191",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x6e, 0x54, 0x92, 0x0,  0x1e, 0x90, 0x8f, 0xfa, 0xb5, 0x3f, 0xde, 0x63, 0xf2, 0xc3, 0xc2,
                   0x69, 0x54, 0xeb, 0xd8, 0xe6, 0xcf, 0xb0, 0x28, 0xa9, 0xcd, 0xaf, 0x67, 0x1e, 0xdd, 0x7d, 0x56,
                   0x1f, 0xce, 0xe4, 0xa7, 0x2,  0x0,  0x14, 0x72, 0xf2, 0x46, 0x6c, 0x2,  0xde, 0xe0, 0xc7, 0xd5,
                   0xfe, 0x3f, 0xfd, 0x8,  0xa,  0xf1, 0x1b, 0x89, 0x66, 0xfc, 0x3,  0x0,  0x0,  0x0,  0x0,  0x0,
                   0x10, 0xbc, 0xd5, 0x39, 0xdb, 0x76, 0x24, 0xa5, 0x46, 0xc2, 0xc3, 0x9d, 0x9b, 0xc1, 0x12, 0x79,
                   0x19, 0x1,  0x0,  0x16, 0x59, 0x6b, 0xb5, 0x72, 0x36, 0x51, 0xc,  0x94, 0x6c, 0x9b, 0x97, 0x95,
                   0xce, 0x49, 0x85, 0x38, 0x1,  0x1,  0x94, 0x1a, 0x61, 0x51, 0x2,  0x0,  0x2,  0x44, 0xbf, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x90, 0x8f, 0xfa, 0xb5, 0x3f, 0xde, 0x63, 0xf2, 0xc3, 0xc2,
                                     0x69, 0x54, 0xeb, 0xd8, 0xe6, 0xcf, 0xb0, 0x28, 0xa9, 0xcd,
                                     0xaf, 0x67, 0x1e, 0xdd, 0x7d, 0x56, 0x1f, 0xce, 0xe4, 0xa7};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x72, 0xf2, 0x46, 0x6c, 0x2,  0xde, 0xe0, 0xc7, 0xd5, 0xfe,
                                     0x3f, 0xfd, 0x8,  0xa,  0xf1, 0x1b, 0x89, 0x66, 0xfc, 0x3};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xbc, 0xd5, 0x39, 0xdb, 0x76, 0x24, 0xa5, 0x46,
                                     0xc2, 0xc3, 0x9d, 0x9b, 0xc1, 0x12, 0x79, 0x19};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x59, 0x6b, 0xb5, 0x72, 0x36, 0x51, 0xc, 0x94, 0x6c, 0x9b, 0x97,
                                     0x95, 0xce, 0x49, 0x85, 0x38, 0x1,  0x1, 0x94, 0x1a, 0x61, 0x51};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x44, 0xbf};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21650, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15109 [("\175\231\162\204$\151/\218\&0m\229",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] []
TEST(Subscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x10, 0x3b, 0x5,  0x0,  0xb,  0xaf, 0xe7, 0xa2,
                   0xcc, 0x24, 0x97, 0x2f, 0xda, 0x30, 0x6d, 0xe5, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xaf, 0xe7, 0xa2, 0xcc, 0x24, 0x97, 0x2f, 0xda, 0x30, 0x6d, 0xe5};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 15109, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31149 [("(\255\220",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("nuB\184\220_5\217\196}\246\129",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\n?*\177\237",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("\166\247\163\135\239\140E\178R\230-\152",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = False, _subQoS = QoS1}),("z\250o\254y\a\a,\201+#\222\212\164\CAN\DC1\184\138\217",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ESC\220\r4\ak\135",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2})] []
TEST(Subscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x4e, 0x79, 0xad, 0x0,  0x3,  0x28, 0xff, 0xdc, 0x0,  0x0,  0xc,  0x6e, 0x75, 0x42, 0xb8,
                   0xdc, 0x5f, 0x35, 0xd9, 0xc4, 0x7d, 0xf6, 0x81, 0x0,  0x0,  0x5,  0xa,  0x3f, 0x2a, 0xb1, 0xed,
                   0x1,  0x0,  0xc,  0xa6, 0xf7, 0xa3, 0x87, 0xef, 0x8c, 0x45, 0xb2, 0x52, 0xe6, 0x2d, 0x98, 0x1,
                   0x0,  0x13, 0x7a, 0xfa, 0x6f, 0xfe, 0x79, 0x7,  0x7,  0x2c, 0xc9, 0x2b, 0x23, 0xde, 0xd4, 0xa4,
                   0x18, 0x11, 0xb8, 0x8a, 0xd9, 0x2,  0x0,  0x7,  0x1b, 0xdc, 0xd,  0x34, 0x7,  0x6b, 0x87, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x28, 0xff, 0xdc};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e, 0x75, 0x42, 0xb8, 0xdc, 0x5f, 0x35, 0xd9, 0xc4, 0x7d, 0xf6, 0x81};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa, 0x3f, 0x2a, 0xb1, 0xed};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa6, 0xf7, 0xa3, 0x87, 0xef, 0x8c, 0x45, 0xb2, 0x52, 0xe6, 0x2d, 0x98};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7a, 0xfa, 0x6f, 0xfe, 0x79, 0x7,  0x7,  0x2c, 0xc9, 0x2b,
                                     0x23, 0xde, 0xd4, 0xa4, 0x18, 0x11, 0xb8, 0x8a, 0xd9};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1b, 0xdc, 0xd, 0x34, 0x7, 0x6b, 0x87};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 31149, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 28306 [("^VR\US\DELZ\SYN\186#\147D\230\US:\188\210\186\165}\145tM\224\&4\158",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\146\&4\203\145\SUB\209\235\223`.\147\&8\250Q\187\223\244\210b\235p\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\205\151*/E\ETXy",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("m\136\t\NUL\228\154\166\199TU&2\143",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = True, _noLocal = False, _subQoS = QoS2})] [PropAuthenticationMethod
// "\151\191.\146\237\136B\SO\187[\200s\174\240\131\247\245",PropTopicAliasMaximum 30483,PropReceiveMaximum
// 10665,PropTopicAliasMaximum 27539,PropWillDelayInterval 20866,PropRetainAvailable 17,PropRetainAvailable
// 110,PropAuthenticationMethod
// "\210\137\139/\245\193\179\&6\148\191\195\ETB\ACKy@L\218\STX\150\162\239\235",PropRequestProblemInformation
// 146,PropRequestResponseInformation 102,PropTopicAlias 2117,PropMaximumPacketSize 21081,PropSessionExpiryInterval
// 9240,PropUserProperty "\148\138\ETBU\242<Zk^#TM\tU\DC3"
// "\204_\154\135\252\255K\206\208\\0\198\CANAYv\237U",PropMessageExpiryInterval 30444,PropCorrelationData
// "\176\204\191)U\FS\162V\178\239\243\203\SOHt\209\128\128\240\203\147f",PropSubscriptionIdentifierAvailable
// 243,PropReceiveMaximum 12253,PropAssignedClientIdentifier "Z\195\235\224",PropMaximumPacketSize
// 21509,PropRetainAvailable 240,PropContentType "\243f\n\241\219\ETBRt$\208n&\131,"]
TEST(Subscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0x82, 0x8a, 0x2,  0x6e, 0x92, 0xb7, 0x1,  0x15, 0x0,  0x11, 0x97, 0xbf, 0x2e, 0x92, 0xed, 0x88, 0x42,
                   0xe,  0xbb, 0x5b, 0xc8, 0x73, 0xae, 0xf0, 0x83, 0xf7, 0xf5, 0x22, 0x77, 0x13, 0x21, 0x29, 0xa9, 0x22,
                   0x6b, 0x93, 0x18, 0x0,  0x0,  0x51, 0x82, 0x25, 0x11, 0x25, 0x6e, 0x15, 0x0,  0x16, 0xd2, 0x89, 0x8b,
                   0x2f, 0xf5, 0xc1, 0xb3, 0x36, 0x94, 0xbf, 0xc3, 0x17, 0x6,  0x79, 0x40, 0x4c, 0xda, 0x2,  0x96, 0xa2,
                   0xef, 0xeb, 0x17, 0x92, 0x19, 0x66, 0x23, 0x8,  0x45, 0x27, 0x0,  0x0,  0x52, 0x59, 0x11, 0x0,  0x0,
                   0x24, 0x18, 0x26, 0x0,  0xf,  0x94, 0x8a, 0x17, 0x55, 0xf2, 0x3c, 0x5a, 0x6b, 0x5e, 0x23, 0x54, 0x4d,
                   0x9,  0x55, 0x13, 0x0,  0x12, 0xcc, 0x5f, 0x9a, 0x87, 0xfc, 0xff, 0x4b, 0xce, 0xd0, 0x5c, 0x30, 0xc6,
                   0x18, 0x41, 0x59, 0x76, 0xed, 0x55, 0x2,  0x0,  0x0,  0x76, 0xec, 0x9,  0x0,  0x15, 0xb0, 0xcc, 0xbf,
                   0x29, 0x55, 0x1c, 0xa2, 0x56, 0xb2, 0xef, 0xf3, 0xcb, 0x1,  0x74, 0xd1, 0x80, 0x80, 0xf0, 0xcb, 0x93,
                   0x66, 0x29, 0xf3, 0x21, 0x2f, 0xdd, 0x12, 0x0,  0x4,  0x5a, 0xc3, 0xeb, 0xe0, 0x27, 0x0,  0x0,  0x54,
                   0x5,  0x25, 0xf0, 0x3,  0x0,  0xe,  0xf3, 0x66, 0xa,  0xf1, 0xdb, 0x17, 0x52, 0x74, 0x24, 0xd0, 0x6e,
                   0x26, 0x83, 0x2c, 0x0,  0x19, 0x5e, 0x56, 0x52, 0x1f, 0x7f, 0x5a, 0x16, 0xba, 0x23, 0x93, 0x44, 0xe6,
                   0x1f, 0x3a, 0xbc, 0xd2, 0xba, 0xa5, 0x7d, 0x91, 0x74, 0x4d, 0xe0, 0x34, 0x9e, 0x26, 0x0,  0x16, 0x92,
                   0x34, 0xcb, 0x91, 0x1a, 0xd1, 0xeb, 0xdf, 0x60, 0x2e, 0x93, 0x38, 0xfa, 0x51, 0xbb, 0xdf, 0xf4, 0xd2,
                   0x62, 0xeb, 0x70, 0x1e, 0xc,  0x0,  0x7,  0xcd, 0x97, 0x2a, 0x2f, 0x45, 0x3,  0x79, 0x1a, 0x0,  0xd,
                   0x6d, 0x88, 0x9,  0x0,  0xe4, 0x9a, 0xa6, 0xc7, 0x54, 0x55, 0x26, 0x32, 0x8f, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x5e, 0x56, 0x52, 0x1f, 0x7f, 0x5a, 0x16, 0xba, 0x23, 0x93, 0x44, 0xe6, 0x1f,
                                     0x3a, 0xbc, 0xd2, 0xba, 0xa5, 0x7d, 0x91, 0x74, 0x4d, 0xe0, 0x34, 0x9e};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x92, 0x34, 0xcb, 0x91, 0x1a, 0xd1, 0xeb, 0xdf, 0x60, 0x2e, 0x93,
                                     0x38, 0xfa, 0x51, 0xbb, 0xdf, 0xf4, 0xd2, 0x62, 0xeb, 0x70, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xcd, 0x97, 0x2a, 0x2f, 0x45, 0x3, 0x79};
  lwmqtt_string_t topic_filter_s2 = {7, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x6d, 0x88, 0x9, 0x0, 0xe4, 0x9a, 0xa6, 0xc7, 0x54, 0x55, 0x26, 0x32, 0x8f};
  lwmqtt_string_t topic_filter_s3 = {13, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  uint8_t bytesprops0[] = {0x97, 0xbf, 0x2e, 0x92, 0xed, 0x88, 0x42, 0xe, 0xbb,
                           0x5b, 0xc8, 0x73, 0xae, 0xf0, 0x83, 0xf7, 0xf5};
  uint8_t bytesprops1[] = {0xd2, 0x89, 0x8b, 0x2f, 0xf5, 0xc1, 0xb3, 0x36, 0x94, 0xbf, 0xc3,
                           0x17, 0x6,  0x79, 0x40, 0x4c, 0xda, 0x2,  0x96, 0xa2, 0xef, 0xeb};
  uint8_t bytesprops3[] = {0xcc, 0x5f, 0x9a, 0x87, 0xfc, 0xff, 0x4b, 0xce, 0xd0,
                           0x5c, 0x30, 0xc6, 0x18, 0x41, 0x59, 0x76, 0xed, 0x55};
  uint8_t bytesprops2[] = {0x94, 0x8a, 0x17, 0x55, 0xf2, 0x3c, 0x5a, 0x6b, 0x5e, 0x23, 0x54, 0x4d, 0x9, 0x55, 0x13};
  uint8_t bytesprops4[] = {0xb0, 0xcc, 0xbf, 0x29, 0x55, 0x1c, 0xa2, 0x56, 0xb2, 0xef, 0xf3,
                           0xcb, 0x1,  0x74, 0xd1, 0x80, 0x80, 0xf0, 0xcb, 0x93, 0x66};
  uint8_t bytesprops5[] = {0x5a, 0xc3, 0xeb, 0xe0};
  uint8_t bytesprops6[] = {0xf3, 0x66, 0xa, 0xf1, 0xdb, 0x17, 0x52, 0x74, 0x24, 0xd0, 0x6e, 0x26, 0x83, 0x2c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30483}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10665}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 27539}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20866}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2117}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21081}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9240}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {15, (char*)&bytesprops2}, .v = {18, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30444}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12253}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21509}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops6}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28306, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 13416 [("\r\166\147\EM\SI{\SOH\234l\226\237]\132$!)Y%\182 \DC3\174-C\164D\FS\145@",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),(",\156\&5\239\239:@",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal
// = True, _subQoS = QoS2}),("#\138\nSgRd\ACKU\180\186\145R\159\249/\EM\142 \146X\228I33\178#",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),(";\130\229\172!\203|",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS2}),("R\183\NUL\247G\201\192\NAKw\152.p\230\DEL\208\197!\243e\167\203",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})]
// [PropSharedSubscriptionAvailable 218,PropSessionExpiryInterval 30374,PropSharedSubscriptionAvailable
// 130,PropSubscriptionIdentifierAvailable 132,PropTopicAlias 12495,PropSessionExpiryInterval 27761]
TEST(Subscribe5QCTest, Encode2) {
  uint8_t pkt[] = {0x82, 0x80, 0x1,  0x34, 0x68, 0x13, 0x2a, 0xda, 0x11, 0x0,  0x0,  0x76, 0xa6, 0x2a, 0x82, 0x29, 0x84,
                   0x23, 0x30, 0xcf, 0x11, 0x0,  0x0,  0x6c, 0x71, 0x0,  0x1d, 0xd,  0xa6, 0x93, 0x19, 0xf,  0x7b, 0x1,
                   0xea, 0x6c, 0xe2, 0xed, 0x5d, 0x84, 0x24, 0x21, 0x29, 0x59, 0x25, 0xb6, 0x20, 0x13, 0xae, 0x2d, 0x43,
                   0xa4, 0x44, 0x1c, 0x91, 0x40, 0x10, 0x0,  0x7,  0x2c, 0x9c, 0x35, 0xef, 0xef, 0x3a, 0x40, 0x26, 0x0,
                   0x1b, 0x23, 0x8a, 0xa,  0x53, 0x67, 0x52, 0x64, 0x6,  0x55, 0xb4, 0xba, 0x91, 0x52, 0x9f, 0xf9, 0x2f,
                   0x19, 0x8e, 0x20, 0x92, 0x58, 0xe4, 0x49, 0x33, 0x33, 0xb2, 0x23, 0xc,  0x0,  0x7,  0x3b, 0x82, 0xe5,
                   0xac, 0x21, 0xcb, 0x7c, 0x2,  0x0,  0x15, 0x52, 0xb7, 0x0,  0xf7, 0x47, 0xc9, 0xc0, 0x15, 0x77, 0x98,
                   0x2e, 0x70, 0xe6, 0x7f, 0xd0, 0xc5, 0x21, 0xf3, 0x65, 0xa7, 0xcb, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xd,  0xa6, 0x93, 0x19, 0xf,  0x7b, 0x1,  0xea, 0x6c, 0xe2,
                                     0xed, 0x5d, 0x84, 0x24, 0x21, 0x29, 0x59, 0x25, 0xb6, 0x20,
                                     0x13, 0xae, 0x2d, 0x43, 0xa4, 0x44, 0x1c, 0x91, 0x40};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2c, 0x9c, 0x35, 0xef, 0xef, 0x3a, 0x40};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x23, 0x8a, 0xa,  0x53, 0x67, 0x52, 0x64, 0x6,  0x55, 0xb4, 0xba, 0x91, 0x52, 0x9f,
                                     0xf9, 0x2f, 0x19, 0x8e, 0x20, 0x92, 0x58, 0xe4, 0x49, 0x33, 0x33, 0xb2, 0x23};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x3b, 0x82, 0xe5, 0xac, 0x21, 0xcb, 0x7c};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x52, 0xb7, 0x0,  0xf7, 0x47, 0xc9, 0xc0, 0x15, 0x77, 0x98, 0x2e,
                                     0x70, 0xe6, 0x7f, 0xd0, 0xc5, 0x21, 0xf3, 0x65, 0xa7, 0xcb};
  lwmqtt_string_t topic_filter_s4 = {21, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 218}},    {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30374}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 130}},    {.prop = (lwmqtt_prop_t)41, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 12495}}, {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 27761}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 13416, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19505 [("",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal =
// True, _subQoS = QoS0}),("\193~\153\213\236\138\165\192;P\209\245\207",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\154\DC41*\134\182g\t'\129\&1\ETX\186_\STX\SYNks\SI\235P",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("1f,]@\243\146\195\138U\CAN\153B\215M8\229X?",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("k\241\"\130\130\f=\CANf\154\172\152E",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("W\235/\243\DLE",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False,
// _subQoS = QoS1}),("\168\164\163wJ",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("\229\237\196\180\216\NAK\196\157'\221z\153\239-\EOT\202X\ENQK\177YOB+",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("RLl\155O\151\a\202]\163\201\221\153L+]\180\223\205\130\DC2h\NUL)\250\252\213\DC4",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropReasonString "\157\164\163\DC1[\246\STXH",PropSharedSubscriptionAvailable 191,PropSubscriptionIdentifier
// 5,PropSubscriptionIdentifierAvailable 89,PropMessageExpiryInterval 26463,PropReasonString "W
// \202\173\&5\169\&3N\183*\240V|]\209\176$\DLE\208",PropMaximumQoS 117,PropSubscriptionIdentifierAvailable
// 215,PropWildcardSubscriptionAvailable 169,PropServerReference
// "\240<\249Kx1\210\149\226\172\191\CANy;",PropResponseTopic "\NUL&\172*\180\NUL",PropAuthenticationData
// "3\192G\bV\176",PropTopicAlias 29798,PropMaximumQoS 29,PropMaximumPacketSize 7661,PropUserProperty
// "\230\183\aKq\DC4K2" "c\195\168p\202\248\CAN\218\DEL\SUB\247p\174\162H\188U!",PropPayloadFormatIndicator
// 35,PropServerReference "+\250\DC4\242\222\182/",PropSessionExpiryInterval 30690,PropPayloadFormatIndicator
// 113,PropWillDelayInterval 31221,PropRequestProblemInformation 46]
TEST(Subscribe5QCTest, Encode3) {
  uint8_t pkt[] = {
      0x82, 0xb7, 0x2,  0x4c, 0x31, 0x98, 0x1,  0x1f, 0x0,  0x8,  0x9d, 0xa4, 0xa3, 0x11, 0x5b, 0xf6, 0x2,  0x48, 0x2a,
      0xbf, 0xb,  0x5,  0x29, 0x59, 0x2,  0x0,  0x0,  0x67, 0x5f, 0x1f, 0x0,  0x13, 0x57, 0x20, 0xca, 0xad, 0x35, 0xa9,
      0x33, 0x4e, 0xb7, 0x2a, 0xf0, 0x56, 0x7c, 0x5d, 0xd1, 0xb0, 0x24, 0x10, 0xd0, 0x24, 0x75, 0x29, 0xd7, 0x28, 0xa9,
      0x1c, 0x0,  0xe,  0xf0, 0x3c, 0xf9, 0x4b, 0x78, 0x31, 0xd2, 0x95, 0xe2, 0xac, 0xbf, 0x18, 0x79, 0x3b, 0x8,  0x0,
      0x6,  0x0,  0x26, 0xac, 0x2a, 0xb4, 0x0,  0x16, 0x0,  0x6,  0x33, 0xc0, 0x47, 0x8,  0x56, 0xb0, 0x23, 0x74, 0x66,
      0x24, 0x1d, 0x27, 0x0,  0x0,  0x1d, 0xed, 0x26, 0x0,  0x8,  0xe6, 0xb7, 0x7,  0x4b, 0x71, 0x14, 0x4b, 0x32, 0x0,
      0x12, 0x63, 0xc3, 0xa8, 0x70, 0xca, 0xf8, 0x18, 0xda, 0x7f, 0x1a, 0xf7, 0x70, 0xae, 0xa2, 0x48, 0xbc, 0x55, 0x21,
      0x1,  0x23, 0x1c, 0x0,  0x7,  0x2b, 0xfa, 0x14, 0xf2, 0xde, 0xb6, 0x2f, 0x11, 0x0,  0x0,  0x77, 0xe2, 0x1,  0x71,
      0x18, 0x0,  0x0,  0x79, 0xf5, 0x17, 0x2e, 0x0,  0x0,  0x2c, 0x0,  0xd,  0xc1, 0x7e, 0x99, 0xd5, 0xec, 0x8a, 0xa5,
      0xc0, 0x3b, 0x50, 0xd1, 0xf5, 0xcf, 0x19, 0x0,  0x15, 0x9a, 0x14, 0x31, 0x2a, 0x86, 0xb6, 0x67, 0x9,  0x27, 0x81,
      0x31, 0x3,  0xba, 0x5f, 0x2,  0x16, 0x6b, 0x73, 0xf,  0xeb, 0x50, 0x2c, 0x0,  0x13, 0x31, 0x66, 0x2c, 0x5d, 0x40,
      0xf3, 0x92, 0xc3, 0x8a, 0x55, 0x18, 0x99, 0x42, 0xd7, 0x4d, 0x38, 0xe5, 0x58, 0x3f, 0x29, 0x0,  0xd,  0x6b, 0xf1,
      0x22, 0x82, 0x82, 0xc,  0x3d, 0x18, 0x66, 0x9a, 0xac, 0x98, 0x45, 0x8,  0x0,  0x5,  0x57, 0xeb, 0x2f, 0xf3, 0x10,
      0x9,  0x0,  0x5,  0xa8, 0xa4, 0xa3, 0x77, 0x4a, 0x16, 0x0,  0x18, 0xe5, 0xed, 0xc4, 0xb4, 0xd8, 0x15, 0xc4, 0x9d,
      0x27, 0xdd, 0x7a, 0x99, 0xef, 0x2d, 0x4,  0xca, 0x58, 0x5,  0x4b, 0xb1, 0x59, 0x4f, 0x42, 0x2b, 0x11, 0x0,  0x1c,
      0x52, 0x4c, 0x6c, 0x9b, 0x4f, 0x97, 0x7,  0xca, 0x5d, 0xa3, 0xc9, 0xdd, 0x99, 0x4c, 0x2b, 0x5d, 0xb4, 0xdf, 0xcd,
      0x82, 0x12, 0x68, 0x0,  0x29, 0xfa, 0xfc, 0xd5, 0x14, 0x10};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc1, 0x7e, 0x99, 0xd5, 0xec, 0x8a, 0xa5, 0xc0, 0x3b, 0x50, 0xd1, 0xf5, 0xcf};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9a, 0x14, 0x31, 0x2a, 0x86, 0xb6, 0x67, 0x9, 0x27, 0x81, 0x31,
                                     0x3,  0xba, 0x5f, 0x2,  0x16, 0x6b, 0x73, 0xf, 0xeb, 0x50};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x31, 0x66, 0x2c, 0x5d, 0x40, 0xf3, 0x92, 0xc3, 0x8a, 0x55,
                                     0x18, 0x99, 0x42, 0xd7, 0x4d, 0x38, 0xe5, 0x58, 0x3f};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x6b, 0xf1, 0x22, 0x82, 0x82, 0xc, 0x3d, 0x18, 0x66, 0x9a, 0xac, 0x98, 0x45};
  lwmqtt_string_t topic_filter_s4 = {13, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x57, 0xeb, 0x2f, 0xf3, 0x10};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xa8, 0xa4, 0xa3, 0x77, 0x4a};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xe5, 0xed, 0xc4, 0xb4, 0xd8, 0x15, 0xc4, 0x9d, 0x27, 0xdd, 0x7a, 0x99,
                                     0xef, 0x2d, 0x4,  0xca, 0x58, 0x5,  0x4b, 0xb1, 0x59, 0x4f, 0x42, 0x2b};
  lwmqtt_string_t topic_filter_s7 = {24, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x52, 0x4c, 0x6c, 0x9b, 0x4f, 0x97, 0x7,  0xca, 0x5d, 0xa3,
                                     0xc9, 0xdd, 0x99, 0x4c, 0x2b, 0x5d, 0xb4, 0xdf, 0xcd, 0x82,
                                     0x12, 0x68, 0x0,  0x29, 0xfa, 0xfc, 0xd5, 0x14};
  lwmqtt_string_t topic_filter_s8 = {28, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  uint8_t bytesprops0[] = {0x9d, 0xa4, 0xa3, 0x11, 0x5b, 0xf6, 0x2, 0x48};
  uint8_t bytesprops1[] = {0x57, 0x20, 0xca, 0xad, 0x35, 0xa9, 0x33, 0x4e, 0xb7, 0x2a,
                           0xf0, 0x56, 0x7c, 0x5d, 0xd1, 0xb0, 0x24, 0x10, 0xd0};
  uint8_t bytesprops2[] = {0xf0, 0x3c, 0xf9, 0x4b, 0x78, 0x31, 0xd2, 0x95, 0xe2, 0xac, 0xbf, 0x18, 0x79, 0x3b};
  uint8_t bytesprops3[] = {0x0, 0x26, 0xac, 0x2a, 0xb4, 0x0};
  uint8_t bytesprops4[] = {0x33, 0xc0, 0x47, 0x8, 0x56, 0xb0};
  uint8_t bytesprops6[] = {0x63, 0xc3, 0xa8, 0x70, 0xca, 0xf8, 0x18, 0xda, 0x7f,
                           0x1a, 0xf7, 0x70, 0xae, 0xa2, 0x48, 0xbc, 0x55, 0x21};
  uint8_t bytesprops5[] = {0xe6, 0xb7, 0x7, 0x4b, 0x71, 0x14, 0x4b, 0x32};
  uint8_t bytesprops7[] = {0x2b, 0xfa, 0x14, 0xf2, 0xde, 0xb6, 0x2f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 5}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 89}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26463}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 29798}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 29}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7661}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops5}, .v = {18, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30690}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 113}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31221}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 46}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19505, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22696 [("i\\\ETB]\223\172\230\167S\161\b\f\181\140\230\235\211\199\RS",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\167",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\167E\206\237eq!\244c\192\133\243\244",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS2}),("\150\245e",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\156\133~]\132@\193",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\RS\145\206)
// \b\156\205\226\161RF\ETX\DC3\144q\211\212pm]%6\185\228\189p",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\188*F\240k\177\DEL\179Z\238a\160$\225\245*\135(\DC2q",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\197\168cf\214e\153\EM_T\211\151;\179\163\164
// \135\158\193\SOH",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("C\133\193\&1\150FS\ESC\227S;\138I\ETX\SUB",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\148\241Hb\144[\206)\160\178w",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("HG\190\249\226\171Bd;n\226\240\138\157R\188\178\139",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1})] [PropUserProperty "=\254\ESC\143n\170~1"
// "\139\206\167\196S\180\252\205\128\213z\132Y\213\SYN\225\133\213\&8$",PropContentType
// "v\DEL\186\DC2J\156\210O",PropUserProperty "\ETX\206\SUB\ETX\162\249\b$\169\254/\DEL\215\ETX\214\202\179lr\ESC;Q"
// "y\197\DEL\202\&6*\237{\144(\206-\"\215\215\136\239\237\ETB\183\US",PropResponseTopic
// "\190%4!\141\131",PropSharedSubscriptionAvailable 243,PropTopicAliasMaximum 30973,PropCorrelationData
// "",PropServerReference "@3}\150J\188\251\170\142\DLE ",PropWildcardSubscriptionAvailable 73,PropAuthenticationData
// "1\134u8\DC2!\136\172",PropMaximumPacketSize 21435,PropAuthenticationData
// "~YJM\211\142\158&\227\153\185=(Ob\188.$1\232\204=<!",PropSessionExpiryInterval 18884,PropUserProperty
// "p\185\234\195\254W\219g" "\145\GS)\201\173",PropPayloadFormatIndicator 100,PropAssignedClientIdentifier
// "=\v\177\242_2j\202\247\134&\174\DC3",PropSubscriptionIdentifier 10,PropWillDelayInterval
// 7296,PropPayloadFormatIndicator 183,PropReasonString
// "\241o\132\157\206v5\253\209\163\165\209\246\DC2T\232\DC3\151\239H\144\227",PropSubscriptionIdentifier
// 18,PropMaximumQoS 213,PropMessageExpiryInterval 19065,PropResponseTopic "\186\238\150\146N"]
TEST(Subscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0x82, 0xc4, 0x3,  0x58, 0xa8, 0x84, 0x2,  0x26, 0x0,  0x8,  0x3d, 0xfe, 0x1b, 0x8f, 0x6e, 0xaa, 0x7e, 0x31, 0x0,
      0x14, 0x8b, 0xce, 0xa7, 0xc4, 0x53, 0xb4, 0xfc, 0xcd, 0x80, 0xd5, 0x7a, 0x84, 0x59, 0xd5, 0x16, 0xe1, 0x85, 0xd5,
      0x38, 0x24, 0x3,  0x0,  0x8,  0x76, 0x7f, 0xba, 0x12, 0x4a, 0x9c, 0xd2, 0x4f, 0x26, 0x0,  0x16, 0x3,  0xce, 0x1a,
      0x3,  0xa2, 0xf9, 0x8,  0x24, 0xa9, 0xfe, 0x2f, 0x7f, 0xd7, 0x3,  0xd6, 0xca, 0xb3, 0x6c, 0x72, 0x1b, 0x3b, 0x51,
      0x0,  0x15, 0x79, 0xc5, 0x7f, 0xca, 0x36, 0x2a, 0xed, 0x7b, 0x90, 0x28, 0xce, 0x2d, 0x22, 0xd7, 0xd7, 0x88, 0xef,
      0xed, 0x17, 0xb7, 0x1f, 0x8,  0x0,  0x6,  0xbe, 0x25, 0x34, 0x21, 0x8d, 0x83, 0x2a, 0xf3, 0x22, 0x78, 0xfd, 0x9,
      0x0,  0x0,  0x1c, 0x0,  0xb,  0x40, 0x33, 0x7d, 0x96, 0x4a, 0xbc, 0xfb, 0xaa, 0x8e, 0x10, 0x20, 0x28, 0x49, 0x16,
      0x0,  0x8,  0x31, 0x86, 0x75, 0x38, 0x12, 0x21, 0x88, 0xac, 0x27, 0x0,  0x0,  0x53, 0xbb, 0x16, 0x0,  0x18, 0x7e,
      0x59, 0x4a, 0x4d, 0xd3, 0x8e, 0x9e, 0x26, 0xe3, 0x99, 0xb9, 0x3d, 0x28, 0x4f, 0x62, 0xbc, 0x2e, 0x24, 0x31, 0xe8,
      0xcc, 0x3d, 0x3c, 0x21, 0x11, 0x0,  0x0,  0x49, 0xc4, 0x26, 0x0,  0x8,  0x70, 0xb9, 0xea, 0xc3, 0xfe, 0x57, 0xdb,
      0x67, 0x0,  0x5,  0x91, 0x1d, 0x29, 0xc9, 0xad, 0x1,  0x64, 0x12, 0x0,  0xd,  0x3d, 0xb,  0xb1, 0xf2, 0x5f, 0x32,
      0x6a, 0xca, 0xf7, 0x86, 0x26, 0xae, 0x13, 0xb,  0xa,  0x18, 0x0,  0x0,  0x1c, 0x80, 0x1,  0xb7, 0x1f, 0x0,  0x16,
      0xf1, 0x6f, 0x84, 0x9d, 0xce, 0x76, 0x35, 0xfd, 0xd1, 0xa3, 0xa5, 0xd1, 0xf6, 0x12, 0x54, 0xe8, 0x13, 0x97, 0xef,
      0x48, 0x90, 0xe3, 0xb,  0x12, 0x24, 0xd5, 0x2,  0x0,  0x0,  0x4a, 0x79, 0x8,  0x0,  0x5,  0xba, 0xee, 0x96, 0x92,
      0x4e, 0x0,  0x13, 0x69, 0x5c, 0x17, 0x5d, 0xdf, 0xac, 0xe6, 0xa7, 0x53, 0xa1, 0x8,  0xc,  0xb5, 0x8c, 0xe6, 0xeb,
      0xd3, 0xc7, 0x1e, 0x0,  0x0,  0x1,  0xa7, 0xc,  0x0,  0xd,  0xa7, 0x45, 0xce, 0xed, 0x65, 0x71, 0x21, 0xf4, 0x63,
      0xc0, 0x85, 0xf3, 0xf4, 0x12, 0x0,  0x3,  0x96, 0xf5, 0x65, 0x1e, 0x0,  0x7,  0x9c, 0x85, 0x7e, 0x5d, 0x84, 0x40,
      0xc1, 0x2,  0x0,  0x1b, 0x1e, 0x91, 0xce, 0x29, 0x20, 0x8,  0x9c, 0xcd, 0xe2, 0xa1, 0x52, 0x46, 0x3,  0x13, 0x90,
      0x71, 0xd3, 0xd4, 0x70, 0x6d, 0x5d, 0x25, 0x36, 0xb9, 0xe4, 0xbd, 0x70, 0x14, 0x0,  0x14, 0xbc, 0x2a, 0x46, 0xf0,
      0x6b, 0xb1, 0x7f, 0xb3, 0x5a, 0xee, 0x61, 0xa0, 0x24, 0xe1, 0xf5, 0x2a, 0x87, 0x28, 0x12, 0x71, 0x14, 0x0,  0x15,
      0xc5, 0xa8, 0x63, 0x66, 0xd6, 0x65, 0x99, 0x19, 0x5f, 0x54, 0xd3, 0x97, 0x3b, 0xb3, 0xa3, 0xa4, 0x20, 0x87, 0x9e,
      0xc1, 0x1,  0x20, 0x0,  0xf,  0x43, 0x85, 0xc1, 0x31, 0x96, 0x46, 0x53, 0x1b, 0xe3, 0x53, 0x3b, 0x8a, 0x49, 0x3,
      0x1a, 0x20, 0x0,  0xb,  0x94, 0xf1, 0x48, 0x62, 0x90, 0x5b, 0xce, 0x29, 0xa0, 0xb2, 0x77, 0x2d, 0x0,  0x12, 0x48,
      0x47, 0xbe, 0xf9, 0xe2, 0xab, 0x42, 0x64, 0x3b, 0x6e, 0xe2, 0xf0, 0x8a, 0x9d, 0x52, 0xbc, 0xb2, 0x8b, 0x15};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x69, 0x5c, 0x17, 0x5d, 0xdf, 0xac, 0xe6, 0xa7, 0x53, 0xa1,
                                     0x8,  0xc,  0xb5, 0x8c, 0xe6, 0xeb, 0xd3, 0xc7, 0x1e};
  lwmqtt_string_t topic_filter_s0 = {19, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa7};
  lwmqtt_string_t topic_filter_s1 = {1, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa7, 0x45, 0xce, 0xed, 0x65, 0x71, 0x21, 0xf4, 0x63, 0xc0, 0x85, 0xf3, 0xf4};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x96, 0xf5, 0x65};
  lwmqtt_string_t topic_filter_s3 = {3, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9c, 0x85, 0x7e, 0x5d, 0x84, 0x40, 0xc1};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1e, 0x91, 0xce, 0x29, 0x20, 0x8,  0x9c, 0xcd, 0xe2, 0xa1, 0x52, 0x46, 0x3, 0x13,
                                     0x90, 0x71, 0xd3, 0xd4, 0x70, 0x6d, 0x5d, 0x25, 0x36, 0xb9, 0xe4, 0xbd, 0x70};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xbc, 0x2a, 0x46, 0xf0, 0x6b, 0xb1, 0x7f, 0xb3, 0x5a, 0xee,
                                     0x61, 0xa0, 0x24, 0xe1, 0xf5, 0x2a, 0x87, 0x28, 0x12, 0x71};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc5, 0xa8, 0x63, 0x66, 0xd6, 0x65, 0x99, 0x19, 0x5f, 0x54, 0xd3,
                                     0x97, 0x3b, 0xb3, 0xa3, 0xa4, 0x20, 0x87, 0x9e, 0xc1, 0x1};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x43, 0x85, 0xc1, 0x31, 0x96, 0x46, 0x53, 0x1b,
                                     0xe3, 0x53, 0x3b, 0x8a, 0x49, 0x3,  0x1a};
  lwmqtt_string_t topic_filter_s8 = {15, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x94, 0xf1, 0x48, 0x62, 0x90, 0x5b, 0xce, 0x29, 0xa0, 0xb2, 0x77};
  lwmqtt_string_t topic_filter_s9 = {11, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x48, 0x47, 0xbe, 0xf9, 0xe2, 0xab, 0x42, 0x64, 0x3b,
                                      0x6e, 0xe2, 0xf0, 0x8a, 0x9d, 0x52, 0xbc, 0xb2, 0x8b};
  lwmqtt_string_t topic_filter_s10 = {18, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS1;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = true;
  uint8_t bytesprops1[] = {0x8b, 0xce, 0xa7, 0xc4, 0x53, 0xb4, 0xfc, 0xcd, 0x80, 0xd5,
                           0x7a, 0x84, 0x59, 0xd5, 0x16, 0xe1, 0x85, 0xd5, 0x38, 0x24};
  uint8_t bytesprops0[] = {0x3d, 0xfe, 0x1b, 0x8f, 0x6e, 0xaa, 0x7e, 0x31};
  uint8_t bytesprops2[] = {0x76, 0x7f, 0xba, 0x12, 0x4a, 0x9c, 0xd2, 0x4f};
  uint8_t bytesprops4[] = {0x79, 0xc5, 0x7f, 0xca, 0x36, 0x2a, 0xed, 0x7b, 0x90, 0x28, 0xce,
                           0x2d, 0x22, 0xd7, 0xd7, 0x88, 0xef, 0xed, 0x17, 0xb7, 0x1f};
  uint8_t bytesprops3[] = {0x3,  0xce, 0x1a, 0x3,  0xa2, 0xf9, 0x8,  0x24, 0xa9, 0xfe, 0x2f,
                           0x7f, 0xd7, 0x3,  0xd6, 0xca, 0xb3, 0x6c, 0x72, 0x1b, 0x3b, 0x51};
  uint8_t bytesprops5[] = {0xbe, 0x25, 0x34, 0x21, 0x8d, 0x83};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0x40, 0x33, 0x7d, 0x96, 0x4a, 0xbc, 0xfb, 0xaa, 0x8e, 0x10, 0x20};
  uint8_t bytesprops8[] = {0x31, 0x86, 0x75, 0x38, 0x12, 0x21, 0x88, 0xac};
  uint8_t bytesprops9[] = {0x7e, 0x59, 0x4a, 0x4d, 0xd3, 0x8e, 0x9e, 0x26, 0xe3, 0x99, 0xb9, 0x3d,
                           0x28, 0x4f, 0x62, 0xbc, 0x2e, 0x24, 0x31, 0xe8, 0xcc, 0x3d, 0x3c, 0x21};
  uint8_t bytesprops11[] = {0x91, 0x1d, 0x29, 0xc9, 0xad};
  uint8_t bytesprops10[] = {0x70, 0xb9, 0xea, 0xc3, 0xfe, 0x57, 0xdb, 0x67};
  uint8_t bytesprops12[] = {0x3d, 0xb, 0xb1, 0xf2, 0x5f, 0x32, 0x6a, 0xca, 0xf7, 0x86, 0x26, 0xae, 0x13};
  uint8_t bytesprops13[] = {0xf1, 0x6f, 0x84, 0x9d, 0xce, 0x76, 0x35, 0xfd, 0xd1, 0xa3, 0xa5,
                            0xd1, 0xf6, 0x12, 0x54, 0xe8, 0x13, 0x97, 0xef, 0x48, 0x90, 0xe3};
  uint8_t bytesprops14[] = {0xba, 0xee, 0x96, 0x92, 0x4e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops3}, .v = {21, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 243}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30973}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21435}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18884}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops10}, .v = {5, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {13, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 7296}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {22, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 18}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19065}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {5, (char*)&bytesprops14}}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22696, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14047 [("\r\253\211]\t\130|\206\&1\231\131\EOT\SI\129\229\140",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\245\193h\190\138\168\227j\SUB\DC2\232\129A\197",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\152>\249\ACK",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\184\209\128O=(Q\229",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("2E\213\230\200\236\143\235\&0\NUL\CAN\ESC#Y\224Bf\FS-z\133 \192'C",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\177\212\217\238\249\r\208\171n\214\145HAI\FSG\NUL>\198\212y\RS\217\148\225\CANQ",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1\152:S",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False,
// _subQoS = QoS0}),("\180n\153T\208\214\157",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS0}),("\168eem\240p\168\224\244\EOT\131/;\201\179\224",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),(")ZK[\221\236\"r\197\144\180\255,\159\143\229\160\189\242",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1})] [PropMessageExpiryInterval
// 9681,PropRequestResponseInformation 112,PropSubscriptionIdentifier 13,PropAssignedClientIdentifier
// "\168+\167\203\"\239\253K\240\150\231]\131\202\231\175\233\135\128K\132\227\217\&4\222$\182\&8\196\209",PropSubscriptionIdentifier
// 14,PropServerKeepAlive 27976,PropRetainAvailable 103,PropSessionExpiryInterval 15663,PropAssignedClientIdentifier
// "\229q\247_d}\143{\232Fi\153\248\228\ETXM6",PropContentType "\145t\166\134\205\232\203\129",PropSessionExpiryInterval
// 8709,PropSubscriptionIdentifierAvailable 52,PropServerKeepAlive 7895,PropServerReference
// "\175\213\152\183^x\fY\165,\154",PropResponseTopic "\250\ESCX\a\230B\239\249\137eFA",PropCorrelationData
// "\254;\t\222p\170\NAK",PropServerKeepAlive 21236,PropSubscriptionIdentifier 12,PropWillDelayInterval
// 21266,PropRequestResponseInformation 45]
TEST(Subscribe5QCTest, Encode5) {
  uint8_t pkt[] = {
      0x82, 0xc0, 0x2,  0x36, 0xdf, 0x92, 0x1,  0x2,  0x0,  0x0,  0x25, 0xd1, 0x19, 0x70, 0xb,  0xd,  0x12, 0x0,  0x1e,
      0xa8, 0x2b, 0xa7, 0xcb, 0x22, 0xef, 0xfd, 0x4b, 0xf0, 0x96, 0xe7, 0x5d, 0x83, 0xca, 0xe7, 0xaf, 0xe9, 0x87, 0x80,
      0x4b, 0x84, 0xe3, 0xd9, 0x34, 0xde, 0x24, 0xb6, 0x38, 0xc4, 0xd1, 0xb,  0xe,  0x13, 0x6d, 0x48, 0x25, 0x67, 0x11,
      0x0,  0x0,  0x3d, 0x2f, 0x12, 0x0,  0x11, 0xe5, 0x71, 0xf7, 0x5f, 0x64, 0x7d, 0x8f, 0x7b, 0xe8, 0x46, 0x69, 0x99,
      0xf8, 0xe4, 0x3,  0x4d, 0x36, 0x3,  0x0,  0x8,  0x91, 0x74, 0xa6, 0x86, 0xcd, 0xe8, 0xcb, 0x81, 0x11, 0x0,  0x0,
      0x22, 0x5,  0x29, 0x34, 0x13, 0x1e, 0xd7, 0x1c, 0x0,  0xb,  0xaf, 0xd5, 0x98, 0xb7, 0x5e, 0x78, 0xc,  0x59, 0xa5,
      0x2c, 0x9a, 0x8,  0x0,  0xc,  0xfa, 0x1b, 0x58, 0x7,  0xe6, 0x42, 0xef, 0xf9, 0x89, 0x65, 0x46, 0x41, 0x9,  0x0,
      0x7,  0xfe, 0x3b, 0x9,  0xde, 0x70, 0xaa, 0x15, 0x13, 0x52, 0xf4, 0xb,  0xc,  0x18, 0x0,  0x0,  0x53, 0x12, 0x19,
      0x2d, 0x0,  0x10, 0xd,  0xfd, 0xd3, 0x5d, 0x9,  0x82, 0x7c, 0xce, 0x31, 0xe7, 0x83, 0x4,  0xf,  0x81, 0xe5, 0x8c,
      0x12, 0x0,  0xe,  0xf5, 0xc1, 0x68, 0xbe, 0x8a, 0xa8, 0xe3, 0x6a, 0x1a, 0x12, 0xe8, 0x81, 0x41, 0xc5, 0x2c, 0x0,
      0x4,  0x98, 0x3e, 0xf9, 0x6,  0xc,  0x0,  0x8,  0xb8, 0xd1, 0x80, 0x4f, 0x3d, 0x28, 0x51, 0xe5, 0x0,  0x0,  0x19,
      0x32, 0x45, 0xd5, 0xe6, 0xc8, 0xec, 0x8f, 0xeb, 0x30, 0x0,  0x18, 0x1b, 0x23, 0x59, 0xe0, 0x42, 0x66, 0x1c, 0x2d,
      0x7a, 0x85, 0x20, 0xc0, 0x27, 0x43, 0x12, 0x0,  0x1b, 0xb1, 0xd4, 0xd9, 0xee, 0xf9, 0xd,  0xd0, 0xab, 0x6e, 0xd6,
      0x91, 0x48, 0x41, 0x49, 0x1c, 0x47, 0x0,  0x3e, 0xc6, 0xd4, 0x79, 0x1e, 0xd9, 0x94, 0xe1, 0x18, 0x51, 0x10, 0x0,
      0x4,  0x31, 0x98, 0x3a, 0x53, 0x0,  0x0,  0x7,  0xb4, 0x6e, 0x99, 0x54, 0xd0, 0xd6, 0x9d, 0x18, 0x0,  0x10, 0xa8,
      0x65, 0x65, 0x6d, 0xf0, 0x70, 0xa8, 0xe0, 0xf4, 0x4,  0x83, 0x2f, 0x3b, 0xc9, 0xb3, 0xe0, 0x2,  0x0,  0x13, 0x29,
      0x5a, 0x4b, 0x5b, 0xdd, 0xec, 0x22, 0x72, 0xc5, 0x90, 0xb4, 0xff, 0x2c, 0x9f, 0x8f, 0xe5, 0xa0, 0xbd, 0xf2, 0x21};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd,  0xfd, 0xd3, 0x5d, 0x9, 0x82, 0x7c, 0xce,
                                     0x31, 0xe7, 0x83, 0x4,  0xf, 0x81, 0xe5, 0x8c};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf5, 0xc1, 0x68, 0xbe, 0x8a, 0xa8, 0xe3,
                                     0x6a, 0x1a, 0x12, 0xe8, 0x81, 0x41, 0xc5};
  lwmqtt_string_t topic_filter_s1 = {14, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x98, 0x3e, 0xf9, 0x6};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb8, 0xd1, 0x80, 0x4f, 0x3d, 0x28, 0x51, 0xe5};
  lwmqtt_string_t topic_filter_s3 = {8, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x32, 0x45, 0xd5, 0xe6, 0xc8, 0xec, 0x8f, 0xeb, 0x30, 0x0,  0x18, 0x1b, 0x23,
                                     0x59, 0xe0, 0x42, 0x66, 0x1c, 0x2d, 0x7a, 0x85, 0x20, 0xc0, 0x27, 0x43};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb1, 0xd4, 0xd9, 0xee, 0xf9, 0xd,  0xd0, 0xab, 0x6e, 0xd6, 0x91, 0x48, 0x41, 0x49,
                                     0x1c, 0x47, 0x0,  0x3e, 0xc6, 0xd4, 0x79, 0x1e, 0xd9, 0x94, 0xe1, 0x18, 0x51};
  lwmqtt_string_t topic_filter_s5 = {27, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x31, 0x98, 0x3a, 0x53};
  lwmqtt_string_t topic_filter_s6 = {4, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xb4, 0x6e, 0x99, 0x54, 0xd0, 0xd6, 0x9d};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xa8, 0x65, 0x65, 0x6d, 0xf0, 0x70, 0xa8, 0xe0,
                                     0xf4, 0x4,  0x83, 0x2f, 0x3b, 0xc9, 0xb3, 0xe0};
  lwmqtt_string_t topic_filter_s8 = {16, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x29, 0x5a, 0x4b, 0x5b, 0xdd, 0xec, 0x22, 0x72, 0xc5, 0x90,
                                     0xb4, 0xff, 0x2c, 0x9f, 0x8f, 0xe5, 0xa0, 0xbd, 0xf2};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  lwmqtt_sub_options_t sub_opts[10];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = true;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  uint8_t bytesprops0[] = {0xa8, 0x2b, 0xa7, 0xcb, 0x22, 0xef, 0xfd, 0x4b, 0xf0, 0x96, 0xe7, 0x5d, 0x83, 0xca, 0xe7,
                           0xaf, 0xe9, 0x87, 0x80, 0x4b, 0x84, 0xe3, 0xd9, 0x34, 0xde, 0x24, 0xb6, 0x38, 0xc4, 0xd1};
  uint8_t bytesprops1[] = {0xe5, 0x71, 0xf7, 0x5f, 0x64, 0x7d, 0x8f, 0x7b, 0xe8,
                           0x46, 0x69, 0x99, 0xf8, 0xe4, 0x3,  0x4d, 0x36};
  uint8_t bytesprops2[] = {0x91, 0x74, 0xa6, 0x86, 0xcd, 0xe8, 0xcb, 0x81};
  uint8_t bytesprops3[] = {0xaf, 0xd5, 0x98, 0xb7, 0x5e, 0x78, 0xc, 0x59, 0xa5, 0x2c, 0x9a};
  uint8_t bytesprops4[] = {0xfa, 0x1b, 0x58, 0x7, 0xe6, 0x42, 0xef, 0xf9, 0x89, 0x65, 0x46, 0x41};
  uint8_t bytesprops5[] = {0xfe, 0x3b, 0x9, 0xde, 0x70, 0xaa, 0x15};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9681}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 13}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27976}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15663}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 8709}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7895}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {12, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21236}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21266}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 45}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14047, 10, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 502 [("\ESC\USm\212\ETB\238\&9\252\153\189\163S\234=+",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("{\221\\\229
// :\162\183\177\157\208\253\FS\144bS\217\ETB\180",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("U,\243\&4\ETB\241\&1\142\221\ACK#\tm\137\153\131F\200\147\&1\153\242\176\192\241\132>\192\174",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\SI\SI\DC39\233\224\EMM\128L5\235\156\157o\239N7\172:d\247",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropCorrelationData
// "\t\197[\224\236Y\206}\148\234\178P\237\222\147(\217\162\154\nL\201|\ACK\184\DLE\243\151\254",PropSubscriptionIdentifierAvailable
// 209,PropTopicAlias 23243,PropTopicAliasMaximum 24913,PropSubscriptionIdentifierAvailable 10,PropMaximumPacketSize
// 27215,PropPayloadFormatIndicator 37,PropContentType "\ESC\175*!\157\249'\t\158\\\204\DC4\158Bo|\140\RS.\202\128
// 2\243\229\185\226",PropRetainAvailable 124,PropRetainAvailable 27,PropSubscriptionIdentifier 0,PropAuthenticationData
// "\DEL\ETX'\143\245\191\229\196\179$",PropPayloadFormatIndicator 43,PropAuthenticationData
// "\177",PropMessageExpiryInterval 1767,PropResponseInformation
// "E\NAKD3[\244*\254\248\246q\215\177\250\RSPU\148.\180^\DC4\ETB#q\218",PropContentType
// "\ENQ\v\221x0F\ACKe\ETB<\255ZS\DEL\169\233O>|0\SO\228\172\142\&7\224\&7",PropPayloadFormatIndicator
// 75,PropSubscriptionIdentifierAvailable 152,PropSharedSubscriptionAvailable 194,PropAuthenticationMethod
// "Ql\234\237c\224\v\151\bG\DEL\141\CAN",PropReceiveMaximum 26111,PropAssignedClientIdentifier
// "\154\162T\157\216\252\187~H\232X\ETX>\146\196\234/\219\239\194",PropReasonString
// "F8pG\158",PropSessionExpiryInterval 28561,PropMaximumPacketSize 13192,PropReasonString "~\191\216`\194}:\246"]
TEST(Subscribe5QCTest, Encode6) {
  uint8_t pkt[] = {
      0x82, 0xda, 0x2,  0x1,  0xf6, 0xf5, 0x1,  0x9,  0x0,  0x1d, 0x9,  0xc5, 0x5b, 0xe0, 0xec, 0x59, 0xce, 0x7d, 0x94,
      0xea, 0xb2, 0x50, 0xed, 0xde, 0x93, 0x28, 0xd9, 0xa2, 0x9a, 0xa,  0x4c, 0xc9, 0x7c, 0x6,  0xb8, 0x10, 0xf3, 0x97,
      0xfe, 0x29, 0xd1, 0x23, 0x5a, 0xcb, 0x22, 0x61, 0x51, 0x29, 0xa,  0x27, 0x0,  0x0,  0x6a, 0x4f, 0x1,  0x25, 0x3,
      0x0,  0x1b, 0x1b, 0xaf, 0x2a, 0x21, 0x9d, 0xf9, 0x27, 0x9,  0x9e, 0x5c, 0xcc, 0x14, 0x9e, 0x42, 0x6f, 0x7c, 0x8c,
      0x1e, 0x2e, 0xca, 0x80, 0x20, 0x32, 0xf3, 0xe5, 0xb9, 0xe2, 0x25, 0x7c, 0x25, 0x1b, 0xb,  0x0,  0x16, 0x0,  0xa,
      0x7f, 0x3,  0x27, 0x8f, 0xf5, 0xbf, 0xe5, 0xc4, 0xb3, 0x24, 0x1,  0x2b, 0x16, 0x0,  0x1,  0xb1, 0x2,  0x0,  0x0,
      0x6,  0xe7, 0x1a, 0x0,  0x1a, 0x45, 0x15, 0x44, 0x33, 0x5b, 0xf4, 0x2a, 0xfe, 0xf8, 0xf6, 0x71, 0xd7, 0xb1, 0xfa,
      0x1e, 0x50, 0x55, 0x94, 0x2e, 0xb4, 0x5e, 0x14, 0x17, 0x23, 0x71, 0xda, 0x3,  0x0,  0x1b, 0x5,  0xb,  0xdd, 0x78,
      0x30, 0x46, 0x6,  0x65, 0x17, 0x3c, 0xff, 0x5a, 0x53, 0x7f, 0xa9, 0xe9, 0x4f, 0x3e, 0x7c, 0x30, 0xe,  0xe4, 0xac,
      0x8e, 0x37, 0xe0, 0x37, 0x1,  0x4b, 0x29, 0x98, 0x2a, 0xc2, 0x15, 0x0,  0xd,  0x51, 0x6c, 0xea, 0xed, 0x63, 0xe0,
      0xb,  0x97, 0x8,  0x47, 0x7f, 0x8d, 0x18, 0x21, 0x65, 0xff, 0x12, 0x0,  0x14, 0x9a, 0xa2, 0x54, 0x9d, 0xd8, 0xfc,
      0xbb, 0x7e, 0x48, 0xe8, 0x58, 0x3,  0x3e, 0x92, 0xc4, 0xea, 0x2f, 0xdb, 0xef, 0xc2, 0x1f, 0x0,  0x5,  0x46, 0x38,
      0x70, 0x47, 0x9e, 0x11, 0x0,  0x0,  0x6f, 0x91, 0x27, 0x0,  0x0,  0x33, 0x88, 0x1f, 0x0,  0x8,  0x7e, 0xbf, 0xd8,
      0x60, 0xc2, 0x7d, 0x3a, 0xf6, 0x0,  0xf,  0x1b, 0x1f, 0x6d, 0xd4, 0x17, 0xee, 0x39, 0xfc, 0x99, 0xbd, 0xa3, 0x53,
      0xea, 0x3d, 0x2b, 0xa,  0x0,  0x13, 0x7b, 0xdd, 0x5c, 0xe5, 0x20, 0x3a, 0xa2, 0xb7, 0xb1, 0x9d, 0xd0, 0xfd, 0x1c,
      0x90, 0x62, 0x53, 0xd9, 0x17, 0xb4, 0x28, 0x0,  0x1d, 0x55, 0x2c, 0xf3, 0x34, 0x17, 0xf1, 0x31, 0x8e, 0xdd, 0x6,
      0x23, 0x9,  0x6d, 0x89, 0x99, 0x83, 0x46, 0xc8, 0x93, 0x31, 0x99, 0xf2, 0xb0, 0xc0, 0xf1, 0x84, 0x3e, 0xc0, 0xae,
      0x1a, 0x0,  0x16, 0xf,  0xf,  0x13, 0x39, 0xe9, 0xe0, 0x19, 0x4d, 0x80, 0x4c, 0x35, 0xeb, 0x9c, 0x9d, 0x6f, 0xef,
      0x4e, 0x37, 0xac, 0x3a, 0x64, 0xf7, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x1b, 0x1f, 0x6d, 0xd4, 0x17, 0xee, 0x39, 0xfc,
                                     0x99, 0xbd, 0xa3, 0x53, 0xea, 0x3d, 0x2b};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x7b, 0xdd, 0x5c, 0xe5, 0x20, 0x3a, 0xa2, 0xb7, 0xb1, 0x9d,
                                     0xd0, 0xfd, 0x1c, 0x90, 0x62, 0x53, 0xd9, 0x17, 0xb4};
  lwmqtt_string_t topic_filter_s1 = {19, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x55, 0x2c, 0xf3, 0x34, 0x17, 0xf1, 0x31, 0x8e, 0xdd, 0x6,
                                     0x23, 0x9,  0x6d, 0x89, 0x99, 0x83, 0x46, 0xc8, 0x93, 0x31,
                                     0x99, 0xf2, 0xb0, 0xc0, 0xf1, 0x84, 0x3e, 0xc0, 0xae};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf,  0xf,  0x13, 0x39, 0xe9, 0xe0, 0x19, 0x4d, 0x80, 0x4c, 0x35,
                                     0xeb, 0x9c, 0x9d, 0x6f, 0xef, 0x4e, 0x37, 0xac, 0x3a, 0x64, 0xf7};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  uint8_t bytesprops0[] = {0x9,  0xc5, 0x5b, 0xe0, 0xec, 0x59, 0xce, 0x7d, 0x94, 0xea, 0xb2, 0x50, 0xed, 0xde, 0x93,
                           0x28, 0xd9, 0xa2, 0x9a, 0xa,  0x4c, 0xc9, 0x7c, 0x6,  0xb8, 0x10, 0xf3, 0x97, 0xfe};
  uint8_t bytesprops1[] = {0x1b, 0xaf, 0x2a, 0x21, 0x9d, 0xf9, 0x27, 0x9,  0x9e, 0x5c, 0xcc, 0x14, 0x9e, 0x42,
                           0x6f, 0x7c, 0x8c, 0x1e, 0x2e, 0xca, 0x80, 0x20, 0x32, 0xf3, 0xe5, 0xb9, 0xe2};
  uint8_t bytesprops2[] = {0x7f, 0x3, 0x27, 0x8f, 0xf5, 0xbf, 0xe5, 0xc4, 0xb3, 0x24};
  uint8_t bytesprops3[] = {0xb1};
  uint8_t bytesprops4[] = {0x45, 0x15, 0x44, 0x33, 0x5b, 0xf4, 0x2a, 0xfe, 0xf8, 0xf6, 0x71, 0xd7, 0xb1,
                           0xfa, 0x1e, 0x50, 0x55, 0x94, 0x2e, 0xb4, 0x5e, 0x14, 0x17, 0x23, 0x71, 0xda};
  uint8_t bytesprops5[] = {0x5,  0xb,  0xdd, 0x78, 0x30, 0x46, 0x6, 0x65, 0x17, 0x3c, 0xff, 0x5a, 0x53, 0x7f,
                           0xa9, 0xe9, 0x4f, 0x3e, 0x7c, 0x30, 0xe, 0xe4, 0xac, 0x8e, 0x37, 0xe0, 0x37};
  uint8_t bytesprops6[] = {0x51, 0x6c, 0xea, 0xed, 0x63, 0xe0, 0xb, 0x97, 0x8, 0x47, 0x7f, 0x8d, 0x18};
  uint8_t bytesprops7[] = {0x9a, 0xa2, 0x54, 0x9d, 0xd8, 0xfc, 0xbb, 0x7e, 0x48, 0xe8,
                           0x58, 0x3,  0x3e, 0x92, 0xc4, 0xea, 0x2f, 0xdb, 0xef, 0xc2};
  uint8_t bytesprops8[] = {0x46, 0x38, 0x70, 0x47, 0x9e};
  uint8_t bytesprops9[] = {0x7e, 0xbf, 0xd8, 0x60, 0xc2, 0x7d, 0x3a, 0xf6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23243}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 24913}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 10}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 27215}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 0}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1767}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 75}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26111}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {5, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28561}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13192}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 502, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 27247
// [("\137\230\141\ACK\169\178P\242\SUB\143Ml]\220\&1<\251\195\206\187\139$\167\174\\zW",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("<\235\&2\233\188SY\DC2}N",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS0}),("\169\156\DC4\199\SUBt\235!\GS\198\SUB\142i\208\aj\\\NAKG\a",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("h\252u[I\131\&8\238i\235/\165{\147\159\226/G\208\207npWu\ACKc\150@",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\132*T\ETB!\169\180\173\239t=",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("\184\198;\ETX\221\STX\202\227[\197q;6\189\n\169",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("x30\199\163\193",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("s\226\229\185N]\173-\176\199\183\201\219",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = True, _subQoS =
// QoS0}),("\228\134\195\198\239\232\245\153\ACKd.\130%$9D\237\231\158\SOH\160\242\151\170\\I",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0})] [PropCorrelationData
// "\247\167\151\238U\DEL\SYN\142\241(\198\136U\175Z\155\227\188`*\"t\237\137\222",PropRequestResponseInformation
// 222,PropSubscriptionIdentifierAvailable 126,PropContentType
// "\NAK\164O=h\238$\166",PropSubscriptionIdentifierAvailable 108,PropMessageExpiryInterval
// 31722,PropMessageExpiryInterval 12051,PropRequestResponseInformation 74,PropRetainAvailable
// 231,PropSharedSubscriptionAvailable 188,PropTopicAlias 4372,PropContentType
// "\130\144\SUB\236o:W\f\135\RSQ}\165",PropServerReference
// "0Q\241\EOT\192'\150u\219\171\242c\190\236\234\204\&0",PropTopicAlias 19724,PropMaximumPacketSize
// 17874,PropRequestResponseInformation 116,PropRetainAvailable 20,PropMaximumQoS 24,PropMaximumPacketSize
// 16124,PropAuthenticationData "\189\212\SI\182",PropReasonString
// "\233h\SI\133\ACK\253\232\156\184\228\164\ESC\n\STX\241\155U",PropUserProperty
// "4:l\200P\SUB\n\164\NUL7\132\172w\201\209BOE8\224\251\DC2\228\SI\FS\197\154" "\184\245l\232\178\fy[\128"]
TEST(Subscribe5QCTest, Encode7) {
  uint8_t pkt[] = {
      0x82, 0xfd, 0x2,  0x6a, 0x6f, 0xbb, 0x1,  0x9,  0x0,  0x19, 0xf7, 0xa7, 0x97, 0xee, 0x55, 0x7f, 0x16, 0x8e, 0xf1,
      0x28, 0xc6, 0x88, 0x55, 0xaf, 0x5a, 0x9b, 0xe3, 0xbc, 0x60, 0x2a, 0x22, 0x74, 0xed, 0x89, 0xde, 0x19, 0xde, 0x29,
      0x7e, 0x3,  0x0,  0x8,  0x15, 0xa4, 0x4f, 0x3d, 0x68, 0xee, 0x24, 0xa6, 0x29, 0x6c, 0x2,  0x0,  0x0,  0x7b, 0xea,
      0x2,  0x0,  0x0,  0x2f, 0x13, 0x19, 0x4a, 0x25, 0xe7, 0x2a, 0xbc, 0x23, 0x11, 0x14, 0x3,  0x0,  0xd,  0x82, 0x90,
      0x1a, 0xec, 0x6f, 0x3a, 0x57, 0xc,  0x87, 0x1e, 0x51, 0x7d, 0xa5, 0x1c, 0x0,  0x11, 0x30, 0x51, 0xf1, 0x4,  0xc0,
      0x27, 0x96, 0x75, 0xdb, 0xab, 0xf2, 0x63, 0xbe, 0xec, 0xea, 0xcc, 0x30, 0x23, 0x4d, 0xc,  0x27, 0x0,  0x0,  0x45,
      0xd2, 0x19, 0x74, 0x25, 0x14, 0x24, 0x18, 0x27, 0x0,  0x0,  0x3e, 0xfc, 0x16, 0x0,  0x4,  0xbd, 0xd4, 0xf,  0xb6,
      0x1f, 0x0,  0x11, 0xe9, 0x68, 0xf,  0x85, 0x6,  0xfd, 0xe8, 0x9c, 0xb8, 0xe4, 0xa4, 0x1b, 0xa,  0x2,  0xf1, 0x9b,
      0x55, 0x26, 0x0,  0x1b, 0x34, 0x3a, 0x6c, 0xc8, 0x50, 0x1a, 0xa,  0xa4, 0x0,  0x37, 0x84, 0xac, 0x77, 0xc9, 0xd1,
      0x42, 0x4f, 0x45, 0x38, 0xe0, 0xfb, 0x12, 0xe4, 0xf,  0x1c, 0xc5, 0x9a, 0x0,  0x9,  0xb8, 0xf5, 0x6c, 0xe8, 0xb2,
      0xc,  0x79, 0x5b, 0x80, 0x0,  0x1b, 0x89, 0xe6, 0x8d, 0x6,  0xa9, 0xb2, 0x50, 0xf2, 0x1a, 0x8f, 0x4d, 0x6c, 0x5d,
      0xdc, 0x31, 0x3c, 0xfb, 0xc3, 0xce, 0xbb, 0x8b, 0x24, 0xa7, 0xae, 0x5c, 0x7a, 0x57, 0x2e, 0x0,  0xa,  0x3c, 0xeb,
      0x32, 0xe9, 0xbc, 0x53, 0x59, 0x12, 0x7d, 0x4e, 0x14, 0x0,  0x14, 0xa9, 0x9c, 0x14, 0xc7, 0x1a, 0x74, 0xeb, 0x21,
      0x1d, 0xc6, 0x1a, 0x8e, 0x69, 0xd0, 0x7,  0x6a, 0x5c, 0x15, 0x47, 0x7,  0x2a, 0x0,  0x1c, 0x68, 0xfc, 0x75, 0x5b,
      0x49, 0x83, 0x38, 0xee, 0x69, 0xeb, 0x2f, 0xa5, 0x7b, 0x93, 0x9f, 0xe2, 0x2f, 0x47, 0xd0, 0xcf, 0x6e, 0x70, 0x57,
      0x75, 0x6,  0x63, 0x96, 0x40, 0x18, 0x0,  0x0,  0x2,  0x0,  0xb,  0x84, 0x2a, 0x54, 0x17, 0x21, 0xa9, 0xb4, 0xad,
      0xef, 0x74, 0x3d, 0x16, 0x0,  0x10, 0xb8, 0xc6, 0x3b, 0x3,  0xdd, 0x2,  0xca, 0xe3, 0x5b, 0xc5, 0x71, 0x3b, 0x36,
      0xbd, 0xa,  0xa9, 0x18, 0x0,  0x6,  0x78, 0x33, 0x30, 0xc7, 0xa3, 0xc1, 0x2,  0x0,  0xd,  0x73, 0xe2, 0xe5, 0xb9,
      0x4e, 0x5d, 0xad, 0x2d, 0xb0, 0xc7, 0xb7, 0xc9, 0xdb, 0x4,  0x0,  0x1a, 0xe4, 0x86, 0xc3, 0xc6, 0xef, 0xe8, 0xf5,
      0x99, 0x6,  0x64, 0x2e, 0x82, 0x25, 0x24, 0x39, 0x44, 0xed, 0xe7, 0x9e, 0x1,  0xa0, 0xf2, 0x97, 0xaa, 0x5c, 0x49,
      0x21, 0x0,  0x0,  0x1c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x89, 0xe6, 0x8d, 0x6,  0xa9, 0xb2, 0x50, 0xf2, 0x1a, 0x8f, 0x4d, 0x6c, 0x5d, 0xdc,
                                     0x31, 0x3c, 0xfb, 0xc3, 0xce, 0xbb, 0x8b, 0x24, 0xa7, 0xae, 0x5c, 0x7a, 0x57};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3c, 0xeb, 0x32, 0xe9, 0xbc, 0x53, 0x59, 0x12, 0x7d, 0x4e};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0x9c, 0x14, 0xc7, 0x1a, 0x74, 0xeb, 0x21, 0x1d, 0xc6,
                                     0x1a, 0x8e, 0x69, 0xd0, 0x7,  0x6a, 0x5c, 0x15, 0x47, 0x7};
  lwmqtt_string_t topic_filter_s2 = {20, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x68, 0xfc, 0x75, 0x5b, 0x49, 0x83, 0x38, 0xee, 0x69, 0xeb,
                                     0x2f, 0xa5, 0x7b, 0x93, 0x9f, 0xe2, 0x2f, 0x47, 0xd0, 0xcf,
                                     0x6e, 0x70, 0x57, 0x75, 0x6,  0x63, 0x96, 0x40};
  lwmqtt_string_t topic_filter_s3 = {28, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0};
  lwmqtt_string_t topic_filter_s4 = {0, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x84, 0x2a, 0x54, 0x17, 0x21, 0xa9, 0xb4, 0xad, 0xef, 0x74, 0x3d};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xb8, 0xc6, 0x3b, 0x3,  0xdd, 0x2,  0xca, 0xe3,
                                     0x5b, 0xc5, 0x71, 0x3b, 0x36, 0xbd, 0xa,  0xa9};
  lwmqtt_string_t topic_filter_s6 = {16, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x78, 0x33, 0x30, 0xc7, 0xa3, 0xc1};
  lwmqtt_string_t topic_filter_s7 = {6, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x73, 0xe2, 0xe5, 0xb9, 0x4e, 0x5d, 0xad, 0x2d, 0xb0, 0xc7, 0xb7, 0xc9, 0xdb};
  lwmqtt_string_t topic_filter_s8 = {13, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xe4, 0x86, 0xc3, 0xc6, 0xef, 0xe8, 0xf5, 0x99, 0x6,  0x64, 0x2e, 0x82, 0x25,
                                     0x24, 0x39, 0x44, 0xed, 0xe7, 0x9e, 0x1,  0xa0, 0xf2, 0x97, 0xaa, 0x5c, 0x49};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0};
  lwmqtt_string_t topic_filter_s10 = {0, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[9].retain_as_published = false;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = true;
  sub_opts[10].no_local = true;
  uint8_t bytesprops0[] = {0xf7, 0xa7, 0x97, 0xee, 0x55, 0x7f, 0x16, 0x8e, 0xf1, 0x28, 0xc6, 0x88, 0x55,
                           0xaf, 0x5a, 0x9b, 0xe3, 0xbc, 0x60, 0x2a, 0x22, 0x74, 0xed, 0x89, 0xde};
  uint8_t bytesprops1[] = {0x15, 0xa4, 0x4f, 0x3d, 0x68, 0xee, 0x24, 0xa6};
  uint8_t bytesprops2[] = {0x82, 0x90, 0x1a, 0xec, 0x6f, 0x3a, 0x57, 0xc, 0x87, 0x1e, 0x51, 0x7d, 0xa5};
  uint8_t bytesprops3[] = {0x30, 0x51, 0xf1, 0x4,  0xc0, 0x27, 0x96, 0x75, 0xdb,
                           0xab, 0xf2, 0x63, 0xbe, 0xec, 0xea, 0xcc, 0x30};
  uint8_t bytesprops4[] = {0xbd, 0xd4, 0xf, 0xb6};
  uint8_t bytesprops5[] = {0xe9, 0x68, 0xf,  0x85, 0x6, 0xfd, 0xe8, 0x9c, 0xb8,
                           0xe4, 0xa4, 0x1b, 0xa,  0x2, 0xf1, 0x9b, 0x55};
  uint8_t bytesprops7[] = {0xb8, 0xf5, 0x6c, 0xe8, 0xb2, 0xc, 0x79, 0x5b, 0x80};
  uint8_t bytesprops6[] = {0x34, 0x3a, 0x6c, 0xc8, 0x50, 0x1a, 0xa,  0xa4, 0x0,  0x37, 0x84, 0xac, 0x77, 0xc9,
                           0xd1, 0x42, 0x4f, 0x45, 0x38, 0xe0, 0xfb, 0x12, 0xe4, 0xf,  0x1c, 0xc5, 0x9a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 222}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 108}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31722}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12051}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4372}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19724}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17874}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 16124}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops6}, .v = {9, (char*)&bytesprops7}}}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27247, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15611 [("\NUL\212p\201h\br'2ko\162\SYN\242U\173Sp\182\184",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropWillDelayInterval
// 16059,PropReceiveMaximum 18847,PropTopicAlias 31233,PropMessageExpiryInterval 17329,PropAuthenticationMethod
// "\228\166\137|\201X\211\ETX\ETBR\SO\247\fL\n\187\EOT\td\183\155u\146O\196\194\194j",PropPayloadFormatIndicator
// 20,PropWillDelayInterval 14778,PropServerReference "z\ETX\168\180\ETX-\244' \143",PropMessageExpiryInterval
// 23767,PropTopicAliasMaximum 583,PropMessageExpiryInterval 13968,PropRequestResponseInformation
// 60,PropSessionExpiryInterval 26412,PropTopicAliasMaximum 7853,PropSubscriptionIdentifierAvailable
// 16,PropTopicAliasMaximum 3303,PropPayloadFormatIndicator 55,PropMaximumQoS 160,PropUserProperty "K\SYNA\163\NUL\221U"
// "\183\v$r\161\250 f\167\ESC\215\136\160\175",PropTopicAlias 13301,PropRequestProblemInformation 216]
TEST(Subscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0x82, 0x9d, 0x1,  0x3c, 0xfb, 0x82, 0x1,  0x18, 0x0,  0x0,  0x3e, 0xbb, 0x21, 0x49, 0x9f, 0x23,
                   0x7a, 0x1,  0x2,  0x0,  0x0,  0x43, 0xb1, 0x15, 0x0,  0x1c, 0xe4, 0xa6, 0x89, 0x7c, 0xc9, 0x58,
                   0xd3, 0x3,  0x17, 0x52, 0xe,  0xf7, 0xc,  0x4c, 0xa,  0xbb, 0x4,  0x9,  0x64, 0xb7, 0x9b, 0x75,
                   0x92, 0x4f, 0xc4, 0xc2, 0xc2, 0x6a, 0x1,  0x14, 0x18, 0x0,  0x0,  0x39, 0xba, 0x1c, 0x0,  0xa,
                   0x7a, 0x3,  0xa8, 0xb4, 0x3,  0x2d, 0xf4, 0x27, 0x20, 0x8f, 0x2,  0x0,  0x0,  0x5c, 0xd7, 0x22,
                   0x2,  0x47, 0x2,  0x0,  0x0,  0x36, 0x90, 0x19, 0x3c, 0x11, 0x0,  0x0,  0x67, 0x2c, 0x22, 0x1e,
                   0xad, 0x29, 0x10, 0x22, 0xc,  0xe7, 0x1,  0x37, 0x24, 0xa0, 0x26, 0x0,  0x7,  0x4b, 0x16, 0x41,
                   0xa3, 0x0,  0xdd, 0x55, 0x0,  0xe,  0xb7, 0xb,  0x24, 0x72, 0xa1, 0xfa, 0x20, 0x66, 0xa7, 0x1b,
                   0xd7, 0x88, 0xa0, 0xaf, 0x23, 0x33, 0xf5, 0x17, 0xd8, 0x0,  0x14, 0x0,  0xd4, 0x70, 0xc9, 0x68,
                   0x8,  0x72, 0x27, 0x32, 0x6b, 0x6f, 0xa2, 0x16, 0xf2, 0x55, 0xad, 0x53, 0x70, 0xb6, 0xb8, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x0,  0xd4, 0x70, 0xc9, 0x68, 0x8,  0x72, 0x27, 0x32, 0x6b,
                                     0x6f, 0xa2, 0x16, 0xf2, 0x55, 0xad, 0x53, 0x70, 0xb6, 0xb8};
  lwmqtt_string_t topic_filter_s0 = {20, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0xe4, 0xa6, 0x89, 0x7c, 0xc9, 0x58, 0xd3, 0x3,  0x17, 0x52, 0xe,  0xf7, 0xc,  0x4c,
                           0xa,  0xbb, 0x4,  0x9,  0x64, 0xb7, 0x9b, 0x75, 0x92, 0x4f, 0xc4, 0xc2, 0xc2, 0x6a};
  uint8_t bytesprops1[] = {0x7a, 0x3, 0xa8, 0xb4, 0x3, 0x2d, 0xf4, 0x27, 0x20, 0x8f};
  uint8_t bytesprops3[] = {0xb7, 0xb, 0x24, 0x72, 0xa1, 0xfa, 0x20, 0x66, 0xa7, 0x1b, 0xd7, 0x88, 0xa0, 0xaf};
  uint8_t bytesprops2[] = {0x4b, 0x16, 0x41, 0xa3, 0x0, 0xdd, 0x55};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 16059}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18847}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31233}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17329}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14778}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23767}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 583}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13968}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 60}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26412}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7853}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3303}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops2}, .v = {14, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13301}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 216}},
  };

  lwmqtt_properties_t props = {21, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15611, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 16791 [("\\\ACK\129B1\149Y/2\178vx\RSo",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\157\170\249\222\&8\248\181\190\212q\151\133\186\245\171\223g1)U\206\a\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("y\245\244\225K\177[\153B\179@\161\193",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished
// = True, _noLocal = True, _subQoS = QoS2}),("\146\247\211\182H z\bK\191\RS\194V\134\&8$\221;8",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\167\159W\185-u;",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS0}),("X\246\247\218G\162mZ(\DEL\EM\172",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\152X9\166\177\RS\226\222\212\128",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\236\NAK\169\245",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS0}),("@I\210\CAN\210\EM\200\RS\186\ETB\235\180$\182\167\155\138\135>'\246",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})]
// [PropSubscriptionIdentifier 30,PropTopicAliasMaximum 28275,PropSubscriptionIdentifierAvailable
// 70,PropSharedSubscriptionAvailable 178,PropTopicAlias 18035,PropMessageExpiryInterval 13889,PropMaximumPacketSize
// 19219,PropReceiveMaximum 11664,PropPayloadFormatIndicator 124,PropAuthenticationData
// "\226\129.\DC2R\ACK\238a\205\DEL\163\STX\182\SYNJK",PropUserProperty "{s\129m\228\218\210\192#zl"
// "\186\138\139r'\199\228\164$=\SYN",PropMaximumPacketSize 483,PropRequestProblemInformation 66]
TEST(Subscribe5QCTest, Encode9) {
  uint8_t pkt[] = {0x82, 0xe9, 0x1,  0x41, 0x97, 0x50, 0xb,  0x1e, 0x22, 0x6e, 0x73, 0x29, 0x46, 0x2a, 0xb2, 0x23, 0x46,
                   0x73, 0x2,  0x0,  0x0,  0x36, 0x41, 0x27, 0x0,  0x0,  0x4b, 0x13, 0x21, 0x2d, 0x90, 0x1,  0x7c, 0x16,
                   0x0,  0x10, 0xe2, 0x81, 0x2e, 0x12, 0x52, 0x6,  0xee, 0x61, 0xcd, 0x7f, 0xa3, 0x2,  0xb6, 0x16, 0x4a,
                   0x4b, 0x26, 0x0,  0xb,  0x7b, 0x73, 0x81, 0x6d, 0xe4, 0xda, 0xd2, 0xc0, 0x23, 0x7a, 0x6c, 0x0,  0xb,
                   0xba, 0x8a, 0x8b, 0x72, 0x27, 0xc7, 0xe4, 0xa4, 0x24, 0x3d, 0x16, 0x27, 0x0,  0x0,  0x1,  0xe3, 0x17,
                   0x42, 0x0,  0xe,  0x5c, 0x6,  0x81, 0x42, 0x31, 0x95, 0x59, 0x2f, 0x32, 0xb2, 0x76, 0x78, 0x1e, 0x6f,
                   0x16, 0x0,  0x17, 0x9d, 0xaa, 0xf9, 0xde, 0x38, 0xf8, 0xb5, 0xbe, 0xd4, 0x71, 0x97, 0x85, 0xba, 0xf5,
                   0xab, 0xdf, 0x67, 0x31, 0x29, 0x55, 0xce, 0x7,  0x87, 0xe,  0x0,  0xd,  0x79, 0xf5, 0xf4, 0xe1, 0x4b,
                   0xb1, 0x5b, 0x99, 0x42, 0xb3, 0x40, 0xa1, 0xc1, 0x1e, 0x0,  0x13, 0x92, 0xf7, 0xd3, 0xb6, 0x48, 0x20,
                   0x7a, 0x8,  0x4b, 0xbf, 0x1e, 0xc2, 0x56, 0x86, 0x38, 0x24, 0xdd, 0x3b, 0x38, 0xa,  0x0,  0x7,  0xa7,
                   0x9f, 0x57, 0xb9, 0x2d, 0x75, 0x3b, 0x8,  0x0,  0xc,  0x58, 0xf6, 0xf7, 0xda, 0x47, 0xa2, 0x6d, 0x5a,
                   0x28, 0x7f, 0x19, 0xac, 0x5,  0x0,  0xa,  0x98, 0x58, 0x39, 0xa6, 0xb1, 0x1e, 0xe2, 0xde, 0xd4, 0x80,
                   0x1e, 0x0,  0x4,  0xec, 0x15, 0xa9, 0xf5, 0x0,  0x0,  0x15, 0x40, 0x49, 0xd2, 0x18, 0xd2, 0x19, 0xc8,
                   0x1e, 0xba, 0x17, 0xeb, 0xb4, 0x24, 0xb6, 0xa7, 0x9b, 0x8a, 0x87, 0x3e, 0x27, 0xf6, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x5c, 0x6, 0x81, 0x42, 0x31, 0x95, 0x59, 0x2f, 0x32, 0xb2, 0x76, 0x78, 0x1e, 0x6f};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9d, 0xaa, 0xf9, 0xde, 0x38, 0xf8, 0xb5, 0xbe, 0xd4, 0x71, 0x97, 0x85,
                                     0xba, 0xf5, 0xab, 0xdf, 0x67, 0x31, 0x29, 0x55, 0xce, 0x7,  0x87};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x79, 0xf5, 0xf4, 0xe1, 0x4b, 0xb1, 0x5b, 0x99, 0x42, 0xb3, 0x40, 0xa1, 0xc1};
  lwmqtt_string_t topic_filter_s2 = {13, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x92, 0xf7, 0xd3, 0xb6, 0x48, 0x20, 0x7a, 0x8,  0x4b, 0xbf,
                                     0x1e, 0xc2, 0x56, 0x86, 0x38, 0x24, 0xdd, 0x3b, 0x38};
  lwmqtt_string_t topic_filter_s3 = {19, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa7, 0x9f, 0x57, 0xb9, 0x2d, 0x75, 0x3b};
  lwmqtt_string_t topic_filter_s4 = {7, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x58, 0xf6, 0xf7, 0xda, 0x47, 0xa2, 0x6d, 0x5a, 0x28, 0x7f, 0x19, 0xac};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x98, 0x58, 0x39, 0xa6, 0xb1, 0x1e, 0xe2, 0xde, 0xd4, 0x80};
  lwmqtt_string_t topic_filter_s6 = {10, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xec, 0x15, 0xa9, 0xf5};
  lwmqtt_string_t topic_filter_s7 = {4, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x40, 0x49, 0xd2, 0x18, 0xd2, 0x19, 0xc8, 0x1e, 0xba, 0x17, 0xeb,
                                     0xb4, 0x24, 0xb6, 0xa7, 0x9b, 0x8a, 0x87, 0x3e, 0x27, 0xf6};
  lwmqtt_string_t topic_filter_s8 = {21, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = false;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = true;
  uint8_t bytesprops0[] = {0xe2, 0x81, 0x2e, 0x12, 0x52, 0x6,  0xee, 0x61,
                           0xcd, 0x7f, 0xa3, 0x2,  0xb6, 0x16, 0x4a, 0x4b};
  uint8_t bytesprops2[] = {0xba, 0x8a, 0x8b, 0x72, 0x27, 0xc7, 0xe4, 0xa4, 0x24, 0x3d, 0x16};
  uint8_t bytesprops1[] = {0x7b, 0x73, 0x81, 0x6d, 0xe4, 0xda, 0xd2, 0xc0, 0x23, 0x7a, 0x6c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 30}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 28275}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 178}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18035}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13889}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19219}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 11664}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 124}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops1}, .v = {11, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 483}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 66}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 16791, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 26959 [("O\ESCB(\149\146o\177\249\238&\152\222\148\225\208k<",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("\163\ACK\208\ETX}\235\ESC\230\193\202s",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("\140>8\177\CAN\US\187w\173\n~\"",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("AdT[\254[\152\249\SUBhe%e\185",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS2}),("\201\230\EM\GS4\DC4\233BO]\165",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\245\148@\246iy\SUB<E\191\SObr",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})]
// [PropMessageExpiryInterval 21521,PropMaximumPacketSize 20232,PropSubscriptionIdentifierAvailable
// 200,PropMessageExpiryInterval 3027,PropAuthenticationMethod
// "\133_\225\158\197\128C\197\NAK=\194B+\161\213\240Y\222\181\128",PropMaximumPacketSize
// 7035,PropSharedSubscriptionAvailable 167,PropRequestResponseInformation 8,PropCorrelationData
// "\212\198\a\220X\146nP\133c`+\ETB4\STX\EM\\%\234\SI\128 MN\176\218\151X",PropSessionExpiryInterval
// 6999,PropMaximumQoS 146,PropSessionExpiryInterval 19768,PropContentType
// "\190\239&~\180Ai\243\SI\130\160\237<,\DC4\191\164\212Sc1\241",PropMaximumPacketSize
// 20153,PropRequestResponseInformation 68,PropMaximumPacketSize 23593,PropSessionExpiryInterval
// 17398,PropSessionExpiryInterval 9346,PropRetainAvailable 78,PropMessageExpiryInterval 20036,PropMessageExpiryInterval
// 6666,PropResponseTopic "\FS\STX7=\235l=\242\181B\US\226E\198i\135l\133",PropMaximumQoS 152,PropWillDelayInterval
// 23069,PropReceiveMaximum 3647,PropSharedSubscriptionAvailable 103,PropAuthenticationMethod
// "\176^\169\205e\202\170\174\214",PropPayloadFormatIndicator 57,PropWillDelayInterval 32244,PropResponseTopic "F"]
TEST(Subscribe5QCTest, Encode10) {
  uint8_t pkt[] = {
      0x82, 0xb4, 0x2,  0x69, 0x4f, 0xcf, 0x1,  0x2,  0x0,  0x0,  0x54, 0x11, 0x27, 0x0,  0x0,  0x4f, 0x8,  0x29, 0xc8,
      0x2,  0x0,  0x0,  0xb,  0xd3, 0x15, 0x0,  0x14, 0x85, 0x5f, 0xe1, 0x9e, 0xc5, 0x80, 0x43, 0xc5, 0x15, 0x3d, 0xc2,
      0x42, 0x2b, 0xa1, 0xd5, 0xf0, 0x59, 0xde, 0xb5, 0x80, 0x27, 0x0,  0x0,  0x1b, 0x7b, 0x2a, 0xa7, 0x19, 0x8,  0x9,
      0x0,  0x1c, 0xd4, 0xc6, 0x7,  0xdc, 0x58, 0x92, 0x6e, 0x50, 0x85, 0x63, 0x60, 0x2b, 0x17, 0x34, 0x2,  0x19, 0x5c,
      0x25, 0xea, 0xf,  0x80, 0x20, 0x4d, 0x4e, 0xb0, 0xda, 0x97, 0x58, 0x11, 0x0,  0x0,  0x1b, 0x57, 0x24, 0x92, 0x11,
      0x0,  0x0,  0x4d, 0x38, 0x3,  0x0,  0x16, 0xbe, 0xef, 0x26, 0x7e, 0xb4, 0x41, 0x69, 0xf3, 0xf,  0x82, 0xa0, 0xed,
      0x3c, 0x2c, 0x14, 0xbf, 0xa4, 0xd4, 0x53, 0x63, 0x31, 0xf1, 0x27, 0x0,  0x0,  0x4e, 0xb9, 0x19, 0x44, 0x27, 0x0,
      0x0,  0x5c, 0x29, 0x11, 0x0,  0x0,  0x43, 0xf6, 0x11, 0x0,  0x0,  0x24, 0x82, 0x25, 0x4e, 0x2,  0x0,  0x0,  0x4e,
      0x44, 0x2,  0x0,  0x0,  0x1a, 0xa,  0x8,  0x0,  0x12, 0x1c, 0x2,  0x37, 0x3d, 0xeb, 0x6c, 0x3d, 0xf2, 0xb5, 0x42,
      0x1f, 0xe2, 0x45, 0xc6, 0x69, 0x87, 0x6c, 0x85, 0x24, 0x98, 0x18, 0x0,  0x0,  0x5a, 0x1d, 0x21, 0xe,  0x3f, 0x2a,
      0x67, 0x15, 0x0,  0x9,  0xb0, 0x5e, 0xa9, 0xcd, 0x65, 0xca, 0xaa, 0xae, 0xd6, 0x1,  0x39, 0x18, 0x0,  0x0,  0x7d,
      0xf4, 0x8,  0x0,  0x1,  0x46, 0x0,  0x12, 0x4f, 0x1b, 0x42, 0x28, 0x95, 0x92, 0x6f, 0xb1, 0xf9, 0xee, 0x26, 0x98,
      0xde, 0x94, 0xe1, 0xd0, 0x6b, 0x3c, 0x2e, 0x0,  0xb,  0xa3, 0x6,  0xd0, 0x3,  0x7d, 0xeb, 0x1b, 0xe6, 0xc1, 0xca,
      0x73, 0x2a, 0x0,  0xc,  0x8c, 0x3e, 0x38, 0xb1, 0x18, 0x1f, 0xbb, 0x77, 0xad, 0xa,  0x7e, 0x22, 0x22, 0x0,  0xe,
      0x41, 0x64, 0x54, 0x5b, 0xfe, 0x5b, 0x98, 0xf9, 0x1a, 0x68, 0x65, 0x25, 0x65, 0xb9, 0x1e, 0x0,  0xb,  0xc9, 0xe6,
      0x19, 0x1d, 0x34, 0x14, 0xe9, 0x42, 0x4f, 0x5d, 0xa5, 0x2,  0x0,  0xd,  0xf5, 0x94, 0x40, 0xf6, 0x69, 0x79, 0x1a,
      0x3c, 0x45, 0xbf, 0xe,  0x62, 0x72, 0x2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x4f, 0x1b, 0x42, 0x28, 0x95, 0x92, 0x6f, 0xb1, 0xf9,
                                     0xee, 0x26, 0x98, 0xde, 0x94, 0xe1, 0xd0, 0x6b, 0x3c};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa3, 0x6, 0xd0, 0x3, 0x7d, 0xeb, 0x1b, 0xe6, 0xc1, 0xca, 0x73};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8c, 0x3e, 0x38, 0xb1, 0x18, 0x1f, 0xbb, 0x77, 0xad, 0xa, 0x7e, 0x22};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x41, 0x64, 0x54, 0x5b, 0xfe, 0x5b, 0x98,
                                     0xf9, 0x1a, 0x68, 0x65, 0x25, 0x65, 0xb9};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc9, 0xe6, 0x19, 0x1d, 0x34, 0x14, 0xe9, 0x42, 0x4f, 0x5d, 0xa5};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xf5, 0x94, 0x40, 0xf6, 0x69, 0x79, 0x1a, 0x3c, 0x45, 0xbf, 0xe, 0x62, 0x72};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0x85, 0x5f, 0xe1, 0x9e, 0xc5, 0x80, 0x43, 0xc5, 0x15, 0x3d,
                           0xc2, 0x42, 0x2b, 0xa1, 0xd5, 0xf0, 0x59, 0xde, 0xb5, 0x80};
  uint8_t bytesprops1[] = {0xd4, 0xc6, 0x7,  0xdc, 0x58, 0x92, 0x6e, 0x50, 0x85, 0x63, 0x60, 0x2b, 0x17, 0x34,
                           0x2,  0x19, 0x5c, 0x25, 0xea, 0xf,  0x80, 0x20, 0x4d, 0x4e, 0xb0, 0xda, 0x97, 0x58};
  uint8_t bytesprops2[] = {0xbe, 0xef, 0x26, 0x7e, 0xb4, 0x41, 0x69, 0xf3, 0xf,  0x82, 0xa0,
                           0xed, 0x3c, 0x2c, 0x14, 0xbf, 0xa4, 0xd4, 0x53, 0x63, 0x31, 0xf1};
  uint8_t bytesprops3[] = {0x1c, 0x2,  0x37, 0x3d, 0xeb, 0x6c, 0x3d, 0xf2, 0xb5,
                           0x42, 0x1f, 0xe2, 0x45, 0xc6, 0x69, 0x87, 0x6c, 0x85};
  uint8_t bytesprops4[] = {0xb0, 0x5e, 0xa9, 0xcd, 0x65, 0xca, 0xaa, 0xae, 0xd6};
  uint8_t bytesprops5[] = {0x46};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 21521}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20232}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 200}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3027}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7035}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 167}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6999}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 146}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 19768}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 20153}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 23593}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17398}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9346}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20036}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6666}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23069}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3647}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32244}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {1, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26959, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24469 [("\ESC#\199)\130R\223\244K\131C[",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS1}),("\251\177\205",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\SIM7\199/\GSb\150\n\210
// m\147\134\136B$\140[\181G",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS2}),("x\229\129*\DC4h3\238\156\215|k\147=\203I\207t\230\131\199E\154\&6-\159\254B\b_",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\GS\179I\154\174\202\188f\228\141\231\152\165U\184H\238\&5a",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS1}),("e\242xX?l\240\&0p[V\STX\221%\132\152\STX\NAK7\204\231\202\SI\167\182\137bd\170\224",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("Au\237\142}\ENQ/1\187\&3fw@\229\243\188\SYN;\189\186\t\159\222\SI\r",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS1}),("@
// \v5\RS\192\164\205\192\128\149\176Yt\SUB\229K\216\195\"\251",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})] [PropRetainAvailable 97,PropContentType
// "F\DLE\248\141\235\CANR\140-\155\252\182}@8nP\161\NAK\135<\203+\223r\244\170\b\STX\233",PropTopicAliasMaximum
// 20763,PropSubscriptionIdentifierAvailable 225,PropCorrelationData
// "BW\138\b\190y\187\130g\198\148\171\186\159\225\131\CAN\239\&6\136z\EM\228\246\224\&0",PropRequestProblemInformation
// 126,PropReceiveMaximum 7455,PropMaximumPacketSize 10474,PropReasonString
// "o\132\224\163",PropSharedSubscriptionAvailable 144,PropServerKeepAlive 24000,PropSessionExpiryInterval
// 11449,PropUserProperty "\203D;\ETX\219[\138\DEL\172\176\"&{" "\EMW-\148Q%\188\225\233[",PropMaximumPacketSize
// 4103,PropMaximumQoS 46]
TEST(Subscribe5QCTest, Encode11) {
  uint8_t pkt[] = {
      0x82, 0xc0, 0x2,  0x5f, 0x95, 0x83, 0x1,  0x25, 0x61, 0x3,  0x0,  0x1e, 0x46, 0x10, 0xf8, 0x8d, 0xeb, 0x18, 0x52,
      0x8c, 0x2d, 0x9b, 0xfc, 0xb6, 0x7d, 0x40, 0x38, 0x6e, 0x50, 0xa1, 0x15, 0x87, 0x3c, 0xcb, 0x2b, 0xdf, 0x72, 0xf4,
      0xaa, 0x8,  0x2,  0xe9, 0x22, 0x51, 0x1b, 0x29, 0xe1, 0x9,  0x0,  0x1a, 0x42, 0x57, 0x8a, 0x8,  0xbe, 0x79, 0xbb,
      0x82, 0x67, 0xc6, 0x94, 0xab, 0xba, 0x9f, 0xe1, 0x83, 0x18, 0xef, 0x36, 0x88, 0x7a, 0x19, 0xe4, 0xf6, 0xe0, 0x30,
      0x17, 0x7e, 0x21, 0x1d, 0x1f, 0x27, 0x0,  0x0,  0x28, 0xea, 0x1f, 0x0,  0x4,  0x6f, 0x84, 0xe0, 0xa3, 0x2a, 0x90,
      0x13, 0x5d, 0xc0, 0x11, 0x0,  0x0,  0x2c, 0xb9, 0x26, 0x0,  0xd,  0xcb, 0x44, 0x3b, 0x3,  0xdb, 0x5b, 0x8a, 0x7f,
      0xac, 0xb0, 0x22, 0x26, 0x7b, 0x0,  0xa,  0x19, 0x57, 0x2d, 0x94, 0x51, 0x25, 0xbc, 0xe1, 0xe9, 0x5b, 0x27, 0x0,
      0x0,  0x10, 0x7,  0x24, 0x2e, 0x0,  0xc,  0x1b, 0x23, 0xc7, 0x29, 0x82, 0x52, 0xdf, 0xf4, 0x4b, 0x83, 0x43, 0x5b,
      0x19, 0x0,  0x3,  0xfb, 0xb1, 0xcd, 0x2c, 0x0,  0x15, 0xf,  0x4d, 0x37, 0xc7, 0x2f, 0x1d, 0x62, 0x96, 0xa,  0xd2,
      0x20, 0x6d, 0x93, 0x86, 0x88, 0x42, 0x24, 0x8c, 0x5b, 0xb5, 0x47, 0x16, 0x0,  0x1e, 0x78, 0xe5, 0x81, 0x2a, 0x14,
      0x68, 0x33, 0xee, 0x9c, 0xd7, 0x7c, 0x6b, 0x93, 0x3d, 0xcb, 0x49, 0xcf, 0x74, 0xe6, 0x83, 0xc7, 0x45, 0x9a, 0x36,
      0x2d, 0x9f, 0xfe, 0x42, 0x8,  0x5f, 0x1d, 0x0,  0x13, 0x1d, 0xb3, 0x49, 0x9a, 0xae, 0xca, 0xbc, 0x66, 0xe4, 0x8d,
      0xe7, 0x98, 0xa5, 0x55, 0xb8, 0x48, 0xee, 0x35, 0x61, 0x21, 0x0,  0x1e, 0x65, 0xf2, 0x78, 0x58, 0x3f, 0x6c, 0xf0,
      0x30, 0x70, 0x5b, 0x56, 0x2,  0xdd, 0x25, 0x84, 0x98, 0x2,  0x15, 0x37, 0xcc, 0xe7, 0xca, 0xf,  0xa7, 0xb6, 0x89,
      0x62, 0x64, 0xaa, 0xe0, 0x5,  0x0,  0x19, 0x41, 0x75, 0xed, 0x8e, 0x7d, 0x5,  0x2f, 0x31, 0xbb, 0x33, 0x66, 0x77,
      0x40, 0xe5, 0xf3, 0xbc, 0x16, 0x3b, 0xbd, 0xba, 0x9,  0x9f, 0xde, 0xf,  0xd,  0x21, 0x0,  0x15, 0x40, 0x20, 0xb,
      0x35, 0x1e, 0xc0, 0xa4, 0xcd, 0xc0, 0x80, 0x95, 0xb0, 0x59, 0x74, 0x1a, 0xe5, 0x4b, 0xd8, 0xc3, 0x22, 0xfb, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x1b, 0x23, 0xc7, 0x29, 0x82, 0x52, 0xdf, 0xf4, 0x4b, 0x83, 0x43, 0x5b};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xfb, 0xb1, 0xcd};
  lwmqtt_string_t topic_filter_s1 = {3, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xf,  0x4d, 0x37, 0xc7, 0x2f, 0x1d, 0x62, 0x96, 0xa,  0xd2, 0x20,
                                     0x6d, 0x93, 0x86, 0x88, 0x42, 0x24, 0x8c, 0x5b, 0xb5, 0x47};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x78, 0xe5, 0x81, 0x2a, 0x14, 0x68, 0x33, 0xee, 0x9c, 0xd7,
                                     0x7c, 0x6b, 0x93, 0x3d, 0xcb, 0x49, 0xcf, 0x74, 0xe6, 0x83,
                                     0xc7, 0x45, 0x9a, 0x36, 0x2d, 0x9f, 0xfe, 0x42, 0x8,  0x5f};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x1d, 0xb3, 0x49, 0x9a, 0xae, 0xca, 0xbc, 0x66, 0xe4, 0x8d,
                                     0xe7, 0x98, 0xa5, 0x55, 0xb8, 0x48, 0xee, 0x35, 0x61};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x65, 0xf2, 0x78, 0x58, 0x3f, 0x6c, 0xf0, 0x30, 0x70, 0x5b,
                                     0x56, 0x2,  0xdd, 0x25, 0x84, 0x98, 0x2,  0x15, 0x37, 0xcc,
                                     0xe7, 0xca, 0xf,  0xa7, 0xb6, 0x89, 0x62, 0x64, 0xaa, 0xe0};
  lwmqtt_string_t topic_filter_s5 = {30, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x41, 0x75, 0xed, 0x8e, 0x7d, 0x5,  0x2f, 0x31, 0xbb, 0x33, 0x66, 0x77, 0x40,
                                     0xe5, 0xf3, 0xbc, 0x16, 0x3b, 0xbd, 0xba, 0x9,  0x9f, 0xde, 0xf,  0xd};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x40, 0x20, 0xb,  0x35, 0x1e, 0xc0, 0xa4, 0xcd, 0xc0, 0x80, 0x95,
                                     0xb0, 0x59, 0x74, 0x1a, 0xe5, 0x4b, 0xd8, 0xc3, 0x22, 0xfb};
  lwmqtt_string_t topic_filter_s7 = {21, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  lwmqtt_sub_options_t sub_opts[8];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  uint8_t bytesprops0[] = {0x46, 0x10, 0xf8, 0x8d, 0xeb, 0x18, 0x52, 0x8c, 0x2d, 0x9b, 0xfc, 0xb6, 0x7d, 0x40, 0x38,
                           0x6e, 0x50, 0xa1, 0x15, 0x87, 0x3c, 0xcb, 0x2b, 0xdf, 0x72, 0xf4, 0xaa, 0x8,  0x2,  0xe9};
  uint8_t bytesprops1[] = {0x42, 0x57, 0x8a, 0x8,  0xbe, 0x79, 0xbb, 0x82, 0x67, 0xc6, 0x94, 0xab, 0xba,
                           0x9f, 0xe1, 0x83, 0x18, 0xef, 0x36, 0x88, 0x7a, 0x19, 0xe4, 0xf6, 0xe0, 0x30};
  uint8_t bytesprops2[] = {0x6f, 0x84, 0xe0, 0xa3};
  uint8_t bytesprops4[] = {0x19, 0x57, 0x2d, 0x94, 0x51, 0x25, 0xbc, 0xe1, 0xe9, 0x5b};
  uint8_t bytesprops3[] = {0xcb, 0x44, 0x3b, 0x3, 0xdb, 0x5b, 0x8a, 0x7f, 0xac, 0xb0, 0x22, 0x26, 0x7b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 97}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 20763}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 126}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 7455}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 10474}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24000}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11449}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops3}, .v = {10, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4103}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 46}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24469, 8, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 12270 [("7\235R8?\\\200\&7^jN\237\DC2\229\&6O7",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\154\223\186^\201\164\207\230\160\GSi\205\210\204=(\196\CAN\191H\169D`",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("\254\248p\NUL5\\\140j\"\ETX\185\251\223\242+'\214\223z\229\247\219\225Y\ETB\FS\ESC\ESC\254",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS2}),("\213\190
// \178\176o\172\166\217\173E\167`)\b\EM\EM\249\204_\DLE\152`\179P",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("w\ESCURkJ\215\186\129\131\NAK\"\139d\\\246\228\ESC\SOHA\EM\218D\215\211*",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\186H[`\183\255",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\170+\DEL:4\218\131z(#\199^O}\a\193\&0\181\231\231\187\187P\239",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1})] [PropRetainAvailable
// 149,PropReasonString
// "\219?!\ETX\138J(v\227\238\210\237\GSu\189\137\&5N^\217F;\242\&7\137\NULl\181\178",PropTopicAliasMaximum
// 13282,PropReasonString "'\r\164I7\148~-",PropAuthenticationMethod
// "\167_\229\162\&8\DC4~\SI\149\131\147s\147\245Y\SOH\RS\167\f\205\245\131\SIl\SUB\191",PropResponseTopic
// "\"\DEL\173Y\174\r\151\133iQ0\137M\208\171\DC2\225\137\238}",PropReasonString
// "E\176\150\&2\255#\224&{\219\242\215\149g\217TW",PropCorrelationData "\161Ss<\192\194ct\146Z\157\169\151\&9\141
// x\173K\147\r|_}\157",PropSubscriptionIdentifier 7,PropReasonString "\EM-",PropMessageExpiryInterval
// 15513,PropSubscriptionIdentifier 22,PropRetainAvailable 40,PropSubscriptionIdentifierAvailable
// 175,PropServerReference "\EOT\182\NAK5\158\&8\DC4\131 U\198\DC3\EOT@p\219Ix\237m\203\161W",PropRetainAvailable
// 30,PropAuthenticationData "\133\136y\187Lb{\218",PropTopicAlias 30717,PropContentType
// "\161\161\171\NUL\152RI\CAN\146\241\194\171\&9\186\145\174\227@\174/Ht\ETBi\242",PropMessageExpiryInterval
// 26831,PropUserProperty "\236\193\150\254\ETB\203\209\179{!}Q\139\170IG\FS\ba\240&'"
// ">\210\&4",PropRequestProblemInformation 91]
TEST(Subscribe5QCTest, Encode12) {
  uint8_t pkt[] = {
      0x82, 0xc0, 0x3,  0x2f, 0xee, 0x91, 0x2,  0x25, 0x95, 0x1f, 0x0,  0x1d, 0xdb, 0x3f, 0x21, 0x3,  0x8a, 0x4a, 0x28,
      0x76, 0xe3, 0xee, 0xd2, 0xed, 0x1d, 0x75, 0xbd, 0x89, 0x35, 0x4e, 0x5e, 0xd9, 0x46, 0x3b, 0xf2, 0x37, 0x89, 0x0,
      0x6c, 0xb5, 0xb2, 0x22, 0x33, 0xe2, 0x1f, 0x0,  0x8,  0x27, 0xd,  0xa4, 0x49, 0x37, 0x94, 0x7e, 0x2d, 0x15, 0x0,
      0x1a, 0xa7, 0x5f, 0xe5, 0xa2, 0x38, 0x14, 0x7e, 0xf,  0x95, 0x83, 0x93, 0x73, 0x93, 0xf5, 0x59, 0x1,  0x1e, 0xa7,
      0xc,  0xcd, 0xf5, 0x83, 0xf,  0x6c, 0x1a, 0xbf, 0x8,  0x0,  0x14, 0x22, 0x7f, 0xad, 0x59, 0xae, 0xd,  0x97, 0x85,
      0x69, 0x51, 0x30, 0x89, 0x4d, 0xd0, 0xab, 0x12, 0xe1, 0x89, 0xee, 0x7d, 0x1f, 0x0,  0x11, 0x45, 0xb0, 0x96, 0x32,
      0xff, 0x23, 0xe0, 0x26, 0x7b, 0xdb, 0xf2, 0xd7, 0x95, 0x67, 0xd9, 0x54, 0x57, 0x9,  0x0,  0x19, 0xa1, 0x53, 0x73,
      0x3c, 0xc0, 0xc2, 0x63, 0x74, 0x92, 0x5a, 0x9d, 0xa9, 0x97, 0x39, 0x8d, 0x20, 0x78, 0xad, 0x4b, 0x93, 0xd,  0x7c,
      0x5f, 0x7d, 0x9d, 0xb,  0x7,  0x1f, 0x0,  0x2,  0x19, 0x2d, 0x2,  0x0,  0x0,  0x3c, 0x99, 0xb,  0x16, 0x25, 0x28,
      0x29, 0xaf, 0x1c, 0x0,  0x17, 0x4,  0xb6, 0x15, 0x35, 0x9e, 0x38, 0x14, 0x83, 0x20, 0x55, 0xc6, 0x13, 0x4,  0x40,
      0x70, 0xdb, 0x49, 0x78, 0xed, 0x6d, 0xcb, 0xa1, 0x57, 0x25, 0x1e, 0x16, 0x0,  0x8,  0x85, 0x88, 0x79, 0xbb, 0x4c,
      0x62, 0x7b, 0xda, 0x23, 0x77, 0xfd, 0x3,  0x0,  0x19, 0xa1, 0xa1, 0xab, 0x0,  0x98, 0x52, 0x49, 0x18, 0x92, 0xf1,
      0xc2, 0xab, 0x39, 0xba, 0x91, 0xae, 0xe3, 0x40, 0xae, 0x2f, 0x48, 0x74, 0x17, 0x69, 0xf2, 0x2,  0x0,  0x0,  0x68,
      0xcf, 0x26, 0x0,  0x16, 0xec, 0xc1, 0x96, 0xfe, 0x17, 0xcb, 0xd1, 0xb3, 0x7b, 0x21, 0x7d, 0x51, 0x8b, 0xaa, 0x49,
      0x47, 0x1c, 0x8,  0x61, 0xf0, 0x26, 0x27, 0x0,  0x3,  0x3e, 0xd2, 0x34, 0x17, 0x5b, 0x0,  0x11, 0x37, 0xeb, 0x52,
      0x38, 0x3f, 0x5c, 0xc8, 0x37, 0x5e, 0x6a, 0x4e, 0xed, 0x12, 0xe5, 0x36, 0x4f, 0x37, 0x6,  0x0,  0x17, 0x9a, 0xdf,
      0xba, 0x5e, 0xc9, 0xa4, 0xcf, 0xe6, 0xa0, 0x1d, 0x69, 0xcd, 0xd2, 0xcc, 0x3d, 0x28, 0xc4, 0x18, 0xbf, 0x48, 0xa9,
      0x44, 0x60, 0x10, 0x0,  0x1d, 0xfe, 0xf8, 0x70, 0x0,  0x35, 0x5c, 0x8c, 0x6a, 0x22, 0x3,  0xb9, 0xfb, 0xdf, 0xf2,
      0x2b, 0x27, 0xd6, 0xdf, 0x7a, 0xe5, 0xf7, 0xdb, 0xe1, 0x59, 0x17, 0x1c, 0x1b, 0x1b, 0xfe, 0x2,  0x0,  0x19, 0xd5,
      0xbe, 0x20, 0xb2, 0xb0, 0x6f, 0xac, 0xa6, 0xd9, 0xad, 0x45, 0xa7, 0x60, 0x29, 0x8,  0x19, 0x19, 0xf9, 0xcc, 0x5f,
      0x10, 0x98, 0x60, 0xb3, 0x50, 0xd,  0x0,  0x1a, 0x77, 0x1b, 0x55, 0x52, 0x6b, 0x4a, 0xd7, 0xba, 0x81, 0x83, 0x15,
      0x22, 0x8b, 0x64, 0x5c, 0xf6, 0xe4, 0x1b, 0x1,  0x41, 0x19, 0xda, 0x44, 0xd7, 0xd3, 0x2a, 0x6,  0x0,  0x6,  0xba,
      0x48, 0x5b, 0x60, 0xb7, 0xff, 0x9,  0x0,  0x18, 0xaa, 0x2b, 0x7f, 0x3a, 0x34, 0xda, 0x83, 0x7a, 0x28, 0x23, 0xc7,
      0x5e, 0x4f, 0x7d, 0x7,  0xc1, 0x30, 0xb5, 0xe7, 0xe7, 0xbb, 0xbb, 0x50, 0xef, 0x1d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x37, 0xeb, 0x52, 0x38, 0x3f, 0x5c, 0xc8, 0x37, 0x5e,
                                     0x6a, 0x4e, 0xed, 0x12, 0xe5, 0x36, 0x4f, 0x37};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9a, 0xdf, 0xba, 0x5e, 0xc9, 0xa4, 0xcf, 0xe6, 0xa0, 0x1d, 0x69, 0xcd,
                                     0xd2, 0xcc, 0x3d, 0x28, 0xc4, 0x18, 0xbf, 0x48, 0xa9, 0x44, 0x60};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xfe, 0xf8, 0x70, 0x0,  0x35, 0x5c, 0x8c, 0x6a, 0x22, 0x3,
                                     0xb9, 0xfb, 0xdf, 0xf2, 0x2b, 0x27, 0xd6, 0xdf, 0x7a, 0xe5,
                                     0xf7, 0xdb, 0xe1, 0x59, 0x17, 0x1c, 0x1b, 0x1b, 0xfe};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd5, 0xbe, 0x20, 0xb2, 0xb0, 0x6f, 0xac, 0xa6, 0xd9, 0xad, 0x45, 0xa7, 0x60,
                                     0x29, 0x8,  0x19, 0x19, 0xf9, 0xcc, 0x5f, 0x10, 0x98, 0x60, 0xb3, 0x50};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x77, 0x1b, 0x55, 0x52, 0x6b, 0x4a, 0xd7, 0xba, 0x81, 0x83, 0x15, 0x22, 0x8b,
                                     0x64, 0x5c, 0xf6, 0xe4, 0x1b, 0x1,  0x41, 0x19, 0xda, 0x44, 0xd7, 0xd3, 0x2a};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xba, 0x48, 0x5b, 0x60, 0xb7, 0xff};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xaa, 0x2b, 0x7f, 0x3a, 0x34, 0xda, 0x83, 0x7a, 0x28, 0x23, 0xc7, 0x5e,
                                     0x4f, 0x7d, 0x7,  0xc1, 0x30, 0xb5, 0xe7, 0xe7, 0xbb, 0xbb, 0x50, 0xef};
  lwmqtt_string_t topic_filter_s6 = {24, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  sub_opts[6].qos = LWMQTT_QOS1;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0xdb, 0x3f, 0x21, 0x3,  0x8a, 0x4a, 0x28, 0x76, 0xe3, 0xee, 0xd2, 0xed, 0x1d, 0x75, 0xbd,
                           0x89, 0x35, 0x4e, 0x5e, 0xd9, 0x46, 0x3b, 0xf2, 0x37, 0x89, 0x0,  0x6c, 0xb5, 0xb2};
  uint8_t bytesprops1[] = {0x27, 0xd, 0xa4, 0x49, 0x37, 0x94, 0x7e, 0x2d};
  uint8_t bytesprops2[] = {0xa7, 0x5f, 0xe5, 0xa2, 0x38, 0x14, 0x7e, 0xf,  0x95, 0x83, 0x93, 0x73, 0x93,
                           0xf5, 0x59, 0x1,  0x1e, 0xa7, 0xc,  0xcd, 0xf5, 0x83, 0xf,  0x6c, 0x1a, 0xbf};
  uint8_t bytesprops3[] = {0x22, 0x7f, 0xad, 0x59, 0xae, 0xd,  0x97, 0x85, 0x69, 0x51,
                           0x30, 0x89, 0x4d, 0xd0, 0xab, 0x12, 0xe1, 0x89, 0xee, 0x7d};
  uint8_t bytesprops4[] = {0x45, 0xb0, 0x96, 0x32, 0xff, 0x23, 0xe0, 0x26, 0x7b,
                           0xdb, 0xf2, 0xd7, 0x95, 0x67, 0xd9, 0x54, 0x57};
  uint8_t bytesprops5[] = {0xa1, 0x53, 0x73, 0x3c, 0xc0, 0xc2, 0x63, 0x74, 0x92, 0x5a, 0x9d, 0xa9, 0x97,
                           0x39, 0x8d, 0x20, 0x78, 0xad, 0x4b, 0x93, 0xd,  0x7c, 0x5f, 0x7d, 0x9d};
  uint8_t bytesprops6[] = {0x19, 0x2d};
  uint8_t bytesprops7[] = {0x4, 0xb6, 0x15, 0x35, 0x9e, 0x38, 0x14, 0x83, 0x20, 0x55, 0xc6, 0x13,
                           0x4, 0x40, 0x70, 0xdb, 0x49, 0x78, 0xed, 0x6d, 0xcb, 0xa1, 0x57};
  uint8_t bytesprops8[] = {0x85, 0x88, 0x79, 0xbb, 0x4c, 0x62, 0x7b, 0xda};
  uint8_t bytesprops9[] = {0xa1, 0xa1, 0xab, 0x0,  0x98, 0x52, 0x49, 0x18, 0x92, 0xf1, 0xc2, 0xab, 0x39,
                           0xba, 0x91, 0xae, 0xe3, 0x40, 0xae, 0x2f, 0x48, 0x74, 0x17, 0x69, 0xf2};
  uint8_t bytesprops11[] = {0x3e, 0xd2, 0x34};
  uint8_t bytesprops10[] = {0xec, 0xc1, 0x96, 0xfe, 0x17, 0xcb, 0xd1, 0xb3, 0x7b, 0x21, 0x7d,
                            0x51, 0x8b, 0xaa, 0x49, 0x47, 0x1c, 0x8,  0x61, 0xf0, 0x26, 0x27};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13282}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 15513}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 22}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 175}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 30}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30717}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {25, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26831}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops10}, .v = {3, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 91}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 12270, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 18547 [("\189J\145\DC3y\183\216\164\150\129\238l\168;Q\211/\253\211\135%\144\153\\\160",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\b@\172f,>\129\206D\233\DEL\225\131B}\239\133\177\140\196\193j\DC1\237",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),("\152\130\187",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\143\DC1\220\180\147#-\155\181y",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS2}),("\235.\t\SOH\DC2\EM/vM\205b",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropContentType
// "\218\224\222?",PropMessageExpiryInterval 29289,PropAuthenticationData "\191n\EOTS",PropSharedSubscriptionAvailable
// 84,PropMessageExpiryInterval 3727,PropMessageExpiryInterval 29049,PropTopicAlias 21920,PropServerReference
// "\231\246\219\229B\169&\a\187\b\167\&3\191u\176!+\243\249T\223{",PropMessageExpiryInterval 11550,PropResponseTopic
// "\218\DEL\237,\213}\NUL\229\138,\ESCD\243P\187\223\187\144WT\EOTU\160da",PropMessageExpiryInterval
// 5728,PropCorrelationData "~\182T\189"]
TEST(Subscribe5QCTest, Encode13) {
  uint8_t pkt[] = {0x82, 0xc3, 0x1,  0x48, 0x73, 0x68, 0x3,  0x0,  0x4,  0xda, 0xe0, 0xde, 0x3f, 0x2,  0x0,  0x0,  0x72,
                   0x69, 0x16, 0x0,  0x4,  0xbf, 0x6e, 0x4,  0x53, 0x2a, 0x54, 0x2,  0x0,  0x0,  0xe,  0x8f, 0x2,  0x0,
                   0x0,  0x71, 0x79, 0x23, 0x55, 0xa0, 0x1c, 0x0,  0x16, 0xe7, 0xf6, 0xdb, 0xe5, 0x42, 0xa9, 0x26, 0x7,
                   0xbb, 0x8,  0xa7, 0x33, 0xbf, 0x75, 0xb0, 0x21, 0x2b, 0xf3, 0xf9, 0x54, 0xdf, 0x7b, 0x2,  0x0,  0x0,
                   0x2d, 0x1e, 0x8,  0x0,  0x19, 0xda, 0x7f, 0xed, 0x2c, 0xd5, 0x7d, 0x0,  0xe5, 0x8a, 0x2c, 0x1b, 0x44,
                   0xf3, 0x50, 0xbb, 0xdf, 0xbb, 0x90, 0x57, 0x54, 0x4,  0x55, 0xa0, 0x64, 0x61, 0x2,  0x0,  0x0,  0x16,
                   0x60, 0x9,  0x0,  0x4,  0x7e, 0xb6, 0x54, 0xbd, 0x0,  0x19, 0xbd, 0x4a, 0x91, 0x13, 0x79, 0xb7, 0xd8,
                   0xa4, 0x96, 0x81, 0xee, 0x6c, 0xa8, 0x3b, 0x51, 0xd3, 0x2f, 0xfd, 0xd3, 0x87, 0x25, 0x90, 0x99, 0x5c,
                   0xa0, 0x2,  0x0,  0x18, 0x8,  0x40, 0xac, 0x66, 0x2c, 0x3e, 0x81, 0xce, 0x44, 0xe9, 0x7f, 0xe1, 0x83,
                   0x42, 0x7d, 0xef, 0x85, 0xb1, 0x8c, 0xc4, 0xc1, 0x6a, 0x11, 0xed, 0xc,  0x0,  0x3,  0x98, 0x82, 0xbb,
                   0x4,  0x0,  0xa,  0x8f, 0x11, 0xdc, 0xb4, 0x93, 0x23, 0x2d, 0x9b, 0xb5, 0x79, 0x1e, 0x0,  0xb,  0xeb,
                   0x2e, 0x9,  0x1,  0x12, 0x19, 0x2f, 0x76, 0x4d, 0xcd, 0x62, 0x24};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xbd, 0x4a, 0x91, 0x13, 0x79, 0xb7, 0xd8, 0xa4, 0x96, 0x81, 0xee, 0x6c, 0xa8,
                                     0x3b, 0x51, 0xd3, 0x2f, 0xfd, 0xd3, 0x87, 0x25, 0x90, 0x99, 0x5c, 0xa0};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x8,  0x40, 0xac, 0x66, 0x2c, 0x3e, 0x81, 0xce, 0x44, 0xe9, 0x7f, 0xe1,
                                     0x83, 0x42, 0x7d, 0xef, 0x85, 0xb1, 0x8c, 0xc4, 0xc1, 0x6a, 0x11, 0xed};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x98, 0x82, 0xbb};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x8f, 0x11, 0xdc, 0xb4, 0x93, 0x23, 0x2d, 0x9b, 0xb5, 0x79};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xeb, 0x2e, 0x9, 0x1, 0x12, 0x19, 0x2f, 0x76, 0x4d, 0xcd, 0x62};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0xda, 0xe0, 0xde, 0x3f};
  uint8_t bytesprops1[] = {0xbf, 0x6e, 0x4, 0x53};
  uint8_t bytesprops2[] = {0xe7, 0xf6, 0xdb, 0xe5, 0x42, 0xa9, 0x26, 0x7,  0xbb, 0x8,  0xa7,
                           0x33, 0xbf, 0x75, 0xb0, 0x21, 0x2b, 0xf3, 0xf9, 0x54, 0xdf, 0x7b};
  uint8_t bytesprops3[] = {0xda, 0x7f, 0xed, 0x2c, 0xd5, 0x7d, 0x0,  0xe5, 0x8a, 0x2c, 0x1b, 0x44, 0xf3,
                           0x50, 0xbb, 0xdf, 0xbb, 0x90, 0x57, 0x54, 0x4,  0x55, 0xa0, 0x64, 0x61};
  uint8_t bytesprops4[] = {0x7e, 0xb6, 0x54, 0xbd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29289}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 3727}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29049}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21920}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11550}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5728}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 18547, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10474 [(",+{\129\233\223\145\247o8\195\202\SIEVN\152\206m\181$\172\204\250HR\169",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\170[\206)\DC4\217gT\220\238",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("\194y\219\180",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS1})] [PropPayloadFormatIndicator 44,PropAssignedClientIdentifier
// "\220\218\250V\193A\242\142\153\ESCH\210",PropAssignedClientIdentifier
// "\165CG\207\253\204\237\177\192\143",PropWillDelayInterval 27765,PropMaximumQoS 133,PropAssignedClientIdentifier
// "\210\CANo\193>",PropTopicAliasMaximum 12560,PropServerReference
// "\164\&2\212\vUW\147WU\226\228\245\212L\166!\225\239\240J",PropResponseInformation
// "_\170&\132\206\&5\153w\167\228\153\203=\ACK\167\ENQ?8\162\&4\SYN/\243\177zCO=",PropMessageExpiryInterval
// 29666,PropUserProperty "\228\&41\ENQG\171\241?F/\199\226\154 @\153\ACK!\ENQ\216\173\ETX\228\253\226\NUL^d.\201"
// "\165\169o\208\SOH\185\193\184\202\r\215\150\226L\138\&9\222+\224@l\240\167\187\129",PropMessageExpiryInterval
// 14224,PropResponseInformation "\168\208\251F\232\179\&4\NAKvO\140\ETX9Ae\160(",PropResponseTopic
// "\196\ACK\197\199\163m\NUL\168~/B\244\198\204\226\NUL\219\&6H\183\203\249\191\188\197\238\167\196\168",PropRequestResponseInformation
// 155,PropSubscriptionIdentifierAvailable 59,PropUserProperty "\SOH"
// ",\254\234u\166\231\205\211\133\169cu`\199\DC4V\234\251)",PropTopicAliasMaximum 8917,PropSessionExpiryInterval
// 28790,PropServerReference "\173\203h\175U\GS\250T"]
TEST(Subscribe5QCTest, Encode14) {
  uint8_t pkt[] = {
      0x82, 0xc6, 0x2,  0x28, 0xea, 0x90, 0x2,  0x1,  0x2c, 0x12, 0x0,  0xc,  0xdc, 0xda, 0xfa, 0x56, 0xc1, 0x41, 0xf2,
      0x8e, 0x99, 0x1b, 0x48, 0xd2, 0x12, 0x0,  0xa,  0xa5, 0x43, 0x47, 0xcf, 0xfd, 0xcc, 0xed, 0xb1, 0xc0, 0x8f, 0x18,
      0x0,  0x0,  0x6c, 0x75, 0x24, 0x85, 0x12, 0x0,  0x5,  0xd2, 0x18, 0x6f, 0xc1, 0x3e, 0x22, 0x31, 0x10, 0x1c, 0x0,
      0x14, 0xa4, 0x32, 0xd4, 0xb,  0x55, 0x57, 0x93, 0x57, 0x55, 0xe2, 0xe4, 0xf5, 0xd4, 0x4c, 0xa6, 0x21, 0xe1, 0xef,
      0xf0, 0x4a, 0x1a, 0x0,  0x1c, 0x5f, 0xaa, 0x26, 0x84, 0xce, 0x35, 0x99, 0x77, 0xa7, 0xe4, 0x99, 0xcb, 0x3d, 0x6,
      0xa7, 0x5,  0x3f, 0x38, 0xa2, 0x34, 0x16, 0x2f, 0xf3, 0xb1, 0x7a, 0x43, 0x4f, 0x3d, 0x2,  0x0,  0x0,  0x73, 0xe2,
      0x26, 0x0,  0x1e, 0xe4, 0x34, 0x31, 0x5,  0x47, 0xab, 0xf1, 0x3f, 0x46, 0x2f, 0xc7, 0xe2, 0x9a, 0x20, 0x40, 0x99,
      0x6,  0x21, 0x5,  0xd8, 0xad, 0x3,  0xe4, 0xfd, 0xe2, 0x0,  0x5e, 0x64, 0x2e, 0xc9, 0x0,  0x19, 0xa5, 0xa9, 0x6f,
      0xd0, 0x1,  0xb9, 0xc1, 0xb8, 0xca, 0xd,  0xd7, 0x96, 0xe2, 0x4c, 0x8a, 0x39, 0xde, 0x2b, 0xe0, 0x40, 0x6c, 0xf0,
      0xa7, 0xbb, 0x81, 0x2,  0x0,  0x0,  0x37, 0x90, 0x1a, 0x0,  0x11, 0xa8, 0xd0, 0xfb, 0x46, 0xe8, 0xb3, 0x34, 0x15,
      0x76, 0x4f, 0x8c, 0x3,  0x39, 0x41, 0x65, 0xa0, 0x28, 0x8,  0x0,  0x1d, 0xc4, 0x6,  0xc5, 0xc7, 0xa3, 0x6d, 0x0,
      0xa8, 0x7e, 0x2f, 0x42, 0xf4, 0xc6, 0xcc, 0xe2, 0x0,  0xdb, 0x36, 0x48, 0xb7, 0xcb, 0xf9, 0xbf, 0xbc, 0xc5, 0xee,
      0xa7, 0xc4, 0xa8, 0x19, 0x9b, 0x29, 0x3b, 0x26, 0x0,  0x1,  0x1,  0x0,  0x13, 0x2c, 0xfe, 0xea, 0x75, 0xa6, 0xe7,
      0xcd, 0xd3, 0x85, 0xa9, 0x63, 0x75, 0x60, 0xc7, 0x14, 0x56, 0xea, 0xfb, 0x29, 0x22, 0x22, 0xd5, 0x11, 0x0,  0x0,
      0x70, 0x76, 0x1c, 0x0,  0x8,  0xad, 0xcb, 0x68, 0xaf, 0x55, 0x1d, 0xfa, 0x54, 0x0,  0x1b, 0x2c, 0x2b, 0x7b, 0x81,
      0xe9, 0xdf, 0x91, 0xf7, 0x6f, 0x38, 0xc3, 0xca, 0xf,  0x45, 0x56, 0x4e, 0x98, 0xce, 0x6d, 0xb5, 0x24, 0xac, 0xcc,
      0xfa, 0x48, 0x52, 0xa9, 0x8,  0x0,  0xa,  0xaa, 0x5b, 0xce, 0x29, 0x14, 0xd9, 0x67, 0x54, 0xdc, 0xee, 0xa,  0x0,
      0x4,  0xc2, 0x79, 0xdb, 0xb4, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x2c, 0x2b, 0x7b, 0x81, 0xe9, 0xdf, 0x91, 0xf7, 0x6f, 0x38, 0xc3, 0xca, 0xf, 0x45,
                                     0x56, 0x4e, 0x98, 0xce, 0x6d, 0xb5, 0x24, 0xac, 0xcc, 0xfa, 0x48, 0x52, 0xa9};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaa, 0x5b, 0xce, 0x29, 0x14, 0xd9, 0x67, 0x54, 0xdc, 0xee};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc2, 0x79, 0xdb, 0xb4};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  lwmqtt_sub_options_t sub_opts[3];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  uint8_t bytesprops0[] = {0xdc, 0xda, 0xfa, 0x56, 0xc1, 0x41, 0xf2, 0x8e, 0x99, 0x1b, 0x48, 0xd2};
  uint8_t bytesprops1[] = {0xa5, 0x43, 0x47, 0xcf, 0xfd, 0xcc, 0xed, 0xb1, 0xc0, 0x8f};
  uint8_t bytesprops2[] = {0xd2, 0x18, 0x6f, 0xc1, 0x3e};
  uint8_t bytesprops3[] = {0xa4, 0x32, 0xd4, 0xb,  0x55, 0x57, 0x93, 0x57, 0x55, 0xe2,
                           0xe4, 0xf5, 0xd4, 0x4c, 0xa6, 0x21, 0xe1, 0xef, 0xf0, 0x4a};
  uint8_t bytesprops4[] = {0x5f, 0xaa, 0x26, 0x84, 0xce, 0x35, 0x99, 0x77, 0xa7, 0xe4, 0x99, 0xcb, 0x3d, 0x6,
                           0xa7, 0x5,  0x3f, 0x38, 0xa2, 0x34, 0x16, 0x2f, 0xf3, 0xb1, 0x7a, 0x43, 0x4f, 0x3d};
  uint8_t bytesprops6[] = {0xa5, 0xa9, 0x6f, 0xd0, 0x1,  0xb9, 0xc1, 0xb8, 0xca, 0xd,  0xd7, 0x96, 0xe2,
                           0x4c, 0x8a, 0x39, 0xde, 0x2b, 0xe0, 0x40, 0x6c, 0xf0, 0xa7, 0xbb, 0x81};
  uint8_t bytesprops5[] = {0xe4, 0x34, 0x31, 0x5, 0x47, 0xab, 0xf1, 0x3f, 0x46, 0x2f, 0xc7, 0xe2, 0x9a, 0x20, 0x40,
                           0x99, 0x6,  0x21, 0x5, 0xd8, 0xad, 0x3,  0xe4, 0xfd, 0xe2, 0x0,  0x5e, 0x64, 0x2e, 0xc9};
  uint8_t bytesprops7[] = {0xa8, 0xd0, 0xfb, 0x46, 0xe8, 0xb3, 0x34, 0x15, 0x76,
                           0x4f, 0x8c, 0x3,  0x39, 0x41, 0x65, 0xa0, 0x28};
  uint8_t bytesprops8[] = {0xc4, 0x6,  0xc5, 0xc7, 0xa3, 0x6d, 0x0,  0xa8, 0x7e, 0x2f, 0x42, 0xf4, 0xc6, 0xcc, 0xe2,
                           0x0,  0xdb, 0x36, 0x48, 0xb7, 0xcb, 0xf9, 0xbf, 0xbc, 0xc5, 0xee, 0xa7, 0xc4, 0xa8};
  uint8_t bytesprops10[] = {0x2c, 0xfe, 0xea, 0x75, 0xa6, 0xe7, 0xcd, 0xd3, 0x85, 0xa9,
                            0x63, 0x75, 0x60, 0xc7, 0x14, 0x56, 0xea, 0xfb, 0x29};
  uint8_t bytesprops9[] = {0x1};
  uint8_t bytesprops11[] = {0xad, 0xcb, 0x68, 0xaf, 0x55, 0x1d, 0xfa, 0x54};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27765}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 133}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12560}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {20, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 29666}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {30, (char*)&bytesprops5}, .v = {25, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14224}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {1, (char*)&bytesprops9}, .v = {19, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 8917}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 28790}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops11}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10474, 3, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 20401 [("\210n-\209\154iPp\201\217l\192\SOHlY\242\n$\144@t",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("@T\180Z\153\"\b\RS8\223%\224\&5z\DC2`\170\NAK\179\224!\SI\153}\149O\252\199\182",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS1}),("P\EM \252RA1y\233=Q
// \206U\161\SUB\NULSCcv\153\&1n\132\135T\138N",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = True, _subQoS =
// QoS0}),("\233\&2\236\152@\229Z\RS\247\249\142\241\147\181\234\al}\228\167\157",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("G\193\ETB\152\&84H\fg2\215\f\DC26\209\t\216xr\172\225>\246Es/_\201",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\SUB\164q\168\180\218\223\190\207RU\153\250\238+E\247\244\183\231\225",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\221\149A\211\195",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})]
// [PropMessageExpiryInterval 18748,PropRetainAvailable 227,PropSessionExpiryInterval
// 7310,PropSubscriptionIdentifierAvailable 59,PropAssignedClientIdentifier
// ".\157P^\128\&1\188\198c2\205\&3s&\138\226\ACK\US\129\155\232~\183",PropMessageExpiryInterval 18830,PropMaximumQoS
// 7,PropMessageExpiryInterval 10723,PropContentType
// "\SUBA>\231\STX\174\247\239NVE\151\215\146\SOH\175\171V",PropRetainAvailable 168,PropReceiveMaximum
// 20286,PropAuthenticationData "\STX\134E\208\156\n\223,Q\166\161\FS\141\192\195\197\&6\EM0^",PropTopicAliasMaximum
// 25662,PropServerKeepAlive 1905,PropResponseTopic "\175\DC3\202",PropPayloadFormatIndicator 117,PropRetainAvailable
// 101,PropReceiveMaximum 17048,PropWildcardSubscriptionAvailable 212,PropWildcardSubscriptionAvailable 20]
TEST(Subscribe5QCTest, Encode15) {
  uint8_t pkt[] = {0x82, 0xae, 0x2,  0x4f, 0xb1, 0x7c, 0x2,  0x0,  0x0,  0x49, 0x3c, 0x25, 0xe3, 0x11, 0x0,  0x0,  0x1c,
                   0x8e, 0x29, 0x3b, 0x12, 0x0,  0x17, 0x2e, 0x9d, 0x50, 0x5e, 0x80, 0x31, 0xbc, 0xc6, 0x63, 0x32, 0xcd,
                   0x33, 0x73, 0x26, 0x8a, 0xe2, 0x6,  0x1f, 0x81, 0x9b, 0xe8, 0x7e, 0xb7, 0x2,  0x0,  0x0,  0x49, 0x8e,
                   0x24, 0x7,  0x2,  0x0,  0x0,  0x29, 0xe3, 0x3,  0x0,  0x12, 0x1a, 0x41, 0x3e, 0xe7, 0x2,  0xae, 0xf7,
                   0xef, 0x4e, 0x56, 0x45, 0x97, 0xd7, 0x92, 0x1,  0xaf, 0xab, 0x56, 0x25, 0xa8, 0x21, 0x4f, 0x3e, 0x16,
                   0x0,  0x14, 0x2,  0x86, 0x45, 0xd0, 0x9c, 0xa,  0xdf, 0x2c, 0x51, 0xa6, 0xa1, 0x1c, 0x8d, 0xc0, 0xc3,
                   0xc5, 0x36, 0x19, 0x30, 0x5e, 0x22, 0x64, 0x3e, 0x13, 0x7,  0x71, 0x8,  0x0,  0x3,  0xaf, 0x13, 0xca,
                   0x1,  0x75, 0x25, 0x65, 0x21, 0x42, 0x98, 0x28, 0xd4, 0x28, 0x14, 0x0,  0x15, 0xd2, 0x6e, 0x2d, 0xd1,
                   0x9a, 0x69, 0x50, 0x70, 0xc9, 0xd9, 0x6c, 0xc0, 0x1,  0x6c, 0x59, 0xf2, 0xa,  0x24, 0x90, 0x40, 0x74,
                   0xd,  0x0,  0x1d, 0x40, 0x54, 0xb4, 0x5a, 0x99, 0x22, 0x8,  0x1e, 0x38, 0xdf, 0x25, 0xe0, 0x35, 0x7a,
                   0x12, 0x60, 0xaa, 0x15, 0xb3, 0xe0, 0x21, 0xf,  0x99, 0x7d, 0x95, 0x4f, 0xfc, 0xc7, 0xb6, 0xd,  0x0,
                   0x1d, 0x50, 0x19, 0x20, 0xfc, 0x52, 0x41, 0x31, 0x79, 0xe9, 0x3d, 0x51, 0x20, 0xce, 0x55, 0xa1, 0x1a,
                   0x0,  0x53, 0x43, 0x63, 0x76, 0x99, 0x31, 0x6e, 0x84, 0x87, 0x54, 0x8a, 0x4e, 0x2c, 0x0,  0x15, 0xe9,
                   0x32, 0xec, 0x98, 0x40, 0xe5, 0x5a, 0x1e, 0xf7, 0xf9, 0x8e, 0xf1, 0x93, 0xb5, 0xea, 0x7,  0x6c, 0x7d,
                   0xe4, 0xa7, 0x9d, 0x14, 0x0,  0x1c, 0x47, 0xc1, 0x17, 0x98, 0x38, 0x34, 0x48, 0xc,  0x67, 0x32, 0xd7,
                   0xc,  0x12, 0x36, 0xd1, 0x9,  0xd8, 0x78, 0x72, 0xac, 0xe1, 0x3e, 0xf6, 0x45, 0x73, 0x2f, 0x5f, 0xc9,
                   0xc,  0x0,  0x15, 0x1a, 0xa4, 0x71, 0xa8, 0xb4, 0xda, 0xdf, 0xbe, 0xcf, 0x52, 0x55, 0x99, 0xfa, 0xee,
                   0x2b, 0x45, 0xf7, 0xf4, 0xb7, 0xe7, 0xe1, 0x6,  0x0,  0x5,  0xdd, 0x95, 0x41, 0xd3, 0xc3, 0x14};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xd2, 0x6e, 0x2d, 0xd1, 0x9a, 0x69, 0x50, 0x70, 0xc9, 0xd9, 0x6c,
                                     0xc0, 0x1,  0x6c, 0x59, 0xf2, 0xa,  0x24, 0x90, 0x40, 0x74};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x40, 0x54, 0xb4, 0x5a, 0x99, 0x22, 0x8,  0x1e, 0x38, 0xdf,
                                     0x25, 0xe0, 0x35, 0x7a, 0x12, 0x60, 0xaa, 0x15, 0xb3, 0xe0,
                                     0x21, 0xf,  0x99, 0x7d, 0x95, 0x4f, 0xfc, 0xc7, 0xb6};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x50, 0x19, 0x20, 0xfc, 0x52, 0x41, 0x31, 0x79, 0xe9, 0x3d,
                                     0x51, 0x20, 0xce, 0x55, 0xa1, 0x1a, 0x0,  0x53, 0x43, 0x63,
                                     0x76, 0x99, 0x31, 0x6e, 0x84, 0x87, 0x54, 0x8a, 0x4e};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe9, 0x32, 0xec, 0x98, 0x40, 0xe5, 0x5a, 0x1e, 0xf7, 0xf9, 0x8e,
                                     0xf1, 0x93, 0xb5, 0xea, 0x7,  0x6c, 0x7d, 0xe4, 0xa7, 0x9d};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x47, 0xc1, 0x17, 0x98, 0x38, 0x34, 0x48, 0xc,  0x67, 0x32,
                                     0xd7, 0xc,  0x12, 0x36, 0xd1, 0x9,  0xd8, 0x78, 0x72, 0xac,
                                     0xe1, 0x3e, 0xf6, 0x45, 0x73, 0x2f, 0x5f, 0xc9};
  lwmqtt_string_t topic_filter_s4 = {28, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1a, 0xa4, 0x71, 0xa8, 0xb4, 0xda, 0xdf, 0xbe, 0xcf, 0x52, 0x55,
                                     0x99, 0xfa, 0xee, 0x2b, 0x45, 0xf7, 0xf4, 0xb7, 0xe7, 0xe1};
  lwmqtt_string_t topic_filter_s5 = {21, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xdd, 0x95, 0x41, 0xd3, 0xc3};
  lwmqtt_string_t topic_filter_s6 = {5, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[5].retain_as_published = false;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS0;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0x2e, 0x9d, 0x50, 0x5e, 0x80, 0x31, 0xbc, 0xc6, 0x63, 0x32, 0xcd, 0x33,
                           0x73, 0x26, 0x8a, 0xe2, 0x6,  0x1f, 0x81, 0x9b, 0xe8, 0x7e, 0xb7};
  uint8_t bytesprops1[] = {0x1a, 0x41, 0x3e, 0xe7, 0x2,  0xae, 0xf7, 0xef, 0x4e,
                           0x56, 0x45, 0x97, 0xd7, 0x92, 0x1,  0xaf, 0xab, 0x56};
  uint8_t bytesprops2[] = {0x2,  0x86, 0x45, 0xd0, 0x9c, 0xa,  0xdf, 0x2c, 0x51, 0xa6,
                           0xa1, 0x1c, 0x8d, 0xc0, 0xc3, 0xc5, 0x36, 0x19, 0x30, 0x5e};
  uint8_t bytesprops3[] = {0xaf, 0x13, 0xca};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18748}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7310}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18830}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10723}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20286}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25662}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1905}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 117}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17048}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20401, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 8563 [("\143\195\RS\DEL-\129\b/n _",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\152K\195\r\158\128&X\SUB\FSI\163y\128\203\171\SO\227\231K\213\SI&Y\211\EM",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS = QoS2})] [PropContentType
// "\159\206p\152)",PropRequestResponseInformation 253,PropServerKeepAlive 32043,PropResponseInformation
// "[\187&\US\146r\201_\142\185\170\136?.\178,\199\SI^=\EM\178\249AC\245\189",PropResponseTopic
// "%\128\CAN\241",PropServerReference
// "K\165\197\SYN\189\NULX\213\224\230`\146\147\b\129\237\SYN\170\190<\206<)\210\US`\236j",PropMessageExpiryInterval
// 632,PropWillDelayInterval 8614,PropMessageExpiryInterval 1653,PropSessionExpiryInterval 2016,PropRetainAvailable
// 232,PropReasonString "\176\&3\159\243N\167\162V\167 \189\158GE\ETBl\149\189",PropSessionExpiryInterval 21353]
TEST(Subscribe5QCTest, Encode16) {
  uint8_t pkt[] = {0x82, 0xb0, 0x1,  0x21, 0x73, 0x81, 0x1,  0x3,  0x0,  0x5,  0x9f, 0xce, 0x70, 0x98, 0x29, 0x19, 0xfd,
                   0x13, 0x7d, 0x2b, 0x1a, 0x0,  0x1b, 0x5b, 0xbb, 0x26, 0x1f, 0x92, 0x72, 0xc9, 0x5f, 0x8e, 0xb9, 0xaa,
                   0x88, 0x3f, 0x2e, 0xb2, 0x2c, 0xc7, 0xf,  0x5e, 0x3d, 0x19, 0xb2, 0xf9, 0x41, 0x43, 0xf5, 0xbd, 0x8,
                   0x0,  0x4,  0x25, 0x80, 0x18, 0xf1, 0x1c, 0x0,  0x1c, 0x4b, 0xa5, 0xc5, 0x16, 0xbd, 0x0,  0x58, 0xd5,
                   0xe0, 0xe6, 0x60, 0x92, 0x93, 0x8,  0x81, 0xed, 0x16, 0xaa, 0xbe, 0x3c, 0xce, 0x3c, 0x29, 0xd2, 0x1f,
                   0x60, 0xec, 0x6a, 0x2,  0x0,  0x0,  0x2,  0x78, 0x18, 0x0,  0x0,  0x21, 0xa6, 0x2,  0x0,  0x0,  0x6,
                   0x75, 0x11, 0x0,  0x0,  0x7,  0xe0, 0x25, 0xe8, 0x1f, 0x0,  0x12, 0xb0, 0x33, 0x9f, 0xf3, 0x4e, 0xa7,
                   0xa2, 0x56, 0xa7, 0x20, 0xbd, 0x9e, 0x47, 0x45, 0x17, 0x6c, 0x95, 0xbd, 0x11, 0x0,  0x0,  0x53, 0x69,
                   0x0,  0xb,  0x8f, 0xc3, 0x1e, 0x7f, 0x2d, 0x81, 0x8,  0x2f, 0x6e, 0x20, 0x5f, 0x29, 0x0,  0x1a, 0x98,
                   0x4b, 0xc3, 0xd,  0x9e, 0x80, 0x26, 0x58, 0x1a, 0x1c, 0x49, 0xa3, 0x79, 0x80, 0xcb, 0xab, 0xe,  0xe3,
                   0xe7, 0x4b, 0xd5, 0xf,  0x26, 0x59, 0xd3, 0x19, 0x1a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0x8f, 0xc3, 0x1e, 0x7f, 0x2d, 0x81, 0x8, 0x2f, 0x6e, 0x20, 0x5f};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x98, 0x4b, 0xc3, 0xd, 0x9e, 0x80, 0x26, 0x58, 0x1a, 0x1c, 0x49, 0xa3, 0x79,
                                     0x80, 0xcb, 0xab, 0xe, 0xe3, 0xe7, 0x4b, 0xd5, 0xf,  0x26, 0x59, 0xd3, 0x19};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0x9f, 0xce, 0x70, 0x98, 0x29};
  uint8_t bytesprops1[] = {0x5b, 0xbb, 0x26, 0x1f, 0x92, 0x72, 0xc9, 0x5f, 0x8e, 0xb9, 0xaa, 0x88, 0x3f, 0x2e,
                           0xb2, 0x2c, 0xc7, 0xf,  0x5e, 0x3d, 0x19, 0xb2, 0xf9, 0x41, 0x43, 0xf5, 0xbd};
  uint8_t bytesprops2[] = {0x25, 0x80, 0x18, 0xf1};
  uint8_t bytesprops3[] = {0x4b, 0xa5, 0xc5, 0x16, 0xbd, 0x0,  0x58, 0xd5, 0xe0, 0xe6, 0x60, 0x92, 0x93, 0x8,
                           0x81, 0xed, 0x16, 0xaa, 0xbe, 0x3c, 0xce, 0x3c, 0x29, 0xd2, 0x1f, 0x60, 0xec, 0x6a};
  uint8_t bytesprops4[] = {0xb0, 0x33, 0x9f, 0xf3, 0x4e, 0xa7, 0xa2, 0x56, 0xa7,
                           0x20, 0xbd, 0x9e, 0x47, 0x45, 0x17, 0x6c, 0x95, 0xbd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32043}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 632}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8614}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1653}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2016}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 21353}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 8563, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 7682 [("\RS `P\209\153\210\225\236\187\202\241L\148\241X",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\ENQM\221\168\223",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\138\SYN\nG\DC3\GS\189\169\136\188\248~1A\160\133\254\212)\197\\",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("X\218\142\219\222C\214\142\ETX\209]-\202k\ESC\146h\161m\207",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\165\153\b\146/\NUL\131\v\215\&9=O\238-\235\DLEg\161@\SYN\ENQ\bZ\163\223\185z",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\201'\162\130h\150\158/\184\FS\131\156\251",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS0})] [PropPayloadFormatIndicator
// 188,PropAuthenticationMethod "\215\201\189\244\208",PropMessageExpiryInterval 7937,PropSubscriptionIdentifier
// 15,PropAuthenticationMethod
// "\200\US\253\244\NAK\155\243r\188\246\211\FS\179\NUL\179U\216]\179\144\EM\237\181MO\218\213\255K\205",PropWillDelayInterval
// 28417,PropServerKeepAlive 21564,PropServerReference "\249\248\176S\225\188\133\136\255\157\176",PropMaximumQoS
// 201,PropSubscriptionIdentifierAvailable 153,PropTopicAliasMaximum 29985]
TEST(Subscribe5QCTest, Encode17) {
  uint8_t pkt[] = {
      0x82, 0xca, 0x1,  0x1e, 0x2,  0x4f, 0x1,  0xbc, 0x15, 0x0,  0x5,  0xd7, 0xc9, 0xbd, 0xf4, 0xd0, 0x2,  0x0,  0x0,
      0x1f, 0x1,  0xb,  0xf,  0x15, 0x0,  0x1e, 0xc8, 0x1f, 0xfd, 0xf4, 0x15, 0x9b, 0xf3, 0x72, 0xbc, 0xf6, 0xd3, 0x1c,
      0xb3, 0x0,  0xb3, 0x55, 0xd8, 0x5d, 0xb3, 0x90, 0x19, 0xed, 0xb5, 0x4d, 0x4f, 0xda, 0xd5, 0xff, 0x4b, 0xcd, 0x18,
      0x0,  0x0,  0x6f, 0x1,  0x13, 0x54, 0x3c, 0x1c, 0x0,  0xb,  0xf9, 0xf8, 0xb0, 0x53, 0xe1, 0xbc, 0x85, 0x88, 0xff,
      0x9d, 0xb0, 0x24, 0xc9, 0x29, 0x99, 0x22, 0x75, 0x21, 0x0,  0x10, 0x1e, 0x20, 0x60, 0x50, 0xd1, 0x99, 0xd2, 0xe1,
      0xec, 0xbb, 0xca, 0xf1, 0x4c, 0x94, 0xf1, 0x58, 0x16, 0x0,  0x5,  0x5,  0x4d, 0xdd, 0xa8, 0xdf, 0x24, 0x0,  0x15,
      0x8a, 0x16, 0xa,  0x47, 0x13, 0x1d, 0xbd, 0xa9, 0x88, 0xbc, 0xf8, 0x7e, 0x31, 0x41, 0xa0, 0x85, 0xfe, 0xd4, 0x29,
      0xc5, 0x5c, 0x20, 0x0,  0x14, 0x58, 0xda, 0x8e, 0xdb, 0xde, 0x43, 0xd6, 0x8e, 0x3,  0xd1, 0x5d, 0x2d, 0xca, 0x6b,
      0x1b, 0x92, 0x68, 0xa1, 0x6d, 0xcf, 0x6,  0x0,  0x1b, 0xa5, 0x99, 0x8,  0x92, 0x2f, 0x0,  0x83, 0xb,  0xd7, 0x39,
      0x3d, 0x4f, 0xee, 0x2d, 0xeb, 0x10, 0x67, 0xa1, 0x40, 0x16, 0x5,  0x8,  0x5a, 0xa3, 0xdf, 0xb9, 0x7a, 0x2c, 0x0,
      0xd,  0xc9, 0x27, 0xa2, 0x82, 0x68, 0x96, 0x9e, 0x2f, 0xb8, 0x1c, 0x83, 0x9c, 0xfb, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x1e, 0x20, 0x60, 0x50, 0xd1, 0x99, 0xd2, 0xe1,
                                     0xec, 0xbb, 0xca, 0xf1, 0x4c, 0x94, 0xf1, 0x58};
  lwmqtt_string_t topic_filter_s0 = {16, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5, 0x4d, 0xdd, 0xa8, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {5, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x8a, 0x16, 0xa,  0x47, 0x13, 0x1d, 0xbd, 0xa9, 0x88, 0xbc, 0xf8,
                                     0x7e, 0x31, 0x41, 0xa0, 0x85, 0xfe, 0xd4, 0x29, 0xc5, 0x5c};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x58, 0xda, 0x8e, 0xdb, 0xde, 0x43, 0xd6, 0x8e, 0x3,  0xd1,
                                     0x5d, 0x2d, 0xca, 0x6b, 0x1b, 0x92, 0x68, 0xa1, 0x6d, 0xcf};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa5, 0x99, 0x8,  0x92, 0x2f, 0x0,  0x83, 0xb, 0xd7, 0x39, 0x3d, 0x4f, 0xee, 0x2d,
                                     0xeb, 0x10, 0x67, 0xa1, 0x40, 0x16, 0x5,  0x8, 0x5a, 0xa3, 0xdf, 0xb9, 0x7a};
  lwmqtt_string_t topic_filter_s4 = {27, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc9, 0x27, 0xa2, 0x82, 0x68, 0x96, 0x9e, 0x2f, 0xb8, 0x1c, 0x83, 0x9c, 0xfb};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0xd7, 0xc9, 0xbd, 0xf4, 0xd0};
  uint8_t bytesprops1[] = {0xc8, 0x1f, 0xfd, 0xf4, 0x15, 0x9b, 0xf3, 0x72, 0xbc, 0xf6, 0xd3, 0x1c, 0xb3, 0x0,  0xb3,
                           0x55, 0xd8, 0x5d, 0xb3, 0x90, 0x19, 0xed, 0xb5, 0x4d, 0x4f, 0xda, 0xd5, 0xff, 0x4b, 0xcd};
  uint8_t bytesprops2[] = {0xf9, 0xf8, 0xb0, 0x53, 0xe1, 0xbc, 0x85, 0x88, 0xff, 0x9d, 0xb0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 7937}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 15}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28417}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21564}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {11, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29985}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7682, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 9224 [("\199\229\146\190\EOT\224",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\238\163\ETB\179[\253\146N.\169\223$\202\251\ENQ\183\191\183`\165\135\152f-qP\201\189\SUB",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("f\133\252\176\189\165",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS0}),("ai\ETX\141\131P\247\191\147\143",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropMaximumQoS 210,PropWillDelayInterval
// 8103,PropUserProperty "\159\161:\170\151\205"
// "\ETB\139\222\ENQ\141\251\198\192\152nA\DC4\237\199x\240\&7\234Oz",PropMaximumPacketSize 25020,PropContentType
// "\199e\202`\233\172\"\155\187\253\220md}Z\225\\\135",PropContentType
// "V\187\154$EZ\243\208=\203\150\223A\153\223\209\131\235\SUB\n\208",PropCorrelationData "\219",PropMaximumQoS
// 103,PropRequestProblemInformation 63,PropMessageExpiryInterval 13825,PropResponseInformation "\190\207s
// #\164\DC4\239\145\252\183\195\206\165G\249\131\215\157\173",PropAssignedClientIdentifier
// "A\ENQ\174>\187i\165\ENQ\164\179F\DEL\166N;L\242\&1\229\196A\173\142\162k\142\&2\rB6",PropRequestResponseInformation
// 84,PropServerReference "L\167\&3k\206GU4)",PropPayloadFormatIndicator 37,PropMessageExpiryInterval
// 31778,PropRequestProblemInformation 119,PropWildcardSubscriptionAvailable 150,PropUserProperty
// "\132\218\239\163T;j\181\143\179`" "\255(UW\194\194\187\251W"]
TEST(Subscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0x82, 0x92, 0x2,  0x24, 0x8,  0xcf, 0x1,  0x24, 0xd2, 0x18, 0x0,  0x0,  0x1f, 0xa7, 0x26, 0x0,  0x6,  0x9f, 0xa1,
      0x3a, 0xaa, 0x97, 0xcd, 0x0,  0x14, 0x17, 0x8b, 0xde, 0x5,  0x8d, 0xfb, 0xc6, 0xc0, 0x98, 0x6e, 0x41, 0x14, 0xed,
      0xc7, 0x78, 0xf0, 0x37, 0xea, 0x4f, 0x7a, 0x27, 0x0,  0x0,  0x61, 0xbc, 0x3,  0x0,  0x12, 0xc7, 0x65, 0xca, 0x60,
      0xe9, 0xac, 0x22, 0x9b, 0xbb, 0xfd, 0xdc, 0x6d, 0x64, 0x7d, 0x5a, 0xe1, 0x5c, 0x87, 0x3,  0x0,  0x15, 0x56, 0xbb,
      0x9a, 0x24, 0x45, 0x5a, 0xf3, 0xd0, 0x3d, 0xcb, 0x96, 0xdf, 0x41, 0x99, 0xdf, 0xd1, 0x83, 0xeb, 0x1a, 0xa,  0xd0,
      0x9,  0x0,  0x1,  0xdb, 0x24, 0x67, 0x17, 0x3f, 0x2,  0x0,  0x0,  0x36, 0x1,  0x1a, 0x0,  0x14, 0xbe, 0xcf, 0x73,
      0x20, 0x23, 0xa4, 0x14, 0xef, 0x91, 0xfc, 0xb7, 0xc3, 0xce, 0xa5, 0x47, 0xf9, 0x83, 0xd7, 0x9d, 0xad, 0x12, 0x0,
      0x1e, 0x41, 0x5,  0xae, 0x3e, 0xbb, 0x69, 0xa5, 0x5,  0xa4, 0xb3, 0x46, 0x7f, 0xa6, 0x4e, 0x3b, 0x4c, 0xf2, 0x31,
      0xe5, 0xc4, 0x41, 0xad, 0x8e, 0xa2, 0x6b, 0x8e, 0x32, 0xd,  0x42, 0x36, 0x19, 0x54, 0x1c, 0x0,  0x9,  0x4c, 0xa7,
      0x33, 0x6b, 0xce, 0x47, 0x55, 0x34, 0x29, 0x1,  0x25, 0x2,  0x0,  0x0,  0x7c, 0x22, 0x17, 0x77, 0x28, 0x96, 0x26,
      0x0,  0xb,  0x84, 0xda, 0xef, 0xa3, 0x54, 0x3b, 0x6a, 0xb5, 0x8f, 0xb3, 0x60, 0x0,  0x9,  0xff, 0x28, 0x55, 0x57,
      0xc2, 0xc2, 0xbb, 0xfb, 0x57, 0x0,  0x6,  0xc7, 0xe5, 0x92, 0xbe, 0x4,  0xe0, 0x1c, 0x0,  0x1d, 0xee, 0xa3, 0x17,
      0xb3, 0x5b, 0xfd, 0x92, 0x4e, 0x2e, 0xa9, 0xdf, 0x24, 0xca, 0xfb, 0x5,  0xb7, 0xbf, 0xb7, 0x60, 0xa5, 0x87, 0x98,
      0x66, 0x2d, 0x71, 0x50, 0xc9, 0xbd, 0x1a, 0x5,  0x0,  0x6,  0x66, 0x85, 0xfc, 0xb0, 0xbd, 0xa5, 0x24, 0x0,  0xa,
      0x61, 0x69, 0x3,  0x8d, 0x83, 0x50, 0xf7, 0xbf, 0x93, 0x8f, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xc7, 0xe5, 0x92, 0xbe, 0x4, 0xe0};
  lwmqtt_string_t topic_filter_s0 = {6, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xee, 0xa3, 0x17, 0xb3, 0x5b, 0xfd, 0x92, 0x4e, 0x2e, 0xa9,
                                     0xdf, 0x24, 0xca, 0xfb, 0x5,  0xb7, 0xbf, 0xb7, 0x60, 0xa5,
                                     0x87, 0x98, 0x66, 0x2d, 0x71, 0x50, 0xc9, 0xbd, 0x1a};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x66, 0x85, 0xfc, 0xb0, 0xbd, 0xa5};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x61, 0x69, 0x3, 0x8d, 0x83, 0x50, 0xf7, 0xbf, 0x93, 0x8f};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  uint8_t bytesprops1[] = {0x17, 0x8b, 0xde, 0x5,  0x8d, 0xfb, 0xc6, 0xc0, 0x98, 0x6e,
                           0x41, 0x14, 0xed, 0xc7, 0x78, 0xf0, 0x37, 0xea, 0x4f, 0x7a};
  uint8_t bytesprops0[] = {0x9f, 0xa1, 0x3a, 0xaa, 0x97, 0xcd};
  uint8_t bytesprops2[] = {0xc7, 0x65, 0xca, 0x60, 0xe9, 0xac, 0x22, 0x9b, 0xbb,
                           0xfd, 0xdc, 0x6d, 0x64, 0x7d, 0x5a, 0xe1, 0x5c, 0x87};
  uint8_t bytesprops3[] = {0x56, 0xbb, 0x9a, 0x24, 0x45, 0x5a, 0xf3, 0xd0, 0x3d, 0xcb, 0x96,
                           0xdf, 0x41, 0x99, 0xdf, 0xd1, 0x83, 0xeb, 0x1a, 0xa,  0xd0};
  uint8_t bytesprops4[] = {0xdb};
  uint8_t bytesprops5[] = {0xbe, 0xcf, 0x73, 0x20, 0x23, 0xa4, 0x14, 0xef, 0x91, 0xfc,
                           0xb7, 0xc3, 0xce, 0xa5, 0x47, 0xf9, 0x83, 0xd7, 0x9d, 0xad};
  uint8_t bytesprops6[] = {0x41, 0x5,  0xae, 0x3e, 0xbb, 0x69, 0xa5, 0x5,  0xa4, 0xb3, 0x46, 0x7f, 0xa6, 0x4e, 0x3b,
                           0x4c, 0xf2, 0x31, 0xe5, 0xc4, 0x41, 0xad, 0x8e, 0xa2, 0x6b, 0x8e, 0x32, 0xd,  0x42, 0x36};
  uint8_t bytesprops7[] = {0x4c, 0xa7, 0x33, 0x6b, 0xce, 0x47, 0x55, 0x34, 0x29};
  uint8_t bytesprops9[] = {0xff, 0x28, 0x55, 0x57, 0xc2, 0xc2, 0xbb, 0xfb, 0x57};
  uint8_t bytesprops8[] = {0x84, 0xda, 0xef, 0xa3, 0x54, 0x3b, 0x6a, 0xb5, 0x8f, 0xb3, 0x60};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8103}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops0}, .v = {20, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25020}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13825}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 84}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31778}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops8}, .v = {9, (char*)&bytesprops9}}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 9224, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 14508 [("R\USc\174\228\248\201\SYN\DC3\248\&2<h@3\163Jo\255\ETB4\159\159\EOTr\244`",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("kDT\132\249\207\190\139\253\141.o\143\143\250z\240\136}\212o\DC3S\151?\164\147",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\160\147#\236\207[\200:`c",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS2}),("\152\v\231pTA\206\241\SO\ENQF\176\150\170\135",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS0})] [PropSessionExpiryInterval
// 4025,PropWildcardSubscriptionAvailable 32,PropServerKeepAlive 14359,PropResponseTopic "\165\252",PropTopicAlias
// 9555,PropReceiveMaximum 28908,PropServerReference "*\bQ",PropReasonString
// "\252\149\229uj\238\251\128\238@1\235\195\202\DC4,|\GS",PropUserProperty "" "_\130\203\198\218\138\&3\156q1
// \194\135\248\146\DLE"]
TEST(Subscribe5QCTest, Encode19) {
  uint8_t pkt[] = {0x82, 0xa3, 0x1,  0x38, 0xac, 0x45, 0x11, 0x0,  0x0,  0xf,  0xb9, 0x28, 0x20, 0x13, 0x38, 0x17, 0x8,
                   0x0,  0x2,  0xa5, 0xfc, 0x23, 0x25, 0x53, 0x21, 0x70, 0xec, 0x1c, 0x0,  0x3,  0x2a, 0x8,  0x51, 0x1f,
                   0x0,  0x12, 0xfc, 0x95, 0xe5, 0x75, 0x6a, 0xee, 0xfb, 0x80, 0xee, 0x40, 0x31, 0xeb, 0xc3, 0xca, 0x14,
                   0x2c, 0x7c, 0x1d, 0x26, 0x0,  0x0,  0x0,  0x10, 0x5f, 0x82, 0xcb, 0xc6, 0xda, 0x8a, 0x33, 0x9c, 0x71,
                   0x31, 0x20, 0xc2, 0x87, 0xf8, 0x92, 0x10, 0x0,  0x1b, 0x52, 0x1f, 0x63, 0xae, 0xe4, 0xf8, 0xc9, 0x16,
                   0x13, 0xf8, 0x32, 0x3c, 0x68, 0x40, 0x33, 0xa3, 0x4a, 0x6f, 0xff, 0x17, 0x34, 0x9f, 0x9f, 0x4,  0x72,
                   0xf4, 0x60, 0x22, 0x0,  0x1b, 0x6b, 0x44, 0x54, 0x84, 0xf9, 0xcf, 0xbe, 0x8b, 0xfd, 0x8d, 0x2e, 0x6f,
                   0x8f, 0x8f, 0xfa, 0x7a, 0xf0, 0x88, 0x7d, 0xd4, 0x6f, 0x13, 0x53, 0x97, 0x3f, 0xa4, 0x93, 0xa,  0x0,
                   0xa,  0xa0, 0x93, 0x23, 0xec, 0xcf, 0x5b, 0xc8, 0x3a, 0x60, 0x63, 0x26, 0x0,  0xf,  0x98, 0xb,  0xe7,
                   0x70, 0x54, 0x41, 0xce, 0xf1, 0xe,  0x5,  0x46, 0xb0, 0x96, 0xaa, 0x87, 0x4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x52, 0x1f, 0x63, 0xae, 0xe4, 0xf8, 0xc9, 0x16, 0x13, 0xf8, 0x32, 0x3c, 0x68, 0x40,
                                     0x33, 0xa3, 0x4a, 0x6f, 0xff, 0x17, 0x34, 0x9f, 0x9f, 0x4,  0x72, 0xf4, 0x60};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6b, 0x44, 0x54, 0x84, 0xf9, 0xcf, 0xbe, 0x8b, 0xfd, 0x8d, 0x2e, 0x6f, 0x8f, 0x8f,
                                     0xfa, 0x7a, 0xf0, 0x88, 0x7d, 0xd4, 0x6f, 0x13, 0x53, 0x97, 0x3f, 0xa4, 0x93};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa0, 0x93, 0x23, 0xec, 0xcf, 0x5b, 0xc8, 0x3a, 0x60, 0x63};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x98, 0xb, 0xe7, 0x70, 0x54, 0x41, 0xce, 0xf1,
                                     0xe,  0x5, 0x46, 0xb0, 0x96, 0xaa, 0x87};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  lwmqtt_sub_options_t sub_opts[4];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  uint8_t bytesprops0[] = {0xa5, 0xfc};
  uint8_t bytesprops1[] = {0x2a, 0x8, 0x51};
  uint8_t bytesprops2[] = {0xfc, 0x95, 0xe5, 0x75, 0x6a, 0xee, 0xfb, 0x80, 0xee,
                           0x40, 0x31, 0xeb, 0xc3, 0xca, 0x14, 0x2c, 0x7c, 0x1d};
  uint8_t bytesprops4[] = {0x5f, 0x82, 0xcb, 0xc6, 0xda, 0x8a, 0x33, 0x9c,
                           0x71, 0x31, 0x20, 0xc2, 0x87, 0xf8, 0x92, 0x10};
  uint8_t bytesprops3[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 4025}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 32}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14359}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9555}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28908}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops3}, .v = {16, (char*)&bytesprops4}}}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14508, 4, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 24389 [("\255L)[J\CAN\t\240\&1\138\n",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS = QoS0}),("\230\203\206\212\216\253-\EOT\b\248<",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0})]
// [PropServerKeepAlive 20334,PropRequestProblemInformation 235,PropSubscriptionIdentifier 27,PropRetainAvailable
// 7,PropPayloadFormatIndicator 25,PropAuthenticationData "`\155",PropResponseTopic "J\132^$",PropSubscriptionIdentifier
// 12,PropCorrelationData
// "\155@\152\SOHV;\SYN\155\&8m\"\213\154N\207+\254\179P\128\213\ENQ\209?\232P1\187\187",PropTopicAlias
// 9652,PropPayloadFormatIndicator 245,PropResponseInformation "",PropPayloadFormatIndicator 152,PropTopicAlias
// 23632,PropWildcardSubscriptionAvailable 49,PropRequestProblemInformation 208,PropCorrelationData
// "|\EM\186mXWwA\178\169\SYN\205\NUL\180\252G\251\157+\STX\186",PropMaximumQoS 114,PropServerKeepAlive
// 3725,PropWildcardSubscriptionAvailable 127,PropAuthenticationMethod
// "^\177\129\138\159\129]\NUL\129\215\181\EOT2\253\ACK\241\&3\179\195\"GKO+>\128\ENQ5",PropServerKeepAlive
// 17385,PropSubscriptionIdentifierAvailable 202,PropUserProperty
// "\251\CAN\177\245\143~JIPS<\205\148\212\199\249\223\133\151_\\>\245\215" "+",PropCorrelationData
// "\ACK\SO\222A\ACK\197#\215?\128\157\226L1",PropReceiveMaximum 8463,PropSubscriptionIdentifierAvailable 254]
TEST(Subscribe5QCTest, Encode20) {
  uint8_t pkt[] = {
      0x82, 0xe1, 0x1,  0x5f, 0x45, 0xc1, 0x1,  0x13, 0x4f, 0x6e, 0x17, 0xeb, 0xb,  0x1b, 0x25, 0x7,  0x1,  0x19, 0x16,
      0x0,  0x2,  0x60, 0x9b, 0x8,  0x0,  0x4,  0x4a, 0x84, 0x5e, 0x24, 0xb,  0xc,  0x9,  0x0,  0x1d, 0x9b, 0x40, 0x98,
      0x1,  0x56, 0x3b, 0x16, 0x9b, 0x38, 0x6d, 0x22, 0xd5, 0x9a, 0x4e, 0xcf, 0x2b, 0xfe, 0xb3, 0x50, 0x80, 0xd5, 0x5,
      0xd1, 0x3f, 0xe8, 0x50, 0x31, 0xbb, 0xbb, 0x23, 0x25, 0xb4, 0x1,  0xf5, 0x1a, 0x0,  0x0,  0x1,  0x98, 0x23, 0x5c,
      0x50, 0x28, 0x31, 0x17, 0xd0, 0x9,  0x0,  0x15, 0x7c, 0x19, 0xba, 0x6d, 0x58, 0x57, 0x77, 0x41, 0xb2, 0xa9, 0x16,
      0xcd, 0x0,  0xb4, 0xfc, 0x47, 0xfb, 0x9d, 0x2b, 0x2,  0xba, 0x24, 0x72, 0x13, 0xe,  0x8d, 0x28, 0x7f, 0x15, 0x0,
      0x1c, 0x5e, 0xb1, 0x81, 0x8a, 0x9f, 0x81, 0x5d, 0x0,  0x81, 0xd7, 0xb5, 0x4,  0x32, 0xfd, 0x6,  0xf1, 0x33, 0xb3,
      0xc3, 0x22, 0x47, 0x4b, 0x4f, 0x2b, 0x3e, 0x80, 0x5,  0x35, 0x13, 0x43, 0xe9, 0x29, 0xca, 0x26, 0x0,  0x18, 0xfb,
      0x18, 0xb1, 0xf5, 0x8f, 0x7e, 0x4a, 0x49, 0x50, 0x53, 0x3c, 0xcd, 0x94, 0xd4, 0xc7, 0xf9, 0xdf, 0x85, 0x97, 0x5f,
      0x5c, 0x3e, 0xf5, 0xd7, 0x0,  0x1,  0x2b, 0x9,  0x0,  0xe,  0x6,  0xe,  0xde, 0x41, 0x6,  0xc5, 0x23, 0xd7, 0x3f,
      0x80, 0x9d, 0xe2, 0x4c, 0x31, 0x21, 0x21, 0xf,  0x29, 0xfe, 0x0,  0xb,  0xff, 0x4c, 0x29, 0x5b, 0x4a, 0x18, 0x9,
      0xf0, 0x31, 0x8a, 0xa,  0x4,  0x0,  0xb,  0xe6, 0xcb, 0xce, 0xd4, 0xd8, 0xfd, 0x2d, 0x4,  0x8,  0xf8, 0x3c, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xff, 0x4c, 0x29, 0x5b, 0x4a, 0x18, 0x9, 0xf0, 0x31, 0x8a, 0xa};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe6, 0xcb, 0xce, 0xd4, 0xd8, 0xfd, 0x2d, 0x4, 0x8, 0xf8, 0x3c};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  lwmqtt_sub_options_t sub_opts[2];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  uint8_t bytesprops0[] = {0x60, 0x9b};
  uint8_t bytesprops1[] = {0x4a, 0x84, 0x5e, 0x24};
  uint8_t bytesprops2[] = {0x9b, 0x40, 0x98, 0x1,  0x56, 0x3b, 0x16, 0x9b, 0x38, 0x6d, 0x22, 0xd5, 0x9a, 0x4e, 0xcf,
                           0x2b, 0xfe, 0xb3, 0x50, 0x80, 0xd5, 0x5,  0xd1, 0x3f, 0xe8, 0x50, 0x31, 0xbb, 0xbb};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0x7c, 0x19, 0xba, 0x6d, 0x58, 0x57, 0x77, 0x41, 0xb2, 0xa9, 0x16,
                           0xcd, 0x0,  0xb4, 0xfc, 0x47, 0xfb, 0x9d, 0x2b, 0x2,  0xba};
  uint8_t bytesprops5[] = {0x5e, 0xb1, 0x81, 0x8a, 0x9f, 0x81, 0x5d, 0x0,  0x81, 0xd7, 0xb5, 0x4,  0x32, 0xfd,
                           0x6,  0xf1, 0x33, 0xb3, 0xc3, 0x22, 0x47, 0x4b, 0x4f, 0x2b, 0x3e, 0x80, 0x5,  0x35};
  uint8_t bytesprops7[] = {0x2b};
  uint8_t bytesprops6[] = {0xfb, 0x18, 0xb1, 0xf5, 0x8f, 0x7e, 0x4a, 0x49, 0x50, 0x53, 0x3c, 0xcd,
                           0x94, 0xd4, 0xc7, 0xf9, 0xdf, 0x85, 0x97, 0x5f, 0x5c, 0x3e, 0xf5, 0xd7};
  uint8_t bytesprops8[] = {0x6, 0xe, 0xde, 0x41, 0x6, 0xc5, 0x23, 0xd7, 0x3f, 0x80, 0x9d, 0xe2, 0x4c, 0x31};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20334}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 12}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9652}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 245}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23632}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 208}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 114}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3725}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17385}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 202}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops6}, .v = {1, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {14, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8463}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 254}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24389, 2, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 10907 [("A\162\160\180\204w=\RSRuY\179\226\193\241M\SI_\205\144\150\163\229E\232\a\173",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("I?\215\128q+\210",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal =
// True, _subQoS = QoS1}),("\156\203A\181",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = False, _subQoS =
// QoS1}),("f,u\248\196\253Ec\136\146a\182D\192\SO\206\128\EMS\198~\227\179\225\&5\190\200",SubOptions {_retainHandling
// = SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\160\250\NAK\133R\172\224\SUB*\176\204\145",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropReasonString
// "\"\132\239\185\EM=GD\248",PropCorrelationData "\NAK\184\206`\149$r;\241\138[ @\154\212n\SUB",PropTopicAlias
// 8966,PropWildcardSubscriptionAvailable 182,PropServerKeepAlive 9665,PropReceiveMaximum 23172,PropReasonString
// "\218,\176x\185\221\ESCd\241tN\131C\DC1\243\236\NULZo\183\243\184\238 \135\213SU\188",PropPayloadFormatIndicator
// 37,PropSubscriptionIdentifier 29,PropReceiveMaximum 17073,PropSessionExpiryInterval
// 6868,PropRequestProblemInformation 43,PropResponseTopic
// "\134g\196\DC1\187=D\nV\173\217\NAK\CAN\245\156\207E<\197\141t\140",PropCorrelationData
// "\144|\146\138o<\145UT\249",PropUserProperty "\162A\184\253\&4\245\225\165\NUL\238\a0\212\163\190W\230"
// "\183\154\155e\ETX\178\v\DC1:\247\230N\237 4B\fu\254\170v\138\240\229B",PropWillDelayInterval 8733,PropContentType
// "\222Dx\"\239\203@\163k/\192qs\149@\226c\DC46\252\175",PropMessageExpiryInterval 25434,PropMessageExpiryInterval
// 9677,PropTopicAlias 7911,PropMaximumPacketSize 7439,PropSubscriptionIdentifier 21,PropContentType
// "\172\191",PropAuthenticationData "\206\229\163T\203",PropMaximumPacketSize 29860,PropUserProperty
// "\195\b<F4\248v\168\166\DC4U'azCW?\186j\192" "R\178bsB\220B\249\190\204_\215\156",PropResponseInformation
// "\163\230}C\EM1+\208\185N\242F\\\234\234\&9E\243\248\166(n\188\DC3\245B\168",PropRequestResponseInformation
// 72,PropSessionExpiryInterval 10596]
TEST(Subscribe5QCTest, Encode21) {
  uint8_t pkt[] = {
      0x82, 0x9c, 0x3,  0x2a, 0x9b, 0xbc, 0x2,  0x1f, 0x0,  0x9,  0x22, 0x84, 0xef, 0xb9, 0x19, 0x3d, 0x47, 0x44, 0xf8,
      0x9,  0x0,  0x11, 0x15, 0xb8, 0xce, 0x60, 0x95, 0x24, 0x72, 0x3b, 0xf1, 0x8a, 0x5b, 0x20, 0x40, 0x9a, 0xd4, 0x6e,
      0x1a, 0x23, 0x23, 0x6,  0x28, 0xb6, 0x13, 0x25, 0xc1, 0x21, 0x5a, 0x84, 0x1f, 0x0,  0x1d, 0xda, 0x2c, 0xb0, 0x78,
      0xb9, 0xdd, 0x1b, 0x64, 0xf1, 0x74, 0x4e, 0x83, 0x43, 0x11, 0xf3, 0xec, 0x0,  0x5a, 0x6f, 0xb7, 0xf3, 0xb8, 0xee,
      0x20, 0x87, 0xd5, 0x53, 0x55, 0xbc, 0x1,  0x25, 0xb,  0x1d, 0x21, 0x42, 0xb1, 0x11, 0x0,  0x0,  0x1a, 0xd4, 0x17,
      0x2b, 0x8,  0x0,  0x16, 0x86, 0x67, 0xc4, 0x11, 0xbb, 0x3d, 0x44, 0xa,  0x56, 0xad, 0xd9, 0x15, 0x18, 0xf5, 0x9c,
      0xcf, 0x45, 0x3c, 0xc5, 0x8d, 0x74, 0x8c, 0x9,  0x0,  0xa,  0x90, 0x7c, 0x92, 0x8a, 0x6f, 0x3c, 0x91, 0x55, 0x54,
      0xf9, 0x26, 0x0,  0x11, 0xa2, 0x41, 0xb8, 0xfd, 0x34, 0xf5, 0xe1, 0xa5, 0x0,  0xee, 0x7,  0x30, 0xd4, 0xa3, 0xbe,
      0x57, 0xe6, 0x0,  0x19, 0xb7, 0x9a, 0x9b, 0x65, 0x3,  0xb2, 0xb,  0x11, 0x3a, 0xf7, 0xe6, 0x4e, 0xed, 0x20, 0x34,
      0x42, 0xc,  0x75, 0xfe, 0xaa, 0x76, 0x8a, 0xf0, 0xe5, 0x42, 0x18, 0x0,  0x0,  0x22, 0x1d, 0x3,  0x0,  0x15, 0xde,
      0x44, 0x78, 0x22, 0xef, 0xcb, 0x40, 0xa3, 0x6b, 0x2f, 0xc0, 0x71, 0x73, 0x95, 0x40, 0xe2, 0x63, 0x14, 0x36, 0xfc,
      0xaf, 0x2,  0x0,  0x0,  0x63, 0x5a, 0x2,  0x0,  0x0,  0x25, 0xcd, 0x23, 0x1e, 0xe7, 0x27, 0x0,  0x0,  0x1d, 0xf,
      0xb,  0x15, 0x3,  0x0,  0x2,  0xac, 0xbf, 0x16, 0x0,  0x5,  0xce, 0xe5, 0xa3, 0x54, 0xcb, 0x27, 0x0,  0x0,  0x74,
      0xa4, 0x26, 0x0,  0x14, 0xc3, 0x8,  0x3c, 0x46, 0x34, 0xf8, 0x76, 0xa8, 0xa6, 0x14, 0x55, 0x27, 0x61, 0x7a, 0x43,
      0x57, 0x3f, 0xba, 0x6a, 0xc0, 0x0,  0xd,  0x52, 0xb2, 0x62, 0x73, 0x42, 0xdc, 0x42, 0xf9, 0xbe, 0xcc, 0x5f, 0xd7,
      0x9c, 0x1a, 0x0,  0x1b, 0xa3, 0xe6, 0x7d, 0x43, 0x19, 0x31, 0x2b, 0xd0, 0xb9, 0x4e, 0xf2, 0x46, 0x5c, 0xea, 0xea,
      0x39, 0x45, 0xf3, 0xf8, 0xa6, 0x28, 0x6e, 0xbc, 0x13, 0xf5, 0x42, 0xa8, 0x19, 0x48, 0x11, 0x0,  0x0,  0x29, 0x64,
      0x0,  0x1b, 0x41, 0xa2, 0xa0, 0xb4, 0xcc, 0x77, 0x3d, 0x1e, 0x52, 0x75, 0x59, 0xb3, 0xe2, 0xc1, 0xf1, 0x4d, 0xf,
      0x5f, 0xcd, 0x90, 0x96, 0xa3, 0xe5, 0x45, 0xe8, 0x7,  0xad, 0x12, 0x0,  0x7,  0x49, 0x3f, 0xd7, 0x80, 0x71, 0x2b,
      0xd2, 0x25, 0x0,  0x4,  0x9c, 0xcb, 0x41, 0xb5, 0x29, 0x0,  0x1b, 0x66, 0x2c, 0x75, 0xf8, 0xc4, 0xfd, 0x45, 0x63,
      0x88, 0x92, 0x61, 0xb6, 0x44, 0xc0, 0xe,  0xce, 0x80, 0x19, 0x53, 0xc6, 0x7e, 0xe3, 0xb3, 0xe1, 0x35, 0xbe, 0xc8,
      0x4,  0x0,  0xc,  0xa0, 0xfa, 0x15, 0x85, 0x52, 0xac, 0xe0, 0x1a, 0x2a, 0xb0, 0xcc, 0x91, 0xe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x41, 0xa2, 0xa0, 0xb4, 0xcc, 0x77, 0x3d, 0x1e, 0x52, 0x75, 0x59, 0xb3, 0xe2, 0xc1,
                                     0xf1, 0x4d, 0xf,  0x5f, 0xcd, 0x90, 0x96, 0xa3, 0xe5, 0x45, 0xe8, 0x7,  0xad};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x49, 0x3f, 0xd7, 0x80, 0x71, 0x2b, 0xd2};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x9c, 0xcb, 0x41, 0xb5};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x66, 0x2c, 0x75, 0xf8, 0xc4, 0xfd, 0x45, 0x63, 0x88, 0x92, 0x61, 0xb6, 0x44, 0xc0,
                                     0xe,  0xce, 0x80, 0x19, 0x53, 0xc6, 0x7e, 0xe3, 0xb3, 0xe1, 0x35, 0xbe, 0xc8};
  lwmqtt_string_t topic_filter_s3 = {27, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa0, 0xfa, 0x15, 0x85, 0x52, 0xac, 0xe0, 0x1a, 0x2a, 0xb0, 0xcc, 0x91};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = true;
  uint8_t bytesprops0[] = {0x22, 0x84, 0xef, 0xb9, 0x19, 0x3d, 0x47, 0x44, 0xf8};
  uint8_t bytesprops1[] = {0x15, 0xb8, 0xce, 0x60, 0x95, 0x24, 0x72, 0x3b, 0xf1,
                           0x8a, 0x5b, 0x20, 0x40, 0x9a, 0xd4, 0x6e, 0x1a};
  uint8_t bytesprops2[] = {0xda, 0x2c, 0xb0, 0x78, 0xb9, 0xdd, 0x1b, 0x64, 0xf1, 0x74, 0x4e, 0x83, 0x43, 0x11, 0xf3,
                           0xec, 0x0,  0x5a, 0x6f, 0xb7, 0xf3, 0xb8, 0xee, 0x20, 0x87, 0xd5, 0x53, 0x55, 0xbc};
  uint8_t bytesprops3[] = {0x86, 0x67, 0xc4, 0x11, 0xbb, 0x3d, 0x44, 0xa,  0x56, 0xad, 0xd9,
                           0x15, 0x18, 0xf5, 0x9c, 0xcf, 0x45, 0x3c, 0xc5, 0x8d, 0x74, 0x8c};
  uint8_t bytesprops4[] = {0x90, 0x7c, 0x92, 0x8a, 0x6f, 0x3c, 0x91, 0x55, 0x54, 0xf9};
  uint8_t bytesprops6[] = {0xb7, 0x9a, 0x9b, 0x65, 0x3,  0xb2, 0xb,  0x11, 0x3a, 0xf7, 0xe6, 0x4e, 0xed,
                           0x20, 0x34, 0x42, 0xc,  0x75, 0xfe, 0xaa, 0x76, 0x8a, 0xf0, 0xe5, 0x42};
  uint8_t bytesprops5[] = {0xa2, 0x41, 0xb8, 0xfd, 0x34, 0xf5, 0xe1, 0xa5, 0x0,
                           0xee, 0x7,  0x30, 0xd4, 0xa3, 0xbe, 0x57, 0xe6};
  uint8_t bytesprops7[] = {0xde, 0x44, 0x78, 0x22, 0xef, 0xcb, 0x40, 0xa3, 0x6b, 0x2f, 0xc0,
                           0x71, 0x73, 0x95, 0x40, 0xe2, 0x63, 0x14, 0x36, 0xfc, 0xaf};
  uint8_t bytesprops8[] = {0xac, 0xbf};
  uint8_t bytesprops9[] = {0xce, 0xe5, 0xa3, 0x54, 0xcb};
  uint8_t bytesprops11[] = {0x52, 0xb2, 0x62, 0x73, 0x42, 0xdc, 0x42, 0xf9, 0xbe, 0xcc, 0x5f, 0xd7, 0x9c};
  uint8_t bytesprops10[] = {0xc3, 0x8,  0x3c, 0x46, 0x34, 0xf8, 0x76, 0xa8, 0xa6, 0x14,
                            0x55, 0x27, 0x61, 0x7a, 0x43, 0x57, 0x3f, 0xba, 0x6a, 0xc0};
  uint8_t bytesprops12[] = {0xa3, 0xe6, 0x7d, 0x43, 0x19, 0x31, 0x2b, 0xd0, 0xb9, 0x4e, 0xf2, 0x46, 0x5c, 0xea,
                            0xea, 0x39, 0x45, 0xf3, 0xf8, 0xa6, 0x28, 0x6e, 0xbc, 0x13, 0xf5, 0x42, 0xa8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8966}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 182}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9665}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23172}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 37}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 17073}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6868}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops5}, .v = {25, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 8733}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25434}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9677}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7911}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 7439}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 21}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 29860}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {20, (char*)&bytesprops10}, .v = {13, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10596}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10907, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 19202 [("",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = False, _noLocal =
// False, _subQoS = QoS1}),("\233$]\137\\\203f\234\199\ESC1+\152\242\NULM",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS0}),("1\194\146\170\EM\r|!\171\192\142\CAN\203<\165p\EMg\236\CAN\174x:\235\165\US\196,\129",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\170\170\208h\229\130\bc\245#",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = False,
// _noLocal = True, _subQoS = QoS1}),("0\218\159\251\186A\250w\ETX\DC4Ni\223Dpd\238-\139\t\134x\DC2\148v",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\180\201\201.\222",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS0})] [PropAuthenticationMethod
// "\158\244s\159\RS\183\175]\142)GW\ENQF\129C^\143uq\245\237\146",PropWillDelayInterval 2853,PropWillDelayInterval
// 12750,PropTopicAliasMaximum 22867,PropRequestResponseInformation 101,PropWillDelayInterval 23997,PropReceiveMaximum
// 21762,PropUserProperty "-K\US\139\251\235" "\154\NUL\242bE\240\&9\167\165H\243\244l9Z3\DC4.",PropResponseInformation
// "\149e\154\236\&97\NULG3@\211\&1#\219\DC4\252\183\&7 \215h\189\214\146\144\ACKI",PropSubscriptionIdentifier
// 6,PropRequestProblemInformation 70,PropTopicAlias 24035,PropReasonString
// "\250\241\240\232\185\178\168\EOTt]\207\174uF\242\214&$\201\149",PropUserProperty "PS\147\163\145"
// "\187`[/\SO^\152x\152A\134n\182x\\\216(\207\&0M\172",PropWildcardSubscriptionAvailable 20,PropRetainAvailable
// 2,PropWildcardSubscriptionAvailable 250,PropServerReference "\208\175\184<ksGt\246",PropReasonString
// "}H\229\135\154d\194\nn\CAN4r8C<\SYN(6\NAK\185\SOH\252\138J\240\179l\215 \145",PropResponseTopic "\227\251\171E"]
TEST(Subscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0x82, 0xce, 0x2,  0x4b, 0x2,  0xe3, 0x1,  0x15, 0x0,  0x17, 0x9e, 0xf4, 0x73, 0x9f, 0x1e, 0xb7, 0xaf, 0x5d, 0x8e,
      0x29, 0x47, 0x57, 0x5,  0x46, 0x81, 0x43, 0x5e, 0x8f, 0x75, 0x71, 0xf5, 0xed, 0x92, 0x18, 0x0,  0x0,  0xb,  0x25,
      0x18, 0x0,  0x0,  0x31, 0xce, 0x22, 0x59, 0x53, 0x19, 0x65, 0x18, 0x0,  0x0,  0x5d, 0xbd, 0x21, 0x55, 0x2,  0x26,
      0x0,  0x6,  0x2d, 0x4b, 0x1f, 0x8b, 0xfb, 0xeb, 0x0,  0x12, 0x9a, 0x0,  0xf2, 0x62, 0x45, 0xf0, 0x39, 0xa7, 0xa5,
      0x48, 0xf3, 0xf4, 0x6c, 0x39, 0x5a, 0x33, 0x14, 0x2e, 0x1a, 0x0,  0x1b, 0x95, 0x65, 0x9a, 0xec, 0x39, 0x37, 0x0,
      0x47, 0x33, 0x40, 0xd3, 0x31, 0x23, 0xdb, 0x14, 0xfc, 0xb7, 0x37, 0x20, 0xd7, 0x68, 0xbd, 0xd6, 0x92, 0x90, 0x6,
      0x49, 0xb,  0x6,  0x17, 0x46, 0x23, 0x5d, 0xe3, 0x1f, 0x0,  0x14, 0xfa, 0xf1, 0xf0, 0xe8, 0xb9, 0xb2, 0xa8, 0x4,
      0x74, 0x5d, 0xcf, 0xae, 0x75, 0x46, 0xf2, 0xd6, 0x26, 0x24, 0xc9, 0x95, 0x26, 0x0,  0x5,  0x50, 0x53, 0x93, 0xa3,
      0x91, 0x0,  0x15, 0xbb, 0x60, 0x5b, 0x2f, 0xe,  0x5e, 0x98, 0x78, 0x98, 0x41, 0x86, 0x6e, 0xb6, 0x78, 0x5c, 0xd8,
      0x28, 0xcf, 0x30, 0x4d, 0xac, 0x28, 0x14, 0x25, 0x2,  0x28, 0xfa, 0x1c, 0x0,  0x9,  0xd0, 0xaf, 0xb8, 0x3c, 0x6b,
      0x73, 0x47, 0x74, 0xf6, 0x1f, 0x0,  0x1e, 0x7d, 0x48, 0xe5, 0x87, 0x9a, 0x64, 0xc2, 0xa,  0x6e, 0x18, 0x34, 0x72,
      0x38, 0x43, 0x3c, 0x16, 0x28, 0x36, 0x15, 0xb9, 0x1,  0xfc, 0x8a, 0x4a, 0xf0, 0xb3, 0x6c, 0xd7, 0x20, 0x91, 0x8,
      0x0,  0x4,  0xe3, 0xfb, 0xab, 0x45, 0x0,  0x0,  0x11, 0x0,  0x10, 0xe9, 0x24, 0x5d, 0x89, 0x5c, 0xcb, 0x66, 0xea,
      0xc7, 0x1b, 0x31, 0x2b, 0x98, 0xf2, 0x0,  0x4d, 0x0,  0x0,  0x1d, 0x31, 0xc2, 0x92, 0xaa, 0x19, 0xd,  0x7c, 0x21,
      0xab, 0xc0, 0x8e, 0x18, 0xcb, 0x3c, 0xa5, 0x70, 0x19, 0x67, 0xec, 0x18, 0xae, 0x78, 0x3a, 0xeb, 0xa5, 0x1f, 0xc4,
      0x2c, 0x81, 0x18, 0x0,  0xa,  0xaa, 0xaa, 0xd0, 0x68, 0xe5, 0x82, 0x8,  0x63, 0xf5, 0x23, 0x5,  0x0,  0x19, 0x30,
      0xda, 0x9f, 0xfb, 0xba, 0x41, 0xfa, 0x77, 0x3,  0x14, 0x4e, 0x69, 0xdf, 0x44, 0x70, 0x64, 0xee, 0x2d, 0x8b, 0x9,
      0x86, 0x78, 0x12, 0x94, 0x76, 0x25, 0x0,  0x5,  0xb4, 0xc9, 0xc9, 0x2e, 0xde, 0x18};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xe9, 0x24, 0x5d, 0x89, 0x5c, 0xcb, 0x66, 0xea,
                                     0xc7, 0x1b, 0x31, 0x2b, 0x98, 0xf2, 0x0,  0x4d};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x31, 0xc2, 0x92, 0xaa, 0x19, 0xd,  0x7c, 0x21, 0xab, 0xc0,
                                     0x8e, 0x18, 0xcb, 0x3c, 0xa5, 0x70, 0x19, 0x67, 0xec, 0x18,
                                     0xae, 0x78, 0x3a, 0xeb, 0xa5, 0x1f, 0xc4, 0x2c, 0x81};
  lwmqtt_string_t topic_filter_s2 = {29, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xaa, 0xaa, 0xd0, 0x68, 0xe5, 0x82, 0x8, 0x63, 0xf5, 0x23};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x30, 0xda, 0x9f, 0xfb, 0xba, 0x41, 0xfa, 0x77, 0x3,  0x14, 0x4e, 0x69, 0xdf,
                                     0x44, 0x70, 0x64, 0xee, 0x2d, 0x8b, 0x9,  0x86, 0x78, 0x12, 0x94, 0x76};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb4, 0xc9, 0xc9, 0x2e, 0xde};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS1;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = false;
  uint8_t bytesprops0[] = {0x9e, 0xf4, 0x73, 0x9f, 0x1e, 0xb7, 0xaf, 0x5d, 0x8e, 0x29, 0x47, 0x57,
                           0x5,  0x46, 0x81, 0x43, 0x5e, 0x8f, 0x75, 0x71, 0xf5, 0xed, 0x92};
  uint8_t bytesprops2[] = {0x9a, 0x0,  0xf2, 0x62, 0x45, 0xf0, 0x39, 0xa7, 0xa5,
                           0x48, 0xf3, 0xf4, 0x6c, 0x39, 0x5a, 0x33, 0x14, 0x2e};
  uint8_t bytesprops1[] = {0x2d, 0x4b, 0x1f, 0x8b, 0xfb, 0xeb};
  uint8_t bytesprops3[] = {0x95, 0x65, 0x9a, 0xec, 0x39, 0x37, 0x0,  0x47, 0x33, 0x40, 0xd3, 0x31, 0x23, 0xdb,
                           0x14, 0xfc, 0xb7, 0x37, 0x20, 0xd7, 0x68, 0xbd, 0xd6, 0x92, 0x90, 0x6,  0x49};
  uint8_t bytesprops4[] = {0xfa, 0xf1, 0xf0, 0xe8, 0xb9, 0xb2, 0xa8, 0x4,  0x74, 0x5d,
                           0xcf, 0xae, 0x75, 0x46, 0xf2, 0xd6, 0x26, 0x24, 0xc9, 0x95};
  uint8_t bytesprops6[] = {0xbb, 0x60, 0x5b, 0x2f, 0xe,  0x5e, 0x98, 0x78, 0x98, 0x41, 0x86,
                           0x6e, 0xb6, 0x78, 0x5c, 0xd8, 0x28, 0xcf, 0x30, 0x4d, 0xac};
  uint8_t bytesprops5[] = {0x50, 0x53, 0x93, 0xa3, 0x91};
  uint8_t bytesprops7[] = {0xd0, 0xaf, 0xb8, 0x3c, 0x6b, 0x73, 0x47, 0x74, 0xf6};
  uint8_t bytesprops8[] = {0x7d, 0x48, 0xe5, 0x87, 0x9a, 0x64, 0xc2, 0xa,  0x6e, 0x18, 0x34, 0x72, 0x38, 0x43, 0x3c,
                           0x16, 0x28, 0x36, 0x15, 0xb9, 0x1,  0xfc, 0x8a, 0x4a, 0xf0, 0xb3, 0x6c, 0xd7, 0x20, 0x91};
  uint8_t bytesprops9[] = {0xe3, 0xfb, 0xab, 0x45};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2853}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 12750}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 22867}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 23997}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21762}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {6, (char*)&bytesprops1}, .v = {18, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 6}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 24035}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops5}, .v = {21, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 20}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 2}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 19202, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 1190 [("\177\230\158.\f",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS2}),("\220\251\RSJYw#\216\245\224",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\212g\230=\168k\211O",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("]\US@\f\210",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True,
// _subQoS = QoS2}),("+\161\199",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal
// = False, _subQoS = QoS2})] [PropAuthenticationMethod
// "\231p\134\ETBU\211\209\218\179\243\242qt\134\245\224\208W\177\235%-[\EM",PropServerKeepAlive
// 14201,PropRetainAvailable 138,PropAssignedClientIdentifier "\DC23\232^\141A\224\140\206\ENQ",PropAuthenticationData
// "\">\STX\166",PropRequestResponseInformation 238,PropPayloadFormatIndicator 55,PropAuthenticationData
// "\248V\155\DC1\175\156\&1^\159\&5\161\165$",PropMessageExpiryInterval 5961,PropServerReference
// "\FS\252\&7^\"\181$\231Jw\"\187r\169]=<e\211\141\NAK",PropReasonString
// "\t\248\230j\tbL\RS\243\132\229\228\151!nK\244<\b#m\DC2\228\FSc\232\134\159\147\"",PropRetainAvailable
// 149,PropMaximumPacketSize 26248,PropTopicAliasMaximum 11913,PropMaximumQoS 112,PropMaximumPacketSize
// 3552,PropMessageExpiryInterval 23578,PropContentType "\135\197\249",PropContentType
// "\227\148\233\fNG\157bZW#\DC2a\164\DC2_/21\206\&2Q",PropAssignedClientIdentifier "",PropAuthenticationMethod
// "\152\179\"\248\167XI\188\254\237",PropMaximumPacketSize 15935,PropAuthenticationData "\143hM\180%
// \DC3ev\224n\138\171\250-s^\r\133\182n\128oQ\172",PropMessageExpiryInterval 28458,PropReceiveMaximum
// 27464,PropResponseInformation "3C",PropRequestResponseInformation 138,PropTopicAliasMaximum
// 12779,PropPayloadFormatIndicator 164]
TEST(Subscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0x82, 0xb2, 0x2,  0x4,  0xa6, 0x80, 0x2,  0x15, 0x0,  0x18, 0xe7, 0x70, 0x86, 0x17, 0x55, 0xd3, 0xd1, 0xda, 0xb3,
      0xf3, 0xf2, 0x71, 0x74, 0x86, 0xf5, 0xe0, 0xd0, 0x57, 0xb1, 0xeb, 0x25, 0x2d, 0x5b, 0x19, 0x13, 0x37, 0x79, 0x25,
      0x8a, 0x12, 0x0,  0xa,  0x12, 0x33, 0xe8, 0x5e, 0x8d, 0x41, 0xe0, 0x8c, 0xce, 0x5,  0x16, 0x0,  0x4,  0x22, 0x3e,
      0x2,  0xa6, 0x19, 0xee, 0x1,  0x37, 0x16, 0x0,  0xd,  0xf8, 0x56, 0x9b, 0x11, 0xaf, 0x9c, 0x31, 0x5e, 0x9f, 0x35,
      0xa1, 0xa5, 0x24, 0x2,  0x0,  0x0,  0x17, 0x49, 0x1c, 0x0,  0x15, 0x1c, 0xfc, 0x37, 0x5e, 0x22, 0xb5, 0x24, 0xe7,
      0x4a, 0x77, 0x22, 0xbb, 0x72, 0xa9, 0x5d, 0x3d, 0x3c, 0x65, 0xd3, 0x8d, 0x15, 0x1f, 0x0,  0x1e, 0x9,  0xf8, 0xe6,
      0x6a, 0x9,  0x62, 0x4c, 0x1e, 0xf3, 0x84, 0xe5, 0xe4, 0x97, 0x21, 0x6e, 0x4b, 0xf4, 0x3c, 0x8,  0x23, 0x6d, 0x12,
      0xe4, 0x1c, 0x63, 0xe8, 0x86, 0x9f, 0x93, 0x22, 0x25, 0x95, 0x27, 0x0,  0x0,  0x66, 0x88, 0x22, 0x2e, 0x89, 0x24,
      0x70, 0x27, 0x0,  0x0,  0xd,  0xe0, 0x2,  0x0,  0x0,  0x5c, 0x1a, 0x3,  0x0,  0x3,  0x87, 0xc5, 0xf9, 0x3,  0x0,
      0x16, 0xe3, 0x94, 0xe9, 0xc,  0x4e, 0x47, 0x9d, 0x62, 0x5a, 0x57, 0x23, 0x12, 0x61, 0xa4, 0x12, 0x5f, 0x2f, 0x32,
      0x31, 0xce, 0x32, 0x51, 0x12, 0x0,  0x0,  0x15, 0x0,  0xa,  0x98, 0xb3, 0x22, 0xf8, 0xa7, 0x58, 0x49, 0xbc, 0xfe,
      0xed, 0x27, 0x0,  0x0,  0x3e, 0x3f, 0x16, 0x0,  0x19, 0x8f, 0x68, 0x4d, 0xb4, 0x25, 0x20, 0x13, 0x65, 0x76, 0xe0,
      0x6e, 0x8a, 0xab, 0xfa, 0x2d, 0x73, 0x5e, 0xd,  0x85, 0xb6, 0x6e, 0x80, 0x6f, 0x51, 0xac, 0x2,  0x0,  0x0,  0x6f,
      0x2a, 0x21, 0x6b, 0x48, 0x1a, 0x0,  0x2,  0x33, 0x43, 0x19, 0x8a, 0x22, 0x31, 0xeb, 0x1,  0xa4, 0x0,  0x5,  0xb1,
      0xe6, 0x9e, 0x2e, 0xc,  0x26, 0x0,  0xa,  0xdc, 0xfb, 0x1e, 0x4a, 0x59, 0x77, 0x23, 0xd8, 0xf5, 0xe0, 0x6,  0x0,
      0x8,  0xd4, 0x67, 0xe6, 0x3d, 0xa8, 0x6b, 0xd3, 0x4f, 0x1d, 0x0,  0x5,  0x5d, 0x1f, 0x40, 0xc,  0xd2, 0x1e, 0x0,
      0x3,  0x2b, 0xa1, 0xc7, 0x2a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xb1, 0xe6, 0x9e, 0x2e, 0xc};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xdc, 0xfb, 0x1e, 0x4a, 0x59, 0x77, 0x23, 0xd8, 0xf5, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {10, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xd4, 0x67, 0xe6, 0x3d, 0xa8, 0x6b, 0xd3, 0x4f};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x5d, 0x1f, 0x40, 0xc, 0xd2};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x2b, 0xa1, 0xc7};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  lwmqtt_sub_options_t sub_opts[5];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = false;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS2;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  uint8_t bytesprops0[] = {0xe7, 0x70, 0x86, 0x17, 0x55, 0xd3, 0xd1, 0xda, 0xb3, 0xf3, 0xf2, 0x71,
                           0x74, 0x86, 0xf5, 0xe0, 0xd0, 0x57, 0xb1, 0xeb, 0x25, 0x2d, 0x5b, 0x19};
  uint8_t bytesprops1[] = {0x12, 0x33, 0xe8, 0x5e, 0x8d, 0x41, 0xe0, 0x8c, 0xce, 0x5};
  uint8_t bytesprops2[] = {0x22, 0x3e, 0x2, 0xa6};
  uint8_t bytesprops3[] = {0xf8, 0x56, 0x9b, 0x11, 0xaf, 0x9c, 0x31, 0x5e, 0x9f, 0x35, 0xa1, 0xa5, 0x24};
  uint8_t bytesprops4[] = {0x1c, 0xfc, 0x37, 0x5e, 0x22, 0xb5, 0x24, 0xe7, 0x4a, 0x77, 0x22,
                           0xbb, 0x72, 0xa9, 0x5d, 0x3d, 0x3c, 0x65, 0xd3, 0x8d, 0x15};
  uint8_t bytesprops5[] = {0x9,  0xf8, 0xe6, 0x6a, 0x9,  0x62, 0x4c, 0x1e, 0xf3, 0x84, 0xe5, 0xe4, 0x97, 0x21, 0x6e,
                           0x4b, 0xf4, 0x3c, 0x8,  0x23, 0x6d, 0x12, 0xe4, 0x1c, 0x63, 0xe8, 0x86, 0x9f, 0x93, 0x22};
  uint8_t bytesprops6[] = {0x87, 0xc5, 0xf9};
  uint8_t bytesprops7[] = {0xe3, 0x94, 0xe9, 0xc,  0x4e, 0x47, 0x9d, 0x62, 0x5a, 0x57, 0x23,
                           0x12, 0x61, 0xa4, 0x12, 0x5f, 0x2f, 0x32, 0x31, 0xce, 0x32, 0x51};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops9[] = {0x98, 0xb3, 0x22, 0xf8, 0xa7, 0x58, 0x49, 0xbc, 0xfe, 0xed};
  uint8_t bytesprops10[] = {0x8f, 0x68, 0x4d, 0xb4, 0x25, 0x20, 0x13, 0x65, 0x76, 0xe0, 0x6e, 0x8a, 0xab,
                            0xfa, 0x2d, 0x73, 0x5e, 0xd,  0x85, 0xb6, 0x6e, 0x80, 0x6f, 0x51, 0xac};
  uint8_t bytesprops11[] = {0x33, 0x43};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14201}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 238}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5961}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 149}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26248}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 11913}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3552}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23578}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {22, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {10, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 15935}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28458}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27464}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {2, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12779}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 164}},
  };

  lwmqtt_properties_t props = {29, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 1190, 5, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 4671 [("osy",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal =
// False, _subQoS = QoS2}),("\210HT\163\DC2\139\243O\224\246\242h\152\192\152y\186",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS1}),("\180Q\187",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("'\191s\156\EM\188\210\SOH\148\186\141\154{\206\STXwV\233\188+",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\149\r:\181V\203\NAK0\179\229",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished =
// True, _noLocal = True, _subQoS = QoS2}),("Re\176\RS\251\223S\255\200\190\180+\217!p",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("w\n\174\187\236vy\169\166\185\&1\149\SOH\250\131\152\204\US\128U\144\DC2\174",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\200\193\194\&8\241p\166",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropUserProperty
// "\214l\NAK)\RSnV\145\153\186\ESC@\184\161\235v\218\191\138\209yb\135Fu~`\146y" "r\234\195\151",PropContentType
// "\196\\$#\243\DC4``\158[a\FS\195P\184D\ETX\ENQv",PropUserProperty
// "\230\165\SOH\255\176h\169\152\224U\226_1\CAN\168\151\218\212\247\USbr\SUBl\147Z"
// "z\128\219N\149#e7",PropSubscriptionIdentifierAvailable 43,PropMaximumQoS 18,PropRequestResponseInformation
// 171,PropTopicAlias 23677,PropMessageExpiryInterval 13734,PropUserProperty "\186v\141\137C\189\&9\138Vt\DLEq\154"
// "\222<\190$\SI%\178\RS\218\187c0",PropResponseInformation
// "\SO\ETX\173Z\235\253\239\182>\214\&8\142\"\188s\144fH\199K\ETXr\USX\194r\199fL\151",PropReasonString
// "\227ec\214\143j\141\&5T\193\139\245",PropAuthenticationMethod
// "z\176\194\219\219<\184\t\140\186\168\240\133\179'Q%\185\170",PropWildcardSubscriptionAvailable 107,PropTopicAlias
// 26361]
TEST(Subscribe5QCTest, Encode24) {
  uint8_t pkt[] = {
      0x82, 0xdb, 0x2,  0x12, 0x3f, 0xda, 0x1,  0x26, 0x0,  0x1d, 0xd6, 0x6c, 0x15, 0x29, 0x1e, 0x6e, 0x56, 0x91, 0x99,
      0xba, 0x1b, 0x40, 0xb8, 0xa1, 0xeb, 0x76, 0xda, 0xbf, 0x8a, 0xd1, 0x79, 0x62, 0x87, 0x46, 0x75, 0x7e, 0x60, 0x92,
      0x79, 0x0,  0x4,  0x72, 0xea, 0xc3, 0x97, 0x3,  0x0,  0x13, 0xc4, 0x5c, 0x24, 0x23, 0xf3, 0x14, 0x60, 0x60, 0x9e,
      0x5b, 0x61, 0x1c, 0xc3, 0x50, 0xb8, 0x44, 0x3,  0x5,  0x76, 0x26, 0x0,  0x1a, 0xe6, 0xa5, 0x1,  0xff, 0xb0, 0x68,
      0xa9, 0x98, 0xe0, 0x55, 0xe2, 0x5f, 0x31, 0x18, 0xa8, 0x97, 0xda, 0xd4, 0xf7, 0x1f, 0x62, 0x72, 0x1a, 0x6c, 0x93,
      0x5a, 0x0,  0x8,  0x7a, 0x80, 0xdb, 0x4e, 0x95, 0x23, 0x65, 0x37, 0x29, 0x2b, 0x24, 0x12, 0x19, 0xab, 0x23, 0x5c,
      0x7d, 0x2,  0x0,  0x0,  0x35, 0xa6, 0x26, 0x0,  0xd,  0xba, 0x76, 0x8d, 0x89, 0x43, 0xbd, 0x39, 0x8a, 0x56, 0x74,
      0x10, 0x71, 0x9a, 0x0,  0xc,  0xde, 0x3c, 0xbe, 0x24, 0xf,  0x25, 0xb2, 0x1e, 0xda, 0xbb, 0x63, 0x30, 0x1a, 0x0,
      0x1e, 0xe,  0x3,  0xad, 0x5a, 0xeb, 0xfd, 0xef, 0xb6, 0x3e, 0xd6, 0x38, 0x8e, 0x22, 0xbc, 0x73, 0x90, 0x66, 0x48,
      0xc7, 0x4b, 0x3,  0x72, 0x1f, 0x58, 0xc2, 0x72, 0xc7, 0x66, 0x4c, 0x97, 0x1f, 0x0,  0xc,  0xe3, 0x65, 0x63, 0xd6,
      0x8f, 0x6a, 0x8d, 0x35, 0x54, 0xc1, 0x8b, 0xf5, 0x15, 0x0,  0x13, 0x7a, 0xb0, 0xc2, 0xdb, 0xdb, 0x3c, 0xb8, 0x9,
      0x8c, 0xba, 0xa8, 0xf0, 0x85, 0xb3, 0x27, 0x51, 0x25, 0xb9, 0xaa, 0x28, 0x6b, 0x23, 0x66, 0xf9, 0x0,  0x3,  0x6f,
      0x73, 0x79, 0x1a, 0x0,  0x11, 0xd2, 0x48, 0x54, 0xa3, 0x12, 0x8b, 0xf3, 0x4f, 0xe0, 0xf6, 0xf2, 0x68, 0x98, 0xc0,
      0x98, 0x79, 0xba, 0x5,  0x0,  0x3,  0xb4, 0x51, 0xbb, 0x1e, 0x0,  0x0,  0xe,  0x0,  0x14, 0x27, 0xbf, 0x73, 0x9c,
      0x19, 0xbc, 0xd2, 0x1,  0x94, 0xba, 0x8d, 0x9a, 0x7b, 0xce, 0x2,  0x77, 0x56, 0xe9, 0xbc, 0x2b, 0x28, 0x0,  0xa,
      0x95, 0xd,  0x3a, 0xb5, 0x56, 0xcb, 0x15, 0x30, 0xb3, 0xe5, 0x2e, 0x0,  0xf,  0x52, 0x65, 0xb0, 0x1e, 0xfb, 0xdf,
      0x53, 0xff, 0xc8, 0xbe, 0xb4, 0x2b, 0xd9, 0x21, 0x70, 0xa,  0x0,  0x17, 0x77, 0xa,  0xae, 0xbb, 0xec, 0x76, 0x79,
      0xa9, 0xa6, 0xb9, 0x31, 0x95, 0x1,  0xfa, 0x83, 0x98, 0xcc, 0x1f, 0x80, 0x55, 0x90, 0x12, 0xae, 0x6,  0x0,  0x7,
      0xc8, 0xc1, 0xc2, 0x38, 0xf1, 0x70, 0xa6, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x6f, 0x73, 0x79};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd2, 0x48, 0x54, 0xa3, 0x12, 0x8b, 0xf3, 0x4f, 0xe0,
                                     0xf6, 0xf2, 0x68, 0x98, 0xc0, 0x98, 0x79, 0xba};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb4, 0x51, 0xbb};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x27, 0xbf, 0x73, 0x9c, 0x19, 0xbc, 0xd2, 0x1,  0x94, 0xba,
                                     0x8d, 0x9a, 0x7b, 0xce, 0x2,  0x77, 0x56, 0xe9, 0xbc, 0x2b};
  lwmqtt_string_t topic_filter_s4 = {20, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x95, 0xd, 0x3a, 0xb5, 0x56, 0xcb, 0x15, 0x30, 0xb3, 0xe5};
  lwmqtt_string_t topic_filter_s5 = {10, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x52, 0x65, 0xb0, 0x1e, 0xfb, 0xdf, 0x53, 0xff,
                                     0xc8, 0xbe, 0xb4, 0x2b, 0xd9, 0x21, 0x70};
  lwmqtt_string_t topic_filter_s6 = {15, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x77, 0xa,  0xae, 0xbb, 0xec, 0x76, 0x79, 0xa9, 0xa6, 0xb9, 0x31, 0x95,
                                     0x1,  0xfa, 0x83, 0x98, 0xcc, 0x1f, 0x80, 0x55, 0x90, 0x12, 0xae};
  lwmqtt_string_t topic_filter_s7 = {23, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc8, 0xc1, 0xc2, 0x38, 0xf1, 0x70, 0xa6};
  lwmqtt_string_t topic_filter_s8 = {7, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  lwmqtt_sub_options_t sub_opts[9];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS1;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS2;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS0;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS2;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS0;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = true;
  uint8_t bytesprops1[] = {0x72, 0xea, 0xc3, 0x97};
  uint8_t bytesprops0[] = {0xd6, 0x6c, 0x15, 0x29, 0x1e, 0x6e, 0x56, 0x91, 0x99, 0xba, 0x1b, 0x40, 0xb8, 0xa1, 0xeb,
                           0x76, 0xda, 0xbf, 0x8a, 0xd1, 0x79, 0x62, 0x87, 0x46, 0x75, 0x7e, 0x60, 0x92, 0x79};
  uint8_t bytesprops2[] = {0xc4, 0x5c, 0x24, 0x23, 0xf3, 0x14, 0x60, 0x60, 0x9e, 0x5b,
                           0x61, 0x1c, 0xc3, 0x50, 0xb8, 0x44, 0x3,  0x5,  0x76};
  uint8_t bytesprops4[] = {0x7a, 0x80, 0xdb, 0x4e, 0x95, 0x23, 0x65, 0x37};
  uint8_t bytesprops3[] = {0xe6, 0xa5, 0x1,  0xff, 0xb0, 0x68, 0xa9, 0x98, 0xe0, 0x55, 0xe2, 0x5f, 0x31,
                           0x18, 0xa8, 0x97, 0xda, 0xd4, 0xf7, 0x1f, 0x62, 0x72, 0x1a, 0x6c, 0x93, 0x5a};
  uint8_t bytesprops6[] = {0xde, 0x3c, 0xbe, 0x24, 0xf, 0x25, 0xb2, 0x1e, 0xda, 0xbb, 0x63, 0x30};
  uint8_t bytesprops5[] = {0xba, 0x76, 0x8d, 0x89, 0x43, 0xbd, 0x39, 0x8a, 0x56, 0x74, 0x10, 0x71, 0x9a};
  uint8_t bytesprops7[] = {0xe,  0x3,  0xad, 0x5a, 0xeb, 0xfd, 0xef, 0xb6, 0x3e, 0xd6, 0x38, 0x8e, 0x22, 0xbc, 0x73,
                           0x90, 0x66, 0x48, 0xc7, 0x4b, 0x3,  0x72, 0x1f, 0x58, 0xc2, 0x72, 0xc7, 0x66, 0x4c, 0x97};
  uint8_t bytesprops8[] = {0xe3, 0x65, 0x63, 0xd6, 0x8f, 0x6a, 0x8d, 0x35, 0x54, 0xc1, 0x8b, 0xf5};
  uint8_t bytesprops9[] = {0x7a, 0xb0, 0xc2, 0xdb, 0xdb, 0x3c, 0xb8, 0x9,  0x8c, 0xba,
                           0xa8, 0xf0, 0x85, 0xb3, 0x27, 0x51, 0x25, 0xb9, 0xaa};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops0}, .v = {4, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {26, (char*)&bytesprops3}, .v = {8, (char*)&bytesprops4}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 18}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23677}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13734}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops5}, .v = {12, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {19, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 26361}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4671, 9, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22250 [("\186\185\130\168\166",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\155\157\SYN\229\227\209\&4\SOH|\242\168\253\129xF\166\\\"BG\191\246\215",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\182\&7\250\251\141.\181\185",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS2}),("",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished = True,
// _noLocal = True, _subQoS = QoS0}),("\134&\251\172\216\150}\237\b\142\246",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS = QoS2}),("\197\235",SubOptions
// {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("K\195})\202\&1'\218\169\SOH\200g\252\235R\225\201\b&@\v Y~\144x\232",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\163\249Y`\207\ETB\EOTf\n\159!l\SUB2hs\162\149\186\250?\a\220\237\200",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\177\128;f\163y\182\222\185\r\SYN\US-y#\168\SO\190Cu\SO\r\143~y\254\vi\163X",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\236Fm\234\247v&5\249\208\&0\FS",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished =
// True, _noLocal = False, _subQoS = QoS2}),("b",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished
// = False, _noLocal = False, _subQoS = QoS0})] [PropRetainAvailable 236,PropSharedSubscriptionAvailable
// 11,PropRequestProblemInformation 28,PropMessageExpiryInterval 4198,PropTopicAlias
// 7386,PropSubscriptionIdentifierAvailable 14,PropWildcardSubscriptionAvailable 157,PropWillDelayInterval
// 20454,PropTopicAlias 8171,PropServerReference "\138\155\254%\185\185nS",PropPayloadFormatIndicator
// 213,PropServerReference "\169K\DLEu\204",PropResponseInformation
// "\ESC\185\142-\151\152\135C\183`\147/\215\235\223\234\138\fLBL\249\131@<r[Fz",PropTopicAliasMaximum
// 14530,PropServerKeepAlive 25044]
TEST(Subscribe5QCTest, Encode25) {
  uint8_t pkt[] = {0x82, 0x89, 0x2,  0x56, 0xea, 0x55, 0x25, 0xec, 0x2a, 0xb,  0x17, 0x1c, 0x2,  0x0,  0x0,  0x10, 0x66,
                   0x23, 0x1c, 0xda, 0x29, 0xe,  0x28, 0x9d, 0x18, 0x0,  0x0,  0x4f, 0xe6, 0x23, 0x1f, 0xeb, 0x1c, 0x0,
                   0x8,  0x8a, 0x9b, 0xfe, 0x25, 0xb9, 0xb9, 0x6e, 0x53, 0x1,  0xd5, 0x1c, 0x0,  0x5,  0xa9, 0x4b, 0x10,
                   0x75, 0xcc, 0x1a, 0x0,  0x1d, 0x1b, 0xb9, 0x8e, 0x2d, 0x97, 0x98, 0x87, 0x43, 0xb7, 0x60, 0x93, 0x2f,
                   0xd7, 0xeb, 0xdf, 0xea, 0x8a, 0xc,  0x4c, 0x42, 0x4c, 0xf9, 0x83, 0x40, 0x3c, 0x72, 0x5b, 0x46, 0x7a,
                   0x22, 0x38, 0xc2, 0x13, 0x61, 0xd4, 0x0,  0x5,  0xba, 0xb9, 0x82, 0xa8, 0xa6, 0x2d, 0x0,  0x17, 0x9b,
                   0x9d, 0x16, 0xe5, 0xe3, 0xd1, 0x34, 0x1,  0x7c, 0xf2, 0xa8, 0xfd, 0x81, 0x78, 0x46, 0xa6, 0x5c, 0x22,
                   0x42, 0x47, 0xbf, 0xf6, 0xd7, 0x28, 0x0,  0x8,  0xb6, 0x37, 0xfa, 0xfb, 0x8d, 0x2e, 0xb5, 0xb9, 0xa,
                   0x0,  0x0,  0xc,  0x0,  0xb,  0x86, 0x26, 0xfb, 0xac, 0xd8, 0x96, 0x7d, 0xed, 0x8,  0x8e, 0xf6, 0x26,
                   0x0,  0x2,  0xc5, 0xeb, 0x1e, 0x0,  0x1b, 0x4b, 0xc3, 0x7d, 0x29, 0xca, 0x31, 0x27, 0xda, 0xa9, 0x1,
                   0xc8, 0x67, 0xfc, 0xeb, 0x52, 0xe1, 0xc9, 0x8,  0x26, 0x40, 0xb,  0x20, 0x59, 0x7e, 0x90, 0x78, 0xe8,
                   0x16, 0x0,  0x19, 0xa3, 0xf9, 0x59, 0x60, 0xcf, 0x17, 0x4,  0x66, 0xa,  0x9f, 0x21, 0x6c, 0x1a, 0x32,
                   0x68, 0x73, 0xa2, 0x95, 0xba, 0xfa, 0x3f, 0x7,  0xdc, 0xed, 0xc8, 0x15, 0x0,  0x1e, 0xb1, 0x80, 0x3b,
                   0x66, 0xa3, 0x79, 0xb6, 0xde, 0xb9, 0xd,  0x16, 0x1f, 0x2d, 0x79, 0x23, 0xa8, 0xe,  0xbe, 0x43, 0x75,
                   0xe,  0xd,  0x8f, 0x7e, 0x79, 0xfe, 0xb,  0x69, 0xa3, 0x58, 0x22, 0x0,  0xc,  0xec, 0x46, 0x6d, 0xea,
                   0xf7, 0x76, 0x26, 0x35, 0xf9, 0xd0, 0x30, 0x1c, 0x1a, 0x0,  0x1,  0x62, 0x20};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0xba, 0xb9, 0x82, 0xa8, 0xa6};
  lwmqtt_string_t topic_filter_s0 = {5, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x9b, 0x9d, 0x16, 0xe5, 0xe3, 0xd1, 0x34, 0x1,  0x7c, 0xf2, 0xa8, 0xfd,
                                     0x81, 0x78, 0x46, 0xa6, 0x5c, 0x22, 0x42, 0x47, 0xbf, 0xf6, 0xd7};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb6, 0x37, 0xfa, 0xfb, 0x8d, 0x2e, 0xb5, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x86, 0x26, 0xfb, 0xac, 0xd8, 0x96, 0x7d, 0xed, 0x8, 0x8e, 0xf6};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xc5, 0xeb};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4b, 0xc3, 0x7d, 0x29, 0xca, 0x31, 0x27, 0xda, 0xa9, 0x1,  0xc8, 0x67, 0xfc, 0xeb,
                                     0x52, 0xe1, 0xc9, 0x8,  0x26, 0x40, 0xb,  0x20, 0x59, 0x7e, 0x90, 0x78, 0xe8};
  lwmqtt_string_t topic_filter_s6 = {27, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa3, 0xf9, 0x59, 0x60, 0xcf, 0x17, 0x4,  0x66, 0xa, 0x9f, 0x21, 0x6c, 0x1a,
                                     0x32, 0x68, 0x73, 0xa2, 0x95, 0xba, 0xfa, 0x3f, 0x7, 0xdc, 0xed, 0xc8};
  lwmqtt_string_t topic_filter_s7 = {25, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xb1, 0x80, 0x3b, 0x66, 0xa3, 0x79, 0xb6, 0xde, 0xb9, 0xd,
                                     0x16, 0x1f, 0x2d, 0x79, 0x23, 0xa8, 0xe,  0xbe, 0x43, 0x75,
                                     0xe,  0xd,  0x8f, 0x7e, 0x79, 0xfe, 0xb,  0x69, 0xa3, 0x58};
  lwmqtt_string_t topic_filter_s8 = {30, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xec, 0x46, 0x6d, 0xea, 0xf7, 0x76, 0x26, 0x35, 0xf9, 0xd0, 0x30, 0x1c};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x62};
  lwmqtt_string_t topic_filter_s10 = {1, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS1;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[6].retain_as_published = false;
  sub_opts[6].no_local = true;
  sub_opts[7].qos = LWMQTT_QOS1;
  sub_opts[7].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = true;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[8].retain_as_published = false;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS2;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = false;
  sub_opts[10].qos = LWMQTT_QOS0;
  sub_opts[10].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;
  uint8_t bytesprops0[] = {0x8a, 0x9b, 0xfe, 0x25, 0xb9, 0xb9, 0x6e, 0x53};
  uint8_t bytesprops1[] = {0xa9, 0x4b, 0x10, 0x75, 0xcc};
  uint8_t bytesprops2[] = {0x1b, 0xb9, 0x8e, 0x2d, 0x97, 0x98, 0x87, 0x43, 0xb7, 0x60, 0x93, 0x2f, 0xd7, 0xeb, 0xdf,
                           0xea, 0x8a, 0xc,  0x4c, 0x42, 0x4c, 0xf9, 0x83, 0x40, 0x3c, 0x72, 0x5b, 0x46, 0x7a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 11}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4198}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7386}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 20454}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8171}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14530}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25044}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22250, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 22609 [("9\162A\164\214x2\135U|)\230\201t\GS\197\189",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS0}),("\SYN!\148\165\145\182dN\241\238@\176\144\v\210`\247d!u\206\133\167\190\&8",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS0}),("\SUB\209\216\248:\200\215\CAN\234\STX\238\216\159Q\183\221\SYN\173<\182\128\142\n,\f",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS1}),("\129?\164a4\230\147\232\177\225\226\247\131\222\205\ENQ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS1}),("\DC2a\186H\140\172N<\153M\252\171\252Ji'\DC3\f36\GS\236\DC4t\200",SubOptions {_retainHandling =
// SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("{\204\244O\162>\CAN9\152\209\137,[\171\227\225\131%",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0}),(")eM\218\&6\152 \202\231\152J\139",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("\200[\DC1O\176\181\136",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = False,
// _noLocal = False, _subQoS = QoS0}),("\209f\ENQ!\195\251$^7\130\148_\DC4\189\167\202s\172\210\149\254\181=",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS =
// QoS2}),("2a\216\&2\185\140i=\199\224\250\&3\230r\DC4\161\146\130G",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\136\ETX\176~\130\DC1\"\241\SIp\253\190\162\219\183`\234",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = False, _subQoS = QoS2})] [PropMaximumPacketSize
// 5697,PropSharedSubscriptionAvailable 120,PropSubscriptionIdentifierAvailable 40,PropWildcardSubscriptionAvailable
// 52,PropServerKeepAlive 24790,PropPayloadFormatIndicator 26,PropUserProperty
// "\a\173:\189{4\DLE\177\231d\231\139\214\254\160\153" "",PropAssignedClientIdentifier
// "`.'\202\203\231\229?\DLE\167\157\134\204\182\180\227\210\192\&9V\143\213Y\133v=",PropCorrelationData
// "h\SI\228\160b\EM\150\151Z\132n\209nb&\FS\129\239|4\211\&36\ENQ\172\135K\SUBz",PropResponseTopic
// "#:+\228\235Y\183\250!x\197\a)\SO\154\254",PropUserProperty
// "p\238\184,\236\ESC\201\&3\199\254\132\246y\187\170\210}!\f\169\247T\184\&0Fw\142"
// "\b\NAKOj\148\136\227\201\221'\195nj7\ETB\254\188\145uD\131\&3\188\&7",PropAuthenticationMethod
// "\169\&4&tp8\151\179\185",PropTopicAlias 13893,PropMessageExpiryInterval 30246,PropMaximumQoS
// 68,PropMaximumPacketSize 19007,PropServerReference "\FS\SOt\223\229R\255",PropMaximumPacketSize
// 24216,PropSubscriptionIdentifierAvailable 104,PropRequestResponseInformation 139,PropSessionExpiryInterval
// 11251,PropTopicAliasMaximum 30523,PropServerKeepAlive 26783,PropMaximumQoS 129,PropRequestProblemInformation 174]
TEST(Subscribe5QCTest, Encode26) {
  uint8_t pkt[] = {
      0x82, 0xdb, 0x3,  0x58, 0x51, 0xea, 0x1,  0x27, 0x0,  0x0,  0x16, 0x41, 0x2a, 0x78, 0x29, 0x28, 0x28, 0x34, 0x13,
      0x60, 0xd6, 0x1,  0x1a, 0x26, 0x0,  0x10, 0x7,  0xad, 0x3a, 0xbd, 0x7b, 0x34, 0x10, 0xb1, 0xe7, 0x64, 0xe7, 0x8b,
      0xd6, 0xfe, 0xa0, 0x99, 0x0,  0x0,  0x12, 0x0,  0x1a, 0x60, 0x2e, 0x27, 0xca, 0xcb, 0xe7, 0xe5, 0x3f, 0x10, 0xa7,
      0x9d, 0x86, 0xcc, 0xb6, 0xb4, 0xe3, 0xd2, 0xc0, 0x39, 0x56, 0x8f, 0xd5, 0x59, 0x85, 0x76, 0x3d, 0x9,  0x0,  0x1d,
      0x68, 0xf,  0xe4, 0xa0, 0x62, 0x19, 0x96, 0x97, 0x5a, 0x84, 0x6e, 0xd1, 0x6e, 0x62, 0x26, 0x1c, 0x81, 0xef, 0x7c,
      0x34, 0xd3, 0x33, 0x36, 0x5,  0xac, 0x87, 0x4b, 0x1a, 0x7a, 0x8,  0x0,  0x10, 0x23, 0x3a, 0x2b, 0xe4, 0xeb, 0x59,
      0xb7, 0xfa, 0x21, 0x78, 0xc5, 0x7,  0x29, 0xe,  0x9a, 0xfe, 0x26, 0x0,  0x1b, 0x70, 0xee, 0xb8, 0x2c, 0xec, 0x1b,
      0xc9, 0x33, 0xc7, 0xfe, 0x84, 0xf6, 0x79, 0xbb, 0xaa, 0xd2, 0x7d, 0x21, 0xc,  0xa9, 0xf7, 0x54, 0xb8, 0x30, 0x46,
      0x77, 0x8e, 0x0,  0x18, 0x8,  0x15, 0x4f, 0x6a, 0x94, 0x88, 0xe3, 0xc9, 0xdd, 0x27, 0xc3, 0x6e, 0x6a, 0x37, 0x17,
      0xfe, 0xbc, 0x91, 0x75, 0x44, 0x83, 0x33, 0xbc, 0x37, 0x15, 0x0,  0x9,  0xa9, 0x34, 0x26, 0x74, 0x70, 0x38, 0x97,
      0xb3, 0xb9, 0x23, 0x36, 0x45, 0x2,  0x0,  0x0,  0x76, 0x26, 0x24, 0x44, 0x27, 0x0,  0x0,  0x4a, 0x3f, 0x1c, 0x0,
      0x7,  0x1c, 0xe,  0x74, 0xdf, 0xe5, 0x52, 0xff, 0x27, 0x0,  0x0,  0x5e, 0x98, 0x29, 0x68, 0x19, 0x8b, 0x11, 0x0,
      0x0,  0x2b, 0xf3, 0x22, 0x77, 0x3b, 0x13, 0x68, 0x9f, 0x24, 0x81, 0x17, 0xae, 0x0,  0x11, 0x39, 0xa2, 0x41, 0xa4,
      0xd6, 0x78, 0x32, 0x87, 0x55, 0x7c, 0x29, 0xe6, 0xc9, 0x74, 0x1d, 0xc5, 0xbd, 0x8,  0x0,  0x19, 0x16, 0x21, 0x94,
      0xa5, 0x91, 0xb6, 0x64, 0x4e, 0xf1, 0xee, 0x40, 0xb0, 0x90, 0xb,  0xd2, 0x60, 0xf7, 0x64, 0x21, 0x75, 0xce, 0x85,
      0xa7, 0xbe, 0x38, 0xc,  0x0,  0x19, 0x1a, 0xd1, 0xd8, 0xf8, 0x3a, 0xc8, 0xd7, 0x18, 0xea, 0x2,  0xee, 0xd8, 0x9f,
      0x51, 0xb7, 0xdd, 0x16, 0xad, 0x3c, 0xb6, 0x80, 0x8e, 0xa,  0x2c, 0xc,  0x29, 0x0,  0x10, 0x81, 0x3f, 0xa4, 0x61,
      0x34, 0xe6, 0x93, 0xe8, 0xb1, 0xe1, 0xe2, 0xf7, 0x83, 0xde, 0xcd, 0x5,  0x5,  0x0,  0x19, 0x12, 0x61, 0xba, 0x48,
      0x8c, 0xac, 0x4e, 0x3c, 0x99, 0x4d, 0xfc, 0xab, 0xfc, 0x4a, 0x69, 0x27, 0x13, 0xc,  0x33, 0x36, 0x1d, 0xec, 0x14,
      0x74, 0xc8, 0xa,  0x0,  0x12, 0x7b, 0xcc, 0xf4, 0x4f, 0xa2, 0x3e, 0x18, 0x39, 0x98, 0xd1, 0x89, 0x2c, 0x5b, 0xab,
      0xe3, 0xe1, 0x83, 0x25, 0x2c, 0x0,  0xc,  0x29, 0x65, 0x4d, 0xda, 0x36, 0x98, 0x20, 0xca, 0xe7, 0x98, 0x4a, 0x8b,
      0x2a, 0x0,  0x7,  0xc8, 0x5b, 0x11, 0x4f, 0xb0, 0xb5, 0x88, 0x20, 0x0,  0x17, 0xd1, 0x66, 0x5,  0x21, 0xc3, 0xfb,
      0x24, 0x5e, 0x37, 0x82, 0x94, 0x5f, 0x14, 0xbd, 0xa7, 0xca, 0x73, 0xac, 0xd2, 0x95, 0xfe, 0xb5, 0x3d, 0xa,  0x0,
      0x13, 0x32, 0x61, 0xd8, 0x32, 0xb9, 0x8c, 0x69, 0x3d, 0xc7, 0xe0, 0xfa, 0x33, 0xe6, 0x72, 0x14, 0xa1, 0x92, 0x82,
      0x47, 0x1d, 0x0,  0x11, 0x88, 0x3,  0xb0, 0x7e, 0x82, 0x11, 0x22, 0xf1, 0xf,  0x70, 0xfd, 0xbe, 0xa2, 0xdb, 0xb7,
      0x60, 0xea, 0x12};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[11];
  uint8_t topic_filter_s0_bytes[] = {0x39, 0xa2, 0x41, 0xa4, 0xd6, 0x78, 0x32, 0x87, 0x55,
                                     0x7c, 0x29, 0xe6, 0xc9, 0x74, 0x1d, 0xc5, 0xbd};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x16, 0x21, 0x94, 0xa5, 0x91, 0xb6, 0x64, 0x4e, 0xf1, 0xee, 0x40, 0xb0, 0x90,
                                     0xb,  0xd2, 0x60, 0xf7, 0x64, 0x21, 0x75, 0xce, 0x85, 0xa7, 0xbe, 0x38};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x1a, 0xd1, 0xd8, 0xf8, 0x3a, 0xc8, 0xd7, 0x18, 0xea, 0x2, 0xee, 0xd8, 0x9f,
                                     0x51, 0xb7, 0xdd, 0x16, 0xad, 0x3c, 0xb6, 0x80, 0x8e, 0xa, 0x2c, 0xc};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x81, 0x3f, 0xa4, 0x61, 0x34, 0xe6, 0x93, 0xe8,
                                     0xb1, 0xe1, 0xe2, 0xf7, 0x83, 0xde, 0xcd, 0x5};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0x61, 0xba, 0x48, 0x8c, 0xac, 0x4e, 0x3c, 0x99, 0x4d, 0xfc, 0xab, 0xfc,
                                     0x4a, 0x69, 0x27, 0x13, 0xc,  0x33, 0x36, 0x1d, 0xec, 0x14, 0x74, 0xc8};
  lwmqtt_string_t topic_filter_s4 = {25, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7b, 0xcc, 0xf4, 0x4f, 0xa2, 0x3e, 0x18, 0x39, 0x98,
                                     0xd1, 0x89, 0x2c, 0x5b, 0xab, 0xe3, 0xe1, 0x83, 0x25};
  lwmqtt_string_t topic_filter_s5 = {18, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x29, 0x65, 0x4d, 0xda, 0x36, 0x98, 0x20, 0xca, 0xe7, 0x98, 0x4a, 0x8b};
  lwmqtt_string_t topic_filter_s6 = {12, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xc8, 0x5b, 0x11, 0x4f, 0xb0, 0xb5, 0x88};
  lwmqtt_string_t topic_filter_s7 = {7, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd1, 0x66, 0x5,  0x21, 0xc3, 0xfb, 0x24, 0x5e, 0x37, 0x82, 0x94, 0x5f,
                                     0x14, 0xbd, 0xa7, 0xca, 0x73, 0xac, 0xd2, 0x95, 0xfe, 0xb5, 0x3d};
  lwmqtt_string_t topic_filter_s8 = {23, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x32, 0x61, 0xd8, 0x32, 0xb9, 0x8c, 0x69, 0x3d, 0xc7, 0xe0,
                                     0xfa, 0x33, 0xe6, 0x72, 0x14, 0xa1, 0x92, 0x82, 0x47};
  lwmqtt_string_t topic_filter_s9 = {19, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  uint8_t topic_filter_s10_bytes[] = {0x88, 0x3,  0xb0, 0x7e, 0x82, 0x11, 0x22, 0xf1, 0xf,
                                      0x70, 0xfd, 0xbe, 0xa2, 0xdb, 0xb7, 0x60, 0xea};
  lwmqtt_string_t topic_filter_s10 = {17, (char*)&topic_filter_s10_bytes};
  topic_filters[10] = topic_filter_s10;
  lwmqtt_sub_options_t sub_opts[11];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = false;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS0;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = false;
  sub_opts[7].qos = LWMQTT_QOS0;
  sub_opts[7].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[7].retain_as_published = false;
  sub_opts[7].no_local = false;
  sub_opts[8].qos = LWMQTT_QOS2;
  sub_opts[8].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[8].retain_as_published = true;
  sub_opts[8].no_local = false;
  sub_opts[9].qos = LWMQTT_QOS1;
  sub_opts[9].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[9].retain_as_published = true;
  sub_opts[9].no_local = true;
  sub_opts[10].qos = LWMQTT_QOS2;
  sub_opts[10].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[10].retain_as_published = false;
  sub_opts[10].no_local = false;
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops0[] = {0x7,  0xad, 0x3a, 0xbd, 0x7b, 0x34, 0x10, 0xb1,
                           0xe7, 0x64, 0xe7, 0x8b, 0xd6, 0xfe, 0xa0, 0x99};
  uint8_t bytesprops2[] = {0x60, 0x2e, 0x27, 0xca, 0xcb, 0xe7, 0xe5, 0x3f, 0x10, 0xa7, 0x9d, 0x86, 0xcc,
                           0xb6, 0xb4, 0xe3, 0xd2, 0xc0, 0x39, 0x56, 0x8f, 0xd5, 0x59, 0x85, 0x76, 0x3d};
  uint8_t bytesprops3[] = {0x68, 0xf,  0xe4, 0xa0, 0x62, 0x19, 0x96, 0x97, 0x5a, 0x84, 0x6e, 0xd1, 0x6e, 0x62, 0x26,
                           0x1c, 0x81, 0xef, 0x7c, 0x34, 0xd3, 0x33, 0x36, 0x5,  0xac, 0x87, 0x4b, 0x1a, 0x7a};
  uint8_t bytesprops4[] = {0x23, 0x3a, 0x2b, 0xe4, 0xeb, 0x59, 0xb7, 0xfa,
                           0x21, 0x78, 0xc5, 0x7,  0x29, 0xe,  0x9a, 0xfe};
  uint8_t bytesprops6[] = {0x8,  0x15, 0x4f, 0x6a, 0x94, 0x88, 0xe3, 0xc9, 0xdd, 0x27, 0xc3, 0x6e,
                           0x6a, 0x37, 0x17, 0xfe, 0xbc, 0x91, 0x75, 0x44, 0x83, 0x33, 0xbc, 0x37};
  uint8_t bytesprops5[] = {0x70, 0xee, 0xb8, 0x2c, 0xec, 0x1b, 0xc9, 0x33, 0xc7, 0xfe, 0x84, 0xf6, 0x79, 0xbb,
                           0xaa, 0xd2, 0x7d, 0x21, 0xc,  0xa9, 0xf7, 0x54, 0xb8, 0x30, 0x46, 0x77, 0x8e};
  uint8_t bytesprops7[] = {0xa9, 0x34, 0x26, 0x74, 0x70, 0x38, 0x97, 0xb3, 0xb9};
  uint8_t bytesprops8[] = {0x1c, 0xe, 0x74, 0xdf, 0xe5, 0x52, 0xff};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5697}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 52}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 24790}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops0}, .v = {0, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops5}, .v = {24, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13893}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30246}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19007}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {7, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24216}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 139}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 11251}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30523}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26783}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 174}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22609, 11, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 5459 [("\167\&9\128\201\254\251f\154)\222\SYN\n\182w",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2}),("\v\244",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\NULV?\231o\214\r\141\181\DC4\236\139\166f\RS?B_",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("\134\198\224\203\182\223E\204\128l\208\172\156\"\246",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\170b\195j\211}D\139\ESC\192\ACK9!\244F\140&1\143W\DC1Qy\211",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS2}),("p\NULm,\228\200\DLE\134\191V\174\192\SOHm\145H\RS\US\177\SIt\\",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\SOH\251cC\207\239\246\&5\202\158\vi\196\&1",SubOptions {_retainHandling = DoNotSendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropTopicAlias 16179,PropSessionExpiryInterval
// 23734,PropMessageExpiryInterval 31667,PropServerReference "x-\231",PropRequestResponseInformation 128,PropContentType
// "\nR\215\219\165\142\208*\130\ACKh\ETX\202\179\141\150\165\252\173m\223p\139M^n\199>"]
TEST(Subscribe5QCTest, Encode27) {
  uint8_t pkt[] = {
      0x82, 0xb9, 0x1,  0x15, 0x53, 0x34, 0x23, 0x3f, 0x33, 0x11, 0x0,  0x0,  0x5c, 0xb6, 0x2,  0x0,  0x0,  0x7b, 0xb3,
      0x1c, 0x0,  0x3,  0x78, 0x2d, 0xe7, 0x19, 0x80, 0x3,  0x0,  0x1c, 0xa,  0x52, 0xd7, 0xdb, 0xa5, 0x8e, 0xd0, 0x2a,
      0x82, 0x6,  0x68, 0x3,  0xca, 0xb3, 0x8d, 0x96, 0xa5, 0xfc, 0xad, 0x6d, 0xdf, 0x70, 0x8b, 0x4d, 0x5e, 0x6e, 0xc7,
      0x3e, 0x0,  0xe,  0xa7, 0x39, 0x80, 0xc9, 0xfe, 0xfb, 0x66, 0x9a, 0x29, 0xde, 0x16, 0xa,  0xb6, 0x77, 0xe,  0x0,
      0x2,  0xb,  0xf4, 0x24, 0x0,  0x12, 0x0,  0x56, 0x3f, 0xe7, 0x6f, 0xd6, 0xd,  0x8d, 0xb5, 0x14, 0xec, 0x8b, 0xa6,
      0x66, 0x1e, 0x3f, 0x42, 0x5f, 0x16, 0x0,  0xf,  0x86, 0xc6, 0xe0, 0xcb, 0xb6, 0xdf, 0x45, 0xcc, 0x80, 0x6c, 0xd0,
      0xac, 0x9c, 0x22, 0xf6, 0x4,  0x0,  0x18, 0xaa, 0x62, 0xc3, 0x6a, 0xd3, 0x7d, 0x44, 0x8b, 0x1b, 0xc0, 0x6,  0x39,
      0x21, 0xf4, 0x46, 0x8c, 0x26, 0x31, 0x8f, 0x57, 0x11, 0x51, 0x79, 0xd3, 0x6,  0x0,  0x16, 0x70, 0x0,  0x6d, 0x2c,
      0xe4, 0xc8, 0x10, 0x86, 0xbf, 0x56, 0xae, 0xc0, 0x1,  0x6d, 0x91, 0x48, 0x1e, 0x1f, 0xb1, 0xf,  0x74, 0x5c, 0x1d,
      0x0,  0xe,  0x1,  0xfb, 0x63, 0x43, 0xcf, 0xef, 0xf6, 0x35, 0xca, 0x9e, 0xb,  0x69, 0xc4, 0x31, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xa7, 0x39, 0x80, 0xc9, 0xfe, 0xfb, 0x66, 0x9a, 0x29, 0xde, 0x16, 0xa, 0xb6, 0x77};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb, 0xf4};
  lwmqtt_string_t topic_filter_s1 = {2, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x0,  0x56, 0x3f, 0xe7, 0x6f, 0xd6, 0xd,  0x8d, 0xb5,
                                     0x14, 0xec, 0x8b, 0xa6, 0x66, 0x1e, 0x3f, 0x42, 0x5f};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x86, 0xc6, 0xe0, 0xcb, 0xb6, 0xdf, 0x45, 0xcc,
                                     0x80, 0x6c, 0xd0, 0xac, 0x9c, 0x22, 0xf6};
  lwmqtt_string_t topic_filter_s3 = {15, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xaa, 0x62, 0xc3, 0x6a, 0xd3, 0x7d, 0x44, 0x8b, 0x1b, 0xc0, 0x6,  0x39,
                                     0x21, 0xf4, 0x46, 0x8c, 0x26, 0x31, 0x8f, 0x57, 0x11, 0x51, 0x79, 0xd3};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x70, 0x0, 0x6d, 0x2c, 0xe4, 0xc8, 0x10, 0x86, 0xbf, 0x56, 0xae,
                                     0xc0, 0x1, 0x6d, 0x91, 0x48, 0x1e, 0x1f, 0xb1, 0xf,  0x74, 0x5c};
  lwmqtt_string_t topic_filter_s5 = {22, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1, 0xfb, 0x63, 0x43, 0xcf, 0xef, 0xf6, 0x35, 0xca, 0x9e, 0xb, 0x69, 0xc4, 0x31};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  lwmqtt_sub_options_t sub_opts[7];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = true;
  sub_opts[2].qos = LWMQTT_QOS2;
  sub_opts[2].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS0;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = true;
  sub_opts[5].qos = LWMQTT_QOS1;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  sub_opts[6].qos = LWMQTT_QOS2;
  sub_opts[6].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[6].retain_as_published = true;
  sub_opts[6].no_local = true;
  uint8_t bytesprops0[] = {0x78, 0x2d, 0xe7};
  uint8_t bytesprops1[] = {0xa,  0x52, 0xd7, 0xdb, 0xa5, 0x8e, 0xd0, 0x2a, 0x82, 0x6,  0x68, 0x3,  0xca, 0xb3,
                           0x8d, 0x96, 0xa5, 0xfc, 0xad, 0x6d, 0xdf, 0x70, 0x8b, 0x4d, 0x5e, 0x6e, 0xc7, 0x3e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 16179}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 23734}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31667}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {28, (char*)&bytesprops1}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5459, 7, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 21650
// [("\144\143\250\181?\222c\242\195\194iT\235\216\230\207\176(\169\205\175g\RS\221}V\US\206\228\167",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS2}),("r\242Fl\STX\222\224\199\213\254?\253\b\n\241\ESC\137f\252\ETX",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = False, _subQoS = QoS0}),("",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = True, _subQoS =
// QoS0}),("\188\213\&9\219v$\165F\194\195\157\155\193\DC2y\EM",SubOptions {_retainHandling = SendOnSubscribeNew,
// _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("Yk\181r6Q\f\148l\155\151\149\206I\133\&8\SOH\SOH\148\SUBaQ",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = False, _subQoS = QoS2}),("D\191",SubOptions {_retainHandling =
// SendOnSubscribeNew, _retainAsPublished = True, _noLocal = True, _subQoS = QoS2})] [PropReasonString "\137Iy\133
// {*\EOT\v5\226\234\221\165\f",PropReasonString
// "\173\224=Tg\214o\ETXDLb\156t]t\ESCs\254]\DLE.",PropMessageExpiryInterval 4602,PropSessionExpiryInterval
// 17637,PropUserProperty "\207\190\248z6"
// "a\176\146]+\EOT\192h\NUL\165\248\229\249\183\200FI\157`\255\170\200\DC3\151\135\ENQ",PropAuthenticationData
// "\174A\SUB\182]\191\215,\167\DC2\US\227\ESC\182cJq\235!Y\158\v&\164\175\225O\233\210\157",PropRequestProblemInformation
// 120,PropWillDelayInterval 1152,PropMaximumPacketSize 13603,PropPayloadFormatIndicator 70,PropMaximumPacketSize
// 17285,PropContentType "2>D\246\r\139;A\182D s\254\207",PropResponseInformation "\185",PropAssignedClientIdentifier
// "\234!~]\191H\214"]
TEST(Subscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0x82, 0x9b, 0x2,  0x54, 0x92, 0xab, 0x1,  0x1f, 0x0,  0xf,  0x89, 0x49, 0x79, 0x85, 0x20, 0x7b, 0x2a,
                   0x4,  0xb,  0x35, 0xe2, 0xea, 0xdd, 0xa5, 0xc,  0x1f, 0x0,  0x15, 0xad, 0xe0, 0x3d, 0x54, 0x67, 0xd6,
                   0x6f, 0x3,  0x44, 0x4c, 0x62, 0x9c, 0x74, 0x5d, 0x74, 0x1b, 0x73, 0xfe, 0x5d, 0x10, 0x2e, 0x2,  0x0,
                   0x0,  0x11, 0xfa, 0x11, 0x0,  0x0,  0x44, 0xe5, 0x26, 0x0,  0x5,  0xcf, 0xbe, 0xf8, 0x7a, 0x36, 0x0,
                   0x1a, 0x61, 0xb0, 0x92, 0x5d, 0x2b, 0x4,  0xc0, 0x68, 0x0,  0xa5, 0xf8, 0xe5, 0xf9, 0xb7, 0xc8, 0x46,
                   0x49, 0x9d, 0x60, 0xff, 0xaa, 0xc8, 0x13, 0x97, 0x87, 0x5,  0x16, 0x0,  0x1e, 0xae, 0x41, 0x1a, 0xb6,
                   0x5d, 0xbf, 0xd7, 0x2c, 0xa7, 0x12, 0x1f, 0xe3, 0x1b, 0xb6, 0x63, 0x4a, 0x71, 0xeb, 0x21, 0x59, 0x9e,
                   0xb,  0x26, 0xa4, 0xaf, 0xe1, 0x4f, 0xe9, 0xd2, 0x9d, 0x17, 0x78, 0x18, 0x0,  0x0,  0x4,  0x80, 0x27,
                   0x0,  0x0,  0x35, 0x23, 0x1,  0x46, 0x27, 0x0,  0x0,  0x43, 0x85, 0x3,  0x0,  0xe,  0x32, 0x3e, 0x44,
                   0xf6, 0xd,  0x8b, 0x3b, 0x41, 0xb6, 0x44, 0x20, 0x73, 0xfe, 0xcf, 0x1a, 0x0,  0x1,  0xb9, 0x12, 0x0,
                   0x7,  0xea, 0x21, 0x7e, 0x5d, 0xbf, 0x48, 0xd6, 0x0,  0x1e, 0x90, 0x8f, 0xfa, 0xb5, 0x3f, 0xde, 0x63,
                   0xf2, 0xc3, 0xc2, 0x69, 0x54, 0xeb, 0xd8, 0xe6, 0xcf, 0xb0, 0x28, 0xa9, 0xcd, 0xaf, 0x67, 0x1e, 0xdd,
                   0x7d, 0x56, 0x1f, 0xce, 0xe4, 0xa7, 0x2e, 0x0,  0x14, 0x72, 0xf2, 0x46, 0x6c, 0x2,  0xde, 0xe0, 0xc7,
                   0xd5, 0xfe, 0x3f, 0xfd, 0x8,  0xa,  0xf1, 0x1b, 0x89, 0x66, 0xfc, 0x3,  0x28, 0x0,  0x0,  0x24, 0x0,
                   0x10, 0xbc, 0xd5, 0x39, 0xdb, 0x76, 0x24, 0xa5, 0x46, 0xc2, 0xc3, 0x9d, 0x9b, 0xc1, 0x12, 0x79, 0x19,
                   0x1d, 0x0,  0x16, 0x59, 0x6b, 0xb5, 0x72, 0x36, 0x51, 0xc,  0x94, 0x6c, 0x9b, 0x97, 0x95, 0xce, 0x49,
                   0x85, 0x38, 0x1,  0x1,  0x94, 0x1a, 0x61, 0x51, 0xa,  0x0,  0x2,  0x44, 0xbf, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x90, 0x8f, 0xfa, 0xb5, 0x3f, 0xde, 0x63, 0xf2, 0xc3, 0xc2,
                                     0x69, 0x54, 0xeb, 0xd8, 0xe6, 0xcf, 0xb0, 0x28, 0xa9, 0xcd,
                                     0xaf, 0x67, 0x1e, 0xdd, 0x7d, 0x56, 0x1f, 0xce, 0xe4, 0xa7};
  lwmqtt_string_t topic_filter_s0 = {30, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x72, 0xf2, 0x46, 0x6c, 0x2,  0xde, 0xe0, 0xc7, 0xd5, 0xfe,
                                     0x3f, 0xfd, 0x8,  0xa,  0xf1, 0x1b, 0x89, 0x66, 0xfc, 0x3};
  lwmqtt_string_t topic_filter_s1 = {20, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0};
  lwmqtt_string_t topic_filter_s2 = {0, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xbc, 0xd5, 0x39, 0xdb, 0x76, 0x24, 0xa5, 0x46,
                                     0xc2, 0xc3, 0x9d, 0x9b, 0xc1, 0x12, 0x79, 0x19};
  lwmqtt_string_t topic_filter_s3 = {16, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x59, 0x6b, 0xb5, 0x72, 0x36, 0x51, 0xc, 0x94, 0x6c, 0x9b, 0x97,
                                     0x95, 0xce, 0x49, 0x85, 0x38, 0x1,  0x1, 0x94, 0x1a, 0x61, 0x51};
  lwmqtt_string_t topic_filter_s4 = {22, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x44, 0xbf};
  lwmqtt_string_t topic_filter_s5 = {2, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS2;
  sub_opts[0].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = true;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS0;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = false;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[3].retain_as_published = true;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = true;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0x89, 0x49, 0x79, 0x85, 0x20, 0x7b, 0x2a, 0x4, 0xb, 0x35, 0xe2, 0xea, 0xdd, 0xa5, 0xc};
  uint8_t bytesprops1[] = {0xad, 0xe0, 0x3d, 0x54, 0x67, 0xd6, 0x6f, 0x3,  0x44, 0x4c, 0x62,
                           0x9c, 0x74, 0x5d, 0x74, 0x1b, 0x73, 0xfe, 0x5d, 0x10, 0x2e};
  uint8_t bytesprops3[] = {0x61, 0xb0, 0x92, 0x5d, 0x2b, 0x4,  0xc0, 0x68, 0x0,  0xa5, 0xf8, 0xe5, 0xf9,
                           0xb7, 0xc8, 0x46, 0x49, 0x9d, 0x60, 0xff, 0xaa, 0xc8, 0x13, 0x97, 0x87, 0x5};
  uint8_t bytesprops2[] = {0xcf, 0xbe, 0xf8, 0x7a, 0x36};
  uint8_t bytesprops4[] = {0xae, 0x41, 0x1a, 0xb6, 0x5d, 0xbf, 0xd7, 0x2c, 0xa7, 0x12, 0x1f, 0xe3, 0x1b, 0xb6, 0x63,
                           0x4a, 0x71, 0xeb, 0x21, 0x59, 0x9e, 0xb,  0x26, 0xa4, 0xaf, 0xe1, 0x4f, 0xe9, 0xd2, 0x9d};
  uint8_t bytesprops5[] = {0x32, 0x3e, 0x44, 0xf6, 0xd, 0x8b, 0x3b, 0x41, 0xb6, 0x44, 0x20, 0x73, 0xfe, 0xcf};
  uint8_t bytesprops6[] = {0xb9};
  uint8_t bytesprops7[] = {0xea, 0x21, 0x7e, 0x5d, 0xbf, 0x48, 0xd6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4602}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17637}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops2}, .v = {26, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1152}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13603}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17285}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {14, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {7, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21650, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 15109 [("\175\231\162\204$\151/\218\&0m\229",SubOptions {_retainHandling = SendOnSubscribe,
// _retainAsPublished = True, _noLocal = True, _subQoS = QoS0})] [PropMaximumQoS 184,PropRequestProblemInformation
// 57,PropReasonString "[l3g\145n\246s",PropAuthenticationData "\NUL}\192\220",PropRetainAvailable 171,PropReasonString
// "8\130\150\188\246\243\SO\177\172\150\235,\255EsB\181\134+}",PropWillDelayInterval 4975]
TEST(Subscribe5QCTest, Encode29) {
  uint8_t pkt[] = {0x82, 0x45, 0x3b, 0x5,  0x34, 0x24, 0xb8, 0x17, 0x39, 0x1f, 0x0,  0x8,  0x5b, 0x6c, 0x33,
                   0x67, 0x91, 0x6e, 0xf6, 0x73, 0x16, 0x0,  0x4,  0x0,  0x7d, 0xc0, 0xdc, 0x25, 0xab, 0x1f,
                   0x0,  0x14, 0x38, 0x82, 0x96, 0xbc, 0xf6, 0xf3, 0xe,  0xb1, 0xac, 0x96, 0xeb, 0x2c, 0xff,
                   0x45, 0x73, 0x42, 0xb5, 0x86, 0x2b, 0x7d, 0x18, 0x0,  0x0,  0x13, 0x6f, 0x0,  0xb,  0xaf,
                   0xe7, 0xa2, 0xcc, 0x24, 0x97, 0x2f, 0xda, 0x30, 0x6d, 0xe5, 0xc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xaf, 0xe7, 0xa2, 0xcc, 0x24, 0x97, 0x2f, 0xda, 0x30, 0x6d, 0xe5};
  lwmqtt_string_t topic_filter_s0 = {11, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  lwmqtt_sub_options_t sub_opts[1];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = true;
  uint8_t bytesprops0[] = {0x5b, 0x6c, 0x33, 0x67, 0x91, 0x6e, 0xf6, 0x73};
  uint8_t bytesprops1[] = {0x0, 0x7d, 0xc0, 0xdc};
  uint8_t bytesprops2[] = {0x38, 0x82, 0x96, 0xbc, 0xf6, 0xf3, 0xe,  0xb1, 0xac, 0x96,
                           0xeb, 0x2c, 0xff, 0x45, 0x73, 0x42, 0xb5, 0x86, 0x2b, 0x7d};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 57}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {8, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 4975}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 15109, 1, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeRequest 31149 [("(\255\220",SubOptions {_retainHandling = SendOnSubscribeNew, _retainAsPublished = True,
// _noLocal = False, _subQoS = QoS0}),("nuB\184\220_5\217\196}\246\129",SubOptions {_retainHandling =
// DoNotSendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS = QoS0}),("\n?*\177\237",SubOptions
// {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal = True, _subQoS =
// QoS1}),("\166\247\163\135\239\140E\178R\230-\152",SubOptions {_retainHandling = SendOnSubscribe, _retainAsPublished =
// False, _noLocal = True, _subQoS = QoS1}),("z\250o\254y\a\a,\201+#\222\212\164\CAN\DC1\184\138\217",SubOptions
// {_retainHandling = SendOnSubscribe, _retainAsPublished = False, _noLocal = False, _subQoS =
// QoS2}),("\ESC\220\r4\ak\135",SubOptions {_retainHandling = DoNotSendOnSubscribe, _retainAsPublished = True, _noLocal
// = True, _subQoS = QoS2})] [PropPayloadFormatIndicator 79,PropSessionExpiryInterval
// 9736,PropSubscriptionIdentifierAvailable 116,PropPayloadFormatIndicator 214,PropRequestProblemInformation
// 5,PropServerReference "ri",PropCorrelationData "\214\216\SO\234M&\242\140\206\t\230",PropMessageExpiryInterval
// 17300,PropWillDelayInterval 32083,PropMaximumQoS 189]
TEST(Subscribe5QCTest, Encode30) {
  uint8_t pkt[] = {0x82, 0x7b, 0x79, 0xad, 0x2c, 0x1,  0x4f, 0x11, 0x0,  0x0,  0x26, 0x8,  0x29, 0x74, 0x1,  0xd6,
                   0x17, 0x5,  0x1c, 0x0,  0x2,  0x72, 0x69, 0x9,  0x0,  0xb,  0xd6, 0xd8, 0xe,  0xea, 0x4d, 0x26,
                   0xf2, 0x8c, 0xce, 0x9,  0xe6, 0x2,  0x0,  0x0,  0x43, 0x94, 0x18, 0x0,  0x0,  0x7d, 0x53, 0x24,
                   0xbd, 0x0,  0x3,  0x28, 0xff, 0xdc, 0x18, 0x0,  0xc,  0x6e, 0x75, 0x42, 0xb8, 0xdc, 0x5f, 0x35,
                   0xd9, 0xc4, 0x7d, 0xf6, 0x81, 0x20, 0x0,  0x5,  0xa,  0x3f, 0x2a, 0xb1, 0xed, 0x2d, 0x0,  0xc,
                   0xa6, 0xf7, 0xa3, 0x87, 0xef, 0x8c, 0x45, 0xb2, 0x52, 0xe6, 0x2d, 0x98, 0x5,  0x0,  0x13, 0x7a,
                   0xfa, 0x6f, 0xfe, 0x79, 0x7,  0x7,  0x2c, 0xc9, 0x2b, 0x23, 0xde, 0xd4, 0xa4, 0x18, 0x11, 0xb8,
                   0x8a, 0xd9, 0x2,  0x0,  0x7,  0x1b, 0xdc, 0xd,  0x34, 0x7,  0x6b, 0x87, 0x2e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x28, 0xff, 0xdc};
  lwmqtt_string_t topic_filter_s0 = {3, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x6e, 0x75, 0x42, 0xb8, 0xdc, 0x5f, 0x35, 0xd9, 0xc4, 0x7d, 0xf6, 0x81};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa, 0x3f, 0x2a, 0xb1, 0xed};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa6, 0xf7, 0xa3, 0x87, 0xef, 0x8c, 0x45, 0xb2, 0x52, 0xe6, 0x2d, 0x98};
  lwmqtt_string_t topic_filter_s3 = {12, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x7a, 0xfa, 0x6f, 0xfe, 0x79, 0x7,  0x7,  0x2c, 0xc9, 0x2b,
                                     0x23, 0xde, 0xd4, 0xa4, 0x18, 0x11, 0xb8, 0x8a, 0xd9};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x1b, 0xdc, 0xd, 0x34, 0x7, 0x6b, 0x87};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  lwmqtt_sub_options_t sub_opts[6];
  sub_opts[0].qos = LWMQTT_QOS0;
  sub_opts[0].retain_handling = LWMQTT_SUB_SEND_ON_SUB_NEW;
  sub_opts[0].retain_as_published = true;
  sub_opts[0].no_local = false;
  sub_opts[1].qos = LWMQTT_QOS0;
  sub_opts[1].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[1].retain_as_published = false;
  sub_opts[1].no_local = false;
  sub_opts[2].qos = LWMQTT_QOS1;
  sub_opts[2].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[2].retain_as_published = true;
  sub_opts[2].no_local = true;
  sub_opts[3].qos = LWMQTT_QOS1;
  sub_opts[3].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[3].retain_as_published = false;
  sub_opts[3].no_local = true;
  sub_opts[4].qos = LWMQTT_QOS2;
  sub_opts[4].retain_handling = LWMQTT_SUB_SEND_ON_SUB;
  sub_opts[4].retain_as_published = false;
  sub_opts[4].no_local = false;
  sub_opts[5].qos = LWMQTT_QOS2;
  sub_opts[5].retain_handling = LWMQTT_SUB_NO_SEND_ON_SUB;
  sub_opts[5].retain_as_published = true;
  sub_opts[5].no_local = true;
  uint8_t bytesprops0[] = {0x72, 0x69};
  uint8_t bytesprops1[] = {0xd6, 0xd8, 0xe, 0xea, 0x4d, 0x26, 0xf2, 0x8c, 0xce, 0x9, 0xe6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9736}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 116}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 214}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 5}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17300}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32083}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 189}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err =
      lwmqtt_encode_subscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 31149, 6, topic_filters, sub_opts, props);

  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// SubscribeResponse 13080 [Right QoS1,Right QoS0,Left SubErrNotAuthorized,Left SubErrNotAuthorized,Right QoS1,Right
// QoS1,Left SubErrPacketIdentifierInUse,Right QoS2,Right QoS2,Left SubErrTopicFilterInvalid,Right QoS0] []
TEST(SubACK311QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0xd, 0x33, 0x18, 0x1, 0x0, 0x87, 0x87, 0x1, 0x1, 0x91, 0x2, 0x2, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13080);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS0);
}

// SubscribeResponse 32460 [Left SubErrImplementationSpecificError,Right QoS2,Right QoS0,Left
// SubErrUnspecifiedError,Right QoS2,Left SubErrPacketIdentifierInUse,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Right QoS2,Right QoS1,Right QoS2] []
TEST(SubACK311QCTest, Decode2) {
  uint8_t pkt[] = {0x90, 0xd, 0x7e, 0xcc, 0x83, 0x2, 0x0, 0x80, 0x2, 0x91, 0x80, 0x80, 0x2, 0x1, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32460);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// SubscribeResponse 7819 [Right QoS2,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x5, 0x1e, 0x8b, 0x2, 0x1, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7819);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 17369 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0x5, 0x43, 0xd9, 0x2, 0x9e, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17369);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
}

// SubscribeResponse 14645 [Right QoS0,Left SubErrTopicFilterInvalid,Right QoS1,Left SubErrTopicFilterInvalid,Right
// QoS1,Right QoS2,Right QoS0] []
TEST(SubACK311QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x9, 0x39, 0x35, 0x0, 0x8f, 0x1, 0x8f, 0x1, 0x2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14645);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
}

// SubscribeResponse 12295 [Left SubErrPacketIdentifierInUse,Right QoS0,Left SubErrTopicFilterInvalid,Right QoS2] []
TEST(SubACK311QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0x6, 0x30, 0x7, 0x91, 0x0, 0x8f, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12295);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
}

// SubscribeResponse 10100 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS2,Right QoS2,Left
// SubErrPacketIdentifierInUse,Right QoS2,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0xd, 0x27, 0x74, 0xa1, 0x0, 0x0, 0xa2, 0x80, 0x2, 0x2, 0x91, 0x2, 0x97, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10100);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 19212 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Left
// SubErrImplementationSpecificError,Right QoS0,Right QoS2,Right QoS0,Left SubErrPacketIdentifierInUse] []
TEST(SubACK311QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0x9, 0x4b, 0xc, 0xa1, 0x1, 0x83, 0x0, 0x2, 0x0, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19212);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 31570 [Left SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0x3, 0x7b, 0x52, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31570);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
}

// SubscribeResponse 15416 [Right QoS1,Left SubErrQuotaExceeded,Left SubErrTopicFilterInvalid,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0x7, 0x3c, 0x38, 0x1, 0x97, 0x8f, 0x1, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15416);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 24411 [Right QoS2,Left SubErrImplementationSpecificError,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse]
// []
TEST(SubACK311QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0x7, 0x5f, 0x5b, 0x2, 0x83, 0x9e, 0xa2, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24411);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
}

// SubscribeResponse 16797 [Right QoS0,Right QoS0,Right QoS1,Right QoS2,Left SubErrUnspecifiedError,Right QoS0,Right
// QoS0,Left SubErrSharedSubscriptionsNotSupported,Left SubErrNotAuthorized,Left
// SubErrSubscriptionIdentifiersNotSupported] []
TEST(SubACK311QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0xc, 0x41, 0x9d, 0x0, 0x0, 0x1, 0x2, 0x80, 0x0, 0x0, 0x9e, 0x87, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16797);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
}

// SubscribeResponse 8011 [Right QoS0,Right QoS2,Right QoS2,Left SubErrTopicFilterInvalid,Left
// SubErrTopicFilterInvalid,Right QoS2] []
TEST(SubACK311QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0x8, 0x1f, 0x4b, 0x0, 0x2, 0x2, 0x8f, 0x8f, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8011);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
}

// SubscribeResponse 32745 [Right QoS0,Right QoS2,Right QoS1,Left SubErrNotAuthorized,Right QoS0,Right QoS2,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS2] []
TEST(SubACK311QCTest, Decode14) {
  uint8_t pkt[] = {0x90, 0xa, 0x7f, 0xe9, 0x0, 0x2, 0x1, 0x87, 0x0, 0x2, 0xa2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32745);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 8548 [Right QoS1,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS0] []
TEST(SubACK311QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0x7, 0x21, 0x64, 0x1, 0x2, 0xa2, 0xa2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8548);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
}

// SubscribeResponse 12279 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Right QoS1,Left
// SubErrTopicFilterInvalid] []
TEST(SubACK311QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0x6, 0x2f, 0xf7, 0x2, 0x9e, 0x1, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12279);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
}

// SubscribeResponse 8001 [Right QoS2,Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS2,Left
// SubErrNotAuthorized,Left SubErrWildcardSubscriptionsNotSupported] []
TEST(SubACK311QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x9, 0x1f, 0x41, 0x2, 0x0, 0xa2, 0x2, 0x2, 0x87, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8001);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 4988 [Left SubErrTopicFilterInvalid,Right QoS0,Left SubErrNotAuthorized,Left
// SubErrImplementationSpecificError,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS2] []
TEST(SubACK311QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0xd, 0x13, 0x7c, 0x8f, 0x0, 0x87, 0x83, 0xa2, 0x9e, 0x0, 0xa1, 0x9e, 0x1, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4988);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// SubscribeResponse 6982 [Right QoS0,Left SubErrTopicFilterInvalid,Left SubErrQuotaExceeded,Left
// SubErrUnspecifiedError,Left SubErrNotAuthorized,Right QoS2,Right QoS0,Right QoS1,Left SubErrTopicFilterInvalid,Left
// SubErrTopicFilterInvalid,Right QoS0] []
TEST(SubACK311QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0xd, 0x1b, 0x46, 0x0, 0x8f, 0x97, 0x80, 0x87, 0x2, 0x0, 0x1, 0x8f, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6982);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS0);
}

// SubscribeResponse 25134 [Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrImplementationSpecificError,Right
// QoS2,Left SubErrNotAuthorized,Right QoS0,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrQuotaExceeded] []
TEST(SubACK311QCTest, Decode20) {
  uint8_t pkt[] = {0x90, 0xa, 0x62, 0x2e, 0xa1, 0x83, 0x2, 0x87, 0x0, 0x2, 0xa2, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25134);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
}

// SubscribeResponse 25090 [Left SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrQuotaExceeded,Left SubErrTopicFilterInvalid,Left SubErrImplementationSpecificError,Right QoS1,Left
// SubErrPacketIdentifierInUse] []
TEST(SubACK311QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x9, 0x62, 0x2, 0x80, 0xa2, 0x97, 0x8f, 0x83, 0x1, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25090);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
}

// SubscribeResponse 270 [Left SubErrPacketIdentifierInUse,Right QoS0,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrUnspecifiedError] []
TEST(SubACK311QCTest, Decode22) {
  uint8_t pkt[] = {0x90, 0xc, 0x1, 0xe, 0x91, 0x0, 0x0, 0xa2, 0x1, 0xa1, 0xa1, 0x0, 0xa1, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 270);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
}

// SubscribeResponse 28717 [Right QoS0,Left SubErrQuotaExceeded,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS2,Right QoS1,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0xa, 0x70, 0x2d, 0x0, 0x97, 0xa2, 0x91, 0x2, 0x1, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28717);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 8736 [Right QoS1,Right QoS2,Left SubErrImplementationSpecificError,Right QoS2,Right QoS0,Right
// QoS1] []
TEST(SubACK311QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x8, 0x22, 0x20, 0x1, 0x2, 0x83, 0x2, 0x0, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8736);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 27132 [Left SubErrWildcardSubscriptionsNotSupported,Left SubErrImplementationSpecificError,Right
// QoS0] []
TEST(SubACK311QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x5, 0x69, 0xfc, 0xa2, 0x83, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27132);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
}

// SubscribeResponse 20260 [Right QoS2,Left SubErrPacketIdentifierInUse,Right QoS0,Right QoS2,Right QoS1,Right QoS1] []
TEST(SubACK311QCTest, Decode26) {
  uint8_t pkt[] = {0x90, 0x8, 0x4f, 0x24, 0x2, 0x91, 0x0, 0x2, 0x1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20260);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 471 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Right QoS0,Left
// SubErrNotAuthorized,Right QoS2,Left SubErrImplementationSpecificError,Right QoS1,Right QoS1] []
TEST(SubACK311QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0xa, 0x1, 0xd7, 0x9e, 0x0, 0x0, 0x87, 0x2, 0x83, 0x1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 471);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
}

// SubscribeResponse 21021 [Right QoS1,Right QoS2,Right QoS2,Right QoS2] []
TEST(SubACK311QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x6, 0x52, 0x1d, 0x1, 0x2, 0x2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21021);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
}

// SubscribeResponse 3050 [Right QoS2,Left SubErrPacketIdentifierInUse,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Left SubErrSharedSubscriptionsNotSupported,Right QoS0] []
TEST(SubACK311QCTest, Decode29) {
  uint8_t pkt[] = {0x90, 0x9, 0xb, 0xea, 0x2, 0x91, 0x80, 0x80, 0x91, 0x9e, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3050);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
}

// SubscribeResponse 9426 [Left SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS1,Right QoS1,Left SubErrImplementationSpecificError,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrTopicFilterInvalid,Right QoS0,Right QoS2] []
TEST(SubACK311QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0xd, 0x24, 0xd2, 0x80, 0xa2, 0xa2, 0x1, 0x1, 0x83, 0xa2, 0x9e, 0x8f, 0x0, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT311, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9426);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0x80);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x80);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], 0x80);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// SubscribeResponse 13080 [Right QoS1,Right QoS0,Left SubErrNotAuthorized,Left SubErrNotAuthorized,Right QoS1,Right
// QoS1,Left SubErrPacketIdentifierInUse,Right QoS2,Right QoS2,Left SubErrTopicFilterInvalid,Right QoS0]
// [PropCorrelationData "\242'L\238\DC3t{\175QVr\STX+\r\195\172\187h\202_\"\142\b\170i{\234\221F\212",PropContentType
// "|]w\253\nFy\252]Vf\254\239?j\197\193\237\vj\174\137\&3L",PropWillDelayInterval 11256,PropMaximumPacketSize
// 14054,PropMaximumPacketSize 28209,PropReasonString "3\159\r",PropWildcardSubscriptionAvailable
// 206,PropSessionExpiryInterval 11090,PropAssignedClientIdentifier "\182V@\252\178\185\166#(\145\&0SP\176\188\EM
// w-\r\230oG\ACK",PropCorrelationData
// "\132\142GK\176\169\216\139\ENQ\145\221Y\249.\186\&1i\142\151\195\244\201\218\&6\176\215\STX",PropSharedSubscriptionAvailable
// 213,PropMessageExpiryInterval 1156,PropMaximumPacketSize 5568,PropSubscriptionIdentifier
// 0,PropRequestResponseInformation 243,PropMessageExpiryInterval 28104]
TEST(SubACK5QCTest, Decode1) {
  uint8_t pkt[] = {0x90, 0xb5, 0x1,  0x33, 0x18, 0xa6, 0x1,  0x9,  0x0,  0x1e, 0xf2, 0x27, 0x4c, 0xee, 0x13, 0x74, 0x7b,
                   0xaf, 0x51, 0x56, 0x72, 0x2,  0x2b, 0xd,  0xc3, 0xac, 0xbb, 0x68, 0xca, 0x5f, 0x22, 0x8e, 0x8,  0xaa,
                   0x69, 0x7b, 0xea, 0xdd, 0x46, 0xd4, 0x3,  0x0,  0x18, 0x7c, 0x5d, 0x77, 0xfd, 0xa,  0x46, 0x79, 0xfc,
                   0x5d, 0x56, 0x66, 0xfe, 0xef, 0x3f, 0x6a, 0xc5, 0xc1, 0xed, 0xb,  0x6a, 0xae, 0x89, 0x33, 0x4c, 0x18,
                   0x0,  0x0,  0x2b, 0xf8, 0x27, 0x0,  0x0,  0x36, 0xe6, 0x27, 0x0,  0x0,  0x6e, 0x31, 0x1f, 0x0,  0x3,
                   0x33, 0x9f, 0xd,  0x28, 0xce, 0x11, 0x0,  0x0,  0x2b, 0x52, 0x12, 0x0,  0x18, 0xb6, 0x56, 0x40, 0xfc,
                   0xb2, 0xb9, 0xa6, 0x23, 0x28, 0x91, 0x30, 0x53, 0x50, 0xb0, 0xbc, 0x19, 0x20, 0x77, 0x2d, 0xd,  0xe6,
                   0x6f, 0x47, 0x6,  0x9,  0x0,  0x1b, 0x84, 0x8e, 0x47, 0x4b, 0xb0, 0xa9, 0xd8, 0x8b, 0x5,  0x91, 0xdd,
                   0x59, 0xf9, 0x2e, 0xba, 0x31, 0x69, 0x8e, 0x97, 0xc3, 0xf4, 0xc9, 0xda, 0x36, 0xb0, 0xd7, 0x2,  0x2a,
                   0xd5, 0x2,  0x0,  0x0,  0x4,  0x84, 0x27, 0x0,  0x0,  0x15, 0xc0, 0xb,  0x0,  0x19, 0xf3, 0x2,  0x0,
                   0x0,  0x6d, 0xc8, 0x1,  0x0,  0x87, 0x87, 0x1,  0x1,  0x91, 0x2,  0x2,  0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 13080);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x91);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], 0x8F);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS0);
}

// SubscribeResponse 32460 [Left SubErrImplementationSpecificError,Right QoS2,Right QoS0,Left
// SubErrUnspecifiedError,Right QoS2,Left SubErrPacketIdentifierInUse,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Right QoS2,Right QoS1,Right QoS2] [PropMaximumQoS 184,PropWildcardSubscriptionAvailable
// 136,PropTopicAliasMaximum 16792,PropWildcardSubscriptionAvailable 177,PropSubscriptionIdentifier 21,PropReasonString
// "\216\246$\243\ESC\190(\179\180\220\135QI\131\160,\SO\198\168\DLE{\151",PropReasonString
// "\140[F\192\171\&9\CAN\DC1\DC4\225\DELQ\156#",PropUserProperty
// "\242\181k\SO\206\166S\157\246\231e\136\202\187\180\151\r\204x9(\202\129\b\194\b\EOT"
// "\160\161\254z\252\150\169\170,)\141\EM\207\147\158\169\137\133\SOH\210\220)\137P\SOHR\229\&1",PropMaximumPacketSize
// 30976,PropPayloadFormatIndicator 118,PropServerKeepAlive 29125,PropReceiveMaximum 14366,PropPayloadFormatIndicator
// 42,PropResponseInformation "\135f+\177j\SO\RS\191T\129g\195\214!\222",PropAssignedClientIdentifier
// "&+\142o\220\&6\FS\202;\151\204\USq\SI\241/\167\164\GS\\gOS\225\a",PropSharedSubscriptionAvailable 67,PropTopicAlias
// 504,PropMessageExpiryInterval 13989,PropAssignedClientIdentifier
// ",\197/\196\SYN\220/\208\160\229\&9e\170Zt\156\139\185",PropResponseTopic "[\tY",PropReasonString
// "h\172\STXi\153y\139@\128u\FS9\138%\230\158$6p\128\163\&5\228P\132h|Po\DC1",PropAuthenticationMethod
// "\251G\217\188\154\GS",PropWillDelayInterval 23086]
TEST(SubACK5QCTest, Decode2) {
  uint8_t pkt[] = {
      0x90, 0x91, 0x2,  0x7e, 0xcc, 0x82, 0x2,  0x24, 0xb8, 0x28, 0x88, 0x22, 0x41, 0x98, 0x28, 0xb1, 0xb,  0x15, 0x1f,
      0x0,  0x16, 0xd8, 0xf6, 0x24, 0xf3, 0x1b, 0xbe, 0x28, 0xb3, 0xb4, 0xdc, 0x87, 0x51, 0x49, 0x83, 0xa0, 0x2c, 0xe,
      0xc6, 0xa8, 0x10, 0x7b, 0x97, 0x1f, 0x0,  0xe,  0x8c, 0x5b, 0x46, 0xc0, 0xab, 0x39, 0x18, 0x11, 0x14, 0xe1, 0x7f,
      0x51, 0x9c, 0x23, 0x26, 0x0,  0x1b, 0xf2, 0xb5, 0x6b, 0xe,  0xce, 0xa6, 0x53, 0x9d, 0xf6, 0xe7, 0x65, 0x88, 0xca,
      0xbb, 0xb4, 0x97, 0xd,  0xcc, 0x78, 0x39, 0x28, 0xca, 0x81, 0x8,  0xc2, 0x8,  0x4,  0x0,  0x1c, 0xa0, 0xa1, 0xfe,
      0x7a, 0xfc, 0x96, 0xa9, 0xaa, 0x2c, 0x29, 0x8d, 0x19, 0xcf, 0x93, 0x9e, 0xa9, 0x89, 0x85, 0x1,  0xd2, 0xdc, 0x29,
      0x89, 0x50, 0x1,  0x52, 0xe5, 0x31, 0x27, 0x0,  0x0,  0x79, 0x0,  0x1,  0x76, 0x13, 0x71, 0xc5, 0x21, 0x38, 0x1e,
      0x1,  0x2a, 0x1a, 0x0,  0xf,  0x87, 0x66, 0x2b, 0xb1, 0x6a, 0xe,  0x1e, 0xbf, 0x54, 0x81, 0x67, 0xc3, 0xd6, 0x21,
      0xde, 0x12, 0x0,  0x19, 0x26, 0x2b, 0x8e, 0x6f, 0xdc, 0x36, 0x1c, 0xca, 0x3b, 0x97, 0xcc, 0x1f, 0x71, 0xf,  0xf1,
      0x2f, 0xa7, 0xa4, 0x1d, 0x5c, 0x67, 0x4f, 0x53, 0xe1, 0x7,  0x2a, 0x43, 0x23, 0x1,  0xf8, 0x2,  0x0,  0x0,  0x36,
      0xa5, 0x12, 0x0,  0x12, 0x2c, 0xc5, 0x2f, 0xc4, 0x16, 0xdc, 0x2f, 0xd0, 0xa0, 0xe5, 0x39, 0x65, 0xaa, 0x5a, 0x74,
      0x9c, 0x8b, 0xb9, 0x8,  0x0,  0x3,  0x5b, 0x9,  0x59, 0x1f, 0x0,  0x1e, 0x68, 0xac, 0x2,  0x69, 0x99, 0x79, 0x8b,
      0x40, 0x80, 0x75, 0x1c, 0x39, 0x8a, 0x25, 0xe6, 0x9e, 0x24, 0x36, 0x70, 0x80, 0xa3, 0x35, 0xe4, 0x50, 0x84, 0x68,
      0x7c, 0x50, 0x6f, 0x11, 0x15, 0x0,  0x6,  0xfb, 0x47, 0xd9, 0xbc, 0x9a, 0x1d, 0x18, 0x0,  0x0,  0x5a, 0x2e, 0x83,
      0x2,  0x0,  0x80, 0x2,  0x91, 0x80, 0x80, 0x2,  0x1,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32460);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x83);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x91);
  EXPECT_EQ(granted_qos_levels[6], 0x80);
  EXPECT_EQ(granted_qos_levels[7], 0x80);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// SubscribeResponse 7819 [Right QoS2,Right QoS1,Left SubErrWildcardSubscriptionsNotSupported]
// [PropSharedSubscriptionAvailable 150,PropSubscriptionIdentifierAvailable 160,PropServerKeepAlive
// 19557,PropRequestResponseInformation 138,PropAuthenticationMethod
// "\236\145\214\235\210\190\189S1l\166\246\225\173'\f\224\161\191\166\201[\STX\210^",PropTopicAlias
// 24707,PropMaximumPacketSize 20799,PropContentType
// "\207\aE\227\201(\194\NUL\226\a_w\245\&9\129\254$\221\233\231\&9\253\&8h\240\GS\135.\247\150",PropMaximumQoS
// 31,PropRequestResponseInformation 6,PropCorrelationData
// "\SI\td\SYN\131\190\187\\\198\140\222\214\169\253+\f\t\192\DC2(\SOH\186\146\214\ETX%\218",PropReceiveMaximum 29138]
TEST(SubACK5QCTest, Decode3) {
  uint8_t pkt[] = {0x90, 0x79, 0x1e, 0x8b, 0x73, 0x2a, 0x96, 0x29, 0xa0, 0x13, 0x4c, 0x65, 0x19, 0x8a, 0x15, 0x0,
                   0x19, 0xec, 0x91, 0xd6, 0xeb, 0xd2, 0xbe, 0xbd, 0x53, 0x31, 0x6c, 0xa6, 0xf6, 0xe1, 0xad, 0x27,
                   0xc,  0xe0, 0xa1, 0xbf, 0xa6, 0xc9, 0x5b, 0x2,  0xd2, 0x5e, 0x23, 0x60, 0x83, 0x27, 0x0,  0x0,
                   0x51, 0x3f, 0x3,  0x0,  0x1e, 0xcf, 0x7,  0x45, 0xe3, 0xc9, 0x28, 0xc2, 0x0,  0xe2, 0x7,  0x5f,
                   0x77, 0xf5, 0x39, 0x81, 0xfe, 0x24, 0xdd, 0xe9, 0xe7, 0x39, 0xfd, 0x38, 0x68, 0xf0, 0x1d, 0x87,
                   0x2e, 0xf7, 0x96, 0x24, 0x1f, 0x19, 0x6,  0x9,  0x0,  0x1b, 0xf,  0x9,  0x64, 0x16, 0x83, 0xbe,
                   0xbb, 0x5c, 0xc6, 0x8c, 0xde, 0xd6, 0xa9, 0xfd, 0x2b, 0xc,  0x9,  0xc0, 0x12, 0x28, 0x1,  0xba,
                   0x92, 0xd6, 0x3,  0x25, 0xda, 0x21, 0x71, 0xd2, 0x2,  0x1,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 7819);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
}

// SubscribeResponse 17369 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Left SubErrTopicFilterInvalid]
// [PropCorrelationData "\152!\DC2\241\205co\n\153l\STX\GS\158\DC1pO\217",PropRequestProblemInformation
// 23,PropRetainAvailable 158,PropSharedSubscriptionAvailable 40,PropRetainAvailable
// 138,PropWildcardSubscriptionAvailable 241,PropSessionExpiryInterval 14344,PropReceiveMaximum
// 20784,PropServerKeepAlive 559,PropServerReference ">\252\161\243\143O\DLE\165\147|\215\DC2+",PropContentType
// "\203\248\228\192\212|\EM\213\234%\165\DEL\211\237\224\211\GS{`PV\128\185`\165\EOT",PropSubscriptionIdentifierAvailable
// 49,PropResponseInformation "dsHa\206\179>\216\217\222\190O\247\DC3\DC3",PropResponseTopic
// "L\234Q\188\186\224\132\151:X\EOTj\227 \176\242\175C\ACKSp\215",PropTopicAlias 22362,PropTopicAlias
// 11639,PropWillDelayInterval 30787,PropSubscriptionIdentifierAvailable 2,PropResponseTopic
// "\187\222\&2\ACKh`\243P\ACK*\STX\225\r",PropSubscriptionIdentifierAvailable 171,PropServerReference "\137@\220"]
TEST(SubACK5QCTest, Decode4) {
  uint8_t pkt[] = {0x90, 0xaf, 0x1,  0x43, 0xd9, 0xa8, 0x1,  0x9,  0x0,  0x11, 0x98, 0x21, 0x12, 0xf1, 0xcd, 0x63, 0x6f,
                   0xa,  0x99, 0x6c, 0x2,  0x1d, 0x9e, 0x11, 0x70, 0x4f, 0xd9, 0x17, 0x17, 0x25, 0x9e, 0x2a, 0x28, 0x25,
                   0x8a, 0x28, 0xf1, 0x11, 0x0,  0x0,  0x38, 0x8,  0x21, 0x51, 0x30, 0x13, 0x2,  0x2f, 0x1c, 0x0,  0xd,
                   0x3e, 0xfc, 0xa1, 0xf3, 0x8f, 0x4f, 0x10, 0xa5, 0x93, 0x7c, 0xd7, 0x12, 0x2b, 0x3,  0x0,  0x1a, 0xcb,
                   0xf8, 0xe4, 0xc0, 0xd4, 0x7c, 0x19, 0xd5, 0xea, 0x25, 0xa5, 0x7f, 0xd3, 0xed, 0xe0, 0xd3, 0x1d, 0x7b,
                   0x60, 0x50, 0x56, 0x80, 0xb9, 0x60, 0xa5, 0x4,  0x29, 0x31, 0x1a, 0x0,  0xf,  0x64, 0x73, 0x48, 0x61,
                   0xce, 0xb3, 0x3e, 0xd8, 0xd9, 0xde, 0xbe, 0x4f, 0xf7, 0x13, 0x13, 0x8,  0x0,  0x16, 0x4c, 0xea, 0x51,
                   0xbc, 0xba, 0xe0, 0x84, 0x97, 0x3a, 0x58, 0x4,  0x6a, 0xe3, 0x20, 0xb0, 0xf2, 0xaf, 0x43, 0x6,  0x53,
                   0x70, 0xd7, 0x23, 0x57, 0x5a, 0x23, 0x2d, 0x77, 0x18, 0x0,  0x0,  0x78, 0x43, 0x29, 0x2,  0x8,  0x0,
                   0xd,  0xbb, 0xde, 0x32, 0x6,  0x68, 0x60, 0xf3, 0x50, 0x6,  0x2a, 0x2,  0xe1, 0xd,  0x29, 0xab, 0x1c,
                   0x0,  0x3,  0x89, 0x40, 0xdc, 0x2,  0x9e, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 17369);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
}

// SubscribeResponse 14645 [Right QoS0,Left SubErrTopicFilterInvalid,Right QoS1,Left SubErrTopicFilterInvalid,Right
// QoS1,Right QoS2,Right QoS0] [PropCorrelationData
// "\179\182\172\210\RS\221\243<O\194\251\163\138\144\130\216\255\204\197\171\211",PropWildcardSubscriptionAvailable
// 186,PropSubscriptionIdentifierAvailable 219,PropRequestProblemInformation 71,PropSessionExpiryInterval
// 7681,PropRetainAvailable 37,PropWillDelayInterval 3337,PropAssignedClientIdentifier
// "}}\162\GSq\179i\163Gj\251\134\252\145\DC1",PropRetainAvailable 197,PropRequestResponseInformation
// 138,PropMaximumPacketSize 19492,PropAuthenticationData
// "nt\f\251\rL\222\233\&3\188%_\141\STX&\243\CAN\f\187\135",PropRequestResponseInformation
// 120,PropWildcardSubscriptionAvailable 74,PropMaximumPacketSize 16777,PropSubscriptionIdentifierAvailable
// 220,PropMaximumQoS 111,PropMessageExpiryInterval 16305,PropCorrelationData
// "\231}\253\200\188\145\141S\208\139c\252\129\198\b^@\DC3\DC2\SOHi\179\222\147\235A\169",PropPayloadFormatIndicator
// 102]
TEST(SubACK5QCTest, Decode5) {
  uint8_t pkt[] = {0x90, 0x99, 0x1,  0x39, 0x35, 0x8e, 0x1,  0x9,  0x0,  0x15, 0xb3, 0xb6, 0xac, 0xd2, 0x1e, 0xdd,
                   0xf3, 0x3c, 0x4f, 0xc2, 0xfb, 0xa3, 0x8a, 0x90, 0x82, 0xd8, 0xff, 0xcc, 0xc5, 0xab, 0xd3, 0x28,
                   0xba, 0x29, 0xdb, 0x17, 0x47, 0x11, 0x0,  0x0,  0x1e, 0x1,  0x25, 0x25, 0x18, 0x0,  0x0,  0xd,
                   0x9,  0x12, 0x0,  0xf,  0x7d, 0x7d, 0xa2, 0x1d, 0x71, 0xb3, 0x69, 0xa3, 0x47, 0x6a, 0xfb, 0x86,
                   0xfc, 0x91, 0x11, 0x25, 0xc5, 0x19, 0x8a, 0x27, 0x0,  0x0,  0x4c, 0x24, 0x16, 0x0,  0x14, 0x6e,
                   0x74, 0xc,  0xfb, 0xd,  0x4c, 0xde, 0xe9, 0x33, 0xbc, 0x25, 0x5f, 0x8d, 0x2,  0x26, 0xf3, 0x18,
                   0xc,  0xbb, 0x87, 0x19, 0x78, 0x28, 0x4a, 0x27, 0x0,  0x0,  0x41, 0x89, 0x29, 0xdc, 0x24, 0x6f,
                   0x2,  0x0,  0x0,  0x3f, 0xb1, 0x9,  0x0,  0x1b, 0xe7, 0x7d, 0xfd, 0xc8, 0xbc, 0x91, 0x8d, 0x53,
                   0xd0, 0x8b, 0x63, 0xfc, 0x81, 0xc6, 0x8,  0x5e, 0x40, 0x13, 0x12, 0x1,  0x69, 0xb3, 0xde, 0x93,
                   0xeb, 0x41, 0xa9, 0x1,  0x66, 0x0,  0x8f, 0x1,  0x8f, 0x1,  0x2,  0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 14645);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x8F);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
}

// SubscribeResponse 12295 [Left SubErrPacketIdentifierInUse,Right QoS0,Left SubErrTopicFilterInvalid,Right QoS2]
// [PropAuthenticationData "\\\140@\157\253\244\189\SUB\FS!\208\251",PropSubscriptionIdentifierAvailable 56]
TEST(SubACK5QCTest, Decode6) {
  uint8_t pkt[] = {0x90, 0x18, 0x30, 0x7,  0x11, 0x16, 0x0,  0xc,  0x5c, 0x8c, 0x40, 0x9d, 0xfd,
                   0xf4, 0xbd, 0x1a, 0x1c, 0x21, 0xd0, 0xfb, 0x29, 0x38, 0x91, 0x0,  0x8f, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12295);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
}

// SubscribeResponse 10100 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrUnspecifiedError,Right QoS2,Right QoS2,Left
// SubErrPacketIdentifierInUse,Right QoS2,Left SubErrQuotaExceeded,Left SubErrUnspecifiedError] []
TEST(SubACK5QCTest, Decode7) {
  uint8_t pkt[] = {0x90, 0xe, 0x27, 0x74, 0x0, 0xa1, 0x0, 0x0, 0xa2, 0x80, 0x2, 0x2, 0x91, 0x2, 0x97, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 10100);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], 0x91);
  EXPECT_EQ(granted_qos_levels[8], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[9], 0x97);
  EXPECT_EQ(granted_qos_levels[10], 0x80);
}

// SubscribeResponse 19212 [Left SubErrSubscriptionIdentifiersNotSupported,Right QoS1,Left
// SubErrImplementationSpecificError,Right QoS0,Right QoS2,Right QoS0,Left SubErrPacketIdentifierInUse]
// [PropServerReference "\240r\148\243\&4\175\187\144\188.5",PropMaximumQoS 211,PropAuthenticationMethod
// "\193\212\SI\177zP\US9f\ESCW",PropRetainAvailable 194,PropContentType
// "\a\164#\131\207\221T;N\ENQ\SO\216\t",PropResponseTopic "\r\195\&6A\222\b&+\197N\195\174S\157M\174
// A\225\132B\220\144\186\172\192",PropContentType "w\202\240\180\SUBSZ\226\DC3r\SOH\181%)W",PropMessageExpiryInterval
// 25838,PropCorrelationData "\136\&7\205\162\165\SYNL\232;\247\230",PropResponseInformation
// "\152\SIa\208J\SO\173M\132\ETB\DC2\GS\SOH",PropRequestProblemInformation 222,PropResponseTopic
// "\171\173w\174",PropTopicAliasMaximum 28507,PropMaximumQoS 239,PropAssignedClientIdentifier
// "\178\165",PropRequestResponseInformation 229,PropRequestResponseInformation 25,PropPayloadFormatIndicator
// 24,PropResponseInformation "\DEL6\138MW",PropWillDelayInterval 31867,PropAssignedClientIdentifier
// "\185\193\n\137-\211\183MkHj@\SOHr\248\218\203\186\189@",PropWildcardSubscriptionAvailable
// 93,PropSessionExpiryInterval 30900,PropRetainAvailable 80,PropServerKeepAlive 31885,PropSubscriptionIdentifier 11]
TEST(SubACK5QCTest, Decode8) {
  uint8_t pkt[] = {0x90, 0xd8, 0x1,  0x4b, 0xc,  0xcd, 0x1,  0x1c, 0x0,  0xb,  0xf0, 0x72, 0x94, 0xf3, 0x34, 0xaf, 0xbb,
                   0x90, 0xbc, 0x2e, 0x35, 0x24, 0xd3, 0x15, 0x0,  0xb,  0xc1, 0xd4, 0xf,  0xb1, 0x7a, 0x50, 0x1f, 0x39,
                   0x66, 0x1b, 0x57, 0x25, 0xc2, 0x3,  0x0,  0xd,  0x7,  0xa4, 0x23, 0x83, 0xcf, 0xdd, 0x54, 0x3b, 0x4e,
                   0x5,  0xe,  0xd8, 0x9,  0x8,  0x0,  0x1a, 0xd,  0xc3, 0x36, 0x41, 0xde, 0x8,  0x26, 0x2b, 0xc5, 0x4e,
                   0xc3, 0xae, 0x53, 0x9d, 0x4d, 0xae, 0x20, 0x41, 0xe1, 0x84, 0x42, 0xdc, 0x90, 0xba, 0xac, 0xc0, 0x3,
                   0x0,  0xf,  0x77, 0xca, 0xf0, 0xb4, 0x1a, 0x53, 0x5a, 0xe2, 0x13, 0x72, 0x1,  0xb5, 0x25, 0x29, 0x57,
                   0x2,  0x0,  0x0,  0x64, 0xee, 0x9,  0x0,  0xb,  0x88, 0x37, 0xcd, 0xa2, 0xa5, 0x16, 0x4c, 0xe8, 0x3b,
                   0xf7, 0xe6, 0x1a, 0x0,  0xd,  0x98, 0xf,  0x61, 0xd0, 0x4a, 0xe,  0xad, 0x4d, 0x84, 0x17, 0x12, 0x1d,
                   0x1,  0x17, 0xde, 0x8,  0x0,  0x4,  0xab, 0xad, 0x77, 0xae, 0x22, 0x6f, 0x5b, 0x24, 0xef, 0x12, 0x0,
                   0x2,  0xb2, 0xa5, 0x19, 0xe5, 0x19, 0x19, 0x1,  0x18, 0x1a, 0x0,  0x5,  0x7f, 0x36, 0x8a, 0x4d, 0x57,
                   0x18, 0x0,  0x0,  0x7c, 0x7b, 0x12, 0x0,  0x14, 0xb9, 0xc1, 0xa,  0x89, 0x2d, 0xd3, 0xb7, 0x4d, 0x6b,
                   0x48, 0x6a, 0x40, 0x1,  0x72, 0xf8, 0xda, 0xcb, 0xba, 0xbd, 0x40, 0x28, 0x5d, 0x11, 0x0,  0x0,  0x78,
                   0xb4, 0x25, 0x50, 0x13, 0x7c, 0x8d, 0xb,  0xb,  0xa1, 0x1,  0x83, 0x0,  0x2,  0x0,  0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 19212);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], 0x91);
}

// SubscribeResponse 31570 [Left SubErrTopicFilterInvalid] [PropRetainAvailable 54,PropMaximumPacketSize
// 11455,PropRequestProblemInformation 175,PropTopicAlias 15662,PropSubscriptionIdentifierAvailable 140,PropMaximumQoS
// 246,PropMessageExpiryInterval 24290]
TEST(SubACK5QCTest, Decode9) {
  uint8_t pkt[] = {0x90, 0x19, 0x7b, 0x52, 0x15, 0x25, 0x36, 0x27, 0x0, 0x0, 0x2c, 0xbf, 0x17, 0xaf,
                   0x23, 0x3d, 0x2e, 0x29, 0x8c, 0x24, 0xf6, 0x2,  0x0, 0x0, 0x5e, 0xe2, 0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[1];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 1, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 31570);
  EXPECT_EQ(count, 1);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
}

// SubscribeResponse 15416 [Right QoS1,Left SubErrQuotaExceeded,Left SubErrTopicFilterInvalid,Right QoS1,Left
// SubErrWildcardSubscriptionsNotSupported] [PropReasonString "UR\224v\152+\STX,\214\DC3n\a|",PropServerReference
// "(\138\223\157\SOH\204T\NUL",PropWildcardSubscriptionAvailable 213,PropRequestResponseInformation
// 87,PropAuthenticationData "j",PropReasonString
// "#\220o\230\ACK\213\ETB\128\&6\210\203\&8k\246\153r\220\221\229\&3\204$e<\229",PropWillDelayInterval
// 3741,PropRetainAvailable 55,PropReasonString
// "\NAKS0\168\205\218\188]\133\197\v\176\DLE\167:\232=",PropResponseInformation
// "w\180\173FEt\146$\178|`\248\151R\252q>\a\147\169u\145Jt\218\133:",PropContentType
// "=u\246\161B\229\166\244,%\133\\\222\187\r\225",PropSessionExpiryInterval 20784]
TEST(SubACK5QCTest, Decode10) {
  uint8_t pkt[] = {0x90, 0x99, 0x1,  0x3c, 0x38, 0x90, 0x1,  0x1f, 0x0,  0xd,  0x55, 0x52, 0xe0, 0x76, 0x98, 0x2b,
                   0x2,  0x2c, 0xd6, 0x13, 0x6e, 0x7,  0x7c, 0x1c, 0x0,  0x8,  0x28, 0x8a, 0xdf, 0x9d, 0x1,  0xcc,
                   0x54, 0x0,  0x28, 0xd5, 0x19, 0x57, 0x16, 0x0,  0x1,  0x6a, 0x1f, 0x0,  0x19, 0x23, 0xdc, 0x6f,
                   0xe6, 0x6,  0xd5, 0x17, 0x80, 0x36, 0xd2, 0xcb, 0x38, 0x6b, 0xf6, 0x99, 0x72, 0xdc, 0xdd, 0xe5,
                   0x33, 0xcc, 0x24, 0x65, 0x3c, 0xe5, 0x18, 0x0,  0x0,  0xe,  0x9d, 0x25, 0x37, 0x1f, 0x0,  0x11,
                   0x15, 0x53, 0x30, 0xa8, 0xcd, 0xda, 0xbc, 0x5d, 0x85, 0xc5, 0xb,  0xb0, 0x10, 0xa7, 0x3a, 0xe8,
                   0x3d, 0x1a, 0x0,  0x1b, 0x77, 0xb4, 0xad, 0x46, 0x45, 0x74, 0x92, 0x24, 0xb2, 0x7c, 0x60, 0xf8,
                   0x97, 0x52, 0xfc, 0x71, 0x3e, 0x7,  0x93, 0xa9, 0x75, 0x91, 0x4a, 0x74, 0xda, 0x85, 0x3a, 0x3,
                   0x0,  0x10, 0x3d, 0x75, 0xf6, 0xa1, 0x42, 0xe5, 0xa6, 0xf4, 0x2c, 0x25, 0x85, 0x5c, 0xde, 0xbb,
                   0xd,  0xe1, 0x11, 0x0,  0x0,  0x51, 0x30, 0x1,  0x97, 0x8f, 0x1,  0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 15416);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], 0x97);
  EXPECT_EQ(granted_qos_levels[2], 0x8F);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
}

// SubscribeResponse 24411 [Right QoS2,Left SubErrImplementationSpecificError,Left
// SubErrSharedSubscriptionsNotSupported,Left SubErrWildcardSubscriptionsNotSupported,Left SubErrPacketIdentifierInUse]
// [PropSessionExpiryInterval 1993]
TEST(SubACK5QCTest, Decode11) {
  uint8_t pkt[] = {0x90, 0xd, 0x5f, 0x5b, 0x5, 0x11, 0x0, 0x0, 0x7, 0xc9, 0x2, 0x83, 0x9e, 0xa2, 0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 24411);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], 0x9E);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], 0x91);
}

// SubscribeResponse 16797 [Right QoS0,Right QoS0,Right QoS1,Right QoS2,Left SubErrUnspecifiedError,Right QoS0,Right
// QoS0,Left SubErrSharedSubscriptionsNotSupported,Left SubErrNotAuthorized,Left
// SubErrSubscriptionIdentifiersNotSupported] [PropSubscriptionIdentifier 28,PropAssignedClientIdentifier
// "\157\160\131\&3o4[\141\&6`\138#\232\b\185\147\220A",PropRequestProblemInformation 41,PropResponseTopic
// "\191\&4\176\SO\193\176(\134L\195Y\236\240\172\154xUkI",PropResponseTopic
// "]\196\DLE{\172\245{u\166O\224T`\210\208zi\250",PropMaximumQoS 110,PropContentType
// "*2\191\163\148\SUB\182\231t\141\145\210\235\169\212:\\4\129Vl\RS\146<\155Sw\199\DC1",PropMessageExpiryInterval
// 20196,PropServerReference
// "e80\133\163\185\239\222\US\131\250c\ACK\131\184+E\193Q\196\NAK\166",PropSessionExpiryInterval
// 192,PropWildcardSubscriptionAvailable 89,PropRetainAvailable 70,PropServerKeepAlive 27803,PropReceiveMaximum
// 26170,PropPayloadFormatIndicator 240,PropSubscriptionIdentifier 7,PropReceiveMaximum 3282,PropServerKeepAlive
// 17130,PropMessageExpiryInterval 15690,PropReceiveMaximum 22602,PropMaximumPacketSize 28367,PropTopicAlias
// 20614,PropWillDelayInterval 4977,PropAuthenticationMethod
// "adv56\218\248\ETB\168\168\172\190m\189\SI\b\134;",PropResponseInformation
// "\\\201\144\152\218&\225Gz\145\135\131\145\190\152'\230"]
TEST(SubACK5QCTest, Decode12) {
  uint8_t pkt[] = {0x90, 0xe9, 0x1,  0x41, 0x9d, 0xdb, 0x1,  0xb,  0x1c, 0x12, 0x0,  0x12, 0x9d, 0xa0, 0x83, 0x33, 0x6f,
                   0x34, 0x5b, 0x8d, 0x36, 0x60, 0x8a, 0x23, 0xe8, 0x8,  0xb9, 0x93, 0xdc, 0x41, 0x17, 0x29, 0x8,  0x0,
                   0x13, 0xbf, 0x34, 0xb0, 0xe,  0xc1, 0xb0, 0x28, 0x86, 0x4c, 0xc3, 0x59, 0xec, 0xf0, 0xac, 0x9a, 0x78,
                   0x55, 0x6b, 0x49, 0x8,  0x0,  0x12, 0x5d, 0xc4, 0x10, 0x7b, 0xac, 0xf5, 0x7b, 0x75, 0xa6, 0x4f, 0xe0,
                   0x54, 0x60, 0xd2, 0xd0, 0x7a, 0x69, 0xfa, 0x24, 0x6e, 0x3,  0x0,  0x1d, 0x2a, 0x32, 0xbf, 0xa3, 0x94,
                   0x1a, 0xb6, 0xe7, 0x74, 0x8d, 0x91, 0xd2, 0xeb, 0xa9, 0xd4, 0x3a, 0x5c, 0x34, 0x81, 0x56, 0x6c, 0x1e,
                   0x92, 0x3c, 0x9b, 0x53, 0x77, 0xc7, 0x11, 0x2,  0x0,  0x0,  0x4e, 0xe4, 0x1c, 0x0,  0x16, 0x65, 0x38,
                   0x30, 0x85, 0xa3, 0xb9, 0xef, 0xde, 0x1f, 0x83, 0xfa, 0x63, 0x6,  0x83, 0xb8, 0x2b, 0x45, 0xc1, 0x51,
                   0xc4, 0x15, 0xa6, 0x11, 0x0,  0x0,  0x0,  0xc0, 0x28, 0x59, 0x25, 0x46, 0x13, 0x6c, 0x9b, 0x21, 0x66,
                   0x3a, 0x1,  0xf0, 0xb,  0x7,  0x21, 0xc,  0xd2, 0x13, 0x42, 0xea, 0x2,  0x0,  0x0,  0x3d, 0x4a, 0x21,
                   0x58, 0x4a, 0x27, 0x0,  0x0,  0x6e, 0xcf, 0x23, 0x50, 0x86, 0x18, 0x0,  0x0,  0x13, 0x71, 0x15, 0x0,
                   0x12, 0x61, 0x64, 0x76, 0x35, 0x36, 0xda, 0xf8, 0x17, 0xa8, 0xa8, 0xac, 0xbe, 0x6d, 0xbd, 0xf,  0x8,
                   0x86, 0x3b, 0x1a, 0x0,  0x11, 0x5c, 0xc9, 0x90, 0x98, 0xda, 0x26, 0xe1, 0x47, 0x7a, 0x91, 0x87, 0x83,
                   0x91, 0xbe, 0x98, 0x27, 0xe6, 0x0,  0x0,  0x1,  0x2,  0x80, 0x0,  0x0,  0x9e, 0x87, 0xa1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 16797);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], 0x80);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
  EXPECT_EQ(granted_qos_levels[8], 0x87);
  EXPECT_EQ(granted_qos_levels[9], 0xA1);
}

// SubscribeResponse 8011 [Right QoS0,Right QoS2,Right QoS2,Left SubErrTopicFilterInvalid,Left
// SubErrTopicFilterInvalid,Right QoS2] [PropWildcardSubscriptionAvailable 104,PropServerKeepAlive
// 27826,PropResponseTopic "\152\138\201\137\152\144\228\aI\CAN\193\146&2sX\a#\\L",PropMessageExpiryInterval
// 4121,PropTopicAliasMaximum 25788,PropSharedSubscriptionAvailable 229,PropTopicAliasMaximum 11111,PropUserProperty
// "\EM\170\205\SUB\162\&4\175u\231\174%}P+\ETB\190\&6m\200\GSK\161/@\255\&7"
// "\254\188D\186\GS\193z\241R\201\139@\200!\SOH\184\&5\191\228",PropAuthenticationData
// "\131oJHx6\173\DC1\180\US\146n2\220\237`\227\157r<\202\b\b\187\219F\172=\177",PropRequestResponseInformation 60]
TEST(SubACK5QCTest, Decode13) {
  uint8_t pkt[] = {0x90, 0x86, 0x1,  0x1f, 0x4b, 0x7d, 0x28, 0x68, 0x13, 0x6c, 0xb2, 0x8,  0x0,  0x14, 0x98, 0x8a,
                   0xc9, 0x89, 0x98, 0x90, 0xe4, 0x7,  0x49, 0x18, 0xc1, 0x92, 0x26, 0x32, 0x73, 0x58, 0x7,  0x23,
                   0x5c, 0x4c, 0x2,  0x0,  0x0,  0x10, 0x19, 0x22, 0x64, 0xbc, 0x2a, 0xe5, 0x22, 0x2b, 0x67, 0x26,
                   0x0,  0x1a, 0x19, 0xaa, 0xcd, 0x1a, 0xa2, 0x34, 0xaf, 0x75, 0xe7, 0xae, 0x25, 0x7d, 0x50, 0x2b,
                   0x17, 0xbe, 0x36, 0x6d, 0xc8, 0x1d, 0x4b, 0xa1, 0x2f, 0x40, 0xff, 0x37, 0x0,  0x13, 0xfe, 0xbc,
                   0x44, 0xba, 0x1d, 0xc1, 0x7a, 0xf1, 0x52, 0xc9, 0x8b, 0x40, 0xc8, 0x21, 0x1,  0xb8, 0x35, 0xbf,
                   0xe4, 0x16, 0x0,  0x1d, 0x83, 0x6f, 0x4a, 0x48, 0x78, 0x36, 0xad, 0x11, 0xb4, 0x1f, 0x92, 0x6e,
                   0x32, 0xdc, 0xed, 0x60, 0xe3, 0x9d, 0x72, 0x3c, 0xca, 0x8,  0x8,  0xbb, 0xdb, 0x46, 0xac, 0x3d,
                   0xb1, 0x19, 0x3c, 0x0,  0x2,  0x2,  0x8f, 0x8f, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8011);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], 0x8F);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
}

// SubscribeResponse 32745 [Right QoS0,Right QoS2,Right QoS1,Left SubErrNotAuthorized,Right QoS0,Right QoS2,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS2] [PropReceiveMaximum 16091,PropServerKeepAlive
// 6465,PropContentType "\192\215\&9m\STXl",PropPayloadFormatIndicator 155,PropCorrelationData
// "qr\253vwH\"T\138Pz*a\133\rJx\RS\183l\236\SO\187\210",PropMessageExpiryInterval 7888,PropResponseInformation
// "\SO\255\133",PropMaximumQoS 64,PropRequestProblemInformation 112,PropMaximumQoS 105,PropResponseInformation
// "\156My%\245\218|R\DC3y\132)\177y\208\230*\221S\201\214\SUB\182\153\156\215",PropWildcardSubscriptionAvailable
// 185,PropServerKeepAlive 28165,PropTopicAlias 32215,PropPayloadFormatIndicator 122,PropSubscriptionIdentifierAvailable
// 114,PropReasonString
// "\204t/\180D\188H(\225\194\162\tK\183\226\252\234\177\155\216\182\192\193t\236uY\209\EMl",PropMessageExpiryInterval
// 28202,PropRequestResponseInformation 201,PropWillDelayInterval 32683,PropUserProperty
// "\189a\159\209i\181\135AI\142\SI\192\DC3\RS"
// "\160\232I0\177\153\175\131\194\150\156\144\138\184\"&m\187",PropAuthenticationData
// "\142'\164\181\151\201T\199M\225",PropAssignedClientIdentifier
// "z\135u.9\ESC\236\152\230\SIla\135*5\DLEt\142\237\131>\140\214\a,\186}",PropServerKeepAlive
// 8604,PropMessageExpiryInterval 6304,PropSessionExpiryInterval 18034,PropResponseTopic
// "\225#\206\SYN6\168?s\142\196\129\176\194\238\206>\247\164."]
TEST(SubACK5QCTest, Decode14) {
  uint8_t pkt[] = {
      0x90, 0x92, 0x2,  0x7f, 0xe9, 0x86, 0x2,  0x21, 0x3e, 0xdb, 0x13, 0x19, 0x41, 0x3,  0x0,  0x6,  0xc0, 0xd7, 0x39,
      0x6d, 0x2,  0x6c, 0x1,  0x9b, 0x9,  0x0,  0x18, 0x71, 0x72, 0xfd, 0x76, 0x77, 0x48, 0x22, 0x54, 0x8a, 0x50, 0x7a,
      0x2a, 0x61, 0x85, 0xd,  0x4a, 0x78, 0x1e, 0xb7, 0x6c, 0xec, 0xe,  0xbb, 0xd2, 0x2,  0x0,  0x0,  0x1e, 0xd0, 0x1a,
      0x0,  0x3,  0xe,  0xff, 0x85, 0x24, 0x40, 0x17, 0x70, 0x24, 0x69, 0x1a, 0x0,  0x1a, 0x9c, 0x4d, 0x79, 0x25, 0xf5,
      0xda, 0x7c, 0x52, 0x13, 0x79, 0x84, 0x29, 0xb1, 0x79, 0xd0, 0xe6, 0x2a, 0xdd, 0x53, 0xc9, 0xd6, 0x1a, 0xb6, 0x99,
      0x9c, 0xd7, 0x28, 0xb9, 0x13, 0x6e, 0x5,  0x23, 0x7d, 0xd7, 0x1,  0x7a, 0x29, 0x72, 0x1f, 0x0,  0x1e, 0xcc, 0x74,
      0x2f, 0xb4, 0x44, 0xbc, 0x48, 0x28, 0xe1, 0xc2, 0xa2, 0x9,  0x4b, 0xb7, 0xe2, 0xfc, 0xea, 0xb1, 0x9b, 0xd8, 0xb6,
      0xc0, 0xc1, 0x74, 0xec, 0x75, 0x59, 0xd1, 0x19, 0x6c, 0x2,  0x0,  0x0,  0x6e, 0x2a, 0x19, 0xc9, 0x18, 0x0,  0x0,
      0x7f, 0xab, 0x26, 0x0,  0xe,  0xbd, 0x61, 0x9f, 0xd1, 0x69, 0xb5, 0x87, 0x41, 0x49, 0x8e, 0xf,  0xc0, 0x13, 0x1e,
      0x0,  0x12, 0xa0, 0xe8, 0x49, 0x30, 0xb1, 0x99, 0xaf, 0x83, 0xc2, 0x96, 0x9c, 0x90, 0x8a, 0xb8, 0x22, 0x26, 0x6d,
      0xbb, 0x16, 0x0,  0xa,  0x8e, 0x27, 0xa4, 0xb5, 0x97, 0xc9, 0x54, 0xc7, 0x4d, 0xe1, 0x12, 0x0,  0x1b, 0x7a, 0x87,
      0x75, 0x2e, 0x39, 0x1b, 0xec, 0x98, 0xe6, 0xf,  0x6c, 0x61, 0x87, 0x2a, 0x35, 0x10, 0x74, 0x8e, 0xed, 0x83, 0x3e,
      0x8c, 0xd6, 0x7,  0x2c, 0xba, 0x7d, 0x13, 0x21, 0x9c, 0x2,  0x0,  0x0,  0x18, 0xa0, 0x11, 0x0,  0x0,  0x46, 0x72,
      0x8,  0x0,  0x13, 0xe1, 0x23, 0xce, 0x16, 0x36, 0xa8, 0x3f, 0x73, 0x8e, 0xc4, 0x81, 0xb0, 0xc2, 0xee, 0xce, 0x3e,
      0xf7, 0xa4, 0x2e, 0x0,  0x2,  0x1,  0x87, 0x0,  0x2,  0xa2, 0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 32745);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 8548 [Right QoS1,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS0] [PropTopicAlias 17510,PropReasonString
// "\SUBz\136\SOH\175\232\242.\SOH?H\147\DEL\194\173r(",PropReceiveMaximum 13803,PropServerKeepAlive 3961,PropTopicAlias
// 14018,PropWillDelayInterval 26965,PropAuthenticationMethod
// "\212\203\150]\213w\NULg\128\STXx\255\180\158P\129Z\233",PropSharedSubscriptionAvailable
// 106,PropSharedSubscriptionAvailable 110,PropSubscriptionIdentifier 3,PropSessionExpiryInterval 26894,PropReasonString
// "=/\188D,L\242t\169c\175\197\228\SYN\153\233\208\217",PropAuthenticationData
// "}\NUL$\158\EM\169\183h2f\230\222\159\234\149Mw\221y\240",PropResponseTopic
// "\172\195E\187D\136f4W*\252\244'4\DC2",PropWildcardSubscriptionAvailable 241,PropSubscriptionIdentifierAvailable
// 71,PropMaximumPacketSize 22821]
TEST(SubACK5QCTest, Decode15) {
  uint8_t pkt[] = {0x90, 0x95, 0x1,  0x21, 0x64, 0x8c, 0x1,  0x23, 0x44, 0x66, 0x1f, 0x0,  0x11, 0x1a, 0x7a, 0x88, 0x1,
                   0xaf, 0xe8, 0xf2, 0x2e, 0x1,  0x3f, 0x48, 0x93, 0x7f, 0xc2, 0xad, 0x72, 0x28, 0x21, 0x35, 0xeb, 0x13,
                   0xf,  0x79, 0x23, 0x36, 0xc2, 0x18, 0x0,  0x0,  0x69, 0x55, 0x15, 0x0,  0x12, 0xd4, 0xcb, 0x96, 0x5d,
                   0xd5, 0x77, 0x0,  0x67, 0x80, 0x2,  0x78, 0xff, 0xb4, 0x9e, 0x50, 0x81, 0x5a, 0xe9, 0x2a, 0x6a, 0x2a,
                   0x6e, 0xb,  0x3,  0x11, 0x0,  0x0,  0x69, 0xe,  0x1f, 0x0,  0x12, 0x3d, 0x2f, 0xbc, 0x44, 0x2c, 0x4c,
                   0xf2, 0x74, 0xa9, 0x63, 0xaf, 0xc5, 0xe4, 0x16, 0x99, 0xe9, 0xd0, 0xd9, 0x16, 0x0,  0x14, 0x7d, 0x0,
                   0x24, 0x9e, 0x19, 0xa9, 0xb7, 0x68, 0x32, 0x66, 0xe6, 0xde, 0x9f, 0xea, 0x95, 0x4d, 0x77, 0xdd, 0x79,
                   0xf0, 0x8,  0x0,  0xf,  0xac, 0xc3, 0x45, 0xbb, 0x44, 0x88, 0x66, 0x34, 0x57, 0x2a, 0xfc, 0xf4, 0x27,
                   0x34, 0x12, 0x28, 0xf1, 0x29, 0x47, 0x27, 0x0,  0x0,  0x59, 0x25, 0x1,  0x2,  0xa2, 0xa2, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[5];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 5, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8548);
  EXPECT_EQ(count, 5);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
}

// SubscribeResponse 12279 [Right QoS2,Left SubErrSharedSubscriptionsNotSupported,Right QoS1,Left
// SubErrTopicFilterInvalid] [PropServerKeepAlive 32670,PropServerReference
// "\248|\170\178I\184\247*\DLE|\226\136\232?b\240",PropRetainAvailable 121]
TEST(SubACK5QCTest, Decode16) {
  uint8_t pkt[] = {0x90, 0x1f, 0x2f, 0xf7, 0x18, 0x13, 0x7f, 0x9e, 0x1c, 0x0,  0x10, 0xf8, 0x7c, 0xaa, 0xb2, 0x49, 0xb8,
                   0xf7, 0x2a, 0x10, 0x7c, 0xe2, 0x88, 0xe8, 0x3f, 0x62, 0xf0, 0x25, 0x79, 0x2,  0x9e, 0x1,  0x8f};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 12279);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x9E);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
}

// SubscribeResponse 8001 [Right QoS2,Right QoS0,Left SubErrWildcardSubscriptionsNotSupported,Right QoS2,Right QoS2,Left
// SubErrNotAuthorized,Left SubErrWildcardSubscriptionsNotSupported] [PropTopicAliasMaximum 3486,PropRetainAvailable
// 25,PropMessageExpiryInterval 11544]
TEST(SubACK5QCTest, Decode17) {
  uint8_t pkt[] = {0x90, 0x14, 0x1f, 0x41, 0xa, 0x22, 0xd,  0x9e, 0x25, 0x19, 0x2,
                   0x0,  0x0,  0x2d, 0x18, 0x2, 0x0,  0xa2, 0x2,  0x2,  0x87, 0xa2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8001);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x87);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
}

// SubscribeResponse 4988 [Left SubErrTopicFilterInvalid,Right QoS0,Left SubErrNotAuthorized,Left
// SubErrImplementationSpecificError,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrSharedSubscriptionsNotSupported,Right QoS1,Right QoS2] [PropRequestProblemInformation
// 33,PropRequestProblemInformation 126,PropMessageExpiryInterval 30345,PropMaximumPacketSize
// 17191,PropPayloadFormatIndicator 186,PropWillDelayInterval 18701,PropTopicAliasMaximum
// 21991,PropMessageExpiryInterval 10612,PropRequestResponseInformation 157,PropAuthenticationData
// "$\223u\CANl\200\208M\SO8C&\131\DEL\250\209\136\136\155Y\165\232\225",PropMessageExpiryInterval
// 6146,PropSubscriptionIdentifier 5,PropMessageExpiryInterval 4255,PropPayloadFormatIndicator 169,PropWillDelayInterval
// 3779,PropSubscriptionIdentifierAvailable 17,PropRequestProblemInformation 73,PropAuthenticationData
// "\240s\172C\193\204P\197\208\224\149p!\241\245\210f\148@",PropServerKeepAlive
// 30539,PropSubscriptionIdentifierAvailable 126,PropResponseInformation
// "\222\132B\SOH(\DC2\EM\251L\187b7|\177\232mv\136\136\&2\202\254"]
TEST(SubACK5QCTest, Decode18) {
  uint8_t pkt[] = {0x90, 0x93, 0x1,  0x13, 0x7c, 0x84, 0x1,  0x17, 0x21, 0x17, 0x7e, 0x2,  0x0,  0x0,  0x76, 0x89, 0x27,
                   0x0,  0x0,  0x43, 0x27, 0x1,  0xba, 0x18, 0x0,  0x0,  0x49, 0xd,  0x22, 0x55, 0xe7, 0x2,  0x0,  0x0,
                   0x29, 0x74, 0x19, 0x9d, 0x16, 0x0,  0x17, 0x24, 0xdf, 0x75, 0x18, 0x6c, 0xc8, 0xd0, 0x4d, 0xe,  0x38,
                   0x43, 0x26, 0x83, 0x7f, 0xfa, 0xd1, 0x88, 0x88, 0x9b, 0x59, 0xa5, 0xe8, 0xe1, 0x2,  0x0,  0x0,  0x18,
                   0x2,  0xb,  0x5,  0x2,  0x0,  0x0,  0x10, 0x9f, 0x1,  0xa9, 0x18, 0x0,  0x0,  0xe,  0xc3, 0x29, 0x11,
                   0x17, 0x49, 0x16, 0x0,  0x13, 0xf0, 0x73, 0xac, 0x43, 0xc1, 0xcc, 0x50, 0xc5, 0xd0, 0xe0, 0x95, 0x70,
                   0x21, 0xf1, 0xf5, 0xd2, 0x66, 0x94, 0x40, 0x13, 0x77, 0x4b, 0x29, 0x7e, 0x1a, 0x0,  0x16, 0xde, 0x84,
                   0x42, 0x1,  0x28, 0x12, 0x19, 0xfb, 0x4c, 0xbb, 0x62, 0x37, 0x7c, 0xb1, 0xe8, 0x6d, 0x76, 0x88, 0x88,
                   0x32, 0xca, 0xfe, 0x8f, 0x0,  0x87, 0x83, 0xa2, 0x9e, 0x0,  0xa1, 0x9e, 0x1,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 4988);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x8F);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], 0x87);
  EXPECT_EQ(granted_qos_levels[3], 0x83);
  EXPECT_EQ(granted_qos_levels[4], 0xA2);
  EXPECT_EQ(granted_qos_levels[5], 0x9E);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], 0xA1);
  EXPECT_EQ(granted_qos_levels[8], 0x9E);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// SubscribeResponse 6982 [Right QoS0,Left SubErrTopicFilterInvalid,Left SubErrQuotaExceeded,Left
// SubErrUnspecifiedError,Left SubErrNotAuthorized,Right QoS2,Right QoS0,Right QoS1,Left SubErrTopicFilterInvalid,Left
// SubErrTopicFilterInvalid,Right QoS0] [PropReceiveMaximum 16887,PropUserProperty
// "\169\DC3\148_\DC3\191\137e\175\"\132\134n!q\210z\157\165y\214\217f\252D"
// "\233\212\209L\198A+\137\246\ETX",PropRequestResponseInformation 92,PropSubscriptionIdentifierAvailable
// 37,PropContentType "\238rR\162\236\b\202+\248\164\SUB`\246W\USD]QZ~\b\155L^r\200\253u-",PropMessageExpiryInterval
// 25037,PropTopicAlias 16205,PropMessageExpiryInterval 24486,PropServerKeepAlive 17359,PropAssignedClientIdentifier
// "\176\222\SI\248\250\"d~v\212\ETB\215",PropTopicAlias 9629,PropCorrelationData
// "6QV>\254\184\233P\DC2\199i\135\162?\160\CAN[,R/\158\ESC\187|Y\145`\fx",PropRetainAvailable 137]
TEST(SubACK5QCTest, Decode19) {
  uint8_t pkt[] = {0x90, 0xa2, 0x1,  0x1b, 0x46, 0x93, 0x1,  0x21, 0x41, 0xf7, 0x26, 0x0,  0x19, 0xa9, 0x13, 0x94, 0x5f,
                   0x13, 0xbf, 0x89, 0x65, 0xaf, 0x22, 0x84, 0x86, 0x6e, 0x21, 0x71, 0xd2, 0x7a, 0x9d, 0xa5, 0x79, 0xd6,
                   0xd9, 0x66, 0xfc, 0x44, 0x0,  0xa,  0xe9, 0xd4, 0xd1, 0x4c, 0xc6, 0x41, 0x2b, 0x89, 0xf6, 0x3,  0x19,
                   0x5c, 0x29, 0x25, 0x3,  0x0,  0x1d, 0xee, 0x72, 0x52, 0xa2, 0xec, 0x8,  0xca, 0x2b, 0xf8, 0xa4, 0x1a,
                   0x60, 0xf6, 0x57, 0x1f, 0x44, 0x5d, 0x51, 0x5a, 0x7e, 0x8,  0x9b, 0x4c, 0x5e, 0x72, 0xc8, 0xfd, 0x75,
                   0x2d, 0x2,  0x0,  0x0,  0x61, 0xcd, 0x23, 0x3f, 0x4d, 0x2,  0x0,  0x0,  0x5f, 0xa6, 0x13, 0x43, 0xcf,
                   0x12, 0x0,  0xc,  0xb0, 0xde, 0xf,  0xf8, 0xfa, 0x22, 0x64, 0x7e, 0x76, 0xd4, 0x17, 0xd7, 0x23, 0x25,
                   0x9d, 0x9,  0x0,  0x1d, 0x36, 0x51, 0x56, 0x3e, 0xfe, 0xb8, 0xe9, 0x50, 0x12, 0xc7, 0x69, 0x87, 0xa2,
                   0x3f, 0xa0, 0x18, 0x5b, 0x2c, 0x52, 0x2f, 0x9e, 0x1b, 0xbb, 0x7c, 0x59, 0x91, 0x60, 0xc,  0x78, 0x25,
                   0x89, 0x0,  0x8f, 0x97, 0x80, 0x87, 0x2,  0x0,  0x1,  0x8f, 0x8f, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 6982);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x8F);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x87);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[8], 0x8F);
  EXPECT_EQ(granted_qos_levels[9], 0x8F);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS0);
}

// SubscribeResponse 25134 [Left SubErrSubscriptionIdentifiersNotSupported,Left SubErrImplementationSpecificError,Right
// QoS2,Left SubErrNotAuthorized,Right QoS0,Right QoS2,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrQuotaExceeded] [PropResponseInformation "!\ENQ\EM\212\211",PropSharedSubscriptionAvailable
// 125,PropSessionExpiryInterval 15656,PropRequestProblemInformation 3,PropRequestResponseInformation
// 24,PropRequestResponseInformation 18,PropWildcardSubscriptionAvailable 148,PropAuthenticationData
// "=\234\&7_\217\238V{\162\&8\186\"\221\201u",PropReasonString
// "\197\161\SI\DC1\143w\149\152\252UR\242(",PropSharedSubscriptionAvailable 137,PropReceiveMaximum
// 13195,PropUserProperty "\197\131\&0(" "\232\181\SYN\215*}\223gi'5I\179",PropSharedSubscriptionAvailable
// 238,PropTopicAlias 27840,PropAssignedClientIdentifier
// "\NULs\vk\NUL\167J\131\133\249\237wq\216b\149\218~\220\139&\203",PropAuthenticationData
// "\"'V0\133\\\247\245\240\196}\245\&9\DLEw\143\184",PropAuthenticationData "& \222\239xv\ESC",PropResponseTopic
// "\205\DEL\233\155Fs\145n\180\219=\196'G\175\SYN\237\214\237\149\163Z \221\176\174U\DC1Z",PropSessionExpiryInterval
// 23440,PropServerKeepAlive 21999,PropCorrelationData
// "\248S\212\178_\170\r\161\141\129Q\203\155S\205\161\189\146\154\185\151|\178\ACK\161\226\US\143\247",PropAuthenticationMethod
// "\145\174\162\172\151!0\243\201\193\168_",PropAuthenticationMethod "",PropSessionExpiryInterval
// 15746,PropMaximumPacketSize 19299,PropRequestProblemInformation 58,PropAuthenticationMethod "N{\229\254%\243r\130"]
TEST(SubACK5QCTest, Decode20) {
  uint8_t pkt[] = {
      0x90, 0x8d, 0x2,  0x62, 0x2e, 0x81, 0x2,  0x1a, 0x0,  0x5,  0x21, 0x5,  0x19, 0xd4, 0xd3, 0x2a, 0x7d, 0x11, 0x0,
      0x0,  0x3d, 0x28, 0x17, 0x3,  0x19, 0x18, 0x19, 0x12, 0x28, 0x94, 0x16, 0x0,  0xf,  0x3d, 0xea, 0x37, 0x5f, 0xd9,
      0xee, 0x56, 0x7b, 0xa2, 0x38, 0xba, 0x22, 0xdd, 0xc9, 0x75, 0x1f, 0x0,  0xd,  0xc5, 0xa1, 0xf,  0x11, 0x8f, 0x77,
      0x95, 0x98, 0xfc, 0x55, 0x52, 0xf2, 0x28, 0x2a, 0x89, 0x21, 0x33, 0x8b, 0x26, 0x0,  0x4,  0xc5, 0x83, 0x30, 0x28,
      0x0,  0xd,  0xe8, 0xb5, 0x16, 0xd7, 0x2a, 0x7d, 0xdf, 0x67, 0x69, 0x27, 0x35, 0x49, 0xb3, 0x2a, 0xee, 0x23, 0x6c,
      0xc0, 0x12, 0x0,  0x16, 0x0,  0x73, 0xb,  0x6b, 0x0,  0xa7, 0x4a, 0x83, 0x85, 0xf9, 0xed, 0x77, 0x71, 0xd8, 0x62,
      0x95, 0xda, 0x7e, 0xdc, 0x8b, 0x26, 0xcb, 0x16, 0x0,  0x11, 0x22, 0x27, 0x56, 0x30, 0x85, 0x5c, 0xf7, 0xf5, 0xf0,
      0xc4, 0x7d, 0xf5, 0x39, 0x10, 0x77, 0x8f, 0xb8, 0x16, 0x0,  0x7,  0x26, 0x20, 0xde, 0xef, 0x78, 0x76, 0x1b, 0x8,
      0x0,  0x1d, 0xcd, 0x7f, 0xe9, 0x9b, 0x46, 0x73, 0x91, 0x6e, 0xb4, 0xdb, 0x3d, 0xc4, 0x27, 0x47, 0xaf, 0x16, 0xed,
      0xd6, 0xed, 0x95, 0xa3, 0x5a, 0x20, 0xdd, 0xb0, 0xae, 0x55, 0x11, 0x5a, 0x11, 0x0,  0x0,  0x5b, 0x90, 0x13, 0x55,
      0xef, 0x9,  0x0,  0x1d, 0xf8, 0x53, 0xd4, 0xb2, 0x5f, 0xaa, 0xd,  0xa1, 0x8d, 0x81, 0x51, 0xcb, 0x9b, 0x53, 0xcd,
      0xa1, 0xbd, 0x92, 0x9a, 0xb9, 0x97, 0x7c, 0xb2, 0x6,  0xa1, 0xe2, 0x1f, 0x8f, 0xf7, 0x15, 0x0,  0xc,  0x91, 0xae,
      0xa2, 0xac, 0x97, 0x21, 0x30, 0xf3, 0xc9, 0xc1, 0xa8, 0x5f, 0x15, 0x0,  0x0,  0x11, 0x0,  0x0,  0x3d, 0x82, 0x27,
      0x0,  0x0,  0x4b, 0x63, 0x17, 0x3a, 0x15, 0x0,  0x8,  0x4e, 0x7b, 0xe5, 0xfe, 0x25, 0xf3, 0x72, 0x82, 0xa1, 0x83,
      0x2,  0x87, 0x0,  0x2,  0xa2, 0x97};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25134);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0xA1);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
  EXPECT_EQ(granted_qos_levels[7], 0x97);
}

// SubscribeResponse 25090 [Left SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrQuotaExceeded,Left SubErrTopicFilterInvalid,Left SubErrImplementationSpecificError,Right QoS1,Left
// SubErrPacketIdentifierInUse] [PropSubscriptionIdentifier 11,PropContentType "\250xC",PropServerKeepAlive
// 21843,PropPayloadFormatIndicator 10,PropRetainAvailable 165,PropTopicAliasMaximum 1014,PropResponseTopic
// "\160\180-\251\252m\233,\254\229\203\253\160\157H\214\SUB$\SO\ESC\146\223+\v",PropReasonString
// "3\171;\133\ENQ\234,\176o\206\NULc\226\247\224\DC4\"\164r\189\212\229C\238M",PropResponseTopic
// "`\225\ESC'\137\184\184Voz\146\&8\201\ESC\237\167\209\177T;o",PropWildcardSubscriptionAvailable
// 255,PropReceiveMaximum 32182]
TEST(SubACK5QCTest, Decode21) {
  uint8_t pkt[] = {0x90, 0x70, 0x62, 0x2,  0x66, 0xb,  0xb,  0x3,  0x0,  0x3,  0xfa, 0x78, 0x43, 0x13, 0x55, 0x53, 0x1,
                   0xa,  0x25, 0xa5, 0x22, 0x3,  0xf6, 0x8,  0x0,  0x18, 0xa0, 0xb4, 0x2d, 0xfb, 0xfc, 0x6d, 0xe9, 0x2c,
                   0xfe, 0xe5, 0xcb, 0xfd, 0xa0, 0x9d, 0x48, 0xd6, 0x1a, 0x24, 0xe,  0x1b, 0x92, 0xdf, 0x2b, 0xb,  0x1f,
                   0x0,  0x19, 0x33, 0xab, 0x3b, 0x85, 0x5,  0xea, 0x2c, 0xb0, 0x6f, 0xce, 0x0,  0x63, 0xe2, 0xf7, 0xe0,
                   0x14, 0x22, 0xa4, 0x72, 0xbd, 0xd4, 0xe5, 0x43, 0xee, 0x4d, 0x8,  0x0,  0x15, 0x60, 0xe1, 0x1b, 0x27,
                   0x89, 0xb8, 0xb8, 0x56, 0x6f, 0x7a, 0x92, 0x38, 0xc9, 0x1b, 0xed, 0xa7, 0xd1, 0xb1, 0x54, 0x3b, 0x6f,
                   0x28, 0xff, 0x21, 0x7d, 0xb6, 0x80, 0xa2, 0x97, 0x8f, 0x83, 0x1,  0x91};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 25090);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], 0x97);
  EXPECT_EQ(granted_qos_levels[3], 0x8F);
  EXPECT_EQ(granted_qos_levels[4], 0x83);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], 0x91);
}

// SubscribeResponse 270 [Left SubErrPacketIdentifierInUse,Right QoS0,Right QoS0,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS1,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrSubscriptionIdentifiersNotSupported,Right QoS0,Left SubErrSubscriptionIdentifiersNotSupported,Left
// SubErrUnspecifiedError] [PropResponseTopic
// "\v=\ENQlq\tV\148o\211h\ETBs\254\213e\224\STXU\f8\134\r\201\248\255\245\218\241",PropAuthenticationData
// "\162\153Q56\EOT+]KH\133Q\219\198\166`",PropAssignedClientIdentifier
// "=\141\218It\145\226W5\180\CAN\230\191\139!\184;\164p\174\236)",PropTopicAlias 11631,PropUserProperty
// "W\234O\236\DC21(|\143\145\201\NAKy\191+\159n\DC1\246\199\150\NAK\156\157\160eX"
// "\RS\"\STX\EM#\169\178",PropMaximumPacketSize 12863,PropMaximumPacketSize 17273,PropMessageExpiryInterval
// 13702,PropCorrelationData
// "\\\165\176o\176.\248\149\208\137\156[\DC2\148\GSR\255\237\187\n\138\254\182\133\242\"\FS\ETXP/",PropSubscriptionIdentifierAvailable
// 79,PropResponseTopic
// "Y\EM\215\231\193\236\\),b\202{\217>\137\186\162\166|\EOT\166!1O\175\SO\233q",PropRetainAvailable
// 207,PropMessageExpiryInterval 15018,PropAssignedClientIdentifier "S\171b\220|\217\146A",PropWillDelayInterval
// 18618,PropSubscriptionIdentifier 13]
TEST(SubACK5QCTest, Decode22) {
  uint8_t pkt[] = {
      0x90, 0xee, 0x1,  0x1,  0xe,  0xe0, 0x1,  0x8,  0x0,  0x1d, 0xb,  0x3d, 0x5,  0x6c, 0x71, 0x9,  0x56, 0x94, 0x6f,
      0xd3, 0x68, 0x17, 0x73, 0xfe, 0xd5, 0x65, 0xe0, 0x2,  0x55, 0xc,  0x38, 0x86, 0xd,  0xc9, 0xf8, 0xff, 0xf5, 0xda,
      0xf1, 0x16, 0x0,  0x10, 0xa2, 0x99, 0x51, 0x35, 0x36, 0x4,  0x2b, 0x5d, 0x4b, 0x48, 0x85, 0x51, 0xdb, 0xc6, 0xa6,
      0x60, 0x12, 0x0,  0x16, 0x3d, 0x8d, 0xda, 0x49, 0x74, 0x91, 0xe2, 0x57, 0x35, 0xb4, 0x18, 0xe6, 0xbf, 0x8b, 0x21,
      0xb8, 0x3b, 0xa4, 0x70, 0xae, 0xec, 0x29, 0x23, 0x2d, 0x6f, 0x26, 0x0,  0x1b, 0x57, 0xea, 0x4f, 0xec, 0x12, 0x31,
      0x28, 0x7c, 0x8f, 0x91, 0xc9, 0x15, 0x79, 0xbf, 0x2b, 0x9f, 0x6e, 0x11, 0xf6, 0xc7, 0x96, 0x15, 0x9c, 0x9d, 0xa0,
      0x65, 0x58, 0x0,  0x7,  0x1e, 0x22, 0x2,  0x19, 0x23, 0xa9, 0xb2, 0x27, 0x0,  0x0,  0x32, 0x3f, 0x27, 0x0,  0x0,
      0x43, 0x79, 0x2,  0x0,  0x0,  0x35, 0x86, 0x9,  0x0,  0x1e, 0x5c, 0xa5, 0xb0, 0x6f, 0xb0, 0x2e, 0xf8, 0x95, 0xd0,
      0x89, 0x9c, 0x5b, 0x12, 0x94, 0x1d, 0x52, 0xff, 0xed, 0xbb, 0xa,  0x8a, 0xfe, 0xb6, 0x85, 0xf2, 0x22, 0x1c, 0x3,
      0x50, 0x2f, 0x29, 0x4f, 0x8,  0x0,  0x1c, 0x59, 0x19, 0xd7, 0xe7, 0xc1, 0xec, 0x5c, 0x29, 0x2c, 0x62, 0xca, 0x7b,
      0xd9, 0x3e, 0x89, 0xba, 0xa2, 0xa6, 0x7c, 0x4,  0xa6, 0x21, 0x31, 0x4f, 0xaf, 0xe,  0xe9, 0x71, 0x25, 0xcf, 0x2,
      0x0,  0x0,  0x3a, 0xaa, 0x12, 0x0,  0x8,  0x53, 0xab, 0x62, 0xdc, 0x7c, 0xd9, 0x92, 0x41, 0x18, 0x0,  0x0,  0x48,
      0xba, 0xb,  0xd,  0x91, 0x0,  0x0,  0xa2, 0x1,  0xa1, 0xa1, 0x0,  0xa1, 0x80};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[10];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 10, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 270);
  EXPECT_EQ(count, 10);
  EXPECT_EQ(granted_qos_levels[0], 0x91);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0xA2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0xA1);
  EXPECT_EQ(granted_qos_levels[6], 0xA1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[8], 0xA1);
  EXPECT_EQ(granted_qos_levels[9], 0x80);
}

// SubscribeResponse 28717 [Right QoS0,Left SubErrQuotaExceeded,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrPacketIdentifierInUse,Right QoS2,Right QoS1,Right QoS2,Right QoS2] [PropCorrelationData
// "\195\&8A}\215\188\&14\EML\193/6C\202\200\147\SOH\155\238\156\175\164\128\180v",PropTopicAlias
// 3259,PropMessageExpiryInterval 12278,PropAuthenticationMethod "\198\DC1V",PropReceiveMaximum
// 20488,PropSubscriptionIdentifier 23,PropUserProperty ""
// "\ESC{.\227\245\\\207d\US\170!\132J\t\EM%\252\226\DC2\240\f\ENQ\r\193\177\205",PropServerKeepAlive
// 22539,PropSubscriptionIdentifier 21,PropSessionExpiryInterval 15138,PropAuthenticationMethod
// "=\133\&8",PropWildcardSubscriptionAvailable 111,PropMaximumQoS 85,PropUserProperty
// "\214S\221\179B\ACK\196J&^'7\180\199$t2" "",PropRequestProblemInformation 145,PropWillDelayInterval
// 3910,PropMaximumPacketSize 12153,PropReasonString "\165\230\187\169\207d
// \222\141\242_\SI|\v\178\GS^\147\b[\ESC\ETX\142\139)\176\170\176d",PropSubscriptionIdentifier 30,PropServerKeepAlive
// 5908,PropReasonString "z\137\181O\231\207\167",PropUserProperty "\225\160\198\252]\145\184\CAN\139\&6\188\161\&0\f"
// ";\221\250B\163Uqv\n?\211\233d1\224\247\170s=",PropMaximumPacketSize 2390]
TEST(SubACK5QCTest, Decode23) {
  uint8_t pkt[] = {0x90, 0xeb, 0x1,  0x70, 0x2d, 0xdf, 0x1,  0x9,  0x0,  0x1a, 0xc3, 0x38, 0x41, 0x7d, 0xd7, 0xbc, 0x31,
                   0x34, 0x19, 0x4c, 0xc1, 0x2f, 0x36, 0x43, 0xca, 0xc8, 0x93, 0x1,  0x9b, 0xee, 0x9c, 0xaf, 0xa4, 0x80,
                   0xb4, 0x76, 0x23, 0xc,  0xbb, 0x2,  0x0,  0x0,  0x2f, 0xf6, 0x15, 0x0,  0x3,  0xc6, 0x11, 0x56, 0x21,
                   0x50, 0x8,  0xb,  0x17, 0x26, 0x0,  0x0,  0x0,  0x1a, 0x1b, 0x7b, 0x2e, 0xe3, 0xf5, 0x5c, 0xcf, 0x64,
                   0x1f, 0xaa, 0x21, 0x84, 0x4a, 0x9,  0x19, 0x25, 0xfc, 0xe2, 0x12, 0xf0, 0xc,  0x5,  0xd,  0xc1, 0xb1,
                   0xcd, 0x13, 0x58, 0xb,  0xb,  0x15, 0x11, 0x0,  0x0,  0x3b, 0x22, 0x15, 0x0,  0x3,  0x3d, 0x85, 0x38,
                   0x28, 0x6f, 0x24, 0x55, 0x26, 0x0,  0x11, 0xd6, 0x53, 0xdd, 0xb3, 0x42, 0x6,  0xc4, 0x4a, 0x26, 0x5e,
                   0x27, 0x37, 0xb4, 0xc7, 0x24, 0x74, 0x32, 0x0,  0x0,  0x17, 0x91, 0x18, 0x0,  0x0,  0xf,  0x46, 0x27,
                   0x0,  0x0,  0x2f, 0x79, 0x1f, 0x0,  0x1d, 0xa5, 0xe6, 0xbb, 0xa9, 0xcf, 0x64, 0x20, 0xde, 0x8d, 0xf2,
                   0x5f, 0xf,  0x7c, 0xb,  0xb2, 0x1d, 0x5e, 0x93, 0x8,  0x5b, 0x1b, 0x3,  0x8e, 0x8b, 0x29, 0xb0, 0xaa,
                   0xb0, 0x64, 0xb,  0x1e, 0x13, 0x17, 0x14, 0x1f, 0x0,  0x7,  0x7a, 0x89, 0xb5, 0x4f, 0xe7, 0xcf, 0xa7,
                   0x26, 0x0,  0xe,  0xe1, 0xa0, 0xc6, 0xfc, 0x5d, 0x91, 0xb8, 0x18, 0x8b, 0x36, 0xbc, 0xa1, 0x30, 0xc,
                   0x0,  0x13, 0x3b, 0xdd, 0xfa, 0x42, 0xa3, 0x55, 0x71, 0x76, 0xa,  0x3f, 0xd3, 0xe9, 0x64, 0x31, 0xe0,
                   0xf7, 0xaa, 0x73, 0x3d, 0x27, 0x0,  0x0,  0x9,  0x56, 0x0,  0x97, 0xa2, 0x91, 0x2,  0x1,  0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 28717);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[1], 0x97);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], 0x91);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS2);
}

// SubscribeResponse 8736 [Right QoS1,Right QoS2,Left SubErrImplementationSpecificError,Right QoS2,Right QoS0,Right
// QoS1] [PropSharedSubscriptionAvailable 21,PropUserProperty "\192$&\227\ACKH\231o\186\200'vm\173"
// "\207?\228=\184\v\213\228\245T\163\194\FSG\162\192\202\180X\DLEg\138c\ACK\147\237\196\216\227",PropTopicAliasMaximum
// 12826]
TEST(SubACK5QCTest, Decode24) {
  uint8_t pkt[] = {0x90, 0x3e, 0x22, 0x20, 0x35, 0x2a, 0x15, 0x26, 0x0,  0xe,  0xc0, 0x24, 0x26, 0xe3, 0x6,  0x48,
                   0xe7, 0x6f, 0xba, 0xc8, 0x27, 0x76, 0x6d, 0xad, 0x0,  0x1d, 0xcf, 0x3f, 0xe4, 0x3d, 0xb8, 0xb,
                   0xd5, 0xe4, 0xf5, 0x54, 0xa3, 0xc2, 0x1c, 0x47, 0xa2, 0xc0, 0xca, 0xb4, 0x58, 0x10, 0x67, 0x8a,
                   0x63, 0x6,  0x93, 0xed, 0xc4, 0xd8, 0xe3, 0x22, 0x32, 0x1a, 0x1,  0x2,  0x83, 0x2,  0x0,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 8736);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], 0x83);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 27132 [Left SubErrWildcardSubscriptionsNotSupported,Left SubErrImplementationSpecificError,Right
// QoS0] [PropSessionExpiryInterval 29768,PropContentType "\DC3",PropRetainAvailable 129,PropWillDelayInterval
// 3417,PropSessionExpiryInterval 11868,PropSessionExpiryInterval 9277,PropRequestResponseInformation
// 147,PropServerKeepAlive 6086,PropAuthenticationData "l\215\STX\207\138\153\197\133T\STX\232\229{
// \141\147",PropAuthenticationMethod "i\203\193$\146\&0T\129uH\204",PropAuthenticationData
// "&E@\143wF\199\136\NULNS\185\175\225\149\155{\203W\241;\192\134\a",PropAssignedClientIdentifier
// "\185\139\185\139\246\242\153\196PJD\"\231\ESC\165A\250\176t\r\154J\213\239\"\195",PropServerKeepAlive
// 10472,PropReasonString "\186\182\239R\141\163/\EOT\163\196\173",PropRequestResponseInformation 159]
TEST(SubACK5QCTest, Decode25) {
  uint8_t pkt[] = {0x90, 0x92, 0x1,  0x69, 0xfc, 0x8b, 0x1,  0x11, 0x0,  0x0,  0x74, 0x48, 0x3,  0x0,  0x1,  0x13, 0x25,
                   0x81, 0x18, 0x0,  0x0,  0xd,  0x59, 0x11, 0x0,  0x0,  0x2e, 0x5c, 0x11, 0x0,  0x0,  0x24, 0x3d, 0x19,
                   0x93, 0x13, 0x17, 0xc6, 0x16, 0x0,  0x10, 0x6c, 0xd7, 0x2,  0xcf, 0x8a, 0x99, 0xc5, 0x85, 0x54, 0x2,
                   0xe8, 0xe5, 0x7b, 0x20, 0x8d, 0x93, 0x15, 0x0,  0xb,  0x69, 0xcb, 0xc1, 0x24, 0x92, 0x30, 0x54, 0x81,
                   0x75, 0x48, 0xcc, 0x16, 0x0,  0x18, 0x26, 0x45, 0x40, 0x8f, 0x77, 0x46, 0xc7, 0x88, 0x0,  0x4e, 0x53,
                   0xb9, 0xaf, 0xe1, 0x95, 0x9b, 0x7b, 0xcb, 0x57, 0xf1, 0x3b, 0xc0, 0x86, 0x7,  0x12, 0x0,  0x1a, 0xb9,
                   0x8b, 0xb9, 0x8b, 0xf6, 0xf2, 0x99, 0xc4, 0x50, 0x4a, 0x44, 0x22, 0xe7, 0x1b, 0xa5, 0x41, 0xfa, 0xb0,
                   0x74, 0xd,  0x9a, 0x4a, 0xd5, 0xef, 0x22, 0xc3, 0x13, 0x28, 0xe8, 0x1f, 0x0,  0xb,  0xba, 0xb6, 0xef,
                   0x52, 0x8d, 0xa3, 0x2f, 0x4,  0xa3, 0xc4, 0xad, 0x19, 0x9f, 0xa2, 0x83, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[3];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 3, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 27132);
  EXPECT_EQ(count, 3);
  EXPECT_EQ(granted_qos_levels[0], 0xA2);
  EXPECT_EQ(granted_qos_levels[1], 0x83);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
}

// SubscribeResponse 20260 [Right QoS2,Left SubErrPacketIdentifierInUse,Right QoS0,Right QoS2,Right QoS1,Right QoS1]
// [PropReceiveMaximum 25039,PropReasonString "6\174\ETX\RSBM\175\b\181\DC2+\246s",PropReceiveMaximum
// 32590,PropServerReference "\138z\187#\202\153\152",PropMaximumQoS 67,PropUserProperty
// "\160e\GS\161\144l\147g\r\174S\183\170\156\149tCm\203\248,\FS\232d\146"
// "\176\203EE\224\239\158j\166\SOHz\215MF\157\ETB\138DI\137\ACK\150\215\&0\141",PropAuthenticationData
// "$\192eZb\135Z$\161",PropSubscriptionIdentifier 7,PropPayloadFormatIndicator 117,PropReceiveMaximum
// 9335,PropSubscriptionIdentifierAvailable 163,PropSharedSubscriptionAvailable 107,PropSharedSubscriptionAvailable
// 141,PropTopicAlias 4296,PropMessageExpiryInterval 13428,PropMaximumPacketSize 15215,PropRetainAvailable
// 197,PropMessageExpiryInterval 12485,PropReceiveMaximum 11017,PropContentType
// "j\180\182\200\188Ul",PropCorrelationData "\\UP\243\172\NUL\f/z\186X\134\236\227R\192",PropUserProperty
// "\213\v\152\ESCBm\133\218C\r\130\194!{"
// "\129$F\179s0y\201\&2\180\143K\197|c\151\160F",PropWildcardSubscriptionAvailable 114,PropSharedSubscriptionAvailable
// 218,PropWillDelayInterval 4879,PropRequestResponseInformation 147,PropTopicAliasMaximum
// 13826,PropSubscriptionIdentifierAvailable 180,PropMessageExpiryInterval 18818,PropMaximumPacketSize 4173]
TEST(SubACK5QCTest, Decode26) {
  uint8_t pkt[] = {
      0x90, 0xef, 0x1,  0x4f, 0x24, 0xe5, 0x1,  0x21, 0x61, 0xcf, 0x1f, 0x0,  0xd,  0x36, 0xae, 0x3,  0x1e, 0x42, 0x4d,
      0xaf, 0x8,  0xb5, 0x12, 0x2b, 0xf6, 0x73, 0x21, 0x7f, 0x4e, 0x1c, 0x0,  0x7,  0x8a, 0x7a, 0xbb, 0x23, 0xca, 0x99,
      0x98, 0x24, 0x43, 0x26, 0x0,  0x19, 0xa0, 0x65, 0x1d, 0xa1, 0x90, 0x6c, 0x93, 0x67, 0xd,  0xae, 0x53, 0xb7, 0xaa,
      0x9c, 0x95, 0x74, 0x43, 0x6d, 0xcb, 0xf8, 0x2c, 0x1c, 0xe8, 0x64, 0x92, 0x0,  0x19, 0xb0, 0xcb, 0x45, 0x45, 0xe0,
      0xef, 0x9e, 0x6a, 0xa6, 0x1,  0x7a, 0xd7, 0x4d, 0x46, 0x9d, 0x17, 0x8a, 0x44, 0x49, 0x89, 0x6,  0x96, 0xd7, 0x30,
      0x8d, 0x16, 0x0,  0x9,  0x24, 0xc0, 0x65, 0x5a, 0x62, 0x87, 0x5a, 0x24, 0xa1, 0xb,  0x7,  0x1,  0x75, 0x21, 0x24,
      0x77, 0x29, 0xa3, 0x2a, 0x6b, 0x2a, 0x8d, 0x23, 0x10, 0xc8, 0x2,  0x0,  0x0,  0x34, 0x74, 0x27, 0x0,  0x0,  0x3b,
      0x6f, 0x25, 0xc5, 0x2,  0x0,  0x0,  0x30, 0xc5, 0x21, 0x2b, 0x9,  0x3,  0x0,  0x7,  0x6a, 0xb4, 0xb6, 0xc8, 0xbc,
      0x55, 0x6c, 0x9,  0x0,  0x10, 0x5c, 0x55, 0x50, 0xf3, 0xac, 0x0,  0xc,  0x2f, 0x7a, 0xba, 0x58, 0x86, 0xec, 0xe3,
      0x52, 0xc0, 0x26, 0x0,  0xe,  0xd5, 0xb,  0x98, 0x1b, 0x42, 0x6d, 0x85, 0xda, 0x43, 0xd,  0x82, 0xc2, 0x21, 0x7b,
      0x0,  0x12, 0x81, 0x24, 0x46, 0xb3, 0x73, 0x30, 0x79, 0xc9, 0x32, 0xb4, 0x8f, 0x4b, 0xc5, 0x7c, 0x63, 0x97, 0xa0,
      0x46, 0x28, 0x72, 0x2a, 0xda, 0x18, 0x0,  0x0,  0x13, 0xf,  0x19, 0x93, 0x22, 0x36, 0x2,  0x29, 0xb4, 0x2,  0x0,
      0x0,  0x49, 0x82, 0x27, 0x0,  0x0,  0x10, 0x4d, 0x2,  0x91, 0x0,  0x2,  0x1,  0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[6];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 6, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 20260);
  EXPECT_EQ(count, 6);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], LWMQTT_QOS1);
}

// SubscribeResponse 471 [Left SubErrSharedSubscriptionsNotSupported,Right QoS0,Right QoS0,Left
// SubErrNotAuthorized,Right QoS2,Left SubErrImplementationSpecificError,Right QoS1,Right QoS1]
// [PropMessageExpiryInterval 13269,PropMaximumPacketSize 22041,PropRetainAvailable
// 121,PropSubscriptionIdentifierAvailable 209]
TEST(SubACK5QCTest, Decode27) {
  uint8_t pkt[] = {0x90, 0x19, 0x1,  0xd7, 0xe,  0x2,  0x0, 0x0, 0x33, 0xd5, 0x27, 0x0, 0x0, 0x56,
                   0x19, 0x25, 0x79, 0x29, 0xd1, 0x9e, 0x0, 0x0, 0x87, 0x2,  0x83, 0x1, 0x1};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[8];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 8, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 471);
  EXPECT_EQ(count, 8);
  EXPECT_EQ(granted_qos_levels[0], 0x9E);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[3], 0x87);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[7], LWMQTT_QOS1);
}

// SubscribeResponse 21021 [Right QoS1,Right QoS2,Right QoS2,Right QoS2] [PropResponseInformation
// "\143\239n\n\SI\203\220\154\130\175\181}\226\144\150\159\&3\142",PropMessageExpiryInterval
// 25828,PropSubscriptionIdentifierAvailable 184,PropCorrelationData
// "~\NUL\236\190|6\221",PropWildcardSubscriptionAvailable 212,PropMessageExpiryInterval 21937,PropSessionExpiryInterval
// 22211,PropSubscriptionIdentifierAvailable 173,PropMessageExpiryInterval 16452,PropSharedSubscriptionAvailable 169]
TEST(SubACK5QCTest, Decode28) {
  uint8_t pkt[] = {0x90, 0x42, 0x52, 0x1d, 0x3b, 0x1a, 0x0,  0x12, 0x8f, 0xef, 0x6e, 0xa,  0xf,  0xcb, 0xdc, 0x9a, 0x82,
                   0xaf, 0xb5, 0x7d, 0xe2, 0x90, 0x96, 0x9f, 0x33, 0x8e, 0x2,  0x0,  0x0,  0x64, 0xe4, 0x29, 0xb8, 0x9,
                   0x0,  0x7,  0x7e, 0x0,  0xec, 0xbe, 0x7c, 0x36, 0xdd, 0x28, 0xd4, 0x2,  0x0,  0x0,  0x55, 0xb1, 0x11,
                   0x0,  0x0,  0x56, 0xc3, 0x29, 0xad, 0x2,  0x0,  0x0,  0x40, 0x44, 0x2a, 0xa9, 0x1,  0x2,  0x2,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[4];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 4, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 21021);
  EXPECT_EQ(count, 4);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[1], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[2], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS2);
}

// SubscribeResponse 3050 [Right QoS2,Left SubErrPacketIdentifierInUse,Left SubErrUnspecifiedError,Left
// SubErrUnspecifiedError,Left SubErrPacketIdentifierInUse,Left SubErrSharedSubscriptionsNotSupported,Right QoS0]
// [PropAuthenticationMethod "\248nv\143\249\166Q\244",PropAuthenticationMethod
// "\218\144)X\160\204Y;\135\SOH\244\200Y\229\245\237;O\210]!\163\139\145\164\222`=j",PropServerReference
// "\165\235\NAK\235\158\192\176\219\145\145\162\SIr\201\131\DEL\131\135\233\148\v\208VG\185\154b\178",PropMessageExpiryInterval
// 16134,PropMaximumQoS 206,PropTopicAliasMaximum 20322,PropReasonString "
// g\129\182B\173\177\254\r\ACK\186\&6\245\210\165\FS,\248]|",PropAuthenticationData
// ".\158\179\181\DC4.A\210O\128g\219i\196\v)\152",PropMaximumQoS 50,PropResponseInformation
// "p\210\143?0\144\DEL\SOH\131\178!\252\&5Z\ACK7\DC4=,\141B\v\181\243$\177K>\DC1\193",PropRequestProblemInformation
// 217,PropAssignedClientIdentifier "\DC3\178\140\230y\196\235:-\173\157l\173\188",PropMaximumPacketSize
// 8704,PropWildcardSubscriptionAvailable 198,PropResponseTopic
// "\EOTOk\147\211\SOH\203\162#\159)\178\209q\"\137",PropPayloadFormatIndicator 29,PropServerReference
// "\169\247",PropServerKeepAlive 7468,PropTopicAlias 13534,PropSharedSubscriptionAvailable
// 117,PropSubscriptionIdentifier 30,PropCorrelationData "nNt\203\206Q\178\r\185\EOT",PropMaximumQoS
// 95,PropWildcardSubscriptionAvailable 131,PropRetainAvailable 113,PropUserProperty "\145<\n\SUB\137\242\&5Z\204"
// "\SUB2\217j\136\175\145\128\230\202\ACK\134\255\144\v\224\159\193~\192\204i\150=;!s\255",PropTopicAliasMaximum 4299]
TEST(SubACK5QCTest, Decode29) {
  uint8_t pkt[] = {
      0x90, 0xab, 0x2,  0xb,  0xea, 0xa0, 0x2,  0x15, 0x0,  0x8,  0xf8, 0x6e, 0x76, 0x8f, 0xf9, 0xa6, 0x51, 0xf4, 0x15,
      0x0,  0x1d, 0xda, 0x90, 0x29, 0x58, 0xa0, 0xcc, 0x59, 0x3b, 0x87, 0x1,  0xf4, 0xc8, 0x59, 0xe5, 0xf5, 0xed, 0x3b,
      0x4f, 0xd2, 0x5d, 0x21, 0xa3, 0x8b, 0x91, 0xa4, 0xde, 0x60, 0x3d, 0x6a, 0x1c, 0x0,  0x1c, 0xa5, 0xeb, 0x15, 0xeb,
      0x9e, 0xc0, 0xb0, 0xdb, 0x91, 0x91, 0xa2, 0xf,  0x72, 0xc9, 0x83, 0x7f, 0x83, 0x87, 0xe9, 0x94, 0xb,  0xd0, 0x56,
      0x47, 0xb9, 0x9a, 0x62, 0xb2, 0x2,  0x0,  0x0,  0x3f, 0x6,  0x24, 0xce, 0x22, 0x4f, 0x62, 0x1f, 0x0,  0x14, 0x20,
      0x67, 0x81, 0xb6, 0x42, 0xad, 0xb1, 0xfe, 0xd,  0x6,  0xba, 0x36, 0xf5, 0xd2, 0xa5, 0x1c, 0x2c, 0xf8, 0x5d, 0x7c,
      0x16, 0x0,  0x11, 0x2e, 0x9e, 0xb3, 0xb5, 0x14, 0x2e, 0x41, 0xd2, 0x4f, 0x80, 0x67, 0xdb, 0x69, 0xc4, 0xb,  0x29,
      0x98, 0x24, 0x32, 0x1a, 0x0,  0x1e, 0x70, 0xd2, 0x8f, 0x3f, 0x30, 0x90, 0x7f, 0x1,  0x83, 0xb2, 0x21, 0xfc, 0x35,
      0x5a, 0x6,  0x37, 0x14, 0x3d, 0x2c, 0x8d, 0x42, 0xb,  0xb5, 0xf3, 0x24, 0xb1, 0x4b, 0x3e, 0x11, 0xc1, 0x17, 0xd9,
      0x12, 0x0,  0xe,  0x13, 0xb2, 0x8c, 0xe6, 0x79, 0xc4, 0xeb, 0x3a, 0x2d, 0xad, 0x9d, 0x6c, 0xad, 0xbc, 0x27, 0x0,
      0x0,  0x22, 0x0,  0x28, 0xc6, 0x8,  0x0,  0x10, 0x4,  0x4f, 0x6b, 0x93, 0xd3, 0x1,  0xcb, 0xa2, 0x23, 0x9f, 0x29,
      0xb2, 0xd1, 0x71, 0x22, 0x89, 0x1,  0x1d, 0x1c, 0x0,  0x2,  0xa9, 0xf7, 0x13, 0x1d, 0x2c, 0x23, 0x34, 0xde, 0x2a,
      0x75, 0xb,  0x1e, 0x9,  0x0,  0xa,  0x6e, 0x4e, 0x74, 0xcb, 0xce, 0x51, 0xb2, 0xd,  0xb9, 0x4,  0x24, 0x5f, 0x28,
      0x83, 0x25, 0x71, 0x26, 0x0,  0x9,  0x91, 0x3c, 0xa,  0x1a, 0x89, 0xf2, 0x35, 0x5a, 0xcc, 0x0,  0x1c, 0x1a, 0x32,
      0xd9, 0x6a, 0x88, 0xaf, 0x91, 0x80, 0xe6, 0xca, 0x6,  0x86, 0xff, 0x90, 0xb,  0xe0, 0x9f, 0xc1, 0x7e, 0xc0, 0xcc,
      0x69, 0x96, 0x3d, 0x3b, 0x21, 0x73, 0xff, 0x22, 0x10, 0xcb, 0x2,  0x91, 0x80, 0x80, 0x91, 0x9e, 0x0};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[7];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 7, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 3050);
  EXPECT_EQ(count, 7);
  EXPECT_EQ(granted_qos_levels[0], LWMQTT_QOS2);
  EXPECT_EQ(granted_qos_levels[1], 0x91);
  EXPECT_EQ(granted_qos_levels[2], 0x80);
  EXPECT_EQ(granted_qos_levels[3], 0x80);
  EXPECT_EQ(granted_qos_levels[4], 0x91);
  EXPECT_EQ(granted_qos_levels[5], 0x9E);
  EXPECT_EQ(granted_qos_levels[6], LWMQTT_QOS0);
}

// SubscribeResponse 9426 [Left SubErrUnspecifiedError,Left SubErrWildcardSubscriptionsNotSupported,Left
// SubErrWildcardSubscriptionsNotSupported,Right QoS1,Right QoS1,Left SubErrImplementationSpecificError,Left
// SubErrWildcardSubscriptionsNotSupported,Left SubErrSharedSubscriptionsNotSupported,Left
// SubErrTopicFilterInvalid,Right QoS0,Right QoS2] [PropSubscriptionIdentifierAvailable 177,PropContentType
// "\253'\175\175\255\138\n\233w\GS\179\DLE\RS,\fOUS\143\226\178K\184%/(",PropSharedSubscriptionAvailable
// 16,PropRequestProblemInformation 63,PropPayloadFormatIndicator 39,PropWildcardSubscriptionAvailable
// 52,PropAuthenticationMethod "\136\176",PropResponseInformation
// "\155A\235\220\214\129\250\203Q\199\245\228\187\220\132\222]-\171XQ",PropSubscriptionIdentifier
// 20,PropPayloadFormatIndicator 214,PropMessageExpiryInterval 31640,PropSubscriptionIdentifierAvailable
// 186,PropRequestResponseInformation 66,PropAuthenticationMethod "}\fV\211\231x\132",PropContentType
// ",\161\201I\197\180\SI$\252k\254P2\185U\180\212\204\196\138\DC2\152\183\206\194\145\193\255P",PropWillDelayInterval
// 6080,PropServerReference "x\132\SOH\215Z\156\160,#\DC3z\174q\198z\239-\220\155"]
TEST(SubACK5QCTest, Decode30) {
  uint8_t pkt[] = {0x90, 0xa5, 0x1,  0x24, 0xd2, 0x96, 0x1,  0x29, 0xb1, 0x3,  0x0,  0x1a, 0xfd, 0x27, 0xaf, 0xaf, 0xff,
                   0x8a, 0xa,  0xe9, 0x77, 0x1d, 0xb3, 0x10, 0x1e, 0x2c, 0xc,  0x4f, 0x55, 0x53, 0x8f, 0xe2, 0xb2, 0x4b,
                   0xb8, 0x25, 0x2f, 0x28, 0x2a, 0x10, 0x17, 0x3f, 0x1,  0x27, 0x28, 0x34, 0x15, 0x0,  0x2,  0x88, 0xb0,
                   0x1a, 0x0,  0x15, 0x9b, 0x41, 0xeb, 0xdc, 0xd6, 0x81, 0xfa, 0xcb, 0x51, 0xc7, 0xf5, 0xe4, 0xbb, 0xdc,
                   0x84, 0xde, 0x5d, 0x2d, 0xab, 0x58, 0x51, 0xb,  0x14, 0x1,  0xd6, 0x2,  0x0,  0x0,  0x7b, 0x98, 0x29,
                   0xba, 0x19, 0x42, 0x15, 0x0,  0x7,  0x7d, 0xc,  0x56, 0xd3, 0xe7, 0x78, 0x84, 0x3,  0x0,  0x1d, 0x2c,
                   0xa1, 0xc9, 0x49, 0xc5, 0xb4, 0xf,  0x24, 0xfc, 0x6b, 0xfe, 0x50, 0x32, 0xb9, 0x55, 0xb4, 0xd4, 0xcc,
                   0xc4, 0x8a, 0x12, 0x98, 0xb7, 0xce, 0xc2, 0x91, 0xc1, 0xff, 0x50, 0x18, 0x0,  0x0,  0x17, 0xc0, 0x1c,
                   0x0,  0x13, 0x78, 0x84, 0x1,  0xd7, 0x5a, 0x9c, 0xa0, 0x2c, 0x23, 0x13, 0x7a, 0xae, 0x71, 0xc6, 0x7a,
                   0xef, 0x2d, 0xdc, 0x9b, 0x80, 0xa2, 0xa2, 0x1,  0x1,  0x83, 0xa2, 0x9e, 0x8f, 0x0,  0x2};
  uint16_t packet_id;
  int count;
  lwmqtt_qos_t granted_qos_levels[11];
  lwmqtt_err_t err = lwmqtt_decode_suback(pkt, sizeof(pkt), &packet_id, LWMQTT_MQTT5, 11, &count, granted_qos_levels);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(packet_id, 9426);
  EXPECT_EQ(count, 11);
  EXPECT_EQ(granted_qos_levels[0], 0x80);
  EXPECT_EQ(granted_qos_levels[1], 0xA2);
  EXPECT_EQ(granted_qos_levels[2], 0xA2);
  EXPECT_EQ(granted_qos_levels[3], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[4], LWMQTT_QOS1);
  EXPECT_EQ(granted_qos_levels[5], 0x83);
  EXPECT_EQ(granted_qos_levels[6], 0xA2);
  EXPECT_EQ(granted_qos_levels[7], 0x9E);
  EXPECT_EQ(granted_qos_levels[8], 0x8F);
  EXPECT_EQ(granted_qos_levels[9], LWMQTT_QOS0);
  EXPECT_EQ(granted_qos_levels[10], LWMQTT_QOS2);
}

// UnsubscribeRequest 17193
// ["\201\232\214-\249\178\243\205$\220\150\232<\145\247","\167\SOH\185\173{\128\&73b\161rO\230\187\148\214\163\169\130\195\177\233\159l\249","K\ENQ\f\ACK\152\223","\169\DC1\140\210\EMO\172%;\SI\DLE\128\170U\SI\180\&7g\221\229
// ","\255/n\"\EOT\\P\199\f\DEL\254\EMgh\179\206\243>"] []
TEST(Unsubscribe311QCTest, Encode1) {
  uint8_t pkt[] = {0xa2, 0x61, 0x43, 0x29, 0x0,  0xf,  0xc9, 0xe8, 0xd6, 0x2d, 0xf9, 0xb2, 0xf3, 0xcd, 0x24, 0xdc, 0x96,
                   0xe8, 0x3c, 0x91, 0xf7, 0x0,  0x19, 0xa7, 0x1,  0xb9, 0xad, 0x7b, 0x80, 0x37, 0x33, 0x62, 0xa1, 0x72,
                   0x4f, 0xe6, 0xbb, 0x94, 0xd6, 0xa3, 0xa9, 0x82, 0xc3, 0xb1, 0xe9, 0x9f, 0x6c, 0xf9, 0x0,  0x6,  0x4b,
                   0x5,  0xc,  0x6,  0x98, 0xdf, 0x0,  0x15, 0xa9, 0x11, 0x8c, 0xd2, 0x19, 0x4f, 0xac, 0x25, 0x3b, 0xf,
                   0x10, 0x80, 0xaa, 0x55, 0xf,  0xb4, 0x37, 0x67, 0xdd, 0xe5, 0x20, 0x0,  0x12, 0xff, 0x2f, 0x6e, 0x22,
                   0x4,  0x5c, 0x50, 0xc7, 0xc,  0x7f, 0xfe, 0x19, 0x67, 0x68, 0xb3, 0xce, 0xf3, 0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xc9, 0xe8, 0xd6, 0x2d, 0xf9, 0xb2, 0xf3, 0xcd,
                                     0x24, 0xdc, 0x96, 0xe8, 0x3c, 0x91, 0xf7};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa7, 0x1,  0xb9, 0xad, 0x7b, 0x80, 0x37, 0x33, 0x62, 0xa1, 0x72, 0x4f, 0xe6,
                                     0xbb, 0x94, 0xd6, 0xa3, 0xa9, 0x82, 0xc3, 0xb1, 0xe9, 0x9f, 0x6c, 0xf9};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4b, 0x5, 0xc, 0x6, 0x98, 0xdf};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa9, 0x11, 0x8c, 0xd2, 0x19, 0x4f, 0xac, 0x25, 0x3b, 0xf, 0x10,
                                     0x80, 0xaa, 0x55, 0xf,  0xb4, 0x37, 0x67, 0xdd, 0xe5, 0x20};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xff, 0x2f, 0x6e, 0x22, 0x4,  0x5c, 0x50, 0xc7, 0xc,
                                     0x7f, 0xfe, 0x19, 0x67, 0x68, 0xb3, 0xce, 0xf3, 0x3e};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17193, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26830
// ["\218+\CAN,\224\168w\RSA\238#\r\212'\236M7g\185\213H9V\247)","-\222\193hv\157\140\193\135\212\152\212","\DEL\rs\210\"\178\STX\ENQ\226\231\ETX\247)\157c\218\174","\243eC
// v|F\170\188e\246w\177:\197J\219\212\184i\139\EOT\207\187\177\228\192\150?\134","\159\157\FS\135\152\130u\DC4\194","\151O\204\&1\251\ACK","46\222nn\188#\191\208{\DC4\208\217\195"]
// []
TEST(Unsubscribe311QCTest, Encode2) {
  uint8_t pkt[] = {0xa2, 0x81, 0x1,  0x68, 0xce, 0x0,  0x19, 0xda, 0x2b, 0x18, 0x2c, 0xe0, 0xa8, 0x77, 0x1e, 0x41, 0xee,
                   0x23, 0xd,  0xd4, 0x27, 0xec, 0x4d, 0x37, 0x67, 0xb9, 0xd5, 0x48, 0x39, 0x56, 0xf7, 0x29, 0x0,  0xc,
                   0x2d, 0xde, 0xc1, 0x68, 0x76, 0x9d, 0x8c, 0xc1, 0x87, 0xd4, 0x98, 0xd4, 0x0,  0x11, 0x7f, 0xd,  0x73,
                   0xd2, 0x22, 0xb2, 0x2,  0x5,  0xe2, 0xe7, 0x3,  0xf7, 0x29, 0x9d, 0x63, 0xda, 0xae, 0x0,  0x1e, 0xf3,
                   0x65, 0x43, 0x20, 0x76, 0x7c, 0x46, 0xaa, 0xbc, 0x65, 0xf6, 0x77, 0xb1, 0x3a, 0xc5, 0x4a, 0xdb, 0xd4,
                   0xb8, 0x69, 0x8b, 0x4,  0xcf, 0xbb, 0xb1, 0xe4, 0xc0, 0x96, 0x3f, 0x86, 0x0,  0x9,  0x9f, 0x9d, 0x1c,
                   0x87, 0x98, 0x82, 0x75, 0x14, 0xc2, 0x0,  0x6,  0x97, 0x4f, 0xcc, 0x31, 0xfb, 0x6,  0x0,  0xe,  0x34,
                   0x36, 0xde, 0x6e, 0x6e, 0xbc, 0x23, 0xbf, 0xd0, 0x7b, 0x14, 0xd0, 0xd9, 0xc3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xda, 0x2b, 0x18, 0x2c, 0xe0, 0xa8, 0x77, 0x1e, 0x41, 0xee, 0x23, 0xd, 0xd4,
                                     0x27, 0xec, 0x4d, 0x37, 0x67, 0xb9, 0xd5, 0x48, 0x39, 0x56, 0xf7, 0x29};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d, 0xde, 0xc1, 0x68, 0x76, 0x9d, 0x8c, 0xc1, 0x87, 0xd4, 0x98, 0xd4};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7f, 0xd, 0x73, 0xd2, 0x22, 0xb2, 0x2,  0x5, 0xe2,
                                     0xe7, 0x3, 0xf7, 0x29, 0x9d, 0x63, 0xda, 0xae};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf3, 0x65, 0x43, 0x20, 0x76, 0x7c, 0x46, 0xaa, 0xbc, 0x65,
                                     0xf6, 0x77, 0xb1, 0x3a, 0xc5, 0x4a, 0xdb, 0xd4, 0xb8, 0x69,
                                     0x8b, 0x4,  0xcf, 0xbb, 0xb1, 0xe4, 0xc0, 0x96, 0x3f, 0x86};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9f, 0x9d, 0x1c, 0x87, 0x98, 0x82, 0x75, 0x14, 0xc2};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x97, 0x4f, 0xcc, 0x31, 0xfb, 0x6};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x34, 0x36, 0xde, 0x6e, 0x6e, 0xbc, 0x23,
                                     0xbf, 0xd0, 0x7b, 0x14, 0xd0, 0xd9, 0xc3};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26830, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 23824 ["\226W\ETX\192;\167?\SO \145"] []
TEST(Unsubscribe311QCTest, Encode3) {
  uint8_t pkt[] = {0xa2, 0xe, 0x5d, 0x10, 0x0, 0xa, 0xe2, 0x57, 0x3, 0xc0, 0x3b, 0xa7, 0x3f, 0xe, 0x20, 0x91};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xe2, 0x57, 0x3, 0xc0, 0x3b, 0xa7, 0x3f, 0xe, 0x20, 0x91};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 23824, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 20314
// ["\247$\SOcz\155#\129\206\189\129\151\230\250[\179\254\214=v\GS\230\237\227\174\157\ETB\ESC\189"] []
TEST(Unsubscribe311QCTest, Encode4) {
  uint8_t pkt[] = {0xa2, 0x21, 0x4f, 0x5a, 0x0,  0x1d, 0xf7, 0x24, 0xe,  0x63, 0x7a, 0x9b,
                   0x23, 0x81, 0xce, 0xbd, 0x81, 0x97, 0xe6, 0xfa, 0x5b, 0xb3, 0xfe, 0xd6,
                   0x3d, 0x76, 0x1d, 0xe6, 0xed, 0xe3, 0xae, 0x9d, 0x17, 0x1b, 0xbd};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xf7, 0x24, 0xe,  0x63, 0x7a, 0x9b, 0x23, 0x81, 0xce, 0xbd,
                                     0x81, 0x97, 0xe6, 0xfa, 0x5b, 0xb3, 0xfe, 0xd6, 0x3d, 0x76,
                                     0x1d, 0xe6, 0xed, 0xe3, 0xae, 0x9d, 0x17, 0x1b, 0xbd};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20314, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 29664
// ["\214i\176\156X)\134(\251ux\210\240\DC1\SUB\200\219\EM\219l\213\170B","=\197\235\163\&1\EM\ENQ\255\181\143\201\171vu_o","6\134~W\204","7\223'\b\224\232u","\166v\184[x","z\n\135.Z\170\&9\208\249\231|\132",":1\229C\168\137","7\181\161\220\150\219:\219\171i\226u\150\195`\169","\223\233\205\n\174\ETB\193\ETB\v\255\&0\137u\158\136D\201\&1","\EMX\246C\131J
// \242>:\SOH\164"] []
TEST(Unsubscribe311QCTest, Encode5) {
  uint8_t pkt[] = {0xa2, 0x8e, 0x1,  0x73, 0xe0, 0x0,  0x17, 0xd6, 0x69, 0xb0, 0x9c, 0x58, 0x29, 0x86, 0x28, 0xfb, 0x75,
                   0x78, 0xd2, 0xf0, 0x11, 0x1a, 0xc8, 0xdb, 0x19, 0xdb, 0x6c, 0xd5, 0xaa, 0x42, 0x0,  0x10, 0x3d, 0xc5,
                   0xeb, 0xa3, 0x31, 0x19, 0x5,  0xff, 0xb5, 0x8f, 0xc9, 0xab, 0x76, 0x75, 0x5f, 0x6f, 0x0,  0x5,  0x36,
                   0x86, 0x7e, 0x57, 0xcc, 0x0,  0x7,  0x37, 0xdf, 0x27, 0x8,  0xe0, 0xe8, 0x75, 0x0,  0x5,  0xa6, 0x76,
                   0xb8, 0x5b, 0x78, 0x0,  0xc,  0x7a, 0xa,  0x87, 0x2e, 0x5a, 0xaa, 0x39, 0xd0, 0xf9, 0xe7, 0x7c, 0x84,
                   0x0,  0x6,  0x3a, 0x31, 0xe5, 0x43, 0xa8, 0x89, 0x0,  0x10, 0x37, 0xb5, 0xa1, 0xdc, 0x96, 0xdb, 0x3a,
                   0xdb, 0xab, 0x69, 0xe2, 0x75, 0x96, 0xc3, 0x60, 0xa9, 0x0,  0x12, 0xdf, 0xe9, 0xcd, 0xa,  0xae, 0x17,
                   0xc1, 0x17, 0xb,  0xff, 0x30, 0x89, 0x75, 0x9e, 0x88, 0x44, 0xc9, 0x31, 0x0,  0xc,  0x19, 0x58, 0xf6,
                   0x43, 0x83, 0x4a, 0x20, 0xf2, 0x3e, 0x3a, 0x1,  0xa4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd6, 0x69, 0xb0, 0x9c, 0x58, 0x29, 0x86, 0x28, 0xfb, 0x75, 0x78, 0xd2,
                                     0xf0, 0x11, 0x1a, 0xc8, 0xdb, 0x19, 0xdb, 0x6c, 0xd5, 0xaa, 0x42};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3d, 0xc5, 0xeb, 0xa3, 0x31, 0x19, 0x5,  0xff,
                                     0xb5, 0x8f, 0xc9, 0xab, 0x76, 0x75, 0x5f, 0x6f};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x36, 0x86, 0x7e, 0x57, 0xcc};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x37, 0xdf, 0x27, 0x8, 0xe0, 0xe8, 0x75};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa6, 0x76, 0xb8, 0x5b, 0x78};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7a, 0xa, 0x87, 0x2e, 0x5a, 0xaa, 0x39, 0xd0, 0xf9, 0xe7, 0x7c, 0x84};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3a, 0x31, 0xe5, 0x43, 0xa8, 0x89};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x37, 0xb5, 0xa1, 0xdc, 0x96, 0xdb, 0x3a, 0xdb,
                                     0xab, 0x69, 0xe2, 0x75, 0x96, 0xc3, 0x60, 0xa9};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xdf, 0xe9, 0xcd, 0xa,  0xae, 0x17, 0xc1, 0x17, 0xb,
                                     0xff, 0x30, 0x89, 0x75, 0x9e, 0x88, 0x44, 0xc9, 0x31};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x19, 0x58, 0xf6, 0x43, 0x83, 0x4a, 0x20, 0xf2, 0x3e, 0x3a, 0x1, 0xa4};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 29664, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28866 ["\ACK"] []
TEST(Unsubscribe311QCTest, Encode6) {
  uint8_t pkt[] = {0xa2, 0x5, 0x70, 0xc2, 0x0, 0x1, 0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x6};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28866, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22023 ["f\155\163\EOT\DLE\ETX\209\SO","d\219\136\ENQC\167\239$\224","e{[\245\153\203\211*~\193"]
// []
TEST(Unsubscribe311QCTest, Encode7) {
  uint8_t pkt[] = {0xa2, 0x23, 0x56, 0x7,  0x0,  0x8,  0x66, 0x9b, 0xa3, 0x4,  0x10, 0x3,  0xd1,
                   0xe,  0x0,  0x9,  0x64, 0xdb, 0x88, 0x5,  0x43, 0xa7, 0xef, 0x24, 0xe0, 0x0,
                   0xa,  0x65, 0x7b, 0x5b, 0xf5, 0x99, 0xcb, 0xd3, 0x2a, 0x7e, 0xc1};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x66, 0x9b, 0xa3, 0x4, 0x10, 0x3, 0xd1, 0xe};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x64, 0xdb, 0x88, 0x5, 0x43, 0xa7, 0xef, 0x24, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x65, 0x7b, 0x5b, 0xf5, 0x99, 0xcb, 0xd3, 0x2a, 0x7e, 0xc1};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22023, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28799
// ["\n\DC3\242\212\169e\178\133","\175\193&\241\184C\SO\NAK\147\164[_\NAKK\180\249\202\fq\246\RS"] []
TEST(Unsubscribe311QCTest, Encode8) {
  uint8_t pkt[] = {0xa2, 0x23, 0x70, 0x7f, 0x0,  0x8,  0xa,  0x13, 0xf2, 0xd4, 0xa9, 0x65, 0xb2,
                   0x85, 0x0,  0x15, 0xaf, 0xc1, 0x26, 0xf1, 0xb8, 0x43, 0xe,  0x15, 0x93, 0xa4,
                   0x5b, 0x5f, 0x15, 0x4b, 0xb4, 0xf9, 0xca, 0xc,  0x71, 0xf6, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xa, 0x13, 0xf2, 0xd4, 0xa9, 0x65, 0xb2, 0x85};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaf, 0xc1, 0x26, 0xf1, 0xb8, 0x43, 0xe, 0x15, 0x93, 0xa4, 0x5b,
                                     0x5f, 0x15, 0x4b, 0xb4, 0xf9, 0xca, 0xc, 0x71, 0xf6, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 28799, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 20344
// ["\132&\189So\207\US\218VGo\190\255u\223\192\228\&7]\EOTM\164\206\171IIN[W","\234\252\195\214\201.\223\160\FSx\204\229\237{-<r\249\235\228\233$\209\192","+\131\193a7\DC4\217\254\195'U\134","\209@\209\148\232\233\173K\167\245/\162\207\176","\DC2\SI,C\178\246\b\132\ETX","i\228\163\EOTH\244\169","\SUB\162\249\211\154-\194\212\246z\215a\206l\211\253\236\150\181Zl\149\193\158\198\173H\226A"]
// []
TEST(Unsubscribe311QCTest, Encode9) {
  uint8_t pkt[] = {0xa2, 0x8c, 0x1,  0x4f, 0x78, 0x0,  0x1d, 0x84, 0x26, 0xbd, 0x53, 0x6f, 0xcf, 0x1f, 0xda, 0x56,
                   0x47, 0x6f, 0xbe, 0xff, 0x75, 0xdf, 0xc0, 0xe4, 0x37, 0x5d, 0x4,  0x4d, 0xa4, 0xce, 0xab, 0x49,
                   0x49, 0x4e, 0x5b, 0x57, 0x0,  0x18, 0xea, 0xfc, 0xc3, 0xd6, 0xc9, 0x2e, 0xdf, 0xa0, 0x1c, 0x78,
                   0xcc, 0xe5, 0xed, 0x7b, 0x2d, 0x3c, 0x72, 0xf9, 0xeb, 0xe4, 0xe9, 0x24, 0xd1, 0xc0, 0x0,  0xc,
                   0x2b, 0x83, 0xc1, 0x61, 0x37, 0x14, 0xd9, 0xfe, 0xc3, 0x27, 0x55, 0x86, 0x0,  0xe,  0xd1, 0x40,
                   0xd1, 0x94, 0xe8, 0xe9, 0xad, 0x4b, 0xa7, 0xf5, 0x2f, 0xa2, 0xcf, 0xb0, 0x0,  0x9,  0x12, 0xf,
                   0x2c, 0x43, 0xb2, 0xf6, 0x8,  0x84, 0x3,  0x0,  0x7,  0x69, 0xe4, 0xa3, 0x4,  0x48, 0xf4, 0xa9,
                   0x0,  0x1d, 0x1a, 0xa2, 0xf9, 0xd3, 0x9a, 0x2d, 0xc2, 0xd4, 0xf6, 0x7a, 0xd7, 0x61, 0xce, 0x6c,
                   0xd3, 0xfd, 0xec, 0x96, 0xb5, 0x5a, 0x6c, 0x95, 0xc1, 0x9e, 0xc6, 0xad, 0x48, 0xe2, 0x41};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x84, 0x26, 0xbd, 0x53, 0x6f, 0xcf, 0x1f, 0xda, 0x56, 0x47,
                                     0x6f, 0xbe, 0xff, 0x75, 0xdf, 0xc0, 0xe4, 0x37, 0x5d, 0x4,
                                     0x4d, 0xa4, 0xce, 0xab, 0x49, 0x49, 0x4e, 0x5b, 0x57};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xea, 0xfc, 0xc3, 0xd6, 0xc9, 0x2e, 0xdf, 0xa0, 0x1c, 0x78, 0xcc, 0xe5,
                                     0xed, 0x7b, 0x2d, 0x3c, 0x72, 0xf9, 0xeb, 0xe4, 0xe9, 0x24, 0xd1, 0xc0};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2b, 0x83, 0xc1, 0x61, 0x37, 0x14, 0xd9, 0xfe, 0xc3, 0x27, 0x55, 0x86};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd1, 0x40, 0xd1, 0x94, 0xe8, 0xe9, 0xad,
                                     0x4b, 0xa7, 0xf5, 0x2f, 0xa2, 0xcf, 0xb0};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0xf, 0x2c, 0x43, 0xb2, 0xf6, 0x8, 0x84, 0x3};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x69, 0xe4, 0xa3, 0x4, 0x48, 0xf4, 0xa9};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1a, 0xa2, 0xf9, 0xd3, 0x9a, 0x2d, 0xc2, 0xd4, 0xf6, 0x7a,
                                     0xd7, 0x61, 0xce, 0x6c, 0xd3, 0xfd, 0xec, 0x96, 0xb5, 0x5a,
                                     0x6c, 0x95, 0xc1, 0x9e, 0xc6, 0xad, 0x48, 0xe2, 0x41};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 20344, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17201
// ["E9\225\244J\192JB\f\160(lt\188^bi","\ETB@\\{\134R\230\250\NAK\128\&8\150\248\143\251*\215ST\DC2$B\181","\188nV\144\253\231\229a\DC3]j4X\165\138\216a\227\242","\GS\140A\175\EMk\248\170\177\234\NAK\223\DEL\251\244\&7y\FS","Nw\187\SUB<lm@\DC3\253t\133t\191","\178\159\203$\179\232D\161\165Je\220\241","5\220\228"]
// []
TEST(Unsubscribe311QCTest, Encode10) {
  uint8_t pkt[] = {0xa2, 0x7b, 0x43, 0x31, 0x0,  0x11, 0x45, 0x39, 0xe1, 0xf4, 0x4a, 0xc0, 0x4a, 0x42, 0xc,  0xa0,
                   0x28, 0x6c, 0x74, 0xbc, 0x5e, 0x62, 0x69, 0x0,  0x17, 0x17, 0x40, 0x5c, 0x7b, 0x86, 0x52, 0xe6,
                   0xfa, 0x15, 0x80, 0x38, 0x96, 0xf8, 0x8f, 0xfb, 0x2a, 0xd7, 0x53, 0x54, 0x12, 0x24, 0x42, 0xb5,
                   0x0,  0x13, 0xbc, 0x6e, 0x56, 0x90, 0xfd, 0xe7, 0xe5, 0x61, 0x13, 0x5d, 0x6a, 0x34, 0x58, 0xa5,
                   0x8a, 0xd8, 0x61, 0xe3, 0xf2, 0x0,  0x12, 0x1d, 0x8c, 0x41, 0xaf, 0x19, 0x6b, 0xf8, 0xaa, 0xb1,
                   0xea, 0x15, 0xdf, 0x7f, 0xfb, 0xf4, 0x37, 0x79, 0x1c, 0x0,  0xe,  0x4e, 0x77, 0xbb, 0x1a, 0x3c,
                   0x6c, 0x6d, 0x40, 0x13, 0xfd, 0x74, 0x85, 0x74, 0xbf, 0x0,  0xd,  0xb2, 0x9f, 0xcb, 0x24, 0xb3,
                   0xe8, 0x44, 0xa1, 0xa5, 0x4a, 0x65, 0xdc, 0xf1, 0x0,  0x3,  0x35, 0xdc, 0xe4};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x45, 0x39, 0xe1, 0xf4, 0x4a, 0xc0, 0x4a, 0x42, 0xc,
                                     0xa0, 0x28, 0x6c, 0x74, 0xbc, 0x5e, 0x62, 0x69};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x17, 0x40, 0x5c, 0x7b, 0x86, 0x52, 0xe6, 0xfa, 0x15, 0x80, 0x38, 0x96,
                                     0xf8, 0x8f, 0xfb, 0x2a, 0xd7, 0x53, 0x54, 0x12, 0x24, 0x42, 0xb5};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xbc, 0x6e, 0x56, 0x90, 0xfd, 0xe7, 0xe5, 0x61, 0x13, 0x5d,
                                     0x6a, 0x34, 0x58, 0xa5, 0x8a, 0xd8, 0x61, 0xe3, 0xf2};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1d, 0x8c, 0x41, 0xaf, 0x19, 0x6b, 0xf8, 0xaa, 0xb1,
                                     0xea, 0x15, 0xdf, 0x7f, 0xfb, 0xf4, 0x37, 0x79, 0x1c};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4e, 0x77, 0xbb, 0x1a, 0x3c, 0x6c, 0x6d,
                                     0x40, 0x13, 0xfd, 0x74, 0x85, 0x74, 0xbf};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb2, 0x9f, 0xcb, 0x24, 0xb3, 0xe8, 0x44, 0xa1, 0xa5, 0x4a, 0x65, 0xdc, 0xf1};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x35, 0xdc, 0xe4};
  lwmqtt_string_t topic_filter_s6 = {3, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17201, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17486
// ["a\ETX","\129\230^\155\234\&7s\234#C\235[\217\184\218\193\151}>Yj\DC2\239\167\132\159{","\221\ESCwC\170\ESC3\SYN\247\206"]
// []
TEST(Unsubscribe311QCTest, Encode11) {
  uint8_t pkt[] = {0xa2, 0x2f, 0x44, 0x4e, 0x0,  0x2,  0x61, 0x3,  0x0,  0x1b, 0x81, 0xe6, 0x5e, 0x9b, 0xea, 0x37, 0x73,
                   0xea, 0x23, 0x43, 0xeb, 0x5b, 0xd9, 0xb8, 0xda, 0xc1, 0x97, 0x7d, 0x3e, 0x59, 0x6a, 0x12, 0xef, 0xa7,
                   0x84, 0x9f, 0x7b, 0x0,  0xa,  0xdd, 0x1b, 0x77, 0x43, 0xaa, 0x1b, 0x33, 0x16, 0xf7, 0xce};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x61, 0x3};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x81, 0xe6, 0x5e, 0x9b, 0xea, 0x37, 0x73, 0xea, 0x23, 0x43, 0xeb, 0x5b, 0xd9, 0xb8,
                                     0xda, 0xc1, 0x97, 0x7d, 0x3e, 0x59, 0x6a, 0x12, 0xef, 0xa7, 0x84, 0x9f, 0x7b};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdd, 0x1b, 0x77, 0x43, 0xaa, 0x1b, 0x33, 0x16, 0xf7, 0xce};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 17486, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 7754 ["\211\172/9\239\190\154\155:\145\238\225c\242\144\159\183"] []
TEST(Unsubscribe311QCTest, Encode12) {
  uint8_t pkt[] = {0xa2, 0x15, 0x1e, 0x4a, 0x0,  0x11, 0xd3, 0xac, 0x2f, 0x39, 0xef, 0xbe,
                   0x9a, 0x9b, 0x3a, 0x91, 0xee, 0xe1, 0x63, 0xf2, 0x90, 0x9f, 0xb7};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xd3, 0xac, 0x2f, 0x39, 0xef, 0xbe, 0x9a, 0x9b, 0x3a,
                                     0x91, 0xee, 0xe1, 0x63, 0xf2, 0x90, 0x9f, 0xb7};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 7754, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 949 ["\139xV\142E\139\&7\179T\130\212\250G\195F\193\252\250\202{\196z\228\164\STX\US\219"] []
TEST(Unsubscribe311QCTest, Encode13) {
  uint8_t pkt[] = {0xa2, 0x1f, 0x3,  0xb5, 0x0,  0x1b, 0x8b, 0x78, 0x56, 0x8e, 0x45, 0x8b, 0x37, 0xb3, 0x54, 0x82, 0xd4,
                   0xfa, 0x47, 0xc3, 0x46, 0xc1, 0xfc, 0xfa, 0xca, 0x7b, 0xc4, 0x7a, 0xe4, 0xa4, 0x2,  0x1f, 0xdb};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x8b, 0x78, 0x56, 0x8e, 0x45, 0x8b, 0x37, 0xb3, 0x54, 0x82, 0xd4, 0xfa, 0x47, 0xc3,
                                     0x46, 0xc1, 0xfc, 0xfa, 0xca, 0x7b, 0xc4, 0x7a, 0xe4, 0xa4, 0x2,  0x1f, 0xdb};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 949, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5184
// ["\160\156\&1\155\217\US\192\233A\170\&6f\208I","\ENQ\r\NAK\179\221\CAN\215\212\191\237F\250\ESC'\255a\132\132W>\231","\169\255\rPZLI'\SO\SYN\158\226\192\203\CAN[\136\168\185","\227Jq\248\&3\215\SYN=\200\169(\221\NAKe0>\147\156pZ\131e\165\ETB\252\152d\245\133\174","\192\144\SI\216f\194_\160\160'\US}\195VY\222\235\217\186%\198T]\247","\239Z\211\232","J\184i\172\147\218PR\190~\at/\158\152T\135\"\144\RS3\139","\167\176.\244x\254S\EOT!N\202z\154T\210\DC3G\DLE\130","\194","\165\208\135\190\165G"]
// []
TEST(Unsubscribe311QCTest, Encode14) {
  uint8_t pkt[] = {0xa2, 0xb6, 0x1,  0x14, 0x40, 0x0,  0xe,  0xa0, 0x9c, 0x31, 0x9b, 0xd9, 0x1f, 0xc0, 0xe9, 0x41, 0xaa,
                   0x36, 0x66, 0xd0, 0x49, 0x0,  0x15, 0x5,  0xd,  0x15, 0xb3, 0xdd, 0x18, 0xd7, 0xd4, 0xbf, 0xed, 0x46,
                   0xfa, 0x1b, 0x27, 0xff, 0x61, 0x84, 0x84, 0x57, 0x3e, 0xe7, 0x0,  0x13, 0xa9, 0xff, 0xd,  0x50, 0x5a,
                   0x4c, 0x49, 0x27, 0xe,  0x16, 0x9e, 0xe2, 0xc0, 0xcb, 0x18, 0x5b, 0x88, 0xa8, 0xb9, 0x0,  0x1e, 0xe3,
                   0x4a, 0x71, 0xf8, 0x33, 0xd7, 0x16, 0x3d, 0xc8, 0xa9, 0x28, 0xdd, 0x15, 0x65, 0x30, 0x3e, 0x93, 0x9c,
                   0x70, 0x5a, 0x83, 0x65, 0xa5, 0x17, 0xfc, 0x98, 0x64, 0xf5, 0x85, 0xae, 0x0,  0x18, 0xc0, 0x90, 0xf,
                   0xd8, 0x66, 0xc2, 0x5f, 0xa0, 0xa0, 0x27, 0x1f, 0x7d, 0xc3, 0x56, 0x59, 0xde, 0xeb, 0xd9, 0xba, 0x25,
                   0xc6, 0x54, 0x5d, 0xf7, 0x0,  0x4,  0xef, 0x5a, 0xd3, 0xe8, 0x0,  0x16, 0x4a, 0xb8, 0x69, 0xac, 0x93,
                   0xda, 0x50, 0x52, 0xbe, 0x7e, 0x7,  0x74, 0x2f, 0x9e, 0x98, 0x54, 0x87, 0x22, 0x90, 0x1e, 0x33, 0x8b,
                   0x0,  0x13, 0xa7, 0xb0, 0x2e, 0xf4, 0x78, 0xfe, 0x53, 0x4,  0x21, 0x4e, 0xca, 0x7a, 0x9a, 0x54, 0xd2,
                   0x13, 0x47, 0x10, 0x82, 0x0,  0x1,  0xc2, 0x0,  0x6,  0xa5, 0xd0, 0x87, 0xbe, 0xa5, 0x47};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xa0, 0x9c, 0x31, 0x9b, 0xd9, 0x1f, 0xc0,
                                     0xe9, 0x41, 0xaa, 0x36, 0x66, 0xd0, 0x49};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5,  0xd,  0x15, 0xb3, 0xdd, 0x18, 0xd7, 0xd4, 0xbf, 0xed, 0x46,
                                     0xfa, 0x1b, 0x27, 0xff, 0x61, 0x84, 0x84, 0x57, 0x3e, 0xe7};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0xff, 0xd,  0x50, 0x5a, 0x4c, 0x49, 0x27, 0xe, 0x16,
                                     0x9e, 0xe2, 0xc0, 0xcb, 0x18, 0x5b, 0x88, 0xa8, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe3, 0x4a, 0x71, 0xf8, 0x33, 0xd7, 0x16, 0x3d, 0xc8, 0xa9,
                                     0x28, 0xdd, 0x15, 0x65, 0x30, 0x3e, 0x93, 0x9c, 0x70, 0x5a,
                                     0x83, 0x65, 0xa5, 0x17, 0xfc, 0x98, 0x64, 0xf5, 0x85, 0xae};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc0, 0x90, 0xf,  0xd8, 0x66, 0xc2, 0x5f, 0xa0, 0xa0, 0x27, 0x1f, 0x7d,
                                     0xc3, 0x56, 0x59, 0xde, 0xeb, 0xd9, 0xba, 0x25, 0xc6, 0x54, 0x5d, 0xf7};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xef, 0x5a, 0xd3, 0xe8};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4a, 0xb8, 0x69, 0xac, 0x93, 0xda, 0x50, 0x52, 0xbe, 0x7e, 0x7,
                                     0x74, 0x2f, 0x9e, 0x98, 0x54, 0x87, 0x22, 0x90, 0x1e, 0x33, 0x8b};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa7, 0xb0, 0x2e, 0xf4, 0x78, 0xfe, 0x53, 0x4,  0x21, 0x4e,
                                     0xca, 0x7a, 0x9a, 0x54, 0xd2, 0x13, 0x47, 0x10, 0x82};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc2};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa5, 0xd0, 0x87, 0xbe, 0xa5, 0x47};
  lwmqtt_string_t topic_filter_s9 = {6, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5184, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 21743
// ["g\SUB\173Z5\135\245\NUL\138\243\130\165\170M\184/O\ETX\214$\241\DC3\147\&8WZ'","\243\253\202\167\210\ACK\253w\239\248\128\US\184\153\242E\242\132\219nOk\250\242qR","\"","U\138\193\246\162T_\SUB\206\&4","\154\&0Tav\255\213\&1\DC2Y","\252=\144O\"ETDc\221\130\228E_4a\DC2\253fn\209\187\138#3","F9\a\224\133\201\252\255\151\253\220\EOT\NUL\ETB3m\140o\135\215lSi\140\155\240\&2\SOH\211\128"]
// []
TEST(Unsubscribe311QCTest, Encode15) {
  uint8_t pkt[] = {0xa2, 0x91, 0x1,  0x54, 0xef, 0x0,  0x1b, 0x67, 0x1a, 0xad, 0x5a, 0x35, 0x87, 0xf5, 0x0,  0x8a, 0xf3,
                   0x82, 0xa5, 0xaa, 0x4d, 0xb8, 0x2f, 0x4f, 0x3,  0xd6, 0x24, 0xf1, 0x13, 0x93, 0x38, 0x57, 0x5a, 0x27,
                   0x0,  0x1a, 0xf3, 0xfd, 0xca, 0xa7, 0xd2, 0x6,  0xfd, 0x77, 0xef, 0xf8, 0x80, 0x1f, 0xb8, 0x99, 0xf2,
                   0x45, 0xf2, 0x84, 0xdb, 0x6e, 0x4f, 0x6b, 0xfa, 0xf2, 0x71, 0x52, 0x0,  0x1,  0x22, 0x0,  0xa,  0x55,
                   0x8a, 0xc1, 0xf6, 0xa2, 0x54, 0x5f, 0x1a, 0xce, 0x34, 0x0,  0xa,  0x9a, 0x30, 0x54, 0x61, 0x76, 0xff,
                   0xd5, 0x31, 0x12, 0x59, 0x0,  0x19, 0xfc, 0x3d, 0x90, 0x4f, 0x22, 0x45, 0x54, 0x44, 0x63, 0xdd, 0x82,
                   0xe4, 0x45, 0x5f, 0x34, 0x61, 0x12, 0xfd, 0x66, 0x6e, 0xd1, 0xbb, 0x8a, 0x23, 0x33, 0x0,  0x1e, 0x46,
                   0x39, 0x7,  0xe0, 0x85, 0xc9, 0xfc, 0xff, 0x97, 0xfd, 0xdc, 0x4,  0x0,  0x17, 0x33, 0x6d, 0x8c, 0x6f,
                   0x87, 0xd7, 0x6c, 0x53, 0x69, 0x8c, 0x9b, 0xf0, 0x32, 0x1,  0xd3, 0x80};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x67, 0x1a, 0xad, 0x5a, 0x35, 0x87, 0xf5, 0x0,  0x8a, 0xf3, 0x82, 0xa5, 0xaa, 0x4d,
                                     0xb8, 0x2f, 0x4f, 0x3,  0xd6, 0x24, 0xf1, 0x13, 0x93, 0x38, 0x57, 0x5a, 0x27};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf3, 0xfd, 0xca, 0xa7, 0xd2, 0x6,  0xfd, 0x77, 0xef, 0xf8, 0x80, 0x1f, 0xb8,
                                     0x99, 0xf2, 0x45, 0xf2, 0x84, 0xdb, 0x6e, 0x4f, 0x6b, 0xfa, 0xf2, 0x71, 0x52};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x22};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x55, 0x8a, 0xc1, 0xf6, 0xa2, 0x54, 0x5f, 0x1a, 0xce, 0x34};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9a, 0x30, 0x54, 0x61, 0x76, 0xff, 0xd5, 0x31, 0x12, 0x59};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfc, 0x3d, 0x90, 0x4f, 0x22, 0x45, 0x54, 0x44, 0x63, 0xdd, 0x82, 0xe4, 0x45,
                                     0x5f, 0x34, 0x61, 0x12, 0xfd, 0x66, 0x6e, 0xd1, 0xbb, 0x8a, 0x23, 0x33};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x46, 0x39, 0x7,  0xe0, 0x85, 0xc9, 0xfc, 0xff, 0x97, 0xfd,
                                     0xdc, 0x4,  0x0,  0x17, 0x33, 0x6d, 0x8c, 0x6f, 0x87, 0xd7,
                                     0x6c, 0x53, 0x69, 0x8c, 0x9b, 0xf0, 0x32, 0x1,  0xd3, 0x80};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 21743, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 11426 ["\138\251
// \SOH\190x\170(\EOT(\NUL\229\US\232\ETX\tH","\212\252_\137\222\158gd\rm\194;&w\RS\242\199\DLE\ETB\253\145\151","xD\194\160"]
// []
TEST(Unsubscribe311QCTest, Encode16) {
  uint8_t pkt[] = {0xa2, 0x33, 0x2c, 0xa2, 0x0,  0x11, 0x8a, 0xfb, 0x20, 0x1,  0xbe, 0x78, 0xaa, 0x28,
                   0x4,  0x28, 0x0,  0xe5, 0x1f, 0xe8, 0x3,  0x9,  0x48, 0x0,  0x16, 0xd4, 0xfc, 0x5f,
                   0x89, 0xde, 0x9e, 0x67, 0x64, 0xd,  0x6d, 0xc2, 0x3b, 0x26, 0x77, 0x1e, 0xf2, 0xc7,
                   0x10, 0x17, 0xfd, 0x91, 0x97, 0x0,  0x4,  0x78, 0x44, 0xc2, 0xa0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x8a, 0xfb, 0x20, 0x1,  0xbe, 0x78, 0xaa, 0x28, 0x4,
                                     0x28, 0x0,  0xe5, 0x1f, 0xe8, 0x3,  0x9,  0x48};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd4, 0xfc, 0x5f, 0x89, 0xde, 0x9e, 0x67, 0x64, 0xd,  0x6d, 0xc2,
                                     0x3b, 0x26, 0x77, 0x1e, 0xf2, 0xc7, 0x10, 0x17, 0xfd, 0x91, 0x97};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x78, 0x44, 0xc2, 0xa0};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 11426, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5841 ["yh\251\169","\178\SI\146G\210\133v\153\f\143T\188\187c\SI\227\n\n\NAK*fTRl\205M\224c!","
// \161\vU\242\SYN:\224","\182o_\213\131\253HkX>\245{\190qc\163\162EH\NUL\a\ENQh","`\198\220\GSG6\209Q\236\251;","\139Hp\135\199d\160+"]
// []
TEST(Unsubscribe311QCTest, Encode17) {
  uint8_t pkt[] = {0xa2, 0x61, 0x16, 0xd1, 0x0,  0x4,  0x79, 0x68, 0xfb, 0xa9, 0x0,  0x1d, 0xb2, 0xf,  0x92, 0x47, 0xd2,
                   0x85, 0x76, 0x99, 0xc,  0x8f, 0x54, 0xbc, 0xbb, 0x63, 0xf,  0xe3, 0xa,  0xa,  0x15, 0x2a, 0x66, 0x54,
                   0x52, 0x6c, 0xcd, 0x4d, 0xe0, 0x63, 0x21, 0x0,  0x8,  0x20, 0xa1, 0xb,  0x55, 0xf2, 0x16, 0x3a, 0xe0,
                   0x0,  0x17, 0xb6, 0x6f, 0x5f, 0xd5, 0x83, 0xfd, 0x48, 0x6b, 0x58, 0x3e, 0xf5, 0x7b, 0xbe, 0x71, 0x63,
                   0xa3, 0xa2, 0x45, 0x48, 0x0,  0x7,  0x5,  0x68, 0x0,  0xb,  0x60, 0xc6, 0xdc, 0x1d, 0x47, 0x36, 0xd1,
                   0x51, 0xec, 0xfb, 0x3b, 0x0,  0x8,  0x8b, 0x48, 0x70, 0x87, 0xc7, 0x64, 0xa0, 0x2b};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x79, 0x68, 0xfb, 0xa9};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb2, 0xf,  0x92, 0x47, 0xd2, 0x85, 0x76, 0x99, 0xc,  0x8f,
                                     0x54, 0xbc, 0xbb, 0x63, 0xf,  0xe3, 0xa,  0xa,  0x15, 0x2a,
                                     0x66, 0x54, 0x52, 0x6c, 0xcd, 0x4d, 0xe0, 0x63, 0x21};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x20, 0xa1, 0xb, 0x55, 0xf2, 0x16, 0x3a, 0xe0};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0x6f, 0x5f, 0xd5, 0x83, 0xfd, 0x48, 0x6b, 0x58, 0x3e, 0xf5, 0x7b,
                                     0xbe, 0x71, 0x63, 0xa3, 0xa2, 0x45, 0x48, 0x0,  0x7,  0x5,  0x68};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x60, 0xc6, 0xdc, 0x1d, 0x47, 0x36, 0xd1, 0x51, 0xec, 0xfb, 0x3b};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8b, 0x48, 0x70, 0x87, 0xc7, 0x64, 0xa0, 0x2b};
  lwmqtt_string_t topic_filter_s5 = {8, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5841, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26803
// ["h\b\248\219\SI\197\167\148#\226\147\153}","f\166\188I8\138","o\166\FS\210\138\156\166\234\SUB:%\155N\154\226\132\233E"]
// []
TEST(Unsubscribe311QCTest, Encode18) {
  uint8_t pkt[] = {0xa2, 0x2d, 0x68, 0xb3, 0x0,  0xd,  0x68, 0x8,  0xf8, 0xdb, 0xf,  0xc5, 0xa7, 0x94, 0x23, 0xe2,
                   0x93, 0x99, 0x7d, 0x0,  0x6,  0x66, 0xa6, 0xbc, 0x49, 0x38, 0x8a, 0x0,  0x12, 0x6f, 0xa6, 0x1c,
                   0xd2, 0x8a, 0x9c, 0xa6, 0xea, 0x1a, 0x3a, 0x25, 0x9b, 0x4e, 0x9a, 0xe2, 0x84, 0xe9, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x68, 0x8, 0xf8, 0xdb, 0xf, 0xc5, 0xa7, 0x94, 0x23, 0xe2, 0x93, 0x99, 0x7d};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x66, 0xa6, 0xbc, 0x49, 0x38, 0x8a};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6f, 0xa6, 0x1c, 0xd2, 0x8a, 0x9c, 0xa6, 0xea, 0x1a,
                                     0x3a, 0x25, 0x9b, 0x4e, 0x9a, 0xe2, 0x84, 0xe9, 0x45};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 26803, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22595 ["","r3\FS\a(<\131w\CAN\204\229"] []
TEST(Unsubscribe311QCTest, Encode19) {
  uint8_t pkt[] = {0xa2, 0x11, 0x58, 0x43, 0x0,  0x0,  0x0,  0xb,  0x72, 0x33,
                   0x1c, 0x7,  0x28, 0x3c, 0x83, 0x77, 0x18, 0xcc, 0xe5};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x72, 0x33, 0x1c, 0x7, 0x28, 0x3c, 0x83, 0x77, 0x18, 0xcc, 0xe5};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22595, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 907
// ["\141\FS\ETX\162\204'\133\DLE7\237\140\\w>\252:\aS\161s\SI\179:\248\150E","*,\176\143\254R\241\242\DLE\173a.\225\151\159I:\161","\\X$\251\237\251W\215P\a\133A\163\145\225D\SYN^\163\bf\237\174\STX\141\230\189w\161\162","\217\182-\169\169\173\191Hx@\206Qi\188\231\210D\165\NUL\165\ENQ\220\232\224\226>"]
// []
TEST(Unsubscribe311QCTest, Encode20) {
  uint8_t pkt[] = {0xa2, 0x6e, 0x3,  0x8b, 0x0,  0x1a, 0x8d, 0x1c, 0x3,  0xa2, 0xcc, 0x27, 0x85, 0x10, 0x37, 0xed,
                   0x8c, 0x5c, 0x77, 0x3e, 0xfc, 0x3a, 0x7,  0x53, 0xa1, 0x73, 0xf,  0xb3, 0x3a, 0xf8, 0x96, 0x45,
                   0x0,  0x12, 0x2a, 0x2c, 0xb0, 0x8f, 0xfe, 0x52, 0xf1, 0xf2, 0x10, 0xad, 0x61, 0x2e, 0xe1, 0x97,
                   0x9f, 0x49, 0x3a, 0xa1, 0x0,  0x1e, 0x5c, 0x58, 0x24, 0xfb, 0xed, 0xfb, 0x57, 0xd7, 0x50, 0x7,
                   0x85, 0x41, 0xa3, 0x91, 0xe1, 0x44, 0x16, 0x5e, 0xa3, 0x8,  0x66, 0xed, 0xae, 0x2,  0x8d, 0xe6,
                   0xbd, 0x77, 0xa1, 0xa2, 0x0,  0x1a, 0xd9, 0xb6, 0x2d, 0xa9, 0xa9, 0xad, 0xbf, 0x48, 0x78, 0x40,
                   0xce, 0x51, 0x69, 0xbc, 0xe7, 0xd2, 0x44, 0xa5, 0x0,  0xa5, 0x5,  0xdc, 0xe8, 0xe0, 0xe2, 0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x8d, 0x1c, 0x3,  0xa2, 0xcc, 0x27, 0x85, 0x10, 0x37, 0xed, 0x8c, 0x5c, 0x77,
                                     0x3e, 0xfc, 0x3a, 0x7,  0x53, 0xa1, 0x73, 0xf,  0xb3, 0x3a, 0xf8, 0x96, 0x45};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2a, 0x2c, 0xb0, 0x8f, 0xfe, 0x52, 0xf1, 0xf2, 0x10,
                                     0xad, 0x61, 0x2e, 0xe1, 0x97, 0x9f, 0x49, 0x3a, 0xa1};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5c, 0x58, 0x24, 0xfb, 0xed, 0xfb, 0x57, 0xd7, 0x50, 0x7,
                                     0x85, 0x41, 0xa3, 0x91, 0xe1, 0x44, 0x16, 0x5e, 0xa3, 0x8,
                                     0x66, 0xed, 0xae, 0x2,  0x8d, 0xe6, 0xbd, 0x77, 0xa1, 0xa2};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd9, 0xb6, 0x2d, 0xa9, 0xa9, 0xad, 0xbf, 0x48, 0x78, 0x40, 0xce, 0x51, 0x69,
                                     0xbc, 0xe7, 0xd2, 0x44, 0xa5, 0x0,  0xa5, 0x5,  0xdc, 0xe8, 0xe0, 0xe2, 0x3e};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 907, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24572
// ["\209r2\129\173f\255\143\237!\188m\134\&4#\167\156\211[@D\181\SO\161\210\n\235\&4","\133\164\149\&5\205\251\223","Bf.\183r\147H\252","/\130V\141\130\200\131\248\b\162Eb\DC2\EM\202r\182\251\FSKJ\186"]
// []
TEST(Unsubscribe311QCTest, Encode21) {
  uint8_t pkt[] = {0xa2, 0x4b, 0x5f, 0xfc, 0x0,  0x1c, 0xd1, 0x72, 0x32, 0x81, 0xad, 0x66, 0xff, 0x8f, 0xed, 0x21,
                   0xbc, 0x6d, 0x86, 0x34, 0x23, 0xa7, 0x9c, 0xd3, 0x5b, 0x40, 0x44, 0xb5, 0xe,  0xa1, 0xd2, 0xa,
                   0xeb, 0x34, 0x0,  0x7,  0x85, 0xa4, 0x95, 0x35, 0xcd, 0xfb, 0xdf, 0x0,  0x8,  0x42, 0x66, 0x2e,
                   0xb7, 0x72, 0x93, 0x48, 0xfc, 0x0,  0x16, 0x2f, 0x82, 0x56, 0x8d, 0x82, 0xc8, 0x83, 0xf8, 0x8,
                   0xa2, 0x45, 0x62, 0x12, 0x19, 0xca, 0x72, 0xb6, 0xfb, 0x1c, 0x4b, 0x4a, 0xba};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xd1, 0x72, 0x32, 0x81, 0xad, 0x66, 0xff, 0x8f, 0xed, 0x21,
                                     0xbc, 0x6d, 0x86, 0x34, 0x23, 0xa7, 0x9c, 0xd3, 0x5b, 0x40,
                                     0x44, 0xb5, 0xe,  0xa1, 0xd2, 0xa,  0xeb, 0x34};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x85, 0xa4, 0x95, 0x35, 0xcd, 0xfb, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x42, 0x66, 0x2e, 0xb7, 0x72, 0x93, 0x48, 0xfc};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2f, 0x82, 0x56, 0x8d, 0x82, 0xc8, 0x83, 0xf8, 0x8,  0xa2, 0x45,
                                     0x62, 0x12, 0x19, 0xca, 0x72, 0xb6, 0xfb, 0x1c, 0x4b, 0x4a, 0xba};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 24572, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22215
// ["tkb\217BA\193-\r\243\141\144\131?#\SO\181p\150,\n\DEL)!","`\148\&8\EOT\EM\209\DLEI\193\218\148\180?\184X`,","\177V]\a8>\139\248\US\158\&4Pz\232|\147S\229\149\145\150\170\185\240'","\242M!M\182ds\247I\DEL\233\&0X),\206\155\200\232\182","s\SOH\149\210\176E\148\180\164\142\v\225gk\198\168\139/\161\240\249T\155)\140*","\165\EM\192\148-\241\213\188\182w\155\ESC*\NUL\RS*)\177h","\244\148-\DC3A\174,d\225\215d\170x"]
// []
TEST(Unsubscribe311QCTest, Encode22) {
  uint8_t pkt[] = {0xa2, 0xa0, 0x1,  0x56, 0xc7, 0x0,  0x18, 0x74, 0x6b, 0x62, 0xd9, 0x42, 0x41, 0xc1, 0x2d, 0xd,  0xf3,
                   0x8d, 0x90, 0x83, 0x3f, 0x23, 0xe,  0xb5, 0x70, 0x96, 0x2c, 0xa,  0x7f, 0x29, 0x21, 0x0,  0x11, 0x60,
                   0x94, 0x38, 0x4,  0x19, 0xd1, 0x10, 0x49, 0xc1, 0xda, 0x94, 0xb4, 0x3f, 0xb8, 0x58, 0x60, 0x2c, 0x0,
                   0x19, 0xb1, 0x56, 0x5d, 0x7,  0x38, 0x3e, 0x8b, 0xf8, 0x1f, 0x9e, 0x34, 0x50, 0x7a, 0xe8, 0x7c, 0x93,
                   0x53, 0xe5, 0x95, 0x91, 0x96, 0xaa, 0xb9, 0xf0, 0x27, 0x0,  0x14, 0xf2, 0x4d, 0x21, 0x4d, 0xb6, 0x64,
                   0x73, 0xf7, 0x49, 0x7f, 0xe9, 0x30, 0x58, 0x29, 0x2c, 0xce, 0x9b, 0xc8, 0xe8, 0xb6, 0x0,  0x1a, 0x73,
                   0x1,  0x95, 0xd2, 0xb0, 0x45, 0x94, 0xb4, 0xa4, 0x8e, 0xb,  0xe1, 0x67, 0x6b, 0xc6, 0xa8, 0x8b, 0x2f,
                   0xa1, 0xf0, 0xf9, 0x54, 0x9b, 0x29, 0x8c, 0x2a, 0x0,  0x13, 0xa5, 0x19, 0xc0, 0x94, 0x2d, 0xf1, 0xd5,
                   0xbc, 0xb6, 0x77, 0x9b, 0x1b, 0x2a, 0x0,  0x1e, 0x2a, 0x29, 0xb1, 0x68, 0x0,  0xd,  0xf4, 0x94, 0x2d,
                   0x13, 0x41, 0xae, 0x2c, 0x64, 0xe1, 0xd7, 0x64, 0xaa, 0x78};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x74, 0x6b, 0x62, 0xd9, 0x42, 0x41, 0xc1, 0x2d, 0xd, 0xf3, 0x8d, 0x90,
                                     0x83, 0x3f, 0x23, 0xe,  0xb5, 0x70, 0x96, 0x2c, 0xa, 0x7f, 0x29, 0x21};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x60, 0x94, 0x38, 0x4,  0x19, 0xd1, 0x10, 0x49, 0xc1,
                                     0xda, 0x94, 0xb4, 0x3f, 0xb8, 0x58, 0x60, 0x2c};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb1, 0x56, 0x5d, 0x7,  0x38, 0x3e, 0x8b, 0xf8, 0x1f, 0x9e, 0x34, 0x50, 0x7a,
                                     0xe8, 0x7c, 0x93, 0x53, 0xe5, 0x95, 0x91, 0x96, 0xaa, 0xb9, 0xf0, 0x27};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf2, 0x4d, 0x21, 0x4d, 0xb6, 0x64, 0x73, 0xf7, 0x49, 0x7f,
                                     0xe9, 0x30, 0x58, 0x29, 0x2c, 0xce, 0x9b, 0xc8, 0xe8, 0xb6};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x73, 0x1,  0x95, 0xd2, 0xb0, 0x45, 0x94, 0xb4, 0xa4, 0x8e, 0xb,  0xe1, 0x67,
                                     0x6b, 0xc6, 0xa8, 0x8b, 0x2f, 0xa1, 0xf0, 0xf9, 0x54, 0x9b, 0x29, 0x8c, 0x2a};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa5, 0x19, 0xc0, 0x94, 0x2d, 0xf1, 0xd5, 0xbc, 0xb6, 0x77,
                                     0x9b, 0x1b, 0x2a, 0x0,  0x1e, 0x2a, 0x29, 0xb1, 0x68};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf4, 0x94, 0x2d, 0x13, 0x41, 0xae, 0x2c, 0x64, 0xe1, 0xd7, 0x64, 0xaa, 0x78};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22215, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 6585
// ["\230\183q\150\255f\RS\133,\EM\151s\DC4","\160\239\214T\CANS\255\134\169\182\167ri\233\201","B\149Ms7\DC2\234x\185t\233\239\247\EOT\150\\\225\NUL\DC4\SO$\tP\190\DC3","\231\130\&50\142?\232\228\STX\183\182\159h\211\140\218N\ESC\ENQL\161=\158\251\166","\218\230\&2\130\163\DLE","\130q\162\EOT:\240\"\206`\134|\162","l\185N\132\177\203*","SB\DC1\\\186\191\167iq\187\204\a\NAK\137\214u\155\n"]
// []
TEST(Unsubscribe311QCTest, Encode23) {
  uint8_t pkt[] = {0xa2, 0x8b, 0x1,  0x19, 0xb9, 0x0,  0xd,  0xe6, 0xb7, 0x71, 0x96, 0xff, 0x66, 0x1e, 0x85, 0x2c,
                   0x19, 0x97, 0x73, 0x14, 0x0,  0xf,  0xa0, 0xef, 0xd6, 0x54, 0x18, 0x53, 0xff, 0x86, 0xa9, 0xb6,
                   0xa7, 0x72, 0x69, 0xe9, 0xc9, 0x0,  0x19, 0x42, 0x95, 0x4d, 0x73, 0x37, 0x12, 0xea, 0x78, 0xb9,
                   0x74, 0xe9, 0xef, 0xf7, 0x4,  0x96, 0x5c, 0xe1, 0x0,  0x14, 0xe,  0x24, 0x9,  0x50, 0xbe, 0x13,
                   0x0,  0x19, 0xe7, 0x82, 0x35, 0x30, 0x8e, 0x3f, 0xe8, 0xe4, 0x2,  0xb7, 0xb6, 0x9f, 0x68, 0xd3,
                   0x8c, 0xda, 0x4e, 0x1b, 0x5,  0x4c, 0xa1, 0x3d, 0x9e, 0xfb, 0xa6, 0x0,  0x6,  0xda, 0xe6, 0x32,
                   0x82, 0xa3, 0x10, 0x0,  0xc,  0x82, 0x71, 0xa2, 0x4,  0x3a, 0xf0, 0x22, 0xce, 0x60, 0x86, 0x7c,
                   0xa2, 0x0,  0x7,  0x6c, 0xb9, 0x4e, 0x84, 0xb1, 0xcb, 0x2a, 0x0,  0x12, 0x53, 0x42, 0x11, 0x5c,
                   0xba, 0xbf, 0xa7, 0x69, 0x71, 0xbb, 0xcc, 0x7,  0x15, 0x89, 0xd6, 0x75, 0x9b, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xe6, 0xb7, 0x71, 0x96, 0xff, 0x66, 0x1e, 0x85, 0x2c, 0x19, 0x97, 0x73, 0x14};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa0, 0xef, 0xd6, 0x54, 0x18, 0x53, 0xff, 0x86,
                                     0xa9, 0xb6, 0xa7, 0x72, 0x69, 0xe9, 0xc9};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x42, 0x95, 0x4d, 0x73, 0x37, 0x12, 0xea, 0x78, 0xb9, 0x74, 0xe9, 0xef, 0xf7,
                                     0x4,  0x96, 0x5c, 0xe1, 0x0,  0x14, 0xe,  0x24, 0x9,  0x50, 0xbe, 0x13};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe7, 0x82, 0x35, 0x30, 0x8e, 0x3f, 0xe8, 0xe4, 0x2,  0xb7, 0xb6, 0x9f, 0x68,
                                     0xd3, 0x8c, 0xda, 0x4e, 0x1b, 0x5,  0x4c, 0xa1, 0x3d, 0x9e, 0xfb, 0xa6};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xda, 0xe6, 0x32, 0x82, 0xa3, 0x10};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x82, 0x71, 0xa2, 0x4, 0x3a, 0xf0, 0x22, 0xce, 0x60, 0x86, 0x7c, 0xa2};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6c, 0xb9, 0x4e, 0x84, 0xb1, 0xcb, 0x2a};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x53, 0x42, 0x11, 0x5c, 0xba, 0xbf, 0xa7, 0x69, 0x71,
                                     0xbb, 0xcc, 0x7,  0x15, 0x89, 0xd6, 0x75, 0x9b, 0xa};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 6585, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22838
// ["@w%\186\210\164\154\ACKl\193]J?uN\fM\186","\206\247\DEL\254\199\EM\205\216\151KC\ETX\219\180etQ\135\188\195\197_\249\b","m\CAN\222\175|\164\198\ETBF","\186\147\228\156\151$\239K@\USJ\248\193`z\220\222\224M[\182","\154\n$qM4\nL\ETXb\ETX\241","K\154?\178\227p\162\200R\194\196","+\245t\230#}Ja\SOH\214x\220)\ESC\138\t\134\215J\222\131$dD\222","\169\191\191\193[\224tV&\218rG\196\SYNQ\224n\157\&7\215\165\207\153+\a\234\235","(\185\142\190\225\&7\FSf\147Obz\203\136||\198\&5\DC1\239\161\202","_>\198mEZ\153\&1\149\250r\146zt\ESC\239g\176\148\197\210\NUL\231-\212\138"]
// []
TEST(Unsubscribe311QCTest, Encode24) {
  uint8_t pkt[] = {0xa2, 0xd9, 0x1,  0x59, 0x36, 0x0,  0x12, 0x40, 0x77, 0x25, 0xba, 0xd2, 0xa4, 0x9a, 0x6,  0x6c, 0xc1,
                   0x5d, 0x4a, 0x3f, 0x75, 0x4e, 0xc,  0x4d, 0xba, 0x0,  0x18, 0xce, 0xf7, 0x7f, 0xfe, 0xc7, 0x19, 0xcd,
                   0xd8, 0x97, 0x4b, 0x43, 0x3,  0xdb, 0xb4, 0x65, 0x74, 0x51, 0x87, 0xbc, 0xc3, 0xc5, 0x5f, 0xf9, 0x8,
                   0x0,  0x9,  0x6d, 0x18, 0xde, 0xaf, 0x7c, 0xa4, 0xc6, 0x17, 0x46, 0x0,  0x15, 0xba, 0x93, 0xe4, 0x9c,
                   0x97, 0x24, 0xef, 0x4b, 0x40, 0x1f, 0x4a, 0xf8, 0xc1, 0x60, 0x7a, 0xdc, 0xde, 0xe0, 0x4d, 0x5b, 0xb6,
                   0x0,  0xc,  0x9a, 0xa,  0x24, 0x71, 0x4d, 0x34, 0xa,  0x4c, 0x3,  0x62, 0x3,  0xf1, 0x0,  0xb,  0x4b,
                   0x9a, 0x3f, 0xb2, 0xe3, 0x70, 0xa2, 0xc8, 0x52, 0xc2, 0xc4, 0x0,  0x19, 0x2b, 0xf5, 0x74, 0xe6, 0x23,
                   0x7d, 0x4a, 0x61, 0x1,  0xd6, 0x78, 0xdc, 0x29, 0x1b, 0x8a, 0x9,  0x86, 0xd7, 0x4a, 0xde, 0x83, 0x24,
                   0x64, 0x44, 0xde, 0x0,  0x1b, 0xa9, 0xbf, 0xbf, 0xc1, 0x5b, 0xe0, 0x74, 0x56, 0x26, 0xda, 0x72, 0x47,
                   0xc4, 0x16, 0x51, 0xe0, 0x6e, 0x9d, 0x37, 0xd7, 0xa5, 0xcf, 0x99, 0x2b, 0x7,  0xea, 0xeb, 0x0,  0x16,
                   0x28, 0xb9, 0x8e, 0xbe, 0xe1, 0x37, 0x1c, 0x66, 0x93, 0x4f, 0x62, 0x7a, 0xcb, 0x88, 0x7c, 0x7c, 0xc6,
                   0x35, 0x11, 0xef, 0xa1, 0xca, 0x0,  0x1a, 0x5f, 0x3e, 0xc6, 0x6d, 0x45, 0x5a, 0x99, 0x31, 0x95, 0xfa,
                   0x72, 0x92, 0x7a, 0x74, 0x1b, 0xef, 0x67, 0xb0, 0x94, 0xc5, 0xd2, 0x0,  0xe7, 0x2d, 0xd4, 0x8a};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x40, 0x77, 0x25, 0xba, 0xd2, 0xa4, 0x9a, 0x6,  0x6c,
                                     0xc1, 0x5d, 0x4a, 0x3f, 0x75, 0x4e, 0xc,  0x4d, 0xba};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xce, 0xf7, 0x7f, 0xfe, 0xc7, 0x19, 0xcd, 0xd8, 0x97, 0x4b, 0x43, 0x3,
                                     0xdb, 0xb4, 0x65, 0x74, 0x51, 0x87, 0xbc, 0xc3, 0xc5, 0x5f, 0xf9, 0x8};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6d, 0x18, 0xde, 0xaf, 0x7c, 0xa4, 0xc6, 0x17, 0x46};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xba, 0x93, 0xe4, 0x9c, 0x97, 0x24, 0xef, 0x4b, 0x40, 0x1f, 0x4a,
                                     0xf8, 0xc1, 0x60, 0x7a, 0xdc, 0xde, 0xe0, 0x4d, 0x5b, 0xb6};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9a, 0xa, 0x24, 0x71, 0x4d, 0x34, 0xa, 0x4c, 0x3, 0x62, 0x3, 0xf1};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4b, 0x9a, 0x3f, 0xb2, 0xe3, 0x70, 0xa2, 0xc8, 0x52, 0xc2, 0xc4};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2b, 0xf5, 0x74, 0xe6, 0x23, 0x7d, 0x4a, 0x61, 0x1,  0xd6, 0x78, 0xdc, 0x29,
                                     0x1b, 0x8a, 0x9,  0x86, 0xd7, 0x4a, 0xde, 0x83, 0x24, 0x64, 0x44, 0xde};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa9, 0xbf, 0xbf, 0xc1, 0x5b, 0xe0, 0x74, 0x56, 0x26, 0xda, 0x72, 0x47, 0xc4, 0x16,
                                     0x51, 0xe0, 0x6e, 0x9d, 0x37, 0xd7, 0xa5, 0xcf, 0x99, 0x2b, 0x7,  0xea, 0xeb};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x28, 0xb9, 0x8e, 0xbe, 0xe1, 0x37, 0x1c, 0x66, 0x93, 0x4f, 0x62,
                                     0x7a, 0xcb, 0x88, 0x7c, 0x7c, 0xc6, 0x35, 0x11, 0xef, 0xa1, 0xca};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5f, 0x3e, 0xc6, 0x6d, 0x45, 0x5a, 0x99, 0x31, 0x95, 0xfa, 0x72, 0x92, 0x7a,
                                     0x74, 0x1b, 0xef, 0x67, 0xb0, 0x94, 0xc5, 0xd2, 0x0,  0xe7, 0x2d, 0xd4, 0x8a};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22838, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 14034 ["1\217\143\SOH~W~\ETX
// \191\NUL\173|\218L\CAN\229\ESC\249\241\169\130","T\140qo","\128k\172\167\180\235\144\222\r\129\254?,\152\187+\228\178F\194\225","\244\CAN\230/\246X\247\&1,\208\222\235(\219%\246\172\225\254\191\189|\218'\253","\ENQ\133\178\EOT\241\135\222\201\220\164\&3\179\157\222T\189\253","\ETB\DC4\159\210\ETB0\218\213;\180\EM\227\244Lr\245\EOTn\NULh","\173.N\n~\219o\214\205\167\190\139\196\185\246\174\&3\STX\215\235\135a","\172g\bAu\187r\au-\DC4!!Vw
// |x","\211\&6\175\180c\153\187s\NUL\v\140Em\215\144\244\&3|\246\ESC&\239tD\243\239","]\US\226A\165\\|\206U6\249d\144\241On-\153"]
// []
TEST(Unsubscribe311QCTest, Encode25) {
  uint8_t pkt[] = {0xa2, 0xd7, 0x1,  0x36, 0xd2, 0x0,  0x16, 0x31, 0xd9, 0x8f, 0x1,  0x7e, 0x57, 0x7e, 0x3,  0x20, 0xbf,
                   0x0,  0xad, 0x7c, 0xda, 0x4c, 0x18, 0xe5, 0x1b, 0xf9, 0xf1, 0xa9, 0x82, 0x0,  0x4,  0x54, 0x8c, 0x71,
                   0x6f, 0x0,  0x15, 0x80, 0x6b, 0xac, 0xa7, 0xb4, 0xeb, 0x90, 0xde, 0xd,  0x81, 0xfe, 0x3f, 0x2c, 0x98,
                   0xbb, 0x2b, 0xe4, 0xb2, 0x46, 0xc2, 0xe1, 0x0,  0x19, 0xf4, 0x18, 0xe6, 0x2f, 0xf6, 0x58, 0xf7, 0x31,
                   0x2c, 0xd0, 0xde, 0xeb, 0x28, 0xdb, 0x25, 0xf6, 0xac, 0xe1, 0xfe, 0xbf, 0xbd, 0x7c, 0xda, 0x27, 0xfd,
                   0x0,  0x11, 0x5,  0x85, 0xb2, 0x4,  0xf1, 0x87, 0xde, 0xc9, 0xdc, 0xa4, 0x33, 0xb3, 0x9d, 0xde, 0x54,
                   0xbd, 0xfd, 0x0,  0x14, 0x17, 0x14, 0x9f, 0xd2, 0x17, 0x30, 0xda, 0xd5, 0x3b, 0xb4, 0x19, 0xe3, 0xf4,
                   0x4c, 0x72, 0xf5, 0x4,  0x6e, 0x0,  0x68, 0x0,  0x16, 0xad, 0x2e, 0x4e, 0xa,  0x7e, 0xdb, 0x6f, 0xd6,
                   0xcd, 0xa7, 0xbe, 0x8b, 0xc4, 0xb9, 0xf6, 0xae, 0x33, 0x2,  0xd7, 0xeb, 0x87, 0x61, 0x0,  0x12, 0xac,
                   0x67, 0x8,  0x41, 0x75, 0xbb, 0x72, 0x7,  0x75, 0x2d, 0x14, 0x21, 0x21, 0x56, 0x77, 0x20, 0x7c, 0x78,
                   0x0,  0x1a, 0xd3, 0x36, 0xaf, 0xb4, 0x63, 0x99, 0xbb, 0x73, 0x0,  0xb,  0x8c, 0x45, 0x6d, 0xd7, 0x90,
                   0xf4, 0x33, 0x7c, 0xf6, 0x1b, 0x26, 0xef, 0x74, 0x44, 0xf3, 0xef, 0x0,  0x12, 0x5d, 0x1f, 0xe2, 0x41,
                   0xa5, 0x5c, 0x7c, 0xce, 0x55, 0x36, 0xf9, 0x64, 0x90, 0xf1, 0x4f, 0x6e, 0x2d, 0x99};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x31, 0xd9, 0x8f, 0x1,  0x7e, 0x57, 0x7e, 0x3,  0x20, 0xbf, 0x0,
                                     0xad, 0x7c, 0xda, 0x4c, 0x18, 0xe5, 0x1b, 0xf9, 0xf1, 0xa9, 0x82};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x54, 0x8c, 0x71, 0x6f};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x80, 0x6b, 0xac, 0xa7, 0xb4, 0xeb, 0x90, 0xde, 0xd,  0x81, 0xfe,
                                     0x3f, 0x2c, 0x98, 0xbb, 0x2b, 0xe4, 0xb2, 0x46, 0xc2, 0xe1};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf4, 0x18, 0xe6, 0x2f, 0xf6, 0x58, 0xf7, 0x31, 0x2c, 0xd0, 0xde, 0xeb, 0x28,
                                     0xdb, 0x25, 0xf6, 0xac, 0xe1, 0xfe, 0xbf, 0xbd, 0x7c, 0xda, 0x27, 0xfd};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5,  0x85, 0xb2, 0x4,  0xf1, 0x87, 0xde, 0xc9, 0xdc,
                                     0xa4, 0x33, 0xb3, 0x9d, 0xde, 0x54, 0xbd, 0xfd};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x17, 0x14, 0x9f, 0xd2, 0x17, 0x30, 0xda, 0xd5, 0x3b, 0xb4,
                                     0x19, 0xe3, 0xf4, 0x4c, 0x72, 0xf5, 0x4,  0x6e, 0x0,  0x68};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xad, 0x2e, 0x4e, 0xa,  0x7e, 0xdb, 0x6f, 0xd6, 0xcd, 0xa7, 0xbe,
                                     0x8b, 0xc4, 0xb9, 0xf6, 0xae, 0x33, 0x2,  0xd7, 0xeb, 0x87, 0x61};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xac, 0x67, 0x8,  0x41, 0x75, 0xbb, 0x72, 0x7,  0x75,
                                     0x2d, 0x14, 0x21, 0x21, 0x56, 0x77, 0x20, 0x7c, 0x78};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd3, 0x36, 0xaf, 0xb4, 0x63, 0x99, 0xbb, 0x73, 0x0,  0xb,  0x8c, 0x45, 0x6d,
                                     0xd7, 0x90, 0xf4, 0x33, 0x7c, 0xf6, 0x1b, 0x26, 0xef, 0x74, 0x44, 0xf3, 0xef};
  lwmqtt_string_t topic_filter_s8 = {26, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5d, 0x1f, 0xe2, 0x41, 0xa5, 0x5c, 0x7c, 0xce, 0x55,
                                     0x36, 0xf9, 0x64, 0x90, 0xf1, 0x4f, 0x6e, 0x2d, 0x99};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 14034, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22538 ["O\215\150\139h\178\159\233Bf\234x\tp\206\198\147s\142\236\132\SYN\221f\DELN\NAK\228\133"]
// []
TEST(Unsubscribe311QCTest, Encode26) {
  uint8_t pkt[] = {0xa2, 0x21, 0x58, 0xa,  0x0,  0x1d, 0x4f, 0xd7, 0x96, 0x8b, 0x68, 0xb2,
                   0x9f, 0xe9, 0x42, 0x66, 0xea, 0x78, 0x9,  0x70, 0xce, 0xc6, 0x93, 0x73,
                   0x8e, 0xec, 0x84, 0x16, 0xdd, 0x66, 0x7f, 0x4e, 0x15, 0xe4, 0x85};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x4f, 0xd7, 0x96, 0x8b, 0x68, 0xb2, 0x9f, 0xe9, 0x42, 0x66,
                                     0xea, 0x78, 0x9,  0x70, 0xce, 0xc6, 0x93, 0x73, 0x8e, 0xec,
                                     0x84, 0x16, 0xdd, 0x66, 0x7f, 0x4e, 0x15, 0xe4, 0x85};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 22538, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 30444
// ["GX)\EOT\193\GS\201A\196\169\SYN\180","\192\194c\139X\215\204<\ba\143\240^\173\198\169V\USFt\229\141;\n\223\215t","\228&\240","","R\164}j.u4\218\129\170\245j\245\192)\196","i\183\181;\182\142C","0|?r?\191\EOT==o\244\243@\198\NAK\218\155\158\NUL\151\184z","v\202.j\238\248\163T\167\148\158dl\249T\228Iv"]
// []
TEST(Unsubscribe311QCTest, Encode27) {
  uint8_t pkt[] = {0xa2, 0x7b, 0x76, 0xec, 0x0,  0xc,  0x47, 0x58, 0x29, 0x4,  0xc1, 0x1d, 0xc9, 0x41, 0xc4, 0xa9,
                   0x16, 0xb4, 0x0,  0x1b, 0xc0, 0xc2, 0x63, 0x8b, 0x58, 0xd7, 0xcc, 0x3c, 0x8,  0x61, 0x8f, 0xf0,
                   0x5e, 0xad, 0xc6, 0xa9, 0x56, 0x1f, 0x46, 0x74, 0xe5, 0x8d, 0x3b, 0xa,  0xdf, 0xd7, 0x74, 0x0,
                   0x3,  0xe4, 0x26, 0xf0, 0x0,  0x0,  0x0,  0x10, 0x52, 0xa4, 0x7d, 0x6a, 0x2e, 0x75, 0x34, 0xda,
                   0x81, 0xaa, 0xf5, 0x6a, 0xf5, 0xc0, 0x29, 0xc4, 0x0,  0x7,  0x69, 0xb7, 0xb5, 0x3b, 0xb6, 0x8e,
                   0x43, 0x0,  0x16, 0x30, 0x7c, 0x3f, 0x72, 0x3f, 0xbf, 0x4,  0x3d, 0x3d, 0x6f, 0xf4, 0xf3, 0x40,
                   0xc6, 0x15, 0xda, 0x9b, 0x9e, 0x0,  0x97, 0xb8, 0x7a, 0x0,  0x12, 0x76, 0xca, 0x2e, 0x6a, 0xee,
                   0xf8, 0xa3, 0x54, 0xa7, 0x94, 0x9e, 0x64, 0x6c, 0xf9, 0x54, 0xe4, 0x49, 0x76};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0x58, 0x29, 0x4, 0xc1, 0x1d, 0xc9, 0x41, 0xc4, 0xa9, 0x16, 0xb4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc0, 0xc2, 0x63, 0x8b, 0x58, 0xd7, 0xcc, 0x3c, 0x8,  0x61, 0x8f, 0xf0, 0x5e, 0xad,
                                     0xc6, 0xa9, 0x56, 0x1f, 0x46, 0x74, 0xe5, 0x8d, 0x3b, 0xa,  0xdf, 0xd7, 0x74};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe4, 0x26, 0xf0};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x52, 0xa4, 0x7d, 0x6a, 0x2e, 0x75, 0x34, 0xda,
                                     0x81, 0xaa, 0xf5, 0x6a, 0xf5, 0xc0, 0x29, 0xc4};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x69, 0xb7, 0xb5, 0x3b, 0xb6, 0x8e, 0x43};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x30, 0x7c, 0x3f, 0x72, 0x3f, 0xbf, 0x4,  0x3d, 0x3d, 0x6f, 0xf4,
                                     0xf3, 0x40, 0xc6, 0x15, 0xda, 0x9b, 0x9e, 0x0,  0x97, 0xb8, 0x7a};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x76, 0xca, 0x2e, 0x6a, 0xee, 0xf8, 0xa3, 0x54, 0xa7,
                                     0x94, 0x9e, 0x64, 0x6c, 0xf9, 0x54, 0xe4, 0x49, 0x76};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 30444, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 10904
// ["\158\151(tQ&M3?\234\162qjZ\ENQ\146wd\180\249\&0","\148\148\181'\255Q\247\ETB\218\ESC\136\SYN\a\213\151t\229az1\208\253","z\245\157\159\151\241\225%\SOH^\129`\166\168\252\172\135}","|\SOq\189\SO","\ENQi\226\n}\143\149O\235\&1\SOHN\241\252\183GG\136\142"]
// []
TEST(Unsubscribe311QCTest, Encode28) {
  uint8_t pkt[] = {0xa2, 0x61, 0x2a, 0x98, 0x0,  0x15, 0x9e, 0x97, 0x28, 0x74, 0x51, 0x26, 0x4d, 0x33, 0x3f, 0xea, 0xa2,
                   0x71, 0x6a, 0x5a, 0x5,  0x92, 0x77, 0x64, 0xb4, 0xf9, 0x30, 0x0,  0x16, 0x94, 0x94, 0xb5, 0x27, 0xff,
                   0x51, 0xf7, 0x17, 0xda, 0x1b, 0x88, 0x16, 0x7,  0xd5, 0x97, 0x74, 0xe5, 0x61, 0x7a, 0x31, 0xd0, 0xfd,
                   0x0,  0x12, 0x7a, 0xf5, 0x9d, 0x9f, 0x97, 0xf1, 0xe1, 0x25, 0x1,  0x5e, 0x81, 0x60, 0xa6, 0xa8, 0xfc,
                   0xac, 0x87, 0x7d, 0x0,  0x5,  0x7c, 0xe,  0x71, 0xbd, 0xe,  0x0,  0x13, 0x5,  0x69, 0xe2, 0xa,  0x7d,
                   0x8f, 0x95, 0x4f, 0xeb, 0x31, 0x1,  0x4e, 0xf1, 0xfc, 0xb7, 0x47, 0x47, 0x88, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x9e, 0x97, 0x28, 0x74, 0x51, 0x26, 0x4d, 0x33, 0x3f, 0xea, 0xa2,
                                     0x71, 0x6a, 0x5a, 0x5,  0x92, 0x77, 0x64, 0xb4, 0xf9, 0x30};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x94, 0x94, 0xb5, 0x27, 0xff, 0x51, 0xf7, 0x17, 0xda, 0x1b, 0x88,
                                     0x16, 0x7,  0xd5, 0x97, 0x74, 0xe5, 0x61, 0x7a, 0x31, 0xd0, 0xfd};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7a, 0xf5, 0x9d, 0x9f, 0x97, 0xf1, 0xe1, 0x25, 0x1,
                                     0x5e, 0x81, 0x60, 0xa6, 0xa8, 0xfc, 0xac, 0x87, 0x7d};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x7c, 0xe, 0x71, 0xbd, 0xe};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5, 0x69, 0xe2, 0xa,  0x7d, 0x8f, 0x95, 0x4f, 0xeb, 0x31,
                                     0x1, 0x4e, 0xf1, 0xfc, 0xb7, 0x47, 0x47, 0x88, 0x8e};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 10904, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5483
// ["","\RSY|\167.\233=\245U,\193\250.\241\&8]Z\239\EOTi\DC2\193\235\212","\233\251\197\179\CAN\205\158\160\250\133\254\220\DC3\236\149k\249,w\223yf\239\240\193\&2\SO","1;\224awQA\b\129m\211-\177#y\130L;%\227\202'","\129\143;\208\166\210!h@\133","\212\213jo\156\238\193\DC2\188o\254\NUL\219\202","(\182Q\ENQ\158\220\233\233\228\196\226\218\163"]
// []
TEST(Unsubscribe311QCTest, Encode29) {
  uint8_t pkt[] = {0xa2, 0x7e, 0x15, 0x6b, 0x0,  0x0,  0x0,  0x18, 0x1e, 0x59, 0x7c, 0xa7, 0x2e, 0xe9, 0x3d, 0xf5,
                   0x55, 0x2c, 0xc1, 0xfa, 0x2e, 0xf1, 0x38, 0x5d, 0x5a, 0xef, 0x4,  0x69, 0x12, 0xc1, 0xeb, 0xd4,
                   0x0,  0x1b, 0xe9, 0xfb, 0xc5, 0xb3, 0x18, 0xcd, 0x9e, 0xa0, 0xfa, 0x85, 0xfe, 0xdc, 0x13, 0xec,
                   0x95, 0x6b, 0xf9, 0x2c, 0x77, 0xdf, 0x79, 0x66, 0xef, 0xf0, 0xc1, 0x32, 0xe,  0x0,  0x16, 0x31,
                   0x3b, 0xe0, 0x61, 0x77, 0x51, 0x41, 0x8,  0x81, 0x6d, 0xd3, 0x2d, 0xb1, 0x23, 0x79, 0x82, 0x4c,
                   0x3b, 0x25, 0xe3, 0xca, 0x27, 0x0,  0xa,  0x81, 0x8f, 0x3b, 0xd0, 0xa6, 0xd2, 0x21, 0x68, 0x40,
                   0x85, 0x0,  0xe,  0xd4, 0xd5, 0x6a, 0x6f, 0x9c, 0xee, 0xc1, 0x12, 0xbc, 0x6f, 0xfe, 0x0,  0xdb,
                   0xca, 0x0,  0xd,  0x28, 0xb6, 0x51, 0x5,  0x9e, 0xdc, 0xe9, 0xe9, 0xe4, 0xc4, 0xe2, 0xda, 0xa3};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0x59, 0x7c, 0xa7, 0x2e, 0xe9, 0x3d, 0xf5, 0x55, 0x2c, 0xc1, 0xfa,
                                     0x2e, 0xf1, 0x38, 0x5d, 0x5a, 0xef, 0x4,  0x69, 0x12, 0xc1, 0xeb, 0xd4};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe9, 0xfb, 0xc5, 0xb3, 0x18, 0xcd, 0x9e, 0xa0, 0xfa, 0x85, 0xfe, 0xdc, 0x13, 0xec,
                                     0x95, 0x6b, 0xf9, 0x2c, 0x77, 0xdf, 0x79, 0x66, 0xef, 0xf0, 0xc1, 0x32, 0xe};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x31, 0x3b, 0xe0, 0x61, 0x77, 0x51, 0x41, 0x8,  0x81, 0x6d, 0xd3,
                                     0x2d, 0xb1, 0x23, 0x79, 0x82, 0x4c, 0x3b, 0x25, 0xe3, 0xca, 0x27};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x81, 0x8f, 0x3b, 0xd0, 0xa6, 0xd2, 0x21, 0x68, 0x40, 0x85};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd4, 0xd5, 0x6a, 0x6f, 0x9c, 0xee, 0xc1, 0x12, 0xbc, 0x6f, 0xfe, 0x0, 0xdb, 0xca};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x28, 0xb6, 0x51, 0x5, 0x9e, 0xdc, 0xe9, 0xe9, 0xe4, 0xc4, 0xe2, 0xda, 0xa3};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 5483, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27410
// ["\142,\253\251\228\164\&6>\237\ETX\150\202\228\225\236\SUB\130}\144\142\196:\EOT","7$&\216\162\FSEn\RSsy\244]","\200\209D","\154,\164<","\211c\153","\DLE\221\175\212*","Pk)\217\129'\201\236\161\181o\176D\191L\241\158\153\EOT\228","#\231\205E\220\217&S\242","\211\145\204"]
// []
TEST(Unsubscribe311QCTest, Encode30) {
  uint8_t pkt[] = {0xa2, 0x67, 0x6b, 0x12, 0x0,  0x17, 0x8e, 0x2c, 0xfd, 0xfb, 0xe4, 0xa4, 0x36, 0x3e, 0xed,
                   0x3,  0x96, 0xca, 0xe4, 0xe1, 0xec, 0x1a, 0x82, 0x7d, 0x90, 0x8e, 0xc4, 0x3a, 0x4,  0x0,
                   0xd,  0x37, 0x24, 0x26, 0xd8, 0xa2, 0x1c, 0x45, 0x6e, 0x1e, 0x73, 0x79, 0xf4, 0x5d, 0x0,
                   0x3,  0xc8, 0xd1, 0x44, 0x0,  0x4,  0x9a, 0x2c, 0xa4, 0x3c, 0x0,  0x3,  0xd3, 0x63, 0x99,
                   0x0,  0x5,  0x10, 0xdd, 0xaf, 0xd4, 0x2a, 0x0,  0x14, 0x50, 0x6b, 0x29, 0xd9, 0x81, 0x27,
                   0xc9, 0xec, 0xa1, 0xb5, 0x6f, 0xb0, 0x44, 0xbf, 0x4c, 0xf1, 0x9e, 0x99, 0x4,  0xe4, 0x0,
                   0x9,  0x23, 0xe7, 0xcd, 0x45, 0xdc, 0xd9, 0x26, 0x53, 0xf2, 0x0,  0x3,  0xd3, 0x91, 0xcc};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x8e, 0x2c, 0xfd, 0xfb, 0xe4, 0xa4, 0x36, 0x3e, 0xed, 0x3,  0x96, 0xca,
                                     0xe4, 0xe1, 0xec, 0x1a, 0x82, 0x7d, 0x90, 0x8e, 0xc4, 0x3a, 0x4};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x37, 0x24, 0x26, 0xd8, 0xa2, 0x1c, 0x45, 0x6e, 0x1e, 0x73, 0x79, 0xf4, 0x5d};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc8, 0xd1, 0x44};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9a, 0x2c, 0xa4, 0x3c};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd3, 0x63, 0x99};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x10, 0xdd, 0xaf, 0xd4, 0x2a};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x50, 0x6b, 0x29, 0xd9, 0x81, 0x27, 0xc9, 0xec, 0xa1, 0xb5,
                                     0x6f, 0xb0, 0x44, 0xbf, 0x4c, 0xf1, 0x9e, 0x99, 0x4,  0xe4};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x23, 0xe7, 0xcd, 0x45, 0xdc, 0xd9, 0x26, 0x53, 0xf2};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd3, 0x91, 0xcc};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT311, 27410, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17193
// ["\201\232\214-\249\178\243\205$\220\150\232<\145\247","\167\SOH\185\173{\128\&73b\161rO\230\187\148\214\163\169\130\195\177\233\159l\249","K\ENQ\f\ACK\152\223","\169\DC1\140\210\EMO\172%;\SI\DLE\128\170U\SI\180\&7g\221\229
// ","\255/n\"\EOT\\P\199\f\DEL\254\EMgh\179\206\243>"] []
TEST(Unsubscribe5QCTest, Encode1) {
  uint8_t pkt[] = {0xa2, 0x62, 0x43, 0x29, 0x0,  0x0,  0xf,  0xc9, 0xe8, 0xd6, 0x2d, 0xf9, 0xb2, 0xf3, 0xcd, 0x24, 0xdc,
                   0x96, 0xe8, 0x3c, 0x91, 0xf7, 0x0,  0x19, 0xa7, 0x1,  0xb9, 0xad, 0x7b, 0x80, 0x37, 0x33, 0x62, 0xa1,
                   0x72, 0x4f, 0xe6, 0xbb, 0x94, 0xd6, 0xa3, 0xa9, 0x82, 0xc3, 0xb1, 0xe9, 0x9f, 0x6c, 0xf9, 0x0,  0x6,
                   0x4b, 0x5,  0xc,  0x6,  0x98, 0xdf, 0x0,  0x15, 0xa9, 0x11, 0x8c, 0xd2, 0x19, 0x4f, 0xac, 0x25, 0x3b,
                   0xf,  0x10, 0x80, 0xaa, 0x55, 0xf,  0xb4, 0x37, 0x67, 0xdd, 0xe5, 0x20, 0x0,  0x12, 0xff, 0x2f, 0x6e,
                   0x22, 0x4,  0x5c, 0x50, 0xc7, 0xc,  0x7f, 0xfe, 0x19, 0x67, 0x68, 0xb3, 0xce, 0xf3, 0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0xc9, 0xe8, 0xd6, 0x2d, 0xf9, 0xb2, 0xf3, 0xcd,
                                     0x24, 0xdc, 0x96, 0xe8, 0x3c, 0x91, 0xf7};
  lwmqtt_string_t topic_filter_s0 = {15, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa7, 0x1,  0xb9, 0xad, 0x7b, 0x80, 0x37, 0x33, 0x62, 0xa1, 0x72, 0x4f, 0xe6,
                                     0xbb, 0x94, 0xd6, 0xa3, 0xa9, 0x82, 0xc3, 0xb1, 0xe9, 0x9f, 0x6c, 0xf9};
  lwmqtt_string_t topic_filter_s1 = {25, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x4b, 0x5, 0xc, 0x6, 0x98, 0xdf};
  lwmqtt_string_t topic_filter_s2 = {6, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xa9, 0x11, 0x8c, 0xd2, 0x19, 0x4f, 0xac, 0x25, 0x3b, 0xf, 0x10,
                                     0x80, 0xaa, 0x55, 0xf,  0xb4, 0x37, 0x67, 0xdd, 0xe5, 0x20};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xff, 0x2f, 0x6e, 0x22, 0x4,  0x5c, 0x50, 0xc7, 0xc,
                                     0x7f, 0xfe, 0x19, 0x67, 0x68, 0xb3, 0xce, 0xf3, 0x3e};
  lwmqtt_string_t topic_filter_s4 = {18, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17193, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26830
// ["\218+\CAN,\224\168w\RSA\238#\r\212'\236M7g\185\213H9V\247)","-\222\193hv\157\140\193\135\212\152\212","\DEL\rs\210\"\178\STX\ENQ\226\231\ETX\247)\157c\218\174","\243eC
// v|F\170\188e\246w\177:\197J\219\212\184i\139\EOT\207\187\177\228\192\150?\134","\159\157\FS\135\152\130u\DC4\194","\151O\204\&1\251\ACK","46\222nn\188#\191\208{\DC4\208\217\195"]
// [PropAssignedClientIdentifier "\128\221\179\247\163 \237\230B\150",PropAuthenticationMethod
// "h\177\&6\139\ETXu\143l^\246\155v\198H4\137\DC3\167\234\228\163\148\236\US\149\209\135q\130",PropPayloadFormatIndicator
// 50,PropResponseInformation "\ETXq\241%\238\151",PropSharedSubscriptionAvailable 148,PropWillDelayInterval
// 25509,PropTopicAlias 4710,PropContentType "\173\218T\210\215W~>XI\156/\250\152H",PropAuthenticationData
// "\240A1*\138\219\168\216'v\187\&0\153\CAN\202A\231o\DLE\202\251\210]\231\200",PropSessionExpiryInterval
// 22202,PropResponseInformation "\181\228\230",PropRetainAvailable 241,PropResponseInformation
// "\136\247\141o\191",PropServerReference "\249\246\v\DC2\183I\160\183z9"]
TEST(Unsubscribe5QCTest, Encode2) {
  uint8_t pkt[] = {
      0xa2, 0x95, 0x2,  0x68, 0xce, 0x92, 0x1,  0x12, 0x0,  0xa,  0x80, 0xdd, 0xb3, 0xf7, 0xa3, 0x20, 0xed, 0xe6, 0x42,
      0x96, 0x15, 0x0,  0x1d, 0x68, 0xb1, 0x36, 0x8b, 0x3,  0x75, 0x8f, 0x6c, 0x5e, 0xf6, 0x9b, 0x76, 0xc6, 0x48, 0x34,
      0x89, 0x13, 0xa7, 0xea, 0xe4, 0xa3, 0x94, 0xec, 0x1f, 0x95, 0xd1, 0x87, 0x71, 0x82, 0x1,  0x32, 0x1a, 0x0,  0x6,
      0x3,  0x71, 0xf1, 0x25, 0xee, 0x97, 0x2a, 0x94, 0x18, 0x0,  0x0,  0x63, 0xa5, 0x23, 0x12, 0x66, 0x3,  0x0,  0xf,
      0xad, 0xda, 0x54, 0xd2, 0xd7, 0x57, 0x7e, 0x3e, 0x58, 0x49, 0x9c, 0x2f, 0xfa, 0x98, 0x48, 0x16, 0x0,  0x19, 0xf0,
      0x41, 0x31, 0x2a, 0x8a, 0xdb, 0xa8, 0xd8, 0x27, 0x76, 0xbb, 0x30, 0x99, 0x18, 0xca, 0x41, 0xe7, 0x6f, 0x10, 0xca,
      0xfb, 0xd2, 0x5d, 0xe7, 0xc8, 0x11, 0x0,  0x0,  0x56, 0xba, 0x1a, 0x0,  0x3,  0xb5, 0xe4, 0xe6, 0x25, 0xf1, 0x1a,
      0x0,  0x5,  0x88, 0xf7, 0x8d, 0x6f, 0xbf, 0x1c, 0x0,  0xa,  0xf9, 0xf6, 0xb,  0x12, 0xb7, 0x49, 0xa0, 0xb7, 0x7a,
      0x39, 0x0,  0x19, 0xda, 0x2b, 0x18, 0x2c, 0xe0, 0xa8, 0x77, 0x1e, 0x41, 0xee, 0x23, 0xd,  0xd4, 0x27, 0xec, 0x4d,
      0x37, 0x67, 0xb9, 0xd5, 0x48, 0x39, 0x56, 0xf7, 0x29, 0x0,  0xc,  0x2d, 0xde, 0xc1, 0x68, 0x76, 0x9d, 0x8c, 0xc1,
      0x87, 0xd4, 0x98, 0xd4, 0x0,  0x11, 0x7f, 0xd,  0x73, 0xd2, 0x22, 0xb2, 0x2,  0x5,  0xe2, 0xe7, 0x3,  0xf7, 0x29,
      0x9d, 0x63, 0xda, 0xae, 0x0,  0x1e, 0xf3, 0x65, 0x43, 0x20, 0x76, 0x7c, 0x46, 0xaa, 0xbc, 0x65, 0xf6, 0x77, 0xb1,
      0x3a, 0xc5, 0x4a, 0xdb, 0xd4, 0xb8, 0x69, 0x8b, 0x4,  0xcf, 0xbb, 0xb1, 0xe4, 0xc0, 0x96, 0x3f, 0x86, 0x0,  0x9,
      0x9f, 0x9d, 0x1c, 0x87, 0x98, 0x82, 0x75, 0x14, 0xc2, 0x0,  0x6,  0x97, 0x4f, 0xcc, 0x31, 0xfb, 0x6,  0x0,  0xe,
      0x34, 0x36, 0xde, 0x6e, 0x6e, 0xbc, 0x23, 0xbf, 0xd0, 0x7b, 0x14, 0xd0, 0xd9, 0xc3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x80, 0xdd, 0xb3, 0xf7, 0xa3, 0x20, 0xed, 0xe6, 0x42, 0x96};
  uint8_t bytesprops1[] = {0x68, 0xb1, 0x36, 0x8b, 0x3,  0x75, 0x8f, 0x6c, 0x5e, 0xf6, 0x9b, 0x76, 0xc6, 0x48, 0x34,
                           0x89, 0x13, 0xa7, 0xea, 0xe4, 0xa3, 0x94, 0xec, 0x1f, 0x95, 0xd1, 0x87, 0x71, 0x82};
  uint8_t bytesprops2[] = {0x3, 0x71, 0xf1, 0x25, 0xee, 0x97};
  uint8_t bytesprops3[] = {0xad, 0xda, 0x54, 0xd2, 0xd7, 0x57, 0x7e, 0x3e, 0x58, 0x49, 0x9c, 0x2f, 0xfa, 0x98, 0x48};
  uint8_t bytesprops4[] = {0xf0, 0x41, 0x31, 0x2a, 0x8a, 0xdb, 0xa8, 0xd8, 0x27, 0x76, 0xbb, 0x30, 0x99,
                           0x18, 0xca, 0x41, 0xe7, 0x6f, 0x10, 0xca, 0xfb, 0xd2, 0x5d, 0xe7, 0xc8};
  uint8_t bytesprops5[] = {0xb5, 0xe4, 0xe6};
  uint8_t bytesprops6[] = {0x88, 0xf7, 0x8d, 0x6f, 0xbf};
  uint8_t bytesprops7[] = {0xf9, 0xf6, 0xb, 0x12, 0xb7, 0x49, 0xa0, 0xb7, 0x7a, 0x39};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 50}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25509}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 4710}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {25, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 22202}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 241}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0xda, 0x2b, 0x18, 0x2c, 0xe0, 0xa8, 0x77, 0x1e, 0x41, 0xee, 0x23, 0xd, 0xd4,
                                     0x27, 0xec, 0x4d, 0x37, 0x67, 0xb9, 0xd5, 0x48, 0x39, 0x56, 0xf7, 0x29};
  lwmqtt_string_t topic_filter_s0 = {25, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2d, 0xde, 0xc1, 0x68, 0x76, 0x9d, 0x8c, 0xc1, 0x87, 0xd4, 0x98, 0xd4};
  lwmqtt_string_t topic_filter_s1 = {12, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7f, 0xd, 0x73, 0xd2, 0x22, 0xb2, 0x2,  0x5, 0xe2,
                                     0xe7, 0x3, 0xf7, 0x29, 0x9d, 0x63, 0xda, 0xae};
  lwmqtt_string_t topic_filter_s2 = {17, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf3, 0x65, 0x43, 0x20, 0x76, 0x7c, 0x46, 0xaa, 0xbc, 0x65,
                                     0xf6, 0x77, 0xb1, 0x3a, 0xc5, 0x4a, 0xdb, 0xd4, 0xb8, 0x69,
                                     0x8b, 0x4,  0xcf, 0xbb, 0xb1, 0xe4, 0xc0, 0x96, 0x3f, 0x86};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9f, 0x9d, 0x1c, 0x87, 0x98, 0x82, 0x75, 0x14, 0xc2};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x97, 0x4f, 0xcc, 0x31, 0xfb, 0x6};
  lwmqtt_string_t topic_filter_s5 = {6, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x34, 0x36, 0xde, 0x6e, 0x6e, 0xbc, 0x23,
                                     0xbf, 0xd0, 0x7b, 0x14, 0xd0, 0xd9, 0xc3};
  lwmqtt_string_t topic_filter_s6 = {14, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26830, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 23824 ["\226W\ETX\192;\167?\SO \145"] [PropRequestResponseInformation 87,PropReceiveMaximum
// 20388,PropReceiveMaximum 27543,PropMessageExpiryInterval 17456,PropTopicAliasMaximum 32748,PropMaximumQoS
// 145,PropMessageExpiryInterval 31600,PropRequestProblemInformation 63,PropAuthenticationMethod
// "\DLEQ\232F\162\143\&6\SO\242\200%\136\251z[|\ACK\129\213\147",PropServerKeepAlive
// 8194,PropRequestResponseInformation 19,PropRequestResponseInformation 205,PropContentType
// "\203oD\202*\181,%\248\240\SUBo\228wJ\168\130\NAK\243\253",PropMessageExpiryInterval 11962,PropSessionExpiryInterval
// 14539,PropUserProperty ""
// "\ACKt\206BH\250\221\238\232\ENQ\172\207\137\STX\195\172k\GS\CAN\154\203-\ETX\204\229\&2!<",PropTopicAlias
// 2154,PropContentType "\236\211\136>U\199L\168\162",PropCorrelationData
// "Fd\229\ACKS\206\180c\143y\153d\210\180\149+\165\207\179\NUL;\135\146v:\182\218\151\207\155",PropSharedSubscriptionAvailable
// 135,PropAuthenticationMethod "\225c\237 \183ve\FS\186",PropTopicAliasMaximum 30866,PropServerKeepAlive
// 32352,PropUserProperty "" "",PropUserProperty "\nY\DLE\150T\227W\160c\228"
// "\208\227\139\ENQ\t\RS\201\v\227\183y\243\215\183\f",PropAssignedClientIdentifier
// "X\SO\176\234\&0\195\253\204\ENQ\143\208y\f\SOH<\ACK",PropMessageExpiryInterval 30461,PropCorrelationData
// "\223A\205\193($\DEL\131\153zj6f@O\145c\243\RS\155\&0\130\143"]
TEST(Unsubscribe5QCTest, Encode3) {
  uint8_t pkt[] = {
      0xa2, 0xa2, 0x2,  0x5d, 0x10, 0x92, 0x2,  0x19, 0x57, 0x21, 0x4f, 0xa4, 0x21, 0x6b, 0x97, 0x2,  0x0,  0x0,  0x44,
      0x30, 0x22, 0x7f, 0xec, 0x24, 0x91, 0x2,  0x0,  0x0,  0x7b, 0x70, 0x17, 0x3f, 0x15, 0x0,  0x14, 0x10, 0x51, 0xe8,
      0x46, 0xa2, 0x8f, 0x36, 0xe,  0xf2, 0xc8, 0x25, 0x88, 0xfb, 0x7a, 0x5b, 0x7c, 0x6,  0x81, 0xd5, 0x93, 0x13, 0x20,
      0x2,  0x19, 0x13, 0x19, 0xcd, 0x3,  0x0,  0x14, 0xcb, 0x6f, 0x44, 0xca, 0x2a, 0xb5, 0x2c, 0x25, 0xf8, 0xf0, 0x1a,
      0x6f, 0xe4, 0x77, 0x4a, 0xa8, 0x82, 0x15, 0xf3, 0xfd, 0x2,  0x0,  0x0,  0x2e, 0xba, 0x11, 0x0,  0x0,  0x38, 0xcb,
      0x26, 0x0,  0x0,  0x0,  0x1c, 0x6,  0x74, 0xce, 0x42, 0x48, 0xfa, 0xdd, 0xee, 0xe8, 0x5,  0xac, 0xcf, 0x89, 0x2,
      0xc3, 0xac, 0x6b, 0x1d, 0x18, 0x9a, 0xcb, 0x2d, 0x3,  0xcc, 0xe5, 0x32, 0x21, 0x3c, 0x23, 0x8,  0x6a, 0x3,  0x0,
      0x9,  0xec, 0xd3, 0x88, 0x3e, 0x55, 0xc7, 0x4c, 0xa8, 0xa2, 0x9,  0x0,  0x1e, 0x46, 0x64, 0xe5, 0x6,  0x53, 0xce,
      0xb4, 0x63, 0x8f, 0x79, 0x99, 0x64, 0xd2, 0xb4, 0x95, 0x2b, 0xa5, 0xcf, 0xb3, 0x0,  0x3b, 0x87, 0x92, 0x76, 0x3a,
      0xb6, 0xda, 0x97, 0xcf, 0x9b, 0x2a, 0x87, 0x15, 0x0,  0x9,  0xe1, 0x63, 0xed, 0x20, 0xb7, 0x76, 0x65, 0x1c, 0xba,
      0x22, 0x78, 0x92, 0x13, 0x7e, 0x60, 0x26, 0x0,  0x0,  0x0,  0x0,  0x26, 0x0,  0xa,  0xa,  0x59, 0x10, 0x96, 0x54,
      0xe3, 0x57, 0xa0, 0x63, 0xe4, 0x0,  0xf,  0xd0, 0xe3, 0x8b, 0x5,  0x9,  0x1e, 0xc9, 0xb,  0xe3, 0xb7, 0x79, 0xf3,
      0xd7, 0xb7, 0xc,  0x12, 0x0,  0x10, 0x58, 0xe,  0xb0, 0xea, 0x30, 0xc3, 0xfd, 0xcc, 0x5,  0x8f, 0xd0, 0x79, 0xc,
      0x1,  0x3c, 0x6,  0x2,  0x0,  0x0,  0x76, 0xfd, 0x9,  0x0,  0x17, 0xdf, 0x41, 0xcd, 0xc1, 0x28, 0x24, 0x7f, 0x83,
      0x99, 0x7a, 0x6a, 0x36, 0x66, 0x40, 0x4f, 0x91, 0x63, 0xf3, 0x1e, 0x9b, 0x30, 0x82, 0x8f, 0x0,  0xa,  0xe2, 0x57,
      0x3,  0xc0, 0x3b, 0xa7, 0x3f, 0xe,  0x20, 0x91};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x10, 0x51, 0xe8, 0x46, 0xa2, 0x8f, 0x36, 0xe,  0xf2, 0xc8,
                           0x25, 0x88, 0xfb, 0x7a, 0x5b, 0x7c, 0x6,  0x81, 0xd5, 0x93};
  uint8_t bytesprops1[] = {0xcb, 0x6f, 0x44, 0xca, 0x2a, 0xb5, 0x2c, 0x25, 0xf8, 0xf0,
                           0x1a, 0x6f, 0xe4, 0x77, 0x4a, 0xa8, 0x82, 0x15, 0xf3, 0xfd};
  uint8_t bytesprops3[] = {0x6,  0x74, 0xce, 0x42, 0x48, 0xfa, 0xdd, 0xee, 0xe8, 0x5,  0xac, 0xcf, 0x89, 0x2,
                           0xc3, 0xac, 0x6b, 0x1d, 0x18, 0x9a, 0xcb, 0x2d, 0x3,  0xcc, 0xe5, 0x32, 0x21, 0x3c};
  uint8_t bytesprops2[] = {0};
  uint8_t bytesprops4[] = {0xec, 0xd3, 0x88, 0x3e, 0x55, 0xc7, 0x4c, 0xa8, 0xa2};
  uint8_t bytesprops5[] = {0x46, 0x64, 0xe5, 0x6,  0x53, 0xce, 0xb4, 0x63, 0x8f, 0x79, 0x99, 0x64, 0xd2, 0xb4, 0x95,
                           0x2b, 0xa5, 0xcf, 0xb3, 0x0,  0x3b, 0x87, 0x92, 0x76, 0x3a, 0xb6, 0xda, 0x97, 0xcf, 0x9b};
  uint8_t bytesprops6[] = {0xe1, 0x63, 0xed, 0x20, 0xb7, 0x76, 0x65, 0x1c, 0xba};
  uint8_t bytesprops8[] = {0};
  uint8_t bytesprops7[] = {0};
  uint8_t bytesprops10[] = {0xd0, 0xe3, 0x8b, 0x5, 0x9, 0x1e, 0xc9, 0xb, 0xe3, 0xb7, 0x79, 0xf3, 0xd7, 0xb7, 0xc};
  uint8_t bytesprops9[] = {0xa, 0x59, 0x10, 0x96, 0x54, 0xe3, 0x57, 0xa0, 0x63, 0xe4};
  uint8_t bytesprops11[] = {0x58, 0xe, 0xb0, 0xea, 0x30, 0xc3, 0xfd, 0xcc, 0x5, 0x8f, 0xd0, 0x79, 0xc, 0x1, 0x3c, 0x6};
  uint8_t bytesprops12[] = {0xdf, 0x41, 0xcd, 0xc1, 0x28, 0x24, 0x7f, 0x83, 0x99, 0x7a, 0x6a, 0x36,
                            0x66, 0x40, 0x4f, 0x91, 0x63, 0xf3, 0x1e, 0x9b, 0x30, 0x82, 0x8f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20388}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 27543}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17456}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 32748}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31600}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 63}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8194}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {20, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11962}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14539}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops2}, .v = {28, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2154}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30866}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 32352}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops7}, .v = {0, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops9}, .v = {15, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {16, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30461}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops12}}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xe2, 0x57, 0x3, 0xc0, 0x3b, 0xa7, 0x3f, 0xe, 0x20, 0x91};
  lwmqtt_string_t topic_filter_s0 = {10, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 23824, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 20314
// ["\247$\SOcz\155#\129\206\189\129\151\230\250[\179\254\214=v\GS\230\237\227\174\157\ETB\ESC\189"]
// [PropAssignedClientIdentifier "]\222#\222G\232n\197\ACK\170f\139\157\154\183\a\167",PropUserProperty
// "\221\DLE\146)\186\136\&7\232" "\220\218,\136\219#4d\143\250\253\251\218\FS\ACK",PropAuthenticationMethod
// "\161\EM_\DEL\198\159i\164e\173\161#\SI\252\216\STX%\198\178Ij8~\162",PropTopicAliasMaximum 5392,PropServerReference
// "\132\255\141\149#\249\ESC;\SO\187\154*y\ETB\191\232Db\219\DLEIJtr\131Qk\247\DLE\169",PropServerKeepAlive
// 6076,PropTopicAliasMaximum 30910,PropSubscriptionIdentifierAvailable 160,PropMaximumQoS
// 92,PropRequestProblemInformation 171,PropServerKeepAlive 12856,PropTopicAlias 32229,PropMessageExpiryInterval
// 11092,PropRetainAvailable 106,PropUserProperty "\161\160>I\250f\174\SO\205\b\ESCD@\STXb\216{v\fT\248
// $E\196\178\203\&4<" "",PropSubscriptionIdentifierAvailable 15,PropUserProperty
// ">\170\FS\193\205GS\209\211\247h\EM\DLEW\226\157"
// "\197/&4\163aHw\250S\145\&5)\SOH\204\240\182\209\SOH\145\169",PropResponseTopic
// "\147\147Y\243\232\&91fj;\184\243\135\&3\149&_\174L\ESC\203n49\206\198\147'w\197",PropMessageExpiryInterval
// 13776,PropAuthenticationData "\162\251,\206\178\249tR\180}\232\178\&3b0u\199\ENQC\GS)\169\198"]
TEST(Unsubscribe5QCTest, Encode4) {
  uint8_t pkt[] = {
      0xa2, 0xb9, 0x2,  0x4f, 0x5a, 0x96, 0x2,  0x12, 0x0,  0x11, 0x5d, 0xde, 0x23, 0xde, 0x47, 0xe8, 0x6e, 0xc5, 0x6,
      0xaa, 0x66, 0x8b, 0x9d, 0x9a, 0xb7, 0x7,  0xa7, 0x26, 0x0,  0x8,  0xdd, 0x10, 0x92, 0x29, 0xba, 0x88, 0x37, 0xe8,
      0x0,  0xf,  0xdc, 0xda, 0x2c, 0x88, 0xdb, 0x23, 0x34, 0x64, 0x8f, 0xfa, 0xfd, 0xfb, 0xda, 0x1c, 0x6,  0x15, 0x0,
      0x18, 0xa1, 0x19, 0x5f, 0x7f, 0xc6, 0x9f, 0x69, 0xa4, 0x65, 0xad, 0xa1, 0x23, 0xf,  0xfc, 0xd8, 0x2,  0x25, 0xc6,
      0xb2, 0x49, 0x6a, 0x38, 0x7e, 0xa2, 0x22, 0x15, 0x10, 0x1c, 0x0,  0x1e, 0x84, 0xff, 0x8d, 0x95, 0x23, 0xf9, 0x1b,
      0x3b, 0xe,  0xbb, 0x9a, 0x2a, 0x79, 0x17, 0xbf, 0xe8, 0x44, 0x62, 0xdb, 0x10, 0x49, 0x4a, 0x74, 0x72, 0x83, 0x51,
      0x6b, 0xf7, 0x10, 0xa9, 0x13, 0x17, 0xbc, 0x22, 0x78, 0xbe, 0x29, 0xa0, 0x24, 0x5c, 0x17, 0xab, 0x13, 0x32, 0x38,
      0x23, 0x7d, 0xe5, 0x2,  0x0,  0x0,  0x2b, 0x54, 0x25, 0x6a, 0x26, 0x0,  0x1d, 0xa1, 0xa0, 0x3e, 0x49, 0xfa, 0x66,
      0xae, 0xe,  0xcd, 0x8,  0x1b, 0x44, 0x40, 0x2,  0x62, 0xd8, 0x7b, 0x76, 0xc,  0x54, 0xf8, 0x20, 0x24, 0x45, 0xc4,
      0xb2, 0xcb, 0x34, 0x3c, 0x0,  0x0,  0x29, 0xf,  0x26, 0x0,  0x10, 0x3e, 0xaa, 0x1c, 0xc1, 0xcd, 0x47, 0x53, 0xd1,
      0xd3, 0xf7, 0x68, 0x19, 0x10, 0x57, 0xe2, 0x9d, 0x0,  0x15, 0xc5, 0x2f, 0x26, 0x34, 0xa3, 0x61, 0x48, 0x77, 0xfa,
      0x53, 0x91, 0x35, 0x29, 0x1,  0xcc, 0xf0, 0xb6, 0xd1, 0x1,  0x91, 0xa9, 0x8,  0x0,  0x1e, 0x93, 0x93, 0x59, 0xf3,
      0xe8, 0x39, 0x31, 0x66, 0x6a, 0x3b, 0xb8, 0xf3, 0x87, 0x33, 0x95, 0x26, 0x5f, 0xae, 0x4c, 0x1b, 0xcb, 0x6e, 0x34,
      0x39, 0xce, 0xc6, 0x93, 0x27, 0x77, 0xc5, 0x2,  0x0,  0x0,  0x35, 0xd0, 0x16, 0x0,  0x17, 0xa2, 0xfb, 0x2c, 0xce,
      0xb2, 0xf9, 0x74, 0x52, 0xb4, 0x7d, 0xe8, 0xb2, 0x33, 0x62, 0x30, 0x75, 0xc7, 0x5,  0x43, 0x1d, 0x29, 0xa9, 0xc6,
      0x0,  0x1d, 0xf7, 0x24, 0xe,  0x63, 0x7a, 0x9b, 0x23, 0x81, 0xce, 0xbd, 0x81, 0x97, 0xe6, 0xfa, 0x5b, 0xb3, 0xfe,
      0xd6, 0x3d, 0x76, 0x1d, 0xe6, 0xed, 0xe3, 0xae, 0x9d, 0x17, 0x1b, 0xbd};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x5d, 0xde, 0x23, 0xde, 0x47, 0xe8, 0x6e, 0xc5, 0x6,
                           0xaa, 0x66, 0x8b, 0x9d, 0x9a, 0xb7, 0x7,  0xa7};
  uint8_t bytesprops2[] = {0xdc, 0xda, 0x2c, 0x88, 0xdb, 0x23, 0x34, 0x64, 0x8f, 0xfa, 0xfd, 0xfb, 0xda, 0x1c, 0x6};
  uint8_t bytesprops1[] = {0xdd, 0x10, 0x92, 0x29, 0xba, 0x88, 0x37, 0xe8};
  uint8_t bytesprops3[] = {0xa1, 0x19, 0x5f, 0x7f, 0xc6, 0x9f, 0x69, 0xa4, 0x65, 0xad, 0xa1, 0x23,
                           0xf,  0xfc, 0xd8, 0x2,  0x25, 0xc6, 0xb2, 0x49, 0x6a, 0x38, 0x7e, 0xa2};
  uint8_t bytesprops4[] = {0x84, 0xff, 0x8d, 0x95, 0x23, 0xf9, 0x1b, 0x3b, 0xe,  0xbb, 0x9a, 0x2a, 0x79, 0x17, 0xbf,
                           0xe8, 0x44, 0x62, 0xdb, 0x10, 0x49, 0x4a, 0x74, 0x72, 0x83, 0x51, 0x6b, 0xf7, 0x10, 0xa9};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops5[] = {0xa1, 0xa0, 0x3e, 0x49, 0xfa, 0x66, 0xae, 0xe,  0xcd, 0x8,  0x1b, 0x44, 0x40, 0x2, 0x62,
                           0xd8, 0x7b, 0x76, 0xc,  0x54, 0xf8, 0x20, 0x24, 0x45, 0xc4, 0xb2, 0xcb, 0x34, 0x3c};
  uint8_t bytesprops8[] = {0xc5, 0x2f, 0x26, 0x34, 0xa3, 0x61, 0x48, 0x77, 0xfa, 0x53, 0x91,
                           0x35, 0x29, 0x1,  0xcc, 0xf0, 0xb6, 0xd1, 0x1,  0x91, 0xa9};
  uint8_t bytesprops7[] = {0x3e, 0xaa, 0x1c, 0xc1, 0xcd, 0x47, 0x53, 0xd1,
                           0xd3, 0xf7, 0x68, 0x19, 0x10, 0x57, 0xe2, 0x9d};
  uint8_t bytesprops9[] = {0x93, 0x93, 0x59, 0xf3, 0xe8, 0x39, 0x31, 0x66, 0x6a, 0x3b, 0xb8, 0xf3, 0x87, 0x33, 0x95,
                           0x26, 0x5f, 0xae, 0x4c, 0x1b, 0xcb, 0x6e, 0x34, 0x39, 0xce, 0xc6, 0x93, 0x27, 0x77, 0xc5};
  uint8_t bytesprops10[] = {0xa2, 0xfb, 0x2c, 0xce, 0xb2, 0xf9, 0x74, 0x52, 0xb4, 0x7d, 0xe8, 0xb2,
                            0x33, 0x62, 0x30, 0x75, 0xc7, 0x5,  0x43, 0x1d, 0x29, 0xa9, 0xc6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops1}, .v = {15, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5392}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 6076}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30910}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 160}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 92}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 12856}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 32229}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11092}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops5}, .v = {0, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 15}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {16, (char*)&bytesprops7}, .v = {21, (char*)&bytesprops8}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {30, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13776}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {23, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xf7, 0x24, 0xe,  0x63, 0x7a, 0x9b, 0x23, 0x81, 0xce, 0xbd,
                                     0x81, 0x97, 0xe6, 0xfa, 0x5b, 0xb3, 0xfe, 0xd6, 0x3d, 0x76,
                                     0x1d, 0xe6, 0xed, 0xe3, 0xae, 0x9d, 0x17, 0x1b, 0xbd};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20314, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 29664
// ["\214i\176\156X)\134(\251ux\210\240\DC1\SUB\200\219\EM\219l\213\170B","=\197\235\163\&1\EM\ENQ\255\181\143\201\171vu_o","6\134~W\204","7\223'\b\224\232u","\166v\184[x","z\n\135.Z\170\&9\208\249\231|\132",":1\229C\168\137","7\181\161\220\150\219:\219\171i\226u\150\195`\169","\223\233\205\n\174\ETB\193\ETB\v\255\&0\137u\158\136D\201\&1","\EMX\246C\131J
// \242>:\SOH\164"] [PropWillDelayInterval 13866,PropSharedSubscriptionAvailable 154,PropSubscriptionIdentifier
// 27,PropSessionExpiryInterval 26200,PropAuthenticationMethod
// "\136f\214T5\GSH\SI\148\188\205\247u\ETX\171\ESC\STX\245N\SOH5Ib(\222",PropRequestResponseInformation
// 65,PropReceiveMaximum 24317]
TEST(Unsubscribe5QCTest, Encode5) {
  uint8_t pkt[] = {0xa2, 0xbe, 0x1,  0x73, 0xe0, 0x2f, 0x18, 0x0,  0x0,  0x36, 0x2a, 0x2a, 0x9a, 0xb,  0x1b, 0x11, 0x0,
                   0x0,  0x66, 0x58, 0x15, 0x0,  0x19, 0x88, 0x66, 0xd6, 0x54, 0x35, 0x1d, 0x48, 0xf,  0x94, 0xbc, 0xcd,
                   0xf7, 0x75, 0x3,  0xab, 0x1b, 0x2,  0xf5, 0x4e, 0x1,  0x35, 0x49, 0x62, 0x28, 0xde, 0x19, 0x41, 0x21,
                   0x5e, 0xfd, 0x0,  0x17, 0xd6, 0x69, 0xb0, 0x9c, 0x58, 0x29, 0x86, 0x28, 0xfb, 0x75, 0x78, 0xd2, 0xf0,
                   0x11, 0x1a, 0xc8, 0xdb, 0x19, 0xdb, 0x6c, 0xd5, 0xaa, 0x42, 0x0,  0x10, 0x3d, 0xc5, 0xeb, 0xa3, 0x31,
                   0x19, 0x5,  0xff, 0xb5, 0x8f, 0xc9, 0xab, 0x76, 0x75, 0x5f, 0x6f, 0x0,  0x5,  0x36, 0x86, 0x7e, 0x57,
                   0xcc, 0x0,  0x7,  0x37, 0xdf, 0x27, 0x8,  0xe0, 0xe8, 0x75, 0x0,  0x5,  0xa6, 0x76, 0xb8, 0x5b, 0x78,
                   0x0,  0xc,  0x7a, 0xa,  0x87, 0x2e, 0x5a, 0xaa, 0x39, 0xd0, 0xf9, 0xe7, 0x7c, 0x84, 0x0,  0x6,  0x3a,
                   0x31, 0xe5, 0x43, 0xa8, 0x89, 0x0,  0x10, 0x37, 0xb5, 0xa1, 0xdc, 0x96, 0xdb, 0x3a, 0xdb, 0xab, 0x69,
                   0xe2, 0x75, 0x96, 0xc3, 0x60, 0xa9, 0x0,  0x12, 0xdf, 0xe9, 0xcd, 0xa,  0xae, 0x17, 0xc1, 0x17, 0xb,
                   0xff, 0x30, 0x89, 0x75, 0x9e, 0x88, 0x44, 0xc9, 0x31, 0x0,  0xc,  0x19, 0x58, 0xf6, 0x43, 0x83, 0x4a,
                   0x20, 0xf2, 0x3e, 0x3a, 0x1,  0xa4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x88, 0x66, 0xd6, 0x54, 0x35, 0x1d, 0x48, 0xf,  0x94, 0xbc, 0xcd, 0xf7, 0x75,
                           0x3,  0xab, 0x1b, 0x2,  0xf5, 0x4e, 0x1,  0x35, 0x49, 0x62, 0x28, 0xde};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 13866}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26200}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24317}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xd6, 0x69, 0xb0, 0x9c, 0x58, 0x29, 0x86, 0x28, 0xfb, 0x75, 0x78, 0xd2,
                                     0xf0, 0x11, 0x1a, 0xc8, 0xdb, 0x19, 0xdb, 0x6c, 0xd5, 0xaa, 0x42};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x3d, 0xc5, 0xeb, 0xa3, 0x31, 0x19, 0x5,  0xff,
                                     0xb5, 0x8f, 0xc9, 0xab, 0x76, 0x75, 0x5f, 0x6f};
  lwmqtt_string_t topic_filter_s1 = {16, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x36, 0x86, 0x7e, 0x57, 0xcc};
  lwmqtt_string_t topic_filter_s2 = {5, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x37, 0xdf, 0x27, 0x8, 0xe0, 0xe8, 0x75};
  lwmqtt_string_t topic_filter_s3 = {7, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xa6, 0x76, 0xb8, 0x5b, 0x78};
  lwmqtt_string_t topic_filter_s4 = {5, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x7a, 0xa, 0x87, 0x2e, 0x5a, 0xaa, 0x39, 0xd0, 0xf9, 0xe7, 0x7c, 0x84};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x3a, 0x31, 0xe5, 0x43, 0xa8, 0x89};
  lwmqtt_string_t topic_filter_s6 = {6, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x37, 0xb5, 0xa1, 0xdc, 0x96, 0xdb, 0x3a, 0xdb,
                                     0xab, 0x69, 0xe2, 0x75, 0x96, 0xc3, 0x60, 0xa9};
  lwmqtt_string_t topic_filter_s7 = {16, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xdf, 0xe9, 0xcd, 0xa,  0xae, 0x17, 0xc1, 0x17, 0xb,
                                     0xff, 0x30, 0x89, 0x75, 0x9e, 0x88, 0x44, 0xc9, 0x31};
  lwmqtt_string_t topic_filter_s8 = {18, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x19, 0x58, 0xf6, 0x43, 0x83, 0x4a, 0x20, 0xf2, 0x3e, 0x3a, 0x1, 0xa4};
  lwmqtt_string_t topic_filter_s9 = {12, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 29664, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28866 ["\ACK"] [PropAuthenticationData "\SI",PropMessageExpiryInterval
// 6437,PropPayloadFormatIndicator 115,PropSharedSubscriptionAvailable 176,PropMaximumQoS 86,PropUserProperty
// "F\148\DC1\254\194\179\208dX\243\151\t\b_\243X\165:\182\231~`\RSxh" "\164\135\153}\DC2.\162*",PropResponseInformation
// "X\220L\204@\140E\ACKo\235?\250\r\194\178h\230",PropServerReference "\220\194\f\146;",PropAssignedClientIdentifier
// "\230\"\CANp}\224\&4\132V\US\NUL+\133\168\193",PropTopicAlias 19678,PropMaximumQoS
// 88,PropSubscriptionIdentifierAvailable 19,PropSharedSubscriptionAvailable 13,PropRetainAvailable
// 199,PropResponseTopic "M\199m\129\254\222;3gj<!j\238J",PropResponseInformation "\248\SYN<S",PropAuthenticationData
// "\156\182\&7\215\246\150\216l5\USD\\^3\SUB\NUL(\137X\149o\208\180\207\EOT\195\179\182\DC3[",PropTopicAliasMaximum
// 17342,PropPayloadFormatIndicator 3,PropUserProperty "\133E\184\212\254O\136V#\224/\186\&1"
// "6}\"\251\ETB\215\DC4N\168\229\203\"\135\DEL\190O\206+\171<\a\213,5\128\220",PropTopicAlias 6042,PropMaximumQoS
// 24,PropUserProperty "`]\DC2\223\169\230\170v(\228\vM\237\187W\199\188\ETXG=\ESC\v\182!\ENQ\253"
// "\239\&4\206O!\197\"\136\178\163\ETB\236\166\233\184\ETX\166\ETX\t*\161",PropTopicAliasMaximum 10476]
TEST(Unsubscribe5QCTest, Encode6) {
  uint8_t pkt[] = {0xa2, 0x9c, 0x2,  0x70, 0xc2, 0x95, 0x2,  0x16, 0x0,  0x1,  0xf,  0x2,  0x0,  0x0,  0x19, 0x25, 0x1,
                   0x73, 0x2a, 0xb0, 0x24, 0x56, 0x26, 0x0,  0x19, 0x46, 0x94, 0x11, 0xfe, 0xc2, 0xb3, 0xd0, 0x64, 0x58,
                   0xf3, 0x97, 0x9,  0x8,  0x5f, 0xf3, 0x58, 0xa5, 0x3a, 0xb6, 0xe7, 0x7e, 0x60, 0x1e, 0x78, 0x68, 0x0,
                   0x8,  0xa4, 0x87, 0x99, 0x7d, 0x12, 0x2e, 0xa2, 0x2a, 0x1a, 0x0,  0x11, 0x58, 0xdc, 0x4c, 0xcc, 0x40,
                   0x8c, 0x45, 0x6,  0x6f, 0xeb, 0x3f, 0xfa, 0xd,  0xc2, 0xb2, 0x68, 0xe6, 0x1c, 0x0,  0x5,  0xdc, 0xc2,
                   0xc,  0x92, 0x3b, 0x12, 0x0,  0xf,  0xe6, 0x22, 0x18, 0x70, 0x7d, 0xe0, 0x34, 0x84, 0x56, 0x1f, 0x0,
                   0x2b, 0x85, 0xa8, 0xc1, 0x23, 0x4c, 0xde, 0x24, 0x58, 0x29, 0x13, 0x2a, 0xd,  0x25, 0xc7, 0x8,  0x0,
                   0xf,  0x4d, 0xc7, 0x6d, 0x81, 0xfe, 0xde, 0x3b, 0x33, 0x67, 0x6a, 0x3c, 0x21, 0x6a, 0xee, 0x4a, 0x1a,
                   0x0,  0x4,  0xf8, 0x16, 0x3c, 0x53, 0x16, 0x0,  0x1e, 0x9c, 0xb6, 0x37, 0xd7, 0xf6, 0x96, 0xd8, 0x6c,
                   0x35, 0x1f, 0x44, 0x5c, 0x5e, 0x33, 0x1a, 0x0,  0x28, 0x89, 0x58, 0x95, 0x6f, 0xd0, 0xb4, 0xcf, 0x4,
                   0xc3, 0xb3, 0xb6, 0x13, 0x5b, 0x22, 0x43, 0xbe, 0x1,  0x3,  0x26, 0x0,  0xd,  0x85, 0x45, 0xb8, 0xd4,
                   0xfe, 0x4f, 0x88, 0x56, 0x23, 0xe0, 0x2f, 0xba, 0x31, 0x0,  0x1a, 0x36, 0x7d, 0x22, 0xfb, 0x17, 0xd7,
                   0x14, 0x4e, 0xa8, 0xe5, 0xcb, 0x22, 0x87, 0x7f, 0xbe, 0x4f, 0xce, 0x2b, 0xab, 0x3c, 0x7,  0xd5, 0x2c,
                   0x35, 0x80, 0xdc, 0x23, 0x17, 0x9a, 0x24, 0x18, 0x26, 0x0,  0x1a, 0x60, 0x5d, 0x12, 0xdf, 0xa9, 0xe6,
                   0xaa, 0x76, 0x28, 0xe4, 0xb,  0x4d, 0xed, 0xbb, 0x57, 0xc7, 0xbc, 0x3,  0x47, 0x3d, 0x1b, 0xb,  0xb6,
                   0x21, 0x5,  0xfd, 0x0,  0x15, 0xef, 0x34, 0xce, 0x4f, 0x21, 0xc5, 0x22, 0x88, 0xb2, 0xa3, 0x17, 0xec,
                   0xa6, 0xe9, 0xb8, 0x3,  0xa6, 0x3,  0x9,  0x2a, 0xa1, 0x22, 0x28, 0xec, 0x0,  0x1,  0x6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf};
  uint8_t bytesprops2[] = {0xa4, 0x87, 0x99, 0x7d, 0x12, 0x2e, 0xa2, 0x2a};
  uint8_t bytesprops1[] = {0x46, 0x94, 0x11, 0xfe, 0xc2, 0xb3, 0xd0, 0x64, 0x58, 0xf3, 0x97, 0x9, 0x8,
                           0x5f, 0xf3, 0x58, 0xa5, 0x3a, 0xb6, 0xe7, 0x7e, 0x60, 0x1e, 0x78, 0x68};
  uint8_t bytesprops3[] = {0x58, 0xdc, 0x4c, 0xcc, 0x40, 0x8c, 0x45, 0x6, 0x6f,
                           0xeb, 0x3f, 0xfa, 0xd,  0xc2, 0xb2, 0x68, 0xe6};
  uint8_t bytesprops4[] = {0xdc, 0xc2, 0xc, 0x92, 0x3b};
  uint8_t bytesprops5[] = {0xe6, 0x22, 0x18, 0x70, 0x7d, 0xe0, 0x34, 0x84, 0x56, 0x1f, 0x0, 0x2b, 0x85, 0xa8, 0xc1};
  uint8_t bytesprops6[] = {0x4d, 0xc7, 0x6d, 0x81, 0xfe, 0xde, 0x3b, 0x33, 0x67, 0x6a, 0x3c, 0x21, 0x6a, 0xee, 0x4a};
  uint8_t bytesprops7[] = {0xf8, 0x16, 0x3c, 0x53};
  uint8_t bytesprops8[] = {0x9c, 0xb6, 0x37, 0xd7, 0xf6, 0x96, 0xd8, 0x6c, 0x35, 0x1f, 0x44, 0x5c, 0x5e, 0x33, 0x1a,
                           0x0,  0x28, 0x89, 0x58, 0x95, 0x6f, 0xd0, 0xb4, 0xcf, 0x4,  0xc3, 0xb3, 0xb6, 0x13, 0x5b};
  uint8_t bytesprops10[] = {0x36, 0x7d, 0x22, 0xfb, 0x17, 0xd7, 0x14, 0x4e, 0xa8, 0xe5, 0xcb, 0x22, 0x87,
                            0x7f, 0xbe, 0x4f, 0xce, 0x2b, 0xab, 0x3c, 0x7,  0xd5, 0x2c, 0x35, 0x80, 0xdc};
  uint8_t bytesprops9[] = {0x85, 0x45, 0xb8, 0xd4, 0xfe, 0x4f, 0x88, 0x56, 0x23, 0xe0, 0x2f, 0xba, 0x31};
  uint8_t bytesprops12[] = {0xef, 0x34, 0xce, 0x4f, 0x21, 0xc5, 0x22, 0x88, 0xb2, 0xa3, 0x17,
                            0xec, 0xa6, 0xe9, 0xb8, 0x3,  0xa6, 0x3,  0x9,  0x2a, 0xa1};
  uint8_t bytesprops11[] = {0x60, 0x5d, 0x12, 0xdf, 0xa9, 0xe6, 0xaa, 0x76, 0x28, 0xe4, 0xb,  0x4d, 0xed,
                            0xbb, 0x57, 0xc7, 0xbc, 0x3,  0x47, 0x3d, 0x1b, 0xb,  0xb6, 0x21, 0x5,  0xfd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6437}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 86}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops1}, .v = {8, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 19678}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 88}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 19}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 199}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {30, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 17342}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops9}, .v = {26, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6042}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)38,
       .value = {.pair = {.k = {26, (char*)&bytesprops11}, .v = {21, (char*)&bytesprops12}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10476}},
  };

  lwmqtt_properties_t props = {24, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x6};
  lwmqtt_string_t topic_filter_s0 = {1, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28866, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22023 ["f\155\163\EOT\DLE\ETX\209\SO","d\219\136\ENQC\167\239$\224","e{[\245\153\203\211*~\193"]
// [PropMaximumQoS 132,PropWildcardSubscriptionAvailable 95,PropRequestResponseInformation 183,PropResponseTopic
// "9Q\228\142(0\235\253e$7\191\150\b\247\177\&3\247\134\vE",PropContentType ";",PropMaximumQoS 58,PropMaximumQoS
// 217,PropRequestProblemInformation 158,PropMaximumQoS 99,PropSessionExpiryInterval 6831,PropUserProperty
// "Z\\I&p\204\227by" "c\150\SO#(\242\215",PropContentType
// "dGL\152\180\164\f\SI\230)t\153\b$\199\148a\147\168bC",PropResponseInformation
// "<\249\224\153\133\235M\167\205\168{3\166R\188\162r2\SOH\ESC\209\192\EOT\173\246\212\253;\249\158",PropAuthenticationMethod
// "\247",PropAuthenticationMethod "cJE",PropServerReference "\139\209e\157n*\208\149\225\140\156I\143\b\159"]
TEST(Unsubscribe5QCTest, Encode7) {
  uint8_t pkt[] = {0xa2, 0xbe, 0x1,  0x56, 0x7,  0x99, 0x1,  0x24, 0x84, 0x28, 0x5f, 0x19, 0xb7, 0x8,  0x0,  0x15, 0x39,
                   0x51, 0xe4, 0x8e, 0x28, 0x30, 0xeb, 0xfd, 0x65, 0x24, 0x37, 0xbf, 0x96, 0x8,  0xf7, 0xb1, 0x33, 0xf7,
                   0x86, 0xb,  0x45, 0x3,  0x0,  0x1,  0x3b, 0x24, 0x3a, 0x24, 0xd9, 0x17, 0x9e, 0x24, 0x63, 0x11, 0x0,
                   0x0,  0x1a, 0xaf, 0x26, 0x0,  0x9,  0x5a, 0x5c, 0x49, 0x26, 0x70, 0xcc, 0xe3, 0x62, 0x79, 0x0,  0x7,
                   0x63, 0x96, 0xe,  0x23, 0x28, 0xf2, 0xd7, 0x3,  0x0,  0x15, 0x64, 0x47, 0x4c, 0x98, 0xb4, 0xa4, 0xc,
                   0xf,  0xe6, 0x29, 0x74, 0x99, 0x8,  0x24, 0xc7, 0x94, 0x61, 0x93, 0xa8, 0x62, 0x43, 0x1a, 0x0,  0x1e,
                   0x3c, 0xf9, 0xe0, 0x99, 0x85, 0xeb, 0x4d, 0xa7, 0xcd, 0xa8, 0x7b, 0x33, 0xa6, 0x52, 0xbc, 0xa2, 0x72,
                   0x32, 0x1,  0x1b, 0xd1, 0xc0, 0x4,  0xad, 0xf6, 0xd4, 0xfd, 0x3b, 0xf9, 0x9e, 0x15, 0x0,  0x1,  0xf7,
                   0x15, 0x0,  0x3,  0x63, 0x4a, 0x45, 0x1c, 0x0,  0xf,  0x8b, 0xd1, 0x65, 0x9d, 0x6e, 0x2a, 0xd0, 0x95,
                   0xe1, 0x8c, 0x9c, 0x49, 0x8f, 0x8,  0x9f, 0x0,  0x8,  0x66, 0x9b, 0xa3, 0x4,  0x10, 0x3,  0xd1, 0xe,
                   0x0,  0x9,  0x64, 0xdb, 0x88, 0x5,  0x43, 0xa7, 0xef, 0x24, 0xe0, 0x0,  0xa,  0x65, 0x7b, 0x5b, 0xf5,
                   0x99, 0xcb, 0xd3, 0x2a, 0x7e, 0xc1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x39, 0x51, 0xe4, 0x8e, 0x28, 0x30, 0xeb, 0xfd, 0x65, 0x24, 0x37,
                           0xbf, 0x96, 0x8,  0xf7, 0xb1, 0x33, 0xf7, 0x86, 0xb,  0x45};
  uint8_t bytesprops1[] = {0x3b};
  uint8_t bytesprops3[] = {0x63, 0x96, 0xe, 0x23, 0x28, 0xf2, 0xd7};
  uint8_t bytesprops2[] = {0x5a, 0x5c, 0x49, 0x26, 0x70, 0xcc, 0xe3, 0x62, 0x79};
  uint8_t bytesprops4[] = {0x64, 0x47, 0x4c, 0x98, 0xb4, 0xa4, 0xc,  0xf,  0xe6, 0x29, 0x74,
                           0x99, 0x8,  0x24, 0xc7, 0x94, 0x61, 0x93, 0xa8, 0x62, 0x43};
  uint8_t bytesprops5[] = {0x3c, 0xf9, 0xe0, 0x99, 0x85, 0xeb, 0x4d, 0xa7, 0xcd, 0xa8, 0x7b, 0x33, 0xa6, 0x52, 0xbc,
                           0xa2, 0x72, 0x32, 0x1,  0x1b, 0xd1, 0xc0, 0x4,  0xad, 0xf6, 0xd4, 0xfd, 0x3b, 0xf9, 0x9e};
  uint8_t bytesprops6[] = {0xf7};
  uint8_t bytesprops7[] = {0x63, 0x4a, 0x45};
  uint8_t bytesprops8[] = {0x8b, 0xd1, 0x65, 0x9d, 0x6e, 0x2a, 0xd0, 0x95, 0xe1, 0x8c, 0x9c, 0x49, 0x8f, 0x8, 0x9f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 132}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 217}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 158}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 99}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 6831}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops2}, .v = {7, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x66, 0x9b, 0xa3, 0x4, 0x10, 0x3, 0xd1, 0xe};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x64, 0xdb, 0x88, 0x5, 0x43, 0xa7, 0xef, 0x24, 0xe0};
  lwmqtt_string_t topic_filter_s1 = {9, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x65, 0x7b, 0x5b, 0xf5, 0x99, 0xcb, 0xd3, 0x2a, 0x7e, 0xc1};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22023, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 28799
// ["\n\DC3\242\212\169e\178\133","\175\193&\241\184C\SO\NAK\147\164[_\NAKK\180\249\202\fq\246\RS"]
// [PropRequestResponseInformation 55]
TEST(Unsubscribe5QCTest, Encode8) {
  uint8_t pkt[] = {0xa2, 0x26, 0x70, 0x7f, 0x2,  0x19, 0x37, 0x0,  0x8,  0xa,  0x13, 0xf2, 0xd4, 0xa9,
                   0x65, 0xb2, 0x85, 0x0,  0x15, 0xaf, 0xc1, 0x26, 0xf1, 0xb8, 0x43, 0xe,  0x15, 0x93,
                   0xa4, 0x5b, 0x5f, 0x15, 0x4b, 0xb4, 0xf9, 0xca, 0xc,  0x71, 0xf6, 0x1e};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 55}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0xa, 0x13, 0xf2, 0xd4, 0xa9, 0x65, 0xb2, 0x85};
  lwmqtt_string_t topic_filter_s0 = {8, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xaf, 0xc1, 0x26, 0xf1, 0xb8, 0x43, 0xe, 0x15, 0x93, 0xa4, 0x5b,
                                     0x5f, 0x15, 0x4b, 0xb4, 0xf9, 0xca, 0xc, 0x71, 0xf6, 0x1e};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 28799, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 20344
// ["\132&\189So\207\US\218VGo\190\255u\223\192\228\&7]\EOTM\164\206\171IIN[W","\234\252\195\214\201.\223\160\FSx\204\229\237{-<r\249\235\228\233$\209\192","+\131\193a7\DC4\217\254\195'U\134","\209@\209\148\232\233\173K\167\245/\162\207\176","\DC2\SI,C\178\246\b\132\ETX","i\228\163\EOTH\244\169","\SUB\162\249\211\154-\194\212\246z\215a\206l\211\253\236\150\181Zl\149\193\158\198\173H\226A"]
// [PropMessageExpiryInterval 30778,PropUserProperty "\193#\v\DC4\235\ESC<"
// "\DC1\SO\222\139g\DC1FOT\197\136\144\SOH\207\253\169t&s",PropContentType
// "\227\158M\EMdm\189\179\DC3^J\219Y\158\188\151/R\155\177\250\170~\220\224q",PropPayloadFormatIndicator
// 100,PropAuthenticationMethod "\DLE\170,\214\\\250\176NO\ETB\231\DC3\144\DC4E9.\147
// \ETB\240\137=\175\137\216TK\164\SYN",PropAuthenticationMethod "\243\STXQ\228
// \199\144\143\163(\149\136V\SYN)0\216\143",PropContentType "\197\182",PropAuthenticationMethod
// "\142\187\DLEz)\SOH\170\242\199\166IT\144\210v",PropWildcardSubscriptionAvailable 102,PropReceiveMaximum
// 32647,PropWildcardSubscriptionAvailable 101,PropServerReference "\vJ1\174X\160",PropAssignedClientIdentifier
// "i\164\DC1\191 \161\DC4\NAKi\\Q\ETB\169*\245",PropUserProperty "@\CAN\230\229\SYNC\137\171\&6\142Dx\135\146%M\ACK"
// "\178\&1F\255r\187",PropSessionExpiryInterval 2273,PropAssignedClientIdentifier
// "r4\254\224\&9\170=\216\n\148\215\212\173\247n\RS\DLEy\ETX\153G",PropResponseTopic
// "\CAN\245gWe\221\161u?\238K\219\SYN\187\175o\DC3\250$l@\\\170",PropServerKeepAlive 4340,PropAuthenticationMethod
// "4\218P\142.y \158\252\133\222\233\172\252\247\&3f\157\134_",PropMessageExpiryInterval 14649,PropContentType
// "\193\153l\235'`X#C\190\DC1",PropWildcardSubscriptionAvailable 16,PropResponseTopic
// "\178\207c\FS\175\224",PropRetainAvailable 197,PropAssignedClientIdentifier
// "8\ETX\SUB\139`\163\212\158|\SI\173\213v\244k\226\200\150Q\247A\147\145",PropReasonString
// "H\160z\149#\187\245\ETXt\178Y\170\197\ACK\160\191\SUBP\176\160\236\218pIh",PropRetainAvailable
// 240,PropSessionExpiryInterval 10260]
TEST(Unsubscribe5QCTest, Encode9) {
  uint8_t pkt[] = {
      0xa2, 0x8a, 0x4,  0x4f, 0x78, 0xfc, 0x2,  0x2,  0x0,  0x0,  0x78, 0x3a, 0x26, 0x0,  0x7,  0xc1, 0x23, 0xb,  0x14,
      0xeb, 0x1b, 0x3c, 0x0,  0x13, 0x11, 0xe,  0xde, 0x8b, 0x67, 0x11, 0x46, 0x4f, 0x54, 0xc5, 0x88, 0x90, 0x1,  0xcf,
      0xfd, 0xa9, 0x74, 0x26, 0x73, 0x3,  0x0,  0x1a, 0xe3, 0x9e, 0x4d, 0x19, 0x64, 0x6d, 0xbd, 0xb3, 0x13, 0x5e, 0x4a,
      0xdb, 0x59, 0x9e, 0xbc, 0x97, 0x2f, 0x52, 0x9b, 0xb1, 0xfa, 0xaa, 0x7e, 0xdc, 0xe0, 0x71, 0x1,  0x64, 0x15, 0x0,
      0x1e, 0x10, 0xaa, 0x2c, 0xd6, 0x5c, 0xfa, 0xb0, 0x4e, 0x4f, 0x17, 0xe7, 0x13, 0x90, 0x14, 0x45, 0x39, 0x2e, 0x93,
      0x20, 0x17, 0xf0, 0x89, 0x3d, 0xaf, 0x89, 0xd8, 0x54, 0x4b, 0xa4, 0x16, 0x15, 0x0,  0x12, 0xf3, 0x2,  0x51, 0xe4,
      0x20, 0xc7, 0x90, 0x8f, 0xa3, 0x28, 0x95, 0x88, 0x56, 0x16, 0x29, 0x30, 0xd8, 0x8f, 0x3,  0x0,  0x2,  0xc5, 0xb6,
      0x15, 0x0,  0xf,  0x8e, 0xbb, 0x10, 0x7a, 0x29, 0x1,  0xaa, 0xf2, 0xc7, 0xa6, 0x49, 0x54, 0x90, 0xd2, 0x76, 0x28,
      0x66, 0x21, 0x7f, 0x87, 0x28, 0x65, 0x1c, 0x0,  0x6,  0xb,  0x4a, 0x31, 0xae, 0x58, 0xa0, 0x12, 0x0,  0xf,  0x69,
      0xa4, 0x11, 0xbf, 0x20, 0xa1, 0x14, 0x15, 0x69, 0x5c, 0x51, 0x17, 0xa9, 0x2a, 0xf5, 0x26, 0x0,  0x11, 0x40, 0x18,
      0xe6, 0xe5, 0x16, 0x43, 0x89, 0xab, 0x36, 0x8e, 0x44, 0x78, 0x87, 0x92, 0x25, 0x4d, 0x6,  0x0,  0x6,  0xb2, 0x31,
      0x46, 0xff, 0x72, 0xbb, 0x11, 0x0,  0x0,  0x8,  0xe1, 0x12, 0x0,  0x15, 0x72, 0x34, 0xfe, 0xe0, 0x39, 0xaa, 0x3d,
      0xd8, 0xa,  0x94, 0xd7, 0xd4, 0xad, 0xf7, 0x6e, 0x1e, 0x10, 0x79, 0x3,  0x99, 0x47, 0x8,  0x0,  0x17, 0x18, 0xf5,
      0x67, 0x57, 0x65, 0xdd, 0xa1, 0x75, 0x3f, 0xee, 0x4b, 0xdb, 0x16, 0xbb, 0xaf, 0x6f, 0x13, 0xfa, 0x24, 0x6c, 0x40,
      0x5c, 0xaa, 0x13, 0x10, 0xf4, 0x15, 0x0,  0x14, 0x34, 0xda, 0x50, 0x8e, 0x2e, 0x79, 0x20, 0x9e, 0xfc, 0x85, 0xde,
      0xe9, 0xac, 0xfc, 0xf7, 0x33, 0x66, 0x9d, 0x86, 0x5f, 0x2,  0x0,  0x0,  0x39, 0x39, 0x3,  0x0,  0xb,  0xc1, 0x99,
      0x6c, 0xeb, 0x27, 0x60, 0x58, 0x23, 0x43, 0xbe, 0x11, 0x28, 0x10, 0x8,  0x0,  0x6,  0xb2, 0xcf, 0x63, 0x1c, 0xaf,
      0xe0, 0x25, 0xc5, 0x12, 0x0,  0x17, 0x38, 0x3,  0x1a, 0x8b, 0x60, 0xa3, 0xd4, 0x9e, 0x7c, 0xf,  0xad, 0xd5, 0x76,
      0xf4, 0x6b, 0xe2, 0xc8, 0x96, 0x51, 0xf7, 0x41, 0x93, 0x91, 0x1f, 0x0,  0x19, 0x48, 0xa0, 0x7a, 0x95, 0x23, 0xbb,
      0xf5, 0x3,  0x74, 0xb2, 0x59, 0xaa, 0xc5, 0x6,  0xa0, 0xbf, 0x1a, 0x50, 0xb0, 0xa0, 0xec, 0xda, 0x70, 0x49, 0x68,
      0x25, 0xf0, 0x11, 0x0,  0x0,  0x28, 0x14, 0x0,  0x1d, 0x84, 0x26, 0xbd, 0x53, 0x6f, 0xcf, 0x1f, 0xda, 0x56, 0x47,
      0x6f, 0xbe, 0xff, 0x75, 0xdf, 0xc0, 0xe4, 0x37, 0x5d, 0x4,  0x4d, 0xa4, 0xce, 0xab, 0x49, 0x49, 0x4e, 0x5b, 0x57,
      0x0,  0x18, 0xea, 0xfc, 0xc3, 0xd6, 0xc9, 0x2e, 0xdf, 0xa0, 0x1c, 0x78, 0xcc, 0xe5, 0xed, 0x7b, 0x2d, 0x3c, 0x72,
      0xf9, 0xeb, 0xe4, 0xe9, 0x24, 0xd1, 0xc0, 0x0,  0xc,  0x2b, 0x83, 0xc1, 0x61, 0x37, 0x14, 0xd9, 0xfe, 0xc3, 0x27,
      0x55, 0x86, 0x0,  0xe,  0xd1, 0x40, 0xd1, 0x94, 0xe8, 0xe9, 0xad, 0x4b, 0xa7, 0xf5, 0x2f, 0xa2, 0xcf, 0xb0, 0x0,
      0x9,  0x12, 0xf,  0x2c, 0x43, 0xb2, 0xf6, 0x8,  0x84, 0x3,  0x0,  0x7,  0x69, 0xe4, 0xa3, 0x4,  0x48, 0xf4, 0xa9,
      0x0,  0x1d, 0x1a, 0xa2, 0xf9, 0xd3, 0x9a, 0x2d, 0xc2, 0xd4, 0xf6, 0x7a, 0xd7, 0x61, 0xce, 0x6c, 0xd3, 0xfd, 0xec,
      0x96, 0xb5, 0x5a, 0x6c, 0x95, 0xc1, 0x9e, 0xc6, 0xad, 0x48, 0xe2, 0x41};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x11, 0xe,  0xde, 0x8b, 0x67, 0x11, 0x46, 0x4f, 0x54, 0xc5,
                           0x88, 0x90, 0x1,  0xcf, 0xfd, 0xa9, 0x74, 0x26, 0x73};
  uint8_t bytesprops0[] = {0xc1, 0x23, 0xb, 0x14, 0xeb, 0x1b, 0x3c};
  uint8_t bytesprops2[] = {0xe3, 0x9e, 0x4d, 0x19, 0x64, 0x6d, 0xbd, 0xb3, 0x13, 0x5e, 0x4a, 0xdb, 0x59,
                           0x9e, 0xbc, 0x97, 0x2f, 0x52, 0x9b, 0xb1, 0xfa, 0xaa, 0x7e, 0xdc, 0xe0, 0x71};
  uint8_t bytesprops3[] = {0x10, 0xaa, 0x2c, 0xd6, 0x5c, 0xfa, 0xb0, 0x4e, 0x4f, 0x17, 0xe7, 0x13, 0x90, 0x14, 0x45,
                           0x39, 0x2e, 0x93, 0x20, 0x17, 0xf0, 0x89, 0x3d, 0xaf, 0x89, 0xd8, 0x54, 0x4b, 0xa4, 0x16};
  uint8_t bytesprops4[] = {0xf3, 0x2,  0x51, 0xe4, 0x20, 0xc7, 0x90, 0x8f, 0xa3,
                           0x28, 0x95, 0x88, 0x56, 0x16, 0x29, 0x30, 0xd8, 0x8f};
  uint8_t bytesprops5[] = {0xc5, 0xb6};
  uint8_t bytesprops6[] = {0x8e, 0xbb, 0x10, 0x7a, 0x29, 0x1, 0xaa, 0xf2, 0xc7, 0xa6, 0x49, 0x54, 0x90, 0xd2, 0x76};
  uint8_t bytesprops7[] = {0xb, 0x4a, 0x31, 0xae, 0x58, 0xa0};
  uint8_t bytesprops8[] = {0x69, 0xa4, 0x11, 0xbf, 0x20, 0xa1, 0x14, 0x15, 0x69, 0x5c, 0x51, 0x17, 0xa9, 0x2a, 0xf5};
  uint8_t bytesprops10[] = {0xb2, 0x31, 0x46, 0xff, 0x72, 0xbb};
  uint8_t bytesprops9[] = {0x40, 0x18, 0xe6, 0xe5, 0x16, 0x43, 0x89, 0xab, 0x36,
                           0x8e, 0x44, 0x78, 0x87, 0x92, 0x25, 0x4d, 0x6};
  uint8_t bytesprops11[] = {0x72, 0x34, 0xfe, 0xe0, 0x39, 0xaa, 0x3d, 0xd8, 0xa,  0x94, 0xd7,
                            0xd4, 0xad, 0xf7, 0x6e, 0x1e, 0x10, 0x79, 0x3,  0x99, 0x47};
  uint8_t bytesprops12[] = {0x18, 0xf5, 0x67, 0x57, 0x65, 0xdd, 0xa1, 0x75, 0x3f, 0xee, 0x4b, 0xdb,
                            0x16, 0xbb, 0xaf, 0x6f, 0x13, 0xfa, 0x24, 0x6c, 0x40, 0x5c, 0xaa};
  uint8_t bytesprops13[] = {0x34, 0xda, 0x50, 0x8e, 0x2e, 0x79, 0x20, 0x9e, 0xfc, 0x85,
                            0xde, 0xe9, 0xac, 0xfc, 0xf7, 0x33, 0x66, 0x9d, 0x86, 0x5f};
  uint8_t bytesprops14[] = {0xc1, 0x99, 0x6c, 0xeb, 0x27, 0x60, 0x58, 0x23, 0x43, 0xbe, 0x11};
  uint8_t bytesprops15[] = {0xb2, 0xcf, 0x63, 0x1c, 0xaf, 0xe0};
  uint8_t bytesprops16[] = {0x38, 0x3,  0x1a, 0x8b, 0x60, 0xa3, 0xd4, 0x9e, 0x7c, 0xf,  0xad, 0xd5,
                            0x76, 0xf4, 0x6b, 0xe2, 0xc8, 0x96, 0x51, 0xf7, 0x41, 0x93, 0x91};
  uint8_t bytesprops17[] = {0x48, 0xa0, 0x7a, 0x95, 0x23, 0xbb, 0xf5, 0x3,  0x74, 0xb2, 0x59, 0xaa, 0xc5,
                            0x6,  0xa0, 0xbf, 0x1a, 0x50, 0xb0, 0xa0, 0xec, 0xda, 0x70, 0x49, 0x68};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30778}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops0}, .v = {19, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {30, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {15, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32647}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {17, (char*)&bytesprops9}, .v = {6, (char*)&bytesprops10}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2273}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4340}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14649}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {11, (char*)&bytesprops14}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 16}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {6, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 197}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops17}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 240}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10260}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x84, 0x26, 0xbd, 0x53, 0x6f, 0xcf, 0x1f, 0xda, 0x56, 0x47,
                                     0x6f, 0xbe, 0xff, 0x75, 0xdf, 0xc0, 0xe4, 0x37, 0x5d, 0x4,
                                     0x4d, 0xa4, 0xce, 0xab, 0x49, 0x49, 0x4e, 0x5b, 0x57};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xea, 0xfc, 0xc3, 0xd6, 0xc9, 0x2e, 0xdf, 0xa0, 0x1c, 0x78, 0xcc, 0xe5,
                                     0xed, 0x7b, 0x2d, 0x3c, 0x72, 0xf9, 0xeb, 0xe4, 0xe9, 0x24, 0xd1, 0xc0};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x2b, 0x83, 0xc1, 0x61, 0x37, 0x14, 0xd9, 0xfe, 0xc3, 0x27, 0x55, 0x86};
  lwmqtt_string_t topic_filter_s2 = {12, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd1, 0x40, 0xd1, 0x94, 0xe8, 0xe9, 0xad,
                                     0x4b, 0xa7, 0xf5, 0x2f, 0xa2, 0xcf, 0xb0};
  lwmqtt_string_t topic_filter_s3 = {14, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x12, 0xf, 0x2c, 0x43, 0xb2, 0xf6, 0x8, 0x84, 0x3};
  lwmqtt_string_t topic_filter_s4 = {9, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x69, 0xe4, 0xa3, 0x4, 0x48, 0xf4, 0xa9};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x1a, 0xa2, 0xf9, 0xd3, 0x9a, 0x2d, 0xc2, 0xd4, 0xf6, 0x7a,
                                     0xd7, 0x61, 0xce, 0x6c, 0xd3, 0xfd, 0xec, 0x96, 0xb5, 0x5a,
                                     0x6c, 0x95, 0xc1, 0x9e, 0xc6, 0xad, 0x48, 0xe2, 0x41};
  lwmqtt_string_t topic_filter_s6 = {29, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 20344, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17201
// ["E9\225\244J\192JB\f\160(lt\188^bi","\ETB@\\{\134R\230\250\NAK\128\&8\150\248\143\251*\215ST\DC2$B\181","\188nV\144\253\231\229a\DC3]j4X\165\138\216a\227\242","\GS\140A\175\EMk\248\170\177\234\NAK\223\DEL\251\244\&7y\FS","Nw\187\SUB<lm@\DC3\253t\133t\191","\178\159\203$\179\232D\161\165Je\220\241","5\220\228"]
// [PropAuthenticationMethod "m\247\237,\158\244\253[\bU&5\220\167\170\221v",PropResponseInformation
// "\236*\233\229\CAN]\191XC\RS\197\131\193E\250\249\190\133\223'\228\132?K9\USv\213\143O",PropTopicAliasMaximum
// 31606,PropMaximumPacketSize 5936,PropUserProperty "0s\EOT\EM\SUB\141\190\188\228\197\169"
// "\SOQ}\RSm",PropTopicAliasMaximum 26239,PropMessageExpiryInterval 5456,PropTopicAlias
// 5837,PropAssignedClientIdentifier
// "\209\&5is\213}\224q);\214B\157e\STX\223\210uW5\146\156\180\192R#",PropAuthenticationMethod
// "D#\142\f\157d\141G\220)x\DC1\221",PropSharedSubscriptionAvailable 165]
TEST(Unsubscribe5QCTest, Encode10) {
  uint8_t pkt[] = {0xa2, 0x89, 0x2,  0x43, 0x31, 0x8c, 0x1,  0x15, 0x0,  0x11, 0x6d, 0xf7, 0xed, 0x2c, 0x9e, 0xf4, 0xfd,
                   0x5b, 0x8,  0x55, 0x26, 0x35, 0xdc, 0xa7, 0xaa, 0xdd, 0x76, 0x1a, 0x0,  0x1e, 0xec, 0x2a, 0xe9, 0xe5,
                   0x18, 0x5d, 0xbf, 0x58, 0x43, 0x1e, 0xc5, 0x83, 0xc1, 0x45, 0xfa, 0xf9, 0xbe, 0x85, 0xdf, 0x27, 0xe4,
                   0x84, 0x3f, 0x4b, 0x39, 0x1f, 0x76, 0xd5, 0x8f, 0x4f, 0x22, 0x7b, 0x76, 0x27, 0x0,  0x0,  0x17, 0x30,
                   0x26, 0x0,  0xb,  0x30, 0x73, 0x4,  0x19, 0x1a, 0x8d, 0xbe, 0xbc, 0xe4, 0xc5, 0xa9, 0x0,  0x5,  0xe,
                   0x51, 0x7d, 0x1e, 0x6d, 0x22, 0x66, 0x7f, 0x2,  0x0,  0x0,  0x15, 0x50, 0x23, 0x16, 0xcd, 0x12, 0x0,
                   0x1a, 0xd1, 0x35, 0x69, 0x73, 0xd5, 0x7d, 0xe0, 0x71, 0x29, 0x3b, 0xd6, 0x42, 0x9d, 0x65, 0x2,  0xdf,
                   0xd2, 0x75, 0x57, 0x35, 0x92, 0x9c, 0xb4, 0xc0, 0x52, 0x23, 0x15, 0x0,  0xd,  0x44, 0x23, 0x8e, 0xc,
                   0x9d, 0x64, 0x8d, 0x47, 0xdc, 0x29, 0x78, 0x11, 0xdd, 0x2a, 0xa5, 0x0,  0x11, 0x45, 0x39, 0xe1, 0xf4,
                   0x4a, 0xc0, 0x4a, 0x42, 0xc,  0xa0, 0x28, 0x6c, 0x74, 0xbc, 0x5e, 0x62, 0x69, 0x0,  0x17, 0x17, 0x40,
                   0x5c, 0x7b, 0x86, 0x52, 0xe6, 0xfa, 0x15, 0x80, 0x38, 0x96, 0xf8, 0x8f, 0xfb, 0x2a, 0xd7, 0x53, 0x54,
                   0x12, 0x24, 0x42, 0xb5, 0x0,  0x13, 0xbc, 0x6e, 0x56, 0x90, 0xfd, 0xe7, 0xe5, 0x61, 0x13, 0x5d, 0x6a,
                   0x34, 0x58, 0xa5, 0x8a, 0xd8, 0x61, 0xe3, 0xf2, 0x0,  0x12, 0x1d, 0x8c, 0x41, 0xaf, 0x19, 0x6b, 0xf8,
                   0xaa, 0xb1, 0xea, 0x15, 0xdf, 0x7f, 0xfb, 0xf4, 0x37, 0x79, 0x1c, 0x0,  0xe,  0x4e, 0x77, 0xbb, 0x1a,
                   0x3c, 0x6c, 0x6d, 0x40, 0x13, 0xfd, 0x74, 0x85, 0x74, 0xbf, 0x0,  0xd,  0xb2, 0x9f, 0xcb, 0x24, 0xb3,
                   0xe8, 0x44, 0xa1, 0xa5, 0x4a, 0x65, 0xdc, 0xf1, 0x0,  0x3,  0x35, 0xdc, 0xe4};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6d, 0xf7, 0xed, 0x2c, 0x9e, 0xf4, 0xfd, 0x5b, 0x8,
                           0x55, 0x26, 0x35, 0xdc, 0xa7, 0xaa, 0xdd, 0x76};
  uint8_t bytesprops1[] = {0xec, 0x2a, 0xe9, 0xe5, 0x18, 0x5d, 0xbf, 0x58, 0x43, 0x1e, 0xc5, 0x83, 0xc1, 0x45, 0xfa,
                           0xf9, 0xbe, 0x85, 0xdf, 0x27, 0xe4, 0x84, 0x3f, 0x4b, 0x39, 0x1f, 0x76, 0xd5, 0x8f, 0x4f};
  uint8_t bytesprops3[] = {0xe, 0x51, 0x7d, 0x1e, 0x6d};
  uint8_t bytesprops2[] = {0x30, 0x73, 0x4, 0x19, 0x1a, 0x8d, 0xbe, 0xbc, 0xe4, 0xc5, 0xa9};
  uint8_t bytesprops4[] = {0xd1, 0x35, 0x69, 0x73, 0xd5, 0x7d, 0xe0, 0x71, 0x29, 0x3b, 0xd6, 0x42, 0x9d,
                           0x65, 0x2,  0xdf, 0xd2, 0x75, 0x57, 0x35, 0x92, 0x9c, 0xb4, 0xc0, 0x52, 0x23};
  uint8_t bytesprops5[] = {0x44, 0x23, 0x8e, 0xc, 0x9d, 0x64, 0x8d, 0x47, 0xdc, 0x29, 0x78, 0x11, 0xdd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31606}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 5936}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {11, (char*)&bytesprops2}, .v = {5, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26239}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5456}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 5837}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {13, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 165}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x45, 0x39, 0xe1, 0xf4, 0x4a, 0xc0, 0x4a, 0x42, 0xc,
                                     0xa0, 0x28, 0x6c, 0x74, 0xbc, 0x5e, 0x62, 0x69};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x17, 0x40, 0x5c, 0x7b, 0x86, 0x52, 0xe6, 0xfa, 0x15, 0x80, 0x38, 0x96,
                                     0xf8, 0x8f, 0xfb, 0x2a, 0xd7, 0x53, 0x54, 0x12, 0x24, 0x42, 0xb5};
  lwmqtt_string_t topic_filter_s1 = {23, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xbc, 0x6e, 0x56, 0x90, 0xfd, 0xe7, 0xe5, 0x61, 0x13, 0x5d,
                                     0x6a, 0x34, 0x58, 0xa5, 0x8a, 0xd8, 0x61, 0xe3, 0xf2};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x1d, 0x8c, 0x41, 0xaf, 0x19, 0x6b, 0xf8, 0xaa, 0xb1,
                                     0xea, 0x15, 0xdf, 0x7f, 0xfb, 0xf4, 0x37, 0x79, 0x1c};
  lwmqtt_string_t topic_filter_s3 = {18, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x4e, 0x77, 0xbb, 0x1a, 0x3c, 0x6c, 0x6d,
                                     0x40, 0x13, 0xfd, 0x74, 0x85, 0x74, 0xbf};
  lwmqtt_string_t topic_filter_s4 = {14, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xb2, 0x9f, 0xcb, 0x24, 0xb3, 0xe8, 0x44, 0xa1, 0xa5, 0x4a, 0x65, 0xdc, 0xf1};
  lwmqtt_string_t topic_filter_s5 = {13, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x35, 0xdc, 0xe4};
  lwmqtt_string_t topic_filter_s6 = {3, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17201, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 17486
// ["a\ETX","\129\230^\155\234\&7s\234#C\235[\217\184\218\193\151}>Yj\DC2\239\167\132\159{","\221\ESCwC\170\ESC3\SYN\247\206"]
// [PropWildcardSubscriptionAvailable 205,PropResponseTopic
// "}\229\DC2Y[\239;\231\254\133v\EM\138O\226No",PropCorrelationData
// "\170Hr\170\199\SO\161\149Dy\229\248`\190\146\180\178w\178\DC4\222\226\ETXJ\253\144\DLE\163\DC2",PropMaximumQoS
// 231,PropUserProperty "\CAN\RS-\219\177\240\179d}\232\136\154\137\183\222nT}U\210\194"
// "\173\DC11\196j\167\156\255\a\DEL\140\245\243",PropSubscriptionIdentifier 28,PropMessageExpiryInterval
// 9872,PropUserProperty
// "\130\157\174\180\156\221\SOH\228\247Gl\SUB\194\133g\134P\NAK\223-\239[\199\138\128\224\NUL\178\\"
// "Z\213\219y\228\SOH\255",PropRequestProblemInformation 96,PropWillDelayInterval 30997,PropUserProperty
// "\139\240O\202<jFJq\202\141\154M\193\&7\202C\212\STXao_\232\182\188\DC3@" "
// p\175\211\&3=]=\ETX\204nH",PropUserProperty "\253\245\154" "\150\&08\203\238",PropAuthenticationData
// "t)\EOT`\239\rD\249\141\EM",PropReasonString
// "\DC1\187\SOH\GS{\225\197\144\207\241\217\DC2\252\128\242+8\207\EM\244<\143\147|[",PropContentType
// ",:\250.i\242C\149\253f\219\147\231\156\211\171(b/\233\133\243\159\&6",PropSubscriptionIdentifierAvailable
// 46,PropRequestResponseInformation 203,PropServerKeepAlive 25706,PropResponseInformation
// "\208i\SOH\233'\211\171\215U;\189\207(\133T\240\\i\225.g\146Y\134\147zXo\177\255"]
TEST(Unsubscribe5QCTest, Encode11) {
  uint8_t pkt[] = {
      0xa2, 0xec, 0x2,  0x44, 0x4e, 0xbb, 0x2,  0x28, 0xcd, 0x8,  0x0,  0x11, 0x7d, 0xe5, 0x12, 0x59, 0x5b, 0xef, 0x3b,
      0xe7, 0xfe, 0x85, 0x76, 0x19, 0x8a, 0x4f, 0xe2, 0x4e, 0x6f, 0x9,  0x0,  0x1d, 0xaa, 0x48, 0x72, 0xaa, 0xc7, 0xe,
      0xa1, 0x95, 0x44, 0x79, 0xe5, 0xf8, 0x60, 0xbe, 0x92, 0xb4, 0xb2, 0x77, 0xb2, 0x14, 0xde, 0xe2, 0x3,  0x4a, 0xfd,
      0x90, 0x10, 0xa3, 0x12, 0x24, 0xe7, 0x26, 0x0,  0x15, 0x18, 0x1e, 0x2d, 0xdb, 0xb1, 0xf0, 0xb3, 0x64, 0x7d, 0xe8,
      0x88, 0x9a, 0x89, 0xb7, 0xde, 0x6e, 0x54, 0x7d, 0x55, 0xd2, 0xc2, 0x0,  0xd,  0xad, 0x11, 0x31, 0xc4, 0x6a, 0xa7,
      0x9c, 0xff, 0x7,  0x7f, 0x8c, 0xf5, 0xf3, 0xb,  0x1c, 0x2,  0x0,  0x0,  0x26, 0x90, 0x26, 0x0,  0x1d, 0x82, 0x9d,
      0xae, 0xb4, 0x9c, 0xdd, 0x1,  0xe4, 0xf7, 0x47, 0x6c, 0x1a, 0xc2, 0x85, 0x67, 0x86, 0x50, 0x15, 0xdf, 0x2d, 0xef,
      0x5b, 0xc7, 0x8a, 0x80, 0xe0, 0x0,  0xb2, 0x5c, 0x0,  0x7,  0x5a, 0xd5, 0xdb, 0x79, 0xe4, 0x1,  0xff, 0x17, 0x60,
      0x18, 0x0,  0x0,  0x79, 0x15, 0x26, 0x0,  0x1b, 0x8b, 0xf0, 0x4f, 0xca, 0x3c, 0x6a, 0x46, 0x4a, 0x71, 0xca, 0x8d,
      0x9a, 0x4d, 0xc1, 0x37, 0xca, 0x43, 0xd4, 0x2,  0x61, 0x6f, 0x5f, 0xe8, 0xb6, 0xbc, 0x13, 0x40, 0x0,  0xc,  0x20,
      0x70, 0xaf, 0xd3, 0x33, 0x3d, 0x5d, 0x3d, 0x3,  0xcc, 0x6e, 0x48, 0x26, 0x0,  0x3,  0xfd, 0xf5, 0x9a, 0x0,  0x5,
      0x96, 0x30, 0x38, 0xcb, 0xee, 0x16, 0x0,  0xa,  0x74, 0x29, 0x4,  0x60, 0xef, 0xd,  0x44, 0xf9, 0x8d, 0x19, 0x1f,
      0x0,  0x19, 0x11, 0xbb, 0x1,  0x1d, 0x7b, 0xe1, 0xc5, 0x90, 0xcf, 0xf1, 0xd9, 0x12, 0xfc, 0x80, 0xf2, 0x2b, 0x38,
      0xcf, 0x19, 0xf4, 0x3c, 0x8f, 0x93, 0x7c, 0x5b, 0x3,  0x0,  0x18, 0x2c, 0x3a, 0xfa, 0x2e, 0x69, 0xf2, 0x43, 0x95,
      0xfd, 0x66, 0xdb, 0x93, 0xe7, 0x9c, 0xd3, 0xab, 0x28, 0x62, 0x2f, 0xe9, 0x85, 0xf3, 0x9f, 0x36, 0x29, 0x2e, 0x19,
      0xcb, 0x13, 0x64, 0x6a, 0x1a, 0x0,  0x1e, 0xd0, 0x69, 0x1,  0xe9, 0x27, 0xd3, 0xab, 0xd7, 0x55, 0x3b, 0xbd, 0xcf,
      0x28, 0x85, 0x54, 0xf0, 0x5c, 0x69, 0xe1, 0x2e, 0x67, 0x92, 0x59, 0x86, 0x93, 0x7a, 0x58, 0x6f, 0xb1, 0xff, 0x0,
      0x2,  0x61, 0x3,  0x0,  0x1b, 0x81, 0xe6, 0x5e, 0x9b, 0xea, 0x37, 0x73, 0xea, 0x23, 0x43, 0xeb, 0x5b, 0xd9, 0xb8,
      0xda, 0xc1, 0x97, 0x7d, 0x3e, 0x59, 0x6a, 0x12, 0xef, 0xa7, 0x84, 0x9f, 0x7b, 0x0,  0xa,  0xdd, 0x1b, 0x77, 0x43,
      0xaa, 0x1b, 0x33, 0x16, 0xf7, 0xce};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x7d, 0xe5, 0x12, 0x59, 0x5b, 0xef, 0x3b, 0xe7, 0xfe,
                           0x85, 0x76, 0x19, 0x8a, 0x4f, 0xe2, 0x4e, 0x6f};
  uint8_t bytesprops1[] = {0xaa, 0x48, 0x72, 0xaa, 0xc7, 0xe,  0xa1, 0x95, 0x44, 0x79, 0xe5, 0xf8, 0x60, 0xbe, 0x92,
                           0xb4, 0xb2, 0x77, 0xb2, 0x14, 0xde, 0xe2, 0x3,  0x4a, 0xfd, 0x90, 0x10, 0xa3, 0x12};
  uint8_t bytesprops3[] = {0xad, 0x11, 0x31, 0xc4, 0x6a, 0xa7, 0x9c, 0xff, 0x7, 0x7f, 0x8c, 0xf5, 0xf3};
  uint8_t bytesprops2[] = {0x18, 0x1e, 0x2d, 0xdb, 0xb1, 0xf0, 0xb3, 0x64, 0x7d, 0xe8, 0x88,
                           0x9a, 0x89, 0xb7, 0xde, 0x6e, 0x54, 0x7d, 0x55, 0xd2, 0xc2};
  uint8_t bytesprops5[] = {0x5a, 0xd5, 0xdb, 0x79, 0xe4, 0x1, 0xff};
  uint8_t bytesprops4[] = {0x82, 0x9d, 0xae, 0xb4, 0x9c, 0xdd, 0x1,  0xe4, 0xf7, 0x47, 0x6c, 0x1a, 0xc2, 0x85, 0x67,
                           0x86, 0x50, 0x15, 0xdf, 0x2d, 0xef, 0x5b, 0xc7, 0x8a, 0x80, 0xe0, 0x0,  0xb2, 0x5c};
  uint8_t bytesprops7[] = {0x20, 0x70, 0xaf, 0xd3, 0x33, 0x3d, 0x5d, 0x3d, 0x3, 0xcc, 0x6e, 0x48};
  uint8_t bytesprops6[] = {0x8b, 0xf0, 0x4f, 0xca, 0x3c, 0x6a, 0x46, 0x4a, 0x71, 0xca, 0x8d, 0x9a, 0x4d, 0xc1,
                           0x37, 0xca, 0x43, 0xd4, 0x2,  0x61, 0x6f, 0x5f, 0xe8, 0xb6, 0xbc, 0x13, 0x40};
  uint8_t bytesprops9[] = {0x96, 0x30, 0x38, 0xcb, 0xee};
  uint8_t bytesprops8[] = {0xfd, 0xf5, 0x9a};
  uint8_t bytesprops10[] = {0x74, 0x29, 0x4, 0x60, 0xef, 0xd, 0x44, 0xf9, 0x8d, 0x19};
  uint8_t bytesprops11[] = {0x11, 0xbb, 0x1,  0x1d, 0x7b, 0xe1, 0xc5, 0x90, 0xcf, 0xf1, 0xd9, 0x12, 0xfc,
                            0x80, 0xf2, 0x2b, 0x38, 0xcf, 0x19, 0xf4, 0x3c, 0x8f, 0x93, 0x7c, 0x5b};
  uint8_t bytesprops12[] = {0x2c, 0x3a, 0xfa, 0x2e, 0x69, 0xf2, 0x43, 0x95, 0xfd, 0x66, 0xdb, 0x93,
                            0xe7, 0x9c, 0xd3, 0xab, 0x28, 0x62, 0x2f, 0xe9, 0x85, 0xf3, 0x9f, 0x36};
  uint8_t bytesprops13[] = {0xd0, 0x69, 0x1,  0xe9, 0x27, 0xd3, 0xab, 0xd7, 0x55, 0x3b, 0xbd, 0xcf, 0x28, 0x85, 0x54,
                            0xf0, 0x5c, 0x69, 0xe1, 0x2e, 0x67, 0x92, 0x59, 0x86, 0x93, 0x7a, 0x58, 0x6f, 0xb1, 0xff};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 205}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {29, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {21, (char*)&bytesprops2}, .v = {13, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 28}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9872}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops4}, .v = {7, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 96}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 30997}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {27, (char*)&bytesprops6}, .v = {12, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {3, (char*)&bytesprops8}, .v = {5, (char*)&bytesprops9}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {10, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {25, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 46}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 203}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 25706}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {30, (char*)&bytesprops13}}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x61, 0x3};
  lwmqtt_string_t topic_filter_s0 = {2, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x81, 0xe6, 0x5e, 0x9b, 0xea, 0x37, 0x73, 0xea, 0x23, 0x43, 0xeb, 0x5b, 0xd9, 0xb8,
                                     0xda, 0xc1, 0x97, 0x7d, 0x3e, 0x59, 0x6a, 0x12, 0xef, 0xa7, 0x84, 0x9f, 0x7b};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xdd, 0x1b, 0x77, 0x43, 0xaa, 0x1b, 0x33, 0x16, 0xf7, 0xce};
  lwmqtt_string_t topic_filter_s2 = {10, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 17486, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 7754 ["\211\172/9\239\190\154\155:\145\238\225c\242\144\159\183"] [PropRetainAvailable
// 248,PropReasonString ":\184K0\247R\175b\180",PropWillDelayInterval 32718,PropSharedSubscriptionAvailable 254]
TEST(Unsubscribe5QCTest, Encode12) {
  uint8_t pkt[] = {0xa2, 0x2b, 0x1e, 0x4a, 0x15, 0x25, 0xf8, 0x1f, 0x0,  0x9,  0x3a, 0xb8, 0x4b, 0x30, 0xf7,
                   0x52, 0xaf, 0x62, 0xb4, 0x18, 0x0,  0x0,  0x7f, 0xce, 0x2a, 0xfe, 0x0,  0x11, 0xd3, 0xac,
                   0x2f, 0x39, 0xef, 0xbe, 0x9a, 0x9b, 0x3a, 0x91, 0xee, 0xe1, 0x63, 0xf2, 0x90, 0x9f, 0xb7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x3a, 0xb8, 0x4b, 0x30, 0xf7, 0x52, 0xaf, 0x62, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32718}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 254}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0xd3, 0xac, 0x2f, 0x39, 0xef, 0xbe, 0x9a, 0x9b, 0x3a,
                                     0x91, 0xee, 0xe1, 0x63, 0xf2, 0x90, 0x9f, 0xb7};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 7754, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 949 ["\139xV\142E\139\&7\179T\130\212\250G\195F\193\252\250\202{\196z\228\164\STX\US\219"]
// [PropUserProperty "\158\184#\255\244>\STX\238\217**\ESC" "\136r\228\199\191\162M.\191\133\160\246g:P\190\168
// 8\137\155",PropAuthenticationData "w",PropSharedSubscriptionAvailable 215,PropSessionExpiryInterval
// 31240,PropRequestProblemInformation 153,PropMessageExpiryInterval 10229,PropCorrelationData
// "f\245EK7\247\194\171\143\163\v3P\169Q\178\212\254&\244^\204\NAK",PropAssignedClientIdentifier
// "V\170\209\&8b\190\165Rs\EM",PropServerKeepAlive 16887,PropResponseInformation
// "e\242\128\146\CAN",PropServerReference "\a\240\202\202\230|",PropTopicAlias 8989,PropRequestResponseInformation
// 49,PropSessionExpiryInterval 18001,PropResponseTopic "\129\242C\192\149\151<\197\194\180\187\SUBD\210",PropTopicAlias
// 854,PropSharedSubscriptionAvailable 130,PropRetainAvailable 248,PropMaximumQoS 251]
TEST(Unsubscribe5QCTest, Encode13) {
  uint8_t pkt[] = {
      0xa2, 0xb8, 0x1,  0x3,  0xb5, 0x97, 0x1,  0x26, 0x0,  0xc,  0x9e, 0xb8, 0x23, 0xff, 0xf4, 0x3e, 0x2,  0xee, 0xd9,
      0x2a, 0x2a, 0x1b, 0x0,  0x15, 0x88, 0x72, 0xe4, 0xc7, 0xbf, 0xa2, 0x4d, 0x2e, 0xbf, 0x85, 0xa0, 0xf6, 0x67, 0x3a,
      0x50, 0xbe, 0xa8, 0x20, 0x38, 0x89, 0x9b, 0x16, 0x0,  0x1,  0x77, 0x2a, 0xd7, 0x11, 0x0,  0x0,  0x7a, 0x8,  0x17,
      0x99, 0x2,  0x0,  0x0,  0x27, 0xf5, 0x9,  0x0,  0x17, 0x66, 0xf5, 0x45, 0x4b, 0x37, 0xf7, 0xc2, 0xab, 0x8f, 0xa3,
      0xb,  0x33, 0x50, 0xa9, 0x51, 0xb2, 0xd4, 0xfe, 0x26, 0xf4, 0x5e, 0xcc, 0x15, 0x12, 0x0,  0xa,  0x56, 0xaa, 0xd1,
      0x38, 0x62, 0xbe, 0xa5, 0x52, 0x73, 0x19, 0x13, 0x41, 0xf7, 0x1a, 0x0,  0x5,  0x65, 0xf2, 0x80, 0x92, 0x18, 0x1c,
      0x0,  0x6,  0x7,  0xf0, 0xca, 0xca, 0xe6, 0x7c, 0x23, 0x23, 0x1d, 0x19, 0x31, 0x11, 0x0,  0x0,  0x46, 0x51, 0x8,
      0x0,  0xe,  0x81, 0xf2, 0x43, 0xc0, 0x95, 0x97, 0x3c, 0xc5, 0xc2, 0xb4, 0xbb, 0x1a, 0x44, 0xd2, 0x23, 0x3,  0x56,
      0x2a, 0x82, 0x25, 0xf8, 0x24, 0xfb, 0x0,  0x1b, 0x8b, 0x78, 0x56, 0x8e, 0x45, 0x8b, 0x37, 0xb3, 0x54, 0x82, 0xd4,
      0xfa, 0x47, 0xc3, 0x46, 0xc1, 0xfc, 0xfa, 0xca, 0x7b, 0xc4, 0x7a, 0xe4, 0xa4, 0x2,  0x1f, 0xdb};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x88, 0x72, 0xe4, 0xc7, 0xbf, 0xa2, 0x4d, 0x2e, 0xbf, 0x85, 0xa0,
                           0xf6, 0x67, 0x3a, 0x50, 0xbe, 0xa8, 0x20, 0x38, 0x89, 0x9b};
  uint8_t bytesprops0[] = {0x9e, 0xb8, 0x23, 0xff, 0xf4, 0x3e, 0x2, 0xee, 0xd9, 0x2a, 0x2a, 0x1b};
  uint8_t bytesprops2[] = {0x77};
  uint8_t bytesprops3[] = {0x66, 0xf5, 0x45, 0x4b, 0x37, 0xf7, 0xc2, 0xab, 0x8f, 0xa3, 0xb, 0x33,
                           0x50, 0xa9, 0x51, 0xb2, 0xd4, 0xfe, 0x26, 0xf4, 0x5e, 0xcc, 0x15};
  uint8_t bytesprops4[] = {0x56, 0xaa, 0xd1, 0x38, 0x62, 0xbe, 0xa5, 0x52, 0x73, 0x19};
  uint8_t bytesprops5[] = {0x65, 0xf2, 0x80, 0x92, 0x18};
  uint8_t bytesprops6[] = {0x7, 0xf0, 0xca, 0xca, 0xe6, 0x7c};
  uint8_t bytesprops7[] = {0x81, 0xf2, 0x43, 0xc0, 0x95, 0x97, 0x3c, 0xc5, 0xc2, 0xb4, 0xbb, 0x1a, 0x44, 0xd2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops0}, .v = {21, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 215}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 31240}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 153}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10229}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16887}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {6, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 8989}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18001}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 854}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 130}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 251}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x8b, 0x78, 0x56, 0x8e, 0x45, 0x8b, 0x37, 0xb3, 0x54, 0x82, 0xd4, 0xfa, 0x47, 0xc3,
                                     0x46, 0xc1, 0xfc, 0xfa, 0xca, 0x7b, 0xc4, 0x7a, 0xe4, 0xa4, 0x2,  0x1f, 0xdb};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 949, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5184
// ["\160\156\&1\155\217\US\192\233A\170\&6f\208I","\ENQ\r\NAK\179\221\CAN\215\212\191\237F\250\ESC'\255a\132\132W>\231","\169\255\rPZLI'\SO\SYN\158\226\192\203\CAN[\136\168\185","\227Jq\248\&3\215\SYN=\200\169(\221\NAKe0>\147\156pZ\131e\165\ETB\252\152d\245\133\174","\192\144\SI\216f\194_\160\160'\US}\195VY\222\235\217\186%\198T]\247","\239Z\211\232","J\184i\172\147\218PR\190~\at/\158\152T\135\"\144\RS3\139","\167\176.\244x\254S\EOT!N\202z\154T\210\DC3G\DLE\130","\194","\165\208\135\190\165G"]
// [PropRequestResponseInformation 213,PropRequestResponseInformation 171,PropWillDelayInterval
// 6198,PropSubscriptionIdentifier 3]
TEST(Unsubscribe5QCTest, Encode14) {
  uint8_t pkt[] = {0xa2, 0xc2, 0x1,  0x14, 0x40, 0xb,  0x19, 0xd5, 0x19, 0xab, 0x18, 0x0,  0x0,  0x18, 0x36, 0xb,  0x3,
                   0x0,  0xe,  0xa0, 0x9c, 0x31, 0x9b, 0xd9, 0x1f, 0xc0, 0xe9, 0x41, 0xaa, 0x36, 0x66, 0xd0, 0x49, 0x0,
                   0x15, 0x5,  0xd,  0x15, 0xb3, 0xdd, 0x18, 0xd7, 0xd4, 0xbf, 0xed, 0x46, 0xfa, 0x1b, 0x27, 0xff, 0x61,
                   0x84, 0x84, 0x57, 0x3e, 0xe7, 0x0,  0x13, 0xa9, 0xff, 0xd,  0x50, 0x5a, 0x4c, 0x49, 0x27, 0xe,  0x16,
                   0x9e, 0xe2, 0xc0, 0xcb, 0x18, 0x5b, 0x88, 0xa8, 0xb9, 0x0,  0x1e, 0xe3, 0x4a, 0x71, 0xf8, 0x33, 0xd7,
                   0x16, 0x3d, 0xc8, 0xa9, 0x28, 0xdd, 0x15, 0x65, 0x30, 0x3e, 0x93, 0x9c, 0x70, 0x5a, 0x83, 0x65, 0xa5,
                   0x17, 0xfc, 0x98, 0x64, 0xf5, 0x85, 0xae, 0x0,  0x18, 0xc0, 0x90, 0xf,  0xd8, 0x66, 0xc2, 0x5f, 0xa0,
                   0xa0, 0x27, 0x1f, 0x7d, 0xc3, 0x56, 0x59, 0xde, 0xeb, 0xd9, 0xba, 0x25, 0xc6, 0x54, 0x5d, 0xf7, 0x0,
                   0x4,  0xef, 0x5a, 0xd3, 0xe8, 0x0,  0x16, 0x4a, 0xb8, 0x69, 0xac, 0x93, 0xda, 0x50, 0x52, 0xbe, 0x7e,
                   0x7,  0x74, 0x2f, 0x9e, 0x98, 0x54, 0x87, 0x22, 0x90, 0x1e, 0x33, 0x8b, 0x0,  0x13, 0xa7, 0xb0, 0x2e,
                   0xf4, 0x78, 0xfe, 0x53, 0x4,  0x21, 0x4e, 0xca, 0x7a, 0x9a, 0x54, 0xd2, 0x13, 0x47, 0x10, 0x82, 0x0,
                   0x1,  0xc2, 0x0,  0x6,  0xa5, 0xd0, 0x87, 0xbe, 0xa5, 0x47};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 213}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 171}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6198}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0xa0, 0x9c, 0x31, 0x9b, 0xd9, 0x1f, 0xc0,
                                     0xe9, 0x41, 0xaa, 0x36, 0x66, 0xd0, 0x49};
  lwmqtt_string_t topic_filter_s0 = {14, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x5,  0xd,  0x15, 0xb3, 0xdd, 0x18, 0xd7, 0xd4, 0xbf, 0xed, 0x46,
                                     0xfa, 0x1b, 0x27, 0xff, 0x61, 0x84, 0x84, 0x57, 0x3e, 0xe7};
  lwmqtt_string_t topic_filter_s1 = {21, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xa9, 0xff, 0xd,  0x50, 0x5a, 0x4c, 0x49, 0x27, 0xe, 0x16,
                                     0x9e, 0xe2, 0xc0, 0xcb, 0x18, 0x5b, 0x88, 0xa8, 0xb9};
  lwmqtt_string_t topic_filter_s2 = {19, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe3, 0x4a, 0x71, 0xf8, 0x33, 0xd7, 0x16, 0x3d, 0xc8, 0xa9,
                                     0x28, 0xdd, 0x15, 0x65, 0x30, 0x3e, 0x93, 0x9c, 0x70, 0x5a,
                                     0x83, 0x65, 0xa5, 0x17, 0xfc, 0x98, 0x64, 0xf5, 0x85, 0xae};
  lwmqtt_string_t topic_filter_s3 = {30, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xc0, 0x90, 0xf,  0xd8, 0x66, 0xc2, 0x5f, 0xa0, 0xa0, 0x27, 0x1f, 0x7d,
                                     0xc3, 0x56, 0x59, 0xde, 0xeb, 0xd9, 0xba, 0x25, 0xc6, 0x54, 0x5d, 0xf7};
  lwmqtt_string_t topic_filter_s4 = {24, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xef, 0x5a, 0xd3, 0xe8};
  lwmqtt_string_t topic_filter_s5 = {4, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x4a, 0xb8, 0x69, 0xac, 0x93, 0xda, 0x50, 0x52, 0xbe, 0x7e, 0x7,
                                     0x74, 0x2f, 0x9e, 0x98, 0x54, 0x87, 0x22, 0x90, 0x1e, 0x33, 0x8b};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa7, 0xb0, 0x2e, 0xf4, 0x78, 0xfe, 0x53, 0x4,  0x21, 0x4e,
                                     0xca, 0x7a, 0x9a, 0x54, 0xd2, 0x13, 0x47, 0x10, 0x82};
  lwmqtt_string_t topic_filter_s7 = {19, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xc2};
  lwmqtt_string_t topic_filter_s8 = {1, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0xa5, 0xd0, 0x87, 0xbe, 0xa5, 0x47};
  lwmqtt_string_t topic_filter_s9 = {6, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5184, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 21743
// ["g\SUB\173Z5\135\245\NUL\138\243\130\165\170M\184/O\ETX\214$\241\DC3\147\&8WZ'","\243\253\202\167\210\ACK\253w\239\248\128\US\184\153\242E\242\132\219nOk\250\242qR","\"","U\138\193\246\162T_\SUB\206\&4","\154\&0Tav\255\213\&1\DC2Y","\252=\144O\"ETDc\221\130\228E_4a\DC2\253fn\209\187\138#3","F9\a\224\133\201\252\255\151\253\220\EOT\NUL\ETB3m\140o\135\215lSi\140\155\240\&2\SOH\211\128"]
// [PropSharedSubscriptionAvailable 98]
TEST(Unsubscribe5QCTest, Encode15) {
  uint8_t pkt[] = {0xa2, 0x94, 0x1,  0x54, 0xef, 0x2,  0x2a, 0x62, 0x0,  0x1b, 0x67, 0x1a, 0xad, 0x5a, 0x35, 0x87, 0xf5,
                   0x0,  0x8a, 0xf3, 0x82, 0xa5, 0xaa, 0x4d, 0xb8, 0x2f, 0x4f, 0x3,  0xd6, 0x24, 0xf1, 0x13, 0x93, 0x38,
                   0x57, 0x5a, 0x27, 0x0,  0x1a, 0xf3, 0xfd, 0xca, 0xa7, 0xd2, 0x6,  0xfd, 0x77, 0xef, 0xf8, 0x80, 0x1f,
                   0xb8, 0x99, 0xf2, 0x45, 0xf2, 0x84, 0xdb, 0x6e, 0x4f, 0x6b, 0xfa, 0xf2, 0x71, 0x52, 0x0,  0x1,  0x22,
                   0x0,  0xa,  0x55, 0x8a, 0xc1, 0xf6, 0xa2, 0x54, 0x5f, 0x1a, 0xce, 0x34, 0x0,  0xa,  0x9a, 0x30, 0x54,
                   0x61, 0x76, 0xff, 0xd5, 0x31, 0x12, 0x59, 0x0,  0x19, 0xfc, 0x3d, 0x90, 0x4f, 0x22, 0x45, 0x54, 0x44,
                   0x63, 0xdd, 0x82, 0xe4, 0x45, 0x5f, 0x34, 0x61, 0x12, 0xfd, 0x66, 0x6e, 0xd1, 0xbb, 0x8a, 0x23, 0x33,
                   0x0,  0x1e, 0x46, 0x39, 0x7,  0xe0, 0x85, 0xc9, 0xfc, 0xff, 0x97, 0xfd, 0xdc, 0x4,  0x0,  0x17, 0x33,
                   0x6d, 0x8c, 0x6f, 0x87, 0xd7, 0x6c, 0x53, 0x69, 0x8c, 0x9b, 0xf0, 0x32, 0x1,  0xd3, 0x80};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 98}},
  };

  lwmqtt_properties_t props = {1, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x67, 0x1a, 0xad, 0x5a, 0x35, 0x87, 0xf5, 0x0,  0x8a, 0xf3, 0x82, 0xa5, 0xaa, 0x4d,
                                     0xb8, 0x2f, 0x4f, 0x3,  0xd6, 0x24, 0xf1, 0x13, 0x93, 0x38, 0x57, 0x5a, 0x27};
  lwmqtt_string_t topic_filter_s0 = {27, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xf3, 0xfd, 0xca, 0xa7, 0xd2, 0x6,  0xfd, 0x77, 0xef, 0xf8, 0x80, 0x1f, 0xb8,
                                     0x99, 0xf2, 0x45, 0xf2, 0x84, 0xdb, 0x6e, 0x4f, 0x6b, 0xfa, 0xf2, 0x71, 0x52};
  lwmqtt_string_t topic_filter_s1 = {26, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x22};
  lwmqtt_string_t topic_filter_s2 = {1, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x55, 0x8a, 0xc1, 0xf6, 0xa2, 0x54, 0x5f, 0x1a, 0xce, 0x34};
  lwmqtt_string_t topic_filter_s3 = {10, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9a, 0x30, 0x54, 0x61, 0x76, 0xff, 0xd5, 0x31, 0x12, 0x59};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xfc, 0x3d, 0x90, 0x4f, 0x22, 0x45, 0x54, 0x44, 0x63, 0xdd, 0x82, 0xe4, 0x45,
                                     0x5f, 0x34, 0x61, 0x12, 0xfd, 0x66, 0x6e, 0xd1, 0xbb, 0x8a, 0x23, 0x33};
  lwmqtt_string_t topic_filter_s5 = {25, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x46, 0x39, 0x7,  0xe0, 0x85, 0xc9, 0xfc, 0xff, 0x97, 0xfd,
                                     0xdc, 0x4,  0x0,  0x17, 0x33, 0x6d, 0x8c, 0x6f, 0x87, 0xd7,
                                     0x6c, 0x53, 0x69, 0x8c, 0x9b, 0xf0, 0x32, 0x1,  0xd3, 0x80};
  lwmqtt_string_t topic_filter_s6 = {30, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 21743, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 11426 ["\138\251
// \SOH\190x\170(\EOT(\NUL\229\US\232\ETX\tH","\212\252_\137\222\158gd\rm\194;&w\RS\242\199\DLE\ETB\253\145\151","xD\194\160"]
// [PropTopicAliasMaximum 5217,PropCorrelationData "*\169\DC1t",PropResponseInformation
// "\ACK0\224\&8\215\163\192\132\255\DC4\226\129\\\179A+o\157~\155\SO",PropUserProperty
// "\207\166@]\175\136\DC3'\r\184\130\159\147=\249\159\211a\186\207V\CANeL\196\&4\144wj"
// "C\a~\200\&4&\133\178\237\SI\237E\NUL",PropRequestProblemInformation 9,PropResponseInformation
// "N\190\&9i\SUBs.D\233$#]\DLE\136\149\170\228\224\SI\ACK\199\140\237\160\DC4Iz",PropReasonString "\NULB\195\248
// 8\235\247z\b",PropAuthenticationData
// "\170\239G\224\203\229\161\152\160\232@oj6\152V\192>\176:^\CAN\160\SOH9\t\135\EOT",PropReasonString
// "\213\250\233\253\148\163\227\EME\ETX<c\226n\179\251Z\156\165",PropRequestProblemInformation 179,PropRetainAvailable
// 32]
TEST(Unsubscribe5QCTest, Encode16) {
  uint8_t pkt[] = {
      0xa2, 0xec, 0x1,  0x2c, 0xa2, 0xb7, 0x1,  0x22, 0x14, 0x61, 0x9,  0x0,  0x4,  0x2a, 0xa9, 0x11, 0x74, 0x1a, 0x0,
      0x15, 0x6,  0x30, 0xe0, 0x38, 0xd7, 0xa3, 0xc0, 0x84, 0xff, 0x14, 0xe2, 0x81, 0x5c, 0xb3, 0x41, 0x2b, 0x6f, 0x9d,
      0x7e, 0x9b, 0xe,  0x26, 0x0,  0x1d, 0xcf, 0xa6, 0x40, 0x5d, 0xaf, 0x88, 0x13, 0x27, 0xd,  0xb8, 0x82, 0x9f, 0x93,
      0x3d, 0xf9, 0x9f, 0xd3, 0x61, 0xba, 0xcf, 0x56, 0x18, 0x65, 0x4c, 0xc4, 0x34, 0x90, 0x77, 0x6a, 0x0,  0xd,  0x43,
      0x7,  0x7e, 0xc8, 0x34, 0x26, 0x85, 0xb2, 0xed, 0xf,  0xed, 0x45, 0x0,  0x17, 0x9,  0x1a, 0x0,  0x1b, 0x4e, 0xbe,
      0x39, 0x69, 0x1a, 0x73, 0x2e, 0x44, 0xe9, 0x24, 0x23, 0x5d, 0x10, 0x88, 0x95, 0xaa, 0xe4, 0xe0, 0xf,  0x6,  0xc7,
      0x8c, 0xed, 0xa0, 0x14, 0x49, 0x7a, 0x1f, 0x0,  0xa,  0x0,  0x42, 0xc3, 0xf8, 0x20, 0x38, 0xeb, 0xf7, 0x7a, 0x8,
      0x16, 0x0,  0x1c, 0xaa, 0xef, 0x47, 0xe0, 0xcb, 0xe5, 0xa1, 0x98, 0xa0, 0xe8, 0x40, 0x6f, 0x6a, 0x36, 0x98, 0x56,
      0xc0, 0x3e, 0xb0, 0x3a, 0x5e, 0x18, 0xa0, 0x1,  0x39, 0x9,  0x87, 0x4,  0x1f, 0x0,  0x13, 0xd5, 0xfa, 0xe9, 0xfd,
      0x94, 0xa3, 0xe3, 0x19, 0x45, 0x3,  0x3c, 0x63, 0xe2, 0x6e, 0xb3, 0xfb, 0x5a, 0x9c, 0xa5, 0x17, 0xb3, 0x25, 0x20,
      0x0,  0x11, 0x8a, 0xfb, 0x20, 0x1,  0xbe, 0x78, 0xaa, 0x28, 0x4,  0x28, 0x0,  0xe5, 0x1f, 0xe8, 0x3,  0x9,  0x48,
      0x0,  0x16, 0xd4, 0xfc, 0x5f, 0x89, 0xde, 0x9e, 0x67, 0x64, 0xd,  0x6d, 0xc2, 0x3b, 0x26, 0x77, 0x1e, 0xf2, 0xc7,
      0x10, 0x17, 0xfd, 0x91, 0x97, 0x0,  0x4,  0x78, 0x44, 0xc2, 0xa0};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2a, 0xa9, 0x11, 0x74};
  uint8_t bytesprops1[] = {0x6,  0x30, 0xe0, 0x38, 0xd7, 0xa3, 0xc0, 0x84, 0xff, 0x14, 0xe2,
                           0x81, 0x5c, 0xb3, 0x41, 0x2b, 0x6f, 0x9d, 0x7e, 0x9b, 0xe};
  uint8_t bytesprops3[] = {0x43, 0x7, 0x7e, 0xc8, 0x34, 0x26, 0x85, 0xb2, 0xed, 0xf, 0xed, 0x45, 0x0};
  uint8_t bytesprops2[] = {0xcf, 0xa6, 0x40, 0x5d, 0xaf, 0x88, 0x13, 0x27, 0xd,  0xb8, 0x82, 0x9f, 0x93, 0x3d, 0xf9,
                           0x9f, 0xd3, 0x61, 0xba, 0xcf, 0x56, 0x18, 0x65, 0x4c, 0xc4, 0x34, 0x90, 0x77, 0x6a};
  uint8_t bytesprops4[] = {0x4e, 0xbe, 0x39, 0x69, 0x1a, 0x73, 0x2e, 0x44, 0xe9, 0x24, 0x23, 0x5d, 0x10, 0x88,
                           0x95, 0xaa, 0xe4, 0xe0, 0xf,  0x6,  0xc7, 0x8c, 0xed, 0xa0, 0x14, 0x49, 0x7a};
  uint8_t bytesprops5[] = {0x0, 0x42, 0xc3, 0xf8, 0x20, 0x38, 0xeb, 0xf7, 0x7a, 0x8};
  uint8_t bytesprops6[] = {0xaa, 0xef, 0x47, 0xe0, 0xcb, 0xe5, 0xa1, 0x98, 0xa0, 0xe8, 0x40, 0x6f, 0x6a, 0x36,
                           0x98, 0x56, 0xc0, 0x3e, 0xb0, 0x3a, 0x5e, 0x18, 0xa0, 0x1,  0x39, 0x9,  0x87, 0x4};
  uint8_t bytesprops7[] = {0xd5, 0xfa, 0xe9, 0xfd, 0x94, 0xa3, 0xe3, 0x19, 0x45, 0x3,
                           0x3c, 0x63, 0xe2, 0x6e, 0xb3, 0xfb, 0x5a, 0x9c, 0xa5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 5217}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops2}, .v = {13, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {19, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 32}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x8a, 0xfb, 0x20, 0x1,  0xbe, 0x78, 0xaa, 0x28, 0x4,
                                     0x28, 0x0,  0xe5, 0x1f, 0xe8, 0x3,  0x9,  0x48};
  lwmqtt_string_t topic_filter_s0 = {17, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xd4, 0xfc, 0x5f, 0x89, 0xde, 0x9e, 0x67, 0x64, 0xd,  0x6d, 0xc2,
                                     0x3b, 0x26, 0x77, 0x1e, 0xf2, 0xc7, 0x10, 0x17, 0xfd, 0x91, 0x97};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x78, 0x44, 0xc2, 0xa0};
  lwmqtt_string_t topic_filter_s2 = {4, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 11426, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5841 ["yh\251\169","\178\SI\146G\210\133v\153\f\143T\188\187c\SI\227\n\n\NAK*fTRl\205M\224c!","
// \161\vU\242\SYN:\224","\182o_\213\131\253HkX>\245{\190qc\163\162EH\NUL\a\ENQh","`\198\220\GSG6\209Q\236\251;","\139Hp\135\199d\160+"]
// [PropResponseInformation
// "@t\NAK\239I\255T\NUL\234u$\b\162Xh\204\159\214:M\231\v\230\189\165$#",PropRequestResponseInformation
// 103,PropAuthenticationData "",PropResponseInformation "\DC4@UB\147\206\239\156`\231\137\bx",PropResponseTopic
// "\204n\229\a\ENQ\177]\226`\EM\209\&8\219u",PropAuthenticationMethod
// "0\232\179\185F\201\b\DLE\180\224z>\157L\226\141\226:h)\216\245\201\235\241|d1",PropResponseTopic
// "\220\223\128\&4\223\222^\193:_W\143G\140\154\SUBD\163",PropContentType
// "9\158\RS\202\251\FS)\132K]\217T\182a\131\217\CAN\185x",PropAuthenticationMethod
// "\220\132\182k\146\240\191\250R\149\168/$\157\216\&4;P\138\250",PropSessionExpiryInterval 17187,PropCorrelationData
// "\131\141\235\238\130w\236\ACKcQ5\166\135\134\160",PropContentType "p\155\&8\149\SO\181",PropUserProperty "Z8\b\234"
// "\161\249\241-\v\156\ESC",PropSubscriptionIdentifier 29,PropReceiveMaximum 23266,PropMaximumPacketSize
// 3356,PropTopicAliasMaximum 7145,PropResponseTopic "\221\244\SUB\SIC\210\165A\DC1\217\143(hW",PropServerKeepAlive
// 502,PropServerKeepAlive 3960,PropWillDelayInterval 1206,PropUserProperty ""
// "x\172\ESCf#\252\234\251\&3\185\211\f\130\244\247",PropAssignedClientIdentifier "",PropSessionExpiryInterval
// 29118,PropResponseInformation
// "\ETBq\221\176v\b\252\146\181\210\171\197\170\242W\247\188\181\SO\180\241\221\ETX",PropRetainAvailable
// 134,PropRequestProblemInformation 51,PropSharedSubscriptionAvailable 51,PropRetainAvailable 129,PropResponseTopic
// "\216\SI\236\&1\204\139\168T\138_\141 l\236\183f\250\135\248!ua\DC2\EM\245"]
TEST(Unsubscribe5QCTest, Encode17) {
  uint8_t pkt[] = {
      0xa2, 0xbb, 0x3,  0x16, 0xd1, 0xd8, 0x2,  0x1a, 0x0,  0x1b, 0x40, 0x74, 0x15, 0xef, 0x49, 0xff, 0x54, 0x0,  0xea,
      0x75, 0x24, 0x8,  0xa2, 0x58, 0x68, 0xcc, 0x9f, 0xd6, 0x3a, 0x4d, 0xe7, 0xb,  0xe6, 0xbd, 0xa5, 0x24, 0x23, 0x19,
      0x67, 0x16, 0x0,  0x0,  0x1a, 0x0,  0xd,  0x14, 0x40, 0x55, 0x42, 0x93, 0xce, 0xef, 0x9c, 0x60, 0xe7, 0x89, 0x8,
      0x78, 0x8,  0x0,  0xe,  0xcc, 0x6e, 0xe5, 0x7,  0x5,  0xb1, 0x5d, 0xe2, 0x60, 0x19, 0xd1, 0x38, 0xdb, 0x75, 0x15,
      0x0,  0x1c, 0x30, 0xe8, 0xb3, 0xb9, 0x46, 0xc9, 0x8,  0x10, 0xb4, 0xe0, 0x7a, 0x3e, 0x9d, 0x4c, 0xe2, 0x8d, 0xe2,
      0x3a, 0x68, 0x29, 0xd8, 0xf5, 0xc9, 0xeb, 0xf1, 0x7c, 0x64, 0x31, 0x8,  0x0,  0x12, 0xdc, 0xdf, 0x80, 0x34, 0xdf,
      0xde, 0x5e, 0xc1, 0x3a, 0x5f, 0x57, 0x8f, 0x47, 0x8c, 0x9a, 0x1a, 0x44, 0xa3, 0x3,  0x0,  0x13, 0x39, 0x9e, 0x1e,
      0xca, 0xfb, 0x1c, 0x29, 0x84, 0x4b, 0x5d, 0xd9, 0x54, 0xb6, 0x61, 0x83, 0xd9, 0x18, 0xb9, 0x78, 0x15, 0x0,  0x14,
      0xdc, 0x84, 0xb6, 0x6b, 0x92, 0xf0, 0xbf, 0xfa, 0x52, 0x95, 0xa8, 0x2f, 0x24, 0x9d, 0xd8, 0x34, 0x3b, 0x50, 0x8a,
      0xfa, 0x11, 0x0,  0x0,  0x43, 0x23, 0x9,  0x0,  0xf,  0x83, 0x8d, 0xeb, 0xee, 0x82, 0x77, 0xec, 0x6,  0x63, 0x51,
      0x35, 0xa6, 0x87, 0x86, 0xa0, 0x3,  0x0,  0x6,  0x70, 0x9b, 0x38, 0x95, 0xe,  0xb5, 0x26, 0x0,  0x4,  0x5a, 0x38,
      0x8,  0xea, 0x0,  0x7,  0xa1, 0xf9, 0xf1, 0x2d, 0xb,  0x9c, 0x1b, 0xb,  0x1d, 0x21, 0x5a, 0xe2, 0x27, 0x0,  0x0,
      0xd,  0x1c, 0x22, 0x1b, 0xe9, 0x8,  0x0,  0xe,  0xdd, 0xf4, 0x1a, 0xf,  0x43, 0xd2, 0xa5, 0x41, 0x11, 0xd9, 0x8f,
      0x28, 0x68, 0x57, 0x13, 0x1,  0xf6, 0x13, 0xf,  0x78, 0x18, 0x0,  0x0,  0x4,  0xb6, 0x26, 0x0,  0x0,  0x0,  0xf,
      0x78, 0xac, 0x1b, 0x66, 0x23, 0xfc, 0xea, 0xfb, 0x33, 0xb9, 0xd3, 0xc,  0x82, 0xf4, 0xf7, 0x12, 0x0,  0x0,  0x11,
      0x0,  0x0,  0x71, 0xbe, 0x1a, 0x0,  0x17, 0x17, 0x71, 0xdd, 0xb0, 0x76, 0x8,  0xfc, 0x92, 0xb5, 0xd2, 0xab, 0xc5,
      0xaa, 0xf2, 0x57, 0xf7, 0xbc, 0xb5, 0xe,  0xb4, 0xf1, 0xdd, 0x3,  0x25, 0x86, 0x17, 0x33, 0x2a, 0x33, 0x25, 0x81,
      0x8,  0x0,  0x19, 0xd8, 0xf,  0xec, 0x31, 0xcc, 0x8b, 0xa8, 0x54, 0x8a, 0x5f, 0x8d, 0x20, 0x6c, 0xec, 0xb7, 0x66,
      0xfa, 0x87, 0xf8, 0x21, 0x75, 0x61, 0x12, 0x19, 0xf5, 0x0,  0x4,  0x79, 0x68, 0xfb, 0xa9, 0x0,  0x1d, 0xb2, 0xf,
      0x92, 0x47, 0xd2, 0x85, 0x76, 0x99, 0xc,  0x8f, 0x54, 0xbc, 0xbb, 0x63, 0xf,  0xe3, 0xa,  0xa,  0x15, 0x2a, 0x66,
      0x54, 0x52, 0x6c, 0xcd, 0x4d, 0xe0, 0x63, 0x21, 0x0,  0x8,  0x20, 0xa1, 0xb,  0x55, 0xf2, 0x16, 0x3a, 0xe0, 0x0,
      0x17, 0xb6, 0x6f, 0x5f, 0xd5, 0x83, 0xfd, 0x48, 0x6b, 0x58, 0x3e, 0xf5, 0x7b, 0xbe, 0x71, 0x63, 0xa3, 0xa2, 0x45,
      0x48, 0x0,  0x7,  0x5,  0x68, 0x0,  0xb,  0x60, 0xc6, 0xdc, 0x1d, 0x47, 0x36, 0xd1, 0x51, 0xec, 0xfb, 0x3b, 0x0,
      0x8,  0x8b, 0x48, 0x70, 0x87, 0xc7, 0x64, 0xa0, 0x2b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x40, 0x74, 0x15, 0xef, 0x49, 0xff, 0x54, 0x0, 0xea, 0x75, 0x24, 0x8,  0xa2, 0x58,
                           0x68, 0xcc, 0x9f, 0xd6, 0x3a, 0x4d, 0xe7, 0xb, 0xe6, 0xbd, 0xa5, 0x24, 0x23};
  uint8_t bytesprops1[] = {0};
  uint8_t bytesprops2[] = {0x14, 0x40, 0x55, 0x42, 0x93, 0xce, 0xef, 0x9c, 0x60, 0xe7, 0x89, 0x8, 0x78};
  uint8_t bytesprops3[] = {0xcc, 0x6e, 0xe5, 0x7, 0x5, 0xb1, 0x5d, 0xe2, 0x60, 0x19, 0xd1, 0x38, 0xdb, 0x75};
  uint8_t bytesprops4[] = {0x30, 0xe8, 0xb3, 0xb9, 0x46, 0xc9, 0x8,  0x10, 0xb4, 0xe0, 0x7a, 0x3e, 0x9d, 0x4c,
                           0xe2, 0x8d, 0xe2, 0x3a, 0x68, 0x29, 0xd8, 0xf5, 0xc9, 0xeb, 0xf1, 0x7c, 0x64, 0x31};
  uint8_t bytesprops5[] = {0xdc, 0xdf, 0x80, 0x34, 0xdf, 0xde, 0x5e, 0xc1, 0x3a,
                           0x5f, 0x57, 0x8f, 0x47, 0x8c, 0x9a, 0x1a, 0x44, 0xa3};
  uint8_t bytesprops6[] = {0x39, 0x9e, 0x1e, 0xca, 0xfb, 0x1c, 0x29, 0x84, 0x4b, 0x5d,
                           0xd9, 0x54, 0xb6, 0x61, 0x83, 0xd9, 0x18, 0xb9, 0x78};
  uint8_t bytesprops7[] = {0xdc, 0x84, 0xb6, 0x6b, 0x92, 0xf0, 0xbf, 0xfa, 0x52, 0x95,
                           0xa8, 0x2f, 0x24, 0x9d, 0xd8, 0x34, 0x3b, 0x50, 0x8a, 0xfa};
  uint8_t bytesprops8[] = {0x83, 0x8d, 0xeb, 0xee, 0x82, 0x77, 0xec, 0x6, 0x63, 0x51, 0x35, 0xa6, 0x87, 0x86, 0xa0};
  uint8_t bytesprops9[] = {0x70, 0x9b, 0x38, 0x95, 0xe, 0xb5};
  uint8_t bytesprops11[] = {0xa1, 0xf9, 0xf1, 0x2d, 0xb, 0x9c, 0x1b};
  uint8_t bytesprops10[] = {0x5a, 0x38, 0x8, 0xea};
  uint8_t bytesprops12[] = {0xdd, 0xf4, 0x1a, 0xf, 0x43, 0xd2, 0xa5, 0x41, 0x11, 0xd9, 0x8f, 0x28, 0x68, 0x57};
  uint8_t bytesprops14[] = {0x78, 0xac, 0x1b, 0x66, 0x23, 0xfc, 0xea, 0xfb, 0x33, 0xb9, 0xd3, 0xc, 0x82, 0xf4, 0xf7};
  uint8_t bytesprops13[] = {0};
  uint8_t bytesprops15[] = {0};
  uint8_t bytesprops16[] = {0x17, 0x71, 0xdd, 0xb0, 0x76, 0x8,  0xfc, 0x92, 0xb5, 0xd2, 0xab, 0xc5,
                            0xaa, 0xf2, 0x57, 0xf7, 0xbc, 0xb5, 0xe,  0xb4, 0xf1, 0xdd, 0x3};
  uint8_t bytesprops17[] = {0xd8, 0xf,  0xec, 0x31, 0xcc, 0x8b, 0xa8, 0x54, 0x8a, 0x5f, 0x8d, 0x20, 0x6c,
                            0xec, 0xb7, 0x66, 0xfa, 0x87, 0xf8, 0x21, 0x75, 0x61, 0x12, 0x19, 0xf5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {0, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {19, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {20, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 17187}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {4, (char*)&bytesprops10}, .v = {7, (char*)&bytesprops11}}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 23266}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3356}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7145}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 502}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 3960}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1206}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops13}, .v = {15, (char*)&bytesprops14}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops15}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29118}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops16}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 134}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 51}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 129}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops17}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[6];
  uint8_t topic_filter_s0_bytes[] = {0x79, 0x68, 0xfb, 0xa9};
  lwmqtt_string_t topic_filter_s0 = {4, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xb2, 0xf,  0x92, 0x47, 0xd2, 0x85, 0x76, 0x99, 0xc,  0x8f,
                                     0x54, 0xbc, 0xbb, 0x63, 0xf,  0xe3, 0xa,  0xa,  0x15, 0x2a,
                                     0x66, 0x54, 0x52, 0x6c, 0xcd, 0x4d, 0xe0, 0x63, 0x21};
  lwmqtt_string_t topic_filter_s1 = {29, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x20, 0xa1, 0xb, 0x55, 0xf2, 0x16, 0x3a, 0xe0};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xb6, 0x6f, 0x5f, 0xd5, 0x83, 0xfd, 0x48, 0x6b, 0x58, 0x3e, 0xf5, 0x7b,
                                     0xbe, 0x71, 0x63, 0xa3, 0xa2, 0x45, 0x48, 0x0,  0x7,  0x5,  0x68};
  lwmqtt_string_t topic_filter_s3 = {23, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x60, 0xc6, 0xdc, 0x1d, 0x47, 0x36, 0xd1, 0x51, 0xec, 0xfb, 0x3b};
  lwmqtt_string_t topic_filter_s4 = {11, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x8b, 0x48, 0x70, 0x87, 0xc7, 0x64, 0xa0, 0x2b};
  lwmqtt_string_t topic_filter_s5 = {8, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5841, 6, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 26803
// ["h\b\248\219\SI\197\167\148#\226\147\153}","f\166\188I8\138","o\166\FS\210\138\156\166\234\SUB:%\155N\154\226\132\233E"]
// [PropResponseInformation "\USvE\182\163\248k\DC3
// \221\254\232\167\186\181Y\155\173X\209\242\132t",PropMessageExpiryInterval 20360,PropMaximumPacketSize
// 13975,PropAuthenticationData
// "q\RS\SOH'\SYN\132j1\245\141\&4r\173\&9k\251f\DC2\233\238*\222\130o\194\203\EOTb",PropContentType
// "e)\148BfT6\DEL\181a\DC2\SYN\145",PropPayloadFormatIndicator 174,PropReasonString "\DLE\223\169\189\162Q\128\ENQ\154
// |\226qCj\186\253`\222@\128\a \236",PropMaximumQoS 65,PropSubscriptionIdentifierAvailable
// 221,PropPayloadFormatIndicator 174,PropMaximumQoS 100,PropRequestResponseInformation 162,PropUserProperty
// "(\167\172\a\NAK\209\206\166\225nR{\130\177\146ZP\252l\SYN\a\251\164\146" "\241\US\"",PropSharedSubscriptionAvailable
// 34,PropRetainAvailable 89]
TEST(Unsubscribe5QCTest, Encode18) {
  uint8_t pkt[] = {
      0xa2, 0xcd, 0x1,  0x68, 0xb3, 0x9e, 0x1,  0x1a, 0x0,  0x17, 0x1f, 0x76, 0x45, 0xb6, 0xa3, 0xf8, 0x6b, 0x13, 0x20,
      0xdd, 0xfe, 0xe8, 0xa7, 0xba, 0xb5, 0x59, 0x9b, 0xad, 0x58, 0xd1, 0xf2, 0x84, 0x74, 0x2,  0x0,  0x0,  0x4f, 0x88,
      0x27, 0x0,  0x0,  0x36, 0x97, 0x16, 0x0,  0x1c, 0x71, 0x1e, 0x1,  0x27, 0x16, 0x84, 0x6a, 0x31, 0xf5, 0x8d, 0x34,
      0x72, 0xad, 0x39, 0x6b, 0xfb, 0x66, 0x12, 0xe9, 0xee, 0x2a, 0xde, 0x82, 0x6f, 0xc2, 0xcb, 0x4,  0x62, 0x3,  0x0,
      0xd,  0x65, 0x29, 0x94, 0x42, 0x66, 0x54, 0x36, 0x7f, 0xb5, 0x61, 0x12, 0x16, 0x91, 0x1,  0xae, 0x1f, 0x0,  0x18,
      0x10, 0xdf, 0xa9, 0xbd, 0xa2, 0x51, 0x80, 0x5,  0x9a, 0x20, 0x7c, 0xe2, 0x71, 0x43, 0x6a, 0xba, 0xfd, 0x60, 0xde,
      0x40, 0x80, 0x7,  0x20, 0xec, 0x24, 0x41, 0x29, 0xdd, 0x1,  0xae, 0x24, 0x64, 0x19, 0xa2, 0x26, 0x0,  0x18, 0x28,
      0xa7, 0xac, 0x7,  0x15, 0xd1, 0xce, 0xa6, 0xe1, 0x6e, 0x52, 0x7b, 0x82, 0xb1, 0x92, 0x5a, 0x50, 0xfc, 0x6c, 0x16,
      0x7,  0xfb, 0xa4, 0x92, 0x0,  0x3,  0xf1, 0x1f, 0x22, 0x2a, 0x22, 0x25, 0x59, 0x0,  0xd,  0x68, 0x8,  0xf8, 0xdb,
      0xf,  0xc5, 0xa7, 0x94, 0x23, 0xe2, 0x93, 0x99, 0x7d, 0x0,  0x6,  0x66, 0xa6, 0xbc, 0x49, 0x38, 0x8a, 0x0,  0x12,
      0x6f, 0xa6, 0x1c, 0xd2, 0x8a, 0x9c, 0xa6, 0xea, 0x1a, 0x3a, 0x25, 0x9b, 0x4e, 0x9a, 0xe2, 0x84, 0xe9, 0x45};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x1f, 0x76, 0x45, 0xb6, 0xa3, 0xf8, 0x6b, 0x13, 0x20, 0xdd, 0xfe, 0xe8,
                           0xa7, 0xba, 0xb5, 0x59, 0x9b, 0xad, 0x58, 0xd1, 0xf2, 0x84, 0x74};
  uint8_t bytesprops1[] = {0x71, 0x1e, 0x1,  0x27, 0x16, 0x84, 0x6a, 0x31, 0xf5, 0x8d, 0x34, 0x72, 0xad, 0x39,
                           0x6b, 0xfb, 0x66, 0x12, 0xe9, 0xee, 0x2a, 0xde, 0x82, 0x6f, 0xc2, 0xcb, 0x4,  0x62};
  uint8_t bytesprops2[] = {0x65, 0x29, 0x94, 0x42, 0x66, 0x54, 0x36, 0x7f, 0xb5, 0x61, 0x12, 0x16, 0x91};
  uint8_t bytesprops3[] = {0x10, 0xdf, 0xa9, 0xbd, 0xa2, 0x51, 0x80, 0x5,  0x9a, 0x20, 0x7c, 0xe2,
                           0x71, 0x43, 0x6a, 0xba, 0xfd, 0x60, 0xde, 0x40, 0x80, 0x7,  0x20, 0xec};
  uint8_t bytesprops5[] = {0xf1, 0x1f, 0x22};
  uint8_t bytesprops4[] = {0x28, 0xa7, 0xac, 0x7,  0x15, 0xd1, 0xce, 0xa6, 0xe1, 0x6e, 0x52, 0x7b,
                           0x82, 0xb1, 0x92, 0x5a, 0x50, 0xfc, 0x6c, 0x16, 0x7,  0xfb, 0xa4, 0x92};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {23, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20360}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 13975}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {13, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 221}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 100}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 162}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {24, (char*)&bytesprops4}, .v = {3, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 34}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 89}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[3];
  uint8_t topic_filter_s0_bytes[] = {0x68, 0x8, 0xf8, 0xdb, 0xf, 0xc5, 0xa7, 0x94, 0x23, 0xe2, 0x93, 0x99, 0x7d};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x66, 0xa6, 0xbc, 0x49, 0x38, 0x8a};
  lwmqtt_string_t topic_filter_s1 = {6, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6f, 0xa6, 0x1c, 0xd2, 0x8a, 0x9c, 0xa6, 0xea, 0x1a,
                                     0x3a, 0x25, 0x9b, 0x4e, 0x9a, 0xe2, 0x84, 0xe9, 0x45};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 26803, 3, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22595 ["","r3\FS\a(<\131w\CAN\204\229"] [PropMessageExpiryInterval 9208,PropMaximumQoS
// 227,PropTopicAliasMaximum 25061,PropTopicAliasMaximum 9521,PropWillDelayInterval
// 19511,PropSharedSubscriptionAvailable 152,PropServerReference
// "\233u\f\131\237\DC2\DC4\128\\\185\187R\218_\155t\ENQ\STX\140",PropMaximumPacketSize 4920,PropPayloadFormatIndicator
// 17,PropResponseInformation "\US\186a",PropTopicAlias 2483,PropMaximumPacketSize 139,PropCorrelationData
// "\t\FS\222\252",PropTopicAliasMaximum 602,PropSubscriptionIdentifierAvailable 119,PropWillDelayInterval
// 22699,PropRetainAvailable 215]
TEST(Unsubscribe5QCTest, Encode19) {
  uint8_t pkt[] = {0xa2, 0x64, 0x58, 0x43, 0x52, 0x2,  0x0,  0x0,  0x23, 0xf8, 0x24, 0xe3, 0x22, 0x61, 0xe5,
                   0x22, 0x25, 0x31, 0x18, 0x0,  0x0,  0x4c, 0x37, 0x2a, 0x98, 0x1c, 0x0,  0x13, 0xe9, 0x75,
                   0xc,  0x83, 0xed, 0x12, 0x14, 0x80, 0x5c, 0xb9, 0xbb, 0x52, 0xda, 0x5f, 0x9b, 0x74, 0x5,
                   0x2,  0x8c, 0x27, 0x0,  0x0,  0x13, 0x38, 0x1,  0x11, 0x1a, 0x0,  0x3,  0x1f, 0xba, 0x61,
                   0x23, 0x9,  0xb3, 0x27, 0x0,  0x0,  0x0,  0x8b, 0x9,  0x0,  0x4,  0x9,  0x1c, 0xde, 0xfc,
                   0x22, 0x2,  0x5a, 0x29, 0x77, 0x18, 0x0,  0x0,  0x58, 0xab, 0x25, 0xd7, 0x0,  0x0,  0x0,
                   0xb,  0x72, 0x33, 0x1c, 0x7,  0x28, 0x3c, 0x83, 0x77, 0x18, 0xcc, 0xe5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe9, 0x75, 0xc,  0x83, 0xed, 0x12, 0x14, 0x80, 0x5c, 0xb9,
                           0xbb, 0x52, 0xda, 0x5f, 0x9b, 0x74, 0x5,  0x2,  0x8c};
  uint8_t bytesprops1[] = {0x1f, 0xba, 0x61};
  uint8_t bytesprops2[] = {0x9, 0x1c, 0xde, 0xfc};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9208}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 227}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 25061}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 9521}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19511}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 152}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 4920}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 17}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2483}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 139}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {4, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 602}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22699}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 215}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[2];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x72, 0x33, 0x1c, 0x7, 0x28, 0x3c, 0x83, 0x77, 0x18, 0xcc, 0xe5};
  lwmqtt_string_t topic_filter_s1 = {11, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22595, 2, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 907
// ["\141\FS\ETX\162\204'\133\DLE7\237\140\\w>\252:\aS\161s\SI\179:\248\150E","*,\176\143\254R\241\242\DLE\173a.\225\151\159I:\161","\\X$\251\237\251W\215P\a\133A\163\145\225D\SYN^\163\bf\237\174\STX\141\230\189w\161\162","\217\182-\169\169\173\191Hx@\206Qi\188\231\210D\165\NUL\165\ENQ\220\232\224\226>"]
// [PropCorrelationData "\DC2D\234\t\n\241\140\244[^/\203\222\202^SSp\220\226\158(",PropMessageExpiryInterval
// 2595,PropRetainAvailable 14,PropMaximumPacketSize 149,PropServerKeepAlive 19177,PropReceiveMaximum
// 32247,PropWillDelayInterval 22627,PropUserProperty ""
// "\200\226\240\205\DEL\190{\DC2\132(s\ETB",PropMessageExpiryInterval 1055]
TEST(Unsubscribe5QCTest, Encode20) {
  uint8_t pkt[] = {0xa2, 0xb5, 0x1,  0x3,  0x8b, 0x46, 0x9,  0x0,  0x16, 0x12, 0x44, 0xea, 0x9,  0xa,  0xf1, 0x8c, 0xf4,
                   0x5b, 0x5e, 0x2f, 0xcb, 0xde, 0xca, 0x5e, 0x53, 0x53, 0x70, 0xdc, 0xe2, 0x9e, 0x28, 0x2,  0x0,  0x0,
                   0xa,  0x23, 0x25, 0xe,  0x27, 0x0,  0x0,  0x0,  0x95, 0x13, 0x4a, 0xe9, 0x21, 0x7d, 0xf7, 0x18, 0x0,
                   0x0,  0x58, 0x63, 0x26, 0x0,  0x0,  0x0,  0xc,  0xc8, 0xe2, 0xf0, 0xcd, 0x7f, 0xbe, 0x7b, 0x12, 0x84,
                   0x28, 0x73, 0x17, 0x2,  0x0,  0x0,  0x4,  0x1f, 0x0,  0x1a, 0x8d, 0x1c, 0x3,  0xa2, 0xcc, 0x27, 0x85,
                   0x10, 0x37, 0xed, 0x8c, 0x5c, 0x77, 0x3e, 0xfc, 0x3a, 0x7,  0x53, 0xa1, 0x73, 0xf,  0xb3, 0x3a, 0xf8,
                   0x96, 0x45, 0x0,  0x12, 0x2a, 0x2c, 0xb0, 0x8f, 0xfe, 0x52, 0xf1, 0xf2, 0x10, 0xad, 0x61, 0x2e, 0xe1,
                   0x97, 0x9f, 0x49, 0x3a, 0xa1, 0x0,  0x1e, 0x5c, 0x58, 0x24, 0xfb, 0xed, 0xfb, 0x57, 0xd7, 0x50, 0x7,
                   0x85, 0x41, 0xa3, 0x91, 0xe1, 0x44, 0x16, 0x5e, 0xa3, 0x8,  0x66, 0xed, 0xae, 0x2,  0x8d, 0xe6, 0xbd,
                   0x77, 0xa1, 0xa2, 0x0,  0x1a, 0xd9, 0xb6, 0x2d, 0xa9, 0xa9, 0xad, 0xbf, 0x48, 0x78, 0x40, 0xce, 0x51,
                   0x69, 0xbc, 0xe7, 0xd2, 0x44, 0xa5, 0x0,  0xa5, 0x5,  0xdc, 0xe8, 0xe0, 0xe2, 0x3e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x12, 0x44, 0xea, 0x9,  0xa,  0xf1, 0x8c, 0xf4, 0x5b, 0x5e, 0x2f,
                           0xcb, 0xde, 0xca, 0x5e, 0x53, 0x53, 0x70, 0xdc, 0xe2, 0x9e, 0x28};
  uint8_t bytesprops2[] = {0xc8, 0xe2, 0xf0, 0xcd, 0x7f, 0xbe, 0x7b, 0x12, 0x84, 0x28, 0x73, 0x17};
  uint8_t bytesprops1[] = {0};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2595}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 149}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 19177}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 32247}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 22627}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {0, (char*)&bytesprops1}, .v = {12, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1055}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0x8d, 0x1c, 0x3,  0xa2, 0xcc, 0x27, 0x85, 0x10, 0x37, 0xed, 0x8c, 0x5c, 0x77,
                                     0x3e, 0xfc, 0x3a, 0x7,  0x53, 0xa1, 0x73, 0xf,  0xb3, 0x3a, 0xf8, 0x96, 0x45};
  lwmqtt_string_t topic_filter_s0 = {26, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x2a, 0x2c, 0xb0, 0x8f, 0xfe, 0x52, 0xf1, 0xf2, 0x10,
                                     0xad, 0x61, 0x2e, 0xe1, 0x97, 0x9f, 0x49, 0x3a, 0xa1};
  lwmqtt_string_t topic_filter_s1 = {18, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x5c, 0x58, 0x24, 0xfb, 0xed, 0xfb, 0x57, 0xd7, 0x50, 0x7,
                                     0x85, 0x41, 0xa3, 0x91, 0xe1, 0x44, 0x16, 0x5e, 0xa3, 0x8,
                                     0x66, 0xed, 0xae, 0x2,  0x8d, 0xe6, 0xbd, 0x77, 0xa1, 0xa2};
  lwmqtt_string_t topic_filter_s2 = {30, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xd9, 0xb6, 0x2d, 0xa9, 0xa9, 0xad, 0xbf, 0x48, 0x78, 0x40, 0xce, 0x51, 0x69,
                                     0xbc, 0xe7, 0xd2, 0x44, 0xa5, 0x0,  0xa5, 0x5,  0xdc, 0xe8, 0xe0, 0xe2, 0x3e};
  lwmqtt_string_t topic_filter_s3 = {26, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 907, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 24572
// ["\209r2\129\173f\255\143\237!\188m\134\&4#\167\156\211[@D\181\SO\161\210\n\235\&4","\133\164\149\&5\205\251\223","Bf.\183r\147H\252","/\130V\141\130\200\131\248\b\162Eb\DC2\EM\202r\182\251\FSKJ\186"]
// [PropCorrelationData
// "\205^\EM\241I\ACKH\152ni\249\224\&1\DC1\157\142>\149\218\&2\226\242\166\DLEL\141\217\158k?",PropCorrelationData
// "\"O\248\226\189\164\192",PropSessionExpiryInterval 43,PropServerReference "z\214\130",PropReasonString
// "b~3\ETX!Z\252\198\128\181#\243\202",PropMessageExpiryInterval 6944,PropRetainAvailable
// 127,PropSharedSubscriptionAvailable 183,PropAuthenticationMethod "\232\t\139\253!",PropContentType
// "\176\184#\GStZ$>\185Bk\175\183\RSb\DC3\235\204",PropPayloadFormatIndicator 239,PropSubscriptionIdentifier
// 3,PropRequestResponseInformation 209,PropServerReference "",PropSubscriptionIdentifier 17,PropSubscriptionIdentifier
// 4,PropServerKeepAlive 29028,PropRequestResponseInformation 90,PropMessageExpiryInterval 28968,PropRetainAvailable
// 43,PropResponseTopic "\141Mv\160\SOH\197|\226\136\&9Om)\176:\205\v]",PropAuthenticationData
// "\n\237\EOTp\SYN\195\158\155\171\230\t\226>\245N\249\191F\ETX\252\203Y\224C\229S",PropAuthenticationMethod
// "\135\166\CAN0\128\159\188\244\DC4-\130\191\173\188\225y\225\141\129S0\a\201D\231\159\222",PropTopicAlias
// 21823,PropWildcardSubscriptionAvailable 248,PropUserProperty "t\193\234\184\SYNi\DEL\147\ACK" "z\212#\175\144~\n"]
TEST(Unsubscribe5QCTest, Encode21) {
  uint8_t pkt[] = {
      0xa2, 0xbc, 0x2,  0x5f, 0xfc, 0xef, 0x1,  0x9,  0x0,  0x1e, 0xcd, 0x5e, 0x19, 0xf1, 0x49, 0x6,  0x48, 0x98, 0x6e,
      0x69, 0xf9, 0xe0, 0x31, 0x11, 0x9d, 0x8e, 0x3e, 0x95, 0xda, 0x32, 0xe2, 0xf2, 0xa6, 0x10, 0x4c, 0x8d, 0xd9, 0x9e,
      0x6b, 0x3f, 0x9,  0x0,  0x7,  0x22, 0x4f, 0xf8, 0xe2, 0xbd, 0xa4, 0xc0, 0x11, 0x0,  0x0,  0x0,  0x2b, 0x1c, 0x0,
      0x3,  0x7a, 0xd6, 0x82, 0x1f, 0x0,  0xd,  0x62, 0x7e, 0x33, 0x3,  0x21, 0x5a, 0xfc, 0xc6, 0x80, 0xb5, 0x23, 0xf3,
      0xca, 0x2,  0x0,  0x0,  0x1b, 0x20, 0x25, 0x7f, 0x2a, 0xb7, 0x15, 0x0,  0x5,  0xe8, 0x9,  0x8b, 0xfd, 0x21, 0x3,
      0x0,  0x12, 0xb0, 0xb8, 0x23, 0x1d, 0x74, 0x5a, 0x24, 0x3e, 0xb9, 0x42, 0x6b, 0xaf, 0xb7, 0x1e, 0x62, 0x13, 0xeb,
      0xcc, 0x1,  0xef, 0xb,  0x3,  0x19, 0xd1, 0x1c, 0x0,  0x0,  0xb,  0x11, 0xb,  0x4,  0x13, 0x71, 0x64, 0x19, 0x5a,
      0x2,  0x0,  0x0,  0x71, 0x28, 0x25, 0x2b, 0x8,  0x0,  0x12, 0x8d, 0x4d, 0x76, 0xa0, 0x1,  0xc5, 0x7c, 0xe2, 0x88,
      0x39, 0x4f, 0x6d, 0x29, 0xb0, 0x3a, 0xcd, 0xb,  0x5d, 0x16, 0x0,  0x1a, 0xa,  0xed, 0x4,  0x70, 0x16, 0xc3, 0x9e,
      0x9b, 0xab, 0xe6, 0x9,  0xe2, 0x3e, 0xf5, 0x4e, 0xf9, 0xbf, 0x46, 0x3,  0xfc, 0xcb, 0x59, 0xe0, 0x43, 0xe5, 0x53,
      0x15, 0x0,  0x1b, 0x87, 0xa6, 0x18, 0x30, 0x80, 0x9f, 0xbc, 0xf4, 0x14, 0x2d, 0x82, 0xbf, 0xad, 0xbc, 0xe1, 0x79,
      0xe1, 0x8d, 0x81, 0x53, 0x30, 0x7,  0xc9, 0x44, 0xe7, 0x9f, 0xde, 0x23, 0x55, 0x3f, 0x28, 0xf8, 0x26, 0x0,  0x9,
      0x74, 0xc1, 0xea, 0xb8, 0x16, 0x69, 0x7f, 0x93, 0x6,  0x0,  0x7,  0x7a, 0xd4, 0x23, 0xaf, 0x90, 0x7e, 0xa,  0x0,
      0x1c, 0xd1, 0x72, 0x32, 0x81, 0xad, 0x66, 0xff, 0x8f, 0xed, 0x21, 0xbc, 0x6d, 0x86, 0x34, 0x23, 0xa7, 0x9c, 0xd3,
      0x5b, 0x40, 0x44, 0xb5, 0xe,  0xa1, 0xd2, 0xa,  0xeb, 0x34, 0x0,  0x7,  0x85, 0xa4, 0x95, 0x35, 0xcd, 0xfb, 0xdf,
      0x0,  0x8,  0x42, 0x66, 0x2e, 0xb7, 0x72, 0x93, 0x48, 0xfc, 0x0,  0x16, 0x2f, 0x82, 0x56, 0x8d, 0x82, 0xc8, 0x83,
      0xf8, 0x8,  0xa2, 0x45, 0x62, 0x12, 0x19, 0xca, 0x72, 0xb6, 0xfb, 0x1c, 0x4b, 0x4a, 0xba};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xcd, 0x5e, 0x19, 0xf1, 0x49, 0x6,  0x48, 0x98, 0x6e, 0x69, 0xf9, 0xe0, 0x31, 0x11, 0x9d,
                           0x8e, 0x3e, 0x95, 0xda, 0x32, 0xe2, 0xf2, 0xa6, 0x10, 0x4c, 0x8d, 0xd9, 0x9e, 0x6b, 0x3f};
  uint8_t bytesprops1[] = {0x22, 0x4f, 0xf8, 0xe2, 0xbd, 0xa4, 0xc0};
  uint8_t bytesprops2[] = {0x7a, 0xd6, 0x82};
  uint8_t bytesprops3[] = {0x62, 0x7e, 0x33, 0x3, 0x21, 0x5a, 0xfc, 0xc6, 0x80, 0xb5, 0x23, 0xf3, 0xca};
  uint8_t bytesprops4[] = {0xe8, 0x9, 0x8b, 0xfd, 0x21};
  uint8_t bytesprops5[] = {0xb0, 0xb8, 0x23, 0x1d, 0x74, 0x5a, 0x24, 0x3e, 0xb9,
                           0x42, 0x6b, 0xaf, 0xb7, 0x1e, 0x62, 0x13, 0xeb, 0xcc};
  uint8_t bytesprops6[] = {0};
  uint8_t bytesprops7[] = {0x8d, 0x4d, 0x76, 0xa0, 0x1,  0xc5, 0x7c, 0xe2, 0x88,
                           0x39, 0x4f, 0x6d, 0x29, 0xb0, 0x3a, 0xcd, 0xb,  0x5d};
  uint8_t bytesprops8[] = {0xa,  0xed, 0x4,  0x70, 0x16, 0xc3, 0x9e, 0x9b, 0xab, 0xe6, 0x9,  0xe2, 0x3e,
                           0xf5, 0x4e, 0xf9, 0xbf, 0x46, 0x3,  0xfc, 0xcb, 0x59, 0xe0, 0x43, 0xe5, 0x53};
  uint8_t bytesprops9[] = {0x87, 0xa6, 0x18, 0x30, 0x80, 0x9f, 0xbc, 0xf4, 0x14, 0x2d, 0x82, 0xbf, 0xad, 0xbc,
                           0xe1, 0x79, 0xe1, 0x8d, 0x81, 0x53, 0x30, 0x7,  0xc9, 0x44, 0xe7, 0x9f, 0xde};
  uint8_t bytesprops11[] = {0x7a, 0xd4, 0x23, 0xaf, 0x90, 0x7e, 0xa};
  uint8_t bytesprops10[] = {0x74, 0xc1, 0xea, 0xb8, 0x16, 0x69, 0x7f, 0x93, 0x6};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {7, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 43}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {13, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6944}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 127}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {5, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29028}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28968}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {26, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 21823}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 248}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {9, (char*)&bytesprops10}, .v = {7, (char*)&bytesprops11}}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[4];
  uint8_t topic_filter_s0_bytes[] = {0xd1, 0x72, 0x32, 0x81, 0xad, 0x66, 0xff, 0x8f, 0xed, 0x21,
                                     0xbc, 0x6d, 0x86, 0x34, 0x23, 0xa7, 0x9c, 0xd3, 0x5b, 0x40,
                                     0x44, 0xb5, 0xe,  0xa1, 0xd2, 0xa,  0xeb, 0x34};
  lwmqtt_string_t topic_filter_s0 = {28, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x85, 0xa4, 0x95, 0x35, 0xcd, 0xfb, 0xdf};
  lwmqtt_string_t topic_filter_s1 = {7, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x42, 0x66, 0x2e, 0xb7, 0x72, 0x93, 0x48, 0xfc};
  lwmqtt_string_t topic_filter_s2 = {8, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x2f, 0x82, 0x56, 0x8d, 0x82, 0xc8, 0x83, 0xf8, 0x8,  0xa2, 0x45,
                                     0x62, 0x12, 0x19, 0xca, 0x72, 0xb6, 0xfb, 0x1c, 0x4b, 0x4a, 0xba};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 24572, 4, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22215
// ["tkb\217BA\193-\r\243\141\144\131?#\SO\181p\150,\n\DEL)!","`\148\&8\EOT\EM\209\DLEI\193\218\148\180?\184X`,","\177V]\a8>\139\248\US\158\&4Pz\232|\147S\229\149\145\150\170\185\240'","\242M!M\182ds\247I\DEL\233\&0X),\206\155\200\232\182","s\SOH\149\210\176E\148\180\164\142\v\225gk\198\168\139/\161\240\249T\155)\140*","\165\EM\192\148-\241\213\188\182w\155\ESC*\NUL\RS*)\177h","\244\148-\DC3A\174,d\225\215d\170x"]
// [PropTopicAliasMaximum 31672,PropWildcardSubscriptionAvailable 140,PropTopicAlias 31200,PropResponseInformation
// "\t\192\t",PropRequestProblemInformation 247,PropSharedSubscriptionAvailable 136,PropReceiveMaximum
// 3232,PropRequestResponseInformation 225,PropReceiveMaximum 12340]
TEST(Unsubscribe5QCTest, Encode22) {
  uint8_t pkt[] = {
      0xa2, 0xbb, 0x1,  0x56, 0xc7, 0x1a, 0x22, 0x7b, 0xb8, 0x28, 0x8c, 0x23, 0x79, 0xe0, 0x1a, 0x0,  0x3,  0x9,  0xc0,
      0x9,  0x17, 0xf7, 0x2a, 0x88, 0x21, 0xc,  0xa0, 0x19, 0xe1, 0x21, 0x30, 0x34, 0x0,  0x18, 0x74, 0x6b, 0x62, 0xd9,
      0x42, 0x41, 0xc1, 0x2d, 0xd,  0xf3, 0x8d, 0x90, 0x83, 0x3f, 0x23, 0xe,  0xb5, 0x70, 0x96, 0x2c, 0xa,  0x7f, 0x29,
      0x21, 0x0,  0x11, 0x60, 0x94, 0x38, 0x4,  0x19, 0xd1, 0x10, 0x49, 0xc1, 0xda, 0x94, 0xb4, 0x3f, 0xb8, 0x58, 0x60,
      0x2c, 0x0,  0x19, 0xb1, 0x56, 0x5d, 0x7,  0x38, 0x3e, 0x8b, 0xf8, 0x1f, 0x9e, 0x34, 0x50, 0x7a, 0xe8, 0x7c, 0x93,
      0x53, 0xe5, 0x95, 0x91, 0x96, 0xaa, 0xb9, 0xf0, 0x27, 0x0,  0x14, 0xf2, 0x4d, 0x21, 0x4d, 0xb6, 0x64, 0x73, 0xf7,
      0x49, 0x7f, 0xe9, 0x30, 0x58, 0x29, 0x2c, 0xce, 0x9b, 0xc8, 0xe8, 0xb6, 0x0,  0x1a, 0x73, 0x1,  0x95, 0xd2, 0xb0,
      0x45, 0x94, 0xb4, 0xa4, 0x8e, 0xb,  0xe1, 0x67, 0x6b, 0xc6, 0xa8, 0x8b, 0x2f, 0xa1, 0xf0, 0xf9, 0x54, 0x9b, 0x29,
      0x8c, 0x2a, 0x0,  0x13, 0xa5, 0x19, 0xc0, 0x94, 0x2d, 0xf1, 0xd5, 0xbc, 0xb6, 0x77, 0x9b, 0x1b, 0x2a, 0x0,  0x1e,
      0x2a, 0x29, 0xb1, 0x68, 0x0,  0xd,  0xf4, 0x94, 0x2d, 0x13, 0x41, 0xae, 0x2c, 0x64, 0xe1, 0xd7, 0x64, 0xaa, 0x78};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9, 0xc0, 0x9};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 31672}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 140}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31200}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 3232}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12340}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0x74, 0x6b, 0x62, 0xd9, 0x42, 0x41, 0xc1, 0x2d, 0xd, 0xf3, 0x8d, 0x90,
                                     0x83, 0x3f, 0x23, 0xe,  0xb5, 0x70, 0x96, 0x2c, 0xa, 0x7f, 0x29, 0x21};
  lwmqtt_string_t topic_filter_s0 = {24, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x60, 0x94, 0x38, 0x4,  0x19, 0xd1, 0x10, 0x49, 0xc1,
                                     0xda, 0x94, 0xb4, 0x3f, 0xb8, 0x58, 0x60, 0x2c};
  lwmqtt_string_t topic_filter_s1 = {17, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xb1, 0x56, 0x5d, 0x7,  0x38, 0x3e, 0x8b, 0xf8, 0x1f, 0x9e, 0x34, 0x50, 0x7a,
                                     0xe8, 0x7c, 0x93, 0x53, 0xe5, 0x95, 0x91, 0x96, 0xaa, 0xb9, 0xf0, 0x27};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf2, 0x4d, 0x21, 0x4d, 0xb6, 0x64, 0x73, 0xf7, 0x49, 0x7f,
                                     0xe9, 0x30, 0x58, 0x29, 0x2c, 0xce, 0x9b, 0xc8, 0xe8, 0xb6};
  lwmqtt_string_t topic_filter_s3 = {20, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x73, 0x1,  0x95, 0xd2, 0xb0, 0x45, 0x94, 0xb4, 0xa4, 0x8e, 0xb,  0xe1, 0x67,
                                     0x6b, 0xc6, 0xa8, 0x8b, 0x2f, 0xa1, 0xf0, 0xf9, 0x54, 0x9b, 0x29, 0x8c, 0x2a};
  lwmqtt_string_t topic_filter_s4 = {26, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xa5, 0x19, 0xc0, 0x94, 0x2d, 0xf1, 0xd5, 0xbc, 0xb6, 0x77,
                                     0x9b, 0x1b, 0x2a, 0x0,  0x1e, 0x2a, 0x29, 0xb1, 0x68};
  lwmqtt_string_t topic_filter_s5 = {19, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xf4, 0x94, 0x2d, 0x13, 0x41, 0xae, 0x2c, 0x64, 0xe1, 0xd7, 0x64, 0xaa, 0x78};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22215, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 6585
// ["\230\183q\150\255f\RS\133,\EM\151s\DC4","\160\239\214T\CANS\255\134\169\182\167ri\233\201","B\149Ms7\DC2\234x\185t\233\239\247\EOT\150\\\225\NUL\DC4\SO$\tP\190\DC3","\231\130\&50\142?\232\228\STX\183\182\159h\211\140\218N\ESC\ENQL\161=\158\251\166","\218\230\&2\130\163\DLE","\130q\162\EOT:\240\"\206`\134|\162","l\185N\132\177\203*","SB\DC1\\\186\191\167iq\187\204\a\NAK\137\214u\155\n"]
// [PropWildcardSubscriptionAvailable 25,PropWildcardSubscriptionAvailable 71,PropResponseInformation
// "\159\253\198f\154\DC1\143e\153\a|W\208\140f\210\DC4H\227\144\183",PropSubscriptionIdentifier 27,PropResponseTopic
// "\128\176XG\181\NUL\r\228\220\237\DC3O\173\ETB\239vD2\ENQ\156\180",PropTopicAlias 23925,PropReasonString
// "{=@F\SO\159\238\207w\145\136\243j\172L\200\246\192U*\212\131@\215A\239el*\187",PropMaximumQoS
// 225,PropWillDelayInterval 32196,PropSubscriptionIdentifierAvailable 174,PropServerReference
// "\238\186y\159\214\137j<\153\195\202\\\160W\"\204!\214C",PropMessageExpiryInterval 14388,PropPayloadFormatIndicator
// 179,PropServerReference "\"\GS\132\146\241\184\t\157\128",PropMessageExpiryInterval 25165,PropWillDelayInterval
// 5332,PropRequestProblemInformation 55,PropWillDelayInterval 1710,PropContentType
// "8\217\136\SYN\241\SI",PropMaximumPacketSize 11435,PropUserProperty "<\254\STX\227\&7\240D"
// "TswK\\L/\217\138A\195\230\158\227VT\r\178",PropMessageExpiryInterval 12725,PropTopicAliasMaximum
// 29756,PropResponseTopic "\253\&6w\174\223\r\bO\178#\156/\243\140:N\132U\155\244^",PropTopicAliasMaximum
// 30499,PropContentType "\138o4K\192\228\ETXR\165\172T\227GE3",PropServerReference
// "\158u\167{7\198\aC\160x[\199\128\144\213\140+s\226\128\191\146\221N\241Y",PropSubscriptionIdentifier 4]
TEST(Unsubscribe5QCTest, Encode23) {
  uint8_t pkt[] = {
      0xa2, 0xaa, 0x3,  0x19, 0xb9, 0x9d, 0x2,  0x28, 0x19, 0x28, 0x47, 0x1a, 0x0,  0x15, 0x9f, 0xfd, 0xc6, 0x66, 0x9a,
      0x11, 0x8f, 0x65, 0x99, 0x7,  0x7c, 0x57, 0xd0, 0x8c, 0x66, 0xd2, 0x14, 0x48, 0xe3, 0x90, 0xb7, 0xb,  0x1b, 0x8,
      0x0,  0x15, 0x80, 0xb0, 0x58, 0x47, 0xb5, 0x0,  0xd,  0xe4, 0xdc, 0xed, 0x13, 0x4f, 0xad, 0x17, 0xef, 0x76, 0x44,
      0x32, 0x5,  0x9c, 0xb4, 0x23, 0x5d, 0x75, 0x1f, 0x0,  0x1e, 0x7b, 0x3d, 0x40, 0x46, 0xe,  0x9f, 0xee, 0xcf, 0x77,
      0x91, 0x88, 0xf3, 0x6a, 0xac, 0x4c, 0xc8, 0xf6, 0xc0, 0x55, 0x2a, 0xd4, 0x83, 0x40, 0xd7, 0x41, 0xef, 0x65, 0x6c,
      0x2a, 0xbb, 0x24, 0xe1, 0x18, 0x0,  0x0,  0x7d, 0xc4, 0x29, 0xae, 0x1c, 0x0,  0x13, 0xee, 0xba, 0x79, 0x9f, 0xd6,
      0x89, 0x6a, 0x3c, 0x99, 0xc3, 0xca, 0x5c, 0xa0, 0x57, 0x22, 0xcc, 0x21, 0xd6, 0x43, 0x2,  0x0,  0x0,  0x38, 0x34,
      0x1,  0xb3, 0x1c, 0x0,  0x9,  0x22, 0x1d, 0x84, 0x92, 0xf1, 0xb8, 0x9,  0x9d, 0x80, 0x2,  0x0,  0x0,  0x62, 0x4d,
      0x18, 0x0,  0x0,  0x14, 0xd4, 0x17, 0x37, 0x18, 0x0,  0x0,  0x6,  0xae, 0x3,  0x0,  0x6,  0x38, 0xd9, 0x88, 0x16,
      0xf1, 0xf,  0x27, 0x0,  0x0,  0x2c, 0xab, 0x26, 0x0,  0x7,  0x3c, 0xfe, 0x2,  0xe3, 0x37, 0xf0, 0x44, 0x0,  0x12,
      0x54, 0x73, 0x77, 0x4b, 0x5c, 0x4c, 0x2f, 0xd9, 0x8a, 0x41, 0xc3, 0xe6, 0x9e, 0xe3, 0x56, 0x54, 0xd,  0xb2, 0x2,
      0x0,  0x0,  0x31, 0xb5, 0x22, 0x74, 0x3c, 0x8,  0x0,  0x15, 0xfd, 0x36, 0x77, 0xae, 0xdf, 0xd,  0x8,  0x4f, 0xb2,
      0x23, 0x9c, 0x2f, 0xf3, 0x8c, 0x3a, 0x4e, 0x84, 0x55, 0x9b, 0xf4, 0x5e, 0x22, 0x77, 0x23, 0x3,  0x0,  0xf,  0x8a,
      0x6f, 0x34, 0x4b, 0xc0, 0xe4, 0x3,  0x52, 0xa5, 0xac, 0x54, 0xe3, 0x47, 0x45, 0x33, 0x1c, 0x0,  0x1a, 0x9e, 0x75,
      0xa7, 0x7b, 0x37, 0xc6, 0x7,  0x43, 0xa0, 0x78, 0x5b, 0xc7, 0x80, 0x90, 0xd5, 0x8c, 0x2b, 0x73, 0xe2, 0x80, 0xbf,
      0x92, 0xdd, 0x4e, 0xf1, 0x59, 0xb,  0x4,  0x0,  0xd,  0xe6, 0xb7, 0x71, 0x96, 0xff, 0x66, 0x1e, 0x85, 0x2c, 0x19,
      0x97, 0x73, 0x14, 0x0,  0xf,  0xa0, 0xef, 0xd6, 0x54, 0x18, 0x53, 0xff, 0x86, 0xa9, 0xb6, 0xa7, 0x72, 0x69, 0xe9,
      0xc9, 0x0,  0x19, 0x42, 0x95, 0x4d, 0x73, 0x37, 0x12, 0xea, 0x78, 0xb9, 0x74, 0xe9, 0xef, 0xf7, 0x4,  0x96, 0x5c,
      0xe1, 0x0,  0x14, 0xe,  0x24, 0x9,  0x50, 0xbe, 0x13, 0x0,  0x19, 0xe7, 0x82, 0x35, 0x30, 0x8e, 0x3f, 0xe8, 0xe4,
      0x2,  0xb7, 0xb6, 0x9f, 0x68, 0xd3, 0x8c, 0xda, 0x4e, 0x1b, 0x5,  0x4c, 0xa1, 0x3d, 0x9e, 0xfb, 0xa6, 0x0,  0x6,
      0xda, 0xe6, 0x32, 0x82, 0xa3, 0x10, 0x0,  0xc,  0x82, 0x71, 0xa2, 0x4,  0x3a, 0xf0, 0x22, 0xce, 0x60, 0x86, 0x7c,
      0xa2, 0x0,  0x7,  0x6c, 0xb9, 0x4e, 0x84, 0xb1, 0xcb, 0x2a, 0x0,  0x12, 0x53, 0x42, 0x11, 0x5c, 0xba, 0xbf, 0xa7,
      0x69, 0x71, 0xbb, 0xcc, 0x7,  0x15, 0x89, 0xd6, 0x75, 0x9b, 0xa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9f, 0xfd, 0xc6, 0x66, 0x9a, 0x11, 0x8f, 0x65, 0x99, 0x7, 0x7c,
                           0x57, 0xd0, 0x8c, 0x66, 0xd2, 0x14, 0x48, 0xe3, 0x90, 0xb7};
  uint8_t bytesprops1[] = {0x80, 0xb0, 0x58, 0x47, 0xb5, 0x0,  0xd,  0xe4, 0xdc, 0xed, 0x13,
                           0x4f, 0xad, 0x17, 0xef, 0x76, 0x44, 0x32, 0x5,  0x9c, 0xb4};
  uint8_t bytesprops2[] = {0x7b, 0x3d, 0x40, 0x46, 0xe,  0x9f, 0xee, 0xcf, 0x77, 0x91, 0x88, 0xf3, 0x6a, 0xac, 0x4c,
                           0xc8, 0xf6, 0xc0, 0x55, 0x2a, 0xd4, 0x83, 0x40, 0xd7, 0x41, 0xef, 0x65, 0x6c, 0x2a, 0xbb};
  uint8_t bytesprops3[] = {0xee, 0xba, 0x79, 0x9f, 0xd6, 0x89, 0x6a, 0x3c, 0x99, 0xc3,
                           0xca, 0x5c, 0xa0, 0x57, 0x22, 0xcc, 0x21, 0xd6, 0x43};
  uint8_t bytesprops4[] = {0x22, 0x1d, 0x84, 0x92, 0xf1, 0xb8, 0x9, 0x9d, 0x80};
  uint8_t bytesprops5[] = {0x38, 0xd9, 0x88, 0x16, 0xf1, 0xf};
  uint8_t bytesprops7[] = {0x54, 0x73, 0x77, 0x4b, 0x5c, 0x4c, 0x2f, 0xd9, 0x8a,
                           0x41, 0xc3, 0xe6, 0x9e, 0xe3, 0x56, 0x54, 0xd,  0xb2};
  uint8_t bytesprops6[] = {0x3c, 0xfe, 0x2, 0xe3, 0x37, 0xf0, 0x44};
  uint8_t bytesprops8[] = {0xfd, 0x36, 0x77, 0xae, 0xdf, 0xd,  0x8,  0x4f, 0xb2, 0x23, 0x9c,
                           0x2f, 0xf3, 0x8c, 0x3a, 0x4e, 0x84, 0x55, 0x9b, 0xf4, 0x5e};
  uint8_t bytesprops9[] = {0x8a, 0x6f, 0x34, 0x4b, 0xc0, 0xe4, 0x3, 0x52, 0xa5, 0xac, 0x54, 0xe3, 0x47, 0x45, 0x33};
  uint8_t bytesprops10[] = {0x9e, 0x75, 0xa7, 0x7b, 0x37, 0xc6, 0x7,  0x43, 0xa0, 0x78, 0x5b, 0xc7, 0x80,
                            0x90, 0xd5, 0x8c, 0x2b, 0x73, 0xe2, 0x80, 0xbf, 0x92, 0xdd, 0x4e, 0xf1, 0x59};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 25}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 71}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 27}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 23925}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {30, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 32196}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 174}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14388}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25165}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 5332}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 1710}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11435}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {7, (char*)&bytesprops6}, .v = {18, (char*)&bytesprops7}}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 12725}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 29756}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 30499}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {26, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 4}},
  };

  lwmqtt_properties_t props = {28, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0xe6, 0xb7, 0x71, 0x96, 0xff, 0x66, 0x1e, 0x85, 0x2c, 0x19, 0x97, 0x73, 0x14};
  lwmqtt_string_t topic_filter_s0 = {13, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xa0, 0xef, 0xd6, 0x54, 0x18, 0x53, 0xff, 0x86,
                                     0xa9, 0xb6, 0xa7, 0x72, 0x69, 0xe9, 0xc9};
  lwmqtt_string_t topic_filter_s1 = {15, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x42, 0x95, 0x4d, 0x73, 0x37, 0x12, 0xea, 0x78, 0xb9, 0x74, 0xe9, 0xef, 0xf7,
                                     0x4,  0x96, 0x5c, 0xe1, 0x0,  0x14, 0xe,  0x24, 0x9,  0x50, 0xbe, 0x13};
  lwmqtt_string_t topic_filter_s2 = {25, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xe7, 0x82, 0x35, 0x30, 0x8e, 0x3f, 0xe8, 0xe4, 0x2,  0xb7, 0xb6, 0x9f, 0x68,
                                     0xd3, 0x8c, 0xda, 0x4e, 0x1b, 0x5,  0x4c, 0xa1, 0x3d, 0x9e, 0xfb, 0xa6};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xda, 0xe6, 0x32, 0x82, 0xa3, 0x10};
  lwmqtt_string_t topic_filter_s4 = {6, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x82, 0x71, 0xa2, 0x4, 0x3a, 0xf0, 0x22, 0xce, 0x60, 0x86, 0x7c, 0xa2};
  lwmqtt_string_t topic_filter_s5 = {12, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x6c, 0xb9, 0x4e, 0x84, 0xb1, 0xcb, 0x2a};
  lwmqtt_string_t topic_filter_s6 = {7, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x53, 0x42, 0x11, 0x5c, 0xba, 0xbf, 0xa7, 0x69, 0x71,
                                     0xbb, 0xcc, 0x7,  0x15, 0x89, 0xd6, 0x75, 0x9b, 0xa};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 6585, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22838
// ["@w%\186\210\164\154\ACKl\193]J?uN\fM\186","\206\247\DEL\254\199\EM\205\216\151KC\ETX\219\180etQ\135\188\195\197_\249\b","m\CAN\222\175|\164\198\ETBF","\186\147\228\156\151$\239K@\USJ\248\193`z\220\222\224M[\182","\154\n$qM4\nL\ETXb\ETX\241","K\154?\178\227p\162\200R\194\196","+\245t\230#}Ja\SOH\214x\220)\ESC\138\t\134\215J\222\131$dD\222","\169\191\191\193[\224tV&\218rG\196\SYNQ\224n\157\&7\215\165\207\153+\a\234\235","(\185\142\190\225\&7\FSf\147Obz\203\136||\198\&5\DC1\239\161\202","_>\198mEZ\153\&1\149\250r\146zt\ESC\239g\176\148\197\210\NUL\231-\212\138"]
// [PropRetainAvailable 107,PropContentType "\248\135;\215w4\172\183\223\SOH\DEL\172\157\151!Z",PropReasonString
// "\173\227\&7\237\199)V \155\175\DEL\NUL\USd\ACK\161\138\150\207\255Vg\135mwS{j",PropAssignedClientIdentifier
// "?\209\182\SO"]
TEST(Unsubscribe5QCTest, Encode24) {
  uint8_t pkt[] = {
      0xa2, 0x95, 0x2,  0x59, 0x36, 0x3b, 0x25, 0x6b, 0x3,  0x0,  0x10, 0xf8, 0x87, 0x3b, 0xd7, 0x77, 0x34, 0xac, 0xb7,
      0xdf, 0x1,  0x7f, 0xac, 0x9d, 0x97, 0x21, 0x5a, 0x1f, 0x0,  0x1c, 0xad, 0xe3, 0x37, 0xed, 0xc7, 0x29, 0x56, 0x20,
      0x9b, 0xaf, 0x7f, 0x0,  0x1f, 0x64, 0x6,  0xa1, 0x8a, 0x96, 0xcf, 0xff, 0x56, 0x67, 0x87, 0x6d, 0x77, 0x53, 0x7b,
      0x6a, 0x12, 0x0,  0x4,  0x3f, 0xd1, 0xb6, 0xe,  0x0,  0x12, 0x40, 0x77, 0x25, 0xba, 0xd2, 0xa4, 0x9a, 0x6,  0x6c,
      0xc1, 0x5d, 0x4a, 0x3f, 0x75, 0x4e, 0xc,  0x4d, 0xba, 0x0,  0x18, 0xce, 0xf7, 0x7f, 0xfe, 0xc7, 0x19, 0xcd, 0xd8,
      0x97, 0x4b, 0x43, 0x3,  0xdb, 0xb4, 0x65, 0x74, 0x51, 0x87, 0xbc, 0xc3, 0xc5, 0x5f, 0xf9, 0x8,  0x0,  0x9,  0x6d,
      0x18, 0xde, 0xaf, 0x7c, 0xa4, 0xc6, 0x17, 0x46, 0x0,  0x15, 0xba, 0x93, 0xe4, 0x9c, 0x97, 0x24, 0xef, 0x4b, 0x40,
      0x1f, 0x4a, 0xf8, 0xc1, 0x60, 0x7a, 0xdc, 0xde, 0xe0, 0x4d, 0x5b, 0xb6, 0x0,  0xc,  0x9a, 0xa,  0x24, 0x71, 0x4d,
      0x34, 0xa,  0x4c, 0x3,  0x62, 0x3,  0xf1, 0x0,  0xb,  0x4b, 0x9a, 0x3f, 0xb2, 0xe3, 0x70, 0xa2, 0xc8, 0x52, 0xc2,
      0xc4, 0x0,  0x19, 0x2b, 0xf5, 0x74, 0xe6, 0x23, 0x7d, 0x4a, 0x61, 0x1,  0xd6, 0x78, 0xdc, 0x29, 0x1b, 0x8a, 0x9,
      0x86, 0xd7, 0x4a, 0xde, 0x83, 0x24, 0x64, 0x44, 0xde, 0x0,  0x1b, 0xa9, 0xbf, 0xbf, 0xc1, 0x5b, 0xe0, 0x74, 0x56,
      0x26, 0xda, 0x72, 0x47, 0xc4, 0x16, 0x51, 0xe0, 0x6e, 0x9d, 0x37, 0xd7, 0xa5, 0xcf, 0x99, 0x2b, 0x7,  0xea, 0xeb,
      0x0,  0x16, 0x28, 0xb9, 0x8e, 0xbe, 0xe1, 0x37, 0x1c, 0x66, 0x93, 0x4f, 0x62, 0x7a, 0xcb, 0x88, 0x7c, 0x7c, 0xc6,
      0x35, 0x11, 0xef, 0xa1, 0xca, 0x0,  0x1a, 0x5f, 0x3e, 0xc6, 0x6d, 0x45, 0x5a, 0x99, 0x31, 0x95, 0xfa, 0x72, 0x92,
      0x7a, 0x74, 0x1b, 0xef, 0x67, 0xb0, 0x94, 0xc5, 0xd2, 0x0,  0xe7, 0x2d, 0xd4, 0x8a};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf8, 0x87, 0x3b, 0xd7, 0x77, 0x34, 0xac, 0xb7,
                           0xdf, 0x1,  0x7f, 0xac, 0x9d, 0x97, 0x21, 0x5a};
  uint8_t bytesprops1[] = {0xad, 0xe3, 0x37, 0xed, 0xc7, 0x29, 0x56, 0x20, 0x9b, 0xaf, 0x7f, 0x0,  0x1f, 0x64,
                           0x6,  0xa1, 0x8a, 0x96, 0xcf, 0xff, 0x56, 0x67, 0x87, 0x6d, 0x77, 0x53, 0x7b, 0x6a};
  uint8_t bytesprops2[] = {0x3f, 0xd1, 0xb6, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 107}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {16, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x40, 0x77, 0x25, 0xba, 0xd2, 0xa4, 0x9a, 0x6,  0x6c,
                                     0xc1, 0x5d, 0x4a, 0x3f, 0x75, 0x4e, 0xc,  0x4d, 0xba};
  lwmqtt_string_t topic_filter_s0 = {18, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xce, 0xf7, 0x7f, 0xfe, 0xc7, 0x19, 0xcd, 0xd8, 0x97, 0x4b, 0x43, 0x3,
                                     0xdb, 0xb4, 0x65, 0x74, 0x51, 0x87, 0xbc, 0xc3, 0xc5, 0x5f, 0xf9, 0x8};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x6d, 0x18, 0xde, 0xaf, 0x7c, 0xa4, 0xc6, 0x17, 0x46};
  lwmqtt_string_t topic_filter_s2 = {9, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xba, 0x93, 0xe4, 0x9c, 0x97, 0x24, 0xef, 0x4b, 0x40, 0x1f, 0x4a,
                                     0xf8, 0xc1, 0x60, 0x7a, 0xdc, 0xde, 0xe0, 0x4d, 0x5b, 0xb6};
  lwmqtt_string_t topic_filter_s3 = {21, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x9a, 0xa, 0x24, 0x71, 0x4d, 0x34, 0xa, 0x4c, 0x3, 0x62, 0x3, 0xf1};
  lwmqtt_string_t topic_filter_s4 = {12, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x4b, 0x9a, 0x3f, 0xb2, 0xe3, 0x70, 0xa2, 0xc8, 0x52, 0xc2, 0xc4};
  lwmqtt_string_t topic_filter_s5 = {11, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x2b, 0xf5, 0x74, 0xe6, 0x23, 0x7d, 0x4a, 0x61, 0x1,  0xd6, 0x78, 0xdc, 0x29,
                                     0x1b, 0x8a, 0x9,  0x86, 0xd7, 0x4a, 0xde, 0x83, 0x24, 0x64, 0x44, 0xde};
  lwmqtt_string_t topic_filter_s6 = {25, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xa9, 0xbf, 0xbf, 0xc1, 0x5b, 0xe0, 0x74, 0x56, 0x26, 0xda, 0x72, 0x47, 0xc4, 0x16,
                                     0x51, 0xe0, 0x6e, 0x9d, 0x37, 0xd7, 0xa5, 0xcf, 0x99, 0x2b, 0x7,  0xea, 0xeb};
  lwmqtt_string_t topic_filter_s7 = {27, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0x28, 0xb9, 0x8e, 0xbe, 0xe1, 0x37, 0x1c, 0x66, 0x93, 0x4f, 0x62,
                                     0x7a, 0xcb, 0x88, 0x7c, 0x7c, 0xc6, 0x35, 0x11, 0xef, 0xa1, 0xca};
  lwmqtt_string_t topic_filter_s8 = {22, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5f, 0x3e, 0xc6, 0x6d, 0x45, 0x5a, 0x99, 0x31, 0x95, 0xfa, 0x72, 0x92, 0x7a,
                                     0x74, 0x1b, 0xef, 0x67, 0xb0, 0x94, 0xc5, 0xd2, 0x0,  0xe7, 0x2d, 0xd4, 0x8a};
  lwmqtt_string_t topic_filter_s9 = {26, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22838, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 14034 ["1\217\143\SOH~W~\ETX
// \191\NUL\173|\218L\CAN\229\ESC\249\241\169\130","T\140qo","\128k\172\167\180\235\144\222\r\129\254?,\152\187+\228\178F\194\225","\244\CAN\230/\246X\247\&1,\208\222\235(\219%\246\172\225\254\191\189|\218'\253","\ENQ\133\178\EOT\241\135\222\201\220\164\&3\179\157\222T\189\253","\ETB\DC4\159\210\ETB0\218\213;\180\EM\227\244Lr\245\EOTn\NULh","\173.N\n~\219o\214\205\167\190\139\196\185\246\174\&3\STX\215\235\135a","\172g\bAu\187r\au-\DC4!!Vw
// |x","\211\&6\175\180c\153\187s\NUL\v\140Em\215\144\244\&3|\246\ESC&\239tD\243\239","]\US\226A\165\\|\206U6\249d\144\241On-\153"]
// [PropMessageExpiryInterval 5120,PropTopicAliasMaximum 18895,PropSharedSubscriptionAvailable 79,PropServerKeepAlive
// 26825,PropRequestResponseInformation 31,PropMaximumQoS 209,PropMaximumQoS 168,PropAuthenticationData
// "R\143\140\ETB\229\&0\193\246~Z\131\166C)\151\226\&7",PropMessageExpiryInterval 11526,PropResponseInformation
// "\169\CAN\170\DEL\206\197",PropRequestProblemInformation 239,PropResponseInformation
// "\188\221\162\177\CAN\246\r\252\&2\198\211o\CAN\FS\ESC\136\&5\"\240`E\ETB",PropSubscriptionIdentifier
// 23,PropMaximumQoS 102,PropRequestResponseInformation 187,PropMessageExpiryInterval
// 20661,PropRequestProblemInformation 73,PropMaximumQoS 39]
TEST(Unsubscribe5QCTest, Encode25) {
  uint8_t pkt[] = {
      0xa2, 0xb7, 0x2,  0x36, 0xd2, 0x5f, 0x2,  0x0,  0x0,  0x14, 0x0,  0x22, 0x49, 0xcf, 0x2a, 0x4f, 0x13, 0x68, 0xc9,
      0x19, 0x1f, 0x24, 0xd1, 0x24, 0xa8, 0x16, 0x0,  0x11, 0x52, 0x8f, 0x8c, 0x17, 0xe5, 0x30, 0xc1, 0xf6, 0x7e, 0x5a,
      0x83, 0xa6, 0x43, 0x29, 0x97, 0xe2, 0x37, 0x2,  0x0,  0x0,  0x2d, 0x6,  0x1a, 0x0,  0x6,  0xa9, 0x18, 0xaa, 0x7f,
      0xce, 0xc5, 0x17, 0xef, 0x1a, 0x0,  0x16, 0xbc, 0xdd, 0xa2, 0xb1, 0x18, 0xf6, 0xd,  0xfc, 0x32, 0xc6, 0xd3, 0x6f,
      0x18, 0x1c, 0x1b, 0x88, 0x35, 0x22, 0xf0, 0x60, 0x45, 0x17, 0xb,  0x17, 0x24, 0x66, 0x19, 0xbb, 0x2,  0x0,  0x0,
      0x50, 0xb5, 0x17, 0x49, 0x24, 0x27, 0x0,  0x16, 0x31, 0xd9, 0x8f, 0x1,  0x7e, 0x57, 0x7e, 0x3,  0x20, 0xbf, 0x0,
      0xad, 0x7c, 0xda, 0x4c, 0x18, 0xe5, 0x1b, 0xf9, 0xf1, 0xa9, 0x82, 0x0,  0x4,  0x54, 0x8c, 0x71, 0x6f, 0x0,  0x15,
      0x80, 0x6b, 0xac, 0xa7, 0xb4, 0xeb, 0x90, 0xde, 0xd,  0x81, 0xfe, 0x3f, 0x2c, 0x98, 0xbb, 0x2b, 0xe4, 0xb2, 0x46,
      0xc2, 0xe1, 0x0,  0x19, 0xf4, 0x18, 0xe6, 0x2f, 0xf6, 0x58, 0xf7, 0x31, 0x2c, 0xd0, 0xde, 0xeb, 0x28, 0xdb, 0x25,
      0xf6, 0xac, 0xe1, 0xfe, 0xbf, 0xbd, 0x7c, 0xda, 0x27, 0xfd, 0x0,  0x11, 0x5,  0x85, 0xb2, 0x4,  0xf1, 0x87, 0xde,
      0xc9, 0xdc, 0xa4, 0x33, 0xb3, 0x9d, 0xde, 0x54, 0xbd, 0xfd, 0x0,  0x14, 0x17, 0x14, 0x9f, 0xd2, 0x17, 0x30, 0xda,
      0xd5, 0x3b, 0xb4, 0x19, 0xe3, 0xf4, 0x4c, 0x72, 0xf5, 0x4,  0x6e, 0x0,  0x68, 0x0,  0x16, 0xad, 0x2e, 0x4e, 0xa,
      0x7e, 0xdb, 0x6f, 0xd6, 0xcd, 0xa7, 0xbe, 0x8b, 0xc4, 0xb9, 0xf6, 0xae, 0x33, 0x2,  0xd7, 0xeb, 0x87, 0x61, 0x0,
      0x12, 0xac, 0x67, 0x8,  0x41, 0x75, 0xbb, 0x72, 0x7,  0x75, 0x2d, 0x14, 0x21, 0x21, 0x56, 0x77, 0x20, 0x7c, 0x78,
      0x0,  0x1a, 0xd3, 0x36, 0xaf, 0xb4, 0x63, 0x99, 0xbb, 0x73, 0x0,  0xb,  0x8c, 0x45, 0x6d, 0xd7, 0x90, 0xf4, 0x33,
      0x7c, 0xf6, 0x1b, 0x26, 0xef, 0x74, 0x44, 0xf3, 0xef, 0x0,  0x12, 0x5d, 0x1f, 0xe2, 0x41, 0xa5, 0x5c, 0x7c, 0xce,
      0x55, 0x36, 0xf9, 0x64, 0x90, 0xf1, 0x4f, 0x6e, 0x2d, 0x99};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x52, 0x8f, 0x8c, 0x17, 0xe5, 0x30, 0xc1, 0xf6, 0x7e,
                           0x5a, 0x83, 0xa6, 0x43, 0x29, 0x97, 0xe2, 0x37};
  uint8_t bytesprops1[] = {0xa9, 0x18, 0xaa, 0x7f, 0xce, 0xc5};
  uint8_t bytesprops2[] = {0xbc, 0xdd, 0xa2, 0xb1, 0x18, 0xf6, 0xd,  0xfc, 0x32, 0xc6, 0xd3,
                           0x6f, 0x18, 0x1c, 0x1b, 0x88, 0x35, 0x22, 0xf0, 0x60, 0x45, 0x17};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 5120}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18895}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 79}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 26825}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 209}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 168}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11526}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {6, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 239}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {22, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 23}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 102}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 20661}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 73}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 39}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[10];
  uint8_t topic_filter_s0_bytes[] = {0x31, 0xd9, 0x8f, 0x1,  0x7e, 0x57, 0x7e, 0x3,  0x20, 0xbf, 0x0,
                                     0xad, 0x7c, 0xda, 0x4c, 0x18, 0xe5, 0x1b, 0xf9, 0xf1, 0xa9, 0x82};
  lwmqtt_string_t topic_filter_s0 = {22, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x54, 0x8c, 0x71, 0x6f};
  lwmqtt_string_t topic_filter_s1 = {4, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x80, 0x6b, 0xac, 0xa7, 0xb4, 0xeb, 0x90, 0xde, 0xd,  0x81, 0xfe,
                                     0x3f, 0x2c, 0x98, 0xbb, 0x2b, 0xe4, 0xb2, 0x46, 0xc2, 0xe1};
  lwmqtt_string_t topic_filter_s2 = {21, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0xf4, 0x18, 0xe6, 0x2f, 0xf6, 0x58, 0xf7, 0x31, 0x2c, 0xd0, 0xde, 0xeb, 0x28,
                                     0xdb, 0x25, 0xf6, 0xac, 0xe1, 0xfe, 0xbf, 0xbd, 0x7c, 0xda, 0x27, 0xfd};
  lwmqtt_string_t topic_filter_s3 = {25, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5,  0x85, 0xb2, 0x4,  0xf1, 0x87, 0xde, 0xc9, 0xdc,
                                     0xa4, 0x33, 0xb3, 0x9d, 0xde, 0x54, 0xbd, 0xfd};
  lwmqtt_string_t topic_filter_s4 = {17, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x17, 0x14, 0x9f, 0xd2, 0x17, 0x30, 0xda, 0xd5, 0x3b, 0xb4,
                                     0x19, 0xe3, 0xf4, 0x4c, 0x72, 0xf5, 0x4,  0x6e, 0x0,  0x68};
  lwmqtt_string_t topic_filter_s5 = {20, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0xad, 0x2e, 0x4e, 0xa,  0x7e, 0xdb, 0x6f, 0xd6, 0xcd, 0xa7, 0xbe,
                                     0x8b, 0xc4, 0xb9, 0xf6, 0xae, 0x33, 0x2,  0xd7, 0xeb, 0x87, 0x61};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0xac, 0x67, 0x8,  0x41, 0x75, 0xbb, 0x72, 0x7,  0x75,
                                     0x2d, 0x14, 0x21, 0x21, 0x56, 0x77, 0x20, 0x7c, 0x78};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd3, 0x36, 0xaf, 0xb4, 0x63, 0x99, 0xbb, 0x73, 0x0,  0xb,  0x8c, 0x45, 0x6d,
                                     0xd7, 0x90, 0xf4, 0x33, 0x7c, 0xf6, 0x1b, 0x26, 0xef, 0x74, 0x44, 0xf3, 0xef};
  lwmqtt_string_t topic_filter_s8 = {26, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  uint8_t topic_filter_s9_bytes[] = {0x5d, 0x1f, 0xe2, 0x41, 0xa5, 0x5c, 0x7c, 0xce, 0x55,
                                     0x36, 0xf9, 0x64, 0x90, 0xf1, 0x4f, 0x6e, 0x2d, 0x99};
  lwmqtt_string_t topic_filter_s9 = {18, (char*)&topic_filter_s9_bytes};
  topic_filters[9] = topic_filter_s9;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 14034, 10, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 22538 ["O\215\150\139h\178\159\233Bf\234x\tp\206\198\147s\142\236\132\SYN\221f\DELN\NAK\228\133"]
// [PropWillDelayInterval 17254,PropWildcardSubscriptionAvailable 120,PropSharedSubscriptionAvailable
// 61,PropUserProperty "\147\245\158\ENQ\220\244\DC1V\240\NUL\186W"
// "&\154\236~;t\US[\FS\211\184K\153u\233[\238n\182[\134G",PropResponseInformation "*\EM)5D6\136",PropMaximumQoS
// 78,PropReceiveMaximum 25530]
TEST(Unsubscribe5QCTest, Encode26) {
  uint8_t pkt[] = {0xa2, 0x61, 0x58, 0xa,  0x3f, 0x18, 0x0,  0x0,  0x43, 0x66, 0x28, 0x78, 0x2a, 0x3d, 0x26, 0x0,  0xc,
                   0x93, 0xf5, 0x9e, 0x5,  0xdc, 0xf4, 0x11, 0x56, 0xf0, 0x0,  0xba, 0x57, 0x0,  0x16, 0x26, 0x9a, 0xec,
                   0x7e, 0x3b, 0x74, 0x1f, 0x5b, 0x1c, 0xd3, 0xb8, 0x4b, 0x99, 0x75, 0xe9, 0x5b, 0xee, 0x6e, 0xb6, 0x5b,
                   0x86, 0x47, 0x1a, 0x0,  0x7,  0x2a, 0x19, 0x29, 0x35, 0x44, 0x36, 0x88, 0x24, 0x4e, 0x21, 0x63, 0xba,
                   0x0,  0x1d, 0x4f, 0xd7, 0x96, 0x8b, 0x68, 0xb2, 0x9f, 0xe9, 0x42, 0x66, 0xea, 0x78, 0x9,  0x70, 0xce,
                   0xc6, 0x93, 0x73, 0x8e, 0xec, 0x84, 0x16, 0xdd, 0x66, 0x7f, 0x4e, 0x15, 0xe4, 0x85};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x26, 0x9a, 0xec, 0x7e, 0x3b, 0x74, 0x1f, 0x5b, 0x1c, 0xd3, 0xb8,
                           0x4b, 0x99, 0x75, 0xe9, 0x5b, 0xee, 0x6e, 0xb6, 0x5b, 0x86, 0x47};
  uint8_t bytesprops0[] = {0x93, 0xf5, 0x9e, 0x5, 0xdc, 0xf4, 0x11, 0x56, 0xf0, 0x0, 0xba, 0x57};
  uint8_t bytesprops2[] = {0x2a, 0x19, 0x29, 0x35, 0x44, 0x36, 0x88};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 17254}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 120}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 61}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops0}, .v = {22, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {7, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 25530}},
  };

  lwmqtt_properties_t props = {7, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[1];
  uint8_t topic_filter_s0_bytes[] = {0x4f, 0xd7, 0x96, 0x8b, 0x68, 0xb2, 0x9f, 0xe9, 0x42, 0x66,
                                     0xea, 0x78, 0x9,  0x70, 0xce, 0xc6, 0x93, 0x73, 0x8e, 0xec,
                                     0x84, 0x16, 0xdd, 0x66, 0x7f, 0x4e, 0x15, 0xe4, 0x85};
  lwmqtt_string_t topic_filter_s0 = {29, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 22538, 1, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 30444
// ["GX)\EOT\193\GS\201A\196\169\SYN\180","\192\194c\139X\215\204<\ba\143\240^\173\198\169V\USFt\229\141;\n\223\215t","\228&\240","","R\164}j.u4\218\129\170\245j\245\192)\196","i\183\181;\182\142C","0|?r?\191\EOT==o\244\243@\198\NAK\218\155\158\NUL\151\184z","v\202.j\238\248\163T\167\148\158dl\249T\228Iv"]
// [PropWillDelayInterval 11257,PropTopicAliasMaximum 19369,PropResponseInformation
// "\vH\153\209\&5I\213\179\159\197\155%"]
TEST(Unsubscribe5QCTest, Encode27) {
  uint8_t pkt[] = {0xa2, 0x93, 0x1,  0x76, 0xec, 0x17, 0x18, 0x0,  0x0,  0x2b, 0xf9, 0x22, 0x4b, 0xa9, 0x1a, 0x0,  0xc,
                   0xb,  0x48, 0x99, 0xd1, 0x35, 0x49, 0xd5, 0xb3, 0x9f, 0xc5, 0x9b, 0x25, 0x0,  0xc,  0x47, 0x58, 0x29,
                   0x4,  0xc1, 0x1d, 0xc9, 0x41, 0xc4, 0xa9, 0x16, 0xb4, 0x0,  0x1b, 0xc0, 0xc2, 0x63, 0x8b, 0x58, 0xd7,
                   0xcc, 0x3c, 0x8,  0x61, 0x8f, 0xf0, 0x5e, 0xad, 0xc6, 0xa9, 0x56, 0x1f, 0x46, 0x74, 0xe5, 0x8d, 0x3b,
                   0xa,  0xdf, 0xd7, 0x74, 0x0,  0x3,  0xe4, 0x26, 0xf0, 0x0,  0x0,  0x0,  0x10, 0x52, 0xa4, 0x7d, 0x6a,
                   0x2e, 0x75, 0x34, 0xda, 0x81, 0xaa, 0xf5, 0x6a, 0xf5, 0xc0, 0x29, 0xc4, 0x0,  0x7,  0x69, 0xb7, 0xb5,
                   0x3b, 0xb6, 0x8e, 0x43, 0x0,  0x16, 0x30, 0x7c, 0x3f, 0x72, 0x3f, 0xbf, 0x4,  0x3d, 0x3d, 0x6f, 0xf4,
                   0xf3, 0x40, 0xc6, 0x15, 0xda, 0x9b, 0x9e, 0x0,  0x97, 0xb8, 0x7a, 0x0,  0x12, 0x76, 0xca, 0x2e, 0x6a,
                   0xee, 0xf8, 0xa3, 0x54, 0xa7, 0x94, 0x9e, 0x64, 0x6c, 0xf9, 0x54, 0xe4, 0x49, 0x76};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb, 0x48, 0x99, 0xd1, 0x35, 0x49, 0xd5, 0xb3, 0x9f, 0xc5, 0x9b, 0x25};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 11257}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19369}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {3, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[8];
  uint8_t topic_filter_s0_bytes[] = {0x47, 0x58, 0x29, 0x4, 0xc1, 0x1d, 0xc9, 0x41, 0xc4, 0xa9, 0x16, 0xb4};
  lwmqtt_string_t topic_filter_s0 = {12, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0xc0, 0xc2, 0x63, 0x8b, 0x58, 0xd7, 0xcc, 0x3c, 0x8,  0x61, 0x8f, 0xf0, 0x5e, 0xad,
                                     0xc6, 0xa9, 0x56, 0x1f, 0x46, 0x74, 0xe5, 0x8d, 0x3b, 0xa,  0xdf, 0xd7, 0x74};
  lwmqtt_string_t topic_filter_s1 = {27, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe4, 0x26, 0xf0};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0};
  lwmqtt_string_t topic_filter_s3 = {0, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x52, 0xa4, 0x7d, 0x6a, 0x2e, 0x75, 0x34, 0xda,
                                     0x81, 0xaa, 0xf5, 0x6a, 0xf5, 0xc0, 0x29, 0xc4};
  lwmqtt_string_t topic_filter_s4 = {16, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x69, 0xb7, 0xb5, 0x3b, 0xb6, 0x8e, 0x43};
  lwmqtt_string_t topic_filter_s5 = {7, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x30, 0x7c, 0x3f, 0x72, 0x3f, 0xbf, 0x4,  0x3d, 0x3d, 0x6f, 0xf4,
                                     0xf3, 0x40, 0xc6, 0x15, 0xda, 0x9b, 0x9e, 0x0,  0x97, 0xb8, 0x7a};
  lwmqtt_string_t topic_filter_s6 = {22, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x76, 0xca, 0x2e, 0x6a, 0xee, 0xf8, 0xa3, 0x54, 0xa7,
                                     0x94, 0x9e, 0x64, 0x6c, 0xf9, 0x54, 0xe4, 0x49, 0x76};
  lwmqtt_string_t topic_filter_s7 = {18, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 30444, 8, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 10904
// ["\158\151(tQ&M3?\234\162qjZ\ENQ\146wd\180\249\&0","\148\148\181'\255Q\247\ETB\218\ESC\136\SYN\a\213\151t\229az1\208\253","z\245\157\159\151\241\225%\SOH^\129`\166\168\252\172\135}","|\SOq\189\SO","\ENQi\226\n}\143\149O\235\&1\SOHN\241\252\183GG\136\142"]
// [PropSubscriptionIdentifier 3,PropSharedSubscriptionAvailable 112,PropAssignedClientIdentifier
// "\235nn\FS\208o\211\167We\172\224",PropResponseTopic
// "\233\173\232\r\185\218\161\200#\179\SOH\SO\DLE\SUB3\171\&4)@\137\198\"\182\EM-\238]\162",PropMessageExpiryInterval
// 25344,PropRequestProblemInformation 184,PropPayloadFormatIndicator 144,PropReceiveMaximum
// 8063,PropWildcardSubscriptionAvailable 56,PropTopicAlias 15484,PropReceiveMaximum 6258,PropTopicAliasMaximum
// 12379,PropMessageExpiryInterval 28859]
TEST(Unsubscribe5QCTest, Encode28) {
  uint8_t pkt[] = {0xa2, 0xb0, 0x1,  0x2a, 0x98, 0x4e, 0xb,  0x3,  0x2a, 0x70, 0x12, 0x0,  0xc,  0xeb, 0x6e, 0x6e, 0x1c,
                   0xd0, 0x6f, 0xd3, 0xa7, 0x57, 0x65, 0xac, 0xe0, 0x8,  0x0,  0x1c, 0xe9, 0xad, 0xe8, 0xd,  0xb9, 0xda,
                   0xa1, 0xc8, 0x23, 0xb3, 0x1,  0xe,  0x10, 0x1a, 0x33, 0xab, 0x34, 0x29, 0x40, 0x89, 0xc6, 0x22, 0xb6,
                   0x19, 0x2d, 0xee, 0x5d, 0xa2, 0x2,  0x0,  0x0,  0x63, 0x0,  0x17, 0xb8, 0x1,  0x90, 0x21, 0x1f, 0x7f,
                   0x28, 0x38, 0x23, 0x3c, 0x7c, 0x21, 0x18, 0x72, 0x22, 0x30, 0x5b, 0x2,  0x0,  0x0,  0x70, 0xbb, 0x0,
                   0x15, 0x9e, 0x97, 0x28, 0x74, 0x51, 0x26, 0x4d, 0x33, 0x3f, 0xea, 0xa2, 0x71, 0x6a, 0x5a, 0x5,  0x92,
                   0x77, 0x64, 0xb4, 0xf9, 0x30, 0x0,  0x16, 0x94, 0x94, 0xb5, 0x27, 0xff, 0x51, 0xf7, 0x17, 0xda, 0x1b,
                   0x88, 0x16, 0x7,  0xd5, 0x97, 0x74, 0xe5, 0x61, 0x7a, 0x31, 0xd0, 0xfd, 0x0,  0x12, 0x7a, 0xf5, 0x9d,
                   0x9f, 0x97, 0xf1, 0xe1, 0x25, 0x1,  0x5e, 0x81, 0x60, 0xa6, 0xa8, 0xfc, 0xac, 0x87, 0x7d, 0x0,  0x5,
                   0x7c, 0xe,  0x71, 0xbd, 0xe,  0x0,  0x13, 0x5,  0x69, 0xe2, 0xa,  0x7d, 0x8f, 0x95, 0x4f, 0xeb, 0x31,
                   0x1,  0x4e, 0xf1, 0xfc, 0xb7, 0x47, 0x47, 0x88, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xeb, 0x6e, 0x6e, 0x1c, 0xd0, 0x6f, 0xd3, 0xa7, 0x57, 0x65, 0xac, 0xe0};
  uint8_t bytesprops1[] = {0xe9, 0xad, 0xe8, 0xd,  0xb9, 0xda, 0xa1, 0xc8, 0x23, 0xb3, 0x1,  0xe,  0x10, 0x1a,
                           0x33, 0xab, 0x34, 0x29, 0x40, 0x89, 0xc6, 0x22, 0xb6, 0x19, 0x2d, 0xee, 0x5d, 0xa2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 3}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 112}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25344}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 144}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8063}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 56}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 15484}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 6258}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12379}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28859}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[5];
  uint8_t topic_filter_s0_bytes[] = {0x9e, 0x97, 0x28, 0x74, 0x51, 0x26, 0x4d, 0x33, 0x3f, 0xea, 0xa2,
                                     0x71, 0x6a, 0x5a, 0x5,  0x92, 0x77, 0x64, 0xb4, 0xf9, 0x30};
  lwmqtt_string_t topic_filter_s0 = {21, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x94, 0x94, 0xb5, 0x27, 0xff, 0x51, 0xf7, 0x17, 0xda, 0x1b, 0x88,
                                     0x16, 0x7,  0xd5, 0x97, 0x74, 0xe5, 0x61, 0x7a, 0x31, 0xd0, 0xfd};
  lwmqtt_string_t topic_filter_s1 = {22, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0x7a, 0xf5, 0x9d, 0x9f, 0x97, 0xf1, 0xe1, 0x25, 0x1,
                                     0x5e, 0x81, 0x60, 0xa6, 0xa8, 0xfc, 0xac, 0x87, 0x7d};
  lwmqtt_string_t topic_filter_s2 = {18, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x7c, 0xe, 0x71, 0xbd, 0xe};
  lwmqtt_string_t topic_filter_s3 = {5, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x5, 0x69, 0xe2, 0xa,  0x7d, 0x8f, 0x95, 0x4f, 0xeb, 0x31,
                                     0x1, 0x4e, 0xf1, 0xfc, 0xb7, 0x47, 0x47, 0x88, 0x8e};
  lwmqtt_string_t topic_filter_s4 = {19, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 10904, 5, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 5483
// ["","\RSY|\167.\233=\245U,\193\250.\241\&8]Z\239\EOTi\DC2\193\235\212","\233\251\197\179\CAN\205\158\160\250\133\254\220\DC3\236\149k\249,w\223yf\239\240\193\&2\SO","1;\224awQA\b\129m\211-\177#y\130L;%\227\202'","\129\143;\208\166\210!h@\133","\212\213jo\156\238\193\DC2\188o\254\NUL\219\202","(\182Q\ENQ\158\220\233\233\228\196\226\218\163"]
// [PropUserProperty "h\205\&2\188\249uu\225"
// "K\190\140\234t\134\NAKX\141\201\185\188\230\&8\211\SUB\170e\194Q\b\235/\161\140y",PropReceiveMaximum
// 28222,PropTopicAliasMaximum 18691,PropAuthenticationData
// "&\148\172\ACKQI)\203\DC3\193\212\176\ACKP",PropAuthenticationData
// "S\ax0\188=\236\&1C\DC2\156^\RSM",PropAuthenticationMethod "\fs\231\144\RS\233K\EMZ",PropAuthenticationData
// "\142\US\198\245A\180",PropReceiveMaximum 5487,PropWildcardSubscriptionAvailable 78,PropResponseInformation
// "\189\160\198",PropCorrelationData "R\170\137\155\151%=\SYN\EOT",PropMessageExpiryInterval
// 17502,PropMaximumPacketSize 31330,PropMaximumPacketSize 6043,PropResponseInformation
// "J~\249\234U,h0\141Kd\133L\151{C$\170C\136w\SUB\182\229",PropTopicAlias 30866,PropSharedSubscriptionAvailable
// 90,PropContentType "\137\164)\SOHa;\237\212\252\191Q\140B\nJ\"\EOT}\253\187\167",PropSharedSubscriptionAvailable
// 165,PropServerReference "Z\134v\144L\180\249]_\202%\222f7~U\DC1\198b\213\ACK\154\ACK@g",PropServerKeepAlive
// 21230,PropRequestProblemInformation 106,PropSubscriptionIdentifierAvailable 104,PropServerReference
// "\184*kb\NAKsf\138\145\225\240w\v\DEL]\227\212's\226\&2\169xF",PropAuthenticationMethod
// "\\\ESC\154wl\225F\142\146\201\217?`\235\201HT\136\US\t\254",PropMaximumPacketSize 11165,PropServerReference
// "\219\153\175\221\237\238m\216\200g",PropMaximumPacketSize 11614,PropPayloadFormatIndicator 95,PropTopicAliasMaximum
// 19880]
TEST(Unsubscribe5QCTest, Encode29) {
  uint8_t pkt[] = {
      0xa2, 0xb6, 0x3,  0x15, 0x6b, 0xb6, 0x2,  0x26, 0x0,  0x8,  0x68, 0xcd, 0x32, 0xbc, 0xf9, 0x75, 0x75, 0xe1, 0x0,
      0x1a, 0x4b, 0xbe, 0x8c, 0xea, 0x74, 0x86, 0x15, 0x58, 0x8d, 0xc9, 0xb9, 0xbc, 0xe6, 0x38, 0xd3, 0x1a, 0xaa, 0x65,
      0xc2, 0x51, 0x8,  0xeb, 0x2f, 0xa1, 0x8c, 0x79, 0x21, 0x6e, 0x3e, 0x22, 0x49, 0x3,  0x16, 0x0,  0xe,  0x26, 0x94,
      0xac, 0x6,  0x51, 0x49, 0x29, 0xcb, 0x13, 0xc1, 0xd4, 0xb0, 0x6,  0x50, 0x16, 0x0,  0xe,  0x53, 0x7,  0x78, 0x30,
      0xbc, 0x3d, 0xec, 0x31, 0x43, 0x12, 0x9c, 0x5e, 0x1e, 0x4d, 0x15, 0x0,  0x9,  0xc,  0x73, 0xe7, 0x90, 0x1e, 0xe9,
      0x4b, 0x19, 0x5a, 0x16, 0x0,  0x6,  0x8e, 0x1f, 0xc6, 0xf5, 0x41, 0xb4, 0x21, 0x15, 0x6f, 0x28, 0x4e, 0x1a, 0x0,
      0x3,  0xbd, 0xa0, 0xc6, 0x9,  0x0,  0x9,  0x52, 0xaa, 0x89, 0x9b, 0x97, 0x25, 0x3d, 0x16, 0x4,  0x2,  0x0,  0x0,
      0x44, 0x5e, 0x27, 0x0,  0x0,  0x7a, 0x62, 0x27, 0x0,  0x0,  0x17, 0x9b, 0x1a, 0x0,  0x18, 0x4a, 0x7e, 0xf9, 0xea,
      0x55, 0x2c, 0x68, 0x30, 0x8d, 0x4b, 0x64, 0x85, 0x4c, 0x97, 0x7b, 0x43, 0x24, 0xaa, 0x43, 0x88, 0x77, 0x1a, 0xb6,
      0xe5, 0x23, 0x78, 0x92, 0x2a, 0x5a, 0x3,  0x0,  0x15, 0x89, 0xa4, 0x29, 0x1,  0x61, 0x3b, 0xed, 0xd4, 0xfc, 0xbf,
      0x51, 0x8c, 0x42, 0xa,  0x4a, 0x22, 0x4,  0x7d, 0xfd, 0xbb, 0xa7, 0x2a, 0xa5, 0x1c, 0x0,  0x19, 0x5a, 0x86, 0x76,
      0x90, 0x4c, 0xb4, 0xf9, 0x5d, 0x5f, 0xca, 0x25, 0xde, 0x66, 0x37, 0x7e, 0x55, 0x11, 0xc6, 0x62, 0xd5, 0x6,  0x9a,
      0x6,  0x40, 0x67, 0x13, 0x52, 0xee, 0x17, 0x6a, 0x29, 0x68, 0x1c, 0x0,  0x18, 0xb8, 0x2a, 0x6b, 0x62, 0x15, 0x73,
      0x66, 0x8a, 0x91, 0xe1, 0xf0, 0x77, 0xb,  0x7f, 0x5d, 0xe3, 0xd4, 0x27, 0x73, 0xe2, 0x32, 0xa9, 0x78, 0x46, 0x15,
      0x0,  0x15, 0x5c, 0x1b, 0x9a, 0x77, 0x6c, 0xe1, 0x46, 0x8e, 0x92, 0xc9, 0xd9, 0x3f, 0x60, 0xeb, 0xc9, 0x48, 0x54,
      0x88, 0x1f, 0x9,  0xfe, 0x27, 0x0,  0x0,  0x2b, 0x9d, 0x1c, 0x0,  0xa,  0xdb, 0x99, 0xaf, 0xdd, 0xed, 0xee, 0x6d,
      0xd8, 0xc8, 0x67, 0x27, 0x0,  0x0,  0x2d, 0x5e, 0x1,  0x5f, 0x22, 0x4d, 0xa8, 0x0,  0x0,  0x0,  0x18, 0x1e, 0x59,
      0x7c, 0xa7, 0x2e, 0xe9, 0x3d, 0xf5, 0x55, 0x2c, 0xc1, 0xfa, 0x2e, 0xf1, 0x38, 0x5d, 0x5a, 0xef, 0x4,  0x69, 0x12,
      0xc1, 0xeb, 0xd4, 0x0,  0x1b, 0xe9, 0xfb, 0xc5, 0xb3, 0x18, 0xcd, 0x9e, 0xa0, 0xfa, 0x85, 0xfe, 0xdc, 0x13, 0xec,
      0x95, 0x6b, 0xf9, 0x2c, 0x77, 0xdf, 0x79, 0x66, 0xef, 0xf0, 0xc1, 0x32, 0xe,  0x0,  0x16, 0x31, 0x3b, 0xe0, 0x61,
      0x77, 0x51, 0x41, 0x8,  0x81, 0x6d, 0xd3, 0x2d, 0xb1, 0x23, 0x79, 0x82, 0x4c, 0x3b, 0x25, 0xe3, 0xca, 0x27, 0x0,
      0xa,  0x81, 0x8f, 0x3b, 0xd0, 0xa6, 0xd2, 0x21, 0x68, 0x40, 0x85, 0x0,  0xe,  0xd4, 0xd5, 0x6a, 0x6f, 0x9c, 0xee,
      0xc1, 0x12, 0xbc, 0x6f, 0xfe, 0x0,  0xdb, 0xca, 0x0,  0xd,  0x28, 0xb6, 0x51, 0x5,  0x9e, 0xdc, 0xe9, 0xe9, 0xe4,
      0xc4, 0xe2, 0xda, 0xa3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x4b, 0xbe, 0x8c, 0xea, 0x74, 0x86, 0x15, 0x58, 0x8d, 0xc9, 0xb9, 0xbc, 0xe6,
                           0x38, 0xd3, 0x1a, 0xaa, 0x65, 0xc2, 0x51, 0x8,  0xeb, 0x2f, 0xa1, 0x8c, 0x79};
  uint8_t bytesprops0[] = {0x68, 0xcd, 0x32, 0xbc, 0xf9, 0x75, 0x75, 0xe1};
  uint8_t bytesprops2[] = {0x26, 0x94, 0xac, 0x6, 0x51, 0x49, 0x29, 0xcb, 0x13, 0xc1, 0xd4, 0xb0, 0x6, 0x50};
  uint8_t bytesprops3[] = {0x53, 0x7, 0x78, 0x30, 0xbc, 0x3d, 0xec, 0x31, 0x43, 0x12, 0x9c, 0x5e, 0x1e, 0x4d};
  uint8_t bytesprops4[] = {0xc, 0x73, 0xe7, 0x90, 0x1e, 0xe9, 0x4b, 0x19, 0x5a};
  uint8_t bytesprops5[] = {0x8e, 0x1f, 0xc6, 0xf5, 0x41, 0xb4};
  uint8_t bytesprops6[] = {0xbd, 0xa0, 0xc6};
  uint8_t bytesprops7[] = {0x52, 0xaa, 0x89, 0x9b, 0x97, 0x25, 0x3d, 0x16, 0x4};
  uint8_t bytesprops8[] = {0x4a, 0x7e, 0xf9, 0xea, 0x55, 0x2c, 0x68, 0x30, 0x8d, 0x4b, 0x64, 0x85,
                           0x4c, 0x97, 0x7b, 0x43, 0x24, 0xaa, 0x43, 0x88, 0x77, 0x1a, 0xb6, 0xe5};
  uint8_t bytesprops9[] = {0x89, 0xa4, 0x29, 0x1,  0x61, 0x3b, 0xed, 0xd4, 0xfc, 0xbf, 0x51,
                           0x8c, 0x42, 0xa,  0x4a, 0x22, 0x4,  0x7d, 0xfd, 0xbb, 0xa7};
  uint8_t bytesprops10[] = {0x5a, 0x86, 0x76, 0x90, 0x4c, 0xb4, 0xf9, 0x5d, 0x5f, 0xca, 0x25, 0xde, 0x66,
                            0x37, 0x7e, 0x55, 0x11, 0xc6, 0x62, 0xd5, 0x6,  0x9a, 0x6,  0x40, 0x67};
  uint8_t bytesprops11[] = {0xb8, 0x2a, 0x6b, 0x62, 0x15, 0x73, 0x66, 0x8a, 0x91, 0xe1, 0xf0, 0x77,
                            0xb,  0x7f, 0x5d, 0xe3, 0xd4, 0x27, 0x73, 0xe2, 0x32, 0xa9, 0x78, 0x46};
  uint8_t bytesprops12[] = {0x5c, 0x1b, 0x9a, 0x77, 0x6c, 0xe1, 0x46, 0x8e, 0x92, 0xc9, 0xd9,
                            0x3f, 0x60, 0xeb, 0xc9, 0x48, 0x54, 0x88, 0x1f, 0x9,  0xfe};
  uint8_t bytesprops13[] = {0xdb, 0x99, 0xaf, 0xdd, 0xed, 0xee, 0x6d, 0xd8, 0xc8, 0x67};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {8, (char*)&bytesprops0}, .v = {26, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 28222}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18691}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {14, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {6, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5487}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 78}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 17502}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 31330}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6043}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 30866}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 90}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {25, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21230}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 106}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {24, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops12}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11165}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {10, (char*)&bytesprops13}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 11614}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 95}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19880}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[7];
  uint8_t topic_filter_s0_bytes[] = {0};
  lwmqtt_string_t topic_filter_s0 = {0, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x1e, 0x59, 0x7c, 0xa7, 0x2e, 0xe9, 0x3d, 0xf5, 0x55, 0x2c, 0xc1, 0xfa,
                                     0x2e, 0xf1, 0x38, 0x5d, 0x5a, 0xef, 0x4,  0x69, 0x12, 0xc1, 0xeb, 0xd4};
  lwmqtt_string_t topic_filter_s1 = {24, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xe9, 0xfb, 0xc5, 0xb3, 0x18, 0xcd, 0x9e, 0xa0, 0xfa, 0x85, 0xfe, 0xdc, 0x13, 0xec,
                                     0x95, 0x6b, 0xf9, 0x2c, 0x77, 0xdf, 0x79, 0x66, 0xef, 0xf0, 0xc1, 0x32, 0xe};
  lwmqtt_string_t topic_filter_s2 = {27, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x31, 0x3b, 0xe0, 0x61, 0x77, 0x51, 0x41, 0x8,  0x81, 0x6d, 0xd3,
                                     0x2d, 0xb1, 0x23, 0x79, 0x82, 0x4c, 0x3b, 0x25, 0xe3, 0xca, 0x27};
  lwmqtt_string_t topic_filter_s3 = {22, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0x81, 0x8f, 0x3b, 0xd0, 0xa6, 0xd2, 0x21, 0x68, 0x40, 0x85};
  lwmqtt_string_t topic_filter_s4 = {10, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0xd4, 0xd5, 0x6a, 0x6f, 0x9c, 0xee, 0xc1, 0x12, 0xbc, 0x6f, 0xfe, 0x0, 0xdb, 0xca};
  lwmqtt_string_t topic_filter_s5 = {14, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x28, 0xb6, 0x51, 0x5, 0x9e, 0xdc, 0xe9, 0xe9, 0xe4, 0xc4, 0xe2, 0xda, 0xa3};
  lwmqtt_string_t topic_filter_s6 = {13, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 5483, 7, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// UnsubscribeRequest 27410
// ["\142,\253\251\228\164\&6>\237\ETX\150\202\228\225\236\SUB\130}\144\142\196:\EOT","7$&\216\162\FSEn\RSsy\244]","\200\209D","\154,\164<","\211c\153","\DLE\221\175\212*","Pk)\217\129'\201\236\161\181o\176D\191L\241\158\153\EOT\228","#\231\205E\220\217&S\242","\211\145\204"]
// [PropMaximumPacketSize 25355,PropRetainAvailable 125,PropRetainAvailable 176,PropWillDelayInterval
// 6837,PropResponseInformation "\137\128\237q5K\SOE}{",PropCorrelationData
// "\224b#\254\157\&5`\ENQ]\128\GS\227@p\239",PropResponseInformation "\188",PropReasonString
// "\131o\165>A\196\165\n\139D \142\ACKjg",PropCorrelationData
// "P\STX{\US\ACKe\167\187/;\ah\134\160'\253\204",PropAuthenticationMethod
// "\224W\DLE$\223\242\a\FSU\245&\254\&1\251\SYN\t\218\222\&0XF\221;",PropSessionExpiryInterval
// 9119,PropSessionExpiryInterval 16118,PropServerKeepAlive 16036,PropMessageExpiryInterval
// 31819,PropAuthenticationMethod
// "\US\137DB7;\140\213\235\NUL&\NUL\162{\170\254C\192\207S\178;t\ENQ",PropMessageExpiryInterval
// 30475,PropServerReference
// "EK\\)\178\NUL\138\&4U\189]<>\163\232\147\244\204\&5;\n\241\169\193\SYN\211\245\DC2\211\180"]
TEST(Unsubscribe5QCTest, Encode30) {
  uint8_t pkt[] = {
      0xa2, 0xad, 0x2,  0x6b, 0x12, 0xc4, 0x1,  0x27, 0x0,  0x0,  0x63, 0xb,  0x25, 0x7d, 0x25, 0xb0, 0x18, 0x0,  0x0,
      0x1a, 0xb5, 0x1a, 0x0,  0xa,  0x89, 0x80, 0xed, 0x71, 0x35, 0x4b, 0xe,  0x45, 0x7d, 0x7b, 0x9,  0x0,  0xf,  0xe0,
      0x62, 0x23, 0xfe, 0x9d, 0x35, 0x60, 0x5,  0x5d, 0x80, 0x1d, 0xe3, 0x40, 0x70, 0xef, 0x1a, 0x0,  0x1,  0xbc, 0x1f,
      0x0,  0xf,  0x83, 0x6f, 0xa5, 0x3e, 0x41, 0xc4, 0xa5, 0xa,  0x8b, 0x44, 0x20, 0x8e, 0x6,  0x6a, 0x67, 0x9,  0x0,
      0x11, 0x50, 0x2,  0x7b, 0x1f, 0x6,  0x65, 0xa7, 0xbb, 0x2f, 0x3b, 0x7,  0x68, 0x86, 0xa0, 0x27, 0xfd, 0xcc, 0x15,
      0x0,  0x17, 0xe0, 0x57, 0x10, 0x24, 0xdf, 0xf2, 0x7,  0x1c, 0x55, 0xf5, 0x26, 0xfe, 0x31, 0xfb, 0x16, 0x9,  0xda,
      0xde, 0x30, 0x58, 0x46, 0xdd, 0x3b, 0x11, 0x0,  0x0,  0x23, 0x9f, 0x11, 0x0,  0x0,  0x3e, 0xf6, 0x13, 0x3e, 0xa4,
      0x2,  0x0,  0x0,  0x7c, 0x4b, 0x15, 0x0,  0x18, 0x1f, 0x89, 0x44, 0x42, 0x37, 0x3b, 0x8c, 0xd5, 0xeb, 0x0,  0x26,
      0x0,  0xa2, 0x7b, 0xaa, 0xfe, 0x43, 0xc0, 0xcf, 0x53, 0xb2, 0x3b, 0x74, 0x5,  0x2,  0x0,  0x0,  0x77, 0xb,  0x1c,
      0x0,  0x1e, 0x45, 0x4b, 0x5c, 0x29, 0xb2, 0x0,  0x8a, 0x34, 0x55, 0xbd, 0x5d, 0x3c, 0x3e, 0xa3, 0xe8, 0x93, 0xf4,
      0xcc, 0x35, 0x3b, 0xa,  0xf1, 0xa9, 0xc1, 0x16, 0xd3, 0xf5, 0x12, 0xd3, 0xb4, 0x0,  0x17, 0x8e, 0x2c, 0xfd, 0xfb,
      0xe4, 0xa4, 0x36, 0x3e, 0xed, 0x3,  0x96, 0xca, 0xe4, 0xe1, 0xec, 0x1a, 0x82, 0x7d, 0x90, 0x8e, 0xc4, 0x3a, 0x4,
      0x0,  0xd,  0x37, 0x24, 0x26, 0xd8, 0xa2, 0x1c, 0x45, 0x6e, 0x1e, 0x73, 0x79, 0xf4, 0x5d, 0x0,  0x3,  0xc8, 0xd1,
      0x44, 0x0,  0x4,  0x9a, 0x2c, 0xa4, 0x3c, 0x0,  0x3,  0xd3, 0x63, 0x99, 0x0,  0x5,  0x10, 0xdd, 0xaf, 0xd4, 0x2a,
      0x0,  0x14, 0x50, 0x6b, 0x29, 0xd9, 0x81, 0x27, 0xc9, 0xec, 0xa1, 0xb5, 0x6f, 0xb0, 0x44, 0xbf, 0x4c, 0xf1, 0x9e,
      0x99, 0x4,  0xe4, 0x0,  0x9,  0x23, 0xe7, 0xcd, 0x45, 0xdc, 0xd9, 0x26, 0x53, 0xf2, 0x0,  0x3,  0xd3, 0x91, 0xcc};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x89, 0x80, 0xed, 0x71, 0x35, 0x4b, 0xe, 0x45, 0x7d, 0x7b};
  uint8_t bytesprops1[] = {0xe0, 0x62, 0x23, 0xfe, 0x9d, 0x35, 0x60, 0x5, 0x5d, 0x80, 0x1d, 0xe3, 0x40, 0x70, 0xef};
  uint8_t bytesprops2[] = {0xbc};
  uint8_t bytesprops3[] = {0x83, 0x6f, 0xa5, 0x3e, 0x41, 0xc4, 0xa5, 0xa, 0x8b, 0x44, 0x20, 0x8e, 0x6, 0x6a, 0x67};
  uint8_t bytesprops4[] = {0x50, 0x2, 0x7b, 0x1f, 0x6,  0x65, 0xa7, 0xbb, 0x2f,
                           0x3b, 0x7, 0x68, 0x86, 0xa0, 0x27, 0xfd, 0xcc};
  uint8_t bytesprops5[] = {0xe0, 0x57, 0x10, 0x24, 0xdf, 0xf2, 0x7,  0x1c, 0x55, 0xf5, 0x26, 0xfe,
                           0x31, 0xfb, 0x16, 0x9,  0xda, 0xde, 0x30, 0x58, 0x46, 0xdd, 0x3b};
  uint8_t bytesprops6[] = {0x1f, 0x89, 0x44, 0x42, 0x37, 0x3b, 0x8c, 0xd5, 0xeb, 0x0,  0x26, 0x0,
                           0xa2, 0x7b, 0xaa, 0xfe, 0x43, 0xc0, 0xcf, 0x53, 0xb2, 0x3b, 0x74, 0x5};
  uint8_t bytesprops7[] = {0x45, 0x4b, 0x5c, 0x29, 0xb2, 0x0, 0x8a, 0x34, 0x55, 0xbd, 0x5d, 0x3c, 0x3e, 0xa3, 0xe8,
                           0x93, 0xf4, 0xcc, 0x35, 0x3b, 0xa, 0xf1, 0xa9, 0xc1, 0x16, 0xd3, 0xf5, 0x12, 0xd3, 0xb4};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25355}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 125}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 176}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 6837}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {15, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {23, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 9119}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16118}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 16036}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31819}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30475}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {17, (lwmqtt_property_t*)&propslist};
  lwmqtt_string_t topic_filters[9];
  uint8_t topic_filter_s0_bytes[] = {0x8e, 0x2c, 0xfd, 0xfb, 0xe4, 0xa4, 0x36, 0x3e, 0xed, 0x3,  0x96, 0xca,
                                     0xe4, 0xe1, 0xec, 0x1a, 0x82, 0x7d, 0x90, 0x8e, 0xc4, 0x3a, 0x4};
  lwmqtt_string_t topic_filter_s0 = {23, (char*)&topic_filter_s0_bytes};
  topic_filters[0] = topic_filter_s0;
  uint8_t topic_filter_s1_bytes[] = {0x37, 0x24, 0x26, 0xd8, 0xa2, 0x1c, 0x45, 0x6e, 0x1e, 0x73, 0x79, 0xf4, 0x5d};
  lwmqtt_string_t topic_filter_s1 = {13, (char*)&topic_filter_s1_bytes};
  topic_filters[1] = topic_filter_s1;
  uint8_t topic_filter_s2_bytes[] = {0xc8, 0xd1, 0x44};
  lwmqtt_string_t topic_filter_s2 = {3, (char*)&topic_filter_s2_bytes};
  topic_filters[2] = topic_filter_s2;
  uint8_t topic_filter_s3_bytes[] = {0x9a, 0x2c, 0xa4, 0x3c};
  lwmqtt_string_t topic_filter_s3 = {4, (char*)&topic_filter_s3_bytes};
  topic_filters[3] = topic_filter_s3;
  uint8_t topic_filter_s4_bytes[] = {0xd3, 0x63, 0x99};
  lwmqtt_string_t topic_filter_s4 = {3, (char*)&topic_filter_s4_bytes};
  topic_filters[4] = topic_filter_s4;
  uint8_t topic_filter_s5_bytes[] = {0x10, 0xdd, 0xaf, 0xd4, 0x2a};
  lwmqtt_string_t topic_filter_s5 = {5, (char*)&topic_filter_s5_bytes};
  topic_filters[5] = topic_filter_s5;
  uint8_t topic_filter_s6_bytes[] = {0x50, 0x6b, 0x29, 0xd9, 0x81, 0x27, 0xc9, 0xec, 0xa1, 0xb5,
                                     0x6f, 0xb0, 0x44, 0xbf, 0x4c, 0xf1, 0x9e, 0x99, 0x4,  0xe4};
  lwmqtt_string_t topic_filter_s6 = {20, (char*)&topic_filter_s6_bytes};
  topic_filters[6] = topic_filter_s6;
  uint8_t topic_filter_s7_bytes[] = {0x23, 0xe7, 0xcd, 0x45, 0xdc, 0xd9, 0x26, 0x53, 0xf2};
  lwmqtt_string_t topic_filter_s7 = {9, (char*)&topic_filter_s7_bytes};
  topic_filters[7] = topic_filter_s7;
  uint8_t topic_filter_s8_bytes[] = {0xd3, 0x91, 0xcc};
  lwmqtt_string_t topic_filter_s8 = {3, (char*)&topic_filter_s8_bytes};
  topic_filters[8] = topic_filter_s8;
  size_t len;
  lwmqtt_err_t err = lwmqtt_encode_unsubscribe(buf, sizeof(buf), &len, LWMQTT_MQTT5, 27410, 9, topic_filters, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection []
TEST(Disco311QCTest, Encode1) {
  uint8_t pkt[] = {0xe0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT311, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNormalDisconnection []
TEST(Disco311QCTest, Encode2) {
  uint8_t pkt[] = {0xe0, 0x0};
  uint8_t buf[sizeof(pkt) + 10] = {0};

  lwmqtt_property_t propslist[] = {};

  lwmqtt_properties_t props = {0, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT311, 0, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServerMoved [PropAssignedClientIdentifier
// "\136h8s\245\148b\RS\211\129\135\138\SI\212\142\187\155\217:\220.\149f\FS\159[/\147\136\t",PropServerReference
// "\245\214\DC2q\254\171\SO\195\152\EOT\208\224z\236\SI\212lK^\253\211\208\170",PropReasonString
// "95Z\190\237\166\190Xy\187\196\170",PropServerReference
// "\133\177\221n\140\&1\239\157\ACK\148\ACK\136^\SOH\142C",PropResponseTopic
// "2&\ETX\151\DC1'\234\210Jve\168!z\181\\<\a\158\&8\SO",PropReceiveMaximum 20949,PropRetainAvailable
// 231,PropCorrelationData
// "y\GS\142\249\DC48P.\n\164'\138\DC1D.'\210{\STX\158\251KM\243\234\165",PropSubscriptionIdentifierAvailable
// 187,PropMessageExpiryInterval 19805,PropTopicAlias 27535,PropMessageExpiryInterval 23453,PropMessageExpiryInterval
// 9517,PropServerReference "\148$`\177",PropContentType "\214A",PropReasonString "\184H\169",PropPayloadFormatIndicator
// 104,PropMessageExpiryInterval 14956,PropSessionExpiryInterval 15208,PropWildcardSubscriptionAvailable
// 53,PropMaximumQoS 237,PropTopicAlias 7810,PropSessionExpiryInterval 3612,PropMaximumPacketSize
// 28521,PropResponseInformation "\188C|\137W\183\t\ENQ\155\&81\172^b\SUB\165\155&\SO\227"]
TEST(Disco5QCTest, Encode1) {
  uint8_t pkt[] = {
      0xe0, 0xf4, 0x1,  0x9d, 0xf1, 0x1,  0x12, 0x0,  0x1e, 0x88, 0x68, 0x38, 0x73, 0xf5, 0x94, 0x62, 0x1e, 0xd3, 0x81,
      0x87, 0x8a, 0xf,  0xd4, 0x8e, 0xbb, 0x9b, 0xd9, 0x3a, 0xdc, 0x2e, 0x95, 0x66, 0x1c, 0x9f, 0x5b, 0x2f, 0x93, 0x88,
      0x9,  0x1c, 0x0,  0x17, 0xf5, 0xd6, 0x12, 0x71, 0xfe, 0xab, 0xe,  0xc3, 0x98, 0x4,  0xd0, 0xe0, 0x7a, 0xec, 0xf,
      0xd4, 0x6c, 0x4b, 0x5e, 0xfd, 0xd3, 0xd0, 0xaa, 0x1f, 0x0,  0xc,  0x39, 0x35, 0x5a, 0xbe, 0xed, 0xa6, 0xbe, 0x58,
      0x79, 0xbb, 0xc4, 0xaa, 0x1c, 0x0,  0x10, 0x85, 0xb1, 0xdd, 0x6e, 0x8c, 0x31, 0xef, 0x9d, 0x6,  0x94, 0x6,  0x88,
      0x5e, 0x1,  0x8e, 0x43, 0x8,  0x0,  0x15, 0x32, 0x26, 0x3,  0x97, 0x11, 0x27, 0xea, 0xd2, 0x4a, 0x76, 0x65, 0xa8,
      0x21, 0x7a, 0xb5, 0x5c, 0x3c, 0x7,  0x9e, 0x38, 0xe,  0x21, 0x51, 0xd5, 0x25, 0xe7, 0x9,  0x0,  0x1a, 0x79, 0x1d,
      0x8e, 0xf9, 0x14, 0x38, 0x50, 0x2e, 0xa,  0xa4, 0x27, 0x8a, 0x11, 0x44, 0x2e, 0x27, 0xd2, 0x7b, 0x2,  0x9e, 0xfb,
      0x4b, 0x4d, 0xf3, 0xea, 0xa5, 0x29, 0xbb, 0x2,  0x0,  0x0,  0x4d, 0x5d, 0x23, 0x6b, 0x8f, 0x2,  0x0,  0x0,  0x5b,
      0x9d, 0x2,  0x0,  0x0,  0x25, 0x2d, 0x1c, 0x0,  0x4,  0x94, 0x24, 0x60, 0xb1, 0x3,  0x0,  0x2,  0xd6, 0x41, 0x1f,
      0x0,  0x3,  0xb8, 0x48, 0xa9, 0x1,  0x68, 0x2,  0x0,  0x0,  0x3a, 0x6c, 0x11, 0x0,  0x0,  0x3b, 0x68, 0x28, 0x35,
      0x24, 0xed, 0x23, 0x1e, 0x82, 0x11, 0x0,  0x0,  0xe,  0x1c, 0x27, 0x0,  0x0,  0x6f, 0x69, 0x1a, 0x0,  0x14, 0xbc,
      0x43, 0x7c, 0x89, 0x57, 0xb7, 0x9,  0x5,  0x9b, 0x38, 0x31, 0xac, 0x5e, 0x62, 0x1a, 0xa5, 0x9b, 0x26, 0xe,  0xe3};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x88, 0x68, 0x38, 0x73, 0xf5, 0x94, 0x62, 0x1e, 0xd3, 0x81, 0x87, 0x8a, 0xf,  0xd4, 0x8e,
                           0xbb, 0x9b, 0xd9, 0x3a, 0xdc, 0x2e, 0x95, 0x66, 0x1c, 0x9f, 0x5b, 0x2f, 0x93, 0x88, 0x9};
  uint8_t bytesprops1[] = {0xf5, 0xd6, 0x12, 0x71, 0xfe, 0xab, 0xe,  0xc3, 0x98, 0x4,  0xd0, 0xe0,
                           0x7a, 0xec, 0xf,  0xd4, 0x6c, 0x4b, 0x5e, 0xfd, 0xd3, 0xd0, 0xaa};
  uint8_t bytesprops2[] = {0x39, 0x35, 0x5a, 0xbe, 0xed, 0xa6, 0xbe, 0x58, 0x79, 0xbb, 0xc4, 0xaa};
  uint8_t bytesprops3[] = {0x85, 0xb1, 0xdd, 0x6e, 0x8c, 0x31, 0xef, 0x9d, 0x6, 0x94, 0x6, 0x88, 0x5e, 0x1, 0x8e, 0x43};
  uint8_t bytesprops4[] = {0x32, 0x26, 0x3,  0x97, 0x11, 0x27, 0xea, 0xd2, 0x4a, 0x76, 0x65,
                           0xa8, 0x21, 0x7a, 0xb5, 0x5c, 0x3c, 0x7,  0x9e, 0x38, 0xe};
  uint8_t bytesprops5[] = {0x79, 0x1d, 0x8e, 0xf9, 0x14, 0x38, 0x50, 0x2e, 0xa,  0xa4, 0x27, 0x8a, 0x11,
                           0x44, 0x2e, 0x27, 0xd2, 0x7b, 0x2,  0x9e, 0xfb, 0x4b, 0x4d, 0xf3, 0xea, 0xa5};
  uint8_t bytesprops6[] = {0x94, 0x24, 0x60, 0xb1};
  uint8_t bytesprops7[] = {0xd6, 0x41};
  uint8_t bytesprops8[] = {0xb8, 0x48, 0xa9};
  uint8_t bytesprops9[] = {0xbc, 0x43, 0x7c, 0x89, 0x57, 0xb7, 0x9,  0x5,  0x9b, 0x38,
                           0x31, 0xac, 0x5e, 0x62, 0x1a, 0xa5, 0x9b, 0x26, 0xe,  0xe3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {30, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 20949}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 231}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 187}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 19805}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 27535}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23453}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 9517}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 104}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14956}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 15208}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7810}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3612}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 28521}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {20, (char*)&bytesprops9}}},
  };

  lwmqtt_properties_t props = {25, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 157, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNotAuthorized [PropReceiveMaximum 2365,PropAuthenticationMethod
// "9\185\198@\189q\ESC\180\156Z\147\151y\248\231\152\139k7\131\182\219\210#\130\252\ENQ"]
TEST(Disco5QCTest, Encode2) {
  uint8_t pkt[] = {0xe0, 0x23, 0x87, 0x21, 0x21, 0x9,  0x3d, 0x15, 0x0,  0x1b, 0x39, 0xb9, 0xc6,
                   0x40, 0xbd, 0x71, 0x1b, 0xb4, 0x9c, 0x5a, 0x93, 0x97, 0x79, 0xf8, 0xe7, 0x98,
                   0x8b, 0x6b, 0x37, 0x83, 0xb6, 0xdb, 0xd2, 0x23, 0x82, 0xfc, 0x5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x39, 0xb9, 0xc6, 0x40, 0xbd, 0x71, 0x1b, 0xb4, 0x9c, 0x5a, 0x93, 0x97, 0x79, 0xf8,
                           0xe7, 0x98, 0x8b, 0x6b, 0x37, 0x83, 0xb6, 0xdb, 0xd2, 0x23, 0x82, 0xfc, 0x5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 2365}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 135, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoQuotaExceeded [PropTopicAliasMaximum 15799,PropTopicAlias 2831,PropResponseInformation
// "\STX\163Q\131",PropSubscriptionIdentifierAvailable 184,PropAuthenticationMethod
// "\168\170\247\154\EM\145;\SO;\EM\166G\190`\149s\224\240\DELh\203@H\US-b\150",PropReasonString
// "\250\137;4\193\169\tvr_Q8\EOT\253\&4\214\189/\153!\DLE\DC4\135\207Fa\205b",PropPayloadFormatIndicator
// 155,PropWillDelayInterval 27802,PropMessageExpiryInterval 31388,PropResponseTopic
// "\128\165\224V<\"4-\133\a\161\253!\156\134X&\DC4,I.\180",PropAuthenticationData "Lp\145\249m{|\216\132Z\190\SOH\156"]
TEST(Disco5QCTest, Encode3) {
  uint8_t pkt[] = {0xe0, 0x84, 0x1,  0x97, 0x81, 0x1,  0x22, 0x3d, 0xb7, 0x23, 0xb,  0xf,  0x1a, 0x0,  0x4,  0x2,  0xa3,
                   0x51, 0x83, 0x29, 0xb8, 0x15, 0x0,  0x1b, 0xa8, 0xaa, 0xf7, 0x9a, 0x19, 0x91, 0x3b, 0xe,  0x3b, 0x19,
                   0xa6, 0x47, 0xbe, 0x60, 0x95, 0x73, 0xe0, 0xf0, 0x7f, 0x68, 0xcb, 0x40, 0x48, 0x1f, 0x2d, 0x62, 0x96,
                   0x1f, 0x0,  0x1c, 0xfa, 0x89, 0x3b, 0x34, 0xc1, 0xa9, 0x9,  0x76, 0x72, 0x5f, 0x51, 0x38, 0x4,  0xfd,
                   0x34, 0xd6, 0xbd, 0x2f, 0x99, 0x21, 0x10, 0x14, 0x87, 0xcf, 0x46, 0x61, 0xcd, 0x62, 0x1,  0x9b, 0x18,
                   0x0,  0x0,  0x6c, 0x9a, 0x2,  0x0,  0x0,  0x7a, 0x9c, 0x8,  0x0,  0x16, 0x80, 0xa5, 0xe0, 0x56, 0x3c,
                   0x22, 0x34, 0x2d, 0x85, 0x7,  0xa1, 0xfd, 0x21, 0x9c, 0x86, 0x58, 0x26, 0x14, 0x2c, 0x49, 0x2e, 0xb4,
                   0x16, 0x0,  0xd,  0x4c, 0x70, 0x91, 0xf9, 0x6d, 0x7b, 0x7c, 0xd8, 0x84, 0x5a, 0xbe, 0x1,  0x9c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2, 0xa3, 0x51, 0x83};
  uint8_t bytesprops1[] = {0xa8, 0xaa, 0xf7, 0x9a, 0x19, 0x91, 0x3b, 0xe,  0x3b, 0x19, 0xa6, 0x47, 0xbe, 0x60,
                           0x95, 0x73, 0xe0, 0xf0, 0x7f, 0x68, 0xcb, 0x40, 0x48, 0x1f, 0x2d, 0x62, 0x96};
  uint8_t bytesprops2[] = {0xfa, 0x89, 0x3b, 0x34, 0xc1, 0xa9, 0x9,  0x76, 0x72, 0x5f, 0x51, 0x38, 0x4,  0xfd,
                           0x34, 0xd6, 0xbd, 0x2f, 0x99, 0x21, 0x10, 0x14, 0x87, 0xcf, 0x46, 0x61, 0xcd, 0x62};
  uint8_t bytesprops3[] = {0x80, 0xa5, 0xe0, 0x56, 0x3c, 0x22, 0x34, 0x2d, 0x85, 0x7,  0xa1,
                           0xfd, 0x21, 0x9c, 0x86, 0x58, 0x26, 0x14, 0x2c, 0x49, 0x2e, 0xb4};
  uint8_t bytesprops4[] = {0x4c, 0x70, 0x91, 0xf9, 0x6d, 0x7b, 0x7c, 0xd8, 0x84, 0x5a, 0xbe, 0x1, 0x9c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 15799}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2831}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 155}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 27802}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31388}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {13, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 151, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoPayloadFormatInvalid [PropSubscriptionIdentifierAvailable 154,PropMaximumQoS
// 22,PropRetainAvailable 184,PropAuthenticationData
// "\182\209\149tT\EOTd%+Zf\152yw\206Y(m\160\147\\\FS\161\156",PropMessageExpiryInterval
// 16874,PropPayloadFormatIndicator 48,PropPayloadFormatIndicator 43,PropMaximumPacketSize
// 19500,PropMessageExpiryInterval 10936,PropResponseTopic "T\230\162",PropSessionExpiryInterval
// 7727,PropSharedSubscriptionAvailable 157,PropMaximumQoS 103,PropMaximumQoS 148,PropSubscriptionIdentifier
// 20,PropResponseInformation "\f\n\128",PropPayloadFormatIndicator 150,PropContentType
// "",PropRequestResponseInformation 67,PropResponseInformation "\162ECV\b%\FS\170\159\191M\140\151"]
TEST(Disco5QCTest, Encode4) {
  uint8_t pkt[] = {0xe0, 0x66, 0x99, 0x64, 0x29, 0x9a, 0x24, 0x16, 0x25, 0xb8, 0x16, 0x0,  0x18, 0xb6, 0xd1,
                   0x95, 0x74, 0x54, 0x4,  0x64, 0x25, 0x2b, 0x5a, 0x66, 0x98, 0x79, 0x77, 0xce, 0x59, 0x28,
                   0x6d, 0xa0, 0x93, 0x5c, 0x1c, 0xa1, 0x9c, 0x2,  0x0,  0x0,  0x41, 0xea, 0x1,  0x30, 0x1,
                   0x2b, 0x27, 0x0,  0x0,  0x4c, 0x2c, 0x2,  0x0,  0x0,  0x2a, 0xb8, 0x8,  0x0,  0x3,  0x54,
                   0xe6, 0xa2, 0x11, 0x0,  0x0,  0x1e, 0x2f, 0x2a, 0x9d, 0x24, 0x67, 0x24, 0x94, 0xb,  0x14,
                   0x1a, 0x0,  0x3,  0xc,  0xa,  0x80, 0x1,  0x96, 0x3,  0x0,  0x0,  0x19, 0x43, 0x1a, 0x0,
                   0xd,  0xa2, 0x45, 0x43, 0x56, 0x8,  0x25, 0x1c, 0xaa, 0x9f, 0xbf, 0x4d, 0x8c, 0x97};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb6, 0xd1, 0x95, 0x74, 0x54, 0x4,  0x64, 0x25, 0x2b, 0x5a, 0x66, 0x98,
                           0x79, 0x77, 0xce, 0x59, 0x28, 0x6d, 0xa0, 0x93, 0x5c, 0x1c, 0xa1, 0x9c};
  uint8_t bytesprops1[] = {0x54, 0xe6, 0xa2};
  uint8_t bytesprops2[] = {0xc, 0xa, 0x80};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xa2, 0x45, 0x43, 0x56, 0x8, 0x25, 0x1c, 0xaa, 0x9f, 0xbf, 0x4d, 0x8c, 0x97};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 154}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 22}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 184}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16874}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 48}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 43}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 19500}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 10936}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 7727}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 157}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 148}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {3, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 150}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 67}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {13, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {20, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 153, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoQoSNotSupported [PropContentType
// "\189\217\225N\157\189=\248iC\v\DLE\236e2\DC1\SI",PropAssignedClientIdentifier
// "rK\219\190\184\174\DC3g\142\US\130\243\225\&4\199\215\FSph\210\133Q\147\223r\r",PropServerKeepAlive
// 1413,PropWildcardSubscriptionAvailable 27,PropResponseInformation "\195",PropWildcardSubscriptionAvailable
// 41,PropPayloadFormatIndicator 101,PropSessionExpiryInterval 29285,PropCorrelationData
// "0/\218\191\179\132lT\US",PropSubscriptionIdentifierAvailable 135,PropRequestProblemInformation 194]
TEST(Disco5QCTest, Encode5) {
  uint8_t pkt[] = {0xe0, 0x55, 0x9b, 0x53, 0x3,  0x0,  0x11, 0xbd, 0xd9, 0xe1, 0x4e, 0x9d, 0xbd, 0x3d, 0xf8,
                   0x69, 0x43, 0xb,  0x10, 0xec, 0x65, 0x32, 0x11, 0xf,  0x12, 0x0,  0x1a, 0x72, 0x4b, 0xdb,
                   0xbe, 0xb8, 0xae, 0x13, 0x67, 0x8e, 0x1f, 0x82, 0xf3, 0xe1, 0x34, 0xc7, 0xd7, 0x1c, 0x70,
                   0x68, 0xd2, 0x85, 0x51, 0x93, 0xdf, 0x72, 0xd,  0x13, 0x5,  0x85, 0x28, 0x1b, 0x1a, 0x0,
                   0x1,  0xc3, 0x28, 0x29, 0x1,  0x65, 0x11, 0x0,  0x0,  0x72, 0x65, 0x9,  0x0,  0x9,  0x30,
                   0x2f, 0xda, 0xbf, 0xb3, 0x84, 0x6c, 0x54, 0x1f, 0x29, 0x87, 0x17, 0xc2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xbd, 0xd9, 0xe1, 0x4e, 0x9d, 0xbd, 0x3d, 0xf8, 0x69,
                           0x43, 0xb,  0x10, 0xec, 0x65, 0x32, 0x11, 0xf};
  uint8_t bytesprops1[] = {0x72, 0x4b, 0xdb, 0xbe, 0xb8, 0xae, 0x13, 0x67, 0x8e, 0x1f, 0x82, 0xf3, 0xe1,
                           0x34, 0xc7, 0xd7, 0x1c, 0x70, 0x68, 0xd2, 0x85, 0x51, 0x93, 0xdf, 0x72, 0xd};
  uint8_t bytesprops2[] = {0xc3};
  uint8_t bytesprops3[] = {0x30, 0x2f, 0xda, 0xbf, 0xb3, 0x84, 0x6c, 0x54, 0x1f};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {26, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1413}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 27}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 41}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 29285}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {9, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 194}},
  };

  lwmqtt_properties_t props = {11, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 155, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoQoSNotSupported [PropResponseInformation "\228(\210io\200N\191p_\175",PropUserProperty
// "C\177+\b_\DC1\246G\141~\203 \156+\162\203\209v:\DC2\215\211"
// "\NAK\171\190\205\186\225L\184\191\ACK\204\133\&5-\236R{",PropWildcardSubscriptionAvailable 55,PropMaximumPacketSize
// 21821,PropMessageExpiryInterval 13767,PropTopicAlias 13552,PropAssignedClientIdentifier
// "\139\SI\bF\SYN\\o\213\133\&55",PropRequestProblemInformation 230,PropResponseInformation
// "NJ\182\163]\143\168\247\133\STX\207\v\149\146\166\RS\206kR0\EOT\236\160\SOH4\208\\\232\162",PropServerReference
// "\128c\v\215z\SUB\ESC\190\165@\150.\179 \241\153\&18\242g\201\EOT",PropSessionExpiryInterval 16675,PropResponseTopic
// "\177\EM\206\165\ETXy\247?\161\b\183\197\135\186\ACK\207",PropTopicAliasMaximum 12720,PropContentType
// "8\SO\198B\137a\209\210\170VE\n\169J\184"]
TEST(Disco5QCTest, Encode6) {
  uint8_t pkt[] = {0xe0, 0xc2, 0x1,  0x9b, 0xbf, 0x1,  0x1a, 0x0,  0xb,  0xe4, 0x28, 0xd2, 0x69, 0x6f, 0xc8, 0x4e, 0xbf,
                   0x70, 0x5f, 0xaf, 0x26, 0x0,  0x16, 0x43, 0xb1, 0x2b, 0x8,  0x5f, 0x11, 0xf6, 0x47, 0x8d, 0x7e, 0xcb,
                   0x20, 0x9c, 0x2b, 0xa2, 0xcb, 0xd1, 0x76, 0x3a, 0x12, 0xd7, 0xd3, 0x0,  0x11, 0x15, 0xab, 0xbe, 0xcd,
                   0xba, 0xe1, 0x4c, 0xb8, 0xbf, 0x6,  0xcc, 0x85, 0x35, 0x2d, 0xec, 0x52, 0x7b, 0x28, 0x37, 0x27, 0x0,
                   0x0,  0x55, 0x3d, 0x2,  0x0,  0x0,  0x35, 0xc7, 0x23, 0x34, 0xf0, 0x12, 0x0,  0xb,  0x8b, 0xf,  0x8,
                   0x46, 0x16, 0x5c, 0x6f, 0xd5, 0x85, 0x35, 0x35, 0x17, 0xe6, 0x1a, 0x0,  0x1d, 0x4e, 0x4a, 0xb6, 0xa3,
                   0x5d, 0x8f, 0xa8, 0xf7, 0x85, 0x2,  0xcf, 0xb,  0x95, 0x92, 0xa6, 0x1e, 0xce, 0x6b, 0x52, 0x30, 0x4,
                   0xec, 0xa0, 0x1,  0x34, 0xd0, 0x5c, 0xe8, 0xa2, 0x1c, 0x0,  0x16, 0x80, 0x63, 0xb,  0xd7, 0x7a, 0x1a,
                   0x1b, 0xbe, 0xa5, 0x40, 0x96, 0x2e, 0xb3, 0x20, 0xf1, 0x99, 0x31, 0x38, 0xf2, 0x67, 0xc9, 0x4,  0x11,
                   0x0,  0x0,  0x41, 0x23, 0x8,  0x0,  0x10, 0xb1, 0x19, 0xce, 0xa5, 0x3,  0x79, 0xf7, 0x3f, 0xa1, 0x8,
                   0xb7, 0xc5, 0x87, 0xba, 0x6,  0xcf, 0x22, 0x31, 0xb0, 0x3,  0x0,  0xf,  0x38, 0xe,  0xc6, 0x42, 0x89,
                   0x61, 0xd1, 0xd2, 0xaa, 0x56, 0x45, 0xa,  0xa9, 0x4a, 0xb8};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xe4, 0x28, 0xd2, 0x69, 0x6f, 0xc8, 0x4e, 0xbf, 0x70, 0x5f, 0xaf};
  uint8_t bytesprops2[] = {0x15, 0xab, 0xbe, 0xcd, 0xba, 0xe1, 0x4c, 0xb8, 0xbf,
                           0x6,  0xcc, 0x85, 0x35, 0x2d, 0xec, 0x52, 0x7b};
  uint8_t bytesprops1[] = {0x43, 0xb1, 0x2b, 0x8,  0x5f, 0x11, 0xf6, 0x47, 0x8d, 0x7e, 0xcb,
                           0x20, 0x9c, 0x2b, 0xa2, 0xcb, 0xd1, 0x76, 0x3a, 0x12, 0xd7, 0xd3};
  uint8_t bytesprops3[] = {0x8b, 0xf, 0x8, 0x46, 0x16, 0x5c, 0x6f, 0xd5, 0x85, 0x35, 0x35};
  uint8_t bytesprops4[] = {0x4e, 0x4a, 0xb6, 0xa3, 0x5d, 0x8f, 0xa8, 0xf7, 0x85, 0x2,  0xcf, 0xb,  0x95, 0x92, 0xa6,
                           0x1e, 0xce, 0x6b, 0x52, 0x30, 0x4,  0xec, 0xa0, 0x1,  0x34, 0xd0, 0x5c, 0xe8, 0xa2};
  uint8_t bytesprops5[] = {0x80, 0x63, 0xb,  0xd7, 0x7a, 0x1a, 0x1b, 0xbe, 0xa5, 0x40, 0x96,
                           0x2e, 0xb3, 0x20, 0xf1, 0x99, 0x31, 0x38, 0xf2, 0x67, 0xc9, 0x4};
  uint8_t bytesprops6[] = {0xb1, 0x19, 0xce, 0xa5, 0x3, 0x79, 0xf7, 0x3f, 0xa1, 0x8, 0xb7, 0xc5, 0x87, 0xba, 0x6, 0xcf};
  uint8_t bytesprops7[] = {0x38, 0xe, 0xc6, 0x42, 0x89, 0x61, 0xd1, 0xd2, 0xaa, 0x56, 0x45, 0xa, 0xa9, 0x4a, 0xb8};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {11, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {22, (char*)&bytesprops1}, .v = {17, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 55}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 21821}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13767}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 13552}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {11, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 230}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16675}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 12720}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {15, (char*)&bytesprops7}}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 155, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoSharedSubscriptionsNotSupported [PropMessageExpiryInterval 11490,PropPayloadFormatIndicator
// 13,PropServerKeepAlive 27670,PropSessionExpiryInterval 16138,PropTopicAlias 7546,PropUserProperty
// "\190\DC2z\155\239\207\177\rw\205\STX\156\139\131" "u\SUB.<\214\181\221P\237lI\239\246",PropSessionExpiryInterval
// 3968,PropUserProperty "\138\&5\250\&3\"r\144\179\248yH9\253\237S\CAN\157\EM\200x\SI\166K\156\183"
// "\244\f\224\208E^\b}\137x\193\232\177\196\209aP\223\&0\ESC",PropAssignedClientIdentifier
// "\176:s\251\174\192\NULz\137G\208$\137p\131\DC3\130\bX\US0\188\250\233\SO\f\ESCL",PropMaximumQoS 110,PropMaximumQoS
// 180,PropAuthenticationMethod "k\r\217\ru,\nB\235\213m\"]\247Sk\240\211\135zD)\183\240\245",PropTopicAliasMaximum
// 18518,PropServerReference "X\252\DC1\218oX\200\156h\172E-\224\132]\170\&3\175c",PropAssignedClientIdentifier
// "e\154\&4l",PropResponseInformation "}8e\161\183\RSI\229\202\US\144\220\r_\190\141\SUB}",PropSessionExpiryInterval
// 18101,PropCorrelationData "\\2\129O\159\195W}\150\DC1\137\&5\233\140S\DC3\EM\185'\SUB\192\159v\204r",PropContentType
// "\207P\v\RSj",PropRetainAvailable 235,PropContentType
// "w\200\234h{\222@\149\210\225\133\v\248\243\246(\US\128\&3&\136\201t\200\DC4\206\227",PropSubscriptionIdentifier 14]
TEST(Disco5QCTest, Encode7) {
  uint8_t pkt[] = {
      0xe0, 0xab, 0x2,  0x9e, 0xa8, 0x2,  0x2,  0x0,  0x0,  0x2c, 0xe2, 0x1,  0xd,  0x13, 0x6c, 0x16, 0x11, 0x0,  0x0,
      0x3f, 0xa,  0x23, 0x1d, 0x7a, 0x26, 0x0,  0xe,  0xbe, 0x12, 0x7a, 0x9b, 0xef, 0xcf, 0xb1, 0xd,  0x77, 0xcd, 0x2,
      0x9c, 0x8b, 0x83, 0x0,  0xd,  0x75, 0x1a, 0x2e, 0x3c, 0xd6, 0xb5, 0xdd, 0x50, 0xed, 0x6c, 0x49, 0xef, 0xf6, 0x11,
      0x0,  0x0,  0xf,  0x80, 0x26, 0x0,  0x19, 0x8a, 0x35, 0xfa, 0x33, 0x22, 0x72, 0x90, 0xb3, 0xf8, 0x79, 0x48, 0x39,
      0xfd, 0xed, 0x53, 0x18, 0x9d, 0x19, 0xc8, 0x78, 0xf,  0xa6, 0x4b, 0x9c, 0xb7, 0x0,  0x14, 0xf4, 0xc,  0xe0, 0xd0,
      0x45, 0x5e, 0x8,  0x7d, 0x89, 0x78, 0xc1, 0xe8, 0xb1, 0xc4, 0xd1, 0x61, 0x50, 0xdf, 0x30, 0x1b, 0x12, 0x0,  0x1c,
      0xb0, 0x3a, 0x73, 0xfb, 0xae, 0xc0, 0x0,  0x7a, 0x89, 0x47, 0xd0, 0x24, 0x89, 0x70, 0x83, 0x13, 0x82, 0x8,  0x58,
      0x1f, 0x30, 0xbc, 0xfa, 0xe9, 0xe,  0xc,  0x1b, 0x4c, 0x24, 0x6e, 0x24, 0xb4, 0x15, 0x0,  0x19, 0x6b, 0xd,  0xd9,
      0xd,  0x75, 0x2c, 0xa,  0x42, 0xeb, 0xd5, 0x6d, 0x22, 0x5d, 0xf7, 0x53, 0x6b, 0xf0, 0xd3, 0x87, 0x7a, 0x44, 0x29,
      0xb7, 0xf0, 0xf5, 0x22, 0x48, 0x56, 0x1c, 0x0,  0x13, 0x58, 0xfc, 0x11, 0xda, 0x6f, 0x58, 0xc8, 0x9c, 0x68, 0xac,
      0x45, 0x2d, 0xe0, 0x84, 0x5d, 0xaa, 0x33, 0xaf, 0x63, 0x12, 0x0,  0x4,  0x65, 0x9a, 0x34, 0x6c, 0x1a, 0x0,  0x12,
      0x7d, 0x38, 0x65, 0xa1, 0xb7, 0x1e, 0x49, 0xe5, 0xca, 0x1f, 0x90, 0xdc, 0xd,  0x5f, 0xbe, 0x8d, 0x1a, 0x7d, 0x11,
      0x0,  0x0,  0x46, 0xb5, 0x9,  0x0,  0x19, 0x5c, 0x32, 0x81, 0x4f, 0x9f, 0xc3, 0x57, 0x7d, 0x96, 0x11, 0x89, 0x35,
      0xe9, 0x8c, 0x53, 0x13, 0x19, 0xb9, 0x27, 0x1a, 0xc0, 0x9f, 0x76, 0xcc, 0x72, 0x3,  0x0,  0x5,  0xcf, 0x50, 0xb,
      0x1e, 0x6a, 0x25, 0xeb, 0x3,  0x0,  0x1b, 0x77, 0xc8, 0xea, 0x68, 0x7b, 0xde, 0x40, 0x95, 0xd2, 0xe1, 0x85, 0xb,
      0xf8, 0xf3, 0xf6, 0x28, 0x1f, 0x80, 0x33, 0x26, 0x88, 0xc9, 0x74, 0xc8, 0x14, 0xce, 0xe3, 0xb,  0xe};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops1[] = {0x75, 0x1a, 0x2e, 0x3c, 0xd6, 0xb5, 0xdd, 0x50, 0xed, 0x6c, 0x49, 0xef, 0xf6};
  uint8_t bytesprops0[] = {0xbe, 0x12, 0x7a, 0x9b, 0xef, 0xcf, 0xb1, 0xd, 0x77, 0xcd, 0x2, 0x9c, 0x8b, 0x83};
  uint8_t bytesprops3[] = {0xf4, 0xc,  0xe0, 0xd0, 0x45, 0x5e, 0x8,  0x7d, 0x89, 0x78,
                           0xc1, 0xe8, 0xb1, 0xc4, 0xd1, 0x61, 0x50, 0xdf, 0x30, 0x1b};
  uint8_t bytesprops2[] = {0x8a, 0x35, 0xfa, 0x33, 0x22, 0x72, 0x90, 0xb3, 0xf8, 0x79, 0x48, 0x39, 0xfd,
                           0xed, 0x53, 0x18, 0x9d, 0x19, 0xc8, 0x78, 0xf,  0xa6, 0x4b, 0x9c, 0xb7};
  uint8_t bytesprops4[] = {0xb0, 0x3a, 0x73, 0xfb, 0xae, 0xc0, 0x0,  0x7a, 0x89, 0x47, 0xd0, 0x24, 0x89, 0x70,
                           0x83, 0x13, 0x82, 0x8,  0x58, 0x1f, 0x30, 0xbc, 0xfa, 0xe9, 0xe,  0xc,  0x1b, 0x4c};
  uint8_t bytesprops5[] = {0x6b, 0xd,  0xd9, 0xd,  0x75, 0x2c, 0xa,  0x42, 0xeb, 0xd5, 0x6d, 0x22, 0x5d,
                           0xf7, 0x53, 0x6b, 0xf0, 0xd3, 0x87, 0x7a, 0x44, 0x29, 0xb7, 0xf0, 0xf5};
  uint8_t bytesprops6[] = {0x58, 0xfc, 0x11, 0xda, 0x6f, 0x58, 0xc8, 0x9c, 0x68, 0xac,
                           0x45, 0x2d, 0xe0, 0x84, 0x5d, 0xaa, 0x33, 0xaf, 0x63};
  uint8_t bytesprops7[] = {0x65, 0x9a, 0x34, 0x6c};
  uint8_t bytesprops8[] = {0x7d, 0x38, 0x65, 0xa1, 0xb7, 0x1e, 0x49, 0xe5, 0xca,
                           0x1f, 0x90, 0xdc, 0xd,  0x5f, 0xbe, 0x8d, 0x1a, 0x7d};
  uint8_t bytesprops9[] = {0x5c, 0x32, 0x81, 0x4f, 0x9f, 0xc3, 0x57, 0x7d, 0x96, 0x11, 0x89, 0x35, 0xe9,
                           0x8c, 0x53, 0x13, 0x19, 0xb9, 0x27, 0x1a, 0xc0, 0x9f, 0x76, 0xcc, 0x72};
  uint8_t bytesprops10[] = {0xcf, 0x50, 0xb, 0x1e, 0x6a};
  uint8_t bytesprops11[] = {0x77, 0xc8, 0xea, 0x68, 0x7b, 0xde, 0x40, 0x95, 0xd2, 0xe1, 0x85, 0xb,  0xf8, 0xf3,
                            0xf6, 0x28, 0x1f, 0x80, 0x33, 0x26, 0x88, 0xc9, 0x74, 0xc8, 0x14, 0xce, 0xe3};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 11490}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 13}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 27670}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 16138}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 7546}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {14, (char*)&bytesprops0}, .v = {13, (char*)&bytesprops1}}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 3968}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops2}, .v = {20, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 180}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 18518}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {19, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {4, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 18101}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {27, (char*)&bytesprops11}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 158, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMaximumConnectTime [PropWildcardSubscriptionAvailable 9,PropResponseInformation
// "\242\"\144\253\155A\a\224\157\&0\250\167\202UU\DC3i\SO\216\ESCE\t\200e\236",PropAuthenticationData
// "\224q~\185\ACK\169\192g\DC2\146\&11iM\128\204\a\176\DC40M",PropRequestProblemInformation 236,PropCorrelationData
// "\164Z\140\175\231\192N\164\SOH{P\ETB\194\200\154\178\193",PropRequestResponseInformation
// 247,PropSubscriptionIdentifierAvailable 58,PropRequestResponseInformation 250,PropMessageExpiryInterval 31479]
TEST(Disco5QCTest, Encode8) {
  uint8_t pkt[] = {0xe0, 0x59, 0xa0, 0x57, 0x28, 0x9,  0x1a, 0x0,  0x19, 0xf2, 0x22, 0x90, 0xfd, 0x9b, 0x41, 0x7,
                   0xe0, 0x9d, 0x30, 0xfa, 0xa7, 0xca, 0x55, 0x55, 0x13, 0x69, 0xe,  0xd8, 0x1b, 0x45, 0x9,  0xc8,
                   0x65, 0xec, 0x16, 0x0,  0x15, 0xe0, 0x71, 0x7e, 0xb9, 0x6,  0xa9, 0xc0, 0x67, 0x12, 0x92, 0x31,
                   0x31, 0x69, 0x4d, 0x80, 0xcc, 0x7,  0xb0, 0x14, 0x30, 0x4d, 0x17, 0xec, 0x9,  0x0,  0x11, 0xa4,
                   0x5a, 0x8c, 0xaf, 0xe7, 0xc0, 0x4e, 0xa4, 0x1,  0x7b, 0x50, 0x17, 0xc2, 0xc8, 0x9a, 0xb2, 0xc1,
                   0x19, 0xf7, 0x29, 0x3a, 0x19, 0xfa, 0x2,  0x0,  0x0,  0x7a, 0xf7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xf2, 0x22, 0x90, 0xfd, 0x9b, 0x41, 0x7,  0xe0, 0x9d, 0x30, 0xfa, 0xa7, 0xca,
                           0x55, 0x55, 0x13, 0x69, 0xe,  0xd8, 0x1b, 0x45, 0x9,  0xc8, 0x65, 0xec};
  uint8_t bytesprops1[] = {0xe0, 0x71, 0x7e, 0xb9, 0x6,  0xa9, 0xc0, 0x67, 0x12, 0x92, 0x31,
                           0x31, 0x69, 0x4d, 0x80, 0xcc, 0x7,  0xb0, 0x14, 0x30, 0x4d};
  uint8_t bytesprops2[] = {0xa4, 0x5a, 0x8c, 0xaf, 0xe7, 0xc0, 0x4e, 0xa4, 0x1,
                           0x7b, 0x50, 0x17, 0xc2, 0xc8, 0x9a, 0xb2, 0xc1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {21, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 247}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 250}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31479}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 160, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoImplementationSpecificError [PropAuthenticationData "\217/",PropCorrelationData
// "X",PropSharedSubscriptionAvailable 119,PropAuthenticationData "bx\153`\169",PropReceiveMaximum
// 29531,PropSessionExpiryInterval 139,PropMaximumPacketSize 17723,PropMaximumQoS 49,PropMessageExpiryInterval
// 6102,PropServerReference "1\187",PropAuthenticationData
// "\186a*#\148o\153\244F$gr\168j\248\241\235\&9\171\ETX\NUL\252",PropContentType "\245\CANo2\202\147\145\142"]
TEST(Disco5QCTest, Encode9) {
  uint8_t pkt[] = {0xe0, 0x52, 0x83, 0x50, 0x16, 0x0,  0x2,  0xd9, 0x2f, 0x9,  0x0,  0x1,  0x58, 0x2a, 0x77, 0x16, 0x0,
                   0x5,  0x62, 0x78, 0x99, 0x60, 0xa9, 0x21, 0x73, 0x5b, 0x11, 0x0,  0x0,  0x0,  0x8b, 0x27, 0x0,  0x0,
                   0x45, 0x3b, 0x24, 0x31, 0x2,  0x0,  0x0,  0x17, 0xd6, 0x1c, 0x0,  0x2,  0x31, 0xbb, 0x16, 0x0,  0x16,
                   0xba, 0x61, 0x2a, 0x23, 0x94, 0x6f, 0x99, 0xf4, 0x46, 0x24, 0x67, 0x72, 0xa8, 0x6a, 0xf8, 0xf1, 0xeb,
                   0x39, 0xab, 0x3,  0x0,  0xfc, 0x3,  0x0,  0x8,  0xf5, 0x18, 0x6f, 0x32, 0xca, 0x93, 0x91, 0x8e};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd9, 0x2f};
  uint8_t bytesprops1[] = {0x58};
  uint8_t bytesprops2[] = {0x62, 0x78, 0x99, 0x60, 0xa9};
  uint8_t bytesprops3[] = {0x31, 0xbb};
  uint8_t bytesprops4[] = {0xba, 0x61, 0x2a, 0x23, 0x94, 0x6f, 0x99, 0xf4, 0x46, 0x24, 0x67,
                           0x72, 0xa8, 0x6a, 0xf8, 0xf1, 0xeb, 0x39, 0xab, 0x3,  0x0,  0xfc};
  uint8_t bytesprops5[] = {0xf5, 0x18, 0x6f, 0x32, 0xca, 0x93, 0x91, 0x8e};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 119}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {5, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 29531}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 139}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 17723}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 49}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6102}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 131, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicAliasInvalid [PropCorrelationData "M=\244-PP\EOT\SIU\137d,\234
// Jvy",PropSubscriptionIdentifierAvailable 128]
TEST(Disco5QCTest, Encode10) {
  uint8_t pkt[] = {0xe0, 0x18, 0x94, 0x16, 0x9,  0x0,  0x11, 0x4d, 0x3d, 0xf4, 0x2d, 0x50, 0x50,
                   0x4,  0xf,  0x55, 0x89, 0x64, 0x2c, 0xea, 0x20, 0x4a, 0x76, 0x79, 0x29, 0x80};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x4d, 0x3d, 0xf4, 0x2d, 0x50, 0x50, 0x4,  0xf, 0x55,
                           0x89, 0x64, 0x2c, 0xea, 0x20, 0x4a, 0x76, 0x79};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 128}},
  };

  lwmqtt_properties_t props = {2, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 148, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServerMoved [PropMaximumQoS 31,PropRequestProblemInformation 145,PropReceiveMaximum
// 12339,PropMessageExpiryInterval 1555,PropRequestResponseInformation 128,PropTopicAlias 20781,PropTopicAlias
// 6717,PropMessageExpiryInterval 13919,PropResponseTopic "->\163",PropSessionExpiryInterval 14049,PropMaximumPacketSize
// 6508,PropResponseTopic "\ETXCT(\\{\RS\DEL\206\EOT\183\141O",PropReasonString
// "\150AFn\165\146\189\&2\253\145-\SUB\US\162G\151\245\201\&4x\DLE\155\129\238",PropResponseInformation
// "\184\153\r\175\180\t\250\197/\DC1\190\210\208\186\187l\EM\216",PropWildcardSubscriptionAvailable
// 165,PropAuthenticationData "\US\USf\180\206\t/\248\167\ETB\246\DC2\213\SUBH\239+A\ENQ"]
TEST(Disco5QCTest, Encode11) {
  uint8_t pkt[] = {0xe0, 0x84, 0x1,  0x9d, 0x81, 0x1,  0x24, 0x1f, 0x17, 0x91, 0x21, 0x30, 0x33, 0x2,  0x0,  0x0,  0x6,
                   0x13, 0x19, 0x80, 0x23, 0x51, 0x2d, 0x23, 0x1a, 0x3d, 0x2,  0x0,  0x0,  0x36, 0x5f, 0x8,  0x0,  0x3,
                   0x2d, 0x3e, 0xa3, 0x11, 0x0,  0x0,  0x36, 0xe1, 0x27, 0x0,  0x0,  0x19, 0x6c, 0x8,  0x0,  0xd,  0x3,
                   0x43, 0x54, 0x28, 0x5c, 0x7b, 0x1e, 0x7f, 0xce, 0x4,  0xb7, 0x8d, 0x4f, 0x1f, 0x0,  0x18, 0x96, 0x41,
                   0x46, 0x6e, 0xa5, 0x92, 0xbd, 0x32, 0xfd, 0x91, 0x2d, 0x1a, 0x1f, 0xa2, 0x47, 0x97, 0xf5, 0xc9, 0x34,
                   0x78, 0x10, 0x9b, 0x81, 0xee, 0x1a, 0x0,  0x12, 0xb8, 0x99, 0xd,  0xaf, 0xb4, 0x9,  0xfa, 0xc5, 0x2f,
                   0x11, 0xbe, 0xd2, 0xd0, 0xba, 0xbb, 0x6c, 0x19, 0xd8, 0x28, 0xa5, 0x16, 0x0,  0x13, 0x1f, 0x1f, 0x66,
                   0xb4, 0xce, 0x9,  0x2f, 0xf8, 0xa7, 0x17, 0xf6, 0x12, 0xd5, 0x1a, 0x48, 0xef, 0x2b, 0x41, 0x5};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2d, 0x3e, 0xa3};
  uint8_t bytesprops1[] = {0x3, 0x43, 0x54, 0x28, 0x5c, 0x7b, 0x1e, 0x7f, 0xce, 0x4, 0xb7, 0x8d, 0x4f};
  uint8_t bytesprops2[] = {0x96, 0x41, 0x46, 0x6e, 0xa5, 0x92, 0xbd, 0x32, 0xfd, 0x91, 0x2d, 0x1a,
                           0x1f, 0xa2, 0x47, 0x97, 0xf5, 0xc9, 0x34, 0x78, 0x10, 0x9b, 0x81, 0xee};
  uint8_t bytesprops3[] = {0xb8, 0x99, 0xd,  0xaf, 0xb4, 0x9,  0xfa, 0xc5, 0x2f,
                           0x11, 0xbe, 0xd2, 0xd0, 0xba, 0xbb, 0x6c, 0x19, 0xd8};
  uint8_t bytesprops4[] = {0x1f, 0x1f, 0x66, 0xb4, 0xce, 0x9,  0x2f, 0xf8, 0xa7, 0x17,
                           0xf6, 0x12, 0xd5, 0x1a, 0x48, 0xef, 0x2b, 0x41, 0x5};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 31}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 145}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 12339}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 1555}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20781}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 6717}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13919}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {3, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 14049}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6508}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {13, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {24, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 165}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {19, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 157, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoPayloadFormatInvalid [PropMessageExpiryInterval 6984,PropSubscriptionIdentifier
// 17,PropServerReference "k+\223\218\228\255\174\248\209D\140\181\164\SUB\136\175K\185",PropAssignedClientIdentifier
// "\150\224\191\129T\a\185[\172\158\DLE\208\186\ETB\238\168\222(L1\247\221",PropResponseTopic
// "\217\&4\155\216.\218\128\DC4\221B\143\SI\247\&1",PropSubscriptionIdentifierAvailable 6,PropAssignedClientIdentifier
// "",PropWildcardSubscriptionAvailable 87,PropTopicAliasMaximum 1948,PropResponseTopic
// "\192\176\194A\221y\194\187\207\201\"\128\NUL!?\169\EOT\DLE",PropContentType "\203",PropSessionExpiryInterval
// 20851,PropSubscriptionIdentifier 17,PropMessageExpiryInterval 30485,PropServerKeepAlive
// 8118,PropRequestProblemInformation 194,PropReceiveMaximum 31011,PropAuthenticationData
// "\201{H\210?\241\NAK\205",PropRequestResponseInformation 61]
TEST(Disco5QCTest, Encode12) {
  uint8_t pkt[] = {0xe0, 0x8d, 0x1,  0x99, 0x8a, 0x1,  0x2,  0x0,  0x0,  0x1b, 0x48, 0xb,  0x11, 0x1c, 0x0,  0x12,
                   0x6b, 0x2b, 0xdf, 0xda, 0xe4, 0xff, 0xae, 0xf8, 0xd1, 0x44, 0x8c, 0xb5, 0xa4, 0x1a, 0x88, 0xaf,
                   0x4b, 0xb9, 0x12, 0x0,  0x16, 0x96, 0xe0, 0xbf, 0x81, 0x54, 0x7,  0xb9, 0x5b, 0xac, 0x9e, 0x10,
                   0xd0, 0xba, 0x17, 0xee, 0xa8, 0xde, 0x28, 0x4c, 0x31, 0xf7, 0xdd, 0x8,  0x0,  0xe,  0xd9, 0x34,
                   0x9b, 0xd8, 0x2e, 0xda, 0x80, 0x14, 0xdd, 0x42, 0x8f, 0xf,  0xf7, 0x31, 0x29, 0x6,  0x12, 0x0,
                   0x0,  0x28, 0x57, 0x22, 0x7,  0x9c, 0x8,  0x0,  0x12, 0xc0, 0xb0, 0xc2, 0x41, 0xdd, 0x79, 0xc2,
                   0xbb, 0xcf, 0xc9, 0x22, 0x80, 0x0,  0x21, 0x3f, 0xa9, 0x4,  0x10, 0x3,  0x0,  0x1,  0xcb, 0x11,
                   0x0,  0x0,  0x51, 0x73, 0xb,  0x11, 0x2,  0x0,  0x0,  0x77, 0x15, 0x13, 0x1f, 0xb6, 0x17, 0xc2,
                   0x21, 0x79, 0x23, 0x16, 0x0,  0x8,  0xc9, 0x7b, 0x48, 0xd2, 0x3f, 0xf1, 0x15, 0xcd, 0x19, 0x3d};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x6b, 0x2b, 0xdf, 0xda, 0xe4, 0xff, 0xae, 0xf8, 0xd1,
                           0x44, 0x8c, 0xb5, 0xa4, 0x1a, 0x88, 0xaf, 0x4b, 0xb9};
  uint8_t bytesprops1[] = {0x96, 0xe0, 0xbf, 0x81, 0x54, 0x7,  0xb9, 0x5b, 0xac, 0x9e, 0x10,
                           0xd0, 0xba, 0x17, 0xee, 0xa8, 0xde, 0x28, 0x4c, 0x31, 0xf7, 0xdd};
  uint8_t bytesprops2[] = {0xd9, 0x34, 0x9b, 0xd8, 0x2e, 0xda, 0x80, 0x14, 0xdd, 0x42, 0x8f, 0xf, 0xf7, 0x31};
  uint8_t bytesprops3[] = {0};
  uint8_t bytesprops4[] = {0xc0, 0xb0, 0xc2, 0x41, 0xdd, 0x79, 0xc2, 0xbb, 0xcf,
                           0xc9, 0x22, 0x80, 0x0,  0x21, 0x3f, 0xa9, 0x4,  0x10};
  uint8_t bytesprops5[] = {0xcb};
  uint8_t bytesprops6[] = {0xc9, 0x7b, 0x48, 0xd2, 0x3f, 0xf1, 0x15, 0xcd};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6984}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {18, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {14, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 6}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 87}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 1948}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {1, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20851}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30485}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 8118}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 194}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 31011}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {8, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 61}},
  };

  lwmqtt_properties_t props = {19, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 153, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoConnectionRateExceeded [PropContentType
// "C\240\216I\207~(\SOH\214\251\236X\186\&1\167j2&r\v\\\183HX",PropPayloadFormatIndicator 3,PropResponseInformation
// "\153\ESC\187Ce\169J\SOH\175",PropRequestProblemInformation 237,PropReasonString
// "\198i\156\243\DC3\176t\231\251\210?\138oA\226\174\143\SUB\207\174\\",PropServerKeepAlive
// 14943,PropAuthenticationData
// "7\141\216\204\&0\222\151\131\211B\215\208g\245-\214\145\133\132\&5\205;\159s,*G\185",PropReceiveMaximum
// 24237,PropRequestResponseInformation 147,PropServerReference "\236\216u\221CD\140x\211",PropAssignedClientIdentifier
// "\190\171t/\STX",PropRequestResponseInformation 147,PropReceiveMaximum 10434,PropMessageExpiryInterval
// 26344,PropSubscriptionIdentifier 25,PropResponseInformation "5\166\USnWv\163\v^\204\169!",PropReceiveMaximum
// 18516,PropUserProperty "\b\141T\173\209\191\206h+.\194\227\174" "\199Z\ACK\""]
TEST(Disco5QCTest, Encode13) {
  uint8_t pkt[] = {0xe0, 0xb5, 0x1,  0x9f, 0xb2, 0x1,  0x3,  0x0,  0x18, 0x43, 0xf0, 0xd8, 0x49, 0xcf, 0x7e, 0x28, 0x1,
                   0xd6, 0xfb, 0xec, 0x58, 0xba, 0x31, 0xa7, 0x6a, 0x32, 0x26, 0x72, 0xb,  0x5c, 0xb7, 0x48, 0x58, 0x1,
                   0x3,  0x1a, 0x0,  0x9,  0x99, 0x1b, 0xbb, 0x43, 0x65, 0xa9, 0x4a, 0x1,  0xaf, 0x17, 0xed, 0x1f, 0x0,
                   0x15, 0xc6, 0x69, 0x9c, 0xf3, 0x13, 0xb0, 0x74, 0xe7, 0xfb, 0xd2, 0x3f, 0x8a, 0x6f, 0x41, 0xe2, 0xae,
                   0x8f, 0x1a, 0xcf, 0xae, 0x5c, 0x13, 0x3a, 0x5f, 0x16, 0x0,  0x1c, 0x37, 0x8d, 0xd8, 0xcc, 0x30, 0xde,
                   0x97, 0x83, 0xd3, 0x42, 0xd7, 0xd0, 0x67, 0xf5, 0x2d, 0xd6, 0x91, 0x85, 0x84, 0x35, 0xcd, 0x3b, 0x9f,
                   0x73, 0x2c, 0x2a, 0x47, 0xb9, 0x21, 0x5e, 0xad, 0x19, 0x93, 0x1c, 0x0,  0x9,  0xec, 0xd8, 0x75, 0xdd,
                   0x43, 0x44, 0x8c, 0x78, 0xd3, 0x12, 0x0,  0x5,  0xbe, 0xab, 0x74, 0x2f, 0x2,  0x19, 0x93, 0x21, 0x28,
                   0xc2, 0x2,  0x0,  0x0,  0x66, 0xe8, 0xb,  0x19, 0x1a, 0x0,  0xc,  0x35, 0xa6, 0x1f, 0x6e, 0x57, 0x76,
                   0xa3, 0xb,  0x5e, 0xcc, 0xa9, 0x21, 0x21, 0x48, 0x54, 0x26, 0x0,  0xd,  0x8,  0x8d, 0x54, 0xad, 0xd1,
                   0xbf, 0xce, 0x68, 0x2b, 0x2e, 0xc2, 0xe3, 0xae, 0x0,  0x4,  0xc7, 0x5a, 0x6,  0x22};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x43, 0xf0, 0xd8, 0x49, 0xcf, 0x7e, 0x28, 0x1, 0xd6, 0xfb, 0xec, 0x58,
                           0xba, 0x31, 0xa7, 0x6a, 0x32, 0x26, 0x72, 0xb, 0x5c, 0xb7, 0x48, 0x58};
  uint8_t bytesprops1[] = {0x99, 0x1b, 0xbb, 0x43, 0x65, 0xa9, 0x4a, 0x1, 0xaf};
  uint8_t bytesprops2[] = {0xc6, 0x69, 0x9c, 0xf3, 0x13, 0xb0, 0x74, 0xe7, 0xfb, 0xd2, 0x3f,
                           0x8a, 0x6f, 0x41, 0xe2, 0xae, 0x8f, 0x1a, 0xcf, 0xae, 0x5c};
  uint8_t bytesprops3[] = {0x37, 0x8d, 0xd8, 0xcc, 0x30, 0xde, 0x97, 0x83, 0xd3, 0x42, 0xd7, 0xd0, 0x67, 0xf5,
                           0x2d, 0xd6, 0x91, 0x85, 0x84, 0x35, 0xcd, 0x3b, 0x9f, 0x73, 0x2c, 0x2a, 0x47, 0xb9};
  uint8_t bytesprops4[] = {0xec, 0xd8, 0x75, 0xdd, 0x43, 0x44, 0x8c, 0x78, 0xd3};
  uint8_t bytesprops5[] = {0xbe, 0xab, 0x74, 0x2f, 0x2};
  uint8_t bytesprops6[] = {0x35, 0xa6, 0x1f, 0x6e, 0x57, 0x76, 0xa3, 0xb, 0x5e, 0xcc, 0xa9, 0x21};
  uint8_t bytesprops8[] = {0xc7, 0x5a, 0x6, 0x22};
  uint8_t bytesprops7[] = {0x8, 0x8d, 0x54, 0xad, 0xd1, 0xbf, 0xce, 0x68, 0x2b, 0x2e, 0xc2, 0xe3, 0xae};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {24, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 3}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {9, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 14943}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 24237}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {9, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {5, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10434}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26344}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 25}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {12, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 18516}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops7}, .v = {4, (char*)&bytesprops8}}}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 159, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServerBusy [PropCorrelationData
// "\156c\234v\230\166\189^6\192\212\247\DELU\146",PropAuthenticationMethod "\128",PropSubscriptionIdentifierAvailable
// 136,PropRequestProblemInformation 9,PropContentType
// "ST6;<Ba\164\DLE\157\129\ESC\254O\v\215\145\147",PropRequestResponseInformation 236,PropAuthenticationData
// "7\157\ESC",PropWildcardSubscriptionAvailable 14,PropServerKeepAlive 9350]
TEST(Disco5QCTest, Encode14) {
  uint8_t pkt[] = {0xe0, 0x3e, 0x89, 0x3c, 0x9,  0x0,  0xf,  0x9c, 0x63, 0xea, 0x76, 0xe6, 0xa6, 0xbd, 0x5e, 0x36,
                   0xc0, 0xd4, 0xf7, 0x7f, 0x55, 0x92, 0x15, 0x0,  0x1,  0x80, 0x29, 0x88, 0x17, 0x9,  0x3,  0x0,
                   0x12, 0x53, 0x54, 0x36, 0x3b, 0x3c, 0x42, 0x61, 0xa4, 0x10, 0x9d, 0x81, 0x1b, 0xfe, 0x4f, 0xb,
                   0xd7, 0x91, 0x93, 0x19, 0xec, 0x16, 0x0,  0x3,  0x37, 0x9d, 0x1b, 0x28, 0xe,  0x13, 0x24, 0x86};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x9c, 0x63, 0xea, 0x76, 0xe6, 0xa6, 0xbd, 0x5e, 0x36, 0xc0, 0xd4, 0xf7, 0x7f, 0x55, 0x92};
  uint8_t bytesprops1[] = {0x80};
  uint8_t bytesprops2[] = {0x53, 0x54, 0x36, 0x3b, 0x3c, 0x42, 0x61, 0xa4, 0x10,
                           0x9d, 0x81, 0x1b, 0xfe, 0x4f, 0xb,  0xd7, 0x91, 0x93};
  uint8_t bytesprops3[] = {0x37, 0x9d, 0x1b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 9}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 236}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {3, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 14}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 9350}},
  };

  lwmqtt_properties_t props = {9, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 137, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoServershuttingDown [PropMaximumQoS 212,PropAssignedClientIdentifier
// "\178\250\197\213?\245Y\EM\227\163\b\n\198[\223\DLEq\189\166>|\147\194\r\152",PropCorrelationData
// "XQ\141\183i\193\CAN\220\187c\NUL",PropSubscriptionIdentifierAvailable 101,PropResponseInformation
// "&\173-H<J;\238\241\166>\175'\176YE\DC1\149\189\243\245%f \141a",PropMaximumQoS 8,PropRetainAvailable
// 83,PropReceiveMaximum 14438,PropSubscriptionIdentifier 7,PropRequestResponseInformation 70,PropMessageExpiryInterval
// 4714,PropSubscriptionIdentifier 16,PropSubscriptionIdentifier 21,PropAuthenticationData
// "csx/\172\f`\190\DC2\ACK\DLE\201\&6\169\168O\188",PropServerKeepAlive 15824,PropMessageExpiryInterval
// 8359,PropWillDelayInterval 26294,PropReceiveMaximum 15657,PropWillDelayInterval 3552,PropTopicAliasMaximum
// 19709,PropMessageExpiryInterval 31451,PropSubscriptionIdentifierAvailable 206,PropMessageExpiryInterval
// 30405,PropUserProperty "L&\216\DC33\DLE!Xa\236\SOQ\243\206G\USV21\179\ETB\246\ETX+w\239zm\SO"
// "\192\136",PropRetainAvailable 59,PropMessageExpiryInterval 26129]
TEST(Disco5QCTest, Encode15) {
  uint8_t pkt[] = {0xe0, 0xc5, 0x1,  0x8b, 0xc2, 0x1,  0x24, 0xd4, 0x12, 0x0,  0x19, 0xb2, 0xfa, 0xc5, 0xd5, 0x3f, 0xf5,
                   0x59, 0x19, 0xe3, 0xa3, 0x8,  0xa,  0xc6, 0x5b, 0xdf, 0x10, 0x71, 0xbd, 0xa6, 0x3e, 0x7c, 0x93, 0xc2,
                   0xd,  0x98, 0x9,  0x0,  0xb,  0x58, 0x51, 0x8d, 0xb7, 0x69, 0xc1, 0x18, 0xdc, 0xbb, 0x63, 0x0,  0x29,
                   0x65, 0x1a, 0x0,  0x1a, 0x26, 0xad, 0x2d, 0x48, 0x3c, 0x4a, 0x3b, 0xee, 0xf1, 0xa6, 0x3e, 0xaf, 0x27,
                   0xb0, 0x59, 0x45, 0x11, 0x95, 0xbd, 0xf3, 0xf5, 0x25, 0x66, 0x20, 0x8d, 0x61, 0x24, 0x8,  0x25, 0x53,
                   0x21, 0x38, 0x66, 0xb,  0x7,  0x19, 0x46, 0x2,  0x0,  0x0,  0x12, 0x6a, 0xb,  0x10, 0xb,  0x15, 0x16,
                   0x0,  0x11, 0x63, 0x73, 0x78, 0x2f, 0xac, 0xc,  0x60, 0xbe, 0x12, 0x6,  0x10, 0xc9, 0x36, 0xa9, 0xa8,
                   0x4f, 0xbc, 0x13, 0x3d, 0xd0, 0x2,  0x0,  0x0,  0x20, 0xa7, 0x18, 0x0,  0x0,  0x66, 0xb6, 0x21, 0x3d,
                   0x29, 0x18, 0x0,  0x0,  0xd,  0xe0, 0x22, 0x4c, 0xfd, 0x2,  0x0,  0x0,  0x7a, 0xdb, 0x29, 0xce, 0x2,
                   0x0,  0x0,  0x76, 0xc5, 0x26, 0x0,  0x1d, 0x4c, 0x26, 0xd8, 0x13, 0x33, 0x10, 0x21, 0x58, 0x61, 0xec,
                   0xe,  0x51, 0xf3, 0xce, 0x47, 0x1f, 0x56, 0x32, 0x31, 0xb3, 0x17, 0xf6, 0x3,  0x2b, 0x77, 0xef, 0x7a,
                   0x6d, 0xe,  0x0,  0x2,  0xc0, 0x88, 0x25, 0x3b, 0x2,  0x0,  0x0,  0x66, 0x11};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb2, 0xfa, 0xc5, 0xd5, 0x3f, 0xf5, 0x59, 0x19, 0xe3, 0xa3, 0x8, 0xa, 0xc6,
                           0x5b, 0xdf, 0x10, 0x71, 0xbd, 0xa6, 0x3e, 0x7c, 0x93, 0xc2, 0xd, 0x98};
  uint8_t bytesprops1[] = {0x58, 0x51, 0x8d, 0xb7, 0x69, 0xc1, 0x18, 0xdc, 0xbb, 0x63, 0x0};
  uint8_t bytesprops2[] = {0x26, 0xad, 0x2d, 0x48, 0x3c, 0x4a, 0x3b, 0xee, 0xf1, 0xa6, 0x3e, 0xaf, 0x27,
                           0xb0, 0x59, 0x45, 0x11, 0x95, 0xbd, 0xf3, 0xf5, 0x25, 0x66, 0x20, 0x8d, 0x61};
  uint8_t bytesprops3[] = {0x63, 0x73, 0x78, 0x2f, 0xac, 0xc,  0x60, 0xbe, 0x12,
                           0x6,  0x10, 0xc9, 0x36, 0xa9, 0xa8, 0x4f, 0xbc};
  uint8_t bytesprops5[] = {0xc0, 0x88};
  uint8_t bytesprops4[] = {0x4c, 0x26, 0xd8, 0x13, 0x33, 0x10, 0x21, 0x58, 0x61, 0xec, 0xe,  0x51, 0xf3, 0xce, 0x47,
                           0x1f, 0x56, 0x32, 0x31, 0xb3, 0x17, 0xf6, 0x3,  0x2b, 0x77, 0xef, 0x7a, 0x6d, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 212}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {25, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {11, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {26, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 83}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 14438}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 70}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4714}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 16}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 21}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {17, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 15824}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 8359}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26294}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 15657}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 3552}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 19709}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 31451}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30405}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {29, (char*)&bytesprops4}, .v = {2, (char*)&bytesprops5}}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 59}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 26129}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 139, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoConnectionRateExceeded [PropMaximumPacketSize 26235,PropWillDelayInterval
// 14753,PropServerKeepAlive 23091,PropCorrelationData "\221\220\197\146\147m\224l\189\137",PropServerKeepAlive
// 18977,PropRetainAvailable 40,PropAuthenticationData
// "\132H\t7\146\228\130\133\156\233\208\238\DC33\218\166T\250\193\185\225\217J\229\252q8\184",PropSubscriptionIdentifierAvailable
// 128,PropSharedSubscriptionAvailable 68,PropPayloadFormatIndicator 198,PropMessageExpiryInterval
// 30085,PropRequestProblemInformation 26,PropTopicAlias 9348,PropCorrelationData
// "k\189\172;\148\130:\194\253D8N'\225I",PropMaximumPacketSize 24904,PropSubscriptionIdentifierAvailable
// 201,PropContentType
// "\129\&2\182\229\200\SOHg]\161dbh\198\133\129/\202]\245\DC20\241\r\188>]",PropRequestResponseInformation
// 151,PropReasonString "\162\249\189\188",PropMessageExpiryInterval 16347,PropServerReference
// "\DC2\208\ESCC$,!|+\v\161\&9\221>\169\191\174\169Re\234\239\194\249 \162VSc\128",PropMaximumPacketSize
// 25464,PropAuthenticationMethod "?\198\243",PropSubscriptionIdentifierAvailable 147,PropServerReference
// "\233\DC3\237\143\167\190r\170o\230\SYN\241\251\ba",PropSessionExpiryInterval 20982,PropReceiveMaximum
// 21095,PropServerReference "\255E^kM:\238\148\US\SI\211\231\&9dM
// \227\244s\167\GS\146n\153\137\209\249",PropContentType "I\160\252\203f",PropAssignedClientIdentifier
// "\"'i\184f\v\194\157bJ\181\SOH"]
TEST(Disco5QCTest, Encode16) {
  uint8_t pkt[] = {
      0xe0, 0x92, 0x2,  0x9f, 0x8f, 0x2,  0x27, 0x0,  0x0,  0x66, 0x7b, 0x18, 0x0,  0x0,  0x39, 0xa1, 0x13, 0x5a, 0x33,
      0x9,  0x0,  0xa,  0xdd, 0xdc, 0xc5, 0x92, 0x93, 0x6d, 0xe0, 0x6c, 0xbd, 0x89, 0x13, 0x4a, 0x21, 0x25, 0x28, 0x16,
      0x0,  0x1c, 0x84, 0x48, 0x9,  0x37, 0x92, 0xe4, 0x82, 0x85, 0x9c, 0xe9, 0xd0, 0xee, 0x13, 0x33, 0xda, 0xa6, 0x54,
      0xfa, 0xc1, 0xb9, 0xe1, 0xd9, 0x4a, 0xe5, 0xfc, 0x71, 0x38, 0xb8, 0x29, 0x80, 0x2a, 0x44, 0x1,  0xc6, 0x2,  0x0,
      0x0,  0x75, 0x85, 0x17, 0x1a, 0x23, 0x24, 0x84, 0x9,  0x0,  0xf,  0x6b, 0xbd, 0xac, 0x3b, 0x94, 0x82, 0x3a, 0xc2,
      0xfd, 0x44, 0x38, 0x4e, 0x27, 0xe1, 0x49, 0x27, 0x0,  0x0,  0x61, 0x48, 0x29, 0xc9, 0x3,  0x0,  0x1a, 0x81, 0x32,
      0xb6, 0xe5, 0xc8, 0x1,  0x67, 0x5d, 0xa1, 0x64, 0x62, 0x68, 0xc6, 0x85, 0x81, 0x2f, 0xca, 0x5d, 0xf5, 0x12, 0x30,
      0xf1, 0xd,  0xbc, 0x3e, 0x5d, 0x19, 0x97, 0x1f, 0x0,  0x4,  0xa2, 0xf9, 0xbd, 0xbc, 0x2,  0x0,  0x0,  0x3f, 0xdb,
      0x1c, 0x0,  0x1e, 0x12, 0xd0, 0x1b, 0x43, 0x24, 0x2c, 0x21, 0x7c, 0x2b, 0xb,  0xa1, 0x39, 0xdd, 0x3e, 0xa9, 0xbf,
      0xae, 0xa9, 0x52, 0x65, 0xea, 0xef, 0xc2, 0xf9, 0x20, 0xa2, 0x56, 0x53, 0x63, 0x80, 0x27, 0x0,  0x0,  0x63, 0x78,
      0x15, 0x0,  0x3,  0x3f, 0xc6, 0xf3, 0x29, 0x93, 0x1c, 0x0,  0xf,  0xe9, 0x13, 0xed, 0x8f, 0xa7, 0xbe, 0x72, 0xaa,
      0x6f, 0xe6, 0x16, 0xf1, 0xfb, 0x8,  0x61, 0x11, 0x0,  0x0,  0x51, 0xf6, 0x21, 0x52, 0x67, 0x1c, 0x0,  0x1b, 0xff,
      0x45, 0x5e, 0x6b, 0x4d, 0x3a, 0xee, 0x94, 0x1f, 0xf,  0xd3, 0xe7, 0x39, 0x64, 0x4d, 0x20, 0xe3, 0xf4, 0x73, 0xa7,
      0x1d, 0x92, 0x6e, 0x99, 0x89, 0xd1, 0xf9, 0x3,  0x0,  0x5,  0x49, 0xa0, 0xfc, 0xcb, 0x66, 0x12, 0x0,  0xc,  0x22,
      0x27, 0x69, 0xb8, 0x66, 0xb,  0xc2, 0x9d, 0x62, 0x4a, 0xb5, 0x1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xdd, 0xdc, 0xc5, 0x92, 0x93, 0x6d, 0xe0, 0x6c, 0xbd, 0x89};
  uint8_t bytesprops1[] = {0x84, 0x48, 0x9,  0x37, 0x92, 0xe4, 0x82, 0x85, 0x9c, 0xe9, 0xd0, 0xee, 0x13, 0x33,
                           0xda, 0xa6, 0x54, 0xfa, 0xc1, 0xb9, 0xe1, 0xd9, 0x4a, 0xe5, 0xfc, 0x71, 0x38, 0xb8};
  uint8_t bytesprops2[] = {0x6b, 0xbd, 0xac, 0x3b, 0x94, 0x82, 0x3a, 0xc2, 0xfd, 0x44, 0x38, 0x4e, 0x27, 0xe1, 0x49};
  uint8_t bytesprops3[] = {0x81, 0x32, 0xb6, 0xe5, 0xc8, 0x1,  0x67, 0x5d, 0xa1, 0x64, 0x62, 0x68, 0xc6,
                           0x85, 0x81, 0x2f, 0xca, 0x5d, 0xf5, 0x12, 0x30, 0xf1, 0xd,  0xbc, 0x3e, 0x5d};
  uint8_t bytesprops4[] = {0xa2, 0xf9, 0xbd, 0xbc};
  uint8_t bytesprops5[] = {0x12, 0xd0, 0x1b, 0x43, 0x24, 0x2c, 0x21, 0x7c, 0x2b, 0xb,  0xa1, 0x39, 0xdd, 0x3e, 0xa9,
                           0xbf, 0xae, 0xa9, 0x52, 0x65, 0xea, 0xef, 0xc2, 0xf9, 0x20, 0xa2, 0x56, 0x53, 0x63, 0x80};
  uint8_t bytesprops6[] = {0x3f, 0xc6, 0xf3};
  uint8_t bytesprops7[] = {0xe9, 0x13, 0xed, 0x8f, 0xa7, 0xbe, 0x72, 0xaa, 0x6f, 0xe6, 0x16, 0xf1, 0xfb, 0x8, 0x61};
  uint8_t bytesprops8[] = {0xff, 0x45, 0x5e, 0x6b, 0x4d, 0x3a, 0xee, 0x94, 0x1f, 0xf,  0xd3, 0xe7, 0x39, 0x64,
                           0x4d, 0x20, 0xe3, 0xf4, 0x73, 0xa7, 0x1d, 0x92, 0x6e, 0x99, 0x89, 0xd1, 0xf9};
  uint8_t bytesprops9[] = {0x49, 0xa0, 0xfc, 0xcb, 0x66};
  uint8_t bytesprops10[] = {0x22, 0x27, 0x69, 0xb8, 0x66, 0xb, 0xc2, 0x9d, 0x62, 0x4a, 0xb5, 0x1};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 26235}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 14753}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 23091}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {10, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 18977}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 40}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 68}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 198}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30085}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 26}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 9348}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {15, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 24904}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 201}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {26, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 151}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {4, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 16347}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {30, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 25464}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {3, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 147}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 20982}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 21095}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {27, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {5, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {12, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {30, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 159, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoConnectionRateExceeded [PropAssignedClientIdentifier "",PropRequestProblemInformation
// 58,PropWillDelayInterval 26540,PropSessionExpiryInterval 10965,PropUserProperty
// "\243\&2QIy!8\EOT\f\ETX\204g\241}@\133\134o\US\FS\231_kx\248" "d\EOT\"0T\238\236",PropContentType
// "\ETX\211\NUL\181\DC47\131}",PropMessageExpiryInterval 24904,PropPayloadFormatIndicator 169,PropMessageExpiryInterval
// 23817,PropAssignedClientIdentifier "\176\ENQ\222VC\188,\164\NAK\DEL\169Gq\182",PropResponseTopic
// "\165\NAK\DC1y_53\211\t\254c\175\213M\NUL&y\b\236V^\246\225\141g\ESC>\173\130",PropPayloadFormatIndicator
// 183,PropSharedSubscriptionAvailable 115,PropWillDelayInterval 25597,PropServerKeepAlive
// 17658,PropSubscriptionIdentifier 2,PropMessageExpiryInterval 14628,PropSessionExpiryInterval 26147]
TEST(Disco5QCTest, Encode17) {
  uint8_t pkt[] = {0xe0, 0x97, 0x1,  0x9f, 0x94, 0x1,  0x12, 0x0,  0x0,  0x17, 0x3a, 0x18, 0x0,  0x0,  0x67, 0xac,
                   0x11, 0x0,  0x0,  0x2a, 0xd5, 0x26, 0x0,  0x19, 0xf3, 0x32, 0x51, 0x49, 0x79, 0x21, 0x38, 0x4,
                   0xc,  0x3,  0xcc, 0x67, 0xf1, 0x7d, 0x40, 0x85, 0x86, 0x6f, 0x1f, 0x1c, 0xe7, 0x5f, 0x6b, 0x78,
                   0xf8, 0x0,  0x7,  0x64, 0x4,  0x22, 0x30, 0x54, 0xee, 0xec, 0x3,  0x0,  0x8,  0x3,  0xd3, 0x0,
                   0xb5, 0x14, 0x37, 0x83, 0x7d, 0x2,  0x0,  0x0,  0x61, 0x48, 0x1,  0xa9, 0x2,  0x0,  0x0,  0x5d,
                   0x9,  0x12, 0x0,  0xe,  0xb0, 0x5,  0xde, 0x56, 0x43, 0xbc, 0x2c, 0xa4, 0x15, 0x7f, 0xa9, 0x47,
                   0x71, 0xb6, 0x8,  0x0,  0x1d, 0xa5, 0x15, 0x11, 0x79, 0x5f, 0x35, 0x33, 0xd3, 0x9,  0xfe, 0x63,
                   0xaf, 0xd5, 0x4d, 0x0,  0x26, 0x79, 0x8,  0xec, 0x56, 0x5e, 0xf6, 0xe1, 0x8d, 0x67, 0x1b, 0x3e,
                   0xad, 0x82, 0x1,  0xb7, 0x2a, 0x73, 0x18, 0x0,  0x0,  0x63, 0xfd, 0x13, 0x44, 0xfa, 0xb,  0x2,
                   0x2,  0x0,  0x0,  0x39, 0x24, 0x11, 0x0,  0x0,  0x66, 0x23};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops2[] = {0x64, 0x4, 0x22, 0x30, 0x54, 0xee, 0xec};
  uint8_t bytesprops1[] = {0xf3, 0x32, 0x51, 0x49, 0x79, 0x21, 0x38, 0x4,  0xc,  0x3,  0xcc, 0x67, 0xf1,
                           0x7d, 0x40, 0x85, 0x86, 0x6f, 0x1f, 0x1c, 0xe7, 0x5f, 0x6b, 0x78, 0xf8};
  uint8_t bytesprops3[] = {0x3, 0xd3, 0x0, 0xb5, 0x14, 0x37, 0x83, 0x7d};
  uint8_t bytesprops4[] = {0xb0, 0x5, 0xde, 0x56, 0x43, 0xbc, 0x2c, 0xa4, 0x15, 0x7f, 0xa9, 0x47, 0x71, 0xb6};
  uint8_t bytesprops5[] = {0xa5, 0x15, 0x11, 0x79, 0x5f, 0x35, 0x33, 0xd3, 0x9,  0xfe, 0x63, 0xaf, 0xd5, 0x4d, 0x0,
                           0x26, 0x79, 0x8,  0xec, 0x56, 0x5e, 0xf6, 0xe1, 0x8d, 0x67, 0x1b, 0x3e, 0xad, 0x82};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 58}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 26540}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 10965}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {25, (char*)&bytesprops1}, .v = {7, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {8, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24904}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 169}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 23817}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {29, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 183}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 25597}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 17658}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 2}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 14628}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26147}},
  };

  lwmqtt_properties_t props = {18, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 159, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoReceiveMaximumExceeded [PropTopicAliasMaximum 7621,PropSubscriptionIdentifierAvailable
// 53,PropReceiveMaximum 8235,PropServerReference "\208-:Qp\231\239N\134\171/qe",PropReasonString
// "<\ENQ\164^k\164\DLEMH\237]3Z\196\158\177\201\ETX$\130\171g\204",PropWillDelayInterval
// 19719,PropSharedSubscriptionAvailable 115,PropAssignedClientIdentifier
// "\169{(\NAK\225\219\r-\157\169\240Xa\144\145\229\217",PropMaximumQoS 235,PropRetainAvailable
// 74,PropAuthenticationData "\152K",PropResponseInformation
// "w\149\151\221\147\238X\v\NUL\142<\DEL\178\t\130\nz\134\227N5",PropAuthenticationData
// "\180\199\128\217c\144\&8\227\&3\136\180\ENQ\FSFG\236\135\143p\139\SOH\128",PropSubscriptionIdentifier
// 24,PropTopicAliasMaximum 3541,PropPayloadFormatIndicator 8,PropSessionExpiryInterval 26303,PropAuthenticationMethod
// ",\230=\151\248\199z\191-$\223\239\154\154\193\196\177\157\153\181I\209\230\132<",PropSessionExpiryInterval
// 2383,PropSessionExpiryInterval 30622,PropRetainAvailable 28,PropSessionExpiryInterval 73,PropCorrelationData
// "\171\218\201\177ZS 5\133\STX\207\181d\\Cx\249\169\183\NAK}h\198\FSpH",PropMaximumQoS
// 135,PropAssignedClientIdentifier "\204~{",PropAuthenticationMethod "Yb",PropAuthenticationMethod
// "E\165\228\205\244\208h\210\129F\128\209\162\157c\219\US\153\149\237\255\137}\170\162t,"]
TEST(Disco5QCTest, Encode18) {
  uint8_t pkt[] = {0xe0, 0x8b, 0x2,  0x93, 0x88, 0x2,  0x22, 0x1d, 0xc5, 0x29, 0x35, 0x21, 0x20, 0x2b, 0x1c, 0x0,  0xd,
                   0xd0, 0x2d, 0x3a, 0x51, 0x70, 0xe7, 0xef, 0x4e, 0x86, 0xab, 0x2f, 0x71, 0x65, 0x1f, 0x0,  0x17, 0x3c,
                   0x5,  0xa4, 0x5e, 0x6b, 0xa4, 0x10, 0x4d, 0x48, 0xed, 0x5d, 0x33, 0x5a, 0xc4, 0x9e, 0xb1, 0xc9, 0x3,
                   0x24, 0x82, 0xab, 0x67, 0xcc, 0x18, 0x0,  0x0,  0x4d, 0x7,  0x2a, 0x73, 0x12, 0x0,  0x11, 0xa9, 0x7b,
                   0x28, 0x15, 0xe1, 0xdb, 0xd,  0x2d, 0x9d, 0xa9, 0xf0, 0x58, 0x61, 0x90, 0x91, 0xe5, 0xd9, 0x24, 0xeb,
                   0x25, 0x4a, 0x16, 0x0,  0x2,  0x98, 0x4b, 0x1a, 0x0,  0x15, 0x77, 0x95, 0x97, 0xdd, 0x93, 0xee, 0x58,
                   0xb,  0x0,  0x8e, 0x3c, 0x7f, 0xb2, 0x9,  0x82, 0xa,  0x7a, 0x86, 0xe3, 0x4e, 0x35, 0x16, 0x0,  0x16,
                   0xb4, 0xc7, 0x80, 0xd9, 0x63, 0x90, 0x38, 0xe3, 0x33, 0x88, 0xb4, 0x5,  0x1c, 0x46, 0x47, 0xec, 0x87,
                   0x8f, 0x70, 0x8b, 0x1,  0x80, 0xb,  0x18, 0x22, 0xd,  0xd5, 0x1,  0x8,  0x11, 0x0,  0x0,  0x66, 0xbf,
                   0x15, 0x0,  0x19, 0x2c, 0xe6, 0x3d, 0x97, 0xf8, 0xc7, 0x7a, 0xbf, 0x2d, 0x24, 0xdf, 0xef, 0x9a, 0x9a,
                   0xc1, 0xc4, 0xb1, 0x9d, 0x99, 0xb5, 0x49, 0xd1, 0xe6, 0x84, 0x3c, 0x11, 0x0,  0x0,  0x9,  0x4f, 0x11,
                   0x0,  0x0,  0x77, 0x9e, 0x25, 0x1c, 0x11, 0x0,  0x0,  0x0,  0x49, 0x9,  0x0,  0x1a, 0xab, 0xda, 0xc9,
                   0xb1, 0x5a, 0x53, 0x20, 0x35, 0x85, 0x2,  0xcf, 0xb5, 0x64, 0x5c, 0x43, 0x78, 0xf9, 0xa9, 0xb7, 0x15,
                   0x7d, 0x68, 0xc6, 0x1c, 0x70, 0x48, 0x24, 0x87, 0x12, 0x0,  0x3,  0xcc, 0x7e, 0x7b, 0x15, 0x0,  0x2,
                   0x59, 0x62, 0x15, 0x0,  0x1b, 0x45, 0xa5, 0xe4, 0xcd, 0xf4, 0xd0, 0x68, 0xd2, 0x81, 0x46, 0x80, 0xd1,
                   0xa2, 0x9d, 0x63, 0xdb, 0x1f, 0x99, 0x95, 0xed, 0xff, 0x89, 0x7d, 0xaa, 0xa2, 0x74, 0x2c};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xd0, 0x2d, 0x3a, 0x51, 0x70, 0xe7, 0xef, 0x4e, 0x86, 0xab, 0x2f, 0x71, 0x65};
  uint8_t bytesprops1[] = {0x3c, 0x5,  0xa4, 0x5e, 0x6b, 0xa4, 0x10, 0x4d, 0x48, 0xed, 0x5d, 0x33,
                           0x5a, 0xc4, 0x9e, 0xb1, 0xc9, 0x3,  0x24, 0x82, 0xab, 0x67, 0xcc};
  uint8_t bytesprops2[] = {0xa9, 0x7b, 0x28, 0x15, 0xe1, 0xdb, 0xd,  0x2d, 0x9d,
                           0xa9, 0xf0, 0x58, 0x61, 0x90, 0x91, 0xe5, 0xd9};
  uint8_t bytesprops3[] = {0x98, 0x4b};
  uint8_t bytesprops4[] = {0x77, 0x95, 0x97, 0xdd, 0x93, 0xee, 0x58, 0xb,  0x0,  0x8e, 0x3c,
                           0x7f, 0xb2, 0x9,  0x82, 0xa,  0x7a, 0x86, 0xe3, 0x4e, 0x35};
  uint8_t bytesprops5[] = {0xb4, 0xc7, 0x80, 0xd9, 0x63, 0x90, 0x38, 0xe3, 0x33, 0x88, 0xb4,
                           0x5,  0x1c, 0x46, 0x47, 0xec, 0x87, 0x8f, 0x70, 0x8b, 0x1,  0x80};
  uint8_t bytesprops6[] = {0x2c, 0xe6, 0x3d, 0x97, 0xf8, 0xc7, 0x7a, 0xbf, 0x2d, 0x24, 0xdf, 0xef, 0x9a,
                           0x9a, 0xc1, 0xc4, 0xb1, 0x9d, 0x99, 0xb5, 0x49, 0xd1, 0xe6, 0x84, 0x3c};
  uint8_t bytesprops7[] = {0xab, 0xda, 0xc9, 0xb1, 0x5a, 0x53, 0x20, 0x35, 0x85, 0x2,  0xcf, 0xb5, 0x64,
                           0x5c, 0x43, 0x78, 0xf9, 0xa9, 0xb7, 0x15, 0x7d, 0x68, 0xc6, 0x1c, 0x70, 0x48};
  uint8_t bytesprops8[] = {0xcc, 0x7e, 0x7b};
  uint8_t bytesprops9[] = {0x59, 0x62};
  uint8_t bytesprops10[] = {0x45, 0xa5, 0xe4, 0xcd, 0xf4, 0xd0, 0x68, 0xd2, 0x81, 0x46, 0x80, 0xd1, 0xa2, 0x9d,
                            0x63, 0xdb, 0x1f, 0x99, 0x95, 0xed, 0xff, 0x89, 0x7d, 0xaa, 0xa2, 0x74, 0x2c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7621}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 53}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 8235}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {13, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {23, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 19719}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {17, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 235}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 74}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {21, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {22, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 24}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3541}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 8}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 26303}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {25, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 2383}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 30622}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 28}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 73}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {26, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 135}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {3, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {27, (char*)&bytesprops10}}},
  };

  lwmqtt_properties_t props = {27, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 147, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoDisconnectWithWill [PropAuthenticationData
// "@\ACK\248%\233\FSHv\216",PropAssignedClientIdentifier
// "$\SUB\226\129\156hO\148j\179\180w\159\161\230Mw6\156S\198\f",PropContentType
// "|\b\136#\SYN\131\179\168\&8\167\201\157]\179\142%-\a\150\132\132",PropResponseTopic
// "%\253",PropRequestProblemInformation 226,PropSubscriptionIdentifier 10,PropRetainAvailable 101,PropServerKeepAlive
// 4043,PropRequestProblemInformation 24,PropRetainAvailable 35,PropContentType
// "\DC3\159\128\255\v'\194\225\152\ESC",PropRetainAvailable 166]
TEST(Disco5QCTest, Encode19) {
  uint8_t pkt[] = {0xe0, 0x60, 0x4,  0x5e, 0x16, 0x0,  0x9,  0x40, 0x6,  0xf8, 0x25, 0xe9, 0x1c, 0x48, 0x76, 0xd8, 0x12,
                   0x0,  0x16, 0x24, 0x1a, 0xe2, 0x81, 0x9c, 0x68, 0x4f, 0x94, 0x6a, 0xb3, 0xb4, 0x77, 0x9f, 0xa1, 0xe6,
                   0x4d, 0x77, 0x36, 0x9c, 0x53, 0xc6, 0xc,  0x3,  0x0,  0x15, 0x7c, 0x8,  0x88, 0x23, 0x16, 0x83, 0xb3,
                   0xa8, 0x38, 0xa7, 0xc9, 0x9d, 0x5d, 0xb3, 0x8e, 0x25, 0x2d, 0x7,  0x96, 0x84, 0x84, 0x8,  0x0,  0x2,
                   0x25, 0xfd, 0x17, 0xe2, 0xb,  0xa,  0x25, 0x65, 0x13, 0xf,  0xcb, 0x17, 0x18, 0x25, 0x23, 0x3,  0x0,
                   0xa,  0x13, 0x9f, 0x80, 0xff, 0xb,  0x27, 0xc2, 0xe1, 0x98, 0x1b, 0x25, 0xa6};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x40, 0x6, 0xf8, 0x25, 0xe9, 0x1c, 0x48, 0x76, 0xd8};
  uint8_t bytesprops1[] = {0x24, 0x1a, 0xe2, 0x81, 0x9c, 0x68, 0x4f, 0x94, 0x6a, 0xb3, 0xb4,
                           0x77, 0x9f, 0xa1, 0xe6, 0x4d, 0x77, 0x36, 0x9c, 0x53, 0xc6, 0xc};
  uint8_t bytesprops2[] = {0x7c, 0x8,  0x88, 0x23, 0x16, 0x83, 0xb3, 0xa8, 0x38, 0xa7, 0xc9,
                           0x9d, 0x5d, 0xb3, 0x8e, 0x25, 0x2d, 0x7,  0x96, 0x84, 0x84};
  uint8_t bytesprops3[] = {0x25, 0xfd};
  uint8_t bytesprops4[] = {0x13, 0x9f, 0x80, 0xff, 0xb, 0x27, 0xc2, 0xe1, 0x98, 0x1b};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {9, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {22, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {21, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {2, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 226}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 101}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 4043}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 24}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 35}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {10, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 166}},
  };

  lwmqtt_properties_t props = {12, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 4, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMaximumConnectTime [PropPayloadFormatIndicator 64,PropRetainAvailable 191,PropTopicAlias
// 20889,PropServerReference "6Kc4;*}\238\DC3\179\ETXT",PropServerKeepAlive 29920,PropReceiveMaximum
// 10201,PropWillDelayInterval 658,PropWillDelayInterval 28824,PropUserProperty "\230\132\149.\219"
// "\n\204\n\154\&3\GS\132\ENQ6",PropServerKeepAlive 7761,PropTopicAliasMaximum 13346,PropSubscriptionIdentifier
// 14,PropRequestProblemInformation 179,PropTopicAliasMaximum 26363,PropSessionExpiryInterval 12423,PropReasonString
// "pT6D\r@\153\162\184\138w+\233\&6\172\206\DC4]\129\&5\164\GS\208\179\187P\207\231"]
TEST(Disco5QCTest, Encode20) {
  uint8_t pkt[] = {0xe0, 0x6c, 0xa0, 0x6a, 0x1,  0x40, 0x25, 0xbf, 0x23, 0x51, 0x99, 0x1c, 0x0,  0xc,  0x36, 0x4b,
                   0x63, 0x34, 0x3b, 0x2a, 0x7d, 0xee, 0x13, 0xb3, 0x3,  0x54, 0x13, 0x74, 0xe0, 0x21, 0x27, 0xd9,
                   0x18, 0x0,  0x0,  0x2,  0x92, 0x18, 0x0,  0x0,  0x70, 0x98, 0x26, 0x0,  0x5,  0xe6, 0x84, 0x95,
                   0x2e, 0xdb, 0x0,  0x9,  0xa,  0xcc, 0xa,  0x9a, 0x33, 0x1d, 0x84, 0x5,  0x36, 0x13, 0x1e, 0x51,
                   0x22, 0x34, 0x22, 0xb,  0xe,  0x17, 0xb3, 0x22, 0x66, 0xfb, 0x11, 0x0,  0x0,  0x30, 0x87, 0x1f,
                   0x0,  0x1c, 0x70, 0x54, 0x36, 0x44, 0xd,  0x40, 0x99, 0xa2, 0xb8, 0x8a, 0x77, 0x2b, 0xe9, 0x36,
                   0xac, 0xce, 0x14, 0x5d, 0x81, 0x35, 0xa4, 0x1d, 0xd0, 0xb3, 0xbb, 0x50, 0xcf, 0xe7};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x36, 0x4b, 0x63, 0x34, 0x3b, 0x2a, 0x7d, 0xee, 0x13, 0xb3, 0x3, 0x54};
  uint8_t bytesprops2[] = {0xa, 0xcc, 0xa, 0x9a, 0x33, 0x1d, 0x84, 0x5, 0x36};
  uint8_t bytesprops1[] = {0xe6, 0x84, 0x95, 0x2e, 0xdb};
  uint8_t bytesprops3[] = {0x70, 0x54, 0x36, 0x44, 0xd,  0x40, 0x99, 0xa2, 0xb8, 0x8a, 0x77, 0x2b, 0xe9, 0x36,
                           0xac, 0xce, 0x14, 0x5d, 0x81, 0x35, 0xa4, 0x1d, 0xd0, 0xb3, 0xbb, 0x50, 0xcf, 0xe7};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 64}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 191}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 20889}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {12, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 29920}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10201}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 658}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 28824}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {5, (char*)&bytesprops1}, .v = {9, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 7761}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 13346}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 14}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 179}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26363}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12423}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {28, (char*)&bytesprops3}}},
  };

  lwmqtt_properties_t props = {16, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 160, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoNotAuthorized [PropServerReference
// "\143\194@H\238\228\a\135\194>\200;\143\128\144M\ETX",PropReceiveMaximum 9209,PropServerReference
// "\254\155pu\225",PropMaximumQoS 188,PropServerReference "j\ENQ",PropSharedSubscriptionAvailable
// 103,PropSharedSubscriptionAvailable 206,PropTopicAlias 31456,PropResponseTopic
// "\205\&7b\203kH\224g\RSi\183\"\178\250\188\t",PropContentType "\186\&8\131\210d\"\163\196\133\162l\178p\131
// \249\&7\n3\187\248\138\233\199\"\CAN\233\204\146",PropContentType "}\216",PropAuthenticationMethod
// "\191\SO",PropMessageExpiryInterval 25961,PropRetainAvailable 53]
TEST(Disco5QCTest, Encode21) {
  uint8_t pkt[] = {0xe0, 0x73, 0x87, 0x71, 0x1c, 0x0,  0x11, 0x8f, 0xc2, 0x40, 0x48, 0xee, 0xe4, 0x7,  0x87, 0xc2, 0x3e,
                   0xc8, 0x3b, 0x8f, 0x80, 0x90, 0x4d, 0x3,  0x21, 0x23, 0xf9, 0x1c, 0x0,  0x5,  0xfe, 0x9b, 0x70, 0x75,
                   0xe1, 0x24, 0xbc, 0x1c, 0x0,  0x2,  0x6a, 0x5,  0x2a, 0x67, 0x2a, 0xce, 0x23, 0x7a, 0xe0, 0x8,  0x0,
                   0x10, 0xcd, 0x37, 0x62, 0xcb, 0x6b, 0x48, 0xe0, 0x67, 0x1e, 0x69, 0xb7, 0x22, 0xb2, 0xfa, 0xbc, 0x9,
                   0x3,  0x0,  0x1d, 0xba, 0x38, 0x83, 0xd2, 0x64, 0x22, 0xa3, 0xc4, 0x85, 0xa2, 0x6c, 0xb2, 0x70, 0x83,
                   0x20, 0xf9, 0x37, 0xa,  0x33, 0xbb, 0xf8, 0x8a, 0xe9, 0xc7, 0x22, 0x18, 0xe9, 0xcc, 0x92, 0x3,  0x0,
                   0x2,  0x7d, 0xd8, 0x15, 0x0,  0x2,  0xbf, 0xe,  0x2,  0x0,  0x0,  0x65, 0x69, 0x25, 0x35};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x8f, 0xc2, 0x40, 0x48, 0xee, 0xe4, 0x7,  0x87, 0xc2,
                           0x3e, 0xc8, 0x3b, 0x8f, 0x80, 0x90, 0x4d, 0x3};
  uint8_t bytesprops1[] = {0xfe, 0x9b, 0x70, 0x75, 0xe1};
  uint8_t bytesprops2[] = {0x6a, 0x5};
  uint8_t bytesprops3[] = {0xcd, 0x37, 0x62, 0xcb, 0x6b, 0x48, 0xe0, 0x67,
                           0x1e, 0x69, 0xb7, 0x22, 0xb2, 0xfa, 0xbc, 0x9};
  uint8_t bytesprops4[] = {0xba, 0x38, 0x83, 0xd2, 0x64, 0x22, 0xa3, 0xc4, 0x85, 0xa2, 0x6c, 0xb2, 0x70, 0x83, 0x20,
                           0xf9, 0x37, 0xa,  0x33, 0xbb, 0xf8, 0x8a, 0xe9, 0xc7, 0x22, 0x18, 0xe9, 0xcc, 0x92};
  uint8_t bytesprops5[] = {0x7d, 0xd8};
  uint8_t bytesprops6[] = {0xbf, 0xe};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {17, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 9209}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {5, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 188}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {2, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 103}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 206}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 31456}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {29, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {2, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {2, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 25961}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 53}},
  };

  lwmqtt_properties_t props = {14, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 135, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoImplementationSpecificError [PropAuthenticationMethod
// "cr,\ACK\bC/\227\NAK\152\228\176\144\192t\v\"\246\130`_",PropMaximumPacketSize 14029,PropSessionExpiryInterval
// 12586,PropRequestResponseInformation 115,PropMaximumPacketSize 6061,PropServerReference
// "$\ACK\138\&0\208\247l\180\253~u\132\ESC\STX\ETBD\r\ETBc\DC3\180\149\140\164\129\183\134\140",PropResponseInformation
// "t",PropSubscriptionIdentifier 17,PropServerKeepAlive 20492,PropTopicAliasMaximum 14027,PropCorrelationData
// "\169\&8\135\SOH\aKzAK~E}\182\236\RS\161\208J8\155Y\202\136\v\196\230\240\ETB",PropServerReference
// "\163\229\183,\196\208\244\188q\166U\ETXh\EM",PropCorrelationData
// "\158\DC4\187\223\140\135oV\t7F\SOH/G\202\177\146\216iMA\ENQ\230\148"]
TEST(Disco5QCTest, Encode22) {
  uint8_t pkt[] = {0xe0, 0xa2, 0x1,  0x83, 0x9f, 0x1,  0x15, 0x0,  0x15, 0x63, 0x72, 0x2c, 0x6,  0x8,  0x43, 0x2f, 0xe3,
                   0x15, 0x98, 0xe4, 0xb0, 0x90, 0xc0, 0x74, 0xb,  0x22, 0xf6, 0x82, 0x60, 0x5f, 0x27, 0x0,  0x0,  0x36,
                   0xcd, 0x11, 0x0,  0x0,  0x31, 0x2a, 0x19, 0x73, 0x27, 0x0,  0x0,  0x17, 0xad, 0x1c, 0x0,  0x1c, 0x24,
                   0x6,  0x8a, 0x30, 0xd0, 0xf7, 0x6c, 0xb4, 0xfd, 0x7e, 0x75, 0x84, 0x1b, 0x2,  0x17, 0x44, 0xd,  0x17,
                   0x63, 0x13, 0xb4, 0x95, 0x8c, 0xa4, 0x81, 0xb7, 0x86, 0x8c, 0x1a, 0x0,  0x1,  0x74, 0xb,  0x11, 0x13,
                   0x50, 0xc,  0x22, 0x36, 0xcb, 0x9,  0x0,  0x1c, 0xa9, 0x38, 0x87, 0x1,  0x7,  0x4b, 0x7a, 0x41, 0x4b,
                   0x7e, 0x45, 0x7d, 0xb6, 0xec, 0x1e, 0xa1, 0xd0, 0x4a, 0x38, 0x9b, 0x59, 0xca, 0x88, 0xb,  0xc4, 0xe6,
                   0xf0, 0x17, 0x1c, 0x0,  0xe,  0xa3, 0xe5, 0xb7, 0x2c, 0xc4, 0xd0, 0xf4, 0xbc, 0x71, 0xa6, 0x55, 0x3,
                   0x68, 0x19, 0x9,  0x0,  0x18, 0x9e, 0x14, 0xbb, 0xdf, 0x8c, 0x87, 0x6f, 0x56, 0x9,  0x37, 0x46, 0x1,
                   0x2f, 0x47, 0xca, 0xb1, 0x92, 0xd8, 0x69, 0x4d, 0x41, 0x5,  0xe6, 0x94};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x63, 0x72, 0x2c, 0x6,  0x8, 0x43, 0x2f, 0xe3, 0x15, 0x98, 0xe4,
                           0xb0, 0x90, 0xc0, 0x74, 0xb, 0x22, 0xf6, 0x82, 0x60, 0x5f};
  uint8_t bytesprops1[] = {0x24, 0x6,  0x8a, 0x30, 0xd0, 0xf7, 0x6c, 0xb4, 0xfd, 0x7e, 0x75, 0x84, 0x1b, 0x2,
                           0x17, 0x44, 0xd,  0x17, 0x63, 0x13, 0xb4, 0x95, 0x8c, 0xa4, 0x81, 0xb7, 0x86, 0x8c};
  uint8_t bytesprops2[] = {0x74};
  uint8_t bytesprops3[] = {0xa9, 0x38, 0x87, 0x1,  0x7,  0x4b, 0x7a, 0x41, 0x4b, 0x7e, 0x45, 0x7d, 0xb6, 0xec,
                           0x1e, 0xa1, 0xd0, 0x4a, 0x38, 0x9b, 0x59, 0xca, 0x88, 0xb,  0xc4, 0xe6, 0xf0, 0x17};
  uint8_t bytesprops4[] = {0xa3, 0xe5, 0xb7, 0x2c, 0xc4, 0xd0, 0xf4, 0xbc, 0x71, 0xa6, 0x55, 0x3, 0x68, 0x19};
  uint8_t bytesprops5[] = {0x9e, 0x14, 0xbb, 0xdf, 0x8c, 0x87, 0x6f, 0x56, 0x9,  0x37, 0x46, 0x1,
                           0x2f, 0x47, 0xca, 0xb1, 0x92, 0xd8, 0x69, 0x4d, 0x41, 0x5,  0xe6, 0x94};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 14029}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 12586}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 115}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 6061}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {28, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {1, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 17}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 20492}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14027}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {28, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {14, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {24, (char*)&bytesprops5}}},
  };

  lwmqtt_properties_t props = {13, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 131, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicNameInvalid [PropTopicAliasMaximum 26497,PropRetainAvailable 72,PropReceiveMaximum
// 481,PropServerReference "",PropReceiveMaximum 1240,PropSubscriptionIdentifierAvailable 54,PropTopicAliasMaximum
// 14770,PropMessageExpiryInterval 24223,PropUserProperty "Y\244\136I\175\250\238\"u\223a\155"
// "\SOF\134\STX\181\&2\174\243\244\&3\192m\149\215F\144[\214\SYN\NAK\253\151\167\140\225-\DEL\rG\149",PropResponseTopic
// "\180U\fQ\144\&2\254\142\179\DC42N\128m\ESC\206\157=@\213%\253#",PropSubscriptionIdentifier 20,PropReasonString
// "^\215\146\207!2r\GS\156[M\236\247G<-)5C\150",PropReasonString "\129%z",PropRetainAvailable 39,PropTopicAliasMaximum
// 7771]
TEST(Disco5QCTest, Encode23) {
  uint8_t pkt[] = {0xe0, 0x88, 0x1,  0x90, 0x85, 0x1,  0x22, 0x67, 0x81, 0x25, 0x48, 0x21, 0x1,  0xe1, 0x1c, 0x0,
                   0x0,  0x21, 0x4,  0xd8, 0x29, 0x36, 0x22, 0x39, 0xb2, 0x2,  0x0,  0x0,  0x5e, 0x9f, 0x26, 0x0,
                   0xc,  0x59, 0xf4, 0x88, 0x49, 0xaf, 0xfa, 0xee, 0x22, 0x75, 0xdf, 0x61, 0x9b, 0x0,  0x1e, 0xe,
                   0x46, 0x86, 0x2,  0xb5, 0x32, 0xae, 0xf3, 0xf4, 0x33, 0xc0, 0x6d, 0x95, 0xd7, 0x46, 0x90, 0x5b,
                   0xd6, 0x16, 0x15, 0xfd, 0x97, 0xa7, 0x8c, 0xe1, 0x2d, 0x7f, 0xd,  0x47, 0x95, 0x8,  0x0,  0x17,
                   0xb4, 0x55, 0xc,  0x51, 0x90, 0x32, 0xfe, 0x8e, 0xb3, 0x14, 0x32, 0x4e, 0x80, 0x6d, 0x1b, 0xce,
                   0x9d, 0x3d, 0x40, 0xd5, 0x25, 0xfd, 0x23, 0xb,  0x14, 0x1f, 0x0,  0x14, 0x5e, 0xd7, 0x92, 0xcf,
                   0x21, 0x32, 0x72, 0x1d, 0x9c, 0x5b, 0x4d, 0xec, 0xf7, 0x47, 0x3c, 0x2d, 0x29, 0x35, 0x43, 0x96,
                   0x1f, 0x0,  0x3,  0x81, 0x25, 0x7a, 0x25, 0x27, 0x22, 0x1e, 0x5b};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0};
  uint8_t bytesprops2[] = {0xe,  0x46, 0x86, 0x2,  0xb5, 0x32, 0xae, 0xf3, 0xf4, 0x33, 0xc0, 0x6d, 0x95, 0xd7, 0x46,
                           0x90, 0x5b, 0xd6, 0x16, 0x15, 0xfd, 0x97, 0xa7, 0x8c, 0xe1, 0x2d, 0x7f, 0xd,  0x47, 0x95};
  uint8_t bytesprops1[] = {0x59, 0xf4, 0x88, 0x49, 0xaf, 0xfa, 0xee, 0x22, 0x75, 0xdf, 0x61, 0x9b};
  uint8_t bytesprops3[] = {0xb4, 0x55, 0xc,  0x51, 0x90, 0x32, 0xfe, 0x8e, 0xb3, 0x14, 0x32, 0x4e,
                           0x80, 0x6d, 0x1b, 0xce, 0x9d, 0x3d, 0x40, 0xd5, 0x25, 0xfd, 0x23};
  uint8_t bytesprops4[] = {0x5e, 0xd7, 0x92, 0xcf, 0x21, 0x32, 0x72, 0x1d, 0x9c, 0x5b,
                           0x4d, 0xec, 0xf7, 0x47, 0x3c, 0x2d, 0x29, 0x35, 0x43, 0x96};
  uint8_t bytesprops5[] = {0x81, 0x25, 0x7a};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 26497}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 72}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 481}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {0, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 1240}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 54}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 14770}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 24223}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {12, (char*)&bytesprops1}, .v = {30, (char*)&bytesprops2}}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 20}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {20, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {3, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 7771}},
  };

  lwmqtt_properties_t props = {15, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 144, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMessageRateTooHigh [PropServerKeepAlive 1529,PropMaximumPacketSize 22315,PropResponseTopic
// "\183L~\163\132\149#\132\245\b@\SOH\t&\180R\171b]\GSB1",PropResponseTopic
// "\250\153\199\236|\176(|\208\143Re\NAK\246*\129#\231g\225t\187\169\236U",PropRequestProblemInformation
// 142,PropAssignedClientIdentifier "i\250\194l0+\144Z\SI\ETX\175\251W\177\149\218-\155\162x.\222\171\146W.X/\250"]
TEST(Disco5QCTest, Encode24) {
  uint8_t pkt[] = {0xe0, 0x61, 0x96, 0x5f, 0x13, 0x5,  0xf9, 0x27, 0x0,  0x0,  0x57, 0x2b, 0x8,  0x0,  0x16, 0xb7, 0x4c,
                   0x7e, 0xa3, 0x84, 0x95, 0x23, 0x84, 0xf5, 0x8,  0x40, 0x1,  0x9,  0x26, 0xb4, 0x52, 0xab, 0x62, 0x5d,
                   0x1d, 0x42, 0x31, 0x8,  0x0,  0x19, 0xfa, 0x99, 0xc7, 0xec, 0x7c, 0xb0, 0x28, 0x7c, 0xd0, 0x8f, 0x52,
                   0x65, 0x15, 0xf6, 0x2a, 0x81, 0x23, 0xe7, 0x67, 0xe1, 0x74, 0xbb, 0xa9, 0xec, 0x55, 0x17, 0x8e, 0x12,
                   0x0,  0x1d, 0x69, 0xfa, 0xc2, 0x6c, 0x30, 0x2b, 0x90, 0x5a, 0xf,  0x3,  0xaf, 0xfb, 0x57, 0xb1, 0x95,
                   0xda, 0x2d, 0x9b, 0xa2, 0x78, 0x2e, 0xde, 0xab, 0x92, 0x57, 0x2e, 0x58, 0x2f, 0xfa};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xb7, 0x4c, 0x7e, 0xa3, 0x84, 0x95, 0x23, 0x84, 0xf5, 0x8,  0x40,
                           0x1,  0x9,  0x26, 0xb4, 0x52, 0xab, 0x62, 0x5d, 0x1d, 0x42, 0x31};
  uint8_t bytesprops1[] = {0xfa, 0x99, 0xc7, 0xec, 0x7c, 0xb0, 0x28, 0x7c, 0xd0, 0x8f, 0x52, 0x65, 0x15,
                           0xf6, 0x2a, 0x81, 0x23, 0xe7, 0x67, 0xe1, 0x74, 0xbb, 0xa9, 0xec, 0x55};
  uint8_t bytesprops2[] = {0x69, 0xfa, 0xc2, 0x6c, 0x30, 0x2b, 0x90, 0x5a, 0xf,  0x3,  0xaf, 0xfb, 0x57, 0xb1, 0x95,
                           0xda, 0x2d, 0x9b, 0xa2, 0x78, 0x2e, 0xde, 0xab, 0x92, 0x57, 0x2e, 0x58, 0x2f, 0xfa};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 1529}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 22315}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {22, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {25, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 142}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {29, (char*)&bytesprops2}}},
  };

  lwmqtt_properties_t props = {6, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 150, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoKeepAliveTimeout [PropMaximumQoS 246,PropServerKeepAlive
// 5558,PropSubscriptionIdentifierAvailable 253,PropAssignedClientIdentifier "V\SO\r\UScP\148\162"]
TEST(Disco5QCTest, Encode25) {
  uint8_t pkt[] = {0xe0, 0x14, 0x8d, 0x12, 0x24, 0xf6, 0x13, 0x15, 0xb6, 0x29, 0xfd,
                   0x12, 0x0,  0x8,  0x56, 0xe,  0xd,  0x1f, 0x63, 0x50, 0x94, 0xa2};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x56, 0xe, 0xd, 0x1f, 0x63, 0x50, 0x94, 0xa2};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 246}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 5558}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 253}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {8, (char*)&bytesprops0}}},
  };

  lwmqtt_properties_t props = {4, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 141, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoQuotaExceeded [PropSharedSubscriptionAvailable 65,PropTopicAlias
// 17712,PropPayloadFormatIndicator 138,PropMessageExpiryInterval 13304,PropWildcardSubscriptionAvailable
// 128,PropMessageExpiryInterval 30209,PropTopicAliasMaximum 10272,PropWillDelayInterval 31542,PropAuthenticationMethod
// "\250\168\232\171ha\162\195\v\133\&1{R!C\248\192/\150r\164\205\239\246\135\205#\167",PropRequestResponseInformation
// 210,PropSubscriptionIdentifier 11,PropResponseTopic "\ENQ< X",PropResponseInformation
// "\225\SOX\ETX\153c\175\ESC\248\186\237\NUL\179\241\154b\165w7\232\155\148\DC2\224\v",PropRequestProblemInformation
// 232,PropMessageExpiryInterval 2206,PropAuthenticationMethod "\141",PropSessionExpiryInterval 32655,PropReasonString
// "x\167\133\133\ENQ\STX\164\DEL\197\159\246\177\217\174\157\199",PropUserProperty "\203\224\t\164,\128\230#\225\143"
// "M\221\t\209@\131\198\207\214",PropReceiveMaximum 5910,PropRetainAvailable 110,PropAssignedClientIdentifier
// "GD\178RLk\USc\148um\233\187\225\226\214\132\130\214 \206\251]\236\244\&1\243!",PropTopicAlias
// 2776,PropWildcardSubscriptionAvailable 195,PropTopicAliasMaximum 3590,PropServerReference
// "\FSX-\237py+\163\158\162\237\138I\161\162\201\243\129\&7u\174\231\153"]
TEST(Disco5QCTest, Encode26) {
  uint8_t pkt[] = {0xe0, 0xe5, 0x1,  0x97, 0xe2, 0x1,  0x2a, 0x41, 0x23, 0x45, 0x30, 0x1,  0x8a, 0x2,  0x0,  0x0,  0x33,
                   0xf8, 0x28, 0x80, 0x2,  0x0,  0x0,  0x76, 0x1,  0x22, 0x28, 0x20, 0x18, 0x0,  0x0,  0x7b, 0x36, 0x15,
                   0x0,  0x1c, 0xfa, 0xa8, 0xe8, 0xab, 0x68, 0x61, 0xa2, 0xc3, 0xb,  0x85, 0x31, 0x7b, 0x52, 0x21, 0x43,
                   0xf8, 0xc0, 0x2f, 0x96, 0x72, 0xa4, 0xcd, 0xef, 0xf6, 0x87, 0xcd, 0x23, 0xa7, 0x19, 0xd2, 0xb,  0xb,
                   0x8,  0x0,  0x4,  0x5,  0x3c, 0x20, 0x58, 0x1a, 0x0,  0x19, 0xe1, 0xe,  0x58, 0x3,  0x99, 0x63, 0xaf,
                   0x1b, 0xf8, 0xba, 0xed, 0x0,  0xb3, 0xf1, 0x9a, 0x62, 0xa5, 0x77, 0x37, 0xe8, 0x9b, 0x94, 0x12, 0xe0,
                   0xb,  0x17, 0xe8, 0x2,  0x0,  0x0,  0x8,  0x9e, 0x15, 0x0,  0x1,  0x8d, 0x11, 0x0,  0x0,  0x7f, 0x8f,
                   0x1f, 0x0,  0x10, 0x78, 0xa7, 0x85, 0x85, 0x5,  0x2,  0xa4, 0x7f, 0xc5, 0x9f, 0xf6, 0xb1, 0xd9, 0xae,
                   0x9d, 0xc7, 0x26, 0x0,  0xa,  0xcb, 0xe0, 0x9,  0xa4, 0x2c, 0x80, 0xe6, 0x23, 0xe1, 0x8f, 0x0,  0x9,
                   0x4d, 0xdd, 0x9,  0xd1, 0x40, 0x83, 0xc6, 0xcf, 0xd6, 0x21, 0x17, 0x16, 0x25, 0x6e, 0x12, 0x0,  0x1c,
                   0x47, 0x44, 0xb2, 0x52, 0x4c, 0x6b, 0x1f, 0x63, 0x94, 0x75, 0x6d, 0xe9, 0xbb, 0xe1, 0xe2, 0xd6, 0x84,
                   0x82, 0xd6, 0x20, 0xce, 0xfb, 0x5d, 0xec, 0xf4, 0x31, 0xf3, 0x21, 0x23, 0xa,  0xd8, 0x28, 0xc3, 0x22,
                   0xe,  0x6,  0x1c, 0x0,  0x17, 0x1c, 0x58, 0x2d, 0xed, 0x70, 0x79, 0x2b, 0xa3, 0x9e, 0xa2, 0xed, 0x8a,
                   0x49, 0xa1, 0xa2, 0xc9, 0xf3, 0x81, 0x37, 0x75, 0xae, 0xe7, 0x99};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0xfa, 0xa8, 0xe8, 0xab, 0x68, 0x61, 0xa2, 0xc3, 0xb,  0x85, 0x31, 0x7b, 0x52, 0x21,
                           0x43, 0xf8, 0xc0, 0x2f, 0x96, 0x72, 0xa4, 0xcd, 0xef, 0xf6, 0x87, 0xcd, 0x23, 0xa7};
  uint8_t bytesprops1[] = {0x5, 0x3c, 0x20, 0x58};
  uint8_t bytesprops2[] = {0xe1, 0xe,  0x58, 0x3,  0x99, 0x63, 0xaf, 0x1b, 0xf8, 0xba, 0xed, 0x0, 0xb3,
                           0xf1, 0x9a, 0x62, 0xa5, 0x77, 0x37, 0xe8, 0x9b, 0x94, 0x12, 0xe0, 0xb};
  uint8_t bytesprops3[] = {0x8d};
  uint8_t bytesprops4[] = {0x78, 0xa7, 0x85, 0x85, 0x5,  0x2,  0xa4, 0x7f,
                           0xc5, 0x9f, 0xf6, 0xb1, 0xd9, 0xae, 0x9d, 0xc7};
  uint8_t bytesprops6[] = {0x4d, 0xdd, 0x9, 0xd1, 0x40, 0x83, 0xc6, 0xcf, 0xd6};
  uint8_t bytesprops5[] = {0xcb, 0xe0, 0x9, 0xa4, 0x2c, 0x80, 0xe6, 0x23, 0xe1, 0x8f};
  uint8_t bytesprops7[] = {0x47, 0x44, 0xb2, 0x52, 0x4c, 0x6b, 0x1f, 0x63, 0x94, 0x75, 0x6d, 0xe9, 0xbb, 0xe1,
                           0xe2, 0xd6, 0x84, 0x82, 0xd6, 0x20, 0xce, 0xfb, 0x5d, 0xec, 0xf4, 0x31, 0xf3, 0x21};
  uint8_t bytesprops8[] = {0x1c, 0x58, 0x2d, 0xed, 0x70, 0x79, 0x2b, 0xa3, 0x9e, 0xa2, 0xed, 0x8a,
                           0x49, 0xa1, 0xa2, 0xc9, 0xf3, 0x81, 0x37, 0x75, 0xae, 0xe7, 0x99};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 65}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 17712}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 138}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 13304}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30209}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 10272}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 31542}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 210}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {4, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 232}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 2206}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {1, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)17, .value = {.int32 = 32655}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {16, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {10, (char*)&bytesprops5}, .v = {9, (char*)&bytesprops6}}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 5910}},
      {.prop = (lwmqtt_prop_t)37, .value = {.byte = 110}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {28, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 2776}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 195}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 3590}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {23, (char*)&bytesprops8}}},
  };

  lwmqtt_properties_t props = {26, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 151, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoProtocolError [PropResponseInformation
// "@;\216x\241\148\ACK\161Q\225\226\135\147c~\233\229$\231\DC2K\205\ESC\186\171,\131)",PropSubscriptionIdentifierAvailable
// 218,PropAssignedClientIdentifier "oW\128\254y(\243y\ESC%",PropWildcardSubscriptionAvailable 23,PropServerKeepAlive
// 22478,PropSubscriptionIdentifier 10,PropSubscriptionIdentifierAvailable 225,PropSharedSubscriptionAvailable
// 7,PropMaximumQoS 39,PropRequestProblemInformation 241]
TEST(Disco5QCTest, Encode27) {
  uint8_t pkt[] = {0xe0, 0x3f, 0x82, 0x3d, 0x1a, 0x0,  0x1c, 0x40, 0x3b, 0xd8, 0x78, 0xf1, 0x94, 0x6,  0xa1, 0x51, 0xe1,
                   0xe2, 0x87, 0x93, 0x63, 0x7e, 0xe9, 0xe5, 0x24, 0xe7, 0x12, 0x4b, 0xcd, 0x1b, 0xba, 0xab, 0x2c, 0x83,
                   0x29, 0x29, 0xda, 0x12, 0x0,  0xa,  0x6f, 0x57, 0x80, 0xfe, 0x79, 0x28, 0xf3, 0x79, 0x1b, 0x25, 0x28,
                   0x17, 0x13, 0x57, 0xce, 0xb,  0xa,  0x29, 0xe1, 0x2a, 0x7,  0x24, 0x27, 0x17, 0xf1};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x40, 0x3b, 0xd8, 0x78, 0xf1, 0x94, 0x6,  0xa1, 0x51, 0xe1, 0xe2, 0x87, 0x93, 0x63,
                           0x7e, 0xe9, 0xe5, 0x24, 0xe7, 0x12, 0x4b, 0xcd, 0x1b, 0xba, 0xab, 0x2c, 0x83, 0x29};
  uint8_t bytesprops1[] = {0x6f, 0x57, 0x80, 0xfe, 0x79, 0x28, 0xf3, 0x79, 0x1b, 0x25};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {28, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 218}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {10, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 23}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 22478}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 10}},
      {.prop = (lwmqtt_prop_t)41, .value = {.byte = 225}},
      {.prop = (lwmqtt_prop_t)42, .value = {.byte = 7}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 39}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 241}},
  };

  lwmqtt_properties_t props = {10, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 130, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoMessageRateTooHigh [PropCorrelationData
// "\131\130\210\132\224|V\230\ETXSGw\157\241\250\179\193g\141\220bo\197>u\146\221",PropResponseInformation
// "Y\147\235\NUL\144#Mw\145[\135\DELb\193)",PropSubscriptionIdentifier 29,PropCorrelationData "a\173\f\212\153u
// &\FS\173 e\ENQOVsAr\183\194\171\198/c5",PropWillDelayInterval 2734,PropMessageExpiryInterval
// 6794,PropRequestProblemInformation 128,PropAssignedClientIdentifier
// "y\136\237\SO1'\134y\179x\189\184K\138B\148^\133\226\170\&7\FS\NAK",PropResponseInformation
// "\203\n\155\233\133a\170V\222\&2i\CAN\170\&5\249\203\166'",PropRequestResponseInformation 136,PropMaximumQoS
// 237,PropMessageExpiryInterval 30501,PropResponseInformation
// "e\171Q+\159e\GS\222\ETX\187",PropRequestResponseInformation 137,PropResponseInformation
// "\ACK!\142\187\226W\n,I\196",PropSubscriptionIdentifier 26,PropPayloadFormatIndicator 131,PropReasonString
// "\198",PropAuthenticationData
// "\129\144\n\n#\SYNXD\136\DLE\225\200\175\129MVO\167B\233\152\130\GS\NUL\130e\208U\196",PropAuthenticationData
// "\171\253\221\227o\148\160E\185\198\232[dA\190\228\232\167\RS~\239\tb\236",PropMessageExpiryInterval
// 28849,PropCorrelationData "6R\144X7\204r~6\137\184\208\209`\207\192n\n%\146",PropTopicAliasMaximum 2747]
TEST(Disco5QCTest, Encode28) {
  uint8_t pkt[] = {
      0xe0, 0x93, 0x2,  0x96, 0x90, 0x2,  0x9,  0x0,  0x1b, 0x83, 0x82, 0xd2, 0x84, 0xe0, 0x7c, 0x56, 0xe6, 0x3,  0x53,
      0x47, 0x77, 0x9d, 0xf1, 0xfa, 0xb3, 0xc1, 0x67, 0x8d, 0xdc, 0x62, 0x6f, 0xc5, 0x3e, 0x75, 0x92, 0xdd, 0x1a, 0x0,
      0xf,  0x59, 0x93, 0xeb, 0x0,  0x90, 0x23, 0x4d, 0x77, 0x91, 0x5b, 0x87, 0x7f, 0x62, 0xc1, 0x29, 0xb,  0x1d, 0x9,
      0x0,  0x19, 0x61, 0xad, 0xc,  0xd4, 0x99, 0x75, 0x20, 0x26, 0x1c, 0xad, 0x20, 0x65, 0x5,  0x4f, 0x56, 0x73, 0x41,
      0x72, 0xb7, 0xc2, 0xab, 0xc6, 0x2f, 0x63, 0x35, 0x18, 0x0,  0x0,  0xa,  0xae, 0x2,  0x0,  0x0,  0x1a, 0x8a, 0x17,
      0x80, 0x12, 0x0,  0x17, 0x79, 0x88, 0xed, 0xe,  0x31, 0x27, 0x86, 0x79, 0xb3, 0x78, 0xbd, 0xb8, 0x4b, 0x8a, 0x42,
      0x94, 0x5e, 0x85, 0xe2, 0xaa, 0x37, 0x1c, 0x15, 0x1a, 0x0,  0x12, 0xcb, 0xa,  0x9b, 0xe9, 0x85, 0x61, 0xaa, 0x56,
      0xde, 0x32, 0x69, 0x18, 0xaa, 0x35, 0xf9, 0xcb, 0xa6, 0x27, 0x19, 0x88, 0x24, 0xed, 0x2,  0x0,  0x0,  0x77, 0x25,
      0x1a, 0x0,  0xa,  0x65, 0xab, 0x51, 0x2b, 0x9f, 0x65, 0x1d, 0xde, 0x3,  0xbb, 0x19, 0x89, 0x1a, 0x0,  0xa,  0x6,
      0x21, 0x8e, 0xbb, 0xe2, 0x57, 0xa,  0x2c, 0x49, 0xc4, 0xb,  0x1a, 0x1,  0x83, 0x1f, 0x0,  0x1,  0xc6, 0x16, 0x0,
      0x1d, 0x81, 0x90, 0xa,  0xa,  0x23, 0x16, 0x58, 0x44, 0x88, 0x10, 0xe1, 0xc8, 0xaf, 0x81, 0x4d, 0x56, 0x4f, 0xa7,
      0x42, 0xe9, 0x98, 0x82, 0x1d, 0x0,  0x82, 0x65, 0xd0, 0x55, 0xc4, 0x16, 0x0,  0x18, 0xab, 0xfd, 0xdd, 0xe3, 0x6f,
      0x94, 0xa0, 0x45, 0xb9, 0xc6, 0xe8, 0x5b, 0x64, 0x41, 0xbe, 0xe4, 0xe8, 0xa7, 0x1e, 0x7e, 0xef, 0x9,  0x62, 0xec,
      0x2,  0x0,  0x0,  0x70, 0xb1, 0x9,  0x0,  0x14, 0x36, 0x52, 0x90, 0x58, 0x37, 0xcc, 0x72, 0x7e, 0x36, 0x89, 0xb8,
      0xd0, 0xd1, 0x60, 0xcf, 0xc0, 0x6e, 0xa,  0x25, 0x92, 0x22, 0xa,  0xbb};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x83, 0x82, 0xd2, 0x84, 0xe0, 0x7c, 0x56, 0xe6, 0x3,  0x53, 0x47, 0x77, 0x9d, 0xf1,
                           0xfa, 0xb3, 0xc1, 0x67, 0x8d, 0xdc, 0x62, 0x6f, 0xc5, 0x3e, 0x75, 0x92, 0xdd};
  uint8_t bytesprops1[] = {0x59, 0x93, 0xeb, 0x0, 0x90, 0x23, 0x4d, 0x77, 0x91, 0x5b, 0x87, 0x7f, 0x62, 0xc1, 0x29};
  uint8_t bytesprops2[] = {0x61, 0xad, 0xc,  0xd4, 0x99, 0x75, 0x20, 0x26, 0x1c, 0xad, 0x20, 0x65, 0x5,
                           0x4f, 0x56, 0x73, 0x41, 0x72, 0xb7, 0xc2, 0xab, 0xc6, 0x2f, 0x63, 0x35};
  uint8_t bytesprops3[] = {0x79, 0x88, 0xed, 0xe,  0x31, 0x27, 0x86, 0x79, 0xb3, 0x78, 0xbd, 0xb8,
                           0x4b, 0x8a, 0x42, 0x94, 0x5e, 0x85, 0xe2, 0xaa, 0x37, 0x1c, 0x15};
  uint8_t bytesprops4[] = {0xcb, 0xa,  0x9b, 0xe9, 0x85, 0x61, 0xaa, 0x56, 0xde,
                           0x32, 0x69, 0x18, 0xaa, 0x35, 0xf9, 0xcb, 0xa6, 0x27};
  uint8_t bytesprops5[] = {0x65, 0xab, 0x51, 0x2b, 0x9f, 0x65, 0x1d, 0xde, 0x3, 0xbb};
  uint8_t bytesprops6[] = {0x6, 0x21, 0x8e, 0xbb, 0xe2, 0x57, 0xa, 0x2c, 0x49, 0xc4};
  uint8_t bytesprops7[] = {0xc6};
  uint8_t bytesprops8[] = {0x81, 0x90, 0xa,  0xa,  0x23, 0x16, 0x58, 0x44, 0x88, 0x10, 0xe1, 0xc8, 0xaf, 0x81, 0x4d,
                           0x56, 0x4f, 0xa7, 0x42, 0xe9, 0x98, 0x82, 0x1d, 0x0,  0x82, 0x65, 0xd0, 0x55, 0xc4};
  uint8_t bytesprops9[] = {0xab, 0xfd, 0xdd, 0xe3, 0x6f, 0x94, 0xa0, 0x45, 0xb9, 0xc6, 0xe8, 0x5b,
                           0x64, 0x41, 0xbe, 0xe4, 0xe8, 0xa7, 0x1e, 0x7e, 0xef, 0x9,  0x62, 0xec};
  uint8_t bytesprops10[] = {0x36, 0x52, 0x90, 0x58, 0x37, 0xcc, 0x72, 0x7e, 0x36, 0x89,
                            0xb8, 0xd0, 0xd1, 0x60, 0xcf, 0xc0, 0x6e, 0xa,  0x25, 0x92};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {27, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 29}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {25, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 2734}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 6794}},
      {.prop = (lwmqtt_prop_t)23, .value = {.byte = 128}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {23, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {18, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 136}},
      {.prop = (lwmqtt_prop_t)36, .value = {.byte = 237}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 30501}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 137}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {10, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 26}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 131}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {1, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {29, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {24, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 28849}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {20, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)34, .value = {.int16 = 2747}},
  };

  lwmqtt_properties_t props = {23, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 150, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoTopicNameInvalid [PropSubscriptionIdentifier 11,PropWillDelayInterval
// 21991,PropAssignedClientIdentifier ",\226\141u\SUB,O\211\188E\239\162\149\174\SOh\249\176[\227\143",PropContentType
// "B\a\160\171\STX!\SO5`\198\SI\177\213\197\n:\\\144",PropResponseTopic
// "\169UZ\203\162\SI\242\235\232=\206\233I\162\224\199",PropReasonString
// "\ETB\251U\131_\203i\253#\202\237\130",PropReceiveMaximum 26751,PropResponseInformation
// "\SYNm\232/R\180h;2t\241\216\&4\243\167\209\174\&1\178:\248uZ\CAN\174\130`"]
TEST(Disco5QCTest, Encode29) {
  uint8_t pkt[] = {0xe0, 0x79, 0x90, 0x77, 0xb,  0xb,  0x18, 0x0,  0x0,  0x55, 0xe7, 0x12, 0x0,  0x15, 0x2c, 0xe2,
                   0x8d, 0x75, 0x1a, 0x2c, 0x4f, 0xd3, 0xbc, 0x45, 0xef, 0xa2, 0x95, 0xae, 0xe,  0x68, 0xf9, 0xb0,
                   0x5b, 0xe3, 0x8f, 0x3,  0x0,  0x12, 0x42, 0x7,  0xa0, 0xab, 0x2,  0x21, 0xe,  0x35, 0x60, 0xc6,
                   0xf,  0xb1, 0xd5, 0xc5, 0xa,  0x3a, 0x5c, 0x90, 0x8,  0x0,  0x10, 0xa9, 0x55, 0x5a, 0xcb, 0xa2,
                   0xf,  0xf2, 0xeb, 0xe8, 0x3d, 0xce, 0xe9, 0x49, 0xa2, 0xe0, 0xc7, 0x1f, 0x0,  0xc,  0x17, 0xfb,
                   0x55, 0x83, 0x5f, 0xcb, 0x69, 0xfd, 0x23, 0xca, 0xed, 0x82, 0x21, 0x68, 0x7f, 0x1a, 0x0,  0x1b,
                   0x16, 0x6d, 0xe8, 0x2f, 0x52, 0xb4, 0x68, 0x3b, 0x32, 0x74, 0xf1, 0xd8, 0x34, 0xf3, 0xa7, 0xd1,
                   0xae, 0x31, 0xb2, 0x3a, 0xf8, 0x75, 0x5a, 0x18, 0xae, 0x82, 0x60};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x2c, 0xe2, 0x8d, 0x75, 0x1a, 0x2c, 0x4f, 0xd3, 0xbc, 0x45, 0xef,
                           0xa2, 0x95, 0xae, 0xe,  0x68, 0xf9, 0xb0, 0x5b, 0xe3, 0x8f};
  uint8_t bytesprops1[] = {0x42, 0x7, 0xa0, 0xab, 0x2,  0x21, 0xe,  0x35, 0x60,
                           0xc6, 0xf, 0xb1, 0xd5, 0xc5, 0xa,  0x3a, 0x5c, 0x90};
  uint8_t bytesprops2[] = {0xa9, 0x55, 0x5a, 0xcb, 0xa2, 0xf,  0xf2, 0xeb,
                           0xe8, 0x3d, 0xce, 0xe9, 0x49, 0xa2, 0xe0, 0xc7};
  uint8_t bytesprops3[] = {0x17, 0xfb, 0x55, 0x83, 0x5f, 0xcb, 0x69, 0xfd, 0x23, 0xca, 0xed, 0x82};
  uint8_t bytesprops4[] = {0x16, 0x6d, 0xe8, 0x2f, 0x52, 0xb4, 0x68, 0x3b, 0x32, 0x74, 0xf1, 0xd8, 0x34, 0xf3,
                           0xa7, 0xd1, 0xae, 0x31, 0xb2, 0x3a, 0xf8, 0x75, 0x5a, 0x18, 0xae, 0x82, 0x60};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 11}},
      {.prop = (lwmqtt_prop_t)24, .value = {.int32 = 21991}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {21, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {18, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {16, (char*)&bytesprops2}}},
      {.prop = (lwmqtt_prop_t)31, .value = {.str = {12, (char*)&bytesprops3}}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 26751}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {27, (char*)&bytesprops4}}},
  };

  lwmqtt_properties_t props = {8, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 144, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}

// DisconnectRequest DiscoImplementationSpecificError [PropTopicAlias 14784,PropServerReference
// "\137jMZ",PropResponseTopic "zW\135\188\248\164yl\192+a\207miV\SOH\220\193\&8(\229/mh7\167\t",PropMaximumPacketSize
// 8003,PropUserProperty "\202\f\ACK*\229\EOT\134\241\DC4v\204\161A"
// "X'\187\165\147\137\207nO\n\233\148\138\138\248\DC4\157\219\155T\139",PropAuthenticationData
// "?\ETB\144p\130gQuI\184,\f\141C3",PropServerKeepAlive 21004,PropMessageExpiryInterval 18390,PropContentType
// "\200'\215P\181a\187\208H\152\210L",PropTopicAlias 18937,PropCorrelationData
// "\128\152\208\147\231\\\141y\138\191\145\167$\223\NAK\DC4 I\199\163\222",PropMessageExpiryInterval
// 4343,PropReceiveMaximum 10269,PropRequestResponseInformation 105,PropSubscriptionIdentifier 7,PropResponseInformation
// "\248&d\EM2#\204\203\219\163\161\177Q\159\147",PropAuthenticationMethod
// "\242\177\\\186\SUBO\240E\"\222\170\242rX\239\181AH\235\139\213\198|u",PropWildcardSubscriptionAvailable
// 44,PropMaximumPacketSize 3490,PropAssignedClientIdentifier "\GS\201\a\185{C",PropAuthenticationData
// "\182\"\FS\182h1l\195\148\a-\189\RSS\197l",PropPayloadFormatIndicator 218]
TEST(Disco5QCTest, Encode30) {
  uint8_t pkt[] = {0xe0, 0xf9, 0x1,  0x83, 0xf6, 0x1,  0x23, 0x39, 0xc0, 0x1c, 0x0,  0x4,  0x89, 0x6a, 0x4d, 0x5a, 0x8,
                   0x0,  0x1b, 0x7a, 0x57, 0x87, 0xbc, 0xf8, 0xa4, 0x79, 0x6c, 0xc0, 0x2b, 0x61, 0xcf, 0x6d, 0x69, 0x56,
                   0x1,  0xdc, 0xc1, 0x38, 0x28, 0xe5, 0x2f, 0x6d, 0x68, 0x37, 0xa7, 0x9,  0x27, 0x0,  0x0,  0x1f, 0x43,
                   0x26, 0x0,  0xd,  0xca, 0xc,  0x6,  0x2a, 0xe5, 0x4,  0x86, 0xf1, 0x14, 0x76, 0xcc, 0xa1, 0x41, 0x0,
                   0x15, 0x58, 0x27, 0xbb, 0xa5, 0x93, 0x89, 0xcf, 0x6e, 0x4f, 0xa,  0xe9, 0x94, 0x8a, 0x8a, 0xf8, 0x14,
                   0x9d, 0xdb, 0x9b, 0x54, 0x8b, 0x16, 0x0,  0xf,  0x3f, 0x17, 0x90, 0x70, 0x82, 0x67, 0x51, 0x75, 0x49,
                   0xb8, 0x2c, 0xc,  0x8d, 0x43, 0x33, 0x13, 0x52, 0xc,  0x2,  0x0,  0x0,  0x47, 0xd6, 0x3,  0x0,  0xc,
                   0xc8, 0x27, 0xd7, 0x50, 0xb5, 0x61, 0xbb, 0xd0, 0x48, 0x98, 0xd2, 0x4c, 0x23, 0x49, 0xf9, 0x9,  0x0,
                   0x15, 0x80, 0x98, 0xd0, 0x93, 0xe7, 0x5c, 0x8d, 0x79, 0x8a, 0xbf, 0x91, 0xa7, 0x24, 0xdf, 0x15, 0x14,
                   0x20, 0x49, 0xc7, 0xa3, 0xde, 0x2,  0x0,  0x0,  0x10, 0xf7, 0x21, 0x28, 0x1d, 0x19, 0x69, 0xb,  0x7,
                   0x1a, 0x0,  0xf,  0xf8, 0x26, 0x64, 0x19, 0x32, 0x23, 0xcc, 0xcb, 0xdb, 0xa3, 0xa1, 0xb1, 0x51, 0x9f,
                   0x93, 0x15, 0x0,  0x18, 0xf2, 0xb1, 0x5c, 0xba, 0x1a, 0x4f, 0xf0, 0x45, 0x22, 0xde, 0xaa, 0xf2, 0x72,
                   0x58, 0xef, 0xb5, 0x41, 0x48, 0xeb, 0x8b, 0xd5, 0xc6, 0x7c, 0x75, 0x28, 0x2c, 0x27, 0x0,  0x0,  0xd,
                   0xa2, 0x12, 0x0,  0x6,  0x1d, 0xc9, 0x7,  0xb9, 0x7b, 0x43, 0x16, 0x0,  0x10, 0xb6, 0x22, 0x1c, 0xb6,
                   0x68, 0x31, 0x6c, 0xc3, 0x94, 0x7,  0x2d, 0xbd, 0x1e, 0x53, 0xc5, 0x6c, 0x1,  0xda};
  uint8_t buf[sizeof(pkt) + 10] = {0};
  uint8_t bytesprops0[] = {0x89, 0x6a, 0x4d, 0x5a};
  uint8_t bytesprops1[] = {0x7a, 0x57, 0x87, 0xbc, 0xf8, 0xa4, 0x79, 0x6c, 0xc0, 0x2b, 0x61, 0xcf, 0x6d, 0x69,
                           0x56, 0x1,  0xdc, 0xc1, 0x38, 0x28, 0xe5, 0x2f, 0x6d, 0x68, 0x37, 0xa7, 0x9};
  uint8_t bytesprops3[] = {0x58, 0x27, 0xbb, 0xa5, 0x93, 0x89, 0xcf, 0x6e, 0x4f, 0xa, 0xe9,
                           0x94, 0x8a, 0x8a, 0xf8, 0x14, 0x9d, 0xdb, 0x9b, 0x54, 0x8b};
  uint8_t bytesprops2[] = {0xca, 0xc, 0x6, 0x2a, 0xe5, 0x4, 0x86, 0xf1, 0x14, 0x76, 0xcc, 0xa1, 0x41};
  uint8_t bytesprops4[] = {0x3f, 0x17, 0x90, 0x70, 0x82, 0x67, 0x51, 0x75, 0x49, 0xb8, 0x2c, 0xc, 0x8d, 0x43, 0x33};
  uint8_t bytesprops5[] = {0xc8, 0x27, 0xd7, 0x50, 0xb5, 0x61, 0xbb, 0xd0, 0x48, 0x98, 0xd2, 0x4c};
  uint8_t bytesprops6[] = {0x80, 0x98, 0xd0, 0x93, 0xe7, 0x5c, 0x8d, 0x79, 0x8a, 0xbf, 0x91,
                           0xa7, 0x24, 0xdf, 0x15, 0x14, 0x20, 0x49, 0xc7, 0xa3, 0xde};
  uint8_t bytesprops7[] = {0xf8, 0x26, 0x64, 0x19, 0x32, 0x23, 0xcc, 0xcb, 0xdb, 0xa3, 0xa1, 0xb1, 0x51, 0x9f, 0x93};
  uint8_t bytesprops8[] = {0xf2, 0xb1, 0x5c, 0xba, 0x1a, 0x4f, 0xf0, 0x45, 0x22, 0xde, 0xaa, 0xf2,
                           0x72, 0x58, 0xef, 0xb5, 0x41, 0x48, 0xeb, 0x8b, 0xd5, 0xc6, 0x7c, 0x75};
  uint8_t bytesprops9[] = {0x1d, 0xc9, 0x7, 0xb9, 0x7b, 0x43};
  uint8_t bytesprops10[] = {0xb6, 0x22, 0x1c, 0xb6, 0x68, 0x31, 0x6c, 0xc3,
                            0x94, 0x7,  0x2d, 0xbd, 0x1e, 0x53, 0xc5, 0x6c};

  lwmqtt_property_t propslist[] = {
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 14784}},
      {.prop = (lwmqtt_prop_t)28, .value = {.str = {4, (char*)&bytesprops0}}},
      {.prop = (lwmqtt_prop_t)8, .value = {.str = {27, (char*)&bytesprops1}}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 8003}},
      {.prop = (lwmqtt_prop_t)38, .value = {.pair = {.k = {13, (char*)&bytesprops2}, .v = {21, (char*)&bytesprops3}}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {15, (char*)&bytesprops4}}},
      {.prop = (lwmqtt_prop_t)19, .value = {.int16 = 21004}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 18390}},
      {.prop = (lwmqtt_prop_t)3, .value = {.str = {12, (char*)&bytesprops5}}},
      {.prop = (lwmqtt_prop_t)35, .value = {.int16 = 18937}},
      {.prop = (lwmqtt_prop_t)9, .value = {.str = {21, (char*)&bytesprops6}}},
      {.prop = (lwmqtt_prop_t)2, .value = {.int32 = 4343}},
      {.prop = (lwmqtt_prop_t)33, .value = {.int16 = 10269}},
      {.prop = (lwmqtt_prop_t)25, .value = {.byte = 105}},
      {.prop = (lwmqtt_prop_t)11, .value = {.int32 = 7}},
      {.prop = (lwmqtt_prop_t)26, .value = {.str = {15, (char*)&bytesprops7}}},
      {.prop = (lwmqtt_prop_t)21, .value = {.str = {24, (char*)&bytesprops8}}},
      {.prop = (lwmqtt_prop_t)40, .value = {.byte = 44}},
      {.prop = (lwmqtt_prop_t)39, .value = {.int32 = 3490}},
      {.prop = (lwmqtt_prop_t)18, .value = {.str = {6, (char*)&bytesprops9}}},
      {.prop = (lwmqtt_prop_t)22, .value = {.str = {16, (char*)&bytesprops10}}},
      {.prop = (lwmqtt_prop_t)1, .value = {.byte = 218}},
  };

  lwmqtt_properties_t props = {22, (lwmqtt_property_t*)&propslist};
  size_t len = 0;
  lwmqtt_err_t err = lwmqtt_encode_disconnect(buf, sizeof(buf), &len, LWMQTT_MQTT5, 131, props);
  EXPECT_EQ(err, LWMQTT_SUCCESS);
  EXPECT_EQ(len, sizeof(pkt));
  EXPECT_ARRAY_EQ(pkt, buf, len);
}
